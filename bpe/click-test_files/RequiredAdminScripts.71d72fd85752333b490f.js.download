(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["RequiredAdminScripts"],{

/***/ "../../../Cognito.Services/Scripts/Cognito-core-admin.js":
/*!************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Cognito.Services/Scripts/Cognito-core-admin.js ***!
  \************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

(( true ? exports : undefined).exec = function(isInIframe) {
(function($) {

	// Create an overlay to hide the underlying page when displaying modal content
	var overlay;
	var onOverlayClick;

	Cognito.ready("append-overlay", "ExoWeb.dom", function ($) {
		overlay = $("#c-modal-overlay");
		if (overlay.length === 0) {
			var cognitoDiv = $('.cognito:first');
			overlay = $("<div id='c-modal-overlay' />").appendTo(cognitoDiv.length == 0 || Cognito.config.flags.AppNav ? document.body : cognitoDiv);
		}
		overlay.click(function () { if (onOverlayClick) onOverlayClick(); });
	});

	// Broadcast token if coming from the login page
	Cognito.ready("broadcast-token", "ExoWeb.dom", function ($) {
		$(document).on("click", '.c-button-progress:not([class*="c-status-"])', function () {
			var $this = $(this);

			// It is possible for the "progress-finished" event to fire before the click event
			// So check to see if there is already a failed or successful class on button
			if(!$this.is(".c-status-failed, .c-status-successful"))
				$this.addClass("c-status-working").prop("disabled", true);
		})
		.on("progress-finished", ".c-button-progress", function(e, status) {
			var $button = $(this);
			$button.removeClass("c-status-working");
			$button.addClass("c-status-" + status);
			setTimeout(function(){
				$button.removeClass("c-status-" + status).prop("disabled", false);
			}, 2500);
		});

	});

	// Shows the modal overlay
	function showOverlay(onClick) {
		onOverlayClick = onClick;
		Cognito.Messaging.trigger("showOverlay");
		overlay.fadeIn();
	}
	Cognito.showOverlay = showOverlay;

	// Hides the modal overlay
	function hideOverlay() {
		onOverlayClick = null;
		Cognito.Messaging.trigger("hideOverlay");
		overlay.fadeOut();
	}
	Cognito.hideOverlay = hideOverlay;

	Cognito.Messaging.addHandler("overlayClicked", function () { $('#c-modal-overlay').trigger('click'); });

	if (isInIframe) {
		Cognito.Messaging.addHandler("navigate", function (data) {
			var navigate = function () {
				if (data.target === "top") {
					window.parent.location = data.url;
				}
				else {
					document.location.href = data.url;
				}
			};
			if (onNavigateDialog) {
				onNavigateDialog.continue = navigate;
				if (!onNavigateDialog.open(data))
					navigate();
			}
			else
				navigate();
		});
	}

	function tryOpenNavigateDialog(data) {
		return new Promise(function (resolve) {
			if (onNavigateDialog) {
				onNavigateDialog.continue = function (changesSaved) {
					resolve({ changesSaved: changesSaved })
				};
				if (!onNavigateDialog.open(data))
					resolve(true);
			}
			else
				resolve(true);
		});
	};

	Cognito.tryOpenNavigateDialog = tryOpenNavigateDialog;

	// Formats value as currency
	function formatCurrency(val) {
		var valString = "$" + Cognito.formatNumber(Math.abs(val).toFixed(2));
		return val >= 0 ? valString : "(" + valString + ")";
	}
	Cognito.formatCurrency = formatCurrency;

	// Format number with thousands separators
	function formatNumber(val) {
		return val.toString().replace(/\B(?=(?:\d{3})+(?!\d))/g, ",");
	}
	Cognito.formatNumber = formatNumber;

	Cognito.Emails = {}

	Cognito.Emails.formatAddresses = function (addresses, tokenPaths, maxNumberOfAddresses) {
		if (typeof addresses !== "string")
			addresses = addresses.join(";");

		var _addresses = [];

		// Get all valid email addresses
		(addresses.match(Cognito.emailAndTokenRegex) || []).forEach(function (addr) {
			addr = addr.replace(/(\xa0|\s)/g, "");
			// Not Empty
			if (addr !== "") {
				// Specific Email Address
				if (addr.match(Cognito.emailRegex))
					_addresses.push(addr);
				// Token
				else if (tokenPaths && addr[0] == '[' && addr[addr.length - 1] == ']' && tokenPaths.indexOf(addr.slice(1, addr.length - 1)) >= 0)
					_addresses.push(addr);
			}
		});

		// Get a distinct set of addresses
		_temp = [];
		_addresses.forEach(function (r) {
			r = r.trim();
			if (_temp.indexOf(r) < 0)
				_temp.push(r);
		})
		_addresses = _temp;

		// Get only the max number of addresses specified
		if (_addresses.length > maxNumberOfAddresses)
			_addresses = _addresses.slice(0, maxNumberOfAddresses);

		return _addresses.join('; ');
	}

	Cognito.Messaging.addHandler("changeOrganization", function(data) {
		Cognito.changeOrganization(data.id, function (responseData) {
			if (responseData.redirect)
				if (responseData.success)
					document.location.href = responseData.redirect;
				else
					window.parent.location.href = responseData.redirect;
			else if (data.redirect)
				document.location.href = data.redirect;
		});
	});

	// Enable views to suppress/participate in navigation
	var onNavigateDialog;
	var blockNavigation;
	var forceNavigation;
	function onNavigate(options) {
		if (!onNavigateDialog) {
			onNavigateDialog = $.fn.dialog(options);
			onNavigateDialog._dialog.css("z-index", 1060);
		}

		blockNavigation = options.open;
		if (onNavigateDialog.open) {
			$(window).on("beforeunload", function (event) {
				if (blockNavigation(event) && !forceNavigation) {
					return options.text;
				}
			});
		}
	}
	Cognito.onNavigate = onNavigate;

	// Performs the specified navigation action if allowed
	// action can also be a data object used by the unsaved changes dialog
	Cognito.navigate = function navigate(action, force) {
		if (force) {
			forceNavigation = true;
			if (typeof action === "function")
				action();
			return Promise.resolve();
		}
		else {
			if (onNavigateDialog) {
				return new Promise(function (resolve) {
					onNavigateDialog.continue = function () {
						onNavigateDialog.close();
						if (typeof action === "function") action.apply(this, arguments);
						resolve();
					};
					if (!onNavigateDialog.open(action))
					{
						if (typeof action === "function")
							action();
						resolve();
					}
				});
			}
			else {
				if (typeof action === "function")
					action();
				return Promise.resolve();
			}
		}
	};

	/**
	 * Hides/shows an element using fadeIn/fadeOut (for use with MS Ajax *:visible and *:visibilityFunction)
	 * @param {HTMLElement} element The target element
	 * @param {boolean} show Whether to show/fadeIn or hide/fadeOut
	 * @param {boolean} isInitializing Whether this is the first time the function has run
	 */
	function visibilityFade(element, show, isInitializing) {
		// Simply hide/show when the visiblity function is first run, since it
		// shouldn't require animation and using fadeIn/fadeOut may not work properly.
		if (isInitializing) {
			if (show)
				$(element).show();
			else
				$(element).hide();
		}

		if (show)
			$(element).fadeIn();
		else
			$(element).fadeOut();
	}

	Cognito.visibilityFade = visibilityFade;

	var module;

	// Get current module
	Cognito.modelReady(function () {
		module = Cognito.config.modules[0];
	});

	Cognito.resendVerification = function() {
		Cognito.serviceRequest({
			endpoint: "admin/resend-verification",
			method: "POST"
		});
	};

	Cognito.createCredentials = function(username, password, success, error) {
		module.serviceRequest({
			endpoint: "credentials",
			method: "POST",
			data: { username: username, password: password },
			success: function(data) {
				if (success && success instanceof Function)
					success(data);
			},
			error: function(jqXHR, textStatus, errorThrown) {
				if (error && error instanceof Function)
					error(jqXHR, textStatus, errorThrown);
			}
		});
	};

	Cognito.updateCredentials = function(id, username, password, success, error) {
		module.serviceRequest({
			endpoint: "credentials",
			method: "PUT",
			data: { id: id, username: username, password: password },
			success: function() {
				if (success && success instanceof Function)
					success();
			},
			error: function(jqXHR, textStatus, errorThrown) {
				if (error && error instanceof Function)
					error(jqXHR, textStatus, errorThrown);
			}
		});
	};

	Cognito.deleteCredentials = function(id, success, error) {
		module.serviceRequest({
			endpoint: "credentials",
			method: "DELETE",
			data: { id: id },
			success: function() {
				if (success && success instanceof Function)
					success();
			},
			error: function(jqXHR, textStatus, errorThrown) {
				if (error && error instanceof Function)
					error(jqXHR, textStatus, errorThrown);
			}
		});
	};

	Cognito.showAnnouncement = function (selector, parentSelector) {
		Cognito.serviceRequest({
			endpoint: "marketing/announcement?module=forms",
			dataType: "html",
			success: function (data) {
				if (data.length === 0) {
					$(parentSelector).hide();
				} else {
					$(parentSelector).show();
					$(selector).attr("data-name", data.substring(4, data.indexOf('-->')));
					$(selector).html(data);
				}
			}
		});
	}

	Cognito.dismissAnnouncment = function(selector, parentSelector) {
		Cognito.serviceRequest({
			endpoint: "marketing/dismissannouncement?name=" + $(selector).attr("data-name"),
			success: function () {
				Cognito.showAnnouncement(selector, parentSelector);
			}
		});
	}

	Cognito.changeOrganization = function(id, callback) {
		Cognito.serviceRequest({
			endpoint: "admin/organization",
			method: "PUT",
			data: { id: id },
			success: function (data) {
				Cognito.Messaging.trigger("organizationChanged", { data: id });

				if (callback instanceof Function) {
					callback(data);
				}
			}
		});
	};

	Cognito.dismissNotification = function(id, callback) {
		Cognito.serviceRequest({
			endpoint: "admin/deletenotification",
			method: "POST",
			data: { id: id },
			success: function(data) {
				if (callback instanceof Function) {
					callback(data);
				}
			}
		});
	};

	var resizeTimeout;
	$(window).resize(function () {
		if (resizeTimeout)
			window.clearTimeout(resizeTimeout);
	});

	if (isInIframe) {
		$(function () {
			// Do not execute during UI Unit testing
			if (document.cookie.indexOf("TestId=") === -1 && !Cognito.config.whiteLabel) {
				if (window.top == window.self) {
					var url = document.location.pathname + document.location.search;

					// Normalize url to NOT have a leading "/"
					// https://developer.mozilla.org/en-US/docs/Web/API/Location/pathname#Browser_compatibility
					if (url.indexOf("/") === 0)
						url = url.substring(1);

					if (url.indexOf("admin/") === 0)
						url = url.substring(6);

					url = url.replace("admin/view/", "");
					document.location.href = Cognito.config.formsUrl + url;
				}
			}

			// Handy little eventing that allows forcing navigation outside of the frame
			$(document).on("click", "a", function (e) {
				var $this = $(this);
				if ($this.attr("data-target") === "top") {
					Cognito.Messaging.trigger("navigate", { data: { location: $this.attr("href") } });

					e.preventDefault();
					return false;
				}
			});
		});
	}
})(ExoJQuery);
})(typeof exports === 'undefined');


/***/ }),

/***/ "../../../Cognito.Services/Scripts/component/cognito-messaging.js":
/*!*********************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Cognito.Services/Scripts/component/cognito-messaging.js ***!
  \*********************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

﻿(( true ? exports : undefined).exec = function() {
window.Cognito = window.Cognito || {};
(function (window) {
	var _handlers = {};

	var Messaging = function () {
		var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
		var event = window.addEventListener ? "message" : "onmessage";
		var eventer = window[eventMethod];

		eventer(event, this._handle, false);
	}

	// Get the value at the specified property path
	function evalPath(obj, path) {
		function index(obj, i) { return obj[i] }
		return path.split('.').reduce(index, obj);
	}

	Messaging.prototype = {
		_handle: function (event) {
			try {
				var payload = JSON.parse(event.data);
			}
			catch (e)
			{ }

			if (payload && payload.event) {
				var handlerList = _handlers[payload.event];

				if (handlerList) {
                    handlerList.forEach(function (handler) {
                        handler.call(event, payload.data);
                    });
				}
			}
		},

		dispose: function () {
			_handlers = {};
		},

		addHandler: function (name, handler) {
            _handlers[name] = _handlers[name] || [];
            _handlers[name].push(handler);
		},

		trigger: function (/* [event,] options */) {
			var event;
			var options;

			if (arguments.length === 2) {
				event = arguments[0];
				options = arguments[1];
			} else if (arguments.length === 1) {
				if (typeof (arguments[0]) === "string") {
					event = arguments[0];
				} else {
					options = arguments[0];
					event = options.event;
				}
			}

			var payload = {};
			payload["event"] = event;

			if (options && options.data) {
					payload["data"] = options.data;
			}

			var target = (options && options.target) || window.parent;
			var origin = (options && options.origin) || "*";

			target.postMessage(JSON.stringify(payload), origin);
		},

		// Creates a proxy for a set of functions that can be safely called across frame boundaries
		proxy: function (target, scope) {

			// Get the function set for the specified target and scope
			var fnSet = evalPath(target, scope);
			var proxy = {};

			// Define a closure to create a proxy wrapper function
			function createProxy(fn) {
				return function () {
					var args = [];
					for (var i = 0; i < arguments.length; i++) {
						arg = arguments[i];

						// Serialize Entity
						if (arg instanceof ExoWeb.Model.Entity) {
							var type = arg.meta.type.get_fullName();
							arg = Cognito.serialize(arg);
							arg.$type = arg.$type || type;
						}

						// Serialize Entity Array
						else if (arg instanceof Array && arg.length > 0 && arg[0] instanceof ExoWeb.Model.Entity) {
							for (var j = 0; j < arg.length; j++) {
								var type = arg[j].meta.type.get_fullName();
								arg[j] = Cognito.serialize(arg[j]);
								arg[j].$type = arg[j].$type || type;
							}
						}

						// Cleanse Arrays
						else if (arg instanceof Array) {
							if (arg.length > 0 && arg[0] instanceof Object) {
								for (var j = 0; j < arg.length; j++) {
									var obj = arg[j];
									var clean = {};
									for (var prop in obj) {
										var val = obj[prop];
										if (val instanceof ExoWeb.Model.Entity || (val instanceof Array && val.length > 0 && val[0] instanceof ExoWeb.Model.Entity))
											continue;
										clean[prop] = val;
									}
									arg[j] = clean;
								}
							}
						}

						// Cleanse Objects
						else if (arg instanceof Object) {
							var clean = {};
							for (var prop in arg) {
								var val = arg[prop];
								if (val instanceof ExoWeb.Model.Entity || (val instanceof Array && val.length > 0 && val[0] instanceof ExoWeb.Model.Entity))
									continue;
								clean[prop] = val;
							}
							arg = clean;
						}						

						args.push(arg);
					}
					Cognito.Messaging.trigger("proxy", { target: target, data: { scope: scope, fn: fn, args: args } });
				};
			}

			// Create proxy functions for each function in the set
			for (var fn in fnSet) {
				proxy[fn] = createProxy(fn);
			}

			return proxy;
		}
	};

	window.Cognito.Messaging = new Messaging();

	// Add a default event handler to generically support controller proxies
	Cognito.Messaging.addHandler("proxy", function (data) {
		for (var i = 0; i < data.args.length; i++) {
			arg = data.args[i];

			// Deserialize Entity
			if (arg && arg.$type) {
				var entity = null;
				if (arg.Id) {
					var type = context.model.meta.type(arg.$type).get_jstype();
					entity = type.meta.get(arg.Id.toString());
				}	
				data.args[i] = Cognito.deserialize(null, arg, entity);
			}

			// Deserialize Entity Array
			if (arg && arg instanceof Array && arg.length > 0 && arg[0].$type) {
				var type = context.model.meta.type(arg[0].$type).get_jstype();
				for (var j = 0; j < arg.length; j++) {
					var entity = null;
					if (arg[j].Id)
						entity = type.meta.get(arg.Id.toString());
					arg[j] = Cognito.deserialize(null, arg[j], entity);
				}
			}
		}
		evalPath(window, data.scope)[data.fn].apply(window, data.args);
	});
})(window);
})();


/***/ }),

/***/ "../../../Cognito.Services/Scripts/required/Cognito-core.js":
/*!***************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Cognito.Services/Scripts/required/Cognito-core.js ***!
  \***************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

(( true ? exports : undefined).exec = function (isInIframe) {
window.Cognito = window.Cognito || {};
Cognito.ieSupportLoaded = false;
Cognito.timers = {};
Cognito.templateComponents = Cognito.templateComponents || [];

// Compatibility
if (!window.console) console = { log: function () { }, error: function () { }, debug: function () { }, warn: function () { } };

(function ($) {

	// ensure the appropriate namespaces exist on the body tag
	document.documentElement.setAttribute("xmlns:sys", "javascript:Sys");
	document.documentElement.setAttribute("xmlns:dataview", "javascript:Sys.UI.DataView");
	document.documentElement.setAttribute("xmlns:content", "javascript:ExoWeb.UI.Content");
	document.documentElement.setAttribute("xmlns:toggle", "javascript:ExoWeb.UI.Toggle");
	document.documentElement.setAttribute("xmlns:template", "javascript:ExoWeb.UI.Template");
	document.documentElement.setAttribute("xmlns:vue", "javascript:ExoWeb.UI.VueComponent");

	var config = {
		sessionToken: "",
		baseUrl: "",
		formsUrl: "",
		websiteBaseUrl: "",
		currentUser: null,
		mode: "",
		organizationCode: "",
		loginAttempts: 0,
		maxLoginAttempts: 1,
		isReady: false,
		tokenUpdated: null,
		authenticate: null,
		serverTimeOffset: 0,
		redirectUrl: "",
		errorCount: 0,
		maxClientErrors: 10,
		scripts: [],
		modules: [],
		resources: {}
	};

	Cognito.config = config = $.extend({}, config, Cognito.config);
	Cognito.resources = $.extend({}, Cognito.resources);

	Cognito._afterReadyEvents = [];
	Cognito._domReadyEvents = [];

	/**
	 * Prevent Vue from making an object observable.
	 * Adapted from VueModel -  https://github.com/cognitoforms/VueModel/blob/master/src/vue-model-observability.ts
	 */
	function preventVueObservability(obj) {
		if (obj && !obj.hasOwnProperty("__ob__")) {
			// Mark the object as "raw" so that Vue won't try to make it observable
			Vue.markRaw(obj);
			return true;
		}
	}

	// Initialize ExoWeb
	$exoweb({
		init: function () {
			var currentUserType = context.model.meta.addType("Cognito.CurrentUserType");
			if (window.Vue) {
				preventVueObservability(context);
				preventVueObservability(context.model);
				preventVueObservability(context.model.meta);
				context.model.meta.addObjectRegistered(function (obj) {
					preventVueObservability(obj);
				});
			}
			currentUserType
				.addProperty({
					name: "Id",
					type: String
				});

			currentUserType
				.addProperty({
					name: "FullName",
					type: String
				});

			currentUserType
				.addProperty({
					name: "EmailAddress",
					type: String
				});
		},

		contextReady: function () { Cognito.ready("ExoWeb.context"); },

		domReady: function () {
			try {
				// Determine if the page is hosted in an iframe dialog.
				var frame = window.frameElement;
				if (frame && $(frame.parentElement).is(".c-modal-content-container")) {
					// If the frame was loaded with a URL, but the src is empty, then assume
					// that the dialog and iframe are being disposed and don't raise events.
					if (frame.contentWindow.location.href && frame.hasAttribute("src") && !frame.getAttribute("src")) {
						return;
					}
				}
			} catch (e) {
				// Ignore potential cross-domain errors when attempting to access the frame element...
			}

			// Set viewport
			Cognito.viewport = $($(".cognito")[0]);

			// Browser detection
			if (Sys.Browser.agent == Sys.Browser.Firefox) {
				$(".cognito:first").addClass("c-firefox");
			}
			else if (Sys.Browser.agent == Sys.Browser.Safari) {
				$(".cognito:first").addClass("c-safari");
			}
			else if (Sys.Browser.agent == Sys.Browser.Opera) {
				$(".cognito:first").addClass("c-opera");
			}

			// Fire any remaining events
			Cognito.ready("ExoWeb.dom");

			// After ready
			Cognito.timers.afterReady = window.setTimeout(function () {
				Cognito.heartbeat();

				$.each(Cognito._afterReadyEvents, function () {
					this.call(window, ExoJQuery);
				});
			}, 0);

			Cognito.config.isReady = true;
		}
	});

	// Start heartbeat
	function heartbeat() {
		$.event.trigger({
			type: "heartbeat.cognito"
		});
		window.setTimeout(heartbeat, 60000);
	}
	Cognito.heartbeat = heartbeat;

	// create on method
	function on(evtName, callback) {
		$(document).on(evtName, callback);
	}
	Cognito.on = on;

	// create fire method
	function fire(/* [event,] options */) {
		var event;
		var options;

		if (arguments.length === 2) {
			event = arguments[0];
			options = arguments[1];
		} else if (arguments.length === 1) {
			if (typeof (arguments[0]) === "string") {
				event = arguments[0];
			} else {
				options = arguments[0];
				event = options.event;
			}
		}

		var payload = {};

		if (options && options.data) {
			payload = options.data;
		}

		if (event) {
			var jqEvent = $.Event(event);
            $(document).trigger(jqEvent, [payload]);

            // If there is another copy of jquery loaded, raise the event on it as well
            if (window.jQuery && $ !== window.jQuery) {
                var otherEvent = new window.jQuery.Event(event);
                window.jQuery(document).trigger(otherEvent, [payload]);
            }

			return jqEvent;
		}
	}
	Cognito.fire = fire;

	function getScript(url) {
		var head = document.getElementsByTagName("head")[0] || document.documentElement;
		var scriptNode = document.createElement("script");
		scriptNode.type = "text/javascript";
		scriptNode.async = false;
		scriptNode.defer = false;

		head.insertBefore(scriptNode, head.firstChild);

		scriptNode.src = url;
	}
	Cognito.getScript = getScript;


	function deleteCookie(name) {
		document.cookie = name + "=deleted; expires=" + new Date(0).toUTCString();
	}

	// Gets the current time adjusting for the server time offset
	function now() {
		return config.serverTimeOffset ? new Date(new Date().getTime() + config.serverTimeOffset) : new Date();
	}
	Cognito.now = now;

	// Gets the current date adjusting for the server time offset and the form timezone offset
	function today(offset) {
		var correctDate = now();
		return new Date(new Date(correctDate.getFullYear(), correctDate.getMonth(), correctDate.getDate(), 0, correctDate.getHours() * 60 + correctDate.getMinutes() + offset + correctDate.getTimezoneOffset()).setHours(0, 0, 0, 0));
	}
	Cognito.today = today;

	function serverNow() {
		return new Date(config.serverTimeOffset);
	}
	Cognito.serverNow = serverNow;

	// Ready - handles tracking of one time dependencies to synchronize code execution
	var readyDependencies = Cognito.readyDependencies || {};
	Cognito.readyDependencies = readyDependencies;
	function ready(/* name, [[, dependencies], action] */) {

		// Invoke the dependent action if dependencies are all available
		var invokeDependent = function (dependent) {
			if (!dependent.action)
				return false;
			for (var d = 0; d < dependent.dependencies.length; d++) {
				var dependency = readyDependencies[dependent.dependencies[d]];
				if (!(dependency == true))
					return false;
			}
			//console.log("%cInvoking: " + dependent.name + (dependent.name == "Unknown" ? " (" + dependent.action.toString().substring(0, 50).replace(/[^a-zA-Z0-9\(\{\)\}]/gi, '') + ")" : ""), (dependent.name.indexOf('activate') > -1 ? 'color: red;' : 'color: blue;'));
			try {
				dependent.action(ExoJQuery);
				dependent.action = null;
				ready(dependent.name);
				return true;
			} catch (e) {
				console.error(e);

				if (window.appInsights) {
					appInsights.trackException(e, "Cognito.ready", { readyActionName: dependent.name });
				}

				readyDependencies[dependent.name] = false;
				return false;
			}
		}

		// Dependency
		if (arguments.length == 1) {
			var dependents = readyDependencies[arguments[0]];
			readyDependencies[arguments[0]] = true;
			//console.log("%cRaising: " + arguments[0], "color: green;");
			if (dependents) {
				for (var d = 0; d < dependents.length; d++) {
					if (readyDependencies[dependents[d]] !== false) {
						invokeDependent(dependents[d]);
					}
				}
			}
		}

			// Dependent
		else {

			// Create the dependent tracking object
			var dependent = {
				name: arguments[0],
				dependencies: arguments.length == 3 ? (typeof (arguments[1]) == "string" ? [arguments[1]] : arguments[1]) : [],
				action: arguments.length == 3 ? arguments[2] : arguments[1]
			};

			// Register the dependent if it cannot be invoked
			if (!invokeDependent(dependent)) {
				//console.log("%cRegistering: " + dependent.name + (dependent.name == "Unknown" ? " (" + dependent.action.toString().substring(0, 50).replace(/[^a-zA-Z0-9\(\{\)\}]/gi, '') + ")" : "") + ", dependent upon: " + dependent.dependencies.toString(), "color: #aaa;");
				for (var d = 0; d < dependent.dependencies.length; d++) {
					var dependency = readyDependencies[dependent.dependencies[d]];
					if (!dependency)
						readyDependencies[dependent.dependencies[d]] = [dependent];
					else if (dependency instanceof Array)
						dependency.push(dependent);
				}
			}
		}
	}
	Cognito.ready = ready;

	function domReady(action) {
		if (action instanceof Function) {
			Cognito.ready(action.name || "Unknown", "ExoWeb.dom", action);
		}
	}
	Cognito.domReady = domReady;

	function afterDomReady(/* readyFunction */) {
		if (arguments[0] instanceof Function) {
			if ($.isReady) {
				arguments[0].call(window, ExoJQuery);
			} else {
				Cognito._afterReadyEvents.push(arguments[0]);
			}
		}
	}
	Cognito.afterDomReady = afterDomReady;

	function modelReady(/* readyFunction */) {
		if (arguments[0] instanceof Function) {
			$exoweb({ contextReady: arguments[0] });
		}
	}
	Cognito.modelReady = modelReady;

	var pendingRequests = {};

	function abortRequests(endpoint) {
		// Needed for removing all requests with razor migration
		if (arguments.length === 0) {
			Object.keys(pendingRequests).forEach(function (key) {
				abortRequests(key);
			});
		}
		else {
			var requests = pendingRequests[endpoint];
			if (requests) {
				requests = requests.slice();
				while (requests.length > 0) {
					var reqObj = requests.pop();
					reqObj.__abort = true;
					reqObj.abort();
				}
			}
		}
	}
	Cognito.abortRequests = abortRequests;

	function serviceRequest(options) {
		options.module = options.module || "";
		options.mode = options.mode || Cognito.config.mode;
		options.method = options.method || "GET";
		options.endpoint = options.endpoint || "";
		options.data = options.data || {};
		options.dataType = options.dataType || "json";
		options.success = options.success || function (data, textStatus, jqXHR) { };

		var errorOption = options.error;
		options.error = function (jqXHR, textStatus, errorThrown) {
			if (jqXHR && jqXHR.__abort === true)
				return;

			if (errorOption)
				errorOption.apply(this, arguments);
			else if (window.console)
				console.error(textStatus);
		};
		options.complete = options.complete || function (jqXHR, textStatus) { };
		options.async = typeof (options.async) === "undefined" ? true : options.async;
		options.contentType = options.overrideContentType ? options.contentType : options.contentType || "application/json; charset=utf-8";
		options.uploadProgress = options.uploadProgress || null;
		options.context = options.context || null;
		options.passive = options.passive || false;
		options.useSubmissionToken = options.useSubmissionToken || false;

		if (options.method.toUpperCase() === "GET")
			options.contentType = "text/plain";

		// serialize the object if it is a Cognito object
		if (options.data.meta) {
			options.contentType = "application/json+cognito; charset=utf-8";
			options.data = Cognito.serialize(options.data);
		}

		if (typeof (options.data) !== "string" && options.contentType && options.contentType.indexOf("application/json") === 0) {
			options.data = JSON.stringify(options.data);
		}

		// Coerce arrays into distinct parameter values
		var data = options.data;
		if (typeof (options.data) !== "string") {
			for (var key in data) {
				if (data.hasOwnProperty(key) && data[key] instanceof Array) {
					var arr = data[key];
					delete data[key];
					for (var i = 0; i < arr.length; i++) {
						data[key + "[" + i + "]"] = arr[i] instanceof Object ? JSON.stringify(arr[i]) : arr[i];
					}
				}
			}
		}

		if (options.endpoint === "") {
			if (window.console) {
				console.error("endpoint is required");
			}
			return;
		}

		// If the browser is IE, append token to requests
		if ($.browser.msie && parseInt($.browser.version, 10) < 10) {
			if (options.endpoint.indexOf("?") == -1) {
				options.endpoint += "?";
			}
			else {
				options.endpoint += "&";
			}

			options.endpoint += "me1=" + options.method;
			options.endpoint += "&ct1=" + encodeURIComponent(options.contentType);

            if ($('#g-recaptcha-response')[0])
                options.endpoint += "&xrec1=" + encodeURIComponent(grecaptcha.getResponse());
			else if ($('#c-nobots')[0])
				options.endpoint += "&xnobots1=" + encodeURIComponent($('#c-nobots').val());
		}

		// Pass through the test id to support UI unit testing
		try {
			if (document.cookie.indexOf("TestId=") >= 0) {
				if (options.endpoint.indexOf("?") == -1) {
					options.endpoint += "?";
				}
				else {
					options.endpoint += "&";
				}
				options.endpoint += "TestId=" + encodeURIComponent(document.cookie.substr(document.cookie.indexOf("TestId=") + 7, 36));
			}
		} catch (e) { }

		var headers = {
			"X-Requested-With": "XMLHttpRequest"
		};

		if (Cognito.config.oid) {
			headers["X-Organization"] = Cognito.config.oid;
		}

        if (options.passive === true) {
            headers["X-Passive-Request"] = 1;
        }

		if ($.inArray(options.method.toUpperCase(), ["GET", "POST"]) === -1) {
			headers["X-HTTP-Method-Override"] = options.method;
			options.method = "POST";
		}
		//recaptcha box showing
		if ($('#g-recaptcha-response')[0])
			headers["X-Recaptcha"] = grecaptcha.getResponse();

        //dom event raised, user not a bot
		else if ($('#c-nobots')[0])
			headers["X-NoBots"] = $('#c-nobots').val();

		// workaround because jqXHR does not expose upload property
		if (options.uploadProgress) {
			options.xhr = function () {
				var xhr = $.ajaxSettings.xhr();
				if (xhr.upload) {
					xhr.upload.onprogress = function (event) {
						var percent = 0;
						var position = event.loaded || event.position; /*event.position is deprecated*/
						var total = event.total;
						if (event.lengthComputable) {
							percent = Math.ceil(position / total * 100);
						}
						options.uploadProgress(event, position, total, percent);
					};
				}
				return xhr;
			};
		}

		var url = Cognito.config.baseUrl;
		if (options.module.length !== 0) {
			url += options.module + "/" + options.mode + "/";
		}

		url += options.endpoint;

		// Raise service request event
		$.event.trigger({
			type: "cognito.serviceRequest"
		});

		function sendRequest() {
			// Track pending requests to the specified endpoint
			var requests = pendingRequests[options.endpoint];
			if (requests === undefined)
				pendingRequests[options.endpoint] = requests = [];

			var jqXHR = $.ajax({
				contentType: options.contentType,
				type: options.method,
				url: url,
				dataType: options.dataType,
				async: options.async,
				data: options.data,
				success: function (data, textStatus, jqXHR) {

					// Remove the pending request
					var index = requests.indexOf(jqXHR);
					if (index >= 0)
						requests.splice(index, 1);

					var token = jqXHR.getResponseHeader("X-SessionToken");

					// Determine the server time offset relative to the client time during posts
					try {
						var serverTimeHeader = jqXHR.getResponseHeader("X-Server-Time");
						if (serverTimeHeader) {
							var serverTime = new Date(serverTimeHeader);
							Cognito.config.serverTimeOffset = serverTime.getTime() - new Date().getTime();
						}
					}
					catch (e) { }

					options.success(data, textStatus, jqXHR);
				},
				error: function (jqXHR, textStatus, errorThrown) {

					// Remove the pending request
					var index = requests.indexOf(jqXHR);
					if (index >= 0)
						requests.splice(index, 1);

					// If session timed out, allow user to reload the page
					if (jqXHR.status === 419) {
						if ($("#c-core-timeout").length === 0) {
							// Create timeout view if it does not currently exist
							$(".cognito:first").append("<div id='c-core-timeout'>Your request has timed out, click <a href='javascript: document.location.reload()'>here</a> to reload</div>");
						}

						$(".cognito").children().hide();
						$("#c-core-timeout").show();
					}
					else if (jqXHR.status === 400 && jqXHR.responseText === 'captcha') {
						if (!$('#g-recaptcha-response')[0]) {
							grecaptcha.render("c-recaptcha-div", {
								theme: "clean",
								sitekey: Cognito.config.recaptchaKey
							});
						}
					}
					else if (jqXHR.status === 401) {
						var returnUrl = encodeURIComponent(location.href);
						location.href = '/login?logoutReason=TokenTimeout&returnUrl=' + returnUrl;
					}

					if (options.context)
						options.error.call(this, jqXHR, textStatus, errorThrown, options.context);
					else
						options.error.call(this, jqXHR, textStatus, errorThrown);
				},
				complete: options.complete,
				beforeSend: options.beforeSend,
				processData: options.processData,
				headers: headers,
				context: !options.context ? this : options.context,
				xhr: options.xhr
			});

			// Add the request to the list of pending endpoint requests
			requests.push(jqXHR);
		}

		if (options.useSubmissionToken) {
			var submissionToken = localStorage.getItem('SubmissionToken');
			var segments = submissionToken !== null ? submissionToken.split('|') : null;

			/* eslint-disable-next-line es/no-number-parseint, es5/no-es6-static-methods */
			if (!submissionToken || new Date().getTime() > Number.parseInt(segments[1]) || Cognito.config.oid !== segments[2]) {
				serviceRequest({
					endpoint: "/svc/csrf",
					dataType: "text",
					success: function (data) {
						headers['CsrfToken'] = data;
						localStorage.setItem('SubmissionToken', data + '|' + (new Date().getTime() + 60 * 60 * 23 * 1000) + '|' + Cognito.config.oid);
						sendRequest();
					}
				});
			}
			else {
				headers['CsrfToken'] = segments[0];
				sendRequest();
			}
		}
		else
			sendRequest();
	}
	Cognito.serviceRequest = serviceRequest;

	function loadContent(content, target, activate) {
		var shouldActivate = typeof (activate) === "undefined" ? true : activate;

		var targetElement = $(target);

		if (targetElement.length == 0) {
			Cognito.ready("cognito-load-content", "ExoWeb.dom", function ($) {
				$(target).append(content);
			});
		} else {
			targetElement.append(content);
		}
	}
	Cognito.loadContent = loadContent;

	function load(module, args, options) {
		options = options || {};
		options.mode = options.mode || "public";
		options.target = options.target || "";
		options.view = options.view || "";
		options.success = options.success || function () { };
		options.args = options.args || {};

		var url = module + "/" + options.mode;

		if (options.view !== "") {
			url += "?view=" + options.view;
		}

		var currentLocation = location.href;
		if (location.hash) {
			currentLocation = location.href.replace(location.hash, "");
			currentLocation += decodeURIComponent(location.hash);
		}

		args["embedUrl"] = args["embedUrl"] || currentLocation;

		var newArgs = "";
		for (var property in args) {
			var arg = args[property];
			if (typeof arg == "object")
				arg = JSON.stringify(arg);

			newArgs += property + "=" + encodeURIComponent(arg) + "&";
		}

		// Add query string parameters from containing page
		newArgs += document.location.search ? ("$qs=" + encodeURIComponent(document.location.search.substring(1))) : "";

		// Trim trailing &
		if (newArgs.length > 0 && newArgs[newArgs.length] === "&") {
			newArgs = newArgs.substring(0, newArgs.length - 1);
		}

		if (options.target === "") {
			options.target = ".cognito:first";
		}

		var requestOptions = {
			method: "GET",
			dataType: "text",
			async: options.async || false,
			endpoint: url,
			success: function (data) {
				Cognito.loadContent(data, options.target);

				options.success();
			},
			error: options.error
		};

		// If the argument length exceeds 1000 characters, POST instead of GET
		if (newArgs && newArgs.length > 1000) {
			requestOptions.method = "POST";
			requestOptions.contentType = "application/x-www-form-urlencoded";
			requestOptions.data = newArgs;
		} else {
			requestOptions.endpoint += (url.indexOf("?") > -1 ? "&" : "?") + newArgs;
		}

		Cognito.serviceRequest(requestOptions);

		return;
	}
	Cognito.load = load;

	function loadConfig(module, options) {
		options = options || {};
		options.target = options.target || "";
		options.view = options.view || "";
		options.args = options.args || "";

		var url = module + "/admin/loadconfig";

		if (options.view !== "") {
			url += "?view=" + options.view;
		}

		if (options.args !== "") {
			url += (url.indexOf("?") > -1 ? "&" : "?") + "args=" + options.args;
		}

		if (options.target === "") {
			if ($("#cognito-interface").length == 0) {
				document.write("<div id=\"cognito-interface\"></div>");
			}
			options.target = "#cognito-interface";
		}

		Cognito.serviceRequest({
			method: "GET",
			dataType: "text",
			async: false,
			endpoint: url,
			success: function (data) {
				Cognito.loadContent(data, options.target);
			}
		});
	}
	Cognito.loadConfig = loadConfig;

	function deserializeDate(value, prop) {
		// get the date format in use for the property to determine how to deserialize
		var dateFormat = prop.get_format().toString();

		// ensure date only data does not have a time component
		if (dateFormat === "d")
			return new Date(value.substr(0, 4), value.substr(5, 2) - 1, value.substr(8, 2));

		// deserialize time data with common date 1/1/1970
		else if (dateFormat === "t") {
			var fullDate = new Date(value);

			// if a date could not be created from the time data provided, then assume the value is only the time component and
			// deserialize to a common date
			if (isNaN(fullDate.getDate())) {
				return new Date(1970, 0, 1, value.substr(0, 2), value.substr(3, 2), value.substr(6, 2));
			} else {
				return fullDate;
			}
		}
		// otherwise, assume the value represents a valid date and time
		else
			return new Date(value);
	}
	Cognito.deserializeDate = deserializeDate;

	// recursively loads json data into entities.
	var instancesPendingInit;
	var instancesPendingLoad;
	function deserialize(type, data, entity) {

		// return null if the input is already null
		if (!data)
			return null;

		var isTopLevelCall = false;

		// ignore changes that occur during deserialization
		var result = null;
		context.server.ignoreChanges(function () {

			// track existing instances pending initialization
			if (!instancesPendingInit) {
				instancesPendingInit = [];
				instancesPendingLoad = [];
				isTopLevelCall = true;
			}

			// does the data contain an array
			if (data instanceof Array) {
				result = [];

				$.each(data, function (index, element) {
					result.push(deserialize(type, element));
				});

				if (isTopLevelCall) {
					instancesPendingInit.forEach(function (obj) {
						for (var t = obj.meta.type; t; t = t.baseType) {
							var handler = t._getEventHandler("initExisting");
							if (handler)
								handler(obj, {});
						}
					});
					instancesPendingInit = null;
				}

				return;
			}

			// change the target type if a type marker was included
			if (data.$type) {
				type = context.model.meta.type(data.$type).get_jstype();
			}
			// determine dynamic type
			else if (Cognito.dynamicTypes) {
				type = Cognito.getDynamicType(type, data) || type;
			}

			var initProperties = {};
			var deserializeIntoEntity = false;

			// Create the entity if not deserializing into an existing instance
			if (!entity) {

				// if the object has an id, try and get it from the object pool
				// check explicity null & undefined, b/c enums will have an id of 0 which
				// evaluates to false
				if (data.Id != null && data.Id != undefined) {
					// Don't use DynamicEntity's "Id" property as a client-side identifier
					// NOTE: If in the future we want to begin using this as the client-side Id,
					// then we could also leverage this to detect whether the item has been saved
					var idProperty = type.meta.property("Id");
					if (idProperty && idProperty.get_containingType().get_fullName() === "Cognito.DynamicEntity") {
						entity = new type(type.meta.newId());
					} else {
						// look to see if the current object is in the object pool
						entity = type.meta.get(data.Id.toString());

						// if the object was in the pool, return it
						// else construct a new type passing in the Id, which will add the object to pool
						// and then continue to deserialize the new entity
						if (entity) {
							result = entity;

							if (isTopLevelCall)
								instancesPendingInit = null;

							return;
						}
						else {
							entity = new type(data.Id.toString());
						}
					}
				}
				else
					entity = new type(type.meta.newId());

				// add the entity to the set that is pending initialization
				instancesPendingInit.push(entity);
			}
			else {
				deserializeIntoEntity = true;
			}

			// set the entity version (if present)
			if (data.$version) {
				entity.$version = data.$version;
			}

			// set the etag (if present)
			if (data.$etag) {
				entity.$etag = data.$etag;
			}

			// process each data property
			for (var propName in data) {

				// get the property
				var prop = type.meta.property(propName);

				if (prop !== null) {
					// get the value
					var value = data[propName];
					var jstype = prop.get_jstype();

					// initialize the property if it is a value type
					if (prop.get_isValueType()) {
						if (jstype === Date && value && value.constructor === String) {
							value = deserializeDate(value, prop);
						}

						if (deserializeIntoEntity)
							entity.set(propName, value);
						else if (prop.get_isList()) {
							initProperties[propName] = value.slice();
						} else {
							initProperties[propName] = value;
						}
					}

					// recursively load entity properties
					else {

						// List
						if (prop.get_isList() && value instanceof Array) {
							var isLookupListProperty = Cognito.Forms && Cognito.Forms.FormEntry && prop.get_jstype().meta.baseType === Cognito.Forms.FormEntry.meta && value.length > 0 && typeof (value[0]) === "string";
							// Existing Entity List
							if (deserializeIntoEntity && !isLookupListProperty) {
								var targetList;
								if (deserializeIntoEntity && entity.meta.type.property(propName))
									targetList = entity.get(propName);
								var i = 0;
								for (i; i < value.length; i++) {
									var targetChild = targetList[i];
									// Update
									if (targetChild)
										Cognito.deserialize(jstype, value[i], targetChild);
										// Insert
									else
										targetList.add(Cognito.deserialize(jstype, value[i]));
								}

								// Delete remaining items
								targetList.removeRange(i, targetList.length);
							}

							// Lookup Entity List
							else if (isLookupListProperty) {
								value = value.slice();

								// Clear existing list
								if (deserializeIntoEntity && entity.meta.type.property(propName))
									entity.get(propName).clear()

								initProperties[propName] = value;
								for (var j = 0; j < value.length; j++)
									instancesPendingLoad.push({ instance: entity, property: prop, id: value[j] });
							}

							// New Entity List
							else {
								initProperties[propName] = value.map(function (child) {
									return Cognito.deserialize(jstype, child);
								});
							}

						}

						// Enum
						else if (value && prop.get_jstype().meta._isEnum) {
							if (deserializeIntoEntity)
								entity.set(propName, jstype.meta.get(value));
							else
								initProperties[propName] = jstype.meta.get(value);
						}

						// Entity
						else {
							var isLookupProperty = prop.get_jstype().meta.baseType === Cognito.Forms.FormEntry.meta && typeof (value) === "string";

							// Existing Entity
							if (deserializeIntoEntity && !isLookupProperty) {
								if (value) {
									var targetEntity = entity.get(propName);
									if (!targetEntity)
										entity.set(propName, Cognito.deserialize(jstype, value, new (jstype)()));
									else
										Cognito.deserialize(jstype, value, targetEntity);
								}
								else
									entity.set(propName, null);
							}

							// Lookup Entity
							else if (isLookupProperty) {
								initProperties[propName] = value;
								instancesPendingLoad.push({ instance: entity, property: prop, id: value });
							}

							// New Entity
							else {
                                initProperties[propName] = Cognito.deserialize(jstype, value);
                            }
						}
					}
				}
			}

			if (!deserializeIntoEntity)
				entity.init(initProperties);

			if (entity._lazyLoader) {
				// unregister the lazyloaders, which are apart of the ServerSync object brought over by $exoweb.
				// Cognito doesn't use the ServerSync, so the lazy loader is unnecessary.
				entity._lazyLoader.allProps.constructor.unregister(entity, entity._lazyLoader.allProps);
			}

			// raise initExisting new existing instances if this is the top level call to deserialize
			if (isTopLevelCall) {

				// if the graph includes unloaded lookups, defer raising init and store the information on the returned entity
				if (instancesPendingLoad.length > 0) {
					entity.meta._instancesPendingLoad = instancesPendingLoad;
					entity.meta._instancesPendingInit = instancesPendingInit;
				}

				// otherwise, raise init existing
				else {
					instancesPendingInit.forEach(function (obj) {
						for (var t = obj.meta.type; t; t = t.baseType) {
							var handler = t._getEventHandler("initExisting");
							if (handler)
								handler(obj, {});
						}
					});
				}

				instancesPendingInit = null;
			}

			// return the new entity
			result = entity;
		})();

		return result;
	}
	Cognito.deserialize = deserialize;

	function normalizeDateValue(value) {
	    return value.getFullYear() + (value.getMonth() < 9 ? "-0" : "-") + (value.getMonth() + 1) + (value.getDate() < 10 ? "-0" : "-") + value.getDate();
	}
	Cognito.normalizeDateValue = normalizeDateValue;

	function normalizeTimeValue(value) {
	    return (value.getHours() < 10 ? "0" : "") + value.getHours() + (value.getMinutes() < 10 ? ":0" : ":") + value.getMinutes() + (value.getSeconds() < 10 ? ":0" : ":") + value.getSeconds();
	}
	Cognito.normalizeTimeValue = normalizeTimeValue;

	function serialize(entity) {
		if (entity == null) {
			return null;
		}

		var result = null;

		if (entity instanceof Array) {
			result = [];

			for (var i = 0; i < entity.length; i++) {
				var element = entity[i];

				// Serialize form entry references as ids
				if (element instanceof Cognito.Forms.FormEntry)
					result.push(element.get_Id());
				else
					result.push(serialize(element));
			}
		}
		else {
			result = {};
			var type = entity.meta.type;

			// Always include the type name if the instance is a derived type
			if (type.baseType)
				result["$type"] = type.get_fullName();

			// Include version (if known)
			if (entity.$version) {
				result["$version"] = entity.$version;
			}

			// Include etag (if known)
			if (entity.$etag) {
				result["$etag"] = entity.$etag;
			}

			var properties = type.get_allproperties();
			for (var p = 0; p < properties.length; p++) {
				var property = properties[p];
				if (property.get_origin() == "server" && property.get_isPersisted()) {
					if (property.get_isValueType()) {
						var value = property.value(entity);

						// serialize date only and time only in special ways
						if (value && property.get_jstype() === Date) {

							// get the date format in use for the property to determine how to serialize
							var dateFormat = property.get_format().toString();

							// ensure date only data does not have a time component
							if (dateFormat === "d")
							    value = normalizeDateValue(value);

							    // ensure time only data does not have a date component or timezone
							else if (dateFormat === "t")
							    value = normalizeTimeValue(value);
						}
						if (property.get_isList()) {
							result[property.get_name()] = value.slice();
						} else {
							result[property.get_name()] = value;
						}
                    }
                    else if (!property.get_isStatic()) {
						var value = property.value(entity);
						var baseType = property.get_jstype().meta.type.baseType;

						if (value && property.get_jstype().meta._isEnum && !property._isList) {
							result[property.get_name()] = value.get_Id();
                        }
                        else if (value && !property._isList && baseType && baseType.get_fullName() === "Cognito.Lookup") {
							result[property.get_name()] = value.get_Code();
						}
                        else if (value && value instanceof Cognito.Forms.FormEntry) {
                            // for lookup fields, we only need to store the id of the child entry
							result[property.get_name()] = value.get_Id();
                        }
						else {
							result[property.get_name()] = serialize(value);
						}
					}
				}
			}
		}

		return result;
	}
	Cognito.serialize = serialize;

	Cognito.isPropertyLookup = function isPropertyLookup(propInfo) {
		return Cognito.Forms.FormEntry && propInfo.get_jstype().meta && propInfo.get_jstype().meta.type.baseType === Cognito.Forms.FormEntry.meta;
	}

	// Forces validation rules to run for every existing entity in the graph
	function validate(entity) {

		// Ignore null or new entities
		if (entity == null || (entity.meta && entity.meta.isNew)) {
			return;
		}

		// Process lists recursively
		if (entity instanceof Array) {
			$.each(entity, function () {
				validate(this);
			});
		}

		// Run rules for existing entities and recurse over child entities
		else {

			// Run all validation rules not set to run on existing entities
			$.each(entity.meta.type.rules, function () {
				if (this.isRegistered && (this instanceof ExoWeb.Model.ConditionRule || (ExoWeb.Model.Rule.requiredRatingScale && this instanceof ExoWeb.Model.Rule.requiredRatingScale)) && (this.invocationTypes & 2) == 0)
					this.execute.call(this, entity);
			});

			// Recurse over child entities
			$.each(entity.meta.type.get_allproperties(), function () {
				// No need to validate lookup entries
				if (this.get_origin() == "server" && this.get_isPersisted() && !this.get_isValueType() && !this.get_isStatic() && !Cognito.isPropertyLookup(this))
					validate(this.value(entity));
			});
		}

		return entity;
	}
	Cognito.validate = validate;

	// Removes all conditions for which the specified object is the root instance
	function deleteEntity(entity) {

		// Ignore null entities
		if (entity == null)
			return;

		// Process lists recursively
		if (entity instanceof Array) {
			$.each(entity, function () {
				deleteEntity(this);
			});
		}

		// Run rules for existing entities and recurse over child entities
		else {

			// Clear conditions on the entity if it is the root instance
			$.each(entity.meta.conditions(), function () {
				if (this.targets && this.targets.length > 0 && this.targets[0].target == entity)
					this.destroy();
			});

            // Destroy the entity to ensure rules are not executed for deleted entities
            entity.meta.destroy();

			// Recurse over child entities
			$.each(entity.meta.type.get_allproperties(), function () {
				if (this.get_origin() == "server" && this.get_isPersisted() && !this.get_isValueType() && !this.get_isStatic() && !Cognito.isPropertyLookup(this))
					deleteEntity(this.value(entity));
			});
		}

		return entity;
	}
	Cognito.deleteEntity = deleteEntity;

	function getNormalizedName(name) {
		if (name) {
			// Capitalize the first letter of every word
			var normalizedName = name.replace(/([^\s])([^\s]*)/g, function (g0, g1, g2) { return g1.toUpperCase() + g2; });

			// Remove all characters that is not alphanumeric
			// Regex pattern matches all characters that are valid for javascript identifiers, exclude "_" as Cognito does not allow underscore to be used in a field's internal name
			normalizedName = normalizedName.replace(/[^0-9a-zA-Z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u02bb-\u02c1\u02d0-\u02d1\u02e0-\u02e4\u02ee\u0370-\u0373\u0376-\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0523\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0621-\u064a\u0660-\u0669\u066e-\u066f\u0671-\u06d3\u06d5\u06e5-\u06e6\u06ee-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07c0-\u07ea\u07f4-\u07f5\u07fa\u0904-\u0939\u093d\u0950\u0958-\u0961\u0966-\u096f\u0971-\u0972\u097b-\u097f\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc-\u09dd\u09df-\u09e1\u09e6-\u09f1\u0a05-\u0a0a\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a66-\u0a6f\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0-\u0ae1\u0ae6-\u0aef\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32-\u0b33\u0b35-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b66-\u0b6f\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0be6-\u0bef\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58-\u0c59\u0c60-\u0c61\u0c66-\u0c6f\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0-\u0ce1\u0ce6-\u0cef\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d3d\u0d60-\u0d61\u0d66-\u0d6f\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32-\u0e33\u0e40-\u0e46\u0e50-\u0e59\u0e81-\u0e82\u0e84\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa-\u0eab\u0ead-\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0ed0-\u0ed9\u0edc-\u0edd\u0f00\u0f20-\u0f29\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8b\u1000-\u102a\u103f-\u1049\u1050-\u1055\u105a-\u105d\u1061\u1065-\u1066\u106e-\u1070\u1075-\u1081\u108e\u1090-\u1099\u10a0-\u10c5\u10d0-\u10fa\u10fc\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u17e0-\u17e9\u1810-\u1819\u1820-\u1877\u1880-\u18a8\u18aa\u1900-\u191c\u1946-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u19d0-\u19d9\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u1b50-\u1b59\u1b83-\u1ba0\u1bae-\u1bb9\u1c00-\u1c23\u1c40-\u1c49\u1c4d-\u1c7d\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u2094\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183-\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2c6f\u2c71-\u2c7d\u2c80-\u2ce4\u2d00-\u2d25\u2d30-\u2d65\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3006\u3031-\u3035\u303b-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fc3\ua000-\ua48c\ua500-\ua60c\ua610-\ua62b\ua640-\ua65f\ua662-\ua66e\ua680-\ua697\ua722-\ua788\ua78b-\ua78c\ua7fb-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8d0-\ua8d9\ua900-\ua925\ua930-\ua946\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa50-\uaa59\uac00-\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]/g, ""); //normalizedName = normalizedName.replace(/\W+|_+|\u00E9+/g, "");

			// Prefix with '_' if the name starts with a digit. Note: The regex expression \d in Javascript is equal to [0-9]. The expression has been updated to include digits from all languages and is equivalent to the expression \d in C#
			if (/^[\u0030-\u003A\u0660-\u066A\u06F0-\u06FA\u07C0-\u07CA\u0966-\u0970\u09E6-\u09F0\u0A66-\u0A70\u0AE6-\u0AF0\u0B66-\u0B70\u0BE6-\u0BF0\u0C66-\u0C70\u0CE6-\u0CF0\u0D66-\u0D70\u0DE6-\u0DF0\u0E50-\u0E5A\u0ED0-\u0EDA\u0F20-\u0F2A\u1040-\u104A\u1090-\u109A\u17E0-\u17EA\u1810-\u181A\u1946-\u1950\u19D0-\u19DA\u1A80-\u1A8A\u1A90-\u1A9A\u1B50-\u1B5A\u1BB0-\u1BBA\u1C40-\u1C4A\u1C50-\u1C5A\uA620-\uA62A\uA8D0-\uA8DA\uA900-\uA90A\uA9D0-\uA9DA\uA9F0-\uA9FA\uAA50-\uAA5A\uABF0-\uABFA\uFF10-\uFF1A]/.test(normalizedName)) {
				normalizedName = "_" + normalizedName;
			}

			return normalizedName;
		}

		return null;
	}

	Cognito.getNormalizedName = getNormalizedName;

	function toBase62(number) {
		if (typeof number === "undefined" || number === null) {
			return "";
		}

		if (typeof number !== "number") {
			throw new Error("Function `toBase62` recieved invalid 'number' parameter of type '" + (typeof number) + "'.");
		} else if (number === 0) {
			return "";
		}

		var digits = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";

		var text = "";

		var value = number;

		while (value > 0) {
			var remainder = value % 62;
			value = Math.floor(value / 62);
			text = digits.charAt(remainder) + text;
		}

		return text;
	}

	function fromBase62(text) {
		if (typeof text === "undefined" || text === null) {
			return 0;
		}

		if (typeof text !== "string") {
			throw new Error("Function `fromBase62` recieved invalid 'text' parameter of type '" + (typeof text) + "'.");
		} else if (text.length === 0) {
			return 0;
		}

		var digits = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";

		var number = 0;

		for (var i = text.length - 1; i >= 0; i--) {
			var c = text[i];
			var idx = digits.indexOf(c);
			var b = text.length - 1 - i;
			var pow = Math.pow(62, b);
			number += pow * idx;
		}

		return number;
	}
	//Cognito.fromBase62 = fromBase62;

	function combineUInt16sWithPadding(n1, n2, randomByte1, randomByte2) {

		if (n1 > 0xffff) {
			throw new Error("Value " + n1 + " exceeds maximum unsigned short value of " + 0xffff + ".");
		}

		var n1Bytes = n1 > 0xff ? 2 : 1;

		if (n2 > 0xffff) {
			throw new Error("Value " + n2 + " exceeds maximum unsigned short value of " + 0xffff + ".");
		}

		var n2Bytes = n2 > 0xff ? 2 : 1;

		if (n1Bytes > 1 && n2Bytes > 1) {
			throw new Error("Both values " + n1 + " and " + n2 + " exceeds maximum byte value of " + 0xff + ".");
		}

		var result = 0;

		var randomByte;

		if (arguments.length > 2 && typeof randomByte1 === "number") {
			randomByte = randomByte1;
		} else {
			randomByte = Math.floor(Math.random() * 255);
		}

		randomByte = randomByte & 0xff;

		// Bytes for n2
		result += n2;

		// Bytes for n1
		result += ((n1 << (n2Bytes === 2 ? 16 : 8))) >>> 0;

		if (n1Bytes === 1 && n2Bytes === 1) {
			// Random byte
			result += randomByte << 16;

			// Generate another random byte for the header
			if (arguments.length > 3 && typeof randomByte2 === "number") {
				randomByte = randomByte2;
			} else {
				randomByte = Math.floor(Math.random() * 255);
			}

			randomByte = randomByte & 0xff;
		}

		// Header byte: n1 and n2 byte size, and random bits
		var headerByte = 0;
		headerByte += n2Bytes;
		headerByte += n1Bytes << 2;
		headerByte += (randomByte << 4) & 0x000000f0;
		result += (headerByte << 24) >>> 0;

		return result;
	}

	function splitUInt32WithPadding(i) {
		var headerByte = (i & 0xff000000) >>> 24;

		var n2;
		var n2Bytes = (headerByte & 0x07) & 0x3;
		if (n2Bytes === 2) {
			n2 = i & 0x0000ffff;
		} else {
			n2 = i & 0x000000ff;
		}

		var n1;
		var n1Bytes = ((headerByte & 0x0f) >> 2) & 0x3;
		if (n2Bytes === 2) {
			n1 = (i >>> 16) & 0xff;
		} else if (n1Bytes === 2) {
			n1 = (i >>> 8) & 0xffff;
		} else {
			n1 = (i >>> 8) & 0xff;
		}

		return [n1, n2];
	}
	//Cognito.splitUInt32WithPadding = splitUInt32WithPadding;

	// Initializes the Form and ParentSection properties on a child section
	function initializeParents(parent, child) {

		// Skip initialization of lookups
		if (child instanceof Cognito.Forms.FormEntry)
			return;

		// Set the parent section if possible
		if (parent && child.set_ParentSection)
			child._ParentSection = parent;

		// Set the containing form if possible
		if (parent && child.set_Form) {
			if (parent instanceof Cognito.Forms.FormEntry)
				child._Form = parent;
			else
				child._Form = parent.get_Form();
		}
	}
	Cognito.initializeParents = initializeParents;

	/**
	 * Generate an id based on the given entry version and list item index
	 * @param {number} version The form entry version to be saved
	 * @param {number} listItemIndex The item's index in the list
	 * @returns {string} The generated list item Id
	 */
	function generateListItemId(version, listItemIndex) {
		try {
			if (version > 0xffff)
				throw new Error("Value " + version + " exceeds maximum unsigned short value of " + 0xffff + ".");

			if (listItemIndex > 0xffff)
				throw new Error("Value " + listItemIndex + " exceeds maximum unsigned short value of " + 0xffff + ".");

			var num = combineUInt16sWithPadding(version, listItemIndex, Math.floor(Math.random() * 255), Math.floor(Math.random() * 255));
			var id = toBase62(num);
			return id;
		} catch (e) {
			// If an error occurs, fall back to a pseudo-random string
			// TODO: Log error to app insights?
			return "R-" + ExoWeb.randomText(10, true);
		}
	}
	Cognito.generateListItemId = generateListItemId;

	// Initializes the Form and ParentSection properties on a child section
	function getParentInitializer(parent) {
		return parent instanceof Cognito.Forms.FormEntry ? { Form: parent } : { Form: parent.get_Form(), ParentSection: parent };
	}
	Cognito.getParentInitializer = getParentInitializer;

	function addListItem(parent, list, item) {
		var formEntry = parent instanceof Cognito.Forms.FormEntry ? parent : parent.get_Form();
		var currentEntryVersion = formEntry.get_Entry() ? (formEntry.get_Entry().get_Version() || 0) : 0;
		var id = generateListItemId(currentEntryVersion + 1, list.length);
		id = ensureUniqueListItemId(list, item, id);
		item.set_Id(id);
		list.add(item);
	}
	Cognito.addListItem = addListItem;

	function removeListItem(parent, list, item) {
		// Delete/destory the item
		item = Cognito.deleteEntity(item);

		var idx = list.indexOf(item);
		list.remove(item);

		var formEntry = parent instanceof Cognito.Forms.FormEntry ? parent : parent.get_Form();
		var currentEntryVersion = formEntry.get_Entry() ? (formEntry.get_Entry().get_Version() || 0) : 0;

		var itemsToEnsureUniqueIds = [];

		// Regenerate Ids for items not yet persisted
		for (var i = (idx >= 0 ? idx : 0); i < list.length; i++) {
			var item = list[i];
			if (item.get_Id()) {
				try {
					// Attempt to decode the item's generated Id
					var num = fromBase62(item.get_Id());
					var numComps = splitUInt32WithPadding(num);
					var itemEntryVersion = numComps[0];
					var itemAtIndex = numComps[1];

					// Potentially reassign the Id if it was generated for the next/pending version of the entry
					if (itemEntryVersion === currentEntryVersion + 1) {
						itemsToEnsureUniqueIds.push(item);

						// Re-generate the Id if it doesn't match its current index (ex: moved due to deletion of another item)
						if (itemAtIndex !== i) {
							item.set_Id(generateListItemId(currentEntryVersion + 1, i));
						}
					}
				} catch (e) {
					// Ignore error if unable to decode Id or create new Id
					// TODO: Send error to app insights?
				}
			}
		}

		// Ensure unique Ids after processing all items since multiple items could have Ids reassigned due to the removal
		var idMap = getListItemIdMap(list);
		itemsToEnsureUniqueIds.forEach(function (item) {
			var id = ensureUniqueListItemId(list, item, item.get_Id(), idMap);
			if (id !== item.get_Id()) {
				item.set_Id(id);
				idMap[id] = item;
			}
		});
	}
	Cognito.removeListItem = removeListItem;

	/**
	 * Get a map of list item ids to their index in the list
	 * @param {Array} list
	 * @returns {{ [key: string]: Object }}
	 */
	function getListItemIdMap(list) {
		var idMap = {};
		for (var i = 0; i < list.length; i++) {
			if (list[i]) {
				var id = list[i].get_Id();
				if (id && !idMap.hasOwnProperty(id)) {
					idMap[id] = list[i];
				}
			}
		}
		return idMap;
	}

	/**
	 * Ensures that the given id is unique to the list,
	 * and returns a unique pseudo-random id if it is not
	 * @param {Array} list The list of items
	 * @param {Object} item The item in the list who's Id is being validated
	 * @param {string} id The id to check for uniqueness
	 * @param {{ [key: string]: Object }} idMap An optional pre-built map of ids to items
	 * @returns {string} The unique list item Id to use
	 */
	function ensureUniqueListItemId(list, item, id, idMap) {
		// Generate the id map on-demand if needed
		if (!idMap) {
			idMap = getListItemIdMap(list);
		}

		var itemForId = idMap[id];

		// If the Id isn't used or is used by the item being checked, then return it
		if (!itemForId || itemForId === item) {
			return id;
		}

		// Otherwise, fall back to a pseudo-random string
		for (var attempts = 0; attempts < 10; attempts++) {
			id = "R-" + ExoWeb.randomText(10 + attempts, true);
			itemForId = idMap[id];
			if (!itemForId) {
				return id;
			}
		}

		// Don't assign an id rather than knowingly use a duplicate
		return null;
	}

	function populateLookup(prop, values, isEnum) {
		var propMeta = prop.value(null);

		if (propMeta._lazyLoader) {
			propMeta._lazyLoader.allProps.constructor.unregister(propMeta, propMeta._lazyLoader.allProps);
		}

		if (isEnum) {
			prop.get_containingType()._isEnum = true;
		}

		propMeta.push.apply(propMeta, values);
	}
	Cognito.populateLookup = populateLookup;

	function addModule(module) {

		if (Cognito.hasOwnProperty(module))
			return Cognito[module];

		return new Cognito.Module(module);
	}
	Cognito.addModule = addModule;

	function loadFileData(module, api, fileDataId, successCallback, errorCallback) {
		Cognito.serviceRequest({
			endpoint: module + "/" + api + "/File",
			method: "GET",
			data: { id: fileDataId },
			success: function (data) {
				if (data) {
					if (successCallback) {
						successCallback.apply(this, [data]);
					}
				}
			},
			error: function (data) {
				if (errorCallback) {
					errorCallback.apply();
				}
			}
		});
	}
	Cognito.loadFileData = loadFileData;

	function getDynamicType(baseType, discriminator) {

		// allow base type to be either the actual JS type or the name of the base type
		if (!(baseType instanceof String) && baseType.meta)
			baseType = baseType.meta.get_fullName();

		var typeInfo = Cognito.dynamicTypes[baseType];

		if (typeInfo) {

			// get type discriminator
			if (discriminator instanceof Object)
				discriminator = discriminator[typeInfo.Discriminator].Id;
			var dynamicType = typeInfo.Types[discriminator];

			// return the discriminated dynamic type if found
			if (dynamicType)
				return dynamicType;

			// create base org type
			dynamicType = context.model.meta.type(baseType + "." + Cognito.config.organizationCode);
			if (dynamicType) {
				return dynamicType.get_jstype();
			}
		}
	}

	Cognito.getDynamicType = getDynamicType;

	// Returns an OData query string based on the specified JavaScript object. If the property type is an Array then an expression checking whether
	// the property value matches any values specifed is created, i.e., Where value in (,..n).
	// Example: { Identifier: "123", Type: ["Tree", "Residential"] } returns substringof(Identifier, "123") eq true and (Type eq "Tree" or Type eq "Residential")
	Cognito.getOdataFilter = function (searchCondition) {
		var filter = "";
		for (var key in searchCondition) {
			var value = searchCondition[key];
			if (value) {
				if (!(value instanceof Array)) {
					//var exp = "substringof(" + key + ", '" + value + "') eq true";
					var exp = "startswith(" + key + ", '" + value + "')";
					filter = filter == "" ? exp : filter + " and " + exp;
				}
				else {
					var choiceExp = "";
					value.forEach(function (v) {
						var exp = key + " eq '" + v + "'";
						choiceExp = choiceExp == "" ? "(" + exp : choiceExp + " or " + exp;
					});
					choiceExp = choiceExp + ")"
					filter = filter == "" ? choiceExp : filter + " and " + choiceExp;
				}
			}
		}

		return filter;
	}

	function getChoiceOptions(adapter) {
		var options = [];
		$.grep(adapter.get_options(), function (option) { options.push(option.get_rawValue()); });
		var otherValue = null;
		var isCheckboxList = $.isArray(adapter.get_rawValue());

		// Checkbox
		if (isCheckboxList)
			otherValue = $(adapter.get_rawValue()).not(options).get()[0] ? $(adapter.get_rawValue()).not(options).get()[0] : "";

			// Radio
		else
			otherValue = !options.contains(adapter.get_rawValue()) ? adapter.get_rawValue() : "";

		var otherOptionAdapter = new ExoWeb.View.OptionAdapter(adapter, otherValue);
		otherOptionAdapter.isFillInOption = true;

		// Ensure that blank values are not considered selected when binding radio buttons
			otherOptionAdapter.get_otherSelected = function () {
			return otherOptionAdapter.get_selected() && !!otherOptionAdapter.get_displayValue();
		};
		otherOptionAdapter.set_otherSelected = function (value) {
			otherOptionAdapter.set_selected(value);
			if (!value)
				otherOptionAdapter.set_displayValue(null);

			Sys.Observer.raisePropertyChanged(this, "otherSelected");
			};

		return adapter.get_options().concat([otherOptionAdapter]);
	}
	Cognito.getChoiceOptions = getChoiceOptions;

	// Gets a value indicating whether the model is valid by traversing the object model searching for
	// conditions. You can also search for a specific condition by specifying the condition code.
	function isModelValid(obj, conditionCode) {
		if (obj.meta.conditions().length > 0) {
			if (!conditionCode)
			return false;
			// Search for specific condition code
			else if (obj.meta.conditions().filter(function (c) { return c.type.code === conditionCode; }).length > 0)
				return false;
		}

			var propertyInfos = obj.meta.type.get_properties();
			for (var i = 0; i < propertyInfos.length; i++) {
				var propInfo = propertyInfos[i];

				// Do not validate static or calculated properties
				if (propInfo.get_isStatic() || !propInfo.get_isPersisted() || Cognito.isPropertyLookup(propInfo))
					continue;

				var fieldName = propInfo.get_fieldName();
				if (obj[fieldName] && obj[fieldName].meta && obj[fieldName].meta instanceof ExoWeb.Model.ObjectMeta) {
				if (!isModelValid(obj[fieldName], conditionCode)) {
						return false;
					}

				} else if (propInfo.get_isList()) {
					var children = obj[fieldName];
					if (children) {
						for (var j = 0; j < children.length; j++) {
							var child = children[j];
							if (child.meta && child.meta instanceof ExoWeb.Model.ObjectMeta)
							if (!isModelValid(child, conditionCode)) {
									return false;
								}
						}
					}
				}
			}

		return true;
	}

	Cognito.isModelValid = isModelValid;

	// Get enumeration with type and name
	function getEnumWithName(enumType, name) {
		return enumType.get_All().filter(function (e) { return e.get_Name() === name; })[0];
	}
	Cognito.getEnumWithName = getEnumWithName;

	Cognito.getJsType = function (typeName) {
		if (typeName === null)
			return null;
		var types = context.model.meta.types().filter(function (t) { return t.get_fullName().toLowerCase() === typeName.toLowerCase(); });
		return types.length > 0 ? types[0].get_jstype() : null;
	};

	function formatUrl(url, entity) {
		var urlParts = url.split("?");

		if (url.indexOf("?") >= 0) {

			var domainPart = url.substr(0, url.indexOf("?") + 1);
			var qsPart = url.substr(domainPart.length);

			var redirectUrl = ExoWeb.Model.Format.fromTemplate(entity.meta.type, domainPart, function (entity) { return entity; }).convert(entity);
			var queryString = ExoWeb.Model.Format.fromTemplate(entity.meta.type, qsPart, function (entity) { return encodeURIComponent(entity); }).convert(entity);

			return redirectUrl + queryString;
		} else {
			return ExoWeb.Model.Format.fromTemplate(entity.meta.type, url, function (entity) { return entity; }).convert(entity);
		}
	}

	Cognito.formatUrl = formatUrl;
    function formatText(value) {
        return value ? value.replace(/\n/g, '<br/>') : value;
    }
    Cognito.formatText = formatText;

    Cognito.escapeHtml = function (value) {
        return value ? value
            .replace(/&/g, '&amp;')
            .replace(/""/g, '&quot;')
            .replace(/'/g, '&#39;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
        : value;
    };

    Cognito.escapeAndFormat = function (value) {
        return Cognito.formatText(Cognito.escapeHtml(value));
    };

    Cognito.maskText = function (value) {
        return value ? value.replace(/./g, '*') : value;
    };

	function getDeviceType(useragent) {
		// Modified version of:
		// http://www.competa.com/blog/how-to-detect-mobile-devices-with-vanilla-javascript/

		if (useragent.match(/Windows NT/i)) {
			return 'windows-desktop';
		} else if (useragent.match(/Android/i)) {
			return 'android';
		} else if (useragent.match(/webOS/i)) {
			return 'webos';
		} else if (useragent.match(/iPhone/i)) {
			return 'iphone';
		} else if (useragent.match(/iPod/i)) {
			return 'ipod';
		} else if (useragent.match(/iPad/i)) {
			return 'ipad';
		} else if (useragent.match(/Windows Phone/i)) {
			return 'windows-phone';
		} else if (useragent.match(/SymbianOS/i)) {
			return 'symbian';
		} else if (useragent.match(/RIM/i) || useragent.match(/BB/i)) {
			return 'blackberry';
		} else {
			return 'unknown';
		}
	}

	Cognito.isDeviceType = function (query) {
		var deviceType = getDeviceType(navigator.userAgent);
		var deviceTypesToCheck = query.split('|');
		return deviceTypesToCheck.some(function (d) { return d.toLowerCase() === deviceType; });
	};

	Cognito.resize = function Cognito$resize(width, form) {
		requestAnimationFrame(function () {
			if (width && form) {
				var width = width;
				var element = $(form);

			} else if (Cognito.viewport) {
				var width = Cognito.viewport.width();
				var element = Cognito.viewport;
			} else
				return;

			if (width <= 414)
				element.addClass("c-sml").removeClass("c-med").removeClass("c-lrg");
			else if (width < 800)
				element.removeClass("c-sml").addClass("c-med").removeClass("c-lrg");
			else
				element.removeClass("c-sml").removeClass("c-med").addClass("c-lrg");

			if (width > 414 && width <= 525)
				element.addClass("c-smed");
			else
				element.removeClass("c-smed");
		});
	};

	Cognito.afterDomReady(function ($) {
		$(window).resize(Cognito.resize);
		Cognito.resize();
	});

	/// Module
	function Module(name) {
		Object.defineProperty(this, "name", { value: name });
		Object.defineProperty(this, "model", { value: {} });
		Cognito.config.modules.push(this);
	}

	Module.mixin({
		serviceRequest: function Module$serviceRequest(options) {
			options.module = this.name;

			Cognito.serviceRequest(options);
		}
	});

	Cognito.Module = Module;


	// polyfill for the Array.some function
	if (!Array.prototype.some) {
		Array.prototype.some = function (fun /*, thisArg */) {
			'use strict';

			if (this === void 0 || this === null)
				throw new TypeError();

			var t = Object(this);
			var len = t.length >>> 0;
			if (typeof fun !== 'function')
				throw new TypeError();

			var thisArg = arguments.length >= 2 ? arguments[1] : void 0;
			for (var i = 0; i < len; i++) {
				if (i in t && fun.call(thisArg, t[i], i, t))
					return true;
			}

			return false;
		};
	}
})(window.ExoJQuery || jQuery);
})(typeof exports === 'undefined');


/***/ }),

/***/ "../../../Cognito.Services/Scripts/required/Cognito-validation.js":
/*!*********************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Cognito.Services/Scripts/required/Cognito-validation.js ***!
  \*********************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

﻿(( true ? exports : undefined).exec = function (isInIframe) {
(function ($) {
	//#region Email Regex
	Cognito.emailRegex = /([a-zA-Z0-9\!\#\$\%\&\'\*\+\-\/\=\?\^_\`\{\|\}\~]+(\.[a-zA-Z0-9\!\#\$\%\&\'\*\+\-\/\=\?\^_\`\{\|\}\~]+)*@([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*\.[a-zA-Z]{2,64}|([0-9]{1,3}(\.[0-9]{1,3}){3})))/g;
	Cognito.emailAndTokenRegex = /(\[(([a-z0-9_.\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u02bb-\u02c1\u02d0-\u02d1\u02e0-\u02e4\u02ee\u0370-\u0373\u0376-\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0523\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0621-\u064a\u0660-\u0669\u066e-\u066f\u0671-\u06d3\u06d5\u06e5-\u06e6\u06ee-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07c0-\u07ea\u07f4-\u07f5\u07fa\u0904-\u0939\u093d\u0950\u0958-\u0961\u0966-\u096f\u0971-\u0972\u097b-\u097f\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc-\u09dd\u09df-\u09e1\u09e6-\u09f1\u0a05-\u0a0a\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a66-\u0a6f\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0-\u0ae1\u0ae6-\u0aef\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32-\u0b33\u0b35-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b66-\u0b6f\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0be6-\u0bef\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58-\u0c59\u0c60-\u0c61\u0c66-\u0c6f\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0-\u0ce1\u0ce6-\u0cef\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d3d\u0d60-\u0d61\u0d66-\u0d6f\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32-\u0e33\u0e40-\u0e46\u0e50-\u0e59\u0e81-\u0e82\u0e84\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa-\u0eab\u0ead-\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0ed0-\u0ed9\u0edc-\u0edd\u0f00\u0f20-\u0f29\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8b\u1000-\u102a\u103f-\u1049\u1050-\u1055\u105a-\u105d\u1061\u1065-\u1066\u106e-\u1070\u1075-\u1081\u108e\u1090-\u1099\u10a0-\u10c5\u10d0-\u10fa\u10fc\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u17e0-\u17e9\u1810-\u1819\u1820-\u1877\u1880-\u18a8\u18aa\u1900-\u191c\u1946-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u19d0-\u19d9\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u1b50-\u1b59\u1b83-\u1ba0\u1bae-\u1bb9\u1c00-\u1c23\u1c40-\u1c49\u1c4d-\u1c7d\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u2094\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183-\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2c6f\u2c71-\u2c7d\u2c80-\u2ce4\u2d00-\u2d25\u2d30-\u2d65\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3006\u3031-\u3035\u303b-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fc3\ua000-\ua48c\ua500-\ua60c\ua610-\ua62b\ua640-\ua65f\ua662-\ua66e\ua680-\ua697\ua722-\ua788\ua78b-\ua78c\ua7fb-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8d0-\ua8d9\ua900-\ua925\ua930-\ua946\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa50-\uaa59\uac00-\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]+)(?:\:(.+?))?)\])|([a-zA-Z0-9\!\#\$\%\&\'\*\+\-\/\=\?\^_\`\{\|\}\~]+(\.[a-zA-Z0-9\!\#\$\%\&\'\*\+\-\/\=\?\^_\`\{\|\}\~]+)*@([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*\.[a-zA-Z]{2,64}|([0-9]{1,3}(\.[0-9]{1,3}){3})))/gi;

	//#region Required Name Rule

	// validates that the first and last fields of a name are specified
	function RequiredNameRule(rootType, options) {

		// ensure the rule name is specified
		options.name = options.name || "RequiredName";

		// ensure the error message is specified
		options.message = options.message || "Name is required.";
		
		// configure the properties to validate
		var prop = options.property instanceof ExoWeb.Model.Property ? options.property : rootType.property(options.property);
		if (options.onChangeOf)
			options.onChangeOf = options.onChangeOf.concat([prop.get_name() + ".First", prop.get_name() + ".Last"]);
		else
			options.onChangeOf = [prop.get_name() + ".First", prop.get_name() + ".Last"];
		
		// define properties for the rule, defaulting isRequired to true if not specified
		if (options.fn) {
			Object.defineProperty(this, "isRequired", { value: options.fn, writable: true });
			options.fn = null;
		}
		else
			Object.defineProperty(this, "isRequired", { value: options.isRequired != false });

		// call the base type constructor
		ExoWeb.Model.ValidatedPropertyRule.apply(this, [rootType, options]);
	}

	// setup the inheritance chain
	RequiredNameRule.prototype = new ExoWeb.Model.ValidatedPropertyRule();
	RequiredNameRule.prototype.constructor = RequiredNameRule;

	RequiredNameRule.mixin({

		// asserts the condition and adds or removes it from the model if necessary
		execute: function RequiredNameRule$execute(obj) {

			// convert string functions into compiled functions on first execution
			if (this.isRequired.constructor === String) {
				this.isRequired = this.rootType.compileExpression(this.isRequired);
			}

			var name = this.property.value(obj);
			var message = this.message;
			var properties = this.properties;

			var assert = name;

			if (this.isRequired.constructor === Boolean)
				assert = assert && this.isRequired;
			else {
				var isReq;
				try
				{
					isReq = this.isRequired.call(obj);
				}
				catch (e)
				{
					isReq = false;
				}

				assert = assert && isReq;
			}

			// Determine if the condition should be asserted
			if (assert) {
				var firstIsMissing = !ExoWeb.Model.RequiredRule.hasValue(name.get_First());
				var lastIsMissing = !ExoWeb.Model.RequiredRule.hasValue(name.get_Last());
				if (firstIsMissing && lastIsMissing) {
					message = Cognito.resources.get("required-name-first-and-last");
					properties = [this.property.get_name(), this.property.get_name() + "{First,Last}"];
				}
				else if (firstIsMissing) {
					message = Cognito.resources.get("required-name-first");
					properties = [this.property.get_name(), this.property.get_name() + "{First}"];
				}
				else if (lastIsMissing) {
					message = Cognito.resources.get("required-name-last");
					properties = [this.property.get_name(), this.property.get_name() + "{Last}"];
				}
				else
					assert = false;
			}

			// Assert the condition
			this.conditionType.when(assert, obj, properties, message);
		}
	});

	// Expose the rule publicly
	ExoWeb.Model.Rule.requiredName = RequiredNameRule;

	//#endregion

	//#region Signature Rule

	// validates that the signature is specified
	function RequiredSignatureRule(rootType, options) {

		// ensure the rule name is specified
		options.name = options.name || "RequiredSignature";

		// ensure the error message is specified
		options.message = options.message || Cognito.resources.get("required");

		// configure the properties to validate
		var prop = options.property instanceof ExoWeb.Model.Property ? options.property : rootType.property(options.property);
		options.onChangeOf = options.onChangeOf
			? options.onChangeOf.concat(prop.get_name() + ".Svg")
			: prop.get_name() + ".Svg";

		// define properties for the rule, defaulting isRequired to true if not specified
		if (options.fn) {
			Object.defineProperty(this, "isRequired", { value: options.fn, writable: true });
			options.fn = null;
		} else {
			Object.defineProperty(this, "isRequired", { value: options.isRequired != false });
		}

		// call the base type constructor
		ExoWeb.Model.ValidatedPropertyRule.apply(this, [rootType, options]);
	}

	// setup the inheritance chain
	RequiredSignatureRule.prototype = new ExoWeb.Model.ValidatedPropertyRule();
	RequiredSignatureRule.prototype.constructor = RequiredSignatureRule;

	RequiredSignatureRule.mixin({

		// asserts the condition and adds or removes it from the model if necessary
		assert: function RequiredSignatureRule$assert(obj) {

			// convert string functions into compiled functions on first execution
			if (this.isRequired.constructor === String) {
				this.isRequired = this.rootType.compileExpression(this.isRequired);
			}

			var signature = this.property.value(obj);
			var message = this.message;
			var properties = this.properties;

			var assert = signature;

			if (this.isRequired.constructor === Boolean) {
				assert = assert && this.isRequired;
			} else {
				var isReq;
				try {
					isReq = this.isRequired.call(obj);
				} catch (e) {
					isReq = false;
				}

				assert = assert && isReq;
			}

			// Asser the condition
			return assert && !ExoWeb.Model.RequiredRule.hasValue(signature.get_Svg());
		}
	});

	// Expose the rule publicly
	ExoWeb.Model.Rule.requiredSignature = RequiredSignatureRule;

	//#endregion

	//#region Required Address Rule

	// Validates required address fields
	function RequiredAddressRule(rootType, options) {

		// ensure the rule name is specified
		options.name = options.name || "Address";

		// ensure the error message is specified
		options.message = options.message || "Address is required.";

		// configure the properties to validate
		var prop = options.property instanceof ExoWeb.Model.Property ? options.property : rootType.property(options.property);

		if (options.onChangeOf)
			options.onChangeOf = options.onChangeOf.concat([prop.get_name() + ".Line1", prop.get_name() + ".City", prop.get_name() + ".State", prop.get_name() + ".PostalCode", prop.get_name() + ".Country"]);
		else
			options.onChangeOf = [prop.get_name() + ".Line1", prop.get_name() + ".City", prop.get_name() + ".State", prop.get_name() + ".PostalCode", prop.get_name() + ".Country"];

		// define properties for the rule, defaulting isRequired to true if not specified
		if (options.fn) {
			Object.defineProperty(this, "isRequired", { value: options.fn, writable: true });
			options.fn = null;
		}
		else
			Object.defineProperty(this, "isRequired", { value: options.isRequired === true });

		if (options.enforceableFields)
			Object.defineProperty(this, "enforceableFields", { value: options.enforceableFields });

		// call the base type constructor
		ExoWeb.Model.ValidatedPropertyRule.apply(this, [rootType, options]);
	}

	// setup the inheritance chain
	RequiredAddressRule.prototype = new ExoWeb.Model.ValidatedPropertyRule();
	RequiredAddressRule.prototype.constructor = RequiredAddressRule;

	RequiredAddressRule.mixin({

		// asserts the condition and adds or removes it from the model if necessary
		execute: function RequiredAddressRule$execute(obj) {

			var message;
			var properties = [];
			var validateRequired = function RequiredAddressRule$validateRequired(property, address, fields) {
			    var count = 0;
				message = "";

				// add the address property as a predicate
				properties.push(property);

			    for (var f = fields.length - 1; f >= 0; f--) {
			        var field = fields[f];
			        var value = address.get(field);
			        if (ExoWeb.Model.RequiredRule.hasValue(address.get(field)))
			            continue;
			        properties.push(property + "." + field);
			        // Rename Postal Code to Zip Code if US Address
			        var label = Cognito.resources["address-" + field.toLowerCase()];
			        if (field === "PostalCode" && address.get_Country() === Cognito.resources.get("united-states"))
			            label = Cognito.resources["address-zip-code"];

			        if (count == 0)
			            message = label;
			        else if (count == 1)
			            message = String.format(Cognito.resources.get("this-and-that"), label, message);
			        else
			            message = String.format(Cognito.resources.get("this-comma-that"), label, message);
			        count++;
			    }
			    if (count > 0)
			        message = String.format(count == 1 ? Cognito.resources.get("required-one") : Cognito.resources.get("required-many"), message);
			};

			// Get the address being validated
			var address = this.property.value(obj);

			// Validate the address
			if (address)
			{
				// convert string functions into compiled functions on first execution
				if (this.isRequired.constructor === String) {
					this.isRequired = this.rootType.compileExpression(this.isRequired);
				}

				var isRequired;
				if (this.isRequired.constructor === Boolean)
					isRequired = this.isRequired;
				else{
					try {
						isRequired = this.isRequired.call(obj, obj);
					}
					catch (e) {
						isRequired = false;
					}
				}

				if (isRequired)
                    validateRequired(this.property.get_name(), address, this.enforceableFields || []);

				if (address.get_Country() === Cognito.resources.get("united-states"))
				{
					if (!message && ExoWeb.Model.RequiredRule.hasValue(address.get_PostalCode()) && !/^\s*(\d{5})(-\d{4})?\s*$/.test(address.get_PostalCode()))
					{
						message = Cognito.resources.get("address-zip-code-invalid");
						properties.push(this.property.get_name());
						properties.push(this.property.get_name() + ".PostalCode");
					}
				}
			}

			// Assert or remove the condition based on the validation result
			this.conditionType.when(!!message, obj, properties, message);
		}
	});

	// Expose the rule publicly
	ExoWeb.Model.Rule.requiredAddress = RequiredAddressRule;

	//#endregion

	//#region Zip Code Rule

	// Validates required address fields
	function ZipCodeRule(rootType, options) {

		// ensure the rule name is specified
		options.name = options.name || "ZipCode";

		// ensure the error message is specified
		options.message = options.message || "Zip Code must be formatted as #####-####.";

		// configure the properties to validate
		var prop = options.property instanceof ExoWeb.Model.Property ? options.property : rootType.property(options.property);

		if (options.onChangeOf)
			options.onChangeOf = options.onChangeOf.concat([prop.get_name() + ".PostalCode", prop.get_name() + ".Country"]);
		else
			options.onChangeOf = [prop.get_name() + ".PostalCode", prop.get_name() + ".Country"];

		// call the base type constructor
		ExoWeb.Model.ValidatedPropertyRule.apply(this, [rootType, options]);
	}

	// setup the inheritance chain
	ZipCodeRule.prototype = new ExoWeb.Model.ValidatedPropertyRule();
	ZipCodeRule.prototype.constructor = ZipCodeRule;

	ZipCodeRule.mixin({

		// asserts the condition and adds or removes it from the model if necessary
		execute: function ZipCodeRule$execute(obj) {

			var message;
			var properties = [];

			// Get the address being validated
			var address = this.property.value(obj);

			// Validate the address
			if (address) {
				if (address.get_Country() === Cognito.resources.get("united-states")) {
					if (ExoWeb.Model.RequiredRule.hasValue(address.get_PostalCode()) && !/^\s*(\d{5})(-\d{4})?\s*$/.test(address.get_PostalCode())) {
						message = Cognito.resources.get("address-zip-code-invalid");
						properties.push(this.property.get_name());
						properties.push(this.property.get_name() + ".PostalCode");
					}
				}
			}

			// Assert or remove the condition based on the validation result
			this.conditionType.when(!!message, obj, properties, message);
		}
	});

	// Expose the rule publicly
	ExoWeb.Model.Rule.zipCode = ZipCodeRule;

	//#endregion

	//#region Unique Name Rule

	// create new validation rule to ensure property value is unique
	function UniqueRule(rootType, options) {
		// ensure the rule name is specified
		options.name = options.name || "UniqueValue";

		// ensure the error message is specified
		options.message = options.message || "Value must be unique";

		// define properties for the rule
		Object.defineProperty(this, "sourceObject", { value: options.sourceObject });
		Object.defineProperty(this, "sourcePath", { value: options.sourcePath });

		// call the base type constructor
		ExoWeb.Model.ValidatedPropertyRule.apply(this, [rootType, options]);

		// never run unique bill type rules during initialization of existing instances
		options.onInitExisting = false;
	}

	// setup the inheritance chain
	UniqueRule.prototype = new ExoWeb.Model.ValidatedPropertyRule();
	UniqueRule.prototype.constructor = UniqueRule;

	UniqueRule.mixin({
		onRegister: function UniqueRule$onRegister() {
			// call the base method
			ExoWeb.Model.ValidatedPropertyRule.prototype.onRegister.call(this);
		},
		isValid: function UniqueRule$isValid(obj, prop, value) {
			if (!this.sourceObject || !this.sourcePath) {
				ExoWeb.logWarning("Unique rule on type \"" + prop.get_containingType().get_fullName() + "\" has not been initialized.");
				return;
			}

			// return true if no value is currently selected
			if (value === undefined || value === null) {
				return true;
			}

			// get the list of allowed values of the property for the given object
			var valuesToSearch = this.values(obj);
			var existingType = null;

			Array.forEach(valuesToSearch, function (val) {
				if (prop.value(val).toLowerCase() == value.toLowerCase() && val.get_Id() != obj.get_Id()) {
					existingType = val;
				}
			});

			return existingType == null || existingType == undefined;
		},
		values: function UniqueRule$values(obj, exitEarly) {
			if (!this.sourceObject || !this.sourcePath) {
				ExoWeb.logWarning("Unique rule on type \"" + this.prop.get_containingType().get_fullName() + "\" has not been initialized.");
				return;
			}

			// Return the value of the source for the given object
			return this.sourceObject["get_" + this.sourcePath]();
		}
	});

	// Expose the rule publicly
	ExoWeb.Model.Rule.unique = UniqueRule;

	// Associate the rule to the exo model property object so it can be assigned to a property
	ExoWeb.Model.Property.prototype.unique = function (sourceObject, sourcePath, message) {
		new ExoWeb.Model.Rule.unique(this.get_containingType(), { property: this, message: message, sourcePath: sourcePath, sourceObject: sourceObject });
		return this;
	};

	//#endregion

	//#region Required RatingScale Rule

	// validates that the first and last fields of a name are specified
	function RequiredRatingScaleRule(rootType, options) {

		// ensure the rule name is specified
		options.name = options.name || "RequiredRatingScale";

		// configure the properties to validate
		var prop = options.property instanceof ExoWeb.Model.Property ? options.property : rootType.property(options.property);
		Object.defineProperty(this, "property", { value: prop });

		// define properties for the rule, defaulting isRequired to true if not specified
		if (options.fn) {
			Object.defineProperty(this, "isRequired", { value: options.fn, writable: true });
			options.fn = null;
		}
		else
			Object.defineProperty(this, "isRequired", { value: options.isRequired != false });

		// automatically run the condition rule during initialization of new instances
		options.onInitNew = true;

		var conditionTypes = [];
		var ratingScalePath = prop.get_name() + ".";
		options.onChangeOf.forEach(function (path) {
			// startsWith "<RatingScale InternalName>."
			if (path.indexOf(ratingScalePath) === 0)
				conditionTypes.push(ExoWeb.Model.Rule.ensureConditionType(options.name + "." + path, rootType, ExoWeb.Model.ConditionType.Error));
		})

		Object.defineProperty(this, "conditionTypes", { value: conditionTypes });

		// call the base type constructor
		ExoWeb.Model.Rule.apply(this, [rootType, options]);
	}

	// setup the inheritance chain
	RequiredRatingScaleRule.prototype = new ExoWeb.Model.Rule();
	RequiredRatingScaleRule.prototype.constructor = RequiredRatingScaleRule;

	RequiredRatingScaleRule.mixin({

		// asserts the condition and adds or removes it from the model if necessary
		execute: function RequiredRatingScaleRule$execute(obj) {

			// convert string functions into compiled functions on first execution
			if (this.isRequired.constructor === String) {
				this.isRequired = this.rootType.compileExpression(this.isRequired);
			}

			var ratingScale = this.property.value(obj);
			var validationMessage = Cognito.resources.get("required");
			var properties = this.properties;

			if (ratingScale) {
				var validate;

				if (this.isRequired.constructor === Boolean)
					validate = this.isRequired;
				else {
					var isReq;
					try {
						isReq = this.isRequired.call(obj);
					}
					catch (e) {
						isReq = false;
					}

					validate = isReq;
				}

				var properties = ratingScale.meta.type.get_properties();
				// Iterate over the rating scale questions asserting or removing the condition based on the validation result 
				for (var i = 0; i < properties.length; i++) {
					var prop = properties[i];
					var fieldName = prop.get_fieldName();
					var assert = validate && !ExoWeb.Model.RequiredRule.hasValue(ratingScale[fieldName]);
					var message = validationMessage.replace('{property}', prop.get_label());

					// lookup the condition type 
					var conditionType = this.conditionTypes.filter(function (c) { return endsWith(c.code, prop.get_name()); })[0];
					if (conditionType)
						conditionType.when(assert, ratingScale, [prop.get_name()], message);
				}
			}
		}
	});
	
	// Expose the rule publicly
	ExoWeb.Model.Rule.requiredRatingScale = RequiredRatingScaleRule;

	function endsWith(str, suffix) {
		return str.indexOf(suffix, str.length - suffix.length) !== -1;
	}

	//#endregion

})();
})(typeof exports === 'undefined');


/***/ }),

/***/ "./src/views/admin/required-scripts.ts":
/*!*********************************************!*\
  !*** ./src/views/admin/required-scripts.ts ***!
  \*********************************************/
/*! exports provided: executeScripts */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "executeScripts", function() { return executeScripts; });
/* harmony import */ var _legacy_Scripts_required_Cognito_core_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @legacy/Scripts/required/Cognito-core.js */ "../../../Cognito.Services/Scripts/required/Cognito-core.js");
/* harmony import */ var _legacy_Scripts_required_Cognito_core_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_legacy_Scripts_required_Cognito_core_js__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _legacy_Scripts_component_cognito_messaging_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @legacy/Scripts/component/cognito-messaging.js */ "../../../Cognito.Services/Scripts/component/cognito-messaging.js");
/* harmony import */ var _legacy_Scripts_component_cognito_messaging_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_legacy_Scripts_component_cognito_messaging_js__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _legacy_Scripts_Cognito_core_admin_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @legacy/Scripts/Cognito-core-admin.js */ "../../../Cognito.Services/Scripts/Cognito-core-admin.js");
/* harmony import */ var _legacy_Scripts_Cognito_core_admin_js__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_legacy_Scripts_Cognito_core_admin_js__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _legacy_Views_Admin_admin_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @legacy/Views/Admin/admin.js */ "../../../Cognito.Services/Views/Admin/admin.js");
/* harmony import */ var _legacy_Views_Admin_admin_js__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_legacy_Views_Admin_admin_js__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _legacy_Scripts_required_Cognito_validation_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @legacy/Scripts/required/Cognito-validation.js */ "../../../Cognito.Services/Scripts/required/Cognito-validation.js");
/* harmony import */ var _legacy_Scripts_required_Cognito_validation_js__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_legacy_Scripts_required_Cognito_validation_js__WEBPACK_IMPORTED_MODULE_4__);





// since the imports above automatically execute their functions, avoid duplicate execution on the first call to executeScripts
var isInitialImport = true;
function executeScripts() {
  if (!isInitialImport) {
    _legacy_Scripts_required_Cognito_core_js__WEBPACK_IMPORTED_MODULE_0___default.a.exec();
    _legacy_Scripts_component_cognito_messaging_js__WEBPACK_IMPORTED_MODULE_1___default.a.exec();
    _legacy_Scripts_Cognito_core_admin_js__WEBPACK_IMPORTED_MODULE_2___default.a.exec();
    _legacy_Views_Admin_admin_js__WEBPACK_IMPORTED_MODULE_3___default.a.exec();
    _legacy_Scripts_required_Cognito_validation_js__WEBPACK_IMPORTED_MODULE_4___default.a.exec();
  }
  isInitialImport = false;
}

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9DOi9Vc2Vycy9UeWxlclRyb3R0ZXIvcmVwb3MvQ29nbml0byBGb3Jtcy9Db2duaXRvLlNlcnZpY2VzL1NjcmlwdHMvQ29nbml0by1jb3JlLWFkbWluLmpzIiwid2VicGFjazovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL0M6L1VzZXJzL1R5bGVyVHJvdHRlci9yZXBvcy9Db2duaXRvIEZvcm1zL0NvZ25pdG8uU2VydmljZXMvU2NyaXB0cy9jb21wb25lbnQvY29nbml0by1tZXNzYWdpbmcuanMiLCJ3ZWJwYWNrOi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vQzovVXNlcnMvVHlsZXJUcm90dGVyL3JlcG9zL0NvZ25pdG8gRm9ybXMvQ29nbml0by5TZXJ2aWNlcy9TY3JpcHRzL3JlcXVpcmVkL0NvZ25pdG8tY29yZS5qcyIsIndlYnBhY2s6Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9DOi9Vc2Vycy9UeWxlclRyb3R0ZXIvcmVwb3MvQ29nbml0byBGb3Jtcy9Db2duaXRvLlNlcnZpY2VzL1NjcmlwdHMvcmVxdWlyZWQvQ29nbml0by12YWxpZGF0aW9uLmpzIiwid2VicGFjazovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy4vc3JjL3ZpZXdzL2FkbWluL3JlcXVpcmVkLXNjcmlwdHMudHMiXSwibmFtZXMiOlsiaXNJbml0aWFsSW1wb3J0IiwiZXhlY3V0ZVNjcmlwdHMiLCJjb3JlU2NyaXB0IiwiZXhlYyIsIm1lc3NhZ2luZ1NjcmlwdCIsImNvcmVBZG1pblNjcmlwdCIsImFkbWluU2NyaXB0IiwidmFsaWRhdGlvblNjcmlwdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsRUFBRSxLQUE2QixhQUFhLFNBQUU7QUFDOUM7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixzQ0FBc0MsRUFBRTtBQUNyRSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHOztBQUVILEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsNkRBQTZELHdDQUF3QyxFQUFFOztBQUV2RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyw2QkFBNkI7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsNENBQTRDLEVBQUU7QUFDOUM7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsZ0NBQWdDOztBQUVoQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsMkJBQTJCO0FBQzNCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FB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RDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSxpQ0FBaUMsR0FBRztBQUNwQztBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBOztBQUVB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QUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFrRTtBQUNXO0FBQ1Q7QUFDYjtBQUN1QjtBQU85RTtBQUNBLElBQUlBLGVBQWUsR0FBRyxJQUFJO0FBQ25CLFNBQVNDLGNBQWNBLENBQUEsRUFBRztFQUNoQyxJQUFJLENBQUNELGVBQWUsRUFBRTtJQUNwQkUsK0VBQVUsQ0FBd0JDLElBQUksQ0FBQyxDQUFDO0lBQ3hDQyxxRkFBZSxDQUF3QkQsSUFBSSxDQUFDLENBQUM7SUFDN0NFLDRFQUFlLENBQXdCRixJQUFJLENBQUMsQ0FBQztJQUM3Q0csbUVBQVcsQ0FBd0JILElBQUksQ0FBQyxDQUFDO0lBQ3pDSSxxRkFBZ0IsQ0FBd0JKLElBQUksQ0FBQyxDQUFDO0VBQ2hEO0VBQ0FILGVBQWUsR0FBRyxLQUFLO0FBQ3hCLEMiLCJmaWxlIjoiUmVxdWlyZWRBZG1pblNjcmlwdHMuNzFkNzJmZDg1NzUyMzMzYjQ5MGYuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoKHR5cGVvZiBleHBvcnRzICE9ICd1bmRlZmluZWQnID8gZXhwb3J0cyA6IHt9KS5leGVjID0gZnVuY3Rpb24oaXNJbklmcmFtZSkge1xyXG4oZnVuY3Rpb24oJCkge1xyXG5cclxuXHQvLyBDcmVhdGUgYW4gb3ZlcmxheSB0byBoaWRlIHRoZSB1bmRlcmx5aW5nIHBhZ2Ugd2hlbiBkaXNwbGF5aW5nIG1vZGFsIGNvbnRlbnRcclxuXHR2YXIgb3ZlcmxheTtcclxuXHR2YXIgb25PdmVybGF5Q2xpY2s7XHJcblxyXG5cdENvZ25pdG8ucmVhZHkoXCJhcHBlbmQtb3ZlcmxheVwiLCBcIkV4b1dlYi5kb21cIiwgZnVuY3Rpb24gKCQpIHtcclxuXHRcdG92ZXJsYXkgPSAkKFwiI2MtbW9kYWwtb3ZlcmxheVwiKTtcclxuXHRcdGlmIChvdmVybGF5Lmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0XHR2YXIgY29nbml0b0RpdiA9ICQoJy5jb2duaXRvOmZpcnN0Jyk7XHJcblx0XHRcdG92ZXJsYXkgPSAkKFwiPGRpdiBpZD0nYy1tb2RhbC1vdmVybGF5JyAvPlwiKS5hcHBlbmRUbyhjb2duaXRvRGl2Lmxlbmd0aCA9PSAwIHx8IENvZ25pdG8uY29uZmlnLmZsYWdzLkFwcE5hdiA/IGRvY3VtZW50LmJvZHkgOiBjb2duaXRvRGl2KTtcclxuXHRcdH1cclxuXHRcdG92ZXJsYXkuY2xpY2soZnVuY3Rpb24gKCkgeyBpZiAob25PdmVybGF5Q2xpY2spIG9uT3ZlcmxheUNsaWNrKCk7IH0pO1xyXG5cdH0pO1xyXG5cclxuXHQvLyBCcm9hZGNhc3QgdG9rZW4gaWYgY29taW5nIGZyb20gdGhlIGxvZ2luIHBhZ2VcclxuXHRDb2duaXRvLnJlYWR5KFwiYnJvYWRjYXN0LXRva2VuXCIsIFwiRXhvV2ViLmRvbVwiLCBmdW5jdGlvbiAoJCkge1xyXG5cdFx0JChkb2N1bWVudCkub24oXCJjbGlja1wiLCAnLmMtYnV0dG9uLXByb2dyZXNzOm5vdChbY2xhc3MqPVwiYy1zdGF0dXMtXCJdKScsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0dmFyICR0aGlzID0gJCh0aGlzKTtcclxuXHJcblx0XHRcdC8vIEl0IGlzIHBvc3NpYmxlIGZvciB0aGUgXCJwcm9ncmVzcy1maW5pc2hlZFwiIGV2ZW50IHRvIGZpcmUgYmVmb3JlIHRoZSBjbGljayBldmVudFxyXG5cdFx0XHQvLyBTbyBjaGVjayB0byBzZWUgaWYgdGhlcmUgaXMgYWxyZWFkeSBhIGZhaWxlZCBvciBzdWNjZXNzZnVsIGNsYXNzIG9uIGJ1dHRvblxyXG5cdFx0XHRpZighJHRoaXMuaXMoXCIuYy1zdGF0dXMtZmFpbGVkLCAuYy1zdGF0dXMtc3VjY2Vzc2Z1bFwiKSlcclxuXHRcdFx0XHQkdGhpcy5hZGRDbGFzcyhcImMtc3RhdHVzLXdvcmtpbmdcIikucHJvcChcImRpc2FibGVkXCIsIHRydWUpO1xyXG5cdFx0fSlcclxuXHRcdC5vbihcInByb2dyZXNzLWZpbmlzaGVkXCIsIFwiLmMtYnV0dG9uLXByb2dyZXNzXCIsIGZ1bmN0aW9uKGUsIHN0YXR1cykge1xyXG5cdFx0XHR2YXIgJGJ1dHRvbiA9ICQodGhpcyk7XHJcblx0XHRcdCRidXR0b24ucmVtb3ZlQ2xhc3MoXCJjLXN0YXR1cy13b3JraW5nXCIpO1xyXG5cdFx0XHQkYnV0dG9uLmFkZENsYXNzKFwiYy1zdGF0dXMtXCIgKyBzdGF0dXMpO1xyXG5cdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XHJcblx0XHRcdFx0JGJ1dHRvbi5yZW1vdmVDbGFzcyhcImMtc3RhdHVzLVwiICsgc3RhdHVzKS5wcm9wKFwiZGlzYWJsZWRcIiwgZmFsc2UpO1xyXG5cdFx0XHR9LCAyNTAwKTtcclxuXHRcdH0pO1xyXG5cclxuXHR9KTtcclxuXHJcblx0Ly8gU2hvd3MgdGhlIG1vZGFsIG92ZXJsYXlcclxuXHRmdW5jdGlvbiBzaG93T3ZlcmxheShvbkNsaWNrKSB7XHJcblx0XHRvbk92ZXJsYXlDbGljayA9IG9uQ2xpY2s7XHJcblx0XHRDb2duaXRvLk1lc3NhZ2luZy50cmlnZ2VyKFwic2hvd092ZXJsYXlcIik7XHJcblx0XHRvdmVybGF5LmZhZGVJbigpO1xyXG5cdH1cclxuXHRDb2duaXRvLnNob3dPdmVybGF5ID0gc2hvd092ZXJsYXk7XHJcblxyXG5cdC8vIEhpZGVzIHRoZSBtb2RhbCBvdmVybGF5XHJcblx0ZnVuY3Rpb24gaGlkZU92ZXJsYXkoKSB7XHJcblx0XHRvbk92ZXJsYXlDbGljayA9IG51bGw7XHJcblx0XHRDb2duaXRvLk1lc3NhZ2luZy50cmlnZ2VyKFwiaGlkZU92ZXJsYXlcIik7XHJcblx0XHRvdmVybGF5LmZhZGVPdXQoKTtcclxuXHR9XHJcblx0Q29nbml0by5oaWRlT3ZlcmxheSA9IGhpZGVPdmVybGF5O1xyXG5cclxuXHRDb2duaXRvLk1lc3NhZ2luZy5hZGRIYW5kbGVyKFwib3ZlcmxheUNsaWNrZWRcIiwgZnVuY3Rpb24gKCkgeyAkKCcjYy1tb2RhbC1vdmVybGF5JykudHJpZ2dlcignY2xpY2snKTsgfSk7XHJcblxyXG5cdGlmIChpc0luSWZyYW1lKSB7XHJcblx0XHRDb2duaXRvLk1lc3NhZ2luZy5hZGRIYW5kbGVyKFwibmF2aWdhdGVcIiwgZnVuY3Rpb24gKGRhdGEpIHtcclxuXHRcdFx0dmFyIG5hdmlnYXRlID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdGlmIChkYXRhLnRhcmdldCA9PT0gXCJ0b3BcIikge1xyXG5cdFx0XHRcdFx0d2luZG93LnBhcmVudC5sb2NhdGlvbiA9IGRhdGEudXJsO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSBkYXRhLnVybDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH07XHJcblx0XHRcdGlmIChvbk5hdmlnYXRlRGlhbG9nKSB7XHJcblx0XHRcdFx0b25OYXZpZ2F0ZURpYWxvZy5jb250aW51ZSA9IG5hdmlnYXRlO1xyXG5cdFx0XHRcdGlmICghb25OYXZpZ2F0ZURpYWxvZy5vcGVuKGRhdGEpKVxyXG5cdFx0XHRcdFx0bmF2aWdhdGUoKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlXHJcblx0XHRcdFx0bmF2aWdhdGUoKTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gdHJ5T3Blbk5hdmlnYXRlRGlhbG9nKGRhdGEpIHtcclxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkge1xyXG5cdFx0XHRpZiAob25OYXZpZ2F0ZURpYWxvZykge1xyXG5cdFx0XHRcdG9uTmF2aWdhdGVEaWFsb2cuY29udGludWUgPSBmdW5jdGlvbiAoY2hhbmdlc1NhdmVkKSB7XHJcblx0XHRcdFx0XHRyZXNvbHZlKHsgY2hhbmdlc1NhdmVkOiBjaGFuZ2VzU2F2ZWQgfSlcclxuXHRcdFx0XHR9O1xyXG5cdFx0XHRcdGlmICghb25OYXZpZ2F0ZURpYWxvZy5vcGVuKGRhdGEpKVxyXG5cdFx0XHRcdFx0cmVzb2x2ZSh0cnVlKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlXHJcblx0XHRcdFx0cmVzb2x2ZSh0cnVlKTtcclxuXHRcdH0pO1xyXG5cdH07XHJcblxyXG5cdENvZ25pdG8udHJ5T3Blbk5hdmlnYXRlRGlhbG9nID0gdHJ5T3Blbk5hdmlnYXRlRGlhbG9nO1xyXG5cclxuXHQvLyBGb3JtYXRzIHZhbHVlIGFzIGN1cnJlbmN5XHJcblx0ZnVuY3Rpb24gZm9ybWF0Q3VycmVuY3kodmFsKSB7XHJcblx0XHR2YXIgdmFsU3RyaW5nID0gXCIkXCIgKyBDb2duaXRvLmZvcm1hdE51bWJlcihNYXRoLmFicyh2YWwpLnRvRml4ZWQoMikpO1xyXG5cdFx0cmV0dXJuIHZhbCA+PSAwID8gdmFsU3RyaW5nIDogXCIoXCIgKyB2YWxTdHJpbmcgKyBcIilcIjtcclxuXHR9XHJcblx0Q29nbml0by5mb3JtYXRDdXJyZW5jeSA9IGZvcm1hdEN1cnJlbmN5O1xyXG5cclxuXHQvLyBGb3JtYXQgbnVtYmVyIHdpdGggdGhvdXNhbmRzIHNlcGFyYXRvcnNcclxuXHRmdW5jdGlvbiBmb3JtYXROdW1iZXIodmFsKSB7XHJcblx0XHRyZXR1cm4gdmFsLnRvU3RyaW5nKCkucmVwbGFjZSgvXFxCKD89KD86XFxkezN9KSsoPyFcXGQpKS9nLCBcIixcIik7XHJcblx0fVxyXG5cdENvZ25pdG8uZm9ybWF0TnVtYmVyID0gZm9ybWF0TnVtYmVyO1xyXG5cclxuXHRDb2duaXRvLkVtYWlscyA9IHt9XHJcblxyXG5cdENvZ25pdG8uRW1haWxzLmZvcm1hdEFkZHJlc3NlcyA9IGZ1bmN0aW9uIChhZGRyZXNzZXMsIHRva2VuUGF0aHMsIG1heE51bWJlck9mQWRkcmVzc2VzKSB7XHJcblx0XHRpZiAodHlwZW9mIGFkZHJlc3NlcyAhPT0gXCJzdHJpbmdcIilcclxuXHRcdFx0YWRkcmVzc2VzID0gYWRkcmVzc2VzLmpvaW4oXCI7XCIpO1xyXG5cclxuXHRcdHZhciBfYWRkcmVzc2VzID0gW107XHJcblxyXG5cdFx0Ly8gR2V0IGFsbCB2YWxpZCBlbWFpbCBhZGRyZXNzZXNcclxuXHRcdChhZGRyZXNzZXMubWF0Y2goQ29nbml0by5lbWFpbEFuZFRva2VuUmVnZXgpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uIChhZGRyKSB7XHJcblx0XHRcdGFkZHIgPSBhZGRyLnJlcGxhY2UoLyhcXHhhMHxcXHMpL2csIFwiXCIpO1xyXG5cdFx0XHQvLyBOb3QgRW1wdHlcclxuXHRcdFx0aWYgKGFkZHIgIT09IFwiXCIpIHtcclxuXHRcdFx0XHQvLyBTcGVjaWZpYyBFbWFpbCBBZGRyZXNzXHJcblx0XHRcdFx0aWYgKGFkZHIubWF0Y2goQ29nbml0by5lbWFpbFJlZ2V4KSlcclxuXHRcdFx0XHRcdF9hZGRyZXNzZXMucHVzaChhZGRyKTtcclxuXHRcdFx0XHQvLyBUb2tlblxyXG5cdFx0XHRcdGVsc2UgaWYgKHRva2VuUGF0aHMgJiYgYWRkclswXSA9PSAnWycgJiYgYWRkclthZGRyLmxlbmd0aCAtIDFdID09ICddJyAmJiB0b2tlblBhdGhzLmluZGV4T2YoYWRkci5zbGljZSgxLCBhZGRyLmxlbmd0aCAtIDEpKSA+PSAwKVxyXG5cdFx0XHRcdFx0X2FkZHJlc3Nlcy5wdXNoKGFkZHIpO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHJcblx0XHQvLyBHZXQgYSBkaXN0aW5jdCBzZXQgb2YgYWRkcmVzc2VzXHJcblx0XHRfdGVtcCA9IFtdO1xyXG5cdFx0X2FkZHJlc3Nlcy5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7XHJcblx0XHRcdHIgPSByLnRyaW0oKTtcclxuXHRcdFx0aWYgKF90ZW1wLmluZGV4T2YocikgPCAwKVxyXG5cdFx0XHRcdF90ZW1wLnB1c2gocik7XHJcblx0XHR9KVxyXG5cdFx0X2FkZHJlc3NlcyA9IF90ZW1wO1xyXG5cclxuXHRcdC8vIEdldCBvbmx5IHRoZSBtYXggbnVtYmVyIG9mIGFkZHJlc3NlcyBzcGVjaWZpZWRcclxuXHRcdGlmIChfYWRkcmVzc2VzLmxlbmd0aCA+IG1heE51bWJlck9mQWRkcmVzc2VzKVxyXG5cdFx0XHRfYWRkcmVzc2VzID0gX2FkZHJlc3Nlcy5zbGljZSgwLCBtYXhOdW1iZXJPZkFkZHJlc3Nlcyk7XHJcblxyXG5cdFx0cmV0dXJuIF9hZGRyZXNzZXMuam9pbignOyAnKTtcclxuXHR9XHJcblxyXG5cdENvZ25pdG8uTWVzc2FnaW5nLmFkZEhhbmRsZXIoXCJjaGFuZ2VPcmdhbml6YXRpb25cIiwgZnVuY3Rpb24oZGF0YSkge1xyXG5cdFx0Q29nbml0by5jaGFuZ2VPcmdhbml6YXRpb24oZGF0YS5pZCwgZnVuY3Rpb24gKHJlc3BvbnNlRGF0YSkge1xyXG5cdFx0XHRpZiAocmVzcG9uc2VEYXRhLnJlZGlyZWN0KVxyXG5cdFx0XHRcdGlmIChyZXNwb25zZURhdGEuc3VjY2VzcylcclxuXHRcdFx0XHRcdGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSByZXNwb25zZURhdGEucmVkaXJlY3Q7XHJcblx0XHRcdFx0ZWxzZVxyXG5cdFx0XHRcdFx0d2luZG93LnBhcmVudC5sb2NhdGlvbi5ocmVmID0gcmVzcG9uc2VEYXRhLnJlZGlyZWN0O1xyXG5cdFx0XHRlbHNlIGlmIChkYXRhLnJlZGlyZWN0KVxyXG5cdFx0XHRcdGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSBkYXRhLnJlZGlyZWN0O1xyXG5cdFx0fSk7XHJcblx0fSk7XHJcblxyXG5cdC8vIEVuYWJsZSB2aWV3cyB0byBzdXBwcmVzcy9wYXJ0aWNpcGF0ZSBpbiBuYXZpZ2F0aW9uXHJcblx0dmFyIG9uTmF2aWdhdGVEaWFsb2c7XHJcblx0dmFyIGJsb2NrTmF2aWdhdGlvbjtcclxuXHR2YXIgZm9yY2VOYXZpZ2F0aW9uO1xyXG5cdGZ1bmN0aW9uIG9uTmF2aWdhdGUob3B0aW9ucykge1xyXG5cdFx0aWYgKCFvbk5hdmlnYXRlRGlhbG9nKSB7XHJcblx0XHRcdG9uTmF2aWdhdGVEaWFsb2cgPSAkLmZuLmRpYWxvZyhvcHRpb25zKTtcclxuXHRcdFx0b25OYXZpZ2F0ZURpYWxvZy5fZGlhbG9nLmNzcyhcInotaW5kZXhcIiwgMTA2MCk7XHJcblx0XHR9XHJcblxyXG5cdFx0YmxvY2tOYXZpZ2F0aW9uID0gb3B0aW9ucy5vcGVuO1xyXG5cdFx0aWYgKG9uTmF2aWdhdGVEaWFsb2cub3Blbikge1xyXG5cdFx0XHQkKHdpbmRvdykub24oXCJiZWZvcmV1bmxvYWRcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XHJcblx0XHRcdFx0aWYgKGJsb2NrTmF2aWdhdGlvbihldmVudCkgJiYgIWZvcmNlTmF2aWdhdGlvbikge1xyXG5cdFx0XHRcdFx0cmV0dXJuIG9wdGlvbnMudGV4dDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRDb2duaXRvLm9uTmF2aWdhdGUgPSBvbk5hdmlnYXRlO1xyXG5cclxuXHQvLyBQZXJmb3JtcyB0aGUgc3BlY2lmaWVkIG5hdmlnYXRpb24gYWN0aW9uIGlmIGFsbG93ZWRcclxuXHQvLyBhY3Rpb24gY2FuIGFsc28gYmUgYSBkYXRhIG9iamVjdCB1c2VkIGJ5IHRoZSB1bnNhdmVkIGNoYW5nZXMgZGlhbG9nXHJcblx0Q29nbml0by5uYXZpZ2F0ZSA9IGZ1bmN0aW9uIG5hdmlnYXRlKGFjdGlvbiwgZm9yY2UpIHtcclxuXHRcdGlmIChmb3JjZSkge1xyXG5cdFx0XHRmb3JjZU5hdmlnYXRpb24gPSB0cnVlO1xyXG5cdFx0XHRpZiAodHlwZW9mIGFjdGlvbiA9PT0gXCJmdW5jdGlvblwiKVxyXG5cdFx0XHRcdGFjdGlvbigpO1xyXG5cdFx0XHRyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0aWYgKG9uTmF2aWdhdGVEaWFsb2cpIHtcclxuXHRcdFx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcclxuXHRcdFx0XHRcdG9uTmF2aWdhdGVEaWFsb2cuY29udGludWUgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdG9uTmF2aWdhdGVEaWFsb2cuY2xvc2UoKTtcclxuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBhY3Rpb24gPT09IFwiZnVuY3Rpb25cIikgYWN0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcblx0XHRcdFx0XHRcdHJlc29sdmUoKTtcclxuXHRcdFx0XHRcdH07XHJcblx0XHRcdFx0XHRpZiAoIW9uTmF2aWdhdGVEaWFsb2cub3BlbihhY3Rpb24pKVxyXG5cdFx0XHRcdFx0e1xyXG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mIGFjdGlvbiA9PT0gXCJmdW5jdGlvblwiKVxyXG5cdFx0XHRcdFx0XHRcdGFjdGlvbigpO1xyXG5cdFx0XHRcdFx0XHRyZXNvbHZlKCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0aWYgKHR5cGVvZiBhY3Rpb24gPT09IFwiZnVuY3Rpb25cIilcclxuXHRcdFx0XHRcdGFjdGlvbigpO1xyXG5cdFx0XHRcdHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdC8qKlxyXG5cdCAqIEhpZGVzL3Nob3dzIGFuIGVsZW1lbnQgdXNpbmcgZmFkZUluL2ZhZGVPdXQgKGZvciB1c2Ugd2l0aCBNUyBBamF4ICo6dmlzaWJsZSBhbmQgKjp2aXNpYmlsaXR5RnVuY3Rpb24pXHJcblx0ICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZWxlbWVudCBUaGUgdGFyZ2V0IGVsZW1lbnRcclxuXHQgKiBAcGFyYW0ge2Jvb2xlYW59IHNob3cgV2hldGhlciB0byBzaG93L2ZhZGVJbiBvciBoaWRlL2ZhZGVPdXRcclxuXHQgKiBAcGFyYW0ge2Jvb2xlYW59IGlzSW5pdGlhbGl6aW5nIFdoZXRoZXIgdGhpcyBpcyB0aGUgZmlyc3QgdGltZSB0aGUgZnVuY3Rpb24gaGFzIHJ1blxyXG5cdCAqL1xyXG5cdGZ1bmN0aW9uIHZpc2liaWxpdHlGYWRlKGVsZW1lbnQsIHNob3csIGlzSW5pdGlhbGl6aW5nKSB7XHJcblx0XHQvLyBTaW1wbHkgaGlkZS9zaG93IHdoZW4gdGhlIHZpc2libGl0eSBmdW5jdGlvbiBpcyBmaXJzdCBydW4sIHNpbmNlIGl0XHJcblx0XHQvLyBzaG91bGRuJ3QgcmVxdWlyZSBhbmltYXRpb24gYW5kIHVzaW5nIGZhZGVJbi9mYWRlT3V0IG1heSBub3Qgd29yayBwcm9wZXJseS5cclxuXHRcdGlmIChpc0luaXRpYWxpemluZykge1xyXG5cdFx0XHRpZiAoc2hvdylcclxuXHRcdFx0XHQkKGVsZW1lbnQpLnNob3coKTtcclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdCQoZWxlbWVudCkuaGlkZSgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChzaG93KVxyXG5cdFx0XHQkKGVsZW1lbnQpLmZhZGVJbigpO1xyXG5cdFx0ZWxzZVxyXG5cdFx0XHQkKGVsZW1lbnQpLmZhZGVPdXQoKTtcclxuXHR9XHJcblxyXG5cdENvZ25pdG8udmlzaWJpbGl0eUZhZGUgPSB2aXNpYmlsaXR5RmFkZTtcclxuXHJcblx0dmFyIG1vZHVsZTtcclxuXHJcblx0Ly8gR2V0IGN1cnJlbnQgbW9kdWxlXHJcblx0Q29nbml0by5tb2RlbFJlYWR5KGZ1bmN0aW9uICgpIHtcclxuXHRcdG1vZHVsZSA9IENvZ25pdG8uY29uZmlnLm1vZHVsZXNbMF07XHJcblx0fSk7XHJcblxyXG5cdENvZ25pdG8ucmVzZW5kVmVyaWZpY2F0aW9uID0gZnVuY3Rpb24oKSB7XHJcblx0XHRDb2duaXRvLnNlcnZpY2VSZXF1ZXN0KHtcclxuXHRcdFx0ZW5kcG9pbnQ6IFwiYWRtaW4vcmVzZW5kLXZlcmlmaWNhdGlvblwiLFxyXG5cdFx0XHRtZXRob2Q6IFwiUE9TVFwiXHJcblx0XHR9KTtcclxuXHR9O1xyXG5cclxuXHRDb2duaXRvLmNyZWF0ZUNyZWRlbnRpYWxzID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkLCBzdWNjZXNzLCBlcnJvcikge1xyXG5cdFx0bW9kdWxlLnNlcnZpY2VSZXF1ZXN0KHtcclxuXHRcdFx0ZW5kcG9pbnQ6IFwiY3JlZGVudGlhbHNcIixcclxuXHRcdFx0bWV0aG9kOiBcIlBPU1RcIixcclxuXHRcdFx0ZGF0YTogeyB1c2VybmFtZTogdXNlcm5hbWUsIHBhc3N3b3JkOiBwYXNzd29yZCB9LFxyXG5cdFx0XHRzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XHJcblx0XHRcdFx0aWYgKHN1Y2Nlc3MgJiYgc3VjY2VzcyBpbnN0YW5jZW9mIEZ1bmN0aW9uKVxyXG5cdFx0XHRcdFx0c3VjY2VzcyhkYXRhKTtcclxuXHRcdFx0fSxcclxuXHRcdFx0ZXJyb3I6IGZ1bmN0aW9uKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikge1xyXG5cdFx0XHRcdGlmIChlcnJvciAmJiBlcnJvciBpbnN0YW5jZW9mIEZ1bmN0aW9uKVxyXG5cdFx0XHRcdFx0ZXJyb3IoanFYSFIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fTtcclxuXHJcblx0Q29nbml0by51cGRhdGVDcmVkZW50aWFscyA9IGZ1bmN0aW9uKGlkLCB1c2VybmFtZSwgcGFzc3dvcmQsIHN1Y2Nlc3MsIGVycm9yKSB7XHJcblx0XHRtb2R1bGUuc2VydmljZVJlcXVlc3Qoe1xyXG5cdFx0XHRlbmRwb2ludDogXCJjcmVkZW50aWFsc1wiLFxyXG5cdFx0XHRtZXRob2Q6IFwiUFVUXCIsXHJcblx0XHRcdGRhdGE6IHsgaWQ6IGlkLCB1c2VybmFtZTogdXNlcm5hbWUsIHBhc3N3b3JkOiBwYXNzd29yZCB9LFxyXG5cdFx0XHRzdWNjZXNzOiBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRpZiAoc3VjY2VzcyAmJiBzdWNjZXNzIGluc3RhbmNlb2YgRnVuY3Rpb24pXHJcblx0XHRcdFx0XHRzdWNjZXNzKCk7XHJcblx0XHRcdH0sXHJcblx0XHRcdGVycm9yOiBmdW5jdGlvbihqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcclxuXHRcdFx0XHRpZiAoZXJyb3IgJiYgZXJyb3IgaW5zdGFuY2VvZiBGdW5jdGlvbilcclxuXHRcdFx0XHRcdGVycm9yKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bik7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH07XHJcblxyXG5cdENvZ25pdG8uZGVsZXRlQ3JlZGVudGlhbHMgPSBmdW5jdGlvbihpZCwgc3VjY2VzcywgZXJyb3IpIHtcclxuXHRcdG1vZHVsZS5zZXJ2aWNlUmVxdWVzdCh7XHJcblx0XHRcdGVuZHBvaW50OiBcImNyZWRlbnRpYWxzXCIsXHJcblx0XHRcdG1ldGhvZDogXCJERUxFVEVcIixcclxuXHRcdFx0ZGF0YTogeyBpZDogaWQgfSxcclxuXHRcdFx0c3VjY2VzczogZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0aWYgKHN1Y2Nlc3MgJiYgc3VjY2VzcyBpbnN0YW5jZW9mIEZ1bmN0aW9uKVxyXG5cdFx0XHRcdFx0c3VjY2VzcygpO1xyXG5cdFx0XHR9LFxyXG5cdFx0XHRlcnJvcjogZnVuY3Rpb24oanFYSFIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XHJcblx0XHRcdFx0aWYgKGVycm9yICYmIGVycm9yIGluc3RhbmNlb2YgRnVuY3Rpb24pXHJcblx0XHRcdFx0XHRlcnJvcihqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHR9O1xyXG5cclxuXHRDb2duaXRvLnNob3dBbm5vdW5jZW1lbnQgPSBmdW5jdGlvbiAoc2VsZWN0b3IsIHBhcmVudFNlbGVjdG9yKSB7XHJcblx0XHRDb2duaXRvLnNlcnZpY2VSZXF1ZXN0KHtcclxuXHRcdFx0ZW5kcG9pbnQ6IFwibWFya2V0aW5nL2Fubm91bmNlbWVudD9tb2R1bGU9Zm9ybXNcIixcclxuXHRcdFx0ZGF0YVR5cGU6IFwiaHRtbFwiLFxyXG5cdFx0XHRzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xyXG5cdFx0XHRcdGlmIChkYXRhLmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0XHRcdFx0JChwYXJlbnRTZWxlY3RvcikuaGlkZSgpO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHQkKHBhcmVudFNlbGVjdG9yKS5zaG93KCk7XHJcblx0XHRcdFx0XHQkKHNlbGVjdG9yKS5hdHRyKFwiZGF0YS1uYW1lXCIsIGRhdGEuc3Vic3RyaW5nKDQsIGRhdGEuaW5kZXhPZignLS0+JykpKTtcclxuXHRcdFx0XHRcdCQoc2VsZWN0b3IpLmh0bWwoZGF0YSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdENvZ25pdG8uZGlzbWlzc0Fubm91bmNtZW50ID0gZnVuY3Rpb24oc2VsZWN0b3IsIHBhcmVudFNlbGVjdG9yKSB7XHJcblx0XHRDb2duaXRvLnNlcnZpY2VSZXF1ZXN0KHtcclxuXHRcdFx0ZW5kcG9pbnQ6IFwibWFya2V0aW5nL2Rpc21pc3Nhbm5vdW5jZW1lbnQ/bmFtZT1cIiArICQoc2VsZWN0b3IpLmF0dHIoXCJkYXRhLW5hbWVcIiksXHJcblx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRDb2duaXRvLnNob3dBbm5vdW5jZW1lbnQoc2VsZWN0b3IsIHBhcmVudFNlbGVjdG9yKTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHRDb2duaXRvLmNoYW5nZU9yZ2FuaXphdGlvbiA9IGZ1bmN0aW9uKGlkLCBjYWxsYmFjaykge1xyXG5cdFx0Q29nbml0by5zZXJ2aWNlUmVxdWVzdCh7XHJcblx0XHRcdGVuZHBvaW50OiBcImFkbWluL29yZ2FuaXphdGlvblwiLFxyXG5cdFx0XHRtZXRob2Q6IFwiUFVUXCIsXHJcblx0XHRcdGRhdGE6IHsgaWQ6IGlkIH0sXHJcblx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XHJcblx0XHRcdFx0Q29nbml0by5NZXNzYWdpbmcudHJpZ2dlcihcIm9yZ2FuaXphdGlvbkNoYW5nZWRcIiwgeyBkYXRhOiBpZCB9KTtcclxuXHJcblx0XHRcdFx0aWYgKGNhbGxiYWNrIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuXHRcdFx0XHRcdGNhbGxiYWNrKGRhdGEpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fTtcclxuXHJcblx0Q29nbml0by5kaXNtaXNzTm90aWZpY2F0aW9uID0gZnVuY3Rpb24oaWQsIGNhbGxiYWNrKSB7XHJcblx0XHRDb2duaXRvLnNlcnZpY2VSZXF1ZXN0KHtcclxuXHRcdFx0ZW5kcG9pbnQ6IFwiYWRtaW4vZGVsZXRlbm90aWZpY2F0aW9uXCIsXHJcblx0XHRcdG1ldGhvZDogXCJQT1NUXCIsXHJcblx0XHRcdGRhdGE6IHsgaWQ6IGlkIH0sXHJcblx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHtcclxuXHRcdFx0XHRpZiAoY2FsbGJhY2sgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG5cdFx0XHRcdFx0Y2FsbGJhY2soZGF0YSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHR9O1xyXG5cclxuXHR2YXIgcmVzaXplVGltZW91dDtcclxuXHQkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uICgpIHtcclxuXHRcdGlmIChyZXNpemVUaW1lb3V0KVxyXG5cdFx0XHR3aW5kb3cuY2xlYXJUaW1lb3V0KHJlc2l6ZVRpbWVvdXQpO1xyXG5cdH0pO1xyXG5cclxuXHRpZiAoaXNJbklmcmFtZSkge1xyXG5cdFx0JChmdW5jdGlvbiAoKSB7XHJcblx0XHRcdC8vIERvIG5vdCBleGVjdXRlIGR1cmluZyBVSSBVbml0IHRlc3RpbmdcclxuXHRcdFx0aWYgKGRvY3VtZW50LmNvb2tpZS5pbmRleE9mKFwiVGVzdElkPVwiKSA9PT0gLTEgJiYgIUNvZ25pdG8uY29uZmlnLndoaXRlTGFiZWwpIHtcclxuXHRcdFx0XHRpZiAod2luZG93LnRvcCA9PSB3aW5kb3cuc2VsZikge1xyXG5cdFx0XHRcdFx0dmFyIHVybCA9IGRvY3VtZW50LmxvY2F0aW9uLnBhdGhuYW1lICsgZG9jdW1lbnQubG9jYXRpb24uc2VhcmNoO1xyXG5cclxuXHRcdFx0XHRcdC8vIE5vcm1hbGl6ZSB1cmwgdG8gTk9UIGhhdmUgYSBsZWFkaW5nIFwiL1wiXHJcblx0XHRcdFx0XHQvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvTG9jYXRpb24vcGF0aG5hbWUjQnJvd3Nlcl9jb21wYXRpYmlsaXR5XHJcblx0XHRcdFx0XHRpZiAodXJsLmluZGV4T2YoXCIvXCIpID09PSAwKVxyXG5cdFx0XHRcdFx0XHR1cmwgPSB1cmwuc3Vic3RyaW5nKDEpO1xyXG5cclxuXHRcdFx0XHRcdGlmICh1cmwuaW5kZXhPZihcImFkbWluL1wiKSA9PT0gMClcclxuXHRcdFx0XHRcdFx0dXJsID0gdXJsLnN1YnN0cmluZyg2KTtcclxuXHJcblx0XHRcdFx0XHR1cmwgPSB1cmwucmVwbGFjZShcImFkbWluL3ZpZXcvXCIsIFwiXCIpO1xyXG5cdFx0XHRcdFx0ZG9jdW1lbnQubG9jYXRpb24uaHJlZiA9IENvZ25pdG8uY29uZmlnLmZvcm1zVXJsICsgdXJsO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gSGFuZHkgbGl0dGxlIGV2ZW50aW5nIHRoYXQgYWxsb3dzIGZvcmNpbmcgbmF2aWdhdGlvbiBvdXRzaWRlIG9mIHRoZSBmcmFtZVxyXG5cdFx0XHQkKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiYVwiLCBmdW5jdGlvbiAoZSkge1xyXG5cdFx0XHRcdHZhciAkdGhpcyA9ICQodGhpcyk7XHJcblx0XHRcdFx0aWYgKCR0aGlzLmF0dHIoXCJkYXRhLXRhcmdldFwiKSA9PT0gXCJ0b3BcIikge1xyXG5cdFx0XHRcdFx0Q29nbml0by5NZXNzYWdpbmcudHJpZ2dlcihcIm5hdmlnYXRlXCIsIHsgZGF0YTogeyBsb2NhdGlvbjogJHRoaXMuYXR0cihcImhyZWZcIikgfSB9KTtcclxuXHJcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdH0pO1xyXG5cdH1cclxufSkoRXhvSlF1ZXJ5KTtcclxufSkodHlwZW9mIGV4cG9ydHMgPT09ICd1bmRlZmluZWQnKTtcclxuIiwi77u/KCh0eXBlb2YgZXhwb3J0cyAhPSAndW5kZWZpbmVkJyA/IGV4cG9ydHMgOiB7fSkuZXhlYyA9IGZ1bmN0aW9uKCkge1xyXG53aW5kb3cuQ29nbml0byA9IHdpbmRvdy5Db2duaXRvIHx8IHt9O1xyXG4oZnVuY3Rpb24gKHdpbmRvdykge1xyXG5cdHZhciBfaGFuZGxlcnMgPSB7fTtcclxuXHJcblx0dmFyIE1lc3NhZ2luZyA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdHZhciBldmVudE1ldGhvZCA9IHdpbmRvdy5hZGRFdmVudExpc3RlbmVyID8gXCJhZGRFdmVudExpc3RlbmVyXCIgOiBcImF0dGFjaEV2ZW50XCI7XHJcblx0XHR2YXIgZXZlbnQgPSB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciA/IFwibWVzc2FnZVwiIDogXCJvbm1lc3NhZ2VcIjtcclxuXHRcdHZhciBldmVudGVyID0gd2luZG93W2V2ZW50TWV0aG9kXTtcclxuXHJcblx0XHRldmVudGVyKGV2ZW50LCB0aGlzLl9oYW5kbGUsIGZhbHNlKTtcclxuXHR9XHJcblxyXG5cdC8vIEdldCB0aGUgdmFsdWUgYXQgdGhlIHNwZWNpZmllZCBwcm9wZXJ0eSBwYXRoXHJcblx0ZnVuY3Rpb24gZXZhbFBhdGgob2JqLCBwYXRoKSB7XHJcblx0XHRmdW5jdGlvbiBpbmRleChvYmosIGkpIHsgcmV0dXJuIG9ialtpXSB9XHJcblx0XHRyZXR1cm4gcGF0aC5zcGxpdCgnLicpLnJlZHVjZShpbmRleCwgb2JqKTtcclxuXHR9XHJcblxyXG5cdE1lc3NhZ2luZy5wcm90b3R5cGUgPSB7XHJcblx0XHRfaGFuZGxlOiBmdW5jdGlvbiAoZXZlbnQpIHtcclxuXHRcdFx0dHJ5IHtcclxuXHRcdFx0XHR2YXIgcGF5bG9hZCA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7XHJcblx0XHRcdH1cclxuXHRcdFx0Y2F0Y2ggKGUpXHJcblx0XHRcdHsgfVxyXG5cclxuXHRcdFx0aWYgKHBheWxvYWQgJiYgcGF5bG9hZC5ldmVudCkge1xyXG5cdFx0XHRcdHZhciBoYW5kbGVyTGlzdCA9IF9oYW5kbGVyc1twYXlsb2FkLmV2ZW50XTtcclxuXHJcblx0XHRcdFx0aWYgKGhhbmRsZXJMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlckxpc3QuZm9yRWFjaChmdW5jdGlvbiAoaGFuZGxlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLmNhbGwoZXZlbnQsIHBheWxvYWQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cclxuXHRcdGRpc3Bvc2U6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0X2hhbmRsZXJzID0ge307XHJcblx0XHR9LFxyXG5cclxuXHRcdGFkZEhhbmRsZXI6IGZ1bmN0aW9uIChuYW1lLCBoYW5kbGVyKSB7XHJcbiAgICAgICAgICAgIF9oYW5kbGVyc1tuYW1lXSA9IF9oYW5kbGVyc1tuYW1lXSB8fCBbXTtcclxuICAgICAgICAgICAgX2hhbmRsZXJzW25hbWVdLnB1c2goaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cclxuXHRcdHRyaWdnZXI6IGZ1bmN0aW9uICgvKiBbZXZlbnQsXSBvcHRpb25zICovKSB7XHJcblx0XHRcdHZhciBldmVudDtcclxuXHRcdFx0dmFyIG9wdGlvbnM7XHJcblxyXG5cdFx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikge1xyXG5cdFx0XHRcdGV2ZW50ID0gYXJndW1lbnRzWzBdO1xyXG5cdFx0XHRcdG9wdGlvbnMgPSBhcmd1bWVudHNbMV07XHJcblx0XHRcdH0gZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkge1xyXG5cdFx0XHRcdGlmICh0eXBlb2YgKGFyZ3VtZW50c1swXSkgPT09IFwic3RyaW5nXCIpIHtcclxuXHRcdFx0XHRcdGV2ZW50ID0gYXJndW1lbnRzWzBdO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRvcHRpb25zID0gYXJndW1lbnRzWzBdO1xyXG5cdFx0XHRcdFx0ZXZlbnQgPSBvcHRpb25zLmV2ZW50O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIHBheWxvYWQgPSB7fTtcclxuXHRcdFx0cGF5bG9hZFtcImV2ZW50XCJdID0gZXZlbnQ7XHJcblxyXG5cdFx0XHRpZiAob3B0aW9ucyAmJiBvcHRpb25zLmRhdGEpIHtcclxuXHRcdFx0XHRcdHBheWxvYWRbXCJkYXRhXCJdID0gb3B0aW9ucy5kYXRhO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR2YXIgdGFyZ2V0ID0gKG9wdGlvbnMgJiYgb3B0aW9ucy50YXJnZXQpIHx8IHdpbmRvdy5wYXJlbnQ7XHJcblx0XHRcdHZhciBvcmlnaW4gPSAob3B0aW9ucyAmJiBvcHRpb25zLm9yaWdpbikgfHwgXCIqXCI7XHJcblxyXG5cdFx0XHR0YXJnZXQucG9zdE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkocGF5bG9hZCksIG9yaWdpbik7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIENyZWF0ZXMgYSBwcm94eSBmb3IgYSBzZXQgb2YgZnVuY3Rpb25zIHRoYXQgY2FuIGJlIHNhZmVseSBjYWxsZWQgYWNyb3NzIGZyYW1lIGJvdW5kYXJpZXNcclxuXHRcdHByb3h5OiBmdW5jdGlvbiAodGFyZ2V0LCBzY29wZSkge1xyXG5cclxuXHRcdFx0Ly8gR2V0IHRoZSBmdW5jdGlvbiBzZXQgZm9yIHRoZSBzcGVjaWZpZWQgdGFyZ2V0IGFuZCBzY29wZVxyXG5cdFx0XHR2YXIgZm5TZXQgPSBldmFsUGF0aCh0YXJnZXQsIHNjb3BlKTtcclxuXHRcdFx0dmFyIHByb3h5ID0ge307XHJcblxyXG5cdFx0XHQvLyBEZWZpbmUgYSBjbG9zdXJlIHRvIGNyZWF0ZSBhIHByb3h5IHdyYXBwZXIgZnVuY3Rpb25cclxuXHRcdFx0ZnVuY3Rpb24gY3JlYXRlUHJveHkoZm4pIHtcclxuXHRcdFx0XHRyZXR1cm4gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0dmFyIGFyZ3MgPSBbXTtcclxuXHRcdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0XHRcdGFyZyA9IGFyZ3VtZW50c1tpXTtcclxuXHJcblx0XHRcdFx0XHRcdC8vIFNlcmlhbGl6ZSBFbnRpdHlcclxuXHRcdFx0XHRcdFx0aWYgKGFyZyBpbnN0YW5jZW9mIEV4b1dlYi5Nb2RlbC5FbnRpdHkpIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgdHlwZSA9IGFyZy5tZXRhLnR5cGUuZ2V0X2Z1bGxOYW1lKCk7XHJcblx0XHRcdFx0XHRcdFx0YXJnID0gQ29nbml0by5zZXJpYWxpemUoYXJnKTtcclxuXHRcdFx0XHRcdFx0XHRhcmcuJHR5cGUgPSBhcmcuJHR5cGUgfHwgdHlwZTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0Ly8gU2VyaWFsaXplIEVudGl0eSBBcnJheVxyXG5cdFx0XHRcdFx0XHRlbHNlIGlmIChhcmcgaW5zdGFuY2VvZiBBcnJheSAmJiBhcmcubGVuZ3RoID4gMCAmJiBhcmdbMF0gaW5zdGFuY2VvZiBFeG9XZWIuTW9kZWwuRW50aXR5KSB7XHJcblx0XHRcdFx0XHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCBhcmcubGVuZ3RoOyBqKyspIHtcclxuXHRcdFx0XHRcdFx0XHRcdHZhciB0eXBlID0gYXJnW2pdLm1ldGEudHlwZS5nZXRfZnVsbE5hbWUoKTtcclxuXHRcdFx0XHRcdFx0XHRcdGFyZ1tqXSA9IENvZ25pdG8uc2VyaWFsaXplKGFyZ1tqXSk7XHJcblx0XHRcdFx0XHRcdFx0XHRhcmdbal0uJHR5cGUgPSBhcmdbal0uJHR5cGUgfHwgdHlwZTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdC8vIENsZWFuc2UgQXJyYXlzXHJcblx0XHRcdFx0XHRcdGVsc2UgaWYgKGFyZyBpbnN0YW5jZW9mIEFycmF5KSB7XHJcblx0XHRcdFx0XHRcdFx0aWYgKGFyZy5sZW5ndGggPiAwICYmIGFyZ1swXSBpbnN0YW5jZW9mIE9iamVjdCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCBhcmcubGVuZ3RoOyBqKyspIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIG9iaiA9IGFyZ1tqXTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIGNsZWFuID0ge307XHJcblx0XHRcdFx0XHRcdFx0XHRcdGZvciAodmFyIHByb3AgaW4gb2JqKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIHZhbCA9IG9ialtwcm9wXTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAodmFsIGluc3RhbmNlb2YgRXhvV2ViLk1vZGVsLkVudGl0eSB8fCAodmFsIGluc3RhbmNlb2YgQXJyYXkgJiYgdmFsLmxlbmd0aCA+IDAgJiYgdmFsWzBdIGluc3RhbmNlb2YgRXhvV2ViLk1vZGVsLkVudGl0eSkpXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRjb250aW51ZTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRjbGVhbltwcm9wXSA9IHZhbDtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRhcmdbal0gPSBjbGVhbjtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdC8vIENsZWFuc2UgT2JqZWN0c1xyXG5cdFx0XHRcdFx0XHRlbHNlIGlmIChhcmcgaW5zdGFuY2VvZiBPYmplY3QpIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgY2xlYW4gPSB7fTtcclxuXHRcdFx0XHRcdFx0XHRmb3IgKHZhciBwcm9wIGluIGFyZykge1xyXG5cdFx0XHRcdFx0XHRcdFx0dmFyIHZhbCA9IGFyZ1twcm9wXTtcclxuXHRcdFx0XHRcdFx0XHRcdGlmICh2YWwgaW5zdGFuY2VvZiBFeG9XZWIuTW9kZWwuRW50aXR5IHx8ICh2YWwgaW5zdGFuY2VvZiBBcnJheSAmJiB2YWwubGVuZ3RoID4gMCAmJiB2YWxbMF0gaW5zdGFuY2VvZiBFeG9XZWIuTW9kZWwuRW50aXR5KSlcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y29udGludWU7XHJcblx0XHRcdFx0XHRcdFx0XHRjbGVhbltwcm9wXSA9IHZhbDtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0YXJnID0gY2xlYW47XHJcblx0XHRcdFx0XHRcdH1cdFx0XHRcdFx0XHRcclxuXHJcblx0XHRcdFx0XHRcdGFyZ3MucHVzaChhcmcpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0Q29nbml0by5NZXNzYWdpbmcudHJpZ2dlcihcInByb3h5XCIsIHsgdGFyZ2V0OiB0YXJnZXQsIGRhdGE6IHsgc2NvcGU6IHNjb3BlLCBmbjogZm4sIGFyZ3M6IGFyZ3MgfSB9KTtcclxuXHRcdFx0XHR9O1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBDcmVhdGUgcHJveHkgZnVuY3Rpb25zIGZvciBlYWNoIGZ1bmN0aW9uIGluIHRoZSBzZXRcclxuXHRcdFx0Zm9yICh2YXIgZm4gaW4gZm5TZXQpIHtcclxuXHRcdFx0XHRwcm94eVtmbl0gPSBjcmVhdGVQcm94eShmbik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiBwcm94eTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHR3aW5kb3cuQ29nbml0by5NZXNzYWdpbmcgPSBuZXcgTWVzc2FnaW5nKCk7XHJcblxyXG5cdC8vIEFkZCBhIGRlZmF1bHQgZXZlbnQgaGFuZGxlciB0byBnZW5lcmljYWxseSBzdXBwb3J0IGNvbnRyb2xsZXIgcHJveGllc1xyXG5cdENvZ25pdG8uTWVzc2FnaW5nLmFkZEhhbmRsZXIoXCJwcm94eVwiLCBmdW5jdGlvbiAoZGF0YSkge1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmFyZ3MubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0YXJnID0gZGF0YS5hcmdzW2ldO1xyXG5cclxuXHRcdFx0Ly8gRGVzZXJpYWxpemUgRW50aXR5XHJcblx0XHRcdGlmIChhcmcgJiYgYXJnLiR0eXBlKSB7XHJcblx0XHRcdFx0dmFyIGVudGl0eSA9IG51bGw7XHJcblx0XHRcdFx0aWYgKGFyZy5JZCkge1xyXG5cdFx0XHRcdFx0dmFyIHR5cGUgPSBjb250ZXh0Lm1vZGVsLm1ldGEudHlwZShhcmcuJHR5cGUpLmdldF9qc3R5cGUoKTtcclxuXHRcdFx0XHRcdGVudGl0eSA9IHR5cGUubWV0YS5nZXQoYXJnLklkLnRvU3RyaW5nKCkpO1xyXG5cdFx0XHRcdH1cdFxyXG5cdFx0XHRcdGRhdGEuYXJnc1tpXSA9IENvZ25pdG8uZGVzZXJpYWxpemUobnVsbCwgYXJnLCBlbnRpdHkpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBEZXNlcmlhbGl6ZSBFbnRpdHkgQXJyYXlcclxuXHRcdFx0aWYgKGFyZyAmJiBhcmcgaW5zdGFuY2VvZiBBcnJheSAmJiBhcmcubGVuZ3RoID4gMCAmJiBhcmdbMF0uJHR5cGUpIHtcclxuXHRcdFx0XHR2YXIgdHlwZSA9IGNvbnRleHQubW9kZWwubWV0YS50eXBlKGFyZ1swXS4kdHlwZSkuZ2V0X2pzdHlwZSgpO1xyXG5cdFx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgYXJnLmxlbmd0aDsgaisrKSB7XHJcblx0XHRcdFx0XHR2YXIgZW50aXR5ID0gbnVsbDtcclxuXHRcdFx0XHRcdGlmIChhcmdbal0uSWQpXHJcblx0XHRcdFx0XHRcdGVudGl0eSA9IHR5cGUubWV0YS5nZXQoYXJnLklkLnRvU3RyaW5nKCkpO1xyXG5cdFx0XHRcdFx0YXJnW2pdID0gQ29nbml0by5kZXNlcmlhbGl6ZShudWxsLCBhcmdbal0sIGVudGl0eSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRldmFsUGF0aCh3aW5kb3csIGRhdGEuc2NvcGUpW2RhdGEuZm5dLmFwcGx5KHdpbmRvdywgZGF0YS5hcmdzKTtcclxuXHR9KTtcclxufSkod2luZG93KTtcclxufSkoKTtcclxuIiwiKCh0eXBlb2YgZXhwb3J0cyAhPSAndW5kZWZpbmVkJyA/IGV4cG9ydHMgOiB7fSkuZXhlYyA9IGZ1bmN0aW9uIChpc0luSWZyYW1lKSB7XHJcbndpbmRvdy5Db2duaXRvID0gd2luZG93LkNvZ25pdG8gfHwge307XHJcbkNvZ25pdG8uaWVTdXBwb3J0TG9hZGVkID0gZmFsc2U7XHJcbkNvZ25pdG8udGltZXJzID0ge307XHJcbkNvZ25pdG8udGVtcGxhdGVDb21wb25lbnRzID0gQ29nbml0by50ZW1wbGF0ZUNvbXBvbmVudHMgfHwgW107XHJcblxyXG4vLyBDb21wYXRpYmlsaXR5XHJcbmlmICghd2luZG93LmNvbnNvbGUpIGNvbnNvbGUgPSB7IGxvZzogZnVuY3Rpb24gKCkgeyB9LCBlcnJvcjogZnVuY3Rpb24gKCkgeyB9LCBkZWJ1ZzogZnVuY3Rpb24gKCkgeyB9LCB3YXJuOiBmdW5jdGlvbiAoKSB7IH0gfTtcclxuXHJcbihmdW5jdGlvbiAoJCkge1xyXG5cclxuXHQvLyBlbnN1cmUgdGhlIGFwcHJvcHJpYXRlIG5hbWVzcGFjZXMgZXhpc3Qgb24gdGhlIGJvZHkgdGFnXHJcblx0ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNldEF0dHJpYnV0ZShcInhtbG5zOnN5c1wiLCBcImphdmFzY3JpcHQ6U3lzXCIpO1xyXG5cdGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ4bWxuczpkYXRhdmlld1wiLCBcImphdmFzY3JpcHQ6U3lzLlVJLkRhdGFWaWV3XCIpO1xyXG5cdGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ4bWxuczpjb250ZW50XCIsIFwiamF2YXNjcmlwdDpFeG9XZWIuVUkuQ29udGVudFwiKTtcclxuXHRkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2V0QXR0cmlidXRlKFwieG1sbnM6dG9nZ2xlXCIsIFwiamF2YXNjcmlwdDpFeG9XZWIuVUkuVG9nZ2xlXCIpO1xyXG5cdGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ4bWxuczp0ZW1wbGF0ZVwiLCBcImphdmFzY3JpcHQ6RXhvV2ViLlVJLlRlbXBsYXRlXCIpO1xyXG5cdGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ4bWxuczp2dWVcIiwgXCJqYXZhc2NyaXB0OkV4b1dlYi5VSS5WdWVDb21wb25lbnRcIik7XHJcblxyXG5cdHZhciBjb25maWcgPSB7XHJcblx0XHRzZXNzaW9uVG9rZW46IFwiXCIsXHJcblx0XHRiYXNlVXJsOiBcIlwiLFxyXG5cdFx0Zm9ybXNVcmw6IFwiXCIsXHJcblx0XHR3ZWJzaXRlQmFzZVVybDogXCJcIixcclxuXHRcdGN1cnJlbnRVc2VyOiBudWxsLFxyXG5cdFx0bW9kZTogXCJcIixcclxuXHRcdG9yZ2FuaXphdGlvbkNvZGU6IFwiXCIsXHJcblx0XHRsb2dpbkF0dGVtcHRzOiAwLFxyXG5cdFx0bWF4TG9naW5BdHRlbXB0czogMSxcclxuXHRcdGlzUmVhZHk6IGZhbHNlLFxyXG5cdFx0dG9rZW5VcGRhdGVkOiBudWxsLFxyXG5cdFx0YXV0aGVudGljYXRlOiBudWxsLFxyXG5cdFx0c2VydmVyVGltZU9mZnNldDogMCxcclxuXHRcdHJlZGlyZWN0VXJsOiBcIlwiLFxyXG5cdFx0ZXJyb3JDb3VudDogMCxcclxuXHRcdG1heENsaWVudEVycm9yczogMTAsXHJcblx0XHRzY3JpcHRzOiBbXSxcclxuXHRcdG1vZHVsZXM6IFtdLFxyXG5cdFx0cmVzb3VyY2VzOiB7fVxyXG5cdH07XHJcblxyXG5cdENvZ25pdG8uY29uZmlnID0gY29uZmlnID0gJC5leHRlbmQoe30sIGNvbmZpZywgQ29nbml0by5jb25maWcpO1xyXG5cdENvZ25pdG8ucmVzb3VyY2VzID0gJC5leHRlbmQoe30sIENvZ25pdG8ucmVzb3VyY2VzKTtcclxuXHJcblx0Q29nbml0by5fYWZ0ZXJSZWFkeUV2ZW50cyA9IFtdO1xyXG5cdENvZ25pdG8uX2RvbVJlYWR5RXZlbnRzID0gW107XHJcblxyXG5cdC8qKlxyXG5cdCAqIFByZXZlbnQgVnVlIGZyb20gbWFraW5nIGFuIG9iamVjdCBvYnNlcnZhYmxlLlxyXG5cdCAqIEFkYXB0ZWQgZnJvbSBWdWVNb2RlbCAtICBodHRwczovL2dpdGh1Yi5jb20vY29nbml0b2Zvcm1zL1Z1ZU1vZGVsL2Jsb2IvbWFzdGVyL3NyYy92dWUtbW9kZWwtb2JzZXJ2YWJpbGl0eS50c1xyXG5cdCAqL1xyXG5cdGZ1bmN0aW9uIHByZXZlbnRWdWVPYnNlcnZhYmlsaXR5KG9iaikge1xyXG5cdFx0aWYgKG9iaiAmJiAhb2JqLmhhc093blByb3BlcnR5KFwiX19vYl9fXCIpKSB7XHJcblx0XHRcdC8vIE1hcmsgdGhlIG9iamVjdCBhcyBcInJhd1wiIHNvIHRoYXQgVnVlIHdvbid0IHRyeSB0byBtYWtlIGl0IG9ic2VydmFibGVcclxuXHRcdFx0VnVlLm1hcmtSYXcob2JqKTtcclxuXHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvLyBJbml0aWFsaXplIEV4b1dlYlxyXG5cdCRleG93ZWIoe1xyXG5cdFx0aW5pdDogZnVuY3Rpb24gKCkge1xyXG5cdFx0XHR2YXIgY3VycmVudFVzZXJUeXBlID0gY29udGV4dC5tb2RlbC5tZXRhLmFkZFR5cGUoXCJDb2duaXRvLkN1cnJlbnRVc2VyVHlwZVwiKTtcclxuXHRcdFx0aWYgKHdpbmRvdy5WdWUpIHtcclxuXHRcdFx0XHRwcmV2ZW50VnVlT2JzZXJ2YWJpbGl0eShjb250ZXh0KTtcclxuXHRcdFx0XHRwcmV2ZW50VnVlT2JzZXJ2YWJpbGl0eShjb250ZXh0Lm1vZGVsKTtcclxuXHRcdFx0XHRwcmV2ZW50VnVlT2JzZXJ2YWJpbGl0eShjb250ZXh0Lm1vZGVsLm1ldGEpO1xyXG5cdFx0XHRcdGNvbnRleHQubW9kZWwubWV0YS5hZGRPYmplY3RSZWdpc3RlcmVkKGZ1bmN0aW9uIChvYmopIHtcclxuXHRcdFx0XHRcdHByZXZlbnRWdWVPYnNlcnZhYmlsaXR5KG9iaik7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHRcdFx0Y3VycmVudFVzZXJUeXBlXHJcblx0XHRcdFx0LmFkZFByb3BlcnR5KHtcclxuXHRcdFx0XHRcdG5hbWU6IFwiSWRcIixcclxuXHRcdFx0XHRcdHR5cGU6IFN0cmluZ1xyXG5cdFx0XHRcdH0pO1xyXG5cclxuXHRcdFx0Y3VycmVudFVzZXJUeXBlXHJcblx0XHRcdFx0LmFkZFByb3BlcnR5KHtcclxuXHRcdFx0XHRcdG5hbWU6IFwiRnVsbE5hbWVcIixcclxuXHRcdFx0XHRcdHR5cGU6IFN0cmluZ1xyXG5cdFx0XHRcdH0pO1xyXG5cclxuXHRcdFx0Y3VycmVudFVzZXJUeXBlXHJcblx0XHRcdFx0LmFkZFByb3BlcnR5KHtcclxuXHRcdFx0XHRcdG5hbWU6IFwiRW1haWxBZGRyZXNzXCIsXHJcblx0XHRcdFx0XHR0eXBlOiBTdHJpbmdcclxuXHRcdFx0XHR9KTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Y29udGV4dFJlYWR5OiBmdW5jdGlvbiAoKSB7IENvZ25pdG8ucmVhZHkoXCJFeG9XZWIuY29udGV4dFwiKTsgfSxcclxuXHJcblx0XHRkb21SZWFkeTogZnVuY3Rpb24gKCkge1xyXG5cdFx0XHR0cnkge1xyXG5cdFx0XHRcdC8vIERldGVybWluZSBpZiB0aGUgcGFnZSBpcyBob3N0ZWQgaW4gYW4gaWZyYW1lIGRpYWxvZy5cclxuXHRcdFx0XHR2YXIgZnJhbWUgPSB3aW5kb3cuZnJhbWVFbGVtZW50O1xyXG5cdFx0XHRcdGlmIChmcmFtZSAmJiAkKGZyYW1lLnBhcmVudEVsZW1lbnQpLmlzKFwiLmMtbW9kYWwtY29udGVudC1jb250YWluZXJcIikpIHtcclxuXHRcdFx0XHRcdC8vIElmIHRoZSBmcmFtZSB3YXMgbG9hZGVkIHdpdGggYSBVUkwsIGJ1dCB0aGUgc3JjIGlzIGVtcHR5LCB0aGVuIGFzc3VtZVxyXG5cdFx0XHRcdFx0Ly8gdGhhdCB0aGUgZGlhbG9nIGFuZCBpZnJhbWUgYXJlIGJlaW5nIGRpc3Bvc2VkIGFuZCBkb24ndCByYWlzZSBldmVudHMuXHJcblx0XHRcdFx0XHRpZiAoZnJhbWUuY29udGVudFdpbmRvdy5sb2NhdGlvbi5ocmVmICYmIGZyYW1lLmhhc0F0dHJpYnV0ZShcInNyY1wiKSAmJiAhZnJhbWUuZ2V0QXR0cmlidXRlKFwic3JjXCIpKSB7XHJcblx0XHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH0gY2F0Y2ggKGUpIHtcclxuXHRcdFx0XHQvLyBJZ25vcmUgcG90ZW50aWFsIGNyb3NzLWRvbWFpbiBlcnJvcnMgd2hlbiBhdHRlbXB0aW5nIHRvIGFjY2VzcyB0aGUgZnJhbWUgZWxlbWVudC4uLlxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBTZXQgdmlld3BvcnRcclxuXHRcdFx0Q29nbml0by52aWV3cG9ydCA9ICQoJChcIi5jb2duaXRvXCIpWzBdKTtcclxuXHJcblx0XHRcdC8vIEJyb3dzZXIgZGV0ZWN0aW9uXHJcblx0XHRcdGlmIChTeXMuQnJvd3Nlci5hZ2VudCA9PSBTeXMuQnJvd3Nlci5GaXJlZm94KSB7XHJcblx0XHRcdFx0JChcIi5jb2duaXRvOmZpcnN0XCIpLmFkZENsYXNzKFwiYy1maXJlZm94XCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKFN5cy5Ccm93c2VyLmFnZW50ID09IFN5cy5Ccm93c2VyLlNhZmFyaSkge1xyXG5cdFx0XHRcdCQoXCIuY29nbml0bzpmaXJzdFwiKS5hZGRDbGFzcyhcImMtc2FmYXJpXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKFN5cy5Ccm93c2VyLmFnZW50ID09IFN5cy5Ccm93c2VyLk9wZXJhKSB7XHJcblx0XHRcdFx0JChcIi5jb2duaXRvOmZpcnN0XCIpLmFkZENsYXNzKFwiYy1vcGVyYVwiKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gRmlyZSBhbnkgcmVtYWluaW5nIGV2ZW50c1xyXG5cdFx0XHRDb2duaXRvLnJlYWR5KFwiRXhvV2ViLmRvbVwiKTtcclxuXHJcblx0XHRcdC8vIEFmdGVyIHJlYWR5XHJcblx0XHRcdENvZ25pdG8udGltZXJzLmFmdGVyUmVhZHkgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0Q29nbml0by5oZWFydGJlYXQoKTtcclxuXHJcblx0XHRcdFx0JC5lYWNoKENvZ25pdG8uX2FmdGVyUmVhZHlFdmVudHMsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdHRoaXMuY2FsbCh3aW5kb3csIEV4b0pRdWVyeSk7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH0sIDApO1xyXG5cclxuXHRcdFx0Q29nbml0by5jb25maWcuaXNSZWFkeSA9IHRydWU7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vIFN0YXJ0IGhlYXJ0YmVhdFxyXG5cdGZ1bmN0aW9uIGhlYXJ0YmVhdCgpIHtcclxuXHRcdCQuZXZlbnQudHJpZ2dlcih7XHJcblx0XHRcdHR5cGU6IFwiaGVhcnRiZWF0LmNvZ25pdG9cIlxyXG5cdFx0fSk7XHJcblx0XHR3aW5kb3cuc2V0VGltZW91dChoZWFydGJlYXQsIDYwMDAwKTtcclxuXHR9XHJcblx0Q29nbml0by5oZWFydGJlYXQgPSBoZWFydGJlYXQ7XHJcblxyXG5cdC8vIGNyZWF0ZSBvbiBtZXRob2RcclxuXHRmdW5jdGlvbiBvbihldnROYW1lLCBjYWxsYmFjaykge1xyXG5cdFx0JChkb2N1bWVudCkub24oZXZ0TmFtZSwgY2FsbGJhY2spO1xyXG5cdH1cclxuXHRDb2duaXRvLm9uID0gb247XHJcblxyXG5cdC8vIGNyZWF0ZSBmaXJlIG1ldGhvZFxyXG5cdGZ1bmN0aW9uIGZpcmUoLyogW2V2ZW50LF0gb3B0aW9ucyAqLykge1xyXG5cdFx0dmFyIGV2ZW50O1xyXG5cdFx0dmFyIG9wdGlvbnM7XHJcblxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHtcclxuXHRcdFx0ZXZlbnQgPSBhcmd1bWVudHNbMF07XHJcblx0XHRcdG9wdGlvbnMgPSBhcmd1bWVudHNbMV07XHJcblx0XHR9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcclxuXHRcdFx0aWYgKHR5cGVvZiAoYXJndW1lbnRzWzBdKSA9PT0gXCJzdHJpbmdcIikge1xyXG5cdFx0XHRcdGV2ZW50ID0gYXJndW1lbnRzWzBdO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdG9wdGlvbnMgPSBhcmd1bWVudHNbMF07XHJcblx0XHRcdFx0ZXZlbnQgPSBvcHRpb25zLmV2ZW50O1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIHBheWxvYWQgPSB7fTtcclxuXHJcblx0XHRpZiAob3B0aW9ucyAmJiBvcHRpb25zLmRhdGEpIHtcclxuXHRcdFx0cGF5bG9hZCA9IG9wdGlvbnMuZGF0YTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoZXZlbnQpIHtcclxuXHRcdFx0dmFyIGpxRXZlbnQgPSAkLkV2ZW50KGV2ZW50KTtcclxuICAgICAgICAgICAgJChkb2N1bWVudCkudHJpZ2dlcihqcUV2ZW50LCBbcGF5bG9hZF0pO1xyXG5cclxuICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgYW5vdGhlciBjb3B5IG9mIGpxdWVyeSBsb2FkZWQsIHJhaXNlIHRoZSBldmVudCBvbiBpdCBhcyB3ZWxsXHJcbiAgICAgICAgICAgIGlmICh3aW5kb3cualF1ZXJ5ICYmICQgIT09IHdpbmRvdy5qUXVlcnkpIHtcclxuICAgICAgICAgICAgICAgIHZhciBvdGhlckV2ZW50ID0gbmV3IHdpbmRvdy5qUXVlcnkuRXZlbnQoZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgd2luZG93LmpRdWVyeShkb2N1bWVudCkudHJpZ2dlcihvdGhlckV2ZW50LCBbcGF5bG9hZF0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cdFx0XHRyZXR1cm4ganFFdmVudDtcclxuXHRcdH1cclxuXHR9XHJcblx0Q29nbml0by5maXJlID0gZmlyZTtcclxuXHJcblx0ZnVuY3Rpb24gZ2V0U2NyaXB0KHVybCkge1xyXG5cdFx0dmFyIGhlYWQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImhlYWRcIilbMF0gfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xyXG5cdFx0dmFyIHNjcmlwdE5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO1xyXG5cdFx0c2NyaXB0Tm9kZS50eXBlID0gXCJ0ZXh0L2phdmFzY3JpcHRcIjtcclxuXHRcdHNjcmlwdE5vZGUuYXN5bmMgPSBmYWxzZTtcclxuXHRcdHNjcmlwdE5vZGUuZGVmZXIgPSBmYWxzZTtcclxuXHJcblx0XHRoZWFkLmluc2VydEJlZm9yZShzY3JpcHROb2RlLCBoZWFkLmZpcnN0Q2hpbGQpO1xyXG5cclxuXHRcdHNjcmlwdE5vZGUuc3JjID0gdXJsO1xyXG5cdH1cclxuXHRDb2duaXRvLmdldFNjcmlwdCA9IGdldFNjcmlwdDtcclxuXHJcblxyXG5cdGZ1bmN0aW9uIGRlbGV0ZUNvb2tpZShuYW1lKSB7XHJcblx0XHRkb2N1bWVudC5jb29raWUgPSBuYW1lICsgXCI9ZGVsZXRlZDsgZXhwaXJlcz1cIiArIG5ldyBEYXRlKDApLnRvVVRDU3RyaW5nKCk7XHJcblx0fVxyXG5cclxuXHQvLyBHZXRzIHRoZSBjdXJyZW50IHRpbWUgYWRqdXN0aW5nIGZvciB0aGUgc2VydmVyIHRpbWUgb2Zmc2V0XHJcblx0ZnVuY3Rpb24gbm93KCkge1xyXG5cdFx0cmV0dXJuIGNvbmZpZy5zZXJ2ZXJUaW1lT2Zmc2V0ID8gbmV3IERhdGUobmV3IERhdGUoKS5nZXRUaW1lKCkgKyBjb25maWcuc2VydmVyVGltZU9mZnNldCkgOiBuZXcgRGF0ZSgpO1xyXG5cdH1cclxuXHRDb2duaXRvLm5vdyA9IG5vdztcclxuXHJcblx0Ly8gR2V0cyB0aGUgY3VycmVudCBkYXRlIGFkanVzdGluZyBmb3IgdGhlIHNlcnZlciB0aW1lIG9mZnNldCBhbmQgdGhlIGZvcm0gdGltZXpvbmUgb2Zmc2V0XHJcblx0ZnVuY3Rpb24gdG9kYXkob2Zmc2V0KSB7XHJcblx0XHR2YXIgY29ycmVjdERhdGUgPSBub3coKTtcclxuXHRcdHJldHVybiBuZXcgRGF0ZShuZXcgRGF0ZShjb3JyZWN0RGF0ZS5nZXRGdWxsWWVhcigpLCBjb3JyZWN0RGF0ZS5nZXRNb250aCgpLCBjb3JyZWN0RGF0ZS5nZXREYXRlKCksIDAsIGNvcnJlY3REYXRlLmdldEhvdXJzKCkgKiA2MCArIGNvcnJlY3REYXRlLmdldE1pbnV0ZXMoKSArIG9mZnNldCArIGNvcnJlY3REYXRlLmdldFRpbWV6b25lT2Zmc2V0KCkpLnNldEhvdXJzKDAsIDAsIDAsIDApKTtcclxuXHR9XHJcblx0Q29nbml0by50b2RheSA9IHRvZGF5O1xyXG5cclxuXHRmdW5jdGlvbiBzZXJ2ZXJOb3coKSB7XHJcblx0XHRyZXR1cm4gbmV3IERhdGUoY29uZmlnLnNlcnZlclRpbWVPZmZzZXQpO1xyXG5cdH1cclxuXHRDb2duaXRvLnNlcnZlck5vdyA9IHNlcnZlck5vdztcclxuXHJcblx0Ly8gUmVhZHkgLSBoYW5kbGVzIHRyYWNraW5nIG9mIG9uZSB0aW1lIGRlcGVuZGVuY2llcyB0byBzeW5jaHJvbml6ZSBjb2RlIGV4ZWN1dGlvblxyXG5cdHZhciByZWFkeURlcGVuZGVuY2llcyA9IENvZ25pdG8ucmVhZHlEZXBlbmRlbmNpZXMgfHwge307XHJcblx0Q29nbml0by5yZWFkeURlcGVuZGVuY2llcyA9IHJlYWR5RGVwZW5kZW5jaWVzO1xyXG5cdGZ1bmN0aW9uIHJlYWR5KC8qIG5hbWUsIFtbLCBkZXBlbmRlbmNpZXNdLCBhY3Rpb25dICovKSB7XHJcblxyXG5cdFx0Ly8gSW52b2tlIHRoZSBkZXBlbmRlbnQgYWN0aW9uIGlmIGRlcGVuZGVuY2llcyBhcmUgYWxsIGF2YWlsYWJsZVxyXG5cdFx0dmFyIGludm9rZURlcGVuZGVudCA9IGZ1bmN0aW9uIChkZXBlbmRlbnQpIHtcclxuXHRcdFx0aWYgKCFkZXBlbmRlbnQuYWN0aW9uKVxyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0Zm9yICh2YXIgZCA9IDA7IGQgPCBkZXBlbmRlbnQuZGVwZW5kZW5jaWVzLmxlbmd0aDsgZCsrKSB7XHJcblx0XHRcdFx0dmFyIGRlcGVuZGVuY3kgPSByZWFkeURlcGVuZGVuY2llc1tkZXBlbmRlbnQuZGVwZW5kZW5jaWVzW2RdXTtcclxuXHRcdFx0XHRpZiAoIShkZXBlbmRlbmN5ID09IHRydWUpKVxyXG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHRcdC8vY29uc29sZS5sb2coXCIlY0ludm9raW5nOiBcIiArIGRlcGVuZGVudC5uYW1lICsgKGRlcGVuZGVudC5uYW1lID09IFwiVW5rbm93blwiID8gXCIgKFwiICsgZGVwZW5kZW50LmFjdGlvbi50b1N0cmluZygpLnN1YnN0cmluZygwLCA1MCkucmVwbGFjZSgvW15hLXpBLVowLTlcXChcXHtcXClcXH1dL2dpLCAnJykgKyBcIilcIiA6IFwiXCIpLCAoZGVwZW5kZW50Lm5hbWUuaW5kZXhPZignYWN0aXZhdGUnKSA+IC0xID8gJ2NvbG9yOiByZWQ7JyA6ICdjb2xvcjogYmx1ZTsnKSk7XHJcblx0XHRcdHRyeSB7XHJcblx0XHRcdFx0ZGVwZW5kZW50LmFjdGlvbihFeG9KUXVlcnkpO1xyXG5cdFx0XHRcdGRlcGVuZGVudC5hY3Rpb24gPSBudWxsO1xyXG5cdFx0XHRcdHJlYWR5KGRlcGVuZGVudC5uYW1lKTtcclxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0fSBjYXRjaCAoZSkge1xyXG5cdFx0XHRcdGNvbnNvbGUuZXJyb3IoZSk7XHJcblxyXG5cdFx0XHRcdGlmICh3aW5kb3cuYXBwSW5zaWdodHMpIHtcclxuXHRcdFx0XHRcdGFwcEluc2lnaHRzLnRyYWNrRXhjZXB0aW9uKGUsIFwiQ29nbml0by5yZWFkeVwiLCB7IHJlYWR5QWN0aW9uTmFtZTogZGVwZW5kZW50Lm5hbWUgfSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRyZWFkeURlcGVuZGVuY2llc1tkZXBlbmRlbnQubmFtZV0gPSBmYWxzZTtcclxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHQvLyBEZXBlbmRlbmN5XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSB7XHJcblx0XHRcdHZhciBkZXBlbmRlbnRzID0gcmVhZHlEZXBlbmRlbmNpZXNbYXJndW1lbnRzWzBdXTtcclxuXHRcdFx0cmVhZHlEZXBlbmRlbmNpZXNbYXJndW1lbnRzWzBdXSA9IHRydWU7XHJcblx0XHRcdC8vY29uc29sZS5sb2coXCIlY1JhaXNpbmc6IFwiICsgYXJndW1lbnRzWzBdLCBcImNvbG9yOiBncmVlbjtcIik7XHJcblx0XHRcdGlmIChkZXBlbmRlbnRzKSB7XHJcblx0XHRcdFx0Zm9yICh2YXIgZCA9IDA7IGQgPCBkZXBlbmRlbnRzLmxlbmd0aDsgZCsrKSB7XHJcblx0XHRcdFx0XHRpZiAocmVhZHlEZXBlbmRlbmNpZXNbZGVwZW5kZW50c1tkXV0gIT09IGZhbHNlKSB7XHJcblx0XHRcdFx0XHRcdGludm9rZURlcGVuZGVudChkZXBlbmRlbnRzW2RdKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRcdC8vIERlcGVuZGVudFxyXG5cdFx0ZWxzZSB7XHJcblxyXG5cdFx0XHQvLyBDcmVhdGUgdGhlIGRlcGVuZGVudCB0cmFja2luZyBvYmplY3RcclxuXHRcdFx0dmFyIGRlcGVuZGVudCA9IHtcclxuXHRcdFx0XHRuYW1lOiBhcmd1bWVudHNbMF0sXHJcblx0XHRcdFx0ZGVwZW5kZW5jaWVzOiBhcmd1bWVudHMubGVuZ3RoID09IDMgPyAodHlwZW9mIChhcmd1bWVudHNbMV0pID09IFwic3RyaW5nXCIgPyBbYXJndW1lbnRzWzFdXSA6IGFyZ3VtZW50c1sxXSkgOiBbXSxcclxuXHRcdFx0XHRhY3Rpb246IGFyZ3VtZW50cy5sZW5ndGggPT0gMyA/IGFyZ3VtZW50c1syXSA6IGFyZ3VtZW50c1sxXVxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0Ly8gUmVnaXN0ZXIgdGhlIGRlcGVuZGVudCBpZiBpdCBjYW5ub3QgYmUgaW52b2tlZFxyXG5cdFx0XHRpZiAoIWludm9rZURlcGVuZGVudChkZXBlbmRlbnQpKSB7XHJcblx0XHRcdFx0Ly9jb25zb2xlLmxvZyhcIiVjUmVnaXN0ZXJpbmc6IFwiICsgZGVwZW5kZW50Lm5hbWUgKyAoZGVwZW5kZW50Lm5hbWUgPT0gXCJVbmtub3duXCIgPyBcIiAoXCIgKyBkZXBlbmRlbnQuYWN0aW9uLnRvU3RyaW5nKCkuc3Vic3RyaW5nKDAsIDUwKS5yZXBsYWNlKC9bXmEtekEtWjAtOVxcKFxce1xcKVxcfV0vZ2ksICcnKSArIFwiKVwiIDogXCJcIikgKyBcIiwgZGVwZW5kZW50IHVwb246IFwiICsgZGVwZW5kZW50LmRlcGVuZGVuY2llcy50b1N0cmluZygpLCBcImNvbG9yOiAjYWFhO1wiKTtcclxuXHRcdFx0XHRmb3IgKHZhciBkID0gMDsgZCA8IGRlcGVuZGVudC5kZXBlbmRlbmNpZXMubGVuZ3RoOyBkKyspIHtcclxuXHRcdFx0XHRcdHZhciBkZXBlbmRlbmN5ID0gcmVhZHlEZXBlbmRlbmNpZXNbZGVwZW5kZW50LmRlcGVuZGVuY2llc1tkXV07XHJcblx0XHRcdFx0XHRpZiAoIWRlcGVuZGVuY3kpXHJcblx0XHRcdFx0XHRcdHJlYWR5RGVwZW5kZW5jaWVzW2RlcGVuZGVudC5kZXBlbmRlbmNpZXNbZF1dID0gW2RlcGVuZGVudF07XHJcblx0XHRcdFx0XHRlbHNlIGlmIChkZXBlbmRlbmN5IGluc3RhbmNlb2YgQXJyYXkpXHJcblx0XHRcdFx0XHRcdGRlcGVuZGVuY3kucHVzaChkZXBlbmRlbnQpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHRDb2duaXRvLnJlYWR5ID0gcmVhZHk7XHJcblxyXG5cdGZ1bmN0aW9uIGRvbVJlYWR5KGFjdGlvbikge1xyXG5cdFx0aWYgKGFjdGlvbiBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcblx0XHRcdENvZ25pdG8ucmVhZHkoYWN0aW9uLm5hbWUgfHwgXCJVbmtub3duXCIsIFwiRXhvV2ViLmRvbVwiLCBhY3Rpb24pO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRDb2duaXRvLmRvbVJlYWR5ID0gZG9tUmVhZHk7XHJcblxyXG5cdGZ1bmN0aW9uIGFmdGVyRG9tUmVhZHkoLyogcmVhZHlGdW5jdGlvbiAqLykge1xyXG5cdFx0aWYgKGFyZ3VtZW50c1swXSBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcblx0XHRcdGlmICgkLmlzUmVhZHkpIHtcclxuXHRcdFx0XHRhcmd1bWVudHNbMF0uY2FsbCh3aW5kb3csIEV4b0pRdWVyeSk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0Q29nbml0by5fYWZ0ZXJSZWFkeUV2ZW50cy5wdXNoKGFyZ3VtZW50c1swXSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0Q29nbml0by5hZnRlckRvbVJlYWR5ID0gYWZ0ZXJEb21SZWFkeTtcclxuXHJcblx0ZnVuY3Rpb24gbW9kZWxSZWFkeSgvKiByZWFkeUZ1bmN0aW9uICovKSB7XHJcblx0XHRpZiAoYXJndW1lbnRzWzBdIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuXHRcdFx0JGV4b3dlYih7IGNvbnRleHRSZWFkeTogYXJndW1lbnRzWzBdIH0pO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRDb2duaXRvLm1vZGVsUmVhZHkgPSBtb2RlbFJlYWR5O1xyXG5cclxuXHR2YXIgcGVuZGluZ1JlcXVlc3RzID0ge307XHJcblxyXG5cdGZ1bmN0aW9uIGFib3J0UmVxdWVzdHMoZW5kcG9pbnQpIHtcclxuXHRcdC8vIE5lZWRlZCBmb3IgcmVtb3ZpbmcgYWxsIHJlcXVlc3RzIHdpdGggcmF6b3IgbWlncmF0aW9uXHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0XHRPYmplY3Qua2V5cyhwZW5kaW5nUmVxdWVzdHMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xyXG5cdFx0XHRcdGFib3J0UmVxdWVzdHMoa2V5KTtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dmFyIHJlcXVlc3RzID0gcGVuZGluZ1JlcXVlc3RzW2VuZHBvaW50XTtcclxuXHRcdFx0aWYgKHJlcXVlc3RzKSB7XHJcblx0XHRcdFx0cmVxdWVzdHMgPSByZXF1ZXN0cy5zbGljZSgpO1xyXG5cdFx0XHRcdHdoaWxlIChyZXF1ZXN0cy5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0XHR2YXIgcmVxT2JqID0gcmVxdWVzdHMucG9wKCk7XHJcblx0XHRcdFx0XHRyZXFPYmouX19hYm9ydCA9IHRydWU7XHJcblx0XHRcdFx0XHRyZXFPYmouYWJvcnQoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0Q29nbml0by5hYm9ydFJlcXVlc3RzID0gYWJvcnRSZXF1ZXN0cztcclxuXHJcblx0ZnVuY3Rpb24gc2VydmljZVJlcXVlc3Qob3B0aW9ucykge1xyXG5cdFx0b3B0aW9ucy5tb2R1bGUgPSBvcHRpb25zLm1vZHVsZSB8fCBcIlwiO1xyXG5cdFx0b3B0aW9ucy5tb2RlID0gb3B0aW9ucy5tb2RlIHx8IENvZ25pdG8uY29uZmlnLm1vZGU7XHJcblx0XHRvcHRpb25zLm1ldGhvZCA9IG9wdGlvbnMubWV0aG9kIHx8IFwiR0VUXCI7XHJcblx0XHRvcHRpb25zLmVuZHBvaW50ID0gb3B0aW9ucy5lbmRwb2ludCB8fCBcIlwiO1xyXG5cdFx0b3B0aW9ucy5kYXRhID0gb3B0aW9ucy5kYXRhIHx8IHt9O1xyXG5cdFx0b3B0aW9ucy5kYXRhVHlwZSA9IG9wdGlvbnMuZGF0YVR5cGUgfHwgXCJqc29uXCI7XHJcblx0XHRvcHRpb25zLnN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3MgfHwgZnVuY3Rpb24gKGRhdGEsIHRleHRTdGF0dXMsIGpxWEhSKSB7IH07XHJcblxyXG5cdFx0dmFyIGVycm9yT3B0aW9uID0gb3B0aW9ucy5lcnJvcjtcclxuXHRcdG9wdGlvbnMuZXJyb3IgPSBmdW5jdGlvbiAoanFYSFIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XHJcblx0XHRcdGlmIChqcVhIUiAmJiBqcVhIUi5fX2Fib3J0ID09PSB0cnVlKVxyXG5cdFx0XHRcdHJldHVybjtcclxuXHJcblx0XHRcdGlmIChlcnJvck9wdGlvbilcclxuXHRcdFx0XHRlcnJvck9wdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0XHRlbHNlIGlmICh3aW5kb3cuY29uc29sZSlcclxuXHRcdFx0XHRjb25zb2xlLmVycm9yKHRleHRTdGF0dXMpO1xyXG5cdFx0fTtcclxuXHRcdG9wdGlvbnMuY29tcGxldGUgPSBvcHRpb25zLmNvbXBsZXRlIHx8IGZ1bmN0aW9uIChqcVhIUiwgdGV4dFN0YXR1cykgeyB9O1xyXG5cdFx0b3B0aW9ucy5hc3luYyA9IHR5cGVvZiAob3B0aW9ucy5hc3luYykgPT09IFwidW5kZWZpbmVkXCIgPyB0cnVlIDogb3B0aW9ucy5hc3luYztcclxuXHRcdG9wdGlvbnMuY29udGVudFR5cGUgPSBvcHRpb25zLm92ZXJyaWRlQ29udGVudFR5cGUgPyBvcHRpb25zLmNvbnRlbnRUeXBlIDogb3B0aW9ucy5jb250ZW50VHlwZSB8fCBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLThcIjtcclxuXHRcdG9wdGlvbnMudXBsb2FkUHJvZ3Jlc3MgPSBvcHRpb25zLnVwbG9hZFByb2dyZXNzIHx8IG51bGw7XHJcblx0XHRvcHRpb25zLmNvbnRleHQgPSBvcHRpb25zLmNvbnRleHQgfHwgbnVsbDtcclxuXHRcdG9wdGlvbnMucGFzc2l2ZSA9IG9wdGlvbnMucGFzc2l2ZSB8fCBmYWxzZTtcclxuXHRcdG9wdGlvbnMudXNlU3VibWlzc2lvblRva2VuID0gb3B0aW9ucy51c2VTdWJtaXNzaW9uVG9rZW4gfHwgZmFsc2U7XHJcblxyXG5cdFx0aWYgKG9wdGlvbnMubWV0aG9kLnRvVXBwZXJDYXNlKCkgPT09IFwiR0VUXCIpXHJcblx0XHRcdG9wdGlvbnMuY29udGVudFR5cGUgPSBcInRleHQvcGxhaW5cIjtcclxuXHJcblx0XHQvLyBzZXJpYWxpemUgdGhlIG9iamVjdCBpZiBpdCBpcyBhIENvZ25pdG8gb2JqZWN0XHJcblx0XHRpZiAob3B0aW9ucy5kYXRhLm1ldGEpIHtcclxuXHRcdFx0b3B0aW9ucy5jb250ZW50VHlwZSA9IFwiYXBwbGljYXRpb24vanNvbitjb2duaXRvOyBjaGFyc2V0PXV0Zi04XCI7XHJcblx0XHRcdG9wdGlvbnMuZGF0YSA9IENvZ25pdG8uc2VyaWFsaXplKG9wdGlvbnMuZGF0YSk7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHR5cGVvZiAob3B0aW9ucy5kYXRhKSAhPT0gXCJzdHJpbmdcIiAmJiBvcHRpb25zLmNvbnRlbnRUeXBlICYmIG9wdGlvbnMuY29udGVudFR5cGUuaW5kZXhPZihcImFwcGxpY2F0aW9uL2pzb25cIikgPT09IDApIHtcclxuXHRcdFx0b3B0aW9ucy5kYXRhID0gSlNPTi5zdHJpbmdpZnkob3B0aW9ucy5kYXRhKTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBDb2VyY2UgYXJyYXlzIGludG8gZGlzdGluY3QgcGFyYW1ldGVyIHZhbHVlc1xyXG5cdFx0dmFyIGRhdGEgPSBvcHRpb25zLmRhdGE7XHJcblx0XHRpZiAodHlwZW9mIChvcHRpb25zLmRhdGEpICE9PSBcInN0cmluZ1wiKSB7XHJcblx0XHRcdGZvciAodmFyIGtleSBpbiBkYXRhKSB7XHJcblx0XHRcdFx0aWYgKGRhdGEuaGFzT3duUHJvcGVydHkoa2V5KSAmJiBkYXRhW2tleV0gaW5zdGFuY2VvZiBBcnJheSkge1xyXG5cdFx0XHRcdFx0dmFyIGFyciA9IGRhdGFba2V5XTtcclxuXHRcdFx0XHRcdGRlbGV0ZSBkYXRhW2tleV07XHJcblx0XHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdFx0XHRkYXRhW2tleSArIFwiW1wiICsgaSArIFwiXVwiXSA9IGFycltpXSBpbnN0YW5jZW9mIE9iamVjdCA/IEpTT04uc3RyaW5naWZ5KGFycltpXSkgOiBhcnJbaV07XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKG9wdGlvbnMuZW5kcG9pbnQgPT09IFwiXCIpIHtcclxuXHRcdFx0aWYgKHdpbmRvdy5jb25zb2xlKSB7XHJcblx0XHRcdFx0Y29uc29sZS5lcnJvcihcImVuZHBvaW50IGlzIHJlcXVpcmVkXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBJZiB0aGUgYnJvd3NlciBpcyBJRSwgYXBwZW5kIHRva2VuIHRvIHJlcXVlc3RzXHJcblx0XHRpZiAoJC5icm93c2VyLm1zaWUgJiYgcGFyc2VJbnQoJC5icm93c2VyLnZlcnNpb24sIDEwKSA8IDEwKSB7XHJcblx0XHRcdGlmIChvcHRpb25zLmVuZHBvaW50LmluZGV4T2YoXCI/XCIpID09IC0xKSB7XHJcblx0XHRcdFx0b3B0aW9ucy5lbmRwb2ludCArPSBcIj9cIjtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRvcHRpb25zLmVuZHBvaW50ICs9IFwiJlwiO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRvcHRpb25zLmVuZHBvaW50ICs9IFwibWUxPVwiICsgb3B0aW9ucy5tZXRob2Q7XHJcblx0XHRcdG9wdGlvbnMuZW5kcG9pbnQgKz0gXCImY3QxPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KG9wdGlvbnMuY29udGVudFR5cGUpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCQoJyNnLXJlY2FwdGNoYS1yZXNwb25zZScpWzBdKVxyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5lbmRwb2ludCArPSBcIiZ4cmVjMT1cIiArIGVuY29kZVVSSUNvbXBvbmVudChncmVjYXB0Y2hhLmdldFJlc3BvbnNlKCkpO1xyXG5cdFx0XHRlbHNlIGlmICgkKCcjYy1ub2JvdHMnKVswXSlcclxuXHRcdFx0XHRvcHRpb25zLmVuZHBvaW50ICs9IFwiJnhub2JvdHMxPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KCQoJyNjLW5vYm90cycpLnZhbCgpKTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBQYXNzIHRocm91Z2ggdGhlIHRlc3QgaWQgdG8gc3VwcG9ydCBVSSB1bml0IHRlc3RpbmdcclxuXHRcdHRyeSB7XHJcblx0XHRcdGlmIChkb2N1bWVudC5jb29raWUuaW5kZXhPZihcIlRlc3RJZD1cIikgPj0gMCkge1xyXG5cdFx0XHRcdGlmIChvcHRpb25zLmVuZHBvaW50LmluZGV4T2YoXCI/XCIpID09IC0xKSB7XHJcblx0XHRcdFx0XHRvcHRpb25zLmVuZHBvaW50ICs9IFwiP1wiO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdG9wdGlvbnMuZW5kcG9pbnQgKz0gXCImXCI7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdG9wdGlvbnMuZW5kcG9pbnQgKz0gXCJUZXN0SWQ9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoZG9jdW1lbnQuY29va2llLnN1YnN0cihkb2N1bWVudC5jb29raWUuaW5kZXhPZihcIlRlc3RJZD1cIikgKyA3LCAzNikpO1xyXG5cdFx0XHR9XHJcblx0XHR9IGNhdGNoIChlKSB7IH1cclxuXHJcblx0XHR2YXIgaGVhZGVycyA9IHtcclxuXHRcdFx0XCJYLVJlcXVlc3RlZC1XaXRoXCI6IFwiWE1MSHR0cFJlcXVlc3RcIlxyXG5cdFx0fTtcclxuXHJcblx0XHRpZiAoQ29nbml0by5jb25maWcub2lkKSB7XHJcblx0XHRcdGhlYWRlcnNbXCJYLU9yZ2FuaXphdGlvblwiXSA9IENvZ25pdG8uY29uZmlnLm9pZDtcclxuXHRcdH1cclxuXHJcbiAgICAgICAgaWYgKG9wdGlvbnMucGFzc2l2ZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICBoZWFkZXJzW1wiWC1QYXNzaXZlLVJlcXVlc3RcIl0gPSAxO1xyXG4gICAgICAgIH1cclxuXHJcblx0XHRpZiAoJC5pbkFycmF5KG9wdGlvbnMubWV0aG9kLnRvVXBwZXJDYXNlKCksIFtcIkdFVFwiLCBcIlBPU1RcIl0pID09PSAtMSkge1xyXG5cdFx0XHRoZWFkZXJzW1wiWC1IVFRQLU1ldGhvZC1PdmVycmlkZVwiXSA9IG9wdGlvbnMubWV0aG9kO1xyXG5cdFx0XHRvcHRpb25zLm1ldGhvZCA9IFwiUE9TVFwiO1xyXG5cdFx0fVxyXG5cdFx0Ly9yZWNhcHRjaGEgYm94IHNob3dpbmdcclxuXHRcdGlmICgkKCcjZy1yZWNhcHRjaGEtcmVzcG9uc2UnKVswXSlcclxuXHRcdFx0aGVhZGVyc1tcIlgtUmVjYXB0Y2hhXCJdID0gZ3JlY2FwdGNoYS5nZXRSZXNwb25zZSgpO1xyXG5cclxuICAgICAgICAvL2RvbSBldmVudCByYWlzZWQsIHVzZXIgbm90IGEgYm90XHJcblx0XHRlbHNlIGlmICgkKCcjYy1ub2JvdHMnKVswXSlcclxuXHRcdFx0aGVhZGVyc1tcIlgtTm9Cb3RzXCJdID0gJCgnI2Mtbm9ib3RzJykudmFsKCk7XHJcblxyXG5cdFx0Ly8gd29ya2Fyb3VuZCBiZWNhdXNlIGpxWEhSIGRvZXMgbm90IGV4cG9zZSB1cGxvYWQgcHJvcGVydHlcclxuXHRcdGlmIChvcHRpb25zLnVwbG9hZFByb2dyZXNzKSB7XHJcblx0XHRcdG9wdGlvbnMueGhyID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdHZhciB4aHIgPSAkLmFqYXhTZXR0aW5ncy54aHIoKTtcclxuXHRcdFx0XHRpZiAoeGhyLnVwbG9hZCkge1xyXG5cdFx0XHRcdFx0eGhyLnVwbG9hZC5vbnByb2dyZXNzID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcblx0XHRcdFx0XHRcdHZhciBwZXJjZW50ID0gMDtcclxuXHRcdFx0XHRcdFx0dmFyIHBvc2l0aW9uID0gZXZlbnQubG9hZGVkIHx8IGV2ZW50LnBvc2l0aW9uOyAvKmV2ZW50LnBvc2l0aW9uIGlzIGRlcHJlY2F0ZWQqL1xyXG5cdFx0XHRcdFx0XHR2YXIgdG90YWwgPSBldmVudC50b3RhbDtcclxuXHRcdFx0XHRcdFx0aWYgKGV2ZW50Lmxlbmd0aENvbXB1dGFibGUpIHtcclxuXHRcdFx0XHRcdFx0XHRwZXJjZW50ID0gTWF0aC5jZWlsKHBvc2l0aW9uIC8gdG90YWwgKiAxMDApO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdG9wdGlvbnMudXBsb2FkUHJvZ3Jlc3MoZXZlbnQsIHBvc2l0aW9uLCB0b3RhbCwgcGVyY2VudCk7XHJcblx0XHRcdFx0XHR9O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRyZXR1cm4geGhyO1xyXG5cdFx0XHR9O1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciB1cmwgPSBDb2duaXRvLmNvbmZpZy5iYXNlVXJsO1xyXG5cdFx0aWYgKG9wdGlvbnMubW9kdWxlLmxlbmd0aCAhPT0gMCkge1xyXG5cdFx0XHR1cmwgKz0gb3B0aW9ucy5tb2R1bGUgKyBcIi9cIiArIG9wdGlvbnMubW9kZSArIFwiL1wiO1xyXG5cdFx0fVxyXG5cclxuXHRcdHVybCArPSBvcHRpb25zLmVuZHBvaW50O1xyXG5cclxuXHRcdC8vIFJhaXNlIHNlcnZpY2UgcmVxdWVzdCBldmVudFxyXG5cdFx0JC5ldmVudC50cmlnZ2VyKHtcclxuXHRcdFx0dHlwZTogXCJjb2duaXRvLnNlcnZpY2VSZXF1ZXN0XCJcclxuXHRcdH0pO1xyXG5cclxuXHRcdGZ1bmN0aW9uIHNlbmRSZXF1ZXN0KCkge1xyXG5cdFx0XHQvLyBUcmFjayBwZW5kaW5nIHJlcXVlc3RzIHRvIHRoZSBzcGVjaWZpZWQgZW5kcG9pbnRcclxuXHRcdFx0dmFyIHJlcXVlc3RzID0gcGVuZGluZ1JlcXVlc3RzW29wdGlvbnMuZW5kcG9pbnRdO1xyXG5cdFx0XHRpZiAocmVxdWVzdHMgPT09IHVuZGVmaW5lZClcclxuXHRcdFx0XHRwZW5kaW5nUmVxdWVzdHNbb3B0aW9ucy5lbmRwb2ludF0gPSByZXF1ZXN0cyA9IFtdO1xyXG5cclxuXHRcdFx0dmFyIGpxWEhSID0gJC5hamF4KHtcclxuXHRcdFx0XHRjb250ZW50VHlwZTogb3B0aW9ucy5jb250ZW50VHlwZSxcclxuXHRcdFx0XHR0eXBlOiBvcHRpb25zLm1ldGhvZCxcclxuXHRcdFx0XHR1cmw6IHVybCxcclxuXHRcdFx0XHRkYXRhVHlwZTogb3B0aW9ucy5kYXRhVHlwZSxcclxuXHRcdFx0XHRhc3luYzogb3B0aW9ucy5hc3luYyxcclxuXHRcdFx0XHRkYXRhOiBvcHRpb25zLmRhdGEsXHJcblx0XHRcdFx0c3VjY2VzczogZnVuY3Rpb24gKGRhdGEsIHRleHRTdGF0dXMsIGpxWEhSKSB7XHJcblxyXG5cdFx0XHRcdFx0Ly8gUmVtb3ZlIHRoZSBwZW5kaW5nIHJlcXVlc3RcclxuXHRcdFx0XHRcdHZhciBpbmRleCA9IHJlcXVlc3RzLmluZGV4T2YoanFYSFIpO1xyXG5cdFx0XHRcdFx0aWYgKGluZGV4ID49IDApXHJcblx0XHRcdFx0XHRcdHJlcXVlc3RzLnNwbGljZShpbmRleCwgMSk7XHJcblxyXG5cdFx0XHRcdFx0dmFyIHRva2VuID0ganFYSFIuZ2V0UmVzcG9uc2VIZWFkZXIoXCJYLVNlc3Npb25Ub2tlblwiKTtcclxuXHJcblx0XHRcdFx0XHQvLyBEZXRlcm1pbmUgdGhlIHNlcnZlciB0aW1lIG9mZnNldCByZWxhdGl2ZSB0byB0aGUgY2xpZW50IHRpbWUgZHVyaW5nIHBvc3RzXHJcblx0XHRcdFx0XHR0cnkge1xyXG5cdFx0XHRcdFx0XHR2YXIgc2VydmVyVGltZUhlYWRlciA9IGpxWEhSLmdldFJlc3BvbnNlSGVhZGVyKFwiWC1TZXJ2ZXItVGltZVwiKTtcclxuXHRcdFx0XHRcdFx0aWYgKHNlcnZlclRpbWVIZWFkZXIpIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgc2VydmVyVGltZSA9IG5ldyBEYXRlKHNlcnZlclRpbWVIZWFkZXIpO1xyXG5cdFx0XHRcdFx0XHRcdENvZ25pdG8uY29uZmlnLnNlcnZlclRpbWVPZmZzZXQgPSBzZXJ2ZXJUaW1lLmdldFRpbWUoKSAtIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRjYXRjaCAoZSkgeyB9XHJcblxyXG5cdFx0XHRcdFx0b3B0aW9ucy5zdWNjZXNzKGRhdGEsIHRleHRTdGF0dXMsIGpxWEhSKTtcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGVycm9yOiBmdW5jdGlvbiAoanFYSFIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XHJcblxyXG5cdFx0XHRcdFx0Ly8gUmVtb3ZlIHRoZSBwZW5kaW5nIHJlcXVlc3RcclxuXHRcdFx0XHRcdHZhciBpbmRleCA9IHJlcXVlc3RzLmluZGV4T2YoanFYSFIpO1xyXG5cdFx0XHRcdFx0aWYgKGluZGV4ID49IDApXHJcblx0XHRcdFx0XHRcdHJlcXVlc3RzLnNwbGljZShpbmRleCwgMSk7XHJcblxyXG5cdFx0XHRcdFx0Ly8gSWYgc2Vzc2lvbiB0aW1lZCBvdXQsIGFsbG93IHVzZXIgdG8gcmVsb2FkIHRoZSBwYWdlXHJcblx0XHRcdFx0XHRpZiAoanFYSFIuc3RhdHVzID09PSA0MTkpIHtcclxuXHRcdFx0XHRcdFx0aWYgKCQoXCIjYy1jb3JlLXRpbWVvdXRcIikubGVuZ3RoID09PSAwKSB7XHJcblx0XHRcdFx0XHRcdFx0Ly8gQ3JlYXRlIHRpbWVvdXQgdmlldyBpZiBpdCBkb2VzIG5vdCBjdXJyZW50bHkgZXhpc3RcclxuXHRcdFx0XHRcdFx0XHQkKFwiLmNvZ25pdG86Zmlyc3RcIikuYXBwZW5kKFwiPGRpdiBpZD0nYy1jb3JlLXRpbWVvdXQnPllvdXIgcmVxdWVzdCBoYXMgdGltZWQgb3V0LCBjbGljayA8YSBocmVmPSdqYXZhc2NyaXB0OiBkb2N1bWVudC5sb2NhdGlvbi5yZWxvYWQoKSc+aGVyZTwvYT4gdG8gcmVsb2FkPC9kaXY+XCIpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHQkKFwiLmNvZ25pdG9cIikuY2hpbGRyZW4oKS5oaWRlKCk7XHJcblx0XHRcdFx0XHRcdCQoXCIjYy1jb3JlLXRpbWVvdXRcIikuc2hvdygpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAoanFYSFIuc3RhdHVzID09PSA0MDAgJiYganFYSFIucmVzcG9uc2VUZXh0ID09PSAnY2FwdGNoYScpIHtcclxuXHRcdFx0XHRcdFx0aWYgKCEkKCcjZy1yZWNhcHRjaGEtcmVzcG9uc2UnKVswXSkge1xyXG5cdFx0XHRcdFx0XHRcdGdyZWNhcHRjaGEucmVuZGVyKFwiYy1yZWNhcHRjaGEtZGl2XCIsIHtcclxuXHRcdFx0XHRcdFx0XHRcdHRoZW1lOiBcImNsZWFuXCIsXHJcblx0XHRcdFx0XHRcdFx0XHRzaXRla2V5OiBDb2duaXRvLmNvbmZpZy5yZWNhcHRjaGFLZXlcclxuXHRcdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAoanFYSFIuc3RhdHVzID09PSA0MDEpIHtcclxuXHRcdFx0XHRcdFx0dmFyIHJldHVyblVybCA9IGVuY29kZVVSSUNvbXBvbmVudChsb2NhdGlvbi5ocmVmKTtcclxuXHRcdFx0XHRcdFx0bG9jYXRpb24uaHJlZiA9ICcvbG9naW4/bG9nb3V0UmVhc29uPVRva2VuVGltZW91dCZyZXR1cm5Vcmw9JyArIHJldHVyblVybDtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRpZiAob3B0aW9ucy5jb250ZXh0KVxyXG5cdFx0XHRcdFx0XHRvcHRpb25zLmVycm9yLmNhbGwodGhpcywganFYSFIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duLCBvcHRpb25zLmNvbnRleHQpO1xyXG5cdFx0XHRcdFx0ZWxzZVxyXG5cdFx0XHRcdFx0XHRvcHRpb25zLmVycm9yLmNhbGwodGhpcywganFYSFIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKTtcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGNvbXBsZXRlOiBvcHRpb25zLmNvbXBsZXRlLFxyXG5cdFx0XHRcdGJlZm9yZVNlbmQ6IG9wdGlvbnMuYmVmb3JlU2VuZCxcclxuXHRcdFx0XHRwcm9jZXNzRGF0YTogb3B0aW9ucy5wcm9jZXNzRGF0YSxcclxuXHRcdFx0XHRoZWFkZXJzOiBoZWFkZXJzLFxyXG5cdFx0XHRcdGNvbnRleHQ6ICFvcHRpb25zLmNvbnRleHQgPyB0aGlzIDogb3B0aW9ucy5jb250ZXh0LFxyXG5cdFx0XHRcdHhocjogb3B0aW9ucy54aHJcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHQvLyBBZGQgdGhlIHJlcXVlc3QgdG8gdGhlIGxpc3Qgb2YgcGVuZGluZyBlbmRwb2ludCByZXF1ZXN0c1xyXG5cdFx0XHRyZXF1ZXN0cy5wdXNoKGpxWEhSKTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAob3B0aW9ucy51c2VTdWJtaXNzaW9uVG9rZW4pIHtcclxuXHRcdFx0dmFyIHN1Ym1pc3Npb25Ub2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdTdWJtaXNzaW9uVG9rZW4nKTtcclxuXHRcdFx0dmFyIHNlZ21lbnRzID0gc3VibWlzc2lvblRva2VuICE9PSBudWxsID8gc3VibWlzc2lvblRva2VuLnNwbGl0KCd8JykgOiBudWxsO1xyXG5cclxuXHRcdFx0LyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVzL25vLW51bWJlci1wYXJzZWludCwgZXM1L25vLWVzNi1zdGF0aWMtbWV0aG9kcyAqL1xyXG5cdFx0XHRpZiAoIXN1Ym1pc3Npb25Ub2tlbiB8fCBuZXcgRGF0ZSgpLmdldFRpbWUoKSA+IE51bWJlci5wYXJzZUludChzZWdtZW50c1sxXSkgfHwgQ29nbml0by5jb25maWcub2lkICE9PSBzZWdtZW50c1syXSkge1xyXG5cdFx0XHRcdHNlcnZpY2VSZXF1ZXN0KHtcclxuXHRcdFx0XHRcdGVuZHBvaW50OiBcIi9zdmMvY3NyZlwiLFxyXG5cdFx0XHRcdFx0ZGF0YVR5cGU6IFwidGV4dFwiLFxyXG5cdFx0XHRcdFx0c3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcclxuXHRcdFx0XHRcdFx0aGVhZGVyc1snQ3NyZlRva2VuJ10gPSBkYXRhO1xyXG5cdFx0XHRcdFx0XHRsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnU3VibWlzc2lvblRva2VuJywgZGF0YSArICd8JyArIChuZXcgRGF0ZSgpLmdldFRpbWUoKSArIDYwICogNjAgKiAyMyAqIDEwMDApICsgJ3wnICsgQ29nbml0by5jb25maWcub2lkKTtcclxuXHRcdFx0XHRcdFx0c2VuZFJlcXVlc3QoKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRoZWFkZXJzWydDc3JmVG9rZW4nXSA9IHNlZ21lbnRzWzBdO1xyXG5cdFx0XHRcdHNlbmRSZXF1ZXN0KCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGVsc2VcclxuXHRcdFx0c2VuZFJlcXVlc3QoKTtcclxuXHR9XHJcblx0Q29nbml0by5zZXJ2aWNlUmVxdWVzdCA9IHNlcnZpY2VSZXF1ZXN0O1xyXG5cclxuXHRmdW5jdGlvbiBsb2FkQ29udGVudChjb250ZW50LCB0YXJnZXQsIGFjdGl2YXRlKSB7XHJcblx0XHR2YXIgc2hvdWxkQWN0aXZhdGUgPSB0eXBlb2YgKGFjdGl2YXRlKSA9PT0gXCJ1bmRlZmluZWRcIiA/IHRydWUgOiBhY3RpdmF0ZTtcclxuXHJcblx0XHR2YXIgdGFyZ2V0RWxlbWVudCA9ICQodGFyZ2V0KTtcclxuXHJcblx0XHRpZiAodGFyZ2V0RWxlbWVudC5sZW5ndGggPT0gMCkge1xyXG5cdFx0XHRDb2duaXRvLnJlYWR5KFwiY29nbml0by1sb2FkLWNvbnRlbnRcIiwgXCJFeG9XZWIuZG9tXCIsIGZ1bmN0aW9uICgkKSB7XHJcblx0XHRcdFx0JCh0YXJnZXQpLmFwcGVuZChjb250ZW50KTtcclxuXHRcdFx0fSk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0YXJnZXRFbGVtZW50LmFwcGVuZChjb250ZW50KTtcclxuXHRcdH1cclxuXHR9XHJcblx0Q29nbml0by5sb2FkQ29udGVudCA9IGxvYWRDb250ZW50O1xyXG5cclxuXHRmdW5jdGlvbiBsb2FkKG1vZHVsZSwgYXJncywgb3B0aW9ucykge1xyXG5cdFx0b3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcblx0XHRvcHRpb25zLm1vZGUgPSBvcHRpb25zLm1vZGUgfHwgXCJwdWJsaWNcIjtcclxuXHRcdG9wdGlvbnMudGFyZ2V0ID0gb3B0aW9ucy50YXJnZXQgfHwgXCJcIjtcclxuXHRcdG9wdGlvbnMudmlldyA9IG9wdGlvbnMudmlldyB8fCBcIlwiO1xyXG5cdFx0b3B0aW9ucy5zdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzIHx8IGZ1bmN0aW9uICgpIHsgfTtcclxuXHRcdG9wdGlvbnMuYXJncyA9IG9wdGlvbnMuYXJncyB8fCB7fTtcclxuXHJcblx0XHR2YXIgdXJsID0gbW9kdWxlICsgXCIvXCIgKyBvcHRpb25zLm1vZGU7XHJcblxyXG5cdFx0aWYgKG9wdGlvbnMudmlldyAhPT0gXCJcIikge1xyXG5cdFx0XHR1cmwgKz0gXCI/dmlldz1cIiArIG9wdGlvbnMudmlldztcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgY3VycmVudExvY2F0aW9uID0gbG9jYXRpb24uaHJlZjtcclxuXHRcdGlmIChsb2NhdGlvbi5oYXNoKSB7XHJcblx0XHRcdGN1cnJlbnRMb2NhdGlvbiA9IGxvY2F0aW9uLmhyZWYucmVwbGFjZShsb2NhdGlvbi5oYXNoLCBcIlwiKTtcclxuXHRcdFx0Y3VycmVudExvY2F0aW9uICs9IGRlY29kZVVSSUNvbXBvbmVudChsb2NhdGlvbi5oYXNoKTtcclxuXHRcdH1cclxuXHJcblx0XHRhcmdzW1wiZW1iZWRVcmxcIl0gPSBhcmdzW1wiZW1iZWRVcmxcIl0gfHwgY3VycmVudExvY2F0aW9uO1xyXG5cclxuXHRcdHZhciBuZXdBcmdzID0gXCJcIjtcclxuXHRcdGZvciAodmFyIHByb3BlcnR5IGluIGFyZ3MpIHtcclxuXHRcdFx0dmFyIGFyZyA9IGFyZ3NbcHJvcGVydHldO1xyXG5cdFx0XHRpZiAodHlwZW9mIGFyZyA9PSBcIm9iamVjdFwiKVxyXG5cdFx0XHRcdGFyZyA9IEpTT04uc3RyaW5naWZ5KGFyZyk7XHJcblxyXG5cdFx0XHRuZXdBcmdzICs9IHByb3BlcnR5ICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoYXJnKSArIFwiJlwiO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIEFkZCBxdWVyeSBzdHJpbmcgcGFyYW1ldGVycyBmcm9tIGNvbnRhaW5pbmcgcGFnZVxyXG5cdFx0bmV3QXJncyArPSBkb2N1bWVudC5sb2NhdGlvbi5zZWFyY2ggPyAoXCIkcXM9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoZG9jdW1lbnQubG9jYXRpb24uc2VhcmNoLnN1YnN0cmluZygxKSkpIDogXCJcIjtcclxuXHJcblx0XHQvLyBUcmltIHRyYWlsaW5nICZcclxuXHRcdGlmIChuZXdBcmdzLmxlbmd0aCA+IDAgJiYgbmV3QXJnc1tuZXdBcmdzLmxlbmd0aF0gPT09IFwiJlwiKSB7XHJcblx0XHRcdG5ld0FyZ3MgPSBuZXdBcmdzLnN1YnN0cmluZygwLCBuZXdBcmdzLmxlbmd0aCAtIDEpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChvcHRpb25zLnRhcmdldCA9PT0gXCJcIikge1xyXG5cdFx0XHRvcHRpb25zLnRhcmdldCA9IFwiLmNvZ25pdG86Zmlyc3RcIjtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgcmVxdWVzdE9wdGlvbnMgPSB7XHJcblx0XHRcdG1ldGhvZDogXCJHRVRcIixcclxuXHRcdFx0ZGF0YVR5cGU6IFwidGV4dFwiLFxyXG5cdFx0XHRhc3luYzogb3B0aW9ucy5hc3luYyB8fCBmYWxzZSxcclxuXHRcdFx0ZW5kcG9pbnQ6IHVybCxcclxuXHRcdFx0c3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcclxuXHRcdFx0XHRDb2duaXRvLmxvYWRDb250ZW50KGRhdGEsIG9wdGlvbnMudGFyZ2V0KTtcclxuXHJcblx0XHRcdFx0b3B0aW9ucy5zdWNjZXNzKCk7XHJcblx0XHRcdH0sXHJcblx0XHRcdGVycm9yOiBvcHRpb25zLmVycm9yXHJcblx0XHR9O1xyXG5cclxuXHRcdC8vIElmIHRoZSBhcmd1bWVudCBsZW5ndGggZXhjZWVkcyAxMDAwIGNoYXJhY3RlcnMsIFBPU1QgaW5zdGVhZCBvZiBHRVRcclxuXHRcdGlmIChuZXdBcmdzICYmIG5ld0FyZ3MubGVuZ3RoID4gMTAwMCkge1xyXG5cdFx0XHRyZXF1ZXN0T3B0aW9ucy5tZXRob2QgPSBcIlBPU1RcIjtcclxuXHRcdFx0cmVxdWVzdE9wdGlvbnMuY29udGVudFR5cGUgPSBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiO1xyXG5cdFx0XHRyZXF1ZXN0T3B0aW9ucy5kYXRhID0gbmV3QXJncztcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHJlcXVlc3RPcHRpb25zLmVuZHBvaW50ICs9ICh1cmwuaW5kZXhPZihcIj9cIikgPiAtMSA/IFwiJlwiIDogXCI/XCIpICsgbmV3QXJncztcclxuXHRcdH1cclxuXHJcblx0XHRDb2duaXRvLnNlcnZpY2VSZXF1ZXN0KHJlcXVlc3RPcHRpb25zKTtcclxuXHJcblx0XHRyZXR1cm47XHJcblx0fVxyXG5cdENvZ25pdG8ubG9hZCA9IGxvYWQ7XHJcblxyXG5cdGZ1bmN0aW9uIGxvYWRDb25maWcobW9kdWxlLCBvcHRpb25zKSB7XHJcblx0XHRvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcclxuXHRcdG9wdGlvbnMudGFyZ2V0ID0gb3B0aW9ucy50YXJnZXQgfHwgXCJcIjtcclxuXHRcdG9wdGlvbnMudmlldyA9IG9wdGlvbnMudmlldyB8fCBcIlwiO1xyXG5cdFx0b3B0aW9ucy5hcmdzID0gb3B0aW9ucy5hcmdzIHx8IFwiXCI7XHJcblxyXG5cdFx0dmFyIHVybCA9IG1vZHVsZSArIFwiL2FkbWluL2xvYWRjb25maWdcIjtcclxuXHJcblx0XHRpZiAob3B0aW9ucy52aWV3ICE9PSBcIlwiKSB7XHJcblx0XHRcdHVybCArPSBcIj92aWV3PVwiICsgb3B0aW9ucy52aWV3O1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChvcHRpb25zLmFyZ3MgIT09IFwiXCIpIHtcclxuXHRcdFx0dXJsICs9ICh1cmwuaW5kZXhPZihcIj9cIikgPiAtMSA/IFwiJlwiIDogXCI/XCIpICsgXCJhcmdzPVwiICsgb3B0aW9ucy5hcmdzO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChvcHRpb25zLnRhcmdldCA9PT0gXCJcIikge1xyXG5cdFx0XHRpZiAoJChcIiNjb2duaXRvLWludGVyZmFjZVwiKS5sZW5ndGggPT0gMCkge1xyXG5cdFx0XHRcdGRvY3VtZW50LndyaXRlKFwiPGRpdiBpZD1cXFwiY29nbml0by1pbnRlcmZhY2VcXFwiPjwvZGl2PlwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRvcHRpb25zLnRhcmdldCA9IFwiI2NvZ25pdG8taW50ZXJmYWNlXCI7XHJcblx0XHR9XHJcblxyXG5cdFx0Q29nbml0by5zZXJ2aWNlUmVxdWVzdCh7XHJcblx0XHRcdG1ldGhvZDogXCJHRVRcIixcclxuXHRcdFx0ZGF0YVR5cGU6IFwidGV4dFwiLFxyXG5cdFx0XHRhc3luYzogZmFsc2UsXHJcblx0XHRcdGVuZHBvaW50OiB1cmwsXHJcblx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XHJcblx0XHRcdFx0Q29nbml0by5sb2FkQ29udGVudChkYXRhLCBvcHRpb25zLnRhcmdldCk7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH1cclxuXHRDb2duaXRvLmxvYWRDb25maWcgPSBsb2FkQ29uZmlnO1xyXG5cclxuXHRmdW5jdGlvbiBkZXNlcmlhbGl6ZURhdGUodmFsdWUsIHByb3ApIHtcclxuXHRcdC8vIGdldCB0aGUgZGF0ZSBmb3JtYXQgaW4gdXNlIGZvciB0aGUgcHJvcGVydHkgdG8gZGV0ZXJtaW5lIGhvdyB0byBkZXNlcmlhbGl6ZVxyXG5cdFx0dmFyIGRhdGVGb3JtYXQgPSBwcm9wLmdldF9mb3JtYXQoKS50b1N0cmluZygpO1xyXG5cclxuXHRcdC8vIGVuc3VyZSBkYXRlIG9ubHkgZGF0YSBkb2VzIG5vdCBoYXZlIGEgdGltZSBjb21wb25lbnRcclxuXHRcdGlmIChkYXRlRm9ybWF0ID09PSBcImRcIilcclxuXHRcdFx0cmV0dXJuIG5ldyBEYXRlKHZhbHVlLnN1YnN0cigwLCA0KSwgdmFsdWUuc3Vic3RyKDUsIDIpIC0gMSwgdmFsdWUuc3Vic3RyKDgsIDIpKTtcclxuXHJcblx0XHQvLyBkZXNlcmlhbGl6ZSB0aW1lIGRhdGEgd2l0aCBjb21tb24gZGF0ZSAxLzEvMTk3MFxyXG5cdFx0ZWxzZSBpZiAoZGF0ZUZvcm1hdCA9PT0gXCJ0XCIpIHtcclxuXHRcdFx0dmFyIGZ1bGxEYXRlID0gbmV3IERhdGUodmFsdWUpO1xyXG5cclxuXHRcdFx0Ly8gaWYgYSBkYXRlIGNvdWxkIG5vdCBiZSBjcmVhdGVkIGZyb20gdGhlIHRpbWUgZGF0YSBwcm92aWRlZCwgdGhlbiBhc3N1bWUgdGhlIHZhbHVlIGlzIG9ubHkgdGhlIHRpbWUgY29tcG9uZW50IGFuZFxyXG5cdFx0XHQvLyBkZXNlcmlhbGl6ZSB0byBhIGNvbW1vbiBkYXRlXHJcblx0XHRcdGlmIChpc05hTihmdWxsRGF0ZS5nZXREYXRlKCkpKSB7XHJcblx0XHRcdFx0cmV0dXJuIG5ldyBEYXRlKDE5NzAsIDAsIDEsIHZhbHVlLnN1YnN0cigwLCAyKSwgdmFsdWUuc3Vic3RyKDMsIDIpLCB2YWx1ZS5zdWJzdHIoNiwgMikpO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdHJldHVybiBmdWxsRGF0ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0Ly8gb3RoZXJ3aXNlLCBhc3N1bWUgdGhlIHZhbHVlIHJlcHJlc2VudHMgYSB2YWxpZCBkYXRlIGFuZCB0aW1lXHJcblx0XHRlbHNlXHJcblx0XHRcdHJldHVybiBuZXcgRGF0ZSh2YWx1ZSk7XHJcblx0fVxyXG5cdENvZ25pdG8uZGVzZXJpYWxpemVEYXRlID0gZGVzZXJpYWxpemVEYXRlO1xyXG5cclxuXHQvLyByZWN1cnNpdmVseSBsb2FkcyBqc29uIGRhdGEgaW50byBlbnRpdGllcy5cclxuXHR2YXIgaW5zdGFuY2VzUGVuZGluZ0luaXQ7XHJcblx0dmFyIGluc3RhbmNlc1BlbmRpbmdMb2FkO1xyXG5cdGZ1bmN0aW9uIGRlc2VyaWFsaXplKHR5cGUsIGRhdGEsIGVudGl0eSkge1xyXG5cclxuXHRcdC8vIHJldHVybiBudWxsIGlmIHRoZSBpbnB1dCBpcyBhbHJlYWR5IG51bGxcclxuXHRcdGlmICghZGF0YSlcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblxyXG5cdFx0dmFyIGlzVG9wTGV2ZWxDYWxsID0gZmFsc2U7XHJcblxyXG5cdFx0Ly8gaWdub3JlIGNoYW5nZXMgdGhhdCBvY2N1ciBkdXJpbmcgZGVzZXJpYWxpemF0aW9uXHJcblx0XHR2YXIgcmVzdWx0ID0gbnVsbDtcclxuXHRcdGNvbnRleHQuc2VydmVyLmlnbm9yZUNoYW5nZXMoZnVuY3Rpb24gKCkge1xyXG5cclxuXHRcdFx0Ly8gdHJhY2sgZXhpc3RpbmcgaW5zdGFuY2VzIHBlbmRpbmcgaW5pdGlhbGl6YXRpb25cclxuXHRcdFx0aWYgKCFpbnN0YW5jZXNQZW5kaW5nSW5pdCkge1xyXG5cdFx0XHRcdGluc3RhbmNlc1BlbmRpbmdJbml0ID0gW107XHJcblx0XHRcdFx0aW5zdGFuY2VzUGVuZGluZ0xvYWQgPSBbXTtcclxuXHRcdFx0XHRpc1RvcExldmVsQ2FsbCA9IHRydWU7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIGRvZXMgdGhlIGRhdGEgY29udGFpbiBhbiBhcnJheVxyXG5cdFx0XHRpZiAoZGF0YSBpbnN0YW5jZW9mIEFycmF5KSB7XHJcblx0XHRcdFx0cmVzdWx0ID0gW107XHJcblxyXG5cdFx0XHRcdCQuZWFjaChkYXRhLCBmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHtcclxuXHRcdFx0XHRcdHJlc3VsdC5wdXNoKGRlc2VyaWFsaXplKHR5cGUsIGVsZW1lbnQpKTtcclxuXHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdFx0aWYgKGlzVG9wTGV2ZWxDYWxsKSB7XHJcblx0XHRcdFx0XHRpbnN0YW5jZXNQZW5kaW5nSW5pdC5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHtcclxuXHRcdFx0XHRcdFx0Zm9yICh2YXIgdCA9IG9iai5tZXRhLnR5cGU7IHQ7IHQgPSB0LmJhc2VUeXBlKSB7XHJcblx0XHRcdFx0XHRcdFx0dmFyIGhhbmRsZXIgPSB0Ll9nZXRFdmVudEhhbmRsZXIoXCJpbml0RXhpc3RpbmdcIik7XHJcblx0XHRcdFx0XHRcdFx0aWYgKGhhbmRsZXIpXHJcblx0XHRcdFx0XHRcdFx0XHRoYW5kbGVyKG9iaiwge30pO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdGluc3RhbmNlc1BlbmRpbmdJbml0ID0gbnVsbDtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gY2hhbmdlIHRoZSB0YXJnZXQgdHlwZSBpZiBhIHR5cGUgbWFya2VyIHdhcyBpbmNsdWRlZFxyXG5cdFx0XHRpZiAoZGF0YS4kdHlwZSkge1xyXG5cdFx0XHRcdHR5cGUgPSBjb250ZXh0Lm1vZGVsLm1ldGEudHlwZShkYXRhLiR0eXBlKS5nZXRfanN0eXBlKCk7XHJcblx0XHRcdH1cclxuXHRcdFx0Ly8gZGV0ZXJtaW5lIGR5bmFtaWMgdHlwZVxyXG5cdFx0XHRlbHNlIGlmIChDb2duaXRvLmR5bmFtaWNUeXBlcykge1xyXG5cdFx0XHRcdHR5cGUgPSBDb2duaXRvLmdldER5bmFtaWNUeXBlKHR5cGUsIGRhdGEpIHx8IHR5cGU7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciBpbml0UHJvcGVydGllcyA9IHt9O1xyXG5cdFx0XHR2YXIgZGVzZXJpYWxpemVJbnRvRW50aXR5ID0gZmFsc2U7XHJcblxyXG5cdFx0XHQvLyBDcmVhdGUgdGhlIGVudGl0eSBpZiBub3QgZGVzZXJpYWxpemluZyBpbnRvIGFuIGV4aXN0aW5nIGluc3RhbmNlXHJcblx0XHRcdGlmICghZW50aXR5KSB7XHJcblxyXG5cdFx0XHRcdC8vIGlmIHRoZSBvYmplY3QgaGFzIGFuIGlkLCB0cnkgYW5kIGdldCBpdCBmcm9tIHRoZSBvYmplY3QgcG9vbFxyXG5cdFx0XHRcdC8vIGNoZWNrIGV4cGxpY2l0eSBudWxsICYgdW5kZWZpbmVkLCBiL2MgZW51bXMgd2lsbCBoYXZlIGFuIGlkIG9mIDAgd2hpY2hcclxuXHRcdFx0XHQvLyBldmFsdWF0ZXMgdG8gZmFsc2VcclxuXHRcdFx0XHRpZiAoZGF0YS5JZCAhPSBudWxsICYmIGRhdGEuSWQgIT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHQvLyBEb24ndCB1c2UgRHluYW1pY0VudGl0eSdzIFwiSWRcIiBwcm9wZXJ0eSBhcyBhIGNsaWVudC1zaWRlIGlkZW50aWZpZXJcclxuXHRcdFx0XHRcdC8vIE5PVEU6IElmIGluIHRoZSBmdXR1cmUgd2Ugd2FudCB0byBiZWdpbiB1c2luZyB0aGlzIGFzIHRoZSBjbGllbnQtc2lkZSBJZCxcclxuXHRcdFx0XHRcdC8vIHRoZW4gd2UgY291bGQgYWxzbyBsZXZlcmFnZSB0aGlzIHRvIGRldGVjdCB3aGV0aGVyIHRoZSBpdGVtIGhhcyBiZWVuIHNhdmVkXHJcblx0XHRcdFx0XHR2YXIgaWRQcm9wZXJ0eSA9IHR5cGUubWV0YS5wcm9wZXJ0eShcIklkXCIpO1xyXG5cdFx0XHRcdFx0aWYgKGlkUHJvcGVydHkgJiYgaWRQcm9wZXJ0eS5nZXRfY29udGFpbmluZ1R5cGUoKS5nZXRfZnVsbE5hbWUoKSA9PT0gXCJDb2duaXRvLkR5bmFtaWNFbnRpdHlcIikge1xyXG5cdFx0XHRcdFx0XHRlbnRpdHkgPSBuZXcgdHlwZSh0eXBlLm1ldGEubmV3SWQoKSk7XHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHQvLyBsb29rIHRvIHNlZSBpZiB0aGUgY3VycmVudCBvYmplY3QgaXMgaW4gdGhlIG9iamVjdCBwb29sXHJcblx0XHRcdFx0XHRcdGVudGl0eSA9IHR5cGUubWV0YS5nZXQoZGF0YS5JZC50b1N0cmluZygpKTtcclxuXHJcblx0XHRcdFx0XHRcdC8vIGlmIHRoZSBvYmplY3Qgd2FzIGluIHRoZSBwb29sLCByZXR1cm4gaXRcclxuXHRcdFx0XHRcdFx0Ly8gZWxzZSBjb25zdHJ1Y3QgYSBuZXcgdHlwZSBwYXNzaW5nIGluIHRoZSBJZCwgd2hpY2ggd2lsbCBhZGQgdGhlIG9iamVjdCB0byBwb29sXHJcblx0XHRcdFx0XHRcdC8vIGFuZCB0aGVuIGNvbnRpbnVlIHRvIGRlc2VyaWFsaXplIHRoZSBuZXcgZW50aXR5XHJcblx0XHRcdFx0XHRcdGlmIChlbnRpdHkpIHtcclxuXHRcdFx0XHRcdFx0XHRyZXN1bHQgPSBlbnRpdHk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdGlmIChpc1RvcExldmVsQ2FsbClcclxuXHRcdFx0XHRcdFx0XHRcdGluc3RhbmNlc1BlbmRpbmdJbml0ID0gbnVsbDtcclxuXHJcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdGVudGl0eSA9IG5ldyB0eXBlKGRhdGEuSWQudG9TdHJpbmcoKSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZVxyXG5cdFx0XHRcdFx0ZW50aXR5ID0gbmV3IHR5cGUodHlwZS5tZXRhLm5ld0lkKCkpO1xyXG5cclxuXHRcdFx0XHQvLyBhZGQgdGhlIGVudGl0eSB0byB0aGUgc2V0IHRoYXQgaXMgcGVuZGluZyBpbml0aWFsaXphdGlvblxyXG5cdFx0XHRcdGluc3RhbmNlc1BlbmRpbmdJbml0LnB1c2goZW50aXR5KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRkZXNlcmlhbGl6ZUludG9FbnRpdHkgPSB0cnVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBzZXQgdGhlIGVudGl0eSB2ZXJzaW9uIChpZiBwcmVzZW50KVxyXG5cdFx0XHRpZiAoZGF0YS4kdmVyc2lvbikge1xyXG5cdFx0XHRcdGVudGl0eS4kdmVyc2lvbiA9IGRhdGEuJHZlcnNpb247XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIHNldCB0aGUgZXRhZyAoaWYgcHJlc2VudClcclxuXHRcdFx0aWYgKGRhdGEuJGV0YWcpIHtcclxuXHRcdFx0XHRlbnRpdHkuJGV0YWcgPSBkYXRhLiRldGFnO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBwcm9jZXNzIGVhY2ggZGF0YSBwcm9wZXJ0eVxyXG5cdFx0XHRmb3IgKHZhciBwcm9wTmFtZSBpbiBkYXRhKSB7XHJcblxyXG5cdFx0XHRcdC8vIGdldCB0aGUgcHJvcGVydHlcclxuXHRcdFx0XHR2YXIgcHJvcCA9IHR5cGUubWV0YS5wcm9wZXJ0eShwcm9wTmFtZSk7XHJcblxyXG5cdFx0XHRcdGlmIChwcm9wICE9PSBudWxsKSB7XHJcblx0XHRcdFx0XHQvLyBnZXQgdGhlIHZhbHVlXHJcblx0XHRcdFx0XHR2YXIgdmFsdWUgPSBkYXRhW3Byb3BOYW1lXTtcclxuXHRcdFx0XHRcdHZhciBqc3R5cGUgPSBwcm9wLmdldF9qc3R5cGUoKTtcclxuXHJcblx0XHRcdFx0XHQvLyBpbml0aWFsaXplIHRoZSBwcm9wZXJ0eSBpZiBpdCBpcyBhIHZhbHVlIHR5cGVcclxuXHRcdFx0XHRcdGlmIChwcm9wLmdldF9pc1ZhbHVlVHlwZSgpKSB7XHJcblx0XHRcdFx0XHRcdGlmIChqc3R5cGUgPT09IERhdGUgJiYgdmFsdWUgJiYgdmFsdWUuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xyXG5cdFx0XHRcdFx0XHRcdHZhbHVlID0gZGVzZXJpYWxpemVEYXRlKHZhbHVlLCBwcm9wKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0aWYgKGRlc2VyaWFsaXplSW50b0VudGl0eSlcclxuXHRcdFx0XHRcdFx0XHRlbnRpdHkuc2V0KHByb3BOYW1lLCB2YWx1ZSk7XHJcblx0XHRcdFx0XHRcdGVsc2UgaWYgKHByb3AuZ2V0X2lzTGlzdCgpKSB7XHJcblx0XHRcdFx0XHRcdFx0aW5pdFByb3BlcnRpZXNbcHJvcE5hbWVdID0gdmFsdWUuc2xpY2UoKTtcclxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRpbml0UHJvcGVydGllc1twcm9wTmFtZV0gPSB2YWx1ZTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdC8vIHJlY3Vyc2l2ZWx5IGxvYWQgZW50aXR5IHByb3BlcnRpZXNcclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gTGlzdFxyXG5cdFx0XHRcdFx0XHRpZiAocHJvcC5nZXRfaXNMaXN0KCkgJiYgdmFsdWUgaW5zdGFuY2VvZiBBcnJheSkge1xyXG5cdFx0XHRcdFx0XHRcdHZhciBpc0xvb2t1cExpc3RQcm9wZXJ0eSA9IENvZ25pdG8uRm9ybXMgJiYgQ29nbml0by5Gb3Jtcy5Gb3JtRW50cnkgJiYgcHJvcC5nZXRfanN0eXBlKCkubWV0YS5iYXNlVHlwZSA9PT0gQ29nbml0by5Gb3Jtcy5Gb3JtRW50cnkubWV0YSAmJiB2YWx1ZS5sZW5ndGggPiAwICYmIHR5cGVvZiAodmFsdWVbMF0pID09PSBcInN0cmluZ1wiO1xyXG5cdFx0XHRcdFx0XHRcdC8vIEV4aXN0aW5nIEVudGl0eSBMaXN0XHJcblx0XHRcdFx0XHRcdFx0aWYgKGRlc2VyaWFsaXplSW50b0VudGl0eSAmJiAhaXNMb29rdXBMaXN0UHJvcGVydHkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdHZhciB0YXJnZXRMaXN0O1xyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKGRlc2VyaWFsaXplSW50b0VudGl0eSAmJiBlbnRpdHkubWV0YS50eXBlLnByb3BlcnR5KHByb3BOYW1lKSlcclxuXHRcdFx0XHRcdFx0XHRcdFx0dGFyZ2V0TGlzdCA9IGVudGl0eS5nZXQocHJvcE5hbWUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0dmFyIGkgPSAwO1xyXG5cdFx0XHRcdFx0XHRcdFx0Zm9yIChpOyBpIDwgdmFsdWUubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIHRhcmdldENoaWxkID0gdGFyZ2V0TGlzdFtpXTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gVXBkYXRlXHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmICh0YXJnZXRDaGlsZClcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRDb2duaXRvLmRlc2VyaWFsaXplKGpzdHlwZSwgdmFsdWVbaV0sIHRhcmdldENoaWxkKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBJbnNlcnRcclxuXHRcdFx0XHRcdFx0XHRcdFx0ZWxzZVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHRhcmdldExpc3QuYWRkKENvZ25pdG8uZGVzZXJpYWxpemUoanN0eXBlLCB2YWx1ZVtpXSkpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0XHRcdC8vIERlbGV0ZSByZW1haW5pbmcgaXRlbXNcclxuXHRcdFx0XHRcdFx0XHRcdHRhcmdldExpc3QucmVtb3ZlUmFuZ2UoaSwgdGFyZ2V0TGlzdC5sZW5ndGgpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0Ly8gTG9va3VwIEVudGl0eSBMaXN0XHJcblx0XHRcdFx0XHRcdFx0ZWxzZSBpZiAoaXNMb29rdXBMaXN0UHJvcGVydHkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdHZhbHVlID0gdmFsdWUuc2xpY2UoKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHQvLyBDbGVhciBleGlzdGluZyBsaXN0XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoZGVzZXJpYWxpemVJbnRvRW50aXR5ICYmIGVudGl0eS5tZXRhLnR5cGUucHJvcGVydHkocHJvcE5hbWUpKVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRlbnRpdHkuZ2V0KHByb3BOYW1lKS5jbGVhcigpXHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0aW5pdFByb3BlcnRpZXNbcHJvcE5hbWVdID0gdmFsdWU7XHJcblx0XHRcdFx0XHRcdFx0XHRmb3IgKHZhciBqID0gMDsgaiA8IHZhbHVlLmxlbmd0aDsgaisrKVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRpbnN0YW5jZXNQZW5kaW5nTG9hZC5wdXNoKHsgaW5zdGFuY2U6IGVudGl0eSwgcHJvcGVydHk6IHByb3AsIGlkOiB2YWx1ZVtqXSB9KTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRcdC8vIE5ldyBFbnRpdHkgTGlzdFxyXG5cdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0aW5pdFByb3BlcnRpZXNbcHJvcE5hbWVdID0gdmFsdWUubWFwKGZ1bmN0aW9uIChjaGlsZCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gQ29nbml0by5kZXNlcmlhbGl6ZShqc3R5cGUsIGNoaWxkKTtcclxuXHRcdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdC8vIEVudW1cclxuXHRcdFx0XHRcdFx0ZWxzZSBpZiAodmFsdWUgJiYgcHJvcC5nZXRfanN0eXBlKCkubWV0YS5faXNFbnVtKSB7XHJcblx0XHRcdFx0XHRcdFx0aWYgKGRlc2VyaWFsaXplSW50b0VudGl0eSlcclxuXHRcdFx0XHRcdFx0XHRcdGVudGl0eS5zZXQocHJvcE5hbWUsIGpzdHlwZS5tZXRhLmdldCh2YWx1ZSkpO1xyXG5cdFx0XHRcdFx0XHRcdGVsc2VcclxuXHRcdFx0XHRcdFx0XHRcdGluaXRQcm9wZXJ0aWVzW3Byb3BOYW1lXSA9IGpzdHlwZS5tZXRhLmdldCh2YWx1ZSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdC8vIEVudGl0eVxyXG5cdFx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgaXNMb29rdXBQcm9wZXJ0eSA9IHByb3AuZ2V0X2pzdHlwZSgpLm1ldGEuYmFzZVR5cGUgPT09IENvZ25pdG8uRm9ybXMuRm9ybUVudHJ5Lm1ldGEgJiYgdHlwZW9mICh2YWx1ZSkgPT09IFwic3RyaW5nXCI7XHJcblxyXG5cdFx0XHRcdFx0XHRcdC8vIEV4aXN0aW5nIEVudGl0eVxyXG5cdFx0XHRcdFx0XHRcdGlmIChkZXNlcmlhbGl6ZUludG9FbnRpdHkgJiYgIWlzTG9va3VwUHJvcGVydHkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGlmICh2YWx1ZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR2YXIgdGFyZ2V0RW50aXR5ID0gZW50aXR5LmdldChwcm9wTmFtZSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmICghdGFyZ2V0RW50aXR5KVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGVudGl0eS5zZXQocHJvcE5hbWUsIENvZ25pdG8uZGVzZXJpYWxpemUoanN0eXBlLCB2YWx1ZSwgbmV3IChqc3R5cGUpKCkpKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0ZWxzZVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdENvZ25pdG8uZGVzZXJpYWxpemUoanN0eXBlLCB2YWx1ZSwgdGFyZ2V0RW50aXR5KTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdGVsc2VcclxuXHRcdFx0XHRcdFx0XHRcdFx0ZW50aXR5LnNldChwcm9wTmFtZSwgbnVsbCk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0XHQvLyBMb29rdXAgRW50aXR5XHJcblx0XHRcdFx0XHRcdFx0ZWxzZSBpZiAoaXNMb29rdXBQcm9wZXJ0eSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0aW5pdFByb3BlcnRpZXNbcHJvcE5hbWVdID0gdmFsdWU7XHJcblx0XHRcdFx0XHRcdFx0XHRpbnN0YW5jZXNQZW5kaW5nTG9hZC5wdXNoKHsgaW5zdGFuY2U6IGVudGl0eSwgcHJvcGVydHk6IHByb3AsIGlkOiB2YWx1ZSB9KTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRcdC8vIE5ldyBFbnRpdHlcclxuXHRcdFx0XHRcdFx0XHRlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0UHJvcGVydGllc1twcm9wTmFtZV0gPSBDb2duaXRvLmRlc2VyaWFsaXplKGpzdHlwZSwgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoIWRlc2VyaWFsaXplSW50b0VudGl0eSlcclxuXHRcdFx0XHRlbnRpdHkuaW5pdChpbml0UHJvcGVydGllcyk7XHJcblxyXG5cdFx0XHRpZiAoZW50aXR5Ll9sYXp5TG9hZGVyKSB7XHJcblx0XHRcdFx0Ly8gdW5yZWdpc3RlciB0aGUgbGF6eWxvYWRlcnMsIHdoaWNoIGFyZSBhcGFydCBvZiB0aGUgU2VydmVyU3luYyBvYmplY3QgYnJvdWdodCBvdmVyIGJ5ICRleG93ZWIuXHJcblx0XHRcdFx0Ly8gQ29nbml0byBkb2Vzbid0IHVzZSB0aGUgU2VydmVyU3luYywgc28gdGhlIGxhenkgbG9hZGVyIGlzIHVubmVjZXNzYXJ5LlxyXG5cdFx0XHRcdGVudGl0eS5fbGF6eUxvYWRlci5hbGxQcm9wcy5jb25zdHJ1Y3Rvci51bnJlZ2lzdGVyKGVudGl0eSwgZW50aXR5Ll9sYXp5TG9hZGVyLmFsbFByb3BzKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gcmFpc2UgaW5pdEV4aXN0aW5nIG5ldyBleGlzdGluZyBpbnN0YW5jZXMgaWYgdGhpcyBpcyB0aGUgdG9wIGxldmVsIGNhbGwgdG8gZGVzZXJpYWxpemVcclxuXHRcdFx0aWYgKGlzVG9wTGV2ZWxDYWxsKSB7XHJcblxyXG5cdFx0XHRcdC8vIGlmIHRoZSBncmFwaCBpbmNsdWRlcyB1bmxvYWRlZCBsb29rdXBzLCBkZWZlciByYWlzaW5nIGluaXQgYW5kIHN0b3JlIHRoZSBpbmZvcm1hdGlvbiBvbiB0aGUgcmV0dXJuZWQgZW50aXR5XHJcblx0XHRcdFx0aWYgKGluc3RhbmNlc1BlbmRpbmdMb2FkLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHRcdGVudGl0eS5tZXRhLl9pbnN0YW5jZXNQZW5kaW5nTG9hZCA9IGluc3RhbmNlc1BlbmRpbmdMb2FkO1xyXG5cdFx0XHRcdFx0ZW50aXR5Lm1ldGEuX2luc3RhbmNlc1BlbmRpbmdJbml0ID0gaW5zdGFuY2VzUGVuZGluZ0luaXQ7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBvdGhlcndpc2UsIHJhaXNlIGluaXQgZXhpc3RpbmdcclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdGluc3RhbmNlc1BlbmRpbmdJbml0LmZvckVhY2goZnVuY3Rpb24gKG9iaikge1xyXG5cdFx0XHRcdFx0XHRmb3IgKHZhciB0ID0gb2JqLm1ldGEudHlwZTsgdDsgdCA9IHQuYmFzZVR5cGUpIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgaGFuZGxlciA9IHQuX2dldEV2ZW50SGFuZGxlcihcImluaXRFeGlzdGluZ1wiKTtcclxuXHRcdFx0XHRcdFx0XHRpZiAoaGFuZGxlcilcclxuXHRcdFx0XHRcdFx0XHRcdGhhbmRsZXIob2JqLCB7fSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0aW5zdGFuY2VzUGVuZGluZ0luaXQgPSBudWxsO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyByZXR1cm4gdGhlIG5ldyBlbnRpdHlcclxuXHRcdFx0cmVzdWx0ID0gZW50aXR5O1xyXG5cdFx0fSkoKTtcclxuXHJcblx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdH1cclxuXHRDb2duaXRvLmRlc2VyaWFsaXplID0gZGVzZXJpYWxpemU7XHJcblxyXG5cdGZ1bmN0aW9uIG5vcm1hbGl6ZURhdGVWYWx1ZSh2YWx1ZSkge1xyXG5cdCAgICByZXR1cm4gdmFsdWUuZ2V0RnVsbFllYXIoKSArICh2YWx1ZS5nZXRNb250aCgpIDwgOSA/IFwiLTBcIiA6IFwiLVwiKSArICh2YWx1ZS5nZXRNb250aCgpICsgMSkgKyAodmFsdWUuZ2V0RGF0ZSgpIDwgMTAgPyBcIi0wXCIgOiBcIi1cIikgKyB2YWx1ZS5nZXREYXRlKCk7XHJcblx0fVxyXG5cdENvZ25pdG8ubm9ybWFsaXplRGF0ZVZhbHVlID0gbm9ybWFsaXplRGF0ZVZhbHVlO1xyXG5cclxuXHRmdW5jdGlvbiBub3JtYWxpemVUaW1lVmFsdWUodmFsdWUpIHtcclxuXHQgICAgcmV0dXJuICh2YWx1ZS5nZXRIb3VycygpIDwgMTAgPyBcIjBcIiA6IFwiXCIpICsgdmFsdWUuZ2V0SG91cnMoKSArICh2YWx1ZS5nZXRNaW51dGVzKCkgPCAxMCA/IFwiOjBcIiA6IFwiOlwiKSArIHZhbHVlLmdldE1pbnV0ZXMoKSArICh2YWx1ZS5nZXRTZWNvbmRzKCkgPCAxMCA/IFwiOjBcIiA6IFwiOlwiKSArIHZhbHVlLmdldFNlY29uZHMoKTtcclxuXHR9XHJcblx0Q29nbml0by5ub3JtYWxpemVUaW1lVmFsdWUgPSBub3JtYWxpemVUaW1lVmFsdWU7XHJcblxyXG5cdGZ1bmN0aW9uIHNlcmlhbGl6ZShlbnRpdHkpIHtcclxuXHRcdGlmIChlbnRpdHkgPT0gbnVsbCkge1xyXG5cdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgcmVzdWx0ID0gbnVsbDtcclxuXHJcblx0XHRpZiAoZW50aXR5IGluc3RhbmNlb2YgQXJyYXkpIHtcclxuXHRcdFx0cmVzdWx0ID0gW107XHJcblxyXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGVudGl0eS5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdHZhciBlbGVtZW50ID0gZW50aXR5W2ldO1xyXG5cclxuXHRcdFx0XHQvLyBTZXJpYWxpemUgZm9ybSBlbnRyeSByZWZlcmVuY2VzIGFzIGlkc1xyXG5cdFx0XHRcdGlmIChlbGVtZW50IGluc3RhbmNlb2YgQ29nbml0by5Gb3Jtcy5Gb3JtRW50cnkpXHJcblx0XHRcdFx0XHRyZXN1bHQucHVzaChlbGVtZW50LmdldF9JZCgpKTtcclxuXHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0XHRyZXN1bHQucHVzaChzZXJpYWxpemUoZWxlbWVudCkpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0cmVzdWx0ID0ge307XHJcblx0XHRcdHZhciB0eXBlID0gZW50aXR5Lm1ldGEudHlwZTtcclxuXHJcblx0XHRcdC8vIEFsd2F5cyBpbmNsdWRlIHRoZSB0eXBlIG5hbWUgaWYgdGhlIGluc3RhbmNlIGlzIGEgZGVyaXZlZCB0eXBlXHJcblx0XHRcdGlmICh0eXBlLmJhc2VUeXBlKVxyXG5cdFx0XHRcdHJlc3VsdFtcIiR0eXBlXCJdID0gdHlwZS5nZXRfZnVsbE5hbWUoKTtcclxuXHJcblx0XHRcdC8vIEluY2x1ZGUgdmVyc2lvbiAoaWYga25vd24pXHJcblx0XHRcdGlmIChlbnRpdHkuJHZlcnNpb24pIHtcclxuXHRcdFx0XHRyZXN1bHRbXCIkdmVyc2lvblwiXSA9IGVudGl0eS4kdmVyc2lvbjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gSW5jbHVkZSBldGFnIChpZiBrbm93bilcclxuXHRcdFx0aWYgKGVudGl0eS4kZXRhZykge1xyXG5cdFx0XHRcdHJlc3VsdFtcIiRldGFnXCJdID0gZW50aXR5LiRldGFnO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR2YXIgcHJvcGVydGllcyA9IHR5cGUuZ2V0X2FsbHByb3BlcnRpZXMoKTtcclxuXHRcdFx0Zm9yICh2YXIgcCA9IDA7IHAgPCBwcm9wZXJ0aWVzLmxlbmd0aDsgcCsrKSB7XHJcblx0XHRcdFx0dmFyIHByb3BlcnR5ID0gcHJvcGVydGllc1twXTtcclxuXHRcdFx0XHRpZiAocHJvcGVydHkuZ2V0X29yaWdpbigpID09IFwic2VydmVyXCIgJiYgcHJvcGVydHkuZ2V0X2lzUGVyc2lzdGVkKCkpIHtcclxuXHRcdFx0XHRcdGlmIChwcm9wZXJ0eS5nZXRfaXNWYWx1ZVR5cGUoKSkge1xyXG5cdFx0XHRcdFx0XHR2YXIgdmFsdWUgPSBwcm9wZXJ0eS52YWx1ZShlbnRpdHkpO1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gc2VyaWFsaXplIGRhdGUgb25seSBhbmQgdGltZSBvbmx5IGluIHNwZWNpYWwgd2F5c1xyXG5cdFx0XHRcdFx0XHRpZiAodmFsdWUgJiYgcHJvcGVydHkuZ2V0X2pzdHlwZSgpID09PSBEYXRlKSB7XHJcblxyXG5cdFx0XHRcdFx0XHRcdC8vIGdldCB0aGUgZGF0ZSBmb3JtYXQgaW4gdXNlIGZvciB0aGUgcHJvcGVydHkgdG8gZGV0ZXJtaW5lIGhvdyB0byBzZXJpYWxpemVcclxuXHRcdFx0XHRcdFx0XHR2YXIgZGF0ZUZvcm1hdCA9IHByb3BlcnR5LmdldF9mb3JtYXQoKS50b1N0cmluZygpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHQvLyBlbnN1cmUgZGF0ZSBvbmx5IGRhdGEgZG9lcyBub3QgaGF2ZSBhIHRpbWUgY29tcG9uZW50XHJcblx0XHRcdFx0XHRcdFx0aWYgKGRhdGVGb3JtYXQgPT09IFwiZFwiKVxyXG5cdFx0XHRcdFx0XHRcdCAgICB2YWx1ZSA9IG5vcm1hbGl6ZURhdGVWYWx1ZSh2YWx1ZSk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdCAgICAvLyBlbnN1cmUgdGltZSBvbmx5IGRhdGEgZG9lcyBub3QgaGF2ZSBhIGRhdGUgY29tcG9uZW50IG9yIHRpbWV6b25lXHJcblx0XHRcdFx0XHRcdFx0ZWxzZSBpZiAoZGF0ZUZvcm1hdCA9PT0gXCJ0XCIpXHJcblx0XHRcdFx0XHRcdFx0ICAgIHZhbHVlID0gbm9ybWFsaXplVGltZVZhbHVlKHZhbHVlKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRpZiAocHJvcGVydHkuZ2V0X2lzTGlzdCgpKSB7XHJcblx0XHRcdFx0XHRcdFx0cmVzdWx0W3Byb3BlcnR5LmdldF9uYW1lKCldID0gdmFsdWUuc2xpY2UoKTtcclxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRyZXN1bHRbcHJvcGVydHkuZ2V0X25hbWUoKV0gPSB2YWx1ZTtcclxuXHRcdFx0XHRcdFx0fVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICghcHJvcGVydHkuZ2V0X2lzU3RhdGljKCkpIHtcclxuXHRcdFx0XHRcdFx0dmFyIHZhbHVlID0gcHJvcGVydHkudmFsdWUoZW50aXR5KTtcclxuXHRcdFx0XHRcdFx0dmFyIGJhc2VUeXBlID0gcHJvcGVydHkuZ2V0X2pzdHlwZSgpLm1ldGEudHlwZS5iYXNlVHlwZTtcclxuXHJcblx0XHRcdFx0XHRcdGlmICh2YWx1ZSAmJiBwcm9wZXJ0eS5nZXRfanN0eXBlKCkubWV0YS5faXNFbnVtICYmICFwcm9wZXJ0eS5faXNMaXN0KSB7XHJcblx0XHRcdFx0XHRcdFx0cmVzdWx0W3Byb3BlcnR5LmdldF9uYW1lKCldID0gdmFsdWUuZ2V0X0lkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgJiYgIXByb3BlcnR5Ll9pc0xpc3QgJiYgYmFzZVR5cGUgJiYgYmFzZVR5cGUuZ2V0X2Z1bGxOYW1lKCkgPT09IFwiQ29nbml0by5Mb29rdXBcIikge1xyXG5cdFx0XHRcdFx0XHRcdHJlc3VsdFtwcm9wZXJ0eS5nZXRfbmFtZSgpXSA9IHZhbHVlLmdldF9Db2RlKCk7XHJcblx0XHRcdFx0XHRcdH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgJiYgdmFsdWUgaW5zdGFuY2VvZiBDb2duaXRvLkZvcm1zLkZvcm1FbnRyeSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZm9yIGxvb2t1cCBmaWVsZHMsIHdlIG9ubHkgbmVlZCB0byBzdG9yZSB0aGUgaWQgb2YgdGhlIGNoaWxkIGVudHJ5XHJcblx0XHRcdFx0XHRcdFx0cmVzdWx0W3Byb3BlcnR5LmdldF9uYW1lKCldID0gdmFsdWUuZ2V0X0lkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0cmVzdWx0W3Byb3BlcnR5LmdldF9uYW1lKCldID0gc2VyaWFsaXplKHZhbHVlKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiByZXN1bHQ7XHJcblx0fVxyXG5cdENvZ25pdG8uc2VyaWFsaXplID0gc2VyaWFsaXplO1xyXG5cclxuXHRDb2duaXRvLmlzUHJvcGVydHlMb29rdXAgPSBmdW5jdGlvbiBpc1Byb3BlcnR5TG9va3VwKHByb3BJbmZvKSB7XHJcblx0XHRyZXR1cm4gQ29nbml0by5Gb3Jtcy5Gb3JtRW50cnkgJiYgcHJvcEluZm8uZ2V0X2pzdHlwZSgpLm1ldGEgJiYgcHJvcEluZm8uZ2V0X2pzdHlwZSgpLm1ldGEudHlwZS5iYXNlVHlwZSA9PT0gQ29nbml0by5Gb3Jtcy5Gb3JtRW50cnkubWV0YTtcclxuXHR9XHJcblxyXG5cdC8vIEZvcmNlcyB2YWxpZGF0aW9uIHJ1bGVzIHRvIHJ1biBmb3IgZXZlcnkgZXhpc3RpbmcgZW50aXR5IGluIHRoZSBncmFwaFxyXG5cdGZ1bmN0aW9uIHZhbGlkYXRlKGVudGl0eSkge1xyXG5cclxuXHRcdC8vIElnbm9yZSBudWxsIG9yIG5ldyBlbnRpdGllc1xyXG5cdFx0aWYgKGVudGl0eSA9PSBudWxsIHx8IChlbnRpdHkubWV0YSAmJiBlbnRpdHkubWV0YS5pc05ldykpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIFByb2Nlc3MgbGlzdHMgcmVjdXJzaXZlbHlcclxuXHRcdGlmIChlbnRpdHkgaW5zdGFuY2VvZiBBcnJheSkge1xyXG5cdFx0XHQkLmVhY2goZW50aXR5LCBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0dmFsaWRhdGUodGhpcyk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIFJ1biBydWxlcyBmb3IgZXhpc3RpbmcgZW50aXRpZXMgYW5kIHJlY3Vyc2Ugb3ZlciBjaGlsZCBlbnRpdGllc1xyXG5cdFx0ZWxzZSB7XHJcblxyXG5cdFx0XHQvLyBSdW4gYWxsIHZhbGlkYXRpb24gcnVsZXMgbm90IHNldCB0byBydW4gb24gZXhpc3RpbmcgZW50aXRpZXNcclxuXHRcdFx0JC5lYWNoKGVudGl0eS5tZXRhLnR5cGUucnVsZXMsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRpZiAodGhpcy5pc1JlZ2lzdGVyZWQgJiYgKHRoaXMgaW5zdGFuY2VvZiBFeG9XZWIuTW9kZWwuQ29uZGl0aW9uUnVsZSB8fCAoRXhvV2ViLk1vZGVsLlJ1bGUucmVxdWlyZWRSYXRpbmdTY2FsZSAmJiB0aGlzIGluc3RhbmNlb2YgRXhvV2ViLk1vZGVsLlJ1bGUucmVxdWlyZWRSYXRpbmdTY2FsZSkpICYmICh0aGlzLmludm9jYXRpb25UeXBlcyAmIDIpID09IDApXHJcblx0XHRcdFx0XHR0aGlzLmV4ZWN1dGUuY2FsbCh0aGlzLCBlbnRpdHkpO1xyXG5cdFx0XHR9KTtcclxuXHJcblx0XHRcdC8vIFJlY3Vyc2Ugb3ZlciBjaGlsZCBlbnRpdGllc1xyXG5cdFx0XHQkLmVhY2goZW50aXR5Lm1ldGEudHlwZS5nZXRfYWxscHJvcGVydGllcygpLCBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0Ly8gTm8gbmVlZCB0byB2YWxpZGF0ZSBsb29rdXAgZW50cmllc1xyXG5cdFx0XHRcdGlmICh0aGlzLmdldF9vcmlnaW4oKSA9PSBcInNlcnZlclwiICYmIHRoaXMuZ2V0X2lzUGVyc2lzdGVkKCkgJiYgIXRoaXMuZ2V0X2lzVmFsdWVUeXBlKCkgJiYgIXRoaXMuZ2V0X2lzU3RhdGljKCkgJiYgIUNvZ25pdG8uaXNQcm9wZXJ0eUxvb2t1cCh0aGlzKSlcclxuXHRcdFx0XHRcdHZhbGlkYXRlKHRoaXMudmFsdWUoZW50aXR5KSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBlbnRpdHk7XHJcblx0fVxyXG5cdENvZ25pdG8udmFsaWRhdGUgPSB2YWxpZGF0ZTtcclxuXHJcblx0Ly8gUmVtb3ZlcyBhbGwgY29uZGl0aW9ucyBmb3Igd2hpY2ggdGhlIHNwZWNpZmllZCBvYmplY3QgaXMgdGhlIHJvb3QgaW5zdGFuY2VcclxuXHRmdW5jdGlvbiBkZWxldGVFbnRpdHkoZW50aXR5KSB7XHJcblxyXG5cdFx0Ly8gSWdub3JlIG51bGwgZW50aXRpZXNcclxuXHRcdGlmIChlbnRpdHkgPT0gbnVsbClcclxuXHRcdFx0cmV0dXJuO1xyXG5cclxuXHRcdC8vIFByb2Nlc3MgbGlzdHMgcmVjdXJzaXZlbHlcclxuXHRcdGlmIChlbnRpdHkgaW5zdGFuY2VvZiBBcnJheSkge1xyXG5cdFx0XHQkLmVhY2goZW50aXR5LCBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0ZGVsZXRlRW50aXR5KHRoaXMpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBSdW4gcnVsZXMgZm9yIGV4aXN0aW5nIGVudGl0aWVzIGFuZCByZWN1cnNlIG92ZXIgY2hpbGQgZW50aXRpZXNcclxuXHRcdGVsc2Uge1xyXG5cclxuXHRcdFx0Ly8gQ2xlYXIgY29uZGl0aW9ucyBvbiB0aGUgZW50aXR5IGlmIGl0IGlzIHRoZSByb290IGluc3RhbmNlXHJcblx0XHRcdCQuZWFjaChlbnRpdHkubWV0YS5jb25kaXRpb25zKCksIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRpZiAodGhpcy50YXJnZXRzICYmIHRoaXMudGFyZ2V0cy5sZW5ndGggPiAwICYmIHRoaXMudGFyZ2V0c1swXS50YXJnZXQgPT0gZW50aXR5KVxyXG5cdFx0XHRcdFx0dGhpcy5kZXN0cm95KCk7XHJcblx0XHRcdH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gRGVzdHJveSB0aGUgZW50aXR5IHRvIGVuc3VyZSBydWxlcyBhcmUgbm90IGV4ZWN1dGVkIGZvciBkZWxldGVkIGVudGl0aWVzXHJcbiAgICAgICAgICAgIGVudGl0eS5tZXRhLmRlc3Ryb3koKTtcclxuXHJcblx0XHRcdC8vIFJlY3Vyc2Ugb3ZlciBjaGlsZCBlbnRpdGllc1xyXG5cdFx0XHQkLmVhY2goZW50aXR5Lm1ldGEudHlwZS5nZXRfYWxscHJvcGVydGllcygpLCBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0aWYgKHRoaXMuZ2V0X29yaWdpbigpID09IFwic2VydmVyXCIgJiYgdGhpcy5nZXRfaXNQZXJzaXN0ZWQoKSAmJiAhdGhpcy5nZXRfaXNWYWx1ZVR5cGUoKSAmJiAhdGhpcy5nZXRfaXNTdGF0aWMoKSAmJiAhQ29nbml0by5pc1Byb3BlcnR5TG9va3VwKHRoaXMpKVxyXG5cdFx0XHRcdFx0ZGVsZXRlRW50aXR5KHRoaXMudmFsdWUoZW50aXR5KSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBlbnRpdHk7XHJcblx0fVxyXG5cdENvZ25pdG8uZGVsZXRlRW50aXR5ID0gZGVsZXRlRW50aXR5O1xyXG5cclxuXHRmdW5jdGlvbiBnZXROb3JtYWxpemVkTmFtZShuYW1lKSB7XHJcblx0XHRpZiAobmFtZSkge1xyXG5cdFx0XHQvLyBDYXBpdGFsaXplIHRoZSBmaXJzdCBsZXR0ZXIgb2YgZXZlcnkgd29yZFxyXG5cdFx0XHR2YXIgbm9ybWFsaXplZE5hbWUgPSBuYW1lLnJlcGxhY2UoLyhbXlxcc10pKFteXFxzXSopL2csIGZ1bmN0aW9uIChnMCwgZzEsIGcyKSB7IHJldHVybiBnMS50b1VwcGVyQ2FzZSgpICsgZzI7IH0pO1xyXG5cclxuXHRcdFx0Ly8gUmVtb3ZlIGFsbCBjaGFyYWN0ZXJzIHRoYXQgaXMgbm90IGFscGhhbnVtZXJpY1xyXG5cdFx0XHQvLyBSZWdleCBwYXR0ZXJuIG1hdGNoZXMgYWxsIGNoYXJhY3RlcnMgdGhhdCBhcmUgdmFsaWQgZm9yIGphdmFzY3JpcHQgaWRlbnRpZmllcnMsIGV4Y2x1ZGUgXCJfXCIgYXMgQ29nbml0byBkb2VzIG5vdCBhbGxvdyB1bmRlcnNjb3JlIHRvIGJlIHVzZWQgaW4gYSBmaWVsZCdzIGludGVybmFsIG5hbWVcclxuXHRcdFx0bm9ybWFsaXplZE5hbWUgPSBub3JtYWxpemVkTmFtZS5yZXBsYWNlKC9bXjAtOWEtekEtWlxcdTAwYWFcXHUwMGI1XFx1MDBiYVxcdTAwYzAtXFx1MDBkNlxcdTAwZDgtXFx1MDBmNlxcdTAwZjgtXFx1MDJiOFxcdTAyYmItXFx1MDJjMVxcdTAyZDAtXFx1MDJkMVxcdTAyZTAtXFx1MDJlNFxcdTAyZWVcXHUwMzcwLVxcdTAzNzNcXHUwMzc2LVxcdTAzNzdcXHUwMzdhLVxcdTAzN2RcXHUwMzg2XFx1MDM4OC1cXHUwMzhhXFx1MDM4Y1xcdTAzOGUtXFx1MDNhMVxcdTAzYTMtXFx1MDNmNVxcdTAzZjctXFx1MDQ4MVxcdTA0OGEtXFx1MDUyM1xcdTA1MzEtXFx1MDU1NlxcdTA1NTlcXHUwNTYxLVxcdTA1ODdcXHUwNWQwLVxcdTA1ZWFcXHUwNWYwLVxcdTA1ZjJcXHUwNjIxLVxcdTA2NGFcXHUwNjYwLVxcdTA2NjlcXHUwNjZlLVxcdTA2NmZcXHUwNjcxLVxcdTA2ZDNcXHUwNmQ1XFx1MDZlNS1cXHUwNmU2XFx1MDZlZS1cXHUwNmZjXFx1MDZmZlxcdTA3MTBcXHUwNzEyLVxcdTA3MmZcXHUwNzRkLVxcdTA3YTVcXHUwN2IxXFx1MDdjMC1cXHUwN2VhXFx1MDdmNC1cXHUwN2Y1XFx1MDdmYVxcdTA5MDQtXFx1MDkzOVxcdTA5M2RcXHUwOTUwXFx1MDk1OC1cXHUwOTYxXFx1MDk2Ni1cXHUwOTZmXFx1MDk3MS1cXHUwOTcyXFx1MDk3Yi1cXHUwOTdmXFx1MDk4NS1cXHUwOThjXFx1MDk4Zi1cXHUwOTkwXFx1MDk5My1cXHUwOWE4XFx1MDlhYS1cXHUwOWIwXFx1MDliMlxcdTA5YjYtXFx1MDliOVxcdTA5YmRcXHUwOWNlXFx1MDlkYy1cXHUwOWRkXFx1MDlkZi1cXHUwOWUxXFx1MDllNi1cXHUwOWYxXFx1MGEwNS1cXHUwYTBhXFx1MGEwZi1cXHUwYTEwXFx1MGExMy1cXHUwYTI4XFx1MGEyYS1cXHUwYTMwXFx1MGEzMi1cXHUwYTMzXFx1MGEzNS1cXHUwYTM2XFx1MGEzOC1cXHUwYTM5XFx1MGE1OS1cXHUwYTVjXFx1MGE1ZVxcdTBhNjYtXFx1MGE2ZlxcdTBhNzItXFx1MGE3NFxcdTBhODUtXFx1MGE4ZFxcdTBhOGYtXFx1MGE5MVxcdTBhOTMtXFx1MGFhOFxcdTBhYWEtXFx1MGFiMFxcdTBhYjItXFx1MGFiM1xcdTBhYjUtXFx1MGFiOVxcdTBhYmRcXHUwYWQwXFx1MGFlMC1cXHUwYWUxXFx1MGFlNi1cXHUwYWVmXFx1MGIwNS1cXHUwYjBjXFx1MGIwZi1cXHUwYjEwXFx1MGIxMy1cXHUwYjI4XFx1MGIyYS1cXHUwYjMwXFx1MGIzMi1cXHUwYjMzXFx1MGIzNS1cXHUwYjM5XFx1MGIzZFxcdTBiNWMtXFx1MGI1ZFxcdTBiNWYtXFx1MGI2MVxcdTBiNjYtXFx1MGI2ZlxcdTBiNzFcXHUwYjgzXFx1MGI4NS1cXHUwYjhhXFx1MGI4ZS1cXHUwYjkwXFx1MGI5Mi1cXHUwYjk1XFx1MGI5OS1cXHUwYjlhXFx1MGI5Y1xcdTBiOWUtXFx1MGI5ZlxcdTBiYTMtXFx1MGJhNFxcdTBiYTgtXFx1MGJhYVxcdTBiYWUtXFx1MGJiOVxcdTBiZDBcXHUwYmU2LVxcdTBiZWZcXHUwYzA1LVxcdTBjMGNcXHUwYzBlLVxcdTBjMTBcXHUwYzEyLVxcdTBjMjhcXHUwYzJhLVxcdTBjMzNcXHUwYzM1LVxcdTBjMzlcXHUwYzNkXFx1MGM1OC1cXHUwYzU5XFx1MGM2MC1cXHUwYzYxXFx1MGM2Ni1cXHUwYzZmXFx1MGM4NS1cXHUwYzhjXFx1MGM4ZS1cXHUwYzkwXFx1MGM5Mi1cXHUwY2E4XFx1MGNhYS1cXHUwY2IzXFx1MGNiNS1cXHUwY2I5XFx1MGNiZFxcdTBjZGVcXHUwY2UwLVxcdTBjZTFcXHUwY2U2LVxcdTBjZWZcXHUwZDA1LVxcdTBkMGNcXHUwZDBlLVxcdTBkMTBcXHUwZDEyLVxcdTBkMjhcXHUwZDJhLVxcdTBkMzlcXHUwZDNkXFx1MGQ2MC1cXHUwZDYxXFx1MGQ2Ni1cXHUwZDZmXFx1MGQ3YS1cXHUwZDdmXFx1MGQ4NS1cXHUwZDk2XFx1MGQ5YS1cXHUwZGIxXFx1MGRiMy1cXHUwZGJiXFx1MGRiZFxcdTBkYzAtXFx1MGRjNlxcdTBlMDEtXFx1MGUzMFxcdTBlMzItXFx1MGUzM1xcdTBlNDAtXFx1MGU0NlxcdTBlNTAtXFx1MGU1OVxcdTBlODEtXFx1MGU4MlxcdTBlODRcXHUwZTg3LVxcdTBlODhcXHUwZThhXFx1MGU4ZFxcdTBlOTQtXFx1MGU5N1xcdTBlOTktXFx1MGU5ZlxcdTBlYTEtXFx1MGVhM1xcdTBlYTVcXHUwZWE3XFx1MGVhYS1cXHUwZWFiXFx1MGVhZC1cXHUwZWIwXFx1MGViMi1cXHUwZWIzXFx1MGViZFxcdTBlYzAtXFx1MGVjNFxcdTBlYzZcXHUwZWQwLVxcdTBlZDlcXHUwZWRjLVxcdTBlZGRcXHUwZjAwXFx1MGYyMC1cXHUwZjI5XFx1MGY0MC1cXHUwZjQ3XFx1MGY0OS1cXHUwZjZjXFx1MGY4OC1cXHUwZjhiXFx1MTAwMC1cXHUxMDJhXFx1MTAzZi1cXHUxMDQ5XFx1MTA1MC1cXHUxMDU1XFx1MTA1YS1cXHUxMDVkXFx1MTA2MVxcdTEwNjUtXFx1MTA2NlxcdTEwNmUtXFx1MTA3MFxcdTEwNzUtXFx1MTA4MVxcdTEwOGVcXHUxMDkwLVxcdTEwOTlcXHUxMGEwLVxcdTEwYzVcXHUxMGQwLVxcdTEwZmFcXHUxMGZjXFx1MTEwMC1cXHUxMTU5XFx1MTE1Zi1cXHUxMWEyXFx1MTFhOC1cXHUxMWY5XFx1MTIwMC1cXHUxMjQ4XFx1MTI0YS1cXHUxMjRkXFx1MTI1MC1cXHUxMjU2XFx1MTI1OFxcdTEyNWEtXFx1MTI1ZFxcdTEyNjAtXFx1MTI4OFxcdTEyOGEtXFx1MTI4ZFxcdTEyOTAtXFx1MTJiMFxcdTEyYjItXFx1MTJiNVxcdTEyYjgtXFx1MTJiZVxcdTEyYzBcXHUxMmMyLVxcdTEyYzVcXHUxMmM4LVxcdTEyZDZcXHUxMmQ4LVxcdTEzMTBcXHUxMzEyLVxcdTEzMTVcXHUxMzE4LVxcdTEzNWFcXHUxMzgwLVxcdTEzOGZcXHUxM2EwLVxcdTEzZjRcXHUxNDAxLVxcdTE2NmNcXHUxNjZmLVxcdTE2NzZcXHUxNjgxLVxcdTE2OWFcXHUxNmEwLVxcdTE2ZWFcXHUxNzAwLVxcdTE3MGNcXHUxNzBlLVxcdTE3MTFcXHUxNzIwLVxcdTE3MzFcXHUxNzQwLVxcdTE3NTFcXHUxNzYwLVxcdTE3NmNcXHUxNzZlLVxcdTE3NzBcXHUxNzgwLVxcdTE3YjNcXHUxN2Q3XFx1MTdkY1xcdTE3ZTAtXFx1MTdlOVxcdTE4MTAtXFx1MTgxOVxcdTE4MjAtXFx1MTg3N1xcdTE4ODAtXFx1MThhOFxcdTE4YWFcXHUxOTAwLVxcdTE5MWNcXHUxOTQ2LVxcdTE5NmRcXHUxOTcwLVxcdTE5NzRcXHUxOTgwLVxcdTE5YTlcXHUxOWMxLVxcdTE5YzdcXHUxOWQwLVxcdTE5ZDlcXHUxYTAwLVxcdTFhMTZcXHUxYjA1LVxcdTFiMzNcXHUxYjQ1LVxcdTFiNGJcXHUxYjUwLVxcdTFiNTlcXHUxYjgzLVxcdTFiYTBcXHUxYmFlLVxcdTFiYjlcXHUxYzAwLVxcdTFjMjNcXHUxYzQwLVxcdTFjNDlcXHUxYzRkLVxcdTFjN2RcXHUxZDAwLVxcdTFkYmZcXHUxZTAwLVxcdTFmMTVcXHUxZjE4LVxcdTFmMWRcXHUxZjIwLVxcdTFmNDVcXHUxZjQ4LVxcdTFmNGRcXHUxZjUwLVxcdTFmNTdcXHUxZjU5XFx1MWY1YlxcdTFmNWRcXHUxZjVmLVxcdTFmN2RcXHUxZjgwLVxcdTFmYjRcXHUxZmI2LVxcdTFmYmNcXHUxZmJlXFx1MWZjMi1cXHUxZmM0XFx1MWZjNi1cXHUxZmNjXFx1MWZkMC1cXHUxZmQzXFx1MWZkNi1cXHUxZmRiXFx1MWZlMC1cXHUxZmVjXFx1MWZmMi1cXHUxZmY0XFx1MWZmNi1cXHUxZmZjXFx1MjA3MVxcdTIwN2ZcXHUyMDkwLVxcdTIwOTRcXHUyMTAyXFx1MjEwN1xcdTIxMGEtXFx1MjExM1xcdTIxMTVcXHUyMTE5LVxcdTIxMWRcXHUyMTI0XFx1MjEyNlxcdTIxMjhcXHUyMTJhLVxcdTIxMmRcXHUyMTJmLVxcdTIxMzlcXHUyMTNjLVxcdTIxM2ZcXHUyMTQ1LVxcdTIxNDlcXHUyMTRlXFx1MjE4My1cXHUyMTg0XFx1MmMwMC1cXHUyYzJlXFx1MmMzMC1cXHUyYzVlXFx1MmM2MC1cXHUyYzZmXFx1MmM3MS1cXHUyYzdkXFx1MmM4MC1cXHUyY2U0XFx1MmQwMC1cXHUyZDI1XFx1MmQzMC1cXHUyZDY1XFx1MmQ2ZlxcdTJkODAtXFx1MmQ5NlxcdTJkYTAtXFx1MmRhNlxcdTJkYTgtXFx1MmRhZVxcdTJkYjAtXFx1MmRiNlxcdTJkYjgtXFx1MmRiZVxcdTJkYzAtXFx1MmRjNlxcdTJkYzgtXFx1MmRjZVxcdTJkZDAtXFx1MmRkNlxcdTJkZDgtXFx1MmRkZVxcdTMwMDUtXFx1MzAwNlxcdTMwMzEtXFx1MzAzNVxcdTMwM2ItXFx1MzAzY1xcdTMwNDEtXFx1MzA5NlxcdTMwOWQtXFx1MzA5ZlxcdTMwYTEtXFx1MzBmYVxcdTMwZmMtXFx1MzBmZlxcdTMxMDUtXFx1MzEyZFxcdTMxMzEtXFx1MzE4ZVxcdTMxYTAtXFx1MzFiN1xcdTMxZjAtXFx1MzFmZlxcdTM0MDAtXFx1NGRiNVxcdTRlMDAtXFx1OWZjM1xcdWEwMDAtXFx1YTQ4Y1xcdWE1MDAtXFx1YTYwY1xcdWE2MTAtXFx1YTYyYlxcdWE2NDAtXFx1YTY1ZlxcdWE2NjItXFx1YTY2ZVxcdWE2ODAtXFx1YTY5N1xcdWE3MjItXFx1YTc4OFxcdWE3OGItXFx1YTc4Y1xcdWE3ZmItXFx1YTgwMVxcdWE4MDMtXFx1YTgwNVxcdWE4MDctXFx1YTgwYVxcdWE4MGMtXFx1YTgyMlxcdWE4NDAtXFx1YTg3M1xcdWE4ODItXFx1YThiM1xcdWE4ZDAtXFx1YThkOVxcdWE5MDAtXFx1YTkyNVxcdWE5MzAtXFx1YTk0NlxcdWFhMDAtXFx1YWEyOFxcdWFhNDAtXFx1YWE0MlxcdWFhNDQtXFx1YWE0YlxcdWFhNTAtXFx1YWE1OVxcdWFjMDAtXFx1ZDdhM1xcdWY5MDAtXFx1ZmEyZFxcdWZhMzAtXFx1ZmE2YVxcdWZhNzAtXFx1ZmFkOVxcdWZiMDAtXFx1ZmIwNlxcdWZiMTMtXFx1ZmIxN1xcdWZiMWRcXHVmYjFmLVxcdWZiMjhcXHVmYjJhLVxcdWZiMzZcXHVmYjM4LVxcdWZiM2NcXHVmYjNlXFx1ZmI0MC1cXHVmYjQxXFx1ZmI0My1cXHVmYjQ0XFx1ZmI0Ni1cXHVmYmIxXFx1ZmJkMy1cXHVmZDNkXFx1ZmQ1MC1cXHVmZDhmXFx1ZmQ5Mi1cXHVmZGM3XFx1ZmRmMC1cXHVmZGZiXFx1ZmU3MC1cXHVmZTc0XFx1ZmU3Ni1cXHVmZWZjXFx1ZmYxMC1cXHVmZjE5XFx1ZmYyMS1cXHVmZjNhXFx1ZmY0MS1cXHVmZjVhXFx1ZmY2Ni1cXHVmZmJlXFx1ZmZjMi1cXHVmZmM3XFx1ZmZjYS1cXHVmZmNmXFx1ZmZkMi1cXHVmZmQ3XFx1ZmZkYS1cXHVmZmRjXS9nLCBcIlwiKTsgLy9ub3JtYWxpemVkTmFtZSA9IG5vcm1hbGl6ZWROYW1lLnJlcGxhY2UoL1xcVyt8Xyt8XFx1MDBFOSsvZywgXCJcIik7XHJcblxyXG5cdFx0XHQvLyBQcmVmaXggd2l0aCAnXycgaWYgdGhlIG5hbWUgc3RhcnRzIHdpdGggYSBkaWdpdC4gTm90ZTogVGhlIHJlZ2V4IGV4cHJlc3Npb24gXFxkIGluIEphdmFzY3JpcHQgaXMgZXF1YWwgdG8gWzAtOV0uIFRoZSBleHByZXNzaW9uIGhhcyBiZWVuIHVwZGF0ZWQgdG8gaW5jbHVkZSBkaWdpdHMgZnJvbSBhbGwgbGFuZ3VhZ2VzIGFuZCBpcyBlcXVpdmFsZW50IHRvIHRoZSBleHByZXNzaW9uIFxcZCBpbiBDI1xyXG5cdFx0XHRpZiAoL15bXFx1MDAzMC1cXHUwMDNBXFx1MDY2MC1cXHUwNjZBXFx1MDZGMC1cXHUwNkZBXFx1MDdDMC1cXHUwN0NBXFx1MDk2Ni1cXHUwOTcwXFx1MDlFNi1cXHUwOUYwXFx1MEE2Ni1cXHUwQTcwXFx1MEFFNi1cXHUwQUYwXFx1MEI2Ni1cXHUwQjcwXFx1MEJFNi1cXHUwQkYwXFx1MEM2Ni1cXHUwQzcwXFx1MENFNi1cXHUwQ0YwXFx1MEQ2Ni1cXHUwRDcwXFx1MERFNi1cXHUwREYwXFx1MEU1MC1cXHUwRTVBXFx1MEVEMC1cXHUwRURBXFx1MEYyMC1cXHUwRjJBXFx1MTA0MC1cXHUxMDRBXFx1MTA5MC1cXHUxMDlBXFx1MTdFMC1cXHUxN0VBXFx1MTgxMC1cXHUxODFBXFx1MTk0Ni1cXHUxOTUwXFx1MTlEMC1cXHUxOURBXFx1MUE4MC1cXHUxQThBXFx1MUE5MC1cXHUxQTlBXFx1MUI1MC1cXHUxQjVBXFx1MUJCMC1cXHUxQkJBXFx1MUM0MC1cXHUxQzRBXFx1MUM1MC1cXHUxQzVBXFx1QTYyMC1cXHVBNjJBXFx1QThEMC1cXHVBOERBXFx1QTkwMC1cXHVBOTBBXFx1QTlEMC1cXHVBOURBXFx1QTlGMC1cXHVBOUZBXFx1QUE1MC1cXHVBQTVBXFx1QUJGMC1cXHVBQkZBXFx1RkYxMC1cXHVGRjFBXS8udGVzdChub3JtYWxpemVkTmFtZSkpIHtcclxuXHRcdFx0XHRub3JtYWxpemVkTmFtZSA9IFwiX1wiICsgbm9ybWFsaXplZE5hbWU7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiBub3JtYWxpemVkTmFtZTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcblxyXG5cdENvZ25pdG8uZ2V0Tm9ybWFsaXplZE5hbWUgPSBnZXROb3JtYWxpemVkTmFtZTtcclxuXHJcblx0ZnVuY3Rpb24gdG9CYXNlNjIobnVtYmVyKSB7XHJcblx0XHRpZiAodHlwZW9mIG51bWJlciA9PT0gXCJ1bmRlZmluZWRcIiB8fCBudW1iZXIgPT09IG51bGwpIHtcclxuXHRcdFx0cmV0dXJuIFwiXCI7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHR5cGVvZiBudW1iZXIgIT09IFwibnVtYmVyXCIpIHtcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiRnVuY3Rpb24gYHRvQmFzZTYyYCByZWNpZXZlZCBpbnZhbGlkICdudW1iZXInIHBhcmFtZXRlciBvZiB0eXBlICdcIiArICh0eXBlb2YgbnVtYmVyKSArIFwiJy5cIik7XHJcblx0XHR9IGVsc2UgaWYgKG51bWJlciA9PT0gMCkge1xyXG5cdFx0XHRyZXR1cm4gXCJcIjtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgZGlnaXRzID0gXCIwMTIzNDU2Nzg5YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWlwiO1xyXG5cclxuXHRcdHZhciB0ZXh0ID0gXCJcIjtcclxuXHJcblx0XHR2YXIgdmFsdWUgPSBudW1iZXI7XHJcblxyXG5cdFx0d2hpbGUgKHZhbHVlID4gMCkge1xyXG5cdFx0XHR2YXIgcmVtYWluZGVyID0gdmFsdWUgJSA2MjtcclxuXHRcdFx0dmFsdWUgPSBNYXRoLmZsb29yKHZhbHVlIC8gNjIpO1xyXG5cdFx0XHR0ZXh0ID0gZGlnaXRzLmNoYXJBdChyZW1haW5kZXIpICsgdGV4dDtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gdGV4dDtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGZyb21CYXNlNjIodGV4dCkge1xyXG5cdFx0aWYgKHR5cGVvZiB0ZXh0ID09PSBcInVuZGVmaW5lZFwiIHx8IHRleHQgPT09IG51bGwpIHtcclxuXHRcdFx0cmV0dXJuIDA7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHR5cGVvZiB0ZXh0ICE9PSBcInN0cmluZ1wiKSB7XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIkZ1bmN0aW9uIGBmcm9tQmFzZTYyYCByZWNpZXZlZCBpbnZhbGlkICd0ZXh0JyBwYXJhbWV0ZXIgb2YgdHlwZSAnXCIgKyAodHlwZW9mIHRleHQpICsgXCInLlwiKTtcclxuXHRcdH0gZWxzZSBpZiAodGV4dC5sZW5ndGggPT09IDApIHtcclxuXHRcdFx0cmV0dXJuIDA7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIGRpZ2l0cyA9IFwiMDEyMzQ1Njc4OWFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVpcIjtcclxuXHJcblx0XHR2YXIgbnVtYmVyID0gMDtcclxuXHJcblx0XHRmb3IgKHZhciBpID0gdGV4dC5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG5cdFx0XHR2YXIgYyA9IHRleHRbaV07XHJcblx0XHRcdHZhciBpZHggPSBkaWdpdHMuaW5kZXhPZihjKTtcclxuXHRcdFx0dmFyIGIgPSB0ZXh0Lmxlbmd0aCAtIDEgLSBpO1xyXG5cdFx0XHR2YXIgcG93ID0gTWF0aC5wb3coNjIsIGIpO1xyXG5cdFx0XHRudW1iZXIgKz0gcG93ICogaWR4O1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBudW1iZXI7XHJcblx0fVxyXG5cdC8vQ29nbml0by5mcm9tQmFzZTYyID0gZnJvbUJhc2U2MjtcclxuXHJcblx0ZnVuY3Rpb24gY29tYmluZVVJbnQxNnNXaXRoUGFkZGluZyhuMSwgbjIsIHJhbmRvbUJ5dGUxLCByYW5kb21CeXRlMikge1xyXG5cclxuXHRcdGlmIChuMSA+IDB4ZmZmZikge1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJWYWx1ZSBcIiArIG4xICsgXCIgZXhjZWVkcyBtYXhpbXVtIHVuc2lnbmVkIHNob3J0IHZhbHVlIG9mIFwiICsgMHhmZmZmICsgXCIuXCIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBuMUJ5dGVzID0gbjEgPiAweGZmID8gMiA6IDE7XHJcblxyXG5cdFx0aWYgKG4yID4gMHhmZmZmKSB7XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIlZhbHVlIFwiICsgbjIgKyBcIiBleGNlZWRzIG1heGltdW0gdW5zaWduZWQgc2hvcnQgdmFsdWUgb2YgXCIgKyAweGZmZmYgKyBcIi5cIik7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIG4yQnl0ZXMgPSBuMiA+IDB4ZmYgPyAyIDogMTtcclxuXHJcblx0XHRpZiAobjFCeXRlcyA+IDEgJiYgbjJCeXRlcyA+IDEpIHtcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiQm90aCB2YWx1ZXMgXCIgKyBuMSArIFwiIGFuZCBcIiArIG4yICsgXCIgZXhjZWVkcyBtYXhpbXVtIGJ5dGUgdmFsdWUgb2YgXCIgKyAweGZmICsgXCIuXCIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciByZXN1bHQgPSAwO1xyXG5cclxuXHRcdHZhciByYW5kb21CeXRlO1xyXG5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID4gMiAmJiB0eXBlb2YgcmFuZG9tQnl0ZTEgPT09IFwibnVtYmVyXCIpIHtcclxuXHRcdFx0cmFuZG9tQnl0ZSA9IHJhbmRvbUJ5dGUxO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0cmFuZG9tQnl0ZSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI1NSk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmFuZG9tQnl0ZSA9IHJhbmRvbUJ5dGUgJiAweGZmO1xyXG5cclxuXHRcdC8vIEJ5dGVzIGZvciBuMlxyXG5cdFx0cmVzdWx0ICs9IG4yO1xyXG5cclxuXHRcdC8vIEJ5dGVzIGZvciBuMVxyXG5cdFx0cmVzdWx0ICs9ICgobjEgPDwgKG4yQnl0ZXMgPT09IDIgPyAxNiA6IDgpKSkgPj4+IDA7XHJcblxyXG5cdFx0aWYgKG4xQnl0ZXMgPT09IDEgJiYgbjJCeXRlcyA9PT0gMSkge1xyXG5cdFx0XHQvLyBSYW5kb20gYnl0ZVxyXG5cdFx0XHRyZXN1bHQgKz0gcmFuZG9tQnl0ZSA8PCAxNjtcclxuXHJcblx0XHRcdC8vIEdlbmVyYXRlIGFub3RoZXIgcmFuZG9tIGJ5dGUgZm9yIHRoZSBoZWFkZXJcclxuXHRcdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIHR5cGVvZiByYW5kb21CeXRlMiA9PT0gXCJudW1iZXJcIikge1xyXG5cdFx0XHRcdHJhbmRvbUJ5dGUgPSByYW5kb21CeXRlMjtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRyYW5kb21CeXRlID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjU1KTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmFuZG9tQnl0ZSA9IHJhbmRvbUJ5dGUgJiAweGZmO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIEhlYWRlciBieXRlOiBuMSBhbmQgbjIgYnl0ZSBzaXplLCBhbmQgcmFuZG9tIGJpdHNcclxuXHRcdHZhciBoZWFkZXJCeXRlID0gMDtcclxuXHRcdGhlYWRlckJ5dGUgKz0gbjJCeXRlcztcclxuXHRcdGhlYWRlckJ5dGUgKz0gbjFCeXRlcyA8PCAyO1xyXG5cdFx0aGVhZGVyQnl0ZSArPSAocmFuZG9tQnl0ZSA8PCA0KSAmIDB4MDAwMDAwZjA7XHJcblx0XHRyZXN1bHQgKz0gKGhlYWRlckJ5dGUgPDwgMjQpID4+PiAwO1xyXG5cclxuXHRcdHJldHVybiByZXN1bHQ7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBzcGxpdFVJbnQzMldpdGhQYWRkaW5nKGkpIHtcclxuXHRcdHZhciBoZWFkZXJCeXRlID0gKGkgJiAweGZmMDAwMDAwKSA+Pj4gMjQ7XHJcblxyXG5cdFx0dmFyIG4yO1xyXG5cdFx0dmFyIG4yQnl0ZXMgPSAoaGVhZGVyQnl0ZSAmIDB4MDcpICYgMHgzO1xyXG5cdFx0aWYgKG4yQnl0ZXMgPT09IDIpIHtcclxuXHRcdFx0bjIgPSBpICYgMHgwMDAwZmZmZjtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdG4yID0gaSAmIDB4MDAwMDAwZmY7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIG4xO1xyXG5cdFx0dmFyIG4xQnl0ZXMgPSAoKGhlYWRlckJ5dGUgJiAweDBmKSA+PiAyKSAmIDB4MztcclxuXHRcdGlmIChuMkJ5dGVzID09PSAyKSB7XHJcblx0XHRcdG4xID0gKGkgPj4+IDE2KSAmIDB4ZmY7XHJcblx0XHR9IGVsc2UgaWYgKG4xQnl0ZXMgPT09IDIpIHtcclxuXHRcdFx0bjEgPSAoaSA+Pj4gOCkgJiAweGZmZmY7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRuMSA9IChpID4+PiA4KSAmIDB4ZmY7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIFtuMSwgbjJdO1xyXG5cdH1cclxuXHQvL0NvZ25pdG8uc3BsaXRVSW50MzJXaXRoUGFkZGluZyA9IHNwbGl0VUludDMyV2l0aFBhZGRpbmc7XHJcblxyXG5cdC8vIEluaXRpYWxpemVzIHRoZSBGb3JtIGFuZCBQYXJlbnRTZWN0aW9uIHByb3BlcnRpZXMgb24gYSBjaGlsZCBzZWN0aW9uXHJcblx0ZnVuY3Rpb24gaW5pdGlhbGl6ZVBhcmVudHMocGFyZW50LCBjaGlsZCkge1xyXG5cclxuXHRcdC8vIFNraXAgaW5pdGlhbGl6YXRpb24gb2YgbG9va3Vwc1xyXG5cdFx0aWYgKGNoaWxkIGluc3RhbmNlb2YgQ29nbml0by5Gb3Jtcy5Gb3JtRW50cnkpXHJcblx0XHRcdHJldHVybjtcclxuXHJcblx0XHQvLyBTZXQgdGhlIHBhcmVudCBzZWN0aW9uIGlmIHBvc3NpYmxlXHJcblx0XHRpZiAocGFyZW50ICYmIGNoaWxkLnNldF9QYXJlbnRTZWN0aW9uKVxyXG5cdFx0XHRjaGlsZC5fUGFyZW50U2VjdGlvbiA9IHBhcmVudDtcclxuXHJcblx0XHQvLyBTZXQgdGhlIGNvbnRhaW5pbmcgZm9ybSBpZiBwb3NzaWJsZVxyXG5cdFx0aWYgKHBhcmVudCAmJiBjaGlsZC5zZXRfRm9ybSkge1xyXG5cdFx0XHRpZiAocGFyZW50IGluc3RhbmNlb2YgQ29nbml0by5Gb3Jtcy5Gb3JtRW50cnkpXHJcblx0XHRcdFx0Y2hpbGQuX0Zvcm0gPSBwYXJlbnQ7XHJcblx0XHRcdGVsc2VcclxuXHRcdFx0XHRjaGlsZC5fRm9ybSA9IHBhcmVudC5nZXRfRm9ybSgpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRDb2duaXRvLmluaXRpYWxpemVQYXJlbnRzID0gaW5pdGlhbGl6ZVBhcmVudHM7XHJcblxyXG5cdC8qKlxyXG5cdCAqIEdlbmVyYXRlIGFuIGlkIGJhc2VkIG9uIHRoZSBnaXZlbiBlbnRyeSB2ZXJzaW9uIGFuZCBsaXN0IGl0ZW0gaW5kZXhcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gdmVyc2lvbiBUaGUgZm9ybSBlbnRyeSB2ZXJzaW9uIHRvIGJlIHNhdmVkXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGxpc3RJdGVtSW5kZXggVGhlIGl0ZW0ncyBpbmRleCBpbiB0aGUgbGlzdFxyXG5cdCAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBnZW5lcmF0ZWQgbGlzdCBpdGVtIElkXHJcblx0ICovXHJcblx0ZnVuY3Rpb24gZ2VuZXJhdGVMaXN0SXRlbUlkKHZlcnNpb24sIGxpc3RJdGVtSW5kZXgpIHtcclxuXHRcdHRyeSB7XHJcblx0XHRcdGlmICh2ZXJzaW9uID4gMHhmZmZmKVxyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIlZhbHVlIFwiICsgdmVyc2lvbiArIFwiIGV4Y2VlZHMgbWF4aW11bSB1bnNpZ25lZCBzaG9ydCB2YWx1ZSBvZiBcIiArIDB4ZmZmZiArIFwiLlwiKTtcclxuXHJcblx0XHRcdGlmIChsaXN0SXRlbUluZGV4ID4gMHhmZmZmKVxyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIlZhbHVlIFwiICsgbGlzdEl0ZW1JbmRleCArIFwiIGV4Y2VlZHMgbWF4aW11bSB1bnNpZ25lZCBzaG9ydCB2YWx1ZSBvZiBcIiArIDB4ZmZmZiArIFwiLlwiKTtcclxuXHJcblx0XHRcdHZhciBudW0gPSBjb21iaW5lVUludDE2c1dpdGhQYWRkaW5nKHZlcnNpb24sIGxpc3RJdGVtSW5kZXgsIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI1NSksIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI1NSkpO1xyXG5cdFx0XHR2YXIgaWQgPSB0b0Jhc2U2MihudW0pO1xyXG5cdFx0XHRyZXR1cm4gaWQ7XHJcblx0XHR9IGNhdGNoIChlKSB7XHJcblx0XHRcdC8vIElmIGFuIGVycm9yIG9jY3VycywgZmFsbCBiYWNrIHRvIGEgcHNldWRvLXJhbmRvbSBzdHJpbmdcclxuXHRcdFx0Ly8gVE9ETzogTG9nIGVycm9yIHRvIGFwcCBpbnNpZ2h0cz9cclxuXHRcdFx0cmV0dXJuIFwiUi1cIiArIEV4b1dlYi5yYW5kb21UZXh0KDEwLCB0cnVlKTtcclxuXHRcdH1cclxuXHR9XHJcblx0Q29nbml0by5nZW5lcmF0ZUxpc3RJdGVtSWQgPSBnZW5lcmF0ZUxpc3RJdGVtSWQ7XHJcblxyXG5cdC8vIEluaXRpYWxpemVzIHRoZSBGb3JtIGFuZCBQYXJlbnRTZWN0aW9uIHByb3BlcnRpZXMgb24gYSBjaGlsZCBzZWN0aW9uXHJcblx0ZnVuY3Rpb24gZ2V0UGFyZW50SW5pdGlhbGl6ZXIocGFyZW50KSB7XHJcblx0XHRyZXR1cm4gcGFyZW50IGluc3RhbmNlb2YgQ29nbml0by5Gb3Jtcy5Gb3JtRW50cnkgPyB7IEZvcm06IHBhcmVudCB9IDogeyBGb3JtOiBwYXJlbnQuZ2V0X0Zvcm0oKSwgUGFyZW50U2VjdGlvbjogcGFyZW50IH07XHJcblx0fVxyXG5cdENvZ25pdG8uZ2V0UGFyZW50SW5pdGlhbGl6ZXIgPSBnZXRQYXJlbnRJbml0aWFsaXplcjtcclxuXHJcblx0ZnVuY3Rpb24gYWRkTGlzdEl0ZW0ocGFyZW50LCBsaXN0LCBpdGVtKSB7XHJcblx0XHR2YXIgZm9ybUVudHJ5ID0gcGFyZW50IGluc3RhbmNlb2YgQ29nbml0by5Gb3Jtcy5Gb3JtRW50cnkgPyBwYXJlbnQgOiBwYXJlbnQuZ2V0X0Zvcm0oKTtcclxuXHRcdHZhciBjdXJyZW50RW50cnlWZXJzaW9uID0gZm9ybUVudHJ5LmdldF9FbnRyeSgpID8gKGZvcm1FbnRyeS5nZXRfRW50cnkoKS5nZXRfVmVyc2lvbigpIHx8IDApIDogMDtcclxuXHRcdHZhciBpZCA9IGdlbmVyYXRlTGlzdEl0ZW1JZChjdXJyZW50RW50cnlWZXJzaW9uICsgMSwgbGlzdC5sZW5ndGgpO1xyXG5cdFx0aWQgPSBlbnN1cmVVbmlxdWVMaXN0SXRlbUlkKGxpc3QsIGl0ZW0sIGlkKTtcclxuXHRcdGl0ZW0uc2V0X0lkKGlkKTtcclxuXHRcdGxpc3QuYWRkKGl0ZW0pO1xyXG5cdH1cclxuXHRDb2duaXRvLmFkZExpc3RJdGVtID0gYWRkTGlzdEl0ZW07XHJcblxyXG5cdGZ1bmN0aW9uIHJlbW92ZUxpc3RJdGVtKHBhcmVudCwgbGlzdCwgaXRlbSkge1xyXG5cdFx0Ly8gRGVsZXRlL2Rlc3RvcnkgdGhlIGl0ZW1cclxuXHRcdGl0ZW0gPSBDb2duaXRvLmRlbGV0ZUVudGl0eShpdGVtKTtcclxuXHJcblx0XHR2YXIgaWR4ID0gbGlzdC5pbmRleE9mKGl0ZW0pO1xyXG5cdFx0bGlzdC5yZW1vdmUoaXRlbSk7XHJcblxyXG5cdFx0dmFyIGZvcm1FbnRyeSA9IHBhcmVudCBpbnN0YW5jZW9mIENvZ25pdG8uRm9ybXMuRm9ybUVudHJ5ID8gcGFyZW50IDogcGFyZW50LmdldF9Gb3JtKCk7XHJcblx0XHR2YXIgY3VycmVudEVudHJ5VmVyc2lvbiA9IGZvcm1FbnRyeS5nZXRfRW50cnkoKSA/IChmb3JtRW50cnkuZ2V0X0VudHJ5KCkuZ2V0X1ZlcnNpb24oKSB8fCAwKSA6IDA7XHJcblxyXG5cdFx0dmFyIGl0ZW1zVG9FbnN1cmVVbmlxdWVJZHMgPSBbXTtcclxuXHJcblx0XHQvLyBSZWdlbmVyYXRlIElkcyBmb3IgaXRlbXMgbm90IHlldCBwZXJzaXN0ZWRcclxuXHRcdGZvciAodmFyIGkgPSAoaWR4ID49IDAgPyBpZHggOiAwKTsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0dmFyIGl0ZW0gPSBsaXN0W2ldO1xyXG5cdFx0XHRpZiAoaXRlbS5nZXRfSWQoKSkge1xyXG5cdFx0XHRcdHRyeSB7XHJcblx0XHRcdFx0XHQvLyBBdHRlbXB0IHRvIGRlY29kZSB0aGUgaXRlbSdzIGdlbmVyYXRlZCBJZFxyXG5cdFx0XHRcdFx0dmFyIG51bSA9IGZyb21CYXNlNjIoaXRlbS5nZXRfSWQoKSk7XHJcblx0XHRcdFx0XHR2YXIgbnVtQ29tcHMgPSBzcGxpdFVJbnQzMldpdGhQYWRkaW5nKG51bSk7XHJcblx0XHRcdFx0XHR2YXIgaXRlbUVudHJ5VmVyc2lvbiA9IG51bUNvbXBzWzBdO1xyXG5cdFx0XHRcdFx0dmFyIGl0ZW1BdEluZGV4ID0gbnVtQ29tcHNbMV07XHJcblxyXG5cdFx0XHRcdFx0Ly8gUG90ZW50aWFsbHkgcmVhc3NpZ24gdGhlIElkIGlmIGl0IHdhcyBnZW5lcmF0ZWQgZm9yIHRoZSBuZXh0L3BlbmRpbmcgdmVyc2lvbiBvZiB0aGUgZW50cnlcclxuXHRcdFx0XHRcdGlmIChpdGVtRW50cnlWZXJzaW9uID09PSBjdXJyZW50RW50cnlWZXJzaW9uICsgMSkge1xyXG5cdFx0XHRcdFx0XHRpdGVtc1RvRW5zdXJlVW5pcXVlSWRzLnB1c2goaXRlbSk7XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBSZS1nZW5lcmF0ZSB0aGUgSWQgaWYgaXQgZG9lc24ndCBtYXRjaCBpdHMgY3VycmVudCBpbmRleCAoZXg6IG1vdmVkIGR1ZSB0byBkZWxldGlvbiBvZiBhbm90aGVyIGl0ZW0pXHJcblx0XHRcdFx0XHRcdGlmIChpdGVtQXRJbmRleCAhPT0gaSkge1xyXG5cdFx0XHRcdFx0XHRcdGl0ZW0uc2V0X0lkKGdlbmVyYXRlTGlzdEl0ZW1JZChjdXJyZW50RW50cnlWZXJzaW9uICsgMSwgaSkpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSBjYXRjaCAoZSkge1xyXG5cdFx0XHRcdFx0Ly8gSWdub3JlIGVycm9yIGlmIHVuYWJsZSB0byBkZWNvZGUgSWQgb3IgY3JlYXRlIG5ldyBJZFxyXG5cdFx0XHRcdFx0Ly8gVE9ETzogU2VuZCBlcnJvciB0byBhcHAgaW5zaWdodHM/XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gRW5zdXJlIHVuaXF1ZSBJZHMgYWZ0ZXIgcHJvY2Vzc2luZyBhbGwgaXRlbXMgc2luY2UgbXVsdGlwbGUgaXRlbXMgY291bGQgaGF2ZSBJZHMgcmVhc3NpZ25lZCBkdWUgdG8gdGhlIHJlbW92YWxcclxuXHRcdHZhciBpZE1hcCA9IGdldExpc3RJdGVtSWRNYXAobGlzdCk7XHJcblx0XHRpdGVtc1RvRW5zdXJlVW5pcXVlSWRzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcclxuXHRcdFx0dmFyIGlkID0gZW5zdXJlVW5pcXVlTGlzdEl0ZW1JZChsaXN0LCBpdGVtLCBpdGVtLmdldF9JZCgpLCBpZE1hcCk7XHJcblx0XHRcdGlmIChpZCAhPT0gaXRlbS5nZXRfSWQoKSkge1xyXG5cdFx0XHRcdGl0ZW0uc2V0X0lkKGlkKTtcclxuXHRcdFx0XHRpZE1hcFtpZF0gPSBpdGVtO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHR9XHJcblx0Q29nbml0by5yZW1vdmVMaXN0SXRlbSA9IHJlbW92ZUxpc3RJdGVtO1xyXG5cclxuXHQvKipcclxuXHQgKiBHZXQgYSBtYXAgb2YgbGlzdCBpdGVtIGlkcyB0byB0aGVpciBpbmRleCBpbiB0aGUgbGlzdFxyXG5cdCAqIEBwYXJhbSB7QXJyYXl9IGxpc3RcclxuXHQgKiBAcmV0dXJucyB7eyBba2V5OiBzdHJpbmddOiBPYmplY3QgfX1cclxuXHQgKi9cclxuXHRmdW5jdGlvbiBnZXRMaXN0SXRlbUlkTWFwKGxpc3QpIHtcclxuXHRcdHZhciBpZE1hcCA9IHt9O1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdGlmIChsaXN0W2ldKSB7XHJcblx0XHRcdFx0dmFyIGlkID0gbGlzdFtpXS5nZXRfSWQoKTtcclxuXHRcdFx0XHRpZiAoaWQgJiYgIWlkTWFwLmhhc093blByb3BlcnR5KGlkKSkge1xyXG5cdFx0XHRcdFx0aWRNYXBbaWRdID0gbGlzdFtpXTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHJldHVybiBpZE1hcDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEVuc3VyZXMgdGhhdCB0aGUgZ2l2ZW4gaWQgaXMgdW5pcXVlIHRvIHRoZSBsaXN0LFxyXG5cdCAqIGFuZCByZXR1cm5zIGEgdW5pcXVlIHBzZXVkby1yYW5kb20gaWQgaWYgaXQgaXMgbm90XHJcblx0ICogQHBhcmFtIHtBcnJheX0gbGlzdCBUaGUgbGlzdCBvZiBpdGVtc1xyXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBpdGVtIFRoZSBpdGVtIGluIHRoZSBsaXN0IHdobydzIElkIGlzIGJlaW5nIHZhbGlkYXRlZFxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBpZCBUaGUgaWQgdG8gY2hlY2sgZm9yIHVuaXF1ZW5lc3NcclxuXHQgKiBAcGFyYW0ge3sgW2tleTogc3RyaW5nXTogT2JqZWN0IH19IGlkTWFwIEFuIG9wdGlvbmFsIHByZS1idWlsdCBtYXAgb2YgaWRzIHRvIGl0ZW1zXHJcblx0ICogQHJldHVybnMge3N0cmluZ30gVGhlIHVuaXF1ZSBsaXN0IGl0ZW0gSWQgdG8gdXNlXHJcblx0ICovXHJcblx0ZnVuY3Rpb24gZW5zdXJlVW5pcXVlTGlzdEl0ZW1JZChsaXN0LCBpdGVtLCBpZCwgaWRNYXApIHtcclxuXHRcdC8vIEdlbmVyYXRlIHRoZSBpZCBtYXAgb24tZGVtYW5kIGlmIG5lZWRlZFxyXG5cdFx0aWYgKCFpZE1hcCkge1xyXG5cdFx0XHRpZE1hcCA9IGdldExpc3RJdGVtSWRNYXAobGlzdCk7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIGl0ZW1Gb3JJZCA9IGlkTWFwW2lkXTtcclxuXHJcblx0XHQvLyBJZiB0aGUgSWQgaXNuJ3QgdXNlZCBvciBpcyB1c2VkIGJ5IHRoZSBpdGVtIGJlaW5nIGNoZWNrZWQsIHRoZW4gcmV0dXJuIGl0XHJcblx0XHRpZiAoIWl0ZW1Gb3JJZCB8fCBpdGVtRm9ySWQgPT09IGl0ZW0pIHtcclxuXHRcdFx0cmV0dXJuIGlkO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIE90aGVyd2lzZSwgZmFsbCBiYWNrIHRvIGEgcHNldWRvLXJhbmRvbSBzdHJpbmdcclxuXHRcdGZvciAodmFyIGF0dGVtcHRzID0gMDsgYXR0ZW1wdHMgPCAxMDsgYXR0ZW1wdHMrKykge1xyXG5cdFx0XHRpZCA9IFwiUi1cIiArIEV4b1dlYi5yYW5kb21UZXh0KDEwICsgYXR0ZW1wdHMsIHRydWUpO1xyXG5cdFx0XHRpdGVtRm9ySWQgPSBpZE1hcFtpZF07XHJcblx0XHRcdGlmICghaXRlbUZvcklkKSB7XHJcblx0XHRcdFx0cmV0dXJuIGlkO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gRG9uJ3QgYXNzaWduIGFuIGlkIHJhdGhlciB0aGFuIGtub3dpbmdseSB1c2UgYSBkdXBsaWNhdGVcclxuXHRcdHJldHVybiBudWxsO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gcG9wdWxhdGVMb29rdXAocHJvcCwgdmFsdWVzLCBpc0VudW0pIHtcclxuXHRcdHZhciBwcm9wTWV0YSA9IHByb3AudmFsdWUobnVsbCk7XHJcblxyXG5cdFx0aWYgKHByb3BNZXRhLl9sYXp5TG9hZGVyKSB7XHJcblx0XHRcdHByb3BNZXRhLl9sYXp5TG9hZGVyLmFsbFByb3BzLmNvbnN0cnVjdG9yLnVucmVnaXN0ZXIocHJvcE1ldGEsIHByb3BNZXRhLl9sYXp5TG9hZGVyLmFsbFByb3BzKTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoaXNFbnVtKSB7XHJcblx0XHRcdHByb3AuZ2V0X2NvbnRhaW5pbmdUeXBlKCkuX2lzRW51bSA9IHRydWU7XHJcblx0XHR9XHJcblxyXG5cdFx0cHJvcE1ldGEucHVzaC5hcHBseShwcm9wTWV0YSwgdmFsdWVzKTtcclxuXHR9XHJcblx0Q29nbml0by5wb3B1bGF0ZUxvb2t1cCA9IHBvcHVsYXRlTG9va3VwO1xyXG5cclxuXHRmdW5jdGlvbiBhZGRNb2R1bGUobW9kdWxlKSB7XHJcblxyXG5cdFx0aWYgKENvZ25pdG8uaGFzT3duUHJvcGVydHkobW9kdWxlKSlcclxuXHRcdFx0cmV0dXJuIENvZ25pdG9bbW9kdWxlXTtcclxuXHJcblx0XHRyZXR1cm4gbmV3IENvZ25pdG8uTW9kdWxlKG1vZHVsZSk7XHJcblx0fVxyXG5cdENvZ25pdG8uYWRkTW9kdWxlID0gYWRkTW9kdWxlO1xyXG5cclxuXHRmdW5jdGlvbiBsb2FkRmlsZURhdGEobW9kdWxlLCBhcGksIGZpbGVEYXRhSWQsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykge1xyXG5cdFx0Q29nbml0by5zZXJ2aWNlUmVxdWVzdCh7XHJcblx0XHRcdGVuZHBvaW50OiBtb2R1bGUgKyBcIi9cIiArIGFwaSArIFwiL0ZpbGVcIixcclxuXHRcdFx0bWV0aG9kOiBcIkdFVFwiLFxyXG5cdFx0XHRkYXRhOiB7IGlkOiBmaWxlRGF0YUlkIH0sXHJcblx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XHJcblx0XHRcdFx0aWYgKGRhdGEpIHtcclxuXHRcdFx0XHRcdGlmIChzdWNjZXNzQ2FsbGJhY2spIHtcclxuXHRcdFx0XHRcdFx0c3VjY2Vzc0NhbGxiYWNrLmFwcGx5KHRoaXMsIFtkYXRhXSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9LFxyXG5cdFx0XHRlcnJvcjogZnVuY3Rpb24gKGRhdGEpIHtcclxuXHRcdFx0XHRpZiAoZXJyb3JDYWxsYmFjaykge1xyXG5cdFx0XHRcdFx0ZXJyb3JDYWxsYmFjay5hcHBseSgpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fVxyXG5cdENvZ25pdG8ubG9hZEZpbGVEYXRhID0gbG9hZEZpbGVEYXRhO1xyXG5cclxuXHRmdW5jdGlvbiBnZXREeW5hbWljVHlwZShiYXNlVHlwZSwgZGlzY3JpbWluYXRvcikge1xyXG5cclxuXHRcdC8vIGFsbG93IGJhc2UgdHlwZSB0byBiZSBlaXRoZXIgdGhlIGFjdHVhbCBKUyB0eXBlIG9yIHRoZSBuYW1lIG9mIHRoZSBiYXNlIHR5cGVcclxuXHRcdGlmICghKGJhc2VUeXBlIGluc3RhbmNlb2YgU3RyaW5nKSAmJiBiYXNlVHlwZS5tZXRhKVxyXG5cdFx0XHRiYXNlVHlwZSA9IGJhc2VUeXBlLm1ldGEuZ2V0X2Z1bGxOYW1lKCk7XHJcblxyXG5cdFx0dmFyIHR5cGVJbmZvID0gQ29nbml0by5keW5hbWljVHlwZXNbYmFzZVR5cGVdO1xyXG5cclxuXHRcdGlmICh0eXBlSW5mbykge1xyXG5cclxuXHRcdFx0Ly8gZ2V0IHR5cGUgZGlzY3JpbWluYXRvclxyXG5cdFx0XHRpZiAoZGlzY3JpbWluYXRvciBpbnN0YW5jZW9mIE9iamVjdClcclxuXHRcdFx0XHRkaXNjcmltaW5hdG9yID0gZGlzY3JpbWluYXRvclt0eXBlSW5mby5EaXNjcmltaW5hdG9yXS5JZDtcclxuXHRcdFx0dmFyIGR5bmFtaWNUeXBlID0gdHlwZUluZm8uVHlwZXNbZGlzY3JpbWluYXRvcl07XHJcblxyXG5cdFx0XHQvLyByZXR1cm4gdGhlIGRpc2NyaW1pbmF0ZWQgZHluYW1pYyB0eXBlIGlmIGZvdW5kXHJcblx0XHRcdGlmIChkeW5hbWljVHlwZSlcclxuXHRcdFx0XHRyZXR1cm4gZHluYW1pY1R5cGU7XHJcblxyXG5cdFx0XHQvLyBjcmVhdGUgYmFzZSBvcmcgdHlwZVxyXG5cdFx0XHRkeW5hbWljVHlwZSA9IGNvbnRleHQubW9kZWwubWV0YS50eXBlKGJhc2VUeXBlICsgXCIuXCIgKyBDb2duaXRvLmNvbmZpZy5vcmdhbml6YXRpb25Db2RlKTtcclxuXHRcdFx0aWYgKGR5bmFtaWNUeXBlKSB7XHJcblx0XHRcdFx0cmV0dXJuIGR5bmFtaWNUeXBlLmdldF9qc3R5cGUoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Q29nbml0by5nZXREeW5hbWljVHlwZSA9IGdldER5bmFtaWNUeXBlO1xyXG5cclxuXHQvLyBSZXR1cm5zIGFuIE9EYXRhIHF1ZXJ5IHN0cmluZyBiYXNlZCBvbiB0aGUgc3BlY2lmaWVkIEphdmFTY3JpcHQgb2JqZWN0LiBJZiB0aGUgcHJvcGVydHkgdHlwZSBpcyBhbiBBcnJheSB0aGVuIGFuIGV4cHJlc3Npb24gY2hlY2tpbmcgd2hldGhlclxyXG5cdC8vIHRoZSBwcm9wZXJ0eSB2YWx1ZSBtYXRjaGVzIGFueSB2YWx1ZXMgc3BlY2lmZWQgaXMgY3JlYXRlZCwgaS5lLiwgV2hlcmUgdmFsdWUgaW4gKCwuLm4pLlxyXG5cdC8vIEV4YW1wbGU6IHsgSWRlbnRpZmllcjogXCIxMjNcIiwgVHlwZTogW1wiVHJlZVwiLCBcIlJlc2lkZW50aWFsXCJdIH0gcmV0dXJucyBzdWJzdHJpbmdvZihJZGVudGlmaWVyLCBcIjEyM1wiKSBlcSB0cnVlIGFuZCAoVHlwZSBlcSBcIlRyZWVcIiBvciBUeXBlIGVxIFwiUmVzaWRlbnRpYWxcIilcclxuXHRDb2duaXRvLmdldE9kYXRhRmlsdGVyID0gZnVuY3Rpb24gKHNlYXJjaENvbmRpdGlvbikge1xyXG5cdFx0dmFyIGZpbHRlciA9IFwiXCI7XHJcblx0XHRmb3IgKHZhciBrZXkgaW4gc2VhcmNoQ29uZGl0aW9uKSB7XHJcblx0XHRcdHZhciB2YWx1ZSA9IHNlYXJjaENvbmRpdGlvbltrZXldO1xyXG5cdFx0XHRpZiAodmFsdWUpIHtcclxuXHRcdFx0XHRpZiAoISh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5KSkge1xyXG5cdFx0XHRcdFx0Ly92YXIgZXhwID0gXCJzdWJzdHJpbmdvZihcIiArIGtleSArIFwiLCAnXCIgKyB2YWx1ZSArIFwiJykgZXEgdHJ1ZVwiO1xyXG5cdFx0XHRcdFx0dmFyIGV4cCA9IFwic3RhcnRzd2l0aChcIiArIGtleSArIFwiLCAnXCIgKyB2YWx1ZSArIFwiJylcIjtcclxuXHRcdFx0XHRcdGZpbHRlciA9IGZpbHRlciA9PSBcIlwiID8gZXhwIDogZmlsdGVyICsgXCIgYW5kIFwiICsgZXhwO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHZhciBjaG9pY2VFeHAgPSBcIlwiO1xyXG5cdFx0XHRcdFx0dmFsdWUuZm9yRWFjaChmdW5jdGlvbiAodikge1xyXG5cdFx0XHRcdFx0XHR2YXIgZXhwID0ga2V5ICsgXCIgZXEgJ1wiICsgdiArIFwiJ1wiO1xyXG5cdFx0XHRcdFx0XHRjaG9pY2VFeHAgPSBjaG9pY2VFeHAgPT0gXCJcIiA/IFwiKFwiICsgZXhwIDogY2hvaWNlRXhwICsgXCIgb3IgXCIgKyBleHA7XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdGNob2ljZUV4cCA9IGNob2ljZUV4cCArIFwiKVwiXHJcblx0XHRcdFx0XHRmaWx0ZXIgPSBmaWx0ZXIgPT0gXCJcIiA/IGNob2ljZUV4cCA6IGZpbHRlciArIFwiIGFuZCBcIiArIGNob2ljZUV4cDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gZmlsdGVyO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gZ2V0Q2hvaWNlT3B0aW9ucyhhZGFwdGVyKSB7XHJcblx0XHR2YXIgb3B0aW9ucyA9IFtdO1xyXG5cdFx0JC5ncmVwKGFkYXB0ZXIuZ2V0X29wdGlvbnMoKSwgZnVuY3Rpb24gKG9wdGlvbikgeyBvcHRpb25zLnB1c2gob3B0aW9uLmdldF9yYXdWYWx1ZSgpKTsgfSk7XHJcblx0XHR2YXIgb3RoZXJWYWx1ZSA9IG51bGw7XHJcblx0XHR2YXIgaXNDaGVja2JveExpc3QgPSAkLmlzQXJyYXkoYWRhcHRlci5nZXRfcmF3VmFsdWUoKSk7XHJcblxyXG5cdFx0Ly8gQ2hlY2tib3hcclxuXHRcdGlmIChpc0NoZWNrYm94TGlzdClcclxuXHRcdFx0b3RoZXJWYWx1ZSA9ICQoYWRhcHRlci5nZXRfcmF3VmFsdWUoKSkubm90KG9wdGlvbnMpLmdldCgpWzBdID8gJChhZGFwdGVyLmdldF9yYXdWYWx1ZSgpKS5ub3Qob3B0aW9ucykuZ2V0KClbMF0gOiBcIlwiO1xyXG5cclxuXHRcdFx0Ly8gUmFkaW9cclxuXHRcdGVsc2VcclxuXHRcdFx0b3RoZXJWYWx1ZSA9ICFvcHRpb25zLmNvbnRhaW5zKGFkYXB0ZXIuZ2V0X3Jhd1ZhbHVlKCkpID8gYWRhcHRlci5nZXRfcmF3VmFsdWUoKSA6IFwiXCI7XHJcblxyXG5cdFx0dmFyIG90aGVyT3B0aW9uQWRhcHRlciA9IG5ldyBFeG9XZWIuVmlldy5PcHRpb25BZGFwdGVyKGFkYXB0ZXIsIG90aGVyVmFsdWUpO1xyXG5cdFx0b3RoZXJPcHRpb25BZGFwdGVyLmlzRmlsbEluT3B0aW9uID0gdHJ1ZTtcclxuXHJcblx0XHQvLyBFbnN1cmUgdGhhdCBibGFuayB2YWx1ZXMgYXJlIG5vdCBjb25zaWRlcmVkIHNlbGVjdGVkIHdoZW4gYmluZGluZyByYWRpbyBidXR0b25zXHJcblx0XHRcdG90aGVyT3B0aW9uQWRhcHRlci5nZXRfb3RoZXJTZWxlY3RlZCA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0cmV0dXJuIG90aGVyT3B0aW9uQWRhcHRlci5nZXRfc2VsZWN0ZWQoKSAmJiAhIW90aGVyT3B0aW9uQWRhcHRlci5nZXRfZGlzcGxheVZhbHVlKCk7XHJcblx0XHR9O1xyXG5cdFx0b3RoZXJPcHRpb25BZGFwdGVyLnNldF9vdGhlclNlbGVjdGVkID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcblx0XHRcdG90aGVyT3B0aW9uQWRhcHRlci5zZXRfc2VsZWN0ZWQodmFsdWUpO1xyXG5cdFx0XHRpZiAoIXZhbHVlKVxyXG5cdFx0XHRcdG90aGVyT3B0aW9uQWRhcHRlci5zZXRfZGlzcGxheVZhbHVlKG51bGwpO1xyXG5cclxuXHRcdFx0U3lzLk9ic2VydmVyLnJhaXNlUHJvcGVydHlDaGFuZ2VkKHRoaXMsIFwib3RoZXJTZWxlY3RlZFwiKTtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRyZXR1cm4gYWRhcHRlci5nZXRfb3B0aW9ucygpLmNvbmNhdChbb3RoZXJPcHRpb25BZGFwdGVyXSk7XHJcblx0fVxyXG5cdENvZ25pdG8uZ2V0Q2hvaWNlT3B0aW9ucyA9IGdldENob2ljZU9wdGlvbnM7XHJcblxyXG5cdC8vIEdldHMgYSB2YWx1ZSBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIG1vZGVsIGlzIHZhbGlkIGJ5IHRyYXZlcnNpbmcgdGhlIG9iamVjdCBtb2RlbCBzZWFyY2hpbmcgZm9yXHJcblx0Ly8gY29uZGl0aW9ucy4gWW91IGNhbiBhbHNvIHNlYXJjaCBmb3IgYSBzcGVjaWZpYyBjb25kaXRpb24gYnkgc3BlY2lmeWluZyB0aGUgY29uZGl0aW9uIGNvZGUuXHJcblx0ZnVuY3Rpb24gaXNNb2RlbFZhbGlkKG9iaiwgY29uZGl0aW9uQ29kZSkge1xyXG5cdFx0aWYgKG9iai5tZXRhLmNvbmRpdGlvbnMoKS5sZW5ndGggPiAwKSB7XHJcblx0XHRcdGlmICghY29uZGl0aW9uQ29kZSlcclxuXHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHQvLyBTZWFyY2ggZm9yIHNwZWNpZmljIGNvbmRpdGlvbiBjb2RlXHJcblx0XHRcdGVsc2UgaWYgKG9iai5tZXRhLmNvbmRpdGlvbnMoKS5maWx0ZXIoZnVuY3Rpb24gKGMpIHsgcmV0dXJuIGMudHlwZS5jb2RlID09PSBjb25kaXRpb25Db2RlOyB9KS5sZW5ndGggPiAwKVxyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdH1cclxuXHJcblx0XHRcdHZhciBwcm9wZXJ0eUluZm9zID0gb2JqLm1ldGEudHlwZS5nZXRfcHJvcGVydGllcygpO1xyXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHByb3BlcnR5SW5mb3MubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHR2YXIgcHJvcEluZm8gPSBwcm9wZXJ0eUluZm9zW2ldO1xyXG5cclxuXHRcdFx0XHQvLyBEbyBub3QgdmFsaWRhdGUgc3RhdGljIG9yIGNhbGN1bGF0ZWQgcHJvcGVydGllc1xyXG5cdFx0XHRcdGlmIChwcm9wSW5mby5nZXRfaXNTdGF0aWMoKSB8fCAhcHJvcEluZm8uZ2V0X2lzUGVyc2lzdGVkKCkgfHwgQ29nbml0by5pc1Byb3BlcnR5TG9va3VwKHByb3BJbmZvKSlcclxuXHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cclxuXHRcdFx0XHR2YXIgZmllbGROYW1lID0gcHJvcEluZm8uZ2V0X2ZpZWxkTmFtZSgpO1xyXG5cdFx0XHRcdGlmIChvYmpbZmllbGROYW1lXSAmJiBvYmpbZmllbGROYW1lXS5tZXRhICYmIG9ialtmaWVsZE5hbWVdLm1ldGEgaW5zdGFuY2VvZiBFeG9XZWIuTW9kZWwuT2JqZWN0TWV0YSkge1xyXG5cdFx0XHRcdGlmICghaXNNb2RlbFZhbGlkKG9ialtmaWVsZE5hbWVdLCBjb25kaXRpb25Db2RlKSkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdH0gZWxzZSBpZiAocHJvcEluZm8uZ2V0X2lzTGlzdCgpKSB7XHJcblx0XHRcdFx0XHR2YXIgY2hpbGRyZW4gPSBvYmpbZmllbGROYW1lXTtcclxuXHRcdFx0XHRcdGlmIChjaGlsZHJlbikge1xyXG5cdFx0XHRcdFx0XHRmb3IgKHZhciBqID0gMDsgaiA8IGNoaWxkcmVuLmxlbmd0aDsgaisrKSB7XHJcblx0XHRcdFx0XHRcdFx0dmFyIGNoaWxkID0gY2hpbGRyZW5bal07XHJcblx0XHRcdFx0XHRcdFx0aWYgKGNoaWxkLm1ldGEgJiYgY2hpbGQubWV0YSBpbnN0YW5jZW9mIEV4b1dlYi5Nb2RlbC5PYmplY3RNZXRhKVxyXG5cdFx0XHRcdFx0XHRcdGlmICghaXNNb2RlbFZhbGlkKGNoaWxkLCBjb25kaXRpb25Db2RlKSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRyZXR1cm4gdHJ1ZTtcclxuXHR9XHJcblxyXG5cdENvZ25pdG8uaXNNb2RlbFZhbGlkID0gaXNNb2RlbFZhbGlkO1xyXG5cclxuXHQvLyBHZXQgZW51bWVyYXRpb24gd2l0aCB0eXBlIGFuZCBuYW1lXHJcblx0ZnVuY3Rpb24gZ2V0RW51bVdpdGhOYW1lKGVudW1UeXBlLCBuYW1lKSB7XHJcblx0XHRyZXR1cm4gZW51bVR5cGUuZ2V0X0FsbCgpLmZpbHRlcihmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5nZXRfTmFtZSgpID09PSBuYW1lOyB9KVswXTtcclxuXHR9XHJcblx0Q29nbml0by5nZXRFbnVtV2l0aE5hbWUgPSBnZXRFbnVtV2l0aE5hbWU7XHJcblxyXG5cdENvZ25pdG8uZ2V0SnNUeXBlID0gZnVuY3Rpb24gKHR5cGVOYW1lKSB7XHJcblx0XHRpZiAodHlwZU5hbWUgPT09IG51bGwpXHJcblx0XHRcdHJldHVybiBudWxsO1xyXG5cdFx0dmFyIHR5cGVzID0gY29udGV4dC5tb2RlbC5tZXRhLnR5cGVzKCkuZmlsdGVyKGZ1bmN0aW9uICh0KSB7IHJldHVybiB0LmdldF9mdWxsTmFtZSgpLnRvTG93ZXJDYXNlKCkgPT09IHR5cGVOYW1lLnRvTG93ZXJDYXNlKCk7IH0pO1xyXG5cdFx0cmV0dXJuIHR5cGVzLmxlbmd0aCA+IDAgPyB0eXBlc1swXS5nZXRfanN0eXBlKCkgOiBudWxsO1xyXG5cdH07XHJcblxyXG5cdGZ1bmN0aW9uIGZvcm1hdFVybCh1cmwsIGVudGl0eSkge1xyXG5cdFx0dmFyIHVybFBhcnRzID0gdXJsLnNwbGl0KFwiP1wiKTtcclxuXHJcblx0XHRpZiAodXJsLmluZGV4T2YoXCI/XCIpID49IDApIHtcclxuXHJcblx0XHRcdHZhciBkb21haW5QYXJ0ID0gdXJsLnN1YnN0cigwLCB1cmwuaW5kZXhPZihcIj9cIikgKyAxKTtcclxuXHRcdFx0dmFyIHFzUGFydCA9IHVybC5zdWJzdHIoZG9tYWluUGFydC5sZW5ndGgpO1xyXG5cclxuXHRcdFx0dmFyIHJlZGlyZWN0VXJsID0gRXhvV2ViLk1vZGVsLkZvcm1hdC5mcm9tVGVtcGxhdGUoZW50aXR5Lm1ldGEudHlwZSwgZG9tYWluUGFydCwgZnVuY3Rpb24gKGVudGl0eSkgeyByZXR1cm4gZW50aXR5OyB9KS5jb252ZXJ0KGVudGl0eSk7XHJcblx0XHRcdHZhciBxdWVyeVN0cmluZyA9IEV4b1dlYi5Nb2RlbC5Gb3JtYXQuZnJvbVRlbXBsYXRlKGVudGl0eS5tZXRhLnR5cGUsIHFzUGFydCwgZnVuY3Rpb24gKGVudGl0eSkgeyByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KGVudGl0eSk7IH0pLmNvbnZlcnQoZW50aXR5KTtcclxuXHJcblx0XHRcdHJldHVybiByZWRpcmVjdFVybCArIHF1ZXJ5U3RyaW5nO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0cmV0dXJuIEV4b1dlYi5Nb2RlbC5Gb3JtYXQuZnJvbVRlbXBsYXRlKGVudGl0eS5tZXRhLnR5cGUsIHVybCwgZnVuY3Rpb24gKGVudGl0eSkgeyByZXR1cm4gZW50aXR5OyB9KS5jb252ZXJ0KGVudGl0eSk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRDb2duaXRvLmZvcm1hdFVybCA9IGZvcm1hdFVybDtcclxuICAgIGZ1bmN0aW9uIGZvcm1hdFRleHQodmFsdWUpIHtcclxuICAgICAgICByZXR1cm4gdmFsdWUgPyB2YWx1ZS5yZXBsYWNlKC9cXG4vZywgJzxici8+JykgOiB2YWx1ZTtcclxuICAgIH1cclxuICAgIENvZ25pdG8uZm9ybWF0VGV4dCA9IGZvcm1hdFRleHQ7XHJcblxyXG4gICAgQ29nbml0by5lc2NhcGVIdG1sID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlID8gdmFsdWVcclxuICAgICAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JylcclxuICAgICAgICAgICAgLnJlcGxhY2UoL1wiXCIvZywgJyZxdW90OycpXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKC8nL2csICcmIzM5OycpXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JylcclxuICAgICAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKVxyXG4gICAgICAgIDogdmFsdWU7XHJcbiAgICB9O1xyXG5cclxuICAgIENvZ25pdG8uZXNjYXBlQW5kRm9ybWF0ID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgcmV0dXJuIENvZ25pdG8uZm9ybWF0VGV4dChDb2duaXRvLmVzY2FwZUh0bWwodmFsdWUpKTtcclxuICAgIH07XHJcblxyXG4gICAgQ29nbml0by5tYXNrVGV4dCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgIHJldHVybiB2YWx1ZSA/IHZhbHVlLnJlcGxhY2UoLy4vZywgJyonKSA6IHZhbHVlO1xyXG4gICAgfTtcclxuXHJcblx0ZnVuY3Rpb24gZ2V0RGV2aWNlVHlwZSh1c2VyYWdlbnQpIHtcclxuXHRcdC8vIE1vZGlmaWVkIHZlcnNpb24gb2Y6XHJcblx0XHQvLyBodHRwOi8vd3d3LmNvbXBldGEuY29tL2Jsb2cvaG93LXRvLWRldGVjdC1tb2JpbGUtZGV2aWNlcy13aXRoLXZhbmlsbGEtamF2YXNjcmlwdC9cclxuXHJcblx0XHRpZiAodXNlcmFnZW50Lm1hdGNoKC9XaW5kb3dzIE5UL2kpKSB7XHJcblx0XHRcdHJldHVybiAnd2luZG93cy1kZXNrdG9wJztcclxuXHRcdH0gZWxzZSBpZiAodXNlcmFnZW50Lm1hdGNoKC9BbmRyb2lkL2kpKSB7XHJcblx0XHRcdHJldHVybiAnYW5kcm9pZCc7XHJcblx0XHR9IGVsc2UgaWYgKHVzZXJhZ2VudC5tYXRjaCgvd2ViT1MvaSkpIHtcclxuXHRcdFx0cmV0dXJuICd3ZWJvcyc7XHJcblx0XHR9IGVsc2UgaWYgKHVzZXJhZ2VudC5tYXRjaCgvaVBob25lL2kpKSB7XHJcblx0XHRcdHJldHVybiAnaXBob25lJztcclxuXHRcdH0gZWxzZSBpZiAodXNlcmFnZW50Lm1hdGNoKC9pUG9kL2kpKSB7XHJcblx0XHRcdHJldHVybiAnaXBvZCc7XHJcblx0XHR9IGVsc2UgaWYgKHVzZXJhZ2VudC5tYXRjaCgvaVBhZC9pKSkge1xyXG5cdFx0XHRyZXR1cm4gJ2lwYWQnO1xyXG5cdFx0fSBlbHNlIGlmICh1c2VyYWdlbnQubWF0Y2goL1dpbmRvd3MgUGhvbmUvaSkpIHtcclxuXHRcdFx0cmV0dXJuICd3aW5kb3dzLXBob25lJztcclxuXHRcdH0gZWxzZSBpZiAodXNlcmFnZW50Lm1hdGNoKC9TeW1iaWFuT1MvaSkpIHtcclxuXHRcdFx0cmV0dXJuICdzeW1iaWFuJztcclxuXHRcdH0gZWxzZSBpZiAodXNlcmFnZW50Lm1hdGNoKC9SSU0vaSkgfHwgdXNlcmFnZW50Lm1hdGNoKC9CQi9pKSkge1xyXG5cdFx0XHRyZXR1cm4gJ2JsYWNrYmVycnknO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0cmV0dXJuICd1bmtub3duJztcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdENvZ25pdG8uaXNEZXZpY2VUeXBlID0gZnVuY3Rpb24gKHF1ZXJ5KSB7XHJcblx0XHR2YXIgZGV2aWNlVHlwZSA9IGdldERldmljZVR5cGUobmF2aWdhdG9yLnVzZXJBZ2VudCk7XHJcblx0XHR2YXIgZGV2aWNlVHlwZXNUb0NoZWNrID0gcXVlcnkuc3BsaXQoJ3wnKTtcclxuXHRcdHJldHVybiBkZXZpY2VUeXBlc1RvQ2hlY2suc29tZShmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC50b0xvd2VyQ2FzZSgpID09PSBkZXZpY2VUeXBlOyB9KTtcclxuXHR9O1xyXG5cclxuXHRDb2duaXRvLnJlc2l6ZSA9IGZ1bmN0aW9uIENvZ25pdG8kcmVzaXplKHdpZHRoLCBmb3JtKSB7XHJcblx0XHRyZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRpZiAod2lkdGggJiYgZm9ybSkge1xyXG5cdFx0XHRcdHZhciB3aWR0aCA9IHdpZHRoO1xyXG5cdFx0XHRcdHZhciBlbGVtZW50ID0gJChmb3JtKTtcclxuXHJcblx0XHRcdH0gZWxzZSBpZiAoQ29nbml0by52aWV3cG9ydCkge1xyXG5cdFx0XHRcdHZhciB3aWR0aCA9IENvZ25pdG8udmlld3BvcnQud2lkdGgoKTtcclxuXHRcdFx0XHR2YXIgZWxlbWVudCA9IENvZ25pdG8udmlld3BvcnQ7XHJcblx0XHRcdH0gZWxzZVxyXG5cdFx0XHRcdHJldHVybjtcclxuXHJcblx0XHRcdGlmICh3aWR0aCA8PSA0MTQpXHJcblx0XHRcdFx0ZWxlbWVudC5hZGRDbGFzcyhcImMtc21sXCIpLnJlbW92ZUNsYXNzKFwiYy1tZWRcIikucmVtb3ZlQ2xhc3MoXCJjLWxyZ1wiKTtcclxuXHRcdFx0ZWxzZSBpZiAod2lkdGggPCA4MDApXHJcblx0XHRcdFx0ZWxlbWVudC5yZW1vdmVDbGFzcyhcImMtc21sXCIpLmFkZENsYXNzKFwiYy1tZWRcIikucmVtb3ZlQ2xhc3MoXCJjLWxyZ1wiKTtcclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdGVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJjLXNtbFwiKS5yZW1vdmVDbGFzcyhcImMtbWVkXCIpLmFkZENsYXNzKFwiYy1scmdcIik7XHJcblxyXG5cdFx0XHRpZiAod2lkdGggPiA0MTQgJiYgd2lkdGggPD0gNTI1KVxyXG5cdFx0XHRcdGVsZW1lbnQuYWRkQ2xhc3MoXCJjLXNtZWRcIik7XHJcblx0XHRcdGVsc2VcclxuXHRcdFx0XHRlbGVtZW50LnJlbW92ZUNsYXNzKFwiYy1zbWVkXCIpO1xyXG5cdFx0fSk7XHJcblx0fTtcclxuXHJcblx0Q29nbml0by5hZnRlckRvbVJlYWR5KGZ1bmN0aW9uICgkKSB7XHJcblx0XHQkKHdpbmRvdykucmVzaXplKENvZ25pdG8ucmVzaXplKTtcclxuXHRcdENvZ25pdG8ucmVzaXplKCk7XHJcblx0fSk7XHJcblxyXG5cdC8vLyBNb2R1bGVcclxuXHRmdW5jdGlvbiBNb2R1bGUobmFtZSkge1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwibmFtZVwiLCB7IHZhbHVlOiBuYW1lIH0pO1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwibW9kZWxcIiwgeyB2YWx1ZToge30gfSk7XHJcblx0XHRDb2duaXRvLmNvbmZpZy5tb2R1bGVzLnB1c2godGhpcyk7XHJcblx0fVxyXG5cclxuXHRNb2R1bGUubWl4aW4oe1xyXG5cdFx0c2VydmljZVJlcXVlc3Q6IGZ1bmN0aW9uIE1vZHVsZSRzZXJ2aWNlUmVxdWVzdChvcHRpb25zKSB7XHJcblx0XHRcdG9wdGlvbnMubW9kdWxlID0gdGhpcy5uYW1lO1xyXG5cclxuXHRcdFx0Q29nbml0by5zZXJ2aWNlUmVxdWVzdChvcHRpb25zKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0Q29nbml0by5Nb2R1bGUgPSBNb2R1bGU7XHJcblxyXG5cclxuXHQvLyBwb2x5ZmlsbCBmb3IgdGhlIEFycmF5LnNvbWUgZnVuY3Rpb25cclxuXHRpZiAoIUFycmF5LnByb3RvdHlwZS5zb21lKSB7XHJcblx0XHRBcnJheS5wcm90b3R5cGUuc29tZSA9IGZ1bmN0aW9uIChmdW4gLyosIHRoaXNBcmcgKi8pIHtcclxuXHRcdFx0J3VzZSBzdHJpY3QnO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMgPT09IHZvaWQgMCB8fCB0aGlzID09PSBudWxsKVxyXG5cdFx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoKTtcclxuXHJcblx0XHRcdHZhciB0ID0gT2JqZWN0KHRoaXMpO1xyXG5cdFx0XHR2YXIgbGVuID0gdC5sZW5ndGggPj4+IDA7XHJcblx0XHRcdGlmICh0eXBlb2YgZnVuICE9PSAnZnVuY3Rpb24nKVxyXG5cdFx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoKTtcclxuXHJcblx0XHRcdHZhciB0aGlzQXJnID0gYXJndW1lbnRzLmxlbmd0aCA+PSAyID8gYXJndW1lbnRzWzFdIDogdm9pZCAwO1xyXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XHJcblx0XHRcdFx0aWYgKGkgaW4gdCAmJiBmdW4uY2FsbCh0aGlzQXJnLCB0W2ldLCBpLCB0KSlcclxuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHR9O1xyXG5cdH1cclxufSkod2luZG93LkV4b0pRdWVyeSB8fCBqUXVlcnkpO1xyXG59KSh0eXBlb2YgZXhwb3J0cyA9PT0gJ3VuZGVmaW5lZCcpO1xyXG4iLCLvu78oKHR5cGVvZiBleHBvcnRzICE9ICd1bmRlZmluZWQnID8gZXhwb3J0cyA6IHt9KS5leGVjID0gZnVuY3Rpb24gKGlzSW5JZnJhbWUpIHtcclxuKGZ1bmN0aW9uICgkKSB7XHJcblx0Ly8jcmVnaW9uIEVtYWlsIFJlZ2V4XHJcblx0Q29nbml0by5lbWFpbFJlZ2V4ID0gLyhbYS16QS1aMC05XFwhXFwjXFwkXFwlXFwmXFwnXFwqXFwrXFwtXFwvXFw9XFw/XFxeX1xcYFxce1xcfFxcfVxcfl0rKFxcLlthLXpBLVowLTlcXCFcXCNcXCRcXCVcXCZcXCdcXCpcXCtcXC1cXC9cXD1cXD9cXF5fXFxgXFx7XFx8XFx9XFx+XSspKkAoW2EtekEtWjAtOV0oW2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPyhcXC5bYS16QS1aMC05XShbYS16QS1aMC05LV17MCw2MX1bYS16QS1aMC05XSk/KSpcXC5bYS16QS1aXXsyLDY0fXwoWzAtOV17MSwzfShcXC5bMC05XXsxLDN9KXszfSkpKS9nO1xyXG5cdENvZ25pdG8uZW1haWxBbmRUb2tlblJlZ2V4ID0gLyhcXFsoKFthLXowLTlfLlxcdTAwYWFcXHUwMGI1XFx1MDBiYVxcdTAwYzAtXFx1MDBkNlxcdTAwZDgtXFx1MDBmNlxcdTAwZjgtXFx1MDJiOFxcdTAyYmItXFx1MDJjMVxcdTAyZDAtXFx1MDJkMVxcdTAyZTAtXFx1MDJlNFxcdTAyZWVcXHUwMzcwLVxcdTAzNzNcXHUwMzc2LVxcdTAzNzdcXHUwMzdhLVxcdTAzN2RcXHUwMzg2XFx1MDM4OC1cXHUwMzhhXFx1MDM4Y1xcdTAzOGUtXFx1MDNhMVxcdTAzYTMtXFx1MDNmNVxcdTAzZjctXFx1MDQ4MVxcdTA0OGEtXFx1MDUyM1xcdTA1MzEtXFx1MDU1NlxcdTA1NTlcXHUwNTYxLVxcdTA1ODdcXHUwNWQwLVxcdTA1ZWFcXHUwNWYwLVxcdTA1ZjJcXHUwNjIxLVxcdTA2NGFcXHUwNjYwLVxcdTA2NjlcXHUwNjZlLVxcdTA2NmZcXHUwNjcxLVxcdTA2ZDNcXHUwNmQ1XFx1MDZlNS1cXHUwNmU2XFx1MDZlZS1cXHUwNmZjXFx1MDZmZlxcdTA3MTBcXHUwNzEyLVxcdTA3MmZcXHUwNzRkLVxcdTA3YTVcXHUwN2IxXFx1MDdjMC1cXHUwN2VhXFx1MDdmNC1cXHUwN2Y1XFx1MDdmYVxcdTA5MDQtXFx1MDkzOVxcdTA5M2RcXHUwOTUwXFx1MDk1OC1cXHUwOTYxXFx1MDk2Ni1cXHUwOTZmXFx1MDk3MS1cXHUwOTcyXFx1MDk3Yi1cXHUwOTdmXFx1MDk4NS1cXHUwOThjXFx1MDk4Zi1cXHUwOTkwXFx1MDk5My1cXHUwOWE4XFx1MDlhYS1cXHUwOWIwXFx1MDliMlxcdTA5YjYtXFx1MDliOVxcdTA5YmRcXHUwOWNlXFx1MDlkYy1cXHUwOWRkXFx1MDlkZi1cXHUwOWUxXFx1MDllNi1cXHUwOWYxXFx1MGEwNS1cXHUwYTBhXFx1MGEwZi1cXHUwYTEwXFx1MGExMy1cXHUwYTI4XFx1MGEyYS1cXHUwYTMwXFx1MGEzMi1cXHUwYTMzXFx1MGEzNS1cXHUwYTM2XFx1MGEzOC1cXHUwYTM5XFx1MGE1OS1cXHUwYTVjXFx1MGE1ZVxcdTBhNjYtXFx1MGE2ZlxcdTBhNzItXFx1MGE3NFxcdTBhODUtXFx1MGE4ZFxcdTBhOGYtXFx1MGE5MVxcdTBhOTMtXFx1MGFhOFxcdTBhYWEtXFx1MGFiMFxcdTBhYjItXFx1MGFiM1xcdTBhYjUtXFx1MGFiOVxcdTBhYmRcXHUwYWQwXFx1MGFlMC1cXHUwYWUxXFx1MGFlNi1cXHUwYWVmXFx1MGIwNS1cXHUwYjBjXFx1MGIwZi1cXHUwYjEwXFx1MGIxMy1cXHUwYjI4XFx1MGIyYS1cXHUwYjMwXFx1MGIzMi1cXHUwYjMzXFx1MGIzNS1cXHUwYjM5XFx1MGIzZFxcdTBiNWMtXFx1MGI1ZFxcdTBiNWYtXFx1MGI2MVxcdTBiNjYtXFx1MGI2ZlxcdTBiNzFcXHUwYjgzXFx1MGI4NS1cXHUwYjhhXFx1MGI4ZS1cXHUwYjkwXFx1MGI5Mi1cXHUwYjk1XFx1MGI5OS1cXHUwYjlhXFx1MGI5Y1xcdTBiOWUtXFx1MGI5ZlxcdTBiYTMtXFx1MGJhNFxcdTBiYTgtXFx1MGJhYVxcdTBiYWUtXFx1MGJiOVxcdTBiZDBcXHUwYmU2LVxcdTBiZWZcXHUwYzA1LVxcdTBjMGNcXHUwYzBlLVxcdTBjMTBcXHUwYzEyLVxcdTBjMjhcXHUwYzJhLVxcdTBjMzNcXHUwYzM1LVxcdTBjMzlcXHUwYzNkXFx1MGM1OC1cXHUwYzU5XFx1MGM2MC1cXHUwYzYxXFx1MGM2Ni1cXHUwYzZmXFx1MGM4NS1cXHUwYzhjXFx1MGM4ZS1cXHUwYzkwXFx1MGM5Mi1cXHUwY2E4XFx1MGNhYS1cXHUwY2IzXFx1MGNiNS1cXHUwY2I5XFx1MGNiZFxcdTBjZGVcXHUwY2UwLVxcdTBjZTFcXHUwY2U2LVxcdTBjZWZcXHUwZDA1LVxcdTBkMGNcXHUwZDBlLVxcdTBkMTBcXHUwZDEyLVxcdTBkMjhcXHUwZDJhLVxcdTBkMzlcXHUwZDNkXFx1MGQ2MC1cXHUwZDYxXFx1MGQ2Ni1cXHUwZDZmXFx1MGQ3YS1cXHUwZDdmXFx1MGQ4NS1cXHUwZDk2XFx1MGQ5YS1cXHUwZGIxXFx1MGRiMy1cXHUwZGJiXFx1MGRiZFxcdTBkYzAtXFx1MGRjNlxcdTBlMDEtXFx1MGUzMFxcdTBlMzItXFx1MGUzM1xcdTBlNDAtXFx1MGU0NlxcdTBlNTAtXFx1MGU1OVxcdTBlODEtXFx1MGU4MlxcdTBlODRcXHUwZTg3LVxcdTBlODhcXHUwZThhXFx1MGU4ZFxcdTBlOTQtXFx1MGU5N1xcdTBlOTktXFx1MGU5ZlxcdTBlYTEtXFx1MGVhM1xcdTBlYTVcXHUwZWE3XFx1MGVhYS1cXHUwZWFiXFx1MGVhZC1cXHUwZWIwXFx1MGViMi1cXHUwZWIzXFx1MGViZFxcdTBlYzAtXFx1MGVjNFxcdTBlYzZcXHUwZWQwLVxcdTBlZDlcXHUwZWRjLVxcdTBlZGRcXHUwZjAwXFx1MGYyMC1cXHUwZjI5XFx1MGY0MC1cXHUwZjQ3XFx1MGY0OS1cXHUwZjZjXFx1MGY4OC1cXHUwZjhiXFx1MTAwMC1cXHUxMDJhXFx1MTAzZi1cXHUxMDQ5XFx1MTA1MC1cXHUxMDU1XFx1MTA1YS1cXHUxMDVkXFx1MTA2MVxcdTEwNjUtXFx1MTA2NlxcdTEwNmUtXFx1MTA3MFxcdTEwNzUtXFx1MTA4MVxcdTEwOGVcXHUxMDkwLVxcdTEwOTlcXHUxMGEwLVxcdTEwYzVcXHUxMGQwLVxcdTEwZmFcXHUxMGZjXFx1MTEwMC1cXHUxMTU5XFx1MTE1Zi1cXHUxMWEyXFx1MTFhOC1cXHUxMWY5XFx1MTIwMC1cXHUxMjQ4XFx1MTI0YS1cXHUxMjRkXFx1MTI1MC1cXHUxMjU2XFx1MTI1OFxcdTEyNWEtXFx1MTI1ZFxcdTEyNjAtXFx1MTI4OFxcdTEyOGEtXFx1MTI4ZFxcdTEyOTAtXFx1MTJiMFxcdTEyYjItXFx1MTJiNVxcdTEyYjgtXFx1MTJiZVxcdTEyYzBcXHUxMmMyLVxcdTEyYzVcXHUxMmM4LVxcdTEyZDZcXHUxMmQ4LVxcdTEzMTBcXHUxMzEyLVxcdTEzMTVcXHUxMzE4LVxcdTEzNWFcXHUxMzgwLVxcdTEzOGZcXHUxM2EwLVxcdTEzZjRcXHUxNDAxLVxcdTE2NmNcXHUxNjZmLVxcdTE2NzZcXHUxNjgxLVxcdTE2OWFcXHUxNmEwLVxcdTE2ZWFcXHUxNzAwLVxcdTE3MGNcXHUxNzBlLVxcdTE3MTFcXHUxNzIwLVxcdTE3MzFcXHUxNzQwLVxcdTE3NTFcXHUxNzYwLVxcdTE3NmNcXHUxNzZlLVxcdTE3NzBcXHUxNzgwLVxcdTE3YjNcXHUxN2Q3XFx1MTdkY1xcdTE3ZTAtXFx1MTdlOVxcdTE4MTAtXFx1MTgxOVxcdTE4MjAtXFx1MTg3N1xcdTE4ODAtXFx1MThhOFxcdTE4YWFcXHUxOTAwLVxcdTE5MWNcXHUxOTQ2LVxcdTE5NmRcXHUxOTcwLVxcdTE5NzRcXHUxOTgwLVxcdTE5YTlcXHUxOWMxLVxcdTE5YzdcXHUxOWQwLVxcdTE5ZDlcXHUxYTAwLVxcdTFhMTZcXHUxYjA1LVxcdTFiMzNcXHUxYjQ1LVxcdTFiNGJcXHUxYjUwLVxcdTFiNTlcXHUxYjgzLVxcdTFiYTBcXHUxYmFlLVxcdTFiYjlcXHUxYzAwLVxcdTFjMjNcXHUxYzQwLVxcdTFjNDlcXHUxYzRkLVxcdTFjN2RcXHUxZDAwLVxcdTFkYmZcXHUxZTAwLVxcdTFmMTVcXHUxZjE4LVxcdTFmMWRcXHUxZjIwLVxcdTFmNDVcXHUxZjQ4LVxcdTFmNGRcXHUxZjUwLVxcdTFmNTdcXHUxZjU5XFx1MWY1YlxcdTFmNWRcXHUxZjVmLVxcdTFmN2RcXHUxZjgwLVxcdTFmYjRcXHUxZmI2LVxcdTFmYmNcXHUxZmJlXFx1MWZjMi1cXHUxZmM0XFx1MWZjNi1cXHUxZmNjXFx1MWZkMC1cXHUxZmQzXFx1MWZkNi1cXHUxZmRiXFx1MWZlMC1cXHUxZmVjXFx1MWZmMi1cXHUxZmY0XFx1MWZmNi1cXHUxZmZjXFx1MjA3MVxcdTIwN2ZcXHUyMDkwLVxcdTIwOTRcXHUyMTAyXFx1MjEwN1xcdTIxMGEtXFx1MjExM1xcdTIxMTVcXHUyMTE5LVxcdTIxMWRcXHUyMTI0XFx1MjEyNlxcdTIxMjhcXHUyMTJhLVxcdTIxMmRcXHUyMTJmLVxcdTIxMzlcXHUyMTNjLVxcdTIxM2ZcXHUyMTQ1LVxcdTIxNDlcXHUyMTRlXFx1MjE4My1cXHUyMTg0XFx1MmMwMC1cXHUyYzJlXFx1MmMzMC1cXHUyYzVlXFx1MmM2MC1cXHUyYzZmXFx1MmM3MS1cXHUyYzdkXFx1MmM4MC1cXHUyY2U0XFx1MmQwMC1cXHUyZDI1XFx1MmQzMC1cXHUyZDY1XFx1MmQ2ZlxcdTJkODAtXFx1MmQ5NlxcdTJkYTAtXFx1MmRhNlxcdTJkYTgtXFx1MmRhZVxcdTJkYjAtXFx1MmRiNlxcdTJkYjgtXFx1MmRiZVxcdTJkYzAtXFx1MmRjNlxcdTJkYzgtXFx1MmRjZVxcdTJkZDAtXFx1MmRkNlxcdTJkZDgtXFx1MmRkZVxcdTMwMDUtXFx1MzAwNlxcdTMwMzEtXFx1MzAzNVxcdTMwM2ItXFx1MzAzY1xcdTMwNDEtXFx1MzA5NlxcdTMwOWQtXFx1MzA5ZlxcdTMwYTEtXFx1MzBmYVxcdTMwZmMtXFx1MzBmZlxcdTMxMDUtXFx1MzEyZFxcdTMxMzEtXFx1MzE4ZVxcdTMxYTAtXFx1MzFiN1xcdTMxZjAtXFx1MzFmZlxcdTM0MDAtXFx1NGRiNVxcdTRlMDAtXFx1OWZjM1xcdWEwMDAtXFx1YTQ4Y1xcdWE1MDAtXFx1YTYwY1xcdWE2MTAtXFx1YTYyYlxcdWE2NDAtXFx1YTY1ZlxcdWE2NjItXFx1YTY2ZVxcdWE2ODAtXFx1YTY5N1xcdWE3MjItXFx1YTc4OFxcdWE3OGItXFx1YTc4Y1xcdWE3ZmItXFx1YTgwMVxcdWE4MDMtXFx1YTgwNVxcdWE4MDctXFx1YTgwYVxcdWE4MGMtXFx1YTgyMlxcdWE4NDAtXFx1YTg3M1xcdWE4ODItXFx1YThiM1xcdWE4ZDAtXFx1YThkOVxcdWE5MDAtXFx1YTkyNVxcdWE5MzAtXFx1YTk0NlxcdWFhMDAtXFx1YWEyOFxcdWFhNDAtXFx1YWE0MlxcdWFhNDQtXFx1YWE0YlxcdWFhNTAtXFx1YWE1OVxcdWFjMDAtXFx1ZDdhM1xcdWY5MDAtXFx1ZmEyZFxcdWZhMzAtXFx1ZmE2YVxcdWZhNzAtXFx1ZmFkOVxcdWZiMDAtXFx1ZmIwNlxcdWZiMTMtXFx1ZmIxN1xcdWZiMWRcXHVmYjFmLVxcdWZiMjhcXHVmYjJhLVxcdWZiMzZcXHVmYjM4LVxcdWZiM2NcXHVmYjNlXFx1ZmI0MC1cXHVmYjQxXFx1ZmI0My1cXHVmYjQ0XFx1ZmI0Ni1cXHVmYmIxXFx1ZmJkMy1cXHVmZDNkXFx1ZmQ1MC1cXHVmZDhmXFx1ZmQ5Mi1cXHVmZGM3XFx1ZmRmMC1cXHVmZGZiXFx1ZmU3MC1cXHVmZTc0XFx1ZmU3Ni1cXHVmZWZjXFx1ZmYxMC1cXHVmZjE5XFx1ZmYyMS1cXHVmZjNhXFx1ZmY0MS1cXHVmZjVhXFx1ZmY2Ni1cXHVmZmJlXFx1ZmZjMi1cXHVmZmM3XFx1ZmZjYS1cXHVmZmNmXFx1ZmZkMi1cXHVmZmQ3XFx1ZmZkYS1cXHVmZmRjXSspKD86XFw6KC4rPykpPylcXF0pfChbYS16QS1aMC05XFwhXFwjXFwkXFwlXFwmXFwnXFwqXFwrXFwtXFwvXFw9XFw/XFxeX1xcYFxce1xcfFxcfVxcfl0rKFxcLlthLXpBLVowLTlcXCFcXCNcXCRcXCVcXCZcXCdcXCpcXCtcXC1cXC9cXD1cXD9cXF5fXFxgXFx7XFx8XFx9XFx+XSspKkAoW2EtekEtWjAtOV0oW2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPyhcXC5bYS16QS1aMC05XShbYS16QS1aMC05LV17MCw2MX1bYS16QS1aMC05XSk/KSpcXC5bYS16QS1aXXsyLDY0fXwoWzAtOV17MSwzfShcXC5bMC05XXsxLDN9KXszfSkpKS9naTtcclxuXHJcblx0Ly8jcmVnaW9uIFJlcXVpcmVkIE5hbWUgUnVsZVxyXG5cclxuXHQvLyB2YWxpZGF0ZXMgdGhhdCB0aGUgZmlyc3QgYW5kIGxhc3QgZmllbGRzIG9mIGEgbmFtZSBhcmUgc3BlY2lmaWVkXHJcblx0ZnVuY3Rpb24gUmVxdWlyZWROYW1lUnVsZShyb290VHlwZSwgb3B0aW9ucykge1xyXG5cclxuXHRcdC8vIGVuc3VyZSB0aGUgcnVsZSBuYW1lIGlzIHNwZWNpZmllZFxyXG5cdFx0b3B0aW9ucy5uYW1lID0gb3B0aW9ucy5uYW1lIHx8IFwiUmVxdWlyZWROYW1lXCI7XHJcblxyXG5cdFx0Ly8gZW5zdXJlIHRoZSBlcnJvciBtZXNzYWdlIGlzIHNwZWNpZmllZFxyXG5cdFx0b3B0aW9ucy5tZXNzYWdlID0gb3B0aW9ucy5tZXNzYWdlIHx8IFwiTmFtZSBpcyByZXF1aXJlZC5cIjtcclxuXHRcdFxyXG5cdFx0Ly8gY29uZmlndXJlIHRoZSBwcm9wZXJ0aWVzIHRvIHZhbGlkYXRlXHJcblx0XHR2YXIgcHJvcCA9IG9wdGlvbnMucHJvcGVydHkgaW5zdGFuY2VvZiBFeG9XZWIuTW9kZWwuUHJvcGVydHkgPyBvcHRpb25zLnByb3BlcnR5IDogcm9vdFR5cGUucHJvcGVydHkob3B0aW9ucy5wcm9wZXJ0eSk7XHJcblx0XHRpZiAob3B0aW9ucy5vbkNoYW5nZU9mKVxyXG5cdFx0XHRvcHRpb25zLm9uQ2hhbmdlT2YgPSBvcHRpb25zLm9uQ2hhbmdlT2YuY29uY2F0KFtwcm9wLmdldF9uYW1lKCkgKyBcIi5GaXJzdFwiLCBwcm9wLmdldF9uYW1lKCkgKyBcIi5MYXN0XCJdKTtcclxuXHRcdGVsc2VcclxuXHRcdFx0b3B0aW9ucy5vbkNoYW5nZU9mID0gW3Byb3AuZ2V0X25hbWUoKSArIFwiLkZpcnN0XCIsIHByb3AuZ2V0X25hbWUoKSArIFwiLkxhc3RcIl07XHJcblx0XHRcclxuXHRcdC8vIGRlZmluZSBwcm9wZXJ0aWVzIGZvciB0aGUgcnVsZSwgZGVmYXVsdGluZyBpc1JlcXVpcmVkIHRvIHRydWUgaWYgbm90IHNwZWNpZmllZFxyXG5cdFx0aWYgKG9wdGlvbnMuZm4pIHtcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiaXNSZXF1aXJlZFwiLCB7IHZhbHVlOiBvcHRpb25zLmZuLCB3cml0YWJsZTogdHJ1ZSB9KTtcclxuXHRcdFx0b3B0aW9ucy5mbiA9IG51bGw7XHJcblx0XHR9XHJcblx0XHRlbHNlXHJcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImlzUmVxdWlyZWRcIiwgeyB2YWx1ZTogb3B0aW9ucy5pc1JlcXVpcmVkICE9IGZhbHNlIH0pO1xyXG5cclxuXHRcdC8vIGNhbGwgdGhlIGJhc2UgdHlwZSBjb25zdHJ1Y3RvclxyXG5cdFx0RXhvV2ViLk1vZGVsLlZhbGlkYXRlZFByb3BlcnR5UnVsZS5hcHBseSh0aGlzLCBbcm9vdFR5cGUsIG9wdGlvbnNdKTtcclxuXHR9XHJcblxyXG5cdC8vIHNldHVwIHRoZSBpbmhlcml0YW5jZSBjaGFpblxyXG5cdFJlcXVpcmVkTmFtZVJ1bGUucHJvdG90eXBlID0gbmV3IEV4b1dlYi5Nb2RlbC5WYWxpZGF0ZWRQcm9wZXJ0eVJ1bGUoKTtcclxuXHRSZXF1aXJlZE5hbWVSdWxlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFJlcXVpcmVkTmFtZVJ1bGU7XHJcblxyXG5cdFJlcXVpcmVkTmFtZVJ1bGUubWl4aW4oe1xyXG5cclxuXHRcdC8vIGFzc2VydHMgdGhlIGNvbmRpdGlvbiBhbmQgYWRkcyBvciByZW1vdmVzIGl0IGZyb20gdGhlIG1vZGVsIGlmIG5lY2Vzc2FyeVxyXG5cdFx0ZXhlY3V0ZTogZnVuY3Rpb24gUmVxdWlyZWROYW1lUnVsZSRleGVjdXRlKG9iaikge1xyXG5cclxuXHRcdFx0Ly8gY29udmVydCBzdHJpbmcgZnVuY3Rpb25zIGludG8gY29tcGlsZWQgZnVuY3Rpb25zIG9uIGZpcnN0IGV4ZWN1dGlvblxyXG5cdFx0XHRpZiAodGhpcy5pc1JlcXVpcmVkLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHtcclxuXHRcdFx0XHR0aGlzLmlzUmVxdWlyZWQgPSB0aGlzLnJvb3RUeXBlLmNvbXBpbGVFeHByZXNzaW9uKHRoaXMuaXNSZXF1aXJlZCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciBuYW1lID0gdGhpcy5wcm9wZXJ0eS52YWx1ZShvYmopO1xyXG5cdFx0XHR2YXIgbWVzc2FnZSA9IHRoaXMubWVzc2FnZTtcclxuXHRcdFx0dmFyIHByb3BlcnRpZXMgPSB0aGlzLnByb3BlcnRpZXM7XHJcblxyXG5cdFx0XHR2YXIgYXNzZXJ0ID0gbmFtZTtcclxuXHJcblx0XHRcdGlmICh0aGlzLmlzUmVxdWlyZWQuY29uc3RydWN0b3IgPT09IEJvb2xlYW4pXHJcblx0XHRcdFx0YXNzZXJ0ID0gYXNzZXJ0ICYmIHRoaXMuaXNSZXF1aXJlZDtcclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dmFyIGlzUmVxO1xyXG5cdFx0XHRcdHRyeVxyXG5cdFx0XHRcdHtcclxuXHRcdFx0XHRcdGlzUmVxID0gdGhpcy5pc1JlcXVpcmVkLmNhbGwob2JqKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Y2F0Y2ggKGUpXHJcblx0XHRcdFx0e1xyXG5cdFx0XHRcdFx0aXNSZXEgPSBmYWxzZTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGFzc2VydCA9IGFzc2VydCAmJiBpc1JlcTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gRGV0ZXJtaW5lIGlmIHRoZSBjb25kaXRpb24gc2hvdWxkIGJlIGFzc2VydGVkXHJcblx0XHRcdGlmIChhc3NlcnQpIHtcclxuXHRcdFx0XHR2YXIgZmlyc3RJc01pc3NpbmcgPSAhRXhvV2ViLk1vZGVsLlJlcXVpcmVkUnVsZS5oYXNWYWx1ZShuYW1lLmdldF9GaXJzdCgpKTtcclxuXHRcdFx0XHR2YXIgbGFzdElzTWlzc2luZyA9ICFFeG9XZWIuTW9kZWwuUmVxdWlyZWRSdWxlLmhhc1ZhbHVlKG5hbWUuZ2V0X0xhc3QoKSk7XHJcblx0XHRcdFx0aWYgKGZpcnN0SXNNaXNzaW5nICYmIGxhc3RJc01pc3NpbmcpIHtcclxuXHRcdFx0XHRcdG1lc3NhZ2UgPSBDb2duaXRvLnJlc291cmNlcy5nZXQoXCJyZXF1aXJlZC1uYW1lLWZpcnN0LWFuZC1sYXN0XCIpO1xyXG5cdFx0XHRcdFx0cHJvcGVydGllcyA9IFt0aGlzLnByb3BlcnR5LmdldF9uYW1lKCksIHRoaXMucHJvcGVydHkuZ2V0X25hbWUoKSArIFwie0ZpcnN0LExhc3R9XCJdO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmIChmaXJzdElzTWlzc2luZykge1xyXG5cdFx0XHRcdFx0bWVzc2FnZSA9IENvZ25pdG8ucmVzb3VyY2VzLmdldChcInJlcXVpcmVkLW5hbWUtZmlyc3RcIik7XHJcblx0XHRcdFx0XHRwcm9wZXJ0aWVzID0gW3RoaXMucHJvcGVydHkuZ2V0X25hbWUoKSwgdGhpcy5wcm9wZXJ0eS5nZXRfbmFtZSgpICsgXCJ7Rmlyc3R9XCJdO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmIChsYXN0SXNNaXNzaW5nKSB7XHJcblx0XHRcdFx0XHRtZXNzYWdlID0gQ29nbml0by5yZXNvdXJjZXMuZ2V0KFwicmVxdWlyZWQtbmFtZS1sYXN0XCIpO1xyXG5cdFx0XHRcdFx0cHJvcGVydGllcyA9IFt0aGlzLnByb3BlcnR5LmdldF9uYW1lKCksIHRoaXMucHJvcGVydHkuZ2V0X25hbWUoKSArIFwie0xhc3R9XCJdO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0XHRhc3NlcnQgPSBmYWxzZTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gQXNzZXJ0IHRoZSBjb25kaXRpb25cclxuXHRcdFx0dGhpcy5jb25kaXRpb25UeXBlLndoZW4oYXNzZXJ0LCBvYmosIHByb3BlcnRpZXMsIG1lc3NhZ2UpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHQvLyBFeHBvc2UgdGhlIHJ1bGUgcHVibGljbHlcclxuXHRFeG9XZWIuTW9kZWwuUnVsZS5yZXF1aXJlZE5hbWUgPSBSZXF1aXJlZE5hbWVSdWxlO1xyXG5cclxuXHQvLyNlbmRyZWdpb25cclxuXHJcblx0Ly8jcmVnaW9uIFNpZ25hdHVyZSBSdWxlXHJcblxyXG5cdC8vIHZhbGlkYXRlcyB0aGF0IHRoZSBzaWduYXR1cmUgaXMgc3BlY2lmaWVkXHJcblx0ZnVuY3Rpb24gUmVxdWlyZWRTaWduYXR1cmVSdWxlKHJvb3RUeXBlLCBvcHRpb25zKSB7XHJcblxyXG5cdFx0Ly8gZW5zdXJlIHRoZSBydWxlIG5hbWUgaXMgc3BlY2lmaWVkXHJcblx0XHRvcHRpb25zLm5hbWUgPSBvcHRpb25zLm5hbWUgfHwgXCJSZXF1aXJlZFNpZ25hdHVyZVwiO1xyXG5cclxuXHRcdC8vIGVuc3VyZSB0aGUgZXJyb3IgbWVzc2FnZSBpcyBzcGVjaWZpZWRcclxuXHRcdG9wdGlvbnMubWVzc2FnZSA9IG9wdGlvbnMubWVzc2FnZSB8fCBDb2duaXRvLnJlc291cmNlcy5nZXQoXCJyZXF1aXJlZFwiKTtcclxuXHJcblx0XHQvLyBjb25maWd1cmUgdGhlIHByb3BlcnRpZXMgdG8gdmFsaWRhdGVcclxuXHRcdHZhciBwcm9wID0gb3B0aW9ucy5wcm9wZXJ0eSBpbnN0YW5jZW9mIEV4b1dlYi5Nb2RlbC5Qcm9wZXJ0eSA/IG9wdGlvbnMucHJvcGVydHkgOiByb290VHlwZS5wcm9wZXJ0eShvcHRpb25zLnByb3BlcnR5KTtcclxuXHRcdG9wdGlvbnMub25DaGFuZ2VPZiA9IG9wdGlvbnMub25DaGFuZ2VPZlxyXG5cdFx0XHQ/IG9wdGlvbnMub25DaGFuZ2VPZi5jb25jYXQocHJvcC5nZXRfbmFtZSgpICsgXCIuU3ZnXCIpXHJcblx0XHRcdDogcHJvcC5nZXRfbmFtZSgpICsgXCIuU3ZnXCI7XHJcblxyXG5cdFx0Ly8gZGVmaW5lIHByb3BlcnRpZXMgZm9yIHRoZSBydWxlLCBkZWZhdWx0aW5nIGlzUmVxdWlyZWQgdG8gdHJ1ZSBpZiBub3Qgc3BlY2lmaWVkXHJcblx0XHRpZiAob3B0aW9ucy5mbikge1xyXG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJpc1JlcXVpcmVkXCIsIHsgdmFsdWU6IG9wdGlvbnMuZm4sIHdyaXRhYmxlOiB0cnVlIH0pO1xyXG5cdFx0XHRvcHRpb25zLmZuID0gbnVsbDtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImlzUmVxdWlyZWRcIiwgeyB2YWx1ZTogb3B0aW9ucy5pc1JlcXVpcmVkICE9IGZhbHNlIH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGNhbGwgdGhlIGJhc2UgdHlwZSBjb25zdHJ1Y3RvclxyXG5cdFx0RXhvV2ViLk1vZGVsLlZhbGlkYXRlZFByb3BlcnR5UnVsZS5hcHBseSh0aGlzLCBbcm9vdFR5cGUsIG9wdGlvbnNdKTtcclxuXHR9XHJcblxyXG5cdC8vIHNldHVwIHRoZSBpbmhlcml0YW5jZSBjaGFpblxyXG5cdFJlcXVpcmVkU2lnbmF0dXJlUnVsZS5wcm90b3R5cGUgPSBuZXcgRXhvV2ViLk1vZGVsLlZhbGlkYXRlZFByb3BlcnR5UnVsZSgpO1xyXG5cdFJlcXVpcmVkU2lnbmF0dXJlUnVsZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBSZXF1aXJlZFNpZ25hdHVyZVJ1bGU7XHJcblxyXG5cdFJlcXVpcmVkU2lnbmF0dXJlUnVsZS5taXhpbih7XHJcblxyXG5cdFx0Ly8gYXNzZXJ0cyB0aGUgY29uZGl0aW9uIGFuZCBhZGRzIG9yIHJlbW92ZXMgaXQgZnJvbSB0aGUgbW9kZWwgaWYgbmVjZXNzYXJ5XHJcblx0XHRhc3NlcnQ6IGZ1bmN0aW9uIFJlcXVpcmVkU2lnbmF0dXJlUnVsZSRhc3NlcnQob2JqKSB7XHJcblxyXG5cdFx0XHQvLyBjb252ZXJ0IHN0cmluZyBmdW5jdGlvbnMgaW50byBjb21waWxlZCBmdW5jdGlvbnMgb24gZmlyc3QgZXhlY3V0aW9uXHJcblx0XHRcdGlmICh0aGlzLmlzUmVxdWlyZWQuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xyXG5cdFx0XHRcdHRoaXMuaXNSZXF1aXJlZCA9IHRoaXMucm9vdFR5cGUuY29tcGlsZUV4cHJlc3Npb24odGhpcy5pc1JlcXVpcmVkKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIHNpZ25hdHVyZSA9IHRoaXMucHJvcGVydHkudmFsdWUob2JqKTtcclxuXHRcdFx0dmFyIG1lc3NhZ2UgPSB0aGlzLm1lc3NhZ2U7XHJcblx0XHRcdHZhciBwcm9wZXJ0aWVzID0gdGhpcy5wcm9wZXJ0aWVzO1xyXG5cclxuXHRcdFx0dmFyIGFzc2VydCA9IHNpZ25hdHVyZTtcclxuXHJcblx0XHRcdGlmICh0aGlzLmlzUmVxdWlyZWQuY29uc3RydWN0b3IgPT09IEJvb2xlYW4pIHtcclxuXHRcdFx0XHRhc3NlcnQgPSBhc3NlcnQgJiYgdGhpcy5pc1JlcXVpcmVkO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdHZhciBpc1JlcTtcclxuXHRcdFx0XHR0cnkge1xyXG5cdFx0XHRcdFx0aXNSZXEgPSB0aGlzLmlzUmVxdWlyZWQuY2FsbChvYmopO1xyXG5cdFx0XHRcdH0gY2F0Y2ggKGUpIHtcclxuXHRcdFx0XHRcdGlzUmVxID0gZmFsc2U7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRhc3NlcnQgPSBhc3NlcnQgJiYgaXNSZXE7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIEFzc2VyIHRoZSBjb25kaXRpb25cclxuXHRcdFx0cmV0dXJuIGFzc2VydCAmJiAhRXhvV2ViLk1vZGVsLlJlcXVpcmVkUnVsZS5oYXNWYWx1ZShzaWduYXR1cmUuZ2V0X1N2ZygpKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0Ly8gRXhwb3NlIHRoZSBydWxlIHB1YmxpY2x5XHJcblx0RXhvV2ViLk1vZGVsLlJ1bGUucmVxdWlyZWRTaWduYXR1cmUgPSBSZXF1aXJlZFNpZ25hdHVyZVJ1bGU7XHJcblxyXG5cdC8vI2VuZHJlZ2lvblxyXG5cclxuXHQvLyNyZWdpb24gUmVxdWlyZWQgQWRkcmVzcyBSdWxlXHJcblxyXG5cdC8vIFZhbGlkYXRlcyByZXF1aXJlZCBhZGRyZXNzIGZpZWxkc1xyXG5cdGZ1bmN0aW9uIFJlcXVpcmVkQWRkcmVzc1J1bGUocm9vdFR5cGUsIG9wdGlvbnMpIHtcclxuXHJcblx0XHQvLyBlbnN1cmUgdGhlIHJ1bGUgbmFtZSBpcyBzcGVjaWZpZWRcclxuXHRcdG9wdGlvbnMubmFtZSA9IG9wdGlvbnMubmFtZSB8fCBcIkFkZHJlc3NcIjtcclxuXHJcblx0XHQvLyBlbnN1cmUgdGhlIGVycm9yIG1lc3NhZ2UgaXMgc3BlY2lmaWVkXHJcblx0XHRvcHRpb25zLm1lc3NhZ2UgPSBvcHRpb25zLm1lc3NhZ2UgfHwgXCJBZGRyZXNzIGlzIHJlcXVpcmVkLlwiO1xyXG5cclxuXHRcdC8vIGNvbmZpZ3VyZSB0aGUgcHJvcGVydGllcyB0byB2YWxpZGF0ZVxyXG5cdFx0dmFyIHByb3AgPSBvcHRpb25zLnByb3BlcnR5IGluc3RhbmNlb2YgRXhvV2ViLk1vZGVsLlByb3BlcnR5ID8gb3B0aW9ucy5wcm9wZXJ0eSA6IHJvb3RUeXBlLnByb3BlcnR5KG9wdGlvbnMucHJvcGVydHkpO1xyXG5cclxuXHRcdGlmIChvcHRpb25zLm9uQ2hhbmdlT2YpXHJcblx0XHRcdG9wdGlvbnMub25DaGFuZ2VPZiA9IG9wdGlvbnMub25DaGFuZ2VPZi5jb25jYXQoW3Byb3AuZ2V0X25hbWUoKSArIFwiLkxpbmUxXCIsIHByb3AuZ2V0X25hbWUoKSArIFwiLkNpdHlcIiwgcHJvcC5nZXRfbmFtZSgpICsgXCIuU3RhdGVcIiwgcHJvcC5nZXRfbmFtZSgpICsgXCIuUG9zdGFsQ29kZVwiLCBwcm9wLmdldF9uYW1lKCkgKyBcIi5Db3VudHJ5XCJdKTtcclxuXHRcdGVsc2VcclxuXHRcdFx0b3B0aW9ucy5vbkNoYW5nZU9mID0gW3Byb3AuZ2V0X25hbWUoKSArIFwiLkxpbmUxXCIsIHByb3AuZ2V0X25hbWUoKSArIFwiLkNpdHlcIiwgcHJvcC5nZXRfbmFtZSgpICsgXCIuU3RhdGVcIiwgcHJvcC5nZXRfbmFtZSgpICsgXCIuUG9zdGFsQ29kZVwiLCBwcm9wLmdldF9uYW1lKCkgKyBcIi5Db3VudHJ5XCJdO1xyXG5cclxuXHRcdC8vIGRlZmluZSBwcm9wZXJ0aWVzIGZvciB0aGUgcnVsZSwgZGVmYXVsdGluZyBpc1JlcXVpcmVkIHRvIHRydWUgaWYgbm90IHNwZWNpZmllZFxyXG5cdFx0aWYgKG9wdGlvbnMuZm4pIHtcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiaXNSZXF1aXJlZFwiLCB7IHZhbHVlOiBvcHRpb25zLmZuLCB3cml0YWJsZTogdHJ1ZSB9KTtcclxuXHRcdFx0b3B0aW9ucy5mbiA9IG51bGw7XHJcblx0XHR9XHJcblx0XHRlbHNlXHJcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImlzUmVxdWlyZWRcIiwgeyB2YWx1ZTogb3B0aW9ucy5pc1JlcXVpcmVkID09PSB0cnVlIH0pO1xyXG5cclxuXHRcdGlmIChvcHRpb25zLmVuZm9yY2VhYmxlRmllbGRzKVxyXG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJlbmZvcmNlYWJsZUZpZWxkc1wiLCB7IHZhbHVlOiBvcHRpb25zLmVuZm9yY2VhYmxlRmllbGRzIH0pO1xyXG5cclxuXHRcdC8vIGNhbGwgdGhlIGJhc2UgdHlwZSBjb25zdHJ1Y3RvclxyXG5cdFx0RXhvV2ViLk1vZGVsLlZhbGlkYXRlZFByb3BlcnR5UnVsZS5hcHBseSh0aGlzLCBbcm9vdFR5cGUsIG9wdGlvbnNdKTtcclxuXHR9XHJcblxyXG5cdC8vIHNldHVwIHRoZSBpbmhlcml0YW5jZSBjaGFpblxyXG5cdFJlcXVpcmVkQWRkcmVzc1J1bGUucHJvdG90eXBlID0gbmV3IEV4b1dlYi5Nb2RlbC5WYWxpZGF0ZWRQcm9wZXJ0eVJ1bGUoKTtcclxuXHRSZXF1aXJlZEFkZHJlc3NSdWxlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFJlcXVpcmVkQWRkcmVzc1J1bGU7XHJcblxyXG5cdFJlcXVpcmVkQWRkcmVzc1J1bGUubWl4aW4oe1xyXG5cclxuXHRcdC8vIGFzc2VydHMgdGhlIGNvbmRpdGlvbiBhbmQgYWRkcyBvciByZW1vdmVzIGl0IGZyb20gdGhlIG1vZGVsIGlmIG5lY2Vzc2FyeVxyXG5cdFx0ZXhlY3V0ZTogZnVuY3Rpb24gUmVxdWlyZWRBZGRyZXNzUnVsZSRleGVjdXRlKG9iaikge1xyXG5cclxuXHRcdFx0dmFyIG1lc3NhZ2U7XHJcblx0XHRcdHZhciBwcm9wZXJ0aWVzID0gW107XHJcblx0XHRcdHZhciB2YWxpZGF0ZVJlcXVpcmVkID0gZnVuY3Rpb24gUmVxdWlyZWRBZGRyZXNzUnVsZSR2YWxpZGF0ZVJlcXVpcmVkKHByb3BlcnR5LCBhZGRyZXNzLCBmaWVsZHMpIHtcclxuXHRcdFx0ICAgIHZhciBjb3VudCA9IDA7XHJcblx0XHRcdFx0bWVzc2FnZSA9IFwiXCI7XHJcblxyXG5cdFx0XHRcdC8vIGFkZCB0aGUgYWRkcmVzcyBwcm9wZXJ0eSBhcyBhIHByZWRpY2F0ZVxyXG5cdFx0XHRcdHByb3BlcnRpZXMucHVzaChwcm9wZXJ0eSk7XHJcblxyXG5cdFx0XHQgICAgZm9yICh2YXIgZiA9IGZpZWxkcy5sZW5ndGggLSAxOyBmID49IDA7IGYtLSkge1xyXG5cdFx0XHQgICAgICAgIHZhciBmaWVsZCA9IGZpZWxkc1tmXTtcclxuXHRcdFx0ICAgICAgICB2YXIgdmFsdWUgPSBhZGRyZXNzLmdldChmaWVsZCk7XHJcblx0XHRcdCAgICAgICAgaWYgKEV4b1dlYi5Nb2RlbC5SZXF1aXJlZFJ1bGUuaGFzVmFsdWUoYWRkcmVzcy5nZXQoZmllbGQpKSlcclxuXHRcdFx0ICAgICAgICAgICAgY29udGludWU7XHJcblx0XHRcdCAgICAgICAgcHJvcGVydGllcy5wdXNoKHByb3BlcnR5ICsgXCIuXCIgKyBmaWVsZCk7XHJcblx0XHRcdCAgICAgICAgLy8gUmVuYW1lIFBvc3RhbCBDb2RlIHRvIFppcCBDb2RlIGlmIFVTIEFkZHJlc3NcclxuXHRcdFx0ICAgICAgICB2YXIgbGFiZWwgPSBDb2duaXRvLnJlc291cmNlc1tcImFkZHJlc3MtXCIgKyBmaWVsZC50b0xvd2VyQ2FzZSgpXTtcclxuXHRcdFx0ICAgICAgICBpZiAoZmllbGQgPT09IFwiUG9zdGFsQ29kZVwiICYmIGFkZHJlc3MuZ2V0X0NvdW50cnkoKSA9PT0gQ29nbml0by5yZXNvdXJjZXMuZ2V0KFwidW5pdGVkLXN0YXRlc1wiKSlcclxuXHRcdFx0ICAgICAgICAgICAgbGFiZWwgPSBDb2duaXRvLnJlc291cmNlc1tcImFkZHJlc3MtemlwLWNvZGVcIl07XHJcblxyXG5cdFx0XHQgICAgICAgIGlmIChjb3VudCA9PSAwKVxyXG5cdFx0XHQgICAgICAgICAgICBtZXNzYWdlID0gbGFiZWw7XHJcblx0XHRcdCAgICAgICAgZWxzZSBpZiAoY291bnQgPT0gMSlcclxuXHRcdFx0ICAgICAgICAgICAgbWVzc2FnZSA9IFN0cmluZy5mb3JtYXQoQ29nbml0by5yZXNvdXJjZXMuZ2V0KFwidGhpcy1hbmQtdGhhdFwiKSwgbGFiZWwsIG1lc3NhZ2UpO1xyXG5cdFx0XHQgICAgICAgIGVsc2VcclxuXHRcdFx0ICAgICAgICAgICAgbWVzc2FnZSA9IFN0cmluZy5mb3JtYXQoQ29nbml0by5yZXNvdXJjZXMuZ2V0KFwidGhpcy1jb21tYS10aGF0XCIpLCBsYWJlbCwgbWVzc2FnZSk7XHJcblx0XHRcdCAgICAgICAgY291bnQrKztcclxuXHRcdFx0ICAgIH1cclxuXHRcdFx0ICAgIGlmIChjb3VudCA+IDApXHJcblx0XHRcdCAgICAgICAgbWVzc2FnZSA9IFN0cmluZy5mb3JtYXQoY291bnQgPT0gMSA/IENvZ25pdG8ucmVzb3VyY2VzLmdldChcInJlcXVpcmVkLW9uZVwiKSA6IENvZ25pdG8ucmVzb3VyY2VzLmdldChcInJlcXVpcmVkLW1hbnlcIiksIG1lc3NhZ2UpO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0Ly8gR2V0IHRoZSBhZGRyZXNzIGJlaW5nIHZhbGlkYXRlZFxyXG5cdFx0XHR2YXIgYWRkcmVzcyA9IHRoaXMucHJvcGVydHkudmFsdWUob2JqKTtcclxuXHJcblx0XHRcdC8vIFZhbGlkYXRlIHRoZSBhZGRyZXNzXHJcblx0XHRcdGlmIChhZGRyZXNzKVxyXG5cdFx0XHR7XHJcblx0XHRcdFx0Ly8gY29udmVydCBzdHJpbmcgZnVuY3Rpb25zIGludG8gY29tcGlsZWQgZnVuY3Rpb25zIG9uIGZpcnN0IGV4ZWN1dGlvblxyXG5cdFx0XHRcdGlmICh0aGlzLmlzUmVxdWlyZWQuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xyXG5cdFx0XHRcdFx0dGhpcy5pc1JlcXVpcmVkID0gdGhpcy5yb290VHlwZS5jb21waWxlRXhwcmVzc2lvbih0aGlzLmlzUmVxdWlyZWQpO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0dmFyIGlzUmVxdWlyZWQ7XHJcblx0XHRcdFx0aWYgKHRoaXMuaXNSZXF1aXJlZC5jb25zdHJ1Y3RvciA9PT0gQm9vbGVhbilcclxuXHRcdFx0XHRcdGlzUmVxdWlyZWQgPSB0aGlzLmlzUmVxdWlyZWQ7XHJcblx0XHRcdFx0ZWxzZXtcclxuXHRcdFx0XHRcdHRyeSB7XHJcblx0XHRcdFx0XHRcdGlzUmVxdWlyZWQgPSB0aGlzLmlzUmVxdWlyZWQuY2FsbChvYmosIG9iaik7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRjYXRjaCAoZSkge1xyXG5cdFx0XHRcdFx0XHRpc1JlcXVpcmVkID0gZmFsc2U7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRpZiAoaXNSZXF1aXJlZClcclxuICAgICAgICAgICAgICAgICAgICB2YWxpZGF0ZVJlcXVpcmVkKHRoaXMucHJvcGVydHkuZ2V0X25hbWUoKSwgYWRkcmVzcywgdGhpcy5lbmZvcmNlYWJsZUZpZWxkcyB8fCBbXSk7XHJcblxyXG5cdFx0XHRcdGlmIChhZGRyZXNzLmdldF9Db3VudHJ5KCkgPT09IENvZ25pdG8ucmVzb3VyY2VzLmdldChcInVuaXRlZC1zdGF0ZXNcIikpXHJcblx0XHRcdFx0e1xyXG5cdFx0XHRcdFx0aWYgKCFtZXNzYWdlICYmIEV4b1dlYi5Nb2RlbC5SZXF1aXJlZFJ1bGUuaGFzVmFsdWUoYWRkcmVzcy5nZXRfUG9zdGFsQ29kZSgpKSAmJiAhL15cXHMqKFxcZHs1fSkoLVxcZHs0fSk/XFxzKiQvLnRlc3QoYWRkcmVzcy5nZXRfUG9zdGFsQ29kZSgpKSlcclxuXHRcdFx0XHRcdHtcclxuXHRcdFx0XHRcdFx0bWVzc2FnZSA9IENvZ25pdG8ucmVzb3VyY2VzLmdldChcImFkZHJlc3MtemlwLWNvZGUtaW52YWxpZFwiKTtcclxuXHRcdFx0XHRcdFx0cHJvcGVydGllcy5wdXNoKHRoaXMucHJvcGVydHkuZ2V0X25hbWUoKSk7XHJcblx0XHRcdFx0XHRcdHByb3BlcnRpZXMucHVzaCh0aGlzLnByb3BlcnR5LmdldF9uYW1lKCkgKyBcIi5Qb3N0YWxDb2RlXCIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gQXNzZXJ0IG9yIHJlbW92ZSB0aGUgY29uZGl0aW9uIGJhc2VkIG9uIHRoZSB2YWxpZGF0aW9uIHJlc3VsdFxyXG5cdFx0XHR0aGlzLmNvbmRpdGlvblR5cGUud2hlbighIW1lc3NhZ2UsIG9iaiwgcHJvcGVydGllcywgbWVzc2FnZSk7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vIEV4cG9zZSB0aGUgcnVsZSBwdWJsaWNseVxyXG5cdEV4b1dlYi5Nb2RlbC5SdWxlLnJlcXVpcmVkQWRkcmVzcyA9IFJlcXVpcmVkQWRkcmVzc1J1bGU7XHJcblxyXG5cdC8vI2VuZHJlZ2lvblxyXG5cclxuXHQvLyNyZWdpb24gWmlwIENvZGUgUnVsZVxyXG5cclxuXHQvLyBWYWxpZGF0ZXMgcmVxdWlyZWQgYWRkcmVzcyBmaWVsZHNcclxuXHRmdW5jdGlvbiBaaXBDb2RlUnVsZShyb290VHlwZSwgb3B0aW9ucykge1xyXG5cclxuXHRcdC8vIGVuc3VyZSB0aGUgcnVsZSBuYW1lIGlzIHNwZWNpZmllZFxyXG5cdFx0b3B0aW9ucy5uYW1lID0gb3B0aW9ucy5uYW1lIHx8IFwiWmlwQ29kZVwiO1xyXG5cclxuXHRcdC8vIGVuc3VyZSB0aGUgZXJyb3IgbWVzc2FnZSBpcyBzcGVjaWZpZWRcclxuXHRcdG9wdGlvbnMubWVzc2FnZSA9IG9wdGlvbnMubWVzc2FnZSB8fCBcIlppcCBDb2RlIG11c3QgYmUgZm9ybWF0dGVkIGFzICMjIyMjLSMjIyMuXCI7XHJcblxyXG5cdFx0Ly8gY29uZmlndXJlIHRoZSBwcm9wZXJ0aWVzIHRvIHZhbGlkYXRlXHJcblx0XHR2YXIgcHJvcCA9IG9wdGlvbnMucHJvcGVydHkgaW5zdGFuY2VvZiBFeG9XZWIuTW9kZWwuUHJvcGVydHkgPyBvcHRpb25zLnByb3BlcnR5IDogcm9vdFR5cGUucHJvcGVydHkob3B0aW9ucy5wcm9wZXJ0eSk7XHJcblxyXG5cdFx0aWYgKG9wdGlvbnMub25DaGFuZ2VPZilcclxuXHRcdFx0b3B0aW9ucy5vbkNoYW5nZU9mID0gb3B0aW9ucy5vbkNoYW5nZU9mLmNvbmNhdChbcHJvcC5nZXRfbmFtZSgpICsgXCIuUG9zdGFsQ29kZVwiLCBwcm9wLmdldF9uYW1lKCkgKyBcIi5Db3VudHJ5XCJdKTtcclxuXHRcdGVsc2VcclxuXHRcdFx0b3B0aW9ucy5vbkNoYW5nZU9mID0gW3Byb3AuZ2V0X25hbWUoKSArIFwiLlBvc3RhbENvZGVcIiwgcHJvcC5nZXRfbmFtZSgpICsgXCIuQ291bnRyeVwiXTtcclxuXHJcblx0XHQvLyBjYWxsIHRoZSBiYXNlIHR5cGUgY29uc3RydWN0b3JcclxuXHRcdEV4b1dlYi5Nb2RlbC5WYWxpZGF0ZWRQcm9wZXJ0eVJ1bGUuYXBwbHkodGhpcywgW3Jvb3RUeXBlLCBvcHRpb25zXSk7XHJcblx0fVxyXG5cclxuXHQvLyBzZXR1cCB0aGUgaW5oZXJpdGFuY2UgY2hhaW5cclxuXHRaaXBDb2RlUnVsZS5wcm90b3R5cGUgPSBuZXcgRXhvV2ViLk1vZGVsLlZhbGlkYXRlZFByb3BlcnR5UnVsZSgpO1xyXG5cdFppcENvZGVSdWxlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFppcENvZGVSdWxlO1xyXG5cclxuXHRaaXBDb2RlUnVsZS5taXhpbih7XHJcblxyXG5cdFx0Ly8gYXNzZXJ0cyB0aGUgY29uZGl0aW9uIGFuZCBhZGRzIG9yIHJlbW92ZXMgaXQgZnJvbSB0aGUgbW9kZWwgaWYgbmVjZXNzYXJ5XHJcblx0XHRleGVjdXRlOiBmdW5jdGlvbiBaaXBDb2RlUnVsZSRleGVjdXRlKG9iaikge1xyXG5cclxuXHRcdFx0dmFyIG1lc3NhZ2U7XHJcblx0XHRcdHZhciBwcm9wZXJ0aWVzID0gW107XHJcblxyXG5cdFx0XHQvLyBHZXQgdGhlIGFkZHJlc3MgYmVpbmcgdmFsaWRhdGVkXHJcblx0XHRcdHZhciBhZGRyZXNzID0gdGhpcy5wcm9wZXJ0eS52YWx1ZShvYmopO1xyXG5cclxuXHRcdFx0Ly8gVmFsaWRhdGUgdGhlIGFkZHJlc3NcclxuXHRcdFx0aWYgKGFkZHJlc3MpIHtcclxuXHRcdFx0XHRpZiAoYWRkcmVzcy5nZXRfQ291bnRyeSgpID09PSBDb2duaXRvLnJlc291cmNlcy5nZXQoXCJ1bml0ZWQtc3RhdGVzXCIpKSB7XHJcblx0XHRcdFx0XHRpZiAoRXhvV2ViLk1vZGVsLlJlcXVpcmVkUnVsZS5oYXNWYWx1ZShhZGRyZXNzLmdldF9Qb3N0YWxDb2RlKCkpICYmICEvXlxccyooXFxkezV9KSgtXFxkezR9KT9cXHMqJC8udGVzdChhZGRyZXNzLmdldF9Qb3N0YWxDb2RlKCkpKSB7XHJcblx0XHRcdFx0XHRcdG1lc3NhZ2UgPSBDb2duaXRvLnJlc291cmNlcy5nZXQoXCJhZGRyZXNzLXppcC1jb2RlLWludmFsaWRcIik7XHJcblx0XHRcdFx0XHRcdHByb3BlcnRpZXMucHVzaCh0aGlzLnByb3BlcnR5LmdldF9uYW1lKCkpO1xyXG5cdFx0XHRcdFx0XHRwcm9wZXJ0aWVzLnB1c2godGhpcy5wcm9wZXJ0eS5nZXRfbmFtZSgpICsgXCIuUG9zdGFsQ29kZVwiKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIEFzc2VydCBvciByZW1vdmUgdGhlIGNvbmRpdGlvbiBiYXNlZCBvbiB0aGUgdmFsaWRhdGlvbiByZXN1bHRcclxuXHRcdFx0dGhpcy5jb25kaXRpb25UeXBlLndoZW4oISFtZXNzYWdlLCBvYmosIHByb3BlcnRpZXMsIG1lc3NhZ2UpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHQvLyBFeHBvc2UgdGhlIHJ1bGUgcHVibGljbHlcclxuXHRFeG9XZWIuTW9kZWwuUnVsZS56aXBDb2RlID0gWmlwQ29kZVJ1bGU7XHJcblxyXG5cdC8vI2VuZHJlZ2lvblxyXG5cclxuXHQvLyNyZWdpb24gVW5pcXVlIE5hbWUgUnVsZVxyXG5cclxuXHQvLyBjcmVhdGUgbmV3IHZhbGlkYXRpb24gcnVsZSB0byBlbnN1cmUgcHJvcGVydHkgdmFsdWUgaXMgdW5pcXVlXHJcblx0ZnVuY3Rpb24gVW5pcXVlUnVsZShyb290VHlwZSwgb3B0aW9ucykge1xyXG5cdFx0Ly8gZW5zdXJlIHRoZSBydWxlIG5hbWUgaXMgc3BlY2lmaWVkXHJcblx0XHRvcHRpb25zLm5hbWUgPSBvcHRpb25zLm5hbWUgfHwgXCJVbmlxdWVWYWx1ZVwiO1xyXG5cclxuXHRcdC8vIGVuc3VyZSB0aGUgZXJyb3IgbWVzc2FnZSBpcyBzcGVjaWZpZWRcclxuXHRcdG9wdGlvbnMubWVzc2FnZSA9IG9wdGlvbnMubWVzc2FnZSB8fCBcIlZhbHVlIG11c3QgYmUgdW5pcXVlXCI7XHJcblxyXG5cdFx0Ly8gZGVmaW5lIHByb3BlcnRpZXMgZm9yIHRoZSBydWxlXHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJzb3VyY2VPYmplY3RcIiwgeyB2YWx1ZTogb3B0aW9ucy5zb3VyY2VPYmplY3QgfSk7XHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJzb3VyY2VQYXRoXCIsIHsgdmFsdWU6IG9wdGlvbnMuc291cmNlUGF0aCB9KTtcclxuXHJcblx0XHQvLyBjYWxsIHRoZSBiYXNlIHR5cGUgY29uc3RydWN0b3JcclxuXHRcdEV4b1dlYi5Nb2RlbC5WYWxpZGF0ZWRQcm9wZXJ0eVJ1bGUuYXBwbHkodGhpcywgW3Jvb3RUeXBlLCBvcHRpb25zXSk7XHJcblxyXG5cdFx0Ly8gbmV2ZXIgcnVuIHVuaXF1ZSBiaWxsIHR5cGUgcnVsZXMgZHVyaW5nIGluaXRpYWxpemF0aW9uIG9mIGV4aXN0aW5nIGluc3RhbmNlc1xyXG5cdFx0b3B0aW9ucy5vbkluaXRFeGlzdGluZyA9IGZhbHNlO1xyXG5cdH1cclxuXHJcblx0Ly8gc2V0dXAgdGhlIGluaGVyaXRhbmNlIGNoYWluXHJcblx0VW5pcXVlUnVsZS5wcm90b3R5cGUgPSBuZXcgRXhvV2ViLk1vZGVsLlZhbGlkYXRlZFByb3BlcnR5UnVsZSgpO1xyXG5cdFVuaXF1ZVJ1bGUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gVW5pcXVlUnVsZTtcclxuXHJcblx0VW5pcXVlUnVsZS5taXhpbih7XHJcblx0XHRvblJlZ2lzdGVyOiBmdW5jdGlvbiBVbmlxdWVSdWxlJG9uUmVnaXN0ZXIoKSB7XHJcblx0XHRcdC8vIGNhbGwgdGhlIGJhc2UgbWV0aG9kXHJcblx0XHRcdEV4b1dlYi5Nb2RlbC5WYWxpZGF0ZWRQcm9wZXJ0eVJ1bGUucHJvdG90eXBlLm9uUmVnaXN0ZXIuY2FsbCh0aGlzKTtcclxuXHRcdH0sXHJcblx0XHRpc1ZhbGlkOiBmdW5jdGlvbiBVbmlxdWVSdWxlJGlzVmFsaWQob2JqLCBwcm9wLCB2YWx1ZSkge1xyXG5cdFx0XHRpZiAoIXRoaXMuc291cmNlT2JqZWN0IHx8ICF0aGlzLnNvdXJjZVBhdGgpIHtcclxuXHRcdFx0XHRFeG9XZWIubG9nV2FybmluZyhcIlVuaXF1ZSBydWxlIG9uIHR5cGUgXFxcIlwiICsgcHJvcC5nZXRfY29udGFpbmluZ1R5cGUoKS5nZXRfZnVsbE5hbWUoKSArIFwiXFxcIiBoYXMgbm90IGJlZW4gaW5pdGlhbGl6ZWQuXCIpO1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gcmV0dXJuIHRydWUgaWYgbm8gdmFsdWUgaXMgY3VycmVudGx5IHNlbGVjdGVkXHJcblx0XHRcdGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsKSB7XHJcblx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIGdldCB0aGUgbGlzdCBvZiBhbGxvd2VkIHZhbHVlcyBvZiB0aGUgcHJvcGVydHkgZm9yIHRoZSBnaXZlbiBvYmplY3RcclxuXHRcdFx0dmFyIHZhbHVlc1RvU2VhcmNoID0gdGhpcy52YWx1ZXMob2JqKTtcclxuXHRcdFx0dmFyIGV4aXN0aW5nVHlwZSA9IG51bGw7XHJcblxyXG5cdFx0XHRBcnJheS5mb3JFYWNoKHZhbHVlc1RvU2VhcmNoLCBmdW5jdGlvbiAodmFsKSB7XHJcblx0XHRcdFx0aWYgKHByb3AudmFsdWUodmFsKS50b0xvd2VyQ2FzZSgpID09IHZhbHVlLnRvTG93ZXJDYXNlKCkgJiYgdmFsLmdldF9JZCgpICE9IG9iai5nZXRfSWQoKSkge1xyXG5cdFx0XHRcdFx0ZXhpc3RpbmdUeXBlID0gdmFsO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gZXhpc3RpbmdUeXBlID09IG51bGwgfHwgZXhpc3RpbmdUeXBlID09IHVuZGVmaW5lZDtcclxuXHRcdH0sXHJcblx0XHR2YWx1ZXM6IGZ1bmN0aW9uIFVuaXF1ZVJ1bGUkdmFsdWVzKG9iaiwgZXhpdEVhcmx5KSB7XHJcblx0XHRcdGlmICghdGhpcy5zb3VyY2VPYmplY3QgfHwgIXRoaXMuc291cmNlUGF0aCkge1xyXG5cdFx0XHRcdEV4b1dlYi5sb2dXYXJuaW5nKFwiVW5pcXVlIHJ1bGUgb24gdHlwZSBcXFwiXCIgKyB0aGlzLnByb3AuZ2V0X2NvbnRhaW5pbmdUeXBlKCkuZ2V0X2Z1bGxOYW1lKCkgKyBcIlxcXCIgaGFzIG5vdCBiZWVuIGluaXRpYWxpemVkLlwiKTtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIFJldHVybiB0aGUgdmFsdWUgb2YgdGhlIHNvdXJjZSBmb3IgdGhlIGdpdmVuIG9iamVjdFxyXG5cdFx0XHRyZXR1cm4gdGhpcy5zb3VyY2VPYmplY3RbXCJnZXRfXCIgKyB0aGlzLnNvdXJjZVBhdGhdKCk7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vIEV4cG9zZSB0aGUgcnVsZSBwdWJsaWNseVxyXG5cdEV4b1dlYi5Nb2RlbC5SdWxlLnVuaXF1ZSA9IFVuaXF1ZVJ1bGU7XHJcblxyXG5cdC8vIEFzc29jaWF0ZSB0aGUgcnVsZSB0byB0aGUgZXhvIG1vZGVsIHByb3BlcnR5IG9iamVjdCBzbyBpdCBjYW4gYmUgYXNzaWduZWQgdG8gYSBwcm9wZXJ0eVxyXG5cdEV4b1dlYi5Nb2RlbC5Qcm9wZXJ0eS5wcm90b3R5cGUudW5pcXVlID0gZnVuY3Rpb24gKHNvdXJjZU9iamVjdCwgc291cmNlUGF0aCwgbWVzc2FnZSkge1xyXG5cdFx0bmV3IEV4b1dlYi5Nb2RlbC5SdWxlLnVuaXF1ZSh0aGlzLmdldF9jb250YWluaW5nVHlwZSgpLCB7IHByb3BlcnR5OiB0aGlzLCBtZXNzYWdlOiBtZXNzYWdlLCBzb3VyY2VQYXRoOiBzb3VyY2VQYXRoLCBzb3VyY2VPYmplY3Q6IHNvdXJjZU9iamVjdCB9KTtcclxuXHRcdHJldHVybiB0aGlzO1xyXG5cdH07XHJcblxyXG5cdC8vI2VuZHJlZ2lvblxyXG5cclxuXHQvLyNyZWdpb24gUmVxdWlyZWQgUmF0aW5nU2NhbGUgUnVsZVxyXG5cclxuXHQvLyB2YWxpZGF0ZXMgdGhhdCB0aGUgZmlyc3QgYW5kIGxhc3QgZmllbGRzIG9mIGEgbmFtZSBhcmUgc3BlY2lmaWVkXHJcblx0ZnVuY3Rpb24gUmVxdWlyZWRSYXRpbmdTY2FsZVJ1bGUocm9vdFR5cGUsIG9wdGlvbnMpIHtcclxuXHJcblx0XHQvLyBlbnN1cmUgdGhlIHJ1bGUgbmFtZSBpcyBzcGVjaWZpZWRcclxuXHRcdG9wdGlvbnMubmFtZSA9IG9wdGlvbnMubmFtZSB8fCBcIlJlcXVpcmVkUmF0aW5nU2NhbGVcIjtcclxuXHJcblx0XHQvLyBjb25maWd1cmUgdGhlIHByb3BlcnRpZXMgdG8gdmFsaWRhdGVcclxuXHRcdHZhciBwcm9wID0gb3B0aW9ucy5wcm9wZXJ0eSBpbnN0YW5jZW9mIEV4b1dlYi5Nb2RlbC5Qcm9wZXJ0eSA/IG9wdGlvbnMucHJvcGVydHkgOiByb290VHlwZS5wcm9wZXJ0eShvcHRpb25zLnByb3BlcnR5KTtcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInByb3BlcnR5XCIsIHsgdmFsdWU6IHByb3AgfSk7XHJcblxyXG5cdFx0Ly8gZGVmaW5lIHByb3BlcnRpZXMgZm9yIHRoZSBydWxlLCBkZWZhdWx0aW5nIGlzUmVxdWlyZWQgdG8gdHJ1ZSBpZiBub3Qgc3BlY2lmaWVkXHJcblx0XHRpZiAob3B0aW9ucy5mbikge1xyXG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJpc1JlcXVpcmVkXCIsIHsgdmFsdWU6IG9wdGlvbnMuZm4sIHdyaXRhYmxlOiB0cnVlIH0pO1xyXG5cdFx0XHRvcHRpb25zLmZuID0gbnVsbDtcclxuXHRcdH1cclxuXHRcdGVsc2VcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiaXNSZXF1aXJlZFwiLCB7IHZhbHVlOiBvcHRpb25zLmlzUmVxdWlyZWQgIT0gZmFsc2UgfSk7XHJcblxyXG5cdFx0Ly8gYXV0b21hdGljYWxseSBydW4gdGhlIGNvbmRpdGlvbiBydWxlIGR1cmluZyBpbml0aWFsaXphdGlvbiBvZiBuZXcgaW5zdGFuY2VzXHJcblx0XHRvcHRpb25zLm9uSW5pdE5ldyA9IHRydWU7XHJcblxyXG5cdFx0dmFyIGNvbmRpdGlvblR5cGVzID0gW107XHJcblx0XHR2YXIgcmF0aW5nU2NhbGVQYXRoID0gcHJvcC5nZXRfbmFtZSgpICsgXCIuXCI7XHJcblx0XHRvcHRpb25zLm9uQ2hhbmdlT2YuZm9yRWFjaChmdW5jdGlvbiAocGF0aCkge1xyXG5cdFx0XHQvLyBzdGFydHNXaXRoIFwiPFJhdGluZ1NjYWxlIEludGVybmFsTmFtZT4uXCJcclxuXHRcdFx0aWYgKHBhdGguaW5kZXhPZihyYXRpbmdTY2FsZVBhdGgpID09PSAwKVxyXG5cdFx0XHRcdGNvbmRpdGlvblR5cGVzLnB1c2goRXhvV2ViLk1vZGVsLlJ1bGUuZW5zdXJlQ29uZGl0aW9uVHlwZShvcHRpb25zLm5hbWUgKyBcIi5cIiArIHBhdGgsIHJvb3RUeXBlLCBFeG9XZWIuTW9kZWwuQ29uZGl0aW9uVHlwZS5FcnJvcikpO1xyXG5cdFx0fSlcclxuXHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJjb25kaXRpb25UeXBlc1wiLCB7IHZhbHVlOiBjb25kaXRpb25UeXBlcyB9KTtcclxuXHJcblx0XHQvLyBjYWxsIHRoZSBiYXNlIHR5cGUgY29uc3RydWN0b3JcclxuXHRcdEV4b1dlYi5Nb2RlbC5SdWxlLmFwcGx5KHRoaXMsIFtyb290VHlwZSwgb3B0aW9uc10pO1xyXG5cdH1cclxuXHJcblx0Ly8gc2V0dXAgdGhlIGluaGVyaXRhbmNlIGNoYWluXHJcblx0UmVxdWlyZWRSYXRpbmdTY2FsZVJ1bGUucHJvdG90eXBlID0gbmV3IEV4b1dlYi5Nb2RlbC5SdWxlKCk7XHJcblx0UmVxdWlyZWRSYXRpbmdTY2FsZVJ1bGUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUmVxdWlyZWRSYXRpbmdTY2FsZVJ1bGU7XHJcblxyXG5cdFJlcXVpcmVkUmF0aW5nU2NhbGVSdWxlLm1peGluKHtcclxuXHJcblx0XHQvLyBhc3NlcnRzIHRoZSBjb25kaXRpb24gYW5kIGFkZHMgb3IgcmVtb3ZlcyBpdCBmcm9tIHRoZSBtb2RlbCBpZiBuZWNlc3NhcnlcclxuXHRcdGV4ZWN1dGU6IGZ1bmN0aW9uIFJlcXVpcmVkUmF0aW5nU2NhbGVSdWxlJGV4ZWN1dGUob2JqKSB7XHJcblxyXG5cdFx0XHQvLyBjb252ZXJ0IHN0cmluZyBmdW5jdGlvbnMgaW50byBjb21waWxlZCBmdW5jdGlvbnMgb24gZmlyc3QgZXhlY3V0aW9uXHJcblx0XHRcdGlmICh0aGlzLmlzUmVxdWlyZWQuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xyXG5cdFx0XHRcdHRoaXMuaXNSZXF1aXJlZCA9IHRoaXMucm9vdFR5cGUuY29tcGlsZUV4cHJlc3Npb24odGhpcy5pc1JlcXVpcmVkKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIHJhdGluZ1NjYWxlID0gdGhpcy5wcm9wZXJ0eS52YWx1ZShvYmopO1xyXG5cdFx0XHR2YXIgdmFsaWRhdGlvbk1lc3NhZ2UgPSBDb2duaXRvLnJlc291cmNlcy5nZXQoXCJyZXF1aXJlZFwiKTtcclxuXHRcdFx0dmFyIHByb3BlcnRpZXMgPSB0aGlzLnByb3BlcnRpZXM7XHJcblxyXG5cdFx0XHRpZiAocmF0aW5nU2NhbGUpIHtcclxuXHRcdFx0XHR2YXIgdmFsaWRhdGU7XHJcblxyXG5cdFx0XHRcdGlmICh0aGlzLmlzUmVxdWlyZWQuY29uc3RydWN0b3IgPT09IEJvb2xlYW4pXHJcblx0XHRcdFx0XHR2YWxpZGF0ZSA9IHRoaXMuaXNSZXF1aXJlZDtcclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHZhciBpc1JlcTtcclxuXHRcdFx0XHRcdHRyeSB7XHJcblx0XHRcdFx0XHRcdGlzUmVxID0gdGhpcy5pc1JlcXVpcmVkLmNhbGwob2JqKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGNhdGNoIChlKSB7XHJcblx0XHRcdFx0XHRcdGlzUmVxID0gZmFsc2U7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0dmFsaWRhdGUgPSBpc1JlcTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHZhciBwcm9wZXJ0aWVzID0gcmF0aW5nU2NhbGUubWV0YS50eXBlLmdldF9wcm9wZXJ0aWVzKCk7XHJcblx0XHRcdFx0Ly8gSXRlcmF0ZSBvdmVyIHRoZSByYXRpbmcgc2NhbGUgcXVlc3Rpb25zIGFzc2VydGluZyBvciByZW1vdmluZyB0aGUgY29uZGl0aW9uIGJhc2VkIG9uIHRoZSB2YWxpZGF0aW9uIHJlc3VsdCBcclxuXHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHByb3BlcnRpZXMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHRcdHZhciBwcm9wID0gcHJvcGVydGllc1tpXTtcclxuXHRcdFx0XHRcdHZhciBmaWVsZE5hbWUgPSBwcm9wLmdldF9maWVsZE5hbWUoKTtcclxuXHRcdFx0XHRcdHZhciBhc3NlcnQgPSB2YWxpZGF0ZSAmJiAhRXhvV2ViLk1vZGVsLlJlcXVpcmVkUnVsZS5oYXNWYWx1ZShyYXRpbmdTY2FsZVtmaWVsZE5hbWVdKTtcclxuXHRcdFx0XHRcdHZhciBtZXNzYWdlID0gdmFsaWRhdGlvbk1lc3NhZ2UucmVwbGFjZSgne3Byb3BlcnR5fScsIHByb3AuZ2V0X2xhYmVsKCkpO1xyXG5cclxuXHRcdFx0XHRcdC8vIGxvb2t1cCB0aGUgY29uZGl0aW9uIHR5cGUgXHJcblx0XHRcdFx0XHR2YXIgY29uZGl0aW9uVHlwZSA9IHRoaXMuY29uZGl0aW9uVHlwZXMuZmlsdGVyKGZ1bmN0aW9uIChjKSB7IHJldHVybiBlbmRzV2l0aChjLmNvZGUsIHByb3AuZ2V0X25hbWUoKSk7IH0pWzBdO1xyXG5cdFx0XHRcdFx0aWYgKGNvbmRpdGlvblR5cGUpXHJcblx0XHRcdFx0XHRcdGNvbmRpdGlvblR5cGUud2hlbihhc3NlcnQsIHJhdGluZ1NjYWxlLCBbcHJvcC5nZXRfbmFtZSgpXSwgbWVzc2FnZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSk7XHJcblx0XHJcblx0Ly8gRXhwb3NlIHRoZSBydWxlIHB1YmxpY2x5XHJcblx0RXhvV2ViLk1vZGVsLlJ1bGUucmVxdWlyZWRSYXRpbmdTY2FsZSA9IFJlcXVpcmVkUmF0aW5nU2NhbGVSdWxlO1xyXG5cclxuXHRmdW5jdGlvbiBlbmRzV2l0aChzdHIsIHN1ZmZpeCkge1xyXG5cdFx0cmV0dXJuIHN0ci5pbmRleE9mKHN1ZmZpeCwgc3RyLmxlbmd0aCAtIHN1ZmZpeC5sZW5ndGgpICE9PSAtMTtcclxuXHR9XHJcblxyXG5cdC8vI2VuZHJlZ2lvblxyXG5cclxufSkoKTtcclxufSkodHlwZW9mIGV4cG9ydHMgPT09ICd1bmRlZmluZWQnKTtcclxuIiwiaW1wb3J0IGNvcmVTY3JpcHQgZnJvbSAnQGxlZ2FjeS9TY3JpcHRzL3JlcXVpcmVkL0NvZ25pdG8tY29yZS5qcyc7XHJcbmltcG9ydCBtZXNzYWdpbmdTY3JpcHQgZnJvbSAnQGxlZ2FjeS9TY3JpcHRzL2NvbXBvbmVudC9jb2duaXRvLW1lc3NhZ2luZy5qcyc7XHJcbmltcG9ydCBjb3JlQWRtaW5TY3JpcHQgZnJvbSAnQGxlZ2FjeS9TY3JpcHRzL0NvZ25pdG8tY29yZS1hZG1pbi5qcyc7XHJcbmltcG9ydCBhZG1pblNjcmlwdCBmcm9tICdAbGVnYWN5L1ZpZXdzL0FkbWluL2FkbWluLmpzJztcclxuaW1wb3J0IHZhbGlkYXRpb25TY3JpcHQgZnJvbSAnQGxlZ2FjeS9TY3JpcHRzL3JlcXVpcmVkL0NvZ25pdG8tdmFsaWRhdGlvbi5qcyc7XHJcbmltcG9ydCB0eXBlIHsgTGVnYWN5U2NyaXB0TW9kdWxlIH0gZnJvbSAnLi91dGlscy91dGlscyc7XHJcbmltcG9ydCB0eXBlIHsgQ29nbml0b0dsb2JhbCBhcyBDb3JlQ29nbml0b0dsb2JhbCB9IGZyb20gJ0BsZWdhY3kvU2NyaXB0cy9yZXF1aXJlZC9Db2duaXRvLWNvcmUnO1xyXG5pbXBvcnQgdHlwZSB7IENvZ25pdG9HbG9iYWwgYXMgQ29yZUFkbWluQ29nbml0b0dsb2JhbCB9IGZyb20gJ0BsZWdhY3kvU2NyaXB0cy9Db2duaXRvLWNvcmUtYWRtaW4nO1xyXG5pbXBvcnQgdHlwZSB7IENvZ25pdG9HbG9iYWwgYXMgQWRtaW5Db2duaXRvR2xvYmFsIH0gZnJvbSAnQGxlZ2FjeS9WaWV3cy9BZG1pbi9hZG1pbic7XHJcbmltcG9ydCB0eXBlIHsgQ29nbml0b0dsb2JhbCBhcyBNZXNzYWdpbmdDb2duaXRvR2xvYmFsIH0gZnJvbSAnQGxlZ2FjeS9TY3JpcHRzL2NvbXBvbmVudC9jb2duaXRvLW1lc3NhZ2luZyc7XHJcblxyXG4vLyBzaW5jZSB0aGUgaW1wb3J0cyBhYm92ZSBhdXRvbWF0aWNhbGx5IGV4ZWN1dGUgdGhlaXIgZnVuY3Rpb25zLCBhdm9pZCBkdXBsaWNhdGUgZXhlY3V0aW9uIG9uIHRoZSBmaXJzdCBjYWxsIHRvIGV4ZWN1dGVTY3JpcHRzXHJcbmxldCBpc0luaXRpYWxJbXBvcnQgPSB0cnVlO1xyXG5leHBvcnQgZnVuY3Rpb24gZXhlY3V0ZVNjcmlwdHMoKSB7XHJcblx0aWYgKCFpc0luaXRpYWxJbXBvcnQpIHtcclxuXHRcdChjb3JlU2NyaXB0IGFzIExlZ2FjeVNjcmlwdE1vZHVsZSkuZXhlYygpO1xyXG5cdFx0KG1lc3NhZ2luZ1NjcmlwdCBhcyBMZWdhY3lTY3JpcHRNb2R1bGUpLmV4ZWMoKTtcclxuXHRcdChjb3JlQWRtaW5TY3JpcHQgYXMgTGVnYWN5U2NyaXB0TW9kdWxlKS5leGVjKCk7XHJcblx0XHQoYWRtaW5TY3JpcHQgYXMgTGVnYWN5U2NyaXB0TW9kdWxlKS5leGVjKCk7XHJcblx0XHQodmFsaWRhdGlvblNjcmlwdCBhcyBMZWdhY3lTY3JpcHRNb2R1bGUpLmV4ZWMoKTtcclxuXHR9XHJcblx0aXNJbml0aWFsSW1wb3J0ID0gZmFsc2U7XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIENvZ25pdG9HbG9iYWwgPSBDb3JlQ29nbml0b0dsb2JhbCAmIENvcmVBZG1pbkNvZ25pdG9HbG9iYWwgJiBBZG1pbkNvZ25pdG9HbG9iYWwgJiBNZXNzYWdpbmdDb2duaXRvR2xvYmFsO1xyXG4iXSwic291cmNlUm9vdCI6IiJ9