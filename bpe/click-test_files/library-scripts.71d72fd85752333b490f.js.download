(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["library-scripts"],{

/***/ "../../../Cognito.Services/Scripts/component/cognito-dialog.js":
/*!******************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Cognito.Services/Scripts/component/cognito-dialog.js ***!
  \******************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

; (function ($) {
	var Dialog = function (options, element) {
		this._options = $.extend({}, Dialog.defaults, options);
		this._dialogVisible = false;
		this._hasTemplate = false;
		this._checkpoint = null;
		this._isExecuting = new ExoWeb.Signal();
		this._defaultButton = null;
		this._accelerators = {};

		// If an instance/property was specified, but no buttons, create default buttons
		if (this._options.instance) {
			if (!this._options.buttons) {
				this._options.buttons = [
					{
						label: "Cancel",
						isCancel: true
					},
					{
						label: "Ok",
						autoClose: false,
						click: function () {
							this._checkpoint = null;
							this.close(false);
						}
					}
				]
			}
		} else if (!this._options.buttons) {
			this._options.buttons = {
				"Ok": function () {
					this.close(false);
				}
			}
		}

		if (element) {
			this.$element = $(element);
			this.$element.bind("click", this.open.bind(this, element));
		}

		//this.$element.append(this._create());
		this._dialog = this._create();

		// Create and add the dialog UI elements once the DOM is ready
		var that = this;
		var readyDeps = ["ExoWeb.dom"];
		if (this._options.templateDep)
			readyDeps.push(this._options.templateDep);
		Cognito.ready("append-dialog-" + options.title, readyDeps, function ($) {
			var cognitoContainer = $('.c-app-container');
			var cognitoDiv = cognitoContainer.length ? cognitoContainer : $('.cognito:first');
			that._dialog.appendTo(cognitoDiv.length == 0 || Cognito.config.flags.AppNav ? document.body : cognitoDiv);

			// Force activation if using templates
			if (that._options.templateName)
				Sys.Application.activateElement(that._dialog[0]);
		});
	};

	Dialog.defaults = {
		title: "",
		width: 400,
		height: 200,
		text: "",
		source: "",
		open: undefined,
		cancel: undefined,
		instance: null,
		property: null,
		templateName: null,
		closeOnEscape: true,
		includeCloseButton: true,
		contentSelector: null,
		closeOnOverlayClick: true,
		modalClass: "",
		contentClass: "",
		onClose: null
	};

	Dialog.activeDialogs = [];

	const zModalOverlay = 1040;

	Dialog.prototype = {
		_create: function () {
			var dialogPane = $("<div class='c-modal scrollbar' />");
			dialogPane.addClass(this._options.modalClass)
								.append("<div class='c-modal-overlay'></div>")
			var dialogContainer = dialogPane;

			dialogContainer.append(this._createContent());

			// Only include the title bar if a title was specified
			if (this._options.title) {
				dialogContainer.prepend(this._createTitle());
			}
			else
				dialogContainer.children().css({ "padding-top": "0px" });

			dialogContainer.append(this._createButtons());

			// Ensure that clicks inside the dialog do not propagate beyond the dialog context
			dialogPane.click(function (event) {
				(event.originalEvent || event).dialog = true;
			});

			return dialogPane;
		},
		_createTitle: function () {
			var titlePane = $("<div class='c-modal-title-bar' />");
			titlePane.append("<div class='c-modal-title'>" + this._options.title + "</div>")

			if (this._options.includeCloseButton) {
				var closePane = $("<div class='c-modal-close' />") // close button
				closePane.append("<i class='icon-remove' />");
				closePane.bind("click", this.close.bind(this));
				titlePane.append(closePane);
			}

			return titlePane;
		},
		_createContent: function () {
			var contentContainer = $("<div class='c-modal-content-container' />");
			var contentPane = $("<div class='c-modal-content' />");
			contentContainer.addClass(this._options.contentClass);
			contentContainer.append(contentPane);
			if (this._options.text) {
				var textContainer = $("<p>");
				if (this._options.text.constructor === String)
					textContainer.html(this._options.text);
				contentPane.append(textContainer);
			} else if (this._options.contentSelector) {
				contentPane.append($(this._options.contentSelector).show());
			}

			// If template name provided, load existing, otherwise create new template
			if (this._options.instance && this._options.templateName)
				contentPane.append(this._loadTemplate());
			else if (this._options.instance)
				contentPane.append(this._createTemplate());

			return contentContainer;
		},
		_createButtons: function () {
			var that = this;
			var buttonPane = $("<div class='c-modal-button-bar' />");
			var leftButtons = $("<div class='c-modal-buttons-left' />");
			var rightButtons = $("<div class='c-modal-buttons-right' />");
			if (this._options.buttons) {
				$.each(this._options.buttons, function (name, props) {
					var button;
					var execute = function () { };
					var autoClose = true;
					var isAlignedRight = true;
					var isAction = false;
					var isDefault = false;
					var isTab = false;
					var isCancel = false;

					// Can use array to pass in additional options
					if (Array.isArray(that._options.buttons)) {
						name = props.label;
						if ($.isFunction(props.click)) execute = props.click;
						if (props.align === "left") isAlignedRight = false;
						autoClose = props.autoClose != false;
						isAction = props.isAction;
						isTab = props.isTab;
						isCancel = props.isCancel;
						isDefault = props.isDefault;
					}
					else {
						if ($.isFunction(props)) {
							execute = props;
						} else {
							if (props.execute && $.isFunction(props.execute)) execute = props.execute;
							isDefault = props.isDefault;
						}
					}

					// Tabbed button
					if (isTab) {
						button = props.isDefaultTab ? $("<a class='c-modal-tab c-modal-tab-active'>" + name + "</a>") : $("<a class='c-modal-tab'>" + name + "</a>");
						isAlignedRight = false;
					}
					else {
						var actionStyle = isAction ? " c-modal-button-action" : "";
						actionStyle += isCancel ? " c-modal-button-cancel button--secondary" : " button--primary";
						button = isAlignedRight ? $("<a class='c-modal-button" + actionStyle + "'>" + name + "</a>") : $("<a class='c-modal-button c-modal-button-left" + actionStyle + "'>" + name + "</a>");
					}
					if (isDefault) that._defaultButton = button;

					var acceleratorChar = null;
					for (var i = 0; i < name.length && !acceleratorChar; i++) {
						if (!that._accelerators[name[i].toLowerCase()]) acceleratorChar = name[i].toLowerCase();
					}

					that._accelerators[acceleratorChar] = button;

					button.bind("click", that._buttonWrapper.bind(that, buttonPane, execute, autoClose, isCancel, button));
					isAlignedRight ? rightButtons.append(button) : leftButtons.append(button);
				});

				buttonPane.append(leftButtons);
				buttonPane.append(rightButtons);
			}

			return buttonPane;
		},
		_createTemplate: function () {
			var templatePane = $("<div class='sys-template' sys:attach='dataview' dataview:data='{~ " + this._options.instance + " }' sys:content-template='form' />");
			templatePane.append("<div sys:attach='content' content:data='{@ " + this._options.property + "}' />");

			return templatePane;
		},
		_loadTemplate: function () {
			return $("<div sys:attach='content' content:data='{~ " + this._options.instance + " }' content:template='" + this._options.templateName + "'></div>");
		},
		_buttonWrapper: function (buttonPane, buttonFunc, autoClose, isCancel, button, event) {
			if (this._isExecuting.isActive()) return;

			if (!isCancel && button.hasClass("c-modal-button"))
				button.addClass("c-modal-button-executing");

			buttonFunc.call(this, event, button);

			var that = this;
			this._isExecuting.waitForAll(function () {
				if (autoClose && that._dialogVisible) that.close(isCancel);
			});
		},
		_bindTo: function (element) {
			if (element) $(element).bind("click", this.open.bind(this));
		},
		_createCheckpoint: function () {
			this._checkpoint = context.server.checkpoint();
		},
		open: function (origEvt) {			
			if (this._options.open) {
				if (!this._options.open.call(this, origEvt))

					// Indicate that the dialog was not opened
					return false;
			}

			$('body').addClass('c-modal-active');

			if (this._options.url) {
				this._dialog.find(".c-modal-content").remove();

				var contentContainer = this._dialog.find(".c-modal-content-container");

				this.frame = $("<iframe"
					+ (this._options.name ? " name='" + this._options.name + "'" : "")
					+ " style='width: 100%; height: 100%; overflow-x: hidden; overflow-y: hidden; -ms-overflow-style: scrollbar'"
					+ " src='" + this._options.url + "'"
					+ "></iframe>")
					.appendTo(contentContainer)
					.get(0);
			}
			else if (this._options.text instanceof Function)
				this._dialog.find(".c-modal-content p").html(this._options.text());

			if (origEvt) {
				this.$element = $(origEvt.currentTarget);
				if (origEvt.preventDefault instanceof Function)
					origEvt.preventDefault();
			}

			// Expose the event that caused the dialog to open
			this.event = origEvt;

			if (this._options.checkpoint) {
				window.context.server.beginCapturingChanges();
				this._checkpoint = context.server.checkpoint();
			}

			// Show the overlay and support automatic closure when the overlay is clicked
			if (Cognito.showOverlay && Dialog.activeDialogs.length == 0) {
				Cognito.showOverlay(function () {
					var dialogs = Dialog.activeDialogs;
					Dialog.activeDialogs = [];
					for (var d = dialogs.length - 1; d >= 0; d--) {
						var dialog = dialogs[d];
						if (dialog._options.closeOnOverlayClick)
							dialog.close(true);
					}
				});
			}

			// Set the width and height
			this._dialog.css({
				"max-width": this._options.width + ($.isNumeric(this._options.width) ? "px" : "")
			});

			// Show the dialog
			this._dialog.css("opacity", 1)
									.addClass("is-active")
									.fadeIn();

			// Fade in an overlay above the active dialog, if stacking
			if (Dialog.activeDialogs.length > 0) {
				var dialog = Dialog.activeDialogs[Dialog.activeDialogs.length - 1];
				$(dialog._dialog).css("z-index", zModalOverlay - 1);
				dialog._dialog.find(".c-modal-overlay").fadeIn();
			}

			// Add the dialog to the active dialog stack
			Dialog.activeDialogs.push(this);

			this._dialogVisible = true;

			// Indicate that the dialog was opened
			return true;
		},
		close: function (isCancel) {

			if (this.frame) {
				var frame = this.frame;

				// Clean up the iframe
				// http://stackoverflow.com/questions/12128458/iframes-and-memory-management-in-javascript
				frame.src = "about:blank";
				setTimeout(function () {
					frame.contentWindow.location.reload();
					setTimeout(function () {
						$(frame).remove();
					}, 1000);
				});

				delete this.frame;
			}

			if ($('.c-modal.is-active, .c-modal[style*="display: block"]').length === 1)
				$('body').removeClass('c-modal-active');

			var that = this;
			if (this._checkpoint && this._options.checkpoint) {
				if (isCancel)
					context.server.rollback(this._checkpoint);
				context.server.stopCapturingChanges();
			}

			if (isCancel && this._options.cancel) {
				this._options.cancel.call(this);
			}

			if (typeof (this._options.onClose) === "function")
				this._options.onClose.call(this);

			$(".c-modal-button:visible").removeClass("c-modal-button-executing");
			this._dialog.removeClass("is-active");
			this._dialog.fadeOut(function () { that._isExecuting = new ExoWeb.Signal(); that._dialog.find(".c-modal-overlay").hide() });

			Dialog.activeDialogs.pop(this);

			// Fade out the overlay above the active dialog, if stacking
			if (Dialog.activeDialogs.length > 0) {
				var dialog = Dialog.activeDialogs[Dialog.activeDialogs.length - 1];
				$(dialog._dialog).css("z-index", "");
				dialog._dialog.find(".c-modal-overlay").fadeOut();
			}

			// Hide the overlay, if this is the final dialog
			else
				window.Cognito && Cognito.hideOverlay();

			this._dialogVisible = false;
		},
		pending: function (callback) {
			return this._isExecuting.pending(callback);
		},
		orPending: function (callback) {
			return this._isExecuting.orPending(callback);
		}
	};

	var that = this;

	// For some unknown reason, the event is being bounded multiple times.  To ensure the event is only bounded once, the event is unbind before it is bind.
	$(document)
		.on("keyup.cognito.dialog", function (e) {
			if (Dialog.activeDialogs.length > 0) {
				var dialog = Dialog.activeDialogs[Dialog.activeDialogs.length - 1];

				if (e.altKey || e.ctrlKey)
					return;

				switch (e.keyCode) {
					case 27:
						if (dialog._options.closeOnEscape) {
							dialog.close.call(dialog, true);
							e.preventDefault();
						}
						break;
					default:
						if (!$(e.target).is("input, textarea")) {
							var charCode = e.which || e.keyCode;
							var char = String.fromCharCode(charCode).toLowerCase();
							if (dialog._accelerators[char] && !dialog._accelerators[char].is("[disabled], .disabled"))
								dialog._accelerators[char].trigger("click");
							e.preventDefault();
						}
				}
			}
		})

		// Hide the dialog when the title bar is clicked (so users can peek under the dialog)
		.on("mousedown.cognito.dialog", ".c-modal-title-bar", function (event) {
			if (Dialog.activeDialogs.length > 0 && $(event.srcElement).closest(".c-modal-close").length == 0) {
				var dialog = Dialog.activeDialogs[Dialog.activeDialogs.length - 1];
				$(dialog._dialog).css("opacity", 0.05);
				$(document).on("mousemove.cognito.dialog", function () {
					$(dialog._dialog).css("opacity", 1);
					$(document).off("mousemove.cognito.dialog");
				});
			}
		})

		// Hide the dialog when the title bar is clicked (so users can peek under the dialog)
		.on("click", ".c-modal-overlay", function () {
			if (Dialog.activeDialogs.length > 0) {
				var dialog = Dialog.activeDialogs[Dialog.activeDialogs.length - 1];
				dialog.close(true);
			}
		});

	$.fn.dialog = function (options) {
		try {
			// Determine if the page is hosted in an iframe dialog.
			var frame = window.frameElement;
			if (frame && $(frame.parentElement).is(".c-modal-content-container")) {
				// Determine if the iframe's parent window contains the Cognito jQuery dialog function.
				if (window.parent.$ && window.parent.$.fn && window.parent.$.fn.dialog) {

					// Convert content selectors into text before promoting to parent window
					if (options.contentSelector) {
						options.text = $(options.contentSelector).html();
						options.contentSelector = null;
					}

					// Call the dialog function on the parent window so that all dialogs open in
					// the outermost window, so they don't have to be nested within one another.
					return window.parent.$.fn.dialog(options);
				}
			}
		} catch (e) {
			// Ignore potential cross-domain errors when attempting to access the frame element...
		}

		var dialog = new Dialog(options);

		// Called in the context of a selector
		if (this.length > 0) {
			return this.each(function () {
				var $this = $(this);
				var data = $this.data("cognito.dialog");

				if (!data) $this.data("cognito.dialog", (data = dialog));

				data._bindTo(this);
			});
		}

		// Called in the context of an assignment
		var viewport = $((options.viewport || (options.viewport = document.body)));
		var storage = viewport.data("cognito.dialog");
		if (!storage) viewport.data("cognito.dialog", (storage = []));

		var data = dialog;
		storage.push(data);

		return data;
	};

	$.fn.dialog.constructor = Dialog;
})(jQuery);

/***/ }),

/***/ "../../../Cognito.Services/Scripts/jquery/jquery-1.8.3.min.js":
/*!*****************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Cognito.Services/Scripts/jquery/jquery-1.8.3.min.js ***!
  \*****************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;﻿/*!
 * jQuery JavaScript Library v1.8.3
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: Tue Nov 13 2012 08:20:33 GMT-0500 (Eastern Standard Time)
 */
(function(n,t){function hf(n){var t=yt[n]={};return i.each(n.split(h),function(n,i){t[i]=!0}),t}function li(n,r,u){if(u===t&&n.nodeType===1){var f="data-"+r.replace(ci,"-$1").toLowerCase();if(u=n.getAttribute(f),typeof u=="string"){try{u=u==="true"?!0:u==="false"?!1:u==="null"?null:+u+""===u?+u:hi.test(u)?i.parseJSON(u):u}catch(e){}i.data(n,r,u)}else u=t}return u}function pt(n){for(var t in n)if((t!=="data"||!i.isEmptyObject(n[t]))&&t!=="toJSON")return!1;return!0}function v(){return!1}function it(){return!0}function k(n){return!n||!n.parentNode||n.parentNode.nodeType===11}function nr(n,t){do n=n[t];while(n&&n.nodeType!==1);return n}function tr(n,t,r){if(t=t||0,i.isFunction(t))return i.grep(n,function(n,i){var u=!!t.call(n,i,n);return u===r});if(t.nodeType)return i.grep(n,function(n){return n===t===r});if(typeof t=="string"){var u=i.grep(n,function(n){return n.nodeType===1});if(df.test(t))return i.filter(t,u,!r);t=i.filter(t,u)}return i.grep(n,function(n){return i.inArray(n,t)>=0===r})}function ir(n){var i=rr.split("|"),t=n.createDocumentFragment();if(t.createElement)while(i.length)t.createElement(i.pop());return t}function oe(n,t){return n.getElementsByTagName(t)[0]||n.appendChild(n.ownerDocument.createElement(t))}function hr(n,t){if(t.nodeType===1&&i.hasData(n)){var u,f,o,s=i._data(n),r=i._data(t,s),e=s.events;if(e){delete r.handle;r.events={};for(u in e)for(f=0,o=e[u].length;f<o;f++)i.event.add(t,u,e[u][f])}r.data&&(r.data=i.extend({},r.data))}}function cr(n,t){var r;t.nodeType===1&&(t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(n),r=t.nodeName.toLowerCase(),r==="object"?(t.parentNode&&(t.outerHTML=n.outerHTML),i.support.html5Clone&&n.innerHTML&&!i.trim(t.innerHTML)&&(t.innerHTML=n.innerHTML)):r==="input"&&er.test(n.type)?(t.defaultChecked=t.checked=n.checked,t.value!==n.value&&(t.value=n.value)):r==="option"?t.selected=n.defaultSelected:r==="input"||r==="textarea"?t.defaultValue=n.defaultValue:r==="script"&&t.text!==n.text&&(t.text=n.text),t.removeAttribute(i.expando))}function rt(n){return typeof n.getElementsByTagName!="undefined"?n.getElementsByTagName("*"):typeof n.querySelectorAll!="undefined"?n.querySelectorAll("*"):[]}function lr(n){er.test(n.type)&&(n.defaultChecked=n.checked)}function pr(n,t){if(t in n)return t;for(var r=t.charAt(0).toUpperCase()+t.slice(1),u=t,i=yr.length;i--;)if(t=yr[i]+r,t in n)return t;return u}function ft(n,t){return n=t||n,i.css(n,"display")==="none"||!i.contains(n.ownerDocument,n)}function wr(n,t){for(var r,o,e=[],f=0,s=n.length;f<s;f++)(r=n[f],r.style)&&(e[f]=i._data(r,"olddisplay"),t?(e[f]||r.style.display!=="none"||(r.style.display=""),r.style.display===""&&ft(r)&&(e[f]=i._data(r,"olddisplay",gr(r.nodeName)))):(o=u(r,"display"),e[f]||o==="none"||i._data(r,"olddisplay",o)));for(f=0;f<s;f++)(r=n[f],r.style)&&(t&&r.style.display!=="none"&&r.style.display!==""||(r.style.display=t?e[f]||"":"none"));return n}function br(n,t,i){var r=le.exec(t);return r?Math.max(0,r[1]-(i||0))+(r[2]||"px"):t}function kr(n,t,r,f){for(var e=r===(f?"border":"content")?4:t==="width"?1:0,o=0;e<4;e+=2)r==="margin"&&(o+=i.css(n,r+c[e],!0)),f?(r==="content"&&(o-=parseFloat(u(n,"padding"+c[e]))||0),r!=="margin"&&(o-=parseFloat(u(n,"border"+c[e]+"Width"))||0)):(o+=parseFloat(u(n,"padding"+c[e]))||0,r!=="padding"&&(o+=parseFloat(u(n,"border"+c[e]+"Width"))||0));return o}function dr(n,t,r){var f=t==="width"?n.offsetWidth:n.offsetHeight,e=!0,o=i.support.boxSizing&&i.css(n,"boxSizing")==="border-box";if(f<=0||f==null){if(f=u(n,t),(f<0||f==null)&&(f=n.style[t]),ut.test(f))return f;e=o&&(i.support.boxSizingReliable||f===n.style[t]);f=parseFloat(f)||0}return f+kr(n,t,r||(o?"border":"content"),e)+"px"}function gr(n){if(ni[n])return ni[n];var f=i("<"+n+">").appendTo(r.body),t=f.css("display");return f.remove(),(t==="none"||t==="")&&(y=r.body.appendChild(y||i.extend(r.createElement("iframe"),{frameBorder:0,width:0,height:0})),p&&y.createElement||(p=(y.contentWindow||y.contentDocument).document,p.write("<!doctype html><html><body>"),p.close()),f=p.body.appendChild(p.createElement(n)),t=u(f,"display"),r.body.removeChild(y)),ni[n]=t,t}function ti(n,t,r,u){var f;if(i.isArray(t))i.each(t,function(t,i){r||we.test(n)?u(n,i):ti(n+"["+(typeof i=="object"?t:"")+"]",i,r,u)});else if(r||i.type(t)!=="object")u(n,t);else for(f in t)ti(n+"["+f+"]",t[f],r,u)}function eu(n){return function(t,r){typeof t!="string"&&(r=t,t="*");var u,o,f,s=t.toLowerCase().split(h),e=0,c=s.length;if(i.isFunction(r))for(;e<c;e++)u=s[e],f=/^\+/.test(u),f&&(u=u.substr(1)||"*"),o=n[u]=n[u]||[],o[f?"unshift":"push"](r)}}function et(n,i,r,u,f,e){f=f||i.dataTypes[0];e=e||{};e[f]=!0;for(var o,s=n[f],h=0,l=s?s.length:0,c=n===ii;h<l&&(c||!o);h++)o=s[h](i,r,u),typeof o=="string"&&(!c||e[o]?o=t:(i.dataTypes.unshift(o),o=et(n,i,r,u,o,e)));return!c&&o||e["*"]||(o=et(n,i,r,u,"*",e)),o}function ou(n,r){var u,f,e=i.ajaxSettings.flatOptions||{};for(u in r)r[u]!==t&&((e[u]?n:f||(f={}))[u]=r[u]);f&&i.extend(!0,n,f)}function uo(n,i,r){var o,u,e,s,h=n.contents,f=n.dataTypes,c=n.responseFields;for(u in c)u in r&&(i[c[u]]=r[u]);while(f[0]==="*")f.shift(),o===t&&(o=n.mimeType||i.getResponseHeader("content-type"));if(o)for(u in h)if(h[u]&&h[u].test(o)){f.unshift(u);break}if(f[0]in r)e=f[0];else{for(u in r){if(!f[0]||n.converters[u+" "+f[0]]){e=u;break}s||(s=u)}e=e||s}if(e)return e!==f[0]&&f.unshift(e),r[e]}function fo(n,t){var i,o,r,e,s=n.dataTypes.slice(),f=s[0],u={},h=0;if(n.dataFilter&&(t=n.dataFilter(t,n.dataType)),s[1])for(i in n.converters)u[i.toLowerCase()]=n.converters[i];for(;r=s[++h];)if(r!=="*"){if(f!=="*"&&f!==r){if(i=u[f+" "+r]||u["* "+r],!i)for(o in u)if(e=o.split(" "),e[1]===r&&(i=u[f+" "+e[0]]||u["* "+e[0]],i)){i===!0?i=u[o]:u[o]!==!0&&(r=e[0],s.splice(h--,0,r));break}if(i!==!0)if(i&&n.throws)t=i(t);else try{t=i(t)}catch(c){return{state:"parsererror",error:i?c:"No conversion from "+f+" to "+r}}}f=r}return{state:"success",data:t}}function cu(){try{return new n.XMLHttpRequest}catch(t){}}function so(){try{return new n.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function lu(){return setTimeout(function(){b=t},0),b=i.now()}function ao(n,t){i.each(t,function(t,i){for(var u=(d[t]||[]).concat(d["*"]),r=0,f=u.length;r<f;r++)if(u[r].call(n,t,i))return})}function au(n,t,r){var e,o=0,c=ct.length,f=i.Deferred().always(function(){delete h.elem}),h=function(){for(var o=b||lu(),t=Math.max(0,u.startTime+u.duration-o),s=t/u.duration||0,i=1-s,r=0,e=u.tweens.length;r<e;r++)u.tweens[r].run(i);return f.notifyWith(n,[u,i,t]),i<1&&e?t:(f.resolveWith(n,[u]),!1)},u=f.promise({elem:n,props:i.extend({},t),opts:i.extend(!0,{specialEasing:{}},r),originalProperties:t,originalOptions:r,startTime:b||lu(),duration:r.duration,tweens:[],createTween:function(t,r){var f=i.Tween(n,u.opts,t,r,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(f),f},stop:function(t){for(var i=0,r=t?u.tweens.length:0;i<r;i++)u.tweens[i].run(1);return t?f.resolveWith(n,[u,t]):f.rejectWith(n,[u,t]),this}}),s=u.props;for(vo(s,u.opts.specialEasing);o<c;o++)if(e=ct[o].call(u,n,s,u.opts),e)return e;return ao(u,s),i.isFunction(u.opts.start)&&u.opts.start.call(n,u),i.fx.timer(i.extend(h,{anim:u,queue:u.opts.queue,elem:n})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function vo(n,t){var r,f,e,u,o;for(r in n)if(f=i.camelCase(r),e=t[f],u=n[r],i.isArray(u)&&(e=u[1],u=n[r]=u[0]),r!==f&&(n[f]=u,delete n[r]),o=i.cssHooks[f],o&&"expand"in o){u=o.expand(u);delete n[f];for(r in u)r in n||(n[r]=u[r],t[r]=e)}else t[f]=e}function yo(n,t,r){var o,u,a,v,s,y,l,f,b,h=this,e=n.style,p={},w=[],c=n.nodeType&&ft(n);r.queue||(f=i._queueHooks(n,"fx"),f.unqueued==null&&(f.unqueued=0,b=f.empty.fire,f.empty.fire=function(){f.unqueued||b()}),f.unqueued++,h.always(function(){h.always(function(){f.unqueued--;i.queue(n,"fx").length||f.empty.fire()})}));n.nodeType===1&&("height"in t||"width"in t)&&(r.overflow=[e.overflow,e.overflowX,e.overflowY],i.css(n,"display")==="inline"&&i.css(n,"float")==="none"&&(i.support.inlineBlockNeedsLayout&&gr(n.nodeName)!=="inline"?e.zoom=1:e.display="inline-block"));r.overflow&&(e.overflow="hidden",i.support.shrinkWrapBlocks||h.done(function(){e.overflow=r.overflow[0];e.overflowX=r.overflow[1];e.overflowY=r.overflow[2]}));for(o in t)if(a=t[o],ho.exec(a)){if(delete t[o],y=y||a==="toggle",a===(c?"hide":"show"))continue;w.push(o)}if(v=w.length,v)for(s=i._data(n,"fxshow")||i._data(n,"fxshow",{}),("hidden"in s)&&(c=s.hidden),y&&(s.hidden=!c),c?i(n).show():h.done(function(){i(n).hide()}),h.done(function(){var t;i.removeData(n,"fxshow",!0);for(t in p)i.style(n,t,p[t])}),o=0;o<v;o++)u=w[o],l=h.createTween(u,c?s[u]:0),p[u]=s[u]||i.style(n,u),u in s||(s[u]=l.start,c&&(l.end=l.start,l.start=u==="width"||u==="height"?1:0))}function f(n,t,i,r,u){return new f.prototype.init(n,t,i,r,u)}function lt(n,t){var r,i={height:n},u=0;for(t=t?1:0;u<4;u+=2-t)r=c[u],i["margin"+r]=i["padding"+r]=n;return t&&(i.opacity=i.width=n),i}function vu(n){return i.isWindow(n)?n:n.nodeType===9?n.defaultView||n.parentWindow:!1}var ui,g,r=n.document,yu=n.location,pu=n.navigator,wu=n.jQuery,bu=n.$,fi=Array.prototype.push,o=Array.prototype.slice,ei=Array.prototype.indexOf,ku=Object.prototype.toString,at=Object.prototype.hasOwnProperty,vt=String.prototype.trim,i=function(n,t){return new i.fn.init(n,t,ui)},nt=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,du=/\S/,h=/\s+/,gu=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,nf=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,oi=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,tf=/^[\],:{}\s]*$/,rf=/(?:^|:|,)(?:\s*\[)+/g,uf=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,ff=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,ef=/^-ms-/,of=/-([\da-z])/gi,sf=function(n,t){return(t+"").toUpperCase()},tt=function(){r.addEventListener?(r.removeEventListener("DOMContentLoaded",tt,!1),i.ready()):r.readyState==="complete"&&(r.detachEvent("onreadystatechange",tt),i.ready())},si={},yt,hi,ci,w,st,hu,ri;i.fn=i.prototype={constructor:i,init:function(n,u,f){var e,o,s;if(!n)return this;if(n.nodeType)return this.context=this[0]=n,this.length=1,this;if(typeof n=="string"){if(e=n.charAt(0)==="<"&&n.charAt(n.length-1)===">"&&n.length>=3?[null,n,null]:nf.exec(n),e&&(e[1]||!u)){if(e[1])return u=u instanceof i?u[0]:u,s=u&&u.nodeType?u.ownerDocument||u:r,n=i.parseHTML(e[1],s,!0),oi.test(e[1])&&i.isPlainObject(u)&&this.attr.call(n,u,!0),i.merge(this,n);if(o=r.getElementById(e[2]),o&&o.parentNode){if(o.id!==e[2])return f.find(n);this.length=1;this[0]=o}return this.context=r,this.selector=n,this}return!u||u.jquery?(u||f).find(n):this.constructor(u).find(n)}return i.isFunction(n)?f.ready(n):(n.selector!==t&&(this.selector=n.selector,this.context=n.context),i.makeArray(n,this))},selector:"",jquery:"1.8.3",length:0,size:function(){return this.length},toArray:function(){return o.call(this)},get:function(n){return n==null?this.toArray():n<0?this[this.length+n]:this[n]},pushStack:function(n,t,r){var u=i.merge(this.constructor(),n);return u.prevObject=this,u.context=this.context,t==="find"?u.selector=this.selector+(this.selector?" ":"")+r:t&&(u.selector=this.selector+"."+t+"("+r+")"),u},each:function(n,t){return i.each(this,n,t)},ready:function(n){return i.ready.promise().done(n),this},eq:function(n){return n=+n,n===-1?this.slice(n):this.slice(n,n+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(o.apply(this,arguments),"slice",o.call(arguments).join(","))},map:function(n){return this.pushStack(i.map(this,function(t,i){return n.call(t,i,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:fi,sort:[].sort,splice:[].splice};i.fn.init.prototype=i.fn;i.extend=i.fn.extend=function(){var o,e,u,r,s,h,n=arguments[0]||{},f=1,l=arguments.length,c=!1;for(typeof n=="boolean"&&(c=n,n=arguments[1]||{},f=2),typeof n=="object"||i.isFunction(n)||(n={}),l===f&&(n=this,--f);f<l;f++)if((o=arguments[f])!=null)for(e in o)(u=n[e],r=o[e],n!==r)&&(c&&r&&(i.isPlainObject(r)||(s=i.isArray(r)))?(s?(s=!1,h=u&&i.isArray(u)?u:[]):h=u&&i.isPlainObject(u)?u:{},n[e]=i.extend(c,h,r)):r!==t&&(n[e]=r));return n};i.extend({noConflict:function(t){return n.$===i&&(n.$=bu),t&&n.jQuery===i&&(n.jQuery=wu),i},isReady:!1,readyWait:1,holdReady:function(n){n?i.readyWait++:i.ready(!0)},ready:function(n){if(n===!0?!--i.readyWait:!i.isReady){if(!r.body)return setTimeout(i.ready,1);(i.isReady=!0,n!==!0&&--i.readyWait>0)||(g.resolveWith(r,[i]),i.fn.trigger&&i(r).trigger("ready").off("ready"))}},isFunction:function(n){return i.type(n)==="function"},isArray:Array.isArray||function(n){return i.type(n)==="array"},isWindow:function(n){return n!=null&&n==n.window},isNumeric:function(n){return!isNaN(parseFloat(n))&&isFinite(n)},type:function(n){return n==null?String(n):si[ku.call(n)]||"object"},isPlainObject:function(n){if(!n||i.type(n)!=="object"||n.nodeType||i.isWindow(n))return!1;try{if(n.constructor&&!at.call(n,"constructor")&&!at.call(n.constructor.prototype,"isPrototypeOf"))return!1}catch(u){return!1}for(var r in n);return r===t||at.call(n,r)},isEmptyObject:function(n){for(var t in n)return!1;return!0},error:function(n){throw new Error(n);},parseHTML:function(n,t,u){var f;return!n||typeof n!="string"?null:(typeof t=="boolean"&&(u=t,t=0),t=t||r,f=oi.exec(n))?[t.createElement(f[1])]:(f=i.buildFragment([n],t,u?null:[]),i.merge([],(f.cacheable?i.clone(f.fragment):f.fragment).childNodes))},parseJSON:function(t){if(!t||typeof t!="string")return null;if(t=i.trim(t),n.JSON&&n.JSON.parse)return n.JSON.parse(t);if(tf.test(t.replace(uf,"@").replace(ff,"]").replace(rf,"")))return new Function("return "+t)();i.error("Invalid JSON: "+t)},parseXML:function(r){var u,f;if(!r||typeof r!="string")return null;try{n.DOMParser?(f=new DOMParser,u=f.parseFromString(r,"text/xml")):(u=new ActiveXObject("Microsoft.XMLDOM"),u.async="false",u.loadXML(r))}catch(e){u=t}return u&&u.documentElement&&!u.getElementsByTagName("parsererror").length||i.error("Invalid XML: "+r),u},noop:function(){},globalEval:function(t){t&&du.test(t)&&(n.execScript||function(t){n.eval.call(n,t)})(t)},camelCase:function(n){return n.replace(ef,"ms-").replace(of,sf)},nodeName:function(n,t){return n.nodeName&&n.nodeName.toLowerCase()===t.toLowerCase()},each:function(n,r,u){var f,e=0,o=n.length,s=o===t||i.isFunction(n);if(u){if(s){for(f in n)if(r.apply(n[f],u)===!1)break}else for(;e<o;)if(r.apply(n[e++],u)===!1)break}else if(s){for(f in n)if(r.call(n[f],f,n[f])===!1)break}else for(;e<o;)if(r.call(n[e],e,n[e++])===!1)break;return n},trim:vt&&!vt.call("﻿ ")?function(n){return n==null?"":vt.call(n)}:function(n){return n==null?"":(n+"").replace(gu,"")},makeArray:function(n,t){var r,u=t||[];return n!=null&&(r=i.type(n),n.length==null||r==="string"||r==="function"||r==="regexp"||i.isWindow(n)?fi.call(u,n):i.merge(u,n)),u},inArray:function(n,t,i){var r;if(t){if(ei)return ei.call(t,n,i);for(r=t.length,i=i?i<0?Math.max(0,r+i):i:0;i<r;i++)if(i in t&&t[i]===n)return i}return-1},merge:function(n,i){var f=i.length,u=n.length,r=0;if(typeof f=="number")for(;r<f;r++)n[u++]=i[r];else while(i[r]!==t)n[u++]=i[r++];return n.length=u,n},grep:function(n,t,i){var u,f=[],r=0,e=n.length;for(i=!!i;r<e;r++)u=!!t(n[r],r),i!==u&&f.push(n[r]);return f},map:function(n,r,u){var f,h,e=[],s=0,o=n.length,c=n instanceof i||o!==t&&typeof o=="number"&&(o>0&&n[0]&&n[o-1]||o===0||i.isArray(n));if(c)for(;s<o;s++)f=r(n[s],s,u),f!=null&&(e[e.length]=f);else for(h in n)f=r(n[h],h,u),f!=null&&(e[e.length]=f);return e.concat.apply([],e)},guid:1,proxy:function(n,r){var f,e,u;return(typeof r=="string"&&(f=n[r],r=n,n=f),!i.isFunction(n))?t:(e=o.call(arguments,2),u=function(){return n.apply(r,e.concat(o.call(arguments)))},u.guid=n.guid=n.guid||i.guid++,u)},access:function(n,r,u,f,e,o,s){var c,l=u==null,h=0,a=n.length;if(u&&typeof u=="object"){for(h in u)i.access(n,r,h,u[h],1,o,f);e=1}else if(f!==t){if(c=s===t&&i.isFunction(f),l&&(c?(c=r,r=function(n,t,r){return c.call(i(n),r)}):(r.call(n,f),r=null)),r)for(;h<a;h++)r(n[h],u,c?f.call(n[h],h,r(n[h],u)):f,s);e=1}return e?n:l?r.call(n):a?r(n[0],u):o},now:function(){return(new Date).getTime()}});i.ready.promise=function(t){if(!g)if(g=i.Deferred(),r.readyState==="complete")setTimeout(i.ready,1);else if(r.addEventListener)r.addEventListener("DOMContentLoaded",tt,!1),n.addEventListener("load",i.ready,!1);else{r.attachEvent("onreadystatechange",tt);n.attachEvent("onload",i.ready);var u=!1;try{u=n.frameElement==null&&r.documentElement}catch(e){}u&&u.doScroll&&function f(){if(!i.isReady){try{u.doScroll("left")}catch(n){return setTimeout(f,50)}i.ready()}}()}return g.promise(t)};i.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(n,t){si["[object "+t+"]"]=t.toLowerCase()});ui=i(r);yt={};i.Callbacks=function(n){n=typeof n=="string"?yt[n]||hf(n):i.extend({},n);var f,c,o,l,s,e,r=[],u=!n.once&&[],a=function(t){for(f=n.memory&&t,c=!0,e=l||0,l=0,s=r.length,o=!0;r&&e<s;e++)if(r[e].apply(t[0],t[1])===!1&&n.stopOnFalse){f=!1;break}o=!1;r&&(u?u.length&&a(u.shift()):f?r=[]:h.disable())},h={add:function(){if(r){var t=r.length;(function u(t){i.each(t,function(t,f){var e=i.type(f);e==="function"?n.unique&&h.has(f)||r.push(f):f&&f.length&&e!=="string"&&u(f)})})(arguments);o?s=r.length:f&&(l=t,a(f))}return this},remove:function(){return r&&i.each(arguments,function(n,t){for(var u;(u=i.inArray(t,r,u))>-1;)r.splice(u,1),o&&(u<=s&&s--,u<=e&&e--)}),this},has:function(n){return i.inArray(n,r)>-1},empty:function(){return r=[],this},disable:function(){return r=u=f=t,this},disabled:function(){return!r},lock:function(){return u=t,f||h.disable(),this},locked:function(){return!u},fireWith:function(n,t){return t=t||[],t=[n,t.slice?t.slice():t],r&&(!c||u)&&(o?u.push(t):a(t)),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!c}};return h};i.extend({Deferred:function(n){var u=[["resolve","done",i.Callbacks("once memory"),"resolved"],["reject","fail",i.Callbacks("once memory"),"rejected"],["notify","progress",i.Callbacks("memory")]],f="pending",r={state:function(){return f},always:function(){return t.done(arguments).fail(arguments),this},then:function(){var n=arguments;return i.Deferred(function(r){i.each(u,function(u,f){var e=f[0],o=n[u];t[f[1]](i.isFunction(o)?function(){var n=o.apply(this,arguments);n&&i.isFunction(n.promise)?n.promise().done(r.resolve).fail(r.reject).progress(r.notify):r[e+"With"](this===t?r:this,[n])}:r[e])});n=null}).promise()},promise:function(n){return n!=null?i.extend(n,r):r}},t={};return r.pipe=r.then,i.each(u,function(n,i){var e=i[2],o=i[3];r[i[1]]=e.add;o&&e.add(function(){f=o},u[n^1][2].disable,u[2][2].lock);t[i[0]]=e.fire;t[i[0]+"With"]=e.fireWith}),r.promise(t),n&&n.call(t,t),t},when:function(n){var t=0,u=o.call(arguments),r=u.length,e=r!==1||n&&i.isFunction(n.promise)?r:0,f=e===1?n:i.Deferred(),c=function(n,t,i){return function(r){t[n]=this;i[n]=arguments.length>1?o.call(arguments):r;i===s?f.notifyWith(t,i):--e||f.resolveWith(t,i)}},s,l,h;if(r>1)for(s=new Array(r),l=new Array(r),h=new Array(r);t<r;t++)u[t]&&i.isFunction(u[t].promise)?u[t].promise().done(c(t,h,u)).fail(f.reject).progress(c(t,l,s)):--e;return e||f.resolveWith(h,u),f.promise()}});i.support=function(){var u,h,e,c,l,f,o,a,v,s,y,t=r.createElement("div");if(t.setAttribute("className","t"),t.innerHTML="  <link/><table><\/table><a href='/a'>a<\/a><input type='checkbox'/>",h=t.getElementsByTagName("*"),e=t.getElementsByTagName("a")[0],!h||!e||!h.length)return{};c=r.createElement("select");l=c.appendChild(r.createElement("option"));f=t.getElementsByTagName("input")[0];e.style.cssText="top:1px;float:left;opacity:.5";u={leadingWhitespace:t.firstChild.nodeType===3,tbody:!t.getElementsByTagName("tbody").length,htmlSerialize:!!t.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.5/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:f.value==="on",optSelected:l.selected,getSetAttribute:t.className!=="t",enctype:!!r.createElement("form").enctype,html5Clone:r.createElement("nav").cloneNode(!0).outerHTML!=="<:nav><\/:nav>",boxModel:r.compatMode==="CSS1Compat",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1};f.checked=!0;u.noCloneChecked=f.cloneNode(!0).checked;c.disabled=!0;u.optDisabled=!l.disabled;try{delete t.test}catch(p){u.deleteExpando=!1}if(!t.addEventListener&&t.attachEvent&&t.fireEvent&&(t.attachEvent("onclick",y=function(){u.noCloneEvent=!1}),t.cloneNode(!0).fireEvent("onclick"),t.detachEvent("onclick",y)),f=r.createElement("input"),f.value="t",f.setAttribute("type","radio"),u.radioValue=f.value==="t",f.setAttribute("checked","checked"),f.setAttribute("name","t"),t.appendChild(f),o=r.createDocumentFragment(),o.appendChild(t.lastChild),u.checkClone=o.cloneNode(!0).cloneNode(!0).lastChild.checked,u.appendChecked=f.checked,o.removeChild(f),o.appendChild(t),t.attachEvent)for(v in{submit:!0,change:!0,focusin:!0})a="on"+v,s=a in t,s||(t.setAttribute(a,"return;"),s=typeof t[a]=="function"),u[v+"Bubbles"]=s;return i(function(){var i,t,f,e,h="padding:0;margin:0;border:0;display:block;overflow:hidden;",o=r.getElementsByTagName("body")[0];o&&(i=r.createElement("div"),i.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",o.insertBefore(i,o.firstChild),t=r.createElement("div"),i.appendChild(t),t.innerHTML="<table><tr><td><\/td><td>t<\/td><\/tr><\/table>",f=t.getElementsByTagName("td"),f[0].style.cssText="padding:0;margin:0;border:0;display:none",s=f[0].offsetHeight===0,f[0].style.display="",f[1].style.display="none",u.reliableHiddenOffsets=s&&f[0].offsetHeight===0,t.innerHTML="",t.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",u.boxSizing=t.offsetWidth===4,u.doesNotIncludeMarginInBodyOffset=o.offsetTop!==1,n.getComputedStyle&&(u.pixelPosition=(n.getComputedStyle(t,null)||{}).top!=="1%",u.boxSizingReliable=(n.getComputedStyle(t,null)||{width:"4px"}).width==="4px",e=r.createElement("div"),e.style.cssText=t.style.cssText=h,e.style.marginRight=e.style.width="0",t.style.width="1px",t.appendChild(e),u.reliableMarginRight=!parseFloat((n.getComputedStyle(e,null)||{}).marginRight)),typeof t.style.zoom!="undefined"&&(t.innerHTML="",t.style.cssText=h+"width:1px;padding:1px;display:inline;zoom:1",u.inlineBlockNeedsLayout=t.offsetWidth===3,t.style.display="block",t.style.overflow="visible",t.innerHTML="<div><\/div>",t.firstChild.style.width="5px",u.shrinkWrapBlocks=t.offsetWidth!==3,i.style.zoom=1),o.removeChild(i),i=t=f=e=null)}),o.removeChild(t),h=e=c=l=f=o=t=null,u}();hi=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/;ci=/([A-Z])/g;i.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(i.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(n){return n=n.nodeType?i.cache[n[i.expando]]:n[i.expando],!!n&&!pt(n)},data:function(n,r,u,f){if(i.acceptData(n)){var s,h,c=i.expando,a=typeof r=="string",l=n.nodeType,o=l?i.cache:n,e=l?n[c]:n[c]&&c;if(e&&o[e]&&(f||o[e].data)||!a||u!==t)return e||(l?n[c]=e=i.deletedIds.pop()||i.guid++:e=c),o[e]||(o[e]={},l||(o[e].toJSON=i.noop)),(typeof r=="object"||typeof r=="function")&&(f?o[e]=i.extend(o[e],r):o[e].data=i.extend(o[e].data,r)),s=o[e],f||(s.data||(s.data={}),s=s.data),u!==t&&(s[i.camelCase(r)]=u),a?(h=s[r],h==null&&(h=s[i.camelCase(r)])):h=s,h}},removeData:function(n,t,r){if(i.acceptData(n)){var e,o,h,s=n.nodeType,u=s?i.cache:n,f=s?n[i.expando]:i.expando;if(u[f]){if(t&&(e=r?u[f]:u[f].data,e)){for(i.isArray(t)||(t in e?t=[t]:(t=i.camelCase(t),t=t in e?[t]:t.split(" "))),o=0,h=t.length;o<h;o++)delete e[t[o]];if(!(r?pt:i.isEmptyObject)(e))return}(r||(delete u[f].data,pt(u[f])))&&(s?i.cleanData([n],!0):i.support.deleteExpando||u!=u.window?delete u[f]:u[f]=null)}}},_data:function(n,t,r){return i.data(n,t,r,!0)},acceptData:function(n){var t=n.nodeName&&i.noData[n.nodeName.toLowerCase()];return!t||t!==!0&&n.getAttribute("classid")===t}});i.fn.extend({data:function(n,r){var u,s,h,o,l,e=this[0],c=0,f=null;if(n===t){if(this.length&&(f=i.data(e),e.nodeType===1&&!i._data(e,"parsedAttrs"))){for(h=e.attributes,l=h.length;c<l;c++)o=h[c].name,o.indexOf("data-")||(o=i.camelCase(o.substring(5)),li(e,o,f[o]));i._data(e,"parsedAttrs",!0)}return f}return typeof n=="object"?this.each(function(){i.data(this,n)}):(u=n.split(".",2),u[1]=u[1]?"."+u[1]:"",s=u[1]+"!",i.access(this,function(r){if(r===t)return f=this.triggerHandler("getData"+s,[u[0]]),f===t&&e&&(f=i.data(e,n),f=li(e,n,f)),f===t&&u[1]?this.data(u[0]):f;u[1]=r;this.each(function(){var t=i(this);t.triggerHandler("setData"+s,u);i.data(this,n,r);t.triggerHandler("changeData"+s,u)})},null,r,arguments.length>1,null,!1))},removeData:function(n){return this.each(function(){i.removeData(this,n)})}});i.extend({queue:function(n,t,r){var u;if(n)return t=(t||"fx")+"queue",u=i._data(n,t),r&&(!u||i.isArray(r)?u=i._data(n,t,i.makeArray(r)):u.push(r)),u||[]},dequeue:function(n,t){t=t||"fx";var r=i.queue(n,t),e=r.length,u=r.shift(),f=i._queueHooks(n,t),o=function(){i.dequeue(n,t)};u==="inprogress"&&(u=r.shift(),e--);u&&(t==="fx"&&r.unshift("inprogress"),delete f.stop,u.call(n,o,f));!e&&f&&f.empty.fire()},_queueHooks:function(n,t){var r=t+"queueHooks";return i._data(n,r)||i._data(n,r,{empty:i.Callbacks("once memory").add(function(){i.removeData(n,t+"queue",!0);i.removeData(n,r,!0)})})}});i.fn.extend({queue:function(n,r){var u=2;return(typeof n!="string"&&(r=n,n="fx",u--),arguments.length<u)?i.queue(this[0],n):r===t?this:this.each(function(){var t=i.queue(this,n,r);i._queueHooks(this,n);n==="fx"&&t[0]!=="inprogress"&&i.dequeue(this,n)})},dequeue:function(n){return this.each(function(){i.dequeue(this,n)})},delay:function(n,t){return n=i.fx?i.fx.speeds[n]||n:n,t=t||"fx",this.queue(t,function(t,i){var r=setTimeout(t,n);i.stop=function(){clearTimeout(r)}})},clearQueue:function(n){return this.queue(n||"fx",[])},promise:function(n,r){var u,e=1,o=i.Deferred(),f=this,s=this.length,h=function(){--e||o.resolveWith(f,[f])};for(typeof n!="string"&&(r=n,n=t),n=n||"fx";s--;)u=i._data(f[s],n+"queueHooks"),u&&u.empty&&(e++,u.empty.add(h));return h(),o.promise(r)}});var s,ai,vi,yi=/[\t\r\n]/g,cf=/\r/g,lf=/^(?:button|input)$/i,af=/^(?:button|input|object|select|textarea)$/i,vf=/^a(?:rea|)$/i,pi=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,wi=i.support.getSetAttribute;i.fn.extend({attr:function(n,t){return i.access(this,i.attr,n,t,arguments.length>1)},removeAttr:function(n){return this.each(function(){i.removeAttr(this,n)})},prop:function(n,t){return i.access(this,i.prop,n,t,arguments.length>1)},removeProp:function(n){return n=i.propFix[n]||n,this.each(function(){try{this[n]=t;delete this[n]}catch(i){}})},addClass:function(n){var r,f,o,t,e,u,s;if(i.isFunction(n))return this.each(function(t){i(this).addClass(n.call(this,t,this.className))});if(n&&typeof n=="string")for(r=n.split(h),f=0,o=this.length;f<o;f++)if(t=this[f],t.nodeType===1)if(t.className||r.length!==1){for(e=" "+t.className+" ",u=0,s=r.length;u<s;u++)e.indexOf(" "+r[u]+" ")<0&&(e+=r[u]+" ");t.className=i.trim(e)}else t.className=n;return this},removeClass:function(n){var e,r,u,f,s,o,c;if(i.isFunction(n))return this.each(function(t){i(this).removeClass(n.call(this,t,this.className))});if(n&&typeof n=="string"||n===t)for(e=(n||"").split(h),o=0,c=this.length;o<c;o++)if(u=this[o],u.nodeType===1&&u.className){for(r=(" "+u.className+" ").replace(yi," "),f=0,s=e.length;f<s;f++)while(r.indexOf(" "+e[f]+" ")>=0)r=r.replace(" "+e[f]+" "," ");u.className=n?i.trim(r):""}return this},toggleClass:function(n,t){var r=typeof n,u=typeof t=="boolean";return i.isFunction(n)?this.each(function(r){i(this).toggleClass(n.call(this,r,this.className,t),t)}):this.each(function(){if(r==="string")for(var f,s=0,o=i(this),e=t,c=n.split(h);f=c[s++];)e=u?e:!o.hasClass(f),o[e?"addClass":"removeClass"](f);else(r==="undefined"||r==="boolean")&&(this.className&&i._data(this,"__className__",this.className),this.className=this.className||n===!1?"":i._data(this,"__className__")||"")})},hasClass:function(n){for(var i=" "+n+" ",t=0,r=this.length;t<r;t++)if(this[t].nodeType===1&&(" "+this[t].className+" ").replace(yi," ").indexOf(i)>=0)return!0;return!1},val:function(n){var r,u,e,f=this[0];return arguments.length?(e=i.isFunction(n),this.each(function(u){var f,o=i(this);this.nodeType===1&&(f=e?n.call(this,u,o.val()):n,f==null?f="":typeof f=="number"?f+="":i.isArray(f)&&(f=i.map(f,function(n){return n==null?"":n+""})),r=i.valHooks[this.type]||i.valHooks[this.nodeName.toLowerCase()],r&&"set"in r&&r.set(this,f,"value")!==t||(this.value=f))})):f?(r=i.valHooks[f.type]||i.valHooks[f.nodeName.toLowerCase()],r&&"get"in r&&(u=r.get(f,"value"))!==t)?u:(u=f.value,typeof u=="string"?u.replace(cf,""):u==null?"":u):void 0}});i.extend({valHooks:{option:{get:function(n){var t=n.attributes.value;return!t||t.specified?n.value:n.text}},select:{get:function(n){for(var e,t,o=n.options,r=n.selectedIndex,u=n.type==="select-one"||r<0,s=u?null:[],h=u?r+1:o.length,f=r<0?h:u?r:0;f<h;f++)if(t=o[f],(t.selected||f===r)&&(i.support.optDisabled?!t.disabled:t.getAttribute("disabled")===null)&&(!t.parentNode.disabled||!i.nodeName(t.parentNode,"optgroup"))){if(e=i(t).val(),u)return e;s.push(e)}return s},set:function(n,t){var r=i.makeArray(t);return i(n).find("option").each(function(){this.selected=i.inArray(i(this).val(),r)>=0}),r.length||(n.selectedIndex=-1),r}}},attrFn:{},attr:function(n,r,u,f){var e,o,h,c=n.nodeType;if(n&&c!==3&&c!==8&&c!==2){if(f&&i.isFunction(i.fn[r]))return i(n)[r](u);if(typeof n.getAttribute=="undefined")return i.prop(n,r,u);if(h=c!==1||!i.isXMLDoc(n),h&&(r=r.toLowerCase(),o=i.attrHooks[r]||(pi.test(r)?ai:s)),u!==t){if(u===null){i.removeAttr(n,r);return}return o&&"set"in o&&h&&(e=o.set(n,u,r))!==t?e:(n.setAttribute(r,u+""),u)}return o&&"get"in o&&h&&(e=o.get(n,r))!==null?e:(e=n.getAttribute(r),e===null?t:e)}},removeAttr:function(n,t){var u,f,r,e,o=0;if(t&&n.nodeType===1)for(f=t.split(h);o<f.length;o++)r=f[o],r&&(u=i.propFix[r]||r,e=pi.test(r),e||i.attr(n,r,""),n.removeAttribute(wi?r:u),e&&u in n&&(n[u]=!1))},attrHooks:{type:{set:function(n,t){if(lf.test(n.nodeName)&&n.parentNode)i.error("type property can't be changed");else if(!i.support.radioValue&&t==="radio"&&i.nodeName(n,"input")){var r=n.value;return n.setAttribute("type",t),r&&(n.value=r),t}}},value:{get:function(n,t){return s&&i.nodeName(n,"button")?s.get(n,t):t in n?n.value:null},set:function(n,t,r){if(s&&i.nodeName(n,"button"))return s.set(n,t,r);n.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(n,r,u){var e,f,s,o=n.nodeType;if(n&&o!==3&&o!==8&&o!==2)return s=o!==1||!i.isXMLDoc(n),s&&(r=i.propFix[r]||r,f=i.propHooks[r]),u!==t?f&&"set"in f&&(e=f.set(n,u,r))!==t?e:n[r]=u:f&&"get"in f&&(e=f.get(n,r))!==null?e:n[r]},propHooks:{tabIndex:{get:function(n){var i=n.getAttributeNode("tabindex");return i&&i.specified?parseInt(i.value,10):af.test(n.nodeName)||vf.test(n.nodeName)&&n.href?0:t}}}});ai={get:function(n,r){var u,f=i.prop(n,r);return f===!0||typeof f!="boolean"&&(u=n.getAttributeNode(r))&&u.nodeValue!==!1?r.toLowerCase():t},set:function(n,t,r){var u;return t===!1?i.removeAttr(n,r):(u=i.propFix[r]||r,u in n&&(n[u]=!0),n.setAttribute(r,r.toLowerCase())),r}};wi||(vi={name:!0,id:!0,coords:!0},s=i.valHooks.button={get:function(n,i){var r;return r=n.getAttributeNode(i),r&&(vi[i]?r.value!=="":r.specified)?r.value:t},set:function(n,t,i){var u=n.getAttributeNode(i);return u||(u=r.createAttribute(i),n.setAttributeNode(u)),u.value=t+""}},i.each(["width","height"],function(n,t){i.attrHooks[t]=i.extend(i.attrHooks[t],{set:function(n,i){if(i==="")return n.setAttribute(t,"auto"),i}})}),i.attrHooks.contenteditable={get:s.get,set:function(n,t,i){t===""&&(t="false");s.set(n,t,i)}});i.support.hrefNormalized||i.each(["href","src","width","height"],function(n,r){i.attrHooks[r]=i.extend(i.attrHooks[r],{get:function(n){var i=n.getAttribute(r,2);return i===null?t:i}})});i.support.style||(i.attrHooks.style={get:function(n){return n.style.cssText.toLowerCase()||t},set:function(n,t){return n.style.cssText=t+""}});i.support.optSelected||(i.propHooks.selected=i.extend(i.propHooks.selected,{get:function(n){var t=n.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}));i.support.enctype||(i.propFix.enctype="encoding");i.support.checkOn||i.each(["radio","checkbox"],function(){i.valHooks[this]={get:function(n){return n.getAttribute("value")===null?"on":n.value}}});i.each(["radio","checkbox"],function(){i.valHooks[this]=i.extend(i.valHooks[this],{set:function(n,t){if(i.isArray(t))return n.checked=i.inArray(i(n).val(),t)>=0}})});var wt=/^(?:textarea|input|select)$/i,bi=/^([^\.]*|)(?:\.(.+)|)$/,yf=/(?:^|\s)hover(\.\S+|)\b/,pf=/^key/,wf=/^(?:mouse|contextmenu)|click/,ki=/^(?:focusinfocus|focusoutblur)$/,di=function(n){return i.event.special.hover?n:n.replace(yf,"mouseenter$1 mouseleave$1")};i.event={add:function(n,r,u,f,e){var a,s,v,y,p,o,b,l,w,c,h;if(n.nodeType!==3&&n.nodeType!==8&&r&&u&&(a=i._data(n))){for(u.handler&&(w=u,u=w.handler,e=w.selector),u.guid||(u.guid=i.guid++),v=a.events,v||(a.events=v={}),s=a.handle,s||(a.handle=s=function(n){return typeof i!="undefined"&&(!n||i.event.triggered!==n.type)?i.event.dispatch.apply(s.elem,arguments):t},s.elem=n),r=i.trim(di(r)).split(" "),y=0;y<r.length;y++)p=bi.exec(r[y])||[],o=p[1],b=(p[2]||"").split(".").sort(),h=i.event.special[o]||{},o=(e?h.delegateType:h.bindType)||o,h=i.event.special[o]||{},l=i.extend({type:o,origType:p[1],data:f,handler:u,guid:u.guid,selector:e,needsContext:e&&i.expr.match.needsContext.test(e),namespace:b.join(".")},w),c=v[o],c||(c=v[o]=[],c.delegateCount=0,h.setup&&h.setup.call(n,f,b,s)!==!1||(n.addEventListener?n.addEventListener(o,s,!1):n.attachEvent&&n.attachEvent("on"+o,s))),h.add&&(h.add.call(n,l),l.handler.guid||(l.handler.guid=u.guid)),e?c.splice(c.delegateCount++,0,l):c.push(l),i.event.global[o]=!0;n=null}},global:{},remove:function(n,t,r,u,f){var l,p,e,w,h,b,a,v,c,o,s,y=i.hasData(n)&&i._data(n);if(y&&(v=y.events)){for(t=i.trim(di(t||"")).split(" "),l=0;l<t.length;l++){if(p=bi.exec(t[l])||[],e=w=p[1],h=p[2],!e){for(e in v)i.event.remove(n,e+t[l],r,u,!0);continue}for(c=i.event.special[e]||{},e=(u?c.delegateType:c.bindType)||e,o=v[e]||[],b=o.length,h=h?new RegExp("(^|\\.)"+h.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null,a=0;a<o.length;a++)s=o[a],(f||w===s.origType)&&(!r||r.guid===s.guid)&&(!h||h.test(s.namespace))&&(!u||u===s.selector||u==="**"&&s.selector)&&(o.splice(a--,1),s.selector&&o.delegateCount--,c.remove&&c.remove.call(n,s));o.length===0&&b!==o.length&&(c.teardown&&c.teardown.call(n,h,y.handle)!==!1||i.removeEvent(n,e,y.handle),delete v[e])}i.isEmptyObject(v)&&(delete y.handle,i.removeData(n,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(u,f,e,o){if(!e||e.nodeType!==3&&e.nodeType!==8){var w,d,c,h,l,v,a,y,p,k,s=u.type||u,b=[];if(!ki.test(s+i.event.triggered)&&(s.indexOf("!")>=0&&(s=s.slice(0,-1),d=!0),s.indexOf(".")>=0&&(b=s.split("."),s=b.shift(),b.sort()),e&&!i.event.customEvent[s]||i.event.global[s])){if(u=typeof u=="object"?u[i.expando]?u:new i.Event(s,u):new i.Event(s),u.type=s,u.isTrigger=!0,u.exclusive=d,u.namespace=b.join("."),u.namespace_re=u.namespace?new RegExp("(^|\\.)"+b.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,v=s.indexOf(":")<0?"on"+s:"",!e){w=i.cache;for(c in w)w[c].events&&w[c].events[s]&&i.event.trigger(u,f,w[c].handle.elem,!0);return}if(u.result=t,u.target||(u.target=e),f=f!=null?i.makeArray(f):[],f.unshift(u),a=i.event.special[s]||{},!a.trigger||a.trigger.apply(e,f)!==!1){if(p=[[e,a.bindType||s]],!o&&!a.noBubble&&!i.isWindow(e)){for(k=a.delegateType||s,h=ki.test(k+s)?e:e.parentNode,l=e;h;h=h.parentNode)p.push([h,k]),l=h;l===(e.ownerDocument||r)&&p.push([l.defaultView||l.parentWindow||n,k])}for(c=0;c<p.length&&!u.isPropagationStopped();c++)h=p[c][0],u.type=p[c][1],y=(i._data(h,"events")||{})[u.type]&&i._data(h,"handle"),y&&y.apply(h,f),y=v&&h[v],y&&i.acceptData(h)&&y.apply&&y.apply(h,f)===!1&&u.preventDefault();return u.type=s,o||u.isDefaultPrevented()||a._default&&a._default.apply(e.ownerDocument,f)!==!1||s==="click"&&i.nodeName(e,"a")||!i.acceptData(e)||v&&e[s]&&(s!=="focus"&&s!=="blur"||u.target.offsetWidth!==0)&&!i.isWindow(e)&&(l=e[v],l&&(e[v]=null),i.event.triggered=s,e[s](),i.event.triggered=t,l&&(e[v]=l)),u.result}}}},dispatch:function(r){r=i.event.fix(r||n.event);var f,c,e,l,a,h,v,u,s,y=(i._data(this,"events")||{})[r.type]||[],p=y.delegateCount,k=o.call(arguments),d=!r.exclusive&&!r.namespace,w=i.event.special[r.type]||{},b=[];if(k[0]=r,r.delegateTarget=this,!w.preDispatch||w.preDispatch.call(this,r)!==!1){if(p&&!(r.button&&r.type==="click"))for(e=r.target;e!=this;e=e.parentNode||this)if(e.disabled!==!0||r.type!=="click"){for(a={},v=[],f=0;f<p;f++)u=y[f],s=u.selector,a[s]===t&&(a[s]=u.needsContext?i(s,this).index(e)>=0:i.find(s,this,null,[e]).length),a[s]&&v.push(u);v.length&&b.push({elem:e,matches:v})}for(y.length>p&&b.push({elem:this,matches:y.slice(p)}),f=0;f<b.length&&!r.isPropagationStopped();f++)for(h=b[f],r.currentTarget=h.elem,c=0;c<h.matches.length&&!r.isImmediatePropagationStopped();c++)u=h.matches[c],(d||!r.namespace&&!u.namespace||r.namespace_re&&r.namespace_re.test(u.namespace))&&(r.data=u.data,r.handleObj=u,l=((i.event.special[u.origType]||{}).handle||u.handler).apply(h.elem,k),l!==t&&(r.result=l,l===!1&&(r.preventDefault(),r.stopPropagation())));return w.postDispatch&&w.postDispatch.call(this,r),r.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(n,t){return n.which==null&&(n.which=t.charCode!=null?t.charCode:t.keyCode),n}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(n,i){var o,u,f,e=i.button,s=i.fromElement;return n.pageX==null&&i.clientX!=null&&(o=n.target.ownerDocument||r,u=o.documentElement,f=o.body,n.pageX=i.clientX+(u&&u.scrollLeft||f&&f.scrollLeft||0)-(u&&u.clientLeft||f&&f.clientLeft||0),n.pageY=i.clientY+(u&&u.scrollTop||f&&f.scrollTop||0)-(u&&u.clientTop||f&&f.clientTop||0)),!n.relatedTarget&&s&&(n.relatedTarget=s===n.target?i.toElement:s),n.which||e===t||(n.which=e&1?1:e&2?3:e&4?2:0),n}},fix:function(n){if(n[i.expando])return n;var f,e,t=n,u=i.event.fixHooks[n.type]||{},o=u.props?this.props.concat(u.props):this.props;for(n=i.Event(t),f=o.length;f;)e=o[--f],n[e]=t[e];return n.target||(n.target=t.srcElement||r),n.target.nodeType===3&&(n.target=n.target.parentNode),n.metaKey=!!n.metaKey,u.filter?u.filter(n,t):n},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(n,t,r){i.isWindow(this)&&(this.onbeforeunload=r)},teardown:function(n,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(n,t,r,u){var f=i.extend(new i.Event,r,{type:n,isSimulated:!0,originalEvent:{}});u?i.event.trigger(f,null,t):i.event.dispatch.call(t,f);f.isDefaultPrevented()&&r.preventDefault()}};i.event.handle=i.event.dispatch;i.removeEvent=r.removeEventListener?function(n,t,i){n.removeEventListener&&n.removeEventListener(t,i,!1)}:function(n,t,i){var r="on"+t;n.detachEvent&&(typeof n[r]=="undefined"&&(n[r]=null),n.detachEvent(r,i))};i.Event=function(n,t){if(!(this instanceof i.Event))return new i.Event(n,t);n&&n.type?(this.originalEvent=n,this.type=n.type,this.isDefaultPrevented=n.defaultPrevented||n.returnValue===!1||n.getPreventDefault&&n.getPreventDefault()?it:v):this.type=n;t&&i.extend(this,t);this.timeStamp=n&&n.timeStamp||i.now();this[i.expando]=!0};i.Event.prototype={preventDefault:function(){this.isDefaultPrevented=it;var n=this.originalEvent;n&&(n.preventDefault?n.preventDefault():n.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=it;var n=this.originalEvent;n&&(n.stopPropagation&&n.stopPropagation(),n.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it;this.stopPropagation()},isDefaultPrevented:v,isPropagationStopped:v,isImmediatePropagationStopped:v};i.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(n,t){i.event.special[n]={delegateType:t,bindType:t,handle:function(n){var f,e=this,r=n.relatedTarget,u=n.handleObj,o=u.selector;return r&&(r===e||i.contains(e,r))||(n.type=u.origType,f=u.handler.apply(this,arguments),n.type=t),f}}});i.support.submitBubbles||(i.event.special.submit={setup:function(){if(i.nodeName(this,"form"))return!1;i.event.add(this,"click._submit keypress._submit",function(n){var u=n.target,r=i.nodeName(u,"input")||i.nodeName(u,"button")?u.form:t;r&&!i._data(r,"_submit_attached")&&(i.event.add(r,"submit._submit",function(n){n._submit_bubble=!0}),i._data(r,"_submit_attached",!0))})},postDispatch:function(n){n._submit_bubble&&(delete n._submit_bubble,this.parentNode&&!n.isTrigger&&i.event.simulate("submit",this.parentNode,n,!0))},teardown:function(){if(i.nodeName(this,"form"))return!1;i.event.remove(this,"._submit")}});i.support.changeBubbles||(i.event.special.change={setup:function(){if(wt.test(this.nodeName))return(this.type==="checkbox"||this.type==="radio")&&(i.event.add(this,"propertychange._change",function(n){n.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),i.event.add(this,"click._change",function(n){this._just_changed&&!n.isTrigger&&(this._just_changed=!1);i.event.simulate("change",this,n,!0)})),!1;i.event.add(this,"beforeactivate._change",function(n){var t=n.target;wt.test(t.nodeName)&&!i._data(t,"_change_attached")&&(i.event.add(t,"change._change",function(n){!this.parentNode||n.isSimulated||n.isTrigger||i.event.simulate("change",this.parentNode,n,!0)}),i._data(t,"_change_attached",!0))})},handle:function(n){var t=n.target;if(this!==t||n.isSimulated||n.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return n.handleObj.handler.apply(this,arguments)},teardown:function(){return i.event.remove(this,"._change"),!wt.test(this.nodeName)}});i.support.focusinBubbles||i.each({focus:"focusin",blur:"focusout"},function(n,t){var u=0,f=function(n){i.event.simulate(t,n.target,i.event.fix(n),!0)};i.event.special[t]={setup:function(){u++==0&&r.addEventListener(n,f,!0)},teardown:function(){--u==0&&r.removeEventListener(n,f,!0)}}});i.fn.extend({on:function(n,r,u,f,e){var o,s;if(typeof n=="object"){typeof r!="string"&&(u=u||r,r=t);for(s in n)this.on(s,r,u,n[s],e);return this}if(u==null&&f==null?(f=r,u=r=t):f==null&&(typeof r=="string"?(f=u,u=t):(f=u,u=r,r=t)),f===!1)f=v;else if(!f)return this;return e===1&&(o=f,f=function(n){return i().off(n),o.apply(this,arguments)},f.guid=o.guid||(o.guid=i.guid++)),this.each(function(){i.event.add(this,n,f,u,r)})},one:function(n,t,i,r){return this.on(n,t,i,r,1)},off:function(n,r,u){var f,e;if(n&&n.preventDefault&&n.handleObj)return f=n.handleObj,i(n.delegateTarget).off(f.namespace?f.origType+"."+f.namespace:f.origType,f.selector,f.handler),this;if(typeof n=="object"){for(e in n)this.off(e,r,n[e]);return this}return(r===!1||typeof r=="function")&&(u=r,r=t),u===!1&&(u=v),this.each(function(){i.event.remove(this,n,u,r)})},bind:function(n,t,i){return this.on(n,null,t,i)},unbind:function(n,t){return this.off(n,null,t)},live:function(n,t,r){i(this.context).on(n,this.selector,t,r);return this},die:function(n,t){return i(this.context).off(n,this.selector||"**",t),this},delegate:function(n,t,i,r){return this.on(t,n,i,r)},undelegate:function(n,t,i){return arguments.length===1?this.off(n,"**"):this.off(t,n||"**",i)},trigger:function(n,t){return this.each(function(){i.event.trigger(n,t,this)})},triggerHandler:function(n,t){if(this[0])return i.event.trigger(n,t,this[0],!0)},toggle:function(n){var t=arguments,u=n.guid||i.guid++,r=0,f=function(u){var f=(i._data(this,"lastToggle"+n.guid)||0)%r;return i._data(this,"lastToggle"+n.guid,f+1),u.preventDefault(),t[f].apply(this,arguments)||!1};for(f.guid=u;r<t.length;)t[r++].guid=u;return this.click(f)},hover:function(n,t){return this.mouseenter(n).mouseleave(t||n)}});i.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(n,t){i.fn[t]=function(n,i){return i==null&&(i=n,n=null),arguments.length>0?this.on(t,null,n,i):this.trigger(t)};pf.test(t)&&(i.event.fixHooks[t]=i.event.keyHooks);wf.test(t)&&(i.event.fixHooks[t]=i.event.mouseHooks)});
/*!
	 * Sizzle CSS Selector Engine
	 * Copyright 2012 jQuery Foundation and other contributors
	 * Released under the MIT license
	 * http://sizzlejs.com/
	 */
(function(n,t){function r(n,t,i,r){i=i||[];t=t||h;var e,u,o,f,s=t.nodeType;if(!n||typeof n!="string")return i;if(s!==1&&s!==9)return[];if(o=g(t),!o&&!r&&(e=wi.exec(n)))if(f=e[1]){if(s===9)if(u=t.getElementById(f),u&&u.parentNode){if(u.id===f)return i.push(u),i}else return i;else if(t.ownerDocument&&(u=t.ownerDocument.getElementById(f))&&gt(t,u)&&u.id===f)return i.push(u),i}else{if(e[2])return p.apply(i,w.call(t.getElementsByTagName(n),0)),i;if((f=e[3])&&oi&&t.getElementsByClassName)return p.apply(i,w.call(t.getElementsByClassName(f),0)),i}return dt(n.replace(it,"$1"),t,i,r,o)}function k(n){return function(t){var i=t.nodeName.toLowerCase();return i==="input"&&t.type===n}}function si(n){return function(t){var i=t.nodeName.toLowerCase();return(i==="input"||i==="button")&&t.type===n}}function y(n){return s(function(t){return t=+t,s(function(i,r){for(var u,f=n([],i.length,t),e=f.length;e--;)i[u=f[e]]&&(i[u]=!(r[u]=i[u]))})})}function ut(n,t,i){if(n===t)return i;for(var r=n.nextSibling;r;){if(r===t)return-1;r=r.nextSibling}return 1}function ft(n,t){var o,f,h,s,i,c,l,a=ri[e][n+" "];if(a)return t?0:a.slice(0);for(i=n,c=[],l=u.preFilter;i;){(!o||(f=vi.exec(i)))&&(f&&(i=i.slice(f[0].length)||i),c.push(h=[]));o=!1;(f=yi.exec(i))&&(h.push(o=new ti(f.shift())),i=i.slice(o.length),o.type=f[0].replace(it," "));for(s in u.filter)(f=rt[s].exec(i))&&(!l[s]||(f=l[s](f)))&&(h.push(o=new ti(f.shift())),i=i.slice(o.length),o.type=s,o.matches=f);if(!o)break}return t?i.length:i?r.error(n):ri(n,c).slice(0)}function pt(n,t,i){var r=t.dir,u=i&&t.dir==="parentNode",f=ci++;return t.first?function(t,i,f){while(t=t[r])if(u||t.nodeType===1)return n(t,i,f)}:function(t,i,o){if(o){while(t=t[r])if((u||t.nodeType===1)&&n(t,i,o))return t}else for(var s,h=tt+" "+f+" ",c=h+ot;t=t[r];)if(u||t.nodeType===1){if((s=t[e])===c)return t.sizset;if(typeof s=="string"&&s.indexOf(h)===0){if(t.sizset)return t}else{if(t[e]=c,n(t,i,o))return t.sizset=!0,t;t.sizset=!1}}}}function wt(n){return n.length>1?function(t,i,r){for(var u=n.length;u--;)if(!n[u](t,i,r))return!1;return!0}:n[0]}function et(n,t,i,r,u){for(var e,o=[],f=0,s=n.length,h=t!=null;f<s;f++)(e=n[f])&&(!i||i(e,r,u))&&(o.push(e),h&&t.push(f));return o}function bt(n,t,i,r,u,f){return r&&!r[e]&&(r=bt(r)),u&&!u[e]&&(u=bt(u,f)),s(function(f,e,o,s){var l,c,a,w=[],y=[],b=e.length,k=f||rr(t||"*",o.nodeType?[o]:o,[]),v=n&&(f||!t)?et(k,w,n,o,s):k,h=i?u||(f?n:b||r)?[]:e:v;if(i&&i(v,h,o,s),r)for(l=et(h,y),r(l,[],o,s),c=l.length;c--;)(a=l[c])&&(h[y[c]]=!(v[y[c]]=a));if(f){if(u||n){if(u){for(l=[],c=h.length;c--;)(a=h[c])&&l.push(v[c]=a);u(null,h=[],l,s)}for(c=h.length;c--;)(a=h[c])&&(l=u?lt.call(f,a):w[c])>-1&&(f[l]=!(e[l]=a))}}else h=et(h===e?h.splice(b,h.length):h),u?u(null,e,h,s):p.apply(e,h)})}function kt(n){for(var s,r,i,o=n.length,h=u.relative[n[0].type],c=h||u.relative[" "],t=h?1:0,l=pt(function(n){return n===s},c,!0),a=pt(function(n){return lt.call(s,n)>-1},c,!0),f=[function(n,t,i){return!h&&(i||t!==nt)||((s=t).nodeType?l(n,t,i):a(n,t,i))}];t<o;t++)if(r=u.relative[n[t].type])f=[pt(wt(f),r)];else{if(r=u.filter[n[t].type].apply(null,n[t].matches),r[e]){for(i=++t;i<o;i++)if(u.relative[n[i].type])break;return bt(t>1&&wt(f),t>1&&n.slice(0,t-1).join("").replace(it,"$1"),r,t<i&&kt(n.slice(t,i)),i<o&&kt(n=n.slice(i)),i<o&&n.join(""))}f.push(r)}return wt(f)}function ir(n,t){var f=t.length>0,e=n.length>0,i=function(o,s,c,l,a){var y,b,k,w=[],d=0,v="0",g=o&&[],it=a!=null,rt=nt,ft=o||e&&u.find.TAG("*",a&&s.parentNode||s),ut=tt+=rt==null?1:Math.E;for(it&&(nt=s!==h&&s,ot=i.el);(y=ft[v])!=null;v++){if(e&&y){for(b=0;k=n[b];b++)if(k(y,s,c)){l.push(y);break}it&&(tt=ut,ot=++i.el)}f&&((y=!k&&y)&&d--,o&&g.push(y))}if(d+=v,f&&v!==d){for(b=0;k=t[b];b++)k(g,w,s,c);if(o){if(d>0)while(v--)g[v]||w[v]||(w[v]=li.call(l));w=et(w)}p.apply(l,w);it&&!o&&w.length>0&&d+t.length>1&&r.uniqueSort(l)}return it&&(tt=ut,nt=rt),g};return i.el=0,f?s(i):i}function rr(n,t,i){for(var u=0,f=t.length;u<f;u++)r(n,t[u],i);return i}function dt(n,t,i,r,f){var o,e,s,c,l,h=ft(n),a=h.length;if(!r&&h.length===1){if(e=h[0]=h[0].slice(0),e.length>2&&(s=e[0]).type==="ID"&&t.nodeType===9&&!f&&u.relative[e[1].type]){if(t=u.find.ID(s.matches[0].replace(v,""),t,f)[0],!t)return i;n=n.slice(e.shift().length)}for(o=rt.POS.test(n)?-1:e.length-1;o>=0;o--){if(s=e[o],u.relative[c=s.type])break;if((l=u.find[c])&&(r=l(s.matches[0].replace(v,""),yt.test(e[0].type)&&t.parentNode||t,f))){if(e.splice(o,1),n=r.length&&e.join(""),!n)return p.apply(i,w.call(r,0)),i;break}}}return ht(n,h)(r,t,f,i,yt.test(n)),i}function hi(){}var ot,st,u,d,g,gt,ht,ct,b,nt,ni=!0,c="undefined",e=("sizcache"+Math.random()).replace(".",""),ti=String,h=n.document,o=h.documentElement,tt=0,ci=0,li=[].pop,p=[].push,w=[].slice,lt=[].indexOf||function(n){for(var t=0,i=this.length;t<i;t++)if(this[t]===n)return t;return-1},s=function(n,t){return n[e]=t==null||t,n},at=function(){var n={},t=[];return s(function(i,r){return t.push(i)>u.cacheLength&&delete n[t.shift()],n[i+" "]=r},n)},ii=at(),ri=at(),ui=at(),f="[\\x20\\t\\r\\n\\f]",a="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",ai=a.replace("w","w#"),fi="\\["+f+"*("+a+")"+f+"*(?:([*^$|!~]?=)"+f+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+ai+")|)|)"+f+"*\\]",vt=":("+a+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+fi+")|[^:]|\\\\.)*|.*))\\)|)",ei=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+f+"*((?:-\\d)?\\d*)"+f+"*\\)|)(?=[^-]|$)",it=new RegExp("^"+f+"+|((?:^|[^\\\\])(?:\\\\.)*)"+f+"+$","g"),vi=new RegExp("^"+f+"*,"+f+"*"),yi=new RegExp("^"+f+"*([\\x20\\t\\r\\n\\f>+~])"+f+"*"),pi=new RegExp(vt),wi=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,yt=/[\x20\t\r\n\f]*[+~]/,bi=/h\d/i,ki=/input|select|textarea|button/i,v=/\\(?!\\)/g,rt={ID:new RegExp("^#("+a+")"),CLASS:new RegExp("^\\.("+a+")"),NAME:new RegExp("^\\[name=['\"]?("+a+")['\"]?\\]"),TAG:new RegExp("^("+a.replace("w","w*")+")"),ATTR:new RegExp("^"+fi),PSEUDO:new RegExp("^"+vt),POS:new RegExp(ei,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+f+"*(even|odd|(([+-]|)(\\d*)n|)"+f+"*(?:([+-]|)"+f+"*(\\d+)|))"+f+"*\\)|)","i"),needsContext:new RegExp("^"+f+"*[>+~]|"+ei,"i")},l=function(n){var t=h.createElement("div");try{return n(t)}catch(i){return!1}finally{t=null}},di=l(function(n){return n.appendChild(h.createComment("")),!n.getElementsByTagName("*").length}),gi=l(function(n){return n.innerHTML="<a href='#'><\/a>",n.firstChild&&typeof n.firstChild.getAttribute!==c&&n.firstChild.getAttribute("href")==="#"}),nr=l(function(n){n.innerHTML="<select><\/select>";var t=typeof n.lastChild.getAttribute("multiple");return t!=="boolean"&&t!=="string"}),oi=l(function(n){return(n.innerHTML="<div class='hidden e'><\/div><div class='hidden'><\/div>",!n.getElementsByClassName||!n.getElementsByClassName("e").length)?!1:(n.lastChild.className="e",n.getElementsByClassName("e").length===2)}),tr=l(function(n){n.id=e+0;n.innerHTML="<a name='"+e+"'><\/a><div name='"+e+"'><\/div>";o.insertBefore(n,o.firstChild);var t=h.getElementsByName&&h.getElementsByName(e).length===2+h.getElementsByName(e+0).length;return st=!h.getElementById(e),o.removeChild(n),t});try{w.call(o.childNodes,0)[0].nodeType}catch(ur){w=function(n){for(var t,i=[];t=this[n];n++)i.push(t);return i}}r.matches=function(n,t){return r(n,null,null,t)};r.matchesSelector=function(n,t){return r(t,null,null,[n]).length>0};d=r.getText=function(n){var r,i="",u=0,t=n.nodeType;if(t){if(t===1||t===9||t===11){if(typeof n.textContent=="string")return n.textContent;for(n=n.firstChild;n;n=n.nextSibling)i+=d(n)}else if(t===3||t===4)return n.nodeValue}else for(;r=n[u];u++)i+=d(r);return i};g=r.isXML=function(n){var t=n&&(n.ownerDocument||n).documentElement;return t?t.nodeName!=="HTML":!1};gt=r.contains=o.contains?function(n,t){var r=n.nodeType===9?n.documentElement:n,i=t&&t.parentNode;return n===i||!!(i&&i.nodeType===1&&r.contains&&r.contains(i))}:o.compareDocumentPosition?function(n,t){return t&&!!(n.compareDocumentPosition(t)&16)}:function(n,t){while(t=t.parentNode)if(t===n)return!0;return!1};r.attr=function(n,t){var i,r=g(n);return(r||(t=t.toLowerCase()),i=u.attrHandle[t])?i(n):r||nr?n.getAttribute(t):(i=n.getAttributeNode(t),i?typeof n[t]=="boolean"?n[t]?t:null:i.specified?i.value:null:null)};u=r.selectors={cacheLength:50,createPseudo:s,match:rt,attrHandle:gi?{}:{href:function(n){return n.getAttribute("href",2)},type:function(n){return n.getAttribute("type")}},find:{ID:st?function(n,t,i){if(typeof t.getElementById!==c&&!i){var r=t.getElementById(n);return r&&r.parentNode?[r]:[]}}:function(n,i,r){if(typeof i.getElementById!==c&&!r){var u=i.getElementById(n);return u?u.id===n||typeof u.getAttributeNode!==c&&u.getAttributeNode("id").value===n?[u]:t:[]}},TAG:di?function(n,t){if(typeof t.getElementsByTagName!==c)return t.getElementsByTagName(n)}:function(n,t){var f=t.getElementsByTagName(n),i,r,u;if(n==="*"){for(r=[],u=0;i=f[u];u++)i.nodeType===1&&r.push(i);return r}return f},NAME:tr&&function(n,t){if(typeof t.getElementsByName!==c)return t.getElementsByName(name)},CLASS:oi&&function(n,t,i){if(typeof t.getElementsByClassName!==c&&!i)return t.getElementsByClassName(n)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(n){return n[1]=n[1].replace(v,""),n[3]=(n[4]||n[5]||"").replace(v,""),n[2]==="~="&&(n[3]=" "+n[3]+" "),n.slice(0,4)},CHILD:function(n){return n[1]=n[1].toLowerCase(),n[1]==="nth"?(n[2]||r.error(n[0]),n[3]=+(n[3]?n[4]+(n[5]||1):2*(n[2]==="even"||n[2]==="odd")),n[4]=+(n[6]+n[7]||n[2]==="odd")):n[2]&&r.error(n[0]),n},PSEUDO:function(n){var t,i;return rt.CHILD.test(n[0])?null:(n[3]?n[2]=n[3]:(t=n[4])&&(pi.test(t)&&(i=ft(t,!0))&&(i=t.indexOf(")",t.length-i)-t.length)&&(t=t.slice(0,i),n[0]=n[0].slice(0,i)),n[2]=t),n.slice(0,3))}},filter:{ID:st?function(n){return n=n.replace(v,""),function(t){return t.getAttribute("id")===n}}:function(n){return n=n.replace(v,""),function(t){var i=typeof t.getAttributeNode!==c&&t.getAttributeNode("id");return i&&i.value===n}},TAG:function(n){return n==="*"?function(){return!0}:(n=n.replace(v,"").toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===n})},CLASS:function(n){var t=ii[e][n+" "];return t||(t=new RegExp("(^|"+f+")"+n+"("+f+"|$)"))&&ii(n,function(n){return t.test(n.className||typeof n.getAttribute!==c&&n.getAttribute("class")||"")})},ATTR:function(n,t,i){return function(u){var f=r.attr(u,n);return f==null?t==="!=":t?(f+="",t==="="?f===i:t==="!="?f!==i:t==="^="?i&&f.indexOf(i)===0:t==="*="?i&&f.indexOf(i)>-1:t==="$="?i&&f.substr(f.length-i.length)===i:t==="~="?(" "+f+" ").indexOf(i)>-1:t==="|="?f===i||f.substr(0,i.length+1)===i+"-":!1):!0}},CHILD:function(n,t,i,r){return n==="nth"?function(n){var t,u,f=n.parentNode;if(i===1&&r===0)return!0;if(f)for(u=0,t=f.firstChild;t;t=t.nextSibling)if(t.nodeType===1&&(u++,n===t))break;return u-=r,u===i||u%i==0&&u/i>=0}:function(t){var i=t;switch(n){case"only":case"first":while(i=i.previousSibling)if(i.nodeType===1)return!1;if(n==="first")return!0;i=t;case"last":while(i=i.nextSibling)if(i.nodeType===1)return!1;return!0}}},PSEUDO:function(n,t){var f,i=u.pseudos[n]||u.setFilters[n.toLowerCase()]||r.error("unsupported pseudo: "+n);return i[e]?i(t):i.length>1?(f=[n,n,"",t],u.setFilters.hasOwnProperty(n.toLowerCase())?s(function(n,r){for(var u,f=i(n,t),e=f.length;e--;)u=lt.call(n,f[e]),n[u]=!(r[u]=f[e])}):function(n){return i(n,0,f)}):i}},pseudos:{not:s(function(n){var i=[],r=[],t=ht(n.replace(it,"$1"));return t[e]?s(function(n,i,r,u){for(var e,o=t(n,null,u,[]),f=n.length;f--;)(e=o[f])&&(n[f]=!(i[f]=e))}):function(n,u,f){return i[0]=n,t(i,null,f,r),!r.pop()}}),has:s(function(n){return function(t){return r(n,t).length>0}}),contains:s(function(n){return function(t){return(t.textContent||t.innerText||d(t)).indexOf(n)>-1}}),enabled:function(n){return n.disabled===!1},disabled:function(n){return n.disabled===!0},checked:function(n){var t=n.nodeName.toLowerCase();return t==="input"&&!!n.checked||t==="option"&&!!n.selected},selected:function(n){return n.parentNode&&n.parentNode.selectedIndex,n.selected===!0},parent:function(n){return!u.pseudos.empty(n)},empty:function(n){var t;for(n=n.firstChild;n;){if(n.nodeName>"@"||(t=n.nodeType)===3||t===4)return!1;n=n.nextSibling}return!0},header:function(n){return bi.test(n.nodeName)},text:function(n){var t,i;return n.nodeName.toLowerCase()==="input"&&(t=n.type)==="text"&&((i=n.getAttribute("type"))==null||i.toLowerCase()===t)},radio:k("radio"),checkbox:k("checkbox"),file:k("file"),password:k("password"),image:k("image"),submit:si("submit"),reset:si("reset"),button:function(n){var t=n.nodeName.toLowerCase();return t==="input"&&n.type==="button"||t==="button"},input:function(n){return ki.test(n.nodeName)},focus:function(n){var t=n.ownerDocument;return n===t.activeElement&&(!t.hasFocus||t.hasFocus())&&!!(n.type||n.href||~n.tabIndex)},active:function(n){return n===n.ownerDocument.activeElement},first:y(function(){return[0]}),last:y(function(n,t){return[t-1]}),eq:y(function(n,t,i){return[i<0?i+t:i]}),even:y(function(n,t){for(var i=0;i<t;i+=2)n.push(i);return n}),odd:y(function(n,t){for(var i=1;i<t;i+=2)n.push(i);return n}),lt:y(function(n,t,i){for(var r=i<0?i+t:i;--r>=0;)n.push(r);return n}),gt:y(function(n,t,i){for(var r=i<0?i+t:i;++r<t;)n.push(r);return n})}};ct=o.compareDocumentPosition?function(n,t){return n===t?(b=!0,0):(!n.compareDocumentPosition||!t.compareDocumentPosition?n.compareDocumentPosition:n.compareDocumentPosition(t)&4)?-1:1}:function(n,t){var i;if(n===t)return b=!0,0;if(n.sourceIndex&&t.sourceIndex)return n.sourceIndex-t.sourceIndex;var e,h,u=[],f=[],o=n.parentNode,s=t.parentNode,r=o;if(o===s)return ut(n,t);if(o){if(!s)return 1}else return-1;while(r)u.unshift(r),r=r.parentNode;for(r=s;r;)f.unshift(r),r=r.parentNode;for(e=u.length,h=f.length,i=0;i<e&&i<h;i++)if(u[i]!==f[i])return ut(u[i],f[i]);return i===e?ut(n,f[i],-1):ut(u[i],t,1)};[0,0].sort(ct);ni=!b;r.uniqueSort=function(n){var r,u=[],t=1,i=0;if(b=ni,n.sort(ct),b){for(;r=n[t];t++)r===n[t-1]&&(i=u.push(t));while(i--)n.splice(u[i],1)}return n};r.error=function(n){throw new Error("Syntax error, unrecognized expression: "+n);};ht=r.compile=function(n,t){var r,u=[],f=[],i=ui[e][n+" "];if(!i){for(t||(t=ft(n)),r=t.length;r--;)i=kt(t[r]),i[e]?u.push(i):f.push(i);i=ui(n,ir(f,u))}return i};h.querySelectorAll&&function(){var u,s=dt,h=/'|\\/g,c=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,n=[":focus"],t=[":active"],i=o.matchesSelector||o.mozMatchesSelector||o.webkitMatchesSelector||o.oMatchesSelector||o.msMatchesSelector;l(function(t){t.innerHTML="<select><option selected=''><\/option><\/select>";t.querySelectorAll("[selected]").length||n.push("\\["+f+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)");t.querySelectorAll(":checked").length||n.push(":checked")});l(function(t){t.innerHTML="<p test=''><\/p>";t.querySelectorAll("[test^='']").length&&n.push("[*^$]="+f+"*(?:\"\"|'')");t.innerHTML="<input type='hidden'/>";t.querySelectorAll(":enabled").length||n.push(":enabled",":disabled")});n=new RegExp(n.join("|"));dt=function(t,i,r,u,f){if(!u&&!f&&!n.test(t)){var o,l,a=!0,c=e,y=i,v=i.nodeType===9&&t;if(i.nodeType===1&&i.nodeName.toLowerCase()!=="object"){for(o=ft(t),(a=i.getAttribute("id"))?c=a.replace(h,"\\$&"):i.setAttribute("id",c),c="[id='"+c+"'] ",l=o.length;l--;)o[l]=c+o[l].join("");y=yt.test(t)&&i.parentNode||i;v=o.join(",")}if(v)try{return p.apply(r,w.call(y.querySelectorAll(v),0)),r}catch(b){}finally{a||i.removeAttribute("id")}}return s(t,i,r,u,f)};i&&(l(function(n){u=i.call(n,"div");try{i.call(n,"[test!='']:sizzle");t.push("!=",vt)}catch(r){}}),t=new RegExp(t.join("|")),r.matchesSelector=function(f,e){if(e=e.replace(c,"='$1']"),!g(f)&&!t.test(e)&&!n.test(e))try{var o=i.call(f,e);if(o||u||f.document&&f.document.nodeType!==11)return o}catch(s){}return r(e,null,null,[f]).length>0})}();u.pseudos.nth=u.pseudos.eq;u.filters=hi.prototype=u.pseudos;u.setFilters=new hi;r.attr=i.attr;i.find=r;i.expr=r.selectors;i.expr[":"]=i.expr.pseudos;i.unique=r.uniqueSort;i.text=r.getText;i.isXMLDoc=r.isXML;i.contains=r.contains})(n);var bf=/Until$/,kf=/^(?:parents|prev(?:Until|All))/,df=/^.[^:#\[\.,]*$/,gi=i.expr.match.needsContext,gf={children:!0,contents:!0,next:!0,prev:!0};i.fn.extend({find:function(n){var t,f,o,u,e,r,s=this;if(typeof n!="string")return i(n).filter(function(){for(t=0,f=s.length;t<f;t++)if(i.contains(s[t],this))return!0});for(r=this.pushStack("","find",n),t=0,f=this.length;t<f;t++)if(o=r.length,i.find(n,this[t],r),t>0)for(u=o;u<r.length;u++)for(e=0;e<o;e++)if(r[e]===r[u]){r.splice(u--,1);break}return r},has:function(n){var t,r=i(n,this),u=r.length;return this.filter(function(){for(t=0;t<u;t++)if(i.contains(this,r[t]))return!0})},not:function(n){return this.pushStack(tr(this,n,!1),"not",n)},filter:function(n){return this.pushStack(tr(this,n,!0),"filter",n)},is:function(n){return!!n&&(typeof n=="string"?gi.test(n)?i(n,this.context).index(this[0])>=0:i.filter(n,this).length>0:this.filter(n).length>0)},closest:function(n,t){for(var r,f=0,o=this.length,u=[],e=gi.test(n)||typeof n!="string"?i(n,t||this.context):0;f<o;f++)for(r=this[f];r&&r.ownerDocument&&r!==t&&r.nodeType!==11;){if(e?e.index(r)>-1:i.find.matchesSelector(r,n)){u.push(r);break}r=r.parentNode}return u=u.length>1?i.unique(u):u,this.pushStack(u,"closest",n)},index:function(n){return n?typeof n=="string"?i.inArray(this[0],i(n)):i.inArray(n.jquery?n[0]:n,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(n,t){var u=typeof n=="string"?i(n,t):i.makeArray(n&&n.nodeType?[n]:n),r=i.merge(this.get(),u);return this.pushStack(k(u[0])||k(r[0])?r:i.unique(r))},addBack:function(n){return this.add(n==null?this.prevObject:this.prevObject.filter(n))}});i.fn.andSelf=i.fn.addBack;i.each({parent:function(n){var t=n.parentNode;return t&&t.nodeType!==11?t:null},parents:function(n){return i.dir(n,"parentNode")},parentsUntil:function(n,t,r){return i.dir(n,"parentNode",r)},next:function(n){return nr(n,"nextSibling")},prev:function(n){return nr(n,"previousSibling")},nextAll:function(n){return i.dir(n,"nextSibling")},prevAll:function(n){return i.dir(n,"previousSibling")},nextUntil:function(n,t,r){return i.dir(n,"nextSibling",r)},prevUntil:function(n,t,r){return i.dir(n,"previousSibling",r)},siblings:function(n){return i.sibling((n.parentNode||{}).firstChild,n)},children:function(n){return i.sibling(n.firstChild)},contents:function(n){return i.nodeName(n,"iframe")?n.contentDocument||n.contentWindow.document:i.merge([],n.childNodes)}},function(n,t){i.fn[n]=function(r,u){var f=i.map(this,t,r);return bf.test(n)||(u=r),u&&typeof u=="string"&&(f=i.filter(u,f)),f=this.length>1&&!gf[n]?i.unique(f):f,this.length>1&&kf.test(n)&&(f=f.reverse()),this.pushStack(f,n,o.call(arguments).join(","))}});i.extend({filter:function(n,t,r){return r&&(n=":not("+n+")"),t.length===1?i.find.matchesSelector(t[0],n)?[t[0]]:[]:i.find.matches(n,t)},dir:function(n,r,u){for(var e=[],f=n[r];f&&f.nodeType!==9&&(u===t||f.nodeType!==1||!i(f).is(u));)f.nodeType===1&&e.push(f),f=f[r];return e},sibling:function(n,t){for(var i=[];n;n=n.nextSibling)n.nodeType===1&&n!==t&&i.push(n);return i}});var rr="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ne=/ jQuery\d+="(?:null|\d+)"/g,bt=/^\s+/,ur=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,fr=/<([\w:]+)/,te=/<tbody/i,ie=/<|&#?\w+;/,re=/<(?:script|style|link)/i,ue=/<(?:script|object|embed|option|style)/i,kt=new RegExp("<(?:"+rr+")[\\s/>]","i"),er=/^(?:checkbox|radio)$/,or=/checked\s*(?:[^=]|=\s*.checked.)/i,fe=/\/(java|ecma)script/i,ee=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,e={option:[1,"<select multiple='multiple'>","<\/select>"],legend:[1,"<fieldset>","<\/fieldset>"],thead:[1,"<table>","<\/table>"],tr:[2,"<table><tbody>","<\/tbody><\/table>"],td:[3,"<table><tbody><tr>","<\/tr><\/tbody><\/table>"],col:[2,"<table><tbody><\/tbody><colgroup>","<\/colgroup><\/table>"],area:[1,"<map>","<\/map>"],_default:[0,"",""]},sr=ir(r),dt=sr.appendChild(r.createElement("div"));e.optgroup=e.option;e.tbody=e.tfoot=e.colgroup=e.caption=e.thead;e.th=e.td;i.support.htmlSerialize||(e._default=[1,"X<div>","<\/div>"]);i.fn.extend({text:function(n){return i.access(this,function(n){return n===t?i.text(this):this.empty().append((this[0]&&this[0].ownerDocument||r).createTextNode(n))},null,n,arguments.length)},wrapAll:function(n){if(i.isFunction(n))return this.each(function(t){i(this).wrapAll(n.call(this,t))});if(this[0]){var t=i(n,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]);t.map(function(){for(var n=this;n.firstChild&&n.firstChild.nodeType===1;)n=n.firstChild;return n}).append(this)}return this},wrapInner:function(n){return i.isFunction(n)?this.each(function(t){i(this).wrapInner(n.call(this,t))}):this.each(function(){var t=i(this),r=t.contents();r.length?r.wrapAll(n):t.append(n)})},wrap:function(n){var t=i.isFunction(n);return this.each(function(r){i(this).wrapAll(t?n.call(this,r):n)})},unwrap:function(){return this.parent().each(function(){i.nodeName(this,"body")||i(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(n){(this.nodeType===1||this.nodeType===11)&&this.appendChild(n)})},prepend:function(){return this.domManip(arguments,!0,function(n){(this.nodeType===1||this.nodeType===11)&&this.insertBefore(n,this.firstChild)})},before:function(){if(!k(this[0]))return this.domManip(arguments,!1,function(n){this.parentNode.insertBefore(n,this)});if(arguments.length){var n=i.clean(arguments);return this.pushStack(i.merge(n,this),"before",this.selector)}},after:function(){if(!k(this[0]))return this.domManip(arguments,!1,function(n){this.parentNode.insertBefore(n,this.nextSibling)});if(arguments.length){var n=i.clean(arguments);return this.pushStack(i.merge(this,n),"after",this.selector)}},remove:function(n,t){for(var r,u=0;(r=this[u])!=null;u++)(!n||i.filter(n,[r]).length)&&(t||r.nodeType!==1||(i.cleanData(r.getElementsByTagName("*")),i.cleanData([r])),r.parentNode&&r.parentNode.removeChild(r));return this},empty:function(){for(var n,t=0;(n=this[t])!=null;t++)for(n.nodeType===1&&i.cleanData(n.getElementsByTagName("*"));n.firstChild;)n.removeChild(n.firstChild);return this},clone:function(n,t){return n=n==null?!1:n,t=t==null?n:t,this.map(function(){return i.clone(this,n,t)})},html:function(n){return i.access(this,function(n){var r=this[0]||{},u=0,f=this.length;if(n===t)return r.nodeType===1?r.innerHTML.replace(ne,""):t;if(typeof n=="string"&&!re.test(n)&&(i.support.htmlSerialize||!kt.test(n))&&(i.support.leadingWhitespace||!bt.test(n))&&!e[(fr.exec(n)||["",""])[1].toLowerCase()]){n=n.replace(ur,"<$1><\/$2>");try{for(;u<f;u++)r=this[u]||{},r.nodeType===1&&(i.cleanData(r.getElementsByTagName("*")),r.innerHTML=n);r=0}catch(o){}}r&&this.empty().append(n)},null,n,arguments.length)},replaceWith:function(n){return k(this[0])?this.length?this.pushStack(i(i.isFunction(n)?n():n),"replaceWith",n):this:i.isFunction(n)?this.each(function(t){var r=i(this),u=r.html();r.replaceWith(n.call(this,t,u))}):(typeof n!="string"&&(n=i(n).detach()),this.each(function(){var t=this.nextSibling,r=this.parentNode;i(this).remove();t?i(t).before(n):i(r).append(n)}))},detach:function(n){return this.remove(n,!0)},domManip:function(n,r,u){n=[].concat.apply([],n);var h,o,f,a,e=0,s=n[0],c=[],l=this.length;if(!i.support.checkClone&&l>1&&typeof s=="string"&&or.test(s))return this.each(function(){i(this).domManip(n,r,u)});if(i.isFunction(s))return this.each(function(f){var e=i(this);n[0]=s.call(this,f,r?e.html():t);e.domManip(n,r,u)});if(this[0]){if(h=i.buildFragment(n,this,c),f=h.fragment,o=f.firstChild,f.childNodes.length===1&&(f=o),o)for(r=r&&i.nodeName(o,"tr"),a=h.cacheable||l-1;e<l;e++)u.call(r&&i.nodeName(this[e],"table")?oe(this[e],"tbody"):this[e],e===a?f:i.clone(f,!0,!0));f=o=null;c.length&&i.each(c,function(n,t){t.src?i.ajax?i.ajax({url:t.src,type:"GET",dataType:"script",async:!1,global:!1,throws:!0}):i.error("no ajax"):i.globalEval((t.text||t.textContent||t.innerHTML||"").replace(ee,""));t.parentNode&&t.parentNode.removeChild(t)})}return this}});i.buildFragment=function(n,u,f){var o,s,h,e=n[0];return u=u||r,u=!u.nodeType&&u[0]||u,u=u.ownerDocument||u,n.length===1&&typeof e=="string"&&e.length<512&&u===r&&e.charAt(0)==="<"&&!ue.test(e)&&(i.support.checkClone||!or.test(e))&&(i.support.html5Clone||!kt.test(e))&&(s=!0,o=i.fragments[e],h=o!==t),o||(o=u.createDocumentFragment(),i.clean(n,u,o,f),s&&(i.fragments[e]=h&&o)),{fragment:o,cacheable:s}};i.fragments={};i.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(n,t){i.fn[n]=function(r){var o,u=0,s=[],f=i(r),h=f.length,e=this.length===1&&this[0].parentNode;if((e==null||e&&e.nodeType===11&&e.childNodes.length===1)&&h===1)return f[t](this[0]),this;for(;u<h;u++)o=(u>0?this.clone(!0):this).get(),i(f[u])[t](o),s=s.concat(o);return this.pushStack(s,n,f.selector)}});i.extend({clone:function(n,t,r){var f,o,u,e;if(i.support.html5Clone||i.isXMLDoc(n)||!kt.test("<"+n.nodeName+">")?e=n.cloneNode(!0):(dt.innerHTML=n.outerHTML,dt.removeChild(e=dt.firstChild)),(!i.support.noCloneEvent||!i.support.noCloneChecked)&&(n.nodeType===1||n.nodeType===11)&&!i.isXMLDoc(n))for(cr(n,e),f=rt(n),o=rt(e),u=0;f[u];++u)o[u]&&cr(f[u],o[u]);if(t&&(hr(n,e),r))for(f=rt(n),o=rt(e),u=0;f[u];++u)hr(f[u],o[u]);return f=o=null,e},clean:function(n,t,u,f){var h,c,o,p,v,d,s,w,a,b,k,y=t===r&&sr,l=[];for(t&&typeof t.createDocumentFragment!="undefined"||(t=r),h=0;(o=n[h])!=null;h++)if(typeof o=="number"&&(o+=""),o){if(typeof o=="string")if(ie.test(o)){for(y=y||ir(t),s=t.createElement("div"),y.appendChild(s),o=o.replace(ur,"<$1><\/$2>"),p=(fr.exec(o)||["",""])[1].toLowerCase(),v=e[p]||e._default,d=v[0],s.innerHTML=v[1]+o+v[2];d--;)s=s.lastChild;if(!i.support.tbody)for(w=te.test(o),a=p==="table"&&!w?s.firstChild&&s.firstChild.childNodes:v[1]==="<table>"&&!w?s.childNodes:[],c=a.length-1;c>=0;--c)i.nodeName(a[c],"tbody")&&!a[c].childNodes.length&&a[c].parentNode.removeChild(a[c]);!i.support.leadingWhitespace&&bt.test(o)&&s.insertBefore(t.createTextNode(bt.exec(o)[0]),s.firstChild);o=s.childNodes;s.parentNode.removeChild(s)}else o=t.createTextNode(o);o.nodeType?l.push(o):i.merge(l,o)}if(s&&(o=s=y=null),!i.support.appendChecked)for(h=0;(o=l[h])!=null;h++)i.nodeName(o,"input")?lr(o):typeof o.getElementsByTagName!="undefined"&&i.grep(o.getElementsByTagName("input"),lr);if(u)for(b=function(n){if(!n.type||fe.test(n.type))return f?f.push(n.parentNode?n.parentNode.removeChild(n):n):u.appendChild(n)},h=0;(o=l[h])!=null;h++)i.nodeName(o,"script")&&b(o)||(u.appendChild(o),typeof o.getElementsByTagName!="undefined"&&(k=i.grep(i.merge([],o.getElementsByTagName("script")),b),l.splice.apply(l,[h+1,0].concat(k)),h+=k.length));return l},cleanData:function(n,t){for(var f,u,r,e,h=0,o=i.expando,s=i.cache,c=i.support.deleteExpando,l=i.event.special;(r=n[h])!=null;h++)if((t||i.acceptData(r))&&(u=r[o],f=u&&s[u],f)){if(f.events)for(e in f.events)l[e]?i.event.remove(r,e):i.removeEvent(r,e,f.handle);s[u]&&(delete s[u],c?delete r[o]:r.removeAttribute?r.removeAttribute(o):r[o]=null,i.deletedIds.push(u))}}}),function(){var t,n;i.uaMatch=function(n){n=n.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+)/.exec(n)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(n)||/(msie) ([\w.]+)/.exec(n)||n.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(n)||[];return{browser:t[1]||"",version:t[2]||"0"}};t=i.uaMatch(pu.userAgent);n={};t.browser&&(n[t.browser]=!0,n.version=t.version);n.chrome?n.webkit=!0:n.webkit&&(n.safari=!0);i.browser=n;i.sub=function(){function n(t,i){return new n.fn.init(t,i)}i.extend(!0,n,this);n.superclass=this;n.fn=n.prototype=this();n.fn.constructor=n;n.sub=this.sub;n.fn.init=function(r,u){return u&&u instanceof i&&!(u instanceof n)&&(u=n(u)),i.fn.init.call(this,r,u,t)};n.fn.init.prototype=n.fn;var t=n(r);return n}}();var u,y,p,gt=/alpha\([^)]*\)/i,se=/opacity=([^)]*)/,he=/^(top|right|bottom|left)$/,ce=/^(none|table(?!-c[ea]).+)/,ar=/^margin/,le=new RegExp("^("+nt+")(.*)$","i"),ut=new RegExp("^("+nt+")(?!px)[a-z%]+$","i"),ae=new RegExp("^([-+])=("+nt+")","i"),ni={BODY:"block"},ve={position:"absolute",visibility:"hidden",display:"block"},vr={letterSpacing:0,fontWeight:400},c=["Top","Right","Bottom","Left"],yr=["Webkit","O","Moz","ms"],ye=i.fn.toggle;i.fn.extend({css:function(n,r){return i.access(this,function(n,r,u){return u!==t?i.style(n,r,u):i.css(n,r)},n,r,arguments.length>1)},show:function(){return wr(this,!0)},hide:function(){return wr(this)},toggle:function(n,t){var r=typeof n=="boolean";return i.isFunction(n)&&i.isFunction(t)?ye.apply(this,arguments):this.each(function(){(r?n:ft(this))?i(this).show():i(this).hide()})}});i.extend({cssHooks:{opacity:{get:function(n,t){if(t){var i=u(n,"opacity");return i===""?"1":i}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:i.support.cssFloat?"cssFloat":"styleFloat"},style:function(n,r,u,f){if(n&&n.nodeType!==3&&n.nodeType!==8&&n.style){var o,s,e,h=i.camelCase(r),c=n.style;if(r=i.cssProps[h]||(i.cssProps[h]=pr(c,h)),e=i.cssHooks[r]||i.cssHooks[h],u!==t){if(s=typeof u,s==="string"&&(o=ae.exec(u))&&(u=(o[1]+1)*o[2]+parseFloat(i.css(n,r)),s="number"),u==null||s==="number"&&isNaN(u))return;if(s!=="number"||i.cssNumber[h]||(u+="px"),!e||!("set"in e)||(u=e.set(n,u,f))!==t)try{c[r]=u}catch(l){}}else return e&&"get"in e&&(o=e.get(n,!1,f))!==t?o:c[r]}},css:function(n,r,f,e){var o,c,s,h=i.camelCase(r);return(r=i.cssProps[h]||(i.cssProps[h]=pr(n.style,h)),s=i.cssHooks[r]||i.cssHooks[h],s&&"get"in s&&(o=s.get(n,!0,e)),o===t&&(o=u(n,r)),o==="normal"&&r in vr&&(o=vr[r]),f||e!==t)?(c=parseFloat(o),f||i.isNumeric(c)?c||0:o):o},swap:function(n,t,i){var u,r,f={};for(r in t)f[r]=n.style[r],n.style[r]=t[r];u=i.call(n);for(r in t)n.style[r]=f[r];return u}});n.getComputedStyle?u=function(t,r){var f,o,s,h,e=n.getComputedStyle(t,null),u=t.style;return e&&(f=e.getPropertyValue(r)||e[r],f!==""||i.contains(t.ownerDocument,t)||(f=i.style(t,r)),ut.test(f)&&ar.test(r)&&(o=u.width,s=u.minWidth,h=u.maxWidth,u.minWidth=u.maxWidth=u.width=f,f=e.width,u.width=o,u.minWidth=s,u.maxWidth=h)),f}:r.documentElement.currentStyle&&(u=function(n,t){var f,u,i=n.currentStyle&&n.currentStyle[t],r=n.style;return i==null&&r&&r[t]&&(i=r[t]),ut.test(i)&&!he.test(t)&&(f=r.left,u=n.runtimeStyle&&n.runtimeStyle.left,u&&(n.runtimeStyle.left=n.currentStyle.left),r.left=t==="fontSize"?"1em":i,i=r.pixelLeft+"px",r.left=f,u&&(n.runtimeStyle.left=u)),i===""?"auto":i});i.each(["height","width"],function(n,t){i.cssHooks[t]={get:function(n,r,f){if(r)return n.offsetWidth===0&&ce.test(u(n,"display"))?i.swap(n,ve,function(){return dr(n,t,f)}):dr(n,t,f)},set:function(n,r,u){return br(n,r,u?kr(n,t,u,i.support.boxSizing&&i.css(n,"boxSizing")==="border-box"):0)}}});i.support.opacity||(i.cssHooks.opacity={get:function(n,t){return se.test((t&&n.currentStyle?n.currentStyle.filter:n.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(n,t){var r=n.style,u=n.currentStyle,e=i.isNumeric(t)?"alpha(opacity="+t*100+")":"",f=u&&u.filter||r.filter||"";(r.zoom=1,t>=1&&i.trim(f.replace(gt,""))===""&&r.removeAttribute&&(r.removeAttribute("filter"),u&&!u.filter))||(r.filter=gt.test(f)?f.replace(gt,e):f+" "+e)}});i(function(){i.support.reliableMarginRight||(i.cssHooks.marginRight={get:function(n,t){return i.swap(n,{display:"inline-block"},function(){if(t)return u(n,"marginRight")})}});!i.support.pixelPosition&&i.fn.position&&i.each(["top","left"],function(n,t){i.cssHooks[t]={get:function(n,r){if(r){var f=u(n,t);return ut.test(f)?i(n).position()[t]+"px":f}}}})});i.expr&&i.expr.filters&&(i.expr.filters.hidden=function(n){return n.offsetWidth===0&&n.offsetHeight===0||!i.support.reliableHiddenOffsets&&(n.style&&n.style.display||u(n,"display"))==="none"},i.expr.filters.visible=function(n){return!i.expr.filters.hidden(n)});i.each({margin:"",padding:"",border:"Width"},function(n,t){i.cssHooks[n+t]={expand:function(i){for(var u=typeof i=="string"?i.split(" "):[i],f={},r=0;r<4;r++)f[n+c[r]+t]=u[r]||u[r-2]||u[0];return f}};ar.test(n)||(i.cssHooks[n+t].set=br)});var pe=/%20/g,we=/\[\]$/,nu=/\r?\n/g,be=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,ke=/^(?:select|textarea)/i;i.fn.extend({serialize:function(){return i.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?i.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||ke.test(this.nodeName)||be.test(this.type))}).map(function(n,t){var r=i(this).val();return r==null?null:i.isArray(r)?i.map(r,function(n){return{name:t.name,value:n.replace(nu,"\r\n")}}):{name:t.name,value:r.replace(nu,"\r\n")}}).get()}});i.param=function(n,r){var u,f=[],e=function(n,t){t=i.isFunction(t)?t():t==null?"":t;f[f.length]=encodeURIComponent(n)+"="+encodeURIComponent(t)};if(r===t&&(r=i.ajaxSettings&&i.ajaxSettings.traditional),i.isArray(n)||n.jquery&&!i.isPlainObject(n))i.each(n,function(){e(this.name,this.value)});else for(u in n)ti(u,n[u],r,e);return f.join("&").replace(pe,"+")};var l,a,de=/#.*$/,ge=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,no=/^(?:GET|HEAD)$/,to=/^\/\//,tu=/\?/,io=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,ro=/([?&])_=[^&]*/,iu=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,ru=i.fn.load,ii={},uu={},fu=["*/"]+["*"];try{a=yu.href}catch(po){a=r.createElement("a");a.href="";a=a.href}l=iu.exec(a.toLowerCase())||[];i.fn.load=function(n,r,u){if(typeof n!="string"&&ru)return ru.apply(this,arguments);if(!this.length)return this;var f,o,s,h=this,e=n.indexOf(" ");return e>=0&&(f=n.slice(e,n.length),n=n.slice(0,e)),i.isFunction(r)?(u=r,r=t):r&&typeof r=="object"&&(o="POST"),i.ajax({url:n,type:o,dataType:"html",data:r,complete:function(n,t){u&&h.each(u,s||[n.responseText,t,n])}}).done(function(n){s=arguments;h.html(f?i("<div>").append(n.replace(io,"")).find(f):n)}),this};i.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(n,t){i.fn[t]=function(n){return this.on(t,n)}});i.each(["get","post"],function(n,r){i[r]=function(n,u,f,e){return i.isFunction(u)&&(e=e||f,f=u,u=t),i.ajax({type:r,url:n,data:u,success:f,dataType:e})}});i.extend({getScript:function(n,r){return i.get(n,t,r,"script")},getJSON:function(n,t,r){return i.get(n,t,r,"json")},ajaxSetup:function(n,t){return t?ou(n,i.ajaxSettings):(t=n,n=i.ajaxSettings),ou(n,t),n},ajaxSettings:{url:a,isLocal:/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(l[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":fu},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":n.String,"text html":!0,"text json":i.parseJSON,"text xml":i.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:eu(ii),ajaxTransport:eu(uu),ajax:function(n,r){function b(n,r,h,l){var a,tt,b,it,p,v=r;e!==2&&(e=2,d&&clearTimeout(d),c=t,k=l||"",f.readyState=n>0?4:0,h&&(it=uo(u,f,h)),n>=200&&n<300||n===304?(u.ifModified&&(p=f.getResponseHeader("Last-Modified"),p&&(i.lastModified[o]=p),p=f.getResponseHeader("Etag"),p&&(i.etag[o]=p)),n===304?(v="notmodified",a=!0):(a=fo(u,it),v=a.state,tt=a.data,b=a.error,a=!b)):(b=v,(!v||n)&&(v="error",n<0&&(n=0))),f.status=n,f.statusText=(r||v)+"",a?nt.resolveWith(s,[tt,v,f]):nt.rejectWith(s,[f,v,b]),f.statusCode(w),w=t,y&&g.trigger("ajax"+(a?"Success":"Error"),[f,u,a?tt:b]),rt.fireWith(s,[f,v]),y&&(g.trigger("ajaxComplete",[f,u]),--i.active||i.event.trigger("ajaxStop")))}var tt,it;typeof n=="object"&&(r=n,n=t);r=r||{};var o,k,p,c,d,a,y,v,u=i.ajaxSetup({},r),s=u.context||u,g=s!==u&&(s.nodeType||s instanceof i)?i(s):i.event,nt=i.Deferred(),rt=i.Callbacks("once memory"),w=u.statusCode||{},ut={},ft={},e=0,ot="canceled",f={readyState:0,setRequestHeader:function(n,t){if(!e){var i=n.toLowerCase();n=ft[i]=ft[i]||n;ut[n]=t}return this},getAllResponseHeaders:function(){return e===2?k:null},getResponseHeader:function(n){var i;if(e===2){if(!p)for(p={};i=ge.exec(k);)p[i[1].toLowerCase()]=i[2];i=p[n.toLowerCase()]}return i===t?null:i},overrideMimeType:function(n){return e||(u.mimeType=n),this},abort:function(n){return n=n||ot,c&&c.abort(n),b(0,n),this}};if(nt.promise(f),f.success=f.done,f.error=f.fail,f.complete=rt.add,f.statusCode=function(n){if(n){var t;if(e<2)for(t in n)w[t]=[w[t],n[t]];else t=n[f.status],f.always(t)}return this},u.url=((n||u.url)+"").replace(de,"").replace(to,l[1]+"//"),u.dataTypes=i.trim(u.dataType||"*").toLowerCase().split(h),u.crossDomain==null&&(a=iu.exec(u.url.toLowerCase()),u.crossDomain=!!(a&&(a[1]!==l[1]||a[2]!==l[2]||(a[3]||(a[1]==="http:"?80:443))!=(l[3]||(l[1]==="http:"?80:443))))),u.data&&u.processData&&typeof u.data!="string"&&(u.data=i.param(u.data,u.traditional)),et(ii,u,r,f),e===2)return f;y=u.global;u.type=u.type.toUpperCase();u.hasContent=!no.test(u.type);y&&i.active++==0&&i.event.trigger("ajaxStart");u.hasContent||(u.data&&(u.url+=(tu.test(u.url)?"&":"?")+u.data,delete u.data),o=u.url,u.cache===!1&&(tt=i.now(),it=u.url.replace(ro,"$1_="+tt),u.url=it+(it===u.url?(tu.test(u.url)?"&":"?")+"_="+tt:"")));(u.data&&u.hasContent&&u.contentType!==!1||r.contentType)&&f.setRequestHeader("Content-Type",u.contentType);u.ifModified&&(o=o||u.url,i.lastModified[o]&&f.setRequestHeader("If-Modified-Since",i.lastModified[o]),i.etag[o]&&f.setRequestHeader("If-None-Match",i.etag[o]));f.setRequestHeader("Accept",u.dataTypes[0]&&u.accepts[u.dataTypes[0]]?u.accepts[u.dataTypes[0]]+(u.dataTypes[0]!=="*"?", "+fu+"; q=0.01":""):u.accepts["*"]);for(v in u.headers)f.setRequestHeader(v,u.headers[v]);if(u.beforeSend&&(u.beforeSend.call(s,f,u)===!1||e===2))return f.abort();ot="abort";for(v in{success:1,error:1,complete:1})f[v](u[v]);if(c=et(uu,u,r,f),c){f.readyState=1;y&&g.trigger("ajaxSend",[f,u]);u.async&&u.timeout>0&&(d=setTimeout(function(){f.abort("timeout")},u.timeout));try{e=1;c.send(ut,b)}catch(st){if(e<2)b(-1,st);else throw st;}}else b(-1,"No Transport");return f},active:0,lastModified:{},etag:{}});var su=[],eo=/\?/,ot=/(=)\?(?=&|$)|\?\?/,oo=i.now();i.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var n=su.pop()||i.expando+"_"+oo++;return this[n]=!0,n}});i.ajaxPrefilter("json jsonp",function(r,u,f){var e,s,o,h=r.data,c=r.url,l=r.jsonp!==!1,a=l&&ot.test(c),v=l&&!a&&typeof h=="string"&&!(r.contentType||"").indexOf("application/x-www-form-urlencoded")&&ot.test(h);if(r.dataTypes[0]==="jsonp"||a||v)return e=r.jsonpCallback=i.isFunction(r.jsonpCallback)?r.jsonpCallback():r.jsonpCallback,s=n[e],a?r.url=c.replace(ot,"$1"+e):v?r.data=h.replace(ot,"$1"+e):l&&(r.url+=(eo.test(c)?"&":"?")+r.jsonp+"="+e),r.converters["script json"]=function(){return o||i.error(e+" was not called"),o[0]},r.dataTypes[0]="json",n[e]=function(){o=arguments},f.always(function(){n[e]=s;r[e]&&(r.jsonpCallback=u.jsonpCallback,su.push(e));o&&i.isFunction(s)&&s(o[0]);o=s=t}),"script"});i.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(n){return i.globalEval(n),n}}});i.ajaxPrefilter("script",function(n){n.cache===t&&(n.cache=!1);n.crossDomain&&(n.type="GET",n.global=!1)});i.ajaxTransport("script",function(n){if(n.crossDomain){var i,u=r.head||r.getElementsByTagName("head")[0]||r.documentElement;return{send:function(f,e){i=r.createElement("script");i.async="async";n.scriptCharset&&(i.charset=n.scriptCharset);i.src=n.url;i.onload=i.onreadystatechange=function(n,r){(r||!i.readyState||/loaded|complete/.test(i.readyState))&&(i.onload=i.onreadystatechange=null,u&&i.parentNode&&u.removeChild(i),i=t,r||e(200,"success"))};u.insertBefore(i,u.firstChild)},abort:function(){if(i)i.onload(0,1)}}}});st=n.ActiveXObject?function(){for(var n in w)w[n](0,1)}:!1;hu=0;i.ajaxSettings.xhr=n.ActiveXObject?function(){return!this.isLocal&&cu()||so()}:cu,function(n){i.extend(i.support,{ajax:!!n,cors:!!n&&"withCredentials"in n})}(i.ajaxSettings.xhr());i.support.ajax&&i.ajaxTransport(function(r){if(!r.crossDomain||i.support.cors){var u;return{send:function(f,e){var h,s,o=r.xhr();if(r.username?o.open(r.type,r.url,r.async,r.username,r.password):o.open(r.type,r.url,r.async),r.xhrFields)for(s in r.xhrFields)o[s]=r.xhrFields[s];r.mimeType&&o.overrideMimeType&&o.overrideMimeType(r.mimeType);r.crossDomain||f["X-Requested-With"]||(f["X-Requested-With"]="XMLHttpRequest");try{for(s in f)o.setRequestHeader(s,f[s])}catch(c){}o.send(r.hasContent&&r.data||null);u=function(n,f){var s,a,v,c,l;try{if(u&&(f||o.readyState===4))if(u=t,h&&(o.onreadystatechange=i.noop,st&&delete w[h]),f)o.readyState!==4&&o.abort();else{s=o.status;v=o.getAllResponseHeaders();c={};l=o.responseXML;l&&l.documentElement&&(c.xml=l);try{c.text=o.responseText}catch(p){}try{a=o.statusText}catch(p){a=""}s||!r.isLocal||r.crossDomain?s===1223&&(s=204):s=c.text?200:404}}catch(y){f||e(-1,y)}c&&e(s,a,c,v)};r.async?o.readyState===4?setTimeout(u,0):(h=++hu,st&&(w||(w={},i(n).unload(st)),w[h]=u),o.onreadystatechange=u):u()},abort:function(){u&&u(0,1)}}}});var b,ht,ho=/^(?:toggle|show|hide)$/,co=new RegExp("^(?:([-+])=|)("+nt+")([a-z%]*)$","i"),lo=/queueHooks$/,ct=[yo],d={"*":[function(n,t){var o,s,r=this.createTween(n,t),e=co.exec(t),h=r.cur(),u=+h||0,f=1,c=20;if(e){if(o=+e[2],s=e[3]||(i.cssNumber[n]?"":"px"),s!=="px"&&u){u=i.css(r.elem,n,!0)||o||1;do f=f||".5",u=u/f,i.style(r.elem,n,u+s);while(f!==(f=r.cur()/h)&&f!==1&&--c)}r.unit=s;r.start=u;r.end=e[1]?u+(e[1]+1)*o:o}return r}]};i.Animation=i.extend(au,{tweener:function(n,t){i.isFunction(n)?(t=n,n=["*"]):n=n.split(" ");for(var r,u=0,f=n.length;u<f;u++)r=n[u],d[r]=d[r]||[],d[r].unshift(t)},prefilter:function(n,t){t?ct.unshift(n):ct.push(n)}});i.Tween=f;f.prototype={constructor:f,init:function(n,t,r,u,f,e){this.elem=n;this.prop=r;this.easing=f||"swing";this.options=t;this.start=this.now=this.cur();this.end=u;this.unit=e||(i.cssNumber[r]?"":"px")},cur:function(){var n=f.propHooks[this.prop];return n&&n.get?n.get(this):f.propHooks._default.get(this)},run:function(n){var t,r=f.propHooks[this.prop];return this.pos=this.options.duration?t=i.easing[this.easing](n,this.options.duration*n,0,1,this.options.duration):t=n,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),r&&r.set?r.set(this):f.propHooks._default.set(this),this}};f.prototype.init.prototype=f.prototype;f.propHooks={_default:{get:function(n){var t;return n.elem[n.prop]!=null&&(!n.elem.style||n.elem.style[n.prop]==null)?n.elem[n.prop]:(t=i.css(n.elem,n.prop,!1,""),!t||t==="auto"?0:t)},set:function(n){i.fx.step[n.prop]?i.fx.step[n.prop](n):n.elem.style&&(n.elem.style[i.cssProps[n.prop]]!=null||i.cssHooks[n.prop])?i.style(n.elem,n.prop,n.now+n.unit):n.elem[n.prop]=n.now}}};f.propHooks.scrollTop=f.propHooks.scrollLeft={set:function(n){n.elem.nodeType&&n.elem.parentNode&&(n.elem[n.prop]=n.now)}};i.each(["toggle","show","hide"],function(n,t){var r=i.fn[t];i.fn[t]=function(u,f,e){return u==null||typeof u=="boolean"||!n&&i.isFunction(u)&&i.isFunction(f)?r.apply(this,arguments):this.animate(lt(t,!0),u,f,e)}});i.fn.extend({fadeTo:function(n,t,i,r){return this.filter(ft).css("opacity",0).show().end().animate({opacity:t},n,i,r)},animate:function(n,t,r,u){var e=i.isEmptyObject(n),f=i.speed(t,r,u),o=function(){var t=au(this,i.extend({},n),f);e&&t.stop(!0)};return e||f.queue===!1?this.each(o):this.queue(f.queue,o)},stop:function(n,r,u){var f=function(n){var t=n.stop;delete n.stop;t(u)};return typeof n!="string"&&(u=r,r=n,n=t),r&&n!==!1&&this.queue(n||"fx",[]),this.each(function(){var o=!0,t=n!=null&&n+"queueHooks",e=i.timers,r=i._data(this);if(t)r[t]&&r[t].stop&&f(r[t]);else for(t in r)r[t]&&r[t].stop&&lo.test(t)&&f(r[t]);for(t=e.length;t--;)e[t].elem===this&&(n==null||e[t].queue===n)&&(e[t].anim.stop(u),o=!1,e.splice(t,1));(o||!u)&&i.dequeue(this,n)})}});i.each({slideDown:lt("show"),slideUp:lt("hide"),slideToggle:lt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(n,t){i.fn[n]=function(n,i,r){return this.animate(t,n,i,r)}});i.speed=function(n,t,r){var u=n&&typeof n=="object"?i.extend({},n):{complete:r||!r&&t||i.isFunction(n)&&n,duration:n,easing:r&&t||t&&!i.isFunction(t)&&t};return u.duration=i.fx.off?0:typeof u.duration=="number"?u.duration:u.duration in i.fx.speeds?i.fx.speeds[u.duration]:i.fx.speeds._default,(u.queue==null||u.queue===!0)&&(u.queue="fx"),u.old=u.complete,u.complete=function(){i.isFunction(u.old)&&u.old.call(this);u.queue&&i.dequeue(this,u.queue)},u};i.easing={linear:function(n){return n},swing:function(n){return.5-Math.cos(n*Math.PI)/2}};i.timers=[];i.fx=f.prototype.init;i.fx.tick=function(){var u,n=i.timers,r=0;for(b=i.now();r<n.length;r++)u=n[r],u()||n[r]!==u||n.splice(r--,1);n.length||i.fx.stop();b=t};i.fx.timer=function(n){n()&&i.timers.push(n)&&!ht&&(ht=setInterval(i.fx.tick,i.fx.interval))};i.fx.interval=13;i.fx.stop=function(){clearInterval(ht);ht=null};i.fx.speeds={slow:600,fast:200,_default:400};i.fx.step={};i.expr&&i.expr.filters&&(i.expr.filters.animated=function(n){return i.grep(i.timers,function(t){return n===t.elem}).length});ri=/^(?:body|html)$/i;i.fn.offset=function(n){if(arguments.length)return n===t?this:this.each(function(t){i.offset.setOffset(this,n,t)});var u,o,s,h,c,l,a,f={top:0,left:0},r=this[0],e=r&&r.ownerDocument;if(e)return(o=e.body)===r?i.offset.bodyOffset(r):(u=e.documentElement,!i.contains(u,r))?f:(typeof r.getBoundingClientRect!="undefined"&&(f=r.getBoundingClientRect()),s=vu(e),h=u.clientTop||o.clientTop||0,c=u.clientLeft||o.clientLeft||0,l=s.pageYOffset||u.scrollTop,a=s.pageXOffset||u.scrollLeft,{top:f.top+l-h,left:f.left+a-c})};i.offset={bodyOffset:function(n){var t=n.offsetTop,r=n.offsetLeft;return i.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(i.css(n,"marginTop"))||0,r+=parseFloat(i.css(n,"marginLeft"))||0),{top:t,left:r}},setOffset:function(n,t,r){var f=i.css(n,"position");f==="static"&&(n.style.position="relative");var e=i(n),o=e.offset(),l=i.css(n,"top"),a=i.css(n,"left"),v=(f==="absolute"||f==="fixed")&&i.inArray("auto",[l,a])>-1,u={},s={},h,c;v?(s=e.position(),h=s.top,c=s.left):(h=parseFloat(l)||0,c=parseFloat(a)||0);i.isFunction(t)&&(t=t.call(n,r,o));t.top!=null&&(u.top=t.top-o.top+h);t.left!=null&&(u.left=t.left-o.left+c);"using"in t?t.using.call(n,u):e.css(u)}};i.fn.extend({position:function(){if(this[0]){var u=this[0],n=this.offsetParent(),t=this.offset(),r=ri.test(n[0].nodeName)?{top:0,left:0}:n.offset();return t.top-=parseFloat(i.css(u,"marginTop"))||0,t.left-=parseFloat(i.css(u,"marginLeft"))||0,r.top+=parseFloat(i.css(n[0],"borderTopWidth"))||0,r.left+=parseFloat(i.css(n[0],"borderLeftWidth"))||0,{top:t.top-r.top,left:t.left-r.left}}},offsetParent:function(){return this.map(function(){for(var n=this.offsetParent||r.body;n&&!ri.test(n.nodeName)&&i.css(n,"position")==="static";)n=n.offsetParent;return n||r.body})}});i.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(n,r){var u=/Y/.test(r);i.fn[n]=function(f){return i.access(this,function(n,f,e){var o=vu(n);if(e===t)return o?r in o?o[r]:o.document.documentElement[f]:n[f];o?o.scrollTo(u?i(o).scrollLeft():e,u?e:i(o).scrollTop()):n[f]=e},n,f,arguments.length,null)}});i.each({Height:"height",Width:"width"},function(n,r){i.each({padding:"inner"+n,content:r,"":"outer"+n},function(u,f){i.fn[f]=function(f,e){var o=arguments.length&&(u||typeof f!="boolean"),s=u||(f===!0||e===!0?"margin":"border");return i.access(this,function(r,u,f){var e;return i.isWindow(r)?r.document.documentElement["client"+n]:r.nodeType===9?(e=r.documentElement,Math.max(r.body["scroll"+n],e["scroll"+n],r.body["offset"+n],e["offset"+n],e["client"+n])):f===t?i.css(r,u,f,s):i.style(r,u,f,s)},r,o?f:t,o,null)}})});n.jQuery=n.$=i; true&&__webpack_require__(/*! !webpack amd options */ "../../node_modules/.pnpm/webpack@4.46.0_webpack-cli@3.3.12/node_modules/webpack/buildin/amd-options.js").jQuery&&!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = (function(){return i}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__))})(window);
//# sourceMappingURL=jquery-1.8.3.min.js.map


/***/ }),

/***/ "../../../Cognito.Services/Scripts/required/Cognito-init-exoweb.js":
/*!**********************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Cognito.Services/Scripts/required/Cognito-init-exoweb.js ***!
  \**********************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

// Add support for "mailto" in links when rendering templates
Sys.UI.Template.allowedProtocols.push("mailto");
Sys.UI.Template.allowedProtocols.push("file");
Sys.UI.Template.allowedProtocols.push("intent");

ExoWeb.config.autoActivation = false;
ExoWeb.config.allowTypeLazyLoading = false;
ExoWeb.config.enableBatchChanges = false;
ExoWeb.config.allowObjectLazyLoading = true;
ExoWeb.config.allowListLazyLoading = true;
ExoWeb.config.calculationErrorDefault = null;

(function ($) {
	ExoWeb.setLogErrorProvider(function (message, e) {
		// This method does nothing, but it is needed in order to override the default
		// "log error provider" registered in WebService.js in ExoWeb
	});


	function updateNativeTimeField() {
		if (this.value) {
			$(this).removeClass("c-timepicker-empty");
		} else {
			$(this).addClass("c-timepicker-empty");
		}
	}

	function setupNativeTimeField() {
		var fifteenMinutesInSeconds = 900;

		$(this).attr("step", fifteenMinutesInSeconds);

		$(this).attr("novalidate", "");

		// Add a class to an ancestor hide the icon in case removal fails due to changes in DOM structure
		$(this).closest(".c-editor").addClass("c-use-native-datetime-fields");

		$(this).closest(".c-editor-time").next(".c-editor-time-icon").remove();

		updateNativeTimeField.call(this);

		// Don't allow tabbing into the text field on mobile devices
		$(this).siblings('[type="text"]').attr('tabindex', -1);

		// Don't change focus on iOS, since it causes the picker to hide and appears to transfer the
		// HH:mm time value to the focussed text field, also, iOS doesn't show focus indication anyway
		if (!Cognito.isDeviceType('iphone|ipod|ipad')) {

			if (Cognito.isDeviceType('android')) {
				// Don't allow tabbing into the time field in android
				// This emulates the native behavior of the 'time' field (as well as 'select') on android
				$(this).attr('tabindex', -1);
			}

			// Set focus to faux input when native time input is clicked (for visual focus indication)
			$(this).on('click', function () {
				$(this).siblings('[type="text"]').focus();
			});

		}
	}

	function createTimePicker() {
		// only enable timepicker for cultures that are compatible with en-US
		var longTimePattern = Sys.CultureInfo.CurrentCulture.dateTimeFormat.LongTimePattern;
		if (longTimePattern.match("^h?h[:.]mm[:.]ss tt$") ){
			$(this).timepicker({
				AMDesignator: Sys.CultureInfo.CurrentCulture.dateTimeFormat.AMDesignator,
				PMDesignator: Sys.CultureInfo.CurrentCulture.dateTimeFormat.PMDesignator,
				timeSeparator: Sys.CultureInfo.CurrentCulture.dateTimeFormat.TimeSeparator,
				twoDigitHourFormat: longTimePattern.substring(0, 2) == "hh"
			})
			.on("changeTime.timepicker", function (e) {
				$simulateMutationEvent(this, "change", false, true);
			});
		}
		// 24 hour time
		else if (longTimePattern.match("^H?H[:.]mm[:.]ss$")) {
			$(this).timepicker({
				showMeridian: false,
				timeSeparator: Sys.CultureInfo.CurrentCulture.dateTimeFormat.TimeSeparator,
				twoDigitHourFormat: longTimePattern.substring(0, 2) == "HH"
			})
			.on("changeTime.timepicker", function (e) {
				$simulateMutationEvent(this, "change", false, true);
			});
		}
	}

	function createSignature() {

		var sig = $(this).parent();

		window.setTimeout(function () {
			var jsignature = sig.children().first();
			var img = sig.find("img");

			// If no controls found, abort
			if (!jsignature.length || !img.length) return;

			// Initialize the signature control
			jsignature.jSignature({ "background-color": "transparent", color: img.css("color"), "decor-color": "#eee", height: 150, width: "100%" });

			// Hide the signature control if a signature is already present
			// The .not is to exlcude the c-readonly added to container c-field and c-section for read-only support
			if (img.attr("src").length || sig.closest(".c-readonly").not(".c-field, .c-section").length) {
				jsignature.hide();

				if (img.attr("src").length) {
					sig.addClass("c-signature-present");

					// To have symmetry with other signature html
					sig.closest('.c-editor').find('> div').addClass("c-signature-present");
					jsignature.jSignature("importData", img.attr("src"));
				}
			}

			// Otherwise, hide the image placeholder
			else
				img.hide();

			if ($(jsignature).parents(".c-signature").hasClass("c-readonly")) {
				$(jsignature).jSignature("disable")
			}

			// Subscribe to change event
			jsignature.bind('change', function (e) {

				// Get the signature
				var signature = $parentContextData(this);

				// No signature present
				if (jsignature.jSignature("getData", "native").length !== 0 && jsignature.is(":visible")) {
					// Set the signature SVG and PNG properties
					signature.set_Svg("data:" + jsignature.jSignature("getData", "svgbase64").join(","));
					signature.set_Png("data:" + jsignature.jSignature("getData", "image").join(","));

					// Add a class to indicate that a signature is present
					jsignature.parent().addClass("c-signature-present");
				}
			});
		}, 0);
	}

	function createAutoComplete() {
		$(this).typeahead({
		    minLength: 0,
            source: null
		});
	}

	// The toggle has been re-implemented to no longer depend on cognito-toggle.js
	//function createToggle() {
	//	var that = $(this);
	//	$(this)['bootstrapSwitch']();
	//	$(this).bootstrapSwitch('setAnimated', true);
	//	$(this).parents(".has-switch").on("switch-change", function () {
	//		$simulateMutationEvent(that[0], "change", false, true);
	//	});
	//}

	function createPlaceholder() {
		if (!$.fn.placeholder) return;

		$(this).placeholder();
	}

	$(document.documentElement).ever({
		selector: "div.c-signature img",
		bound: createSignature
	});

	$(document.documentElement).ever({
		selector: "input[type=text].c-timepicker",
		bound: createTimePicker
	});

	$(document.documentElement).ever({
		selector: "input[type=time].c-timepicker",
		bound: setupNativeTimeField
	});

	$(document.documentElement).on("input change focus", "input[type=time].c-timepicker", updateNativeTimeField);

	$(document.documentElement).ever({
		selector: "input.c-autocomplete",
		bound: createAutoComplete
	});

	// The toggle has been re-implemented to no longer depend on cognito-toggle.js
	//$(document.documentElement).ever({
	//	selector: "input.c-toggle",
	//	bound: createToggle
	//});

	$(document.documentElement).ever({
		selector: "input,textarea",
		bound: createPlaceholder
	});

	$(document.documentElement).ever({
		selector: "input.c-mask",
		bound: function () {
			var mask = $(this).attr("data-mask");
			$(this).mask(mask, { autoclear: false, autoinit: false });
		},
		unbound: function () {
			$(this).unmask();
		}
	});

	// Clear signatures when delete button is clicked
	$(document.documentElement).on("click", ".c-signature-present .c-signature-glyph", function () {
		// Get the signature
		var signature = $parentContextData(this);

		// Clear the signature SVG and PNG properties
		signature.set_Svg(null);
		signature.set_Png(null);

		// Remove signature indicator
		$(this).parent().removeClass("c-signature-present");

		// Reset and show the signature control
		$(this).parent().children().first().jSignature("reset").show();
		$(this).parent().children("img").hide();
		window.setTimeout(Cognito.resize);
	});

	// Toggle
	// Trigger toggle with JS instead of <label> per AXE report
	$(document.documentElement).on('click', '.c-toggle--container', function () {
		$(this).siblings('[type="checkbox"]').trigger('click').trigger('focus');
	});

})(ExoJQuery || jQuery);


/***/ }),

/***/ "../../../Cognito.Services/Scripts/required/cognito-init-dependencies.js":
/*!****************************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Cognito.Services/Scripts/required/cognito-init-dependencies.js ***!
  \****************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

window.Cognito = window.Cognito || {};

(function(window, jQuery) {
	if (!jQuery) {
		console.error("jQuery not loaded.  Cognito depends on jQuery 1.7+");
	}
	
	window.ExoJQuery = jQuery.noConflict(true);
})(window, jQuery);

/***/ }),

/***/ "../../../Cognito.Services/Scripts/required/jquery.xdr.js":
/*!*************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Cognito.Services/Scripts/required/jquery.xdr.js ***!
  \*************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

﻿if (window.XDomainRequest) {
	jQuery.ajaxTransport(function (s) {
		if (s.crossDomain /*&& s.async*/) {
			if (s.timeout) {
				s.xdrTimeout = s.timeout;
				delete s.timeout;
			}
			var xdr;
			return {
				send: function (_, complete) {
					function callback(status, statusText, response, responseHeaders) {
						xdr.onload = xdr.onerror = xdr.ontimeout = xdr.onprogress = function() { };
						xdr = undefined;

						if (response.text.slice(0, 9) === "ie9error:") {
							var data = JSON.parse(response.text.substring(9));
							status = data.status;
							statusText = data.description;
							response.text = "";
						}

						complete(status, statusText, response, responseHeaders);
					}
					xdr = new XDomainRequest();

					if (s.url.slice(0, 5) === "https" && window.location.protocol === "http:") {
						s.url = s.url.replace("https", "http");
					}

					xdr.open(s.type, s.url);
					xdr.onload = function () {
						callback(200, "OK", {
							text: xdr.responseText
						}, "Content-Type: " + xdr.contentType);
					};
					xdr.onerror = function () {
						callback(500, "General error.");
					};
					xdr.onprogress = function () { };
					if (s.xdrTimeout) {
						xdr.ontimeout = function () {
							callback(0, "timeout");
						};
						xdr.timeout = s.xdrTimeout;
					}
					xdr.send((s.hasContent && s.data) || null);
				},
				abort: function () {
					if (xdr) {
						xdr.onerror = function () { };
						xdr.abort();
					}
				}
			};
		}
	});
}


/***/ }),

/***/ "../../../Public/ExoWeb/ExoWeb/client/dist/exoweb-msajax.js":
/*!***************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Public/ExoWeb/ExoWeb/client/dist/exoweb-msajax.js ***!
  \***************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

window.ExoWeb = {};
window.ExoWeb.Model = {};
window.ExoWeb.Mapper = {};
window.ExoWeb.UI = {};
window.ExoWeb.View = {};
window.ExoWeb.DotNet = {};

(function(jQuery) {

	// #region ExoWeb.Config
	//////////////////////////////////////////////////

	var config = {
		// Avoid patterns that can make debugging more difficult, try/catch for example.
		debug: false,

		// Indicates that signal should use window.setTimeout when invoking callbacks. This is
		// done in order to get around problems with browser complaining about long-running script.
		signalTimeout: false,

		// The maximum number of pending signals to execute as a batch.
		// By default this is null, which means that no maximum is enforced.
		signalMaxBatchSize: null,

		// Causes the query processing to load model roots in the query individually. By default they are batch-loaded.
		individualQueryLoading: false,

		// Uniquely identifies this application if more than one app is hosted under the same domain name.
		appInstanceId: "?",

		// Automatic DOM activation when document.ready fires
		autoActivation: true,

		// Controls different whether lazy loading are allowed. If set to false, an error is raised when lazy loading occurs.
		allowTypeLazyLoading: true,
		allowObjectLazyLoading: true,
		allowListLazyLoading: true,

		// Allows additional scope variables to be introduced for dynamically compiled expressions
		expressionScope: null,

		// Specifies the default defaultIfError value for CalculatedPropertyRule instances
		calculationErrorDefault: undefined,

		// Specifies whether the adapter should update a control's value when the display
		// value is updated while being set, for example due to applying a format.
		autoReformat: true,

		// Specifies whether changes should be collected in logical batches.
		enableBatchChanges: true,

		// Specifies whether "runaway" rules should be detected, e.g. the case where a
		// rule causes itself to be re-entered continually (wheter directly or indirectly).
		detectRunawayRules: false,

		// Controls the maximum number of times that a child event scope can transfer events
		// to its parent while the parent scope is exiting. A large number indicates that
		// rules are not reaching steady-state. Technically something other than rules could
		// cause this scenario, but in practice they are the primary use-case for event scope. 
		nonExitingScopeNestingCount: 100
	};

	ExoWeb.config = config;

	// #endregion

	// #region ExoWeb.Unload
	//////////////////////////////////////////////////

	// Attach to the unload event and change the page state so that scripts can
	// toggle their behavior and not do things that will fail during unload. 
	ExoWeb.windowIsUnloading = false;
	if (window.addEventListener) {
		window.addEventListener("unload", function () {
			ExoWeb.windowIsUnloading = true;
		}, false);
	} else if (window.attachEvent) {
		window.attachEvent("onunload", function () {
			ExoWeb.windowIsUnloading = true;
		});
	}

	// #endregion

	// #region ExoWeb.Errors
	//////////////////////////////////////////////////

	function ArgumentTypeError(argumentName, expectedType, actualValue) {
		/// <summary locid="M:J#ArgumentTypeError.#ctor">
		/// An error type that is raised when an argument to a function
		/// is of the wrong type.
		/// </summary>
		/// <param name="argumentName" type="String">The name of the argument that was of the wrong type.</param>
		/// <param name="expectedType" type="String">The expected type of the arguments.</param>
		/// <param name="value">The actual number of arguments that were given.</param>

		if (arguments.length !== 3) throw new ArgumentsLengthError(3, arguments.length);
		if (argumentName == null) throw new ArgumentNullError("argumentName");
		if (typeof(argumentName) !== "string") throw new ArgumentTypeError("argumentName", "string", argumentName);
		if (expectedType == null) throw new ArgumentNullError("expectedType");
		if (typeof(expectedType) !== "string") throw new ArgumentTypeError("expectedType", "string", expectedType);

		this.name = "ArgumentTypeError";
		this.argumentName = argumentName;
		this.expectedType = expectedType;
		this.actualValue = actualValue;
		this.message = "Argument '" + argumentName + "' must be of type " + expectedType + ": " + actualValue + ".";
	}

	ArgumentTypeError.prototype = new Error();
	ArgumentTypeError.prototype.constructor = ArgumentTypeError;

	ExoWeb.ArgumentTypeError = ArgumentTypeError;
	window.ArgumentTypeError = ArgumentTypeError;

	function ArgumentsLengthError(expected, actual) {
		/// <summary locid="M:J#ArgumentsLengthError.#ctor">
		/// An error type that is raised when the wrong number
		/// of arguments is passed to a function.
		/// </summary>
		/// <param name="expected" type="Number">The expected number of arguments.</param>
		/// <param name="actual" type="Number">The actual number of arguments that were given.</param>

		if (arguments.length !== 2) throw new ArgumentsLengthError(2, arguments.length);
		if (expected == null) throw new ArgumentNullError("expected");
		if (actual == null) throw new ArgumentNullError("actual");
		if (typeof(expected) !== "number") throw new ArgumentTypeError("expected", "number", expected);
		if (typeof(actual) !== "number") throw new ArgumentTypeError("actual", "number", actual);

		this.name = "ArgumentsLengthError";
		this.expected = expected;
		this.actual = actual;
		this.message = "The number of arguments is not correct, expected " + expected + ", actual " + actual + ".";
	}

	ArgumentsLengthError.prototype = new Error();
	ArgumentsLengthError.prototype.constructor = ArgumentsLengthError;

	ExoWeb.ArgumentsLengthError = ArgumentsLengthError;
	window.ArgumentsLengthError = ArgumentsLengthError;

	function ArgumentNullError(argumentName, reason) {
		/// <summary locid="M:J#ArgumentNullError.#ctor">
		/// An error type that is raised when an argument is
		/// null or undefined and it must have a value.
		/// </summary>
		/// <param name="argumentName" type="String">The name of the argument that was null.</param>
		/// <param name="reason" type="String">The reason that the argument cannot be null.</param>

		if (arguments.length < 1 && arguments.length > 2) throw new ArgumentsLengthError(2, arguments.length);
		if (argumentName == null) throw new ArgumentNullError("argumentName");
		if (typeof(argumentName) !== "string") throw new ArgumentTypeError("argumentName", "string", argumentName);
		if (reason != null && typeof(reason) !== "string") throw new ArgumentTypeError("reason", "string", reason);

		this.name = "ArgumentNullError";
		this.argumentName = argumentName;
		this.reason = reason;
		this.message = "Argument '" + argumentName + "' cannot be null or undefined" + (reason ? ": " + reason + "." : ".");
	}

	ArgumentNullError.prototype = new Error();
	ArgumentNullError.prototype.constructor = ArgumentNullError;

	ExoWeb.ArgumentNullError = ArgumentNullError;
	window.ArgumentNullError = ArgumentNullError;

	function ArgumentError(argumentName, reason) {
		/// <summary locid="M:J#ArgumentNullError.#ctor">
		/// An error type that is raised when an argument has an invalid value.
		/// </summary>
		/// <param name="argumentName" type="String">The name of the argument that was null.</param>
		/// <param name="reason" type="String">The reason that the argument cannot be null.</param>

		if (arguments.length !== 2) throw new ArgumentsLengthError(2, arguments.length);
		if (argumentName == null) throw new ArgumentNullError("argumentName");
		if (typeof (argumentName) !== "string") throw new ArgumentTypeError("argumentName", "string", argumentName);
		if (reason == null) throw new ArgumentNullError("reason");
		if (typeof (reason) !== "string") throw new ArgumentTypeError("reason", "string", reason);

		this.name = "ArgumentError";
		this.argumentName = argumentName;
		this.reason = reason;
		this.message = "Argument '" + argumentName + "' has an invalid value" + (reason ? ": " + reason + "." : ".");
	}

	ArgumentError.prototype = new Error();
	ArgumentError.prototype.constructor = ArgumentError;

	ExoWeb.ArgumentError = ArgumentError;
	window.ArgumentError = ArgumentError;

	var logErrorProvider = null;

	function setLogErrorProvider(fn) {
		/// <summary>
		/// Provide an implementation of the LogError provider.
		/// </summary>
		/// <remarks>
		///
		/// Event propogation
		/// =================
		///
		/// When the global error event occurs, the log error handler is called last
		/// before exiting.  This allows existing subscribers to handle the error and
		/// prevent propogation, also preventing the error from being logged. Subscribers
		/// that attach to the error event after the log error handler is subscribed
		/// (i.e. after the framework script has loaded) should execute their logic
		/// first, then call the original event handler.  Unlike other handlers, the
		/// log error handler may NOT signal that the error was handled to prevent
		/// propogation.  The ExoWeb.error event can be used for that purpose. If the
		/// error reaches the logging phase it is assumed that it will not be handled.  
		///
		/// The event handler's argument(s)
		/// ===============================
		///
		/// The function is called with a single object, referred to as "errorData".
		/// The default object that is passed contains the following properties, which
		/// correspond to the format of the ServiceError object:
		///
		///		"message": The error message.
		///		"type": The type of error.  By default this is simply "Error".  A custom event
		///			handler may choose to attempt to infer the error type from the message.
		///		"url": The URL where the error occurred.  By default this is the current URL.
		///		"refererUrl": By default this is the `document.referrer` property.
		///		"additionalInfo": By default this is an object with `url` and `lineNumber`
		///			properties, which correspond to the arguments of that name which were
		///			passed to the global error event.  Custom error	handlers can remove these
		///			properties and/or include custom data.  Additional properties should use
		///			primative types, and should be only one level deep.  In other words,
		///			`errorData["Foo.Bar"] = 1`, not `errorData.Foo = { Bar: 1 }`.
		///
		/// </remarks>
		/// <param name="fn" type="Function">The error provider function.</param>

		if (arguments.length !== 1) throw new ArgumentsLengthError(1, arguments.length);
		if (fn == null) throw new ArgumentNullError("fn");
		if (typeof(fn) !== "function") throw new ArgumentTypeError("fn", "function", fn);

		logErrorProvider = fn;
	}

	ExoWeb.setLogErrorProvider = setLogErrorProvider;

	var errorEventFns = [];

	function addError (fn) {
		/// <summary>
		/// Attach an event handler to the global error event.
		/// </summary>
		/// <remarks>
		///
		/// Timing of event
		/// ===============
		///
		/// The ExoWeb error event is called when a global error event is raised, immediately
		/// before the "log error" provider is called.
		///
		/// The event handler's argument(s)
		/// ===============================
		///
		/// The event handler is passed four arguments in total: the original three arguments
		/// of the global error handler (message, url, lineNumber, colNumber, errorObj), as well as the "errorData"
		/// object, which will ultimately be passed to the "log error" provider. The event
		/// handler may choose to modified any of the errorData object's properties.
		/// 
		/// </remarks>
		/// <param name="fn" type="Function">The error event function. Signature: f (message, url, lineNumber, colNumber, errorObj, errorData).</param>

		if (fn == null) throw new ArgumentNullError("fn");
		if (typeof(fn) !== "function") throw new ArgumentTypeError("fn", "function", fn);

		errorEventFns.push(fn);
	}

	ExoWeb.addError = addError;

	function removeError(fn) {
		/// <summary>
		/// Removes an event handler to the global error event.
		/// </summary>
		/// <param name="fn" type="Function">The error event function.</param>

		if (fn == null) throw new ArgumentNullError("fn");
		if (typeof (fn) !== "function") throw new ArgumentTypeError("fn", "function", fn);

		var idx = errorEventFns.indexOf(fn);
		if (idx < 0) {
			throw new ArgumentError("fn", "The given function was not found in the list of error handlers.");
		}
		errorEventFns.splice(idx, 1);
	}

	ExoWeb.removeError = removeError;

	/*
	* Handles an error that 
	*/
	function handleError(message, url, lineNumber, colNumber, errorObj, customErrorData, raiseEvents, onSuccess, onFailure) {

		// Initialize the default error data based on the error.
		var cancelled = false,
			errorData = jQuery.extend({
				message: message,
				type: "Error",
				url: window.location.href,
				refererUrl: document.referrer,
				stackTrace: errorObj ? errorObj.stack : "",
				additionalInfo: {
					url: url,
					lineNumber: lineNumber,
					columnNumber: colNumber
				}
			}, customErrorData);

		if (raiseEvents) {
			// The error was not handled, so raise the error event.
			errorEventFns.forEach(function (fn) {
				// Skip if the event has been cancelled.
				if (cancelled) {
					return;
				}

				var result = fn(message, url, lineNumber, colNumber, errorObj, errorData);
				if (result === true) {
					// Cancel the event if the result indicates that the event was handled.
					cancelled = true;
				}
			});
		}

		if (!cancelled && logErrorProvider) {
			// Log the error.
			logErrorProvider(errorData, onSuccess, onFailure);
		}

	}

	/*
	* Explicitly logs an error without throwing.
	* Raising the 'error' event is optional.
	*/
	function logError(message, url, lineNumber, colNumber, errorObj, errorData, raiseEvents, onSuccess, onFailure) {
		/// <summary>
		/// Logs an error.
		/// 
		/// Signature:
		/// ExoWeb.logError(message or error[, url, lineNumber][, errorData][, raiseEvents][, onSuccess][, onFailure]);
		/// 
		/// Examples:
		/// 
		/// ExoWeb.logError(e);
		/// ExoWeb.logError('Message', 'http://...', 14);
		/// ExoWeb.logError('Message', 'http://...', 14, 12);
		/// ExoWeb.logError('Message', 'http://...', 14, 12, e);
		/// ExoWeb.logError(e, { foo: "bar" }, function () { /* on success */ });
		/// ExoWeb.logError('Message', 'http://...', 14, 12, true, function () { /* on success */ }, function () { /* on failure */ });
		/// ExoWeb.logError('Message', 'http://...', 14, 12, { foo: "bar" }, true);
		/// </summary>
		/// <param name="message" type="String">The error message.</param>
		/// <param name="url" type="String" optional="true">The url where the error occurred.</param>
		/// <param name="lineNumber" type="Number" integer="true" optional="true">The line number where the error occurred.</param>
		/// <param name="colNumber" type="Number" integer="true" optional="true">The column number where the error occurred.</param>
		/// <param name="errorObj" type="Error" optional="true">Native Error object.</param>
		/// <param name="errorData" type="Object" optional="true">Custom data to include with the error.</param>
		/// <param name="raiseEvents" type="Boolean" optional="true">
		/// Whether or not to raise the error event when handling the error. When called via internal framework
		/// methods (e.g. the global error event handler) the events will be raised, but when called externally
		/// the caller must specify that they want events to be raised to avoid unwanted side-effects.
		/// </param>
		/// <param name="onSuccess" type="Function" optional="true">The callback to invoke when logging the error succeeds.</param>
		/// <param name="onFailure" type="Function" optional="true">The callback to invoke when logging the error fails.</param>

		// Ensure that the message (or error) argument was passed in
		if (message == null) throw new ArgumentNullError("message");

		if (arguments.length > 9) {
			throw new ArgumentsLengthError(9, arguments.length);
		}

		var args = Array.prototype.slice.call(arguments),
			successCallback = null,
			failureCallback = null,
			error = null,
			raiseErrorEvents = false,
			customErrorData = null;

		if (isFunction(args[args.length - 1])) {
			successCallback = args.pop();
			if (isFunction(args[args.length - 1])) {
				failureCallback = successCallback;
				successCallback = args.pop();
			}
		}

		if (isBoolean(args[args.length - 1])) {
			raiseErrorEvents = args.pop();
		}

		if (args.length > 1 && args[args.length - 1] instanceof Object && !(args[args.length - 1] instanceof Error)) {
			customErrorData = args.pop();
		}

		// An Error or string was passed in
		if (args.length === 1) {
			if (message instanceof Error) {
				// Rewrite arguments
				error = message;

				// Pass along the information from the error
				handleError(error.message, error.fileName, error.lineNumber, error.columnNumber, message, customErrorData, raiseErrorEvents, successCallback, failureCallback);
			}
			else {
				// Pass along the message and simulate the other information
				handleError(message.toString(), "?", "-1", "-1", null, customErrorData, raiseErrorEvents, successCallback, failureCallback);
			}
		}
		// Check for {message, url, lineNumber} mode
		else if (args.length >= 3) {
			// Validate args
			if (!(message.constructor === String)) throw new ArgumentTypeError("message", "string", message);
			if (url.constructor !== String) throw new ArgumentTypeError("url", "string", url);
			if (lineNumber != null && typeof (lineNumber) !== "number") throw new ArgumentTypeError("lineNumber", "number", lineNumber);

			// Pass along the information
			handleError(message, url, lineNumber, typeof colNumber === "number" ? colNumber : -1, errorObj instanceof Error ? errorObj : null, customErrorData, raiseErrorEvents, successCallback, failureCallback);
		}
		// Incorrect number of arguments
		else {
			throw new ArgumentsLengthError(3, arguments.length);
		}
	}

	ExoWeb.logError = logError;

	/*
	* Attaches to the global error event and logs the error if
	* logging is implemented and the error is not handled.
	*/
	var oldOnError = window.onerror;
	window.onerror = function (message, url, lineNumber, colNumber, errorObj) {

		if (!window.ExoWeb || ExoWeb.windowIsUnloading) {
			return false;
		}

		// Call previous handler.
		if (oldOnError && oldOnError.apply(this, arguments) === true) {
			// Previous handler has handled the error, so exit now and prevent propogation.
			return true;
		}

		// Pass the error along to event subscribers and then log.
		handleError(message, url, lineNumber, colNumber, errorObj, null, true);

		// Let default handler run.
		return false;

	};

	// #endregion

	// #region ExoWeb.Warnings
	//////////////////////////////////////////////////

	var logWarningProvider = function (message) {
		// if the console is defined then log the message
		if (typeof (console) !== "undefined") {
			if (console.warn) {
				console.warn(message);
			}
		}
	};

	function setLogWarningProvider(fn) {
		/// <summary>
		/// Provide an implementation of the logWarning provider.
		/// </summary>
		/// <remarks>
		///
		/// The event handler's argument(s)
		/// ===============================
		///
		/// The function is called with a single value, the warning message.
		//
		/// </remarks>
		/// <param name="fn" type="Function">The warning provider function.</param>

		if (arguments.length !== 1) throw new ArgumentsLengthError(1, arguments.length);
		if (fn == null) throw new ArgumentNullError("fn");
		if (typeof(fn) !== "function") throw new ArgumentTypeError("fn", "function", fn);

		logWarningProvider = fn;
	}

	ExoWeb.setLogWarningProvider = setLogWarningProvider;

	function logWarning(message) {
		if (logWarningProvider) {
			// Log the warning.
			logWarningProvider(message);
		}
	}

	ExoWeb.logWarning = logWarning;

	// #endregion

	// #region ExoWeb.TypeChecking
	//////////////////////////////////////////////////

	var typeExpr = /\s([a-z|A-Z]+)/;

	function type(obj) {
		if (obj === undefined) {
			return "undefined";
		}
		else if (obj === null) {
			return "null";
		}
		else {
			return Object.prototype.toString.call(obj).match(typeExpr)[1].toLowerCase();
		}
	}
	ExoWeb.type = type;

	function isNullOrUndefined(obj) {
		return obj === null || obj === undefined;
	}
	ExoWeb.isNullOrUndefined = isNullOrUndefined;

	function isArray(obj) {
		return type(obj) === "array";
	}
	ExoWeb.isArray = isArray;

	function isString(obj) {
		return type(obj) === "string";
	}
	ExoWeb.isString = isString;

	function isNumber(obj) {
		return type(obj) === "number";
	}
	ExoWeb.isNumber = isNumber;

	var integerExpr = /^-?[0-9]{1,10}$/;

	function isInteger(obj) {
		return isNumber(obj) && !isNaN(obj) && integerExpr.test(obj.toString()) && (obj >= -2147483648 && obj <= 2147483647);
	}
	ExoWeb.isInteger = isInteger;

	function isNatural(obj) {
		return isInteger(obj) && obj > 0;
	}
	ExoWeb.isNatural = isNatural;

	function isWhole(obj) {
		return isInteger(obj) && obj >= 0;
	}
	ExoWeb.isWhole = isWhole;

	var decimalExpr = /^-?[0-9]+\.[0-9]+$/;

	function isDecimal(obj) {
		return isNumber(obj) && !isNaN(obj) && decimalExpr.test(obj.toString());
	}
	ExoWeb.isDecimal = isDecimal;

	function isFunction(obj) {
		return type(obj) === "function";
	}
	ExoWeb.isFunction = isFunction;

	function isBoolean(obj) {
		return type(obj) === "boolean";
	}
	ExoWeb.isBoolean = isBoolean;

	function isDate(obj) {
		return type(obj) === "date";
	}
	ExoWeb.isDate = isDate;

	function isObject(obj) {
		return type(obj) === "object" || (obj && obj instanceof Object);
	}
	ExoWeb.isObject = isObject;

	// #endregion

	// #region ExoWeb.Random
	//////////////////////////////////////////////////

	function randomInteger(min, max) {
		var scale;
		if (arguments.length === 0) {
			min = 0;
			max = 9;
		}
		else if (arguments.length === 1) {
			if (!isInteger(min)) {
				throw new Error("Minimum argument must be an integer.");
			}

			if (min < 0) {
				max = 0;
			}
			else {
				max = min;
				min = 0;
			}
		}
		else if (!isInteger(min)) {
			throw new Error("Minimum argument must be an integer.");
		}
		else if (!isInteger(max)) {
			throw new Error("Maximum argument must be an integer.");
		}
		else if (min >= max) {
			throw new Error("Minimum argument must be less than maximum argument.");
		}

		var rand = Math.random();
		return rand === 1 ? max : Math.floor(rand * (max - min + 1)) + min;
	}

	ExoWeb.randomInteger = randomInteger;

	function randomText(len, includeDigits) {
		if (arguments.length === 0) {
			throw new Error("Length argument is required.");
		}
		else if (!isNatural(len)) {
			throw new Error("Length argument must be a natural number.");
		}

		var result = "";
		for (var i = 0; i < len; i++) {
			var min = 0;
			var max = includeDigits ? 35 : 25;
			var rand = randomInteger(min, max);
			var charCode;
			if (rand <= 25) {
				// Alpha: add 97 for 'a'
				charCode = rand + 97;
			}
			else {
				// Num: start at 0 and add 48 for 0
				charCode = (rand - 26) + 48;
			}
			result += String.fromCharCode(charCode);
		}
		return result;
	}

	ExoWeb.randomText = randomText;

	// #endregion

	// #region ExoWeb.Function
	//////////////////////////////////////////////////

	var overridableNonEnumeratedMethods;

	for (var m in {}) {
		if (m == "toString") {
			overridableNonEnumeratedMethods = [];
			break;
		}
	}

	if (!overridableNonEnumeratedMethods)
		overridableNonEnumeratedMethods = ["toString", "toLocaleString", "valueOf"];

	function addPrototypeMember(obj, name, member) {

		// method
		if (member instanceof Function) {
			obj[name] = member;
		}

		// property
		else if (member instanceof Object) {
			Object.defineProperty(obj, name, member);
		}

		// field
		else {
			obj[name] = member;
		}
	}

	Function.prototype.mixin = function mixin(members, obj) {
		if (!obj) {
			obj = this.prototype;
		}

		for (var m in members) {
			var member = members[m];
			if (members.hasOwnProperty(m)) {
				addPrototypeMember(obj, m, member);
			}
		}

		// IE's "in" operator doesn't return keys for native properties on the Object prototype
		overridableNonEnumeratedMethods.forEach(function (m) {
			var member = members[m];
			if (members.hasOwnProperty(m)) {
				addPrototypeMember(obj, m, member);
			}
		});
	};

	Function.prototype.dontDoubleUp = function Function$dontDoubleUp(options) {
		var proceed = this;
		var calls = [];
	
		// Is the function already being called with the same arguments?
		return function dontDoubleUp() {
			var i, ilen, j, jlen, origCallback, origThisPtr, partitionedArg, partitionedArgIdx, groupBy, callsInProgress, call, shouldJoinCall, otherPartitionedArg, partitionedInCall, joinArgIdx, args;
	
			// Make a copy of the invocation arguments.
			args = Array.prototype.slice.call(arguments);

			// Extract callback and thisPtr arguments, if they exist.
			if (options.callbackArg < arguments.length) {
				origCallback = arguments[options.callbackArg];
			}
			if (options.thisPtrArg < arguments.length) {
				origThisPtr = arguments[options.thisPtrArg];
			}

			// Determine what arguments can be partitioned into separate calls
			if (options.partitionedArg !== null && options.partitionedArg !== undefined) {
				partitionedArg = arguments[options.partitionedArg];
				if (!(partitionedArg instanceof Array)) {
					throw new Error("The partitioned argument must be an array.");
				}

				// Create a copy of the argument.
				partitionedArg = partitionedArg.copy();

				partitionedArgIdx = -1;
			}

			// Determine what values to use to group callers
			groupBy = [];
			if (options.groupBy && options.groupBy instanceof Array) {
				for (i = 0, ilen = options.groupBy.length; i < ilen; i++) {
					if (partitionedArg !== undefined && options.groupBy[i] === options.partitionedArg) {
						partitionedArgIdx = groupBy.length;
					}
					groupBy.push(arguments[options.groupBy[i]]);
				}
			}
			else if (options.groupBy !== null && options.groupBy !== undefined) {
				groupBy.push(arguments[options.groupBy]);
				if (options.groupBy === options.partitionedArg) {
					partitionedArgIdx = 0;
				}
			}
			else {
				for (i = 0, ilen = arguments.length; i < ilen; ++i) {
					if (i !== options.callbackArg && i !== options.thisPtrArg) {
						if (partitionedArg !== undefined && i === options.partitionedArg) {
							partitionedArgIdx = groupBy.length;
						}
						groupBy.push(arguments[i]);
					}
				}
			}

			// Verify that the the partitioned argument is part of the grouping.
			if (partitionedArgIdx === -1) {
				throw new Error("Invalid partitionedArg option.");
			}

			// Is this call already in progress?
			callsInProgress = [];
			for (i = 0, ilen = calls.length; (partitionedArg === undefined || partitionedArg.length > 0) && i < ilen; i++) {
				call = calls[i];

				// TODO: handle optional params better
				if (groupBy.length != call.groupBy.length) {
					continue;
				}

				// Only join calls together if they were called on the same object.
				shouldJoinCall = this === call.context;

				// Make sure all of the arguments match.
				for (j = 0, jlen = groupBy.length; shouldJoinCall && j < jlen; j++) {
					if (j === partitionedArgIdx) {	
						// Attempt to find items in partitioned argument that are in progress and remove them
						shouldJoinCall = call.groupBy[j].some(function(p) {
							return partitionedArg.indexOf(p) >= 0;
						});
					}
					else if (groupBy[j] !== call.groupBy[j]) {
						shouldJoinCall = false;
					}
				}

				if (shouldJoinCall) {

					partitionedInCall = [];

					// Remove partitioned args that will be satisfied by the call in progress.
					if (partitionedArg !== undefined) {
						otherPartitionedArg = call.groupBy[partitionedArgIdx];
						for (j = 0, jlen = otherPartitionedArg.length; j < jlen; j++) {
							joinArgIdx = partitionedArg.indexOf(otherPartitionedArg[j]);
							if (joinArgIdx >= 0) {
								partitionedInCall.push(otherPartitionedArg[j]);
								partitionedArg.splice(joinArgIdx, 1);
							}
						}
					}

					callsInProgress.push({ call: call, partitioned: partitionedInCall });

				}
			}

			if (callsInProgress.length === 0 || (partitionedArg !== undefined && partitionedArg.length > 0)) {

				// track the next call that is about to be made
				call = { callback: Functor(), groupBy: groupBy, context: this };
			
				calls.push(call);

				// make sure the original callback is invoked and that cleanup occurs
				call.callback.add(function() {
					if (calls.indexOf(call) < 0) {
						throw new Error("Call not found.");
					}
					if (origCallback) {
						origCallback.apply(origThisPtr || this, arguments);
					}
					if (options.memoize === true) {
						call.complete = true;
						call.response = {
							thisPtr: this,
							args: Array.prototype.slice.call(arguments)
						};
					}
					else {
						calls.remove(call);
					}
				});

				// Copy the args
				newArgs = args.slice();

				// use remaining partitioned args if in effect
				if (partitionedArg !== undefined && partitionedArg.length > 0) {
					newArgs[options.partitionedArg] = partitionedArg;
				}

				// pass the new callback to the inner function
				newArgs[options.callbackArg] = call.callback;

				call.args = newArgs;

				proceed.apply(this, newArgs);

			}

			if (callsInProgress.length > 0 && origCallback) {
		
				// wait for the original call to complete
				forEach(callsInProgress, function(call) {

					var invocationArgs;

					if (options.partitionedFilter) {
						invocationArgs = args.slice();
						invocationArgs[options.partitionedArg] = call.partitioned;
						invocationArgs[options.callbackArg] = origCallback;
					}

					var callbackArgs;

					if (call.call.complete === true) {
						if (options.partitionedFilter) {
							callbackArgs = Array.prototype.slice.call(call.call.response.args);
							options.partitionedFilter.call(origThisPtr || this, call.call.args, invocationArgs, callbackArgs);
						}
						else {
							callbackArgs = call.call.response.args;
						}

						origCallback.apply(origThisPtr || call.call.response.thisPtr, callbackArgs);
					}
					else {
						call.call.callback.add(function() {
							if (options.partitionedFilter) {
								callbackArgs = Array.prototype.slice.call(arguments);
								options.partitionedFilter.call(origThisPtr || this, call.call.args, invocationArgs, callbackArgs);
							}
							else {
								callbackArgs = arguments;
							}
	
							origCallback.apply(origThisPtr || this, callbackArgs);
						});
					}
				});

			}
		};
	};

	Function.prototype.cached = function Function$cached(options) {
		var proceed = this;
		var cache = {};

		var keygen = (options && options.key) || function(arg) { return arg; };

		return function cached() {
			var key = keygen.apply(this, arguments);
			return cache.hasOwnProperty(key) ? cache[key] : (cache[key] = proceed.apply(this, arguments));
		};
	};

	function bind(obj) {
		var slice = [].slice,
			args = slice.call(arguments, 1),
			self = this,
			nop = function () {},
			bound = function () {
				return self.apply(this instanceof nop ? this : (obj || {}),
					args.concat(slice.call(arguments)));
			};

		nop.prototype = self.prototype;
		bound.prototype = new nop();

		return bound;
	}

	// Function.prototype.bind polyfill
	if (!Function.prototype.bind)
		Function.prototype.bind = bind;

	Function.prototype.prepare = function prepare(thisPtr, args) {
		/// <summary>
		/// Returns a function that will invoke this function with the given
		/// this value and arguments, regardless of how the returned 
		/// function is invoked.
		/// </summary>

		var func = this;
		return function prepare$fn() {
			return func.apply(thisPtr || this, args || []);
		};
	};

	Function.prototype.prependArguments = function prependArguments(/* arg1, arg2, ... */) {
		var func = this;
		var additional = Array.prototype.slice.call(arguments);
		return function prependArguments$fn() {
			var args = [];
			Array.prototype.push.apply(args, additional);
			Array.prototype.push.apply(args, Array.prototype.slice.call(arguments));
			return func.apply(this, args);
		};
	};

	Function.prototype.appendArguments = function appendArguments(/* arg1, arg2, ... */) {
		var func = this;
		var additional = Array.prototype.slice.call(arguments);
		return function appendArguments$fn() {
			var args = Array.prototype.slice.call(arguments);
			Array.prototype.push.apply(args, additional);
			return func.apply(this, args);
		};
	};

	Function.prototype.spliceArguments = function spliceArguments(/* start, howmany, item1, item2, ... */) {
		var func = this;
		var spliceArgs = arguments;
		return function spliceArguments$fn() {
			var args = Array.prototype.slice.call(arguments);
			args.splice.apply(args, spliceArgs);
			return func.apply(this, args);
		};
	};

	Function.prototype.sliceArguments = function sliceArguments(/* start, end */) {
		var func = this;
		var sliceArgs = arguments;
		return function spliceArguments$fn() {
			var args = Array.prototype.slice.call(arguments);
			args = args.slice.apply(args, sliceArgs);
			return func.apply(this, args);
		};
	};

	function mergeFunctions(fn1, fn2, options) {
		// return early if one or both functions are not defined
		if (!fn1 && !fn2) return;
		if (!fn2) return fn1;
		if (!fn1) return fn2;

		if (options && options.async === true) {
			return function () {
				var idx = options.callbackIndex || 0;
				var callback = arguments[idx];

				// Ensure that there is a callback function
				if (callback == null) throw new ArgumentNullError("callback", "'mergeFunctions' was called in async mode");
				if (typeof(callback) !== "function") throw new ArgumentTypeError("callback", "function", callback);

				var signal = new Signal("mergeFunctions");

				// replace callback function with signal pending and invoke callback when both are complete
				var args1 = Array.prototype.slice.call(arguments);
				args1.splice(idx, 1, signal.pending());
				fn1.apply(this, args1);

				var args2 = Array.prototype.slice.call(arguments);
				args2.splice(idx, 1, signal.pending());
				fn2.apply(this, args2);

				signal.waitForAll(callback, (options.thisPtrIndex && arguments[options.thisPtrIndex]) || this);
			};
		}
		else if (options && options.andResults === true) {
			return function () {
				return fn1.apply(this, arguments) && fn2.apply(this, arguments);
			};
		}
		else if (options && options.orResults === true) {
			return function () {
				return fn1.apply(this, arguments) || fn2.apply(this, arguments);
			};
		}
		else {
			return function () {
				fn1.apply(this, arguments);
				fn2.apply(this, arguments);
			};
		}
	}

	function equals(obj) {
		return function(other) {
			return obj === other;
		};
	}

	function not(fn) {
		return function() {
			return !fn.apply(this, arguments);
		};
	}

	function before(original, fn) {
		return function() {
			fn.apply(this, arguments);
			original.apply(this, arguments);
		};
	}

	function after(original, fn) {
		return function() {
			original.apply(this, arguments);
			fn.apply(this, arguments);
		};
	}

	function callArgument(arg) {
		arg.call();
	}

	var funcRegex = /function\s*([\w_\$]*)/i;
	function parseFunctionName(f) {
		var result = funcRegex.exec(f);
		return result ? (result[1] || "{anonymous}") : "{anonymous}";
	}

	// #endregion

	// #region ExoWeb.Array
	//////////////////////////////////////////////////

	function addRange(arr, items) {
		arr.push.apply(arr, items);
	}

	function contains(arr, item, from) {
		return arr.indexOf(item, from) >= 0;
	}

	function copy(arr) {
		return Array.prototype.slice.call(arr);
	}

	// Filters out duplicate items from the given array.
	/////////////////////////////////////////////////////
	function distinct(arr) {
		var result = [];

		for(var i = 0, len = arr.length; i < len; i++)
			if (result.indexOf(arr[i]) < 0)
				result.push(arr[i]);

		return result;
	}

	function every(arr, callback, thisPtr) {
		for (var i = 0, len = arr.length; i < len; i++)
			if (i in arr && !callback.call(thisPtr || this, arr[i], i, arr))
				return false;

		return true;
	}

	// Based on https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/fill#polyfill
	function fill(arr, value) {
		// Steps 1-2.
		if (arr == null) {
			throw new TypeError('Array is null or not defined');
		}

		var O = Object(arr);

		// Steps 3-5.
		var len = O.length >>> 0;

		// Steps 6-7.
		var start = arguments[2];
		var relativeStart = start >> 0;

		// Step 8.
		var k = relativeStart < 0 ?
			Math.max(len + relativeStart, 0) :
			Math.min(relativeStart, len);

		// Steps 9-10.
		var end = arguments[3];
		var relativeEnd = end === undefined ?
			len : end >> 0;

		// Step 11.
		var finalValue = relativeEnd < 0 ?
			Math.max(len + relativeEnd, 0) :
			Math.min(relativeEnd, len);

		// Step 12.
		while (k < finalValue) {
			O[k] = value;
			k++;
		}

		// Step 13.
		return O;
	}

	function filter(arr, callback, thisPtr) {
		var result = [];
		for (var i = 0, len = arr.length; i < len; i++) {
			if (i in arr) {
				var val = arr[i]; // callback may mutate original item
				if (callback.call(thisPtr || this, val, i, arr))
					result.push(val);
			}
		}

		return result;
	}

	// Based on https://vanillajstoolkit.com/polyfills/arrayfind/
	function find(arr, callback) {
		// 1. Let O be ? ToObject(this value).
		if (arr == null) {
			throw new TypeError('Array is null or not defined');
		}

		var o = Object(arr);

		// 2. Let len be ? ToLength(? Get(O, "length")).
		var len = o.length >>> 0;

		// 3. If IsCallable(callback) is false, throw a TypeError exception.
		if (typeof callback !== 'function') {
			throw new TypeError('callback must be a function');
		}

		// 4. If thisArg was supplied, let T be thisArg; else let T be undefined.
		var thisArg = arguments[2];

		// 5. Let k be 0.
		var k = 0;

		// 6. Repeat, while k < len
		while (k < len) {
			// a. Let Pk be ! ToString(k).
			// b. Let kValue be ? Get(O, Pk).
			// c. Let testResult be ToBoolean(? Call(callback, T, ï¿½ kValue, k, O ï¿½)).
			// d. If testResult is true, return kValue.
			var kValue = o[k];
			if (callback.call(thisArg, kValue, k, o)) {
				return kValue;
			}
			// e. Increase k by 1.
			k++;
		}

		// 7. Return undefined.
		return undefined;
	}

	// Based on https://vanillajstoolkit.com/polyfills/arrayfindindex/
	function findIndex(arr, predicate) {
		if (arr == null) {
			throw new TypeError('Array is null or not defined');
		}

		// 1. Let O be ? ToObject(this value).
		var o = Object(arr);

		// 2. Let len be ? ToLength(? Get(O, "length")).
		var len = o.length >>> 0;

		// 3. If IsCallable(predicate) is false, throw a TypeError exception.
		if (typeof predicate !== 'function') {
			throw new TypeError('predicate must be a function');
		}

		// 4. If thisArg was supplied, let T be thisArg; else let T be undefined.
		var thisArg = arguments[2];

		// 5. Let k be 0.
		var k = 0;

		// 6. Repeat, while k < len
		while (k < len) {
			// a. Let Pk be ! ToString(k).
			// b. Let kValue be ? Get(O, Pk).
			// c. Let testResult be ToBoolean(? Call(predicate, T, ï¿½ kValue, k, O ï¿½)).
			// d. If testResult is true, return k.
			var kValue = o[k];
			if (predicate.call(thisArg, kValue, k, o)) {
				return k;
			}
			// e. Increase k by 1.
			k++;
		}

		// 7. Return -1.
		return -1;
	}

	function first(arr, callback, thisPtr) {
		for (var i = 0, len = arr.length; i < len; i++) {
			if (i in arr) {
				var val = arr[i];
				if (!callback || callback.call(thisPtr || this, val, i, arr) === true) {
					return val;
				}
			}
		}

		return null;
	}

	// Based on https://vanillajstoolkit.com/polyfills/arrayflat/
	function flat(arr, depth) {
		// If no depth is specified, default to 1
		if (depth === undefined) {
			depth = 1;
		}

		// Recursively reduce sub-arrays to the specified depth
		var flatten = function (arr, depth) {

			// If depth is 0, return the array as-is
			if (depth < 1) {
				return arr.slice();
			}

			// Otherwise, concatenate into the parent array
			return arr.reduce(function (acc, val) {
				return acc.concat(Array.isArray(val) ? flatten(val, depth - 1) : val);
			}, []);

		};

		return flatten(arr, depth);
	}

	function flatMap(arr, callbackFn) {
		return flat(Array.prototype.map.apply(arr, Array.prototype.slice.call(arguments, 1)), 1);
	}

	function forEach(arr, callback, thisPtr) {
		for (var i = 0, len = arr.length; i < len; i++)
			if (i in arr)
				callback.call(thisPtr || this, arr[i], i, arr);
	}

	function indexOf(arr, elt, from) {
		var len = arr.length;
		from = Number(from) || 0;
		from = (from < 0) ? Math.ceil(from) : Math.floor(from);
		if (from < 0) from += len;

		for (; from < len; from++)
			if (from in arr && arr[from] === elt)
				return from;

		return -1;
	}

	function insert(arr, index, item) {
		arr.splice.call(arr, index, 0, item);
	}

	function insertRange(arr, index, items) {
		var args = items.slice();
		args.splice(0, 0, index, 0);
		arr.splice.apply(arr, args);
	}

	// Finds the set intersection of the two given arrays.  The items
	// in the resulting list are distinct and in no particular order.
	///////////////////////////////////////////////////////////////////
	function intersect(arr1, arr2) {
		return distinct(filter(arr1, function(item) {
			return arr2.indexOf(item) >= 0;
		}));
	}

	function last(arr, callback, thisPtr) {
		var result = null;

		for (var i = 0, len = arr.length; i < len; i++) {
			if (i in arr) {
				var val = arr[i];
				if (!callback || callback.call(thisPtr || this, val, i, arr) === true) {
					result = val;
				}
			}
		}

		return result;
	}

	function lastIndexOf(arr, item, from) {
		var len = arr.length;

		if (len === 0) return -1;

		var n = len;
		if (from) {
			n = Number(from);

			if (n !== n)
				n = 0;
			else if (n !== 0 && n !== (1 / 0) && n !== -(1 / 0))
				n = (n > 0 || -1) * Math.floor(Math.abs(n));
		}

		var k = n >= 0 ? Math.min(n, len - 1) : len - Math.abs(n);

		while (k >= 0)
			if (k in arr && arr[k] === item)
				return k;

		return -1;
	}

	function map(arr, callback, thisPtr) {
		var result = [];

		for (var i = 0, len = arr.length; i < len; i++)
			if (i in arr)
				result[i] = callback.call(thisPtr || this, arr[i], i, arr);

		return result;
	}

	function mapToArray(arr, callback, thisPtr) {
		var result = [];

		forEach(arr, function(item, i, a) {
			addRange(result, callback.call(thisPtr || this, item, i, a));
		});

		return result;
	}

	function observableSplice(arr, events, index, removeCount, addItems) {
		var removedItems;

		if (removeCount) {
			if (removeCount > 1 && arr.removeRange) {
				removedItems = arr.removeRange(index, removeCount);
			}
			else if (removeCount === 1 && arr.removeAt) {
				removedItems = [arr.removeAt(index)];
			}
			else {
				removedItems = arr.splice(index, removeCount);
			}
	
			if (events) {
				events.push({
					action: Sys.NotifyCollectionChangedAction.remove,
					oldStartingIndex: index,
					oldItems: removedItems,
					newStartingIndex: null,
					newItems: null
				});
			}
		}

		if (addItems.length > 0) {
			if (addItems.length > 1 && arr.insertRange) {
				arr.insertRange(index, addItems);
			}
			else if (addItems.length === 1 && arr.insert) {
				arr.insert(index, addItems[0]);
			}
			else {
				insertRange(arr, index, addItems);
			}

			if (events) {
				events.push({
					action: Sys.NotifyCollectionChangedAction.add,
					oldStartingIndex: null,
					oldItems: null,
					newStartingIndex: index,
					newItems: addItems
				});
			}
		}
	}

	function peek(arr) {
		var peekVal = arr.pop();
		arr.push(peekVal);
		return peekVal;
	}

	function purge(arr, callback, thisPtr) {
		var result = null;

		for (var i = 0; i < arr.length; i++) {
			if (callback.call(thisPtr || this, arr[i], i, arr) === true) {
				// Invoke removeAt method if it exists.
				if (arr.removeAt)
					arr.removeAt(i);
				else
					arr.splice(i, 1);

				// Lazy create result array.
				if (result === null) {
					result = [];
				}

				// Add index (accounting for previously removed
				// items that are now in the return value).
				result.push(i + result.length);

				// Decrement to account for removal.
				i--;
			}
		}

		return result;
	}

	function reduce(arr, accumlator, initialValue){
		var i = 0, len = arr.length, curr;

		if(typeof(accumlator) !== "function")
			throw new TypeError("First argument is not a function.");

		if(!len && arguments.length <= 2)
			throw new TypeError("Array length is 0 and no intial value was given.");

		if(arguments.length <= 2) {
			if (len === 0)
				throw new TypeError("Empty array and no second argument");

			curr = arr[i++]; // Increase i to start searching the secondly defined element in the array
		}
		else {
			curr = arguments[2];
		}

		for(; i < len; i++) {
			if (i in arr) {
				curr = accumlator.call(undefined, curr, arr[i], i, arr);
			}
		}

		return curr;
	}

	function remove(arr, item) {
		var idx = arr.indexOf(item);
		if (idx < 0)
			return false;

		arr.splice(idx, 1);
		return true;
	}

	function removeAt(arr, index) {
		arr.splice(index, 1);
	}

	function removeRange(arr, index, count) {
		return arr.splice(index, count);
	}

	function single(arr, callback, thisPtr) {
		var items;
		if (callback !== undefined) {
			items = filter(arr, callback, thisPtr);
		}
		else {
			items = arr;
		}

		if (items.length > 1)
			throw new Error("Expected a single item, but found " + items.length + ".");

		if (items.length === 0) {
			throw new Error("Expected a single item, but did not find a match.");
		}

		return items[0];
	}

	function some(arr, callback, thisPtr) {
		for (var i = 0, len = arr.length; i < len; i++)
			if (i in arr && callback.call(thisPtr || this, arr[i], i, arr))
				return true;

		return false;
	}

	function update(arr, target/*, trackEvents, equalityFn*/) {
		var source = arr, trackEvents = arguments[2], events = trackEvents ? [] : null, pointer = 0, srcSeek = 0, tgtSeek = 0, equalityFn = arguments[3];

		while (srcSeek < source.length) {
			if (source[srcSeek] === target[tgtSeek]) {
				if (pointer === srcSeek && pointer === tgtSeek) {
					// items match, so advance
					pointer = srcSeek = tgtSeek = pointer + 1;
				}
				else {
					// remove range from source and add range from target
					observableSplice(source, events, pointer, srcSeek - pointer, target.slice(pointer, tgtSeek));

					// reset to index follow target seek location since arrays match up to that point
					pointer = srcSeek = tgtSeek = tgtSeek + 1;
				}
			}
			else if (tgtSeek >= target.length) {
				// reached the end of the target array, so advance the src pointer and test again
				tgtSeek = pointer;
				srcSeek += 1;
			}
			else {
				// advance to the next target item to test
				tgtSeek += 1;
			}
		}

		observableSplice(source, events, pointer, srcSeek - pointer, target.slice(pointer, Math.max(tgtSeek, target.length)));

		return events;
	}

	if (!Array.prototype.addRange)
		Array.prototype.addRange = function(items) { addRange(this, items); };
	if (!Array.prototype.copy)
		Array.prototype.copy = function() { return copy(this); };
	if (!Array.prototype.clear)
		Array.prototype.clear = function () { this.length = 0; };
	if (!Array.prototype.contains)
		Array.prototype.contains = function (elt/*, from*/) { return contains(this, elt, arguments[1]); };
	if (!Array.prototype.dequeue)
		Array.prototype.dequeue = function() { return this.shift(); };
	if (!Array.prototype.distinct)
		Array.prototype.distinct = function() { return distinct(this); };
	if (!Array.prototype.every)
		Array.prototype.every = function(fun /*, thisp*/) { return every(this, fun, arguments[1]); };
	if (!Array.prototype.fill)
		Array.prototype.fill = function(value, times) { return fill(this, value, times); };
	if (!Array.prototype.filter)
		Array.prototype.filter = function(fun/*, thisp */) { return filter(this, fun, arguments[1]); };
	if (!Array.prototype.find)
		Array.prototype.find = function(callbackFn, thisArg) { return find(this, callbackFn, thisArg); };
	if (!Array.prototype.findIndex)
		Array.prototype.findIndex = function(predicate, thisArg) { return findIndex(this, predicate, thisArg); };
	if (!Array.prototype.first)
		Array.prototype.first = function(fun/*, thisp */) { return first(this, fun, arguments[1]); };
	if (!Array.prototype.flat)
		Array.prototype.flat = function(depth) { return flat(this, depth); };
	if (!Array.prototype.flatMap)
		Array.prototype.flatMap = function(callbackFn) { return flatMap(this, callbackFn); };
	if (!Array.prototype.forEach)
		Array.prototype.forEach = function(fun /*, thisp*/) { forEach(this, fun, arguments[1]); };
	if (!Array.prototype.indexOf)
		Array.prototype.indexOf = function(elt/*, from*/) { return indexOf(this, elt, arguments[1]); };
	if (!Array.prototype.intersect)
		Array.prototype.intersect = function(items) { return intersect(this, items); };
	if (!Array.prototype.last)
		Array.prototype.last = function(fun/*, thisp */) { return last(this, fun, arguments[1]); };
	if (!Array.prototype.lastIndexOf)
		Array.prototype.lastIndexOf = function (item/*, from*/) { return lastIndexOf(this, item, arguments[1]); };
	if (!Array.prototype.map)
		Array.prototype.map = function(fun /*, thisp*/) { return map(this, fun, arguments[1]); };
	if (!Array.prototype.mapToArray)
		Array.prototype.mapToArray = function(fun/*, thisp*/) { return mapToArray(this, fun, arguments[1]); };
	if (!Array.prototype.peek)
		Array.prototype.peek = function() { return peek(this); };
	if (!Array.prototype.purge)
		Array.prototype.purge = function(fun/*, thisp*/) { return purge(this, fun, arguments[1]); };
	if (!Array.prototype.reduce)
		Array.prototype.reduce = function(accumulator, intialValue) { return reduce(this, accumulator, intialValue); };
	if (!Array.prototype.remove)
		Array.prototype.remove = function(item) { return remove(this, item); };
	if (!Array.prototype.single)
		Array.prototype.single = function(fun/*, thisp */) { return single(this, fun, arguments[1]); };
	if (!Array.prototype.some)
		Array.prototype.some = function(fun /*, thisp*/) { return some(this, fun, arguments[1]); };

	// Based on https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from#polyfill
	var from = (function () {
		var symbolIterator;
		try {
			symbolIterator = Symbol.iterator
				? Symbol.iterator
				: 'Symbol(Symbol.iterator)';
		} catch (e) {
			symbolIterator = 'Symbol(Symbol.iterator)';
		}

		var toStr = Object.prototype.toString;
		var isCallable = function (fn) {
			return (
				typeof fn === 'function' ||
				toStr.call(fn) === '[object Function]'
			);
		};
		var toInteger = function (value) {
			var number = Number(value);
			if (isNaN(number)) return 0;
			if (number === 0 || !isFinite(number)) return number;
			return (number > 0 ? 1 : -1) * Math.floor(Math.abs(number));
		};
		var maxSafeInteger = Math.pow(2, 53) - 1;
		var toLength = function (value) {
			var len = toInteger(value);
			return Math.min(Math.max(len, 0), maxSafeInteger);
		};

		var setGetItemHandler = function setGetItemHandler(isIterator, items) {
			var iterator = isIterator && items[symbolIterator]();
			return function getItem(k) {
				return isIterator ? iterator.next() : items[k];
			};
		};

		var getArray = function getArray(
			T,
			A,
			len,
			getItem,
			isIterator,
			mapFn
		) {
			// 16. Let k be 0.
			var k = 0;

			// 17. Repeat, while k < lenï¿½ or while iterator is done (also steps a - h)
			while (k < len || isIterator) {
				var item = getItem(k);
				var kValue = isIterator ? item.value : item;

				if (isIterator && item.done) {
					return A;
				} else {
					if (mapFn) {
						A[k] =
							typeof T === 'undefined'
								? mapFn(kValue, k)
								: mapFn.call(T, kValue, k);
					} else {
						A[k] = kValue;
					}
				}
				k += 1;
			}

			if (isIterator) {
				throw new TypeError(
					'Array.from: provided arrayLike or iterator has length more then 2 ** 52 - 1'
				);
			} else {
				A.length = len;
			}

			return A;
		};

		// The length property of the from method is 1.
		return function from(arrayLikeOrIterator /*, mapFn, thisArg */) {
			// 1. Let C be the this value.
			var C = this;

			// 2. Let items be ToObject(arrayLikeOrIterator).
			var items = Object(arrayLikeOrIterator);
			var isIterator = isCallable(items[symbolIterator]);

			// 3. ReturnIfAbrupt(items).
			if (arrayLikeOrIterator == null && !isIterator) {
				throw new TypeError(
					'Array.from requires an array-like object or iterator - not null or undefined'
				);
			}

			// 4. If mapfn is undefined, then let mapping be false.
			var mapFn = arguments.length > 1 ? arguments[1] : void undefined;
			var T;
			if (typeof mapFn !== 'undefined') {
				// 5. else
				// 5. a If IsCallable(mapfn) is false, throw a TypeError exception.
				if (!isCallable(mapFn)) {
					throw new TypeError(
						'Array.from: when provided, the second argument must be a function'
					);
				}

				// 5. b. If thisArg was supplied, let T be thisArg; else let T be undefined.
				if (arguments.length > 2) {
					T = arguments[2];
				}
			}

			// 10. Let lenValue be Get(items, "length").
			// 11. Let len be ToLength(lenValue).
			var len = toLength(items.length);

			// 13. If IsConstructor(C) is true, then
			// 13. a. Let A be the result of calling the [[Construct]] internal method
			// of C with an argument list containing the single item len.
			// 14. a. Else, Let A be ArrayCreate(len).
			var A = isCallable(C) ? Object(new C(len)) : new Array(len);

			return getArray(
				T,
				A,
				len,
				setGetItemHandler(isIterator, items),
				isIterator,
				mapFn
			);
		};
	})();

	// Based on https://vanillajstoolkit.com/polyfills/arrayisarray/
	function isArray(value) {
		return Object.prototype.toString.call(value) === '[object Array]';
	}

	function of() {
		return Array.prototype.slice.call(arguments);
	}

	if (!Array.from)
		Array.from = from;
	if (!Array.isArray)
		Array.isArray = isArray;
	if (!Array.of)
		Array.of = of;

	// #endregion

	// #region ExoWeb.String
	//////////////////////////////////////////////////

	// Add String.trim() if not natively supported
	if (typeof String.prototype.trim !== 'function') {
		String.prototype.trim = function () {
			return this.replace(/^\s+|\s+$/g, '');
		}
	}
	function isNullOrEmpty(str) {
		return str === null || str === undefined || str === "";
	}

	// Based on https://vanillajstoolkit.com/polyfills/stringendswith/
	function endsWith(str, searchStr, position) {
		// This works much better than >= because
		// it compensates for NaN:
		if (!(position < str.length)) {
			position = str.length;
		} else {
			position |= 0; // round position
		}
		return str.substr(position - searchStr.length, searchStr.length) === searchStr;
	}

	function includes(str, search, start) {
		if (search instanceof RegExp) {
			throw TypeError('first argument must not be a RegExp');
		}
		if (start === undefined) { start = 0; }
		return str.indexOf(search, start) !== -1;
	}

	// https://gist.github.com/TheBrenny/039add509c87a3143b9c077f76aa550b
	function matchAll (str, rx) {
		if (typeof rx === "string") rx = new RegExp(rx, "g"); // coerce a string to be a global regex
		rx = new RegExp(rx); // Clone the regex so we don't update the last index on the regex they pass us
		var cap = []; // the single capture
		var all = []; // all the captures (return this)
		while ((cap = rx.exec(str)) !== null) all.push(cap); // execute and add
		return all; // profit!
	}

	// Based on https://vanillajstoolkit.com/polyfills/stringpadend/
	function padEnd(str, targetLength, padString) {
		targetLength = targetLength >> 0; //floor if number or convert non-number to 0;
		padString = String((typeof padString !== 'undefined' ? padString : ' '));
		if (str.length > targetLength) {
			return String(str);
		}
		else {
			targetLength = targetLength - str.length;
			if (targetLength > padString.length) {
				padString += repeat(padString, targetLength / padString.length); //append to original to ensure we are longer than needed
			}
			return String(str) + padString.slice(0, targetLength);
		}
	}

	// Based on https://vanillajstoolkit.com/polyfills/stringpadstart/
	function padStart(str, targetLength, padString) {
		targetLength = targetLength >> 0; //truncate if number or convert non-number to 0;
		padString = String((typeof padString !== 'undefined' ? padString : ' '));
		if (str.length > targetLength) {
			return String(str);
		}
		else {
			targetLength = targetLength - str.length;
			if (targetLength > padString.length) {
				padString += repeat(padString, targetLength / padString.length); //append to original to ensure we are longer than needed
			}
			return padString.slice(0, targetLength) + String(str);
		}
	}

	// Based on https://vanillajstoolkit.com/polyfills/stringrepeat/
	function repeat(str, count) {
		if (str == null)
			throw new TypeError('can\'t convert ' + str + ' to object');

		var result = '' + str;
		// To convert string to integer.
		count = +count;
		// Check NaN
		if (count != count)
			count = 0;

		if (count < 0)
			throw new RangeError('repeat count must be non-negative');

		if (count == Infinity)
			throw new RangeError('repeat count must be less than infinity');

		count = Math.floor(count);
		if (result.length == 0 || count == 0)
			return '';

		// Ensuring count is a 31-bit integer allows us to heavily optimize the
		// main part. But anyway, most current (August 2014) browsers can't handle
		// strings 1 << 28 chars or longer, so:
		if (result.length * count >= 1 << 28)
			throw new RangeError('repeat count must not overflow maximum string size');

		var maxCount = result.length * count;
		count = Math.floor(Math.log(count) / Math.log(2));
		while (count) {
			result += result;
			count--;
		}
		result += result.substring(0, maxCount - result.length);
		return result;
	}

	// Based on https://vanillajstoolkit.com/polyfills/stringreplaceall/
	function replaceAll(str, substr, newSubstr) {
		// If a regex pattern
		if (Object.prototype.toString.call(substr).toLowerCase() === '[object regexp]') {
			return str.replace(substr, newSubstr);
		}

		// If a string
		return str.replace(new RegExp(substr, 'g'), newSubstr);
	}

	// Based on https://vanillajstoolkit.com/polyfills/stringstartswith/
	function startsWith(str, searchString, position) {
		return str.slice(position || 0, searchString.length) === searchString;
	}

	// Based on https://vanillajstoolkit.com/polyfills/stringtrimend/
	function trimEnd(str) {
		return str.replace(new RegExp(/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/.source + '$', 'g'), '');
	}

	// Based on https://vanillajstoolkit.com/polyfills/stringtrimstart/
	function trimStart(str) {
		return str.replace(new RegExp('^' + /[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/.source, 'g'), '');
	}

	if (!String.prototype.endsWith)
		String.prototype.endsWith = function (searchStr /*, position*/) { return endsWith(this, rx, arguments[1]); };
	if (!String.prototype.includes)
		String.prototype.includes = function (search /*, start*/) { return includes(this, search, arguments[1]); };
	if (!String.prototype.matchAll)
		String.prototype.matchAll = function (regexp) { return matchAll(this, regexp); };
	if (!String.prototype.padEnd)
		String.prototype.padEnd = function (targetLength /*, padString*/) { return padEnd(this, targetLength, arguments[1]); };
	if (!String.prototype.padStart)
		String.prototype.padStart = function (targetLength /*, padString*/) { return padStart(this, targetLength, arguments[1]); };
	if (!String.prototype.repeat)
		String.prototype.repeat = function (count) { return repeat(this, count); };
	if (!String.prototype.replaceAll)
		String.prototype.replaceAll = function (substr, newSubstr) { return replaceAll(this, substr, newSubstr); };
	if (!String.prototype.startsWith)
		String.prototype.startsWith = function (searchString /*, position*/) { return startsWith(this, searchString, arguments[1]); };
	if (!String.prototype.trimEnd)
		String.prototype.trimEnd = function () { return trimEnd(this); };
	if (!String.prototype.trimStart)
		String.prototype.trimStart = function () { return trimStart(this); };

	// #endregion

	// #region ExoWeb.Cache
	//////////////////////////////////////////////////

	var cacheInited = false;

	var scriptTag = document.getElementsByTagName("script");
	var referrer = scriptTag[scriptTag.length - 1].src;

	var cacheHash;

	var match = /[?&]cachehash=([^&]*)/i.exec(referrer);
	if (match) {
		cacheHash = match[1];
	}

	ExoWeb.cacheHash = cacheHash;

	// Determine if local storage is supported, understanding 
	var useLocalStorage = false;
	try {
		var testLS = "c-localStorage";
		window.localStorage.setItem(testLS, testLS);
		window.localStorage.removeItem(testLS);
		useLocalStorage = true;
	}
	catch (e)
	{ }

	if (useLocalStorage) {

		ExoWeb.cache = function (key, value) {
			var localKey = key;

			// defer init of the cache so that the appInstanceId can be set
			if (!cacheInited) {
				cacheInited = true;

				// if there's an older version of caching, clear the entire cache (the old way)
				if (window.localStorage.getItem("cacheHash"))
					window.localStorage.clear();

				// Flush the local storage cache if the cache hash has changed
				if (cacheHash && ExoWeb.cache("cacheHash") != cacheHash) {
					ExoWeb.clearCache();
					ExoWeb.cache("cacheHash", cacheHash);
				}
			}

			// scope the cache to ExoWeb and to a particular app if there are multiple apps hosted at the same domain.
			localKey = "ExoWeb:cache:" + ExoWeb.config.appInstanceId + ":" + localKey;

			if (arguments.length == 1) {
				value = window.localStorage.getItem(localKey);
				return value ? JSON.parse(value) : null;
			}
			else if (arguments.length == 2) {
				var json = JSON.stringify(value);
				try {
					window.localStorage.setItem(localKey, json);
				}
				catch (e) {
					logWarning(e.message);
				}
				return value;
			}
		};

		ExoWeb.clearCache = function () {
			window.localStorage.clear();
		};
	}

	// Caching Not Supported
	else {
		ExoWeb.cache = function (key, value) { return null; };
		ExoWeb.clearCache = function () { };
	}

	// #endregion

	// #region ExoWeb.Activity
	//////////////////////////////////////////////////

	var activityCallbacks = [];

	function registerActivity(label, callback, thisPtr) {
		if (label == null) throw new ArgumentNullError("label");
		if (typeof (label) !== "string") throw new ArgumentTypeError("label", "string", label);
		if (callback == null) throw new ArgumentNullError("callback");
		if (typeof (callback) !== "function") throw new ArgumentTypeError("callback", "function", callback);

		var item = { label: label, callback: callback };

		if (thisPtr) {
			callback.thisPtr = thisPtr;
		}

		activityCallbacks.push(item);
	}

	ExoWeb.registerActivity = registerActivity;

	function isBusy(/* logBusyLabel */) {
		var busy = false;
		var logBusyLabel = arguments[0];

		getBusyItems(function (item) {
			busy = true;

			if (logBusyLabel) {
				console.log("Item \"" + item.label + "\" is busy.");
				return false;
			}
			else {
				return true;
			}
		});

		return busy;
	}

	ExoWeb.isBusy = isBusy;

	function getBusyItems(onBusyItemFound) {
		var busyItems = [];

		for (var i = 0, len = activityCallbacks.length; i < len; i++) {
			var item = activityCallbacks[i];

			if (item.callback.call(item.thisPtr || this) === true) {
				busyItems.push(item);

				if (onBusyItemFound && onBusyItemFound(item) === true)
					return busyItems;
			}
		}

		return busyItems;
	}

	ExoWeb.getBusyItems = getBusyItems;

	// #endregion

	// #region ExoWeb.Batch
	//////////////////////////////////////////////////

	var batchIndex = 0;
	var allBatches = [];
	var currentBatch = null;

	function Batch(label) {
		this._index = batchIndex++;
		this._labels = [label];
		this._rootLabel = label;
		this._subscribers = [];

		allBatches.push(this);
	}

	registerActivity("Batch", function() {
		return Batch.all().length > 0;
	});

	Batch.all = function Batch_$all(includeEnded) {
		return allBatches.filter(function(e) {
			return includeEnded || !e.isEnded();
		});
	};

	Batch.current = function Batch_$current() {
		return currentBatch;
	};

	Batch.suspendCurrent = function Batch_$suspendCurrent(message) {
		if (currentBatch !== null) {
			var batch = currentBatch;
			currentBatch = null;
			return batch;
		}
	};

	Batch.start = function Batch_$start(label) {
		if (currentBatch) {
			currentBatch._begin(label);
		}
		else {
			currentBatch = new Batch(label);
		}

		return currentBatch;
	};

	Batch.resume = function Batch_$resume(batch) {
		if (batch) {
			(batch._transferredTo || batch)._resume();
		}
	};

	Batch.end = function Batch_$end(batch) {
		(batch._transferredTo || batch)._end();
	};

	Batch.whenDone = function Batch_$whenDone(fn, thisPtr) {
		if (currentBatch) {
			currentBatch.whenDone(fn, thisPtr);
		}
		else {
			fn.call(thisPtr || this);
		}
	};

	Batch.current = function Batch_$current() {
		return currentBatch;
	};

	Batch.mixin({
		_begin: function Batch$_begin(label) {
			this._labels.push(label);

			return this;
		},
		_end: function Batch$_end() {
			// Cannot end a batch that has already been ended.
			if (this.isEnded()) {
				return this;
			}

			// Remove the last label from the list.
			var label = this._labels.pop();

			if (this.isEnded()) {
				// If we are ending the current batch, then null out the current batch 
				// variable so that new batches can be created with a new root label.
				if (currentBatch === this) {
					currentBatch = null;
				}

				// Invoke the subscribers.
				var subscriber = this._subscribers.dequeue();
				while (subscriber) {
					subscriber.fn.apply(subscriber.thisPtr || this, arguments);
					subscriber = this._subscribers.dequeue();
				}
			}

			return this;
		},
		_transferTo: function Batch$_transferTo(otherBatch) {
			// Transfers this batch's labels and subscribers to the
			// given batch.  From this point forward this batch defers
			// its behavior to the given batch.

			// Transfer labels from one batch to another.
			otherBatch._labels.addRange(this._labels);
			this._labels.clear();
			otherBatch._subscribers.addRange(this._subscribers);
			this._subscribers.clear();
			this._transferredTo = otherBatch;
		},
		_resume: function Batch$_resume() {
			// Ignore resume on a batch that has already been ended.
			if (this.isEnded()) {
				return;
			}

			if (currentBatch !== null) {
				// If there is a current batch then simple transfer the labels to it.
				this._transferTo(currentBatch);
				return currentBatch;
			}

			currentBatch = this;

			return this;
		},
		isEnded: function Batch$isEnded() {
			return this._labels.length === 0;
		},
		whenDone: function Batch$whenDone(fn, thisPtr) {
			this._subscribers.push({ fn: fn, thisPtr: thisPtr });

			return this;
		}
	});

	ExoWeb.Batch = Batch;

	// #endregion

	// #region ExoWeb.Signal
	//////////////////////////////////////////////////

	var pendingSignalTimeouts = null;

	function Signal(debugLabel) {
		this._waitForAll = [];
		this._pending = 0;
		this._debugLabel = debugLabel;
	}

	var setupCallbacks = function setupCallbacks() {
		window.setTimeout(function () {
			var callbacks, maxBatch = isNumber(config.signalMaxBatchSize) ? config.signalMaxBatchSize : null;
			if (maxBatch && pendingSignalTimeouts.length > maxBatch) {
				// Exceeds max batch size, so only invoke the max number and delay the rest
				callbacks = pendingSignalTimeouts.splice(0, maxBatch);
				setupCallbacks();
			}
			else {
				// No max batch, or does not exceed size, so call all pending callbacks
				callbacks = pendingSignalTimeouts;
				pendingSignalTimeouts = null;
			}
			// Call each callback in order
			callbacks.forEach(callArgument);
		}, 1);
	};

	function doCallback(name, thisPtr, callback, args, executeImmediately) {
		if (executeImmediately === false || (config.signalTimeout === true && executeImmediately !== true)) {
			var batch = Batch.suspendCurrent("_doCallback");

			// manage a queue of callbacks to ensure the order of execution

			var setup = false;
			if (pendingSignalTimeouts === null) {
				pendingSignalTimeouts = [];
				setup = true;
			}

			pendingSignalTimeouts.push(function() {
				Batch.resume(batch);
				callback.apply(thisPtr, args || []);
			});

			if (setup) {
				setupCallbacks();
			}
		}
		else {
			callback.apply(thisPtr, args || []);
		}
	}

	Signal.mixin({
		pending: function Signal$pending(callback, thisPtr, executeImmediately) {
			if (this._pending === 0) {
				Signal.allPending.push(this);
			}

			this._pending++;
			return this._genCallback(callback, thisPtr, executeImmediately);
		},
		orPending: function Signal$orPending(callback, thisPtr, executeImmediately) {
			return this._genCallback(callback, thisPtr, executeImmediately);
		},
		_doCallback: function Signal$_doCallback(name, thisPtr, callback, args, executeImmediately) {
			doCallback.apply(this, arguments);
		},
		_genCallback: function Signal$_genCallback(callback, thisPtr, executeImmediately) {
			var signal = this, called = false;
			return function Signal$_genCallback$result() {
				signal._doCallback("pending", thisPtr || this, function Signal$_genCallback$fn() {

					// Throw an error if the signal callback has already been called
					if (called) throw new Error("(" + signal._debugLabel + ") signal callback was called more than once.");

					// Record the fact that the callback has already been called in case it is called again
					called = true;

					// Invoke the callback if it exists
					if (callback) callback.apply(this, arguments);

					// Signal that the callback is complete
					signal.oneDone();

				}, arguments, executeImmediately);
			};
		},
		waitForAll: function Signal$waitForAll(callback, thisPtr, executeImmediately) {
			if (!callback) {
				return;
			}

			if (this._pending === 0) {
				this._doCallback("waitForAll", thisPtr, callback, [], executeImmediately);
			}
			else {
				this._waitForAll.push({ "callback": callback, "thisPtr": thisPtr, "executeImmediately": executeImmediately });
			}
		},
		oneDone: function Signal$oneDone() {
			--this._pending;

			if (this._pending === 0) {
				Signal.allPending.remove(this);
			}

			while (this._pending === 0 && this._waitForAll.length > 0) {
				var item = this._waitForAll.dequeue();
				this._doCallback("waitForAll", item.thisPtr, item.callback, [], item.executeImmediately);
			}
		},
		isActive: function Signal$isActive() {
			return this._pending > 0;
		}
	});

	Signal.allPending = [];

	Signal.begin = function (debugLabel) {
		return new Signal(debugLabel);
	};

	ExoWeb.Signal = Signal;

	// #endregion

	// #region ExoWeb.Functor
	//////////////////////////////////////////////////

	function Functor() {
		var funcs = [];

		var f = function Functor$fn() {
			for (var i = 0; i < funcs.length; ++i) {
				var item = funcs[i];

				// Don't re-run one-time subscriptions that have already been applied.
				if (item.applied === true) {
					continue;
				}

				// Ensure that there is either no filter or the filter passes.
				if (!item.filter || item.filter.apply(this, arguments) === true) {
					// If handler is set to execute once,
					// remove the handler before calling.
					if (item.once === true) {
						// Mark as applied but leave item in array to avoid potential
						// problems due to re-entry into event invalidating iteration
						// index. In some cases re-entry would be a red-flag, but for
						// "global" events, where the context of the event is derived
						// from the arguments, the event could easily be re-entered
						// in a different context with different arguments.
						item.applied = true;
					}

					// Call the handler function.
					item.fn.apply(this, arguments);
				}
			}
		};

		f._funcs = funcs;
		f.add = Functor$add;
		f.remove = Functor$remove;
		f.isEmpty = Functor$isEmpty;
		f.clear = Functor$clear;

		return f;
	}

	function Functor$add(fn, filter, once) {
		var item = { fn: fn };

		if (filter !== undefined) {
			item.filter = filter;
		}

		if (once !== undefined) {
			item.once = once;
		}

		this._funcs.push(item);

		return fn;
	}

	function Functor$remove(old) {
		for (var i = this._funcs.length - 1; i >= 0; --i) {
			if (this._funcs[i].fn === old) {
				this._funcs.splice(i, 1);
				return true;
			}
		}

		return false;
	}

	function Functor$clear() {
		this._funcs.length = 0;
	}

	function Functor$isEmpty(args) {
		return !this._funcs.some(function (item) { return item.applied !== true && (!args || !item.filter || item.filter.apply(this, args)); }, this);
	}

	var functorEventsInProgress = 0;

	// busy if there are any events in progress
	registerActivity("Functor", function() {
		return functorEventsInProgress > 0;
	});

	Functor.eventing = {
		_addEvent: function Functor$_addEvent(name, func, filter, once) {
			if (!this["_" + name]) {
				this["_" + name] = new Functor();
			}

			this["_" + name].add(func, filter, once);

			return func;
		},
		_removeEvent: function Functor$_removeEvent(name, func) {
			var handler = this["_" + name];
			if (handler) {
				handler.remove(func);
				return true;
			}

			return false;
		},
		_raiseEvent: function Functor$_raiseEvent(name, argsArray) {
			var handler = this["_" + name];
			if (handler) {
				try {
					functorEventsInProgress++;
					handler.apply(this, argsArray || []);
				}
				finally {
					functorEventsInProgress--;
				}
			}
		},
		_clearEvent: function Functor$_clearEvent(name) {
			var evtName = "_" + name;
			if (this.hasOwnProperty(evtName)) {
				this[evtName] = null;
			}
		},
		_getEventHandler: function Functor$_getEventHandler(name) {
			return this["_" + name];
		}
	};

	ExoWeb.Functor = Functor;

	// #endregion

	// #region ExoWeb.FunctionChain
	//////////////////////////////////////////////////

	function FunctionChain(steps, thisPtr) {
		if (!(steps instanceof Array)) {
			throw new ArgumentTypeError("steps", "array", steps);
		}

		this._steps = steps;
		this._thisPtr = thisPtr;
	}

	FunctionChain.prepare = function FunctionChain$_invoke() {
		// Return a function that can be invoked with callback and thisPtr.
		// Useful for assigning to a prototype member, since "this" is used
		// as the thisPtr for the chain if "thisPtr" argument is not supplied,
		// while "thisPtr" of invocation is used as the argument to "invoke".

		var steps,
			thisPtrOuter = null;

		// no args => empty chain
		if (arguments.length === 0) {
			steps = [];
		} else if (arguments.length === 1 && arguments[0] instanceof Array) {
			// One array arg => array of steps
			steps = arguments[0];
		} else if (arguments.length === 2 && arguments[0] instanceof Array) {
			// Two args (first array) => array of steps and this pointer
			steps = arguments[0];
			thisPtrOuter = arguments[1];
		} else {
			// Otherwise, assume arguments correspond to steps
			steps = Array.prototype.slice.call(arguments);
		}

		return function(callback, thisPtr) {
			var chain = new FunctionChain(steps, thisPtrOuter || this);
			chain.invoke(callback, thisPtr);
		};
	};

	FunctionChain.forEachAsync = function (items, stepFunction, callback) {
		if (items.length === 0) {
			if (callback) {
				callback();
			}
			return;
		}

		var chain = new FunctionChain(items.map(function (item) {
			return function (cb, thisPtr) {
				stepFunction.call(thisPtr || this, item, cb, thisPtr || this);
			};
		}));
		chain.invoke(callback);
	};

	function doStep(idx, callback, thisPtr) {
		var outerCallback = callback;
		var outerThisPtr = thisPtr;
		var nextStep = idx + 1 < this._steps.length ?
			doStep.prependArguments(idx + 1, outerCallback, outerThisPtr).bind(this) :
			function() {
				if (outerCallback && outerCallback instanceof Function) {
					outerCallback.apply(outerThisPtr || this, arguments);
				}
			};

		this._steps[idx].call(this._thisPtr || this, nextStep);
	}

	FunctionChain.mixin({
		invoke: function(callback, thisPtr) {
			doStep.call(this, 0, callback, thisPtr);
		}
	});

	ExoWeb.FunctionChain = FunctionChain;

	// #endregion

	// #region ExoWeb.EventScope
	//////////////////////////////////////////////////

	var currentEventScope = null;

	function EventScope() {
		// If there is a current event scope
		// then it will be the parent of the new event scope
		var parent = currentEventScope;

		// Define the parent property
		Object.defineProperty(this, "parent", { value: parent });

		// Define the isActive property
		this.isActive = true;

		// Set this to be the current event scope
		currentEventScope = this;
	}

	EventScope.mixin(Functor.eventing);

	EventScope.mixin({
		abort: function () {
			if (!this.isActive) {
				throw new Error("The event scope cannot be aborted because it is not active.");
			}

			try {
				var abortHandler = this._getEventHandler("abort");
				if (abortHandler && !abortHandler.isEmpty()) {
					// Invoke all subscribers
					abortHandler();
				}

				// Clear the events to ensure that they aren't
				// inadvertantly raised again through this scope
				this._clearEvent("abort");
				this._clearEvent("exit");
			}
			finally {
				// The event scope is no longer active
				this.isActive = false;

				if (currentEventScope && currentEventScope === this) {
					// Roll back to the closest active scope
					while (currentEventScope && !currentEventScope.isActive) {
						currentEventScope = currentEventScope.parent;
					}
				}
			}
		},
		exit: function() {
			if (!this.isActive) {
				throw new Error("The event scope cannot be exited because it is not active.");
			}

			try {
				var exitHandler = this._getEventHandler("exit");
				if (exitHandler && !exitHandler.isEmpty()) {

					// If there is no parent scope, then go ahead and execute the 'exit' event
					if (this.parent === null || !this.parent.isActive) {

						// Record the initial version and initial number of subscribers
						this._exitEventVersion = 0;
						this._exitEventHandlerCount = exitHandler._funcs.length;

						// Invoke all subscribers
						exitHandler();

						// Delete the fields to indicate that raising the exit event suceeded
						delete this._exitEventHandlerCount;
						delete this._exitEventVersion;

					}
					else {
						if (typeof window.ExoWeb.config.nonExitingScopeNestingCount === "number") {
							var maxNesting = window.ExoWeb.config.nonExitingScopeNestingCount - 1;
							if (this.parent.hasOwnProperty("_exitEventVersion") && this.parent._exitEventVersion >= maxNesting) {
								this.abort();
								logWarning("Event scope 'exit' subscribers were discarded due to non-exiting.");
								return;
							}
						}

						// Move subscribers to the parent scope
						this.parent._addEvent("exit", exitHandler);

						if (this.parent.hasOwnProperty("_exitEventVersion")) {
							this.parent._exitEventVersion++;
						}
					}

					// Clear the events to ensure that they aren't
					// inadvertantly raised again through this scope
					this._clearEvent("exit");
					this._clearEvent("abort");
				}
			}
			finally {
				// The event scope is no longer active
				this.isActive = false;

				if (currentEventScope && currentEventScope === this) {
					// Roll back to the closest active scope
					while (currentEventScope && !currentEventScope.isActive) {
						currentEventScope = currentEventScope.parent;
					}
				}
			}
		}
	});

	function EventScope$onExit(callback, thisPtr) {
		if (currentEventScope === null) {
			// Immediately invoke the callback
			if (thisPtr) {
				callback.call(thisPtr);
			}
			else {
				callback();
			}
		}
		else if (!currentEventScope.isActive) {
			throw new Error("The current event scope cannot be inactive.");
		}
		else {
			// Subscribe to the exit event
			currentEventScope._addEvent("exit", callback.bind(thisPtr));
		}
	}

	function EventScope$onAbort(callback, thisPtr) {
		if (currentEventScope !== null) {
			if (!currentEventScope.isActive) {
				throw new Error("The current event scope cannot be inactive.");
			}

			// Subscribe to the abort event
			currentEventScope._addEvent("abort", callback.bind(thisPtr));
		}
	}

	function EventScope$perform(callback, thisPtr) {
		// Create an event scope
		var scope = new EventScope();
		try {
			// Invoke the callback
			if (thisPtr) {
				callback.call(thisPtr);
			}
			else {
				callback();
			}
		}
		finally {
			// Exit the event scope
			scope.exit();
		}
	}

	// Export public functions
	var eventScopeApi = {
		onExit: EventScope$onExit,
		onAbort: EventScope$onAbort,
		perform: EventScope$perform
	};

	ExoWeb.EventScope = eventScopeApi;

	// #endregion

	// #region ExoWeb.EvalWrapper
	//////////////////////////////////////////////////

	// Helper class for interpreting expressions
	function EvalWrapper(value) {
		this.value = value;
	}

	EvalWrapper.mixin({
		get: function EvalWrapper$get(member) {
			var propValue = getValue(this.value, member);

			if (propValue === undefined) {
				propValue = window[member];
			}

			if (propValue === undefined) {
				throw new TypeError(member + " is undefined");
			}

			return new EvalWrapper(propValue);
		}
	});

	ExoWeb.EvalWrapper = EvalWrapper;

	// #endregion

	// #region ExoWeb.Transform
	//////////////////////////////////////////////////

	function Transform(array, forLive) {
		if (array == null) throw new ArgumentNullError("array", "transform input is required");
		if (!(array instanceof Array)) throw new ArgumentTypeError("array", "array", array);

		this._array = array;
		this.rootInput = array;
		if (forLive === true) {
			this._livePending = true;
			this._liveComplete = false;
		}
	}

	function TransformGroup(group, items) {
		this.group = group;
		this.items = items;
	}

	var compileFilterFunction = (function Transform$compileFilterFunction(filter) {
		var parser = /(([a-z_$][0-9a-z_$]*)([.]?))|(('([^']|\')*')|("([^"]|\")*"))/gi;
		var skipWords = ["true", "false", "$index", "null"];

		filter = filter.replace(parser, function (match, ignored, name, more, strLiteral) {
			if ((strLiteral !== undefined && strLiteral !== null && strLiteral.length > 0) || skipWords.indexOf(name) >= 0) {
				return match;
			}

			if (name === "$item") {
				return more ? "" : name;
			}

			if (more.length > 0) {
				return "get('" + name + "')" + more;
			}

			return "get('" + name + "').value";
		});

		return new Function("$item", "$index", "with(new ExoWeb.EvalWrapper($item)){ return (" + filter + ");}");
	}).cached();

	var compileSelectFunction = (function Transform$compileSelectFunction(selector) {
		return new Function("$item", "$index", "return ExoWeb.evalPath($item, '" + selector + "');");
	}).cached();

	var compileSelectManyFunction = (function Transform$compileSelectManyFunction(selector) {
		return new Function("$item", "$index", "return ExoWeb.evalPath($item, '" + selector + "');");
	}).cached();

	var compileGroupsFunction = (function Transform$compileGroupsFunction(groups) {
		return new Function("$item", "$index", "return ExoWeb.evalPath($item, '" + groups + "');");
	}).cached();

	var compileOrderingFunction = (function Transform$compileOrderingFunction(ordering) {
		var orderings = [];
		var parser = /\s*([a-z0-9_.]+)(\s+null)?(\s+(asc|desc))?(\s+null)? *(,|$)/gi;

		ordering.replace(parser, function (match, path, nullsFirst, ws, dir, nullsLast) {
			var isNullsFirst = (nullsFirst !== undefined && nullsFirst !== null && nullsFirst.length > 0);
			var isNullsLast = (nullsLast !== undefined && nullsLast !== null && nullsLast.length > 0);
			orderings.push({
				path: path,
				ab: dir === "desc" ? 1 : -1,
				nulls: isNullsLast || (!ws && isNullsFirst) ? 1 : -1
			});
		});

		function before(a, b) {
			if (a !== null && a !== undefined && a.constructor === String && b !== null && b !== undefined && b.constructor === String) {
				a = a.toLowerCase();
				b = b.toLowerCase();
			}
			return a < b;
		}

		return function compare(aObj, bObj) {
			for (var i = 0; i < orderings.length; ++i) {
				var order = orderings[i];

				var a = evalPath(aObj, order.path, null, null);
				var b = evalPath(bObj, order.path, null, null);

				if (a === null && b !== null) {
					return order.nulls;
				}
				if (a !== null && b === null) {
					return -order.nulls;
				}
				if (before(a, b)) {
					return order.ab;
				}
				if (before(b, a)) {
					return -order.ab;
				}
			}

			return 0;
		};
	}).cached();

	var transforms = {
		where: function where(input, filter, thisPtr) {
			var filterFn = filter instanceof Function ? filter : compileFilterFunction(filter);
			return input.filter(filterFn, thisPtr);
		},
		select: function select(input, selector, thisPtr) {
			var mapFn = selector instanceof Function ? selector : compileSelectFunction(selector);
			return input.map(mapFn, thisPtr);
		},
		selectMany: function select(input, selector, thisPtr) {
			var mapFn = selector instanceof Function ? selector : compileSelectFunction(selector);
			return input.mapToArray(mapFn, thisPtr);
		},
		groupBy: function groupBy(input, groups, thisPtr) {
			var groupFn = groups instanceof Function ? groups : compileGroupsFunction(groups);

			var result = [];
			var len = input.length;
			for (var i = 0; i < len; i++) {
				var item = input[i];
				var groupKey = groupFn.apply(thisPtr || item, [item, i]);

				var group = null;
				for (var g = 0; g < result.length; ++g) {
					if (result[g].group == groupKey) {
						group = result[g];
						group.items.push(item);
						break;
					}
				}

				if (!group) {
					result.push(new TransformGroup(groupKey, [item]));
				}
			}

			return result;
		},
		orderBy: function orderBy(input, ordering, thisPtr) {
			var sortFn = ordering instanceof Function ? ordering : compileOrderingFunction(ordering);
			return input.copy().sort(thisPtr ? sortFn.bind(thisPtr) : sortFn);
		}
	};

	function copyTransform(steps, array, live) {
		var result = $transform(array, live);
		steps.forEach(function (step) {
			result = result[step._transform.method].call(result, step._transform.arg, step._transform.thisPtr)
		});
		return result;
	}

	function makeTransform(array, priorTransform, method, arg, thisPtr) {
		// Make sure that the same transform is not made live more than once since this can cause collisions.
		if (priorTransform._liveComplete === true) {
			throw new Error("Cannot call live on the same transform multiple times.");
		}

		var result;

		// When creating a live transform, the result cannot be used directly as an array to
		// discourage using part of the result when the intention is to eventually call "live".
		// When live mode is not used, then if live is eventually called it will result in a non-optimal
		// copying of the transform.
		if (priorTransform._livePending === true) {
			result = new Transform(array, true);
		}
		else {
			Function.mixin(Transform.prototype, array);
			result = array;
		}

		result._prior = priorTransform;
		result.rootInput = priorTransform.rootInput;
		result._transform = { method: method, arg: arg, thisPtr: thisPtr };
		return result;
	}

	Transform.mixin({
		input: function Transform$input() {
			return this._array || this;
		},
		where: function Transform$where(filter, thisPtr) {
			var output = transforms.where(this.input(), filter, thisPtr);
			return makeTransform(output, this, "where", filter, thisPtr);
		},
		select: function Transform$select(selector, thisPtr) {
			var output = transforms.select(this.input(), selector, thisPtr);
			return makeTransform(output, this, "select", selector, thisPtr);
		},
		selectMany: function Transform$selectMany(selector, thisPtr) {
			var output = transforms.selectMany(this.input(), selector, thisPtr);
			return makeTransform(output, this, "selectMany", selector, thisPtr);
		},
		groupBy: function Transform$groupBy(groups, thisPtr) {
			var output = transforms.groupBy(this.input(), groups, thisPtr);
			if (this._livePending) {
				// make the items array observable if the transform is in live mode
				output.forEach(function (group) {
					ExoWeb.Observer.makeObservable(group.items);
				});
			}
			return makeTransform(output, this, "groupBy", groups, thisPtr);
		},
		orderBy: function Transform$orderBy(ordering, thisPtr) {
			var output = transforms.orderBy(this.input(), ordering, thisPtr);
			return makeTransform(output, this, "orderBy", ordering, thisPtr);
		},
		live: function Transform$live() {
			// Watches for changes on the root input into the transform
			// and raises observable change events on this item as the 
			// results change.

			var transform, steps = [], rootStep;

			// determine the set of transform steps and the level of nested grouping
			for (var step = this; step; step = step._prior) {
				if (step._prior) {
					steps.splice(0, 0, step);
				}
				else {
					rootStep = step;
				}
			}

			// copy and return a live-mode transform if live mode was not used originally
			if (this._livePending !== true) {
				return copyTransform(steps, rootStep.input(), true).live();
			}

			// make a copy of the final transformed data and make it observable
			var output = this.input().copy();
			ExoWeb.Observer.makeObservable(output);
			output.rootInput = this.rootInput;

			// watch for changes to root input and update the transform steps as needed
			ExoWeb.Observer.addCollectionChanged(rootStep.input(), function Transform$live$collectionChanged(sender, args) {
				var changes, stepInput, stepResult, modifiedItemsArrays = [];

				//Sys.NotifyCollectionChangedAction.add;

				// copy the set of changes since they will be manipulated
				changes = args.get_changes().map(function (c) {
					return {
						action: c.action,
						oldItems: c.oldItems ? c.oldItems.copy() : null,
						oldStartingIndex: c.oldStartingIndex,
						newItems: c.newItems ? c.newItems.copy() : null,
						newStartingIndex: c.newStartingIndex
					};
				});

				// make a copied version of the input so that it can be manipulated without affecting the result
				stepInput = rootStep.input().copy();

				// re-run the transform on the newly changed input
				steps.forEach(function (step) {
					// store a reference to the output of this step
					stepResult = step.input();

					if (step._transform.method === "where") {
						changes.purge(function (change) {
							if (change.oldItems) {
								var oldItems = change.oldItems;
								// determine which removed items made it through the filter
								change.oldItems = transforms[step._transform.method](change.oldItems, step._transform.arg, step._transform.thisPtr);
								if (change.oldItems.length === 0) {
									// none of the removed items make it through the filter, so discard
									change.oldItems = null;
									change.oldStartingIndex = null;
									return true;
								}
								else {
									// find the actual index of the first removed item in the resulting array
									change.oldStartingIndex = stepResult.indexOf(change.oldItems[0]);

									// remove the filtered items from the result array
									stepResult.splice(change.oldStartingIndex, change.oldItems.length);
								}
							}
							else if (change.newItems) {
								var newItems = change.newItems;
								// determine which added items will make it through the filter
								change.newItems = transforms[step._transform.method](change.newItems, step._transform.arg, step._transform.thisPtr);
								if (change.newItems.length === 0) {
									// none of the new items will make it through the filter, so discard
									change.newItems = null;
									change.newStartingIndex = null;
									return true;
								}
								else {
									// if not added to the beginning or end of the list, determine
									// the real starting index by finding the index of the previous item
									if (change.newStartingIndex !== 0 && (change.newStartingIndex + change.newItems.length) !== stepInput.length) {
										var found = false;
										for (var idx = change.newStartingIndex - 1; !found && idx >= 0; idx--) {
											if (stepResult.indexOf(stepInput[idx]) >= 0) {
												found = true;
											}
										}
										change.newStartingIndex = idx + 1;
									}

									// splice the filtered items into the result array
									var spliceArgs = change.newItems.copy();
									spliceArgs.splice(0, 0, change.newStartingIndex, 0);
									Array.prototype.splice.apply(stepResult, spliceArgs);
								}
							}
							else {
								return true;
							}
						});
					}
					else if (step._transform.method === "select") {
						changes.forEach(function (change) {
							if (change.oldItems) {
								change.oldItems = stepResult.splice(change.oldStartingIndex, change.oldItems.length);
							}
							else if (change.newItems) {
								var mapFn = step._transform.arg instanceof Function ? step._transform.arg : compileSelectFunction(step._transform.arg);
								change.newItems = change.newItems.map(function (item) {
									return mapFn.call(step._transform.thisPtr || item, item);
								});

								// splice the filtered items into the result array
								var spliceArgs = change.newItems.copy();
								spliceArgs.splice(0, 0, change.newStartingIndex, 0);
								Array.prototype.splice.apply(stepResult, spliceArgs);
							}
						});
					}
					else if (step._transform.method === "selectMany") {
						changes.forEach(function (change) {
							if (change.oldItems) {
								var mapFn = step._transform.arg instanceof Function ? step._transform.arg : compileSelectManyFunction(step._transform.arg);
								var oldItemsMany = change.oldItems.mapToArray(function (item) {
									return mapFn.call(step._transform.thisPtr || item, item);
								});
								var oldPreceeding = stepInput.slice(0, change.oldStartingIndex);
								var oldPreceedingMany = oldPreceeding.mapToArray(function (item) {
									return mapFn.call(step._transform.thisPtr || item, item);
								});
								change.oldItems = stepResult.splice(oldPreceedingMany.length, oldItemsMany.length);
								change.oldStartingIndex = oldPreceedingMany.length;
							}
							else if (change.newItems) {
								var mapFn = step._transform.arg instanceof Function ? step._transform.arg : compileSelectManyFunction(step._transform.arg);
								change.newItems = change.newItems.mapToArray(function (item) {
									return mapFn.call(step._transform.thisPtr || item, item);
								});

								// splice the filtered items into the result array
								var spliceArgs = change.newItems.copy();
								spliceArgs.splice(0, 0, change.newStartingIndex, 0);
								Array.prototype.splice.apply(stepResult, spliceArgs);
							}
						});
					}
					else if (step._transform.method === "groupBy") {
						var groupFn = step._transform.arg instanceof Function ? step._transform.arg : compileGroupsFunction(step._transform.arg);
						var copyOfResults = stepResult.copy();
						changes.forEach(function (change) {
							if (change.oldItems) {
								change.oldItems.forEach(function (item) {
									var groupKey = groupFn.call(step._transform.thisPtr || item, item);
									var group = copyOfResults.filter(function (g) { return g.group === groupKey; })[0];
									// begin and end update on items array
									if (modifiedItemsArrays.indexOf(group.items) < 0) {
										group.items.beginUpdate();
										modifiedItemsArrays.push(group.items);
									}
									// remove the item
									var idx = group.items.indexOf(item);
									group.items.remove(item);
									if (idx === 0) {
										var groupIndex = copyOfResults.indexOf(group),
											sourceIndex = stepInput.indexOf(group.items[0]),
											targetIndex = null;
										for (i = 0; i < copyOfResults.length; i++) {
											if (sourceIndex > stepInput.indexOf(copyOfResults[i].items[0])) {
												targetIndex = i + 1;
												break;
											}
										}
										if (targetIndex !== null) {
											copyOfResults.splice(groupIndex, 1);
											copyOfResults.splice(targetIndex, 0, group);
										}
									}
									if (group.items.length === 0) {
										// remove the group from the copy of the array
										copyOfResults.splice(copyOfResults.indexOf(group), 1);
									}
								});
							}
							else if (change.newItems) {
								change.newItems.forEach(function (item) {
									var groupKey = groupFn.call(step._transform.thisPtr || item, item),
										group = copyOfResults.filter(function (g) { return g.group === groupKey; })[0],
										sourceIndex,
										targetIndex,
										resequenceGroup = false,
										groupIndex,
										i;

									if (group) {
										// begin and end update on items array
										if (modifiedItemsArrays.indexOf(group.items) < 0) {
											group.items.beginUpdate();
											modifiedItemsArrays.push(group.items);
										}
										sourceIndex = stepInput.indexOf(item), targetIndex = null;
										for (i = 0; i < group.items.length; i++) {
											if (sourceIndex < stepInput.indexOf(group.items[i])) {
												targetIndex = i;
												break;
											}
										}
										if (targetIndex !== null) {
											group.items.insert(targetIndex, item);
											// group's index may have changed as a result
											if (targetIndex === 0) {
												resequenceGroup = true;
											}
										}
										else {
											group.items.add(item);
										}
									}
									else {
										group = new TransformGroup(groupKey, [item]);
										ExoWeb.Observer.makeObservable(group.items);
										copyOfResults.push(group);
										resequenceGroup = true;
									}

									if (resequenceGroup === true) {
										groupIndex = copyOfResults.indexOf(group);
										sourceIndex = stepInput.indexOf(group.items[0]);
										targetIndex = null;
										for (i = 0; i < groupIndex; i++) {
											if (sourceIndex < stepInput.indexOf(copyOfResults[i].items[0])) {
												targetIndex = i;
												break;
											}
										}
										if (targetIndex !== null) {
											copyOfResults.splice(groupIndex, 1);
											copyOfResults.splice(targetIndex, 0, group);
										}
									}
								});
							}
						});

						// collect new changes to groups
						changes = update(stepResult, copyOfResults, true);
					}
					else if (step._transform.method === "orderBy") {
						// sort the input and update the step result to match
						var sorted = transforms[step._transform.method](stepInput, step._transform.arg, step._transform.thisPtr);
						changes = update(stepResult, sorted, true);
					}

					// move the input forward to the result of the current step
					stepInput = stepResult;
				});

				// apply changes to the ouput array
				output.beginUpdate();
				changes.forEach(function (change) {
					if (change.oldItems) {
						output.removeRange(change.oldStartingIndex, change.oldItems.length);
					}
					else if (change.newItems) {
						output.insertRange(change.newStartingIndex, change.newItems);
					}
				});
				output.endUpdate();

				// release changes to items arrays of groups, changes to the array occur first to allow
				// for changes to groups' items to be ignored if the group is no longer a part of the output
				modifiedItemsArrays.forEach(function (items) {
					items.endUpdate();
				});
			});

			// mark the transform steps as live complete
			rootStep._liveComplete = true;
			steps.forEach(function (step) {
				step._liveComplete = true;
			});

			return output;
		}
	});

	ExoWeb.Transform = Transform;
	window.$transform = function transform(array, forLive) { return new Transform(array, forLive); };

	// #endregion

	// #region ExoWeb.Translator
	//////////////////////////////////////////////////

	function Translator() {
		this._forwardDictionary = {};
		this._reverseDictionary = {};
	}

	Translator.prototype = {
		lookup: function Translator$lookup(source, category, key) {
			if (source[category]) {
				return source[category][key] || null;
			}
		},
		forward: function Translator$forward(category, key) {
			return this.lookup(this._forwardDictionary, category, key);
		},
		reverse: function Translator$reverse(category, key) {
			return this.lookup(this._reverseDictionary, category, key);
		},
		add: function Translator$addMapping(category, key, value/*, suppressReverse*/) {
			// look for optional suppress reverse lookup argument
			var suppressReverse = (arguments.length == 4 && arguments[3].constructor === Boolean) ? arguments[3] : false;

			// lazy initialize the forward dictionary for the category
			if (!this._forwardDictionary[category]) {
				this._forwardDictionary[category] = {};
			}
			this._forwardDictionary[category][key] = value;

			// don't add to the reverse dictionary if the suppress flag is specified
			if (!suppressReverse) {
				// lazy initialize the reverse dictionary for the category
				if (!this._reverseDictionary[category]) {
					this._reverseDictionary[category] = {};
				}
				this._reverseDictionary[category][value] = key;
			}
		}
	};

	ExoWeb.Translator = Translator;

	// #endregion

	// #region ExoWeb.Utilities
	//////////////////////////////////////////////////

	// determine whether Object.defineProperty is supported and add legacy support is necessary/possible
	var definePropertySupported = false;
	var defineProperty;

	function defineLegacyProperty() {
		Object.defineProperty = function (obj, prop, desc) {

			// assume getter will only need to calculate once following the constructor
			if ("get" in desc) {
				if (!desc.init) throw new Error("Getters are not supported by the current browser.  Use definePropertySupported to check for full support.");

				// assume objects with prototypes are instances and go ahead and initialize the property using the getter
				if (obj.prototype) {
					obj[prop] = desc.get.call(obj, obj);
				}

				// otherwise, configure the prototype to initialize the property when the constructor is called
				else if (obj.constructor) {
					var initProperties = obj.constructor.__initProperties;
					if (!initProperties) {
						obj.constructor.__initProperties = initProperties = {};
					}
					initProperties[prop] = desc.get;
				}
			}

			// assume it is just a data property
			else {
				obj[prop] = desc.value;
			}

			// throw an exception if the property has a setter, which is definitely not supported
			if ("set" in desc) throw new Error("Setters are not supported by the current browser.  Use definePropertySupported to check for full support.");
		};
	}

	try {
		// emulate ES5 getter/setter API using legacy APIs
		if (Object.prototype.__defineGetter__ && !Object.defineProperty) {
			Object.defineProperty = function (obj, prop, desc) {

				// property with getter
				if ("get" in desc) obj.__defineGetter__(prop, desc.get);

				// property with setter
				if ("set" in desc) obj.__defineSetter__(prop, desc.set);

				// data only property
				if (!("get" in desc || "set" in desc)) {

					// read/write property
					if (desc.writable) {
						var value = desc.value;
						obj.__defineGetter__(prop, function () { return value; });
						obj.__defineSetter__(prop, function (val) { value = val; });
					}

					// read only property
					else {
						var value = desc.value;
						obj.__defineGetter__(prop, function () { return value; });
					}
				}
			};
			definePropertySupported = true;
		}

		// otherwise, ensure defineProperty actually works
		else if (Object.defineProperty && Object.defineProperty({}, "x", { get: function () { return true } }).x) {
			definePropertySupported = true;
		}

		// enable legacy support
		else {
			defineLegacyProperty();
		}
	} 

	// no getter/setter support
	catch (e) {

		// enable legacy support
		defineLegacyProperty();
	}

	// classes that call define property should
	function initializeLegacyProperties(obj) {
		if (definePropertySupported) return;
		var initProperties = obj.constructor.__initProperties;
		if (initProperties) {
			for (var p in initProperties) {
				obj[p] = initProperties[p].call(obj, obj);
			}
		}
	}

	// evalPath internal utility function
	function evalPath(obj, path, nullValue, undefinedValue) {
		var i, name, steps = path.split("."), source, value = obj;

		if (value === null) {
			return arguments.length >= 3 ? nullValue : null;
		}
		if (value === undefined) {
			return arguments.length >= 4 ? undefinedValue : undefined;
		}

		for (i = 0; i < steps.length; ++i) {
			name = steps[i];
			source = value;
			value = getValue(source, name);

			if (value === null) {
				return arguments.length >= 3 ? nullValue : null;
			}
			if (value === undefined) {
				return arguments.length >= 4 ? undefinedValue : undefined;
			}
		}

		return value;
	}

	ExoWeb.evalPath = evalPath;

	function getLastTarget(target, propertyPath) {
		var i, pathArray, finalTarget = target;

		if (propertyPath == null) throw new ArgumentNullError("propertyPath");

		if (propertyPath.constructor == String) {
			pathArray = propertyPath.split(".");
		}
		else {
			if (!(propertyPath instanceof Array)) throw ArgumentTypeError("propertyPath", "string|array", propertyPath);
			pathArray = propertyPath;
		}

		for (i = 0; i < pathArray.length - 1; i++) {
			if (finalTarget) {
				finalTarget = getValue(finalTarget, pathArray[i]);
			}
		}

		return finalTarget;
	}

	ExoWeb.getLastTarget = getLastTarget;
	window.$lastTarget = getLastTarget;

	// If a getter method matching the given property name is found on the target it is invoked and returns the 
	// value, unless the the value is undefined, in which case null is returned instead.  This is done so that 
	// calling code can interpret a return value of undefined to mean that the property it requested does not exist.
	// TODO: better name
	function getValue(target, property) {
		var value;

		// the see if there is an explicit getter function for the property
		var getter = target["get_" + property];
		if (getter) {
			value = getter.call(target);
			if (value === undefined) {
				value = null;
			}
		}

		// otherwise search for the property
		else {
			if ((isObject(target) && property in target) ||
				Object.prototype.hasOwnProperty.call(target, property) ||
				(target.constructor === String && /^[0-9]+$/.test(property) && parseInt(property, 10) < target.length)) {
				value = target[property];
				if (value === undefined) {
					value = null;
				}
			}
			else if (/\./.test(property)) {
				logWarning("Possible incorrect usage of \"getValue()\", the path \"" + property + "\" does not exist on the target and appears to represent a multi-hop path.");
			}
		}

		return value;
	}

	ExoWeb.getValue = getValue;

	function getCtor(type) {

		// Only return a value if the argument is defined
		if (type !== undefined && type !== null) {

			// If the argument is a function then return it immediately.
			if (isType(type, Function)) {
				return type;

			}
			else {
				var ctor;

				if (isType(type, String)) {
					// remove "window." from the type name since it is implied
					type = type.replace(/(window\.)?(.*)/, "$2");

					// evaluate the path
					ctor = evalPath(window, type);
				}

				// warn (and implicitly return undefined) if the result is not a javascript function
				if (ctor !== undefined && ctor !== null && !isType(ctor, Function)) {
					logWarning("The given type \"" + type + "\" is not a function.");
				}
				else {
					return ctor;
				}
			}
		}
	}

	ExoWeb.getCtor = getCtor;

	function isType(val, type) {

		// Exit early for checking function type
		if (val !== undefined && val !== null && val === Function && type !== undefined && type !== null && type === Function) {
			return true;
		}

		var ctor = getCtor(type);

		// ensure a defined value and constructor
		return val !== undefined && val !== null &&
				ctor !== undefined && ctor !== null &&
				// accomodate objects (instanceof) as well as intrinsic value types (String, Number, etc)
				(val instanceof ctor || val.constructor === ctor);
	}

	ExoWeb.isType = isType;

	function eachProp(obj, callback, thisPtr) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(prop)) {
				if (callback.apply(thisPtr || this, [prop, obj[prop]]) === false) {
					break;
				}
			}
		}
	}

	ExoWeb.eachProp = eachProp;

	function objectToArray(obj) {
		var list = [];
		eachProp(obj, function(prop, value) {
			list.push(value);
		});
		return list;
	}

	ExoWeb.objectToArray = objectToArray;

	function $format(str, values) {
		var source;

		if (arguments.length < 2) {
			return str;
		}

		if (arguments.length > 2) {
			// use arguments passed to function as array
			source = Array.prototype.slice.call(arguments, 1);
		}
		else {
			source = !(values instanceof Array) ? [values] : values;
		}

		return str.replace(/\{([0-9]+)\}/ig, function (match, indexStr) {
			var index = parseInt(indexStr, 10);
			var result = source[index];

			if (result !== null && result !== undefined && result.constructor !== String) {
				result = result.toString();
			}

			return result;
		});
	}

	window.$format = $format;

	function makeHumanReadable(text) {
		return text.replace(/([^A-Z]+)([A-Z])/g, "$1 $2");
	}

	ExoWeb.makeHumanReadable = makeHumanReadable;

	// #endregion

	// #region ExoWeb.TimeSpan
	//////////////////////////////////////////////////

	function TimeSpan(ms) {
		/// <field name="totalSeconds" type="Number">The target entity the condition is associated with.</field>

		this.totalMilliseconds = ms;

		initializeLegacyProperties(this);
	}

	TimeSpan.mixin({
		totalSeconds: { get: function () { return this.totalMilliseconds / 1000; }, init: true },
		totalMinutes: { get: function () { return this.totalSeconds / 60; }, init: true },
		totalHours: { get: function () { return this.totalMinutes / 60; }, init: true },
		totalDays: { get: function () { return this.totalHours / 24; }, init: true },
		milliseconds: { get: function () { return Math.floor(this.totalMilliseconds % 1000); }, init: true },
		seconds: { get: function () { return Math.floor(this.totalSeconds % 60); }, init: true },
		minutes: { get: function () { return Math.floor(this.totalMinutes % 60); }, init: true },
		hours: { get: function () { return Math.floor(this.totalHours % 24); }, init: true },
		days: { get: function () { return Math.floor(this.totalDays); }, init: true },
		toObject: function() {
			return {
				Hours: this.hours,
				Minutes: this.minutes,
				Seconds: this.seconds,
				Milliseconds: this.milliseconds,
				Ticks: this.totalMilliseconds * 1000000 / 100,
				Days: this.days,
				TotalDays: this.totalDays,
				TotalHours: this.totalHours,
				TotalMilliseconds: this.totalMilliseconds,
				TotalMinutes: this.totalMinutes,
				TotalSeconds: this.totalSeconds
			};
		},
		valueOf: function() {
			return this.totalMilliseconds;
		},
		toString: function TimeSpan$toString() { 
			var num;
			var label;

			if (this.totalHours < 1) {
				num = Math.round(this.totalMinutes);
				label = "minute";
			}
			else if (this.totalDays < 1) {
				num = Math.round(this.totalHours * 100) / 100;
				label = "hour";
			}
			else {
				num = Math.round(this.totalDays * 100) / 100;
				label = "day";
			}

			return num == 1 ? (num + " " + label) : (num + " " + label + "s");
		}
	});

	window.TimeSpan = TimeSpan;

	Date.mixin({
		subtract: function Date$subtract(d) {
			return new TimeSpan(this - d);
		},
		add: function Date$add(timeSpan) {
			return new Date(this.getTime() + timeSpan.totalMilliseconds);
		}
	});

	// #endregion

	// #region ExoWeb.Date
	//////////////////////////////////////////////////

	var dayOfWeek = {};
	var days = ["sunday", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday"];
	days.forEach(function(day, i) {
		dayOfWeek[day] = i;
	});

	Date.prototype.toDate = function toDate() {
		return new Date(this.getFullYear(), this.getMonth(), this.getDate());
	};

	Date.prototype.addYears = function addYears(numYears) {
		return new Date(this.getFullYear() + numYears, this.getMonth(), this.getDate(), this.getHours(), this.getMinutes(), this.getSeconds(), this.getMilliseconds());
	};

	Date.prototype.addDays = function addDays(numDays, requireWeekDay) {
		var date = new Date(this.getFullYear(), this.getMonth(), this.getDate() + numDays, this.getHours(), this.getMinutes(), this.getSeconds(), this.getMilliseconds());

		// If requireWeekDay is true and the day falls on a Saturday or Sunday, then
		// the the result will be moved back to the preceeding friday (when subtracting days)
		// or forward to the next monday (when adding days).
		if (requireWeekDay === true) {
			// Sunday
			if (date.getDay() === 0) {
				date.setDate(date.getDate() + (numDays >= 0 ? 1 : -2));
			}
			// Saturday 
			else if (date.getDay() === 6) {
				date.setDate(date.getDate() + (numDays >= 0 ? 2 : -1));
			}
		}

		return date;
	};

	var oneHourInMilliseconds = 1000 * 60 * 60;

	Date.prototype.addHours = function addHours(numHours) {
		return new Date(+this + (oneHourInMilliseconds * numHours));
	};

	function getDayOfWeek(day) {
		if (day !== undefined && day !== null && day.constructor === String)
			day = days.indexOf(day.toLowerCase());
		else if (day !== undefined && day !== null && day.constructor !== Number)
			day = null;

		return day >= 0 && day < days.length ? day : null;
	}

	Date.prototype.startOfWeek = function(startOfWeekDay) {
		var startOfWeek = getDayOfWeek(startOfWeekDay) || dayOfWeek.monday; // monday by default
		return this.addDays(startOfWeek - this.getDay());
	};

	Date.prototype.weekOfYear = function(startOfWeekDay) {
		var startOfWeek = getDayOfWeek(startOfWeekDay) || dayOfWeek.monday; // monday by default

		if (this.startOfWeek(startOfWeek).getYear() < this.getYear()) {
			return 0;
		}

		var firstDayOfYear = new Date(this.getFullYear(), 0, 1);
		var firstWeek = firstDayOfYear.startOfWeek(startOfWeek);
		if (firstWeek.getFullYear() < firstDayOfYear.getFullYear()) {
			firstWeek = firstWeek.addDays(7);
		}

		var weeks = 0;
		var target = this.toDate();
		for (var day = firstWeek; day <= target; day = day.addDays(7)) {
			weeks++;
		}

		return weeks;
	};

	Date.prototype.weekDifference = function (other, startOfWeek) {
		var isNegative = other <= this;
		var a = this, b = other;

		if (isNegative)
		{
			a = other;
			b = this;
		}

		var aWeek = a.weekOfYear(startOfWeek);
		var bWeek = b.weekOfYear(startOfWeek);

		for (var i = a.getFullYear(); i < b.getFullYear(); i++)
			bWeek += (new Date(i, 11, 31)).weekOfYear(startOfWeek);

		return isNegative ? aWeek - bWeek : bWeek - aWeek;
	};

	// #endregion

	// #region ExoWeb.Object
	//////////////////////////////////////////////////

	// original code grabbed from http://oranlooney.com/functional-javascript/
	Object.copy = function Object$Copy(obj, options/*, level*/) {
		if (!options) {
			options = {};
		}

		// initialize max level to default value
		if (!options.maxLevel) {
			options.maxLevel = 25;
		}

		// initialize level to default value
		var level = arguments.length > 2 ? arguments[2] : 0;

		if (level >= options.maxLevel || typeof obj !== 'object' || obj === null || obj === undefined) {
			return obj;  // non-object have value sematics, so obj is already a copy.
		}
		else {
			if (obj instanceof Array) {
				var result = [];
				for (var i = 0; i < obj.length; i++) {
					result.push(Object.copy(obj[i]));
				}
				return result;
			}
			else {
				var value = obj.valueOf();
				if (obj != value) {
					// the object is a standard object wrapper for a native type, say String.
					// we can make a copy by instantiating a new object around the value.
					return new obj.constructor(value);
				} else {
					// don't clone entities
					if (typeof(Entity) !== "undefined" && obj instanceof Entity) {
						return obj;
					}
					else {
						// ok, we have a normal object. copy the whole thing, property-by-property.
						var c = {};
						for (var property in obj) {
							// Optionally copy property values as well
							if (options.copyChildren) {
								c[property] = Object.copy(obj[property], options, level + 1);
							}
							else {
								c[property] = obj[property];
							}

						}
						return c;
					}
				}
			}
		}
	};

	// Based on https://vanillajstoolkit.com/polyfills/objectassign/
	function assign(target, varArgs) {
		if (target == null) { // TypeError if undefined or null
			throw new TypeError('Cannot convert undefined or null to object');
		}

		var to = Object(target);

		for (var index = 1; index < arguments.length; index++) {
			var nextSource = arguments[index];

			if (nextSource != null) { // Skip over if undefined or null
				for (var nextKey in nextSource) {
					// Avoid bugs when hasOwnProperty is shadowed
					if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {
						to[nextKey] = nextSource[nextKey];
					}
				}
			}
		}
		return to;
	}

	// Based on https://vanillajstoolkit.com/polyfills/objectentries/
	function entries(obj) {
		var ownProps = Object.keys(obj),
			i = ownProps.length,
			resArray = new Array(i); // preallocate the Array

		while (i--)
			resArray[i] = [ownProps[i], obj[ownProps[i]]];

		return resArray;
	}

	if (!Object.assign)
		Object.assign = assign;
	if (!Object.entries)
		Object.entries = entries;

	// #endregion

	// #region ExoWeb.Observer
	//////////////////////////////////////////////////

	var Observer = { };

	Observer.addPathChanged = function Observer$addPathChanged(target, path, handler, allowNoTarget) {
		// Throw an error if the target is null or undefined, unless the calling code specifies that this is ok
		if (target == null) {
			if (allowNoTarget === true) return;
			else throw new ArgumentNullError("target", "'allowNoTarget' is false - path = \"" + (path instanceof Array ? path.join(".") : path) + "\"");
		}

		// Ensure a set of path change handlers
		if (!target.__pathChangeHandlers) {
			target.__pathChangeHandlers = {};
		}

		var list = path;
		if (path instanceof Array) {
			path = path.join(".");
		}
		else {
			list = path.split(".");
		}

		var roots = [];

		function processStep(parent, item, index) {
			var observers = [];

			function addObserver(value) {
				var obs = new PropertyObserver(item);

				observers.push(obs);
				if (index === 0) {
					roots.push(obs);
				}

				obs.start(value, handler);

				// Continue to next steps if there are any
				if (index + 1 < list.length) {
					processStep(obs, list[index + 1], index + 1);
				}
			}

			function removeObserver(value) {
				for (var i = 0; i < observers.length; i++) {
					var obs = observers[i];
					if (obs._source === value) {
						Array.removeAt(observers, i--);
						if (index === 0) {
							Array.remove(roots, obs);
						}

						obs.stop();
					}
				}
			}

			// If there is a step before this one, then respond to 
			// changes to the value(s) at that step.
			if (parent) {
				parent._addEvent("valueCaptured", addObserver);
				parent._addEvent("valueReleased", removeObserver);
			}

			var source = index === 0 ? target : parent.value();
			if (source !== undefined && source !== null) {
				if (source instanceof Array) {
					Array.forEach(source, addObserver);

					// Watch for changes to the target if it is an array, so that we can
					// add new observers, remove old ones, and call the handler.
					if (index === 0) {
						Observer.addCollectionChanged(source, function(sender, args) {
							var changes = args.get_changes();

							Array.forEach(changes.removed || [], removeObserver);
							Array.forEach(changes.added || [], addObserver);
							handler();
						});
					}
				}
				else {
					addObserver(source);
				}
			}
		}

		// Start processing the path
		processStep(null, list[0], 0);

		// Store the observer on the object
		var pathChangeHandlers = target.__pathChangeHandlers[path];
		if (!pathChangeHandlers) {
			target.__pathChangeHandlers[path] = pathChangeHandlers = [];
		}
		pathChangeHandlers.push({ roots: roots, handler: handler });
	};

	Observer.removePathChanged = function Sys$Observer$removePathChanged(target, path, handler) {
		path = (path instanceof Array) ? path.join(".") : path;

		var pathChangeHandlers = target.__pathChangeHandlers ? target.__pathChangeHandlers[path] : null;

		if (pathChangeHandlers) {
			// Search the list for handlers that match the given handler and stop and remove them
			pathChangeHandlers.purge(function(pathChangeHandler) {
				if (pathChangeHandler.handler === handler) {
					Array.forEach(pathChangeHandler.roots, function(observer) {
						observer.stop();
					});
					return true;
				}
			});

			// If there are no more handlers for this path then remove it from the cache
			if (pathChangeHandlers.length === 0) {
				// delete the data specific to this path
				delete target.__pathChangeHandlers[path];

				// determine if there are any other paths being watched
				var hasHandlers = false;
				for (var remainingHandler in target.__pathChangeHandlers) {
					if (target.__pathChangeHandlers.hasOwnProperty(remainingHandler)) {
						hasHandlers = true;
					}
				}

				// null out the property of the target if there are no longer any paths being watched
				if (!hasHandlers) {
					target.__pathChangeHandlers = null;
				}
			}
		}
	};

	var observableInterface = {
		makeObservable: function (target) {
			throw new Error("Observable provider has not been implemented.  Call ExoWeb.Model.setObservableProvider().");
		},
		disposeObservable: function (target) {
			throw new Error("Observable provider has not been implemented.  Call ExoWeb.Model.setObservableProvider().");
		},
		addCollectionChanged: function (target, handler) {
			throw new Error("Observable provider has not been implemented.  Call ExoWeb.Model.setObservableProvider().");
		},
		removeCollectionChanged: function (target, handler) {
			throw new Error("Observable provider has not been implemented.  Call ExoWeb.Model.setObservableProvider().");
		},
		addPropertyChanged: function (target, property, handler) {
			throw new Error("Observable provider has not been implemented.  Call ExoWeb.Model.setObservableProvider().");
		},
		removePropertyChanged: function (target, property, handler) {
			throw new Error("Observable provider has not been implemented.  Call ExoWeb.Model.setObservableProvider().");
		},
		raisePropertyChanged: function (target, property) {
			throw new Error("Observable provider has not been implemented.  Call ExoWeb.Model.setObservableProvider().");
		},
		setValue: function (target, property, value) {
			throw new Error("Observable provider has not been implemented.  Call ExoWeb.Model.setObservableProvider().");
		}
	};

	// sets the observer provider to use, verifying that it matches the defined interface.
	function setObserverProvider(provider) {
		for (var method in observableInterface) {
			var definition = provider[method];
			if (!(definition instanceof Function)) {
				throw new Error("Observable provider does not implement '" + method + "'.");
			}
			Observer[method] = definition;
		}
	}

	// expose publicly
	ExoWeb.Observer = Observer;

	// #endregion

	// #region ExoWeb.PropertyObserver
	//////////////////////////////////////////////////

	function PropertyObserver(prop) {
		this._source = null;
		this._prop = prop;
		this._handler = null;
	}

	PropertyObserver.mixin(Functor.eventing);

	PropertyObserver.mixin({
		value: function PropertyObserver$value() {
			return ExoWeb.getValue(this._source, this._prop);
		},
		release: function PropertyObserver$release(value) {
			// Notify subscribers that the old value should be released
			if (value instanceof Array) {
				Array.forEach(value, function(item) {
					this._raiseEvent("valueReleased", [item]);
				}, this);
			}
			else {
				this._raiseEvent("valueReleased", [value]);
			}
		},
		capture: function PropertyObserver$capture(value) {
			// Notify subscribers that a new value was captured
			if (value instanceof Array) {
				Array.forEach(value, function(item) {
					this._raiseEvent("valueCaptured", [item]);
				}, this);

				var _this = this;

				// Have to store the array since if the value changes we won't necessarily be able to retrieve the original array
				if (this._collectionTarget !== undefined && this._collectionTarget !== null) {
					Observer.removeCollectionChanged(this._collectionTarget, this._collectionHandler);
				}

				this._collectionTarget = value;

				this._collectionHandler = function collectionHandler(sender, args) {
					var changes = args.get_changes();

					// Call the actual handler
					_this._handler.apply(this, arguments);

					// remove old observers and add new observers
					Array.forEach(changes.removed || [], function(removed) {
						_this._raiseEvent("valueReleased", [removed]);
					});
					Array.forEach(changes.added || [], function(added) {
						_this._raiseEvent("valueCaptured", [added]);
					});
				};

				Observer.addCollectionChanged(this._collectionTarget, this._collectionHandler);
			}
			else {
				this._raiseEvent("valueCaptured", [value]);
			}
		},
		start: function PropertyObserver$start(source, handler) {
			if (this._source) {
				throw new Error("Cannot start an observer that is already started.");
			}

			var _this = this;

			this._source = source;
			this._handler = handler;

			var value = this.value();

			this._propHandler = function propHandler(sender, args) {
				// Call the actual handler.
				_this._handler.apply(this, arguments);

				// Release the old value
				if (value !== undefined && value !== null) {
					_this.release(value);
				}

				value = _this.value();

				// Release the old value
				if (value !== undefined && value !== null) {
					_this.capture(value);
				}
			};

			Observer.addPropertyChanged(this._source, this._prop, this._propHandler);

			// If we currently have a value, then notify subscribers
			if (value !== undefined && value !== null) {
				this.capture(value);
			}
		},
		stop: function PropertyObserver$stop() {
			if (this._source) {
				// Remove the registered event(s)
				Observer.removePropertyChanged(this._source, this._prop, this._propHandler);

				// Have to store the array since if the value changes we won't necessarily be able to retrieve the original array
				if (this._collectionTarget !== undefined && this._collectionTarget !== null) {
					Observer.removeCollectionChanged(this._collectionTarget, this._collectionHandler);
					this.release(this._collectionTarget);
				}
				else {
					var value = this.value();
					if (value !== undefined && value !== null) {
						this.release(value);
					}
				}

				// Null out the source to indicate that it is no longer watching that object
				this._source = null;
			}
		}
	});

	ExoWeb.PropertyObserver = PropertyObserver;

	// #endregion

	// #region ExoWeb.Model.Resource
	//////////////////////////////////////////////////

	var Resource = {
		"allowed-values":							"{property} is not in the list of allowed values.",
		"compare-after":							"{property} must be after {compareSource}.",
		"compare-before":							"{property} must be before {compareSource}.",
		"compare-equal":							"{property} must be the same as {compareSource}.",
		"compare-greater-than":						"{property} must be greater than {compareSource}.",
		"compare-greater-than-or-equal":			"{property} must be greater than or equal to {compareSource}.",
		"compare-less-than":						"{property} must be less than {compareSource}.",
		"compare-less-than-or-equal":				"{property} must be less than or equal to {compareSource}.",
		"compare-not-equal":						"{property} must be different from {compareSource}.",
		"compare-on-or-after":						"{property} must be on or after {compareSource}.",
		"compare-on-or-before":						"{property} must be on or before {compareSource}.",
		"listlength-at-least":						"Please specify at least {min} {property}.",
		"listlength-at-most":						"Please specify no more than {max} {property}.",
		"listlength-between":						"Please specify between {min} and {max} {property}.",
		"range-at-least":							"{property} must be at least {min}.",
		"range-at-most":							"{property} must be at most {max}.",
		"range-between":							"{property} must be between {min} and {max}.",
		"range-on-or-after":						"{property} must be on or after {min}.",
		"range-on-or-before":						"{property} must be on or before {max}.",
		"required":									"{property} is required.",
		"required-if-after":						"{property} is required when {compareSource} is after {compareValue}.",
		"required-if-before":						"{property} is required when {compareSource} is before {compareValue}.",
		"required-if-equal":						"{property} is required when {compareSource} is {compareValue}.",
		"required-if-exists":						"{property} is required when {compareSource} is specified.",
		"required-if-greater-than":					"{property} is required when {compareSource} is greater than {compareValue}.",
		"required-if-greater-than-or-equal":		"{property} is required when {compareSource} is greater than or equal to {compareValue}.",
		"required-if-less-than":					"{property} is required when {compareSource} is less than {compareValue}.",
		"required-if-less-than-or-equal":			"{property} is required when {compareSource} is less than or equal to {compareValue}.",
		"required-if-not-equal":					"{property} is required when {compareSource} is not {compareValue}.",
		"required-if-not-exists":					"{property} is required when {compareSource} is not specified.",
		"required-if-on-or-after":					"{property} is required when {compareSource} is on or after {compareValue}.",
		"required-if-on-or-before":					"{property} is required when {compareSource} is on or before {compareValue}.",
		"string-format":							"{property} must be formatted as {formatDescription}.",
		"string-length-at-least":					"{property} must be at least {min} characters.",
		"string-length-at-most":					"{property} must be at most {max} characters.",
		"string-length-between":                    "{property} must be between {min} and {max} characters.",
	    "format-with-description":                  "{property} must be formatted as {description}.",
		"format-without-description":               "{property} is not properly formatted.",
	    "format-currency":                          "$#,###.##",
	    "format-percentage":                        "#.##%",
	    "format-integer":                           "#,###",
	    "format-decimal":                           "#,###.##",

		// gets the resource with the specified name
		get: function Resource$get(name) {
			return this[name];
		}
	}

	// publicly export the resource object
	ExoWeb.Model.Resource = Resource;

	// #endregion

	// #region ExoWeb.Model.FormatCompiler
	//////////////////////////////////////////////////

	var formatTemplateParser = /\[([_a-zA-Z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u02bb-\u02c1\u02d0-\u02d1\u02e0-\u02e4\u02ee\u0370-\u0373\u0376-\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0523\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0621-\u064a\u0660-\u0669\u066e-\u066f\u0671-\u06d3\u06d5\u06e5-\u06e6\u06ee-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07c0-\u07ea\u07f4-\u07f5\u07fa\u0904-\u0939\u093d\u0950\u0958-\u0961\u0966-\u096f\u0971-\u0972\u097b-\u097f\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc-\u09dd\u09df-\u09e1\u09e6-\u09f1\u0a05-\u0a0a\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a66-\u0a6f\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0-\u0ae1\u0ae6-\u0aef\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32-\u0b33\u0b35-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b66-\u0b6f\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0be6-\u0bef\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58-\u0c59\u0c60-\u0c61\u0c66-\u0c6f\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0-\u0ce1\u0ce6-\u0cef\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d3d\u0d60-\u0d61\u0d66-\u0d6f\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32-\u0e33\u0e40-\u0e46\u0e50-\u0e59\u0e81-\u0e82\u0e84\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa-\u0eab\u0ead-\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0ed0-\u0ed9\u0edc-\u0edd\u0f00\u0f20-\u0f29\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8b\u1000-\u102a\u103f-\u1049\u1050-\u1055\u105a-\u105d\u1061\u1065-\u1066\u106e-\u1070\u1075-\u1081\u108e\u1090-\u1099\u10a0-\u10c5\u10d0-\u10fa\u10fc\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u17e0-\u17e9\u1810-\u1819\u1820-\u1877\u1880-\u18a8\u18aa\u1900-\u191c\u1946-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u19d0-\u19d9\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u1b50-\u1b59\u1b83-\u1ba0\u1bae-\u1bb9\u1c00-\u1c23\u1c40-\u1c49\u1c4d-\u1c7d\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u2094\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183-\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2c6f\u2c71-\u2c7d\u2c80-\u2ce4\u2d00-\u2d25\u2d30-\u2d65\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3006\u3031-\u3035\u303b-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fc3\ua000-\ua48c\ua500-\ua60c\ua610-\ua62b\ua640-\ua65f\ua662-\ua66e\ua680-\ua697\ua722-\ua788\ua78b-\ua78c\ua7fb-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8d0-\ua8d9\ua900-\ua925\ua930-\ua946\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa50-\uaa59\uac00-\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc][_.0-9a-zA-Z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u02bb-\u02c1\u02d0-\u02d1\u02e0-\u02e4\u02ee\u0370-\u0373\u0376-\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0523\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0621-\u064a\u0660-\u0669\u066e-\u066f\u0671-\u06d3\u06d5\u06e5-\u06e6\u06ee-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07c0-\u07ea\u07f4-\u07f5\u07fa\u0904-\u0939\u093d\u0950\u0958-\u0961\u0966-\u096f\u0971-\u0972\u097b-\u097f\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc-\u09dd\u09df-\u09e1\u09e6-\u09f1\u0a05-\u0a0a\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a66-\u0a6f\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0-\u0ae1\u0ae6-\u0aef\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32-\u0b33\u0b35-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b66-\u0b6f\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0be6-\u0bef\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58-\u0c59\u0c60-\u0c61\u0c66-\u0c6f\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0-\u0ce1\u0ce6-\u0cef\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d3d\u0d60-\u0d61\u0d66-\u0d6f\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32-\u0e33\u0e40-\u0e46\u0e50-\u0e59\u0e81-\u0e82\u0e84\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa-\u0eab\u0ead-\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0ed0-\u0ed9\u0edc-\u0edd\u0f00\u0f20-\u0f29\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8b\u1000-\u102a\u103f-\u1049\u1050-\u1055\u105a-\u105d\u1061\u1065-\u1066\u106e-\u1070\u1075-\u1081\u108e\u1090-\u1099\u10a0-\u10c5\u10d0-\u10fa\u10fc\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u17e0-\u17e9\u1810-\u1819\u1820-\u1877\u1880-\u18a8\u18aa\u1900-\u191c\u1946-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u19d0-\u19d9\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u1b50-\u1b59\u1b83-\u1ba0\u1bae-\u1bb9\u1c00-\u1c23\u1c40-\u1c49\u1c4d-\u1c7d\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u2094\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183-\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2c6f\u2c71-\u2c7d\u2c80-\u2ce4\u2d00-\u2d25\u2d30-\u2d65\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3006\u3031-\u3035\u303b-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fc3\ua000-\ua48c\ua500-\ua60c\ua610-\ua62b\ua640-\ua65f\ua662-\ua66e\ua680-\ua697\ua722-\ua788\ua78b-\ua78c\ua7fb-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8d0-\ua8d9\ua900-\ua925\ua930-\ua946\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa50-\uaa59\uac00-\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]*)(\:(.+?))?\]/ig;

	var metaPathParser = /^(.*\.|)meta(\..*|)$/;

	function createTemplateParser(template) {
	    var parse = function parseFormatTemplate() {
	        if (!this._tokens) {
	            this._tokens = [];

	            // Replace escaped \, [ or ] characters with placeholders
	            template = template.replace(/\\\\/g, '\u0000').replace(/\\\[/g, '\u0001').replace(/\\\]/g, '\u0002');
	            var index = 0;
	            formatTemplateParser.lastIndex = 0;
	            var match = formatTemplateParser.exec(template);

	            // Process each token match
	            while (match) {
	                var path = match[1];

	                // Create a token for the current match, including the prefix, path and format
	                this._tokens.push({
	                    prefix: template.substring(index, formatTemplateParser.lastIndex - match[0].length).replace(/\u0000/g, '\\').replace(/\u0001/g, '[').replace(/\u0002/g, ']'),
	                    path: path,
	                    format: match[3] ? match[3].replace(/\u0000/g, '\\').replace(/\u0001/g, '[').replace(/\u0002/g, ']') : null
	                });

	                // Track the last index and find the next match
	                index = formatTemplateParser.lastIndex;
	                match = formatTemplateParser.exec(template);
	            }

	            // Capture any trailing literal text as a token without a path
	            if (index < template.length) {
	                this._tokens.push({
	                    prefix: template.substring(index).replace(/\u0000/g, '\\').replace(/\u0001/g, '[').replace(/\u0002/g, ']')
	                });
	            }
	        }
	    };
	    return parse;
	}

	function createTemplateCompiler(type) {
		var logWarning = function logCompileFormatTemplateWarning(message) {
			if (typeof console !== "undefined") {
				if (console.warn && typeof console.warn === "function")
					console.warn(message);
				else if (console.log && typeof console.log === "function")
					console.log("WARN: " + message);
			}
		};

	    var compile = function compileFormatTemplate(callback, thisPtr) {
	        // First, ensure that the template is parsed
	        this._parse.call(this);

	        // Detect whether the template is being compiled in async mode
	        var isAsync = callback && callback instanceof Function;

	        // If the template is currently being compiled, then wait for it to complete
	        if (this._compileSignal && isAsync) {
	            this._compileSignal.waitForAll(callback, thisPtr);
	            return;
	        }

	        // If the template has already been compiled, then invoke the callback immediately
	        if (this._paths && isAsync) {
	            callback.call(thisPtr || this);
	            return;
	        }

	        if (!this._paths) {
	            if (isAsync) {
	                this._compileSignal = new Signal("compileFormatTemplate");
	            }

	            this._paths = [];

	            this._tokens.forEach(function (token) {
	                var path = token.path;
	                if (path) {
	                    var propertyPath = path;

	                    // See if the path represents a property path in the model
	                    try {
	                        // Detect property path followed by ".meta..."
	                        propertyPath = propertyPath.replace(metaPathParser, "$1");
	                        var isMetaPath = propertyPath.length > 0 && propertyPath.length < path.length;
	                        var allowFormat = !isMetaPath;
	                        if (isMetaPath) {
	                            propertyPath = propertyPath.substring(0, propertyPath.length - 1);
	                        }

	                        // If a property path remains, then attempt to find a default format and paths for the format
	                        if (propertyPath) {
	                            var processFormatProperty = function (property) {
									if (property) {
										// Only allow formats for a property path that is not followed by ".meta..."
										if (allowFormat) {
											// Determine the default property format
											var defaultFormat = property.get_format();

											// If the path references one or more entity properties, include paths for the property format. Otherwise, just add the path.
											var lastIndex = formatTemplateParser.lastIndex;
											if (defaultFormat && defaultFormat.constructor === Format && defaultFormat !== this && defaultFormat.getPaths().length > 0)
												this._paths.addRange(defaultFormat.getPaths().map(function (p) { return propertyPath + "." + p; }));
											else
												this._paths.push(propertyPath);
											formatTemplateParser.lastIndex = lastIndex;
											// Use the default format for the property
											if (!token.format) {
												token.format = defaultFormat;
											}
										}
										// Formats are not allowed, so just add the path
										else {
											this._paths.push(propertyPath);
										}
									} else {
										logWarning("Path '" + propertyPath + "' is not valid.");
									}
	                            };

								// Get the property and process it either immediately, or when the path is available (if compiling in async mode)
								if (isAsync) {
									Model.property(propertyPath, type, false, this._compileSignal.pending(processFormatProperty, this), this, false);
								} else {
									var property = Model.property(propertyPath, type);
									if (property) {
										processFormatProperty.call(this, property);
									} else {
										logWarning("Path '" + propertyPath + "' is not valid.");
									}
								}
	                        }
	                    }
						catch (e) {
							logWarning(e);
	                    }
	                }
	            }, this);

	            // If the format is being compiled async, then invoke the callback when complete
	            if (isAsync) {
	                this._compileSignal.waitForAll(function () {
	                    callback.call(thisPtr || this);
	                    delete this._compileSignal;
	                }, this);
	            }
	        }
	    };
	    return compile;
	}

	// #endregion

	// #region ExoWeb.Model.Format
	//////////////////////////////////////////////////

	function Format(options) {
		if (!options.hasOwnProperty("specifier") || !isString(options.specifier)) {
			throw new Error("Format specifier string must be provided.");
		}
		this._specifier = options.specifier;
		this._paths = options.paths;
		this._convert = options.convert;
		this._convertBack = options.convertBack;
		this._parse = options.parse;
		this._compile = options.compile;
		this._description = options.description;
		this._nullString = options.nullString || "";
		this._undefinedString = options.undefinedString || "";
		this._getFormattedValue = function (obj) {
			var result = "";
			for (var index = 0; index < this._tokens.length; index++) {
				var token = this._tokens[index];
				if (token.prefix)
					result = result + token.prefix;
				if (token.path) {
					var value = evalPath(obj, token.path);
					if (value === undefined || value === null)
						value = "";
					else if (token.format) {
						if (token.format.constructor === String) {
							token.format = getFormat(value.constructor, token.format);
						}

						if (value instanceof Array)
							value = value.map(function (v) { return token.format.convert(v); }).join(", ");
						else
							value = token.format.convert(value);

						if (this._formatEval)
							value = this._formatEval(value);
					}
					result = result + value;
				}
			}

			return result;
		};

		// function to perform additional post formatting
		this._formatEval = options.formatEval;
	}

	Format.fromTemplate = function Format$fromTemplate(type, template, formatEval) {

		return new Format({
			specifier: template,

			parse: createTemplateParser(template),

			compile: createTemplateCompiler(type),

			convert: function convert(obj) {
				if (obj === null || obj === undefined) {
					return "";
				}

				// Ensure the format has been compiled
				this._compile();

				var result = "";
				if (obj instanceof Array)
					for (var i = 0; i < obj.length; i++) {
						var value = this._getFormattedValue(obj[i]);

						if (result !== "" && value !== "")
							result = result + ", " + value;
						else
							result = result + value;
					}
				else
					result = this._getFormattedValue(obj);

				return result;
			},

			formatEval: formatEval
		});
	};

	Format.mixin({
		getTokens: function () {
			if (this._parse)
				this._parse();
			return this._tokens || [];
		},
		getPaths: function (callback, thisPtr) {
			if (this._compile) {
				if (callback && callback instanceof Function) {
					this._compile.call(this, function () {
						var paths = this._paths || [];
						callback.call(thisPtr || this, paths);
					}, this);
				} else {
					this._compile();
					return this._paths || [];
				}
			} else {
				return this._paths || [];
			}
		},
		convert: function (val) {
			if (val === undefined) {
				return this._undefinedString;
			}

			if (val === null) {
				return this._nullString;
			}

			if (val instanceof FormatError) {
				return val.get_invalidValue();
			}

			if (!this._convert) {
				return val;
			}

			return this._convert(val);
		},
		convertBack: function (val) {
			if (val === null || val == this._nullString) {
				return null;
			}

			if (val === undefined || val == this._undefinedString) {
				return;
			}

			if (val.constructor == String) {
				val = val.trim();

				if (val.length === 0) {
					return null;
				}
			}

			if (!this._convertBack) {
				return val;
			}

			try {
				return this._convertBack(val);
			}
			catch (err) {
				if (err instanceof FormatError) {
					return err;
				}
				else {
				    return new FormatError(this._description ? 
	                    Resource.get("format-with-description").replace('{description}', this._description) :
						Resource.get("format-without-description"),
								val);
				}
			}
		},
		toString: function() {
			return this._specifier;
		}	
	});

	Format.hasTokens = function hasTokens(template) {
		formatTemplateParser.lastIndex = 0;
		return formatTemplateParser.test(template);
	}

	ExoWeb.Model.Format = Format;

	// #endregion

	// #region ExoWeb.Model.Model
	//////////////////////////////////////////////////

	function Model() {
		this._types = {};
		this._ruleQueue = [];
	}

	Model.mixin(Functor.eventing);

	Model.mixin({
		dispose: function Model$dispose() {
			for (var key in this._types) {
				delete window[key];
			}
		},
		addType: function Model$addType(name, base, origin, format) {
			var type = new Type(this, name, base, origin, format);
			this._types[name] = type;
			return type;
		},
		type: function (name) {
			return this._types[name];
		},
		types: function (filter) {
			var result = [], typeName, type;
			for (typeName in this._types) {
				type = this._types[typeName];
				if (!filter || filter(type)) {
					result.push(type);
				}
			}
			return result;
		},
		addBeforeContextReady: function (handler) {
			// Only executes the given handler once, since the event should only fire once
			if (!this._contextReady) {
				this._addEvent("beforeContextReady", handler, null, true);
			}
			else {
				handler();
			}
		},

		// queues a rule to be registered
		registerRule: function Model$registerRule(rule) {
			if (!this._contextReady) {
				this._ruleQueue.push(rule);
			} else {
				rule.register();
			}
		},

		// register rules pending registration
		registerRules: function Model$registerRules() {
			var i, rules = this._ruleQueue;
			this._ruleQueue = [];
			for (i = 0; i < rules.length; i += 1) {
				rules[i].register();
			}
		},
		notifyBeforeContextReady: function () {
			this._contextReady = true;
			this.registerRules();
			this._raiseEvent("beforeContextReady", []);
		},
		addAfterPropertySet: function (handler) {
			this._addEvent("afterPropertySet", handler);
		},
		notifyAfterPropertySet: function (obj, property, newVal, oldVal) {
			this._raiseEvent("afterPropertySet", [obj, property, newVal, oldVal]);
		},
		addObjectRegistered: function (func, objectOrFunction, once) {
			this._addEvent("objectRegistered", func, objectOrFunction ? (objectOrFunction instanceof Function ? objectOrFunction : equals(objectOrFunction)) : null, once);
		},
		removeObjectRegistered: function (func) {
			this._removeEvent("objectRegistered", func);
		},
		notifyObjectRegistered: function (obj) {
			this._raiseEvent("objectRegistered", [obj]);
		},
		addObjectUnregistered: function (func) {
			this._addEvent("objectUnregistered", func);
		},
		notifyObjectUnregistered: function (obj) {
			this._raiseEvent("objectUnregistered", [obj]);
		},
		addListChanged: function (func) {
			this._addEvent("listChanged", func);
		},
		notifyListChanged: function (obj, property, changes) {
			this._raiseEvent("listChanged", [obj, property, changes]);
		},
		_ensureNamespace: function Model$_ensureNamespace(name, parentNamespace) {
			var result, nsTokens, target = parentNamespace;

			if (target.constructor === String) {
				nsTokens = target.split(".");
				target = window;
				Array.forEach(nsTokens, function (token) {
					target = target[token];

					if (target === undefined) {
						throw new Error("Parent namespace \"" + parentNamespace + "\" could not be found.");
					}
				});
			} else if (target === undefined || target === null) {
				target = window;
			}

			// create the namespace object if it doesn't exist, otherwise return the existing namespace
			if (!(name in target)) {
				result = target[name] = {};
				return result;
			} else {
				return target[name];
			}
		}
	});

	function ensureType(type, forceLoad, callback) {

		// immediately invoke the callback if no type was specified or the type is loaded
		if (!type || LazyLoader.isLoaded(type)) {
			return callback();
		}

		// force type loading if requested
		if (forceLoad) {
			LazyLoader.load(type, null, false, callback);
		}

		// otherwise, only continue processing when and if dependent types are loaded
		else {
			$extend(type._fullName, callback);
		}

		return null;
	}

	Model.property = function Model$property(path, thisType/*, forceLoadTypes, callback, thisPtr, waitForGlobals*/) {

		var type,
			loadProperty,
			singlePropertyName,
			tokens = null,
			forceLoadTypes = arguments.length >= 3 && typeof arguments[2] === "boolean" ? arguments[2] : false,
			callback = arguments[3],
			thisPtr = arguments[4],
			waitForGlobals = arguments.length >= 6 && typeof arguments[5] === "boolean" ? arguments[5] : true;

		// Allow the path argument to be either a string or PathTokens instance.
		if (path.constructor === PathTokens) {
			tokens = path;
			path = tokens.expression;
		}

		// Return cached property chains as soon as possible (in other words,
		// do as little as possible prior to returning the cached chain).
		if (thisType && thisType._chains && thisType._chains[path]) {
			if (callback) {
				callback.call(thisPtr || this, thisType._chains[path]);
				return null;
			} else {
				return thisType._chains[path];
			}
		}

		// The path argument was a string, so use it to create a PathTokens object.
		// Delay doing this as an optimization for cached property chains.
		if (!tokens) {
			tokens = new PathTokens(path);
		}

		// get the instance type, if specified
		type = thisType instanceof Function ? thisType.meta : thisType;

		// determine if a typecast was specified for the path to identify a specific subclass to use as the root type
		if (tokens.steps[0].property === "this" && tokens.steps[0].cast) {

			//Try and resolve cast to an actual type in the model
			type = Model.getJsType(tokens.steps[0].cast, false).meta;
			tokens.steps.dequeue();
		}

		// create a function to lazily load a property 
		loadProperty = function (containingType, propertyName, propertyCallback) {
			ensureType(containingType, forceLoadTypes, function () {
				propertyCallback.call(thisPtr || this, containingType.property(propertyName));
			});
		};

		// Optimize for a single property expression, as it is neither static nor a chain.
		if (tokens.steps.length === 1) {
			singlePropertyName = tokens.steps[0].property;
			if (callback) {
				loadProperty(type, singlePropertyName, callback);
			} else {
				var singleProperty = type.property(singlePropertyName);
				if (singleProperty) {
					return singleProperty;
				} else {
					throw new Error("Path '" + path + "' is not valid.");
				}
			}
		}

		// otherwise, first see if the path represents a property chain, and if not, a global property
		else {

			// predetermine the global type name and property name before seeing if the path is an instance path
			var globalTypeName = tokens.steps
				.slice(0, tokens.steps.length - 1)
				.map(function (item) { return item.property; })
				.join(".");

			var globalPropertyName = tokens.steps[tokens.steps.length - 1].property;

			// Copy of the Model.property arguments for async re-entry.
			var outerArgs = Array.prototype.slice.call(arguments);

			// create a function to see if the path is a global property if instance processing fails
			var processGlobal = function (instanceParseError) {

				// Retrieve the javascript type by name.
				type = Model.getJsType(globalTypeName, true);

				// Handle non-existant or non-loaded type.
				if (!type) {
					if (callback) {
						if (waitForGlobals) {
							// Retry when type is loaded
							$extend(globalTypeName, Model.property.prepare(Model, outerArgs));
							return null;
						} else {
							callback(null);
							return null;
						}
					} else {
						return null;
					}
				}

				// Get the corresponding meta type.
				type = type.meta;

				// return the static property
				if (callback) {
					loadProperty(type, globalPropertyName, callback);
				} else {
					return type.property(globalPropertyName);
				}
			};

			if (callback) {
				PropertyChain.create(type, tokens, forceLoadTypes, thisPtr ? callback.bind(thisPtr) : callback, processGlobal);
			} else {
				var result = PropertyChain.create(type, tokens, forceLoadTypes) || processGlobal();
				if (result) {
					return result;
				} else {
					throw new Error("Path '" + path + "' is not valid.");
				}
			}
		}
	};

	Model.intrinsicJsTypes = ["Object", "String", "Number", "Boolean", "Date", "TimeSpan", "Array"];
	Model.types = {};
	Model.getJsType = function Model$getJsType(name, allowUndefined) {
		/// <summary>
		/// Retrieves the JavaScript constructor function corresponding to the given full type name.
		/// </summary>
		/// <returns type="Object" />

		var obj = Model.types;
		var steps = name.split(".");
		if (steps.length === 1 && Model.intrinsicJsTypes.indexOf(name) > -1) {
			return window[name];
		}
		else {
			for (var i = 0; i < steps.length; i++) {
				var step = steps[i];
				obj = obj[step];
				if (obj === undefined) {
					if (allowUndefined) {
						return;
					}
					else {
						throw new Error($format("The type \"{0}\" could not be found.  Failed on step \"{1}\".", [name, step]));
					}
				}
			}
			return obj;
		}
	};

	ExoWeb.Model.Model = Model;

	// #endregion

	// #region ExoWeb.Model.Entity
	//////////////////////////////////////////////////

	function Entity() {
	}

	function forEachProperty(obj, callback, thisPtr) {
		for (var prop in obj) {
			callback.call(thisPtr || this, prop, obj[prop]);
		}
	}

	function getProperties(/*[properties] or [propName, propValue] */) {
		if (arguments.length === 2) {
			var properties = {};
			properties[arguments[0]] = arguments[1];
			return properties;
		}
		else {
			return arguments[0];
		}
	}

	Entity.mixin({
		init: function Entity$init(/*[properties] or [propName, propValue] */) {
			forEachProperty(getProperties.apply(this, arguments), function (name, value) {
				var prop = this.meta.type.property(name);

				if (!prop) {
					throw new Error("Could not find property \"" + name + "\" on type \"" + this.meta.type.get_fullName() + "\".");
				}

				// Initialization is not force.  If the propery already has a value it will be ignored.
				Property$_init.call(prop, this, value);
			}, this);
		},
		set: function Entity$set(/*[properties] or [propName, propValue] */) {
			forEachProperty(getProperties.apply(this, arguments), function (name, value) {
				var prop = this.meta.type.property(name);
				if (!prop) {
					throw new Error("Could not find property \"" + name + "\" on type \"" + this.meta.type.get_fullName() + "\".");
				}

				Property$_setter.call(prop, this, value, false);
			}, this);
		},
		get: function Entity$get(propName) {
			return this.meta.type.property(propName).value(this);
		},
		toString: function Entity$toString(format) {
			if (format) {
				format = getFormat(this.constructor, format);
			}
			else {
				format = this.meta.type.get_format();
			}

			if (format)
				return format.convert(this);
			else
				return Entity.toIdString(this);
		}
	});

	// Gets the typed string id suitable for roundtripping via fromIdString
	Entity.toIdString = function Entity$toIdString(obj) {
		return $format("{0}|{1}", [obj.meta.type.get_fullName(), obj.meta.id]);
	};

	// Gets or loads the entity with the specified typed string id
	Entity.fromIdString = function Entity$fromIdString(idString) {
		// Typed identifiers take the form "type|id".
	    var type = idString.substring(0, idString.indexOf("|"));
	    var id = idString.substring(type.length + 1);

		// Use the left-hand portion of the id string as the object's type.
		var jstype = ExoWeb.Model.Model.getJsType(type);

		// Retrieve the object with the given id.
		return jstype.meta.get(id,
			// Typed identifiers may or may not be the exact type of the instance.
			// An id string may be constructed with only knowledge of the base type.
			false
		);
	};

	ExoWeb.Model.Entity = Entity;

	// #endregion

	// #region ExoWeb.Model.Type
	//////////////////////////////////////////////////

	function Type(model, name, baseType, origin) {
		this._fullName = name;

		// if origin is not provided it is assumed to be client
		this._origin = origin || "client";
		this._originForNewProperties = this._origin;

		this._pool = {};
		this._legacyPool = {};
		this._counter = 0;
		this._properties = {}; 
		this._instanceProperties = {};
		this._staticProperties = {};
		this._pendingInit = [];
		this._pendingInvocation = [];

		// define properties
		Object.defineProperty(this, "model", { value: model });
		Object.defineProperty(this, "rules", { value: [] });

		// generate class and constructor
		var jstype = Model.getJsType(name, true);

		// create namespaces as needed
		var nameTokens = name.split("."),
			token = nameTokens.dequeue(),
			namespaceObj = Model.types,
			globalObj = window;

		while (nameTokens.length > 0) {
			namespaceObj = model._ensureNamespace(token, namespaceObj);
			globalObj = model._ensureNamespace(token, globalObj);
			token = nameTokens.dequeue();
		}

		// the final name to use is the last token
		var finalName = token;
		jstype = generateClass(this);

		this._jstype = jstype;

		// If the namespace already contains a type with this name, append a '$' to the name
		if (!namespaceObj[finalName]) {
			namespaceObj[finalName] = jstype;
		}
		else {
			namespaceObj['$' + finalName] = jstype;
		}

		// If the global object already contains a type with this name, append a '$' to the name
		if (!globalObj[finalName]) {
			globalObj[finalName] = jstype;
		}
		else {
			globalObj['$' + finalName] = jstype;
		}

		// setup inheritance
		this.derivedTypes = [];
		var baseJsType;

		if (baseType) {
			baseJsType = baseType._jstype;

			this.baseType = baseType;
			baseType.derivedTypes.push(this);
		
			// inherit all shortcut properties that have aleady been defined
			inheritBaseTypePropShortcuts(jstype, baseType);
		}
		else {
			baseJsType = Entity;
			this.baseType = null;
		}

		disableConstruction = true;
		this._jstype.prototype = new baseJsType();
		disableConstruction = false;

		this._jstype.prototype.constructor = this._jstype;

		// helpers
		jstype.meta = this;

		// Add self-reference to decrease the likelihood of errors
		// due to an absence of the necessary type vs. entity.
		this.type = this;
	}

	// copy shortcut properties from a base meta type (recursively) to a target jstype
	function inheritBaseTypePropShortcuts(jstype, baseType) {
		for (var propName in baseType._properties) {
			jstype["$" + propName] = baseType._properties[propName];
		}

		// recursively add base type properties
		if (baseType.baseType) {
			inheritBaseTypePropShortcuts(jstype, baseType.baseType);
		}
	}

	var disableConstruction = false;

	var validateId = function Type$validateId(type, id) {
		if (id === null || id === undefined) {
			throw new Error($format("Id cannot be {0} (entity = {1}).", id === null ? "null" : "undefined", type.get_fullName()));
		}
		else if (!ExoWeb.isString(id)) {
			throw new Error($format("Id must be a string:  encountered id {0} of type \"{1}\" (entity = {2}).",
				id.toString(), parseFunctionName(id.constructor), type.get_fullName()));
		}
		else if (id === "") {
			throw new Error($format("Id cannot be a blank string (entity = {0}).", type.get_fullName()));
		}
	};

	function generateClass(type) {
		function construct(idOrProps, props, suppressModelEvent) {
			if (!disableConstruction) {
				if (idOrProps && idOrProps.constructor === String) {
					var id = idOrProps;
					var obj = type.get(id,
						// When a constructor is called we do not want to silently
						// return an instance of a sub type, so fetch using exact type.
						true,
						// Indicate that an object is currently being constructed.
						true);

					// If the instance already exists, then initialize properties and return it.
					if (obj) {
						if (props) {
							obj.init(props);
						}
						return obj;
					}

					// Register the newly constructed existing instance.
					type.register(this, id, suppressModelEvent);

					// Initialize properties if provided.
					if (props) {
						this.init(props);
					}
				}
				else {
					// Register the newly constructed new instance. It will
					// be assigned a sequential client-generated id.
					type.register(this, null, suppressModelEvent);

					// Set properties passed into constructor.
					if (idOrProps) {
						this.set(idOrProps);
					}

					// Raise initNew event if registered.
					for (var t = type; t; t = t.baseType) {
						var handler = t._getEventHandler("initNew");
						if (handler) {
							handler(this, {});
						}
					}
				}
			}
		}

		return construct;
	}

	var newIdPrefix = "+c";

	Type.getNewIdPrefix = function getNewIdPrefix() {
		if (arguments.length > 0) throw new Error("The method getNewIdPrefix does not accept arguments");
		return newIdPrefix.substring(1);
	};

	Type.setNewIdPrefix = function setNewIdPrefix(prefix) {
		if (prefix === null || prefix === undefined) throw new Error("The new id prefix argument is required");
		if (typeof(prefix) !== "string") throw new TypeError("The new id prefix must be a string, found " + prefix.toString());
		if (prefix.length === 0) throw new Error("The new id prefix cannot be empty string");
		newIdPrefix = "+" + prefix;
	};

	Type.prototype = {
		// gets and optionally sets the pending initialization status for a static property on the type
		pendingInvocation: function Type$pendingInvocation(rule, value) {
			var indexOfRule = this._pendingInvocation.indexOf(rule);
			if (arguments.length > 1) {
				if (value && indexOfRule < 0) {
					this._pendingInvocation.push(rule);
				}
				else if (!value && indexOfRule >= 0) {
					this._pendingInvocation.splice(indexOfRule, 1);
				}
			}
			return indexOfRule >= 0;
		},

		addInitNew: function Type$addInitNew(handler, obj, once) {
			this._addEvent("initNew", handler, obj ? equals(obj) : null, once);
			return this;
		},

		// gets and optionally sets the pending initialization status for a static property on the type
		pendingInit: function Type$pendingInit(prop, value) {
			var result = this[prop._fieldName] === undefined || this._pendingInit[prop.get_name()] === true;
			if (arguments.length > 1) {
				if (value) {
					this._pendingInit[prop.get_name()] = true;
				}
				else {
					delete this._pendingInit[prop.get_name()];
				}
			}
			return result;
		},
		addInitExisting: function Type$addInitExisting(handler, obj, once) {
			this._addEvent("initExisting", handler, obj ? equals(obj) : null, once);
			return this;
		},
		newId: function Type$newId() {
			// Get the next id for this type's heirarchy.
			for (var nextId, type = this; type; type = type.baseType) {
				nextId = Math.max(nextId || 0, type._counter);
			}

			// Update the counter for each type in the heirarchy.
			for (var type = this; type; type = type.baseType) {
				type._counter = nextId + 1;
			}

			// Return the new id.
			return newIdPrefix + nextId;
		},
		register: function Type$register(obj, id, suppressModelEvent) {
			// register is called with single argument from default constructor
			if (arguments.length === 2) {
				validateId(this, id);
			}

			obj.meta = new ObjectMeta(this, obj);

			if (!id) {
				id = this.newId();
				obj.meta.isNew = true;
			}

			var key = id.toLowerCase();

			obj.meta.id = id;
			Observer.makeObservable(obj);

			for (var t = this; t; t = t.baseType) {
				if (t._pool.hasOwnProperty(key)) {
					throw new Error($format("Object \"{0}|{1}\" has already been registered.", this.get_fullName(), id));
				}

				t._pool[key] = obj;
				if (t._known) {
					t._known.add(obj);
				}
			}

			if (!suppressModelEvent) {
				this.model.notifyObjectRegistered(obj);
			}
		},
		changeObjectId: function Type$changeObjectId(oldId, newId) {
			validateId(this, oldId);
			validateId(this, newId);

			var oldKey = oldId.toLowerCase();
			var newKey = newId.toLowerCase();

			var obj = this._pool[oldKey];

			if (obj) {
				obj.meta.legacyId = oldId;

				for (var t = this; t; t = t.baseType) {
					t._pool[newKey] = obj;

					delete t._pool[oldKey];

					t._legacyPool[oldKey] = obj;
				}

				obj.meta.id = newId;

				return obj;
			}
			else {
				logWarning($format("Attempting to change id: Instance of type \"{0}\" with id = \"{1}\" could not be found.", this.get_fullName(), oldId));
			}
		},
		unregister: function Type$unregister(obj) {
			for (var t = this; t; t = t.baseType) {
				delete t._pool[obj.meta.id.toLowerCase()];

				if (obj.meta.legacyId) {
					delete t._legacyPool[obj.meta.legacyId.toLowerCase()];
				}

				if (t._known) {
					t._known.remove(obj);
				}
			}

			this.model.notifyObjectUnregistered(obj);
		},
		get: function Type$get(id, exactTypeOnly) {
			validateId(this, id);

			var key = id.toLowerCase();
			var obj = this._pool[key] || this._legacyPool[key];

			// If exactTypeOnly is specified, don't return sub-types.
			if (obj && exactTypeOnly === true && obj.meta.type !== this) {
				throw new Error($format("The entity with id='{0}' is expected to be of type '{1}' but found type '{2}'.", id, this._fullName, obj.meta.type._fullName));
			}

			return obj;
		},
		// Gets an array of all objects of this type that have been registered.
		// The returned array is observable and collection changed events will be raised
		// when new objects are registered or unregistered.
		// The array is in no particular order.
		known: function Type$known() {
			var list = this._known;
			if (!list) {
				list = this._known = [];

				for (var id in this._pool) {
					list.push(this._pool[id]);
				}

				Observer.makeObservable(list);
			}

			return list;
		},
		addPropertyAdded: function (handler) {
			this._addEvent("propertyAdded", handler);
		},
		addRule: function Type$addRule(def) {
			return new Rule(this, def);
		},
		addProperty: function Type$addProperty(def) {
			var format = def.format;
			if (format && format.constructor === String) {
				format = getFormat(def.type, format);
			}

			var prop = new Property(this, def.name, def.type, def.label, def.helptext, format, def.isList, def.isStatic, def.isPersisted, def.isCalculated, def.index, def.defaultValue, def.constant);

			this._properties[def.name] = prop;
			(def.isStatic ? this._staticProperties : this._instanceProperties)[def.name] = prop;

			// modify jstype to include functionality based on the type definition
			function genPropertyShortcut(mtype, overwrite) {
				var shortcutName = "$" + def.name;
				if (!(shortcutName in mtype._jstype) || overwrite) {
					mtype._jstype[shortcutName] = prop;
				}

				mtype.derivedTypes.forEach(function (t) {
					genPropertyShortcut(t, false);
				});
			}
			genPropertyShortcut(this, true);

			if (prop.get_isStatic()) {
				// for static properties add member to javascript type
				this._jstype["get_" + def.name] = this._makeGetter(prop, Property$_getter.bind(prop), true);
			}
			else {
				// for instance properties add member to all instances of this javascript type
				this._jstype.prototype["get_" + def.name] = this._makeGetter(prop, Property$_getter.bind(prop), true);
			}

			if (prop.get_isStatic()) {
				this._jstype["set_" + def.name] = this._makeSetter(prop);
			}
			else {
				this._jstype.prototype["set_" + def.name] = this._makeSetter(prop);
			}

			this._raiseEvent("propertyAdded", [this, { property: prop}]);

			return prop;
		},
		addMethod: function Type$addMethod(def) {
			var methodName = this.get_fullName() + "." + def.name;
			var method = function () {
				//signature: p1, p2, p#, paths, onSuccess, onFail

				// Detect the optional success and failure callback delegates
				var onSuccess;
				var onFail;
				var paths = null;

				if (arguments.length > 1) {
					onSuccess = arguments[arguments.length - 2];
					if (onSuccess instanceof Function) {
						onFail = arguments[arguments.length - 1];
					}
					else {
						onSuccess = arguments[arguments.length - 1];
					}
				}
				else if (arguments.length > 0)
					onSuccess = arguments[arguments.length - 1];

				if (!(onSuccess instanceof Function))
					onSuccess = undefined;

				var onSuccessFn = function (result) {
					if (onSuccess !== undefined) {
						onSuccess(result.event);
					}
				};

				var argCount = arguments.length - (onSuccess === undefined ? 0 : 1) - (onFail === undefined ? 0 : 1);
				var firstArgCouldBeParameterSet = argCount > 0 && arguments[0] instanceof Object && !(def.parameters.length === 0 || arguments[0][def.parameters[0]] === undefined);
				var instance = this instanceof Entity ? this : null;

				if (argCount >= 1 && argCount <= 2 && arguments[0] instanceof Object &&
						((argCount == 1 && (def.parameters.length != 1 || firstArgCouldBeParameterSet)) ||
						((argCount == 2 && (def.parameters.length != 2 || (firstArgCouldBeParameterSet && arguments[1] instanceof Array)))))) {

					// Invoke the server event
					context.server.raiseServerEvent(methodName, instance, arguments[0], false, onSuccessFn, onFail, argCount == 2 ? arguments[1] : null);
				}

				// Otherwise, assume that the parameters were all passed in sequential order
				else {
					// Throw an error if the incorrect number of arguments were passed to the method
					if (def.parameters.length == argCount - 1 && arguments[argCount - 1] instanceof Array)
						paths = arguments[argCount - 1];
					else if (def.parameters.length != argCount)
						throw new Error($format("Invalid number of arguments passed to \"{0}.{1}\" method.", this._fullName, def.name));

					if (def.isStatic && paths)
						throw new Error($format("Cannot include paths when invoking a static method - \"{0}.{1}\".", this.meta._fullName, def.name));

					// Construct the arguments to pass
					var args = {};
					for (var parameter in def.parameters) {
						if (def.parameters.hasOwnProperty(parameter)) {
							args[def.parameters[parameter]] = arguments[parameter];
						}
					}

					// Invoke the server event
					context.server.raiseServerEvent(methodName, instance, args, false, onSuccessFn, onFail, paths);
				}
			};

			// Assign the method to the type for static methods, otherwise assign it to the prototype for instance methods
			if (def.isStatic) {
				this._jstype[def.name] = method;
			}
			else {
				this._jstype.prototype[def.name] = method;
			}

		},	
		getPath: function(path) {
			// Get single property
			var property = this.property(path);
		
			// Create property chain
			if (!property) {
				property = PropertyChain.create(this, new ExoWeb.Model.PathTokens(path));
			}

			// Return the property path
			return property;
		},
		getPaths: function(path) {
			var start = 0;
			var paths = [];

			// Process the path
			if (/{|,|}/g.test(path)) {
				var stack = [];
				var parent;

				for (var i = 0, len = path.length; i < len; ++i) {
					var c = path.charAt(i);

					if (c === "{" || c === "," || c === "}") {
						var seg = path.substring(start, i).trim();
						start = i + 1;

						if (c === "{") {
							if (parent) {
								stack.push(parent);
								parent += "." + seg;
							}
							else {
								parent = seg;
							}
						}
						else { // ',' or '}'
							if (seg.length > 0) {
								paths.push(this.getPath(parent ? parent + "." + seg : seg));
							}

							if (c === "}") {
								parent = (stack.length === 0) ? undefined : stack.pop();
							}
						}
					}
				}

				if (stack.length > 0 || parent) {
					throw new Error("Unclosed '{' in path: " + path);
				}

				if (start < path.length) {
					var _seg = path.substring(start).trim();
					if (_seg.length > 0) {
						paths.push(this.getPath(_seg));
					}

					// Set start to past the end of the list to indicate that the entire string was processed
					start = path.length;
				}
			}

			// If the input is a simple property or path, then add the single property or chain
			if (start === 0) {
				paths.push(this.getPath(path.trim()));
			}

			return paths;
		},
		_makeGetter: function Type$_makeGetter(property, getter, skipTypeCheck) {
			return function () {
				// ensure the property is initialized
				var result = getter.call(property, this, skipTypeCheck);

				// ensure the property is initialized
				if (result === undefined || (property.get_isList() && LazyLoader.isRegistered(result))) {
					throw new Error($format(
						"Property {0}.{1} is not initialized.  Make sure instances are loaded before accessing property values.  {2}|{3}",
						property._containingType.get_fullName(),
						property.get_name(),
						this.meta.type.get_fullName(),
						this.meta.id
					));
				}

				// return the result
				return result;
			};
		},
		_makeSetter: function Type$_makeSetter(prop) {
			var setter = function (val) {
				Property$_setter.call(prop, this, val, true);
			};

			setter.__notifies = true;

			return setter;
		},
		get_format: function Type$get_format() {
			return this._format ? this._format : (this.baseType ? this.baseType.get_format() : undefined);
		},
		set_format: function Type$set_format(value) {
			if (value && value.constructor == String)
				value = getFormat(this.get_jstype(), value);
			this._format = value;
		},
		get_fullName: function Type$get_fullName() {
			return this._fullName;
		},
		get_jstype: function Type$get_jstype() {
			return this._jstype;
		},
		get_properties: function Type$get_properties() {
			return ExoWeb.objectToArray(this._properties);
		},
		get_allproperties: function Type$get_allproperties() {
			var temp = ExoWeb.objectToArray(this._properties);

			//go up the base types until there are no more
			var tempObj = this;
			while (tempObj.baseType) {
				tempObj = tempObj.baseType;
				temp = tempObj.get_properties().concat(temp);
			}

			return temp;
		},
		get_baseproperties: function Type$get_baseproperties() {
			var temp = new Array();

			//go up the base types until there are no more
			var tempObj = this;
			var alreadyBase = true;
			while (tempObj.baseType) {
				tempObj = tempObj.baseType;
				temp = tempObj.get_properties().concat(temp);
				alreadyBase = false;
			}

			if (alreadyBase)
				temp = tempObj.get_properties();

			return temp;
		},
		get_staticProperties: function Type$get_staticProperties() {
			return this._staticProperties;
		},
		get_instanceProperties: function Type$get_instanceProperties() {
			return this._instanceProperties;
		},
		property: function Type$property(name) {
			var prop;
			for (var t = this; t && !prop; t = t.baseType) {
				prop = t._properties[name];

				if (prop) {
					return prop;
				}
			}
			return null;
		},
		conditionIf: function (options) {
			new ExoWeb.Model.Rule.condition(this, options);
			return this;
		},
		set_originForNewProperties: function Type$set_originForNewProperties(value) {
			this._originForNewProperties = value;
		},
		get_originForNewProperties: function Type$get_originForNewProperties() {
			return this._originForNewProperties;
		},
		set_origin: function Type$set_origin(value) {
			this._origin = value;
		},
		get_origin: function Type$get_origin() {
			return this._origin;
		},
		compileExpression: function Type$compile(expression) {

			// use exports if required
			if (this._exports || ExoWeb.config.expressionScope) {
				expression = "return function() { return " + expression + "; }";
				var args;
				var values;

				// Include exported functions, if specified
				if (this._exports) {
					args = this._exports.names;
					values = this._exports.implementations;
				}

				// Include global expression scope variables, is specified
				if (ExoWeb.config.expressionScope) {
					if (!ExoWeb.config.expressionScope._names) {
						var scopeNames = [];
						var scopeValues = [];
						for(var key in ExoWeb.config.expressionScope){
							scopeNames.push(key);
							scopeValues.push(ExoWeb.config.expressionScope[key]);
						}
						ExoWeb.config.expressionScope._names = scopeNames;
						ExoWeb.config.expressionScope._values = scopeValues;
					}
					args = args ? args.concat(ExoWeb.config.expressionScope._names) : ExoWeb.config.expressionScope._names;
					values = values ? values.concat(ExoWeb.config.expressionScope._values) : ExoWeb.config.expressionScope._values;
				}

				// Compile the expression using the specified exported functions and global scope variables
				var compile = Function.apply(null, args.concat([expression]));
				return compile.apply(null, values);
			}

			// otherwise, just create the function based on the expression
			else {
				return new Function("return " + expression + ";");
			}
		},
		set_exports: function Type$set_exports(exports) {
			var names = [];
			var script = "return ["
			for (var name in exports) {
				names.push(name);
				script += exports[name] + ",";
			}
			if (script.length > 8) {
				script = script.slice(0, -1) + "];";
				this._exports = { names: names, implementations: new Function(script)() };
			}
		},
		// Adds a single export function to the type for use by calls to compileExpression().
		addExport: function Type$addExport(name, fn) {
			if (!this._exports) {
				this._exports = { names: [name], implementations: new Function("return [" + fn + "];")() };
			}
			else if (this._exports.names.indexOf(name) === -1) {
				this._exports.names.push(name);
				this._exports.implementations.push(new Function("return " + fn)());
			}
		
		},
		eachBaseType: function Type$eachBaseType(callback, thisPtr) {
			for (var baseType = this.baseType; !!baseType; baseType = baseType.baseType) {
				if (callback.call(thisPtr || this, baseType) === false) {
					return;
				}
			}
		},
		isSubclassOf: function Type$isSubclassOf(mtype) {
			var result = false;

			this.eachBaseType(function (baseType) {
				if (baseType === mtype) {
					result = true;
					return false;
				}
			});

			return result;
		},
		isLoaded: function (prop) {
			/// <summary locid="M:J#ExoWeb.Model.Type.isLoaded">
			/// Check whether the Type and optional property are loaded.
			/// </summary>
			/// <param name="prop" optional="true" mayBeNull="true" type="Object">The optional property object or property name to check.</param>

			// First see if there is a lazy loader attached to the entity (and optional property).
			if (LazyLoader.isRegistered(this, null, prop)) {
				return false;
			}

			// Immediately return true if a property name was not specified
			if (prop) {
				// Coerce property names into property instances
				if (isString(prop)) {
					prop = this.property(prop);
				}

				// Otherwise, get the property value and determine whether there is a
				// lazy loader attached to the property value, e.g. entity or list.
				var val = prop.value(this._jstype);
				if (val !== null && val !== undefined && LazyLoader.isRegistered(val)) {
					return false;
				}
			}

			return true;
		},
		toString: function Type$toString() {
			return this.get_fullName();
		},
		addConditionsChanged: function Type$addConditionsChanged(handler, criteria) {
			var filter;

			// condition type filter
			if (criteria instanceof ConditionType) {
				filter = function (sender, args) { return args.conditionTarget.condition.type === criteria; };
			}

				// property filter
			else if (criteria instanceof Property || criteria instanceof PropertyChain) {
				criteria = criteria.lastProperty();
				filter = function (sender, args) { return args.conditionTarget.properties.indexOf(criteria) >= 0; };
			}

			// subscribe to the event
			this._addEvent("conditionsChanged", handler, filter);

			// Return the type meta to support method chaining
			return this;
		},
		removeConditionsChanged: function Type$removeConditionsChanged(handler) {
			this._removeEvent("conditionsChanged", handler);
		}
	};

	Type.mixin(Functor.eventing);
	ExoWeb.Model.Type = Type;

	// #endregion

	// #region ExoWeb.Model.Property
	//////////////////////////////////////////////////

	//////////////////////////////////////////////////////////////////////////////////////
	/// <remarks>
	/// If the interface for this class is changed it should also be changed in
	/// PropertyChain, since PropertyChain acts as an aggregation of properties 
	/// that can be treated as a single property.
	/// </remarks>
	///////////////////////////////////////////////////////////////////////////////
	function Property(containingType, name, jstype, label, helptext, format, isList, isStatic, isPersisted, isCalculated, index, defaultValue, constant) {
		this._containingType = containingType;
		this._name = name;
		this._fieldName = "_" + name;
		this._jstype = jstype;
		this._label = label || makeHumanReadable(name);
		this._helptext = helptext;
		this._format = format;
		this._isList = isList === true;
		this._isStatic = isStatic === true;
		this._isPersisted = isPersisted === true;
		this._isCalculated = isCalculated === true;
		this._index = index;
		this._defaultValue =
			defaultValue !== undefined ? defaultValue :
				isList ? [] :
					jstype === Boolean ? false :
						jstype === Number ? 0 :
							null;

		this._constant = null;
		if (constant !== null && constant !== undefined) {
			// constant value should be lazily initialized to ensure any type dependencies have been resolved
			if (isList && constant instanceof Array) {
				this._constant = function () {
					return constant.map(function (i) {
						return new jstype(i);
					});
				};
			}
			else if (!isList && typeof constant === "object") {
				this._constant = function () {
					new jstype(i);
				};
			}
		}

		this._rules = [];

		if (containingType.get_originForNewProperties()) {
			this._origin = containingType.get_originForNewProperties();
		}

		if (this._origin === "client" && this._isPersisted) {
			logWarning($format("Client-origin properties should not be marked as persisted: Type = {0}, Name = {1}", containingType.get_fullName(), name));
		}
	}

	// updates the property and message or conditionType options for property rules
	function preparePropertyRuleOptions(property, options, error) {
		options.property = property;
		if (error && error.constructor === String) {
			options.message = error;
		}
		else if (error instanceof ConditionType) {
			options.conditionType = error;
		}
		return options;
	}

	// updates the property and message or conditionType options for property rules
	function hasPropertyChangedSubscribers(property, obj) {
		var changedEvent = property._getEventHandler("changed");
		return changedEvent && !changedEvent.isEmpty([obj]);
	}

	// registers a rule with a specific property
	function registerPropertyRule(property, rule) {
		property._rules.push(rule);

		// Raise events if registered.
		var ruleRegisteredEvent = property._getEventHandler("ruleRegistered");
		if (ruleRegisteredEvent && !ruleRegisteredEvent.isEmpty()) {
			ruleRegisteredEvent(rule, { property: property });
		}
	}

	function Property$_init(obj, val, force) {
		var target = (this._isStatic ? this._containingType.get_jstype() : obj);
		var curVal = target[this._fieldName];

		if (curVal !== undefined && !(force === undefined || force)) {
			return;
		}

		target[this._fieldName] = val;

		target.meta.pendingInit(this, false);

		if (val instanceof Array) {
			var _this = this;
			Observer.makeObservable(val);
			Observer.addCollectionChanged(val, function Property$collectionChanged(sender, args) {
				var changes = args.get_changes();

				// Don't raise the change event unless there is actually a change to the collection
				if (changes && changes.some(function (change) { return (change.newItems && change.newItems.length > 0) || (change.oldItems && change.oldItems.length > 0); })) {
					// NOTE: property change should be broadcast before rules are run so that if 
					// any rule causes a roundtrip to the server these changes will be available
					_this._containingType.model.notifyListChanged(target, _this, changes);

					// NOTE: oldValue is not currently implemented for lists
					_this._raiseEvent("changed", [target, { property: _this, newValue: val, oldValue: undefined, changes: changes, collectionChanged: true }]);

					Observer.raisePropertyChanged(target, _this._name);
				}
			});

			// Override the default toString on arrays so that we get a comma-delimited list
			val.toString = Property$_arrayToString.bind(val);
		}

		Observer.raisePropertyChanged(target, this._name);

		// Return the property to support method chaining
		return this;
	}

	function Property$_arrayToString() {
		return this.join(", ");
	}

	function Property$_ensureInited(obj) {
		// Determine if the property has been initialized with a value
		// and initialize the property if necessary
		if (!obj.hasOwnProperty(this._fieldName)) {

			// Do not initialize calculated properties. Calculated properties should be initialized using a property get rule.  
			if (!this.get_isCalculated()) {
				var value = this.get_constant() !== null ? this.get_constant() : this.get_defaultValue();
				Property$_init.call(this, obj, value);
			}

			// Mark the property as pending initialization
			obj.meta.pendingInit(this, true);
		}
	}

	function Property$_getter(obj) {
		// Ensure the entity is loaded before accessing property values
		if (LazyLoader.isRegistered(obj)) {
			return;
		}

		// Ensure that the property has an initial (possibly default) value
		Property$_ensureInited.call(this, obj);

		// Raise get events
		// NOTE: get events may result in a change, so the value cannot be cached
		var getEvent = this._getEventHandler("get");
		if (getEvent && !getEvent.isEmpty()) {
			getEvent(obj, { property: this, value: obj[this._fieldName] });
		}

		// Return the property value
		return obj[this._fieldName];
	}

	function Property$_setter(obj, val, skipTypeCheck, additionalArgs) {
		// Ensure the entity is loaded before setting property values
		if (LazyLoader.isRegistered(obj)) {
			throw new Error("Cannot set " + this.get_name() + "=" + (val === undefined ? "<undefined>" : val) + " for instance " + obj.meta.type.get_fullName() + "|" + obj.meta.id + ": object is ghosted.");
		}

		// Ensure that the property has an initial (possibly default) value
		Property$_ensureInited.call(this, obj);

		if (!this.canSetValue(obj, val)) {
			throw new Error("Cannot set " + this.get_name() + "=" + (val === undefined ? "<undefined>" : val) + " for instance " + obj.meta.type.get_fullName() + "|" + obj.meta.id + ": a value of type " + (this._jstype && this._jstype.meta ? this._jstype.meta.get_fullName() : parseFunctionName(this._jstype)) + " was expected.");
		}

		var old = obj[this._fieldName];

		// Update lists as batch remove/add operations
		if (this.get_isList()) {
			old.beginUpdate();
			update(old, val);
			old.endUpdate();
		}
		else {

			// compare values so that this check is accurate for primitives
			var oldValue = (old === undefined || old === null) ? old : old.valueOf();
			var newValue = (val === undefined || val === null) ? val : val.valueOf();

			// Do nothing if the new value is the same as the old value. Account for NaN numbers, which are
			// not equivalent (even to themselves). Although isNaN returns true for non-Number values, we won't
			// get this far for Number properties unless the value is actually of type Number (a number or NaN).
			if (oldValue !== newValue && !(this._jstype === Number && isNaN(oldValue) && isNaN(newValue))) {
				// Set the backing field value
				obj[this._fieldName] = val;

				obj.meta.pendingInit(this, false);

				// Do not raise change if the property has not been initialized. 
				if (old !== undefined) {
					this.raiseChanged(obj, val, old, additionalArgs);
				}
			}
		}
	}

	Property.mixin({

		defaultValue: function Property$defaultValue(value) {
			this._defaultValue = value;
			return this;
		},

		equals: function Property$equals(prop) {
			if (prop !== undefined && prop !== null) {
				if (prop instanceof Property) {
					return this === prop;
				}
				else if (prop instanceof PropertyChain) {
					var props = prop.all();
					return props.length === 1 && this.equals(props[0]);
				}
			}
		},

		raiseChanged: function (obj, val, old, additionalArgs) {
			// NOTE: property change should be broadcast before rules are run so that if 
			// any rule causes a roundtrip to the server these changes will be available
			this._containingType.model.notifyAfterPropertySet(obj, this, val, old);

			var changedEvent = this._getEventHandler("changed");
			if (changedEvent && !changedEvent.isEmpty()) {
				// Create the event argument object
				var args = { property: this, newValue: val, oldValue: old };

				// Assign custom event argument values
				if (additionalArgs) {
					for (var p in additionalArgs) {
						if (additionalArgs.hasOwnProperty(p)) {
							args[p] = additionalArgs[p];
						}
					}
				}

				changedEvent(obj, args);
			}

			Observer.raisePropertyChanged(obj, this._name);
		},

		rule: function (type) {
			if (type == null) throw new ArgumentNullError("type");
			if (typeof (type) !== "function") throw new ArgumentTypeError("type", "function", type);

			return first(this._rules, function (rule) {
				if (rule instanceof type) {
					return true;
				}
			});
		},
		rules: function (filter) {
			return filter && filter instanceof Function ? this._rules.filter(filter) : this._rules.slice();
		},
		addRuleRegistered: function Property$addRuleRegistered(handler, obj, once) {
			this._addEvent("ruleRegistered", handler, obj ? equals(obj) : null, once);
			return this;
		},
		removeRuleRegistered: function Property$removeRuleRegistered(handler, obj, once) {
			this._removeEvent("ruleRegistered", handler);
			return this;
		},

		toString: function Property$toString() {
			if (this._isStatic) {
				return this.get_path();
			}
			else {
				return $format("this<{0}>.{1}", [this.get_containingType(), this.get_name()]);
			}
		},

		get_containingType: function Property$get_containingType() {
			return this._containingType;
		},
		isDefinedBy: function Property$isDefinedBy(mtype) {
			return this._containingType === mtype || mtype.isSubclassOf(this._containingType);
		},

		get_jstype: function Property$get_jstype() {
			return this._jstype;
		},

		get_index: function Property$get_index() {
			return this._index;
		},

		get_format: function Property$get_format() {
			if (!this._format) {
				if (this._jstype.meta instanceof ExoWeb.Model.Type)
					this._format = this._jstype.meta.get_format(); // Default to type-level formats for entity types
				else
					this._format = getFormat(this._jstype, "G"); // Default to general format for non-entity type
			}
			return this._format;
		},
		set_format: function Property$set_format(value) {
			this._format = getFormat(this._jstype, value);
		},
		format: function (val) {
			return this.get_format() ? this.get_format().convert(val) : val;
		},

		get_defaultValue: function Property$get_defaultValue() {
			// clone array and date defaults since they are mutable javascript types
			return this._defaultValue instanceof Array ? this._defaultValue.slice() :
				this._defaultValue instanceof Date ? new Date(+this._defaultValue) :
					this._defaultValue instanceof TimeSpan ? new TimeSpan(this._defaultValue.totalMilliseconds) :
						this._defaultValue instanceof Function ? this._defaultValue() :
							this._defaultValue;
		},

		get_origin: function Property$get_origin() {
			return this._origin ? this._origin : this._containingType.get_origin();
		},

		get_isEntityType: function Property$get_isEntityType() {
			if (!this.get_jstype().meta) {
				return false;
			}
			return !this._isList;
		},

		get_isEntityListType: function Property$get_isEntityListType() {
			if (!this.get_jstype().meta) {
				return false;
			}
			return this._isList;
		},

		get_isValueType: function Property$get_isValueType() {
			return !this.get_jstype().meta;
		},

		get_isList: function Property$get_isList() {
			return this._isList;
		},

		get_isStatic: function Property$get_isStatic() {
			return this._isStatic;
		},

		get_constant: function Property$get_constant() {
			// initialize and cache the constant value if we have not already
			if (typeof this._constant === "function")
				this._constant = this._constant();
			return this._constant;
		},

		get_isPersisted: function Property$get_isPersisted() {
			return this._isPersisted;
		},

		get_isCalculated: function Property$get_isCalculated() {
			return this._isCalculated;
		},

		get_label: function Property$get_label() {
			return this._label;
		},

		get_helptext: function Property$get_helptext() {
			return this._helptext;
		},

		get_name: function Property$get_name() {
			return this._name;
		},

		get_fieldName: function Property$get_fieldName() {
			return this._fieldName;
		},

		get_path: function Property$get_path() {
			return this._isStatic ? (this._containingType.get_fullName() + "." + this._name) : this._name;
		},

		canSetValue: function Property$canSetValue(obj, val) {
			// NOTE: only allow values of the correct data type to be set in the model

			if (val === undefined) {
				logWarning("You should not set property values to undefined, use null instead: property = ." + this._name + ".");
				return true;
			}

			if (val === null) {
				return true;
			}

			// for entities check base types as well
			if (val.constructor && val.constructor.meta) {
				for (var valType = val.constructor.meta; valType; valType = valType.baseType) {
					if (valType._jstype === this._jstype) {
						return true;
					}
				}

				return false;
			}

			//Data types
			else {
				var valObjectType = val.constructor;

				//"Normalize" data type in case it came from another frame as well as ensure that the types are the same
				switch (type(val)) {
					case "string":
						valObjectType = String;
						break;
					case "number":
						valObjectType = Number;
						break;
					case "boolean":
						valObjectType = Boolean;
						break;
					case "date":
						valObjectType = Date;
						break;
					case "array":
						valObjectType = Array;
						break;
				}

				// value property type check
				return valObjectType === this._jstype ||

					// entity array type check
					(valObjectType === Array && this.get_isList() && val.every(function (child) {
						if (child.constructor && child.constructor.meta) {
							for (var childType = child.constructor.meta; childType; childType = childType.baseType) {
								if (childType._jstype === this._jstype) {
									return true;
								}
							}
						}
						return child.constructor === this._jstype;
					}, this));
			}
		},

		value: function Property$value(obj, val, args) {
			var target = (this._isStatic ? this._containingType.get_jstype() : obj);

			if (target === undefined || target === null) {
				throw new Error($format(
					"Cannot {0} value for {1}static property \"{2}\" on type \"{3}\": target is null or undefined.",
					(arguments.length > 1 ? "set" : "get"), (this._isStatic ? "" : "non-"), this.get_path(), this._containingType.get_fullName()));
			}

			if (arguments.length > 1) {
				Property$_setter.call(this, target, val, false, args);
			}
			else {
				return Property$_getter.call(this, target);
			}
		},

		isInited: function Property$isInited(obj) {
			var target = (this._isStatic ? this._containingType.get_jstype() : obj);
			if (!target.hasOwnProperty(this._fieldName)) {
				// If the backing field has not been created, then property is not initialized
				return false;
			}
			if (this._isList) {
				var value = target[this._fieldName];
				if (value === undefined || !LazyLoader.isLoaded(value)) {
					// If the list is not-loaded, then the property is not initialized
					return false;
				}
			}
			return true;
		},

		// starts listening for get events on the property. Use obj argument to
		// optionally filter the events to a specific object
		addGet: function Property$addGet(handler, obj, once) {
			this._addEvent("get", handler, obj ? equals(obj) : null, once);

			// Return the property to support method chaining
			return this;
		},
		removeGet: function Property$removeGet(handler) {
			this._removeEvent("get", handler);
		},

		// starts listening for change events on the property. Use obj argument to
		// optionally filter the events to a specific object
		addChanged: function Property$addChanged(handler, obj, once) {
			this._addEvent("changed", handler, obj ? equals(obj) : null, once);

			// Return the property to support method chaining
			return this;
		},
		removeChanged: function Property$removeChanged(handler) {
			this._removeEvent("changed", handler);
		},

		firstProperty: function Property$firstProperty() {
			return this;
		},
		lastProperty: function Property$lastProperty() {
			return this;
		},
		properties: function Property$properties() {
			return [this];
		},

		lastTarget: function Property$lastTarget(obj) {
			return obj;
		},

		ifExists: function (path) {
			Model.property(path, this._containingType, true, function (chain) {
				this.calculated({
					basedOn: [path],
					fn: function () {
						return !isNullOrUndefined(chain.value(this));
					}
				});
			}, this);

			return this;
		},

		alias: function (path, eventName) {
			Model.property(path, this._containingType, true, function (chain) {
				this.calculated({
					basedOn: [(eventName ? eventName + " of " : "") + path],
					fn: function () {
						return chain.value(this);
					}
				});
			}, this);

			return this;
		},

		rootedPath: function Property$rootedPath(type) {
			if (this.isDefinedBy(type)) {
				return this._isStatic ? this._containingType.get_fullName() + "." + this._name : this._name;
			}
		},

		label: function (label) {
			this._label = label;
			return this;
		},

		helptext: function (helptext) {
			this._helptext = helptext;
			return this;
		},

		// Adds a rule to the property that will update its value based on a calculation.
		calculated: function (options) {
			options.property = this;
			var definedType = options.rootType ? options.rootType.meta : this._containingType;
			delete options.rootType;

			new CalculatedPropertyRule(definedType, options);

			return this;
		},
		required: function (error) {
			var options = preparePropertyRuleOptions(this, {}, error);
			new ExoWeb.Model.Rule.required(this._containingType, options);
			return this;
		},
		allowedValues: function (source, error) {
			var options = preparePropertyRuleOptions(this, { source: source }, error);
			new ExoWeb.Model.Rule.allowedValues(this._containingType, options);
			return this;
		},
		optionValues: function (source, error) {
			var options = preparePropertyRuleOptions(this, { source: source, onInit: false, onInitNew: false, onInitExisting: false }, error);
			options.ignoreValidation = true;
			new ExoWeb.Model.Rule.allowedValues(this._containingType, options);
			return this;
		},
		compare: function (operator, source, error) {
			var options = preparePropertyRuleOptions(this, { compareOperator: operator, compareSource: source }, error);
			new ExoWeb.Model.Rule.compare(this._containingType, options);
			return this;
		},
		range: function (min, max, error) {
			var options = preparePropertyRuleOptions(this, { min: min, max: max }, error);
			new ExoWeb.Model.Rule.range(this._containingType, options);
			return this;
		},
		conditionIf: function (options, type) {
			var definedType = options.rootType ? options.rootType.meta : this._containingType;
			delete options.rootType;

			options = preparePropertyRuleOptions(this, options, type);
			new ExoWeb.Model.Rule.validated(definedType, options);
			return this;
		},
		errorIf: function (options, error) {
			return this.conditionIf(options, error);
		},
		warningIf: function (options, warning) {
			return this.conditionIf(jQuery.extend(options, { category: ConditionType.Warning }), warning);
		},
		requiredIf: function (source, operator, value, error) {
			if (source.constructor === String) {
				var options = preparePropertyRuleOptions(this, { compareSource: source, compareOperator: operator, compareValue: value }, error);
				new ExoWeb.Model.Rule.requiredIf(this._containingType, options);
			}
			else {
				var definedType = source.rootType ? source.rootType.meta : this._containingType;
				delete source.rootType;
				source = preparePropertyRuleOptions(this, source);

				new ExoWeb.Model.Rule.requiredIf(definedType, source);
			}
			return this;
		},
		stringLength: function (min, max, error) {
			var options = preparePropertyRuleOptions(this, { min: min, max: max }, error);
			new ExoWeb.Model.Rule.stringLength(this._containingType, options);
			return this;
		},
		stringFormat: function (description, expression, reformat, error) {
			var options = preparePropertyRuleOptions(this, { description: description, expression: expression, reformat: reformat }, error);
			new ExoWeb.Model.Rule.stringFormat(this._containingType, options);
			return this;
		},
		listLength: function (options, error) {
			var options = preparePropertyRuleOptions(this, { staticLength: options.staticLength, compareSource: options.compareSource, compareOperator: options.compareOperator }, error);
			new ExoWeb.Model.Rule.listLength(this._containingType, options);
			return this;
		}
	});
	Property.mixin(Functor.eventing);
	ExoWeb.Model.Property = Property;

	// #endregion

	// #region ExoWeb.Model.PathTokens
	//////////////////////////////////////////////////

	function PathTokens(expression) {
	
		// legacy: remove "this." prefix from instance properties
		if (expression.substr(0, 5) === "this.")
			expression = expression.substr(5);

		this.expression = expression;

		// replace "." in type casts so that they do not interfere with splitting path
		expression = expression.replace(/<[^>]*>/ig, function(e) { return e.replace(/\./ig, function() { return "$_$"; }); });

		if (expression.length > 0) {
			this.steps = expression.split(".").map(function (step) {
				// Regex pattern matches all letters and digits that are valid for javascript identifiers, including  "_"
				var parsed = step.match(/^([_0-9a-zA-Z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u02bb-\u02c1\u02d0-\u02d1\u02e0-\u02e4\u02ee\u0370-\u0373\u0376-\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0523\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0621-\u064a\u0660-\u0669\u066e-\u066f\u0671-\u06d3\u06d5\u06e5-\u06e6\u06ee-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07c0-\u07ea\u07f4-\u07f5\u07fa\u0904-\u0939\u093d\u0950\u0958-\u0961\u0966-\u096f\u0971-\u0972\u097b-\u097f\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc-\u09dd\u09df-\u09e1\u09e6-\u09f1\u0a05-\u0a0a\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a66-\u0a6f\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0-\u0ae1\u0ae6-\u0aef\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32-\u0b33\u0b35-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b66-\u0b6f\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0be6-\u0bef\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58-\u0c59\u0c60-\u0c61\u0c66-\u0c6f\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0-\u0ce1\u0ce6-\u0cef\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d3d\u0d60-\u0d61\u0d66-\u0d6f\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32-\u0e33\u0e40-\u0e46\u0e50-\u0e59\u0e81-\u0e82\u0e84\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa-\u0eab\u0ead-\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0ed0-\u0ed9\u0edc-\u0edd\u0f00\u0f20-\u0f29\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8b\u1000-\u102a\u103f-\u1049\u1050-\u1055\u105a-\u105d\u1061\u1065-\u1066\u106e-\u1070\u1075-\u1081\u108e\u1090-\u1099\u10a0-\u10c5\u10d0-\u10fa\u10fc\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u17e0-\u17e9\u1810-\u1819\u1820-\u1877\u1880-\u18a8\u18aa\u1900-\u191c\u1946-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u19d0-\u19d9\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u1b50-\u1b59\u1b83-\u1ba0\u1bae-\u1bb9\u1c00-\u1c23\u1c40-\u1c49\u1c4d-\u1c7d\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u2094\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183-\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2c6f\u2c71-\u2c7d\u2c80-\u2ce4\u2d00-\u2d25\u2d30-\u2d65\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3006\u3031-\u3035\u303b-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fc3\ua000-\ua48c\ua500-\ua60c\ua610-\ua62b\ua640-\ua65f\ua662-\ua66e\ua680-\ua697\ua722-\ua788\ua78b-\ua78c\ua7fb-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8d0-\ua8d9\ua900-\ua925\ua930-\ua946\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa50-\uaa59\uac00-\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]+)(<([_$0-9a-zA-Z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u02bb-\u02c1\u02d0-\u02d1\u02e0-\u02e4\u02ee\u0370-\u0373\u0376-\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0523\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0621-\u064a\u0660-\u0669\u066e-\u066f\u0671-\u06d3\u06d5\u06e5-\u06e6\u06ee-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07c0-\u07ea\u07f4-\u07f5\u07fa\u0904-\u0939\u093d\u0950\u0958-\u0961\u0966-\u096f\u0971-\u0972\u097b-\u097f\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc-\u09dd\u09df-\u09e1\u09e6-\u09f1\u0a05-\u0a0a\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a66-\u0a6f\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0-\u0ae1\u0ae6-\u0aef\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32-\u0b33\u0b35-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b66-\u0b6f\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0be6-\u0bef\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58-\u0c59\u0c60-\u0c61\u0c66-\u0c6f\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0-\u0ce1\u0ce6-\u0cef\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d3d\u0d60-\u0d61\u0d66-\u0d6f\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32-\u0e33\u0e40-\u0e46\u0e50-\u0e59\u0e81-\u0e82\u0e84\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa-\u0eab\u0ead-\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0ed0-\u0ed9\u0edc-\u0edd\u0f00\u0f20-\u0f29\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8b\u1000-\u102a\u103f-\u1049\u1050-\u1055\u105a-\u105d\u1061\u1065-\u1066\u106e-\u1070\u1075-\u1081\u108e\u1090-\u1099\u10a0-\u10c5\u10d0-\u10fa\u10fc\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u17e0-\u17e9\u1810-\u1819\u1820-\u1877\u1880-\u18a8\u18aa\u1900-\u191c\u1946-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u19d0-\u19d9\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u1b50-\u1b59\u1b83-\u1ba0\u1bae-\u1bb9\u1c00-\u1c23\u1c40-\u1c49\u1c4d-\u1c7d\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u2094\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183-\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2c6f\u2c71-\u2c7d\u2c80-\u2ce4\u2d00-\u2d25\u2d30-\u2d65\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3006\u3031-\u3035\u303b-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fc3\ua000-\ua48c\ua500-\ua60c\ua610-\ua62b\ua640-\ua65f\ua662-\ua66e\ua680-\ua697\ua722-\ua788\ua78b-\ua78c\ua7fb-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8d0-\ua8d9\ua900-\ua925\ua930-\ua946\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa50-\uaa59\uac00-\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc$]+)>)?$/i);

				if (!parsed) {
					return null;
				}

				var result = { property: parsed[1] };

				if (parsed[3]) {
					// restore "." in type case expression
					result.cast = parsed[3].replace(/\$_\$/ig, function() { return "."; });
				}

				return result;
			});
		}
		else {
			this.steps = [];
		}
	}

	PathTokens.normalizePaths = function PathTokens$normalizePaths(paths) {
		var result = [];

		if (paths) {
			paths.forEach(function (p) {

				// coerce property and property chains into string paths
				p = p instanceof Property ? p.get_name() :
					p instanceof PropertyChain ? p.get_path() :
					p;

				var stack = [];
				var parent;
				var start = 0;
				var pLen = p.length;

				for (var i = 0; i < pLen; ++i) {
					var c = p.charAt(i);

					if (c === '{' || c === ',' || c === '}') {
						var seg = p.substring(start, i).trim();
						start = i + 1;

						if (c === '{') {
							if (parent) {
								stack.push(parent);
								parent += "." + seg;
							}
							else {
								parent = seg;
							}
						}
						else {   // ',' or '}'
							if (seg.length > 0) {
								result.push(new PathTokens(parent ? parent + "." + seg : seg));
							}

							if (c === '}') {
								parent = (stack.length === 0) ? undefined : stack.pop();
							}
						}
					}
				}

				if (stack.length > 0) {
					throw new Error("Unclosed '{' in path: " + p);
				}

				if (start === 0) {
					result.push(new PathTokens(p.trim()));
				}
			});
		}
		return result;
	};

	PathTokens.mixin({
		buildExpression: function PathTokens$buildExpression() {
			var path = "";
			this.steps.forEach(function(step) {
				path += (path ? "." : "") + step.property + (step.cast ? "<" + step.cast + ">" : "");
			});
			return path;
		},
		toString: function PathTokens$toString() {
			return this.expression;
		}
	});

	ExoWeb.Model.PathTokens = PathTokens;

	// #endregion

	// #region ExoWeb.Model.PropertyChain
	//////////////////////////////////////////////////

	function PropertyChain(rootType, properties, filters) {
		/// <summary>
		/// Encapsulates the logic required to work with a chain of properties and
		/// a root object, allowing interaction with the chain as if it were a 
		/// single property of the root object.
		/// </summary>

		var handlers = null;

		function onStepChanged(priorProp, sender, args) {
			// scan all known objects of this type and raise event for any instance connected
			// to the one that sent the event.
			if (priorProp != undefined) {
				this._rootType.known().forEach(function(known) {
					if (this.connects(known, sender, priorProp)) {
						// Copy the original arguments so that we don't affect other code
						var newArgs = Object.copy(args);

					// Reset property to be the chain, but store the original property as "triggeredBy"
					newArgs.originalSender = sender;
					newArgs.triggeredBy = newArgs.property;
					newArgs.property = this;

						// Call the handler, passing through the arguments
						this._raiseEvent("changed", [known, newArgs]);
					}
				}, this);
			}
			else {
				var newArgs = Object.copy(args);
				// Reset property to be the chain, but store the original property as "triggeredBy"
				newArgs.originalSender = sender;
				newArgs.triggeredBy = newArgs.property;
				newArgs.property = this;

				this._raiseEvent("changed", [sender, newArgs]);
			}
		}

		this._updatePropertyChangeSubscriptions = function() {
			var handler = this._getEventHandler("changed");
			var eventHandlersExist = handler && !handler.isEmpty();
			var subscribedToPropertyChanges = handlers !== null;

			if (!eventHandlersExist && subscribedToPropertyChanges) {
				// If there are no more subscribers then unsubscribe from property-level events
				this._properties.forEach(function(prop, index) {
					var handler = handlers[index];
					prop.removeChanged(handler);
				}, this);
				handlers = null;
			}
			else if (eventHandlersExist && !subscribedToPropertyChanges) {
				// If there are subscribers and we have not subscribed to property-level events, then do so
				handlers = [];
				this._properties.forEach(function(prop, index) {
					var priorProp = (index === 0) ? undefined : this._properties[index - 1];
					var handler = onStepChanged.bind(this).prependArguments(priorProp);
					handlers.push(handler);
					prop.addChanged(handler);
				}, this);
			}
		};

		this._rootType = rootType;
		this._properties = properties;
		this._filters = filters;
	}

	PropertyChain.create = function PropertyChain$create(rootType, pathTokens/*, forceLoadTypes, success, fail*/) {
		/// <summary>
		/// Attempts to synchronously or asynchronously create a property chain for the specified 
		/// root type and path.  Also handles caching of property chains at the type level.
		/// </summary>

		var type = rootType;
		var properties = [];
		var filters = [];
		var filterTypes = [];

		// initialize optional callback arguments
		var forceLoadTypes = arguments.length >= 3 && arguments[2] && arguments[2].constructor === Boolean ? arguments[2] : false;
		var success = arguments.length >= 4 && arguments[3] && arguments[3] instanceof Function ? arguments[3] : null;
		var fail = arguments.length >= 5 && arguments[4] && arguments[4] instanceof Function ?
			arguments[4] : function (error) { if (success) { throw new Error(error); } };

		// process each step in the path either synchronously or asynchronously depending on arguments
		var processStep = function PropertyChain$processStep() {

			// get the next step
			var step = pathTokens.steps.dequeue();
			if (!step) {
				fail($format("Syntax error in property path: {0}", [pathTokens.expression]));

				// return null to indicate that the path is not valid
				return null;
			}

			// get the property for the step 
			var prop = type.property(step.property);
			if (!prop) {
				fail($format("Path '{0}' references an unknown property: {1}.{2}.", [pathTokens.expression, type.get_fullName(), step.property]));

				// return null if the property does not exist
				return null;
			}

			// ensure the property is not static because property chains are not valid for static properties
			if (prop.get_isStatic()) {
				fail($format("Path '{0}' references a static property: {1}.{2}.", [pathTokens.expression, type.get_fullName(), step.property]));

				// return null to indicate that the path references a static property
				return null;
			}

			// store the property for the step
			properties.push(prop);

			// handle optional type filters
			if (step.cast) {

				// determine the filter type
				type = Model.getJsType(step.cast, true).meta;
				if (!type) {
					fail($format("Path '{0}' references an invalid type: {1}", [pathTokens.expression, step.cast]));
					return null;
				}

				var jstype = type.get_jstype();
				filterTypes[properties.length] = jstype;
				filters[properties.length] = function (target) {
					return target instanceof jstype;
				};
			}
			else {
				type = prop.get_jstype().meta;
			}

			// process the next step if not at the end of the path
			if (pathTokens.steps.length > 0) {
				return ensureType(type, forceLoadTypes, processStep);
			}

			// otherwise, create and return the new property chain
			else {

				// processing the path is complete, verify that chain is not zero-length
				if (properties.length === 0) {
					fail($format("PropertyChain cannot be zero-length."));
					return null;
				}

				// ensure filter types on the last step are loaded
				var filterTypeSignal = new Signal("filterType");
				var filterType = filterTypes[properties.length - 1];
				if (filterType) {
					ensureType(filterType.meta, forceLoadTypes, filterTypeSignal.pending(null, null, true));
				}
				var ret;
				filterTypeSignal.waitForAll(function () {
					// create and cache the new property chain
					var chain = new PropertyChain(rootType, properties, filters);
					if (!rootType._chains) {
						rootType._chains = {};
					}
					rootType._chains[pathTokens.expression] = chain;

					// if asynchronous processing was allowed, invoke the success callback
					if (success) {
						success(chain);
					}

					// return the new property chain
					ret = chain;
				}, null, true);
				return ret;
			}
		};

		// begin processing steps in the path
		return ensureType(type, forceLoadTypes, processStep);
	}

	PropertyChain.mixin(Functor.eventing);

	PropertyChain.mixin({
		equals: function PropertyChain$equals(prop) {
			if (prop !== undefined && prop !== null) {
				if (prop instanceof Property) {
					return prop.equals(this);
				}
				else if (prop instanceof PropertyChain) {
					if (prop._properties.length !== this._properties.length) {
						return false;
					}

					for (var i = 0; i < this._properties.length; i++) {
						if (!this._properties[i].equals(prop._properties[i])) {
							return false;
						}
					}

					return true;
				}
			}
		},
		all: function PropertyChain$all() {
			return this._properties;
		},
		append: function PropertyChain$append(prop) {
			Array.addRange(this._properties, prop.all());
		},
		each: function PropertyChain$each(obj, callback, thisPtr, propFilter /*, target, p, lastProp*/) {
			/// <summary>
			/// Iterates over all objects along a property chain starting with the root object (obj).  This
			/// is analogous to the Array forEach function.  The callback may return a Boolean value to indicate 
			/// whether or not to continue iterating.
			/// </summary>
			/// <param name="obj" type="ExoWeb.Model.Entity">
			/// The root object to use in iterating over the chain.
			/// </param>
			/// <param name="callback" type="Function">
			/// The function to invoke at each iteration step.  May return a Boolean value to indicate whether 
			/// or not to continue iterating.
			/// </param>
			/// <param name="propFilter" type="ExoWeb.Model.Property" optional="true">
			/// If specified, only iterates over objects that are RETURNED by the property filter.  In other
			/// words, steps that correspond to a value or values of the chain at a specific property step).
			/// For example, if the chain path is "this.PropA.ListPropB", then...
			///     chain.each(target, callback, null, ListPropB);
			/// ...will iterate the values of the list property only.
			/// </param>

			if (obj == null) throw new ArgumentNullError("obj");
			if (callback == null) throw new ArgumentNullError("callback");
			if (typeof (callback) != "function") throw new ArgumentTypeError("callback", "function", callback);

			// invoke callback on obj first
			var target = arguments[4] || obj;
			var lastProp = arguments[6] || null;
			var props = this._properties.slice(arguments[5] || 0);
			for (var p = arguments[5] || 0; p < this._properties.length; p++) {
				var prop = this._properties[p];
				var isLastProperty = p === this._properties.length - 1;
				var canSkipRemainingProps = isLastProperty || (propFilter && lastProp === propFilter);
				var enableCallback = (!propFilter || lastProp === propFilter);

				if (target instanceof Array) {
					// if the target is a list, invoke the callback once per item in the list
					for (var i = 0; i < target.length; ++i) {
						// take into account any any chain filters along the way
						if (!this._filters[p] || this._filters[p](target[i])) {

							if (enableCallback && callback.call(thisPtr || this, target[i], i, target, prop, p, props) === false) {
								return false;
							}

							if (!canSkipRemainingProps) {
								var targetValue = prop.value(target[i]);
								// continue along the chain for this list item
								if (!targetValue || this.each(obj, callback, thisPtr, propFilter, targetValue, p + 1, prop) === false) {
									return false;
								}
							}
						}
					}
					// subsequent properties already visited in preceding loop
					return true;
				}
				else {
					// return early if the target is filtered and does not match
					if (this._filters[p] && this._filters[p](target) === false) {
						break;
					}

					// take into account any chain filters along the way
					if (enableCallback && callback.call(thisPtr || this, target, -1, null, prop, p, props) === false) {
						return false;
					}
				}

				// if a property filter is used and was just evaluated, stop early
				if (canSkipRemainingProps) {
					break;
				}

				// move to next property in the chain
				target = target[prop._fieldName];

				// break early if the target is undefined
				if (target === undefined || target === null) {
					break;
				}

				lastProp = prop;
			}

			return true;
		},
		get_path: function PropertyChain$get_path() {
			if (!this._path) {
				this._path = this._getPathFromIndex(0);
			}

			return this._path;
		},
		_getPathFromIndex: function PropertyChain$_getPathFromIndex(startIndex) {
			var steps = [];
			if (this._properties[startIndex].get_isStatic()) {
				steps.push(this._properties[startIndex].get_containingType().get_fullName());
			}

			var previousStepType;
			this._properties.slice(startIndex).forEach(function (p, i) {
				if (i !== 0) {
					if (p.get_containingType() !== previousStepType && p.get_containingType().isSubclassOf(previousStepType)) {
						steps[steps.length - 1] = steps[steps.length - 1] + "<" + p.get_containingType().get_fullName() + ">";
					}
				}
				steps.push(p.get_name());
				previousStepType = p.get_jstype().meta;
			});

			return steps.join(".");
		},
		firstProperty: function PropertyChain$firstProperty() {
			return this._properties[0];
		},
		lastProperty: function PropertyChain$lastProperty() {
			return this._properties[this._properties.length - 1];
		},
		properties: function PropertyChain$properties() {
			return this._properties.slice();
		},
		lastTarget: function PropertyChain$lastTarget(obj) {
			for (var p = 0; p < this._properties.length - 1; p++) {
				var prop = this._properties[p];

				// exit early on null or undefined
				if (obj === undefined || obj === null) {
					return obj;
				}

				obj = prop.value(obj);
			}
			return obj;
		},

		prepend: function PropertyChain$prepend(other) {
			var props = other instanceof PropertyChain ? other.all() : [other];

			this._rootType = other.get_containingType();
			Array.prototype.splice.apply(this._properties, [0, 0].concat(props));
		},

		canSetValue: function PropertyChain$canSetValue(obj, value) {
			return this.lastProperty().canSetValue(this.lastTarget(obj), value);
		},

		// Determines if this property chain connects two objects.
		connects: function PropertyChain$connects(fromRoot, toObj, viaProperty) {
			var connected = false;

			// perform simple comparison if no property is defined
			if (!viaProperty) {
				return fromRoot === toObj;
			}

			this.each(fromRoot, function (target) {
				if (target === toObj) {
					connected = true;
					return false;
				}
			}, this, viaProperty);

			return connected;
		},
		rootedPath: function PropertyChain$rootedPath(rootType) {
			for (var i = 0; i < this._properties.length; i++) {
				if (this._properties[i].isDefinedBy(rootType)) {
					var path = this._getPathFromIndex(i);
					return this._properties[i]._isStatic ? this._properties[i].get_containingType().get_fullName() + "." + path : path;
				}
			}
		},
		// starts listening for the get event of the last property in the chain on any known instances. Use obj argument to
		// optionally filter the events to a specific object
		addGet: function PropertyChain$addGet(handler, obj) {
			var chain = this;

			this.lastProperty().addGet(function PropertyChain$_raiseGet(sender, property, value, isInited) {
				handler(sender, chain, value, isInited);
			}, obj);

			// Return the property to support method chaining
			return this;
		},
		removeChanged: function PropertyChain$removeChanged(handler) {
			this._removeEvent("changed", handler);

			this._updatePropertyChangeSubscriptions();
		},
		// starts listening for change events along the property chain on any known instances. Use obj argument to
		// optionally filter the events to a specific object
		addChanged: function PropertyChain$addChanged(handler, obj, once, toleratePartial) {
			var filter = mergeFunctions(

				// Only raise for the given root object if specified
				obj ? equals(obj) : null,

				toleratePartial
					// Ensure that the chain can be accessed without error if toleratePartial is true
					? (function (sender, args) {
						var allCanBeAccessed = true;
						this.each(sender, function (target, targetIndex, targetArray, property, propertyIndex, properties) {
							if (!property.isInited(target)) {
								var propertyGetWouldCauseError = false;
								if (LazyLoader.isRegistered(target)) {
									propertyGetWouldCauseError = true;
								} else if (property.get_isList()) {
									var list = target[property._fieldName];
									if (list && LazyLoader.isRegistered(list)) {
										propertyGetWouldCauseError = true;
									}
								}

								if (propertyGetWouldCauseError) {
									allCanBeAccessed = false;

									// Exit immediately
									return false;
								}
							}
						});
						return allCanBeAccessed;
					}.bind(this))

					// Ensure that the chain is inited from the root if toleratePartial is false
					: this.isInited.bind(this).spliceArguments(1, 1, true),

				{
					// Both filters must pass
					andResults: true
				}

			);

			this._addEvent("changed", handler, filter, once);

			this._updatePropertyChangeSubscriptions();

			// Return the property chain to support method chaining
			return this;
		},
		// Property pass-through methods
		///////////////////////////////////////////////////////////////////////
		get_containingType: function PropertyChain$get_containingType() {
			return this._rootType;
		},
		get_jstype: function PropertyChain$get_jstype() {
			return this.lastProperty().get_jstype();
		},
		get_format: function PropertyChain$get_format() {
			return this.lastProperty().get_format();
		},
		format: function PropertyChain$format(val) {
			return this.lastProperty().format(val);
		},
		get_isList: function PropertyChain$get_isList() {
			return this.lastProperty().get_isList();
		},
		get_isStatic: function PropertyChain$get_isStatic() {
			// TODO
			return this.lastProperty().get_isStatic();
		},
		get_label: function PropertyChain$get_label() {
			return this.lastProperty().get_label();
		},
		get_helptext: function PropertyChain$get_helptext() {
			return this.lastProperty().get_helptext();
		},
		get_name: function PropertyChain$get_name() {
			return this.lastProperty().get_name();
		},
		get_isValueType: function PropertyChain$get_isValueType() {
			return this.lastProperty().get_isValueType();
		},
		get_isEntityType: function PropertyChain$get_isEntityType() {
			return this.lastProperty().get_isEntityType();
		},
		get_isEntityListType: function PropertyChain$get_isEntityListType() {
			return this.lastProperty().get_isEntityListType();
		},
		rules: function (filter) {
			return this.lastProperty().rules(filter);
		},
		value: function PropertyChain$value(obj, val, customInfo) {
			var target = this.lastTarget(obj, true);
			var prop = this.lastProperty();

			if (arguments.length > 1) {
				prop.value(target, val, customInfo);
			}
			else {
				return target ? prop.value(target) : target;
			}
		},
		isInited: function PropertyChain$isInited(obj, enforceCompleteness /*, fromIndex, fromProp*/) {
			/// <summary>
			/// Determines if the property chain is initialized, akin to single Property initialization.
			/// </summary>
			var allInited = true, initedProperties = [], fromIndex = arguments[2] || 0, fromProp = arguments[3] || null, expectedProps = this._properties.length - fromIndex;

			this.each(obj, function(target, targetIndex, targetArray, property, propertyIndex, properties) {
				if (targetArray && enforceCompleteness) {
					if (targetArray.every(function(item) { return this.isInited(item, true, propertyIndex, properties[propertyIndex - 1]); }, this)) {
						Array.prototype.push.apply(initedProperties, properties.slice(propertyIndex));
					}
					else {
						allInited = false;
					}

					// Stop iterating at an array value
					return false;
				}
				else {
					if (!targetArray || targetIndex === 0) {
						initedProperties.push(property);
					}
					if (!property.isInited(target)) {
						initedProperties.remove(property);
						allInited = false;

						// Exit immediately since chain is not inited
						return false;
					}
				}
			}, this, null, obj, fromIndex, fromProp);

			return allInited && (!enforceCompleteness || initedProperties.length === expectedProps);
		},
		toString: function PropertyChain$toString() {
			if (this._isStatic) {
				return this.get_path();
			}
			else {
				var path = this._properties.map(function (e) { return e.get_name(); }).join(".");
				return $format("this<{0}>.{1}", [this.get_containingType(), path]);
			}
		}
	});

	ExoWeb.Model.PropertyChain = PropertyChain;

	// #endregion

	// #region ExoWeb.Model.ObjectMeta
	//////////////////////////////////////////////////

	function ObjectMeta(type, obj) {
		this._obj = obj;
		this.type = type;
		this._conditions = {};
		this._pendingInit = {};
		this._pendingInvocation = [];
	}

	ObjectMeta.mixin({

		get_entity: function () {
			return this._obj;
		},

		// gets the property or property chain for the specified property path
		property: function ObjectMeta$property(propName, thisOnly) {
			return this.type.property(propName, thisOnly);
		},

		// gets and optionally sets the pending initialization status for a property on the current instance
		pendingInvocation: function ObjectMeta$pendingInvocation(rule, value) {
			var indexOfRule = this._pendingInvocation.indexOf(rule);
			if (arguments.length > 1) {
				if (value && indexOfRule < 0) {
					this._pendingInvocation.push(rule);
				}
				else if (!value && indexOfRule >= 0) {
					this._pendingInvocation.splice(indexOfRule, 1);
				}
			}
			return indexOfRule >= 0;
		},

		// gets and optionally sets the pending initialization status for a property on the current instance
		pendingInit: function ObjectMeta$pendingInit(prop, value) {
			var result = this._obj[prop._fieldName] === undefined || this._pendingInit[prop.get_name()] === true;
			if (arguments.length > 1) {
				if (value) {
					this._pendingInit[prop.get_name()] = true;
				}
				else {
					delete this._pendingInit[prop.get_name()];
				}
			}
			return result;
		},

		// gets the condition target with the specified condition type
		getCondition: function ObjectMeta$getCondition(conditionType) {
			return this._conditions[conditionType.code];
		},

		// stores the condition target for the current instance
		setCondition: function ObjectMeta$setCondition(conditionTarget) {
			if (conditionTarget.condition.type != formatConditionType) {
				this._conditions[conditionTarget.condition.type.code] = conditionTarget;
			}
		},

		// clears the condition for the current instance with the specified condition type
		clearCondition: function ObjectMeta$clearCondition(conditionType) {
			delete this._conditions[conditionType.code];
		},

		// determines if the set of permissions are allowed for the current instance
		isAllowed: function ObjectMeta$isAllowed(/*codes*/) {
			if (arguments.length === 0) {
				return undefined;
			}

			// ensure each condition type is allowed for the current instance
			for (var c = arguments.length - 1; c >= 0; c--) {
				var code = arguments[c];
				var conditionType = ConditionType.get(code);

				// return undefined if the condition type does not exist
				if (conditionType === undefined) {
					return undefined;
				}

				// throw an exception if the condition type is not a permission
				if (!(conditionType instanceof ConditionType.Permission)) {
					throw new Error("Condition type \"" + code + "\" should be a Permission.");
				}

				// return false if a condition of the current type exists and is a deny permission or does not exist and is a grant permission
				if (this._conditions[conditionType.code] ? !conditionType.isAllowed : conditionType.isAllowed) {
					return false;
				}
			}

			return true;
		},

		// determines whether the instance and optionally the specified property value is loaded
		isLoaded: function ObjectMeta$isLoaded(prop) {
			/// <summary locid="M:J#ExoWeb.Model.ObjectMeta.isLoaded">
			/// Check whether the instance and optional property are loaded.
			/// </summary>
			/// <param name="prop" optional="true" mayBeNull="true" type="Object">The optional property object or property name to check.</param>

			// First see if there is a lazy loader attached to the entity (and optional property).
			if (LazyLoader.isRegistered(this._obj, null, prop)) {
				return false;
			}

			// Immediately return true if a property name was not specified
			if (prop) {
				// Coerce property names into property instances
				if (isString(prop)) {
					var name = prop;
					prop = this.property(prop, true);
				
					if (!prop) {
						throw new Error("Could not find property \"" + name + "\" on type \"" + this.type.get_fullName() + "\".");
					}
				}

				// Otherwise, get the property value and determine whether there is a
				// lazy loader attached to the property value, e.g. entity or list.
				var val = prop.value(this._obj);
				if (val !== null && val !== undefined && LazyLoader.isRegistered(val)) {
					return false;
				}
			}

			return true;
		},

		// get some or all of the condition
		conditions: function ObjectMeta$conditions(criteria) {

			// condition type filter
			if (criteria instanceof ConditionType) {
				var conditionTarget = this._conditions[criteria.code];
				return conditionTarget ? [conditionTarget.condition] : [];
			}

			// property filter
			if (criteria instanceof Property || criteria instanceof PropertyChain) {
				criteria = criteria.lastProperty();
				var result = [];
				for (var type in this._conditions) {
					var conditionTarget = this._conditions[type];
					if (conditionTarget.properties.some(function (p) { return p.equals(criteria); })) {
						result.push(conditionTarget.condition);
					}
				}
				return result;
			}

			// otherwise, just return all conditions
			var result = [];
			for (var type in this._conditions) {
				result.push(this._conditions[type].condition);
			}
			return result;
		},
		destroy: function () {
			this.type.unregister(this._obj);
		},
		// starts listening for change events on the conditions array. Use obj argument to
		// optionally filter the events to a specific condition type by passing either
		// the condition type code or type itself.
		addConditionsChanged: function ObjectMeta$addConditionsChanged(handler, criteria) {
			var filter;

			// condition type filter
			if (criteria instanceof ConditionType) {
				filter = function (sender, args) { return args.conditionTarget.condition.type === criteria; };
			}

			// property filter
			else if (criteria instanceof Property || criteria instanceof PropertyChain) {
				criteria = criteria.lastProperty();
				filter = function (sender, args) { return args.conditionTarget.properties.indexOf(criteria) >= 0; };
			}

			// subscribe to the event
			this._addEvent("conditionsChanged", handler, filter);

			// Return the object meta to support method chaining
			return this;
		},
		removeConditionsChanged: function ObjectMeta$removeConditionsChanged(handler) {
			this._removeEvent("conditionsChanged", handler);
		}
	});

	ObjectMeta.mixin(Functor.eventing);
	ExoWeb.Model.ObjectMeta = ObjectMeta;

	// #endregion

	// #region ExoWeb.Model.RuleInvocationType
	//////////////////////////////////////////////////

	var RuleInvocationType = {

		/// <summary>
		/// Occurs when an existing instance is initialized.
		/// </summary>
		InitExisting: 2,

		/// <summary>
		/// Occurs when a new instance is initialized.
		/// </summary>
		InitNew: 4,

		/// <summary>
		/// Occurs when a property value is retrieved.
		/// </summary>
		PropertyGet: 8,

		/// <summary>
		/// Occurs when a property value is changed.
		/// </summary>
		PropertyChanged: 16
	}

	// #endregion

	// #region ExoWeb.Model.Rule
	//////////////////////////////////////////////////

	var customRuleIndex = 0;

	function Rule(rootType, options) {
		/// <summary>Creates a rule that executes a delegate when specified model events occur.</summary>
		/// <param name="rootType" type="Type">The model type the rule is for.</param>
		/// <param name="options" type="Object">
		///		The options for the rule, including:
		///			name:				the optional unique name of the type of validation rule
		///			execute:			a function to execute when the rule is triggered
		///			onInit:				true to indicate the rule should run when an instance of the root type is initialized, otherwise false
		///			onInitNew:			true to indicate the rule should run when a new instance of the root type is initialized, otherwise false
		///			onInitExisting:		true to indicate the rule should run when an existing instance of the root type is initialized, otherwise false
		///			onChangeOf:			an array of property paths (strings, Property or PropertyChain instances) that drive when the rule should execute due to property changes
		///			returns:			an array of properties (string name or Property instance) that the rule is responsible to calculating the value of
		/// </param>
		/// <returns type="Rule">The new rule.</returns>

		// exit immediately if called with no arguments
		if (arguments.length === 0) {
			return;
		}

		// ensure a valid root type was provided
		if (!(rootType instanceof ExoWeb.Model.Type)) {
			if (rootType && rootType.meta) {
				rootType = rootType.meta;
			}
			else {
				throw new Error("A value root model type must be specified when constructing rules.");
			}
		}

		// store the initialization options for processing during registration
		if (options) {
			if (options instanceof Function) {
				this._options = {
					name: rootType.get_fullName() + ".Custom." + (++customRuleIndex),
					execute: function (obj) {
						// use the root object as this
						return options.apply(obj, arguments);
					}
				};
			}
			else {
				this._options = options;
				if (!this._options.name) {
					this._options.name = rootType.get_fullName() + ".Custom." + (++customRuleIndex);
				}
			}
		}
		else {
			this._options = {
				name: rootType.get_fullName() + ".Custom." + (++customRuleIndex)
			};
		}
	
		// explicitly override execute if specified
		if (this._options.execute instanceof Function) {
			this.execute = this._options.execute;
		}

		// define properties for the rule
		Object.defineProperty(this, "rootType", { value: rootType });
		Object.defineProperty(this, "name", { value: this._options.name });
		Object.defineProperty(this, "invocationTypes", { value: 0, writable: true });
		Object.defineProperty(this, "predicates", { value: [], writable: true });
		Object.defineProperty(this, "returnValues", { value: [], writable: true });
		Object.defineProperty(this, "isRegistered", { value: false, writable: true });

		// register the rule after loading has completed
		rootType.model.registerRule(this);
	}

	// base rule implementation
	Rule.mixin({

		// indicates that the rule should run only for new instances when initialized
		onInitNew: function () {

			// ensure the rule has not already been registered
			if (!this._options) {
				//throw new Error("Rules cannot be configured once they have been registered: " + this.name);
				return this;
			}

			// configure the rule to run on init new
			this.invocationTypes |= RuleInvocationType.InitNew;
			return this;
		},

		// indicates that the rule should run only for existing instances when initialized
		onInitExisting: function () {

			// ensure the rule has not already been registered
			if (!this._options) {
				//throw new Error("Rules cannot be configured once they have been registered: " + this.name);
				return this;
			}

			// configure the rule to run on init existingh
			this.invocationTypes |= RuleInvocationType.InitExisting;
			return this;
		},

		// indicates that the rule should run for both new and existing instances when initialized
		onInit: function () {

			// ensure the rule has not already been registered
			if (!this._options) {
				//throw new Error("Rules cannot be configured once they have been registered: " + this.name);
				return this;
			}

			// configure the rule to run on both init new and init existing
			this.invocationTypes |= RuleInvocationType.InitNew | RuleInvocationType.InitExisting;
			return this;
		},

		// indicates that the rule should automatically run when one of the specified property paths changes
		// predicates:  an array of property paths (strings, Property or PropertyChain instances) that drive when the rule should execute due to property changes
		onChangeOf: function (predicates) {

			// ensure the rule has not already been registered
			if (!this._options) {
				//throw new Error("Rules cannot be configured once they have been registered: " + this.name);
				return this;
			}

			// allow change of predicates to be specified as a parameter array without []'s
			if (predicates && predicates.constructor === String) {
				predicates = Array.prototype.slice.call(arguments);
			}

			// add to the set of existing change predicates
			this.predicates = this.predicates.length > 0 ? this.predicates.concat(predicates) : predicates;

			// also configure the rule to run on property change unless it has already been configured to run on property get
			if ((this.invocationTypes & RuleInvocationType.PropertyGet) === 0) {
				this.invocationTypes |= RuleInvocationType.PropertyChanged;
			}
			return this;
		},

		// indicates that the rule is responsible for calculating and returning values of one or more properties on the root type
		// properties:	an array of properties (string name or Property instance) that the rule is responsible to calculating the value of
		returns: function (properties) {
			if (!this._options) {
				//throw new Error("Rules cannot be configured once they have been registered: " + this.name);
				return this;
			}
			// allow return properties to be specified as a parameter array without []'s
			if (properties && properties.constructor === String) {
				properties = Array.prototype.slice.call(arguments);
			}
			if (!properties) {
				throw new Error("Rule must specify at least 1 property for returns.");
			}

			// add to the set of existing return value properties
			this.returnValues = this.returnValues.length > 0 ? this.returnValues.concat(properties) : properties;

			// configure the rule to run on property get and not on property change
			this.invocationTypes |= RuleInvocationType.PropertyGet;
			this.invocationTypes &= ~RuleInvocationType.PropertyChanged;
			return this;
		},

		// registers the rule based on the configured invocation types, predicates, and return values
		register: function Rule$register() {

			// create a scope variable to reference the current rule when creating event handlers
			var rule = this;

			// track the rule with the root type
			this.rootType.rules.push(this);

			// create a function to process the rule's options
			var processOptions = function () {
				// configure the rule based on any specified options
				if (this._options) {
					if (this._options.onInit)
						this.onInit();
					if (this._options.onInitNew)
						this.onInitNew();
					if (this._options.onInitExisting)
						this.onInitExisting();
					if (this._options.onChangeOf)
						this.onChangeOf(this._options.onChangeOf);
					if (this._options.returns)
						this.returns(this._options.returns);

					// legacy support for basedOn option syntax
					if (this._options.basedOn) {
						this._options.basedOn.forEach(function (input) {
							var parts = input.split(" of ");
							if (parts.length >= 2) {
								if (parts[0].split(",").indexOf("change") >= 0) {
									this.onChangeOf([parts[1]]);
								}
							}
							else {
								this.onChangeOf(input);
							}
						}, this);
					}
				}

				// indicate that the rule should now be considered registered and cannot be reconfigured
				delete this._options;
			}

			// create a function to determine whether the rule can execute for the given arguments
			var canExecute = function(obj, args) {
				// ensure the rule target is a valid rule root type
				return obj instanceof rule.rootType.get_jstype();
			};

			// create a function to safely execute the rule
			var execute = function (obj, args) {
				// Ensure that the rule can be executed.
				if (!canExecute.call(this, obj, args)) return;

				EventScope$perform(function() {
					if (window.ExoWeb.config.detectRunawayRules) {
						if (currentEventScope.parent && currentEventScope.parent._exitEventVersion) {
							// Determine the maximum number nested calls to EventScope$perform
							// before considering a rule to be a "runaway" rule. 
							var maxNesting;
							if (typeof window.ExoWeb.config.nonExitingScopeNestingCount === "number") {
								maxNesting = window.ExoWeb.config.nonExitingScopeNestingCount - 1;
							} else {
								maxNesting = 99;
							}

							if (currentEventScope.parent._exitEventVersion > maxNesting) {
								logWarning("Aborting rule '" + rule.name + "'.");
								return;
							}
						}
					}

					rule.execute.call(rule, obj, args);
				});
			};

			// create function to perform rule registration once predicates and return values have been prepared
			var register = function () {

				// register for init new
				if (this.invocationTypes & RuleInvocationType.InitNew) {
					this.rootType.addInitNew(function (sender, args) {
						execute.call(this, sender, args);
					});
				}

				// register for init existing
				if (this.invocationTypes & RuleInvocationType.InitExisting) {
					this.rootType.addInitExisting(function (sender, args) {
						execute.call(this, sender, args);
					});
				}

				// register for property change
				if (this.invocationTypes & RuleInvocationType.PropertyChanged) {
					this.predicates.forEach(function (predicate) {
						predicate.addChanged(
							function (sender, args) {
								if (canExecute.call(this, sender, args) && !sender.meta.pendingInvocation(rule)) {
									sender.meta.pendingInvocation(rule, true);
									EventScope$onExit(function() {
										sender.meta.pendingInvocation(rule, false);
										execute.call(this, sender, args);
									});
									EventScope$onAbort(function() {
										sender.meta.pendingInvocation(rule, false);
									});
								}
							},
							null, // no object filter
							false, // subscribe for all time, not once
							true // tolerate nulls since rule execution logic will handle guard conditions
						);
					});
				}

				// register for property get
				if (this.invocationTypes & RuleInvocationType.PropertyGet && this.returnValues) {

					// register for property get events for each return value to calculate the property when accessed
					this.returnValues.forEach(function (returnValue) {
						returnValue.addGet(function (sender, args) {

							// run the rule to initialize the property if it is pending initialization
							if (canExecute.call(this, sender, args) && sender.meta.pendingInit(returnValue)) {
								sender.meta.pendingInit(returnValue, false);
								execute.call(this, sender, args);
							}
						});
					});

					// register for property change events for each predicate to invalidate the property value when inputs change
					this.predicates.forEach(function (predicate) {
						predicate.addChanged(
							function (sender, args) {

								// immediately execute the rule if there are explicit event subscriptions for the property
								if (rule.returnValues.some(function (returnValue) { return hasPropertyChangedSubscribers(returnValue, sender); })) {
									if (canExecute.call(this, sender, args) && !sender.meta.pendingInvocation(rule)) {
										sender.meta.pendingInvocation(rule, true);
										EventScope$onExit(function() {
											sender.meta.pendingInvocation(rule, false);
											execute.call(this, sender, args);
										});
										EventScope$onAbort(function() {
											sender.meta.pendingInvocation(rule, false);
										});
									}
								}

								// Otherwise, just mark the property as pending initialization and raise property change for UI subscribers
								else {
									rule.returnValues.forEach(function (returnValue) {
										sender.meta.pendingInit(returnValue, true);
									});
									// Defer change notification until the scope of work has completed
									EventScope$onExit(function () {
										rule.returnValues.forEach(function (returnValue) { 
											Observer.raisePropertyChanged(sender, returnValue.get_name());
										});
									}, this);
								}
							},
							null, // no object filter
							false, // subscribe for all time, not once
							true // tolerate nulls since rule execution logic will handle guard conditions
						);
					});
				}

				// allow rule subclasses to perform final initialization when registered
				if (this.onRegister instanceof Function) {
					this.onRegister();
				}

				// Mark the rule as successfully registered
				this.isRegistered = true;
			};

			// create a function to kick off the registration process
			var startRegister = function () {
				// process the rule options, this is only done once
				processOptions.call(this);

				// resolve return values, which should all be loaded since the root type is now definitely loaded
				if (this.returnValues) {
					this.returnValues.forEach(function (returnValue, i) {
						if (!(returnValue instanceof Property)) {
							this.returnValues[i] = this.rootType.property(returnValue);
						}
					}, this);
				}

				// resolve all predicates, because the rule cannot run until the dependent types have all been loaded
				if (this.predicates) {
					var signal;
					var predicates = [];

					// setup loading of each property path that the calculation is based on
					this.predicates.forEach(function (predicate, i) {

						// simply copy the predicate over if has already a valid property or property chain
						if (predicate instanceof Property || predicate instanceof PropertyChain) {
							predicates.push(predicate);
						}

						// parse string inputs, which may be paths containing nesting {} hierarchial syntax
						else if (predicate.constructor === String) {

							// create a signal if this is the first string-based input
							if (!signal) {
								signal = new Signal("prepare rule predicates");
							}

							// normalize the paths to accommodate {} hierarchial syntax
							PathTokens.normalizePaths([predicate]).forEach(function (path) {
								Model.property(path, this.rootType, false, signal.pending(function (chain) {
									// add the prepared property or property chain
									predicates.push(chain);
								}, this, true), this);
							}, this);
						}
					}, this);

					// wait until all property information is available to initialize the rule
					if (signal) {
						signal.waitForAll(function () {
							this.predicates = predicates;
							register.call(this);
						}, this, true);
					}

					// otherwise, just immediately proceed with rule registration
					else {
						this.predicates = predicates;
						register.call(this);
					}
				}
			};

			// Optionally perform async pre-registration logic, then kick off the registration process
			if (this.preRegister) {
				// Invoke the rule's pre-register logic if it exists
				if (this.preRegister(function () { startRegister.call(this); }, this) === false) {
					startRegister.call(this);
				}
			} else {
				startRegister.call(this);
			}
		}
	});

	// creates a condition type for the specified rule and type or property, of the specified category type (usually Error or Warning)
	Rule.ensureConditionType = function Rule$ensureConditionType(ruleName, typeOrProp, category, sets) {
		var generatedCode =
			typeOrProp instanceof Property ? $format("{0}.{1}.{2}", [typeOrProp.get_containingType().get_fullName(), typeOrProp.get_name(), ruleName]) :
			typeOrProp instanceof Type ? $format("{0}.{1}", [typeOrProp.get_fullName(), ruleName]) : 
			ruleName;
		var counter = "";

		while (ConditionType.get(generatedCode + counter))
			counter++;

		// return a new client condition type of the specified category
		return new category(generatedCode + counter, $format("Generated condition type for {0} rule.", [ruleName]), null, "client");
	};

	// creates an error for the specified rule and type or property
	Rule.ensureError = function Rule$ensureError(ruleName, typeOrProp, sets) {
		return Rule.ensureConditionType(ruleName, typeOrProp, ConditionType.Error, sets);
	};

	// creates an error for the specified rule and type or property
	Rule.ensureWarning = function Rule$ensureWarning(ruleName, typeOrProp, sets) {
		return Rule.ensureConditionType(ruleName, typeOrProp, ConditionType.Warning, sets);
	};

	// publicly expose the rule
	ExoWeb.Model.Rule = Rule;

	// #endregion

	// #region ExoWeb.Model.RuleInput
	//////////////////////////////////////////////////

	function RuleInput(property) {
		this.property = property;
	}

	RuleInput.prototype = {
		set_dependsOnInit: function RuleInput$set_dependsOnInit(value) {
			this._init = value;
		},
		get_dependsOnInit: function RuleInput$get_dependsOnInit() {
			return this._init === undefined ? false : this._init;
		},
		set_dependsOnChange: function RuleInput$set_dependsOnChange(value) {
			this._change = value;
		},
		get_dependsOnChange: function RuleInput$get_dependsOnChange() {
			return this._change === undefined ? true : this._change;
		},
		set_dependsOnGet: function RuleInput$set_dependsOnGet(value) {
			this._get = value;
		},
		get_dependsOnGet: function RuleInput$get_dependsOnGet() {
			return this._get === undefined ? false : this._get;
		},
		get_isTarget: function RuleInput$get_isTarget() {
			return this._isTarget === undefined ? false : this._isTarget;
		},
		set_isTarget: function RuleInput$set_isTarget(value) {
			this._isTarget = value;
		}
	};
	ExoWeb.Model.RuleInput = RuleInput;

	// #endregion

	// #region ExoWeb.Model.ConditionRule
	//////////////////////////////////////////////////

	function ConditionRule(rootType, options) {
		/// <summary>Creates a rule that asserts a condition based on a predicate.</summary>
		/// <param name="rootType" type="Type">The model type the rule is for.</param>
		/// <param name="options" type="Object">
		///		The options for the rule, including:
		///			assert:				a predicate that returns true when the condition should be asserted
		///			name:				the optional unique name of the type of rule
		///			conditionType:		the optional condition type to use, which will be automatically created if not specified
		///			category:			ConditionType.Error || ConditionType.Warning (defaults to ConditionType.Error)
		///			message:			the message to show the user when the validation fails
		///			properties:			an array of property paths the validation condition should be attached to when asserted, in addition to the target property
		///			sets:				the optional array of condition type sets to associate the condition with
		///			onInit:				true to indicate the rule should run when an instance of the root type is initialized, otherwise false
		///			onInitNew:			true to indicate the rule should run when a new instance of the root type is initialized, otherwise false
		///			onInitExisting:		true to indicate the rule should run when an existing instance of the root type is initialized, otherwise false
		///			onChangeOf:			an array of property paths (strings, Property or PropertyChain instances) that drive when the rule should execute due to property changes
		/// </param>
		/// <returns type="ConditionRule">The new condition rule.</returns>

		// exit immediately if called with no arguments
		if (arguments.length === 0) return;

		// ensure the rule name is specified
		options.name = options.name || "Condition";

		// store the condition predicate
		var assert = options.assert || options.fn;
		if (assert) {
			this.assert = assert;
		}

		// automatically run the condition rule during initialization of new instances
		if (!options.hasOwnProperty("onInitNew")) {
			options.onInitNew = true;
		}

		// coerce string to condition type
		var conditionType = options.conditionType;
		if (isString(conditionType)) {
			conditionType = ConditionType.get(conditionType);
		}

		// create a condition type if not passed in, defaulting to Error if a condition category was not specified
		Object.defineProperty(this, "conditionType", { 
			value: conditionType || Rule.ensureConditionType(options.name, rootType, options.category || ConditionType.Error, options.sets)
		});

		// automatically run the condition rule during initialization of existing instances if the condition type was defined on the client
		if (!options.hasOwnProperty("onInitExisting") && this.conditionType.origin !== "server") {
			options.onInitExisting = true;
		}

		// store the condition message and properties
		if (options.message) {
			Object.defineProperty(this, "message", { value: options.message, writable: true });
		}
		if (options.properties) {
			Object.defineProperty(this, "properties", { value: options.properties, writable: true });
		}

		// Call the base rule constructor
		Rule.apply(this, [rootType, options]);
	}

	// setup the inheritance chain
	ConditionRule.prototype = new Rule();
	ConditionRule.prototype.constructor = ConditionRule;

	// implement the execute method
	ConditionRule.mixin({

		// subclasses may override this function to return the set of properties to attach conditions to for this rule
		properties: function ConditionRule$properties() {
			return this.hasOwnProperty("properties") ? this.properties : [];
		},

		// subclasses may override this function to calculate an appropriate message for this rule during the registration process
		message: function ConditionRule$message() {
			return this.conditionType.message;
		},

		// subclasses may override this function to indicate whether the condition should be asserted
		assert: function ConditionRule$assert(obj) {
			throw new Error("ConditionRule.assert() must be passed into the constructor or overriden by subclasses.");
		},

		// asserts the condition and adds or removes it from the model if necessary
		execute: function ConditionRule$execute(obj, args) {

			var assert;

			// call assert the root object as "this" if the assertion function was overriden in the constructor
			if (this.hasOwnProperty("assert")) {

				// convert string functions into compiled functions on first execution
				if (this.assert.constructor === String) {
					this.assert = this.rootType.compileExpression(this.assert);
				}
				assert = this.assert.call(obj, obj, args);
			}

			// otherwise, allow "this" to be the current rule to support subclasses that override assert
			else {
				assert = this.assert(obj);
			}

			var message = this.message;
			if (message instanceof Function) {
				if (this.hasOwnProperty("message")) {
					// When message is overriden, use the root object as this
					message = message.bind(obj);
				}
				else {
					message = message.bind(this);
				}
			}

			// create or remove the condition if necessary
			if (assert !== undefined) {
				this.conditionType.when(assert, obj,
						this.properties instanceof Function ? this.properties(obj) : this.properties,
						message);
			}
		},
	
		// gets the string representation of the condition rule
		toString: function () {
			return this.message || this.conditionType.message;
		}
	});

	// expose the rule publicly
	Rule.condition = ConditionRule;
	ExoWeb.Model.ConditionRule = ConditionRule;

	// #endregion

	// #region ExoWeb.Model.ValidatedPropertyRule
	//////////////////////////////////////////////////

	function ValidatedPropertyRule(rootType, options) {
		/// <summary>Creates a rule that validates the value of a property in the model.</summary>
		/// <param name="rootType" type="Type">The model type the rule is for.</param>
		/// <param name="options" type="Object">
		///		The options for the rule, including:
		///			property:			the property being validated (either a Property instance or string property name)
		///			isValid:			function (obj, prop, val) { return true; } (a predicate that returns true when the property is valid)
		///			name:				the optional unique name of the type of validation rule
		///			conditionType:		the optional condition type to use, which will be automatically created if not specified
		///			category:			ConditionType.Error || ConditionType.Warning (defaults to ConditionType.Error)
		///			message:			the message to show the user when the validation fails	
		///			properties:			an array of property paths the validation condition should be attached to when asserted, in addition to the target property
		///			onInit:				true to indicate the rule should run when an instance of the root type is initialized, otherwise false
		///			onInitNew:			true to indicate the rule should run when a new instance of the root type is initialized, otherwise false
		///			onInitExisting:		true to indicate the rule should run when an existing instance of the root type is initialized, otherwise false
		///			onChangeOf:			an array of property paths (strings, Property or PropertyChain instances) that drive when the rule should execute due to property changes
		/// </param>
		/// <returns type="ValidatedPropertyRule">The new validated property rule.</returns>

		// exit immediately if called with no arguments
		if (arguments.length == 0) return;

		// ensure the rule name is specified
		options.name = options.name || "ValidatedProperty";

		// store the property being validated
		var prop = options.property instanceof Property ? options.property : rootType.property(options.property);
		Object.defineProperty(this, "property", { value: prop });

		// override the prototype isValid function if specified
		if (options.isValid instanceof Function) {
			this.isValid = options.isValid;
		}

		// ensure the properties and predicates to include the target property
		if (!options.properties) {
			options.properties = [prop.get_name()];
		}
		else if (options.properties.indexOf(prop.get_name()) < 0 && options.properties.indexOf(prop) < 0) {
			options.properties.push(prop.get_name());
		}
		if (!options.onChangeOf) {
			options.onChangeOf = [prop];
		}
		else if (options.onChangeOf.indexOf(prop.get_name()) < 0 && options.onChangeOf.indexOf(prop) < 0) {
			options.onChangeOf.push(prop);
		}

		// create a property specified condition type if not passed in, defaulting to Error if a condition category was not specified
		options.conditionType = options.conditionType || Rule.ensureConditionType(options.name, this.property, options.category || ConditionType.Error);

		// Replace the property label token in the validation message if present
		if (options.message) {
			var rule = this;
			var message = options.message;
			var hasTokens = Format.hasTokens(prop.get_label());
		
			if (typeof (message) === "function") {
				// Create a function to apply the format to the property label when generating the message
				options.message = function (obj) {
					var messageTemplate = message.apply(this, [obj]);
					return messageTemplate.replace("{property}", hasTokens ? rule.getPropertyLabelFormat().convert(this) : prop.get_label());
				};
			}
			else if (typeof (message) === "string" && hasTokens) {
				// Create a function to apply the format to the property label when generating the message
				options.message = function (obj) {
					return message.replace("{property}", rule.getPropertyLabelFormat().convert(this));
				};
			}
			else {
				var label = prop.get_label();
				// Escaped unescaped quotes
				if (label.indexOf("\"") >= 0) {
					var text = ""; var prev = "";
					label.split("").forEach(function (c) {
						if (c === "\"" && prev !== "\\")
							text += "\\" + c;
						else
							text += c;
						prev = c;
					});
					label = text;
				}
				options.message = message.replace('{property}', label);
			}
		}

		// call the base rule constructor
		ConditionRule.apply(this, [rootType, options]);
	}

	// setup the inheritance chain
	ValidatedPropertyRule.prototype = new ConditionRule();
	ValidatedPropertyRule.prototype.constructor = ValidatedPropertyRule;

	// extend the base type
	ValidatedPropertyRule.mixin({

		// returns false if the property is valid, true if invalid, or undefined if unknown
		assert: function ValidatedPropertyRule$assert(obj) {

			var isValid = this.isValid(obj, this.property, this.property.value(obj));
			return isValid === undefined ? isValid : !isValid;
		},

		// perform addition initialization of the rule when it is registered
		onRegister: function () {

			// register the rule with the target property
			registerPropertyRule(this.property, this);
		},

		getPropertyLabelFormat: function () {
			// convert the property label into a model format
			if (!this._propertyLabelFormat)
				this._propertyLabelFormat = ExoWeb.Model.getFormat(this.rootType.get_jstype(), this.property.get_label());
			return this._propertyLabelFormat;
		},

		getPropertyLabel: function (obj) {
			if (Format.hasTokens(this.property.get_label())) {
				return this.getPropertyLabelFormat().convert(obj);
			} else {
				return this.property.get_label();
			}
		},

		preRegister: function (callback, thisPtr) {
			// Exit if the rule is no tin a valid state
			if (!this.rootType) {
				return false;
			}

			// Exit if the property label does not contain tokens
			if (!Format.hasTokens(this.property.get_label())) {
				return false;
			}

			var registerFormatPaths = function (formatPaths) {
				if (formatPaths.length <= 0)
					return;

				if (!this._options)
					this._options = {};

				if (!this._options.onChangeOf)
					this._options.onChangeOf = [];

				formatPaths.forEach(function (p) {
					this.rootType.getPaths(p).forEach(function(prop) {
						if (this._options.onChangeOf.indexOf(prop) < 0) {
							if (typeof this._options.onChangeOf === "string")
								this._options.onChangeOf = [this._options.onChangeOf];

							this._options.onChangeOf.push(prop);
						}
					}, this);
				}, this);
			};

			// Ensure tokens included in the format trigger rule execution
			if (callback && callback instanceof Function) {
				this.getPropertyLabelFormat().getPaths(function (formatPaths) {
					registerFormatPaths.call(this, formatPaths);
					callback.call(thisPtr || this);
				}, this);
			} else {
				var formatPaths = this.getPropertyLabelFormat().getPaths();
				registerFormatPaths.call(this, formatPaths);
				return true;
			}
		}
	});

	// Expose the rule publicly
	Rule.validated = ValidatedPropertyRule;
	ExoWeb.Model.ValidatedPropertyRule = ValidatedPropertyRule;

	// #endregion

	// #region ExoWeb.Model.CalculatedPropertyRule
	//////////////////////////////////////////////////

	function CalculatedPropertyRule(rootType, options) {
		/// <summary>Creates a rule that calculates the value of a property in the model.</summary>
		/// <param name="rootType" type="Type">The model type the rule is for.</param>
		/// <param name="options" type="Object">
		///		The options for the rule, including:
		///			property:		the property being calculated (either a Property instance or string property name)
		///			calculate:		a function that returns the value to assign to the property, or undefined if the value cannot be calculated
		///			defaultIfError: the value to return if an error occurs, or undefined to cause an exception to be thrown
		///			name:			the optional unique name of the rule
		///		    onInit:			true to indicate the rule should run when an instance of the root type is initialized, otherwise false
		///		    onInitNew:		true to indicate the rule should run when a new instance of the root type is initialized, otherwise false
		///		    onInitExisting:	true to indicate the rule should run when an existing instance of the root type is initialized, otherwise false
		///		    onChangeOf:		an array of property paths (strings, Property or PropertyChain instances) that drive when the rule should execute due to property changes
		/// </param>
		/// <returns type="CalculatedPropertyRule">The new calculated property rule.</returns>

		// store the property being validated
		var prop = options.property instanceof Property ? options.property : rootType.property(options.property);
		Object.defineProperty(this, "property", { value: prop });

		Object.defineProperty(this, "useOptimalUpdates", { value: options.useOptimalUpdates !== false });

		// ensure the rule name is specified
		options.name = options.name || (rootType.get_fullName() + "." + prop.get_name() + ".Calculated");

		// store the calculation function
		Object.defineProperty(this, "calculate", { value: options.calculate || options.fn, writable: true });

		// store the calculation function
		Object.defineProperty(this, "defaultIfError", { value: options.hasOwnProperty("defaultIfError") ? options.defaultIfError : ExoWeb.config.calculationErrorDefault });

		// indicate that the rule is responsible for returning the value of the calculated property
		options.returns = [prop];

		// Call the base rule constructor 
		Rule.apply(this, [rootType, options]);
	}

	// setup the inheritance chain
	CalculatedPropertyRule.prototype = new Rule();
	CalculatedPropertyRule.prototype.constructor = CalculatedPropertyRule;

	// extend the base type
	CalculatedPropertyRule.mixin({
		execute: function CalculatedPropertyRule$execute(obj) {
			var prop = this.property;

			// convert string functions into compiled functions on first execution
			if (this.calculate.constructor === String) {
				this.calculate = this.rootType.compileExpression(this.calculate);
			}

			// calculate the new property value
			var newValue;
			if (this.defaultIfError === undefined)
				newValue = this.calculate.apply(obj, [obj]);
			else {
				try {
					newValue = this.calculate.apply(obj, [obj]);
				}
				catch (e) {
					newValue = this.defaultIfError;
				}
			}

			// exit immediately if the calculated result was undefined
			if (newValue === undefined) return;

			// modify list properties to match the calculated value instead of overwriting the property
			if (prop.get_isList()) {

				// re-calculate the list values
				var newList = newValue;

				// compare the new list to the old one to see if changes were made
				var curList = prop.value(obj);

				if (newList.length === curList.length) {
					var noChanges = true;

					for (var i = 0; i < newList.length; ++i) {
						if (newList[i] !== curList[i]) {
							noChanges = false;
							break;
						}
					}

					if (noChanges) {
						return;
					}
				}

				// update the current list so observers will receive the change events
				curList.beginUpdate();
				if (this.useOptimalUpdates)
					update(curList, newList);
				else {
					curList.clear();
					curList.addRange(newList);
				}
				curList.endUpdate();
			}

			// otherwise, just set the property to the new value
			else {
				prop.value(obj, newValue, { calculated: true });
			}
		},
		toString: function () {
			return "calculation of " + this.property._name;
		},
		// perform addition initialization of the rule when it is registered
		onRegister: function () {

			// register the rule with the target property
			registerPropertyRule(this.property, this);
		}
	});

	// expose the rule publicly
	Rule.calculated = CalculatedPropertyRule;
	ExoWeb.Model.CalculatedPropertyRule = CalculatedPropertyRule;

	// #endregion

	// #region ExoWeb.Model.RequiredRule
	//////////////////////////////////////////////////

	function RequiredRule(rootType, options) {
		/// <summary>Creates a rule that validates that a property has a value.</summary>
		/// <param name="rootType" type="Type">The model type the rule is for.</param>
		/// <param name="options" type="Object">
		///		The options for the rule, including:
		///			property:			the property being validated (either a Property instance or string property name)
		///			name:				the optional unique name of the type of validation rule
		///			conditionType:		the optional condition type to use, which will be automatically created if not specified
		///			category:			ConditionType.Error || ConditionType.Warning (defaults to ConditionType.Error)
		///			message:			the message to show the user when the validation fails
		///			requiredValue:		the optional required value
		/// </param>
		/// <returns type="RequiredRule">The new required rule.</returns>

		// ensure the rule name is specified
		options.name = options.name || "Required";

		// ensure the error message is specified
		options.message = options.message || Resource.get("required");

		if (options.requiredValue)
			Object.defineProperty(this, "requiredValue", { value: options.requiredValue });

		// call the base type constructor
		ValidatedPropertyRule.apply(this, [rootType, options]);
	}

	// setup the inheritance chain
	RequiredRule.prototype = new ValidatedPropertyRule();
	RequiredRule.prototype.constructor = RequiredRule;

	// define a global function that determines if a value exists
	RequiredRule.hasValue = function RequiredRule$hasValue(val) {
		return val !== undefined && val !== null && (val.constructor !== String || val.trim() !== "") && (!(val instanceof Array) || val.length > 0);
	};

	// extend the base type
	RequiredRule.mixin({

		// returns true if the property is valid, otherwise false
		isValid: function RequiredRule$isValid(obj, prop, val) {
			if (this.requiredValue)
				return val === this.requiredValue;
			else
				return RequiredRule.hasValue(val);
		},

		// get the string representation of the rule
		toString: function () {
			return $format("{0}.{1} is required", [this.property.get_containingType().get_fullName(), this.property.get_name()]);
		}
	});

	// Expose the rule publicly
	Rule.required = RequiredRule;
	ExoWeb.Model.RequiredRule = RequiredRule;

	// #endregion

	// #region ExoWeb.Model.ValidationRule
	//////////////////////////////////////////////////

	function ValidationRule(rootType, options) {
		/// <summary>Creates a rule that performs custom validation for a property.</summary>
		/// <param name="rootType" type="Type">The model type the rule is for.</param>
		/// <param name="options" type="Object">
		///		The options for the rule, including:
		///			property:			the property being validated (either a Property instance or string property name)
		///			name:				the optional unique name of the type of validation rule
		///			conditionType:		the optional condition type to use, which will be automatically created if not specified
		///			category:			ConditionType.Error || ConditionType.Warning (defaults to ConditionType.Error)
		///			message:			the message to show the user when the validation fails
		///			requiredValue:		the optional required value
		/// </param>
		/// <returns type="RequiredRule">The new required rule.</returns>

		// ensure the rule name is specified
		options.name = options.name || "Validation";
	
		if (options.message) {
			// Evaluate the message as a localizable resource
			if (Resource.get(options.message))
				options.message = Resource.get(options.message);
		} else if (options.messageFn) {
			// Store the message function if specified
			Object.defineProperty(this, "messageFn", { value: options.messageFn, writable: true });
		} else {
			// Set a default error message is one is not specified
			options.message = Resource.get("validation");
		}
	
		// predicate-based rule
		if (options.isError || options.fn) {
			Object.defineProperty(this, "isError", { value: options.isError || options.fn, writable: true });
		}

		// call the base type constructor
		ValidatedPropertyRule.apply(this, [rootType, options]);
	}

	// setup the inheritance chain
	ValidationRule.prototype = new ValidatedPropertyRule();
	ValidationRule.prototype.constructor = ValidationRule;

	// extend the base type
	ValidationRule.mixin({

		message: function (obj) {
			var message = "";
			var prop = this.property;
			var hasTokens = Format.hasTokens(prop.get_label());

			if (this.messageFn) {
				// convert string functions into compiled functions on first execution
				if (this.messageFn.constructor === String) {
					this.messageFn = this.rootType.compileExpression(this.messageFn);
				}

				// Invoke the function bound to the entity, and also pass the entity as the argument
				// This is consitent with how rule 'message' option that is an own property is called in this manner (see: ConditionRule.js)
				message = this.messageFn.apply(obj, [obj]);

				// Convert a non-string message into a string
				if (message != null && typeof message !== "string") {
					logWarning("Converting message of type '" + (typeof message) + "' for rule '" + this.name + "' to a string.");
					message = message.toString();
				}
			} else {
				// Fall back to the default validation message
				message = Resource.get("validation");
			}

			// Replace the {property} token with the property label (or evaluated label format)
			message = message.replace("{property}", hasTokens ? this.getPropertyLabelFormat().convert(obj) : prop.get_label());

			return message;
		},

		// returns true if the property is valid, otherwise false
		isValid: function ValidationRule$isValid(obj, prop, val) {		
			// convert string functions into compiled functions on first execution
			if (this.isError.constructor === String) {
				this.isError = this.rootType.compileExpression(this.isError);
			}

			try {
				if (!this.isError.apply(obj, [obj])) {
					// The 'isError' function returned false, so consider the object to be valid
					return true;
				} else {
					var message = this.message;
					if (message instanceof Function) {
						if (this.hasOwnProperty("message")) {
							// When message is overriden, use the root object as this (see: ConditionRule.js)
							message = message.bind(obj);
						}
						else {
							message = message.bind(this);
						}

						// Invoke the message function to ensure that it will produce a value
						message = message(obj);
					}

					// If there is no message, then consider the object to be valid
					return !message;
				}
			}
			catch (e) {
				// If 'isError' or 'messageFn' throws an error, then consider the object to be valid
				logWarning(e);
				return true;
			}
		},

		// get the string representation of the rule
		toString: function () {
			return $format("{0}.{1} is invalid", [this.property.get_containingType().get_fullName(), this.property.get_name()]);
		}
	});

	// Expose the rule publicly
	Rule.validation = ValidationRule;
	ExoWeb.Model.ValidationRule = ValidationRule;

	// #endregion

	// #region ExoWeb.Model.RangeRule
	//////////////////////////////////////////////////

	function RangeRule(rootType, options) {
		/// <summary>Creates a rule that validates a property value is within a specific range.</summary>
		/// <param name="rootType" type="Type">The model type the rule is for.</param>
		/// <param name="options" type="Object">
		///		The options for the rule, including:
		///			property:			the property being validated (either a Property instance or string property name)
		///			min:				the minimum valid value of the property
		///			max:				the maximum valid value of the property
		///			minFn:				a function returning the minimum valid value of the property
		///			maxFn:				a function returning the maximum valid value of the property
		///			name:				the optional unique name of the type of validation rule
		///			conditionType:		the optional condition type to use, which will be automatically created if not specified
		///			category:			ConditionType.Error || ConditionType.Warning (defaults to ConditionType.Error)
		///			message:			the message to show the user when the validation fails
		///		    onChangeOf:			an array of property paths (strings, Property or PropertyChain instances) that drive when the rule should execute due to property changes
		/// </param>
		/// <returns type="RangeRule">The new range rule.</returns>

		// exit immediately if called with no arguments
		if (arguments.length == 0) return;

		// ensure the rule name is specified
		options.name = options.name || "Range";

		// get the property being validated in order to determine the data type
		var property = options.property instanceof Property ? options.property : rootType.property(options.property);

		// coerce date range constants
		if (options.min && property.get_jstype() === Date) {
			options.min = new Date(options.min);
		}
		if (options.max && property.get_jstype() === Date) {
			options.max = new Date(options.max);
		}

		// coerce null ranges to undefined
		if (options.min === null) {
			options.min = undefined;
		}
		if (options.max === null) {
			options.max = undefined;
		}

		// convert constant values into functions
		if (!options.minFn) {
			options.minFn = function() { return options.min; };
		}
		if (!options.maxFn) {
			options.maxFn = function() { return options.max; };
		}

		// Store the min and max functions
		Object.defineProperty(this, "min", { value: options.minFn, writable: true });
		Object.defineProperty(this, "max", { value: options.maxFn, writable: true });

		// call the base type constructor
		ValidatedPropertyRule.apply(this, [rootType, options]);
	}

	// setup the inheritance chain
	RangeRule.prototype = new ValidatedPropertyRule();
	RangeRule.prototype.constructor = RangeRule;

	// extend the base type
	RangeRule.mixin({

		// get the min and max range in effect for this rule for the specified instance
		range: function RangeRule$range(obj) {

			// convert string functions into compiled functions on first execution
			if (this.min && this.min.constructor === String) {
				this.min = this.rootType.compileExpression(this.min);
			}
			if (this.max && this.max.constructor === String) {
				this.max = this.rootType.compileExpression(this.max);
			}

			// determine the min and max values based on the current state of the instance
			var range = { };
			try { range.min = this.min.call(obj); }	catch (e) { }
			try { range.max = this.max.call(obj); }	catch (e) { }
			range.min = range.min == null ? undefined : range.min;
			range.max = range.max == null ? undefined : range.max;

			return range;
		},

		// returns true if the property is valid, otherwise false
		isValid: function RangeRule$isValid(obj, prop, val) { 

			var range = this.range(obj);

			return val === null || val === undefined || ((range.min === undefined || val >= range.min) && (range.max === undefined || val <= range.max));
		},

		message: function RangeRule$message(obj) {

			var range = this.range(obj);

			// ensure the error message is specified
			var message =
				(range.min !== undefined && range.max !== undefined ? Resource.get("range-between").replace("{min}", this.property.format(range.min)).replace("{max}", this.property.format(range.max)) : // between date or ordinal
					this.property.get_jstype() === Date ?
						range.min !== undefined ?
							Resource.get("range-on-or-after").replace("{min}", this.property.format(range.min)) : // on or after date
							Resource.get("range-on-or-before").replace("{max}", this.property.format(range.max)) : // on or before date
						range.min !== undefined ?
							Resource.get("range-at-least").replace("{min}", this.property.format(range.min)) : // at least ordinal
							Resource.get("range-at-most").replace("{max}", this.property.format(range.max))); // at most ordinal

			return message.replace('{property}', this.getPropertyLabel(obj));		
		},

		// get the string representation of the rule
		toString: function () {
			return $format("{0}.{1} in range, min: {2}, max: {3}",
				[this.get_property().get_containingType().get_fullName(),
				this.get_property().get_name(),
				this.min ? "" : this.min,
				this.max ? "" : this.max]);
		}
	});

	// Expose the rule publicly
	Rule.range = RangeRule;
	ExoWeb.Model.RangeRule = RangeRule;

	// #endregion

	// #region ExoWeb.Model.AllowedValuesRule
	//////////////////////////////////////////////////

	function AllowedValuesRule(rootType, options) {
		/// <summary>Creates a rule that validates whether a selected value or values is in a list of allowed values.</summary>
		/// <param name="rootType" type="Type">The model type the rule is for.</param>
		/// <param name="options" type="Object">
		///		The options for the rule, including:
		///			property:		the property being validated (either a Property instance or string property name)
		///			source:			the source property for the allowed values (either a Property or PropertyChain instance or a string property path)
		///			name:			the optional unique name of the rule
		///			conditionType:	the optional condition type to use, which will be automatically created if not specified
		///			category:		ConditionType.Error || ConditionType.Warning, defaults to ConditionType.Error if not specified
		///			message:		the message to show the user when the validation fails
		/// </param>
		/// <returns type="AllowedValuesRule">The new allowed values rule.</returns>

		// ensure the rule name is specified
		options.name = options.name || "AllowedValues";

		// ensure the error message is specified
		options.message = options.message || Resource.get("allowed-values");

		// define properties for the rule
		if (options.source instanceof Property || options.source instanceof PropertyChain) {
			Object.defineProperty(this, "sourcePath", { value: options.source.get_path() });
			Object.defineProperty(this, "source", { value: options.source });
			options.onChangeOf = [options.source];
		}
		else if (options.source instanceof Function || options.fn) {
			Object.defineProperty(this, "sourceFn", { value: options.source || options.fn, writable: true });
			options.fn = null;
		}
		else {
			Object.defineProperty(this, "sourcePath", { value: options.source });
			options.onChangeOf = [options.source];
		}

		if (options.ignoreValidation) {
		    Object.defineProperty(this, "ignoreValidation", { value: options.ignoreValidation });
		}

		// create a property specified condition type if not passed in, defaulting to Error if a condition category was not specified
		options.conditionType = options.conditionType || Rule.ensureConditionType(options.name, this.property, options.category || ConditionType.Error);

		// never run allowed values rules during initialization of existing instances
		if (!options.hasOwnProperty("onInitExisting") && options.conditionType.origin === "server") {
			options.onInitExisting = false;
		}

		// call the base type constructor
		ValidatedPropertyRule.apply(this, [rootType, options]);
	}

	// setup the inheritance chain
	AllowedValuesRule.prototype = new ValidatedPropertyRule();
	AllowedValuesRule.prototype.constructor = AllowedValuesRule;

	// extend the base type
	AllowedValuesRule.mixin({
		onRegister: function AllowedValuesRule$onRegister() {

			// get the allowed values source, if only the path was specified
			if (!this.source && !this.sourceFn) {
				Object.defineProperty(this, "source", { value: Model.property(this.sourcePath, this.rootType) });
			}

			// call the base method
			ValidatedPropertyRule.prototype.onRegister.call(this);
		},
		isValid: function AllowedValuesRule$isValid(obj, prop, value) {

		    //gives the ability to create a drop down of available options
	        //but does not need validatin (combo box)
		    if (this.ignoreValidation) {
		        return true;
		    }

			// return true if no value is currently selected
			if (!value) {
				return true;
			}

			// get the list of allowed values of the property for the given object
			var allowed = this.values(obj);

			// return undefined if the set of allowed values cannot be determined
			if (!LazyLoader.isLoaded(allowed)) {
				return;
			}

			// ensure that the value or list of values is in the allowed values list (single and multi-select)				
			if (value instanceof Array) {
				return value.every(function (item) { return Array.contains(allowed, item); });
			}
			else {
				return Array.contains(allowed, value);
			}
		},

		// Subscribes to changes to the allow value predicates, indicating that the allowed values have changed
		addChanged: function AllowedValuesRule$addChanged(handler, obj, once) {
			for (var p = 0; p < this.predicates.length; p++) {
				var predicate = this.predicates[p];
				if (predicate !== this.property)
					predicate.addChanged(handler, obj, once);
			}
		},

		// Unsubscribes from changes to the allow value predicates
		removeChanged: function AllowedValuesRule$removeChanged(handler, obj, once) {
			for (var p = 0; p < this.predicates.length; p++) {
				var predicate = this.predicates[p];
				if (predicate !== this.property)
					predicate.removeChanged(handler, obj, once);
			}
		},

		values: function AllowedValuesRule$values(obj, exitEarly) {
			if (!this.source && !this.sourceFn) {
				logWarning("AllowedValues rule on type \"" + this.prop.get_containingType().get_fullName() + "\" has not been initialized.");
				return;
			}

			// Function-based allowed values
			if (this.sourceFn) {

				// convert string functions into compiled functions on first execution
				if (this.sourceFn.constructor === String) {
					this.sourceFn = this.rootType.compileExpression(this.sourceFn);
				}

				return this.sourceFn.call(obj, obj);
			}

			// Property path-based allowed values
			else {
				// For non-static properties, verify that a final target exists and
				// if not return an appropriate null or undefined value instead.
				if (!this.source.get_isStatic()) {
					// Get the value of the last target for the source property (chain).
					var lastTarget = this.source.lastTarget(obj, exitEarly);

					// Use the last target to distinguish between the absence of data and
					// data that has not been loaded, if a final value cannot be obtained.
					if (lastTarget === undefined) {
						// Undefined signifies unloaded data
						return undefined;
					}
					else if (lastTarget === null) {
						// Null signifies the absensce of a value
						return null;
					}
				}

				// Return the value of the source for the given object
				return this.source.value(obj);
			}
		},
		toString: function AllowedValuesRule$toString() {
			return $format("{0}.{1} allowed values = {2}", [this.property.get_containingType().get_fullName(), this.property.get_name(), this._sourcePath]);
		}
	});

	// expose the rule publicly
	Rule.allowedValues = AllowedValuesRule;
	ExoWeb.Model.AllowedValuesRule = AllowedValuesRule;

	// #endregion

	// #region ExoWeb.Model.CompareRule
	//////////////////////////////////////////////////

	function CompareRule(rootType, options) {
		/// <summary>Creates a rule that validates a property by comparing it to another property.</summary>
		/// <param name="rootType" type="Type">The model type the rule is for.</param>
		/// <param name="options" type="Object">
		///		The options for the rule, including:
		///			property:			the property being validated (either a Property instance or string property name)
		///			compareSource:		the source property to compare to (either a Property or PropertyChain instance or a string property path)
		///			compareOperator:	the relational comparison operator to use (one of "Equal", "NotEqual", "GreaterThan", "GreaterThanEqual", "LessThan" or "LessThanEqual")
		///			name:				the optional unique name of the type of validation rule
		///			conditionType:		the optional condition type to use, which will be automatically created if not specified
		///			category:			ConditionType.Error || ConditionType.Warning (defaults to ConditionType.Error)
		///			message:			the message to show the user when the validation fails
		/// </param>
		/// <returns type="CompareRule">The new compare rule.</returns>

		// exit immediately if called with no arguments
		if (arguments.length == 0) return;

		options.name = options.name || "Compare";
	
		// ensure changes to the compare source triggers rule execution
		if (options.compareSource)
			options.onChangeOf = [options.compareSource];

		// define properties for the rule
		Object.defineProperty(this, "compareOperator", { value: options.compareOperator });
		if (options.source instanceof Property || options.compareSource instanceof PropertyChain) {
			Object.defineProperty(this, "comparePath", { value: options.compareSource.get_path() });
			Object.defineProperty(this, "compareSource", { value: options.compareSource });
		}
		else {
			Object.defineProperty(this, "comparePath", { value: options.compareSource });
		}

		// call the base type constructor
		ValidatedPropertyRule.apply(this, [rootType, options]);
	}

	// compares the source value to a comparison value using the specified operator
	CompareRule.compare = function CompareRule$compare(sourceValue, compareOp, compareValue, defaultValue) {
		if (compareValue === undefined || compareValue === null) {
			switch (compareOp) {
				case "Equal": return !RequiredRule.hasValue(sourceValue);
				case "NotEqual": return RequiredRule.hasValue(sourceValue);
			}
		}

		if (sourceValue !== undefined && sourceValue !== null && compareValue !== undefined && compareValue !== null) {
			switch (compareOp) {
				case "Equal": return sourceValue == compareValue;
				case "NotEqual": return sourceValue != compareValue;
				case "GreaterThan": return sourceValue > compareValue;
				case "GreaterThanEqual": return sourceValue >= compareValue;
				case "LessThan": return sourceValue < compareValue;
				case "LessThanEqual": return sourceValue <= compareValue;
			}
			// Equality by default.
			return sourceValue == compareValue;
		}

		return defaultValue;
	};

	// setup the inheritance chain
	CompareRule.prototype = new ValidatedPropertyRule();
	CompareRule.prototype.constructor = CompareRule;

	// extend the base type
	CompareRule.mixin({

		// return true of the comparison is valid, otherwise false
		isValid: function Compare$isValid(obj, prop, value) {
			var compareValue = this.compareSource.value(obj);
			return CompareRule.compare(value, this.compareOperator, compareValue, true);
		},

		// calculates the appropriate message based on the comparison operator and data type
		message: function () {
			var message;
			var isDate = this.compareSource.get_jstype() === Date;
			if (this.compareOperator === "Equal") {
				message = Resource.get("compare-equal");
			}
			else if (this.compareOperator === "NotEqual") {
				message = Resource.get("compare-not-equal");
			}
			else if (this.compareOperator === "GreaterThan") {
				message = Resource.get(isDate ? "compare-after" : "compare-greater-than");
			}
			else if (this.compareOperator === "GreaterThanEqual") {
				message = Resource.get(isDate ? "compare-on-or-after" : "compare-greater-than-or-equal");
			}
			else if (this.compareOperator === "LessThan") {
				message = Resource.get(isDate ? "compare-before" : "compare-less-than");
			}
			else if (this.compareOperator === "LessThanEqual") {
				message = Resource.get(isDate ? "compare-on-or-before" : "compare-less-than-or-equal");
			}
			else {
				throw new Error("Invalid comparison operator for compare rule.");
			}

			message = message.replace("{compareSource}", this.compareSource.get_label());

			return message.replace('{property}', this.getPropertyLabel(obj));
		},

		// perform addition initialization of the rule when it is registered
		onRegister: function () {

			// get the compare source, if only the path was specified
			if (!this.compareSource && this.comparePath) {
				Object.defineProperty(this, "compareSource", { value: Model.property(this.comparePath, this.rootType) });
			}

			// call the base method
			ValidatedPropertyRule.prototype.onRegister.call(this);
		}
	});

	// expose the rule publicly
	Rule.compare = CompareRule;
	ExoWeb.Model.CompareRule = CompareRule;

	// #endregion

	// #region ExoWeb.Model.RequiredIfRule
	//////////////////////////////////////////////////

	function RequiredIfRule(rootType, options) {
		/// <summary>Creates a rule that conditionally validates whether a property has a value.</summary>
		/// <param name="rootType" type="Type">The model type the rule is for.</param>
		/// <param name="options" type="Object">
		///		The options for the rule, including:
		///			property:			the property being validated (either a Property instance or string property name)
		///			isRequired:			a predicate function indicating whether the property should be required
		///			compareSource:		the source property to compare to (either a Property or PropertyChain instance or a string property path)
		///			compareOperator:	the relational comparison operator to use (one of "Equal", "NotEqual", "GreaterThan", "GreaterThanEqual", "LessThan" or "LessThanEqual")
		///			compareValue:		the optional value to compare to
		///			name:				the optional unique name of the type of validation rule
		///			conditionType:		the optional condition type to use, which will be automatically created if not specified
		///			category:			ConditionType.Error || ConditionType.Warning (defaults to ConditionType.Error)
		///			message:			the message to show the user when the validation fails
		///		    onInit:				true to indicate the rule should run when an instance of the root type is initialized, otherwise false
		///		    onInitNew:			true to indicate the rule should run when a new instance of the root type is initialized, otherwise false
		///		    onInitExisting:		true to indicate the rule should run when an existing instance of the root type is initialized, otherwise false
		///		    onChangeOf:			an array of property paths (strings, Property or PropertyChain instances) that drive when the rule should execute due to property changes
		///			requiredValue:		the optional required value
		/// </param>
		/// <returns type="RequiredIfRule">The new required if rule.</returns>

		options.name = options.name || "RequiredIf";

		// ensure changes to the compare source triggers rule execution
		if (!options.onChangeOf && options.compareSource) {
			options.onChangeOf = [options.compareSource];
		}

		// predicate-based rule
		if (options.isRequired || options.fn) {
			Object.defineProperty(this, "isRequired", { value: options.isRequired || options.fn, writable: true });
			options.fn = null;
			options.message = options.message || Resource.get("required");
		}

			// comparison-based rule
		else {
			Object.defineProperty(this, "comparePath", { value: options.compareSource });
			Object.defineProperty(this, "compareOperator", {
				value: options.compareOperator || (options.compareValue !== undefined && options.compareValue !== null ? "Equal" : "NotEqual"),
				writable: true
			});
			Object.defineProperty(this, "compareValue", { value: options.compareValue, writable: true });
		}

		if (options.requiredValue)
			Object.defineProperty(this, "requiredValue", { value: options.requiredValue });

		// call the base type constructor
		ValidatedPropertyRule.apply(this, [rootType, options]);
	}

	// setup the inheritance chain
	RequiredIfRule.prototype = new ValidatedPropertyRule();
	RequiredIfRule.prototype.constructor = RequiredIfRule;

	// extend the base type
	RequiredIfRule.mixin({

		// determines whether the property should be considered required
		isRequired: function RequiredIfRule$required(obj) {
			var sourceValue = this.compareSource.value(obj);
			return CompareRule.compare(sourceValue, this.compareOperator, this.compareValue, false);
		},

		// calculates the appropriate message based on the comparison operator and data type
		message: function () {
			var message;
			var isDate = this.compareSource.get_jstype() === Date;
			if (this.compareValue === undefined || this.compareValue === null) {
				message = Resource.get(this.compareOperator === "Equal" ? "required-if-not-exists" : "required-if-exists");
			}
			else if (this.compareOperator === "Equal") {
				message = Resource.get("required-if-equal");
			}
			else if (this.compareOperator === "NotEqual") {
				message = Resource.get("required-if-not-equal");
			}
			else if (this.compareOperator === "GreaterThan") {
				message = Resource.get(isDate ? "required-if-after" : "required-if-greater-than");
			}
			else if (this.compareOperator === "GreaterThanEqual") {
				message = Resource.get(isDate ? "required-if-on-or-after" : "required-if-greater-than-or-equal");
			}
			else if (this.compareOperator === "LessThan") {
				message = Resource.get(isDate ? "required-if-before" : "required-if-less-than");
			}
			else if (this.compareOperator === "LessThanEqual") {
				message = Resource.get(isDate ? "required-if-on-or-before" : "required-if-less-than-or-equal");
			}
			else {
				throw new Error("Invalid comparison operator for compare rule.");
			}

			message = message.replace("{compareSource}", this.compareSource.get_label())
				.replace("{compareValue}", this.compareSource.format(this.compareValue));

			return message.replace('{property}', this.getPropertyLabel(obj));
		},

		// returns false if the property is valid, true if invalid, or undefined if unknown
		assert: function RequiredIfRule$assert(obj) {
			var isReq;

			// convert string functions into compiled functions on first execution
			if (this.isRequired.constructor === String) {
				this.isRequired = this.rootType.compileExpression(this.isRequired);
			}

			if (this.hasOwnProperty("isRequired")) {
				try {
					isReq = this.isRequired.call(obj);
				}
				catch (e) {
					isReq = false;
				}
			}
				// otherwise, allow "this" to be the current rule to support subclasses that override assert
			else
				isReq = this.isRequired(obj);

			if (this.requiredValue)
				return isReq && this.property.value(obj) !== this.requiredValue;
			else
				return isReq && !RequiredRule.hasValue(this.property.value(obj));
		},

		// perform addition initialization of the rule when it is registered
		onRegister: function () {

			// call the base method
			ValidatedPropertyRule.prototype.onRegister.call(this);

			// perform addition registration for required if rules with a compare source
			if (this.comparePath) {

				// get the compare source, which is already a rule predicate and should immediately resolve
				Object.defineProperty(this, "compareSource", { value: Model.property(this.comparePath, this.rootType) });

				// flip the equality rules for boolean data types
				if (this.compareSource.get_jstype() === Boolean && this.compareOperator == "NotEqual" && (this.compareValue === undefined || this.compareValue === null)) {
					this.compareOperator = "Equal";
					this.compareValue = true;
				}
			}
		}
	});

	// Expose the rule publicly
	Rule.requiredIf = RequiredIfRule;
	ExoWeb.Model.RequiredIfRule = RequiredIfRule;

	// #endregion

	// #region ExoWeb.Model.StringLengthRule
	//////////////////////////////////////////////////

	function StringLengthRule(rootType, options) {
		/// <summary>Creates a rule that validates that the length of a string property is within a specific range.</summary>
		/// <param name="rootType" type="Type">The model type the rule is for.</param>
		/// <param name="options" type="Object">
		///		The options for the rule, including:
		///			property:			the property being validated (either a Property instance or string property name)
		///			min:				the minimum length of the property
		///			max:				the maximum length of the property
		///			name:				the optional unique name of the type of validation rule
		///			conditionType:		the optional condition type to use, which will be automatically created if not specified
		///			category:			ConditionType.Error || ConditionType.Warning (defaults to ConditionType.Error)
		///			message:			the message to show the user when the validation fails
		/// </param>
		/// <returns type="RangeRule">The new range rule.</returns>

		// ensure the rule name is specified
		options.name = options.name || "StringLength";

		// store the min and max lengths
		Object.defineProperty(this, "min", { value: options.min });
		Object.defineProperty(this, "max", { value: options.max });

		// ensure the error message is specified
		options.message = options.message ||
			(options.min && options.max ? Resource.get("string-length-between").replace("{min}", this.min).replace("{max}", this.max) :
			options.min ? Resource.get("string-length-at-least").replace("{min}", this.min) :
			Resource.get("string-length-at-most").replace("{max}", this.max));

		// call the base type constructor
		ValidatedPropertyRule.apply(this, [rootType, options]);
	}

	// setup the inheritance chain
	StringLengthRule.prototype = new ValidatedPropertyRule();
	StringLengthRule.prototype.constructor = StringLengthRule;

	// extend the base type
	StringLengthRule.mixin({

		// returns true if the property is valid, otherwise false
		isValid: function StringLengthRule$isValid(obj, prop, val) {
			return !val || val === "" || ((!this.min || val.length >= this.min) && (!this.max || val.length <= this.max));
		},

		// get the string representation of the rule
		toString: function () {
			return $format("{0}.{1} in range, min: {2}, max: {3}",
				[this.get_property().get_containingType().get_fullName(),
				this.get_property().get_name(),
				this.min ? "" : this.min,
				this.max ? "" : this.max]);
		}
	});

	// Expose the rule publicly
	Rule.stringLength = StringLengthRule;
	ExoWeb.Model.StringLengthRule = StringLengthRule;

	// #endregion

	// #region ExoWeb.Model.StringFormatRule
	//////////////////////////////////////////////////

	function StringFormatRule(rootType, options) {
		/// <summary>Creates a rule that validates that a string property value is correctly formatted.</summary>
		/// <param name="rootType" type="Type">The model type the rule is for.</param>
		/// <param name="options" type="Object">
		///		The options for the rule, including:
		///			property:			the property being validated (either a Property instance or string property name)
		///			description:		the human readable description of the format, such as MM/DD/YYY
		///		    expression:			a regular expression string or RegExp instance that the property value must match
		///		    reformat:			and optional regular expression reformat string or reformat function that will be used to correct the value if it matches
		///			name:				the optional unique name of the type of validation rule
		///			conditionType:		the optional condition type to use, which will be automatically created if not specified
		///			category:			ConditionType.Error || ConditionType.Warning (defaults to ConditionType.Error)
		///			message:			the message to show the user when the validation fails
		/// </param>
		/// <returns type="StringFormatRule">The new string format rule.</returns>

		// exit immediately if called with no arguments
		if (arguments.length == 0) return;

		// ensure the rule name is specified
		options.name = options.name || "StringFormat";


		// ensure the error message is specified
		if (Resource.get(options.message))
	        options.message = Resource.get(options.message);
	    else
	        options.message = options.message || Resource.get("string-format").replace("{formatDescription}", options.description);

		// define properties for the rule
		Object.defineProperty(this, "description", { value: options.description });
		Object.defineProperty(this, "expression", { value: options.expression instanceof RegExp ? options.expression : RegExp(options.expression) });
		Object.defineProperty(this, "reformat", { value: options.reformat });

		// call the base type constructor
		ValidatedPropertyRule.apply(this, [rootType, options]);
	}

	// setup the inheritance chain
	StringFormatRule.prototype = new ValidatedPropertyRule();
	StringFormatRule.prototype.constructor = StringFormatRule;

	// extend the base type
	StringFormatRule.mixin({

		// returns true if the property is valid, otherwise false
		isValid: function StringFormatRule$isValid(obj, prop, val) {
			var isValid = true;
			if (val && val != "") {
				this.expression.lastIndex = 0;
				isValid = this.expression.test(val);
				if (isValid && this.reformat) {
					if (this.reformat instanceof Function) {
						val = this.reformat(val);
					}
					else {
						this.expression.lastIndex = 0;
						val = val.replace(this.expression, this.reformat);
					}
					prop.value(obj, val);
				}
			}
			return isValid;
		},

		// get the string representation of the rule
		toString: function () {
			return $format("{0}.{1} formatted as {2}",
				[this.get_property.get_containingType().get_fullName(),
				this.get_property().get_name(),
				this.description]);
		}
	});

	// Expose the rule publicly
	Rule.stringFormat = StringFormatRule;
	ExoWeb.Model.StringFormatRule = StringFormatRule;

	// #endregion

	// #region ExoWeb.Model.ListLengthRule
	//////////////////////////////////////////////////

	function ListLengthRule(rootType, options) {
		/// <summary>Creates a rule that validates a list property contains a specific range of items.</summary>
		/// <param name="rootType" type="Type">The model type the rule is for.</param>
		/// <param name="options" type="Object">
		///		The options for the rule, including:
		///			property:			the property being validated (either a Property instance or string property name)
		///			min:				the minimum valid value of the property
		///			max:				the maximum valid value of the property
		///			minFn:				a function returning the minimum valid value of the property
		///			maxFn:				a function returning the maximum valid value of the property
		///			name:				the optional unique name of the type of validation rule
		///			conditionType:		the optional condition type to use, which will be automatically created if not specified
		///			category:			ConditionType.Error || ConditionType.Warning (defaults to ConditionType.Error)
		///			message:			the message to show the user when the validation fails
		///		    onChangeOf:			an array of property paths (strings, Property or PropertyChain instances) that drive when the rule should execute due to property changes
		/// </param>
		/// <returns type="ListLengthRule">The new list length rule.</returns>

		// ensure the rule name is specified
		options.name = options.name || "ListLength";

		// call the base type constructor
		RangeRule.apply(this, [rootType, options]);
	}

	// setup the inheritance chain
	ListLengthRule.prototype = new RangeRule();
	ListLengthRule.prototype.constructor = ListLengthRule;

	// extend the base type
	ListLengthRule.mixin({

		// returns true if the property is valid, otherwise false
		isValid: function ListLengthRule$isValid(obj, prop, val) {

			var range = this.range(obj);

			return val === null || val === undefined || ((!range.min || val.length >= range.min) && (!range.max || val.length <= range.max));
		},

		message: function ListLengthRule$message(obj) {

			var range = this.range(obj);

			// ensure the error message is specified
			var message =
				(range.min && range.max ? Resource.get("listlength-between").replace("{min}", this.property.format(range.min)).replace("{max}", this.property.format(range.max)) : 
						range.min ?
							Resource.get("listlength-at-least").replace("{min}", this.property.format(range.min)) : // at least ordinal
							Resource.get("listlength-at-most").replace("{max}", this.property.format(range.max))); // at most ordinal

			return message.replace('{property}', this.getPropertyLabel(obj));
		}
	});

	// Expose the rule publicly
	Rule.listLength = ListLengthRule;
	ExoWeb.Model.ListLengthRule = ListLengthRule;

	// #endregion

	// #region ExoWeb.Model.ConditionTypeSet
	//////////////////////////////////////////////////

	function ConditionTypeSet(name) {
		if (allConditionTypeSets[name]) {
			throw new Error("A set with the name \"" + name + "\" has already been created.");
		}

		Object.defineProperty(this, "name", { value: name });
		Object.defineProperty(this, "types", { value: [] });
		Object.defineProperty(this, "active", { value: false, writable: true });
		Object.defineProperty(this, "conditions", { value: [] });

		allConditionTypeSets[name] = this;
	}

	var allConditionTypeSets = ConditionTypeSet.allConditionTypeSets = {};

	ConditionTypeSet.all = function ConditionTypeSet$all() {
		/// <summary>
		/// Returns an array of all condition type sets that have been created.
		/// Note that the array is created each time the function is called.
		/// </summary>
		/// <returns type="Array" />

		var all = [];
		for (var name in allConditionTypeSets) {
			all.push(allConditionTypeSets[name]);
		}
		return all;
	};

	ConditionTypeSet.get = function ConditionTypeSet$get(name) {
		/// <summary>
		/// Returns the condition type set with the given name, if it exists.
		/// </summary>
		/// <param name="name" type="String" />
		/// <returns type="ConditionTypeSet" />

		return allConditionTypeSets[name];
	};

	ConditionTypeSet.prototype = {
		activate: function ConditionTypeSet$activate(value) {
			if (!this.active) {
				this.active = true;
				this._raiseEvent("activated");
			}
		},
		deactivate: function ConditionTypeSet$deactivate() {
			if (this.active) {
				this.active = false;
				this._raiseEvent("deactivated");
			}
		},
		addActivated: function ConditionTypeSet$addActivated(handler) {
			this._addEvent("activated", handler);
		},
		removeActivated: function ConditionTypeSet$removeActivated(handler) {
			this._removeEvent("activated", handler);
		},
		addDeactivated: function ConditionTypeSet$addDeactivated(handler) {
			this._addEvent("deactivated", handler);
		},
		removeDeactivated: function ConditionTypeSet$removeDeactivated(handler) {
			this._removeEvent("deactivated", handler);
		},

		addConditionsChanged: function ConditionTypeSet$addConditionsChanged(handler) {

			// subscribe to the event
			this._addEvent("conditionsChanged", handler);

			// Return the condition type to support method chaining
			return this;
		},

		removeConditionsChanged: function ConditionTypeSet$removeConditionsChanged(handler) {
			this._removeEvent("conditionsChanged", handler);
		}
	};

	ConditionTypeSet.mixin(ExoWeb.Functor.eventing);

	ExoWeb.Model.ConditionTypeSet = ConditionTypeSet;

	// #endregion

	// #region ExoWeb.Model.ConditionType
	//////////////////////////////////////////////////

	function ConditionType(code, category, message, sets, origin) {
		// So that sub types can use it's prototype.
		if (arguments.length === 0) {
			return;
		}

		if (allConditionTypes[code]) {
			throw new Error("A condition type with the code \"" + code + "\" has already been created.");
		}

		Object.defineProperty(this, "code", { value: code });
		Object.defineProperty(this, "category", { value: category });
		Object.defineProperty(this, "message", { value: message });
		Object.defineProperty(this, "sets", { value: sets || [] });
		Object.defineProperty(this, "rules", { value: [] });
		Object.defineProperty(this, "conditions", { value: [] });
		Object.defineProperty(this, "origin", { value: origin });

		if (sets && sets.length > 0) {
			Array.forEach(sets, function(s) {
				s.types.push(this);
			}, this);
		}

		allConditionTypes[code] = this;
	}

	var allConditionTypes = ConditionType.allConditionTypes = {};

	ConditionType.all = function ConditionType$all() {
		/// <summary>
		/// Returns an array of all condition types that have been created.
		/// Note that the array is created each time the function is called.
		/// </summary>
		/// <returns type="Array" />

		var all = [];
		for (var name in allConditionTypes) {
			all.push(allConditionTypes[name]);
		}
		return all;
	}

	ConditionType.get = function ConditionType$get(code) {
		/// <summary>
		/// Returns the condition type with the given code, if it exists.
		/// </summary>
		/// <param name="code" type="String" />
		/// <returns type="ConditionTypeSet" />

		return allConditionTypes[code];
	};

	ConditionType.prototype = {

		// adds or removes a condition from the model for the specified target if necessary
		when: function ConditionType$when(condition, target, properties, message) {

			// get the current condition if it exists
			var conditionTarget = target.meta.getCondition(this);

			// add the condition on the target if it does not exist yet
			if (condition) {

				// if the message is a function, invoke to get the actual message
				message = message instanceof Function ? message(target) : message;

				// create a new condition if one does not exist
				if (!conditionTarget) {
					return new Condition(this, message, target, properties, "client");
				}

				// replace the condition if the message has changed
				else if (message && message != conditionTarget.condition.message) {

					// destroy the existing condition
					conditionTarget.condition.destroy();

					// create a new condition with the updated message
					return new Condition(this, message, target, properties, "client");
				}

				// otherwise, just return the existing condition
				else {
					return conditionTarget.condition;
				}
			}

			// Destroy the condition if it exists on the target and is no longer valid
			if (conditionTarget != null)
				conditionTarget.condition.destroy();

			// Return null to indicate that no condition was created
			return null;
		},
		extend: function ConditionType$extend(data) {
			for (var prop in data) {
				if (prop !== "type" && prop !== "rule" && !this["get_" + prop]) {
					var fieldName = "_" + prop;
					this[fieldName] = data[prop];
					this["get" + fieldName] = function ConditionType$getter() {
						return this[fieldName];
					}
				}
			}
		},
	
		addConditionsChanged: function ConditionType$addConditionsChanged(handler) {

			// subscribe to the event
			this._addEvent("conditionsChanged", handler);

			// Return the condition type to support method chaining
			return this;
		},

		removeConditionsChanged: function ConditionType$removeConditionsChanged(handler) {
			this._removeEvent("conditionsChanged", handler);
		}
	}

	ConditionType.mixin(Functor.eventing);

	ExoWeb.Model.ConditionType = ConditionType;

	(function() {
		//////////////////////////////////////////////////////////////////////////////////////
		function Error(code, message, sets, origin) {
			ConditionType.call(this, code, "Error", message, sets, origin);
		}

		Error.prototype = new ConditionType();

		ExoWeb.Model.ConditionType.Error = Error;

		//////////////////////////////////////////////////////////////////////////////////////
		function Warning(code, message, sets, origin) {
			ConditionType.call(this, code, "Warning", message, sets, origin);
		}

		Warning.prototype = new ConditionType();

		ExoWeb.Model.ConditionType.Warning = Warning;

		//////////////////////////////////////////////////////////////////////////////////////
		function Permission(code, message, sets, permissionType, isAllowed, origin) {
			ConditionType.call(this, code, "Permission", message, sets, origin);
			Object.defineProperty(this, "permissionType", { value: permissionType });
			Object.defineProperty(this, "isAllowed", { value: isAllowed });
		}

		Permission.prototype = new ConditionType();

		ExoWeb.Model.ConditionType.Permission = Permission;
	})();

	// #endregion

	// #region ExoWeb.Model.ConditionTarget
	//////////////////////////////////////////////////

	function ConditionTarget(condition, target, properties) {
		/// <summary>Represents the association of a condition to a specific target entity.</summary>
		/// <param name="condition" type="Condition">The condition the target is for.</param>
		/// <param name="target" type="Entity">The target entity the condition is associated with.</param>
		/// <param name="properties" type="Array" elementType="Property">The set of properties on the target entity the condition is related to.</param>
		/// <returns type="ConditionTarget">The new condition target.</returns>

	    /// <field name="target" type="Entity">The target entity the condition is associated with.</field>
	    /// <field name="condition" type="Condition">The condition the target is for.</field>
	    /// <field name="properties" type="Array" elementType="Property">The set of properties on the target entity the condition is related to.</field>

	    Object.defineProperty(this, "target", { value: target });
		Object.defineProperty(this, "condition", { value: condition });
		Object.defineProperty(this, "properties", { value: properties });

		// attach the condition target to the target entity
		target.meta.setCondition(this);
	}

	// #endregion

	// #region ExoWeb.Model.Condition
	//////////////////////////////////////////////////

	function Condition(type, message, target, properties, origin) {
		/// <summary>Represents an instance of a condition of a specific type associated with one or more entities in a model.</summary>
	    /// <param name="type" type="ConditionType">The type of condition, which usually is an instance of a subclass like Error, Warning or Permission.</param>
	    /// <param name="message" type="String">The optional message to use for the condition, which will default to the condition type message if not specified.</param>
		/// <param name="target" type="Entity">The root target entity the condition is associated with.</param>
	    /// <param name="properties" type="Array" elementType="String">The set of property paths specifying which properties and entities the condition should be attached to.</param>
		/// <param name="origin" type="String">The original source of the condition, either "client" or "server".</param>
		/// <returns type="Condition">The new condition instance.</returns>

		/// <field name="type" type="ConditionType">The type of condition, which usually is an instance of a subclass like Error, Warning or Permission.</field>
		/// <field name="message" type="String">The optional message to use for the condition, which will default to the condition type message if not specified.</field>
		/// <field name="origin" type="String">The original source of the condition, either "client" or "server".</field>
		/// <field name="targets" type="Array" elementType="ConditionTarget">The set of condition targets that link the condition to specific entities and properties.</field>

		Object.defineProperty(this, "type", { value: type });
		Object.defineProperty(this, "message", { value: message || (type ? type.message : undefined) });
		Object.defineProperty(this, "origin", { value: origin });

		var targets = [];

		// create targets if a root was specified
		if (target) {

			// set the properties to an empty array if not specified and normalize the paths to expand {} syntax if used
			properties = PathTokens.normalizePaths(properties || []);

			// create a single condition target if the specified properties are all on the root
			if (properties.every(function (p) { return p.length === 1; }))
				targets.push(new ConditionTarget(this, target, properties));

			// otherwise, process the property paths to create the necessary sources
			else {
				// process each property path to build up the condition sources
				for (var p = properties.length - 1; p >= 0; p--) {
					var steps = properties[p].steps;
					var instances = [target];

					var leaf = steps.length - 1;

					// iterate over each step along the path
					for (var s = 0; s < steps.length; s++) {
						var step = steps[s].property;
						var childInstances = [];

						// create condition targets for all instances for the current step along the path
						for (var i = instances.length - 1; i >= 0; i--) {
							var instance = instances[i];

							// get the property for the current step and instance type and skip if the property cannot be found
							var property = instance.meta.type.property(step);
							if (!property) {
								continue;
							}

							// only create conditions on the last step, the leaf node
							if (s === leaf) {
								// see if a target already exists for the current instance
								var conditionTarget = null;
								for (var t = targets.length - 1; t >= 0; t--) {
									if (targets[t].target === instance) {
										conditionTarget = targets[t];
										break;
									}
								}

								// create the condition target if it does not already exist
								if (!conditionTarget) {
									conditionTarget = new ConditionTarget(this, instance, [property]);
									targets.push(conditionTarget);
								}

								// otherwise, just ensure it references the current step
								else if (conditionTarget.properties.indexOf(property) < 0)
									conditionTarget.properties.push(property);
							}

							// get the value of the current step
							var child = property.value(instance);

							// add the children, if any, to the set of child instances to process for the next step
							if (child instanceof Entity)
								childInstances.push(child);
							else if (child instanceof Array && child.length > 0 && child[0] instanceof Entity)
								childInstances = childInstances.concat(child);
						}

						// assign the set of instances to process for the next step
						instances = childInstances;
					}
				}
			}
		}

		// store the condition targets
		Object.defineProperty(this, "targets", { value: targets });

		// raise events for the new condition
		if (this.type != formatConditionType) {

			// raise events on condition targets
			for (var t = targets.length - 1; t >= 0; t--) {
				var conditionTarget = targets[t];

				// instance events
				conditionTarget.target.meta._raiseEvent("conditionsChanged", [conditionTarget.target.meta, { conditionTarget: conditionTarget, add: true, remove: false }]);

				// type events
				for (var type = conditionTarget.target.meta.type; type; type = type.baseType) {
					type._raiseEvent("conditionsChanged", [conditionTarget.target.meta, { conditionTarget: conditionTarget, add: true, remove: false }]);
				}
			}

			// raise events on condition types
			this.type.conditions.push(this);
			this.type._raiseEvent("conditionsChanged", [this.type, { condition: this, add: true, remove: false }]);

			// raise events on condition type sets
			if (this.type.sets) {
				for (var s = this.type.sets.length - 1; s >= 0; s--) {
					var set = this.type.sets[s];
					set.conditions.push(this);
					set._raiseEvent("conditionsChanged", [set, { condition: this, add: true, remove: false }]);
				}
			}
		}
	}

	// implementation
	Condition.mixin({
		destroy: function Condition$destroy() {
			/// <summary>Removes the condition targets from all target instances and raises condition change events.</summary>

			// raise events on condition type sets
			if (this.type.sets) {
				for (var s = this.type.sets.length - 1; s >= 0; s--) {
					var set = this.type.sets[s];
					set.conditions.remove(this);
					set._raiseEvent("conditionsChanged", [set, { condition: this, add: false, remove: true }]);
				}
			}

			// raise events on condition types
			this.type.conditions.remove(this);
			this.type._raiseEvent("conditionsChanged", [this.type, { condition: this, add: false, remove: true }]);

			for (var t = this.targets.length - 1; t >= 0; t--) {
				var conditionTarget = this.targets[t];
				conditionTarget.target.meta.clearCondition(conditionTarget.condition.type);

				// instance events
				conditionTarget.target.meta._raiseEvent("conditionsChanged", [conditionTarget.target.meta, { conditionTarget: conditionTarget, add: false, remove: true }]);

				// type events
				for (var type = conditionTarget.target.meta.type; type; type = type.baseType) {
					type._raiseEvent("conditionsChanged", [conditionTarget.target.meta, { conditionTarget: conditionTarget, add: false, remove: true }]);
				}
			}

			// remove references to all condition targets
			this.targets.slice(0, 0);
		},
		toString: function Condition$toString() {
			return this.message;
		}
	});

	// Expose the type publicly
	ExoWeb.Model.Condition = Condition;

	// #endregion

	// #region ExoWeb.Model.FormatError
	//////////////////////////////////////////////////

	function FormatError(message, invalidValue) {
		Object.defineProperty(this, "message", { value: message });
		Object.defineProperty(this, "invalidValue", { value: invalidValue });
	}

	var formatConditionType = new ConditionType.Error("FormatError", "The value is not properly formatted.", []);

	FormatError.mixin({
		createCondition: function FormatError$createCondition(target, prop) {
			return new Condition(formatConditionType,
				this.message.replace("{property}", prop.get_label()),
				target,
				[prop.get_name()],
				"client");
		},
		toString: function FormateError$toString() {
			return this._invalidValue;
		}
	});

	ExoWeb.Model.FormatError = FormatError;

	// #endregion

	// #region ExoWeb.Model.FormatProvider
	//////////////////////////////////////////////////

	var formatProvider = function formatProvider(type, format) {
		throw new Error("Format provider has not been implemented.  Call ExoWeb.Model.setFormatProvider(fn);");
	};

	function getFormat(type, format) {

		// return null if a format specifier was not provided
		if (!format || format === '')
			return null;

		// initialize format cache
		if (!type._formats)
			type._formats = {};

		// first see if the requested format is cached
		var f = type._formats[format];
		if (f)
			return f;

		// then see if it is an entity type
		if (type.meta && type.meta instanceof Type)
			type._formats[format] = f = Format.fromTemplate(type, format);

		// otherwise, call the format provider to create a new format
		else
			type._formats[format] = f = formatProvider(type, format);

		return f;
	}

	function setFormatProvider(fn) {
		formatProvider = fn;
	}

	ExoWeb.Model.getFormat = getFormat;

	// #endregion

	// #region ExoWeb.Model.LazyLoader
	//////////////////////////////////////////////////

	/*global isType, PathTokens, logWarning, parseFunctionName, getValue, Signal */

	function LazyLoader() {
	}

	LazyLoader.eval = function LazyLoader$eval(target, path, successCallback, errorCallback, scopeChain, thisPtr/*, continueFn, performedLoading, root, processed, invokeImmediatelyIfPossible*/) {
		var processed, root, performedLoading, continueFn, step, i, value, invokeImmediatelyIfPossible;

		if (path === undefined || path === null) {
			path = "";
		}

		if (isType(path, String)) {
			path = new PathTokens(path);
		}
		else if (isType(path, Array)) {
			logWarning("Calling LazyLoader.eval with a path Array is deprecated, please use a string path instead.");
			path = new PathTokens(path.join("."));
		}
		else if (!isType(path, PathTokens)) {
			throw new Error("Unknown path \"" + path + "\" of type " + parseFunctionName(path.constructor) + ".");
		}

		scopeChain = scopeChain || [window];

		// If additional arguments were specified (internal), then use those.
		if (arguments.length === 11) {
			// Allow an invocation to specify continuing loading properties using a given function, by default this is LazyLoader.eval.
			// This is used by evalAll to ensure that array properties can be force loaded at any point in the path.
			continueFn = arguments[6] instanceof Function ? arguments[6] : continueFn;
			// Allow recursive calling function (eval or evalAll) to specify that loading was performed.
			performedLoading = arguments[7] instanceof Boolean ? arguments[7] : false;
			// Allow recursive calling function (eval or evalAll) to specify the root object being used.
			root = arguments[8];
			// Allow recursive calling function (eval or evalAll) to specify the processed steps.
			processed = arguments[9];
			// Allow recursive calling function (eval or evalAll) to specify whether to invoke the callback immmediately if possible (when no loading is required).
			invokeImmediatelyIfPossible = arguments[10];
		}
		// Initialize to defaults.
		else {
			continueFn = LazyLoader.eval;
			performedLoading = false;
			root = target;
			processed = [];
			invokeImmediatelyIfPossible = null;
		}

		// If the target is null or undefined then attempt to backtrack using the scope chain
		if (target === undefined || target === null) {
			target = root = scopeChain.dequeue();
		}
	
		while (path.steps.length > 0) {
			// If null or undefined was passed in with no scope chain, fail
			if (target === undefined || target === null) {
				if (errorCallback) {
					errorCallback.apply(thisPtr || this, ["Target is null or undefined"]);
				}
				else {
					throw new Error("Cannot complete property evaluation because the target is null or undefined");
				}
			}

			// If an array is encountered and this call originated from "evalAll" then delegate to "evalAll", otherwise
			// this will most likely be an error condition unless the remainder of the path are properties of Array.
			if (continueFn !== LazyLoader.eval && target instanceof Array) {
				continueFn(target, path, successCallback, errorCallback, scopeChain, thisPtr, continueFn, performedLoading, root, processed, invokeImmediatelyIfPossible);
				return;
			}

			// Get the next step to evaluate
			step = path.steps.dequeue();

			// If the target is not loaded then load it and continue when complete
			if (LazyLoader.isRegistered(target, null, step.property)) {
				performedLoading = true;
				Array.insert(path.steps, 0, step);
				LazyLoader.load(target, step.property, false, function () {
					continueFn(target, path, successCallback, errorCallback, scopeChain, thisPtr, continueFn, performedLoading, root, processed, invokeImmediatelyIfPossible);
				});
				return;
			}

			// Get the value of the current step
			value = getValue(target, step.property);

			// If the value is undefined then there is a problem since getValue returns null if a property exists but returns no value.
			if (value === undefined) {
				// Attempt to backtrack using the next item in the scope chain.
				if (scopeChain.length > 0) {
					target = root = scopeChain.dequeue();
					Array.insert(path.steps, 0, step);
					for (i = processed.length - 1; i >= 0; i -= 1) {
						Array.insert(path.steps, 0, processed[i]);
					}
					processed.length = 0;
				}
				// Otherwise, fail since the path could not be evaluated
				else {
					if (errorCallback) {
						errorCallback.apply(thisPtr || this, ["Property is undefined: " + step.property]);
					}
					else {
						throw new Error("Cannot complete property evaluation because a property is undefined: " + step.property);
					}

					return;
				}
			}
			// The next target is null (nothing left to evaluate) or there is a cast of the current property and the value is
			// not of the cast type (no need to continue evaluating).
			else if (value === null || (step.cast && !isType(value, step.cast))) {
				if (successCallback) {
					successCallback.apply(thisPtr || this, [null, performedLoading, root]);
				}
				return;
			}
			// Otherwise, continue to the next property.
			else {
				processed.push(step);
				target = value;
			}
		}

		// Load final object
		if (target !== undefined && target !== null && LazyLoader.isRegistered(target)) {
			performedLoading = true;
			LazyLoader.load(target, null, false, successCallback ? successCallback.prepare(thisPtr || this, [target, performedLoading, root]) : undefined);
		}
		else if (successCallback) {
			successCallback.apply(thisPtr || this, [target, performedLoading, root]);
		}
	};

	LazyLoader.evalAll = function LazyLoader$evalAll(target, path, successCallback, errorCallback, scopeChain, thisPtr/*, continueFn, performedLoading, root, processed, invokeImmediatelyIfPossible*/) {
		var root, performedLoading, processed, invokeImmediatelyIfPossible, signal, results, errors, successCallbacks, errorCallbacks, allSucceeded;

		if (arguments.length === 11) {
			performedLoading = arguments[7] instanceof Boolean ? arguments[7] : false;
			root = arguments[8];
			processed = arguments[9];
			invokeImmediatelyIfPossible = arguments[10];
		}
		else {
			performedLoading = false;
			root = target;
			processed = [];
			invokeImmediatelyIfPossible = null;
		}

		// Ensure that the target is an array
		if (!(target instanceof Array)) {
			LazyLoader.eval(target, path, successCallback, errorCallback, scopeChain, thisPtr, LazyLoader.evalAll, performedLoading, root, processed, invokeImmediatelyIfPossible);
			return;
		}
			// Ensure that the array is loaded, then continue
		else if (LazyLoader.isRegistered(target)) {
			LazyLoader.load(target, null, false, function () {
				LazyLoader.evalAll(target, path, successCallback, errorCallback, scopeChain, thisPtr, LazyLoader.evalAll, performedLoading, root, processed, invokeImmediatelyIfPossible);
			});
			return;
		}

		signal = new Signal("evalAll - " + path);
		results = [];
		errors = [];
		successCallbacks = [];
		errorCallbacks = [];
		allSucceeded = true;

		target.forEach(function (subTarget, i) {
			results.push(null);
			errors.push(null);
			successCallbacks.push(signal.pending(function (result, performedLoadingOne, rootOne) {
				performedLoading = performedLoading || performedLoadingOne;
				results[i] = result;
				if (root !== rootOne) {
					logWarning("Found different roots when evaluating all paths.");
				}
				root = rootOne;
			}, null, invokeImmediatelyIfPossible));
			errorCallbacks.push(signal.orPending(function (err) {
				allSucceeded = false;
				errors[i] = err;
			}, null, invokeImmediatelyIfPossible));
		});

		target.forEach(function (subTarget, i) {
			// Make a copy of the original path tokens for arrays so that items' processing don't affect one another.
			if (path instanceof PathTokens) {
				path = path.buildExpression();
			}
			LazyLoader.eval(subTarget, path, successCallbacks[i], errorCallbacks[i], scopeChain, thisPtr, LazyLoader.evalAll, performedLoading, root, processed.slice(0), invokeImmediatelyIfPossible);
		});

		signal.waitForAll(function () {
			if (allSucceeded) {
				// call the success callback if one exists
				if (successCallback) {
					successCallback.apply(thisPtr || this, [results, performedLoading, root]);
				}
			}
			else if (errorCallback) {
				errorCallback.apply(thisPtr || this, [errors]);
			}
			else {
				errors.forEach(function (e) {
					throw new Error("Error encountered while attempting to eval paths for all items in the target array: " + e);
				});
			}
		}, null, invokeImmediatelyIfPossible);
	};

	LazyLoader.isRegistered = function LazyLoader$isRegistered(obj, targetLoader, targetProperty) {
		var reg, loader, propertyLoader, targetPropertyName;

		if (obj === null || obj === undefined) {
			return false;
		}

		reg = obj._lazyLoader;

		if (!reg) {
			return false;
		}

		if (targetProperty) {
			if (isString(targetProperty)) {
				targetPropertyName = targetProperty;
			} else if (targetProperty instanceof Property) {
				targetPropertyName = targetProperty.get_name();
			} else {
				throw new Error("Unexpected targetProperty argument value \"" + targetProperty + "\" in LazyLoader.isRegistered().");
			}
			// Attempt to retrieve a property-specific loader if it exists.
			if (reg.byProp && reg.byProp.hasOwnProperty(targetPropertyName)) {
				propertyLoader = reg.byProp[targetPropertyName];
				if (propertyLoader !== null && propertyLoader !== undefined) {
					return true;
				}
			}
		}

		loader = reg.allProps;
		if (loader !== null && loader !== undefined) {
			if (targetLoader) {
				return loader === targetLoader;
			}
			return true;
		}

		return false;
	};

	LazyLoader.isLoaded = function LazyLoader$isLoaded(obj /*, paths...*/) {
		var result, paths, singlePath, singleStep, nextStep, propName, filterType, property, value;

		if (obj === undefined) {
			result = undefined;
		} else if (obj === null) {
			result = null;
		} else {
			if (arguments.length === 1) {
				// No paths were specified...
				paths = null;
			} else {
				// Paths were specified in some form. They can be passed in as an array of 1 or
				// more arguments, or passed in seperately to be processed as "rest" arguments.
				if (arguments.length === 2) {
					if (isType(arguments[1], Array)) {
						// 1) isLoaded(obj, ["arg1", "arg2", ...]);
						paths = arguments[1];
					} else {
						// 2) isLoaded(obj, "arg");
						paths = [arguments[1]];
					}
				} else {
					// 3) isLoaded(obj, "arg1", "arg2", ...);
					paths = Array.prototype.slice.call(arguments, 1);
				}
			}

			if (!paths || paths.length === 0) {
				// No paths, so this is only an object-level check for the existence of a loader.
				result = !LazyLoader.isRegistered(obj);
			} else if (paths.length === 1) {
				// Only one path, so walk down the path until a non-loaded step is detected.
				singlePath = paths[0];

				// Remove unnecessary "this." prefix.
				if (isType(singlePath, String) && singlePath.startsWith("this.")) {
					singlePath = singlePath.substring(5);
				}

				// Attempt to optimize for a single property name or final path step.
				if (isType(singlePath, String) && singlePath.indexOf(".") < 0) {
					if (singlePath.length === 0) {
						throw new Error("Unexpected empty string passed to LazyLoader.isLoaded().");
					}
					propName = singlePath;
				} else if (isType(singlePath, PathTokens)) {
					if (singlePath.steps.length === 0) {
						throw new Error("Unexpected empty path tokens passed to LazyLoader.isLoaded().");
					} else if (singlePath.steps.length === 1) {
						singleStep = singlePath.steps.dequeue();
						propName = singleStep.property;
					}
				}

				if (propName) {
					// Optimize for a single property name or path step.
					if (LazyLoader.isRegistered(obj, null, propName)) {
						result = false;
					} else {
						// Get the value of the single property or final path step.
						if (obj.meta) {
							property = obj.meta.property(propName, true);
							value = property.value(obj);
						} else {
							value = getValue(obj, propName);
						}

						if (!value) {
							// There is no value, so there can be no lazy loader registered.
							return true;
						} else {
							// If the property value doesn't have a registered lazy loader, then it is considered loaded.
							return !LazyLoader.isRegistered(value);
						}
					}
				} else {
					if (isType(singlePath, String)) {
						if (singlePath.length === 0) {
							throw new Error("Unexpected empty string passed to LazyLoader.isLoaded().");
						}
						singlePath = new PathTokens(singlePath);
					} else if (!isType(singlePath, PathTokens)) {
						throw new Error("Unknown path \"" + singlePath + "\" of type " + parseFunctionName(singlePath.constructor) + ".");
					}

					// Get the value of the next step.
					nextStep = singlePath.steps.dequeue();
					if (obj.meta) {
						property = obj.meta.property(nextStep.property, true);
						value = property.value(obj);
					} else {
						value = getValue(obj, nextStep.property);
					}

					if (!value) {
						// There is no value, so there can be no lazy loader registered.
						return true;
					} else if (LazyLoader.isRegistered(value)) {
						// There is a lazy loader, so stop processing and return false.
						return false;
					} else {
						// There is no lazy loader, so continue processing the next step.
						if (nextStep.cast) {
							filterType = Model.getJsType(nextStep.cast, true);
						}
						if (nextStep.cast && !filterType) {
							// Stop processing since the filter type doesn't yet exist.
							result = true;
						} else if (isArray(value)) {
							// Make a copy of the original path tokens for arrays so that items' processing don't affect one another.
							if (singlePath instanceof PathTokens) {
								singlePath = singlePath.buildExpression();
							}
							result = !value.some(function (item) {
								return (!filterType || item instanceof filterType) && !LazyLoader.isLoaded(item, singlePath);
							});
						} else if (filterType && !(value instanceof filterType)) {
							// Stop processing since the value doesn't pass the filter.
							result = true;
						} else {
							result = LazyLoader.isLoaded(value, singlePath);
						}
					}
				}
			} else {
				// Multiple paths, so check each one individually.
				result = !paths.some(function (path) {
					// Use some and the inverse of the result in order to exit
					// immediately as soon as a non-loaded step is found.
					return !LazyLoader.isLoaded(obj, path);
				});
			}
		}

		return result;
	};

	LazyLoader.load = function LazyLoader$load(obj, propName, inScope, callback, thisPtr) {
		var reg = obj._lazyLoader;
		if (!reg) {
			if (callback && callback instanceof Function) {
				callback.call(thisPtr || this);
			}
		}
		else {
			var loader;
			if (propName && reg.byProp) {
				loader = reg.byProp[propName];
			}

			if (!loader) {
				loader = reg.allProps;
			}

			if (!loader) {
				throw new Error($format("Attempting to load object but no appropriate loader is registered. object: {0}, property: {1}", obj, propName));
			}

			loader.load(obj, propName, inScope, callback, thisPtr);
		}
	};

	LazyLoader.register = function LazyLoader$register(obj, loader, propName) {
		var reg = obj._lazyLoader;

		if (!reg) {
			reg = obj._lazyLoader = {};
		}

		if (propName) {
			if (!reg.byProp) {
				reg.byProp = {};
			}

			reg.byProp[propName] = loader;
		}
		else {
			obj._lazyLoader.allProps = loader;
		}
	};

	LazyLoader.unregister = function LazyLoader$unregister(obj, loader, propName) {
		var reg = obj._lazyLoader;

		if (!reg) {
			return;
		}

		if (propName) {
			delete reg.byProp[propName];
		} else if (reg.byProp) {
			var allDeleted = true;
			for (var p in reg.byProp) {
				if (reg.byProp[p] === loader) {
					delete reg.byProp[p];
				}
				else {
					allDeleted = false;
				}
			}

			if (allDeleted) {
				delete reg.byProp;
			}
		}

		if (reg.allProps === loader) {
			delete reg.allProps;
		}

		if (!reg.byProp && !reg.allProps) {
			delete obj._lazyLoader;
		}
	};

	// #endregion

	// #region ExoWeb.Model.Utilities
	//////////////////////////////////////////////////

	var coreGetValue = getValue;

	// If a getter method matching the given property name is found on the target it is invoked and returns the 
	// value, unless the the value is undefined, in which case null is returned instead.  This is done so that 
	// calling code can interpret a return value of undefined to mean that the property it requested does not exist.
	// TODO: better name
	getValue = function getValueOverride(target, property) {

		// first see if the property is a model property
		if (target instanceof ExoWeb.Model.Entity || (target.meta && target.meta instanceof ExoWeb.Model.Type)) {
			var prop = target.meta.type.property(property);
			if (prop) {
				var value = prop.value(target);
				if (value === undefined) {
					value = null;
				}
				return value;
			}
		}

		return coreGetValue(target, property);
	}

	ExoWeb.getValue = getValue;

	// #endregion

	// #region ExoWeb.Mapper.ObjectProvider
	//////////////////////////////////////////////////

	/*global exports, context, Batch */

	var objectProviderFn = function objectProviderFn() {
		throw new Error("Object provider has not been implemented. Call ExoWeb.Mapper.setObjectProvider(fn);");
	};

	function objectProvider(type, ids, paths, inScope, changes, onSuccess, onFailure, thisPtr) {
		var scopeQueries, batch;

		// ensure correct value of "scopeQueries" argument
		if (onSuccess !== undefined && onSuccess !== null && !(onSuccess instanceof Function)) {
			// scopeQueries is included in call, so shift arguments
			scopeQueries = onSuccess;
			onSuccess = onFailure;
			onFailure = thisPtr;
			thisPtr = arguments.length > 8 ? arguments[8] : null;
		}
		else {
			// scopeQueries is NOT included in call, so insert default value into args array
			scopeQueries = context.server._scopeQueries; //ignore jslint
		}

		if (onFailure !== undefined && onFailure !== null && !(onFailure instanceof Function)) {
			thisPtr = onFailure;
			onFailure = null;
		}

		batch = Batch.suspendCurrent("objectProvider");

		objectProviderFn(type, ids, paths, inScope, changes, scopeQueries,
			function () {
				Batch.resume(batch);
				if (onSuccess) {
					onSuccess.apply(thisPtr || null, arguments);
				}
			},
			function () {
				Batch.resume(batch);
				if (onFailure) {
					onFailure.apply(thisPtr || null, arguments);
				}
			});
	}

	ExoWeb.Mapper.setObjectProvider = function setObjectProvider(fn) {
		objectProviderFn = fn;
	};

	// #endregion

	// #region ExoWeb.Mapper.QueryProvider
	//////////////////////////////////////////////////

	/*global exports, context, Batch */

	var queryProviderFn = function queryProviderFn() {
		throw new Error("Query provider has not been implemented. Call ExoWeb.Mapper.setQueryProvider(fn);");
	};

	function queryProvider(queries, changes, onSuccess, onFailure, thisPtr) {
		var scopeQueries, batch;

		// ensure correct value of "scopeQueries" argument
		if (onSuccess !== undefined && onSuccess !== null && !(onSuccess instanceof Function)) {
			// scopeQueries is included in call, so shift arguments
			scopeQueries = onSuccess;
			onSuccess = onFailure;
			onFailure = thisPtr;
			thisPtr = arguments.length > 5 ? arguments[5] : null;
		}
		else {
			// scopeQueries is NOT included in call, so insert default value into args array
			scopeQueries = context.server._scopeQueries; //ignore jslint
		}

		if (onFailure !== undefined && onFailure !== null && !(onFailure instanceof Function)) {
			thisPtr = onFailure;
			onFailure = null;
		}

		batch = Batch.suspendCurrent("queryProvider");

		queryProviderFn(queries, changes, scopeQueries,
			function () {
				Batch.resume(batch);
				if (onSuccess) {
					onSuccess.apply(thisPtr || this, arguments);
				}
			},
			function () {
				Batch.resume(batch);
				if (onFailure) {
					onFailure.apply(thisPtr || this, arguments);
				}
			});
	}

	ExoWeb.Mapper.setQueryProvider = function setQueryProvider(fn) {
		queryProviderFn = fn;
	};

	// #endregion

	// #region ExoWeb.Mapper.TypeProvider
	//////////////////////////////////////////////////

	/*global exports, Batch, copy, purge, eachProp */

	var typeProviderFn = function typeProviderFn() {
		throw new Error("Type provider has not been implemented. Call ExoWeb.Mapper.setTypeProvider(fn);");
	};

	function typeProviderImpl(types, callback, thisPtr) {
		var batch = Batch.suspendCurrent("typeProvider"),
			typesToLoad = copy(types),
			cachedTypes = [],
			typesJson = {};

		purge(typesToLoad, function (type) {
			var cachedType = window.ExoWeb.cache(type);

			if (!cachedType) {
				return false;
			}
			else if (window.ExoWeb.cacheHash && cachedType.cacheHash !== window.ExoWeb.cacheHash) {
				// the cached type definition is out of date, so remove it and continue
				window.ExoWeb.cache(type, null);
				return false;
			}

			cachedTypes.push(type);
			return true;
		});

		// If some (or all) of the types are currently cached, go ahead and call the success function.
		if (cachedTypes.length > 0) {
			cachedTypes.forEach(function (type) {
				typesJson[type] = window.ExoWeb.cache(type).types[type];
			});
		}

		if (typesToLoad.length > 0) {
			typeProviderFn(typesToLoad,
				function (result) {
					Batch.resume(batch);

					var resultsJson = result.types;

					// Add the resulting json and cache each type.
					eachProp(resultsJson, function (type) {

						// construct a json object, with the cachehash, for cacheing
						var json = { cacheHash: window.ExoWeb.cacheHash, types: {} };

						// extract the type definition
						json.types[type] = typesJson[type] = resultsJson[type];

						// cache the type
						window.ExoWeb.cache(type, json);

					});

					callback.call(thisPtr || null, true, typesJson);
				},
				function () {
					Batch.resume(batch);

					var args = copy(arguments);
					args.splice(0, 0, false);
					callback.apply(thisPtr || null, args);
				});
		}
		else {
			Batch.resume(batch);
			callback.call(thisPtr || null, true, typesJson);
		}
	}

	function deleteTypeJson(originalArgs, invocationArgs, callbackArgs) {
		// If type request was handled by another caller, then assume that typesFromJson will be called
		if (callbackArgs[0]) {
			callbackArgs.splice(1, 1, {}, callbackArgs[1]);
		}
	}

	var typeProvider = typeProviderImpl.dontDoubleUp({ callbackArg: 1, partitionedArg: 0, partitionedFilter: deleteTypeJson, memoize: true });

	ExoWeb.Mapper.setTypeProvider = function setTypeProvider(fn) {
		typeProviderFn = fn;
	};

	// #endregion

	// #region ExoWeb.Mapper.ListProvider
	//////////////////////////////////////////////////

	/*global exports, context, Batch */

	var listProviderFn = function listProvider() {
		throw new Error("List provider has not been implemented. Call ExoWeb.Mapper.setListProvider(fn);");
	};

	function listProvider(ownerType, owner, listProp, paths, changes, onSuccess, onFailure, thisPtr) {
		var scopeQueries, batch, listPath, pathsToLoad, ownerId;

		// ensure correct value of "scopeQueries" argument
		if (onSuccess !== undefined && onSuccess !== null && !(onSuccess instanceof Function)) {
			// scopeQueries is included in call, so shift arguments
			scopeQueries = onSuccess;
			onSuccess = onFailure;
			onFailure = thisPtr;
			thisPtr = arguments.length > 7 ? arguments[7] : null;
		}
		else {
			// scopeQueries is NOT included in call, so insert default value into args array
			scopeQueries = context.server._scopeQueries; //ignore jslint
		}

		if (onFailure !== undefined && onFailure !== null && !(onFailure instanceof Function)) {
			thisPtr = onFailure;
			onFailure = null;
		}

		batch = Batch.suspendCurrent("listProvider");

		ownerId = owner === "static" ? null : owner;
		listPath = owner === "static" ? ownerType + "." + listProp : listProp;
		pathsToLoad = [listPath];

		// prepend list prop to beginning of each other prop
		if (paths && paths.length > 0) {
			Array.forEach(paths, function (p) {
				pathsToLoad.push(listPath + "." + p);
			});
		}

		listProviderFn(ownerType, ownerId, pathsToLoad, changes, scopeQueries,
			function () {
				Batch.resume(batch);
				if (onSuccess) {
					onSuccess.apply(thisPtr || null, arguments);
				}
			},
			function () {
				Batch.resume(batch);
				if (onFailure) {
					onFailure.apply(thisPtr || null, arguments);
				}
			});
	}

	ExoWeb.Mapper.setListProvider = function setListProvider(fn) {
		listProviderFn = fn;
	};

	// #endregion

	// #region ExoWeb.Mapper.RoundtripProvider
	//////////////////////////////////////////////////

	/*global exports, context, Batch */

	var roundtripProviderFn = function roundtripProviderFn() {
		throw new Error("Roundtrip provider has not been implemented. Call ExoWeb.Mapper.setRoundtripProvider(fn);");
	};

	function roundtripProvider(root, paths, changes, onSuccess, onFailure, thisPtr) {
		var scopeQueries, batch;
	
		// ensure correct value of "scopeQueries" argument
		if (onSuccess !== undefined && onSuccess !== null && !(onSuccess instanceof Function)) {
			// scopeQueries is included in call, so shift arguments
			scopeQueries = onSuccess;
			onSuccess = onFailure;
			onFailure = thisPtr;
			thisPtr = arguments.length > 4 ? arguments[4] : null;
		}
		else {
			// scopeQueries is NOT included in call, so insert default value into args array
			scopeQueries = context.server._scopeQueries; //ignore jslint
		}

		if (onFailure !== undefined && onFailure !== null && !(onFailure instanceof Function)) {
			thisPtr = onFailure;
			onFailure = null;
		}

		batch = Batch.suspendCurrent("roundtripProvider");

		roundtripProviderFn(root, paths, changes, scopeQueries,
			function () {
				Batch.resume(batch);
				if (onSuccess) {
					onSuccess.apply(thisPtr || this, arguments);
				}
			},
			function () {
				Batch.resume(batch);
				if (onFailure) {
					onFailure.apply(thisPtr || this, arguments);
				}
			});
	}

	ExoWeb.Mapper.setRoundtripProvider = function setRoundtripProvider(fn) {
		roundtripProviderFn = fn;
	};

	// #endregion

	// #region ExoWeb.Mapper.SaveProvider
	//////////////////////////////////////////////////

	/*global exports, context, Batch */

	var saveProviderFn = function saveProviderFn() {
		throw new Error("Save provider has not been implemented. Call ExoWeb.Mapper.setSaveProvider(fn);");
	};

	function saveProvider(root, changes, onSuccess, onFailure, thisPtr) {
		var scopeQueries, batch;

		// ensure correct value of "scopeQueries" argument
		if (onSuccess !== undefined && onSuccess !== null && !(onSuccess instanceof Function)) {
			// scopeQueries is included in call, so shift arguments
			scopeQueries = onSuccess;
			onSuccess = onFailure;
			onFailure = thisPtr;
			thisPtr = arguments.length > 5 ? arguments[5] : null;
		}
		else {
			// scopeQueries is NOT included in call, so insert default value into args array
			scopeQueries = context.server._scopeQueries; //ignore jslint
		}

		if (onFailure !== undefined && onFailure !== null && !(onFailure instanceof Function)) {
			thisPtr = onFailure;
			onFailure = null;
		}

		batch = Batch.suspendCurrent("saveProvider");
		saveProviderFn(root, changes, scopeQueries,
			function () {
				Batch.resume(batch);
				if (onSuccess) {
					onSuccess.apply(thisPtr || this, arguments);
				}
			},
			function () {
				Batch.resume(batch);
				if (onFailure) {
					onFailure.apply(thisPtr || this, arguments);
				}
			});
	}

	ExoWeb.Mapper.setSaveProvider = function setSaveProvider(fn) {
		saveProviderFn = fn;
	};

	// #endregion

	// #region ExoWeb.Mapper.EventProvider
	//////////////////////////////////////////////////

	/*global exports, context, Batch */

	var eventProviderFn = function eventProviderFn() {
		throw new Error("Event provider has not been implemented. Call ExoWeb.Mapper.setEventProvider(fn);");
	};

	function eventProvider(eventType, eventInstance, event, paths, changes, onSuccess, onFailure, thisPtr) {
		var scopeQueries, batch;

		// ensure correct value of "scopeQueries" argument
		if (onSuccess !== undefined && onSuccess !== null && !(onSuccess instanceof Function)) {
			// scopeQueries is included in call, so shift arguments
			scopeQueries = onSuccess;
			onSuccess = onFailure;
			onFailure = thisPtr;
			thisPtr = arguments.length > 8 ? arguments[8] : null;
		}
		else {
			// scopeQueries is NOT included in call, so insert default value into args array
			scopeQueries = context.server._scopeQueries; //ignore jslint
		}

		if (onFailure !== undefined && onFailure !== null && !(onFailure instanceof Function)) {
			thisPtr = onFailure;
			onFailure = null;
		}

		batch = Batch.suspendCurrent("eventProvider");
		eventProviderFn(eventType, eventInstance, event, paths, changes, scopeQueries,
			function () {
				Batch.resume(batch);
				if (onSuccess) {
					onSuccess.apply(thisPtr || null, arguments);
				}
			},
			function () {
				Batch.resume(batch);
				if (onFailure) {
					onFailure.apply(thisPtr || null, arguments);
				}
			});
	}

	ExoWeb.Mapper.setEventProvider = function setEventProvider(fn) {
		eventProviderFn = fn;
	};

	// #endregion

	// #region ExoWeb.Mapper.ResponseHandler
	//////////////////////////////////////////////////

	function ResponseHandler(model, serverSync, options) {
		if (options === undefined || options === null) {
			throw new Error("Options cannot be null or undefined.");
		}

		this._model = model;
		this._serverSync = serverSync;
		this._options = options;
	}

	ResponseHandler.mixin({
		execute: ExoWeb.FunctionChain.prepare(
			function ResponseHandler$startResponseBatch(callback, thisPtr) {
				/// <summary>
				/// Start a new response batch.
				/// </summary>

				this._batch = Batch.start("ResponseHandler");
				callback.call(thisPtr || this);
			},
			function ResponseHandler$setServerInfo(callback, thisPtr) {
				/// <summary>
				/// Set server info from JSON
				/// </summary>

				if (this._options.serverInfo) {
					this._serverSync.set_ServerInfo(this._options.serverInfo);
				}

				callback.call(thisPtr || this);
			},

			function ResponseHandler$loadTypes(callback, thisPtr) {
				/// <summary>
				/// Load types from JSON
				/// </summary>
				if (this._options.types) {
					for (var typeName in this._options.types) {
						var mtype = this._model.type(typeName);

						// If this type has not already been loaded, laod from JSON
						if (!mtype || LazyLoader.isRegistered(mtype)) {
							var typesToUse = {};
							typesToUse[typeName] = this._options.types[typeName];
							typesFromJson(this._model, typesToUse);

							mtype = this._model.type(typeName);

							// Remove lazy-loader
							TypeLazyLoader.unregister(mtype);

							// Raise $extends handlers for the type
							raiseExtensions(mtype);
						}
					}
				}

				callback.call(thisPtr || this);
			},

			function ResponseHandler$startQueueingEvents(callback, thisPtr) {
				/// <summary>
				/// Start queueing model events
				/// </summary>

				this._eventScope = new EventScope();
				callback.call(thisPtr || this);
			},

			function ResponseHandler$applyChanges(callback, thisPtr) {
				/// <summary>
				/// Apply changes from JSON
				/// </summary>

				if (this._options.changes) {
					if (this._options.changes) {
						this._serverSync.applyChanges(this._options.checkpoint, this._options.changes, this._options.source, null, this._options.checkpoint, this._options.description ? this._options.description + ":response" : null, null, this._options.beforeApply, this._options.afterApply, callback, thisPtr);
					}
					else {
						if (this._options.source) {
							// no changes, so record empty set
							this._serverSync._changeLog.addSet(this._options.source, this._options.description + ":response");
							this._serverSync._changeLog.start({ user: this._serverSync.get_localUser() });
						}
						callback.call(thisPtr || this);
					}
				}
				else {
					callback.call(thisPtr || this);
				}
			},

			function ResponseHandler$loadInstances(callback, thisPtr) {
				/// <summary>
				/// Load instance data from JSON
				/// </summary>

				if (this._options.instances) {
					objectsFromJson(this._model, this._options.instances, function (instancesPendingInit) {
						this.instancesPendingInit = instancesPendingInit;
						callback.apply(thisPtr || this, arguments);
					}, this);
				}
				else {
					callback.call(thisPtr || this);
				}
			},

			function ResponseHandler$registerRules(callback, thisPtr) {
				/// <summary>
				/// Register all rules pending registration with the model
				/// </summary>

				this._model.registerRules();
				callback.call(thisPtr || this);
			},

			function ResponseHandler$stopQueueingEvents(callback, thisPtr) {
				/// <summary>
				/// Stop queueing model events
				/// </summary>

				this._serverSync.batchChanges(this._options.description + ":result", function () {
					this._eventScope.exit();
				}, this);

				callback.call(thisPtr || this);
			},

			function ResponseHandler$initInstances(callback, thisPtr) {
				/// <summary>
				/// Initialize all instances loaded by the response
				/// </summary>

				// Raise init events for existing instances loaded by the response
				if (this.instancesPendingInit) {
					var instances = this.instancesPendingInit;
					context.server._changeLog.batchChanges(this._options.description ? this._options.description + ":initExisting" : "responseHandlerInitExisting", context.server._localUser, function () {
						instances.forEach(function (obj) {
							for (var t = obj.meta.type; t; t = t.baseType) {
								var handler = t._getEventHandler("initExisting");
								if (handler)
									handler(obj, {});
							}
						});
					}, true);
				}

				callback.call(thisPtr || this);
			},

			function ResponseHandler$loadConditions(callback, thisPtr) {
				/// <summary>
				/// Load conditions from JSON
				/// </summary>

				if (this._options.conditions) {
					conditionsFromJson(this._model, this._options.conditions, this.instancesPendingInit, callback, thisPtr);
				}
				else {
					callback.call(thisPtr || this);
				}
			},

			function ResponseHandler$endResponseBatch(callback, thisPtr) {
				/// <summary>
				/// End the response batch.
				/// </summary>

				Batch.end(this._batch);
				callback.call(thisPtr || this);
			}
		)
	});

	ResponseHandler.execute = function (model, serverSync, options, callback, thisPtr) {
		(new ResponseHandler(model, serverSync, options)).execute(callback, thisPtr);
	};

	ExoWeb.Mapper.ResponseHandler = ResponseHandler;

	// #endregion

	// #region ExoWeb.Mapper.Translation
	//////////////////////////////////////////////////

	// Gets or loads the entity with the specified typed string id
	Entity.fromIdString = function Entity$fromIdString(idString) {
		// Typed identifiers take the form "type|id".
	    var type = idString.substring(0, idString.indexOf("|"));
	    var id = idString.substring(type.length + 1);

		// Use the left-hand portion of the id string as the object's type.
		var jstype = ExoWeb.Model.Model.getJsType(type);

		// Attempt to retrieve the object with the given id.
		var obj = jstype.meta.get(
			// Use the right-hand portion of the id string as the object's id.
			id,

			// Typed identifiers may or may not be the exact type of the instance.
			// An id string may be constructed with only knowledge of the base type.
			false
		);

		// If the object does not exist, assume it is an existing object that is not
		// yet in memory client-side, so create a ghosted instance.
		if (!obj) {
			obj = new jstype(id);
			if (jstype.meta.get_origin() === "server") {
				ObjectLazyLoader.register(obj);
			}
		}

		return obj;
	};

	function toExoModel(val, translator) {
		if (val === undefined || val === null)
			return;

		// entities only: translate forward to the server's id
		if (val instanceof ExoWeb.Model.Entity) {
			var result = {
				id: val.meta.id,
				type: val.meta.type.get_fullName()
			};

			if (val.meta.isNew) {
				result.isNew = true;
			}

			result.id = translator.forward(result.type, result.id) || result.id;
			return result;
		}

		return val;
	}

	function translateId(translator, type, id) {
		// get the server id, either translated or as the serialized entity id itself
		var serverId = translator.forward(type, id) || id;
		// get the client id, either a reverse translation of the server id or the server id itself
		var clientId = translator.reverse(type, serverId) || serverId;

		return clientId;
	}

	function fromExoModel(val, translator, create, supplementalObjectsArray) {
		if (val !== undefined && val !== null && val.type && val.id ) {
			var type = ExoWeb.Model.Model.getJsType(val.type);

			// Entities only: translate back to the client's id.  This is necessary to handle the fact that ids are created on 
			// both the client and server.  Also, in some cases a transaction references an entity that was created on the server 
			// and then committed, so that the id actually references an object that already exists on the client but with a different id.
			//--------------------------------------------------------------------------------------------------------
			if (type.meta && type.meta instanceof ExoWeb.Model.Type && translator) {
				// NOTE: don't alter the original object
				var id = translateId(translator, val.type, val.id);

				var obj = type.meta.get(id,
					// Since "fromExoModel" operates on the ExoModel change object format,
					// it can be assumed that the instance type is exact.
					true
				);

				// If the object was not found and a supplemental list was provided, then search for it
				if (!obj && supplementalObjectsArray && supplementalObjectsArray.length > 0) {
					var matches = supplementalObjectsArray.filter(function(o) {
						return o instanceof type && o.meta.id === id;
					});
					if (matches.length > 1) {
						throw new Error("Expected a single item, but found " + matches.length + ".");
					}
					obj = matches[0];
				}

				if (!obj && create) {
					obj = new type(id);
					if (type.meta.get_origin() === "server") {
						ObjectLazyLoader.register(obj);
					}
				}

				return obj;
			}

			// is this needed? Can the if statement that checks type.meta be removed?
			return val;
		}

		return val;
	}

	// #endregion

	// #region ExoWeb.Mapper.ExoModelEventListener
	//////////////////////////////////////////////////

	function ExoModelEventListener(model, translator, filters) {
		this._model = model;
		this._translator = translator;
		this._filters = filters;

		// listen for events
		model.addListChanged(this.onListChanged.bind(this));
		model.addAfterPropertySet(this.onPropertyChanged.bind(this));
		model.addObjectRegistered(this.onObjectRegistered.bind(this));
		model.addObjectUnregistered(this.onObjectUnregistered.bind(this));
	}

	ExoModelEventListener.mixin(ExoWeb.Functor.eventing);

	ExoModelEventListener.mixin({
		addChangeDetected: function ExoModelEventListener$onEvent(handler) {
			this._addEvent("changeDetected", handler);
		},

		// Model event handlers
		onListChanged: function ExoModelEventListener$onListChanged(obj, property, listChanges) {
			if (this._filters && this._filters.listChanged && this._filters.listChanged(obj, property, listChanges) !== true)
				return;

			// Recording static property changes is not supported by the JSON format or the server-side implementation.
			if (property.get_isStatic()) {
				return;
			}

			for (var i = 0; i < listChanges.length; ++i) {
				var listChange = listChanges[i];

				var change = {
					type: "ListChange",
					instance: toExoModel(obj, this._translator),
					property: property.get_name(),
					added: [],
					removed: []
				};

				var _this = this;
				if (listChange.newStartingIndex >= 0 || listChange.newItems) {
					Array.forEach(listChange.newItems, function ExoModelEventListener$onListChanged$addedItem(obj) {
						change.added.push(toExoModel(obj, _this._translator));
					});
				}
				if (listChange.oldStartingIndex >= 0 || listChange.oldItems) {
					Array.forEach(listChange.oldItems, function ExoModelEventListener$onListChanged$removedItem(obj) {
						change.removed.push(toExoModel(obj, _this._translator));
					});
				}

				this._raiseEvent("changeDetected", [change]);
			}
		},
		onObjectRegistered: function ExoModelEventListener$onObjectRegistered(obj) {
			if (this._filters && this._filters.objectRegistered && this._filters.objectRegistered(obj) !== true)
				return;

			if (obj.meta.isNew) {
				var change = {
					type: "InitNew",
					instance: toExoModel(obj, this._translator)
				};

				this._raiseEvent("changeDetected", [change]);
			}
		},
		onObjectUnregistered: function ExoModelEventListener$onObjectUnregistered(obj) {
			if (this._filters && this._filters.objectUnregistered && this._filters.objectUnregistered(obj) !== true)
				return;

			//if (obj.meta.type.get_origin() === "server") {
			//	throw new Error($format("Unregistering server-type objects is not currently supported: {0}|{1}", obj.meta.type.fullName, obj.meta.id));
			//}
		},
		onPropertyChanged: function ExoModelEventListener$onPropertyChanged(obj, property, newValue, oldValue) {
			if (this._filters && this._filters.propertyChanged && this._filters.propertyChanged(obj, property, newValue, oldValue) !== true)
				return;

			// Recording static property changes is not supported by the JSON format or the server-side implementation.
			if (property.get_isStatic()) {
				return;
			}

			if (property.get_isValueType()) {
				var valueChange = {
					type: "ValueChange",
					instance: toExoModel(obj, this._translator),
					property: property.get_name(),
					oldValue: oldValue,
					newValue: newValue
				};

				this._raiseEvent("changeDetected", [valueChange]);
			}
			else {
				var refChange = {
					type: "ReferenceChange",
					instance: toExoModel(obj, this._translator),
					property: property.get_name(),
					oldValue: toExoModel(oldValue, this._translator),
					newValue: toExoModel(newValue, this._translator)
				};

				this._raiseEvent("changeDetected", [refChange]);
			}
		}
	});

	ExoWeb.Mapper.ExoModelEventListener = ExoModelEventListener;

	// #endregion

	// #region ExoWeb.Mapper.ChangeSet
	//////////////////////////////////////////////////

	/*globals exports, Functor, ArgumentError, ArgumentNullError, ArgumentTypeError, randomText */

	function ChangeSet(source, title, user, initialChanges, code) {
		if (source === null || source === undefined) {
			throw new ArgumentNullError("source");
		}
		if (source.constructor !== String) {
			throw new ArgumentTypeError("source", "string", source);
		}
		if (source !== "init" && source !== "server" && source !== "client") {
			throw new ArgumentError("source", source + " must be in the set ['init', 'server', 'client']");
		}
		if (user !== null && user !== undefined && user.constructor !== String) {
			throw new ArgumentTypeError("user", "string", user);
		}

		this.code = code || randomText(8);
		this.source = source;
		this.title = title || null;
		this.user = user || null;
		this.changes = (initialChanges && initialChanges instanceof Array) ? [].concat(initialChanges) : [];
		this.onChangeAdded = new Functor();
		this.onChangeUndone = new Functor();
		this.onTruncated = new Functor();
	}

	ChangeSet.mixin({
		add: function (change) {
			var idx = this.changes.push(change) - 1;
			this.onChangeAdded(change, idx, this);
			return idx;
		},
		checkpoint: function (title, code) {
			// Generate a random code for the checkpoint if one is not given.
			if (!code) {
				code = randomText(10);
			}

			// Add the checkpoint and return the code.
			this.add({ type: "Checkpoint", title: title || "untitled", code: code });
			return code;
		},
		count: function (filter, thisPtr) {
			if (!filter) {
				return this.changes.length;
			}

			return this.changes.filter(filter, thisPtr).length;
		},
		lastChange: function () {
			return this.changes.length > 0 ? this.changes[this.changes.length - 1] : null;
		},
		serialize: function (forServer, filter, thisPtr) {
			if (arguments.length === 0) {
				forServer = true;
			} else if (forServer instanceof Function) {
				thisPtr = filter;
				filter = forServer;
				forServer = true;
			}

			var result = {
				source: this.source,
				changes: filter ? this.changes.filter(filter, thisPtr) : Array.prototype.slice.call(this.changes)
			};

			if (!forServer) {
				result.title = this.title;
				result.code = this.code;
				if (this.user) {
					result.user = this.user;
				}
			}

			return result;
		},
		truncate: function (checkpoint, filter, thisPtr) {
			// Allow calling as function(filter, thisPtr)
			if (checkpoint && Object.prototype.toString.call(checkpoint) === "[object Function]") {
				thisPtr = filter;
				filter = checkpoint;
				checkpoint = null;
			}

			// Wrap custom filter if a checkpoint is given.
			if (checkpoint) {
				var foundCheckpoint = false;
				var customFilter = filter;
				filter = function(change) {
					// Check to see if this is the checkpoint we're looking for.
					if (change.type === "Checkpoint" && change.code === checkpoint) {
						foundCheckpoint = true;
					}

					// Stop truncating when the checkpoint is found.
					if (foundCheckpoint === true) {
						return false;
					}

					// Delegate to custom filter if one is given.
					return customFilter ? customFilter.apply(this, arguments) : true;
				};
			}

			// Discard all changes that match the given filter
			var numRemoved;
			if (filter) {
				var removedAt = this.changes.purge(filter, thisPtr);
				numRemoved = removedAt ? removedAt.length : 0;
			} else {
				numRemoved = this.changes.length;
				this.changes.clear();
			}

			this.onTruncated(numRemoved, this);
			return numRemoved;
		},
		undo: function() {
			if (this.changes.length > 0) {
				var lastIdx = this.changes.length - 1;
				var change = this.changes[lastIdx];
				this.changes.splice(lastIdx, 1);
				this.onChangeUndone(change, lastIdx, this);
				return change;
			}

			return null;
		}
	});

	// #endregion

	// #region ExoWeb.Mapper.ChangeLog
	//////////////////////////////////////////////////

	/*globals Functor, ChangeSet */

	function ChangeLog(defaultUser) {
		this._defaultUser = defaultUser;
		this.activeSet = null;
		this.sets = [];
		this.onChangeAdded = new Functor();
		this.onChangeSetStarted = new Functor();
		this.onChangeUndone = new Functor();
		this.onTruncated = new Functor();
	}

	ChangeLog.mixin({
		add: function (change) {
			// Adds a new change to the log.

			if (this.activeSet === null) {
				throw new Error("The change log is not currently active.");
			}

			var idx = this.activeSet.add(change);

			this.onChangeAdded(change, idx, this.activeSet, this);

			return idx;
		},
		addSet: function (source, title, user, changes, code) {
			var changeSet = new ChangeSet(source, title, user, changes, code);
			this.sets.push(changeSet);
			return changeSet;
		},
		batchChanges: function (title, user, action, removeIfEmpty) {
			/// <summary>
			/// Ensures that the set of changes that result from invoking
			/// `action` are placed in a dedicated change set with the given
			/// `title` (or description) and `user` and no other changes.
			/// </summary>

			if (!title || title.constructor !== String || title.length === 0) {
				throw new Error("The first argument to batchChanges must be a non-empty string which specifies a title for the changes.");
			}
			if (user !== null && user !== undefined && (user.constructor !== String || user.length === 0)) {
				throw new Error("The second argument to batchChanges must be a non-empty string which specifies the user who is initiating the changes.");
			}
			if (!action || !(action instanceof Function)) {
				throw new Error("The third argument to batchChanges must be a function which performs the changes.");
			}

			var newBatchSetIndex,
				newBatchSet,
				changeSetStartedHandler,
				previousActiveSet = this.activeSet,
				previousActiveSetIdx = previousActiveSet ? this.sets.indexOf(previousActiveSet) : -1,
				priorSet = previousActiveSet,
				usePriorSet = true,
				newActiveSet = null;

			// Start a new set for the batch if there isn't a current active set. If there is a current active set it can be
			// re-used if it has no pre-existing changes and has the same source, title, and user.
			if (!previousActiveSet || (previousActiveSet.changes.length > 0 || previousActiveSet.source !== "client" || previousActiveSet.title !== title || previousActiveSet.user !== user)) {
				newBatchSet = new ChangeSet("client", title, user || this._defaultUser);
				this.sets.push(newBatchSet);
				this.activeSet = newBatchSet;
			}

			// If a new set is created for the batch, and there was a previous active set, then remove it if it isn't needed.
			if (newBatchSet && previousActiveSet) {
				// If there are no changes, no title, and no user, then the set doesn't provide any useful information.
				if (!previousActiveSet.title && !previousActiveSet.user && previousActiveSet.changes.length === 0) {
					// Re-use the set rather than create a new one. This is not strictly necessary, but since
					// there is a precedent for attempting to reuse sets, it makes sense to do so here as well.
					newActiveSet = previousActiveSet;

					// Remove the set from the log.
					this.sets.splice(previousActiveSetIdx, 1);
					// NOTE: no need to alter "activeSet", since it was already changed to be the new batch set.

					// Move the prior set back since the previous active set is removed.
					priorSet = this.sets[previousActiveSetIdx - 1];

					// Don't re-use the prior set since it was not active and the
					// previous active set was removed (as if it never existed).
					usePriorSet = false;
				}
			}

			// Raise an error if a change set is started while the batch is being performed.
			changeSetStartedHandler = function () {
				throw new Error("Nested change batches are not currently supported. Batch already in progress: " + title);
			};

			// Attach the event
			this.onChangeSetStarted.add(changeSetStartedHandler);

			try {
				// Invoke the action callback.
				action();
			} finally {
				// Remove the event
				if (!this.onChangeSetStarted.remove(changeSetStartedHandler)) {
					throw new Error("Could not unsubscribe from change set started event.");
				}

				if (newBatchSet) {
					newBatchSetIndex = this.sets.indexOf(newBatchSet);

					// Remove the new batch set if the caller specified that it should be removed if empty and there were no changes.
					if (removeIfEmpty && newBatchSet === this.activeSet && newBatchSet.changes.length === 0) {
						this.sets.splice(newBatchSetIndex, 1);

						// Restore the previous active set to the log if it was removed.
						if (previousActiveSet && priorSet !== previousActiveSet) {
							this.sets.splice(previousActiveSetIdx, 0, previousActiveSet);
						}

						this.activeSet = previousActiveSet;
						return null;
					}

					this.onChangeSetStarted(newBatchSet, usePriorSet ? priorSet : null, newBatchSetIndex, this);
				}

				// If there was previously an active set, start a new
				// set in order to collect changes that follow separately.
				if (newActiveSet) {
					var idx = this.sets.push(newActiveSet) - 1;
					var newPriorSet = this.sets[idx - 1];
					this.activeSet = newActiveSet;
					this.onChangeSetStarted(newActiveSet, newPriorSet, idx, this);
				} else if (previousActiveSet) {
					// Use the previous title and user for the new set.
					this.start({ title: previousActiveSet.title, user: previousActiveSet.user });
				} else if (this.activeSet.changes.length > 0) {
					// If there wasn't an active set before, then start a new set
					// without a title only if there are changes in the active
					// set. This is a last-resort to ensure that following changes
					// are not included with the changes that were just batched.
					this.start("unknown");
				}
			}

			return newBatchSet;
		},
		checkpoint: function (title, code) {
			if (!this.activeSet) {
				return null;
			}

			return this.activeSet.checkpoint(title, code);
		},
		compress: function (tailOnly, considerAdditionalInfo) {
			var removed = [];

			for (var i = this.sets.length - 1; i >= 0; i--) {
				var set = this.sets[i];
				if (set.changes.length === 0 && (!considerAdditionalInfo || (!set.title && !set.user))) {
					if (set === this.activeSet) {
						this.activeSet = null;
					}

					// Remove the item
					var splicedItems = this.sets.splice(i, 1);

					// Insert at the beginning of the list of removed items
					var spliceArgs = [0, 0];
					Array.prototype.push.apply(spliceArgs, splicedItems);
					Array.prototype.splice.apply(removed, spliceArgs);
				}

				if (tailOnly) {
					// Exit early after checking the last
					// change set if 'tailOnly' is specified.
					break;
				}
			}

			return removed;
		},
		count: function (filter, thisPtr) {
			var result = 0;
			forEach(this.sets, function (set) {
				result += set.count(filter, thisPtr);
			}, this);
			return result;
		},
		lastChange: function () {
			for (var i = this.sets.length - 1; i >= 0; i--) {
				var set = this.sets[i];
				var change = set.lastChange();
				if (change !== null && change !== undefined) {
					return change;
				}
			}

			return null;
		},
		serialize: function (forServer, filter, thisPtr) {
			// Serializes the log and it's sets, including
			// those changes that pass the given filter.

			if (arguments.length === 0) {
				forServer = true;
			} else if (forServer instanceof Function) {
				thisPtr = filter;
				filter = forServer;
				forServer = true;
			}

			return this.sets.map(function (set) {
				return set.serialize(forServer, filter, thisPtr);
			});
		},
		start: function (titleOrOptions, continueLast) {
			// Starts a new change set, which means that new changes will
			// be added to the new set from this point forward.
			var title, user, code;

			if (titleOrOptions == null) throw new ArgumentNullError("titleOrOptions");
			if (titleOrOptions.constructor !== String && !(titleOrOptions instanceof Object)) throw new ArgumentTypeError("titleOrOptions", "string|object", titleOrOptions);

			if (continueLast != null && continueLast.constructor !== Boolean) throw new ArgumentTypeError("continueLast", "boolean", continueLast);

			if (titleOrOptions.constructor === String) {
				title = titleOrOptions;
				user = null;
				code = null;
			} else {
				title = titleOrOptions.title || null;
				user = titleOrOptions.user || null;
				code = titleOrOptions.code || null;
			}

			var previousActiveSet = this.activeSet;

			if (continueLast) {
				var candidateSet = previousActiveSet;
				if (!candidateSet && this.sets.length > 0) {
					candidateSet = this.sets[this.sets.length - 1];
				}
				if (candidateSet && candidateSet.source === "client" && candidateSet.user === user && candidateSet.title === title) {
					if (previousActiveSet) {
						return null;
					} else {
						this.activeSet = candidateSet;
						this.onChangeSetStarted(candidateSet, previousActiveSet, this.sets.length - 1, this);
						return candidateSet;
					}
				}
			}

			var set = new ChangeSet("client", title, user || this._defaultUser, null, code);
			var idx = this.sets.push(set) - 1;
			this.activeSet = set;
			this.onChangeSetStarted(set, previousActiveSet, idx, this);
			return set;
		},
		stop: function () {
			if (!this.activeSet) {
				throw new Error("The change log is not currently active.");
			}

			this.activeSet = null;
		},
		truncate: function (checkpoint, filter, thisPtr) {
			// Removes all change sets where all changes match the given
			// filter.  If a set contains one or more changes that do NOT
			// match, the set is left intact with those changes.

			// Allow calling as function(filter, thisPtr)
			if (checkpoint && Object.prototype.toString.call(checkpoint) === "[object Function]") {
				thisPtr = filter;
				filter = checkpoint;
				checkpoint = null;
			}

			var numRemoved = 0;
			var foundCheckpoint = false;

			for (var i = 0; i < this.sets.length; i++) {
				if (checkpoint) {
					foundCheckpoint = this.sets[i].changes.some(function (c) {
						return c.type === "Checkpoint" && c.code === checkpoint;
					});
				}

				numRemoved += this.sets[i].truncate(checkpoint, filter, thisPtr);

				// If all changes have been removed (or all but the given checkpoint) then discard the set
				if (this.sets[i].changes.length === 0) {
					var currentSet = this.sets[i];
					this.sets.splice(i--, 1);
					if (currentSet === this.activeSet) {
						this.activeSet = null;
					}
				}

				if (foundCheckpoint)
					break;
			}

			this.onTruncated(numRemoved, this);
			return numRemoved;
		},
		undo: function () {
			if (!this.activeSet) {
				throw new Error("The change log is not currently active.");
			}

			var currentSet = this.activeSet,
				currentSetIndex = this.sets.indexOf(currentSet);

			while (currentSet.changes.length === 0) {
				// remove the set from the log
				this.sets.splice(currentSetIndex, 1);

				if (--currentSetIndex < 0) {
					return null;
				}

				currentSet = this.sets[currentSetIndex];
				this.activeSet = currentSet;
			}

			var idx = currentSet.changes.length - 1;
			var change = currentSet.undo();

			this.onChangeUndone(change, idx, currentSet, this);

			return change;
		}
	});

	// #endregion

	// #region ExoWeb.Mapper.ServerSync
	//////////////////////////////////////////////////

	/*globals window, setTimeout, clearTimeout, context */
	/*globals Functor, Translator, Observer, ArgumentNullError, ArgumentTypeError */
	/*globals Model, Entity, LazyLoader, ObjectLazyLoader, ChangeLog, ExoModelEventListener, fromExoModel */
	/*global saveProvider, roundtripProvider, eventProvider, objectProvider */

	function ServerSync(model) {
		// Basic argument validation.
		if (model === null || model === undefined) {
			throw new ArgumentNullError("model");
		}
		if (typeof (model) !== "object" || !(model instanceof Model)) {
			throw new ArgumentTypeError("model", "model", model);
		}

		// Create the necessary local variables.
		var changeLog = new ChangeLog(),
			translator = new Translator(),
			objectsDeleted = [],
			isObjectDeleted = function (deletedObjectsList, obj, isChange) {
				if (Array.contains(deletedObjectsList, obj)) {
					if (isChange) {
						logWarning($format("Object {0}|{1} was changed but has been deleted.", obj.meta.type.get_fullName(), obj.meta.id));
					}
					return true;
				}
				return false;
			},
			filterObjectEvent = function (obj) {
				return !isObjectDeleted(objectsDeleted, obj, false);
			},
			filterPropertyEvent = function (obj) {
				return !isObjectDeleted(objectsDeleted, obj, true);
			},
			listener = new ExoModelEventListener(model, translator, {
				listChanged: filterPropertyEvent,
				propertyChanged: filterPropertyEvent,
				objectRegistered: filterObjectEvent,
				objectUnregistered: filterObjectEvent
			}),
			applyingChanges = 0,
			isCapturingChanges = false,
			self = this;

		// When the event listener detects a change then pass it along to the change log.
		listener.addChangeDetected(function (change) {
			if (applyingChanges <= 0 && isCapturingChanges === true) {
				if (change.property) {
					var instance = fromExoModel(change.instance, translator);
					var property = instance.meta.property(change.property);

					if (property.get_jstype() === Date && change.newValue && property.get_format() && !hasTimeFormat.test(property.get_format().toString())) {
						var serverOffset = self.get_ServerTimezoneOffset();
						var localOffset = -(new Date().getTimezoneOffset() / 60);
						var difference = localOffset - serverOffset;
						change.newValue = change.newValue.addHours(difference);
					}
					else if (change.newValue && change.newValue instanceof TimeSpan) {
						change.newValue = change.newValue.toObject();
					}
				}

				changeLog.add(change);

				self._raiseEvent("changesDetected", [self, { reason: "listener.addChangeDetected", changes: [change] }]);

				// Restart auto-save interval if necessary.
				if (self._saveInterval && self.canSave(change) && isPropertyChangePersisted(change)) {
					self._queueAutoSave();
				}
			}
		});

		// Applying changes (e.g. via a server response change set).
		this.isApplyingChanges = function () {
			return applyingChanges > 0;
		};
		this.beginApplyingChanges = function () {
			applyingChanges += 1;
		};
		this.endApplyingChanges = function () {
			applyingChanges -= 1;

			if (applyingChanges < 0) {
				throw new Error("Error in transaction log processing: unmatched begin and end applying changes.");
			}
		};

		// Capturing changes (i.e. after context initialization has completed).
		this.isCapturingChanges = function () {
			return isCapturingChanges === true;
		};
		this.beginCapturingChanges = function () {
			if (!isCapturingChanges) {
				isCapturingChanges = true;
				changeLog.start({ user: this._localUser });
			}
		};
		this.stopCapturingChanges = function () {
			if (isCapturingChanges) {
				isCapturingChanges = false;
				changeLog.stop();
			}
		};
		this.ignoreChanges = function (before, callback, after, thisPtr) {
			if (arguments.length === 1) {
				callback = arguments[0];
				before = null;
			}

			return function () {
				var beforeCalled = false;

				try {
					applyingChanges += 1;

					if (before && before instanceof Function) {
						before();
					}

					beforeCalled = true;

					callback.apply(thisPtr || this, arguments);
				} finally {
					applyingChanges -= 1;

					if (beforeCalled === true && after && after instanceof Function) {
						after();
					}
				}
			};
		};

		this.isObjectDeleted = function (obj, isChange) {
			return isObjectDeleted(objectsDeleted, obj, isChange);
		};

		// If an existing object is registered then register it for lazy loading.
		model.addObjectRegistered(function (obj) {
			if (!obj.meta.isNew && obj.meta.type.get_origin() === "server" && isCapturingChanges === true && !applyingChanges) {
				ObjectLazyLoader.register(obj);
			}
		});

		// Link model and server objects.
		Object.defineProperty(this, "model", { value: model });
		Object.defineProperty(model, "server", { value: this });

		// Assign backing fields as needed
		this._changeLog = changeLog;
		this._scopeQueries = [];
		this._objectsExcludedFromSave = [];
		this._objectsDeleted = objectsDeleted;
		this._translator = translator;
		this._serverInfo = null;
		this._localUser = null;

		Observer.makeObservable(this);
	}

	function isPropertyChangePersisted(change) {
		if (change.property) {
			var jstype = Model.getJsType(change.instance.type, true);
			if (jstype) {
				var prop = jstype.meta.property(change.property);
				// Can't save non-persisted properties
				if (!prop.get_isPersisted()) {
					return false;
				}
			}
		}
		return true;
	}

	ServerSync.mixin(Functor.eventing);

	var pendingRequests = 0;

	registerActivity("ServerSync: request", function() {
		return pendingRequests > 0;
	});

	function serializeChanges(includeAllChanges, simulateInitRoot) {
		var changes = this._changeLog.serialize(includeAllChanges ? this.canSend : this.canSave, this);

		// temporary HACK (no, really): splice InitNew changes into init transaction
		if (simulateInitRoot && simulateInitRoot.meta.isNew) {
			function isRootInitChange(change) {
				return change.type === "InitNew" && change.instance.type === simulateInitRoot.meta.type.get_fullName() &&
					(change.instance.id === simulateInitRoot.meta.id || this._translator.reverse(change.instance.type, change.instance.id) === simulateInitRoot.meta.id);
			}

			var found = false;
			var initSet = changes.filter(function(set) { return set.source === "init"; })[0];
			if (!initSet || !initSet.changes.some(isRootInitChange, this)) {
				changes.forEach(function(set) {
					if (found === true) return;
					set.changes.forEach(function(change, index) {
						if (found === true) return;
						else if (isRootInitChange.call(this, change)) {
							set.changes.splice(index, 1);
							if (!initSet) {
								initSet = { changes: [change], source: "init" };
								changes.splice(0, 0, initSet);
							}
							else {
								initSet.changes.push(change);
							}
							found = true;
						}
					}, this);
				}, this);
			}
		}

		return changes;
	}

	// when ServerSync is made singleton, this data will be referenced via closure
	function ServerSync$addScopeQuery(query) {
		this._scopeQueries.push(query);
	}

	function ServerSync$storeInitChanges(changes) {
		var activeSet = this._changeLog.activeSet;

		this._changeLog.addSet("init", null, null, changes);

		if (activeSet) {
			this._changeLog.start({ title: activeSet.title, user: activeSet.user });
		}
	}

	function ServerSync$retroactivelyFixChangeWhereIdChanged(changeInstance, obj) {
		// Update change to reflect the object's new id if it is referencing a legacy id
		if (changeInstance.id === obj.meta.legacyId) {
			changeInstance.id = obj.meta.id;
			changeInstance.isNew = false;
		}
	}

	ServerSync.mixin({
		// Enable/disable save & related functions
		///////////////////////////////////////////////////////////////////////
		enableSave: function ServerSync$enableSave(obj) {
			if (!(obj instanceof Entity)) {
				throw new Error("Can only enableSave on entity objects.");
			}

			if (Array.contains(this._objectsExcludedFromSave, obj)) {
				var oldPendingChanges;
				if (this._saveRoot) {
					// If autosave is enabled then determine if we need to queue a timeout
					oldPendingChanges = this.changes(false, this._saveRoot, true);
				}
				Array.remove(this._objectsExcludedFromSave, obj);

				this._raiseEvent("changesDetected", [this, { reason: "enableSave" }]);

				// Determine if ther are now pending changes
				if (oldPendingChanges && oldPendingChanges.length === 0 && this._saveInterval && !this._saveTimeout) {
					if (this.changes(false, this._saveRoot, true).length > 0) {
						this._queueAutoSave();
					}
				}
				return true;
			}
		},
		disableSave: function ServerSync$disableSave(obj) {
			if (!(obj instanceof Entity)) {
				throw new Error("Can only disableSave on entity objects.");
			}

			if (!Array.contains(this._objectsExcludedFromSave, obj)) {
				var oldPendingChanges;
				if (this._saveRoot) {
					// If autosave is enabled then determine if we need to queue a timeout
					oldPendingChanges = this.changes(false, this._saveRoot, true);
				}
				this._objectsExcludedFromSave.push(obj);

				this._raiseEvent("changesDetected", [this, { reason: "disableSave" }]);

				// Determine if ther are no longer pending changes
				if (oldPendingChanges && oldPendingChanges.length > 0 && this._saveInterval && this._saveTimeout) {
					if (this.changes(false, this._saveRoot, true).length === 0) {
						window.clearTimeout(this._saveTimeout);
						this._saveTimeout = null;
					}
				}
				return true;
			}
		},
		notifyDeleted: function ServerSync$notifyDeleted(obj) {
			if (!(obj instanceof Entity)) {
				throw new Error("Notified of deleted object that is not an entity.");
			}

			if (!Array.contains(this._objectsDeleted, obj)) {
				this._objectsDeleted.push(obj);
				return true;
			}

			return false;
		},
		canSend: function (change) {

			// Checkpoint is a client-only event type.
			if (change.type === "Checkpoint") {
				return false;
			}

			if (change.instance) {
				var type = Model.getJsType(change.instance.type, true);
				if (type && LazyLoader.isLoaded(type.meta)) {
					if (type.meta.get_origin() !== "server") {
						// Don't send change events for types that didn't originate from the server.
						return false;
					}

					if (change.property) {
						var property = type.meta.property(change.property);
						// Don't send property change events for properties that didn't originate from the server, or static properties.
						if (property.get_origin() !== "server" || property.get_isStatic()) {
							return false;
						}
					}

					// Don't send changes for deleted objects.
					var obj = fromExoModel(change.instance, this._translator, false, this._objectsDeleted);
					if (obj && this.isObjectDeleted(obj, false)) {
						return false;
					}
				}
			}

			// Event is ok to send.
			return true;
		},
		canSaveObject: function ServerSync$canSaveObject(objOrMeta) {
			var obj;
			var errorFmt = "Unable to test whether object can be saved:  {0}.";

			if (objOrMeta == null) {
				throw new ArgumentNullError("objOrMeta");
			}
			else if (objOrMeta instanceof ExoWeb.Model.ObjectMeta) {
				obj = objOrMeta._obj;
			}
			else if (objOrMeta instanceof Entity) {
				obj = objOrMeta;
			}
			else {
				throw new ArgumentTypeError("objOrMeta", "ObjectMeta|Entity", objOrMeta);
			}

			return !Array.contains(this._objectsExcludedFromSave, obj) && !Array.contains(this._objectsDeleted, obj);
		},
		canSave: function ServerSync$canSave(change) {

			// Can't save changes that can't be sent to the server at all.
			if (!this.canSend(change)) return false;

			// For list changes additionally check added and removed objects.
			if (change.type === "ListChange") {
				if (change.added.length > 0 || change.removed.length > 0) {
					var ignore = true;

					// Search added and removed for an object that can be saved.
					Array.forEach(change.added, function (item) {
						// if the type doesn't exist then obviously the instance doesn't either
						if (!item.type || !ExoWeb.Model.Model.getJsType(item.type, true)) {
							ignore = false;
						}
						else {
							var obj = fromExoModel(item, this._translator, false, this._objectsDeleted);
							// Only objects that exist can be disabled
							if (!obj || this.canSaveObject(obj)) {
								ignore = false;
							}
						}
					}, this);
					Array.forEach(change.removed, function (item) {
						// if the type doesn't exist then obviously the instance doesn't either
						if (!item.type || !ExoWeb.Model.Model.getJsType(item.type, true)) {
							ignore = false;
						}
						else {
							var obj = fromExoModel(item, this._translator, false, this._objectsDeleted);
							if (!obj || this.canSaveObject(obj)) {
								ignore = false;
							}
						}
					}, this);

					// If no "savable" object was found in added or 
					// removed then this change cannot be saved.
					if (ignore) {
						return false;
					}
				}
			}
			// For reference changes additionally check oldValue/newValue
			else if (change.type === "ReferenceChange") {
				var oldJsType = change.oldValue && ExoWeb.Model.Model.getJsType(change.oldValue.type, true);
				if (oldJsType) {
					var oldValue = fromExoModel(change.oldValue, this._translator, false, this._objectsDeleted);
					if (oldValue && !this.canSaveObject(oldValue)) {
						return false;
					}
				}

				var newJsType = change.newValue && ExoWeb.Model.Model.getJsType(change.newValue.type, true);
				if (newJsType) {
					var newValue = fromExoModel(change.newValue, this._translator, false, this._objectsDeleted);
					if (newValue && !this.canSaveObject(newValue)) {
						return false;
					}
				}
			}

			// if the type doesn't exist then obviously the instance doesn't either
			var jstype = ExoWeb.Model.Model.getJsType(change.instance.type, true);
			if (!jstype) {
				return true;
			}

			// Ensure that the instance that the change pertains to can be saved.
			var instanceObj = fromExoModel(change.instance, this._translator, false, this._objectsDeleted);
			return !instanceObj || this.canSaveObject(instanceObj);
		},

		_handleResult: function ServerSync$_handleResult(result, description, checkpoint, callbackOrOptions) {
			var callback, beforeApply = null, afterApply = null;

			if (callbackOrOptions instanceof Function) {
				callback = callbackOrOptions;
			}
			else {
				callback = callbackOrOptions.callback;
				beforeApply = callbackOrOptions.beforeApply;
				afterApply = callbackOrOptions.afterApply;
			}

			ResponseHandler.execute(this.model, this, {
				instances: result.instances,
				conditions: result.conditions,
				types: result.types && result.types instanceof Array ? null : result.types,
				changes: result.changes,
				source: "server",
				description: description,
				checkpoint: checkpoint,
				serverInfo: result.serverInfo,
				beforeApply: beforeApply,
				afterApply: afterApply
			}, callback, this);
		},

		// General events methods
		///////////////////////////////////////////////////////////////////////
		addRequestBegin: function (handler) {
			this._addEvent("requestBegin", handler);
		},
		removeRequestBegin: function (handler) {
			this._removeEvent("requestBegin", handler);
		},
		addRequestEnd: function (handler) {
			this._addEvent("requestEnd", handler);
		},
		removeRequestEnd: function (handler) {
			this._removeEvent("requestEnd", handler);
		},
		addRequestSuccess: function (handler) {
			this._addEvent("requestSuccess", handler);
		},
		removeRequestSuccess: function (handler) {
			this._removeEvent("requestSuccess", handler);
		},
		addRequestFailed: function (handler) {
			this._addEvent("requestFailed", handler);
		},
		removeRequestFailed: function (handler) {
			this._removeEvent("requestFailed", handler);
		},

		// Raise Server Event
		///////////////////////////////////////////////////////////////////////
		raiseServerEvent: function ServerSync$raiseServerEvent(name, target, event, includeAllChanges, success, failed, paths) {
			/// <summary locid="M:J#ExoWeb.Mapper.ServerSync.save">
			/// Raise a server event on the given target. The given success or failure callback is invoked
			/// when the request is complete.
			/// </summary>
			/// <param name="name" optional="false" mayBeNull="false" type="String"></param>
			/// <param name="target" optional="false" mayBeNull="false" type="ExoWeb.Model.Entity"></param>
			/// <param name="event" optional="true" mayBeNull="null" type="Object"></param>
			/// <param name="success" optional="true" mayBeNull="true" type="Function"></param>
			/// <param name="failed" optional="true" mayBeNull="true" type="Function"></param>
			/// <param name="paths" optional="true" mayBeNull="true" isArray="true" type="String"></param>

			var args, checkpoint, serializedEvent, serializedEventTarget, eventPropName;

			pendingRequests++;

			// Checkpoint the log to ensure that we only truncate changes that were saved.
			checkpoint = this._changeLog.checkpoint("raiseServerEvent(" + name + ")-" + +(new Date()));

			args = {
				type: "raiseServerEvent",
				target: target,
				checkpoint: checkpoint,
				includeAllChanges: includeAllChanges
			};

			args.eventName = name;
			args.eventObject = event;

			this._raiseEvent("raiseServerEventBegin", [this, args]);

			serializedEvent = {};

			// If an event object is provided then convert its entity properties into their serialized form.
			if (event !== undefined && event !== null) {
				for (eventPropName in event) {
					var arg = event[eventPropName];

					if (arg instanceof Array) {
						serializedEvent[eventPropName] = arg.map(function (a) { return toExoModel(a, this._translator); }, this);
					} else {
						serializedEvent[eventPropName] = toExoModel(arg, this._translator);
					}
				}
			}

			serializedEventTarget = toExoModel(target, this._translator);

			args.root = serializedEventTarget;
			args.eventData = serializedEvent;

			this._raiseEvent("requestBegin", [this, args]);

			eventProvider(
				name,
				serializedEventTarget,
				serializedEvent,
				paths,
				serializeChanges.call(this, includeAllChanges, target),
				this._onRaiseServerEventSuccess.bind(this).appendArguments(args, checkpoint, success),
				this._onRaiseServerEventFailed.bind(this).appendArguments(args, failed || success)
			);
		},
		_onRaiseServerEventSuccess: function ServerSync$_onRaiseServerEventSuccess(result, args, checkpoint, callback) {
			args.responseObject = result;
			args.requestSucceeded = true;

			this._raiseEvent("requestEnd", [this, args]);

			this._handleResult(result, "raiseServerEvent(" + args.eventName + ")", checkpoint, function () {
				this._raiseEvent("requestSuccess", [this, args]);

				var event = result.events[0];
				if (event instanceof Array) {
					for (var i = 0; i < event.length; ++i) {
						event[i] = fromExoModel(event[i], this._translator, true);
					}
				}
				else {
					event = fromExoModel(event, this._translator, true);
				}

				restoreDates(event);

				result.event = event;

				args.eventResult = event;

				this._raiseEvent("raiseServerEventEnd", [this, args]);
				this._raiseEvent("raiseServerEventSuccess", [this, args]);

				if (callback && callback instanceof Function) {
					callback(result);
				}

				pendingRequests--;
			});
		},
		_onRaiseServerEventFailed: function ServerSync$_onRaiseServerEventFailed(error, args, callback) {
			args.responseObject = error;
			args.requestSucceeded = false;

			this._raiseEvent("requestEnd", [this, args]);
			this._raiseEvent("requestFailed", [this, args]);

			this._raiseEvent("raiseServerEventEnd", [this, args]);
			this._raiseEvent("raiseServerEventFailed", [this, args]);

			if (callback && callback instanceof Function) {
				callback(error);
			}

			pendingRequests--;
		},
		addRaiseServerEventBegin: function (handler) {
			this._addEvent("raiseServerEventBegin", handler);
		},
		removeRaiseServerEventBegin: function (handler) {
			this._removeEvent("raiseServerEventBegin", handler);
		},
		addRaiseServerEventEnd: function (handler) {
			this._addEvent("raiseServerEventEnd", handler);
		},
		removeRaiseServerEventEnd: function (handler) {
			this._removeEvent("raiseServerEventEnd", handler);
		},
		addRaiseServerEventSuccess: function (handler) {
			this._addEvent("raiseServerEventSuccess", handler);
		},
		removeRaiseServerEventSuccess: function (handler) {
			this._removeEvent("raiseServerEventSuccess", handler);
		},
		addRaiseServerEventFailed: function (handler) {
			this._addEvent("raiseServerEventFailed", handler);
		},
		removeRaiseServerEventFailed: function (handler) {
			this._removeEvent("raiseServerEventFailed", handler);
		},

		// Roundtrip
		///////////////////////////////////////////////////////////////////////
		roundtrip: function ServerSync$roundtrip(target, paths, success, failed) {
			/// <summary locid="M:J#ExoWeb.Mapper.ServerSync.save">
			/// Roundtrips the current changes to the server. The given success or failure callback is
			/// invoked when the request is complete.
			/// </summary>
			/// <param name="target" optional="false" mayBeNull="false" type="ExoWeb.Model.Entity"></param>
			/// <param name="paths" optional="false" mayBeNull="true" isArray="true" type="String"></param>
			/// <param name="success" optional="false" mayBeNull="true" type="Function"></param>
			/// <param name="failed" optional="false" mayBeNull="true" type="Function"></param>

			var args, checkpoint, serializedTarget, includeAllChanges;

			pendingRequests++;

			if (target && target instanceof Function) {
				success = target;
				failed = paths;
				target = null;
				paths = null;
			}

			checkpoint = this._changeLog.checkpoint("roundtrip-" + +(new Date()));

			if (target) {
				includeAllChanges = true;
			} else {
				includeAllChanges = false;
			}

			args = {
				type: "roundtrip",
				target: target || null,
				checkpoint: checkpoint,
				includeAllChanges: includeAllChanges
			};

			this._raiseEvent("roundtripBegin", [this, args]);

			if (target) {
				serializedTarget = toExoModel(target, this._translator);
			} else {
				serializedTarget = null;
			}

			args.root = serializedTarget;

			this._raiseEvent("requestBegin", [this, args]);

			roundtripProvider(
				serializedTarget,
				paths,
				serializeChanges.call(this, includeAllChanges, target),
				this._onRoundtripSuccess.bind(this).appendArguments(args, checkpoint, success),
				this._onRoundtripFailed.bind(this).appendArguments(args, failed || success)
			);
		},
		_onRoundtripSuccess: function ServerSync$_onRoundtripSuccess(result, args, checkpoint, callback) {
			args.responseObject = result;
			args.requestSucceeded = true;

			this._raiseEvent("requestEnd", [this, args]);

			this._handleResult(result, "roundtrip", checkpoint, function () {
				this._raiseEvent("requestSuccess", [this, args]);
				this._raiseEvent("roundtripEnd", [this, args]);
				this._raiseEvent("roundtripSuccess", [this, args]);

				if (callback && callback instanceof Function) {
					callback(result);
				}

				pendingRequests--;
			});
		},
		_onRoundtripFailed: function ServerSync$_onRoundtripFailed(error, args, callback) {
			args.responseObject = error;
			args.requestSucceeded = false;

			this._raiseEvent("requestEnd", [this, args]);
			this._raiseEvent("requestFailed", [this, args]);

			this._raiseEvent("roundtripEnd", [this, args]);
			this._raiseEvent("roundtripFailed", [this, args]);

			if (callback && callback instanceof Function) {
				callback(error);
			}

			pendingRequests--;
		},
		startAutoRoundtrip: function (interval) {
			if (!interval || typeof(interval) !== "number" || interval <= 0) {
				throw new Error("An interval must be specified for auto-save.");
			}

			// cancel any pending roundtrip schedule
			this.stopAutoRoundtrip();

			function doRoundtrip() {
				this.roundtrip(function () {
					this._roundtripTimeout = window.setTimeout(doRoundtrip.bind(this), interval);
				});
			}

			this._roundtripTimeout = window.setTimeout(doRoundtrip.bind(this), interval);
		},
		stopAutoRoundtrip: function () {
			if (this._roundtripTimeout) {
				window.clearTimeout(this._roundtripTimeout);
			}
		},
		addRoundtripBegin: function (handler) {
			this._addEvent("roundtripBegin", handler);
		},
		removeRoundtripBegin: function (handler) {
			this._removeEvent("roundtripBegin", handler);
		},
		addRoundtripEnd: function (handler) {
			this._addEvent("roundtripEnd", handler);
		},
		removeRoundtripEnd: function (handler) {
			this._removeEvent("roundtripEnd", handler);
		},
		addRoundtripSuccess: function (handler) {
			this._addEvent("roundtripSuccess", handler);
		},
		removeRoundtripSuccess: function (handler) {
			this._removeEvent("roundtripSuccess", handler);
		},
		addRoundtripFailed: function (handler) {
			this._addEvent("roundtripFailed", handler);
		},
		removeRoundtripFailed: function (handler) {
			this._removeEvent("roundtripFailed", handler);
		},

		// Save
		///////////////////////////////////////////////////////////////////////
		save: function (target, success, failed) {
			/// <summary locid="M:J#ExoWeb.Mapper.ServerSync.save">
			/// Saves changes to the given target and related entities. The given success or failure
			/// callback is invoked when the request is complete.
			/// </summary>
			/// <param name="target" optional="false" mayBeNull="false" type="ExoWeb.Model.Entity"></param>
			/// <param name="success" optional="false" mayBeNull="true" type="Function"></param>
			/// <param name="failed" optional="false" mayBeNull="true" type="Function"></param>

			var args, checkpoint, serializedTarget;

			pendingRequests++;

			// Checkpoint the log to ensure that we only truncate changes that were saved.
			checkpoint = this._changeLog.checkpoint("save-" + +(new Date()));

			args = {
				type: "save",
				target: target,
				checkpoint: checkpoint,
				includeAllChanges: false
			};

			this._raiseEvent("saveBegin", [this, args]);

			serializedTarget = toExoModel(target, this._translator);

			args.root = serializedTarget;

			this._raiseEvent("requestBegin", [this, args]);

			saveProvider(
				serializedTarget,
				serializeChanges.call(this, false, target),
				this._onSaveSuccess.bind(this).appendArguments(args, checkpoint, success),
				this._onSaveFailed.bind(this).appendArguments(args, failed || success)
			);
		},
		_onSaveSuccess: function ServerSync$_onSaveSuccess(result, args, checkpoint, callback) {
			args.responseObject = result;
			args.requestSucceeded = true;

			this._raiseEvent("requestEnd", [this, args]);

			this._handleResult(result, "save", checkpoint, function () {
				this._raiseEvent("requestSuccess", [this, args]);
				this._raiseEvent("saveEnd", [this, args]);
				this._raiseEvent("saveSuccess", [this, args]);

				if (callback && callback instanceof Function) {
					callback(result);
				}

				pendingRequests--;
			});
		},
		_onSaveFailed: function (error, args, callback) {
			args.responseObject = error;
			args.requestSucceeded = false;

			this._raiseEvent("requestEnd", [this, args]);
			this._raiseEvent("requestFailed", [this, args]);

			this._raiseEvent("saveEnd", [this, args]);
			this._raiseEvent("saveFailed", [this, args]);

			if (callback && callback instanceof Function) {
				callback(error);
			}

			pendingRequests--;
		},
		startAutoSave: function ServerSync$startAutoSave(root, interval, maxAttempts) {
			if (!root || !(root instanceof Entity)) {
				throw new Error("A root object must be specified for auto-save.");
			}

			if (!interval || typeof(interval) !== "number" || interval <= 0) {
				throw new Error("An interval must be specified for auto-save.");
			}

			if (maxAttempts && (typeof (maxAttempts) !== "number" || maxAttempts <= 0)) {
				throw new Error("Max number of auto-save attempts must be a positive number.");
			}

			// cancel any pending save schedule
			this.stopAutoSave();

			this._saveInterval = interval;
			this._saveRoot = root;

			// Attempt to provide a somewhat reasonable default.
			this._maxAutoSaveAttempts = maxAttempts || 3;
		},
		stopAutoSave: function ServerSync$stopAutoSave() {
			if (this._saveTimeout) {
				window.clearTimeout(this._saveTimeout);
				this._saveTimeout = null;
			}

			this._saveInterval = null;
			this._saveRoot = null;
			this._maxAutoSaveAttempts = null;
		},
		_autoSaveSuccess: function() {
			this._failedAutoSaveAttempts = 0;

			// Wait for the next change before next auto save
			this._saveTimeout = null;

			// ...unless there were new pending changes encountered since the last auto-save.
			if (this.changes(false, this._saveRoot, true).length > 0) {
				this._queueAutoSave();
			}
		},
		_autoSaveFailure: function() {
			if (++this._failedAutoSaveAttempts < this._maxAutoSaveAttempts) {
				this._queueAutoSave();
			} else {
				logWarning($format("Auto-save failed {0} consecutive times and will not re-try again until additional changes are detected.", this._failedAutoSaveAttempts));
			}
		},
		_doAutoSave: function() {
			this.save(this._saveRoot, this._autoSaveSuccess.bind(this), this._autoSaveFailure.bind(this));
		},
		_queueAutoSave: function ServerSync$_queueAutoSave() {
			if (this._saveTimeout) {
				// Already queued...
				return;
			}

			if (!this._saveInterval || !this._saveRoot || !this._maxAutoSaveAttempts) {
				// Auto-save is not configured...
				return;
			}

			this._saveTimeout = window.setTimeout(this._doAutoSave.bind(this), this._saveInterval);
		},
		addSaveBegin: function (handler) {
			this._addEvent("saveBegin", handler);
		},
		removeSaveBegin: function (handler) {
			this._removeEvent("saveBegin", handler);
		},
		addSaveEnd: function (handler) {
			this._addEvent("saveEnd", handler);
		},
		removeSaveEnd: function (handler) {
			this._removeEvent("saveEnd", handler);
		},
		addSaveSuccess: function (handler) {
			this._addEvent("saveSuccess", handler);
		},
		removeSaveSuccess: function (handler) {
			this._removeEvent("saveSuccess", handler);
		},
		addSaveFailed: function (handler) {
			this._addEvent("saveFailed", handler);
		},
		removeSaveFailed: function (handler) {
			this._removeEvent("saveFailed", handler);
		},

		// EnsureLoaded
		///////////////////////////////////////////////////////////////////////
		ensureLoaded: function (target, paths, includePathsFromQueries, success, failed) {
			/// <summary locid="M:J#ExoWeb.Mapper.ServerSync.ensureLoaded">
			/// Loads the given entity (and optionally a set of relative paths) if necessary. The given success or failure
			/// callback is invoked when the request is complete if loading was required. If no loading was required, the
			/// success callback is invoked after a short period of time. This artifical asynchronicity is introduced
			/// primarily to limit call stack size, and in the case of loading a consistent asynchronous experience is
			/// acceptable and perhaps even expected to some extent.
			/// </summary>
			/// <param name="target" optional="false" mayBeNull="false" type="ExoWeb.Model.Entity|ExoWeb.Model.Type"></param>
			/// <param name="paths" optional="false" mayBeNull="true" isArray="true" type="String"></param>
			/// <param name="includePathsFromQueries" mayBeNull="true" type="Boolean" optional="false"></param>
			/// <param name="success" optional="false" mayBeNull="true" type="Function"></param>
			/// <param name="failed" optional="false" mayBeNull="true" type="Function"></param>

			var args, checkpoint, serializedTarget, queryPaths, pathsToLoad, staticPath, staticProperty;

			pendingRequests++;

			if (target === null || target === undefined) {
				throw new Error("Method ensureLoaded requires a target argument.");
			}

			if (target instanceof Entity) {
				if (includePathsFromQueries) {
					// Get the paths from the original query(ies) that apply to the target object (based on type).
					queryPaths = ObjectLazyLoader.getRelativePaths(target);
					if (paths) {
						pathsToLoad = paths.concat(queryPaths);
					} else {
						pathsToLoad = queryPaths;
					}
				} else {
					pathsToLoad = paths || [];
				}
			} else {
				// For static loading a single array or object will be loaded with no additional paths.
				pathsToLoad = [];

				// Use the meta type if a type constructor was used as the target.
				if (target instanceof Function && target.meta && target.meta && target.meta instanceof Type) {
					target = target.meta;
				}

				if (!(target instanceof Type)) {
					throw new Error($format("Method ensureLoaded expects target of type Entity or Type, but found type \"{0}\".", parseFunctionName(target.constructor)));
				}

				if (paths === null || paths === undefined) {
					throw new Error("Method ensureLoaded requires a paths argument for static property loading.");
				}

				if (Object.prototype.toString.call(paths) === "[object String]") {
					staticPath = paths;
				} else if (Object.prototype.toString.call(paths) === "[object Array]") {
					if (paths.length === 1) {
						staticPath = paths[0];
					} else {
						throw new Error($format("Multiple paths cannot be specified when ensuring that static property information is loaded: \"{0}.[{1}]\".", target.get_fullName(), paths.join(",")));
					}
				} else {
					throw new Error($format("Argument \"paths\" was expected to be a string or array of strings, but found type \"{0}\" instead.", parseFunctionName(target.constructor)));
				}

				// Static property path can only be a single property name, not a multi-step path.
				if (staticPath.indexOf(".") >= 0) {
					throw new Error($format("Multiple path steps cannot be specified when ensuring that static property information is loaded: \"{0}.{1}\".", target.get_fullName(), staticPath));
				}

				// Get the meta property for the given single path.
				staticProperty = target.property(staticPath);

				// Prepend the target type name to the static path for later use in logging and errors, etc.
				staticPath = target.get_fullName() + "." + staticPath;

				// Get the static path value and verify that there is a value in order to ensure loading.
				target = staticProperty.value(target);
				if (target === null || target === undefined) {
					throw new Error($format("Unable to ensure that static path \"{0}\" is loaded because it evaluates to a null or undefined value.", staticPath));
				}
			}

			// Checkpoint the log to ensure that we only truncate changes that were saved.
			checkpoint = this._changeLog.checkpoint("ensureLoaded" + +(new Date()));

			args = {
				type: "ensureLoaded",
				target: target instanceof Entity ? target : null,
				checkpoint: checkpoint,
				includeAllChanges: true
			};

			this._raiseEvent("ensureLoadedBegin", [this, args]);

			// Check if the object or any of the paths require loading. Apply the array of paths to the
			// isLoaded call, since the paths will be obtained as "rest" parameters.
			if (!LazyLoader.isLoaded.apply(null, [target].concat(pathsToLoad))) {
				serializedTarget = target instanceof Entity ? toExoModel(target, this._translator) : null;

				args.root = serializedTarget;

				this._raiseEvent("requestBegin", [this, args]);

				// TODO: reference to server will be a singleton, not context
				objectProvider(
					target instanceof Entity ? target.meta.type.get_fullName() : target.get_fullName(),
					target instanceof Entity ? [target.meta.id] : [],
					pathsToLoad,
					false, // in scope?
					serializeChanges.call(this, true),
					this._onEnsureLoadedSuccess.bind(this).appendArguments(args, checkpoint, success),
					this._onEnsureLoadedFailed.bind(this).appendArguments(args, failed || success));
			} else {
				var self = this;
				window.setTimeout(function () {
					args.requiredLoading = false;

					self._raiseEvent("ensureLoadedEnd", [self, args]);
					self._raiseEvent("ensureLoadedSuccess", [self, args]);

					if (success && success instanceof Function) {
						success();
					}

					pendingRequests--;
				}, 1);
			}
		},
		_onEnsureLoadedSuccess: function (result, args, checkpoint, callback) {
			args.responseObject = result;
			args.requestSucceeded = true;

			this._raiseEvent("requestEnd", [this, args]);

			this._handleResult(result, "ensureLoaded", checkpoint, function () {
				this._raiseEvent("requestSuccess", [this, args]);

				args.requiredLoading = true;

				this._raiseEvent("ensureLoadedEnd", [this, args]);
				this._raiseEvent("ensureLoadedSuccess", [this, args]);

				if (callback && callback instanceof Function) {
					callback(result);
				}

				pendingRequests--;
			});
		},
		_onEnsureLoadedFailed: function (error, args, callback) {
			args.responseObject = error;
			args.requestSucceeded = false;

			this._raiseEvent("requestEnd", [this, args]);
			this._raiseEvent("requestFailed", [this, args]);

			args.requiredLoading = true;

			this._raiseEvent("ensureLoadedEnd", [this, args]);
			this._raiseEvent("ensureLoadedFailed", [this, args]);

			if (callback && callback instanceof Function) {
				callback(error);
			}

			pendingRequests--;
		},
		addEnsureLoadedBegin: function (handler) {
			this._addEvent("ensureLoadedBegin", handler);
		},
		removeEnsureLoadedBegin: function (handler) {
			this._removeEvent("ensureLoadedBegin", handler);
		},
		addEnsureLoadedEnd: function (handler) {
			this._addEvent("ensureLoadedEnd", handler);
		},
		removeEnsureLoadedEnd: function (handler) {
			this._removeEvent("ensureLoadedEnd", handler);
		},
		addEnsureLoadedSuccess: function (handler) {
			this._addEvent("ensureLoadedSuccess", handler);
		},
		removeEnsureLoadedSuccess: function (handler) {
			this._removeEvent("ensureLoadedSuccess", handler);
		},
		addEnsureLoadedFailed: function (handler) {
			this._addEvent("ensureLoadedFailed", handler);
		},
		removeEnsureLoadedFailed: function (handler) {
			this._removeEvent("ensureLoadedFailed", handler);
		},

		// Apply Changes
		///////////////////////////////////////////////////////////////////////
		applyChanges: function (checkpoint, changes, source, user, setId, description, filter, beforeApply, afterApply, callback, thisPtr) {
			if (!changes || !(changes instanceof Array)) {
				if (callback) {
					callback.call(thisPtr || this);
				}
				return;
			}

			if (source == null) throw new ArgumentNullError("source");

			var newChanges = [];

			var signal = new Signal("applyChanges");
			var waitForAllRegistered = false;
			var batchStarted = false;
			var changesApplying = false;
			var callbackInvoked = false;
			var methodExited = false;

			try {
				var batch = ExoWeb.Batch.start("apply changes");
				batchStarted = true;

				this.beginApplyingChanges();
				changesApplying = true;

				var previousActiveSet = null;

				if (this._changeLog.activeSet) {
					previousActiveSet = this._changeLog.activeSet;

					// Stop the active set
					this._changeLog.stop();

					if (this._changeLog.compress(true, true).indexOf(previousActiveSet) > 0) {
						// If the previous active set was removed, then don't use it later on.
						previousActiveSet = null;
					}
				}

				var changeSet = this._changeLog.addSet(source, description, user, null, setId);

				this._changeLog.onChangeSetStarted(changeSet, previousActiveSet, previousActiveSet ? this._changeLog.sets.indexOf(previousActiveSet) : -1, this._changeLog);

				// Determine that the target of a change is a new instance
				var instanceIsNew = function (change) {
					if (ExoWeb.Model.Model.getJsType(change.instance.type, true)) {
						var obj = fromExoModel(change.instance, this._translator);
						return obj && obj.meta.isNew;
					}
					return false;
				};

				// truncate change log up-front if save occurred
				var shouldDiscardChange;
				var saveChanges = changes.filter(function (c, i) { return c.type === "Save"; });
				var numSaveChanges = saveChanges.length;
				if (numSaveChanges > 0) {
					// Collect all of the id changes in the response. Multiple saves could occur.
					var idChanges = saveChanges.mapToArray(function (change) { return change.added || []; });

					// Create a list of new instances that were saved. Use a typed identifier form since the id stored
					// in changes in the change log will be a server id rather than client id (if there is a distinction)
					// and using the typed identifier approach allows for a straightforward search of the array.
					var newInstancesSaved = idChanges.map(function (idChange) { return idChange.type + "|" + idChange.oldId; });

					// Truncate changes that we believe were actually saved based on the response
					shouldDiscardChange = function (change) {
						var couldHaveBeenSaved, isNewObjectNotYetSaved;

						// Determine if the change could have been saved in the first place
						couldHaveBeenSaved = this.canSave(change);

						// Determine if the change targets a new object that has not been saved
						isNewObjectNotYetSaved = change.instance && (change.instance.isNew || instanceIsNew.call(this, change)) && !newInstancesSaved.contains(change.instance.type + "|" + change.instance.id);

						// Return a value indicating whether or not the change should be removed
						return couldHaveBeenSaved && !isNewObjectNotYetSaved;
					};

					// Truncate changes that we believe were actually saved based on the response
					this._changeLog.truncate(checkpoint, shouldDiscardChange.bind(this));
					this._changeLog.start({ user: this._localUser });

					// Update affected scope queries
					idChanges.forEach(function (idChange) {
						var jstype = ExoWeb.Model.Model.getJsType(idChange.type, true);
						if (jstype && LazyLoader.isLoaded(jstype.meta)) {
							var serverOldId = idChange.oldId;
							var clientOldId = !(idChange.oldId in jstype.meta._pool) ?
								this._translator.reverse(idChange.type, serverOldId) :
								idChange.oldId;
							this._scopeQueries.forEach(function (query) {
								query.ids = query.ids.map(function (id) {
									return (id === clientOldId) ? idChange.newId : id;
								}, this);
							}, this);
						}
					}, this);
				}

				var numPendingSaveChanges = numSaveChanges;

				changes.forEach(function (change) {
					if (change.type === "InitNew") {
						this.applyInitChange(change, beforeApply, afterApply, signal.pending());
					}
					else if (change.type === "ReferenceChange") {
						this.applyRefChange(change, beforeApply, afterApply, signal.pending());
					}
					else if (change.type === "ValueChange") {
						this.applyValChange(change, beforeApply, afterApply, signal.pending());
					}
					else if (change.type === "ListChange") {
						this.applyListChange(change, beforeApply, afterApply, signal.pending());
					}
					else if (change.type === "Save") {
						this.applySaveChange(change, beforeApply, afterApply, signal.pending());
						numPendingSaveChanges--;
					}

					if (change.type !== "Save") {
						var noObjectsWereSaved = numSaveChanges === 0;
						var hasPendingSaveChanges = numPendingSaveChanges > 0;

						// Only record a change if there is not a pending save change, also take into account new instances that are not saved
						if (noObjectsWereSaved || !hasPendingSaveChanges || !shouldDiscardChange.call(this, change)) {
							// Apply additional filter
							if (!filter || filter(change) === true) {
								newChanges.push(change);
								changeSet.add(change);
							}
						}
					}
				}, this);

				// Start a new change set to capture future changes.
				if (this.isCapturingChanges()) {
					this._changeLog.start({ user: this._localUser });
				}

				waitForAllRegistered = true;
				signal.waitForAll(function () {
					// The method has not yet exited, which means that teardown is happening
					// synchronously, so end applying changes before invoking the callback.
					if (!methodExited) {
						this.endApplyingChanges();
					}

					ExoWeb.Batch.end(batch);

					if (callback) {
						callback.call(thisPtr || this);
					}

					callbackInvoked = true;
				}, this, true);
			}
			finally {
				// The 'teardown' callback was not invoked, either because of an error or because
				// of delayed execution of the teardown routine, so end applying changes immediately.
				if (changesApplying && !callbackInvoked) {
					this.endApplyingChanges();
				}

				// An error occurred after the batch was started but before the 'teardown' callback
				// was registered (which would normally end the batch) so end it immediately.
				if (batchStarted && !waitForAllRegistered) {
					ExoWeb.Batch.end(batch);
				}
			}

			if (newChanges.length > 0) {
				this._raiseEvent("changesDetected", [this, { reason: "applyChanges", changes: newChanges }]);
			}

			// Allow potentially asynchronous callbacks to detect that the
			// method has already exited via a closure on this variable.
			methodExited = true;
		},
		applySaveChange: function (change, before, after, callback, thisPtr) {
			if (!(change.added || change.deleted)) {
				if (callback) {
					callback.call(thisPtr || this);
				}
				return;
			}

			change.deleted.forEach(function (instance) {
				tryGetJsType(this.model, instance.type, null, false, function (type) {
					tryGetEntity(this.model, this._translator, type, instance.id, null, LazyLoadEnum.None, this.ignoreChanges(before, function (obj) {
						// Notify server object that the instance is deleted
						this.notifyDeleted(obj);
						// Simply a marker flag for debugging purposes
						obj.meta.isDeleted = true;
						// Unregister the object so that it can't be retrieved via get, known, or have rules execute against it
						type.meta.unregister(obj);
						// Remove affected scope queries
						this._scopeQueries.purge(function (query) {
							// Remove the deleted object's id from the scope query
							query.ids.purge(function (id) {
								return (id === obj.meta.id);
							}, this);
							// Remove the scope query if it is empty
							return query.ids.length === 0;
						}, this);
					}, after), this);
				}, this);
			}, this);

			change.added.forEach(function (idChange, idChangeIndex) {
				ensureJsType(this.model, idChange.type, this.ignoreChanges(before, function (jstype) {
					var serverOldId = idChange.oldId;
					var clientOldId = !(idChange.oldId in jstype.meta._pool) ?
							this._translator.reverse(idChange.type, serverOldId) :
							idChange.oldId;

					// If the client recognizes the old id then this is an object we have seen before
					if (clientOldId) {
						var type = this.model.type(idChange.type);

						// Attempt to load the object whos id is changing.
						var obj = type.get(
							// Load the object using the object's id prior to saving.
							clientOldId,

							// When processing server-side changes we can expect that the type of the instance
							// is exactly the type specified in the change object, not a base type. 
							true
						);

						// Ensure that the object exists.
						if (!obj) {
							throw new Error($format(
								"Unable to change id for object of type \"{0}\" from \"{1}\" to \"{2}\" since the object could not be found.",
								jstype.meta.get_fullName(), idChange.oldId, idChange.newId));
						}

						// Change the id and make non-new.
						type.changeObjectId(clientOldId, idChange.newId);
						Observer.setValue(obj.meta, "isNew", false);

						// Update affected scope queries
						this._scopeQueries.forEach(function (query) {
							query.ids = query.ids.map(function (id) {
								return (id === clientOldId) ? idChange.newId : id;
							}, this);
						}, this);

						// Update post-save changes with new id
						function fixChangeInstanceDueToIdChange(inst) {
							if (inst) {
								var jstype = Model.getJsType(inst.type, true);
								if (jstype && obj === fromExoModel(inst, this._translator)) {
									inst.id = idChange.newId;
									inst.isNew = false;
								}
							}
						}

						this._changeLog.sets.forEach(function (set) {
							set.changes.forEach(function (change) {
								// Only process changes to model instances
								if (!change.instance) return;

								fixChangeInstanceDueToIdChange.call(this, change.instance);

								// For list changes additionally check added and removed objects.
								if (change.type === "ListChange") {
									// get the jsType of the object that contains the list
									var jsType = Model.getJsType(change.instance.type, true);

									if (jsType) {
										if (jsType.meta.property(change.property).get_isEntityListType()) {
											if (change.added.length > 0)
												change.added.forEach(fixChangeInstanceDueToIdChange, this);
											if (change.removed.length > 0)
												change.removed.forEach(fixChangeInstanceDueToIdChange, this);
										}
									}
								}
								// For reference changes additionally check oldValue/newValue
								else if (change.type === "ReferenceChange") {
									fixChangeInstanceDueToIdChange.call(this, change.oldValue);
									fixChangeInstanceDueToIdChange.call(this, change.newValue);
								}
							}, this);
						}, this);
					}
					// Otherwise, log an error.
					else {
						logWarning($format("Cannot apply id change on type \"{0}\" since old id \"{1}\" was not found.", idChange.type, idChange.oldId));
					}
				}, after), this);
			}, this);

			// Callback immediately since nothing will be force loaded
			if (callback) {
				callback.call(thisPtr || this);
			}
		},
		applyInitChange: function (change, before, after, callback, thisPtr) {
			tryGetJsType(this.model, change.instance.type, null, false, this.ignoreChanges(before, function (jstype) {

				// Attempt to fetch the object in case it has already been created.
				var newObj = jstype.meta.get(
					// Since the object is being newly created, we can use the server-generated id.
					change.instance.id,

					// When processing server-side changes we can expect that the type of the instance
					// is exactly the type specified in the change object, not a base type. 
					true
				);

				if (!newObj) {
					// Check for a translation between the old id that was reported and an actual old id.  This is
					// needed since new objects that are created on the server and then committed will result in an accurate
					// id change record, but "instance.id" for this change will actually be the persisted id.
					var serverOldId = this._translator.forward(change.instance.type, change.instance.id) || change.instance.id;

					lazyCreateEntity(change.instance.type, serverOldId, this.ignoreChanges(before, function () {
						// Create the new object (supress events)
						newObj = new jstype(null, null, true);

						// Remember the object's client-generated new id and the corresponding server-generated new id
						this._translator.add(change.instance.type, newObj.meta.id, serverOldId);

						// Raise event after recording id mapping so that listeners can leverage it
						this.model.notifyObjectRegistered(newObj);

						return newObj;
					}, after), this);
				}
			}, after), this);

			// Callback immediately since nothing will be force loaded
			if (callback) {
				callback.call(thisPtr || this);
			}
		},
		applyRefChange: function (change, before, after, callback, thisPtr) {
			var hasExited = false;
			var callBeforeExiting = true;

			tryGetJsType(this.model, change.instance.type, change.property, false, function (srcType) {
				tryGetEntity(this.model, this._translator, srcType, change.instance.id, null, LazyLoadEnum.None, this.ignoreChanges(before, function (srcObj) {
					// Update change to reflect the object's new id
					ServerSync$retroactivelyFixChangeWhereIdChanged(change.instance, srcObj);

					// Cache the property since it is not a simple property access.
					var property = srcObj.meta.property(change.property);
					if (!property) {
						throw new Error("Property \"" + change.property + "\" could not be found on type \"" + srcType.meta.get_fullName() + "\".");
					}

					// Apply change
					if (change.newValue) {
						// Don't call immediately since we may need to lazy load the type
						if (!hasExited) {
							callBeforeExiting = false;
						}

						tryGetJsType(this.model, change.newValue.type, null, true, this.ignoreChanges(before, function (refType) {
							tryGetEntity(this.model, this._translator, refType, change.newValue.id, null, LazyLoadEnum.Lazy, this.ignoreChanges(before, function (refObj) {
								// Update change to reflect the object's new id
								ServerSync$retroactivelyFixChangeWhereIdChanged(change.newValue, refObj);

								// Update change to reflect the object's new id
								if (change.newValue.id === refObj.meta.legacyId) {
									change.newValue.id = refObj.meta.id;
								}

								// Manually ensure a property value, if it doesn't have one then it will be marked as pendingInit
								Property$_ensureInited.call(property, srcObj);

								// Mark the property as no longer pending init since its value is being established
								srcObj.meta.pendingInit(property, false);

								// Set the property value
								Observer.setValue(srcObj, change.property, refObj);

								// Callback once the type has been loaded
								if (!callBeforeExiting && callback) {
									callback.call(thisPtr || this);
								}
							}, after), this);
						}, after), this);
					}
					else {
						// Manually ensure a property value, if it doesn't have one then it will be marked as pendingInit
						Property$_ensureInited.call(property, srcObj);

						// Mark the property as no longer pending init since its value is being established
						srcObj.meta.pendingInit(property, false);

						// Set the property value
						Observer.setValue(srcObj, change.property, null);
					}

					// Update oldValue's id in change object
					if (change.oldValue) {
						tryGetJsType(this.model, change.oldValue.type, null, true, this.ignoreChanges(before, function (refType) {
							// Update change to reflect the object's new id
							var refObj = fromExoModel(change.oldValue, this._translator, true);
							ServerSync$retroactivelyFixChangeWhereIdChanged(change.oldValue, refObj);
						}, after), this);
					}
				}, after), this);
			}, this);

			// Callback immediately since nothing will be force loaded...yet
			if (callBeforeExiting && callback) {
				callback.call(thisPtr || this);
			}

			hasExited = true;
		},
		applyValChange: function (change, before, after, callback, thisPtr) {
			tryGetJsType(this.model, change.instance.type, change.property, false, function (srcType) {
				tryGetEntity(this.model, this._translator, srcType, change.instance.id, null, LazyLoadEnum.None, this.ignoreChanges(before, function (srcObj) {
					// Update change to reflect the object's new id
					ServerSync$retroactivelyFixChangeWhereIdChanged(change.instance, srcObj);

					// Cache the new value, becuase we access it many times and also it may be modified below
					// to account for timezone differences, but we don't want to modify the actual change object.
					var newValue = change.newValue;

					// Cache the property since it is not a simple property access.
					var property = srcObj.meta.property(change.property);
					if (!property) {
						throw new Error("Property \"" + change.property + "\" could not be found on type \"" + srcType.meta.get_fullName() + "\".");
					}

					if (property.get_jstype() === Date && newValue && newValue.constructor == String && newValue.length > 0) {

						// Convert from string (e.g.: "2011-07-28T06:00:00.000Z") to date.
						dateRegex.lastIndex = 0;
						newValue = new Date(newValue.replace(dateRegex, dateRegexReplace));

						//now that we have the value set for the date.
						//if the underlying property datatype is actually a date and not a datetime
						//then we need to add the local timezone offset to make sure that the date is displayed acurately.
						if (property.get_format() && !hasTimeFormat.test(property.get_format().toString())) {
							var serverOffset = this.get_ServerTimezoneOffset();
							var localOffset = -(new Date().getTimezoneOffset() / 60);
							newValue = newValue.addHours(serverOffset - localOffset);
						}
					}
					else if (newValue && newValue instanceof TimeSpan) {
						newValue = newValue.toObject();
					}

					// Manually ensure a property value, if it doesn't have one then it will be marked as pendingInit
					Property$_ensureInited.call(property, srcObj);

					// Mark the property as no longer pending init since its value is being established
					srcObj.meta.pendingInit(property, false);

					// Set the property value
					Observer.setValue(srcObj, change.property, newValue);
				}, after), this);
			}, this);

			// Callback immediately since nothing will be force loaded
			if (callback) {
				callback.call(thisPtr || this);
			}
		},
		applyListChange: function (change, before, after, callback, thisPtr) {
			var hasExited = false;
			var callBeforeExiting = true;

			tryGetJsType(this.model, change.instance.type, change.property, false, function (srcType) {
				tryGetEntity(this.model, this._translator, srcType, change.instance.id, change.property, LazyLoadEnum.None, this.ignoreChanges(before, function (srcObj) {
					// Update change to reflect the object's new id
					ServerSync$retroactivelyFixChangeWhereIdChanged(change.instance, srcObj);

					var property = srcObj.meta.property(change.property);
					if (!property) {
						throw new Error("Property \"" + change.property + "\" could not be found on type \"" + srcType.meta.get_fullName() + "\".");
					}

					var isEntityList = property.get_isEntityListType();
					var list = property.value(srcObj);

					list.beginUpdate();

					var listSignal = new ExoWeb.Signal("applyListChange-items");

					// apply added items
					if (change.added.length > 0) {
						// Don't call immediately since we may need to lazy load the type
						if (!hasExited) {
							callBeforeExiting = false;
						}

						// Add each item to the list after ensuring that the type is loaded
						change.added.forEach(function (item) {
							if (isEntityList) {
								tryGetJsType(this.model, item.type, null, true, listSignal.pending(this.ignoreChanges(before, function (itemType) {
									tryGetEntity(this.model, this._translator, itemType, item.id, null, LazyLoadEnum.Lazy, this.ignoreChanges(before, function (itemObj) {
										// Update change to reflect the object's new id
										ServerSync$retroactivelyFixChangeWhereIdChanged(item, itemObj);

										if (!list.contains(itemObj)) {
											ListLazyLoader.allowModification(list, function () {
												list.add(itemObj);
											});
										}
									}, after), this);
								}, after)), this, true);
							} else {
								ListLazyLoader.allowModification(list, function () {
									list.add(item);
								});
							}
						}, this);
					}

					// apply removed items
					change.removed.forEach(function (item) {
						if (isEntityList) {
							// no need to load instance only to remove it from a list when it can't possibly exist
							tryGetJsType(this.model, item.type, null, false, this.ignoreChanges(before, function (itemType) {
								tryGetEntity(this.model, this._translator, itemType, item.id, null, LazyLoadEnum.Lazy, this.ignoreChanges(before, function (itemObj) {
									// Update change to reflect the object's new id
									ServerSync$retroactivelyFixChangeWhereIdChanged(item, itemObj);

									ListLazyLoader.allowModification(list, function () {
										list.remove(itemObj);
									});
								}, after), this);
							}, after), this, true);
						} else {
							ListLazyLoader.allowModification(list, function () {
								list.remove(item);
							});
						}
					}, this);

					// don't end update until the items have been loaded
					listSignal.waitForAll(this.ignoreChanges(before, function () {
						try {
							var listUpdateEnded = false;
							if (hasExited) {
								this.beginApplyingChanges();
							}
							try {
								ListLazyLoader.allowModification(list, function () {
									// Update variable first to indicate that endUpdate was at least attempted.
									// If the call to endUpdate generates an error we would not want to attempt
									// again and potentially generate a different error because of side-effects.
									listUpdateEnded = true;

									list.endUpdate();
								});
							} finally {
								if (!listUpdateEnded) {
									list.endUpdate();
								}
							}
						} finally {
							if (hasExited) {
								this.endApplyingChanges();
							}
						}

						// Callback once all instances have been added
						if (!callBeforeExiting && callback) {
							callback.call(thisPtr || this);
						}
					}, after), this, true);
				}, after), this);
			}, this);

			// Callback immediately since nothing will be force loaded...yet
			if (callBeforeExiting && callback) {
				callback.call(thisPtr || this);
			}

			hasExited = true;
		},

		// Checkpoint
		///////////////////////////////////////////////////////////////////////
		checkpoint: function ServerSync$checkpoint() {
			return this._changeLog.checkpoint();
		},

		// Rollback
		///////////////////////////////////////////////////////////////////////
		rollback: function ServerSync$rollback(checkpoint, callback, thisPtr) {
			var signal = new Signal("rollback");
			var waitForAllRegistered = false;

			try {
				var batch = ExoWeb.Batch.start("rollback changes");

				this.beginApplyingChanges();

				var change = this._changeLog.undo();
				while (change && !(change.type === "Checkpoint" && change.code === checkpoint)) {
					if (change.type == "InitNew") {
						this.rollbackInitChange(change, signal.pending());
					}
					else if (change.type == "ReferenceChange") {
						this.rollbackRefChange(change, signal.pending());
					}
					else if (change.type == "ValueChange") {
						this.rollbackValChange(change, signal.pending());
					}
					else if (change.type == "ListChange") {
						this.rollbackListChange(change, signal.pending());
					}

					change = this._changeLog.undo();
				}

				waitForAllRegistered = true;
				signal.waitForAll(function () {
					this.endApplyingChanges();
					ExoWeb.Batch.end(batch);
					if (callback) {
						callback.call(thisPtr || this);
					}
					this._raiseEvent("changesDetected", [this, { reason: "rollback" }]);
				}, this, true);
			}
			finally {
				// the signal was not registered, therefore we need to handle endApplyingChanges call here
				if (!waitForAllRegistered) {
					this.endApplyingChanges();
					ExoWeb.Batch.end(batch);
				}
			}
		},
		rollbackValChange: function ServerSync$rollbackValChange(change, callback, thisPtr) {
			tryGetJsType(this.model, change.instance.type, change.property, false, function (srcType) {
				tryGetEntity(this.model, this._translator, srcType, change.instance.id, null, LazyLoadEnum.None, function (srcObj) {

					// Cache the new value, becuase we access it many times and also it may be modified below
					// to account for timezone differences, but we don't want to modify the actual change object.
					var oldValue = change.oldValue;

					// Cache the property since it is not a simple property access.
					var property = srcObj.meta.property(change.property);
					if (!property) {
						throw new Error("Property \"" + change.property + "\" could not be found on type \"" + srcType.meta.get_fullName() + "\".");
					}

					if (property.get_jstype() === Date && oldValue && oldValue.constructor == String && oldValue.length > 0) {

						// Convert from string (e.g.: "2011-07-28T06:00:00.000Z") to date.
						dateRegex.lastIndex = 0;
						oldValue = new Date(oldValue.replace(dateRegex, dateRegexReplace));

						//now that we have the value set for the date.
						//if the underlying property datatype is actually a date and not a datetime
						//then we need to add the local timezone offset to make sure that the date is displayed acurately.
						if (property.get_format() && !hasTimeFormat.test(property.get_format().toString())) {
							var serverOffset = this.get_ServerTimezoneOffset();
							var localOffset = -(new Date().getTimezoneOffset() / 60);
							oldValue = oldValue.addHours(serverOffset - localOffset);
						}
					}
					else if (oldValue && oldValue instanceof TimeSpan) {
						oldValue = oldValue.toObject();
					}

					// Set the property value
					Observer.setValue(srcObj, change.property, oldValue);
				}, this);
			}, this);

			// Callback immediately since nothing will be force loaded
			if (callback) {
				callback.call(thisPtr || this);
			}
		},
		rollbackRefChange: function ServerSync$rollbackRefChange(change, callback, thisPtr) {
			var hasExited = false;
			var callBeforeExiting = true;

			tryGetJsType(this.model, change.instance.type, change.property, false, function (srcType) {
				tryGetEntity(this.model, this._translator, srcType, change.instance.id, null, LazyLoadEnum.None, function (srcObj) {
					if (change.oldValue) {
						// Don't call immediately since we may need to lazy load the type
						if (!hasExited) {
							callBeforeExiting = false;
						}

						tryGetJsType(this.model, change.oldValue.type, null, true, function (refType) {
							tryGetEntity(this.model, this._translator, refType, change.oldValue.id, null, LazyLoadEnum.None, function (refObj) {
								Observer.setValue(srcObj, change.property, refObj);

								// Callback once the type has been loaded
								if (!callBeforeExiting && callback) {
									callback.call(thisPtr || this);
								}
							}, this);
						}, this);
					}
					else {
						Observer.setValue(srcObj, change.property, null);
					}
				}, this);
			}, this);

			// Callback immediately since nothing will be force loaded...yet
			if (callBeforeExiting && callback) {
				callback.call(thisPtr || this);
			}

			hasExited = true;
		},
		rollbackInitChange: function ServerSync$rollbackInitChange(change, callback, thisPtr) {
			//TODO: need to remove from the translator
			if (callback) {
				callback.call(thisPtr || this);
			}
		},
		rollbackListChange: function ServerSync$rollbackListChange(change, callback, thisPtr) {
			var hasExited = false;
			var callBeforeExiting = true;

			tryGetJsType(this.model, change.instance.type, change.property, false, function (srcType) {
				tryGetEntity(this.model, this._translator, srcType, change.instance.id, change.property, LazyLoadEnum.None, function (srcObj) {
					var property = srcObj.meta.property(change.property);
					if (!property) {
						throw new Error("Property \"" + change.property + "\" could not be found on type \"" + srcType.meta.get_fullName() + "\".");
					}

					var isEntityList = property.get_isEntityListType();
					var list = property.value(srcObj);
					var translator = this._translator;

					list.beginUpdate();

					var listSignal = new ExoWeb.Signal("rollbackListChange-items");

					// Rollback added items
					change.added.forEach(function rollbackListChanges$added(item) {
						if (isEntityList) {
							tryGetJsType(this.model, item.type, null, false, function (itemType) {
								var childObj = fromExoModel(item, translator);
								if (childObj) {
									list.remove(childObj);
								}
							}, this);
						} else {
							list.remove(item);
						}
					}, this);

					// Rollback removed items
					if (change.removed.length > 0) {
						// Don't call immediately since we may need to lazy load the type
						if (!hasExited) {
							callBeforeExiting = false;
						}

						change.removed.forEach(function rollbackListChanges$added(item) {
							if (isEntityList) {
								tryGetJsType(this.model, item.type, null, true, listSignal.pending(function (itemType) {
									var childObj = fromExoModel(item, translator, true);
									list.add(childObj);
								}, this, true), this);
							} else {
								list.add(item);
							}
						}, this);
					}

					// don't end update until the items have been loaded
					listSignal.waitForAll(function () {
						if (hasExited) {
							this.beginApplyingChanges();
						}
						ListLazyLoader.allowModification(list, function () {
							list.endUpdate();
						});
						if (hasExited) {
							this.endApplyingChanges();
						}
						// Callback once all instances have been added
						if (!callBeforeExiting && callback) {
							callback.call(thisPtr || this);
						}
					}, this);
				}, this);
			}, this);

			// Callback immediately since nothing will be force loaded...yet
			if (callBeforeExiting && callback) {
				callback.call(thisPtr || this);
			}

			hasExited = true;
		},

		// Various
		///////////////////////////////////////////////////////////////////////
		addChangesDetected: function (handler) {
			this._addEvent("changesDetected", handler);
		},
		batchChanges: function (description, callback, thisPtr) {
			// Remove empty batches if a descriptive title or user is not specified.
			// If a title or user is specified then it may be desireable to keep it for diagnostic purposes.
			var removeIfEmpty = !description && !this._localUser;

			this._changeLog.batchChanges(description, this._localUser, thisPtr ? callback.bind(thisPtr) : callback, removeIfEmpty);
		},
		changes: function ServerSync$changes(includeAllChanges, simulateInitRoot, excludeNonPersisted) {
			var list = [];
			var sets = serializeChanges.call(this, includeAllChanges, simulateInitRoot);
			sets.forEach(function (set) {
				if (excludeNonPersisted) {
					list.addRange(set.changes.filter(isPropertyChangePersisted));
				}
				else {
					list.addRange(set.changes);
				}
			});
			return list;
		},
		get_ServerTimezoneOffset: function ServerSync$get_ServerTimezoneOffset() {
			//if we have not set the server timezone offset yet, retrieve it from the server
			var timezoneOffset = 0;

			if (this._serverInfo !== null) {
				timezoneOffset = this._serverInfo.TimeZoneOffset;
			}

			return timezoneOffset;
		},
		set_ServerInfo: function ServerSync$set_ServerTimezoneOffset(newInfo) {
			//join the new server info with the information that you are adding.
			this._serverInfo = this._serverInfo ? jQuery.extend(this._serverInfo, newInfo) : newInfo;
		},
		get_localUser: function ServerSync$get_localUser(user) {
			return this._localUser;
		},
		set_localUser: function ServerSync$set_localUser(user) {
			this._localUser = user;
		}
	});

	Property.prototype.triggersRoundtrip = function (paths) {
		this.addChanged(function (sender) {
			if (!context.server.isApplyingChanges()) {
				EventScope$onExit(function() {
					setTimeout(function () {
						sender.meta.type.model.server.roundtrip(sender, paths);
					}, 100);
				});
			}
		});
	};

	// #endregion

	// #region ExoWeb.Mapper.Internals
	//////////////////////////////////////////////////

	var STATIC_ID = "static";
	var dateRegex = /^(\d{4})-(\d{2})-(\d{2})T(\d{2})\:(\d{2})\:(\d{2})(\.\d{3})?Z$/g;
	var dateRegexReplace = "$2/$3/$1 $4:$5:$6 GMT";
	var hasTimeFormat = /[hHmts]/;

	function ensureJsType(model, typeName, callback, thisPtr) {
		var mtype = model.type(typeName);

		if (!mtype) {
			fetchTypes(model, [typeName], function(jstype) {
				callback.call(thisPtr || this, jstype);
			});
		}
		else if (LazyLoader.isRegistered(mtype)) {
			LazyLoader.load(mtype, null, false, function(jstype) {
				callback.apply(thisPtr || this, [jstype]);
			});
		}
		else {
			callback.apply(thisPtr || this, [mtype.get_jstype()]);
		}
	}

	function conditionsFromJson(model, conditionsJson, forInstances, callback, thisPtr) {

		for (var conditionCode in conditionsJson) {
			conditionFromJson(model, forInstances, conditionCode, conditionsJson[conditionCode]);
		}

		if (callback && callback instanceof Function) {
			callback.call(thisPtr || this);
		}
	}

	function conditionFromJson(model, forInstances, conditionCode, conditionsJson) {
		var conditionType = ExoWeb.Model.ConditionType.get(conditionCode);

		if (!conditionType) {
			logWarning("A condition type with code \"" + conditionCode + "\" could not be found.");
			return;
		}

		var serverSync = model.server;

		// process each condition
		if (forInstances) {
			conditionsJson.forEach(function (conditionJson) {
				var rootTarget = conditionJson.targets[0];
				if (rootTarget) {
					tryGetJsType(serverSync.model, rootTarget.instance.type, null, false, function (jstype) {
						tryGetEntity(serverSync.model, serverSync._translator, jstype, rootTarget.instance.id, null, LazyLoadEnum.None, function (rootTargetInstance) {
							if (forInstances.indexOf(rootTargetInstance) >= 0) {
								conditionTargetsFromJson(model, conditionType, conditionJson.message, conditionJson.targets);
							}
						});
					});
				}
			});
		}
		else {
			conditionsJson.forEach(function (conditionJson) {
				conditionTargetsFromJson(model, conditionType, conditionJson.message, conditionJson.targets);
			});
		}
	}

	function conditionTargetsFromJson(model, conditionType, message, targetsJson) {
		var condition = new Condition(conditionType, message, null, null, "server");

		var serverSync = model.server;

		// process each condition target
		targetsJson.forEach(function (target) {
			tryGetJsType(serverSync.model, target.instance.type, null, false, function (jstype) {
				tryGetEntity(serverSync.model, serverSync._translator, jstype, target.instance.id, null, LazyLoadEnum.None, function (instance) {
					condition.targets.push(new ConditionTarget(condition, instance, target.properties.map(function (p) { return jstype.meta.property(p); })));
				});
			});
		});
	}

	function objectsFromJson(model, json, callback, thisPtr) {
		var signal = new ExoWeb.Signal("objectsFromJson");
		var objectsLoaded = [];
		for (var typeName in json) {
			var poolJson = json[typeName];
			for (var id in poolJson) {
				// locate the object's state in the json
				objectFromJson(model, typeName, id, poolJson[id], signal.pending(function (obj) {
					if (obj) {
						objectsLoaded.push(obj);
					}
				}), thisPtr);
			}
		}

		signal.waitForAll(function() {
			callback.call(thisPtr || this, objectsLoaded);
		});
	}

	function objectFromJson(model, typeName, id, json, callback, thisPtr) {
		// get the object to load
		var obj;

		// family-qualified type name is not available so can't use getType()
		var mtype = model.type(typeName);

		// if this type has never been seen, go and fetch it and resume later
		if (!mtype) {
			fetchTypes(model, [typeName], function () {
				objectFromJson(model, typeName, id, json, callback);
			});
			return;
		}

		// Load object's type if needed
		if (LazyLoader.isRegistered(mtype)) {
			LazyLoader.load(mtype, null, false, function() {
				objectFromJson(model, typeName, id, json, callback, thisPtr);
			});
			return;
		}

		// get target object to load
		if (id === STATIC_ID) {
			obj = null;
		}
		else {
			obj = getObject(model, typeName, id, null, true);
		}

		var loadedObj;

		var initObj = false;
		if (id === STATIC_ID) {
			initObj = true;
		} else if (obj) {
			if (LazyLoader.isRegistered(obj)) {
				initObj = true;
				// track the newly loaded instance to pass to the caller when complete
				loadedObj = obj;
				// unregister the instance from loading
				ObjectLazyLoader.unregister(obj);
			}
			if (obj.wasGhosted) {
				initObj = true;
				// track the newly loaded instance to pass to the caller when complete
				loadedObj = obj;
				delete obj.wasGhosted;
			}
		}

		// Continue if the object needs to be initialized (ghosted or lazy loaded),
		// or there is no object (load static lists), or the object is not new (load
		// non-loaded list properties for an object that was previously loaded).
		if (initObj || !obj || !obj.meta.isNew) {
			var loadedProperties = [];

			// Load object's properties
			for (var t = mtype; t !== null; t = obj ? t.baseType : null) {
				var props = obj ? t.get_instanceProperties() : t.get_staticProperties();

				for (var propName in props) {
					if (loadedProperties.indexOf(propName) >= 0) {
						continue;
					}

					loadedProperties.push(propName);

					var prop = props[propName];

					if (!prop) {
						throw new Error($format("Cannot load object {0}|{2} because it has an unexpected property '{1}'", typeName, propName, id));
					}

					if (prop.get_origin() !== "server") {
						continue;
					}

					if (!initObj && !prop.get_isList()) {
						// If the root object is already initialized, then skip over non-list properties.
						continue;
					}

					var propData;

					// instance fields have indexes, static fields use names
					if (obj) {
						propData = json[prop.get_index()];
					} else {
						propData = json[propName];

						// not all static fields may be present
						if (propData === undefined) {
							continue;
						}
					}

					if (propData !== null) {
						var propType = prop.get_jstype();

						// Always process list properties since they can be loaded after the parent object.
						if (prop.get_isList()) {
							var list = prop.get_isStatic() ? prop.value() : obj[prop._fieldName];

							if (propData == "?") {
								// don't overwrite list if its already a ghost
								if (!list) {
									list = ListLazyLoader.register(obj, prop);
									Property$_init.call(prop, obj, list, false);
								}
							} else {
								if (!list || LazyLoader.isRegistered(list)) {

									var doingObjectInit = undefined;
									//var newItems = [];

									// json has list members
									if (list) {
										ListLazyLoader.unregister(list);
										doingObjectInit = false;
									} else {
										list = [];
										doingObjectInit = true;
									}

									for (var i = 0; i < propData.length; i++) {
										var ref = propData[i];
										var c = getObject(model, propType, (ref && ref.id || ref), (ref && ref.type || propType));
										if (list.contains(c)) {
											logWarning($format("Initializing list {0}|{1}.{2} already contains object {3}.", typeName, id, prop._name, Entity.toIdString(c)));
										}
										//newItems.push(c);
										list.push(c);
									}

									if (doingObjectInit) {
										Property$_init.call(prop, obj, list);
									} else {
										// Collection change driven by user action or other behavior would result in the "change" event
										// being raised for the list property.  Since we don't want to record this as a true observable
										// change, raise the event manually so that rules will still run as needed.
										//if (obj) {
										prop._raiseEvent("changed", [obj, { property: prop, newValue: list, oldValue: undefined, collectionChanged: true }]);
										//}

										// Example of explicitly raising the collection change event if needed.
										// NOTE: This is probably not necessary because it is difficult to get a reference to a
										// non-loaded list and so nothing would be watching for changes prior to loading completion.
										// The _initializing flag would be necessary to signal to the property's collection change
										// handler that it should not raise the various events in response to the collection change.
										//list._initializing = true;
										//Sys.Observer.raiseCollectionChanged(list, [new Sys.CollectionChange(Sys.NotifyCollectionChangedAction.add, newItems, 0)]);
										//delete list._initializing;
									}
								}
							}
						} else if (initObj) {
							var ctor = prop.get_jstype(true);

							// assume if ctor is not found its a model type not an intrinsic
							if (!ctor || ctor.meta) {
								Property$_init.call(prop, obj, getObject(model, propType, (propData && propData.id || propData), (propData && propData.type || propType)));
							} else {
								// Coerce strings into dates
								if (ctor == Date && propData && propData.constructor == String && propData.length > 0) {

									// Convert from string (e.g.: "2011-07-28T06:00:00.000Z") to date.
									dateRegex.lastIndex = 0;
									propData = new Date(propData.replace(dateRegex, dateRegexReplace));

									//now that we have the value set for the date.
									//if the underlying property datatype is actually a date and not a datetime
									//then we need to add the local timezone offset to make sure that the date is displayed acurately.
									if (prop.get_format() && !hasTimeFormat.test(prop.get_format().toString())) {
										var serverOffset = model.server.get_ServerTimezoneOffset();
										var localOffset = -(new Date().getTimezoneOffset() / 60);
										propData = propData.addHours(serverOffset - localOffset);
									}
								} else if (ctor === TimeSpan) {
									propData = new TimeSpan(propData.TotalMilliseconds);
								}
								Property$_init.call(prop, obj, propData);
							}
						}
					} else if (initObj) {
						Property$_init.call(prop, obj, null);
					}
				}
			}
		}

		if (callback && callback instanceof Function) {
			callback.call(thisPtr || this, loadedObj);
		}
	}

	function typesFromJson(model, json, onTypeLoadSuccess, onTypeLoadFailure) {
		for (var typeName in json) {
			var typeJson = json[typeName];
			if (typeJson === null) {
				if (onTypeLoadFailure) {
					onTypeLoadFailure(typeName, null);
				}
			} else {
				typeFromJson(model, typeName, typeJson);
				if (onTypeLoadSuccess) {
					onTypeLoadSuccess(typeName, typeJson);
				}
			}
		}
	}

	function typeFromJson(model, typeName, json) {
		// get model type. it may have already been created for lazy loading
		var mtype = getType(model, typeName, json.baseType);

		// set the default type format
		if (json.format) {
			mtype.set_format(getFormat(mtype.get_jstype(), json.format));
		}

		if (mtype.get_originForNewProperties() === "client") {
			throw new Error("Type \"" + mtype._fullName + "\" has already been loaded");
		}

		// store exports
		if (json.exports) {
			mtype.set_exports(json.exports);
		}

		// define properties
		for (var propName in json.properties) {
			var propJson = json.properties[propName];

			// Type
			var propType = propJson.type;
			if (propJson.type.endsWith("[]")) {
				propType = propType.toString().substring(0, propType.length - 2);
				propJson.isList = true;
			}
			propType = getJsType(model, propType);

			// Format
			var format = getFormat(propType, propJson.format);

			// Add the property
			var prop = mtype.addProperty({
				name: propName,
				type: propType,
				label: propJson.label,
				helptext: propJson.helptext,
				format: format,
				isList: propJson.isList === true,
				isStatic: propJson.isStatic === true,
				isPersisted: propJson.isPersisted !== false,
				isCalculated: propJson.isCalculated === true,
				index: propJson.index,
				defaultValue: propJson.defaultValue ? mtype.compileExpression(propJson.defaultValue) : undefined,
				constant: propJson.constant
			});
		
			// setup static properties for lazy loading
			if (propJson.isStatic && propJson.isList) {
				Property$_init.call(prop, null, ListLazyLoader.register(null, prop));
			}

			// process property specific rules, which have a specialized json syntax to improve readability and minimize type json size
			if (propJson.rules) {
				for (var rule in propJson.rules) {
					var options = propJson.rules[rule];
				
					// default the type to the rule name if not specified
					if (!options.type) {
						options.type = rule;

						// calculate the name of the rule if not specified in the json, assuming it will be unique
						if (!options.name) {
							options.name = mtype.get_fullName() + "." + prop.get_name() + "." + rule.substr(0, 1).toUpperCase() + rule.substr(1);
						}
					}

					// initialize the name of the rule if not specified in the json
					else if (!options.name) {
						options.name = rule;
					}

					options.property = prop;
					ruleFromJson(mtype, options);
				}
			}
		}

		// ensure all properties added from now on are considered client properties
		mtype.set_originForNewProperties("client");

		// define methods
		for (var methodName in json.methods) {
			var methodJson = json.methods[methodName];
			mtype.addMethod({ name: methodName, parameters: methodJson.parameters, isStatic: methodJson.isStatic });
		}

		// define condition types
		if (json.conditionTypes)
			conditionTypesFromJson(model, mtype, json.conditionTypes);

		// define rules 
		if (json.rules) {
			for (var i = 0; i < json.rules.length; ++i) {
				ruleFromJson(mtype, json.rules[i]);
			}
		}

	}

	function conditionTypesFromJson(model, mtype, json) {
		json.forEach(function (ctype) {
			conditionTypeFromJson(mtype, ctype);
		});
	}

	function conditionTypeFromJson(mtype, json) {

		// for rules that assert a single condition, the code will be the unique name of the rule
		json.code = json.code || json.name;

		// attempt to retrieve the condition type by code.
		var conditionType = ExoWeb.Model.ConditionType.get(json.code);

		// create the condition type if it does not already exist.
		if (!conditionType) {

			// get a list of condition type sets for this type.
			var sets = !json.sets ? [] : json.sets.map(function(name) {
				var set = ExoWeb.Model.ConditionTypeSet.get(name);
				if (!set) {
					set = new ExoWeb.Model.ConditionTypeSet(name);
				}
				return set;
			});

			// create the appropriate condition type based on the category.
			if (!json.category || json.category == "Error") {
				conditionType = new ExoWeb.Model.ConditionType.Error(json.code, json.message, sets, "server");
			}
			else if (json.category == "Warning") {
				conditionType = new ExoWeb.Model.ConditionType.Warning(json.code, json.message, sets, "server");
			}
			else if (json.category == "Permission") {
				conditionType = new ExoWeb.Model.ConditionType.Permission(json.code, json.message, sets, json.permissionType, json.isAllowed, "server");
			}
			else {
				conditionType = new ExoWeb.Model.ConditionType(json.code, json.category, json.message, sets, "server");
			}

			// account for the potential for subclasses to be serialized with additional properties.
			conditionType.extend(json);
		}

		if (json.rule && json.rule.hasOwnProperty("type")) {
			conditionType.rules.push(ruleFromJson(mtype, json.rule, conditionType));
		}

		return conditionType;
	}

	function ruleFromJson(mtype, options) {
		var ruleType = ExoWeb.Model.Rule[options.type];
		if (options.conditionType) {
			options.conditionType = conditionTypeFromJson(mtype, options.conditionType);
		}
		else if (ruleType.prototype instanceof ConditionRule) {
			options.conditionType = conditionTypeFromJson(mtype, options);
		}
		return new ruleType(mtype, options);
	}

	function getJsType(model, typeName, forLoading) {
		// Get an array representing the type family.
		var family = typeName.split(">");

		// Try to get the js type from the window object.
		var jstype = ExoWeb.Model.Model.getJsType(family[0], true);

		// If its not defined, assume the type is a model type
		// that may eventually be fetched.
		if (jstype === undefined) {
			jstype = getType(model, null, family).get_jstype();
		}

		return jstype;
	}

	function flattenTypes(types, flattened) {
		function add(item) {
			if (flattened.indexOf(item) < 0) {
				flattened.push(item);
			}
		}

		if (types instanceof Array) {
			Array.forEach(types, add);
		}
		else if (typeof (types) === "string") {
			Array.forEach(types.split(">"), add);
		}
		else if (types) {
			add(types);
		}
	}

	// Gets a reference to a type.  IMPORTANT: typeName must be the
	// family-qualified type name (ex: Employee>Person).
	function getType(model, finalType, propType) {
		// ensure the entire type family is at least ghosted
		// so that javascript OO mechanisms work properly
		var family = [];

		flattenTypes(finalType, family);
		flattenTypes(propType, family);

		var mtype;
		var baseType;

		while (family.length > 0) {
			baseType = mtype;

			var type = family.pop();

			if (type instanceof ExoWeb.Model.Type) {
				mtype = type;
			}
			else if (type.meta) {
				mtype = type.meta;
			}
			else {
				// type is a string
				mtype = model.type(type);

				// if type doesn't exist, setup a ghost type
				if (!mtype) {
					mtype = model.addType(type, baseType, "server");
					TypeLazyLoader.register(mtype);
				}
			}
		}

		return mtype;
	}

	function getObject(model, propType, id, finalType, forLoading) {
		if (id === STATIC_ID) {
			throw new Error("Function 'getObject' can only be called for instances (id='" + id + "')");
		}

		// get model type
		var mtype = getType(model, finalType, propType);

		// Try to locate the instance by id.
		var obj = mtype.get(id,
			// If an exact type exists then it should be specified in the call to getObject.
			true);

		// If it doesn't exist, create a ghosted instance.
		if (!obj) {
			obj = new (mtype.get_jstype())(id);
			obj.wasGhosted = true;
			if (!forLoading) {
				// If the instance is not being loaded, then attach a lazy loader.
				ObjectLazyLoader.register(obj);
			}
		}

		return obj;
	}

	function onTypeLoaded(model, typeName) {
		var mtype = model.type(typeName);
		mtype.eachBaseType(function(mtype) {
			if (!LazyLoader.isLoaded(mtype)) {
				throw new Error("Base type " + mtype._fullName + " is not loaded.");
			}
		});
		TypeLazyLoader.unregister(mtype);
		raiseExtensions(mtype);
		return mtype;
	}

	///////////////////////////////////////////////////////////////////////////////
	function fetchTypesImpl(model, typeNames, callback, thisPtr) {
		var signal = new ExoWeb.Signal("fetchTypes(" + typeNames.join(",") + ")");
		signal.pending();

		var typesPending = typeNames.copy(), typesLoaded = [];

		function typesFetched(success, types, otherTypes) {
			var baseTypesToFetch = [], loadedTypes = [], baseTypeDependencies = {}, loadableTypes = [];

			if (success) {
				typesFromJson(model, types, null, function (typeName) {
					// Remove types that failed to load
					typesPending.remove(typeName);
				});

				// Update types that have been loaded.  This needs to be persisted since
				// this function can recurse and arguments are not persisted.
				eachProp(types, function(prop) { typesLoaded.push(prop); });
				if (otherTypes) {
					eachProp(otherTypes, function(prop) { typesLoaded.push(prop); });
				}

				// Extract the types that can be loaded since they have no pending base types
				purge(typesPending, function(typeName) {
					var mtype, pendingBaseType = false;

					// In the absense of recursion this will be equivalent to enumerating
					// the properties of the "types" and "otherTypes" arguments.
					if (typesLoaded.contains(typeName)) {
						mtype = model.type(typeName);
						if (mtype) {
							if (LazyLoader.isLoaded(mtype)) {
								loadedTypes.push(mtype._fullName);
							}
							else {
								// find base types that are not loaded
								mtype.eachBaseType(function(baseType) {
									// Don't raise the loaded event until the base types are marked as loaded (or about to be marked as loaded in this pass)
									if (!LazyLoader.isLoaded(baseType)) {
										// Base type will be loaded in this pass
										if (typesLoaded.contains(baseType._fullName)) {
											if (baseTypeDependencies.hasOwnProperty(typeName)) {
												baseTypeDependencies[typeName].splice(0, 0, baseType._fullName);
											}
											else {
												baseTypeDependencies[typeName] = [baseType._fullName];
											}
										}
										else {
											pendingBaseType = true;
											if (!baseTypesToFetch.contains(baseType._fullName) && !typesPending.contains(baseType._fullName)) {
												baseTypesToFetch.push(baseType._fullName);
											}
										}
									}
								});

								if (!pendingBaseType) {
									loadableTypes.push(typeName);
									return true;
								}
							}
						}
					}
				});

				// Remove types that have already been marked as loaded
				loadedTypes.forEach(function(typeName) {
					typesPending.remove(typeName);
				});

				// Raise loaded event on types that can be marked as loaded
				while(loadableTypes.length > 0) {
					var typeName = loadableTypes.dequeue();
					if (baseTypeDependencies.hasOwnProperty(typeName)) {
						// Remove dependencies from array and map
						var deps = baseTypeDependencies[typeName];
						delete baseTypeDependencies[typeName];
						deps.forEach(function(t) {
							loadableTypes.remove(t);
							delete baseTypeDependencies[t];
						});

						// Splice the types back into the beginning of the array in the correct order.
						var spliceArgs = deps;
						spliceArgs.push(typeName);
						spliceArgs.splice(0, 0, 0, 0);
						Array.prototype.splice.apply(loadableTypes, spliceArgs);
					}
					else {
						typesPending.remove(typeName);
						onTypeLoaded(model, typeName);
					}
				}

				// Fetch any pending base types
				if (baseTypesToFetch.length > 0) {
					// TODO: need to notify dontDoubleUp that these types are
					// now part of the partitioned argument for the call.
					typesPending.addRange(baseTypesToFetch);

					// Make a recursive request for base types.
					typeProvider(baseTypesToFetch, typesFetched);
				}
				else if (typesPending.length === 0 && signal.isActive()) {
					// COMPLETE!!!
					signal.oneDone();
				}
			}
			// Handle an error response.  Loading should
			// *NOT* continue as if the type is available.
			else {
				throw new Error($format("Failed to load {0} (HTTP: {1}, Timeout: {2})", typeNames.join(","), types._statusCode, types._timedOut));
			}
		}

		// request the types
		typeProvider(typeNames, typesFetched);

		signal.waitForAll(function() {
			if (callback && callback instanceof Function) {
				var jstypes = typeNames.map(function (typeName) {
					var mtype = model.type(typeName);
					return mtype ? mtype.get_jstype() : null;
				});
				callback.apply(thisPtr || this, jstypes);
			}
		});
	}

	function moveTypeResults(originalArgs, invocationArgs, callbackArgs) {
		// Replace all elements of the callback args array with the types that were requested
		var spliceArgs = [0, callbackArgs.length];
		Array.prototype.push.apply(spliceArgs, invocationArgs[1].map(function(typeName) {
			var mtype = invocationArgs[0].type(typeName);
			return mtype ? mtype.get_jstype() : null;
		}));
		Array.prototype.splice.apply(callbackArgs, spliceArgs);
	}

	var fetchTypes = fetchTypesImpl.dontDoubleUp({ callbackArg: 2, thisPtrArg: 3, partitionedArg: 1, partitionedFilter: moveTypeResults });

	// fetches model paths and calls success or fail based on the outcome
	function fetchPathTypes(model, jstype, path, success, fail) {
		var step = path.steps.dequeue();
		var removedSteps = [step];
		while (step) {
			// locate property definition in model
			var prop = jstype.meta.property(step.property);

			if (!prop) {
				var args = [0, 0];
				Array.prototype.push.apply(args, removedSteps);
				Array.prototype.splice.apply(path.steps, args);
				fail("Could not find property \"" + step.property + "\" on type \"" + jstype.meta.get_fullName() + "\".");
				return;
			}

			// don't need to fetch type information for value types
			if (prop.get_isValueType()) {
				break;
			}

			// Load the type of the property if its not yet loaded
			var mtype;
			if (step.cast) {
				mtype = model.type(step.cast);

				// if this type has never been seen, go and fetch it and resume later
				if (!mtype) {
					Array.insert(path.steps, 0, step);
					fetchTypes(model, [step.cast], function () {
						fetchPathTypes(model, jstype, path, success, function () {
							var args = [0, 0];
							Array.prototype.push.apply(args, removedSteps);
							Array.prototype.splice.apply(path.steps, args);
							fail.apply(this, arguments);
						});
					});
					return;
				}
			}
			else {
				mtype = prop.get_jstype().meta;
			}

			// if property's type isn't load it, then fetch it
			if (!LazyLoader.isLoaded(mtype)) {
				fetchTypes(model, [mtype.get_fullName()], function (t) {
					fetchPathTypes(model, t, path, success, function () {
						var args = [0, 0];
						Array.prototype.push.apply(args, removedSteps);
						Array.prototype.splice.apply(path.steps, args);
						fail.apply(this, arguments);
					});
				});

				// path walking will resume with callback
				return;
			}

			// keep walking the path
			jstype = mtype.get_jstype();

			step = path.steps.dequeue();
			removedSteps.push(step);
		}

		// Inform the caller that the path has been successfully fetched
		success();
	}

	function fetchQueryTypes(model, typeName, paths, callback) {
		var signal = new ExoWeb.Signal("fetchTypes");

		function rootTypeLoaded(jstype) {
		
			// process all paths
			if (paths) {
				Array.forEach(paths, function (path) {

					// attempt to fetch the path
					fetchPathTypes(model, jstype, path, signal.pending(), function (err) {

						// determine if the path represents a static property if the path was not valid
						var step = null, typeName = "";
						while (path.steps.length > 1) {
							step = path.steps.dequeue();
							typeName += (typeName.length > 0 ? "." : "") + step.property;
						}

						var mtype = model.type(typeName);

						var fetchStaticPathTypes = function fetchStaticPathTypes() {
							fetchPathTypes(model, (mtype || model.type(typeName)).get_jstype(), path, signal.pending(), function () {
								throw new Error("Invalid query path \"" + path + "\" - " + err);
							});
						};

						if (!mtype) {
							// first time type has been seen, fetch it
							fetchTypes(model, [typeName], signal.pending(function (t) {
								if (!t) {
									throw new Error(err);
								}
								fetchStaticPathTypes(t);
							}));
						}
						else if (LazyLoader.isRegistered(mtype)) {
							// lazy load type and continue walking the path
							LazyLoader.load(mtype, null, false, signal.pending(fetchStaticPathTypes));
						}
						else {
							fetchStaticPathTypes();
						}

					});
				});
			}
		}

		// load root type, then load types referenced in paths
		var rootType = model.type(typeName);
		if (!rootType) {
			fetchTypes(model, [typeName], signal.pending(function(t) {
				rootTypeLoaded(t);
			}));
		}
		else if (LazyLoader.isRegistered(rootType)) {
			LazyLoader.load(rootType, null, false, signal.pending(rootTypeLoaded));
		}
		else {
			rootTypeLoaded(rootType.get_jstype());
		}

		signal.waitForAll(callback);
	}

	// Recursively searches throught the specified object and restores dates serialized as strings
	function restoreDates(value) {
		function tryRestoreDate(obj, key) {
			var val = obj[key];
			if (val && val.constructor === String && dateRegex.test(val)) {
				dateRegex.lastIndex = 0;
				obj[key] = new Date(val.replace(dateRegex, dateRegexReplace));
			}
		}

		if (value instanceof Array) {
			for (var i = 0; i < value.length; i++) {
				tryRestoreDate(value, i);
			}
		}
		else if (value instanceof Object) {
			for (var field in value) {
				if (value.hasOwnProperty(field)) {
					tryRestoreDate(value, field);
				}
			}
		}
	}

	function tryGetJsType(model, name, property, forceLoad, callback, thisPtr) {
		var jstype = ExoWeb.Model.Model.getJsType(name, true);

		if (jstype && LazyLoader.isLoaded(jstype.meta)) {
			callback.call(thisPtr || this, jstype);
		}
		else if (jstype && forceLoad) {
			LazyLoader.load(jstype.meta, property, false, callback, thisPtr);
		}
		else if (!jstype && forceLoad) {
			ensureJsType(model, name, callback, thisPtr);
		}
		else {
			$extend(name, function() {
				callback.apply(this, arguments);
			}, thisPtr);
		}
	}

	var pendingEntities = {};

	function lazyCreateEntity(type, id, callback, thisPtr) {
		var pendingForType = pendingEntities[type];
		if (!pendingForType) {
			pendingEntities[type] = pendingForType = {};
		}

		if (!pendingForType[id]) {
			pendingForType[id] = { callback: callback, thisPtr: thisPtr };
		}
	}

	var LazyLoadEnum = {
		// If the object doesn't exist, then the callback will be invoked once the object has been loaded for some other reason.
		None: 0,
		// If the object doesn't exist, then force creation and loading of the object and invoke the callback immediately.
		Force: 1,
		// If the object doesn't exist, then force creation and loading of the object and invoke the callback when loading is complete.
		ForceAndWait: 2,
		// If the object doesn't exist, then create the object and invoke the callback.
		Lazy: 3
	};

	var metaGet = Type.prototype.get;

	Type.prototype.get = function (id, exactTypeOnly, suppressLazyInit) {
		var obj = metaGet.apply(this, arguments);

		if (!obj && !suppressLazyInit) {
			// If the object doesn't exist and is pending, create it.
			var pendingForType = pendingEntities[this.get_fullName()];
			if (pendingForType) {
				var pendingForId = pendingForType[id];
				if (pendingForId) {
					obj = pendingForId.callback.call(pendingForId.thisPtr);
				}
			}
		}

		return obj;
	};

	function tryGetEntity(model, translator, type, id, property, lazyLoad, callback, thisPtr) {
		// First, attempt to retrieve an existing object.
		var obj = type.meta.get(
			// Translate to the client-side id.
			translateId(translator, type.meta.get_fullName(), id),

			// We know that tryGetEntity is only called internally and the source of the entity
			// information is always seen as server-origin and so should specify an exact type.
			true,

			// Dont' lazily create the new object if no lazy behavior is specified, i.e. the caller doesn't want to force the object to exist.
			lazyLoad !== LazyLoadEnum.Force && lazyLoad !== LazyLoadEnum.ForceAndWait && lazyLoad !== LazyLoadEnum.Lazy
		);

		if (obj && obj.meta.isLoaded(property)) {
			// If the object exists and is loaded, then invoke the callback immediately.
			callback.call(thisPtr || this, obj);
		}
		else if (lazyLoad == LazyLoadEnum.Lazy) {
			if (!obj) {
				obj = fromExoModel({ type: type.meta.get_fullName(), id: id }, translator, true);
			}

			// In lazy mode, simply invoke the callback if the object exists, since the caller doesn't care whether it is loaded.
			callback.call(thisPtr || this, obj);
		}
		else if (lazyLoad == LazyLoadEnum.Force) {
			// The caller wants the instance force loaded but doesn't want to wait for it to complete.

			// If the instance doesn't exist then ensure that a ghosted instance is created.
			if (!obj) {
				obj = fromExoModel({ type: type.meta.get_fullName(), id: id }, translator, true);
			}

			// Invoke the callback immediately.
			callback.call(thisPtr || this, obj);

			// After the callback has been invoked, force loading to occur.
			LazyLoader.load(obj, property, false);
		}
		else if (lazyLoad == LazyLoadEnum.ForceAndWait) {
			// The caller wants the instance force loaded and will wait for it to complete.

			// If the instance doesn't exist then ensure that a ghosted instance is created.
			if (!obj) {
				obj = fromExoModel({ type: type.meta.get_fullName(), id: id }, translator, true);
			}

			// Force loading to occur, passing through the callback.
			LazyLoader.load(obj, property, false, thisPtr ? callback.bind(thisPtr) : callback);
		}
		else {
			// The caller does not want to force loading, so wait for the instance to come into existance and invoke the callback when it does.

			function invokeCallback() {
				if (filter(obj) !== true)
					return;

				// only invoke the callback once
				propertyFilter = function () { return false; };
				callback.call(thisPtr || this, obj);
			}

			var objSignal = new Signal("wait for object to exist");

			function ensureListLoaded() {
				// If there is a property specified that is a list, then don't invoke the callback until it is loaded.
				if (property) {
					var propertyObj = type.meta.property(property);
					// Only entity lists can be lazy loaded in addition to the parent object.
					if (propertyObj.get_isEntityListType()) {
						if (!obj.meta.isLoaded(property)) {
							// List lazy loader will invoke property change event
							propertyObj.addChanged(objSignal.pending(null, null, true), obj, true);
						}
					}
				}
			}

			function waitForObjectLoaded() {
				// Since the object is not loaded, don't invoke the callback until it is loaded.
				obj.meta.type.addInitExisting(objSignal.pending(function () {
					ensureListLoaded();
				}, null, true), obj, true);
			}

			function waitForObjectExists() {
				// The object doesn't exist, so don't invoke the callback until something causes it to be created.
				model.addObjectRegistered(objSignal.pending(null, null, true), function (newObj) {
					if (newObj.meta.type === type.meta && newObj.meta.id === translateId(translator, type.meta.get_fullName(), id)) {
						obj = newObj;
						if (!obj.meta.isLoaded()) {
							waitForObjectLoaded();
						}
						return true;
					}
				}, true);
			}

			if (!obj) {
				waitForObjectExists();
			} else if (!obj.meta.isLoaded()) {
				waitForObjectLoaded();
			} else {
				ensureListLoaded();
			}

			objSignal.waitForAll(function () {
				callback.call(thisPtr || this, obj);
			}, null, true);
		}
	}

	// #endregion

	// #region ExoWeb.Mapper.TypeLazyLoader
	//////////////////////////////////////////////////

	function TypeLazyLoader() {
	}

	function typeLoad(mtype, propName, inScope, callback, thisPtr) {
		if (!ExoWeb.config.allowTypeLazyLoading) {
			throw new Error("Type lazy loading has been disabled: " + mtype.get_fullName());
		}

		fetchTypes(mtype.model, [mtype.get_fullName()], function(jstype) {
			if (callback && callback instanceof Function) {
				callback(jstype);
			}
		}, thisPtr);
	}

	TypeLazyLoader.mixin({
		load: typeLoad.dontDoubleUp({ callbackArg: 3, thisPtrArg: 4, groupBy: 0 })
	});

	(function() {
		var instance = new TypeLazyLoader();

		TypeLazyLoader.register = function(obj) {
			LazyLoader.register(obj, instance);
		};

		TypeLazyLoader.unregister = function(obj) {
			LazyLoader.unregister(obj, instance);
		};
	})();

	// #endregion

	// #region ExoWeb.Mapper.ObjectLazyLoader
	//////////////////////////////////////////////////

	// <reference path="../core/Config.js" />

	function ObjectLazyLoader() {
		this._requests = {};
		this._typePaths = {};
	}

	var pendingObjects = 0;

	registerActivity("ObjectLazyLoader", function() {
		return pendingObjects > 0;
	});

	function objLoad(obj, propName, inScope, callback, thisPtr) {
		if (!ExoWeb.config.allowObjectLazyLoading) {
			throw new Error($format("Object lazy loading has been disabled: {0}|{1}", obj.meta.type.get_fullName(), obj.meta.id));
		}

		pendingObjects++;

		var signal = new ExoWeb.Signal("object lazy loader");

		var id = obj.meta.id || STATIC_ID;
		var mtype = obj.meta.type || obj.meta;

		// Get the paths from the original query(ies) that apply to this object (based on type).
		var paths = ObjectLazyLoader.getRelativePaths(obj);

		// Add the property to load if specified.  Assumes an instance property.
		if (propName && paths.indexOf(propName) < 0) {
			paths.push(propName);
		}

		// fetch object json
		logWarning($format("Lazy load object: {0}|{1}", mtype.get_fullName(), id));

		// TODO: reference to server will be a singleton, not context
		objectProvider(mtype.get_fullName(), [id], paths, inScope,
			serializeChanges.call(context.server, true),
			function(result) {
				mtype.model.server._handleResult(result, $format("Lazy load: {0}|{1}", mtype.get_fullName(), id), null, function() {
					LazyLoader.unregister(obj, this);
					pendingObjects--;

					// Raise init events if registered.
					for (var t = mtype; t; t = t.baseType) {
						var handler = t._getEventHandler("initExisting");
						if (handler)
							handler(obj, {});
					}

					callback.call(thisPtr || this, obj);
				});
			},
			function(e) {
				pendingObjects--;
				var message = $format("Failed to load {0}|{1}: ", [mtype.get_fullName(), id]);
				if (e !== undefined && e !== null &&
					e.get_message !== undefined && e.get_message !== null &&
					e.get_message instanceof Function) {

					message += e.get_message();
				}
				else {
					message += "unknown error";
				}
				throw new Error(message);
			});

		// does the object's type need to be loaded too?
		if (LazyLoader.isRegistered(mtype)) {
			LazyLoader.load(mtype, null, false, signal.pending());
		}
	}

	ObjectLazyLoader.mixin({
		load: objLoad.dontDoubleUp({ callbackArg: 3, thisPtrArg: 4, groupBy: 0 })
	});

	(function() {
		var instance = new ObjectLazyLoader();

		ObjectLazyLoader.addPaths = function ObjectLazyLoader$addPaths(rootType, paths) {
			var typePaths = instance._typePaths[rootType];
			if (!typePaths) {
				typePaths = instance._typePaths[rootType] = [];
			}
			for (var i = 0; i < paths.length; i++) {
				var path = paths[i];
				if (typePaths.indexOf(path) < 0) {
					typePaths.push(path);
				}
			}
		};

		ObjectLazyLoader.getRelativePaths = function getRelativePaths(obj) {
			return ObjectLazyLoader.getRelativePathsForType(obj.meta.type);
		};

		ObjectLazyLoader.getRelativePathsForType = function getRelativePathsForType(type) {
			var relPaths = [];

			for (var typeName in instance._typePaths) {
				var jstype = Model.getJsType(typeName);

				if (jstype && jstype.meta) {
					var paths = instance._typePaths[typeName];
					for (var i = 0; i < paths.length; i++) {
						var path = paths[i].expression;
						var chain = Model.property(path, jstype.meta);
						// No need to include static paths since if they were 
						// cached then they were loaded previously.
						if (!chain.get_isStatic()) {
							var rootedPath = chain.rootedPath(type);
							if (rootedPath) {
								relPaths.push(rootedPath);
							}
						}
					}
				}
			}

			return relPaths.distinct();
		};

		ObjectLazyLoader.isRegistered = function (obj) {
			return LazyLoader.isRegistered(obj, instance);
		};

		ObjectLazyLoader.register = function(obj) {
			if (!ObjectLazyLoader.isRegistered(obj)) {
				if (obj.meta.type.get_origin() !== "server") {
					throw new Error($format("Cannot lazy load instance of non-server-origin type: {0}|{1}", obj.meta.type.get_fullName(), obj.meta.id));
				}
				LazyLoader.register(obj, instance);
			}
		};

		ObjectLazyLoader.unregister = function(obj) {
			LazyLoader.unregister(obj, instance);
		};
	})();

	// #endregion

	// #region ExoWeb.Mapper.ListLazyLoader
	//////////////////////////////////////////////////

	function ListLazyLoader() {
	}

	function listLoad(list, propName, inScope, callback, thisPtr) {
		var signal = new ExoWeb.Signal("list lazy loader");

		var model = list._ownerProperty.get_containingType().model;
		var ownerId = list._ownerId;
		var containingType = list._ownerProperty.get_containingType();

		// Determine the instance or type that owns the list.
		var owner = ownerId === STATIC_ID ?

			// For static lists the owner is a type.
			containingType.get_jstype() :

			// For non-static lists, retrieve the owner by type and id.
			containingType.get(
				// Fetch the owner using the id specified in the lazy loader metadata.
				ownerId,

				// When loading a list the type of the owner comes from the containing
				// type of the property, so it may not be the exact type of the instance.
				false
			);

		var ownerType = ownerId === STATIC_ID ? owner.meta.get_fullName() : owner.meta.type.get_fullName();
		var prop = list._ownerProperty;
		var propIndex = list._ownerProperty.get_index();
		var propName = list._ownerProperty.get_name();
		var propType = list._ownerProperty.get_jstype().meta;

		if (!ExoWeb.config.allowListLazyLoading) {
			throw new Error($format("List lazy loading has been disabled: {0}|{1}.{2}", ownerType, ownerId, propName));
		}

		// load the objects in the list
		logWarning($format("Lazy load list: {0}|{1}.{2}", ownerType, ownerId, propName));

		var objectJson, conditionsJson;

		// TODO: reference to server will be a singleton, not context
		listProvider(ownerType, ownerId, propName, ownerId === STATIC_ID ? [] : ObjectLazyLoader.getRelativePathsForType(propType),
			serializeChanges.call(context.server, true),
			signal.pending(function(result) {
				objectJson = result.instances;
				conditionsJson = result.conditions;
			}),
			signal.orPending(function(e) {
				var errorMessage;
				if (e !== undefined && e !== null &&
						e.get_message !== undefined && e.get_message !== null &&
						e.get_message instanceof Function) {

					errorMessage = e.get_message();
				}
				else if (e.message) {
					errorMessage = e.message;
				}
				else {
					errorMessage = "unknown error";
				}

				throw new Error($format("Failed to load {0}|{1}.{2}: {3}", ownerType, ownerId, propName, errorMessage));
			})
		);

		// ensure that the property type is loaded as well.
		// if the list has objects that are subtypes, those will be loaded later
		// when the instances are being loaded
		if (LazyLoader.isRegistered(propType)) {
			LazyLoader.load(propType, null, false, signal.pending());
		}

		signal.waitForAll(function() {
			if (!objectJson) {
				return;
			}

			// The actual type name and id as found in the resulting json.
			var jsonId = ownerId;
			var jsonType = ownerType;

			// Find the given type and id in the object json.  The type key may be a dervied type.
			function searchJson(mtype, id) {
				// The given type is a key that is present in the result json.
				if (objectJson[mtype.get_fullName()]) {

					// The id is also a key.
					if (objectJson[mtype.get_fullName()][id]) {
						jsonType = mtype.get_fullName();
						jsonId = id;
						return true;
					}

					// Ids returned from the server are not always in the same case as ids on the client, so check one-by-one.
					for (var varId in objectJson[mtype.get_fullName()]) {
						if (varId.toLowerCase() == id.toLowerCase()) {
							jsonType = mtype.get_fullName();
							jsonId = varId;
							return true;
						}
					}
				}

				// Check derived types recursively.
				for (var i = 0; i < mtype.derivedTypes.length; i++) {
					if (searchJson(mtype.derivedTypes[i], id)) {
						return true;
					}
				}
			}

			if (!searchJson(ExoWeb.Model.Model.getJsType(ownerType).meta, ownerId)) {
				throw new Error($format("Data could not be found for {0}:{1}.", ownerType, ownerId));
			}

			var listJson = prop.get_isStatic() ?
				objectJson[jsonType][jsonId][propName] :
				objectJson[jsonType][jsonId][propIndex];

			if (!(listJson instanceof Array)) {
				throw new Error($format("Attempting to load list {0} of instance {1}:{2}, but the response JSON is not an array: {3}.", propName, ownerType, ownerId, listJson));
			}

			var populateList = false;
			//var newItems = [];

			if (LazyLoader.isRegistered(list)) {
				// If the lazy loader is no longer registered,
				// then don't populate the list.
				populateList = true;
				ListLazyLoader.unregister(list, this);
			}

			// populate the list with objects
			for (var i = 0; i < listJson.length; i++) {
				var ref = listJson[i];
				var item = getObject(model, propType, (ref && ref.id || ref), (ref && ref.type || propType));

				//newItems.push(item);

				if (populateList) {
					if (list.contains(item)) {
						logWarning($format("Lazy loading list {0}|{1}.{2} already contains object {3}.", ownerType, ownerId, propName, Entity.toIdString(item)));
					}
					list.push(item);
				}

				// if the list item is already loaded ensure its data is not in the response
				// so that it won't be reloaded
				if (LazyLoader.isLoaded(item)) {
					delete objectJson[jsonType][ref.id];
				}
			}

			// remove list from json and process the json.  there may be
			// instance data returned for the objects in the list
			if (LazyLoader.isLoaded(owner)) {
				delete objectJson[jsonType][jsonId];
			}

			ListLazyLoader.unregister(list, this);

			var batch = ExoWeb.Batch.start($format("{0}|{1}.{2}", [ownerType, ownerId, propName]));

			var done = function() {
				// Collection change driven by user action or other behavior would result in the "change" event
				//	being raised for the list property.  Since we don't want to record this as a true observable
				//	change, raise the event manually so that rules will still run as needed.
				// This occurs before batch end so that it functions like normal object loading.
				//if (ownerId !== STATIC_ID) {
				prop._raiseEvent("changed", [owner, { property: prop, newValue: list, oldValue: undefined, collectionChanged: true }]);
				//}

				// Example of explicitly raising the collection change event if needed.
				// NOTE: This is probably not necessary because it is difficult to get a reference to a
				// non-loaded list and so nothing would be watching for changes prior to loading completion.
				// The _initializing flag would be necessary to signal to the property's collection change
				// handler that it should not raise the various events in response to the collection change.
				//list._initializing = true;
				//Sys.Observer.raiseCollectionChanged(list, [new Sys.CollectionChange(Sys.NotifyCollectionChangedAction.add, newItems, 0)]);
				//delete list._initializing;

				ExoWeb.Batch.end(batch);
				callback.call(thisPtr || this, list);
			};

			objectsFromJson(model, objectJson, function() {
				if (conditionsJson) {
					conditionsFromJson(model, conditionsJson, list.slice(0), done);
				}
				else {
					done();
				}
			});
		});
	}

	ListLazyLoader.mixin({
		load: listLoad.dontDoubleUp({ callbackArg: 3, thisPtrArg: 4, groupBy: 0 })
	});

	(function() {
		var instance = new ListLazyLoader();

		var modifiableLists = [];

		function lazyListModified(sender, args) {
			// Check that modifications have not been allowed.
			if (modifiableLists.indexOf(sender) < 0) {
				// Check that at least one change involves adding or removing a non-new instance.
				if (args.get_changes().mapToArray(function(c) { return c.newItems || []; }).concat(args.get_changes().mapToArray(function(c) { return c.oldItems || []; })).some(function(i) { return !i.meta.isNew; })) {
					throw new Error($format("{0} list {1}.{2} was modified but it has not been loaded.",
						this._isStatic ? "Static" : "Non-static",
						this._isStatic ? this._containingType.get_fullName() : "this<" + this._containingType.get_fullName() + ">",
						this._name
					));
				}
			}
		}

		ListLazyLoader.register = function(obj, prop) {
			var list = [];

			// Throw an error if a non-loaded list is modified
			var collectionChangeHandler = lazyListModified.bind(prop);
			list._collectionChangeHandler = collectionChangeHandler;
			Observer.addCollectionChanged(list, collectionChangeHandler);

			list._ownerId = prop.get_isStatic() ? STATIC_ID : obj.meta.id;
			list._ownerProperty = prop;

			LazyLoader.register(list, instance);

			return list;
		};

		ListLazyLoader.unregister = function(list) {
			Observer.removeCollectionChanged(list, list._collectionChangeHandler);
			LazyLoader.unregister(list, instance);

			delete list._ownerId;
			delete list._ownerProperty;
			delete list._collectionChangeHandler;
		};

		ListLazyLoader.allowModification = function(list, callback, thisPtr) {
			modifiableLists.push(list);
			callback.call(thisPtr || this);
			modifiableLists.remove(list);
		};
	})();

	// #endregion

	// #region ExoWeb.Mapper.Context
	//////////////////////////////////////////////////

	// Signal to keep track of any ongoing context initialization
	var allSignals = new ExoWeb.Signal("Context : allSignals");

	ExoWeb.registerActivity("Context: allSignals", function() {
		return allSignals.isActive();
	});

	function Context() {
		window.context = this;

		this.model = { meta: new ExoWeb.Model.Model() };
		this.server = new ServerSync(this.model.meta);
	}

	Context.mixin(ExoWeb.Functor.eventing);

	var numberOfPendingQueries;

	Context.mixin({
		addReady: function Context$addReady(callback, thisPtr) {
			var queriesAreComplete = numberOfPendingQueries === 0;

			this._addEvent("ready", thisPtr ? callback.bind(thisPtr) : callback, null, true);

			// Simulate the event being raised immediately if a query or queries have already completed
			if (queriesAreComplete) {
				// Subscribers will not actually be called until signals have subsided
				allSignals.waitForAll(function() {
					this._raiseEvent("ready");
				}, this);
			}
		},
		isPending: function () {
			return numberOfPendingQueries > 0;
		},
		beginContextReady: ExoWeb.Functor(),
		endContextReady: ExoWeb.Functor()
	});

	function ensureContext() {
		if (!window.context) {
			window.context = new Context();
		}

		if (!(window.context instanceof Context)) {
			throw new Error("The window object has a context property that is not a valid context.");
		}
	}

	Context.ready = function Context$ready(context) {
		numberOfPendingQueries--;

		var queriesAreComplete = numberOfPendingQueries === 0;

		if (queriesAreComplete) {
			// Indicate that one or more model queries are ready for consumption
			allSignals.waitForAll(function() {
				context._raiseEvent("ready");
			});
		}
	};

	Context.query = function Context$query(context, options) {
		var queriesHaveBegunOrCompleted = numberOfPendingQueries !== undefined;
		if (!queriesHaveBegunOrCompleted) {
			numberOfPendingQueries = 0;
		}
		numberOfPendingQueries++;

		// Execute the query and fire the ready event when complete
		(new ContextQuery(context, options)).execute(function() {
			Context.ready(context);
		});
	}

	// #endregion

	// #region ExoWeb.Mapper.ContextQuery
	//////////////////////////////////////////////////

	function ContextQuery(context, options) {
		this.context = context;
		this.options = options;
		this.batch = null;
		this.state = {};
	}

	ContextQuery.mixin({
		execute: ExoWeb.FunctionChain.prepare(

		// Starts a batch so that others will not respond to changes that are
		// broadcast during querying, i.e. instance loading.
		///////////////////////////////////////////////////////////////////////////////
			function ContextQuery$setup(callback, thisPtr) {
				// start a batch to represent all of the pending work
				this.batch = ExoWeb.Batch.start("context query");

				// store init changes as early as possible
				if (this.options.changes)
					ServerSync$storeInitChanges.call(this.context.server, this.options.changes);

				// If the allSignals signal is not active, then set up a fake pending callback in
				// order to ensure that the context is not "loaded" prior to models being initilized.
				if (!allSignals.isActive()) {
					this._predictiveModelPending = allSignals.pending(null, this, true);
				}

				// Setup lazy loading on the context object to control lazy evaluation.
				// Loading is considered complete at the same point model.ready() fires. 
				LazyLoader.register(this.context, {
					load: function context$load(obj, propName, inScope, callback, thisPtr) {
						// objects are already loading so just queue up the calls
						allSignals.waitForAll(function context$load$callback() {
							LazyLoader.unregister(obj, this);

							if (callback && callback instanceof Function) {
								callback.call(thisPtr || this);
							}
						}, this, true);
					}
				});

				callback.call(thisPtr || this);
			},

		// Perform pre-processing of model queries and their paths.
		///////////////////////////////////////////////////////////////////////////////
			function ContextQuery$initModels(callback, thisPtr) {
				if (this.options.model) {
					// Start capturing changes prior to processing any model query
					this.context.server.beginCapturingChanges();
					ExoWeb.eachProp(this.options.model, function (varName, query) {
						// Assert that the necessary properties are provided
						if (!query.hasOwnProperty("from") || (!query.hasOwnProperty("id") && !query.hasOwnProperty("ids")))
							throw new Error("The model query \"" + varName + "\" requires a from and id or ids clause.");
						if (query.hasOwnProperty("id") && query.hasOwnProperty("ids"))
							throw new Error("The model query \"" + varName + "\" must specify either id or ids, not both.");

						// common initial setup of state for all model queries
						this.state[varName] = { signal: new ExoWeb.Signal("createContext." + varName), isArray: false };

						if (this._predictiveModelPending) {
							delete this._predictiveModelPending;
						}
						else {
							allSignals.pending(null, this, true);
						}

						// normalize id(s) property and determine whether the result should be an array
						if (query.hasOwnProperty("ids") && !(query.ids instanceof Array)) {
							query.ids = [query.ids];
						}
						else if (query.hasOwnProperty("id") && !(query.id instanceof Array)) {
							query.ids = [query.id];
							delete query.id;
						}
						else {
							// we know that either id or ids is specified, so if neither
							// one is NOT an array, then the query must be an array
							this.state[varName].isArray = true;

							// pre-initialize array queries
							var arr = [];
							Observer.makeObservable(arr);
							this.context.model[varName] = arr;
						}

						// get rid of junk (null/undefined/empty) ids
						query.ids = filter(query.ids, not(isNullOrEmpty));

						// remove new ids for later processing
						query.newIds = purge(query.ids, equals($newId()));

						// Store the paths for later use in lazy loading
						query.normalized = ExoWeb.Model.PathTokens.normalizePaths(query.include);
						ObjectLazyLoader.addPaths(query.from, query.normalized);

						// use temporary config setting to enable/disable scope-of-work functionality
						if (query.inScope !== false) {
							if (query.ids.length > 0) {
								this.state[varName].scopeQuery = {
									from: query.from,
									ids: query.ids,
									// TODO: this will be subset of paths interpreted as scope-of-work
									include: query.include ? query.include : [],
									inScope: true,
									forLoad: false
								};
							}
						}
					}, this);
				}

				// Undo predictive pending "callback" set up before models were processed.
				if (this._predictiveModelPending) {
					delete this._predictiveModelPending;
					allSignals.oneDone();
				}

				callback.call(thisPtr || this);
			},

		// Only fetch the types if they are not embedded. If the types are
		// embedded then fetching the types from server will cause a signal to
		// be created that will never be processed.
		///////////////////////////////////////////////////////////////////////////////
			function ContextQuery$fetchTypes(callback, thisPtr) {
				var typesToLoad = [], model = this.context.model.meta, instances = this.options.instances, signal = new ExoWeb.Signal("ContextQuery$fetchTypes");

				// Include types for all instances in instance payload
				if (instances && (!this.options.types || this.options.types instanceof Array)) {
					eachProp(this.options.instances, function(t) {
						// Add the type of the instances.
						var mtype = model.type(t);
						if (!mtype || LazyLoader.isRegistered(mtype)) {
							typesToLoad.push(t);
						}
					}, this);
				}

				// Load all types specified in types portion of query
				if (this.options.types && this.options.types instanceof Array) {
					this.options.types
						.map(function(t) {
							return t.from || t;
						}).filter(function(t) {
							// Exclude types that are already loaded
							var mtype = model.type(t);
							return !mtype || LazyLoader.isRegistered(mtype);
						}).forEach(function(t) {
							if (!typesToLoad.contains(t)) {
								typesToLoad.push(t);
							}
						});
				}

				// Fetch types in a single batch request
				if (typesToLoad.length > 0) {
					fetchTypes(model, typesToLoad, signal.pending(), this);
				}

				// Fetch additional types based on model queries and paths
				if (this.options.model && (!this.options.types || this.options.types instanceof Array)) {
					ExoWeb.eachProp(this.options.model, function (varName, query) {
						fetchQueryTypes(this.context.model.meta, query.from, query.normalized, signal.pending());
					}, this);
				}

				signal.waitForAll(callback, thisPtr);
			},

		// Process embedded data as if it had been recieved from the server in
		// the form of a web service response. This should enable flicker-free
		// page loads by embedded data, changes, etc.
		///////////////////////////////////////////////////////////////////////////////
			function ContextQuery$processEmbedded(callback, thisPtr) {
				if (this.options.instances || this.options.conditions || (this.options.types && !(this.options.types instanceof Array))) {
					var handler = new ResponseHandler(this.context.model.meta, this.context.server, {
						instances: this.options.instances,
						conditions: this.options.conditions,
						types: this.options.types && this.options.types instanceof Array ? null : this.options.types,
						serverInfo: this.options.serverInfo
					});

					handler.execute(function () {
						// Update 'isNew' for objects that show up in InitNew changes.
						if (this.options.changes) {
							this.options.changes.forEach(function (change) {
								if (change.type === "InitNew") {
									tryGetJsType(this.context.server.model, change.instance.type, null, false, function (jstype) {

										// Attempt to find the InitNew instance if it was present in the instances JSON.
										var obj = jstype.meta.get(
											// Ok to fetch the instance by the server-generated id?
											change.instance.id,
										
											// When processing embedded changes we can expect that the type of the instance
											// is exactly the type specified in the change object, not a base type.
											true
										);

										// If it exists, then it would have been created as an existing object, so mark it as new.
										if (obj) {
											obj.meta.isNew = true;
										}

									}, this);
								}
							}, this);
						}

						callback.call(thisPtr || this);
					}, this);
				}
				else {
					callback.call(thisPtr || this);
				}
			},

		// Detect batch query candidates and send batch request, if batching is
		// enabled (true by default).
		///////////////////////////////////////////////////////////////////////////////
			function ContextQuery$doBatchRequest(callback, thisPtr) {
				if (this.options.model && ExoWeb.config.individualQueryLoading !== true) {
					var pendingQueries = [];
					var batchQuerySignal;

					ExoWeb.eachProp(this.options.model, function (varName, query) {
						if (!query.load && query.ids.length > 0) {
							var jstype = ExoWeb.Model.Model.getJsType(query.from, true);

							// get a list of ids that should be batch-requested
							var batchIds = filter(query.ids, function (id, index) {
								// if the type doesn't exist, include the id in the batch query
								if (!jstype) return true;

								// Check to see if the object already exists, i.e. because of embedding.
								var obj = jstype.meta.get(
									// Translate the specified ID, which may be a server-generated new id,
									// into the appropriate client-generated id.
									translateId(this.context.server._translator, query.from, id),

									// The type specified in a query may be a sub-class of the actual type,
									// since it may be written by hand and not known ahead of time.
									false
								);

								// If it doesn't exist, include the id in the batch query.
								if (obj === undefined) {
									return true;
								}

								// otherwise, include it in the model
								if (this.state[varName].isArray) {
									this.context.model[varName][index] = obj;
								}
								else {
									this.context.model[varName] = obj;
								}
							}, this);

							if (batchIds.length > 0) {
								if (batchQuerySignal === undefined) {
									batchQuerySignal = new ExoWeb.Signal("batch query");
									batchQuerySignal.pending(null, this, true);
								}

								// complete the individual query signal after the batch is complete
								batchQuerySignal.waitForAll(this.state[varName].signal.pending(null, this, true), this, true);

								pendingQueries.push({
									from: query.from,
									ids: batchIds,
									include: query.include || [],
									inScope: true,
									forLoad: true
								});
							}
						}
					}, this);

					if (pendingQueries.length > 0) {
						// perform batch query
						queryProvider(pendingQueries, null,
							function context$objects$callback(result) {
								objectsFromJson(this.context.model.meta, result.instances, function () {
									if (result.conditions) {
										conditionsFromJson(this.context.model.meta, result.conditions, null, function () {
											batchQuerySignal.oneDone();
										});
									}
									else {
										batchQuerySignal.oneDone();
									}
								}, this);
							},
							function context$objects$callback(error) {
								throw new Error($format("Failed to load batch query (HTTP: {0}, Timeout: {1})", error._statusCode, error._timedOut));
							}, this);
					}
				}

				callback.call(thisPtr || this);
			},

		// Send individual requests and simulate for "load" option.
		///////////////////////////////////////////////////////////////////////////////
			function ContextQuery$doIndividualRequests(callback, thisPtr) {
				if (this.options.model) {
					// 2) Start loading instances individually
					ExoWeb.eachProp(this.options.model, function (varName, query) {
						if (query.load) {
							// bypass all server callbacks if data is embedded
							this.state[varName].objectJson = query.load.instances;
							this.state[varName].conditionsJson = query.load.conditions;
						}
						// need to load data from server
						// fetch object state if an id of a persisted object was specified
						else if (ExoWeb.config.individualQueryLoading === true) {
							tryGetJsType(this.context.model.meta, query.from, null, true, function (type) {
								// TODO: eliminate duplication!!!
								// get the list of ids that should be individually loaded
								var individualIds = filter(query.ids, function (id, index) {

									// Check to see if the object already exists, i.e. because of embedding.
									var obj = type.meta.get(
										// Translate the specified ID, which may be a server-generated new id,
										// into the appropriate client-generated id.
										translateId(this.context.server._translator, query.from, id),
									
										// The type specified in a query may be a sub-class of the actual type,
										// since it may be written by hand and not known ahead of time.
										false
									);

									// If it doesn't exist, include the id in the batch query.
									if (obj === undefined) {
										return true;
									}

									// otherwise, include it in the model
									if (this.state[varName].isArray) {
										this.context.model[varName][index] = obj;
									}
									else {
										this.context.model[varName] = obj;
									}
								}, this);

								if (individualIds.length > 0) {
									// for individual queries, include scope queries for all *BUT* the query we are sending
									var scopeQueries = [];
									var currentVarName = varName;
									ExoWeb.eachProp(this.options.model, function (varName, query) {
										if (varName !== currentVarName && this.state[varName].scopeQuery) {
											scopeQueries.push(this.state[varName].scopeQuery);
										}
									}, this);

									objectProvider(query.from, individualIds, query.include || [], true, null, scopeQueries,
										this.state[varName].signal.pending(function context$objects$callback(result) {
											this.state[varName].objectJson = result.instances;
											this.state[varName].conditionsJson = result.conditions;
										}, this, true),
										this.state[varName].signal.orPending(function context$objects$callback(error) {
											throw new Error($format("Failed to load {0}|{1} (HTTP: {3}, Timeout: {4})",
												query.from, query.ids, error._statusCode, error._timedOut));
										}, this, true), this);
								}
							}, this);
						}
					}, this);
				}

				callback.call(thisPtr || this);
			},

		// Load static paths for queries that don't otherwise require loading.
		///////////////////////////////////////////////////////////////////////////////
			function ContextQuery$doStaticRequests(callback, thisPtr) {
				if (this.options.model) {
					ExoWeb.eachProp(this.options.model, function (varName, query) {
						if (!query.load && query.ids.length === 0) {
							// Remove instance paths when an id is not specified
							var staticPaths = query.include ? query.include.filter(function (p) { return !p.startsWith("this.") && !p.startsWith("this{"); }) : null;

							// Only call the server if paths were specified
							if (staticPaths && staticPaths.length > 0) {
								objectProvider(null, null, staticPaths, false, null,
									allSignals.pending(function context$objects$callback(result) {
										// load the json. this may happen asynchronously to increment the signal just in case
										objectsFromJson(this.context.model.meta, result.instances, allSignals.pending(function () {
											if (result.conditions) {
												conditionsFromJson(this.context.model.meta, result.conditions, null, allSignals.pending());
											}
										}), this);
									}, this, true),
									allSignals.orPending(function context$objects$callback(error) {
										throw new Error($format("Failed to load {0}|{1} (HTTP: {2}, Timeout: {3})",
											query.from, query.ids, error._statusCode, error._timedOut));
									}, this, true)
								);
							}
						}
					}, this);
				}

				callback.call(thisPtr || this);
			},

		// Process instances data for queries as they finish loading.
		///////////////////////////////////////////////////////////////////////////////
			function ContextQuery$processResults(callback, thisPtr) {
				if (this.options.model) {
					ExoWeb.eachProp(this.options.model, function (varName, query) {
						this.state[varName].signal.waitForAll(function context$model() {
							// make sure everything isn't considered complete until new objects are also created
							if (query.newIds) allSignals.pending();

							// check to see if the root(s) have already been established
							if ((!this.state[varName].isArray && this.context.model[varName]) ||
								(this.state[varName].isArray && !query.ids.some(function (id, index) { return !this.context.model[varName][index]; }))) {

								allSignals.oneDone();
								return;
							}
							// otherwise, loading is required to establish roots if there are any server ids
							else if (query.ids.length > 0) {
								var processResponse = new Signal("processing response");

								if (this.state[varName].objectJson) {
									// load the json. this may happen asynchronously so increment the signal just in case
									objectsFromJson(this.context.model.meta, this.state[varName].objectJson, processResponse.pending(null, this), this, true);

									// indicate that instance data is already being loaded
									delete this.state[varName].objectJson;
								}

								processResponse.waitForAll(this.state[varName].signal.pending(function context$model$callback() {
									var mtype = this.context.model.meta.type(query.from);

									if (!mtype) {
										throw new Error($format("Could not get type {0} required to process query results.", query.from));
									}

									// establish roots for each id
									forEach(query.ids, function (id, index) {
										// TODO: resolve translator access
										var clientId = translateId(this.context.server._translator, query.from, id);

										// Retrieve the existing instance by id.
										var obj = mtype.get(
											// Translate the specified ID, which may be a server-generated new id,
											// into the appropriate client-generated id.
											clientId,

											// The type specified in a query may be a sub-class of the actual type,
											// since it may be written by hand and not known ahead of time.
											false
										);

										// If it doesn't exist, raise an error.
										if (obj == null) {
											throw new Error("Could not get " + query.from + " with id = " + clientId + (id !== clientId ? "(" + id + ")" : "") + ".");
										}

										// Otherwise, include it in the model.
										if (!this.state[varName].isArray && !this.context.model[varName]) {
											this.context.model[varName] = obj;
										}
										else if (this.state[varName].isArray && !this.context.model[varName][index]) {
											this.context.model[varName][index] = obj;
										}
									}, this);

									if (this.state[varName].conditionsJson) {
										conditionsFromJson(this.context.model.meta, this.state[varName].conditionsJson, null, function () {
											// model object has been successfully loaded!
											allSignals.oneDone();
										}, this);
									}
									else {
										// model object has been successfully loaded!
										allSignals.oneDone();
									}
								}, this), this);
							}
							else {
								// model object has been successfully loaded!
								allSignals.oneDone();
							}

							if (this.state[varName].objectJson) {
								// ensure that instance data is loaded (even if not needed to establish roots) just in case
								// root object was satisfied because it happened to be a part of the model of another root object
								objectsFromJson(this.context.model.meta, this.state[varName].objectJson, allSignals.pending());
							}

							// construct a new object(s) if a new id(s) was specified
							if (query.newIds) {
								// if json must be processed, signal will have been incremented again
								this.state[varName].signal.waitForAll(function () {
									if (this.state[varName].isArray) {
										foreach(query.newIds, function (index) {
											this.context.model[varName][index] = new (this.context.model.meta.type(query.from).get_jstype())();
										}, this);
									}
									else {
										this.context.model[varName] = new (this.context.model.meta.type(query.from).get_jstype())();
									}
								}, this);

								// model object has been successfully loaded!
								allSignals.oneDone();
							}
						}, this);
					}, this, true);
				}

				callback.call(thisPtr || this);
			},

		// Perform pre-processing of model queries and their paths.
		///////////////////////////////////////////////////////////////////////////////
			function ContextQuery$postQueries(callback, thisPtr) {
				if (this.options.model) {
					ExoWeb.eachProp(this.options.model, function (varName, query) {
						if (this.state[varName].scopeQuery) {
							ServerSync$addScopeQuery.call(this.context.server, this.state[varName].scopeQuery);
						}
					}, this);
				}

				callback.call(thisPtr || this);
			},

		// Final cleanup step. Allow rules to run initially, end the batch,
		// and allow the server sync to start capturing existing objects in
		// order to attach a lazy loader.
		///////////////////////////////////////////////////////////////////////////////
			function ContextQuery$cleanup(callback, thisPtr) {
				allSignals.waitForAll(function () {
					// allows previously defered rules to run
					this.context.model.meta.notifyBeforeContextReady();

					ExoWeb.Batch.end(this.batch);
				}, this, true);

				callback.call(thisPtr || this);
			}
		)
	});

	// #endregion

	// #region ExoWeb.Mapper.ExoWeb
	//////////////////////////////////////////////////

	// Don't activate the DOM automatically, instead delay until after context initialization
	Sys.activateDom = false;

	// Object constant to signal to mapper to create a new instance rather than load one
	var $newId = function $newId() {
		return "$newId";
	};

	window.$newId = $newId;

	// Indicates whether or not the DOM has been activated
	var activated = false;

	var serverInfo;

	var pendingTypeQueries = [];

	// Callback(s) to execute as soon as a context query begins.
	var initFns = new ExoWeb.Functor();

	// Signal to gate context completion via extendContext options.
	var globalReadySignal = new Signal();

	var extendContextFn = null;

	var contextReadyFns = new ExoWeb.Functor();

	var domReadyFns = new ExoWeb.Functor();

	function modelReadyHandler() {
		if (extendContextFn) {
			extendContextFn(window.context, globalReadySignal.pending());
			extendContextFn = null;
		}

		globalReadySignal.waitForAll(function () {
			if (!contextReadyFns.isEmpty()) {
				window.context.beginContextReady();
				contextReadyFns(window.context);
				window.context.endContextReady();
			}

			jQuery(function () {
				// Activate the document if this is the first context to load
				if (!activated && ExoWeb.config.autoActivation) {
					activated = true;
					Sys.Application.activateElement(document.documentElement);
				}

				// Invoke dom ready notifications
				if (!domReadyFns.isEmpty()) {
					if (ExoWeb.config.debug) {
						domReadyFns(window.context);
					} else {
						try {
							domReadyFns(window.context);
						} catch (e) {
							ExoWeb.logError(e, true);
						}
					}
				}
			});
		});
	}

	// Global method for initializing ExoWeb on a page

	function $exoweb(options) {

		// Support initialization function argument
		if (options instanceof Function) {
			options = { init: options };
		}

		if (options.init) {
			// Register the init function ONCE.
			initFns.add(options.init, null, true);
			delete options.init;
		}

		if (options.extendContext) {
			// Merge the extendContext function so that the callback argument is invoked after ALL have invoked the callback.
			extendContextFn = mergeFunctions(extendContextFn, options.extendContext, { async: true, callbackIndex: 1 });
			delete options.extendContext;
		}

		if (options.contextReady) {
			// Register the contextReady function ONCE.
			contextReadyFns.add(options.contextReady, null, true);
			delete options.contextReady;
		}

		if (options.domReady) {
			// Register the domReady function ONCE.
			domReadyFns.add(options.domReady, null, true);
			delete options.domReady;
		}

		// The server info object will be maintained here and constantly set each time a
		// context query is created. It shouldn't be publicly set for any other reason.
		if (options.serverInfo) {
			// Merge any additional serverInfo options.
			serverInfo = jQuery.extend(serverInfo, options.serverInfo);
			delete options.serverInfo;
		}

		if (options.types && options.types instanceof Array) {
			// Store type queries for later use, since only embedded data or a model query triggers immediate querying.
			pendingTypeQueries = pendingTypeQueries.concat(options.types);
			delete options.types;
		}

		// A model query or embedded data will trigger a context query immediately.
		var triggerQuery = false;
		var queryObject = {};

		if (options.model) {
			triggerQuery = true;
			queryObject.model = options.model;
			delete options.model;
		}

		if (options.types) {
			triggerQuery = true;
			queryObject.types = options.types;
			delete options.types;
		}

		if (options.instances) {
			triggerQuery = true;
			queryObject.instances = options.instances;
			delete options.instances;
		}

		if (options.conditions) {
			triggerQuery = true;
			queryObject.conditions = options.conditions;
			delete options.conditions;
		}

		if (options.changes) {
			triggerQuery = true;
			queryObject.changes = options.changes;
			delete options.changes;
		}

		if (triggerQuery) {

			// Ensure that a context is created if it hasn't been already.
			ensureContext();

			// Perform initialization immediately
			initFns(window.context);

			// Include server info if present.
			if (serverInfo) {
				// The server info object will be maintained here and constantly set each time a
				// context query is created. It shouldn't be publicly set for any other reason.
				queryObject.serverInfo = serverInfo;
			}

			// Send pending type queries with the query if types were not embedded.
			if (pendingTypeQueries.length > 0 && !queryObject.types) {
				queryObject.types = pendingTypeQueries;
				pendingTypeQueries = [];
			}

			// Start the new query
			Context.query(window.context, queryObject);

			if (pendingTypeQueries.length > 0) {
				// Send a seperate query for type queries if they couldn't be send with the primary query.
				Context.query(window.context, { types: pendingTypeQueries });
				pendingTypeQueries = [];
			}

			// Perform context initialization when the model is ready
			window.context.addReady(modelReadyHandler);

		} else if (window.context) {

			// Ensure that the context variable has not been used for some other purpose.
			if (!(window.context instanceof Context)) {
				throw new Error("The window object has a context property that is not a valid context.");
			}

			// Context has already been created, so perform initialization immediately
			initFns(window.context);

			// If the context has already completed, then fire the ready handler. It is safe to fire more than once.
			if (!window.context.isPending()) {
				allSignals.waitForAll(modelReadyHandler);
			}
		}

	}

	window.$exoweb = $exoweb;

	// #endregion

	// #region ExoWeb.Mapper.Extend
	//////////////////////////////////////////////////

	var pendingTypeExtensions = {};
	var pendingSubtypeExtensions = {};

	function raiseExtensions(mtype) {
		//ExoWeb.Batch.whenDone(function() { 
			// apply app-specific configuration
			// defer until loading is completed to reduce init events
			var exts = pendingTypeExtensions[mtype.get_fullName()];
			if (exts) {
				delete pendingTypeExtensions[mtype.get_fullName()];
				exts(mtype.get_jstype());
			}

			mtype.eachBaseType(function(baseType) {
				var subExts = pendingSubtypeExtensions[baseType.get_fullName()];
				if (subExts) {
					// don't delete subtype extensions since more subtypes may be created
					subExts(mtype.get_jstype());
				}
			});
		//});
	}

	function extendOne(typeName, callback, thisPtr) {
		var jstype = ExoWeb.Model.Model.getJsType(typeName, true);

		if (jstype && LazyLoader.isLoaded(jstype.meta)) {
			callback.call(thisPtr || this, jstype);
		}
		else {
			var pending = pendingTypeExtensions[typeName];

			if (!pending) {
				pending = pendingTypeExtensions[typeName] = ExoWeb.Functor();
			}

			pending.add(thisPtr ? callback.bind(thisPtr) : callback);
		}
	}

	window.$extend = function(typeInfo, callback, thisPtr) {
		if (typeInfo == null) throw new ArgumentNullError("typeInfo");

		// If typeInfo is an arry of type names, then use a signal to wait until all types are loaded.
		if (Object.prototype.toString.call(typeInfo) === "[object Array]") {
			var signal = new ExoWeb.Signal("extend");

			var types = [];
			typeInfo.forEach(function(item, index) {
				if (item.constructor !== String) {
					throw new ArgumentTypeError("typeInfo", "string", item);
				}

				extendOne(item, signal.pending(function(type) {
					types[index] = type;
				}), thisPtr);
			});

			signal.waitForAll(function() {
				// When all types are available, call the original callback.
				callback.apply(thisPtr || this, types);
			});
		}
		// Avoid the overhead of signal and just call extendOne directly.
		else if (typeInfo.constructor === String) {
			extendOne(typeInfo, callback, thisPtr);
		}
		else {
			throw new ArgumentTypeError("typeInfo", "string|array", typeInfo);
		}
	};

	window.$extendSubtypes = function(typeName, callback, thisPtr) {
		if (typeName == null) throw new ArgumentNullError("typeName");
		if (typeName.constructor !== String) throw new ArgumentTypeError("typeName", "string", typeName);

		var jstype = ExoWeb.Model.Model.getJsType(typeName, true);

		if (jstype) {
			// Call for existing, loaded subtypes
			Array.forEach(jstype.meta.derivedTypes || [], function(mtype) {
				if (mtype && LazyLoader.isLoaded(mtype)) {
					callback.call(thisPtr || this, mtype.get_jstype());
					Array.forEach(mtype.derivedTypes || [], arguments.callee.spliceArguments(1, 2));
				}
			});
		}
	
		var pending = pendingSubtypeExtensions[typeName];

		if (!pending) {
			pending = pendingSubtypeExtensions[typeName] = ExoWeb.Functor();
		}

		pending.add(thisPtr ? callback.bind(thisPtr) : callback);
	};

	window.$extendProperties = function (typeName, includeBuiltIn, callback, thisPtr) {
		if (typeName == null) throw new ArgumentNullError("typeName");
		if (typeName.constructor !== String) throw new ArgumentTypeError("typeName", "string", typeName);

		if (includeBuiltIn && includeBuiltIn instanceof Function) {
			thisPtr = callback;
			callback = includeBuiltIn;
			includeBuiltIn = false;
		}

		extendOne(typeName, function (jstype) {
			// Raise handler for existing properties
			jstype.meta.get_properties().forEach(function (prop) {
				if (includeBuiltIn === true || prop.get_origin() !== "server")
					callback.call(thisPtr || this, prop, true);
			});

			// Raise handler when new properties are added
			jstype.meta.addPropertyAdded(function (sender, args) {
				callback.call(thisPtr || this, args.property, false);
			});
		});
	}

	// #endregion

	// #region ExoWeb.UI.Toggle
	//////////////////////////////////////////////////

	function Toggle(element) {

		// Default action is show
		this._action = "show";

		Toggle.initializeBase(this, [element]);
	}

	var Toggle_allowedActions = ["show", "hide", "enable", "disable", "render", "dispose", "addClass", "removeClass"];

	// Actions
	Toggle.mixin({
		// Show/Hide
		//////////////////////////////////////////////////////////
		link_show: function Toggle$link_show() {
			if ((this._action === "show" && jQuery(this._element).is(".toggle-on")) || (this._action === "hide" && jQuery(this._element).is(".toggle-off"))) {
				this.set_state("on");
			}
			else {
				this.set_state("off");
			}
		},
		add_showing: function (handler) {
			/// <summary locid="E:J#Sys.UI.DataView.showing" />
			this._addHandler("showing", handler);
		},
		remove_showing: function (handler) {
			this._removeHandler("showing", handler);
		},
		add_hiding: function (handler) {
			/// <summary locid="E:J#Sys.UI.DataView.hiding" />
			this._addHandler("hiding", handler);
		},
		remove_hiding: function (handler) {
			this._removeHandler("hiding", handler);
		},
		do_show: function Toggle$do_show() {

			// visibility has changed so raise event
			if (this._visible === undefined || this._visible === false) {
				var showingArgs = new ActionEventArgs();

				this._pendingEventArgs = showingArgs;

				if (this._visible === false) {
					Sys.Observer.raiseEvent(this, "showing", showingArgs);
				}

				showingArgs.waitForAll(function () {
					this._pendingEventArgs = null;

					if (this._effect == "slide" && this._visible === false)
						jQuery(this._element).slideDown();
					else if (this._effect == "fade" && this._visible === false)
						jQuery(this._element).fadeIn();
					else
						jQuery(this._element).show();

					this.set_state("on");

					// visibility has changed so raise event
					Sys.Observer.raiseEvent(this, "shown");

					this._visible = true;

					this._pendingActions();
				}, this, true);
			}
		},
		do_hide: function Toggle$do_hide() {

			// visibility has changed so raise event
			if (this._visible === undefined || this._visible === true) {
				var hidingArgs = new ActionEventArgs();

				this._pendingEventArgs = hidingArgs;

				if (this._visible === true) {
					Sys.Observer.raiseEvent(this, "hiding", hidingArgs);
				}

				hidingArgs.waitForAll(function () {
					this._pendingEventArgs = null;

					if (this._effect == "slide" && this._visible === true)
						jQuery(this._element).slideUp();
					else if (this._effect == "fade" && this._visible === true)
						jQuery(this._element).fadeOut();
					else
						jQuery(this._element).hide();

					this.set_state("off");

					// visibility has changed so raise event
					Sys.Observer.raiseEvent(this, "hidden");

					this._visible = false;

					this._pendingActions();
				}, this, true);
			}
		},
		add_on: function Toggle$add_on(handler) {
			this._addHandler("on", handler);
		},
		remove_on: function Toggle$remove_on(handler) {
			this._removeHandler("on", handler);
		},
		add_off: function Toggle$add_off(handler) {
			this._addHandler("off", handler);
		},
		remove_off: function Toggle$remove_off(handler) {
			this._removeHandler("off", handler);
		},
		add_shown: function Toggle$add_shown(handler) {
			this._addHandler("shown", handler);
		},
		remove_shown: function Toggle$remove_shown(handler) {
			this._removeHandler("shown", handler);
		},
		add_hidden: function Toggle$add_hidden(handler) {
			this._addHandler("hidden", handler);
		},
		remove_hidden: function Toggle$remove_hidden(handler) {
			this._removeHandler("hidden", handler);
		},
		get_visible: function Toggle$get_visible() {
			return this._visible;
		},

		// Enable/Disable
		//////////////////////////////////////////////////////////
		link_disable: function Toggle$link_disable() {
			if ((this._action === "disable" && jQuery(this._element).is(".toggle-on")) || (this._action === "enable" && jQuery(this._element).is(".toggle-off"))) {
				jQuery("select,input,textarea,a,button,optgroup,option", this._element).andSelf().attr("disabled", "disabled");
				this.set_state("off");
			}
			else {
				this.set_state("on");
			}
		},
		do_enable: function Toggle$do_enable() {
			jQuery("select,input,textarea,a,button,optgroup,option", this._element).andSelf().removeAttr("disabled");
			this.set_state("on");
		},
		do_disable: function Toggle$do_disable() {
			jQuery("select,input,textarea,a,button,optgroup,option", this._element).andSelf().attr("disabled", "disabled");
			this.set_state("off");
		},

		// Render/Destroy
		//////////////////////////////////////////////////////////
		link_render: function Toggle$link_render() {
			this._context = null;

			if ((this._action === "render" && jQuery(this._element).is(".toggle-on")) || (this._action === "dispose" && jQuery(this._element).is(".toggle-off"))) {
				var pctx = this.get_templateContext();

				if (!this._ctxIdx && this._element.childNodes.length > 0)
					throw new Error("A toggle control is attached to the node, which expects a template context id, but no id was specified.");

				var newContext = new Sys.UI.TemplateContext(this._ctxIdx);
				newContext.data = pctx.dataItem;
				newContext.components = [];
				newContext.nodes = [];
				newContext.dataItem = pctx.dataItem;
				newContext.index = 0;
				newContext.parentContext = pctx;
				newContext.containerElement = this._element;
				newContext.template = this._getTemplate();
				newContext.template._ensureCompiled();
				this._context = newContext;

				Sys.Application._linkContexts(pctx, this, pctx.dataItem, this._element, newContext, this._contentTemplate);

				newContext.initializeComponents();
				newContext._onInstantiated(null, true);
				this.set_state("on");
				jQuery(this._element).show();
			}
			else {
				this.set_state("off");
				jQuery(this._element).hide();
			}
		},
		init_render: function Toggle$init_render() {
			if (!this._template && !jQuery(this._element).is(".sys-template")) {
				throw new Error("When using toggle in render/dispose mode, the element should be marked with the \"sys-template\" class.");
			}

			this._template = new Sys.UI.Template(this._element);
			this._template._ensureCompiled();
			jQuery(this._element).empty();
			jQuery(this._element).removeClass("sys-template");
		},
		do_render: function Toggle$do_render() {
			if (!this.get_renderOnly())
				jQuery(this._element).show();

			if (!this._context) {
				var pctx = this.get_templateContext();

				var renderArgs = new Sys.Data.DataEventArgs(pctx.dataItem);
				Sys.Observer.raiseEvent(this, "rendering", renderArgs);

				jQuery(this._element).empty();

				var context = this._context = this._template.instantiateIn(this._element, pctx.dataItem, pctx.dataItem, 0, null, pctx, this._contentTemplate);
				context.initializeComponents();

				Sys.Observer.raiseEvent(this, "rendered", renderArgs);
			}

			this.set_state("on");
		},
		do_dispose: function Toggle$do_dispose() {
			if (!this.get_renderOnly())
				jQuery(this._element).hide();

			if (this._context) {
				var renderArgs = new Sys.Data.DataEventArgs();
				Sys.Observer.raiseEvent(this, "rendering", renderArgs);

				this._context.dispose();
				this._context = null;

				jQuery(this._element).empty();

				Sys.Observer.raiseEvent(this, "rendered", renderArgs);
			}

			this.set_state("off");
		},
		add_rendering: function (handler) {
			this._addHandler("rendering", handler);
		},
		remove_rendering: function (handler) {
			this._removeHandler("rendering", handler);
		},
		add_rendered: function (handler) {
			this._addHandler("rendered", handler);
		},
		remove_rendered: function (handler) {
			this._removeHandler("rendered", handler);
		},

		// addClass / removeClass
		//////////////////////////////////////////////////////////
		do_addClass: function Toggle$do_addClass() {
			var $el = jQuery(this._element);

			if (!$el.is("." + this._className)) {
				$el.addClass(this._className);
				this.set_state("on");
				Sys.Observer.raiseEvent(this, "classAdded");
			}
		},
		do_removeClass: function Toggle$do_removeClass() {
			var $el = jQuery(this._element);

			if ($el.is("." + this._className)) {
				$el.removeClass(this._className);
				this.set_state("off");
				Sys.Observer.raiseEvent(this, "classRemoved");
			}
		},
		add_classAdded: function Toggle$add_classAdded(handler) {
			this._addHandler("classAdded", handler);
		},
		remove_classAdded: function Toggle$remove_classAdded(handler) {
			this._removeHandler("classAdded", handler);
		},
		add_classRemoved: function Toggle$add_classRemoved(handler) {
			this._addHandler("classRemoved", handler);
		},
		remove_classRemoved: function Toggle$remove_classRemoved(handler) {
			this._removeHandler("classRemoved", handler);
		}
	});

	// Inverse Actions
	Toggle.mixin({
		// Hide/Show
		//////////////////////////////////////////////////////////
		link_hide: Toggle.prototype.link_show,
		init_hide: Toggle.prototype.init_show,
		undo_hide: Toggle.prototype.do_show,
		undo_show: Toggle.prototype.do_hide,

		// Enable/Disable
		//////////////////////////////////////////////////////////
		link_enabled: Toggle.prototype.link_disable,
		init_disable: Toggle.prototype.init_enable,
		undo_disable: Toggle.prototype.do_enable,
		undo_enable: Toggle.prototype.do_disable,

		// Render/Dispose
		//////////////////////////////////////////////////////////
		link_dispose: Toggle.prototype.link_render,
		init_dispose: Toggle.prototype.init_render,
		undo_render: Toggle.prototype.do_dispose,
		undo_dispose: Toggle.prototype.do_render,

		// addClass/removeClass
		//////////////////////////////////////////////////////////
		undo_addClass: Toggle.prototype.do_removeClass,
		undo_removeClass: Toggle.prototype.do_addClass
	});

	Toggle.mixin({
		_generatesContext: function Toggle$_generatesContext() {
			return this._action === "render" || this._action === "dispose";
		},
		_getTemplate: function Toggle$_getTemplate() {
			return this._template;
		},
		_setTemplate: function Toggle$_setTemplate(value) {
			this._template = value;
		},
		_setTemplateCtxId: function Toggle$_setTemplateCtxId(idx) {
			this._ctxIdx = idx;
		},

		get_templateContext: function Toggle$get_templateContext() {
			/// <value mayBeNull="false" type="Sys.UI.TemplateContext" locid="P:J#ExoWeb.UI.Toggle.templateContext"></value>
			if (!this._parentContext) {
				this._parentContext = Sys.UI.Template.findContext(this._element);
			}
			return this._parentContext;
		},
		set_templateContext: function Toggle$set_templateContext(value) {
			this._parentContext = value;
		},

		get_action: function Toggle$get_action() {
			/// <summary>
			/// The value that determines what the control should
			/// do when its state changes. Ignored if the class property is set
			/// Options:  show, hide, enable, disable, render, dispose, addClass, removeClass
			/// </summary>

			return this._action;
		},
		set_action: function Toggle$set_action(value) {
			if (!Array.contains(Toggle_allowedActions, value)) {
				throw new Error($format("Invalid toggle action \"{0}\".  Possible values are \"{1}\".", value, Toggle_allowedActions.join(", ")));
			}

			this._action = value;
			this.execute();
		},

		get_renderOnly: function Toggle$get_renderOnly() {
			/// <summary>
			/// If true, render/dispose will not hide/show the element
			/// </summary>

			return this._renderOnly;
		},
		set_renderOnly: function Toggle$set_renderOnly(value) {
			this._renderOnly = value;
		},

		get_className: function Toggle$get_className() {
			/// <summary>
			/// Class to add or remove
			/// </summary>

			return this._className;
		},
		set_className: function Toggle$set_className(value) {
			this._className = value;
			if (!this._action)
				this._action = "addClass";
			this.execute();
		},

		// NOTE: Keep these properties around for backwards compatibility.
		get_class: function Toggle$get_class() {
			/// <summary>
			/// Class to add or remove
			/// </summary>

			logWarning("The toggle:class property is deprecated (see issue #1). Consider using toggle:classname instead.");

			return this._className;
		},
		set_class: function Toggle$set_class(value) {
			logWarning("The toggle:class property is deprecated (see issue #1). Consider using toggle:classname instead.");

			this._className = value;
			if (!this._action)
				this._action = "addClass";
			this.execute();
		},

		get_on: function Toggle$get_on() {
			/// <summary>
			/// The value that the control will watch to determine
			/// when its state should change.
			/// </summary>

			return this._on;
		},
		set_on: function Toggle$set_on(value) {
			var changed = value !== this._on;

			if (changed) {
				if (this._on && this._on instanceof Array) {
					Observer.removeCollectionChanged(this._on, this._collectionChangedHandler);
				}

				this._on = value;

				if (this._on && this._on instanceof Array) {
					this._collectionChangedHandler = this.execute.bind(this);
					Observer.addCollectionChanged(this._on, this._collectionChangedHandler);
				}

				this.execute();
			}
			else if (this._when && this._when instanceof Function) {
				this._on = value;
				this.execute();
			}
		},

		get_when: function Toggle$get_when() {
			/// <summary>
			/// The value to compare "on" to, this will most likely 
			/// be a static value, like true or false.
			/// </summary>

			return this._when;
		},
		set_when: function Toggle$set_when(value) {
			this._when = value;
			this.execute();
		},

		set_strictMode: function Toggle$set_strictMode(value) {
			/// <summary>
			/// If true, the "on" value will be strictly compared
			/// to the "when" value.  Otherwise, if "when" is undefined
			/// the "on" value will be checked for truthiness.
			/// </summary>

			this._strictMode = value;
		},
		get_strictMode: function Toggle$get_strictMode() {
			return this._strictMode;
		},

		get_groupName: function Toggle$get_groupName() {
			return this._groupName;
		},
		set_groupName: function Toggle$set_groupName(value) {
			this._groupName = value;
		},

		get_effect: function Toggle$get_effect() {
			return this._effect;
		},
		set_effect: function Toggle$set_effect(value) {
			this._effect = value;
		},

		get_state: function Toggle$get_state() {
			return this._state;
		},
		set_state: function Toggle$set_state(value) {
			this._state = value;
			this._stateClass(value);
			Sys.Observer.raiseEvent(this, value);
		},

		equals: function Toggle$equals() {
			if (this._when === undefined) {
				// When is not defined, so condition depends entirely on "on" property
				var onType = Object.prototype.toString.call(this._on);

				if (this._strictMode === true) {
					if (this._on.constructor !== Boolean)
						throw new Error("With strict mode enabled, toggle:on should be a value of type Boolean.");

					return this._on;
				}
				else if (onType === "[object Array]") {
					return this._on.length > 0;
				}
				else {
					// Default case when not in strict mode is truthiness.
					return !!this._on;
				}
			}
			else if (this._when instanceof Function) {
				var result = this._when(this._on);
				if (this._strictMode === true) {
					if (result === null || result === undefined || result.constructor !== Boolean)
						throw new Error("With strict mode enabled, toggle:when function should return a value of type Boolean.");
					return result;
				}
				else {
					return !!result;
				}
			}
			else {
				return this._on === this._when;
			}
		},

		canExecute: function Toggle$canExecute() {
			// Ensure that the control is initialized, has an element, and the "on" property has been set.
			// Scenario 1:  The set_on or set_when methods may be called before the control has been initialized.
			// Scenario 2:  If a lazy markup extension is used to set the "on" or "when" properties then a callback could set the 
			//				property value when the element is undefined, possibly because of template re-rendering.
			// Scenario 3:  If a lazy markup extension is used to set the "on" property then it may not have a value when initialized.
			return this.get_isInitialized() && this._element !== undefined && this._element !== null && this.hasOwnProperty("_on");
		},
		execute: function Toggle$execute() {
			if (this.canExecute()) {
				var action = this[(this.equals() === true ? "do_" : "undo_") + this._action].bind(this);
				if (this._pendingEventArgs) {
					this._pendingActions.add(action, (function () {
						return !this._pendingEventArgs;
					}).bind(this), true);
				} else {
					action();
				}
			}
		},
		addContentTemplate: function Toggle$addContentTemplate(tmpl) {
			if (this._action !== "render" && this._action !== "dispose" && this.get_templateContext() === Sys.Application._context) {
				throw Error.invalidOperation("invalidSysContentTemplate");
			}
			Sys.UI.IContentTemplateConsumer.prototype.addContentTemplate.apply(this, arguments);
		},
		dispose: function ExoWeb$UI$Toggle$dispose() {
			if (this._template) {
				this._template.dispose();
			}
			if (this._context) {
				this._context.dispose();
			}
			this._action = this._className = this._collectionChangedHandler = this._contentTemplate =
				this._context = this._ctxIdx = this._groupName = this._on = this._parentContext =
				this._state = this._strictMode = this._template = this._visible = this._when = null;
			ExoWeb.UI.Toggle.callBaseMethod(this, "dispose");
		},
		link: function Toggle$link() {
			// Perform custom link logic for the action
			var actionLink = this["link_" + this._action];
			if (actionLink) {
				actionLink.call(this);
			}

			ExoWeb.UI.Toggle.callBaseMethod(this, "link");
		},
		initialize: function Toggle$initialize() {
			Toggle.callBaseMethod(this, "initialize");

			this._pendingActions = new ExoWeb.Functor();

			if (this.get_isLinkPending()) {
				this.link();
			}
			else {
				// Perform custom init logic for the action
				var actionInit = this["init_" + this._action];
				if (actionInit) {
					actionInit.call(this);
				}

				this.execute();
			}
		},
		_stateClass: function (state) {
			if (state == "on")
				jQuery(this._element).addClass("toggle-on").removeClass("toggle-off");
			else
				jQuery(this._element).removeClass("toggle-on").addClass("toggle-off");
		}
	});

	ExoWeb.UI.Toggle = Toggle;
	Toggle.registerClass("ExoWeb.UI.Toggle", Sys.UI.Control, Sys.UI.ITemplateContextConsumer, Sys.UI.IContentTemplateConsumer);

	function ActionEventArgs() {
		this._signal = new ExoWeb.Signal();
		ActionEventArgs.initializeBase(this);
	}

	ActionEventArgs.prototype.pending = function (callback, thisPtr, executeImmediately) {
		return this._signal.pending.apply(this._signal, arguments);
	}

	ActionEventArgs.prototype.waitForAll = function (callback, thisPtr, executeImmediately) {
		this._signal.waitForAll.apply(this._signal, arguments);
	}

	ExoWeb.UI.ActionEventArgs = ActionEventArgs;
	ActionEventArgs.registerClass("ExoWeb.UI.ActionEventArgs", Sys.EventArgs);

	// #endregion

	// #region ExoWeb.UI.ToggleGroup
	//////////////////////////////////////////////////

	function ToggleGroup(element) {
		ToggleGroup.initializeBase(this, [element]);
	}

	ToggleGroup.mixin({
		_execute: function ToggleGroup$_execute() {
			if (this._visible.length === 0 && this._children.length > 0) {
				jQuery(this._element).hide();
			}
			else {
				jQuery(this._element).show();
			}
		},
		_toggleAdded: function ToggleGroup$_toggleAdded(idx, elem) {
			if (elem.control.get_groupName() === this._name && !Array.contains(this._children, elem)) {
				this._children.push(elem);

				if (elem.control.get_state() === "on") {
					this._add(elem);
				}

				elem.control.add_on(this._onHandler);
				elem.control.add_off(this._offHandler);
			}
		},
		_toggleRemoved: function ToggleGroup$_toggleRemoved(idx, elem) {
			if (Array.contains(this._children, elem)) {
				elem.control.remove_on(this._onHandler);
				elem.control.remove_off(this._offHandler);

				this._remove(elem);
				this._children.remove(elem);
				this._execute();
			}
		},
		_toggleOn: function ToggleGroup$_toggleOn(sender) {
			this._add(sender.get_element());
			this._execute();
		},
		_toggleOff: function ToggleGroup$_toggleOff(sender) {
			this._remove(sender.get_element());
			this._execute();
		},
		get_name: function ToggleGroup$get_name() {
			return this._name;
		},
		set_name: function ToggleGroup$set_name(value) {
			this._name = value;
		},
		_add: function (elem) {
			if (this._visible.indexOf(elem) < 0)
				this._visible.push(elem);
		},
		_remove: function (elem) {
			this._visible.remove(elem);
		},
		initialize: function ToggleGroup$initialize() {
			ToggleGroup.callBaseMethod(this, "initialize");

			this._children = [];
			this._visible = [];

			this._onHandler = this._toggleOn.bind(this);
			this._offHandler = this._toggleOff.bind(this);

			jQuery(":toggle", this._element).ever(this._toggleAdded.bind(this), this._toggleRemoved.bind(this));

			this._execute();
		}
	});

	ExoWeb.UI.ToggleGroup = ToggleGroup;
	ToggleGroup.registerClass("ExoWeb.UI.ToggleGroup", Sys.UI.Control);

	// #endregion

	// #region ExoWeb.UI.VueComponent
	//////////////////////////////////////////////////

	function VueComponent(element) {
		VueComponent.initializeBase(this, [element]);
		this._vm = null;
		this._eventHandlers = [];
	}

	function toKebabCase(str) {
		return str.replace(/[A-Z]/g, function (x) {
			return "-" + x.toLowerCase();
		});
	}

	VueComponent.prototype = {

		get_templateContext: function VueComponent$get_templateContext() {
			/// <value mayBeNull="false" type="Sys.UI.TemplateContext" locid="P:J#ExoWeb.UI.VueComponent.templateContext"></value>
			if (!this._parentContext) {
				this._parentContext = Sys.UI.Template.findContext(this._element);
			}
			return this._parentContext;
		},
		set_templateContext: function VueComponent$set_templateContext(value) {
			this._parentContext = value;
		},

		get_component: function() {
			return this._componentName;
		},
		set_component: function(value) {
			this._componentName = value;
		},

		get_parent: function() {
			if (!this._parent) {
				var parentVm = null;
				for (var tc = this.get_templateContext(); tc; tc = tc.parentContext) {
					if (tc.vm) {
						parentVm = tc.vm;
						break;
					}
				}
				this._parent = parentVm;
			}
			return this._parent;
		},
		set_parent: function(value) {
			this._parent = value;
		},

		get_model: function() {
			return this._model;
		},
		set_model: function(value) {
			this._model = value;
		},

		get_props: function() {
			return this._props || {};
		},
		set_props: function(value) {
			this._props = value;
			if (this._vm)
				this._bindProps();
		},

		get_setup: function() {
			return this._setup;
		},
		set_setup: function(value) {
			this._setup = value;
		},

		_bindProps: function () {
			// setup ad hoc prop bindings
			// Example: vuecomponent:xyz="{binding SomeProperty}"
			// Establishes a one way binding of SomeProperty -> component's xyz prop
			for (var prop in this._vm.$options.props) {
				if (Object.getPrototypeOf(this).hasOwnProperty("get_" + prop))
					console.warn("Prop '" + prop + "' will not be bound to " + this.get_component() + " component because it is a reserved property of the VueComponent control.");
				else
					this._bindProp(prop, this._getValue(prop));
			}
		},

		_setProp: function (propName, value) {
			this._vm[propName] = value;
		},

		_preventVueObservability: function(value) {
			if (value && typeof value === 'object') {
				if (value.length && Array.isArray(value)) {
					var _this = this;
					var hasExoWebEntities = false;
					value.forEach(function (o) {
						if (_this._preventVueObservability(o))
							hasExoWebEntities = true;
					});
					return hasExoWebEntities;
				}
				else if (value instanceof ExoWeb.Model.Entity) {
					preventVueObservability(value);
					return true;
				}
				else if (value instanceof ExoWeb.View.Adapter) {
					var hasExoWebEntities = this._preventVueObservability(value.get_rawValue());
					return hasExoWebEntities || value.get_isEntity() || value.get_isEntityList();
				}
			}
		},

		_getValue: function(vueProp) {
			var value = this[toKebabCase(vueProp)];
			if (this._preventVueObservability(value)) {
				if (ExoWeb.config.debug)
					console.warn("Don't pass ExoWeb objects to Vue components, component = " + this.get_component() + ", prop=" + vueProp + ".", value);
			}
			return value;
		},

		_bindProp: function(propName, value) {
			if (value instanceof ExoWeb.View.Adapter) {
				this._setProp(propName, value.get_rawValue());
				value.add_propertyChanged(function () {
					var rawValue = value.get_rawValue();
					this._preventVueObservability(rawValue);
					this._setProp(propName, rawValue);
				}.bind(this));
			}
			else {
				if (value !== undefined)
					this._setProp(propName, value);

				ExoWeb.Observer.addPropertyChanged(this, toKebabCase(propName), function () {
					this._setProp(propName, this._getValue(propName));
				}.bind(this));
			}
		},

		_bindModel: function() {
			// setup v-model binding
			// vuecomponent:model="{@ Property}" establishes a two way binding between Property and the component's
			// model prop. Property will be updated with the value emitted on the component's model event.
			// https://vuejs.org/v2/guide/components-custom-events.html#Customizing-Component-v-model
			var model = this.get_model();
			if (model instanceof ExoWeb.View.Adapter) {
				var modelOptions = this._vm.$options.model || { prop: "value", event: "input" };
				this._bindProp(modelOptions.prop, model);
				this._vm.$on(modelOptions.event, function (val) {
					model.set_rawValue(val);
				});
			}
		},

		_bindEventHandler: function(propName) {
			var that = this;
			this._vm.$on(propName.substring(1), function() {
				that._getValue(propName).apply(null, arguments);
			});

		},

		_bindEventHandlers: function() {
			for (var prop in this) {
				if (prop.indexOf("@") === 0 && typeof this[prop] === "function") {
					this._bindEventHandler(prop);
				}
			}
		},

		initialize: function() {
			VueComponent.callBaseMethod(this, "initialize");

			var element = this.get_element();
			var mountPoint = document.createElement(element.tagName);
			element.appendChild(mountPoint);

			if (!window.VueComponents)
				console.error("VueComponents global was not found. Please make sure the component library is loaded correctly before trying to use this control.");
			else if (!VueComponents[this.get_component()])
				console.error("No component named '" + this.get_component() + "' was found in the component library.");
			else {
				VueComponents[this.get_component()].load().then(function (Component) {
					var propsData = {};
					// ensure props are provided to component constructor
					for (var prop in Component.options.props) {
						var value = this._getValue(prop);
						if (value instanceof ExoWeb.View.Adapter)
							value = value.get_rawValue();
						propsData[prop] = value;
					}

					if (Component.options.functional) {
						this._vm = new Vue({
							template: '<c-component-wrapper ref="component" v-bind="$props" />',
							components: { 'c-component-wrapper': Component },
							props: Object.keys(propsData),
							propsData: propsData
						});
					}
					else {
						this._vm = new Component({
							propsData: propsData
						});
					}

					// retroactively connect parent-child relationship to aid vue devtools
					// passing parent during construction breaks reactivity for object and array
					// type props
					var parent = this._vm.$parent = this.get_parent();
					if (parent)
						parent.$children.push(this._vm);

					this._bindModel();
					this._bindProps();
					this._bindEventHandlers();

					if (typeof this._setup === "function")
						this._setup(this._vm, this._model);
					this._vm.$mount(mountPoint);
				}.bind(this));
			}
		},

		dispose: function () {
			if (this._vm) {
				try {
					this._vm.$destroy();
				}
				catch (e) {
					// Ignore error destroying component
				}
			}
		}
	};

	/**
	 * Prevent Vue from making an object observable.
	 * Adapted from VueModel -  https://github.com/cognitoforms/VueModel/blob/master/src/vue-model-observability.ts
	 */
	function preventVueObservability(obj) {
		if (obj && !obj.hasOwnProperty("__ob__")) {
			// Mark the object as "raw" so that Vue won't try to make it observable
			Vue.markRaw(obj);
			return true;
		}
	}

	ExoWeb.UI.VueComponent = VueComponent;
	VueComponent.registerClass("ExoWeb.UI.VueComponent", Sys.UI.Control, Sys.UI.ITemplateContextConsumer);

	// #endregion

	// #region ExoWeb.UI.Template
	//////////////////////////////////////////////////

	function Template(element) {
		/// <summary locid="M:J#ExoWeb.UI.Template.#ctor">
		/// In addition to defining template markup, also defines rules that are used
		/// to determine if it should be chosen as the template for a given element
		/// based on a CSS selector as well as a javascript filter that is evaluated 
		/// against the element in question.
		/// </summary>
		/// <param name="element"></param>
		Template.initializeBase(this, [element]);
	}

	var allTemplates = {};

	Template.prototype = {

		get_name: function Template$get_name() {
			/// <value mayBeNull="true" type="String" locid="P:J#ExoWeb.UI.Template.name"></value>
			return this._name;
		},
		set_name: function Template$set_name(value) {
			this._name = value;
		},

		get_nameArray: function Template$get_nameArray() {
			/// <value mayBeNull="true" type="String" locid="P:J#ExoWeb.UI.Template.nameArray"></value>
			if (this._name && !this._nameArray) {
				this._nameArray = this._name.trim().split(/\s+/);
			}
			return this._nameArray;
		},

		get_kind: function Template$get_kind() {
			/// <value mayBeNull="true" type="String" locid="P:J#ExoWeb.UI.Template.kind"></value>
			return this._kind;
		},
		set_kind: function Template$set_kind(value) {
			this._kind = value;
		},

		get_dataType: function Template$get_dataType() {
			/// <value mayBeNull="true" type="String" locid="P:J#ExoWeb.UI.Template.dataType"></value>
			return this._dataType;
		},
		set_dataType: function Template$set_dataType(value) {
			if (ExoWeb.isType(value, Function)) {
				this._dataType = parseFunctionName(value);
				this._dataTypeCtor = value;
			}
			else if (ExoWeb.isType(value, String)) {
				this._dataType = value;
			}
		},

		get_dataTypeCtor: function Template$get_dataTypeCtor() {
			/// <value mayBeNull="true" type="String" locid="P:J#ExoWeb.UI.Template.dataTypeCtor"></value>
			if (!this._dataTypeCtor && ExoWeb.isType(this._dataType, String)) {
				// lazy evaluate the actual constructor
				this._dataTypeCtor = ExoWeb.getCtor(this._dataType);
			}
			return this._dataTypeCtor;
		},

		get_isReference: function Template$get_isReference() {
			/// <value mayBeNull="true" type="Boolean" locid="P:J#ExoWeb.UI.Template.isReference"></value>
			return this._isReference;
		},
		set_isReference: function Template$set_isReference(value) {
			if (value && value.constructor === String) {
				var str = value.toLowerCase().trim();
				if (str === "true") {
					value = true;
				}
				else if (str === "false") {
					value = false;
				}
				else {
					this._isReferenceText = value;
					value = null;
				}
			}
			this._isReference = value;
		},

		get_isList: function Template$get_isList() {
			/// <value mayBeNull="true" type="Boolean" locid="P:J#ExoWeb.UI.Template.isList"></value>
			return this._isList;
		},
		set_isList: function Template$set_isList(value) {
			if (value && value.constructor === String) {
				var str = value.toLowerCase().trim();
				if (str === "true") {
					value = true;
				}
				else if (str === "false") {
					value = false;
				}
				else {
					this._isListText = value;
					value = null;
				}
			}
			this._isList = value;
		},

		get_aspects: function Template$get_aspects() {
			/// <value mayBeNull="true" type="Boolean" locid="P:J#ExoWeb.UI.Template.aspects"></value>
			if (!this._aspects) {
				var aspects = this._aspects = {};
				if (this._isList !== null && this._isList !== undefined) {
					aspects.isList = this._isList;
				}
				if (this._isReference !== null && this._isReference !== undefined) {
					aspects.isReference = this._isReference;
				}
				if (this.get_dataType() !== null && this.get_dataType() !== undefined) {
					aspects.dataType = this.get_dataTypeCtor();
				}
			}
			return this._aspects;
		},

		isCorrectKind: function Template$isCorrectKind(obj) {
			/// <summary locid="M:J#ExoWeb.UI.Template.isCorrectKind">
			/// Determines whether the given object is of the correct kind
			/// for the template, if a kind is specified.
			/// </summary>
			/// <param name="obj" optional="false" mayBeNull="false"></param>
			/// <returns type="Boolean"></returns>
			if (obj instanceof ExoWeb.View.Adapter) {
				return this._kind === "@";
			}
			else {
				return this._kind === undefined;
			}
		},

		_namesSatisfiedBy: function Template$_namesSatisfiedBy(names) {
			/// <summary locid="M:J#ExoWeb.UI.Template._namesSatisfiedBy">
			/// Determines whether the given names collection satisifes all
			/// required template names.
			/// </summary>
			/// <param name="names" type="Array" optional="false" mayBeNull="false"></param>
			/// <returns type="Boolean"></returns>
			return !this.get_nameArray() || !this.get_nameArray().some(function(n) { return !names.contains(n); });
		},

		_aspectsSatisfiedBy: function Template$_aspectsSatisfiedBy(aspects) {
			/// <summary locid="M:J#ExoWeb.UI.Template._aspectsSatisfiedBy">
			/// Determines whether the given data satisfies special aspects
			/// required by the template.
			/// </summary>
			/// <param name="aspects" type="Array" optional="false" mayBeNull="false"></param>
			/// <returns type="Boolean"></returns>
			var satisfied = true;
			eachProp(this.get_aspects(), function(name, value) {
				if (!aspects.hasOwnProperty(name) || (value === null || value === undefined) || (name !== "dataType" && aspects[name] !== value) || (name === "dataType" && aspects[name] !== value && !(aspects[name] && aspects[name].meta && aspects[name].meta.isSubclassOf(value.meta)))) {
					return (satisfied = false);
				}
			});
			return satisfied;
		},

		matches: function Template$matches(data, names) {
			/// <summary locid="M:J#ExoWeb.UI.Template.matches">
			/// Determines whether the given data and name array match the template.
			/// </summary>
			/// <param name="data" optional="false" mayBeNull="false"></param>
			/// <param name="names" type="Array" optional="false" mayBeNull="false"></param>
			/// <returns type="Boolean"></returns>
			if (this._namesSatisfiedBy(names)) {
				var aspects;
				if (data && data.aspects && data.aspects instanceof Function) {
					aspects = data.aspects();
				}
				else {
					aspects = {
						isList: (data && data instanceof Array),
						isReference: (data && data instanceof ExoWeb.Model.Entity)
					};
					if (data === null || data === undefined) {
						aspects.dataType = null;
					}
					else if (data instanceof ExoWeb.Model.Entity) {
						aspects.dataType = data.meta.type.get_jstype();
					}
					else if (data instanceof Array) {
						aspects.dataType = Array;
					}
					else if (data instanceof Object) {
						aspects.dataType = Object;
					}
					else {
						aspects.dataType = data.constructor;
					}
				}
				return this._aspectsSatisfiedBy(aspects);
			}
		},

		toString: function() {
			return $format("<{0} name=\"{1}\" kind=\"{2}\" datatype=\"{3}\" isreference=\"{4}\" islist=\"{5}\" />",
				this._element.tagName.toLowerCase(),
				this._name || "",
				this._kind || "",
				this._dataType || "",
				isNullOrUndefined(this._isReference) ? "" : this._isReference,
				isNullOrUndefined(this._isList) ? "" : this._isList
			);
		},

		dispose: function Template$dispose() {
			this._aspects = this._contentTemplate = this._dataType = this._dataTypeCtor = this._isList = this._isListText =
				this._isReference = this._isReferenceText = this._kind = this._name = this._nameArray = null;
			ExoWeb.UI.Template.callBaseMethod(this, "dispose");
		},

		initialize: function() {
			/// <summary locid="M:J#ExoWeb.UI.Template.initialize" />
			Template.callBaseMethod(this, "initialize");

			// add a class that can be used to search for templates 
			// and make sure that the template element is hidden
			jQuery(this._element).addClass("exoweb-template").hide();

			if (this._element.control.constructor !== String) {
				var el = this._element;
				var tagName = el.tagName.toLowerCase();
				var cache = allTemplates[tagName];
				if (!cache) {
					cache = allTemplates[tagName] = [];
				}
				cache.push(el);
			}
		}

	};

	function findTemplate(tagName, data, names) {
		/// <summary locid="M:J#ExoWeb.UI.Template.find">
		/// Finds the first field template that match the given data and names and returns the template.
		/// </summary>

		if (data === undefined || data === null) {
			logWarning("Attempting to find template for " + (data === undefined ? "undefined" : "null") + " data.");
		}

		var cache;
		if (cache = allTemplates[tagName]) {
			for (var t = cache.length - 1; t >= 0; t--) {
				var tmplEl = cache[t];
				var tmpl = tmplEl.control;
	
				if (tmpl instanceof Template) {
					var isCorrectKind = tmpl.isCorrectKind(data);
					if ((isCorrectKind === undefined || isCorrectKind === true) && tmpl.matches(data, names)) {
						return tmplEl;
					}
				}
			}
		}

		return null;
	}

	// bookkeeping for Template.load
	// TODO: consider wrapper object to clean up after templates are loaded?
	var templateCount = 0;
	var externalTemplatesSignal = new ExoWeb.Signal("external templates");
	var lastTemplateRequestSignal;

	Template.load = function Template$load(path, options) {
		/// <summary locid="M:J#ExoWeb.UI.Template.load">
		/// Loads external templates into the page.
		/// </summary>

		var id = "exoweb-templates-" + (templateCount++);

		var lastReq = lastTemplateRequestSignal;

		// set the last request signal to the new signal and increment
		var signal = lastTemplateRequestSignal = new ExoWeb.Signal(id);
		var callback = externalTemplatesSignal.pending(signal.pending(function () {
			// Activate template controls within the response.
			Sys.Application.activateElement(this);
		}));

		jQuery(function ($) {
			var tmpl = jQuery("<div id='" + id + "'/>")
					.hide()
					.appendTo("body");

			//if the template is stored locally look for the path as a div on the page rather than the cache
			if (options && options.isLocal === true) {
				var localTemplate = jQuery('#' + path);
				callback.call(localTemplate.get(0));
			}
			else {
				var html = ExoWeb.cache(path);

				if (html) {
					tmpl.append(html);
					callback.call(tmpl.get(0));
				} 
				else {
					tmpl.load(path, function(responseText, textStatus, jqXHR) {
						// Ensure that jqXHR is loaded.  'state' check for jquery 1.7+, 'isResolved' check for jQuery 1.5 - 1.7
						if ((jqXHR.state && jqXHR.state() === "resolved") || (jqXHR.isResolved && jqXHR.isResolved())) {
							// Cache the template
							ExoWeb.cache(path, responseText);

							// if there is a pending request then wait for it to complete
							if (lastReq) {
								lastReq.waitForAll(callback, this);
							}
							else {
								callback.call(this);
							}
						}
					});
				}
			}
		});
	};

	ExoWeb.UI.Template = Template;
	Template.registerClass("ExoWeb.UI.Template", Sys.UI.Control, Sys.UI.IContentTemplateConsumer);

	// #endregion

	// #region ExoWeb.UI.Content
	//////////////////////////////////////////////////

	function Content(element) {
		/// <summary locid="M:J#ExoWeb.UI.Content.#ctor">
		/// Finds its matching template and renders using the provided data as the 
		/// binding context.  It can be used as a "field control", using part of the 
		/// context data to select the appropriate control template.  Another common 
		/// usage would be to select the appropriate template for a portion of the UI,
		/// as in the example where an objects meta type determines how it is 
		/// displayed in the UI.
		/// </summary>
		/// <param name="element"></param>
		Content.initializeBase(this, [element]);
	}

	var contentControlsRendering = 0;

	registerActivity("Content rendering", function() {
		if (contentControlsRendering < 0) {
			logWarning("Number of content controls rendering should never dip below zero.");
		}

		return contentControlsRendering > 0;
	});

	Content.prototype = {

		get_template: function Content$get_template() {
			/// <value mayBeNull="true" type="String" locid="P:J#ExoWeb.UI.Content.template"></value>
			return this._template;
		},
		set_template: function (value) {
			this._template = value;
		},

		get_data: function Content$get_data() {
			/// <value mayBeNull="false" locid="P:J#ExoWeb.UI.Content.data"></value>
			return this._data;
		},
		set_data: function Content$set_data(value) {
			var removedData = ((value === undefined || value === null) && (this._data !== undefined && this._data !== null));

			if (this._changedHandler) {
				// Remove old change handler if applicable.
				Observer.removeCollectionChanged(this._data, this._changedHandler);
				delete this._changedHandler;
			}

			this._data = value;

			if (value instanceof Array) {
				// Watch for changes to an array.
				this._changedHandler = this._collectionChanged.bind(this);
				Observer.addCollectionChanged(value, this._changedHandler);
			}

			// Force rendering to occur if we previously had a value and now do not.
			this.update(removedData);
		},

		get_disabled: function Content$get_disabled() {
			/// <value mayBeNull="false" type="Boolean" locid="P:J#ExoWeb.UI.Content.disabled"></value>
			return this._disabled === undefined ? false : !!this._disabled;
		},
		set_disabled: function Content$set_disabled(value) {
			var newValue;

			if (value.constructor === Boolean) {
				newValue = value;
			}
			else if (value.constructor === String) {
				newValue = value.toLowerCase() == "true" ? true : (value.toLowerCase() == "false" ? false : undefined);
			}
			else {
				throw new Error("Invalid value for property \"disabled\": " + value);
			}

			var oldValue = this._disabled;
			this._disabled = newValue;

			if (oldValue === true && newValue === false) {
				this.update();
			}
		},

		get_contexts: function Content$get_contexts() {
			/// <value mayBeNull="false" type="Array" locid="P:J#ExoWeb.UI.Content.contexts"></value>
			return [this._context];
		},

		get_templateContext: function Content$get_templateContext() {
			/// <value mayBeNull="false" type="Sys.UI.TemplateContext" locid="P:J#ExoWeb.UI.Content.templateContext"></value>
			if (!this._parentContext) {
				this._parentContext = Sys.UI.Template.findContext(this._element);
			}
			return this._parentContext;
		},
		set_templateContext: function Context$set_templateContext(value) {
			this._parentContext = value;
		},

		get_isRendered: function Context$get_isRendered() {
			/// <value mayBeNull="false" type="Boolean" locid="P:J#ExoWeb.UI.Content.isRendered"></value>
			return this._isRendered;
		},

		add_rendering: function Content$add_rendering(handler) {
			/// <summary locid="E:J#ExoWeb.UI.Content.rendering" />
			this._addHandler("rendering", handler);
		},
		remove_rendering: function Content$remove_rendering(handler) {
			this._removeHandler("rendering", handler);
		},

		add_rendered: function Content$add_rendered(handler) {
			/// <summary locid="E:J#ExoWeb.UI.Content.rendered" />
			this._addHandler("rendered", handler);
		},
		remove_rendered: function Content$remove_rendered(handler) {
			this._removeHandler("rendered", handler);
		},

		add_error: function (handler) {
			/// <summary locid="E:J#ExoWeb.UI.Content.error" />
			this._addHandler("error", handler);
		},
		remove_error: function (handler) {
			this._removeHandler("error", handler);
		},

		_collectionChanged: function (sender, args) {
			this.update(true);
		},

		_initializeResults: function Content$_initializeResults() {
			if (this._context) {
				this._context.initializeComponents();
			}
		},

		_generatesContext: function Content$_generatesContext() {
			return true;
		},
		_setTemplateCtxId: function Content$_setTemplateCtxId(idx) {
			this._ctxIdx = idx;
		},

		_findTemplate: function Content$_findTemplate() {
			/// <summary locid="M:J#ExoWeb.UI.Content._findTemplate">
			/// Find the first matching template for the content control.
			/// </summary>
			var tmplNames;
			if (this._contentTemplate) {
				tmplNames = this._contentTemplate;
			}
			if (this._template) {
				if (tmplNames) {
					tmplNames += " ";
					tmplNames += this._template;
				}
				else {
					tmplNames = this._template;
				}
			}

			var tmplEl = findTemplate(this._element.tagName.toLowerCase(), this._data, tmplNames ? tmplNames.trim().split(/\s+/) : []);

			if (!tmplEl) {
				throw new Error($format("This content region does not match any available templates. Tag={0}, Data={1}, Template={2}", this._element.tagName.toLowerCase(), this._data, tmplNames || ""));
			}

			return tmplEl;
		},

		_canRender: function Content$_canRender(force) {
			/// <summary locid="M:J#ExoWeb.UI.Content._canRender">
			/// Ensure that the control is initialized, has an element, and the "data" property has been set.
			/// 1) The set_data method may be called before the control has been initialized.
			/// 2) If a lazy markup extension is used to set the "data" property then a callback could set the 
			/// property value when the element is undefined, possibly because of template re-rendering.
			/// 3) If a lazy markup extension is used to set the "data" property then it may not have a value when initialized.
			/// Also check that the control has not been disabled.
			/// </summary>

			return ((this._data !== undefined && this._data !== null) || force === true) &&
				this.get_isInitialized() && this._element !== undefined && this._element !== null && !this.get_disabled();
		},

		_getResultingTemplateNames: function Content$_getResultingTemplateNames(tmplEl) {
			// use sys:content-template (on content control) and content:template
			var contentTemplateNames;
			if (this._contentTemplate) {
				contentTemplateNames = this._contentTemplate;
				if (this._template) {
					contentTemplateNames += " " + this._template;
				}
			}
			else if (this._template) {
				contentTemplateNames = this._template;
			}
			else {
				contentTemplateNames = "";
			}

			var contentTemplate = contentTemplateNames.trim().split(/\s+/).distinct();

			// Remove names matched by the template
			if (contentTemplate.length > 0) {
				var tmplNames = tmplEl.control.get_nameArray();
				if (tmplNames) {
					purge(contentTemplate, function(name) {
						return tmplNames.indexOf(name) >= 0;
					});
				}
			}

			// Add sys:content-template defined on the template element
			if (tmplEl.control._contentTemplate) {
				contentTemplate.addRange(tmplEl.control._contentTemplate.trim().split(/\s+/));
			}

			return contentTemplate;
		},

		_render: function Content$_render() {
			/// <summary locid="M:J#ExoWeb.UI.Content._render">
			/// Render the content template into the container element.
			/// </summary>

			// Failing to empty content before rendering can result in invalid content since rendering 
			// content is not necessarily in order because of waiting on external templates.
			var container = this._element;

			jQuery(container).empty();

			var parentContext = this.get_templateContext();
			this._context = null;

			var data = this._data;
			if (data !== null && data !== undefined) {
				var tmplEl = this._findTemplate();
				var template = new Sys.UI.Template(tmplEl);

				// get custom classes from template
				var classes = jQuery(tmplEl).attr("class");
				if (classes) {
					classes = jQuery.trim(classes.replace("exoweb-template", "").replace("sys-template", ""));
					jQuery(container).addClass(classes);
				}

				// Get the list of template names applicable to the control's children
				var contentTemplate = this._getResultingTemplateNames(tmplEl);

				this._context = template.instantiateIn(container, this._data, this._data, 0, null, parentContext, contentTemplate.join(" "));

				this._initializeResults();
			}
		},

		_renderStart: function Content$_renderStart(force) {
			/// <summary locid="M:J#ExoWeb.UI.Content._renderStart">
			/// Start the rendering process. There may be a delay if external templates
			/// have not yet finished loading.
			/// </summary>
			if (this._canRender(force)) {
				contentControlsRendering++;

				externalTemplatesSignal.waitForAll(function () {
					if (this._element === undefined || this._element === null) {
						contentControlsRendering--;
						return;
					}

					var renderArgs = new Sys.Data.DataEventArgs(this._data);
					Sys.Observer.raiseEvent(this, "rendering", renderArgs);

					this._isRendered = false;

					try {
						this._render();
						this._isRendered = true;
						Sys.Observer.raiseEvent(this, "rendered", renderArgs);
					}
					finally {
						contentControlsRendering--;
					}
				}, this);
			}
		},

		_link: function () {
			if (!this._ctxIdx && this._element && this._element.childNodes.length > 0)
				throw new Error("A content control is attached to the node, which expects a template context id, but no id was specified.");

			if ((this._data !== null && this._data !== undefined) || (this._element && this._element.childNodes.length > 0)) {
				var pctx = this.get_templateContext();
				var tmplEl = this._findTemplate();

				var newContext = new Sys.UI.TemplateContext(this._ctxIdx);
				newContext.data = this._data;
				newContext.components = [];
				newContext.nodes = [];
				newContext.dataItem = this._data;
				newContext.index = 0;
				newContext.parentContext = pctx;
				newContext.containerElement = this._element;
				newContext.template = new Sys.UI.Template(tmplEl);
				newContext.template._ensureCompiled();

				this._context = newContext;

				// Get the list of template names applicable to the control's children
				var contentTemplate = this._getResultingTemplateNames(tmplEl);

				var element = this._element;
				Sys.Application._linkContexts(pctx, this, this._data, element, newContext, contentTemplate.join(" "));

				for (var i = 0; i < element.childNodes.length; i++) {
					newContext.nodes.push(element.childNodes[i]);
				}

				newContext._onInstantiated(null, true);
				this._initializeResults();
			}
		},

		link: function Content$link() {
			/// <summary locid="M:J#ExoWeb.UI.Content.link" />
			if (!this._linkInProgress) {
				this._linkInProgress = true;
				contentControlsRendering++;
				externalTemplatesSignal.waitForAll(function () {
					// Control has disposed.
					if (this._element === undefined || this._element === null) {
						ExoWeb.UI.Content.callBaseMethod(this, 'link');
						contentControlsRendering--;
						return;
					}

					try {
						delete this._linkInProgress;
						this._isRendered = true;
						this._context = null;
						this._link();
						ExoWeb.UI.Content.callBaseMethod(this, 'link');
					}
					finally {
						contentControlsRendering--;
					}
				}, this);
			}
		},

		update: function Content$update(force) {
			if (this.get_isLinkPending()) {
				if (this.hasOwnProperty("_data")) {
					this.link();
				}
			}
			else if (this._canRender(force)) {
				this._renderStart(force);
			}
		},

		dispose: function ExoWeb$UI$Content$dispose() {
			if (this._context) {
				this._context.dispose();
			}
			if (this._changedHandler) {
				Observer.removeCollectionChanged(this._data, this._changedHandler);
				this._changedHandler = null;
			}
			this._contentTemplate = this._context = this._ctxIdx =
				this._data = this._disabled = this._isRendered = this._parentContext = this._template = null;
			ExoWeb.UI.Content.callBaseMethod(this, "dispose");
		},

		initialize: function Content$initialize() {
			/// <summary locid="M:J#ExoWeb.UI.Content.initialize" />
			Content.callBaseMethod(this, "initialize");

			if (jQuery(this._element).is(".sys-template")) {
				if (jQuery(this._element).children().length > 0) {
					logWarning("Content control is marked with the \"sys-template\" class, which means that its children will be ignored and discarded.");
				}
				else {
					logWarning("No need to mark a content control with the \"sys-template\" class.");
				}
			}
			this.update();
		}

	};

	ExoWeb.UI.Content = Content;
	Content.registerClass("ExoWeb.UI.Content", Sys.UI.Control, Sys.UI.ITemplateContextConsumer, Sys.UI.IContentTemplateConsumer);

	// #endregion

	// #region ExoWeb.UI.DataView
	//////////////////////////////////////////////////

	var dataViewsRendering = 0;

	registerActivity("DataView rendering", function() {
		if (dataViewsRendering < 0) {
			logWarning("Number of dataview controls rendering should never dip below zero.");
		}

		return dataViewsRendering > 0;
	});

	var dataViewRefresh = Sys.UI.DataView.prototype.refresh;
	Sys.UI.DataView.prototype.refresh = function refresh() {
		dataViewsRendering++;

		if (this.get_element()) {
			dataViewRefresh.apply(this, arguments);
		}
		else {
			logWarning("Attempting to refresh, but DataView was being disposed.");
		}

		dataViewsRendering--;
	};

	// #endregion

	// #region ExoWeb.UI.Html
	//////////////////////////////////////////////////

	function Html(element) {
		/// <summary>
		/// </summary>
		/// <example>
		///		<div sys:attach="html" html:url="http://www.google.com"></div>
		/// </example>

		Html.initializeBase(this, [element]);
	}

	Html.prototype = {
		get_source: function Html$get_source() {
			return this._source;
		},
		set_source: function Html$set_source(value) {
			this._source = value;
		},
		get_loadingClass: function Html$get_loadingClass() {
			return this._loadingClass;
		},
		set_loadingClass: function Html$set_loadingClass(value) {
			this._loadingClass = value;
		},
		get_url: function Html$get_url() {
			return this._url;
		},
		set_url: function Html$set_url(value) {
			this._url = value;
		},
		get_path: function Html$get_path() {
			var source = this.get_source();
			var url = this.get_url();
			if (source instanceof ExoWeb.Model.Entity) {
				url = source.toString(url);
			}
			return $format(url, source);
		},
		initialize: function Html$initialize() {
			Html.callBaseMethod(this, "initialize");

			var path = this.get_path();
			var element = this.get_element();
			var loadingClass = this.get_loadingClass();

			jQuery(element).addClass(loadingClass);

			jQuery(element).load(path, function(responseText, status, response) {
				jQuery(element).removeClass(loadingClass);

				if (status != "success" && status != "notmodified") {
					throw new Error("Failed to load html: status = " + status);
				}
			});
		}
	};

	ExoWeb.UI.Html = Html;
	Html.registerClass("ExoWeb.UI.Html", Sys.UI.Control);

	// #endregion

	// #region ExoWeb.UI.Behavior
	//////////////////////////////////////////////////

	function Behavior(element) {
		/// <summary>
		/// </summary>
		/// <example>
		///		<div sys:attach="behavior" behavior:script="Sys.scripts.Foo" behavior:typename="My.Class" behavior:prop-foo="bar"></div>
		/// </example>

		Behavior.initializeBase(this, [element]);
	}

	Behavior.prototype = {
		get_script: function Behavior$get_script() {
			return this._script;
		},
		set_script: function Behavior$set_script(value) {
			this._script = value;
		},
		get_scriptObject: function Behavior$get_script() {
			if (!this._scriptObject) {
				var path = this._script.startsWith("window") ?
					this._script.substring(7) :
					this._script;

				this._scriptObject = ExoWeb.evalPath(window, path);
			}

			return this._scriptObject;
		},
		get_typeName: function Behavior$get_typeName() {
			return this._typeName;
		},
		set_typeName: function Behavior$set_typeName(value) {
			this._typeName = value;
		},

		// NOTE: Keep these properties around for backwards compatibility.
		get_class: function Behavior$get_class() {
			logWarning("The behavior:class property is deprecated (see issue #1). Consider using behavior:typename instead.");

			return this._typeName;
		},
		set_class: function Behavior$set_class(value) {
			logWarning("The behavior:class property is deprecated (see issue #1). Consider using behavior:typename instead.");

			this._typeName = value;
		},

		get_dontForceLoad: function Behavior$get_dontForceLoad() {
			return this._dontForceLoad;
		},
		set_dontForceLoad: function Behavior$set_dontForceLoad(value) {
			this._dontForceLoad = value;
		},
		get_ctorFunction: function Behavior$get_ctorFunction() {
			if (!this._ctorFunction) {
				this._ctorFunction = ExoWeb.getCtor(this._typeName);
			}

			return this._ctorFunction;
		},
		get_properties: function Behavior$get_properties() {
			if (!this._properties) {
				this._properties = {};
				for (var prop in this) {
					if (prop.startsWith("prop_") && !prop.startsWith("prop_add_")) {
						var ctor = this.get_ctorFunction();
						if (!ctor) {
							throw new Error($format("Could not evaulate type '{0}'.", this._typeName));
						}

						var name = Sys.Application._mapToPrototype(prop.substring(5), ctor);

						if (!name) {
							throw new Error($format("Property '{0}' could not be found on type '{1}'.", prop.substring(5), this._typeName));
						}

						this._properties[name] = this[prop];
					}
				}
			}

			return this._properties;
		},
		get_events: function Behavior$get_events() {
			if (!this._events) {
				this._events = {};
				for (var prop in this) {
					if (prop.startsWith("prop_add_")) {
						var ctor = this.get_ctorFunction();
						if (!ctor) {
							throw new Error($format("Could not evaulate type '{0}'.", this._typeName));
						}

						var name = Sys.Application._mapToPrototype(prop.substring(9), ctor);

						if (!name) {
							throw new Error($format("Event '{0}' could not be found on type '{1}'.", prop.substring(9), this._typeName));
						}

						this._events[name] = this[prop];
					}
				}
			}

			return this._events;
		},
		_create: function Behavior$create() {
			// if the element is not within the document body it 
			// probably means that it is being removed - TODO: verify
			if (!jQuery.contains(document.body, this._element)) {
				return;
			}

			this._behavior = $create(this.get_ctorFunction(), this.get_properties(), this.get_events(), null, this._element);
		},
		initialize: function Behavior$initialize() {
			Behavior.callBaseMethod(this, "initialize");

			if (!this._dontForceLoad) {
				Sys.require([this.get_scriptObject()], this._create.bind(this));
			}
			else {
				this._create();
			}
		}
	};

	ExoWeb.UI.Behavior = Behavior;
	Behavior.registerClass("ExoWeb.UI.Behavior", Sys.UI.Control);

	// #endregion

	// #region ExoWeb.UI.Utilities
	//////////////////////////////////////////////////

	function getTemplateSubContainer(childElement) {
		var element = childElement;

		function isDataViewOrContent(el) {
			return (el.control && el.control instanceof Sys.UI.DataView) ||
				(el.control && el.control instanceof ExoWeb.UI.Content);
		}

		// find the first parent that has an attached ASP.NET Ajax dataview or ExoWeb content control (ignore toggle)
		while (element.parentNode && !isDataViewOrContent(element.parentNode)) {
			element = element.parentNode;
		}

		// containing template was not found
		if (element.parentNode && isDataViewOrContent(element.parentNode)) {
			return element;
		}
	}

	function getDataForContainer(container, subcontainer, index) {
		var data = null;

		if (container) {
			if (container.control instanceof Sys.UI.DataView || container.control instanceof ExoWeb.UI.Content) {
				var containerContexts = container.control.get_contexts();
				var containerData = container.control.get_data();

				// ensure an array for conformity
				if (!(containerData instanceof Array)) {
					containerData = [containerData];
				}

				if (containerContexts) {
					// if there is only one context in the array then the index must be zero
					if (containerContexts.length == 1) {
						index = 0;
					}

					if (index !== undefined && index !== null && index.constructor === Number) {
						if (index < containerContexts.length) {
							var indexedContext = containerContexts[index];
							var indexedData = containerData[index];
							data = (indexedContext) ? indexedContext.dataItem : indexedData;
						}
					}
					else {
						// try to find the right context based on the element's position in the dom
						for (var i = 0, l = containerContexts.length; i < l; i++) {
							var childContext = containerContexts[i];
							if (!childContext) {
								var contextsFromDom = map(container.children, function(e) { return Sys.UI.Template.findContext(e.firstChild); }).distinct();
								var matchingContext = contextsFromDom.single(function(tc) { return Sys._indexOf(tc.nodes, subcontainer) >= 0; });
								if (matchingContext) {
									data = matchingContext.dataItem;
									break;
								}
							}
							else if (childContext.containerElement === container && Sys._indexOf(childContext.nodes, subcontainer) > -1) {
								data = childContext.dataItem;
								break;
							}

						}
					}
				}
			}
		}

		return data;
	}

	function getParentContext(options/*{ target, subcontainer, index, level, dataType, ifFn }*/) {
		/// <summary>
		/// 	Finds the template context data based on the given options.
		/// </summary>
		/// <param name="options" type="Object">
		/// 	The object which contains the options to use.
		/// 	target:  The target from which to start searching.  This can be an HTML
		/// 					element, a control, or a template context.
		/// 		index (optional):  The index of the desired context.  If the desired context
		/// 					is one level up and is part of a list, this argument can be used
		/// 					to specify which template context to return.
		/// 		level (optional):  The number of levels to travel.  By default this is "1",
		/// 					which means that the immediate parent context data will be returned.
		/// 		dataType (optional):  If specified, this type is used as the type of data to search
		/// 					for.  When context data of this type is encountered it is returned.
		/// 					Note that arrays are not supported.  If the data is an array and the
		/// 					type of items must be checked, use the "ifFn" argument.
		/// 		ifFn (optional):  A function that determines whether the correct data has been
		/// 					found.  The context data is returned as soon as the result of calling 
		/// 					this function with the current data and container is true.
		/// </param>
		/// <returns type="Object" />

		var target = options.target, effectiveLevel = options.level || 1, container, subcontainer = options.subcontainer, i = 0, searching = true, context, data;

		if (target.control && (target.control instanceof Sys.UI.DataView || target.control instanceof ExoWeb.UI.Content)) {
			target = target.control;
		}
		else if (target instanceof Sys.UI.Template) {
			target = target.get_element();
		}
		else if (target instanceof Sys.UI.TemplateContext) {
			target = target.containerElement;
		}

		while (searching === true) {
			// if we are starting out with a dataview then look at the parent context rather than walking 
			// up the dom (since the element will probably not be present in the dom)
			if (!container && (target instanceof Sys.UI.DataView || target instanceof ExoWeb.UI.Content)) {
				context = target.get_templateContext();

				// If the control's context is the global context, then exit here with a custom result
				if (context._global === true) {
					return { data: null, global: true, container: document.documentElement, subcontainer: target.get_element() };
				}

				container = context.containerElement;

				if (container.control instanceof Toggle)
					container = Sys.UI.Template.findContext(container).containerElement;
			
				if (options.target && options.target.tagName) {
					subcontainer = getTemplateSubContainer(options.target);
				}
			}
			else {
				var obj = container || target;
				subcontainer = getTemplateSubContainer(obj);

				if (!subcontainer) {
					// Back up and attempt to go through the control.
					if (obj.control && (obj.control instanceof Sys.UI.DataView || container.control instanceof ExoWeb.UI.Content)) {
						container = null;
						target = obj.control;
						continue;
					}

					throw Error.invalidOperation("Not within a container template.");
				}

				container = subcontainer.parentNode;
			}

			// Increment the counter to check against the level parameter.
			i++;

			// Get the context data for the current level.
			data = getDataForContainer(container, subcontainer, options.index);

			if (options.dataType) {
				// Verify that the current data is not the data type that we are looking for.
				searching = !data || !(data instanceof options.dataType || data.constructor === options.dataType);
			}
			else if (options.ifFn) {
				// Verify that the stop function conditions are not met.
				searching = !(options.ifFn.call(this, data, container));
			}
			else {
				// Finally, check the level.  If no level was specified then we will only go up one level.
				searching = i < effectiveLevel;
			}
		}

		return { data: data, container: container, subcontainer: subcontainer };
	}

	ExoWeb.UI.getParentContext = getParentContext;

	ExoWeb.UI.getParentContextData = function() {
		return getParentContext.apply(this, arguments).data;
	};

	window.$parentContextData = function $parentContextData(target, index, level, dataType, ifFn) {
		/// <summary>
		/// 	Finds the template context data based on the given options.
		/// </summary>
		/// <param name="target" type="Object">
		/// 	The target from which to start searching.  This can be an HTML element, a 
		/// 	control, or a template context.
		/// </param>
		/// <param name="index" type="Number" integer="true" optional="true">
		/// 	The index of the desired context.  If the desired context is one level
		/// 	up and is part of a list, this argument can be used to specify which
		/// 	template context to return.
		/// </param>
		/// <param name="level" type="Number" integer="true" optional="true">
		/// 	The number of levels to travel.  By default this is "1", which means that
		/// 	the immediate parent context data will be returned.
		/// </param>
		/// <param name="dataType" type="Function" optional="true">
		/// 	If specified, this type is used as the type of data to search for.  When context
		/// 	data of this type is encountered it is returned.  Note that arrays are not supported.
		/// 	If the data is an array and the type of items must be checked, use the "ifFn" argument.
		/// </param>
		/// <param name="ifFn" type="Function" optional="true">
		/// 	A function that determines whether the correct data has been found.  The context data
		/// 	is returned as soon as the result of calling this function with the current data and 
		/// 	container is true.
		/// </param>
		/// <returns type="Object" />

		return getParentContext({
			"target": target,
			"index": index,
			"level": level,
			"dataType": dataType,
			"ifFn": ifFn
		}).data;
	};

	function getIsLast(template, index) {
		/// <summary>
		/// 	Returns whether the data being rendered in the given template at the given index is 
		/// 	the last object in the list.
		///
		///		Example:
		///
		///		&lt; span sys:if="{{ $isLast(this, $index) }}" &gt;
		///
		/// </summary>
		/// <param name="template" type="Sys.UI.Template">The template that is being rendered.</param>
		/// <param name="index" type="Number" integer="true">The index of the current data item.</param>
		/// <returns type="Boolean" />

		var len = template.get_element().control.get_contexts().length;
		return index == len - 1;
	}

	window.$isLast = getIsLast;

	// #endregion

	// #region ExoWeb.View.AdapterMarkupExtension
	//////////////////////////////////////////////////

	Sys._Application.mixin(Functor.eventing);

	Sys._Application.prototype.addBeforeCreateAdapter = function Application$addBeforeCreateAdapter(handler) {
	    this._addEvent("beforeCreateAdapter", handler);
	};

	Sys._Application.prototype.removeBeforeCreateAdapter = function Application$removeBeforeCreateAdapter(handler) {
	    this._removeEvent("beforeCreateAdapter", handler);
	};

	Sys.Application.registerMarkupExtension(
		"@",
		function AdapterMarkupExtention(component, targetProperty, templateContext, properties) {
			if (properties.required) {
				logWarning("Adapter markup extension does not support the \"required\" property.");
			}

			var path = properties.path || properties.$default;
			delete properties.$default;

			var source;
			if (properties.source) {
				source = properties.source;
				delete properties.source;
			}
			else {
				source = templateContext.dataItem;
			}

			var adapter;
			if (!path) {
				if (!(source instanceof Adapter)) {
					throw new Error("No path was specified for the \"@\" markup extension, and the source is not an adapter.");
				}
				for (var prop in properties) {
					if (properties.hasOwnProperty(prop) && prop !== "isLinkPending") {
						throw new Error("Additional adapter properties cannot be specified when deferring to another adapter (no path specified). Found property \"" + prop + "\".");
					}
				}
				adapter = source;
			}
			else {
			    Sys.Application._raiseEvent("beforeCreateAdapter", [Sys.Application, { source: source, path: path, properties: properties }]);
				adapter = new Adapter(source, path, properties.format, properties);
				templateContext.components.push(adapter);
			}

			adapter.ready(function AdapterReady() {
				Observer.setValue(component, targetProperty, adapter);
			});
		},
		false
	);

	// #endregion

	// #region ExoWeb.View.MetaMarkupExtension
	//////////////////////////////////////////////////

	var bindingSetters = [];
	var setterExpr = /^set_(.*)$/;
	ExoWeb.eachProp(Sys.Binding.prototype, function(prop) {
		var name = setterExpr.exec(prop);
		if (name) {
			bindingSetters.push(name[1]);
		}
	});

	Sys.Application.registerMarkupExtension(
		"#",
		function MetaMarkupExtension(component, targetProperty, templateContext, properties) {
			if (properties.required) {
				logWarning("Meta markup extension does not support the \"required\" property.");
			}

			var options, element;

			if (Sys.Component.isInstanceOfType(component)) {
				element = component.get_element();
			}
			else if (Sys.UI.DomElement.isDomElement(component)) {
				element = component;
			}

			options = Sys._merge({
				source: templateContext.dataItem,
				templateContext: templateContext,
				target: component,
				targetProperty: targetProperty,
				property: element.nodeName === "SELECT" ? "systemValue" : "displayValue"
			}, properties);

			delete properties.$default;

			// remove properties that apply to the binding
			for (var p in properties) {
				if (properties.hasOwnProperty(p)) {
					if (bindingSetters.indexOf(p) >= 0) {
						delete properties[p];
					}
				}
			}

			options.path = options.path || options.$default;
			delete options.$default;

			var adapter = options.source = new Adapter(options.source || templateContext.dataItem, options.path, options.format, properties);

			options.path = options.property;
			delete options.property;
		
			templateContext.components.push(adapter);
			templateContext.components.push(Sys.Binding.bind(options));
		},
		false
	);

	// #endregion

	// #region ExoWeb.View.ConditionMarkupExtension
	//////////////////////////////////////////////////

	Sys.Application.registerMarkupExtension("?",
		function (component, targetProperty, templateContext, properties) {
			var options = Sys._merge({
				source: templateContext.dataItem,
				templateContext: templateContext,
				targetProperty: targetProperty
			}, properties);

			var meta = options.source.meta;

			options.type = options.type || options.$default;
			delete options.$default;

			options.single = options.single && (options.single === true || options.single.toString().toLowerCase() === "true");

			var types = options.type ? options.type.split(",") : null;

			var sets = options.set ? options.set.split(",") : null;

			var target = function () {
				if (options.target && options.target.constructor === String)
					return evalPath(options.source, options.target);
				return options.target;
			};

			function updateConditions() {
				var currentTarget = target();
				var conditions = meta.conditions().filter(function (c) {
					return (!types || types.indexOf(c.type.code) >= 0) && // check for type code match (if specified)
						(!sets || intersect(sets, c.type.sets.map(function (s) { return s.name; })).length > 0) && // check for set code match (if specified)
						(!target || c.targets.some(function (t) { return t.target === currentTarget; })); // check for target (if specified)
				});

				if (options.single === true) {
					if (conditions.length > 1) {
						throw new Error($format("Multiple conditions were found for type \"{0}\".", options.type));
					}

					conditions = conditions.length === 0 ? null : conditions[0];
				}

				Observer.setValue(component, properties.targetProperty || targetProperty, conditions);
			}

			updateConditions();
			meta.addConditionsChanged(updateConditions, meta);
		},
		false);

	// #endregion

	// #region ExoWeb.View.Binding
	//////////////////////////////////////////////////

	function Binding(templateContext, source, sourcePath, target, targetPath, options, scopeChain) {
		Binding.initializeBase(this);

		this._templateContext = templateContext;
		this._source = source;
		this._sourcePath = sourcePath;
		this._target = target;

		var pathLower = targetPath ? targetPath.toLowerCase() : targetPath;
		if (pathLower === "innertext") {
			this._targetPath = "innerText";
		}
		else if (pathLower === "innerhtml") {
			this._targetPath = "innerHTML";
		}
		else {
			this._targetPath = targetPath;
		}

		this._options = options || {};

		this._isTargetElement = Sys.UI.DomElement.isDomElement(target);

		this._updateImmediately = true;

		if (this._sourcePath) {
			// Start the initial fetch of the source value.
			this._evalSuccessHandler = this._evalSuccess.bind(this);
			this._evalFailureHandler = this._evalFailure.bind(this);
			LazyLoader.eval(this._source, this._sourcePath, this._evalSuccessHandler, this._evalFailureHandler, scopeChain);
		}
		else {
			this._evalSuccess(this._source);
		}

		this._updateImmediately = false;
	}

	function ensureArray(value) {
		return isArray(value) ? value : (isNullOrUndefined(value) ? [] : [value]);
	}

	Binding.mixin({

		// Functions concerned with setting the value of the target after
		// the source value has been retrieved and manipulated based on options.
		//////////////////////////////////////////////////////////////////////////

		_setTarget: function(value) {
			if (this._isTargetElement && (this._targetPath === "innerText" || this._targetPath === "innerHTML")) {
				if (value && !isString(value))
					value = value.toString();

				// taken from Sys$Binding$_sourceChanged
				Sys.Application._clearContent(this._target);
				if (this._targetPath === "innerHTML")
					this._target.innerHTML = value;
				else
					this._target.appendChild(document.createTextNode(value));
				Observer.raisePropertyChanged(this._target, this._targetPath);
			}
			else if (this._isTargetElement && value === null) {
				// IE would set the value to "null"
				Observer.setValue(this._target, this._targetPath, "");
			}
			else {
				Observer.setValue(this._target, this._targetPath, value);
			}
		},

		_queue: function (value) {
			if (this._pendingValue) {
				this._pendingValue = value;
				return;
			}

			this._pendingValue = value;

			Batch.whenDone(function() {
				var targetValue = this._pendingValue;
				delete this._pendingValue;

				if (this._disposed === true) {
					return;
				}

				this._setTarget(targetValue);
			}, this);
		},

		// Functions that filter or transform the value of the source before
		// setting the target.  These methods are NOT asynchronous.
		//////////////////////////////////////////////////////////////////////////

		_getValue: function(value) {
			// Use a default value if the source value is null. NOTE: Because of the way LazyLoader.eval and evalPath are used,
			// the result should never be undefined. Undefined would indicate that a property did not exist, which would be an
			// error. This also has the side-effect of being more compatible with server-side rendering.
			if (value === null) {
				if (this._options.hasOwnProperty("nullValue")) {
					return this._options.nullValue;
				}
			}
			else {
				// Attempt to format the source value using a format specifier
				if (this._options.format) {
					return getFormat(value.constructor, this._options.format).convert(value);
				}
				else if (this._options.transform) {
					// Generate the transform function
					if (!this._transformFn) {
						this._transformFn = new Function("list", "$index", "$dataItem", "return $transform(list, true)." + this._options.transform + ";");
					}
					// Transform the original list using the given options
					var transformResult = this._transformFn(value, this._templateContext.index, this._templateContext.dataItem);
					if (transformResult.live !== Transform.prototype.live) {
						throw new Error("Invalid transform result: may only contain \"where\", \"orderBy\", \"select\", \"selectMany\", and \"groupBy\".");
					}
					return transformResult.live();
				}
			}
			return value;
		},

		// Functions that deal with responding to changes, asynchronous loading,
		// and general bookkeeping.
		//////////////////////////////////////////////////////////////////////////

		_require: function (value, callback) {
			var valueRevision = this._valueRevision = ExoWeb.randomText(8, true),
				updateImmediately = true;

			LazyLoader.evalAll(value, this._options.required, function () {

				// Make sure that the data being evaluated is not stale.
				if (!this._value || this._value !== value || this._valueRevision !== valueRevision) {
					return;
				}

				if (updateImmediately) {
					callback.call(this);
				} else {
					window.setTimeout(callback.bind(this), 1);
				}
			}, null, null, this, LazyLoader.evalAll, false, value, [], true);

			updateImmediately = false;
		},

		_update: function (value, oldItems, newItems) {
			if (this._disposed === true) {
				return;
			}

			// if necessary, remove an existing collection change handler
			if (this._collectionChangedHandler) {
				Observer.removeCollectionChanged(this._value, this._collectionChangedHandler);
				delete this._value;
				delete this._collectionChangedHandler;
			}

			this._value = value;

			// if the value is an array and we will transform the value or require paths, then watch for collection change events
			if (value && value instanceof Array && this._options.required) {
				this._collectionChangedHandler = this._collectionChanged.bind(this);
				Observer.makeObservable(value);
				Observer.addCollectionChanged(value, this._collectionChangedHandler);
			}

			// If additional paths are required then load them before invoking the callback.
			if (this._options.required) {
				this._updateWatchedItems(value, oldItems, newItems, function() {
					this._queue(this._getValue(value));
				});
			}
			else {
				this._queue(this._getValue(value));
			}
		},
	
		_updateWatchedItems: function(value, oldItems, newItems, callback) {
			// Unwatch require path for items that are no longer relevant.
			if (oldItems && oldItems.length > 0) {
				oldItems.forEach(function(item) {
					Observer.removePathChanged(item, this._options.required, this._watchedItemPathChangedHandler);
				}, this);
				delete this._watchedItemPathChangedHandler;
			}

			if (value) {
				// Load required paths, then manipulate the source value and update the target.
				this._require(value, function() {
					if (this._disposed === true) {
						return;
					}

					if (newItems && newItems.length > 0) {
						// Watch require path for new items.
						this._watchedItemPathChangedHandler = this._watchedItemPathChanged.bind(this);
						forEach(newItems, function(item) {
							Observer.addPathChanged(item, this._options.required, this._watchedItemPathChangedHandler, true);
						}, this);
					}

					if (callback) {
						callback.call(this);
					}
				});
			}
			else if (callback) {
				callback.call(this);
			}
		},

		_collectionChanged: function(items, evt) {
			// In the case of an array-valued source, respond to a collection change that is raised for the source value.
			if (this._options.required) {
				var oldItems = evt.get_changes().mapToArray(function(change) { return change.oldItems || []; });
				var newItems = evt.get_changes().mapToArray(function(change) { return change.newItems || []; });
				this._updateWatchedItems(items, oldItems, newItems);
			}
		},

		_watchedItemPathChanged: function(sender, args) {
			this._update(this._sourcePathResult);
		},

		_sourcePathChanged: function() {
			// Save the previous result and evaluate and store the new one.
			var prevSourcePathResult = this._sourcePathResult;
			this._sourcePathResult = evalPath(this._source, this._sourcePath);

			// if the value is the same (which will commonly happen when the source is an array) then there is no need to update
			if (prevSourcePathResult !== this._sourcePathResult) {
				// Respond to a change that occurs at any point along the source path.
				this._update(this._sourcePathResult, ensureArray(prevSourcePathResult), ensureArray(this._sourcePathResult));
			}
		},

		_evalSuccess: function(result, performedLoading, source) {
			this._source = source;

			if (this._disposed) {
				return;
			}

			delete this._evalSuccessHandler;

			if (this._sourcePath) {
				this._sourcePathChangedHandler = this._sourcePathChanged.bind(this);
				Observer.addPathChanged(this._source, this._sourcePath, this._sourcePathChangedHandler, true);
			}

			this._sourcePathResult = result;

			if (this._updateImmediately) {
				this._update(result, null, ensureArray(result));
			} else {
				var self = this;
				window.setTimeout(function () {
					self._update(result, null, ensureArray(result));
				}, 1);
			}
		},

		_evalFailure: function(err) {
			if (this._disposed) {
				return;
			}

			delete this._evalFailureHandler;

			throw new Error($format("Couldn't evaluate path '{0}', {1}", this._sourcePath, err));
		},

		dispose: function() {
			if (!this._disposed) {
				this._disposed = true;
				if (this._collectionChangedHandler) {
					Observer.removeCollectionChanged(this._value, this._collectionChangedHandler);
					this._collectionChangedHandler = null;
				}
				if (this._sourcePathChangedHandler) {
					Observer.removePathChanged(this._source, this._sourcePath, this._sourcePathChangedHandler);
					this._sourcePathChangedHandler = null;
				}
				if (this._watchedItemPathChangedHandler) {
					ensureArray(this._sourcePathResult).forEach(function(item) {
						Observer.removePathChanged(item, this._options.required, this._watchedItemPathChangedHandler);
					}, this);
					this._watchedItemPathChangedHandler = null;
				}
				if (this._evalSuccessHandler) {
					this._evalSuccessHandler = null;
				}
				if (this._evalFailureHandler) {
					this._evalFailureHandler = null;
				}
				this._isTargetElement = this._options = this._pendingValue = this._source =
					this._sourcePath = this._sourcePathResult = this._target = this._targetPath =
					this._templateContext = this._transformFn = this._value = this._valueRevision = null;
			}
			Binding.callBaseMethod(this, "dispose");
		}

	});

	ExoWeb.View.Binding = Binding;
	Binding.registerClass("ExoWeb.View.Binding", Sys.Component, Sys.UI.ITemplateContextConsumer);

	// #endregion

	// #region ExoWeb.View.LazyMarkupExtension
	//////////////////////////////////////////////////

	Sys.Application.registerMarkupExtension(
		"~",
		function LazyMarkupExtension(component, targetProperty, templateContext, properties) {
			var source;
			var scopeChain;
			var path = properties.path || properties.$default || null;

			// if a source is specified and it is a string, then execute the source as a JavaScript expression
			if (properties.source) {
				if (properties.source.constructor === String) {
					// create a function to evaluate the binding source from the given string
					var evalSource = new Function("$element", "$index", "$dataItem", "$context", "return " + properties.source + ";");

					// get the relevant html element either as the component or the component's target element
					var element = null;
					if (Sys.Component.isInstanceOfType(component)) {
						element = component.get_element();
					}
					else if (Sys.UI.DomElement.isDomElement(component)) {
						element = component;
					}

					// evaluate the value of the expression
					source = evalSource(element, templateContext.index, templateContext.dataItem, templateContext);

					// don't try to eval the path against window
					scopeChain = [];
				}
				else {
					source = properties.source;
				}
			}
			else if (templateContext.dataItem) {
				source = templateContext.dataItem;
			}
			else {
				// No context data, so path must be global
				source = window;
				scopeChain = [];
			}

			// Build an options object that represents only the options that the binding
			// expects, and only if they were specified in the markup extension
			var options = {};
			if (properties.hasOwnProperty("required")) {
				options.required = properties.required;
			}
			if (properties.hasOwnProperty("transform")) {
				options.transform = properties.transform;
			}
			if (properties.hasOwnProperty("format")) {
				options.format = properties.format;
			}
			if (properties.hasOwnProperty("nullValue")) {
				options.nullValue = properties.nullValue;
			}

			// Construct the new binding class
			var binding = new Binding(templateContext, source, path, component, properties.targetProperty || targetProperty, options, scopeChain);

			// register with the template context as a child component
			templateContext.components.push(binding);
		},
		false
	);

	// #endregion

	// #region ExoWeb.View.Adapter
	//////////////////////////////////////////////////

	function Adapter(target, propertyPath, format, options) {
		Adapter.initializeBase(this);

		this._target = target instanceof OptionAdapter ? target.get_rawValue() : target;
		this._propertyPath = propertyPath;
		this._settingRawValue = false;
		this._readySignal = new ExoWeb.Signal("Adapter Ready");

		if (options.allowedValuesTransform) {
			this._allowedValuesTransform = options.allowedValuesTransform;
		}

		if (options.optionsTransform) {
			throw new Error($format("Option \"optionsTransform\" is obsolete, use \"allowedValuesTransform\" instead. Path = \"{0}\".", propertyPath));
		}

		if (options.allowedValuesMayBeNull) {
			this._allowedValuesMayBeNull = options.allowedValuesMayBeNull;
		}

		// Initialize the property chain.
		this._initPropertyChain();

		// Determine the display format to use
		this._format = format ? getFormat(this._propertyChain.get_jstype(), format) : this._propertyChain.get_format();

		// Load the object this adapter is bound to and then load allowed values.
		LazyLoader.eval(this._target, this._propertyChain.get_path(),
			this._readySignal.pending(null, null, true),
			this._readySignal.orPending(function(err) {
				throw new Error($format("Couldn't evaluate path '{0}', {1}", propertyPath, err));
			}, null, true)
		);

		// Add arbitrary options so that they are made available in templates.
		this._extendProperties(options);
	}

	Adapter.mixin({
		// Internal book-keeping and setup methods
		///////////////////////////////////////////////////////////////////////
		_extendProperties: function Adapter$_extendProperties(options) {
			if (options) {
				var allowedOverrides = ["label", "helptext"];

				// The "nullOption" value can be specified for booleans since options
				// are exposed and they are not treated as nullable by default.
				if (this.isType(Boolean)) {
					allowedOverrides.push("nullOption");
				}

				this._extendedProperties = [];
				for (var optionName in options) {
					// check for existing getter and setter methods
					var getter = this["get_" + optionName];
					var setter = this["set_" + optionName];

					// if the option is already defined don't overwrite critical properties (e.g.: value)
					if (getter && !Array.contains(allowedOverrides, optionName)) {
						continue;
					}

					this._extendedProperties.push(optionName);

					// create a getter and setter if they don't exist
					if (!getter || !(getter instanceof Function)) {
						getter = this["get_" + optionName] =
							(function makeGetter(adapter, optionName) {
								return function Adapter$customGetter() { return adapter["_" + optionName]; };
							})(this, optionName);
					}
					if (!setter || !(setter instanceof Function)) {
						setter = this["set_" + optionName] =
							(function makeSetter(adapter, optionName) {
								return function Adapter$customSetter(value) { adapter["_" + optionName] = value; };
							})(this, optionName);
					}

					// set the option value
					setter.call(this, options[optionName]);
				}
			}
		},
		_initPropertyChain: function Adapter$_initPropertyChain() {
			var sourceType;

			if (this._target instanceof Adapter) {
				if (!this._target.get_isEntity()) {
					throw new Error("Adapter source is not an entity.");
				}

				sourceType = this._target._propertyChain.get_jstype().meta;
			}
			else {
				var sourceObject = this._target;

				if (!(sourceObject instanceof Entity)) {
					throw new Error("Adapter source is not an entity, found " + (sourceObject != null ? typeof (sourceObject) : "null"));
				}

				sourceType = sourceObject.meta.type;
			}

			// get the property chain for this adapter starting at the source object
			this._propertyChain = Model.property(this._propertyPath, sourceType);
			if (!this._propertyChain) {
				throw new Error($format("Property \"{0}\" could not be found.", this._propertyPath));
			}

			// If the target is an adapter, prepend its property chain.  Cannot simply concatenate paths
			// since the child path could be instance-dependent (i.e. the parents value is a subtype).
			if (this._target instanceof Adapter) {
				if (this._propertyChain instanceof Property) {
					this._propertyChain = new PropertyChain(this._propertyChain.get_containingType(), [this._propertyChain], []);
				}
				this._propertyChain.prepend(this._target.get_propertyChain());
				this._parentAdapter = this._target;
				this._target = this._target.get_target();
			}
		},
		_loadForFormatAndRaiseChange: function Adapter$_loadForFormatAndRaiseChange(val) {
			EventScope$onExit(function() {
				var signal = new ExoWeb.Signal("Adapter.displayValue");
				this._doForFormatPaths(val, function(path) {
					EventScope$perform(function() {
						LazyLoader.evalAll(val, path, signal.pending(), signal.orPending(), null, null, function() {
							EventScope$perform(LazyLoader.evalAll.bind(this, arguments));
						}, false, val, []);
					}, this);
				});
				signal.waitForAll(function() {
					Observer.raisePropertyChanged(this, "displayValue");
					Observer.raisePropertyChanged(this, "systemValue");
				}, this);
			}, this);
		},
		_doForFormatPaths: function Adapter$_doForFormatPaths(val, callback, thisPtr) {
			if (val === undefined || val === null || !this._format) {
				return;
			}

			this._format.getPaths().forEach(callback, thisPtr || this);
		},
		_unsubscribeFromFormatChanges: function Adapter$_unsubscribeFromFormatChanges(val) {
			this._doForFormatPaths(val, function (path) {
				var subscription = this._formatSubscribers[path];
				if (subscription && subscription.chain) {
					subscription.chain.removeChanged(subscription.handler);
				}
			});
		},
		_subscribeToFormatChanges: function Adapter$_subscribeToFormatChanges(val) {
			this._doForFormatPaths(val, function (path) {
				Model.property(path, this._propertyChain.lastProperty().get_jstype().meta, true, function (chain) {
					var subscription = this._formatSubscribers[path] = { chain: chain, handler: this._loadForFormatAndRaiseChange.bind(this).prependArguments(val) };
					var entities = val instanceof Array ? val : [val];
					entities.forEach(function (entity) {
						chain.addChanged(subscription.handler, entity, false, true);
					});
				}, this);
			});
		},
		_ensureObservable: function Adapter$_ensureObservable() {
			var _this = this;

			if (!this._observable) {
				Observer.makeObservable(this);

				// subscribe to property changes at all points in the path
				this._targetChangedHandler = this._onTargetChanged.bind(this);
				this._propertyChain.addChanged(this._targetChangedHandler, this._target, false, true);

				this._formatSubscribers = {};

				// set up initial watching of format paths
				if (this._propertyChain.lastTarget(this._target)) {
					var rawValue = this._propertyChain.value(this._target);
					this._subscribeToFormatChanges(rawValue);
				}

				// when the value changes resubscribe
				this._propertyChain.addChanged(function (sender, args) {
					_this._unsubscribeFromFormatChanges(args.oldValue);
					_this._subscribeToFormatChanges(args.newValue);
				}, this._target, false, true);

				this._observable = true;
			}
		},
		_onTargetChanged: function Adapter$_onTargetChanged(sender, args) {
			var _this = this;
			var rawValue = this.get_rawValue();

			if (!this._settingRawValue) {
				// raise raw value changed event
				LazyLoader.eval(rawValue, null, function () {
					Observer.raisePropertyChanged(_this, "rawValue");
				});
			}

			// raise value changed event
			this._loadForFormatAndRaiseChange(rawValue);

			// Re-attach validation handlers if needed
			var properties = this._propertyChain.properties();
			var numProps = properties.length;

			// The last target does not change if this is a single-property chain,
			// so no need to update validation events
			if (numProps > 1 && args.triggeredBy !== this._propertyChain.lastProperty()) {
				// Remove event handlers for previous last target 
				if (args.oldValue) {
					// Determine the old last target
					var property,
						propIndex = properties.indexOf(args.triggeredBy) + 1,
						newLastTarget = this._propertyChain.lastTarget(this._target),
						oldLastTarget = args.oldValue;
					while (oldLastTarget && propIndex < numProps - 1) {
						property = properties[propIndex++],
						oldLastTarget = property.value(oldLastTarget);
					}

					// Remove and re-add validation handlers if the last target has changed
					if (oldLastTarget && oldLastTarget !== newLastTarget) {
						this.get_conditions().clear();
						if (this._conditionsChangedHandler) {
							oldLastTarget.meta.removeConditionsChanged(this._conditionsChangedHandler);
						}
					}
				}

				// Add the conditions for the new target and subscribe to changes
				if (this.get_conditions() && newLastTarget) {
					this.get_conditions().addRange(newLastTarget.meta.conditions(this.get_propertyChain().lastProperty()));
					if (this._conditionsChangedHandler) {
						newLastTarget.meta.addConditionsChanged(this._conditionsChangedHandler, this.get_propertyChain());
					}
				}
			}

			if (!this._settingRawValue) {
				// Raise change on options representing the old and new value in the event that the property 
				// has be changed by non-UI code or another UI component.  This will result in double raising 
				// events if the value was set by changing selected on one of the OptionAdapter objects.
				if (this._options) {
					Array.forEach(this._options, function (o) {
						// Always reload selected for options in an array since we don't know what the old values in the list were
						if (args.newValue instanceof Array || o.get_rawValue() == args.newValue || o.get_rawValue() == args.oldValue) {
							Observer.raisePropertyChanged(o, "selected");
						}
					});
				}

				// Dispose of existing event handlers related to allowed value loading
				disposeOptions.call(this);
				signalOptionsReady.call(this);
			}
		},
		_setValue: function Adapter$_setValue(value) {
			var prop = this._propertyChain;

			// Clear existing format errors before adding a new one.
			if (this._formatError) {
				this.get_conditions().remove(this._formatError);
				this._formatError = undefined;
			}

			if (value instanceof ExoWeb.Model.FormatError) {
				// Insert new format errors if the value is not valid.
				this._formatError = value.createCondition(prop.lastTarget(this._target), prop.lastProperty());
				this.get_conditions().insert(0, this._formatError);
			} else {
				// Otherwise, update the property value.
				var changed = prop.value(this._target) !== value;
				this.set_rawValue(value, changed);
			}
		},

		// Various methods.
		///////////////////////////////////////////////////////////////////////
		ready: function Adapter$ready(callback, thisPtr) {
			this._readySignal.waitForAll(callback, thisPtr, true);
		},
		toString: function Adapter$toString() {
			var targetType;
			if (this._target === null) {
				targetType = "null";
			}
			else if (this._target === undefined) {
				targetType = "undefined";
			}
			else {
				targetType = parseFunctionName(this._target.constructor);
			}

			var value;
			try {
				value = this.get_rawValue();

				if (value === null) {
					value = "null";
				}
				else if (value === undefined) {
					value = "undefined";
				}
				else if (value.constructor !== String) {
					value = value.toString();
				}
			}
			catch (e) {
				value = "[error]";
			}

			return $format("<{0}>.{1}:  {2}", [targetType, this._propertyPath, value]);
		},

		// Properties that are intended to be used by templates.
		///////////////////////////////////////////////////////////////////////
		isType: function Adapter$isType(jstype) {
			if (this._jstype && this._jstype instanceof Function) {
				return this._jstype === jstype;
			}

			for (var propType = this._propertyChain.get_jstype(); propType !== null; propType = propType.getBaseType()) {
				if (propType === jstype) {
					return true;
				}
			}

			return false;
		},
		aspects: function Adapter$aspects() {
			if (!this._aspects) {
				this._aspects = {
					"isList": this.get_isList(),
					"isReference": this.get_isEntity() || this.get_isEntityList(),
					"dataType": this.get_dataType()
				};
			}
			return this._aspects;
		},
		get_isList: function Adapter$get_isList() {
			return this._propertyChain.get_isList();
		},
		get_isEntity: function Adapter$get_isEntity() {
			return this._propertyChain.get_isEntityType();
		},
		get_isEntityList: function Adapter$get_isEntityList() {
			return this._propertyChain.get_isEntityListType();
		},
		get_isStatic: function Adapter$get_isStatic() {
			return this._propertyChain.get_isStatic();
		},
		get_target: function Adapter$get_target() {
			return this._target;
		},
		get_propertyPath: function Adapter$get_propertyPath() {
			return this._propertyPath;
		},
		get_propertyChain: function Adapter$get_propertyChain() {
			return this._propertyChain;
		},
		get_format: function Adapter$get_format() {
			return this._format;
		},
		get_dataType: function Adapter$get_dataType() {
			return this._propertyChain.get_jstype();
		},
		get_label: function Adapter$get_label() {
			// if no label is specified then use the property label
			return this._label || this._propertyChain.get_label();
		},
		get_helptext: function Adapter$get_helptext() {
			// help text may also be included in the model?
			return this._helptext || this._propertyChain.get_helptext() || "";
		},
		get_nullOption: function Adapter$get_nullOption() {
			if (this.isType(Boolean)) {
				if (this.hasOwnProperty("_nullOption")) {
					return this._nullOption;
				}

				// Booleans are not nullable by default.
				return false;
			}

			return true;
		},
		get_values: function Adapter$get_values() {
			this._ensureObservable();
			if (this.get_isList()) {
				var _this = this;
				var values = this._propertyChain.value(this._target);
				return values.map(function (v, i) { return new ListValueAdapter(_this, i) });
			}
			else {
				throw new Error("Adapter values are only available for list properties.");
			}
		},
		get_rawValue: function Adapter$get_rawValue() {
			this._ensureObservable();
			return this._propertyChain.value(this._target);
		},
		set_rawValue: function Adapter$set_rawValue(value, changed) {
			var prop = this._propertyChain, target, targetType;

			if (changed === undefined) {
				changed = prop.value(this._target) !== value;
			}

			if (changed) {
				this._settingRawValue = true;

				try {
					target = this._target;
					if (target === null) {
						targetType = "null";
					} else if (target === undefined) {
						targetType = "undefined";
					} else if (target instanceof ExoWeb.Model.Entity) {
						targetType = target.meta.type.get_fullName();
					} else if (target instanceof ExoWeb.View.Adapter) {
						targetType = "Adapter";
					} else if (target instanceof ExoWeb.View.OptionAdapter) {
						targetType = "OptionAdapter";
					} else if (target instanceof ExoWeb.View.OptionGroupAdapter) {
						targetType = "OptionGroupAdapter";
					} else {
						targetType = parseFunctionName(target.constructor);
					}

					if (ExoWeb.config.enableBatchChanges) {
						context.server.batchChanges($format("adapter: {0}.{1}", targetType, this._propertyPath), function () {
							prop.value(target, value);
						});
					}
					else {
						prop.value(target, value);
					}
				}
				finally {
					this._settingRawValue = false;
				}
			}
		},
		get_systemValue: function Adapter$get_systemValue() {
			var rawValue = this.get_rawValue();
			if (this.get_isEntity()) {
				return rawValue ? Entity.toIdString(rawValue) : "";
			}
			else if (this.isType(Boolean)) {
				if (rawValue === true) {
					return "true";
				}
				else if (rawValue === false) {
					return "false";
				}
				else {
					return "";
				}
			}
			else if (this.isType(String)) {
				return rawValue;
			}
			else {
				logWarning("Possible incorrect usage of systemValue for a type that is not supported");
				return rawValue ? rawValue.toString() : "";
			}
		},
		set_systemValue: function Adapter$set_systemValue(value) {
			if (this.get_isEntity()) {

				// set to null
				if (!value) {
					this._setValue(null);
				}
				else {
					var entity = Entity.fromIdString(value);

					// lazy load if necessary
					if (LazyLoader.isRegistered(entity)) {
						// Load the entity (in scope) before setting the value.
						LazyLoader.load(entity, null, true, function () {
							this._setValue(entity);
						}, this);
					}
					// set immediately if loaded
					else {
						this._setValue(entity);
					}
				}
			}
			else if (this.isType(Boolean)) {
				if (value === "true") {
					this._setValue(true);
				}
				else if (value === "false") {
					this._setValue(false);
				}
				else {
					this._setValue(null);
				}
			}
			else if (this.isType(String)) {
				if (!value) 
					this._setValue(null);
				else
					this._setValue(value);
			}
			else {
				throw new Error("Cannot set systemValue property of Adapters for non-entity types.");
			}
		},
		get_displayValue: function Adapter$get_displayValue() {
			var displayValue;
			var rawValue = this.get_rawValue();

			if (this._format) {
				// Use a markup or property format if available
				if (rawValue instanceof Array) {
					displayValue = rawValue.map(function (value) { return this._format.convert(value); }, this);
				}
				else {
					displayValue = this._format.convert(rawValue);
				}
			}
			else if (rawValue instanceof Array) {
				// If no format exists, then fall back to toString
				displayValue = rawValue.map(function (value) {
					if (value === null || value === undefined) {
						return "";
					}
					else {
						return value.toString();
					}
				}, this);
			}
			else if (rawValue === null || rawValue === undefined) {
				displayValue = "";
			}
			else {
				displayValue = rawValue.toString();
			}

			return displayValue instanceof Array ? displayValue.join(", ") : displayValue;
		},
		set_displayValue: function Adapter$set_displayValue(value) {
			if (this.get_isEntity()) {
				throw new Error("Cannot set displayValue property of Adapters for entity types.");
			}
			else if (this.get_isList()) {
				throw new Error("Cannot set displayValue property of Adapters for list types.");
			}
			else {
				var initialValue = value;
				value = this._format ? this._format.convertBack(value) : value;
				this._setValue(value);
				if (ExoWeb.config.autoReformat && !(value instanceof ExoWeb.Model.FormatError)) {
					var newValue = this.get_displayValue();
					if (initialValue != newValue) {
						var adapter = this;
						window.setTimeout(function () { Observer.raisePropertyChanged(adapter, "displayValue"); }, 1);
					}
				}
			}
		},

		dispose: function Adapter$dispose() {
			var disposed = this._disposed, options = null;

			if (!disposed) {
				this._disposed = true;
				disposeOptions.call(this);
				options = this._options;
				if (this._extendedProperties) {
					var ext = this._extendedProperties;
					for (var i = 0, l = ext.length; i < l; i++) {
						this["_" + ext[i]] = null;
					}
					this._extendedProperties = null;
				}
				if (this._targetChangedHandler) {
					this._propertyChain.removeChanged(this._targetChangedHandler);
					this._targetChangedHandler = null;
				}
				this._unsubscribeFromFormatChanges(this.get_rawValue());
				// Clean up validation event handlers
				var lastTarget = this._propertyChain.lastTarget(this._target);
				if (lastTarget) {
					if (this._conditionsChangedHandler) {
						lastTarget.meta.removeConditionsChanged(this._conditionsChangedHandler);
					}
				}
				this._allowedValues = this._allowedValuesMayBeNull = this._aspects =
					this._format = this._formatSubscribers = this._helptext = this._jstype = this._settingRawValue = this._label =
					this._observable = this._options = this._allowedValuesTransform = this._parentAdapter = this._propertyChain =
					this._propertyPath = this._readySignal = this._target = null;
			}

			Adapter.callBaseMethod(this, "dispose");

			if (!disposed) {
				Observer.disposeObservable(this);
				if (options) {
					options.forEach(Observer.disposeObservable);
				}
			}
		}
	});

	// #region Conditions

	function conditionsChangedHandler(conditions, sender, args) {
		if (args.add) {
			conditions.add(args.conditionTarget.condition);
		}
		else if (args.remove) {
			conditions.remove(args.conditionTarget.condition);
		}
	}

	function getFirstError(conditions, includeWarnings) {
		var firstError = null;
		for (var c = 0; c < conditions.length; c++) {
			var condition = conditions[c];
			if (condition.type instanceof ConditionType.Error || (includeWarnings === true && condition.type instanceof ConditionType.Warning)) {
				if (firstError === null || /FormatError/i.test(condition.type.code)) {
					firstError = condition;
				}
				// Ensures a format error takes precedence over a required field error
				else if (!/FormatError/i.test(firstError.type.code) && /Required/i.test(condition.type.code))
				{
					firstError = condition;
				}
			}
		}
		return firstError;
	}

	Adapter.mixin({
		get_conditions: function Adapter$get_conditions() {

			// initialize the conditions if necessary
			if (!this._conditions) {

				// get the current target
				var target = this.get_propertyChain().lastTarget(this._target);

				// get the current set of conditions
				var conditions = this._conditions = target ? target.meta.conditions(this.get_propertyChain().lastProperty()) : [];

				// make the conditions observable
				Observer.makeObservable(this._conditions);

				// subscribe to condition changes on the current target
				if (target) {
					var handler = this._conditionsChangedHandler = conditionsChangedHandler.prependArguments(conditions);
					target.meta.addConditionsChanged(handler, this.get_propertyChain());
				}
			}
			return this._conditions;
		},
		get_firstErrorOrWarning: function Adapter$get_firstErrorOrWarning() {
			// gets the first error or warning in a set of conditions, always returning format errors first followed by required field errors, and null if no errors exist
			// initialize on first access
			if (!this.hasOwnProperty("_firstErrorOrWarning")) {

				var conditions = this.get_conditions();
				this._firstErrorOrWarning = getFirstError(conditions, true);

				// automatically update when condition changes occur
				var adapter = this;
				conditions.add_collectionChanged(function (sender, args) {

					var err = getFirstError(conditions, true);

					// store the first error and raise property change if it differs from the previous first error
					if (adapter._firstErrorOrWarning !== err) {
						adapter._firstErrorOrWarning = err;
						Observer.raisePropertyChanged(adapter, "firstErrorOrWarning");
					}
				});
			}

			// return the first error
			return this._firstErrorOrWarning;
		},
		get_firstError: function Adapter$get_firstError() {
			// gets the first error in a set of conditions, always returning format errors first followed by required field errors, and null if no errors exist
			// initialize on first access
			if (!this.hasOwnProperty("_firstError")) {

				var conditions = this.get_conditions();
				this._firstError = getFirstError(conditions);

				// automatically update when condition changes occur
				var adapter = this;
				conditions.add_collectionChanged(function (sender, args) {

					var err = getFirstError(conditions);

					// store the first error and raise property change if it differs from the previous first error
					if (adapter._firstError !== err) {
						adapter._firstError = err;
						Observer.raisePropertyChanged(adapter, "firstError");
					}
				});
			}

			// return the first error
			return this._firstError;
		},
		get_hasError: function Adapter$get_hasError() {
			// initialize on first access
			if (!this.hasOwnProperty("_hasError")) {

				var conditions = this.get_conditions();
				this._hasError = !!this.get_firstError();

				// automatically update when condition changes occur
				var adapter = this;
				conditions.add_collectionChanged(function (sender, args) {

					var val = !!adapter.get_firstError();

					// store the first error and raise property change if it differs from the previous first error
					if (adapter._hasError !== val) {
						adapter._hasError = val;
						Observer.raisePropertyChanged(adapter, "hasError");
					}
				});
			}

			return this._hasError;
		}
	});

	// #endregion

	// #region Options

	function disposeOptions() {
		var lastProperty = this._propertyChain.lastProperty();
		var allowedValuesRule = lastProperty.rule(ExoWeb.Model.Rule.allowedValues);
		if (this._allowedValuesChangedHandler) {
			allowedValuesRule.removeChanged(this._allowedValuesChangedHandler);
			this._allowedValuesChangedHandler = null;
		}
		if ( this._allowedValuesRuleExistsHandler) {
			this._propertyChain.lastProperty().removeRuleRegistered(this._allowedValuesRuleExistsHandler);
			this._allowedValuesRuleExistsHandler = null;
		}
		if (this._allowedValuesExistHandler) {
			allowedValuesRule.removeChanged(this._allowedValuesExistHandler);
			this._allowedValuesExistHandler = null;
		}
		this._options = null;
	}

	// Create an option adapter from the given object
	function createOptionAdapter(item) {
		// If it is a transform group then create an option group
		if (item instanceof TransformGroup) {
			return new OptionGroupAdapter(this, item.group, item.items);
		}
		// Otherwise,create a single option
		else {
			return new OptionAdapter(this, item);
		}
	}

	// Notify subscribers that options are available
	function signalOptionsReady() {
		if (this._disposed) {
			return;
		}

		// Delete backing fields so that options can be recalculated (and loaded)
		delete this._options;

		// Raise events in order to cause subscribers to fetch the new value
		ExoWeb.Observer.raisePropertyChanged(this, "options");
	}

	// If the given rule is allowed values, signal options ready
	function checkAllowedValuesRuleExists(rule) {
		if (rule instanceof Rule.allowedValues) {
			this._propertyChain.lastProperty().removeRuleRegistered(this._allowedValuesRuleExistsHandler);
			signalOptionsReady.call(this);
		}
	}

	function checkAllowedValuesExist() {
		var lastProperty = this._propertyChain.lastProperty();
		var allowedValuesRule = lastProperty.rule(ExoWeb.Model.Rule.allowedValues);
		var targetObj = this._propertyChain.lastTarget(this._target);
		var allowedValues = allowedValuesRule.values(targetObj, !!this._allowedValuesMayBeNull);

		if (allowedValues instanceof Array) {
			allowedValuesRule.removeChanged(this._allowedValuesExistHandler);
			delete this._allowedValuesExistHandler;
			signalOptionsReady.call(this);
		}
	}

	// Update the given options source array to match the current allowed values
	function refreshOptionsFromAllowedValues(optionsSourceArray) {
		var lastProperty = this._propertyChain.lastProperty();
		var allowedValuesRule = lastProperty.rule(ExoWeb.Model.Rule.allowedValues);
		var targetObj = this._propertyChain.lastTarget(this._target);
		var allowedValues = allowedValuesRule.values(targetObj, !!this._allowedValuesMayBeNull);
		if (allowedValues) {
			optionsSourceArray.beginUpdate();
			update(optionsSourceArray, allowedValues);
			optionsSourceArray.endUpdate();
		}
		else {
			signalOptionsReady.call(this);
		}
	}

	// Perform any required loading of allowed values items
	function ensureAllowedValuesLoaded(newItems, callback, thisPtr) {
		// Wait until the "batch" of work is complete before lazy loading options. Otherwise,
		// the lazy loading could occur during processing of a response which already contains
		// the data, which could cause performance degredation due to redundant data loading.
		Batch.whenDone(function () {
			var signal = new Signal("ensureAllowedValuesLoaded");
			newItems.forEach(function(item) {
				if (LazyLoader.isRegistered(item)) {
					LazyLoader.load(item, null, true, signal.pending());
				}
			});
			signal.waitForAll(callback, thisPtr);
		});
	}

	function clearInvalidOptions(allowedValues) {
		var rawValue = this.get_rawValue();
		var isDateProp = this.isType(Date);

		function isAllowedValue(value) {
			if (isDateProp) {
				return allowedValues.some(function (v) {
					return v instanceof Date && value.valueOf() === v.valueOf();
				});
			}

			return allowedValues.indexOf(value) !== -1;
		}

		if (rawValue !== null && allowedValues) {
			// Remove option values that are no longer valid
			if (rawValue instanceof Array) {
				purge(rawValue, function (item) {
					return !isAllowedValue(item);
				}, this);
			} else if (!isAllowedValue(rawValue) && this._propertyChain.value(this._target) !== null) {
				this._propertyChain.value(this._target, null);
			}
		} else if (rawValue instanceof Array) {
			rawValue.clear();
		} else if (this._propertyChain.value(this._target) !== null) {
			this._propertyChain.value(this._target, null);
		}
	}

	function allowedValuesChanged(optionsSourceArray, sender, args) {
		var lastProperty = this._propertyChain.lastProperty();
		var allowedValuesRule = lastProperty.rule(ExoWeb.Model.Rule.allowedValues);
		var allowedValues = allowedValuesRule.values(this._propertyChain.lastTarget(this._target), !!this._allowedValuesMayBeNull);

	    // Clear out invalid selections
		if (!allowedValuesRule.ignoreValidation) {
		    clearInvalidOptions.call(this, allowedValues);
		}

		// Load allowed value items that were added
		if (args.changes) {
			// Collect all items that were added
			var newItems = [];
			args.changes.forEach(function(change) {
				if (change.newItems) {
					newItems.addRange(change.newItems);
				}
			});
			if (newItems.length > 0) {
				ensureAllowedValuesLoaded(newItems, refreshOptionsFromAllowedValues.prependArguments(optionsSourceArray), this);
			}
			else {
				refreshOptionsFromAllowedValues.call(this, optionsSourceArray);
			}
		}
		else if (!args.oldValue && args.newValue) {
			// If there was previously not a value of the path and now there is, then all items are new
			ensureAllowedValuesLoaded(allowedValues, refreshOptionsFromAllowedValues.prependArguments(optionsSourceArray), this);
		}
		else {
			refreshOptionsFromAllowedValues.call(this, optionsSourceArray);
		}

	}

	Adapter.mixin({
		get_options: function Adapter$get_options() {
			if (!this.hasOwnProperty("_options")) {
				if (this.isType(Boolean)) {
					this._options = [createOptionAdapter.call(this, true), createOptionAdapter.call(this, false)];
				}
				else {
					var lastProperty = this._propertyChain.lastProperty();
					var allowedValuesRule = lastProperty.rule(ExoWeb.Model.Rule.allowedValues);

					// Watch for the registration of an allowed values rule if it doesn't exist
					if (!allowedValuesRule) {
						this._allowedValuesRuleExistsHandler = checkAllowedValuesRuleExists.bind(this);
						lastProperty.addRuleRegistered(this._allowedValuesRuleExistsHandler);
						this._options = null;
						return;
					}

					// Cache the last target
					var targetObj = this._propertyChain.lastTarget(this._target);

					// Retrieve the value of allowed values property
					var allowedValues = allowedValuesRule.values(targetObj, !!this._allowedValuesMayBeNull);

					// Load allowed values if the path is not inited
					if (allowedValues === undefined && (allowedValuesRule.source instanceof Property || allowedValuesRule.source instanceof PropertyChain)) {
						logWarning("Adapter forced eval of allowed values. Rule: " + allowedValuesRule);
						LazyLoader.eval(allowedValuesRule.source.get_isStatic() ? null : targetObj,
							allowedValuesRule.source.get_path(),
							signalOptionsReady.bind(this));
						this._options = null;
						return;
					}

					// Watch for changes until the allowed values path has a value
					if (!allowedValues) {
						this._allowedValuesExistHandler = checkAllowedValuesExist.bind(this);
						allowedValuesRule.addChanged(this._allowedValuesExistHandler, targetObj);
						if (!allowedValuesRule.ignoreValidation) {
						    clearInvalidOptions.call(this);
						}
						this._options = null;
						return;
					}

					// Load the allowed values list if it is not already loaded
					if (LazyLoader.isRegistered(allowedValues)) {
						logWarning("Adapter forced loading of allowed values list. Rule: " + allowedValuesRule);
						LazyLoader.load(allowedValues, null, true, signalOptionsReady.bind(this), this);
						this._options = null;
						return;
					}

					if (!allowedValuesRule.ignoreValidation) {
					    clearInvalidOptions.call(this, allowedValues);
					}

					// Create an observable copy of the allowed values that we can keep up to date in our own time
					var observableAllowedValues = allowedValues.slice();
					ExoWeb.Observer.makeObservable(observableAllowedValues);

					// Respond to changes to allowed values
					this._allowedValuesChangedHandler = allowedValuesChanged.bind(this).prependArguments(observableAllowedValues);
					allowedValuesRule.addChanged(this._allowedValuesChangedHandler, targetObj, false, true);

					// Create a transform that watches the observable copy and uses the user-supplied _allowedValuesTransform if given
					if (this._allowedValuesTransform) {
						transformedAllowedValues = (new Function("$array", "{ return $transform($array, true)." + this._allowedValuesTransform + "; }"))(observableAllowedValues);
						if (transformedAllowedValues.live !== Transform.prototype.live) {
							throw new Error("Invalid options transform result: may only contain \"where\", \"orderBy\", \"select\", \"selectMany\", and \"groupBy\".");
						}
					}
					else {
						transformedAllowedValues = $transform(observableAllowedValues, true);
					}

					// Map the allowed values to option adapters
					this._options = transformedAllowedValues.select(createOptionAdapter.bind(this)).live();
				}
			}

			return this._options;
		}
	});

	// #endregion

	ExoWeb.View.Adapter = Adapter;
	Adapter.registerClass("ExoWeb.View.Adapter", Sys.Component, Sys.UI.ITemplateContextConsumer);

	// #endregion

	// #region ExoWeb.View.OptionAdapter
	//////////////////////////////////////////////////

	function OptionAdapter(parent, obj) {
		this._parent = parent;
		this._obj = obj;

		// watch for changes to properties of the source object and update the label
		this._ensureObservable();
	}

	OptionAdapter.prototype = {
		// Internal book-keeping and setup methods
		///////////////////////////////////////////////////////////////////////
		_loadForFormatAndRaiseChange: function OptionAdapter$_loadForFormatAndRaiseChange(val) {
			if (val === undefined || val === null) {
				Observer.raisePropertyChanged(this, "displayValue");
				Observer.raisePropertyChanged(this, "systemValue");
				return;
			}

			var signal = new ExoWeb.Signal("OptionAdapter.displayValue");
			this._parent._doForFormatPaths(val, function (path) {
				LazyLoader.evalAll(val, path, signal.pending());
			}, this);
			signal.waitForAll(function () {
				Observer.raisePropertyChanged(this, "displayValue");
				Observer.raisePropertyChanged(this, "systemValue");
			}, this);
		},
		_subscribeToFormatChanges: function OptionAdapter$_subscribeToFormatChanges(val) {
			this._parent._doForFormatPaths(val, function (path) {
				Model.property(path, val.meta.type, true, function (chain) {
					var subscription = this._formatSubscribers[path] = { chain: chain, handler: this._loadForFormatAndRaiseChange.bind(this).prependArguments(val) };
					chain.addChanged(subscription.handler, val);
				}, this);
			}, this);
		},
		_ensureObservable: function OptionAdapter$_ensureObservable() {
			if (!this._observable) {
				Observer.makeObservable(this);

				this._formatSubscribers = {};

				// set up initial watching of format paths
				this._subscribeToFormatChanges(this._obj);

				this._observable = true;
			}
		},

		// Properties consumed by UI
		///////////////////////////////////////////////////////////////////////////
		get_parent: function OptionAdapter$get_parent() {
			return this._parent;
		},
		get_rawValue: function OptionAdapter$get_rawValue() {
			return this._obj;
		},
		get_displayValue: function OptionAdapter$get_displayValue() {
			var format = this._parent.get_format();
			return format ? format.convert(this._obj) : this._obj;
		},
		set_displayValue: function OptionAdapter$set_displayValue(value) {
			if (this._parent.get_isEntity()) {
				throw new Error("Cannot set displayValue property of OptionAdapters for entity types.");
			}
			else {
				var selected = this.get_selected();
				// Remove old value from the list if selected
				if (selected) this.set_selected(false);

				// Set the internal option value after optional applying a conversion
				value = this._format ? this._format.convertBack(value) : value;
				this._obj = value;

				// Add new value to the list if previously selected
				if (selected) this.set_selected(true);
			}
		},
		get_systemValue: function OptionAdapter$get_systemValue() {
			if (this._obj === null || this._obj === undefined) {
				return "";
			}
			else {
				return this._parent.get_isEntity() ? Entity.toIdString(this._obj) : this._obj.toString();
			}
		},
		get_selected: function OptionAdapter$get_selected() {
			var rawValue = this._parent.get_rawValue();

			if (rawValue instanceof Array) {
				return Array.contains(rawValue, this._obj);
			}
			else {
				return rawValue === this._obj;
			}
		},
		set_selected: function OptionAdapter$set_selected(value) {
			var rawValue = this._parent.get_rawValue();

			if (rawValue instanceof Array) {
				this._parent._settingRawValue = true;

				try {
					if (value && !Array.contains(rawValue, this._obj)) {
						rawValue.add(this._obj);
					}
					else if (!value && Array.contains(rawValue, this._obj)) {
						rawValue.remove(this._obj);
					}

				} finally {
					this._parent._settingRawValue = false;
				}
			}
			else {
				if (value) {
					this._parent.set_rawValue(this._obj);
				}
				else {
					this._parent.set_rawValue(null);
				}
			}
		},
		get_conditions: function OptionAdapter$get_conditions() {
			return this._parent.get_conditions();
		}
	};

	ExoWeb.View.OptionAdapter = OptionAdapter;

	// #endregion

	// #region ExoWeb.View.ListValueAdapter
	//////////////////////////////////////////////////

	function ListValueAdapter(parent, index) {
		this._parent = parent;
		this._index = index;

		// watch for changes to properties of the source object and update the label
		this._ensureObservable();
	}

	ListValueAdapter.prototype = {
		// Internal book-keeping and setup methods
		///////////////////////////////////////////////////////////////////////
		_loadForFormatAndRaiseChange: function ListValueAdapter$_loadForFormatAndRaiseChange(val) {
			if (val === undefined || val === null) {
				Observer.raisePropertyChanged(this, "displayValue");
				Observer.raisePropertyChanged(this, "systemValue");
				return;
			}

			var signal = new ExoWeb.Signal("ListValueAdapter.displayValue");
			this._parent._doForFormatPaths(val, function (path) {
				LazyLoader.evalAll(val, path, signal.pending());
			}, this);
			signal.waitForAll(function () {
				Observer.raisePropertyChanged(this, "displayValue");
				Observer.raisePropertyChanged(this, "systemValue");
			}, this);
		},
		//_subscribeToFormatChanges: function ListValueAdapter$_subscribeToFormatChanges(val) {
		//	this._parent._doForFormatPaths(val, function (path) {
		//		Model.property(path, val.meta.type, true, function (chain) {
		//			var subscription = this._formatSubscribers[path] = { chain: chain, handler: this._loadForFormatAndRaiseChange.bind(this).prependArguments(val) };
		//			chain.addChanged(subscription.handler, val);
		//		}, this);
		//	}, this);
		//},
		_ensureObservable: function ListValueAdapter$_ensureObservable() {
			if (!this._observable) {
				Observer.makeObservable(this);

				this._formatSubscribers = {};

				// set up initial watching of format paths
				//this._subscribeToFormatChanges(this._obj);

				this._observable = true;
			}
		},

		// Properties consumed by UI
		///////////////////////////////////////////////////////////////////////////
		get_parent: function ListValueAdapter$get_parent() {
			return this._parent;
		},
		get_isEntity: function ListValueAdapter$get_isEntity() {
			return this._parent.get_isEntity();
		},
		get_options: function ListValueAdapter$get_options() {
			var _this = this;
			return this._parent.get_options().map(function (o) { return new OptionAdapter(_this, o._obj); });
		},
		get_rawValue: function ListValueAdapter$get_rawValue() {
			return this._parent.get_rawValue()[this._index];
		},
		get_displayValue: function ListValueAdapter$get_displayValue() {
			var format = this._parent._format;
			var obj = this._parent.get_rawValue()[this._index];
			return format ? format.convert(obj) : obj;
		},
		set_displayValue: function ListValueAdapter$set_displayValue(value) {
			if (this._parent.get_isEntity()) {
				throw new Error("Cannot set displayValue property of OptionAdapters for entity types.");
			}
			else {
				// Set the internal option value after optional applying a conversion
				value = this._format ? this._parent._format.convertBack(value) : value;

				var list = this._parent.get_rawValue();
				list.beginUpdate();
				list.removeAt(this._index);
				list.insert(this._index, value);
				list.endUpdate();
			}
		},
		get_systemValue: function ListValueAdapter$get_systemValue() {
			if (this._obj === null || this._obj === undefined) {
				return "";
			}
			else {
				return this._parent.get_isEntity() ? Entity.toIdString(this._obj) : this._obj.toString();
			}
		},
		get_conditions: function ListValueAdapter$get_conditions() {
			return this._parent.get_conditions();
		},
		_doForFormatPaths: function ListValueAdapter$_doForFormatPaths(val, callback, thisPtr) {
			return this._parent._doForFormatPaths(val, callback, thisPtr);
		},
		get_format: function ListValueAdapter$get_format() {
			return this._parent._format;
		}
	};

	ExoWeb.View.ListValueAdapter = ListValueAdapter;

	// #endregion

	// #region ExoWeb.View.OptionGroupAdapter
	//////////////////////////////////////////////////

	function OptionGroupAdapter(parent, obj, items) {
		this._parent = parent;
		this._obj = obj;
		this._options = $transform(items).select(parent._createOption.bind(parent)).live();

		// watch for changes to properties of the source object and update the label
		this._ensureObservable();
	}

	OptionGroupAdapter.prototype = {
		// Properties consumed by UI
		///////////////////////////////////////////////////////////////////////////
		get_parent: function OptionGroupAdapter$get_parent() {
			return this._parent;
		},
		get_rawValue: function OptionGroupAdapter$get_rawValue() {
			return this._obj;
		},
		get_displayValue: function OptionGroupAdapter$get_displayValue() {
			var result = this._obj;
			if (result !== null && result !== undefined && result.formats && result.formats.$display) {
				result = result.formats.$display.convert(result);
			}
			return result;
		},
		get_systemValue: function OptionGroupAdapter$get_systemValue() {
			var result = this._obj;
			if (result !== null && result !== undefined && result.formats && result.formats.$system) {
				result = result.formats.$system.convert(result);
			}
			return result;
		},
		get_options: function OptionGroupAdapter$get_options() {
			return this._options;
		},
		get_conditions: function OptionGroupAdapter$get_conditions() {
			return this._parent.get_conditions();
		}
	};

	ExoWeb.View.OptionGroupAdapter = OptionGroupAdapter;
	OptionGroupAdapter.registerClass("ExoWeb.View.OptionGroupAdapter");

	// #endregion

	// #region ExoWeb.View.MsAjax
	//////////////////////////////////////////////////

	/*globals Sys, jQuery */

	(function () {
		function updateLastTargetAndSourceForOtherRadios(target) {
			// Set _lastTarget=false on other radio buttons in the group, since they only 
			// remember the last target that was recieved when an event fires and radio button
			// target change events fire on click (which does not account for de-selection).  
			// Otherwise, the source value is only set the first time the radio button is selected.
			if (Sys.UI.DomElement.isDomElement(target) && jQuery(target).is("input[type=radio]:checked")) {
				jQuery("input[type=radio][name='" + target.name + "']").each(function () {
					if (this !== target && this.__msajaxbindings !== undefined) {
						var bindings = this.__msajaxbindings;
						for (var i = 0; i < bindings.length; i++)
							bindings[i]._lastTarget = bindings[i]._lastSource = false;
					}
				});
			}
		}

		var targetChangedImpl = Sys.Binding.prototype._targetChanged;
		Sys.Binding.prototype._targetChanged = function (force) {
			// Batch changes that may occur due to the target element changing.
			var source = this.get_source(),
				sourceType,
				batchChanges = ExoWeb.config.enableBatchChanges;

			if (source === null) {
				sourceType = "null";
			}
			else if (source === undefined) {
				sourceType = "undefined";
			}
			else if (source instanceof ExoWeb.Model.Entity) {
				sourceType = source.meta.type.get_fullName();
			}
			else if (source instanceof ExoWeb.View.Adapter) {
				sourceType = "Adapter";

				// Adapters handle their own batching.
				batchChanges = false;
			}
			else if (source instanceof ExoWeb.View.OptionAdapter) {
				sourceType = "OptionAdapter";

				// If the option adapter is not a list, then it will set the
				// adapter's rawValue, which will handle batching itself.
				if (!source.get_parent().get_isList()) {
					batchChanges = false;
				}
			}
			else if (source instanceof ExoWeb.View.OptionGroupAdapter) {
				sourceType = "OptionGroupAdapter";
			}
			else {
				sourceType = parseFunctionName(source.constructor);
			}

			if (batchChanges) {
				context.server._changeLog.batchChanges(
					$format("binding: {0}.{1}", sourceType, this.get_path()),
					context.server._localUser,
					targetChangedImpl.bind(this, arguments),
					true
				);
			} else {
				targetChangedImpl.apply(this, arguments);
			}

			// If the binding is not disposing, then fix backing
			// fields for other radio buttons in the same group.
			if (!this._disposed) {
				updateLastTargetAndSourceForOtherRadios(this._target);
			}
		};

		function removeCheckedAttributeToMatchSourceValue(target, sourceValue) {
			// Remove checked attribute from a radio button if the source value has been set to false.
			if (Sys.UI.DomElement.isDomElement(target) && jQuery(target).is("input[type=radio]:checked") && !sourceValue) {
				jQuery(target).removeAttr("checked");
			}
		}

		var sourceChangedImpl = Sys.Binding.prototype._sourceChanged;
		Sys.Binding.prototype._sourceChanged = function (force) {
			var link = force === false;

			// Invoke the standard method implementation.
			sourceChangedImpl.apply(this, [force]);

			if (!this._disposed && !link) {
				removeCheckedAttributeToMatchSourceValue(this._target, this._lastSource);
			}
		};

		Sys.UI.DataView.prototype._loadData = function (value) {
			this._swapData(this._data, value);
			var oldValue = this._data;
			this._data = value;
			this._setData = true;
			this._stale = false;
			// Array data should not typically be set unless some intermediate
			// process (like transform) is creating a new array from the same original.
			if ((value && value instanceof Array) && (oldValue && oldValue instanceof Array)) {
				// copy the original array
				var arr = oldValue.slice();
				var changes = update(arr, value, true);
				this._collectionChanged(value, new Sys.NotifyCollectionChangedEventArgs(changes));
			}
			else {
				this._dirty = true;
				if (this._isActive()) {
					if (this.get_isLinkPending()) {
						this.link();
					}
					else {
						this.refresh();
					}
					this.raisePropertyChanged("data");
				}
				else {
					this._changed = true;
				}
			}
		};
	})();

	// Get's the last object in the source path.  Ex: Customer.Address.Street returns the Address object.
	function getFinalSrcObject(binding) {
		var src = binding.get_source();

		for (var i = 0; i < binding._pathArray.length - 1; ++i) {
			src = src[binding._pathArray[i]] || src["get_" + binding._pathArray[i]]();
		}

		return src;
	}

	ExoWeb.View.getFinalSrcObject = getFinalSrcObject;

	function getFinalPathStep(binding) {
		return binding._pathArray[binding._pathArray.length - 1];
	}

	ExoWeb.View.getFinalPathStep = getFinalPathStep;

	function getBindingInfo(binding) {
		var srcObj = getFinalSrcObject(binding);

		var target;
		var property;

		// Option adapter defers to parent adapter
		if (srcObj instanceof ExoWeb.View.OptionAdapter) {
			srcObj = srcObj.get_parent();
		}

		if (srcObj instanceof ExoWeb.View.Adapter) {
			var chain = srcObj.get_propertyChain();
			property = chain.lastProperty();
			target = chain.lastTarget(srcObj.get_target());
		}
		else if (srcObj instanceof ExoWeb.Model.Entity) {
			var propName = getFinalPathStep(binding);
			property = srcObj.meta.property(propName);
			target = srcObj;
		}

		return {
			target: target,
			property: property
		};
	}

	ExoWeb.View.getBindingInfo = getBindingInfo;

	// #endregion

	// #region Validation
	//////////////////////////////////////////////////

	var isError = function (condition) {
		return condition.type instanceof ExoWeb.Model.ConditionType.Error;
	};

	var isValidationCondition = function (condition) {
		return condition.type instanceof ExoWeb.Model.ConditionType.Error || condition.type instanceof ExoWeb.Model.ConditionType.Warning;
	};

	var onMetaConditionsChanged = function (sender, args, property) {
		if (isValidationCondition(args.conditionTarget.condition)) {
			$(this).trigger("validated", [sender.conditions(property)]);
		}
	};

	var onConditionsCollectionChanged = function (sender, args) {
		$(this).trigger("validated", [sender.filter(isValidationCondition)]);
	};

	var ensureInited = function (element, trackData) {
		if (!window.ExoWeb) {
			return;
		}

		var $el = jQuery(element);

		if ($el.attr("__validating") === undefined) {
			// register for model validation events
			var bindings = $el.liveBindings();

			for (var i = 0; i < bindings.length; i++) {
				var binding = bindings[i];
				var srcObj = ExoWeb.View.getFinalSrcObject(binding);
				var propName = ExoWeb.View.getFinalPathStep(binding);

				var meta = srcObj.meta || srcObj;

				var validationData = null;

				if (meta instanceof ExoWeb.Model.ObjectMeta) {
					var property = meta.type.property(propName);

					var metaHandler = onMetaConditionsChanged.bind(element).spliceArguments(2, 0, property);

					if (trackData) {
						validationData = { instance: { type: meta.type.get_fullName(), id: meta.id }, handler: metaHandler };
					}

					meta.addConditionsChanged(metaHandler, property);
				}
				else if (meta && meta.get_conditions) {
					var conditions = meta.get_conditions();

					var collectionHandler = onConditionsCollectionChanged.bind(element);

					if (trackData) {
						validationData = { collection: conditions, handler: collectionHandler };
					}

					ExoWeb.Observer.addCollectionChanged(conditions, collectionHandler);
				}

				if (trackData) {
					$el.data("validated", validationData);
				}
			}

			// don't double register for events
			$el.attr("__validating", true);
		}
	};

	jQuery.fn.validated = function (f, trackData) {
		this.each(function () {
			jQuery(this).bind('validated', f);
			ensureInited(this, trackData);
		});

		return this;
	};

	// Gets all model rules associated with the property an element is bound to
	jQuery.fn.rules = function (ruleType) {
		if (!window.Sys || !window.ExoWeb || !ExoWeb.Model) return [];

		return jQuery(this).liveBindings()
			.map(function(binding) {
				return ExoWeb.View.getBindingInfo(binding);
			}).filter(function(info) {
				return !!info.property;
			}).map(function(info) {
				return info.property.rule(ruleType);
			});
	};

	jQuery.fn.errors = function () {
		if (!window.Sys || !window.ExoWeb || !ExoWeb.Model) return [];

		return jQuery(this).liveBindings().mapToArray(function (binding) {

			var source = binding.get_source();
			if (source instanceof ExoWeb.View.Adapter) {
				return source.get_conditions().filter(isError);
			}
			else {
				var info = ExoWeb.View.getBindingInfo(binding);

				// Guard against null/undefined target.  This could happen if the target is 
				// undefined, or if the path is multi-hop, and the full path is not defined.
				if (!info.target || !info.property) return [];

				return info.target.meta.conditions(info.property).filter(isError);
			}
		});
	};

	// #endregion

	// #region Selectors
	//////////////////////////////////////////////////

	var exoWebAndModel = false;

	jQuery.expr[":"].rule = function (obj, index, meta, stack) {
		if (exoWebAndModel === false) {
			if (!(window.ExoWeb && ExoWeb.Model))
				return false;
			exoWebAndModel = true;
		}

		var ruleName = meta[3];
		var ruleType = ExoWeb.Model.Rule[ruleName];

		if (!ruleType) {
			throw new Error("Unknown rule in selector: " + ruleName);
		}

		return jQuery(obj).rules(ruleType).length > 0;
	};

	jQuery.expr[":"].bound = function (obj, index, meta, stack) {
		if (exoWebAndModel === false) {
			if (!(window.ExoWeb && ExoWeb.Model))
				return false;
			exoWebAndModel = true;
		}

		return jQuery(obj).liveBindings().length > 0;
	};

	//////////////////////////////////////////////////////////////////////////////////////
	// helpers for working with controls
	var dataviewPrereqs = false;
	jQuery.expr[":"].dataview = function (obj, index, meta, stack) {
		if (dataviewPrereqs === false) {
			if (!(window.Sys !== undefined && Sys.UI !== undefined && obj.control !== undefined && Sys.UI.DataView !== undefined))
				return false;
			dataviewPrereqs = true;
		}

		return obj.control instanceof Sys.UI.DataView;
	};

	var contentPrereqs = false;
	jQuery.expr[":"].content = function (obj, index, meta, stack) {
		if (contentPrereqs === false) {
			if (!(window.ExoWeb !== undefined && ExoWeb.UI !== undefined && obj.control !== undefined && ExoWeb.UI.Content !== undefined && obj.control))
				return false;

			contentPrereqs = true;
		}

		return obj.control instanceof ExoWeb.UI.Content;
	};

	var togglePrereqs = false;
	jQuery.expr[":"].toggle = function (obj, index, meta, stack) {
		if (togglePrereqs === false) {
			if (!(window.ExoWeb !== undefined && ExoWeb.UI !== undefined && obj.control !== undefined && ExoWeb.UI.Toggle !== undefined && obj.control))
				return false;

			togglePrereqs = true;
		}

		return obj.control instanceof ExoWeb.UI.Toggle;
	};

	jQuery.expr[":"].control = function (obj, index, meta, stack) {
		var typeName = meta[3];
		var jstype = new Function("{return " + typeName + ";}");

		return obj.control instanceof jstype();
	};

	// #endregion

	// #region Helpers
	//////////////////////////////////////////////////

	jQuery.fn.control = function jQuery$control(propName, propValue) {
		if (arguments.length === 0) {
			return this.get(0).control;
		}
		else if (arguments.length == 1) {
			return this.get(0).control["get_" + propName]();
		}
		else {
			this.each(function jQuery$control$one(index, element) {
				this.control["set_" + propName](propValue);
			});
		}
	};

	jQuery.fn.commands = function jQuery$commands(commands) {
		var control = this.control();
		control.add_command(function jQuery$commands$command(sender, args) {
			var handler = commands[args.get_commandName()];
			if (handler) {
				handler(sender, args);
			}
		});
	};

	// Gets all Sys.Bindings for an element
	jQuery.fn.liveBindings = function jQuery$liveBindings() {
		var bindings = [];
		this.each(function jQuery$liveBindings$one() {
			if (this.__msajaxbindings)
				Array.addRange(bindings, this.__msajaxbindings);
		});
		return bindings;
	};

	// #endregion

	// #region Ever
	//////////////////////////////////////////////////

	// Cache lists of ever handlers by type
	var everHandlers = { added: [], deleted: [], bound: [], unbound: [] };

	var processElements = function processElements(container, els, action, source) {
		// Determine if the input is an array
		var isArr = Object.prototype.toString.call(els) === "[object Array]",

			// The number of elements to process
			numEls = isArr ? els.length : 1,

			// Cache of handlers for the action in question
			actionHandlers,

			// The number of unfiltered handlers
			numActionHandlers,

			// Handlers that are applicable to this call
			handlers,

			// The number of cached handlers
			numHandlers,

			// Determines whether to search children for matches
			doSearch,

			// Element iteration index variable
			i = 0,

			// Element iteration item variable
			el,

			// Optimization: cache the jQuery object for the element
			$el,

			// Handler iteration index variable
			j,

			// Handler iteration item variable
			handler;

		if (numEls === 0) {
			return;
		}

		actionHandlers = everHandlers[action];

		// Filter based on source and context
		i = -1;
		numActionHandlers = actionHandlers.length;
		handlers = [];
		while (++i < numActionHandlers) {
			handler = actionHandlers[i];

			// If a handler source is specified then filter by the source
			if (handler.source && handler.source !== source) {
				continue;
			}

			// If a handler context is specified then see if it contains the given container, or equals if children were passed in
			if (handler.context && !((isArr && handler.context === container) || jQuery.contains(handler.context, container))) {
				continue;
			}

			handlers.push(handler);
		}

		numHandlers = handlers.length;

		if (numHandlers === 0) {
			return;
		}

		// Only perform descendent search for added/deleted actions, since this
		// doesn't make sense for bound/unbound, which are specific to an element.
		doSearch = action === "added" || action === "deleted";

		i = -1;
		while (++i < numEls) {
			el = isArr ? els[i] : els;

			// Only process elements
			if (el.nodeType === 1) {
				j = 0;
				$el = jQuery(el);

				while (j < numHandlers) {
					handler = handlers[j++];

					// Test root
					if ($el.is(handler.selector)) {
						handler.action.apply(el, [0, el]);
					}

					if (doSearch && el.children.length > 0) {
						// Test children
						$el.find(handler.selector).each(handler.action);
					}
				}
			}
		}
	};

	var interceptingBound = false;
	var interceptingTemplates = false;
	var interceptingWebForms = false;
	var interceptingToggle = false;
	var interceptingContent = false;
	var partialPageLoadOccurred = false;

	function ensureIntercepting() {
		if (!interceptingBound && window.Sys && Sys.Binding && Sys.UI && Sys.UI.TemplateContext) {
			var addBinding = Sys.Binding.prototype._addBinding;
			if (!addBinding) {
				throw new Error("Could not find Binding._addBinding method to override.");
			}
			Sys.Binding.prototype._addBinding = function addBinding$wrap(element) {
				addBinding.apply(this, arguments);
				var ctx = this._templateContext;
				if (ctx._completed && ctx._completed.length > 0) {
					ctx.add_instantiated(function addBinding$contextInstantiated() {
						processElements(element, element, "bound");
					});
				}
				else {
					processElements(element, element, "bound");
				}
			};
			var disposeBindings = Sys.Binding._disposeBindings;
			if (!disposeBindings) {
				throw new Error("Could not find Binding._disposeBindings method to override.");
			}
			Sys.Binding._disposeBindings = function disposeBindings$wrap() {
				disposeBindings.apply(this, arguments);
				processElements(this, this, "unbound");
			};
			interceptingBound = true;
		}

		if (!interceptingTemplates && window.Sys && Sys.UI && Sys.UI.Template) {
			var instantiateInBase = Sys.UI.Template.prototype.instantiateIn;
			if (!instantiateInBase) {
				throw new Error("Could not find Template.instantiateIn method to override.");
			}
			Sys.UI.Template.prototype.instantiateIn = function instantiateIn$wrap() {
				var context = instantiateInBase.apply(this, arguments);
				if (context.nodes.length > 0) {
					processElements(context.containerElement, context.nodes, "added", "template");
				}
				return context;
			};
			// intercept Sys.UI.DataView._clearContainers called conditionally during dispose() and refresh().
			// dispose is too late because the nodes will have been cleared out.
			Sys.UI.DataView.prototype._clearContainers = function _clearContainers$override(placeholders, start, count) {
				var i, len, nodes, startNode, endNode, context;
				for (i = start || 0, len = count ? (start + count) : this._contexts.length; i < len; i++) {
					context = this._contexts[i];
					nodes = context.nodes;
					if (nodes.length > 0) {
						processElements(context.containerElement, nodes, "deleted", "template");
					}
					if (count) {
						if (!startNode) {
							startNode = nodes[0];
						}
						if (nodes.length > 0) {
							endNode = nodes[nodes.length - 1];
						}
					}
				}
				for (i = 0, len = placeholders.length; i < len; i++) {
					var ph = placeholders[i],
						container = ph ? ph.parentNode : this.get_element();
					if (!count || (startNode && endNode)) {
						this._clearContainer(container, ph, startNode, endNode, true);
					}
				}
				for (i = start || 0, len = count ? (start + count) : this._contexts.length; i < len; i++) {
					var ctx = this._contexts[i];
					ctx.nodes = null;
					ctx.dispose();
				}
			};
			Sys.UI.DataView.prototype._clearContainer = function _clearContainer$override(container, placeholder, startNode, endNode, suppressEvent) {
				var count = placeholder ? placeholder.__msajaxphcount : -1;
				if ((count > -1) && placeholder) placeholder.__msajaxphcount = 0;
				if (count < 0) {
					if (placeholder) {
						container.removeChild(placeholder);
					}
					if (!suppressEvent) {
						if (container.childNodes.length > 0) {
							processElements(container, container.childNodes, "deleted", "template");
						}
					}
					if (!startNode) {
						Sys.Application.disposeElement(container, true);
					}
					var cleared = false;
					if (!startNode) {
						try {
							container.innerHTML = "";
							cleared = true;
						}
						catch (err) { }
					}
					if (!cleared) {
						var child = startNode || container.firstChild, nextChild;
						while (child) {
							nextChild = child === endNode ? null : child.nextSibling;
							Sys.Application.disposeElement(child, false);
							container.removeChild(child);
							child = nextChild;
						}
					}
					if (placeholder) {
						container.appendChild(placeholder);
					}
				}
				else if (count > 0) {
					var i, l, start, children = container.childNodes;
					for (i = 0, l = children.length; i < l; i++) {
						if (children[i] === placeholder) {
							break;
						}
					}
					start = i - count;
					for (i = 0; i < count; i++) {
						var element = children[start];
						processElements(element, element, "deleted", "template");
						Sys.Application.disposeElement(element, false);
						container.removeChild(element);
					}
				}
			};
			interceptingTemplates = true;
		}

		if (!interceptingWebForms && window.Sys && Sys.WebForms && Sys.WebForms.PageRequestManager) {
			Sys.WebForms.PageRequestManager.getInstance().add_pageLoading(function PageRequestManager$ever_deleted(sender, evt) {
				partialPageLoadOccurred = true;
				var updating = evt.get_panelsUpdating();
				if (updating.length > 0) {
					processElements(null, updating, "deleted", "updatePanel");
				}
			});
			Sys.WebForms.PageRequestManager.getInstance().add_pageLoaded(function PageRequestManager$ever_added(sender, evt) {
				// Only process elements for update panels that were added if we have actually done a partial update.
				// This is needed so that the "ever" handler is not called twice when a panel is added to the page on first page load.
				if (partialPageLoadOccurred) {
					var created = evt.get_panelsCreated();
					if (created.length > 0) {
						processElements(null, created, "added", "updatePanel");
					}
				}

				var updated = evt.get_panelsUpdated();
				if (updated.length > 0) {
					processElements(null, updated, "added", "updatePanel");
				}
			});
			interceptingWebForms = true;
		}

		if (!interceptingToggle && window.ExoWeb && ExoWeb.UI && ExoWeb.UI.Toggle) {
			var undoRender = ExoWeb.UI.Toggle.prototype.undo_render;
			if (!undoRender) {
				throw new Error("Could not find Toggle.undo_render method to override.");
			}
			ExoWeb.UI.Toggle.prototype.undo_render = function Toggle$undo_render$wrap() {
				var children = this._element.children;
				if (children.length > 0) {
					processElements(this._element, children, "deleted", "template");
				}
				undoRender.apply(this, arguments);
			};
			var toggleDispose = ExoWeb.UI.Toggle.prototype.do_dispose;
			if (!toggleDispose) {
				throw new Error("Could not find Toggle.do_dispose method to override.");
			}
			ExoWeb.UI.Toggle.prototype.do_dispose = function Toggle$do_dispose$wrap() {
				var children = this._element.children;
				if (children.length > 0) {
					processElements(this._element, children, "deleted", "template");
				}
				toggleDispose.apply(this, arguments);
			};
			interceptingToggle = true;
		}

		if (!interceptingContent && window.ExoWeb && ExoWeb.UI && ExoWeb.UI.Content) {
			var _render = ExoWeb.UI.Content.prototype._render;
			if (!_render) {
				throw new Error("Could not find Content._render method to override.");
			}
			ExoWeb.UI.Content.prototype._render = function Content$_render$wrap() {
				if (this._element) {
					var children = this._element.children;
					if (children.length > 0) {
						processElements(this._element, children, "deleted", "template");
					}
				}
				_render.apply(this, arguments);
			};
			interceptingContent = true;
		}
	}

	var rootContext = jQuery("body").context;

	var addEverHandler = function addEverHandler(context, selector, type, source, action) {
		var handlers, i, len, handler, existingHandler, existingFn;
		i = 0;
		handlers = everHandlers[type];
		len = handlers.length;
		while (i < len) {
			existingHandler = handlers[i++];
			if (existingHandler.context === context && existingHandler.source === source && existingHandler.selector === selector) {
				handler = existingHandler;
				break;
			}
		}
		if (!handler) {
			handler = { selector: selector, action: action };
			if (context) {
				handler.context = context;
			}
			handlers.push(handler);
		}
		else if (handler.action.add) {
			handler.action.add(action);
		}
		else {
			existingFn = handler.action;
			if (window.ExoWeb) {
				handler.action = ExoWeb.Functor();
				handler.action.add(existingFn);
				handler.action.add(action);
			}
			else {
				handler.action = function () {
					existingFn.apply(this, arguments);
					action.apply(this, arguments);
				};
			}
		}
	};

	// Matches elements as they are dynamically added to the DOM
	jQuery.fn.ever = function jQuery$ever(opts) {

		// The non-selector context that was passed into this jQuery object
		var queryContext,

			// The selector that was specified on the query
			querySelector = this.selector,

			// The jQuery objects that the action may be immediately performed for
			boundImmediate,
			addedImmediate,

			// The options the will be used to add handlers
			options;

		// Optimization: only make a record of the context if it's not the root context
		if (this.context !== rootContext) {
			queryContext = this.context;
		}

		// Handle legacy form
		if (typeof (opts) === "function") {
			addedImmediate = this;
			options = {
				context: queryContext,
				selector: querySelector,
				added: opts,
				deleted: arguments[1]
			};
		}
			// Use options argument directly
		else {
			options = opts;
			// Detect non-supported options
			if (window.ExoWeb) {
				for (var opt in options) {
					if (options.hasOwnProperty(opt) && !/^(selector|source|added|deleted|bound|unbound)$/.test(opt)) {
						logWarning("Unexpected option \"" + opt + "\"");
					}
				}
			}
			// Set the context if it was specified
			if (queryContext) {
				options.context = queryContext;
			}
			// Filter the immediate object if it will be used to invoke immediately (added/bound)
			if (options.added) {
				addedImmediate = this;
				if (options.selector) {
					addedImmediate = addedImmediate.find(options.selector);
				}
			}
			if (options.bound) {
				boundImmediate = this;
				if (options.selector) {
					boundImmediate = boundImmediate.find(options.selector);
				}
				boundImmediate = boundImmediate.filter(":bound");
			}
			// Merge the query selector with the options selector
			if (querySelector) {
				if (options.selector) {
					options.selector = querySelector.replace(/,/g, " " + options.selector + ",") + " " + options.selector;
				}
				else {
					options.selector = querySelector;
				}
			}
			else if (!options.selector) {
				throw new Error("Ever requires a selector");
			}
			if (window.ExoWeb && options.source) {
				if (!(options.added || options.deleted)) {
					logWarning("The source option only applies to added and deleted handlers");
				}
				if (options.source !== "template" && options.source !== "updatePanel") {
					logWarning("Unexpected source \"" + options.source + "\"");
				}
			}
		}

		// Add ever handlers
		if (options.added) {
			if (addedImmediate.length > 0) {
				addedImmediate.each(options.added);
			}
			addEverHandler(options.context, options.selector, "added", options.source, options.added);
		}
		if (options.deleted) {
			addEverHandler(options.context, options.selector, "deleted", options.source, options.deleted);
		}
		if (options.bound) {
			if (boundImmediate.length > 0) {
				boundImmediate.each(options.bound);
			}
			addEverHandler(options.context, options.selector, "bound", options.source, options.bound);
		}
		if (options.unbound) {
			addEverHandler(options.context, options.selector, "unbound", options.source, options.unbound);
		}

		// Ensure that code is being overriden to call ever handlers where appropriate
		ensureIntercepting();

		// Really shouldn't chain calls b/c only elements currently in the DOM would be affected
		return null;
	};

	// #endregion

	// #region ExoWeb.DotNet.WebService
	//////////////////////////////////////////////////

	var webServiceConfig = {
		/*
		 * Specify the application's root URL. Otherwise it is assumed that
		 * the root is the URL up to the first forward slash '/'.
		 */
		appRoot: null,

		/*
		 * If set to true, when requests are sent they will use the text "Save", "Roundtrip", or the
		 * specific method name as an alias for "Request".  If the method name would collide with
		 * another procedure ("GetType" or "LogError"), then "Request" will be used instead.
		 */
		aliasRequests: false
	};

	ExoWeb.DotNet.config = webServiceConfig;

	var path = window.location.pathname;
	var idx = path.lastIndexOf("/");

	if (idx > 0 && idx < path.length - 1) {
		path = path.substring(0, idx + 1);
	}
	else if (idx === 0 && path.length > 1) {
		path += "/";
	}

	var fmt = window.location.port ? "{0}//{1}:{2}" : "{0}//{1}";
	var host = $format(fmt, window.location.protocol, window.location.hostname, window.location.port);

	function getPath() {
		return host + (webServiceConfig.appRoot || path) + "ExoWeb.axd";
	}

	function sendRequest(options) {
		// Include config data in request
		options.data.config = webServiceConfig;

		jQuery.ajax({
			url: getPath() + "/" + options.path,
			type: options.type,
			data: JSON.stringify(options.data),
			processData: false,
			dataType: "text",
			contentType: "application/json",
			success: function(result) {
				options.onSuccess(JSON.parse(result));
			},
			error: function(result) {
				var error = { message: result.statusText };
				try
				{
					error = JSON.parse(result.responseText);
				}
				catch(e) {}
				options.onFailure(error);
			}
		});
	}

	ExoWeb.Mapper.setEventProvider(function (eventType, eventInstance, event, paths, changes, scopeQueries, onSuccess, onFailure) {
		sendRequest({
			type: "Post",
			path: webServiceConfig.aliasRequests && eventType !== "GetType" && eventType !== "LogError" ? eventType : "Request",
			data: {
				events: [{ type: eventType, include: paths, instance: eventInstance, event: event }],
				queries: scopeQueries,
				changes: changes
			},
			onSuccess: onSuccess,
			onFailure: onFailure
		});
	});

	ExoWeb.Mapper.setRoundtripProvider(function (root, paths, changes, scopeQueries, onSuccess, onFailure) {
		var queries = [];

		if (root) {
			queries.push({
				from: root.type,
				ids: [root.id],
				include: paths,
				inScope: true,
				forLoad: true
			});
		}

		queries.addRange(scopeQueries);

		sendRequest({
			type: "Post",
			path: webServiceConfig.aliasRequests ? "Roundtrip" : "Request",
			data: {
				changes: changes,
				queries: queries
			},
			onSuccess: onSuccess,
			onFailure: onFailure
		});
	});

	ExoWeb.Mapper.setObjectProvider(function (type, ids, paths, inScope, changes, scopeQueries, onSuccess, onFailure) {
		sendRequest({
			type: "Post",
			path: webServiceConfig.aliasRequests ? "LoadObject" : "Request",
			data: {
				queries:[{
					from: type,
					ids: ids,
					include: paths,
					inScope: inScope,
					forLoad: true
				}].concat(scopeQueries),
				changes:changes
			},
			onSuccess: onSuccess,
			onFailure: onFailure
		});
	});

	ExoWeb.Mapper.setQueryProvider(function (queries, changes, scopeQueries, onSuccess, onFailure) {
		sendRequest({
			type: "Post",
			path: webServiceConfig.aliasRequests ? "Query" : "Request",
			data: {
				changes: changes,
				queries: queries.concat(scopeQueries)
			},
			onSuccess: onSuccess,
			onFailure: onFailure
		});
	});

	ExoWeb.Mapper.setSaveProvider(function (root, changes, scopeQueries, onSuccess, onFailure) {
		sendRequest({
			type: "Post",
			path: webServiceConfig.aliasRequests ? "Save" : "Request",
			data: {
				events:[{type: "Save", instance: root}],
				queries: scopeQueries,
				changes:changes
			},
			onSuccess: onSuccess,
			onFailure: onFailure
		});
	});

	ExoWeb.Mapper.setListProvider(function (ownerType, ownerId, paths, changes, scopeQueries, onSuccess, onFailure) {
		sendRequest({
			type: "Post",
			path: webServiceConfig.aliasRequests ? "LoadList" : "Request",
			data: {
				queries: [{
					from: ownerType,
					ids: ownerId === null ? [] : [ownerId],
					include: paths,
					inScope: false,
					forLoad: true
				}].concat(scopeQueries),
				changes: changes
			},
			onSuccess: onSuccess,
			onFailure: onFailure
		});
	});

	ExoWeb.Mapper.setTypeProvider(function (types, onSuccess, onFailure) {
		if (types.length === 1) {
			var data = { type: types[0], config: webServiceConfig};

			if (ExoWeb.cacheHash) {
				data.cachehash = ExoWeb.cacheHash;
			}

			Sys.Net.WebServiceProxy.invoke(getPath(), "GetType", true, data, onSuccess, onFailure, null, 1000000, false, null);
		}
		else {
			sendRequest({
				type: "Post",
				path: webServiceConfig.aliasRequests ? "GetTypes" : "Request",
				data: { types: types },
				onSuccess: onSuccess,
				onFailure: onFailure
			});
		}
	});

	var loggingError = false;
	ExoWeb.setLogErrorProvider(function (errorData, onSuccess, onFailure) {
		if (loggingError === false) {
			try {
				loggingError = true;
				Sys.Net.WebServiceProxy.invoke(
					getPath(),
					"LogError",
					false,
					errorData,
					function () {
						if (onSuccess) {
							onSuccess.apply(this, arguments);
						}
					},
					function () {
						// Don't log errors that occur when trying to log an error.
						if (onFailure) {
							onFailure.apply(this, arguments);
						}
					},
					null,
					1000000,
					false,
					null
				);
			} finally {
				loggingError = false;
			}
		}
	});

	// #endregion

	// #region FormatProvider
	//////////////////////////////////////////////////

	setFormatProvider(function FormatProvider(type, format) {

		// Date
		if (type === Date) {
			// Add support for g and G that are not natively supported by the MSAJAX framework
			if (format === "g")
				format = Date._expandFormat(Sys.CultureInfo.CurrentCulture.dateTimeFormat, "d") + " " + Date._expandFormat(Sys.CultureInfo.CurrentCulture.dateTimeFormat, "t");
			else if (format === "G")
				format = Date._expandFormat(Sys.CultureInfo.CurrentCulture.dateTimeFormat, "d") + " " + Date._expandFormat(Sys.CultureInfo.CurrentCulture.dateTimeFormat, "T");

			return new Format({
				description: "",
				specifier: format,
				convert: function (val) {
					return val.localeFormat(format);
				},
				convertBack: function (str) {
					var date;
					// Time value, set default date to 1/1/1970 to easily compare time values
					if (format === "t") {
						var timeFormat = Date._expandFormat(Sys.CultureInfo.CurrentCulture.dateTimeFormat, "d") + " " + Date._expandFormat(Sys.CultureInfo.CurrentCulture.dateTimeFormat, "t");
						var startDate = new Date(1970, 0, 1).localeFormat("d");
						date = Date.parseLocale(startDate + " " + str, timeFormat);
					}
					else
						date = Date.parseLocale(str, format);

					if (date === null)
						throw new Error("Invalid date format");
					return date;
				}
			});
		}

		// Number
		if (type === Number) {
			var isCurrencyFormat = format.match(/[$c]+/i);
			var isPercentageFormat = format.match(/[%p]+/i);
			var isIntegerFormat = format.match(/[dnfg]0/i);
			var currencyDecimalDigits = Sys.CultureInfo.CurrentCulture.numberFormat.CurrencyDecimalDigits;

			return new Format({
				description: isCurrencyFormat ? Resource["format-currency"] : isPercentageFormat ? Resource["format-percentage"] : isIntegerFormat ? Resource["format-integer"] : Resource["format-decimal"],
				specifier: format,
				convert: function (val) {
					// Default to browser formatting for general format
					if (format.toLowerCase() === "g")
						return val.toString();

					// Otherwise, use the localized format
					return val.localeFormat(format);
				},
				convertBack: function (str) {
					// Handle use of () to denote negative numbers
					var sign = 1;
					if (str.match(/^\(.*\)$/)) {
						str = str.substring(1, str.length - 1);
						sign = -1;
					}
					var result;

					// Remove currency symbols before parsing
					if (isCurrencyFormat) {
						result = Number.parseLocale(str.replace(Sys.CultureInfo.CurrentCulture.numberFormat.CurrencySymbol, "")) * sign;

						// if there is a decimal place, check the precision isnt greater than allowed for currency. 
						// Floating points in js can be skewed under certain circumstances, we are just checking the decimals instead of multiplying results.
						var resultStr = result.toString();
						if (resultStr.indexOf('.') > -1 && (resultStr.length - (resultStr.indexOf('.') + 1)) > currencyDecimalDigits) {
							result = NaN;
						}
					}
						// Remove percentage symbols before parsing and divide by 100
					else if (isPercentageFormat)
						result = Number.parseLocale(str.replace(Sys.CultureInfo.CurrentCulture.numberFormat.PercentSymbol, "")) / 100 * sign;

						// Ensure integers are actual whole numbers
					else if (isIntegerFormat && !isInteger(Number.parseLocale(str)))
						result = NaN;

						// Just parse a simple number
					else
						result = Number.parseLocale(str) * sign;

					if (isNaN(result))
						throw new Error("Invalid format");

					return result;
				}
			});
		}

		// Boolean
		if (type === Boolean) {
			// Format strings used for true, false, and null (or undefined) values
			var trueFormat, falseFormat, nullFormat;

			if (format && format.toLowerCase() === "g") {
				trueFormat = "True";
				falseFormat = "False";
				nullFormat = ""
			}
			else {
				var formats = format.split(';');
				trueFormat = formats.length > 0 ? formats[0] : "";
				falseFormat = formats.length > 1 ? formats[1] : "";
				nullFormat = formats.length > 2 ? formats[2] : "";
			}

			return new Format({
				description: "",
				specifier: format,
				convert: function (val) {
					if (val === true)
						return trueFormat;
					else if (val === false)
						return falseFormat;
					else
						return nullFormat;
				},
				convertBack: function (str) {
					if (str.toLowerCase() === trueFormat.toLowerCase())
						return true;
					else if (str.toLowerCase() === falseFormat.toLowerCase())
						return false;
					else
						return null;
				}
			});
		}

		// Default
		return new Format({
			description: "",
			specifier: "",
			convert: function (val) {
				return val.toString();
			},
			convertBack: function (str) {
				return str;
			}
		});

	});

	// #endregion

	// #region ObserverProvider
	//////////////////////////////////////////////////

	function raiseSpecificPropertyChanged(target, args) {
		var func = target.__propertyChangeHandlers[args.get_propertyName()];
		if (func && func instanceof Function) {
			func.apply(this, arguments);
		}
	}

	setObserverProvider({

		makeObservable: Sys.Observer.makeObservable,

		disposeObservable: Sys.Observer.disposeObservable,

		addCollectionChanged: Sys.Observer.addCollectionChanged,

		removeCollectionChanged: Sys.Observer.removeCollectionChanged,

		addPropertyChanged: function Sys$Observer$addPropertyChanged(target, property, handler) {
			if (!target.__propertyChangeHandlers) {
				target.__propertyChangeHandlers = {};
				Sys.Observer.addPropertyChanged(target, raiseSpecificPropertyChanged);
			}

			var func = target.__propertyChangeHandlers[property];

			if (!func) {
				target.__propertyChangeHandlers[property] = func = ExoWeb.Functor();
			}

			func.add(handler);
		},

		removePropertyChanged: function Sys$Observer$removePropertyChanged(target, property, handler) {
			var func = target.__propertyChangeHandlers ? target.__propertyChangeHandlers[property] : null;

			if (func) {
				func.remove(handler);

				// if the functor is empty then remove the callback as an optimization
				if (func.isEmpty()) {
					delete target.__propertyChangeHandlers[property];

					var hasHandlers = false;
					for (var remainingHandler in target.__propertyChangeHandlers) {
						if (target.__propertyChangeHandlers.hasOwnProperty(remainingHandler)) {
							hasHandlers = true;
						}
					}

					if (!hasHandlers) {
						target.__propertyChangeHandlers = null;
						Sys.Observer.removePropertyChanged(target, raiseSpecificPropertyChanged);
					}
				}
			}
		},

		raisePropertyChanged: Sys.Observer.raisePropertyChanged,

		setValue: Sys.Observer.setValue
	});

	ExoWeb.updateArray = function updateArray(array, items) {
		if (array.beginUpdate && array.endUpdate) {
			array.beginUpdate();
		}
		update(array, items);
		if (array.beginUpdate && array.endUpdate) {
			array.endUpdate();
		}
	};

	// #endregion
})(window.ExoJQuery || jQuery);


/***/ }),

/***/ "../../../Public/ExoWeb/ExoWeb/client/ref/aspnetajax/MicrosoftAjax.debug.js":
/*!*******************************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Public/ExoWeb/ExoWeb/client/ref/aspnetajax/MicrosoftAjax.debug.js ***!
  \*******************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

﻿// Name:        MicrosoftAjax.debug.js
// Assembly:    System.Web.Ajax
// Version:     3.0.31106.1
// FileVersion: 3.0.31106.1


(function(window, Sys) {

var merge = function _merge(target) {
	target = target || {};
	foreach(arguments, function(o) {
		if (o) {
			forIn(o, function(v, n) {
				target[n] = v;
			});
		}
	}, 1);
	return target;
}
var forIn = function _forIn(obj, callback) {
	for (var x in obj) {
		callback(obj[x], x);
	}
}
var foreach = function _foreach(arr, callback, start) {
	var cancelled;
	if (arr) {
		// javascript array
		arr = arr !== window && typeof (arr.nodeType) === "undefined" &&
			(arr instanceof Array ||
		// arguments array, or nodelist (has .item and is not a dom element or window)
			(typeof (arr.length) === 'number' && (typeof (arr.callee) === "function" || (arr.item && typeof (arr.nodeType) === "undefined") && !arr.addEventListener && !arr.attachEvent)))
			? arr : [arr];
		for (var i = start||0, l = arr.length; i < l; i++) {
			if (callback(arr[i], i)) {
				cancelled = true;
				break;
			}
		}
	}
	return !cancelled;
}
var callIf = function _callIf(obj, name, args) {
	var fn = obj[name],
		exists = typeof(fn) === "function";
	if (exists) fn.call(obj, args);
	return exists;
}

if (!Sys || !Sys.loader) {
	function append(target) {
		target = target || {};
		foreach(arguments, function(o) {
			if (o) {
				forIn(o, function(v, n) {
					if (typeof(target[n]) === "undefined") target[n] = v;
				});
			}
		}, 1);
		return target;
	}

	var notLoading = 0,
		loading = 1,
		loadingCo = 2,
		loaded = 3,
		attachEvent = !!document.attachEvent;
	function getAndDelete(obj, field) {
		var r = obj[field];
		delete obj[field];
		return r;
	}
	function foreachCall(obj, field, args) {
		foreach(getAndDelete(obj, field), function(callback) {
			callback.apply(null, args||[]);
		});
	}
	function lazyget(obj, name, value) {
		return obj ? (obj[name] = obj[name] || value) : value;
	}
	function lazypush(obj, name, value) {
		lazyget(obj, name, []).push(value);
	}
	function lazyset(obj, name, key, value) {
		lazyget(obj, name, {})[key] = value;
	}
	function all(tag, element) {
		return (element||document).getElementsByTagName(tag);
	}
	function createElement(tag) {
		return document.createElement(tag);
	}
	function listenOnce(target, name, ieName, callback, isReadyState, isScript) {
		function onEvent() {
			if (!attachEvent || !isReadyState || /loaded|complete/.test(target.readyState)) {
				if (attachEvent) {
					target.detachEvent(ieName || ("on" + name), onEvent);
				}
				else {
					target.removeEventListener(name, onEvent, false);
					if (isScript) {
						target.removeEventListener("error", onEvent, false);
					}
				}
				callback.apply(target);
				target = null;
			}
		}
		if (attachEvent) {
			target.attachEvent(ieName || ("on" + name), onEvent);
		}
		else {
			target.addEventListener(name, onEvent, false);
			if (isScript) {
				target.addEventListener("error", onEvent, false);
			}
		}
	}
	function raiseDomReady() {
		if (Sys._domReady) {
			Sys._2Pass(getAndDelete(Sys, "_domReadyQueue"));
		}
	}
	function raiseOnReady() {
		var ready = Sys._ready;
		if (!ready && Sys._domReady && !(Sys.loader && Sys.loader._loading)) {
			Sys._ready = ready = true;
		}
		if (ready) {
			Sys._2Pass(getAndDelete(Sys, "_readyQueue"));
		}
	}
	window.Sys = Sys = append(Sys, {
		version: [3, 0, 31106, 1],
		__class: true,
		debug: true,
		scripts: {},
		activateDom: true,
		composites: {},
		components: {},
		plugins: {},
		create: {},
		converters: {},
		_domLoaded: function _domLoaded() {
			function domReady() {
				if (!Sys._domReady) {
					Sys._domReady = true;
					raiseDomReady();
					raiseOnReady();
				}
			}
			listenOnce(window, "load", null, domReady);

			var check;
			if (attachEvent) {
				if ((window == window.top) && document.documentElement.doScroll) {
					var timeout, er, el = createElement("div");
					check = function() {
						try {
							el.doScroll("left");
						}
						catch (er) {
							timeout = window.setTimeout(check, 0);
							return;
						}
						el = null;
						domReady();
					}
					check();
				}
				else {
					listenOnce(document, null, "onreadystatechange", domReady, true);
				}
			}
			else if (document.addEventListener) {
				listenOnce(document, "DOMContentLoaded", null, domReady);
			}
		},
		_getById: function _getById(found, id, single, includeSelf, element) {
			if (element) {
				if (includeSelf && (element.id === id)) {
					found[0] = element;
				}
				else {
					foreach(all("*", element), function(element) {
						if (element.id === id) {
							found[0] = element;
							return true;
						}
					});
				}
			}
			else {
				var e = document.getElementById(id);
				if (e) found[0] = e;
			}
			return found.length;
		},
		_getByClass: function _getByClass(found, targetClass, single, includeSelf, element) {
			function pushIfMatch(element) {
				var ret, className = element.className;
				if (className && ((className === targetClass) || (className.indexOf(' ' + targetClass) >= 0) || (className.indexOf(targetClass + ' ') >= 0))) {
					found.push(element);
					ret = true;
				}
				return ret;
			}
			var i, l, nodes;
			if (includeSelf && pushIfMatch(element) && single) {
				return true;
			}
			element = element || document;
			var finder = element.querySelectorAll || element.getElementsByClassName;
			if (finder) {
				if (element.querySelectorAll) targetClass = "." + targetClass;
				nodes = finder.call(element, targetClass);
				for (i = 0, l = nodes.length; i < l; i++) {
					found.push(nodes[i]);
					if (single) return true;
				}
			}
			else {
				nodes = all("*", element);
				for (i = 0, l = nodes.length; i < l; i++) {
					if (pushIfMatch(nodes[i]) && single) {
						return true;
					}
				}
			}
		},
		query: function query(selector, context) {
			/// <summary locid="M:J#query" />
			/// <param name="selector"></param>
			/// <param name="context" optional="true" mayBeNull="true"></param>
			/// <returns type="Array"></returns>
			return (context && typeof(context.query) === "function") ?
				context.query(selector) :
				this._find(selector, context);
		},
		get: function get(selector, context) {
			/// <summary locid="M:J#get" />
			/// <param name="selector"></param>
			/// <param name="context" optional="true" mayBeNull="true"></param>
			/// <returns></returns>
			return (context && typeof(context.get) === "function") ?
				context.get(selector) :
				this._find(selector, context, true);
		},
		_find: function _find(selector, context, single) {
			var found = [];
			if (typeof(selector) !== "string") {
				found.push(selector);
			}
			else {
				var includeSelf = context instanceof Array,
					match = /^([\$#\.])((\w|[$:\.\-])+)$/.exec(selector);
				if (match && match.length === 4) {
					selector = match[2];
					var type = match[1];
					if (type === "$") {
						Sys._getComponent(found, selector, context);
					}
					else {
						var finder = type === "#" ? Sys._getById : Sys._getByClass;
						if (context) {
							foreach(context, function(node) {
								if (node.nodeType === 1) {
									return finder(found, selector, single, includeSelf, node);
								}
							});
						}
						else {
							finder(found, selector, single);
						}
					}
				}
				else if (/^\w+$/.test(selector)) {
					if (includeSelf) {
						foreach(context, function(node) {
							if (node.nodeType === 1) {
								if (node.tagName.toLowerCase() === selector) {
									found.push(node);
									if (single) return true;
								}
								if(!foreach(all(selector, node), function(node) {
									found.push(node);
									if (single) return true;
								})) {
									return true;
								}
							}
						});
					}
					else {
						var nodes = all(selector, context);
						if (single) {
							return (nodes[0] || null);
						}
						foreach(nodes, function(node) {
							found.push(node);
						});
					}
				}
				else if (window.jQuery) {
					found = jQuery(selector).get();
				}
			}
			return found.length ? (single ? found[0] : found) : null;
		},
		onDomReady: function onDomReady(callback) {
			/// <summary locid="M:J#onDomReady" />
			/// <param name="callback" type="Function"></param>
			lazypush(this, "_domReadyQueue", callback);
			raiseDomReady();
		},
		onReady: function onReady(callback) {
			/// <summary locid="M:J#onReady" />
			/// <param name="callback" type="Function"></param>
			lazypush(this, "_readyQueue", callback);
			raiseOnReady();
		}
				/// <summary locid="M:J#registerScript" />
				/// <param name="name" type="String"></param>
				/// <param name="executionDependencies" mayBeNull="true" type="Array" elementType="String"></param>
				/// <param name="executionCallback" type="Function"></param>
	});
	Sys._getComponent = Sys._getComponent || function() { }
	Sys._2Pass = Sys._2Pass || function _2Pass(callback) {
	   foreach(callback, function(c) { c(); });
	}

Sys._domLoaded();
}

function execute() {

Sys._foreach = foreach;
Sys._forIn = forIn;
Sys._merge = merge;
Sys._callIf = callIf;

Function.__typeName = 'Function';
Function.__class = true;

Function.createCallback = function Function$createCallback(method, context) {
	/// <summary locid="M:J#Function.createCallback" />
	/// <param name="method" type="Function"></param>
	/// <param name="context" mayBeNull="true"></param>
	/// <returns type="Function"></returns>



	return function() {
		var l = arguments.length;
		if (l > 0) {
			var args = [];
			for (var i = 0; i < l; i++) {
				args[i] = arguments[i];
			}
			args[l] = context;
			return method.apply(this, args);
		}
		return method.call(this, context);
	}
}

Function.createDelegate = function Function$createDelegate(instance, method) {
	/// <summary locid="M:J#Function.createDelegate" />
	/// <param name="instance" mayBeNull="true"></param>
	/// <param name="method" type="Function"></param>
	/// <returns type="Function"></returns>



	return function() {
		return method.apply(instance, arguments);
	}
}

Function.emptyFunction = Function.emptyMethod = function Function$emptyMethod() {
	/// <summary locid="M:J#Function.emptyMethod" />
}

Function.validateParameters = function Function$validateParameters(parameters, expectedParameters, validateParameterCount) {
	/// <summary locid="M:J#Function.validateParameters" />
	/// <param name="parameters"></param>
	/// <param name="expectedParameters"></param>
	/// <param name="validateParameterCount" type="Boolean" optional="true" mayBeNull="true"></param>
	/// <returns type="Error" mayBeNull="true"></returns>

	return Function._validateParams(parameters, expectedParameters, validateParameterCount);
}

Function._validateParams = function Function$_validateParams(params, expectedParams, validateParameterCount) {
	var e, expectedLength = expectedParams.length;
	validateParameterCount = validateParameterCount !== false;
	e = Function._validateParameterCount(params, expectedParams, validateParameterCount);
	if (e) {
		e.popStackFrame();
		return e;
	}
	for (var i = 0, l = params.length; i < l; i++) {
		var expectedParam = expectedParams[Math.min(i, expectedLength - 1)],
			paramName = expectedParam.name;
		if (expectedParam.parameterArray) {
			paramName += "[" + (i - expectedLength + 1) + "]";
		}
		else if (!validateParameterCount && (i >= expectedLength)) {
			break;
		}
		e = Function._validateParameter(params[i], expectedParam, paramName);
		if (e) {
			e.popStackFrame();
			return e;
		}
	}
	return null;
}

Function._validateParameterCount = function Function$_validateParameterCount(params, expectedParams, validateParameterCount) {
	var i, error,
		expectedLen = expectedParams.length,
		actualLen = params.length;
	if (actualLen < expectedLen) {
		var minParams = expectedLen;
		for (i = 0; i < expectedLen; i++) {
			var param = expectedParams[i];
			if (param.optional || param.parameterArray) {
				minParams--;
			}
		}
		if (actualLen < minParams) {
			error = true;
		}
	}
	else if (validateParameterCount && (actualLen > expectedLen)) {
		error = true;
		for (i = 0; i < expectedLen; i++) {
			if (expectedParams[i].parameterArray) {
				error = false;
				break;
			}
		}
	}

	if (error) {
		var e = Error.parameterCount();
		e.popStackFrame();
		return e;
	}

	return null;
}

Function._validateParameter = function Function$_validateParameter(param, expectedParam, paramName) {
	var e,
		expectedType = expectedParam.type,
		expectedInteger = !!expectedParam.integer,
		expectedDomElement = !!expectedParam.domElement,
		mayBeNull = !!expectedParam.mayBeNull;

	e = Function._validateParameterType(param, expectedType, expectedInteger, expectedDomElement, mayBeNull, paramName);
	if (e) {
		e.popStackFrame();
		return e;
	}

	var expectedElementType = expectedParam.elementType,
		elementMayBeNull = !!expectedParam.elementMayBeNull;
	if (expectedType === Array && typeof(param) !== "undefined" && param !== null &&
		(expectedElementType || !elementMayBeNull)) {
		var expectedElementInteger = !!expectedParam.elementInteger,
			expectedElementDomElement = !!expectedParam.elementDomElement;
		for (var i=0; i < param.length; i++) {
			var elem = param[i];
			e = Function._validateParameterType(elem, expectedElementType,
				expectedElementInteger, expectedElementDomElement, elementMayBeNull,
				paramName + "[" + i + "]");
			if (e) {
				e.popStackFrame();
				return e;
			}
		}
	}

	return null;
}

Function._validateParameterType = function Function$_validateParameterType(param, expectedType, expectedInteger, expectedDomElement, mayBeNull, paramName) {
	var e, i;

	if (typeof(param) === "undefined") {
		if (mayBeNull) {
			return null;
		}
		else {
			e = Error.argumentUndefined(paramName);
			e.popStackFrame();
			return e;
		}
	}

	if (param === null) {
		if (mayBeNull) {
			return null;
		}
		else {
			e = Error.argumentNull(paramName);
			e.popStackFrame();
			return e;
		}
	}

	if (expectedType && expectedType.__enum) {
		if (typeof(param) !== 'number') {
			e = Error.argumentType(paramName, Object.getType(param), expectedType);
			e.popStackFrame();
			return e;
		}
		if ((param % 1) === 0) {
			var values = expectedType.prototype;
			if (!expectedType.__flags || (param === 0)) {
				for (i in values) {
					if (values[i] === param) return null;
				}
			}
			else {
				var v = param;
				for (i in values) {
					var vali = values[i];
					if (vali === 0) continue;
					if ((vali & param) === vali) {
						v -= vali;
					}
					if (v === 0) return null;
				}
			}
		}
		e = Error.argumentOutOfRange(paramName, param, String.format(Sys.Res.enumInvalidValue, param, expectedType.getName()));
		e.popStackFrame();
		return e;
	}

	if (expectedDomElement && (!Sys._isDomElement(param) || (param.nodeType === 3))) {
		e = Error.argument(paramName, Sys.Res.argumentDomElement);
		e.popStackFrame();
		return e;
	}

	if (expectedType && !Sys._isInstanceOfType(expectedType, param)) {
		e = Error.argumentType(paramName, Object.getType(param), expectedType);
		e.popStackFrame();
		return e;
	}

	if (expectedType === Number && expectedInteger) {
		if ((param % 1) !== 0) {
			e = Error.argumentOutOfRange(paramName, param, Sys.Res.argumentInteger);
			e.popStackFrame();
			return e;
		}
	}

	return null;
}
Error.__typeName = 'Error';
Error.__class = true;

Error.create = function Error$create(message, errorInfo) {
	/// <summary locid="M:J#Error.create" />
	/// <param name="message" type="String" optional="true" mayBeNull="true"></param>
	/// <param name="errorInfo" optional="true" mayBeNull="true"></param>
	/// <returns type="Error"></returns>


	var err = new Error(message);
	err.message = message;

	if (errorInfo) {
		for (var v in errorInfo) {
			err[v] = errorInfo[v];
		}
	}

	err.popStackFrame();
	return err;
}







Error.argument = function Error$argument(paramName, message) {
	/// <summary locid="M:J#Error.argument" />
	/// <param name="paramName" type="String" optional="true" mayBeNull="true"></param>
	/// <param name="message" type="String" optional="true" mayBeNull="true"></param>
	/// <returns></returns>


	var displayMessage = "Sys.ArgumentException: " + (message ? message : Sys.Res.argument);
	if (paramName) {
		displayMessage += "\n" + String.format(Sys.Res.paramName, paramName);
	}

	var err = Error.create(displayMessage, { name: "Sys.ArgumentException", paramName: paramName });
	err.popStackFrame();
	return err;
}

Error.argumentNull = function Error$argumentNull(paramName, message) {
	/// <summary locid="M:J#Error.argumentNull" />
	/// <param name="paramName" type="String" optional="true" mayBeNull="true"></param>
	/// <param name="message" type="String" optional="true" mayBeNull="true"></param>
	/// <returns></returns>


	var displayMessage = "Sys.ArgumentNullException: " + (message ? message : Sys.Res.argumentNull);
	if (paramName) {
		displayMessage += "\n" + String.format(Sys.Res.paramName, paramName);
	}

	var err = Error.create(displayMessage, { name: "Sys.ArgumentNullException", paramName: paramName });
	err.popStackFrame();
	return err;
}

Error.argumentOutOfRange = function Error$argumentOutOfRange(paramName, actualValue, message) {
	/// <summary locid="M:J#Error.argumentOutOfRange" />
	/// <param name="paramName" type="String" optional="true" mayBeNull="true"></param>
	/// <param name="actualValue" optional="true" mayBeNull="true"></param>
	/// <param name="message" type="String" optional="true" mayBeNull="true"></param>
	/// <returns></returns>


	var displayMessage = "Sys.ArgumentOutOfRangeException: " + (message ? message : Sys.Res.argumentOutOfRange);
	if (paramName) {
		displayMessage += "\n" + String.format(Sys.Res.paramName, paramName);
	}

	if (typeof(actualValue) !== "undefined" && actualValue !== null) {
		displayMessage += "\n" + String.format(Sys.Res.actualValue, actualValue);
	}

	var err = Error.create(displayMessage, {
		name: "Sys.ArgumentOutOfRangeException",
		paramName: paramName,
		actualValue: actualValue
	});
	err.popStackFrame();
	return err;
}

Error.argumentType = function Error$argumentType(paramName, actualType, expectedType, message) {
	/// <summary locid="M:J#Error.argumentType" />
	/// <param name="paramName" type="String" optional="true" mayBeNull="true"></param>
	/// <param name="actualType" type="Type" optional="true" mayBeNull="true"></param>
	/// <param name="expectedType" type="Type" optional="true" mayBeNull="true"></param>
	/// <param name="message" type="String" optional="true" mayBeNull="true"></param>
	/// <returns></returns>


	var displayMessage = "Sys.ArgumentTypeException: ";
	if (message) {
		displayMessage += message;
	}
	else if (actualType && expectedType) {
		displayMessage +=
			String.format(Sys.Res.argumentTypeWithTypes, actualType.getName(), expectedType.getName());
	}
	else {
		displayMessage += Sys.Res.argumentType;
	}

	if (paramName) {
		displayMessage += "\n" + String.format(Sys.Res.paramName, paramName);
	}

	var err = Error.create(displayMessage, {
		name: "Sys.ArgumentTypeException",
		paramName: paramName,
		actualType: actualType,
		expectedType: expectedType
	});
	err.popStackFrame();
	return err;
}

Error.argumentUndefined = function Error$argumentUndefined(paramName, message) {
	/// <summary locid="M:J#Error.argumentUndefined" />
	/// <param name="paramName" type="String" optional="true" mayBeNull="true"></param>
	/// <param name="message" type="String" optional="true" mayBeNull="true"></param>
	/// <returns></returns>


	var displayMessage = "Sys.ArgumentUndefinedException: " + (message ? message : Sys.Res.argumentUndefined);
	if (paramName) {
		displayMessage += "\n" + String.format(Sys.Res.paramName, paramName);
	}

	var err = Error.create(displayMessage, { name: "Sys.ArgumentUndefinedException", paramName: paramName });
	err.popStackFrame();
	return err;
}

Error.format = function Error$format(message) {
	/// <summary locid="M:J#Error.format" />
	/// <param name="message" type="String" optional="true" mayBeNull="true"></param>
	/// <returns></returns>

	var displayMessage = "Sys.FormatException: " + (message ? message : Sys.Res.format);
	var err = Error.create(displayMessage, {name: 'Sys.FormatException'});
	err.popStackFrame();
	return err;
}

Error.invalidOperation = function Error$invalidOperation(message) {
	/// <summary locid="M:J#Error.invalidOperation" />
	/// <param name="message" type="String" optional="true" mayBeNull="true"></param>
	/// <returns></returns>

	var displayMessage = "Sys.InvalidOperationException: " + (message ? message : Sys.Res.invalidOperation);

	var err = Error.create(displayMessage, {name: 'Sys.InvalidOperationException'});
	err.popStackFrame();
	return err;
}

Error.notImplemented = function Error$notImplemented(message) {
	/// <summary locid="M:J#Error.notImplemented" />
	/// <param name="message" type="String" optional="true" mayBeNull="true"></param>
	/// <returns></returns>

	var displayMessage = "Sys.NotImplementedException: " + (message ? message : Sys.Res.notImplemented);

	var err = Error.create(displayMessage, {name: 'Sys.NotImplementedException'});
	err.popStackFrame();
	return err;
}

Error.parameterCount = function Error$parameterCount(message) {
	/// <summary locid="M:J#Error.parameterCount" />
	/// <param name="message" type="String" optional="true" mayBeNull="true"></param>
	/// <returns></returns>


	var displayMessage = "Sys.ParameterCountException: " + (message ? message : Sys.Res.parameterCount);
	var err = Error.create(displayMessage, {name: 'Sys.ParameterCountException'});
	err.popStackFrame();
	return err;
}

Error.prototype.popStackFrame = function Error$popStackFrame() {
	/// <summary locid="M:J#checkParam" />
	if (arguments.length !== 0) throw Error.parameterCount();


	if (typeof(this.stack) === "undefined" || this.stack === null ||
		typeof(this.fileName) === "undefined" || this.fileName === null ||
		typeof(this.lineNumber) === "undefined" || this.lineNumber === null) {
		return;
	}

	var stackFrames = this.stack.split("\n");

	var currentFrame = stackFrames[0];
	var pattern = this.fileName + ":" + this.lineNumber;
	while(typeof(currentFrame) !== "undefined" &&
		  currentFrame !== null &&
		  currentFrame.indexOf(pattern) === -1) {
		stackFrames.shift();
		currentFrame = stackFrames[0];
	}

	var nextFrame = stackFrames[1];

	if (typeof(nextFrame) === "undefined" || nextFrame === null) {
		return;
	}

	var nextFrameParts = nextFrame.match(/@(.*):(\d+)$/);
	if (typeof(nextFrameParts) === "undefined" || nextFrameParts === null) {
		return;
	}

	this.fileName = nextFrameParts[1];

	this.lineNumber = parseInt(nextFrameParts[2]);

	stackFrames.shift();
	this.stack = stackFrames.join("\n");
}
Object.__typeName = 'Object';
Object.__class = true;

Object.getType = function Object$getType(instance) {
	/// <summary locid="M:J#Object.getType" />
	/// <param name="instance"></param>
	/// <returns type="Type"></returns>

	var ctor = instance.constructor;
	if (!ctor || (typeof(ctor) !== "function") || !ctor.__typeName || (ctor.__typeName === 'Object')) {
		return Object;
	}
	return ctor;
}

Object.getTypeName = function Object$getTypeName(instance) {
	/// <summary locid="M:J#Object.getTypeName" />
	/// <param name="instance"></param>
	/// <returns type="String"></returns>

	return Object.getType(instance).getName();
}
String.__typeName = 'String';
String.__class = true;

String.prototype.endsWith = function String$endsWith(searchStr, position) {
	/// <summary locid="M:J#String.endsWith" />
	/// <param name="searchStr" type="String"></param>
	/// <param name="position" type="Number"></param>
	/// <returns type="Boolean"></returns>

	// Based on https://vanillajstoolkit.com/polyfills/stringendswith/
	// This works much better than >= because
	// it compensates for NaN:
	if (!(position < this.length)) {
		position = this.length;
	} else {
		position |= 0; // round position
	}
	return this.substr(position - searchStr.length, searchStr.length) === searchStr;
}

String.prototype.startsWith = function String$startsWith(prefix, position) {
	/// <summary locid="M:J#String.startsWith" />
	/// <param name="prefix" type="String"></param>
	/// <param name="position" type="String"></param>
	/// <returns type="Boolean"></returns>

	// Based on https://vanillajstoolkit.com/polyfills/stringstartswith/
	return (this.substr(position || 0, prefix.length) === prefix);
}

String.prototype.trim = function String$trim() {
	/// <summary locid="M:J#String.trim" />
	/// <returns type="String"></returns>
	if (arguments.length !== 0) throw Error.parameterCount();
	return this.replace(/^\s+|\s+$/g, '');
}

String.prototype.trimEnd = function String$trimEnd() {
	/// <summary locid="M:J#String.trimEnd" />
	/// <returns type="String"></returns>
	if (arguments.length !== 0) throw Error.parameterCount();
	return this.replace(/\s+$/, '');
}

String.prototype.trimStart = function String$trimStart() {
	/// <summary locid="M:J#String.trimStart" />
	/// <returns type="String"></returns>
	if (arguments.length !== 0) throw Error.parameterCount();
	return this.replace(/^\s+/, '');
}

String.format = function String$format(format, args) {
	/// <summary locid="M:J#String.format" />
	/// <param name="format" type="String"></param>
	/// <param name="args" parameterArray="true" mayBeNull="true"></param>
	/// <returns type="String"></returns>

	return String._toFormattedString(false, arguments);
}

String._toFormattedString = function String$_toFormattedString(useLocale, args) {
	var result = '';
	var format = args[0];

	for (var i=0;;) {
		var open = format.indexOf('{', i);
		var close = format.indexOf('}', i);
		if ((open < 0) && (close < 0)) {
			result += format.slice(i);
			break;
		}
		if ((close > 0) && ((close < open) || (open < 0))) {
			if (format.charAt(close + 1) !== '}') {
				throw Error.argument('format', Sys.Res.stringFormatBraceMismatch);
			}
			result += format.slice(i, close + 1);
			i = close + 2;
			continue;
		}

		result += format.slice(i, open);
		i = open + 1;

		if (format.charAt(i) === '{') {
			result += '{';
			i++;
			continue;
		}

		if (close < 0) throw Error.argument('format', Sys.Res.stringFormatBraceMismatch);


		var brace = format.substring(i, close);
		var colonIndex = brace.indexOf(':');
		var argNumber = parseInt((colonIndex < 0)? brace : brace.substring(0, colonIndex), 10) + 1;
		if (isNaN(argNumber)) throw Error.argument('format', Sys.Res.stringFormatInvalid);
		var argFormat = (colonIndex < 0)? '' : brace.substring(colonIndex + 1);

		var arg = args[argNumber];
		if (typeof(arg) === "undefined" || arg === null) {
			arg = '';
		}

		if (arg.toFormattedString) {
			result += arg.toFormattedString(argFormat);
		}
		else if (useLocale && arg.localeFormat) {
			result += arg.localeFormat(argFormat);
		}
		else if (arg.format) {
			result += arg.format(argFormat);
		}
		else
			result += arg.toString();

		i = close + 1;
	}

	return result;
}
Boolean.__typeName = 'Boolean';
Boolean.__class = true;

Boolean.parse = function Boolean$parse(value) {
	/// <summary locid="M:J#Boolean.parse" />
	/// <param name="value" type="String"></param>
	/// <returns type="Boolean"></returns>

	var v = value.trim().toLowerCase();
	if (v === 'false') return false;
	if (v === 'true') return true;
	throw Error.argumentOutOfRange('value', value, Sys.Res.boolTrueOrFalse);
}
Date.__typeName = 'Date';
Date.__class = true;
Number.__typeName = 'Number';
Number.__class = true;
RegExp.__typeName = 'RegExp';
RegExp.__class = true;

//if (!window) this.window = this;


window.Type = Function;








Type.__fullyQualifiedIdentifierRegExp = new RegExp("^[^.0-9 \\s|,;:&*=+\\-()\\[\\]{}^%#@!~\\n\\r\\t\\f\\\\]([^ \\s|,;:&*=+\\-()\\[\\]{}^%#@!~\\n\\r\\t\\f\\\\]*[^. \\s|,;:&*=+\\-()\\[\\]{}^%#@!~\\n\\r\\t\\f\\\\])?$", "i");
Type.__identifierRegExp = new RegExp("^[^.0-9 \\s|,;:&*=+\\-()\\[\\]{}^%#@!~\\n\\r\\t\\f\\\\][^. \\s|,;:&*=+\\-()\\[\\]{}^%#@!~\\n\\r\\t\\f\\\\]*$", "i");

Type.prototype.callBaseMethod = function Type$callBaseMethod(instance, name, baseArguments) {
	/// <summary locid="M:J#Type.callBaseMethod" />
	/// <param name="instance"></param>
	/// <param name="name" type="String"></param>
	/// <param name="baseArguments" type="Array" optional="true" mayBeNull="true" elementMayBeNull="true"></param>
	/// <returns></returns>

	var baseMethod = Sys._getBaseMethod(this, instance, name);
	if (!baseMethod) throw Error.invalidOperation(String.format(Sys.Res.methodNotFound, name));
	if (!baseArguments) {
		return baseMethod.apply(instance);
	}
	else {
		return baseMethod.apply(instance, baseArguments);
	}
}

Type.prototype.getBaseMethod = function Type$getBaseMethod(instance, name) {
	/// <summary locid="M:J#Type.getBaseMethod" />
	/// <param name="instance"></param>
	/// <param name="name" type="String"></param>
	/// <returns type="Function" mayBeNull="true"></returns>

	return Sys._getBaseMethod(this, instance, name);
}

Type.prototype.getBaseType = function Type$getBaseType() {
	/// <summary locid="M:J#Type.getBaseType" />
	/// <returns type="Type" mayBeNull="true"></returns>
	if (arguments.length !== 0) throw Error.parameterCount();
	return (typeof(this.__baseType) === "undefined") ? null : this.__baseType;
}

Type.prototype.getInterfaces = function Type$getInterfaces() {
	/// <summary locid="M:J#Type.getInterfaces" />
	/// <returns type="Array" elementType="Type" mayBeNull="false" elementMayBeNull="false"></returns>
	if (arguments.length !== 0) throw Error.parameterCount();
	var result = [];
	var type = this;
	while(type) {
		var interfaces = type.__interfaces;
		if (interfaces) {
			for (var i = 0, l = interfaces.length; i < l; i++) {
				var interfaceType = interfaces[i];
				if (!Array.contains(result, interfaceType)) {
					result[result.length] = interfaceType;
				}
			}
		}
		type = type.__baseType;
	}
	return result;
}

Type.prototype.getName = function Type$getName() {
	/// <summary locid="M:J#Type.getName" />
	/// <returns type="String"></returns>
	if (arguments.length !== 0) throw Error.parameterCount();
	return (typeof(this.__typeName) === "undefined") ? "" : this.__typeName;
}

Type.prototype.implementsInterface = function Type$implementsInterface(interfaceType) {
	/// <summary locid="M:J#Type.implementsInterface" />
	/// <param name="interfaceType" type="Type"></param>
	/// <returns type="Boolean"></returns>

	this.resolveInheritance();

	var interfaceName = interfaceType.getName();
	var cache = this.__interfaceCache;
	if (cache) {
		var cacheEntry = cache[interfaceName];
		if (typeof(cacheEntry) !== 'undefined') return cacheEntry;
	}
	else {
		cache = this.__interfaceCache = {};
	}

	var baseType = this;
	while (baseType) {
		var interfaces = baseType.__interfaces;
		if (interfaces) {
			if (Array.indexOf(interfaces, interfaceType) !== -1) {
				return cache[interfaceName] = true;
			}
		}

		baseType = baseType.__baseType;
	}

	return cache[interfaceName] = false;
}

Type.prototype.inheritsFrom = function Type$inheritsFrom(parentType) {
	/// <summary locid="M:J#Type.inheritsFrom" />
	/// <param name="parentType" type="Type"></param>
	/// <returns type="Boolean"></returns>

	this.resolveInheritance();
	return Sys._inheritsFrom(this, parentType);
}

Sys._inheritsFrom = function Sys$_inheritsFrom(type, parentType) {
	var ret;
	if (parentType) {
		var baseType = type.__baseType;
		while (baseType) {
			if (baseType === parentType) {
				ret = true;
				break;
			}
			baseType = baseType.__baseType;
		}
	}
	return !!ret;
}

Type.prototype.initializeBase = function Type$initializeBase(instance, baseArguments) {
	/// <summary locid="M:J#Type.initializeBase" />
	/// <param name="instance"></param>
	/// <param name="baseArguments" type="Array" optional="true" mayBeNull="true" elementMayBeNull="true"></param>
	/// <returns></returns>

	if (!Sys._isInstanceOfType(this, instance)) throw Error.argumentType('instance', Object.getType(instance), this);

	this.resolveInheritance();
	if (this.__baseType) {
		if (!baseArguments) {
			this.__baseType.apply(instance);
		}
		else {
			this.__baseType.apply(instance, baseArguments);
		}
	}

	return instance;
}

Type.prototype.isImplementedBy = function Type$isImplementedBy(instance) {
	/// <summary locid="M:J#Type.isImplementedBy" />
	/// <param name="instance" mayBeNull="true"></param>
	/// <returns type="Boolean"></returns>

	if (typeof(instance) === "undefined" || instance === null) return false;

	var instanceType = Object.getType(instance);
	return !!(instanceType.implementsInterface && instanceType.implementsInterface(this));
}

Type.prototype.isInstanceOfType = function Type$isInstanceOfType(instance) {
	/// <summary locid="M:J#Type.isInstanceOfType" />
	/// <param name="instance" mayBeNull="true"></param>
	/// <returns type="Boolean"></returns>

	return Sys._isInstanceOfType(this, instance);
}

Type.prototype.registerClass = function Type$registerClass(typeName, baseType, interfaceTypes) {
	/// <summary locid="M:J#Type.registerClass" />
	/// <param name="typeName" type="String"></param>
	/// <param name="baseType" type="Type" optional="true" mayBeNull="true"></param>
	/// <param name="interfaceTypes" parameterArray="true" type="Type"></param>
	/// <returns type="Type"></returns>

	if (!Type.__fullyQualifiedIdentifierRegExp.test(typeName)) throw Error.argument('typeName', Sys.Res.notATypeName);
	var parsedName;
	try {
		parsedName = window.eval(typeName);
	}
	catch(e) {
		throw Error.argument('typeName', Sys.Res.argumentTypeName);
	}
	if (parsedName !== this) throw Error.argument('typeName', Sys.Res.badTypeName);
	if (Sys.__registeredTypes[typeName]) throw Error.invalidOperation(String.format(Sys.Res.typeRegisteredTwice, typeName));

	if ((arguments.length > 1) && (typeof(baseType) === 'undefined')) throw Error.argumentUndefined('baseType');

	this.prototype.constructor = this;
	this.__typeName = typeName;
	this.__class = true;
	if (baseType) {
		this.__baseType = baseType;
		this.__basePrototypePending = true;
	}
	Sys.__upperCaseTypes[typeName.toUpperCase()] = this;

	if (interfaceTypes) {
		this.__interfaces = [];
		this.resolveInheritance();
		for (var i = 2, l = arguments.length; i < l; i++) {
			var interfaceType = arguments[i];
			if (!interfaceType.__interface) throw Error.argument('interfaceTypes[' + (i - 2) + ']', Sys.Res.notAnInterface);
			for (var methodName in interfaceType.prototype) {
				var method = interfaceType.prototype[methodName];
				if (!this.prototype[methodName]) {
					this.prototype[methodName] = method;
				}
			}
			this.__interfaces.push(interfaceType);
		}
	}
	Sys.__registeredTypes[typeName] = true;
	return this;
}

Sys.registerComponent = function Sys$registerComponent(type, options) {
	/// <summary locid="M:J#Sys.registerComponent" />
	/// <param name="type" type="Function"></param>
	/// <param name="options" type="Object" optional="true" mayBeNull="true"></param>

	var typeName = type.getName();
	var isControlOrBehavior = Sys.UI && (Sys._inheritsFrom(type, Sys.UI.Control) || Sys._inheritsFrom(type, Sys.UI.Behavior));
	var name = (options && options.name);
	if (!name) {
		name = typeName;
		var i = name.lastIndexOf('.');
		if (i >= 0) {
			name = name.substr(i+1);
			if (name && name.charAt(0) === "_") return;
		}
		name = name.substr(0, 1).toLowerCase() + name.substr(1);
	}
	if (!options) {
		options = {};
	}
	options.name = name;
	options.type = type;
	options.typeName = typeName;
	options._isBehavior = isControlOrBehavior;
	Sys.components[name] = merge(Sys.components[name], options);
	var fn = Sys.create[name],
		defaults = fn && fn.defaults;
	Sys.create[name] = fn = Sys._getCreate(type, isControlOrBehavior, options);
	fn.defaults = defaults || null;
	fn._component = options;
	if (window.jQuery) {
		var jTarget = isControlOrBehavior ? jQuery.fn : jQuery;
		if (!jTarget.hasOwnProperty(name)) {
			fn = jTarget[name];
			defaults = fn && fn.defaults;
			jTarget[name] = fn = Sys._getCreate(type, isControlOrBehavior, options, true);
			fn.defaults = defaults || null;
			fn._component = options;
		}
	}
}

Sys._getCreate = function _getCreate(type, isControlOrBehavior, options, isjQuery) {
	var typeName = type.getName(),
		body = [],
		arglist = [],
		description = (options && options.description) || "Creates an instance of the type '" + typeName  + "' and sets the given properties.";
	body.push("/// <summary>", description, "</summary>\n");
	if (isControlOrBehavior && !isjQuery) {
		arglist.push("target");
		body.push('/// <param name="target">The DOM element to attach to, as a DOM element or selector.</param>\n');
	}
	foreach(options && options.parameters, function(parameter) {
		var name = parameter, type = '', desc = '';
		if (typeof(parameter) !== "string") {
			name = parameter.name;
			type = parameter.type||'';
			desc = parameter.description||'';
		}
		arglist.push(name);
		body.push('/// <param name="', name, '" type="', type, '">', desc, '</param>\n');
	});
	arglist.push("properties");
	body.push('/// <param name="properties" type="Object" mayBeNull="true" optional="true">Additional properties to set on the component.</param>\n');
	if (!isjQuery) {
		body.push('/// <returns type="', typeName, '"></returns>\n',
				  'return Sys._createComp(arguments.callee._component, arguments.callee.defaults, arguments);');
	}
	else {
		body.push("var callee = arguments.callee, component = callee._component, defaults = callee.defaults, args = Array.prototype.slice.call(arguments, 0);\nargs.splice(0, 0, null);\nreturn this.each(function() {\n",
				  "    args[0] = this;\n    Sys._createComp(component, defaults, args)\n",
				  "});");
	}
	arglist.push(body.join(''));
	return Function.apply(null, arglist);
}

Sys.registerPlugin = function Sys$registerPlugin(pluginInfo) {
	/// <summary locid="M:J#Sys.registerPlugin" />
	/// <param name="pluginInfo" type="Object"></param>

	var name = pluginInfo.name;
	Sys.plugins[name] = merge(Sys.plugins[name], pluginInfo);
	Sys[name] = pluginInfo.plugin;
	if (window.jQuery) {
		jQuery[name] = Sys[name];
	}
}

Sys._createComp = function _createComp(component, defaults, args) {
	var parameters = component.parameters || [],
		isBehavior = component._isBehavior,
		target = isBehavior ? args[0] : null;
	var offsetFromTargetArgument = isBehavior ? 1 : 0;
	var props = args[parameters.length + offsetFromTargetArgument] || {};
	props = merge({}, defaults, props);
	foreach(parameters, function(parameter, i) {
		var name = typeof(parameter) === "string" ? parameter : parameter.name,
			value = args[i + offsetFromTargetArgument];
		if (typeof(value) !== "undefined" && typeof(props[name]) === "undefined") {
			props[name] = value;
		}
	});
	return isBehavior ?
		Sys._create(component.type, props, target) :
		Sys._create(component.type, props);
}

Sys._create = function _create(type, properties, target) {
	var targetType = typeof(target);
	if (targetType === "string") {
		target = Sys.get(target);
	}
	var instance;
	Sys._2Pass(function() {
		instance = targetType === "undefined" ? new type() : new type(target);
		callIf(instance, "beginUpdate");
		Sys._setProps(instance, properties);
		var componentType = Sys.Component;
		if (!componentType || !componentType._register(instance)) {
			callIf(instance, "endUpdate") || callIf(instance, "initialize");
		}
	});
	return instance;
}

Sys._setProps = function _setProps(instance, properties) {
	forIn(properties, function(value, field) {
		callIf(instance, "add_" + field, value) ||
		callIf(instance, "set_" + field, value) ||
		(instance[field] = value);
	});
}

Type.prototype.registerInterface = function Type$registerInterface(typeName) {
	/// <summary locid="M:J#Type.registerInterface" />
	/// <param name="typeName" type="String"></param>
	/// <returns type="Type"></returns>

	if (!Type.__fullyQualifiedIdentifierRegExp.test(typeName)) throw Error.argument('typeName', Sys.Res.notATypeName);
	var parsedName;
	try {
		parsedName = window.eval(typeName);
	}
	catch(e) {
		throw Error.argument('typeName', Sys.Res.argumentTypeName);
	}
	if (parsedName !== this) throw Error.argument('typeName', Sys.Res.badTypeName);
	if (Sys.__registeredTypes[typeName]) throw Error.invalidOperation(String.format(Sys.Res.typeRegisteredTwice, typeName));
	Sys.__upperCaseTypes[typeName.toUpperCase()] = this;

	this.prototype.constructor = this;
	this.__typeName = typeName;
	this.__interface = true;
	Sys.__registeredTypes[typeName] = true;

	return this;
}

Type.prototype.resolveInheritance = function Type$resolveInheritance() {
	/// <summary locid="M:J#Type.resolveInheritance" />
	if (arguments.length !== 0) throw Error.parameterCount();

	if (this.__basePrototypePending) {
		var baseType = this.__baseType;

		baseType.resolveInheritance();

		for (var memberName in baseType.prototype) {
			var memberValue = baseType.prototype[memberName];
			if (!this.prototype[memberName]) {
				this.prototype[memberName] = memberValue;
			}
		}
		delete this.__basePrototypePending;
	}
}

Type.getRootNamespaces = function Type$getRootNamespaces() {
	/// <summary locid="M:J#Type.getRootNamespaces" />
	/// <returns type="Array"></returns>
	if (arguments.length !== 0) throw Error.parameterCount();
	return Array.clone(Sys.__rootNamespaces);
}

Type.isClass = function Type$isClass(type) {
	/// <summary locid="M:J#Type.isClass" />
	/// <param name="type" mayBeNull="true"></param>
	/// <returns type="Boolean"></returns>

	if ((typeof(type) === 'undefined') || (type === null)) return false;
	return !!type.__class;
}

Type.isInterface = function Type$isInterface(type) {
	/// <summary locid="M:J#Type.isInterface" />
	/// <param name="type" mayBeNull="true"></param>
	/// <returns type="Boolean"></returns>

	if ((typeof(type) === 'undefined') || (type === null)) return false;
	return !!type.__interface;
}

Type.isNamespace = function Type$isNamespace(object) {
	/// <summary locid="M:J#Type.isNamespace" />
	/// <param name="object" mayBeNull="true"></param>
	/// <returns type="Boolean"></returns>

	if ((typeof(object) === 'undefined') || (object === null)) return false;
	return !!object.__namespace;
}

Type.parse = function Type$parse(typeName, ns) {
	/// <summary locid="M:J#Type.parse" />
	/// <param name="typeName" type="String" mayBeNull="true"></param>
	/// <param name="ns" optional="true" mayBeNull="true"></param>
	/// <returns type="Type" mayBeNull="true"></returns>

	var fn;
	if (ns) {
		fn = Sys.__upperCaseTypes[ns.getName().toUpperCase() + '.' + typeName.toUpperCase()];
		return fn || null;
	}
	if (!typeName) return null;
	if (!Type.__htClasses) {
		Type.__htClasses = {};
	}
	fn = Type.__htClasses[typeName];
	if (!fn) {
		fn = window.eval(typeName);
		if (typeof(fn) !== 'function') throw Error.argument('typeName', Sys.Res.notATypeName);
		Type.__htClasses[typeName] = fn;
	}
	return fn;
}

Type.registerNamespace = function Type$registerNamespace(namespacePath) {
	/// <summary locid="M:J#Type.registerNamespace" />
	/// <param name="namespacePath" type="String"></param>

	Type._registerNamespace(namespacePath);
}
Type._registerNamespace = function Type$_registerNamespace(namespacePath) {
	if (!Type.__fullyQualifiedIdentifierRegExp.test(namespacePath)) throw Error.argument('namespacePath', Sys.Res.invalidNameSpace);
	var rootObject = window;
	var namespaceParts = namespacePath.split('.');

	for (var i = 0, l = namespaceParts.length; i < l; i++) {
		var currentPart = namespaceParts[i];
		var ns = rootObject[currentPart];
		var nsType = typeof(ns);
		if ((nsType !== "undefined") && (ns !== null)) {
			if (nsType === "function") {
				throw Error.invalidOperation(String.format(Sys.Res.namespaceContainsClass, namespaceParts.splice(0, i + 1).join('.')));
			}
			if ((typeof(ns) !== "object") || (ns instanceof Array)) {
				throw Error.invalidOperation(String.format(Sys.Res.namespaceContainsNonObject, namespaceParts.splice(0, i + 1).join('.')));
			}
		}
		if (!ns) {
			ns = rootObject[currentPart] = {};
		}
		if (!ns.__namespace) {
			if (!i && (namespacePath !== "Sys")) {
				Sys.__rootNamespaces.push(ns);
			}
			ns.__namespace = true;
			ns.__typeName = namespaceParts.slice(0, i + 1).join('.');
			var parsedName;
			try {
				parsedName = window.eval(ns.__typeName);
			}
			catch(e) {
				parsedName = null;
			}
			if (parsedName !== ns) {
				delete rootObject[currentPart];
				throw Error.argument('namespacePath', Sys.Res.invalidNameSpace);
			}
			ns.getName = function ns$getName() {return this.__typeName;}
		}
		rootObject = ns;
	}
}

Type._checkDependency = function Type$_checkDependency(dependency, featureName) {
	var scripts = Type._registerScript._scripts, isDependent = (scripts ? (!!scripts[dependency]) : false);
	if ((typeof(featureName) !== 'undefined') && !isDependent) {
		throw Error.invalidOperation(String.format(Sys.Res.requiredScriptReferenceNotIncluded,
		featureName, dependency));
	}
	return isDependent;
}

Type._registerScript = function Type$_registerScript(scriptName, dependencies) {
	var scripts = Type._registerScript._scripts;
	if (!scripts) {
		Type._registerScript._scripts = scripts = {};
	}
	if (scripts[scriptName]) {
		throw Error.invalidOperation(String.format(Sys.Res.scriptAlreadyLoaded, scriptName));
	}
	scripts[scriptName] = true;
	if (dependencies) {
		for (var i = 0, l = dependencies.length; i < l; i++) {
			var dependency = dependencies[i];
			if (!Type._checkDependency(dependency)) {
				throw Error.invalidOperation(String.format(Sys.Res.scriptDependencyNotFound, scriptName, dependency));
			}
		}
	}
}

Type._registerNamespace("Sys");
Sys.__upperCaseTypes = {};
Sys.__rootNamespaces = [Sys];
Sys.__registeredTypes = {};






Sys._isInstanceOfType = function Sys$_isInstanceOfType(type, instance) {
	if (typeof(instance) === "undefined" || instance === null) return false;
	if (instance instanceof type) return true;
	var instanceType = Object.getType(instance);
	return !!(instanceType === type) ||
		   (instanceType.inheritsFrom && instanceType.inheritsFrom(type)) ||
		   (instanceType.implementsInterface && instanceType.implementsInterface(type));
}



Sys._getBaseMethod = function Sys$_getBaseMethod(type, instance, name) {
	if (!Sys._isInstanceOfType(type, instance)) throw Error.argumentType('instance', Object.getType(instance), type);
	var baseType = type.getBaseType();
	if (baseType) {
		var baseMethod = baseType.prototype[name];
		return (baseMethod instanceof Function) ? baseMethod : null;
	}
	return null;
}

Sys._isDomElement = function Sys$_isDomElement(obj) {
	var val = false;
	if (typeof (obj.nodeType) !== 'number') {
		var doc = obj.ownerDocument || obj.document || obj;
		if (doc != obj) {
			var w = doc.defaultView || doc.parentWindow;
			val = (w != obj);
		}
		else {
			val = !doc.body || !Sys._isDomElement(doc.body);
		}
	}
	return !val;
}

var isBrowser = Sys._isBrowser = function Sys$_isBrowser(name) {
	if (name === 'InternetExplorer') return Sys.Browser.agent === Sys.Browser[name];

	return Sys.Browser.agent === Sys.Browser[name];
}



foreach(Sys._ns, Type._registerNamespace);
delete Sys._ns;
Array.__typeName = 'Array';
Array.__class = true;

Array.add = Array.enqueue = function Array$enqueue(array, item) {
	/// <summary locid="M:J#Array.enqueue" />
	/// <param name="array" type="Array" elementMayBeNull="true"></param>
	/// <param name="item" mayBeNull="true"></param>


	array[array.length] = item;
}

Array.addRange = function Array$addRange(array, items) {
	/// <summary locid="M:J#Array.addRange" />
	/// <param name="array" type="Array" elementMayBeNull="true"></param>
	/// <param name="items" type="Array" elementMayBeNull="true"></param>


	array.push.apply(array, items);
}

Array.clear = function Array$clear(array) {
	/// <summary locid="M:J#Array.clear" />
	/// <param name="array" type="Array" elementMayBeNull="true"></param>

	array.length = 0;
}

Array.clone = function Array$clone(array) {
	/// <summary locid="M:J#Array.clone" />
	/// <param name="array" type="Array" elementMayBeNull="true"></param>
	/// <returns type="Array" elementMayBeNull="true"></returns>

	if (array.length === 1) {
		return [array[0]];
	}
	else {
		return Array.apply(null, array);
	}
}

Array.contains = function Array$contains(array, item) {
	/// <summary locid="M:J#Array.contains" />
	/// <param name="array" type="Array" elementMayBeNull="true"></param>
	/// <param name="item" mayBeNull="true"></param>
	/// <returns type="Boolean"></returns>

	return (indexOf(array, item) >= 0);
}

Array.dequeue = function Array$dequeue(array) {
	/// <summary locid="M:J#Array.dequeue" />
	/// <param name="array" type="Array" elementMayBeNull="true"></param>
	/// <returns mayBeNull="true"></returns>

	return array.shift();
}

Array.forEach = function Array$forEach(array, method, instance) {
	/// <summary locid="M:J#Array.forEach" />
	/// <param name="array" type="Array" elementMayBeNull="true"></param>
	/// <param name="method" type="Function"></param>
	/// <param name="instance" optional="true" mayBeNull="true"></param>

	for (var i = 0, l = array.length; i < l; i++) {
		var elt = array[i];
		if (typeof(elt) !== 'undefined') method.call(instance, elt, i, array);
	}
}

Array.indexOf = function Array$indexOf(array, item, start) {
	/// <summary locid="M:J#Array.indexOf" />
	/// <param name="array" type="Array" elementMayBeNull="true"></param>
	/// <param name="item" optional="true" mayBeNull="true"></param>
	/// <param name="start" optional="true" mayBeNull="true"></param>
	/// <returns type="Number"></returns>

	return indexOf(array, item, start);
}

Array.insert = function Array$insert(array, index, item) {
	/// <summary locid="M:J#Array.insert" />
	/// <param name="array" type="Array" elementMayBeNull="true"></param>
	/// <param name="index" mayBeNull="true"></param>
	/// <param name="item" mayBeNull="true"></param>

	array.splice(index, 0, item);
}

Array.parse = function Array$parse(value) {
	/// <summary locid="M:J#Array.parse" />
	/// <param name="value" type="String" mayBeNull="true"></param>
	/// <returns type="Array" elementMayBeNull="true"></returns>

	if (!value) return [];
	var v = window.eval("(" + value + ")");
	if (!Array.isInstanceOfType(v)) throw Error.argument('value', Sys.Res.arrayParseBadFormat);
	return v;
}

Array.remove = function Array$remove(array, item) {
	/// <summary locid="M:J#Array.remove" />
	/// <param name="array" type="Array" elementMayBeNull="true"></param>
	/// <param name="item" mayBeNull="true"></param>
	/// <returns type="Boolean"></returns>

	var index = indexOf(array, item);
	if (index >= 0) {
		array.splice(index, 1);
	}
	return (index >= 0);
}

Array.removeAt = function Array$removeAt(array, index) {
	/// <summary locid="M:J#Array.removeAt" />
	/// <param name="array" type="Array" elementMayBeNull="true"></param>
	/// <param name="index" mayBeNull="true"></param>

	array.splice(index, 1);
}





var indexOf = Sys._indexOf = function Sys$_indexOf(array, item, start) {
	if (typeof(item) === "undefined") return -1;
	var length = array.length;
	if (length !== 0) {
		start = start - 0;
		if (isNaN(start)) {
			start = 0;
		}
		else {
			if (isFinite(start)) {
				start = start - (start % 1);
			}
			if (start < 0) {
				start = Math.max(0, length + start);
			}
		}

		for (var i = start; i < length; i++) {
			if ((typeof(array[i]) !== "undefined") && (array[i] === item)) {
				return i;
			}
		}
	}
	return -1;
}

Type._registerScript._scripts = {
	"MicrosoftAjaxCore.js": true,
	"MicrosoftAjaxGlobalization.js": true,
	"MicrosoftAjaxSerialization.js": true,
	"MicrosoftAjaxComponentModel.js": true,
	"MicrosoftAjaxHistory.js": true,
	"MicrosoftAjaxNetwork.js" : true,
	"MicrosoftAjaxWebServices.js": true };

Sys.IDisposable = function Sys$IDisposable() {
	throw Error.notImplemented();
}

	function Sys$IDisposable$dispose() {
		throw Error.notImplemented();
	}
Sys.IDisposable.prototype = {
	dispose: Sys$IDisposable$dispose
}
Sys.IDisposable.registerInterface('Sys.IDisposable');
Sys.StringBuilder = function Sys$StringBuilder(initialText) {
	/// <summary locid="M:J#Sys.StringBuilder.#ctor" />
	/// <param name="initialText" optional="true" mayBeNull="true"></param>

	this._parts = (typeof(initialText) !== 'undefined' && initialText !== null && initialText !== '') ?
		[initialText.toString()] : [];
	this._value = {};
	this._len = 0;
}


	function Sys$StringBuilder$append(text) {
		/// <summary locid="M:J#Sys.StringBuilder.append" />
		/// <param name="text" mayBeNull="true"></param>
		/// <returns type="Sys.StringBuilder"></returns>

		this._parts.push(text);
		return this;
	}

	function Sys$StringBuilder$appendLine(text) {
		/// <summary locid="M:J#Sys.StringBuilder.appendLine" />
		/// <param name="text" optional="true" mayBeNull="true"></param>
		/// <returns type="Sys.StringBuilder"></returns>

		this._parts.push(
			((typeof(text) === 'undefined') || (text === null) || (text === '')) ?
			'\r\n' : (text + '\r\n'));
		return this;
	}

	function Sys$StringBuilder$clear() {
		/// <summary locid="M:J#Sys.StringBuilder.clear" />
		if (arguments.length !== 0) throw Error.parameterCount();
		this._parts = [];
		this._value = {};
		this._len = 0;
	}

	function Sys$StringBuilder$isEmpty() {
		/// <summary locid="M:J#Sys.StringBuilder.isEmpty" />
		/// <returns type="Boolean"></returns>
		if (arguments.length !== 0) throw Error.parameterCount();
		if (this._parts.length === 0) return true;
		return this.toString() === '';
	}



	function Sys$StringBuilder$toString(separator) {
		/// <summary locid="M:J#Sys.StringBuilder.toString" />
		/// <param name="separator" type="String" optional="true" mayBeNull="true"></param>
		/// <returns type="String"></returns>

		separator = separator || '';
		var parts = this._parts;
		if (this._len !== parts.length) {
			this._value = {};
			this._len = parts.length;
		}
		var val = this._value;
		if (typeof(val[separator]) === 'undefined') {
			if (separator !== '') {
				for (var i = 0; i < parts.length;) {
					if ((typeof(parts[i]) === 'undefined') || (parts[i] === '') || (parts[i] === null)) {
						parts.splice(i, 1);
					}
					else {
						i++;
					}
				}
			}
			val[separator] = this._parts.join(separator);
		}
		return val[separator];
	}
Sys.StringBuilder.prototype = {
	append: Sys$StringBuilder$append,
	appendLine: Sys$StringBuilder$appendLine,
	clear: Sys$StringBuilder$clear,
	isEmpty: Sys$StringBuilder$isEmpty,
	toString: Sys$StringBuilder$toString
}
Sys.StringBuilder.registerClass('Sys.StringBuilder');


var agent = navigator.userAgent,
	browser = Sys.Browser = {
		InternetExplorer: {},
		Firefox: {},
		Safari: {},
		Opera: {},
		agent: null,
		hasDebuggerStatement: false,
		name: navigator.appName,
		version: parseFloat(navigator.appVersion),
		documentMode: 0 };

if (agent.indexOf(' MSIE ') > -1) {
	browser.agent = browser.InternetExplorer;
	browser.version = parseFloat(agent.match(/MSIE (\d+\.\d+)/)[1]);
	if ((browser.version > 7) && (document.documentMode > 6)) {
		browser.documentMode = document.documentMode;
	}
	browser.hasDebuggerStatement = true;
	browser.name = 'InternetExplorer';
}
else if (agent.indexOf(' Edge/') > -1) {
	browser.agent = browser.InternetExplorer;
	browser.version = parseFloat(agent.match(/ Edge\/(\d+\.\d+)/)[1]);
	browser.hasDebuggerStatement = true;
}
else if (agent.indexOf(' Firefox/') > -1) {
	browser.agent = browser.Firefox;
	browser.version = parseFloat(agent.match(/ Firefox\/(\d+\.\d+)/)[1]);
	browser.name = 'Firefox';
	browser.hasDebuggerStatement = true;
}
else if (agent.indexOf(' AppleWebKit/') > -1) {
	browser.agent = browser.Safari;
	browser.version = parseFloat(agent.match(/ AppleWebKit\/(\d+(\.\d+)?)/)[1]);
	browser.name = 'Safari';
}
else if (agent.indexOf('Opera/') > -1) {
	browser.agent = browser.Opera;
}
else if (agent.indexOf('Trident') > -1) {
	browser.agent = browser.InternetExplorer;
	browser.version = parseFloat(agent.match(/rv\:(\d+\.\d+)/)[1]);
	browser.documentMode = document.documentMode;
	browser.hasDebuggerStatement = true;
	browser.name = 'InternetExplorer';
}


Sys.EventArgs = function Sys$EventArgs() {
	/// <summary locid="M:J#Sys.EventArgs.#ctor" />
	if (arguments.length !== 0) throw Error.parameterCount();
}
Sys.EventArgs.registerClass('Sys.EventArgs');

Sys.EventArgs.Empty = new Sys.EventArgs();
Sys.CancelEventArgs = function Sys$CancelEventArgs() {
	/// <summary locid="M:J#Sys.CancelEventArgs.#ctor" />
	if (arguments.length !== 0) throw Error.parameterCount();
	Sys.CancelEventArgs.initializeBase(this);

	this._cancel = false;
}


	function Sys$CancelEventArgs$get_cancel() {
		/// <value type="Boolean" locid="P:J#Sys.CancelEventArgs.cancel"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._cancel;
	}
	function Sys$CancelEventArgs$set_cancel(value) {

		this._cancel = value;
	}
Sys.CancelEventArgs.prototype = {
	get_cancel: Sys$CancelEventArgs$get_cancel,
	set_cancel: Sys$CancelEventArgs$set_cancel
}

Sys.CancelEventArgs.registerClass('Sys.CancelEventArgs', Sys.EventArgs);



Type.registerNamespace('Sys.UI');

Sys._Debug = function Sys$_Debug() {
	/// <summary locid="M:J#Sys.Debug.#ctor" />
	/// <field name="isDebug" type="Boolean" locid="F:J#Sys.Debug.isDebug"></field>
	if (arguments.length !== 0) throw Error.parameterCount();
}


	function Sys$_Debug$_appendConsole(text) {
		if ((typeof(Debug) !== 'undefined') && Debug.writeln) {
			Debug.writeln(text);
		}
		if (window.console && window.console.log) {
			window.console.log(text);
		}
		if (window.opera) {
			window.opera.postError(text);
		}
		if (window.debugService) {
			window.debugService.trace(text);
		}
	}

	function Sys$_Debug$_appendTrace(text) {
		var traceElement = Sys.get('#TraceConsole');
		if (traceElement && (traceElement.tagName.toUpperCase() === 'TEXTAREA')) {
			traceElement.value += text + '\n';
		}
	}

	function Sys$_Debug$assert(condition, message, displayCaller) {
		/// <summary locid="M:J#Sys.Debug.assert" />
		/// <param name="condition" type="Boolean"></param>
		/// <param name="message" type="String" optional="true" mayBeNull="true"></param>
		/// <param name="displayCaller" type="Boolean" optional="true" mayBeNull="true"></param>

		if (!condition) {
			message = (displayCaller && this.assert.caller) ?
				String.format(Sys.Res.assertFailedCaller, message, this.assert.caller) :
				String.format(Sys.Res.assertFailed, message);

			if (confirm(String.format(Sys.Res.breakIntoDebugger, message))) {
				this.fail(message);
			}
		}
	}

	function Sys$_Debug$clearTrace() {
		/// <summary locid="M:J#Sys.Debug.clearTrace" />
		if (arguments.length !== 0) throw Error.parameterCount();
		var traceElement = Sys.get('#TraceConsole');
		if (traceElement && (traceElement.tagName.toUpperCase() === 'TEXTAREA')) {
			traceElement.value = '';
		}
	}

	function Sys$_Debug$fail(message) {
		/// <summary locid="M:J#Sys.Debug.fail" />
		/// <param name="message" type="String" mayBeNull="true"></param>

		this._appendConsole(message);

		if (Sys.Browser.hasDebuggerStatement) {
			window.eval('debugger');
		}
	}

	function Sys$_Debug$trace(text) {
		/// <summary locid="M:J#Sys.Debug.trace" />
		/// <param name="text"></param>

		this._appendConsole(text);
		this._appendTrace(text);
	}

	function Sys$_Debug$traceDump(object, name) {
		/// <summary locid="M:J#Sys.Debug.traceDump" />
		/// <param name="object" mayBeNull="true"></param>
		/// <param name="name" type="String" mayBeNull="true" optional="true"></param>

		var text = this._traceDump(object, name, true);
	}

	function Sys$_Debug$_traceDump(object, name, recursive, indentationPadding, loopArray) {
		name = name? name : 'traceDump';
		indentationPadding = indentationPadding? indentationPadding : '';
		if (object === null) {
			this.trace(indentationPadding + name + ': null');
			return;
		}
		switch(typeof(object)) {
			case 'undefined':
				this.trace(indentationPadding + name + ': Undefined');
				break;
			case 'number': case 'string': case 'boolean':
				this.trace(indentationPadding + name + ': ' + object);
				break;
			default:
				if (Date.isInstanceOfType(object) || RegExp.isInstanceOfType(object)) {
					this.trace(indentationPadding + name + ': ' + object.toString());
					break;
				}
				if (!loopArray) {
					loopArray = [];
				}
				else if (Array.contains(loopArray, object)) {
					this.trace(indentationPadding + name + ': ...');
					return;
				}
				Array.add(loopArray, object);

				if ((object == window) || (object === document) ||
					(window.HTMLElement && (object instanceof HTMLElement)) ||
					(typeof(object.nodeName) === 'string')) {
					var tag = object.tagName? object.tagName : 'DomElement';
					if (object.id) {
						tag += ' - ' + object.id;
					}
					this.trace(indentationPadding + name + ' {' +  tag + '}');
				}
				else {
					var typeName = Object.getTypeName(object);
					this.trace(indentationPadding + name + (typeof(typeName) === 'string' ? ' {' + typeName + '}' : ''));
					if ((indentationPadding === '') || recursive) {
						indentationPadding += "    ";
						var i, length, properties, p, v;
						if (Array.isInstanceOfType(object)) {
							length = object.length;
							for (i = 0; i < length; i++) {
								this._traceDump(object[i], '[' + i + ']', recursive, indentationPadding, loopArray);
							}
						}
						else {
							for (p in object) {
								v = object[p];
								if (!Function.isInstanceOfType(v)) {
									this._traceDump(v, p, recursive, indentationPadding, loopArray);
								}
							}
						}
					}
				}
				Array.remove(loopArray, object);
		}
	}
Sys._Debug.prototype = {
	_appendConsole: Sys$_Debug$_appendConsole,
	_appendTrace: Sys$_Debug$_appendTrace,
	assert: Sys$_Debug$assert,
	clearTrace: Sys$_Debug$clearTrace,
	fail: Sys$_Debug$fail,
	trace: Sys$_Debug$trace,
	traceDump: Sys$_Debug$traceDump,
	_traceDump: Sys$_Debug$_traceDump
}
Sys._Debug.registerClass('Sys._Debug');

Sys.Debug = new Sys._Debug();
	Sys.Debug.isDebug = true;
function Sys$Enum$parse(value, ignoreCase) {
	/// <summary locid="M:J#Sys.Enum.parse" />
	/// <param name="value" type="String"></param>
	/// <param name="ignoreCase" type="Boolean" optional="true" mayBeNull="true"></param>
	/// <returns></returns>

	var values, parsed, val;
	if (ignoreCase) {
		values = this.__lowerCaseValues;
		if (!values) {
			this.__lowerCaseValues = values = {};
			var prototype = this.prototype;
			for (var name in prototype) {
				values[name.toLowerCase()] = prototype[name];
			}
		}
	}
	else {
		values = this.prototype;
	}
	if (!this.__flags) {
		val = (ignoreCase ? value.toLowerCase() : value);
		parsed = values[val.trim()];
		if (typeof(parsed) !== 'number') throw Error.argument('value', String.format(Sys.Res.enumInvalidValue, value, this.__typeName));
		return parsed;
	}
	else {
		var parts = (ignoreCase ? value.toLowerCase() : value).split(',');
		var v = 0;

		for (var i = parts.length - 1; i >= 0; i--) {
			var part = parts[i].trim();
			parsed = values[part];
			if (typeof(parsed) !== 'number') throw Error.argument('value', String.format(Sys.Res.enumInvalidValue, value.split(',')[i].trim(), this.__typeName));
			v |= parsed;
		}
		return v;
	}
}

function Sys$Enum$toString(value) {
	/// <summary locid="M:J#Sys.Enum.toString" />
	/// <param name="value" optional="true" mayBeNull="true"></param>
	/// <returns type="String"></returns>

	if ((typeof(value) === 'undefined') || (value === null)) return this.__string;
	if ((typeof(value) != 'number') || ((value % 1) !== 0)) throw Error.argumentType('value', Object.getType(value), this);
	var values = this.prototype;
	var i;
	if (!this.__flags || (value === 0)) {
		for (i in values) {
			if (values[i] === value) {
				return i;
			}
		}
	}
	else {
		var sorted = this.__sortedValues;
		if (!sorted) {
			sorted = [];
			for (i in values) {
				sorted[sorted.length] = {key: i, value: values[i]};
			}
			sorted.sort(function(a, b) {
				return a.value - b.value;
			});
			this.__sortedValues = sorted;
		}
		var parts = [];
		var v = value;
		for (i = sorted.length - 1; i >= 0; i--) {
			var kvp = sorted[i];
			var vali = kvp.value;
			if (vali === 0) continue;
			if ((vali & value) === vali) {
				parts[parts.length] = kvp.key;
				v -= vali;
				if (v === 0) break;
			}
		}
		if (parts.length && v === 0) return parts.reverse().join(', ');
	}
	throw Error.argumentOutOfRange('value', value, String.format(Sys.Res.enumInvalidValue, value, this.__typeName));
}

Type.prototype.registerEnum = function Type$registerEnum(name, flags) {
	/// <summary locid="M:J#Sys.UI.LineType.#ctor" />
	/// <param name="name" type="String"></param>
	/// <param name="flags" type="Boolean" optional="true" mayBeNull="true"></param>

	if (!Type.__fullyQualifiedIdentifierRegExp.test(name)) throw Error.argument('name', Sys.Res.notATypeName);
	var parsedName;
	try {
		parsedName = window.eval(name);
	}
	catch(e) {
		throw Error.argument('name', Sys.Res.argumentTypeName);
	}
	if (parsedName !== this) throw Error.argument('name', Sys.Res.badTypeName);
	if (Sys.__registeredTypes[name]) throw Error.invalidOperation(String.format(Sys.Res.typeRegisteredTwice, name));
	for (var j in this.prototype) {
		var val = this.prototype[j];
		if (!Type.__identifierRegExp.test(j)) throw Error.invalidOperation(String.format(Sys.Res.enumInvalidValueName, j));
		if (typeof(val) !== 'number' || (val % 1) !== 0) throw new Error(j);// Error.invalidOperation(Sys.Res.enumValueNotInteger);
		if (typeof(this[j]) !== 'undefined') throw Error.invalidOperation(String.format(Sys.Res.enumReservedName, j));
	}
	Sys.__upperCaseTypes[name.toUpperCase()] = this;

	for (var i in this.prototype) {
		this[i] = this.prototype[i];
	}
	this.__typeName = name;
	this.parse = Sys$Enum$parse;
	this.__string = this.toString();
	this.toString = Sys$Enum$toString;
	this.__flags = flags;
	this.__enum = true;
	Sys.__registeredTypes[name] = true;
}

Type.isEnum = function Type$isEnum(type) {
	/// <summary locid="M:J#Type.isEnum" />
	/// <param name="type" mayBeNull="true"></param>
	/// <returns type="Boolean"></returns>

	if ((typeof(type) === 'undefined') || (type === null)) return false;
	return !!type.__enum;
}

Type.isFlags = function Type$isFlags(type) {
	/// <summary locid="M:J#Type.isFlags" />
	/// <param name="type" mayBeNull="true"></param>
	/// <returns type="Boolean"></returns>

	if ((typeof(type) === 'undefined') || (type === null)) return false;
	return !!type.__flags;
}

Sys.CollectionChange = function Sys$CollectionChange(action, newItems, newStartingIndex, oldItems, oldStartingIndex) {
	/// <summary locid="M:J#Sys.CollectionChange.#ctor" />
	/// <param name="action" type="Sys.NotifyCollectionChangedAction"></param>
	/// <param name="newItems" optional="true" mayBeNull="true"></param>
	/// <param name="newStartingIndex" type="Number" integer="true" optional="true" mayBeNull="true"></param>
	/// <param name="oldItems" optional="true" mayBeNull="true"></param>
	/// <param name="oldStartingIndex" type="Number" integer="true" optional="true" mayBeNull="true"></param>
	/// <field name="action" type="Sys.NotifyCollectionChangedAction" locid="F:J#Sys.CollectionChange.action"></field>
	/// <field name="newItems" type="Array" mayBeNull="true" elementMayBeNull="true" locid="F:J#Sys.CollectionChange.newItems"></field>
	/// <field name="newStartingIndex" type="Number" integer="true" locid="F:J#Sys.CollectionChange.newStartingIndex"></field>
	/// <field name="oldItems" type="Array" mayBeNull="true" elementMayBeNull="true" locid="F:J#Sys.CollectionChange.oldItems"></field>
	/// <field name="oldStartingIndex" type="Number" integer="true" locid="F:J#Sys.CollectionChange.oldStartingIndex"></field>

	this.action = action;
	if (newItems) {
		if (!(newItems instanceof Array)) {
			newItems = [newItems];
		}
	}
	this.newItems = newItems || null;
	if (typeof newStartingIndex !== "number") {
		newStartingIndex = -1;
	}
	this.newStartingIndex = newStartingIndex;
	if (oldItems) {
		if (!(oldItems instanceof Array)) {
			oldItems = [oldItems];
		}
	}
	this.oldItems = oldItems || null;
	if (typeof oldStartingIndex !== "number") {
		oldStartingIndex = -1;
	}
	this.oldStartingIndex = oldStartingIndex;
}
Sys.CollectionChange.registerClass("Sys.CollectionChange");
Sys.NotifyCollectionChangedAction = function Sys$NotifyCollectionChangedAction() {
	/// <summary locid="M:J#Sys.NotifyCollectionChangedAction.#ctor" />
	/// <field name="add" type="Number" integer="true" static="true" locid="F:J#Sys.NotifyCollectionChangedAction.add"></field>
	/// <field name="remove" type="Number" integer="true" static="true" locid="F:J#Sys.NotifyCollectionChangedAction.remove"></field>
	/// <field name="reset" type="Number" integer="true" static="true" locid="F:J#Sys.NotifyCollectionChangedAction.reset"></field>
	if (arguments.length !== 0) throw Error.parameterCount();
	throw Error.notImplemented();
}




Sys.NotifyCollectionChangedAction.prototype = {
	add: 0,
	remove: 1,
	reset: 2
}
Sys.NotifyCollectionChangedAction.registerEnum('Sys.NotifyCollectionChangedAction');
Sys.NotifyCollectionChangedEventArgs = function Sys$NotifyCollectionChangedEventArgs(changes) {
	/// <summary locid="M:J#Sys.NotifyCollectionChangedEventArgs.#ctor" />
	/// <param name="changes" type="Array" elementType="Sys.CollectionChange"></param>

	this._changes = changes;
	Sys.NotifyCollectionChangedEventArgs.initializeBase(this);
}

	function Sys$NotifyCollectionChangedEventArgs$get_changes() {
		/// <value type="Array" elementType="Sys.CollectionChange" locid="P:J#Sys.NotifyCollectionChangedEventArgs.changes"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._changes || [];
	}
Sys.NotifyCollectionChangedEventArgs.prototype = {
	get_changes: Sys$NotifyCollectionChangedEventArgs$get_changes
}
Sys.NotifyCollectionChangedEventArgs.registerClass("Sys.NotifyCollectionChangedEventArgs", Sys.EventArgs);

Sys.Observer = function Sys$Observer() {
	throw Error.invalidOperation();
}
Sys.Observer.registerClass("Sys.Observer");

Sys.Observer.makeObservable = function Sys$Observer$makeObservable(target) {
	/// <summary locid="M:J#Sys.Observer.makeObservable" />
	/// <param name="target" mayBeNull="false"></param>
	/// <returns></returns>

	var isArray = target instanceof Array,
		o = Sys.Observer;
	Sys.Observer._ensureObservable(target);
	if (target.setValue === o._observeMethods.setValue) return target;
	o._addMethods(target, o._observeMethods);
	if (isArray) {
		o._addMethods(target, o._arrayMethods);
	}
	return target;
}
Sys.Observer.disposeObservable = function Sys$Observer$disposeObservable(target) {
	var isArray = target instanceof Array,
		o = Sys.Observer;
	if (target.setValue === o._observeMethods.setValue) {
		o._removeMethods(target, o._observeMethods);
		if (isArray) {
			o._removeMethods(target, o._arrayMethods);
		}
	}
}
Sys.Observer._ensureObservable = function Sys$Observer$_ensureObservable(target) {
	var type = typeof target;
	if ((type === "string") || (type === "number") || (type === "boolean") || (type === "date")) {
		throw Error.invalidOperation(String.format(Sys.Res.notObservable, type));
	}
}
Sys.Observer._addMethods = function Sys$Observer$_addMethods(target, methods) {
	for (var m in methods) {
		//Allow observable to overwrite target methods.
		//if (target[m] && (target[m] !== methods[m])) {
		//    throw Error.invalidOperation(String.format(Sys.Res.observableConflict, m));
		//}
		target[m] = methods[m];
	}
}
Sys.Observer._removeMethods = function Sys$Observer$_removeMethods(target, methods) {
	for (var m in methods) {
		target[m] = null;
	}
}


Sys.Observer._addEventHandler = function Sys$Observer$_addEventHandler(target, eventName, handler) {
	Sys.Observer._getContext(target, true).events._addHandler(eventName, handler);
}
Sys.Observer.addEventHandler = function Sys$Observer$addEventHandler(target, eventName, handler) {
	/// <summary locid="M:J#Sys.Observer.addEventHandler" />
	/// <param name="target"></param>
	/// <param name="eventName" type="String"></param>
	/// <param name="handler" type="Function"></param>

	Sys.Observer._ensureObservable(target);
	Sys.Observer._addEventHandler(target, eventName, handler);
}


Sys.Observer._removeEventHandler = function Sys$Observer$_removeEventHandler(target, eventName, handler) {
	Sys.Observer._getContext(target, true).events._removeHandler(eventName, handler);
}
Sys.Observer.removeEventHandler = function Sys$Observer$removeEventHandler(target, eventName, handler) {
	/// <summary locid="M:J#Sys.Observer.removeEventHandler" />
	/// <param name="target"></param>
	/// <param name="eventName" type="String"></param>
	/// <param name="handler" type="Function"></param>

	Sys.Observer._ensureObservable(target);
	Sys.Observer._removeEventHandler(target, eventName, handler);
}
Sys.Observer.clearEventHandlers = function Sys$Observer$clearEventHandlers(target, eventName) {
	/// <summary locid="M:J#Sys.Observer.clearEventHandlers" />
	/// <param name="target"></param>
	/// <param name="eventName" type="String" mayBeNull="true" optional="true"></param>

	Sys.Observer._ensureObservable(target);
	Sys.Observer._getContext(target, true).events._removeHandlers(eventName);
}
Sys.Observer.raiseEvent = function Sys$Observer$raiseEvent(target, eventName, eventArgs) {
	/// <summary locid="M:J#Sys.Observer.raiseEvent" />
	/// <param name="target"></param>
	/// <param name="eventName" type="String"></param>
	/// <param name="eventArgs" optional="true" mayBeNull="true"></param>

	Sys.Observer._ensureObservable(target);
	var ctx = Sys.Observer._getContext(target);
	if (!ctx) return;
	var handler = ctx.events.getHandler(eventName);
	if (handler) {
		handler(target, eventArgs || Sys.EventArgs.Empty);
	}
}
Sys.Observer.addPropertyChanged = function Sys$Observer$addPropertyChanged(target, handler) {
	/// <summary locid="M:J#Sys.Observer.addPropertyChanged" />
	/// <param name="target" mayBeNull="false"></param>
	/// <param name="handler" type="Function"></param>

	Sys.Observer._ensureObservable(target);
	Sys.Observer._addEventHandler(target, "propertyChanged", handler);
}
Sys.Observer.removePropertyChanged = function Sys$Observer$removePropertyChanged(target, handler) {
	/// <summary locid="M:J#Sys.Observer.removePropertyChanged" />
	/// <param name="target" mayBeNull="false"></param>
	/// <param name="handler" type="Function"></param>

	Sys.Observer._ensureObservable(target);
	Sys.Observer._removeEventHandler(target, "propertyChanged", handler);
}
Sys.Observer.beginUpdate = function Sys$Observer$beginUpdate(target) {
	/// <summary locid="M:J#Sys.Observer.beginUpdate" />
	/// <param name="target" mayBeNull="false"></param>

	Sys.Observer._ensureObservable(target);
	Sys.Observer._getContext(target, true).updating = true;
}
Sys.Observer.endUpdate = function Sys$Observer$endUpdate(target) {
	/// <summary locid="M:J#Sys.Observer.endUpdate" />
	/// <param name="target" mayBeNull="false"></param>

	Sys.Observer._ensureObservable(target);
	var ctx = Sys.Observer._getContext(target);
	if (!ctx || !ctx.updating) return;
	ctx.updating = false;
	var dirty = ctx.dirty;
	ctx.dirty = false;
	if (dirty) {
		if (target instanceof Array) {
			var changes = ctx.changes;
			ctx.changes = null;
			Sys.Observer.raiseCollectionChanged(target, changes);
		}
		Sys.Observer.raisePropertyChanged(target, "");
	}
}
Sys.Observer.isUpdating = function Sys$Observer$isUpdating(target) {
	/// <summary locid="M:J#Sys.Observer.isUpdating" />
	/// <param name="target" mayBeNull="false"></param>
	/// <returns type="Boolean"></returns>

	Sys.Observer._ensureObservable(target);
	var ctx = Sys.Observer._getContext(target);
	return ctx ? ctx.updating : false;
}


Sys.Observer._setValue = function Sys$Observer$_setValue(target, propertyName, value) {
	var getter, setter, mainTarget = target, path = propertyName.split('.');
	for (var i = 0, l = (path.length - 1); i < l; i++) {
		var name = path[i];
		getter = target["get_" + name];
		if (typeof (getter) === "function") {
			target = getter.call(target);
		}
		else {
			target = target[name];
		}
		var type = typeof (target);
		if ((target === null) || (type === "undefined")) {
			throw Error.invalidOperation(String.format(Sys.Res.nullReferenceInPath, propertyName));
		}
	}

	var notify = true; // added
	var currentValue, lastPath = path[l];
	getter = target["get_" + lastPath];
	setter = target["set_" + lastPath];
	if (typeof (getter) === 'function') {
		currentValue = getter.call(target);
	}
	else {
		currentValue = target[lastPath];
	}
	if (typeof (setter) === 'function') {
		notify = !setter.__notifies; // added
		setter.call(target, value);
	}
	else {
		target[lastPath] = value;
	}
	if (currentValue !== value) {
		var ctx = Sys.Observer._getContext(mainTarget);
		if (ctx && ctx.updating) {
			ctx.dirty = true;
			return;
		}
		if (notify) {
			Sys.Observer.raisePropertyChanged(mainTarget, path[0]);
		}
	}
}
Sys.Observer.setValue = function Sys$Observer$setValue(target, propertyName, value) {
	/// <summary locid="M:J#Sys.Observer.setValue" />
	/// <param name="target" mayBeNull="false"></param>
	/// <param name="propertyName" type="String"></param>
	/// <param name="value" mayBeNull="true"></param>

	Sys.Observer._ensureObservable(target);
	Sys.Observer._setValue(target, propertyName, value);
}
Sys.Observer.raisePropertyChanged = function Sys$Observer$raisePropertyChanged(target, propertyName) {
	/// <summary locid="M:J#Sys.Observer.raisePropertyChanged" />
	/// <param name="target" mayBeNull="false"></param>
	/// <param name="propertyName" type="String"></param>
	Sys.Observer.raiseEvent(target, "propertyChanged", new Sys.PropertyChangedEventArgs(propertyName));
}

Sys.Observer.addCollectionChanged = function Sys$Observer$addCollectionChanged(target, handler) {
	/// <summary locid="M:J#Sys.Observer.addCollectionChanged" />
	/// <param name="target" type="Array" elementMayBeNull="true"></param>
	/// <param name="handler" type="Function"></param>

	Sys.Observer._addEventHandler(target, "collectionChanged", handler);
}
Sys.Observer.removeCollectionChanged = function Sys$Observer$removeCollectionChanged(target, handler) {
	/// <summary locid="M:J#Sys.Observer.removeCollectionChanged" />
	/// <param name="target" type="Array" elementMayBeNull="true"></param>
	/// <param name="handler" type="Function"></param>

	Sys.Observer._removeEventHandler(target, "collectionChanged", handler);
}
Sys.Observer._collectionChange = function Sys$Observer$_collectionChange(target, change) {
	var ctx = Sys.Observer._getContext(target);
	if (ctx && ctx.updating) {
		ctx.dirty = true;
		var changes = ctx.changes;
		if (!changes) {
			ctx.changes = changes = [change];
		}
		else {
			changes.push(change);
		}
	}
	else {
		Sys.Observer.raiseCollectionChanged(target, [change]);
		Sys.Observer.raisePropertyChanged(target, 'length');
	}
}
Sys.Observer.add = function Sys$Observer$add(target, item) {
	/// <summary locid="M:J#Sys.Observer.add" />
	/// <param name="target" type="Array" elementMayBeNull="true"></param>
	/// <param name="item" mayBeNull="true"></param>

	var change = new Sys.CollectionChange(Sys.NotifyCollectionChangedAction.add, [item], target.length);
	Array.add(target, item);
	Sys.Observer._collectionChange(target, change);
}
Sys.Observer.addRange = function Sys$Observer$addRange(target, items) {
	/// <summary locid="M:J#Sys.Observer.addRange" />
	/// <param name="target" type="Array" elementMayBeNull="true"></param>
	/// <param name="items" type="Array" elementMayBeNull="true"></param>

	var change = new Sys.CollectionChange(Sys.NotifyCollectionChangedAction.add, items, target.length);
	Array.addRange(target, items);
	Sys.Observer._collectionChange(target, change);
}
Sys.Observer.insertRange = function Sys$Observer$insertRange(target, index, items) {
	/// <summary locid="M:J#Sys.Observer.insertRange" />
	/// <param name="target" type="Array" elementMayBeNull="true"></param>
	/// <param name="index" type="Array" elementMayBeNull="true"></param>
	/// <param name="items" type="Array" elementMayBeNull="true"></param>

	var change = new Sys.CollectionChange(Sys.NotifyCollectionChangedAction.add, items, index);
	var spliceArgs = items.slice();
	spliceArgs.splice(0, 0, index, 0);
	target.splice.apply(target, spliceArgs);
	Sys.Observer._collectionChange(target, change);
}
Sys.Observer.removeRange = function Sys$Observer$removeRange(target, start, count) {
	/// <summary locid="M:J#Sys.Observer.removeRange" />
	/// <param name="target" type="Array" elementMayBeNull="true"></param>
	/// <param name="start" type="Array" elementMayBeNull="true"></param>
	/// <param name="count" type="Array" elementMayBeNull="true"></param>

	var items = target.splice(start, count);
	var change = new Sys.CollectionChange(Sys.NotifyCollectionChangedAction.remove, null, -1, items, start);
	Sys.Observer._collectionChange(target, change);
	return items;
}
Sys.Observer.clear = function Sys$Observer$clear(target) {
	/// <summary locid="M:J#Sys.Observer.clear" />
	/// <param name="target" type="Array" elementMayBeNull="true"></param>

	var oldItems = Array.clone(target);
	Array.clear(target);
	Sys.Observer._collectionChange(target, new Sys.CollectionChange(Sys.NotifyCollectionChangedAction.reset, null, -1, oldItems, 0));
}
Sys.Observer.insert = function Sys$Observer$insert(target, index, item) {
	/// <summary locid="M:J#Sys.Observer.insert" />
	/// <param name="target" type="Array" elementMayBeNull="true"></param>
	/// <param name="index" type="Number" integer="true"></param>
	/// <param name="item" mayBeNull="true"></param>

	Array.insert(target, index, item);
	Sys.Observer._collectionChange(target, new Sys.CollectionChange(Sys.NotifyCollectionChangedAction.add, [item], index));
}
Sys.Observer.remove = function Sys$Observer$remove(target, item) {
	/// <summary locid="M:J#Sys.Observer.remove" />
	/// <param name="target" type="Array" elementMayBeNull="true"></param>
	/// <param name="item" mayBeNull="true"></param>
	/// <returns type="Boolean"></returns>

	var index = Array.indexOf(target, item);
	if (index !== -1) {
		Array.remove(target, item);
		Sys.Observer._collectionChange(target, new Sys.CollectionChange(Sys.NotifyCollectionChangedAction.remove, null, -1, [item], index));
		return true;
	}
	return false;
}
Sys.Observer.removeAt = function Sys$Observer$removeAt(target, index) {
	/// <summary locid="M:J#Sys.Observer.removeAt" />
	/// <param name="target" type="Array" elementMayBeNull="true"></param>
	/// <param name="index" type="Number" integer="true"></param>

	if ((index > -1) && (index < target.length)) {
		var item = target[index];
		Array.removeAt(target, index);
		Sys.Observer._collectionChange(target, new Sys.CollectionChange(Sys.NotifyCollectionChangedAction.remove, null, -1, [item], index));
		return item;
	}
}
Sys.Observer.raiseCollectionChanged = function Sys$Observer$raiseCollectionChanged(target, changes) {
	/// <summary locid="M:J#Sys.Observer.raiseCollectionChanged" />
	/// <param name="target"></param>
	/// <param name="changes" type="Array" elementType="Sys.CollectionChange"></param>
	Sys.Observer.raiseEvent(target, "collectionChanged", new Sys.NotifyCollectionChangedEventArgs(changes));
}


Sys.Observer._observeMethods = {
	add_propertyChanged: function(handler) {
		Sys.Observer._addEventHandler(this, "propertyChanged", handler);
	},
	remove_propertyChanged: function(handler) {
		Sys.Observer._removeEventHandler(this, "propertyChanged", handler);
	},
	addEventHandler: function(eventName, handler) {
		/// <summary locid="M:J#Sys.Observer.raiseCollectionChanged" />
		/// <param name="eventName" type="String"></param>
		/// <param name="handler" type="Function"></param>

		Sys.Observer._addEventHandler(this, eventName, handler);
	},
	removeEventHandler: function(eventName, handler) {
		/// <summary locid="M:J#Sys.Observer.raiseCollectionChanged" />
		/// <param name="eventName" type="String"></param>
		/// <param name="handler" type="Function"></param>

		Sys.Observer._removeEventHandler(this, eventName, handler);
	},
	clearEventHandlers: function(eventName) {
		/// <summary locid="M:J#Sys.Observer.raiseCollectionChanged" />
		/// <param name="target"></param>
		/// <param name="eventName" type="String" mayBeNull="true" optional="true"></param>

		Sys.Observer._getContext(this, true).events._removeHandlers(eventName);
	},
	get_isUpdating: function() {
		/// <summary locid="M:J#Sys.Observer.raiseCollectionChanged" />
		/// <returns type="Boolean"></returns>
		return Sys.Observer.isUpdating(this);
	},
	beginUpdate: function() {
		/// <summary locid="M:J#Sys.Observer.raiseCollectionChanged" />
		Sys.Observer.beginUpdate(this);
	},
	endUpdate: function() {
		/// <summary locid="M:J#Sys.Observer.raiseCollectionChanged" />
		Sys.Observer.endUpdate(this);
	},
	setValue: function(name, value) {
		/// <summary locid="M:J#Sys.Observer.raiseCollectionChanged" />
		/// <param name="name" type="String"></param>
		/// <param name="value" mayBeNull="true"></param>

		Sys.Observer._setValue(this, name, value);
	},
	raiseEvent: function(eventName, eventArgs) {
		/// <summary locid="M:J#Sys.Observer.raiseCollectionChanged" />
		/// <param name="eventName" type="String"></param>
		/// <param name="eventArgs" optional="true" mayBeNull="true"></param>
		Sys.Observer.raiseEvent(this, eventName, eventArgs||null);
	},
	raisePropertyChanged: function(name) {
		/// <summary locid="M:J#Sys.Observer.raiseCollectionChanged" />
		/// <param name="name" type="String"></param>
		Sys.Observer.raiseEvent(this, "propertyChanged", new Sys.PropertyChangedEventArgs(name));
	}
}
Sys.Observer._arrayMethods = {
	add_collectionChanged: function(handler) {
		Sys.Observer._addEventHandler(this, "collectionChanged", handler);
	},
	remove_collectionChanged: function(handler) {
		Sys.Observer._removeEventHandler(this, "collectionChanged", handler);
	},
	add: function(item) {
		/// <summary locid="M:J#Sys.Observer.raiseCollectionChanged" />
		/// <param name="item" mayBeNull="true"></param>
		Sys.Observer.add(this, item);
	},
	addRange: function(items) {
		/// <summary locid="M:J#Sys.Observer.raiseCollectionChanged" />
		/// <param name="items" type="Array" elementMayBeNull="true"></param>
		Sys.Observer.addRange(this, items);
	},
	clear: function() {
		/// <summary locid="M:J#Sys.Observer.raiseCollectionChanged" />
		Sys.Observer.clear(this);
	},
	insert: function(index, item) {
		/// <summary locid="M:J#Sys.Observer.raiseCollectionChanged" />
		/// <param name="index" type="Number" integer="true"></param>
		/// <param name="item" mayBeNull="true"></param>
		Sys.Observer.insert(this, index, item);
	},
	insertRange: function(index, items) {
		/// <summary locid="M:J#Sys.Observer.insertRange" />
		/// <param name="target" type="Array" elementMayBeNull="true"></param>
		/// <param name="index" type="Array" elementMayBeNull="true"></param>
		/// <param name="items" type="Array" elementMayBeNull="true"></param>
		Sys.Observer.insertRange(this, index, items);
	},
	remove: function(item) {
		/// <summary locid="M:J#Sys.Observer.raiseCollectionChanged" />
		/// <param name="item" mayBeNull="true"></param>
		/// <returns type="Boolean"></returns>
		return Sys.Observer.remove(this, item);
	},
	removeAt: function(index) {
		/// <summary locid="M:J#Sys.Observer.raiseCollectionChanged" />
		/// <param name="index" type="Number" integer="true"></param>
		return Sys.Observer.removeAt(this, index);
	},
	removeRange: function(start, count) {
		/// <summary locid="M:J#Sys.Observer.removeRange" />
		/// <param name="target" type="Array" elementMayBeNull="true"></param>
		/// <param name="start" type="Array" elementMayBeNull="true"></param>
		/// <param name="count" type="Array" elementMayBeNull="true"></param>
		return Sys.Observer.removeRange(this, start, count);
	},
	raiseCollectionChanged: function(changes) {
		/// <summary locid="M:J#Sys.Observer.raiseCollectionChanged" />
		/// <param name="changes" type="Array" elementType="Sys.CollectionChange"></param>
		Sys.Observer.raiseEvent(this, "collectionChanged", new Sys.NotifyCollectionChangedEventArgs(changes));
	}
}
Sys.Observer._getContext = function Sys$Observer$_getContext(obj, create) {
	var ctx = obj._observerContext;
	if (ctx) return ctx();
	if (create) {
		return (obj._observerContext = Sys.Observer._createContext())();
	}
	return null;
}
Sys.Observer._createContext = function Sys$Observer$_createContext() {
	var ctx = {
		events: new Sys.EventHandlerList()
	};
	return function() {
		return ctx;
	}
}





Date._appendPreOrPostMatch = function Date$_appendPreOrPostMatch(preMatch, strBuilder) {
	var quoteCount = 0;
	var escaped = false;
	for (var i = 0, il = preMatch.length; i < il; i++) {
		var c = preMatch.charAt(i);
		switch (c) {
		case '\'':
			if (escaped) strBuilder.append("'");
			else quoteCount++;
			escaped = false;
			break;
		case '\\':
			if (escaped) strBuilder.append("\\");
			escaped = !escaped;
			break;
		default:
			strBuilder.append(c);
			escaped = false;
			break;
		}
	}
	return quoteCount;
}

   Date._expandFormat = function Date$_expandFormat(dtf, format) {
	if (!format) {
		format = "F";
	}
	var len = format.length;
	if (len === 1) {
		switch (format) {
		case "d":
			return dtf["ShortDatePattern"];
		case "D":
			return dtf["LongDatePattern"];
		case "t":
			return dtf["ShortTimePattern"];
		case "T":
			return dtf["LongTimePattern"];
		case "f":
			return dtf["LongDatePattern"] + " " + dtf["ShortTimePattern"];
		case "F":
			return dtf["FullDatePattern"];
		case "g":
			return dtf["ShortDatePattern"] + " " + dtf["ShortTimePattern"];
		case "G":
			return dtf["ShortDatePattern"] + " " + dtf["LongTimePattern"];
		case "M": case "m":
			return dtf["MonthDayPattern"];
		case "s":
			return dtf["SortableDateTimePattern"];
		
		case "Y": case "y":
			return dtf["YearMonthPattern"];
		default:
			throw Error.format(Sys.Res.formatInvalidString);
		}
	}
	else if ((len === 2) && (format.charAt(0) === "%")) {
		format = format.charAt(1);
	}
	return format;
}

Date._expandYear = function Date$_expandYear(dtf, year) {
	var now = new Date(),
		era = Date._getEra(now);
	if (year < 100) {
		var curr = Date._getEraYear(now, dtf, era);
		year += curr - (curr % 100);
		if (year > dtf.Calendar.TwoDigitYearMax) {
			year -= 100;
		}
	}
	return year;
}

Date._getEra = function Date$_getEra(date, eras) {
	if (!eras) return 0;
	var start, ticks = date.getTime();
	for (var i = 0, l = eras.length; i < l; i += 4) {
		start = eras[i+2];
		if ((start === null) || (ticks >= start)) {
			return i;
		}
	}
	return 0;
}
Date._getEraYear = function Date$_getEraYear(date, dtf, era, sortable) {
	var year = date.getFullYear();
	if (!sortable && dtf.eras) {
		year -= dtf.eras[era + 3];
	}
	return year;
}

Date._getParseRegExp = function Date$_getParseRegExp(dtf, format) {
	if (!dtf._parseRegExp) {
		dtf._parseRegExp = {};
	}
	else if (dtf._parseRegExp[format]) {
		return dtf._parseRegExp[format];
	}

	var expFormat = Date._expandFormat(dtf, format);
	expFormat = expFormat.replace(/([\^\$\.\*\+\?\|\[\]\(\)\{\}])/g, "\\\\$1");

	var regexp = new Sys.StringBuilder("^");
	var groups = [];
	var index = 0;
	var quoteCount = 0;
	var tokenRegExp = Date._getTokenRegExp();
	var match;

	while ((match = tokenRegExp.exec(expFormat)) !== null) {
		var preMatch = expFormat.slice(index, match.index);
		index = tokenRegExp.lastIndex;

		quoteCount += Date._appendPreOrPostMatch(preMatch, regexp);
		if ((quoteCount%2) === 1) {
			regexp.append(match[0]);
			continue;
		}

		switch (match[0]) {
			case 'dddd': case 'ddd':
			case 'MMMM': case 'MMM':
			case 'gg': case 'g':
				regexp.append("(\\D+)");
				break;
			case 'tt': case 't':
				regexp.append("(\\D*)");
				break;
			case 'yyyy':
				regexp.append("(\\d{4})");
				break;
			case 'fff':
				regexp.append("(\\d{3})");
				break;
			case 'ff':
				regexp.append("(\\d{2})");
				break;
			case 'f':
				regexp.append("(\\d)");
				break;
			case 'dd': case 'd':
			case 'MM': case 'M':
			case 'yy': case 'y':
			case 'HH': case 'H':
			case 'hh': case 'h':
			case 'mm': case 'm':
			case 'ss': case 's':
				regexp.append("(\\d\\d?)");
				break;
			case 'zzz':
				regexp.append("([+-]?\\d\\d?:\\d{2})");
				break;
			case 'zz': case 'z':
				regexp.append("([+-]?\\d\\d?)");
				break;
			case '/':
				regexp.append("(\\" + dtf.DateSeparator + ")");
				break;
		}
		Array.add(groups, match[0]);
	}
	Date._appendPreOrPostMatch(expFormat.slice(index), regexp);
	regexp.append("$");
	var regexpStr = regexp.toString().replace(/\s+/g, "\\s+");
	var parseRegExp = {'regExp': regexpStr, 'groups': groups};
	dtf._parseRegExp[format] = parseRegExp;
	return parseRegExp;
}

Date._getTokenRegExp = function Date$_getTokenRegExp() {
	return /\/|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z|gg|g/g;
}

Date.parseLocale = function Date$parseLocale(value, formats) {
	/// <summary locid="M:J#Date.parseLocale" />
	/// <param name="value" type="String"></param>
	/// <param name="formats" parameterArray="true" optional="true" mayBeNull="true"></param>
	/// <returns type="Date"></returns>

	return Date._parse(value, Sys.CultureInfo.CurrentCulture, arguments);
}

Date.parseInvariant = function Date$parseInvariant(value, formats) {
	/// <summary locid="M:J#Date.parseInvariant" />
	/// <param name="value" type="String"></param>
	/// <param name="formats" parameterArray="true" optional="true" mayBeNull="true"></param>
	/// <returns type="Date"></returns>

	return Date._parse(value, Sys.CultureInfo.InvariantCulture, arguments);
}

Date._parse = function Date$_parse(value, cultureInfo, args) {
	var i, l, date, format, formats, custom = false;
	for (i = 1, l = args.length; i < l; i++) {
		format = args[i];
		if (format) {
			custom = true;
			date = Date._parseExact(value, format, cultureInfo);
			if (date) return date;
		}
	}
	if (! custom) {
		formats = cultureInfo._getDateTimeFormats();
		for (i = 0, l = formats.length; i < l; i++) {
			date = Date._parseExact(value, formats[i], cultureInfo);
			if (date) return date;
		}
	}
	return null;
}

Date._parseExact = function Date$_parseExact(value, format, cultureInfo) {
	value = value.trim();
	var dtf = cultureInfo.dateTimeFormat,
		parseInfo = Date._getParseRegExp(dtf, format),
		match = new RegExp(parseInfo.regExp).exec(value);
	if (match === null) return null;
	var groups = parseInfo.groups,
		era = null, year = null, month = null, date = null, weekDay = null,
		hour = 0, hourOffset, min = 0, sec = 0, msec = 0, tzMinOffset = null,
		pmHour = false;
	for (var j = 0, jl = groups.length; j < jl; j++) {
		var matchGroup = match[j+1];
		if (matchGroup) {
			switch (groups[j]) {
				case 'dd': case 'd':
					date = parseInt(matchGroup, 10);
					if ((date < 1) || (date > 31)) return null;
					break;
				case 'MMMM':
					month = cultureInfo._getMonthIndex(matchGroup);
					if ((month < 0) || (month > 11)) return null;
					break;
				case 'MMM':
					month = cultureInfo._getMonthIndex(matchGroup, true);
					if ((month < 0) || (month > 11)) return null;
					break;
				case 'M': case 'MM':
					month = parseInt(matchGroup, 10) - 1;
					if ((month < 0) || (month > 11)) return null;
					break;
				case 'y': case 'yy':
					year = Date._expandYear(dtf,parseInt(matchGroup, 10));
					if ((year < 0) || (year > 9999)) return null;
					break;
				case 'yyyy':
					year = parseInt(matchGroup, 10);
					if ((year < 0) || (year > 9999)) return null;
					break;
				case 'h': case 'hh':
					hour = parseInt(matchGroup, 10);
					if (hour === 12) hour = 0;
					if ((hour < 0) || (hour > 11)) return null;
					break;
				case 'H': case 'HH':
					hour = parseInt(matchGroup, 10);
					if ((hour < 0) || (hour > 23)) return null;
					break;
				case 'm': case 'mm':
					min = parseInt(matchGroup, 10);
					if ((min < 0) || (min > 59)) return null;
					break;
				case 's': case 'ss':
					sec = parseInt(matchGroup, 10);
					if ((sec < 0) || (sec > 59)) return null;
					break;
				case 'tt': case 't':
					var upperToken = matchGroup.toUpperCase();
					pmHour = (upperToken === dtf.PMDesignator.toUpperCase());
					if (!pmHour && (upperToken !== dtf.AMDesignator.toUpperCase())) return null;
					break;
				case 'f':
					msec = parseInt(matchGroup, 10) * 100;
					if ((msec < 0) || (msec > 999)) return null;
					break;
				case 'ff':
					msec = parseInt(matchGroup, 10) * 10;
					if ((msec < 0) || (msec > 999)) return null;
					break;
				case 'fff':
					msec = parseInt(matchGroup, 10);
					if ((msec < 0) || (msec > 999)) return null;
					break;
				case 'dddd':
					weekDay = cultureInfo._getDayIndex(matchGroup);
					if ((weekDay < 0) || (weekDay > 6)) return null;
					break;
				case 'ddd':
					weekDay = cultureInfo._getDayIndex(matchGroup, true);
					if ((weekDay < 0) || (weekDay > 6)) return null;
					break;
				case 'zzz':
					var offsets = matchGroup.split(/:/);
					if (offsets.length !== 2) return null;
					hourOffset = parseInt(offsets[0], 10);
					if ((hourOffset < -12) || (hourOffset > 13)) return null;
					var minOffset = parseInt(offsets[1], 10);
					if ((minOffset < 0) || (minOffset > 59)) return null;
					tzMinOffset = (hourOffset * 60) + (matchGroup.startsWith('-')? -minOffset : minOffset);
					break;
				case 'z': case 'zz':
					hourOffset = parseInt(matchGroup, 10);
					if ((hourOffset < -12) || (hourOffset > 13)) return null;
					tzMinOffset = hourOffset * 60;
					break;
				case 'g': case 'gg':
					var eraName = matchGroup;
					if (!eraName || !dtf.eras) return null;
					eraName = eraName.toLowerCase().trim();
					for (var i = 0, l = dtf.eras.length; i < l; i += 4) {
						if (eraName === dtf.eras[i + 1].toLowerCase()) {
							era = i;
							break;
						}
					}
					if (era === null) return null;
					break;
			}
		}
	}
	var result = new Date(), defaultYear, convert = dtf.Calendar.convert;
	// If none are specified, set to todays date to 1/1/1970
	if (year == null && month == null && date == null) {
		year = 1970;
		month = 0;
		date = 1;
	}
	else {
		if (convert) {
			defaultYear = convert.fromGregorian(result)[0];
		}
		else {
			defaultYear = result.getFullYear();
		}
		if (year === null) {
			year = defaultYear;
		}
		else if (dtf.eras) {
			year += dtf.eras[(era || 0) + 3];
		}
		if (month === null) {
			month = 0;
		}
		if (date === null) {
			date = 1;
		}
	}
	if (convert) {
		result = convert.toGregorian(year, month, date);
		if (result === null) return null;
	}
	else {
		result.setFullYear(year, month, date);
		if (result.getDate() !== date) return null;
		if ((weekDay !== null) && (result.getDay() !== weekDay)) {
			return null;
		}
	}
	if (pmHour && (hour < 12)) {
		hour += 12;
	}
	result.setHours(hour, min, sec, msec);
	if (tzMinOffset !== null) {
		var adjustedMin = result.getMinutes() - (tzMinOffset + result.getTimezoneOffset());
		result.setHours(result.getHours() + parseInt(adjustedMin/60, 10), adjustedMin%60);
	}
	return result;
}

Date.prototype.format = function Date$format(format) {
	/// <summary locid="M:J#Date.format" />
	/// <param name="format" type="String"></param>
	/// <returns type="String"></returns>

	return this._toFormattedString(format, Sys.CultureInfo.InvariantCulture);
}

Date.prototype.localeFormat = function Date$localeFormat(format) {
	/// <summary locid="M:J#Date.localeFormat" />
	/// <param name="format" type="String"></param>
	/// <returns type="String"></returns>

	return this._toFormattedString(format, Sys.CultureInfo.CurrentCulture);
}

Date.prototype._toFormattedString = function Date$_toFormattedString(format, cultureInfo) {
	var dtf = cultureInfo.dateTimeFormat,
		convert = dtf.Calendar.convert;
	if (!format || !format.length || (format === 'i')) {
		if (cultureInfo && cultureInfo.name.length) {
			if (convert) {
				return this._toFormattedString(dtf.FullDateTimePattern, cultureInfo);
			}
			else {
				var eraDate = new Date(this.getTime());
				var era = Date._getEra(this, dtf.eras);
				eraDate.setFullYear(Date._getEraYear(this, dtf, era));
				return eraDate.toLocaleString();
			}
		}
		else {
			return this.toString();
		}
	}

	var eras = dtf.eras,
		sortable = (format === "s");
	format = Date._expandFormat(dtf, format);

	var ret = new Sys.StringBuilder();
	var hour;

	function addLeadingZero(num) {
		if (num < 10) {
			return '0' + num;
		}
		return num.toString();
	}

	function addLeadingZeros(num) {
		if (num < 10) {
			return '00' + num;
		}
		if (num < 100) {
			return '0' + num;
		}
		return num.toString();
	}
	function padYear(year) {
		if (year < 10) {
			return '000' + year;
		}
		else if (year < 100) {
			return '00' + year;
		}
		else if (year < 1000) {
			return '0' + year;
		}
		return year.toString();
	}
	var foundDay, checkedDay, dayPartRegExp = /([^d]|^)(d|dd)([^d]|$)/g;
	function hasDay() {
		if (foundDay || checkedDay) {
			return foundDay;
		}
		foundDay = dayPartRegExp.test(format);
		checkedDay = true;
		return foundDay;
	}
	var quoteCount = 0,
		tokenRegExp = Date._getTokenRegExp(),
		converted;
	if (!sortable && convert) {
		converted = convert.fromGregorian(this);
	}
	for (;;) {

		var index = tokenRegExp.lastIndex;

		var ar = tokenRegExp.exec(format);

		var preMatch = format.slice(index, ar ? ar.index : format.length);
		quoteCount += Date._appendPreOrPostMatch(preMatch, ret);

		if (!ar) break;

		if ((quoteCount%2) === 1) {
			ret.append(ar[0]);
			continue;
		}
		function getPart(date, part) {
			if (converted) {
				return converted[part];
			}
			switch (part) {
				case 0: return date.getFullYear();
				case 1: return date.getMonth();
				case 2: return date.getDate();
			}
		}

		switch (ar[0]) {
		case "dddd":
			ret.append(dtf.DayNames[this.getDay()]);
			break;
		case "ddd":
			ret.append(dtf.AbbreviatedDayNames[this.getDay()]);
			break;
		case "dd":
			foundDay = true;
			ret.append(addLeadingZero(getPart(this, 2)));
			break;
		case "d":
			foundDay = true;
			ret.append(getPart(this, 2));
			break;
		case "MMMM":
			ret.append((dtf.MonthGenitiveNames && hasDay())
				? dtf.MonthGenitiveNames[getPart(this, 1)]
				: dtf.MonthNames[getPart(this, 1)]);
			break;
		case "MMM":
			ret.append((dtf.AbbreviatedMonthGenitiveNames && hasDay())
				? dtf.AbbreviatedMonthGenitiveNames[getPart(this, 1)]
				: dtf.AbbreviatedMonthNames[getPart(this, 1)]);
			break;
		case "MM":
			ret.append(addLeadingZero(getPart(this, 1) + 1));
			break;
		case "M":
			ret.append(getPart(this, 1) + 1);
			break;
		case "yyyy":
			ret.append(padYear(converted ? converted[0] : Date._getEraYear(this, dtf, Date._getEra(this, eras), sortable)));
			break;
		case "yy":
			ret.append(addLeadingZero((converted ? converted[0] : Date._getEraYear(this, dtf, Date._getEra(this, eras), sortable)) % 100));
			break;
		case "y":
			ret.append((converted ? converted[0] : Date._getEraYear(this, dtf, Date._getEra(this, eras), sortable)) % 100);
			break;
		case "hh":
			hour = this.getHours() % 12;
			if (hour === 0) hour = 12;
			ret.append(addLeadingZero(hour));
			break;
		case "h":
			hour = this.getHours() % 12;
			if (hour === 0) hour = 12;
			ret.append(hour);
			break;
		case "HH":
			ret.append(addLeadingZero(this.getHours()));
			break;
		case "H":
			ret.append(this.getHours());
			break;
		case "mm":
			ret.append(addLeadingZero(this.getMinutes()));
			break;
		case "m":
			ret.append(this.getMinutes());
			break;
		case "ss":
			ret.append(addLeadingZero(this.getSeconds()));
			break;
		case "s":
			ret.append(this.getSeconds());
			break;
		case "tt":
			ret.append((this.getHours() < 12) ? dtf.AMDesignator : dtf.PMDesignator);
			break;
		case "t":
			ret.append(((this.getHours() < 12) ? dtf.AMDesignator : dtf.PMDesignator).charAt(0));
			break;
		case "f":
			ret.append(addLeadingZeros(this.getMilliseconds()).charAt(0));
			break;
		case "ff":
			ret.append(addLeadingZeros(this.getMilliseconds()).substr(0, 2));
			break;
		case "fff":
			ret.append(addLeadingZeros(this.getMilliseconds()));
			break;
		case "z":
			hour = this.getTimezoneOffset() / 60;
			ret.append(((hour <= 0) ? '+' : '-') + Math.floor(Math.abs(hour)));
			break;
		case "zz":
			hour = this.getTimezoneOffset() / 60;
			ret.append(((hour <= 0) ? '+' : '-') + addLeadingZero(Math.floor(Math.abs(hour))));
			break;
		case "zzz":
			hour = this.getTimezoneOffset() / 60;
			ret.append(((hour <= 0) ? '+' : '-') + addLeadingZero(Math.floor(Math.abs(hour))) +
				":" + addLeadingZero(Math.abs(this.getTimezoneOffset() % 60)));
			break;
		case "g":
		case "gg":
			if (dtf.eras) {
				ret.append(dtf.eras[Date._getEra(this, eras) + 1]);
			}
			break;
		case "/":
			ret.append(dtf.DateSeparator);
			break;
		}
	}
	return ret.toString();
}
String.localeFormat = function String$localeFormat(format, args) {
	/// <summary locid="M:J#String.localeFormat" />
	/// <param name="format" type="String"></param>
	/// <param name="args" parameterArray="true" mayBeNull="true"></param>
	/// <returns type="String"></returns>

	return String._toFormattedString(true, arguments);
}
Number.parseLocale = function Number$parseLocale(value) {
	/// <summary locid="M:J#Number.parseLocale" />
	/// <param name="value" type="String"></param>
	/// <returns type="Number"></returns>

	return Number._parse(value, Sys.CultureInfo.CurrentCulture);
}
Number.parseInvariant = function Number$parseInvariant(value) {
	/// <summary locid="M:J#Number.parseInvariant" />
	/// <param name="value" type="String"></param>
	/// <returns type="Number"></returns>

	return Number._parse(value, Sys.CultureInfo.InvariantCulture);
}
Number._parse = function Number$_parse(value, cultureInfo) {
	value = value.trim();
	if (value.match(/^[+-]?infinity$/i)) {
		return parseFloat(value);
	}
	if (value.match(/^0x[a-f0-9]+$/i)) {
		return parseInt(value);
	}

	var numFormat = cultureInfo.numberFormat;
	var signInfo = Number._parseNumberNegativePattern(value, numFormat, numFormat.NumberNegativePattern);
	var sign = signInfo[0];
	var num = signInfo[1];
	if ((sign === '') && (numFormat.NumberNegativePattern !== 1)) {
		signInfo = Number._parseNumberNegativePattern(value, numFormat, 1);
		sign = signInfo[0];
		num = signInfo[1];
	}
	if (sign === '') sign = '+';
	var exponent;
	var intAndFraction;
	var exponentPos = num.indexOf('e');
	if (exponentPos < 0) exponentPos = num.indexOf('E');
	if (exponentPos < 0) {
		intAndFraction = num;
		exponent = null;
	}
	else {
		intAndFraction = num.substr(0, exponentPos);
		exponent = num.substr(exponentPos + 1);
	}
	var integer;
	var fraction;
	var decimalPos = intAndFraction.indexOf(numFormat.NumberDecimalSeparator);
	if (decimalPos < 0) {
		integer = intAndFraction;
		fraction = null;
	}
	else {
		integer = intAndFraction.substr(0, decimalPos);
		fraction = intAndFraction.substr(decimalPos + numFormat.NumberDecimalSeparator.length);
	}
	integer = integer.split(numFormat.NumberGroupSeparator).join('');
	var altNumGroupSeparator = numFormat.NumberGroupSeparator.replace(/\u00A0/g, " ");
	if (numFormat.NumberGroupSeparator !== altNumGroupSeparator) {
		integer = integer.split(altNumGroupSeparator).join('');
	}
	var p = sign + integer;
	if (fraction !== null) {
		p += '.' + fraction;
	}
	if (exponent !== null) {
		var expSignInfo = Number._parseNumberNegativePattern(exponent, numFormat, 1);
		if (expSignInfo[0] === '') {
			expSignInfo[0] = '+';
		}
		p += 'e' + expSignInfo[0] + expSignInfo[1];
	}

	if (p.match(/^[+-]?\d*\.?\d*(e[+-]?\d+)?$/)) {
		return parseFloat(p);
	}
	return Number.NaN;
}
Number._parseNumberNegativePattern = function Number$_parseNumberNegativePattern(value, numFormat, numberNegativePattern) {
	var neg = numFormat.NegativeSign;
	var pos = numFormat.PositiveSign;
	switch (numberNegativePattern) {
		case 4:
			neg = ' ' + neg;
			pos = ' ' + pos;
		case 3:
			if (value.endsWith(neg)) {
				return ['-', value.substr(0, value.length - neg.length)];
			}
			else if (value.endsWith(pos)) {
				return ['+', value.substr(0, value.length - pos.length)];
			}
			break;
		case 2:
			neg += ' ';
			pos += ' ';
		case 1:
			if (value.startsWith(neg)) {
				return ['-', value.substr(neg.length)];
			}
			else if (value.startsWith(pos)) {
				return ['+', value.substr(pos.length)];
			}
			break;
		case 0:
			if (value.startsWith('(') && value.endsWith(')')) {
				return ['-', value.substr(1, value.length - 2)];
			}
			break;
	}
	return ['', value];
}

Number.prototype.format = function Number$format(format) {
	/// <summary locid="M:J#Number.format" />
	/// <param name="format" type="String"></param>
	/// <returns type="String"></returns>

	return this._toFormattedString(format, Sys.CultureInfo.InvariantCulture);
}
Number.prototype.localeFormat = function Number$localeFormat(format) {
	/// <summary locid="M:J#Number.localeFormat" />
	/// <param name="format" type="String"></param>
	/// <returns type="String"></returns>

	return this._toFormattedString(format, Sys.CultureInfo.CurrentCulture);
}
Number.prototype._toFormattedString = function Number$_toFormattedString(format, cultureInfo) {
	if (!format || (format.length === 0) || (format === 'i')) {
		if (cultureInfo && (cultureInfo.name.length > 0)) {
			return this.toLocaleString();
		}
		else {
			return this.toString();
		}
	}
	var _percentPositivePattern = ["n %", "n%", "%n" ];
	var _percentNegativePattern = ["-n %", "-n%", "-%n"];
	var _numberNegativePattern = ["(n)","-n","- n","n-","n -"];
	var _currencyPositivePattern = ["$n","n$","$ n","n $"];
	var _currencyNegativePattern = ["($n)","-$n","$-n","$n-","(n$)","-n$","n-$","n$-","-n $","-$ n","n $-","$ n-","$ -n","n- $","($ n)","(n $)"];

	function zeroPad(str, count, left) {
		for (var l=str.length; l < count; l++) {
			str = (left ? ('0' + str) : (str + '0'));
		}
		return str;
	}
	function expandNumber(number, precision, groupSizes, sep, decimalChar) {
		var curSize = groupSizes[0];
		var curGroupIndex = 1;



		var factor = Math.pow(10, precision);
		var rounded = (Math.round(number * factor) / factor);
		if (!isFinite(rounded)) {
			rounded = number;
		}
		number = rounded;
		var numberString = number.toString();
		var right = "";
		var exponent;
		var split = numberString.split(/e/i);
		numberString = split[0];
		exponent = (split.length > 1 ? parseInt(split[1]) : 0);
		split = numberString.split('.');
		numberString = split[0];
		right = split.length > 1 ? split[1] : "";
		var l;
		if (exponent > 0) {
			right = zeroPad(right, exponent, false);
			numberString += right.slice(0, exponent);
			right = right.substr(exponent);
		}
		else if (exponent < 0) {
			exponent = -exponent;
			numberString = zeroPad(numberString, exponent+1, true);
			right = numberString.slice(-exponent, numberString.length) + right;
			numberString = numberString.slice(0, -exponent);
		}

		if (precision > 0) {
			if (right.length > precision) {
				right = right.slice(0, precision);
			}
			else {
				right = zeroPad(right, precision, false);
			}
			right = decimalChar + right;
		}
		else {
			right = "";
		}

		var stringIndex = numberString.length-1;
		var ret = "";
		while (stringIndex >= 0) {

			if (curSize === 0 || curSize > stringIndex) {
				if (ret.length > 0)
					return numberString.slice(0, stringIndex + 1) + sep + ret + right;
				else
					return numberString.slice(0, stringIndex + 1) + right;
			}

			if (ret.length > 0)
				ret = numberString.slice(stringIndex - curSize + 1, stringIndex+1) + sep + ret;
			else
				ret = numberString.slice(stringIndex - curSize + 1, stringIndex+1);

			stringIndex -= curSize;

			if (curGroupIndex < groupSizes.length) {
				curSize = groupSizes[curGroupIndex];
				curGroupIndex++;
			}
		}
		return numberString.slice(0, stringIndex + 1) + sep + ret + right;
	}
	var nf = cultureInfo.numberFormat;

	var number = Math.abs(this);

	if (!format)
		format = "D";

	var precision = -1;
	if (format.length > 1) precision = parseInt(format.slice(1), 10);

	var pattern;
	switch (format.charAt(0)) {
	case "d":
	case "D":
		pattern = 'n';

		if (precision !== -1) {
			number = zeroPad(""+number, precision, true);
		}

		if (this < 0) number = -number;
		break;
	case "c":
	case "C":
		if (this < 0) pattern = _currencyNegativePattern[nf.CurrencyNegativePattern];
		else pattern = _currencyPositivePattern[nf.CurrencyPositivePattern];
		if (precision === -1) precision = nf.CurrencyDecimalDigits;
		number = expandNumber(Math.abs(this), precision, nf.CurrencyGroupSizes, nf.CurrencyGroupSeparator, nf.CurrencyDecimalSeparator);
		break;
	case "n":
	case "N":
		if (this < 0) pattern = _numberNegativePattern[nf.NumberNegativePattern];
		else pattern = 'n';
		if (precision === -1) precision = nf.NumberDecimalDigits;
		number = expandNumber(Math.abs(this), precision, nf.NumberGroupSizes, nf.NumberGroupSeparator, nf.NumberDecimalSeparator);
		break;
	case "p":
	case "P":
		if (this < 0) pattern = _percentNegativePattern[nf.PercentNegativePattern];
		else pattern = _percentPositivePattern[nf.PercentPositivePattern];
		if (precision === -1) precision = nf.PercentDecimalDigits;
		number = expandNumber(Math.abs(this) * 100, precision, nf.PercentGroupSizes, nf.PercentGroupSeparator, nf.PercentDecimalSeparator);
		break;
	default:
		throw Error.format(Sys.Res.formatBadFormatSpecifier);
	}

	var regex = /n|\$|-|%/g;

	var ret = "";

	for (;;) {

		var index = regex.lastIndex;

		var ar = regex.exec(pattern);

		ret += pattern.slice(index, ar ? ar.index : pattern.length);

		if (!ar)
			break;

		switch (ar[0]) {
		case "n":
			ret += number;
			break;
		case "$":
			ret += nf.CurrencySymbol;
			break;
		case "-":
			if (/[1-9]/.test(number)) {
				ret += nf.NegativeSign;
			}
			break;
		case "%":
			ret += nf.PercentSymbol;
			break;
		}
	}

	return ret;
}
function toUpper(value) {
	return value.split("\u00A0").join(' ').toUpperCase();
}
function toUpperArray(arr) {
	var result = [];
	foreach(arr, function(value, i) {
		result[i] = toUpper(value);
	});
	return result;
}

function clone(obj) {
	var objNew = {};
	forIn(obj, function(value, field) {
		objNew[field] = (value instanceof Array) ? (value.length === 1 ? [value] : Array.apply(null, value)) :
			((typeof(value) === "object") ? clone(value) : value);
	});
	return objNew;
}

Sys.CultureInfo = function Sys$CultureInfo(name, numberFormat, dateTimeFormat) {
	/// <summary locid="M:J#Sys.CultureInfo.#ctor" />
	/// <param name="name" type="String"></param>
	/// <param name="numberFormat" type="Object"></param>
	/// <param name="dateTimeFormat" type="Object"></param>

	this.name = name;
	this.numberFormat = numberFormat;
	this.dateTimeFormat = dateTimeFormat;
}

	function Sys$CultureInfo$_getDateTimeFormats() {
		var formats = this._dateTimeFormats;
		if (!formats) {
			var dtf = this.dateTimeFormat;
			this._dateTimeFormats = formats =
			  [ dtf["MonthDayPattern"],
				dtf["YearMonthPattern"],
				dtf["ShortDatePattern"],
				dtf["ShortTimePattern"],
				dtf["LongDatePattern"],
				dtf["LongTimePattern"],
				dtf["FullDateTimePattern"],
				dtf["RFC1123Pattern"],
				dtf["SortableDateTimePattern"],
				dtf["UniversalSortableDateTimePattern"] ];
		}
		return formats;
	}
	function Sys$CultureInfo$_getMonthIndex(value, abbr) {
		var name = abbr ? "_upperAbbrMonths" : "_upperMonths",
			genitiveName = name + "Genitive",
			upperMonths = this[name];
		if (!upperMonths) {
			var prefix = (abbr ? "Abbreviated" : "");
			this[name] = toUpperArray(this.dateTimeFormat[prefix+"MonthNames"]);
			this[genitiveName] = toUpperArray(this.dateTimeFormat[prefix+"MonthGenitiveNames"]);
		}
		value = toUpper(value);
		var i = indexOf(this[name], value);
		if (i < 0) {
			i = indexOf(this[genitiveName], value);
		}
		return i;
	}
	function Sys$CultureInfo$_getDayIndex(value, abbr) {
		var name = abbr ? "_upperAbbrDays" : "_upperDays",
			upperDays = this[name];
		if (!upperDays) {
			this[name] = toUpperArray(this.dateTimeFormat[(abbr ? "Abbreviated" : "")+"DayNames"]);
		}
		return indexOf(this[name], toUpper(value));
	}
Sys.CultureInfo.prototype = {
	_getDateTimeFormats: Sys$CultureInfo$_getDateTimeFormats,
	_getMonthIndex: Sys$CultureInfo$_getMonthIndex,
	_getDayIndex: Sys$CultureInfo$_getDayIndex
}
Sys.CultureInfo.registerClass('Sys.CultureInfo');

merge(Sys.CultureInfo, {
_parse: function(value) {
	var dtf = value.dateTimeFormat;
	if (dtf && !dtf.eras) {
		dtf.eras = value.eras;
	}
	return new Sys.CultureInfo(value.name, value.numberFormat, dtf);
},
_setup: function() {
	var cultureInfo = window.__cultureInfo,
		monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December",""],
		shortMonthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""],
		invariant = { "name": "", "numberFormat": { "CurrencyDecimalDigits": 2, "CurrencyDecimalSeparator": ".", "CurrencyGroupSizes": [3], "NumberGroupSizes": [3], "PercentGroupSizes": [3], "CurrencyGroupSeparator": ",", "CurrencySymbol": "\u00A4", "NaNSymbol": "NaN", "CurrencyNegativePattern": 0, "NumberNegativePattern": 1, "PercentPositivePattern": 0, "PercentNegativePattern": 0, "NegativeInfinitySymbol": "-Infinity", "NegativeSign": "-", "NumberDecimalDigits": 2, "NumberDecimalSeparator": ".", "NumberGroupSeparator": ",", "CurrencyPositivePattern": 0, "PositiveInfinitySymbol": "Infinity", "PositiveSign": "+", "PercentDecimalDigits": 2, "PercentDecimalSeparator": ".", "PercentGroupSeparator": ",", "PercentSymbol": "%", "PerMilleSymbol": "\u2030", "NativeDigits": ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"], "DigitSubstitution": 1 }, "dateTimeFormat": { "AMDesignator": "AM", "Calendar": { "MinSupportedDateTime": "@-62135568000000@", "MaxSupportedDateTime": "@253402300799999@", "AlgorithmType": 1, "CalendarType": 1, "Eras": [1], "TwoDigitYearMax": 2029 }, "DateSeparator": "/", "FirstDayOfWeek": 0, "CalendarWeekRule": 0, "FullDateTimePattern": "dddd, dd MMMM yyyy HH:mm:ss", "LongDatePattern": "dddd, dd MMMM yyyy", "LongTimePattern": "HH:mm:ss", "MonthDayPattern": "MMMM dd", "PMDesignator": "PM", "RFC1123Pattern": "ddd, dd MMM yyyy HH\':\'mm\':\'ss \'GMT\'", "ShortDatePattern": "MM/dd/yyyy", "ShortTimePattern": "h:mm tt", "SortableDateTimePattern": "yyyy\'-\'MM\'-\'dd\'T\'HH\':\'mm\':\'ss", "TimeSeparator": ":", "UniversalSortableDateTimePattern": "yyyy\'-\'MM\'-\'dd HH\':\'mm\':\'ss\'Z\'", "YearMonthPattern": "yyyy MMMM", "AbbreviatedDayNames": ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"], "ShortestDayNames": ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"], "DayNames": ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"], "AbbreviatedMonthNames": shortMonthNames, "MonthNames": monthNames, "NativeCalendarName": "Gregorian Calendar", "AbbreviatedMonthGenitiveNames": Array.clone(shortMonthNames), "MonthGenitiveNames": Array.clone(monthNames) }, "eras": [1, "A.D.", null, 0] };
	this.InvariantCulture = this._parse(invariant);
	switch(typeof(cultureInfo)) {
		case "string":
			cultureInfo = window.eval("(" + cultureInfo + ")");
		case "object":
			this.CurrentCulture = this._parse(cultureInfo);
			try {
				delete __cultureInfo;
			} catch(e) {
				__cultureInfo = null;
			}
			break;
		default:
			cultureInfo = clone(invariant);
			cultureInfo.name = "en-US";
			cultureInfo.numberFormat.CurrencySymbol = "$";
			var dtf = cultureInfo.dateTimeFormat;
			dtf.FullDatePattern = "dddd, MMMM dd, yyyy h:mm:ss tt";
			dtf.LongDatePattern = "dddd, MMMM dd, yyyy";
			dtf.LongTimePattern = "h:mm:ss tt";
			dtf.ShortDatePattern = "M/d/yyyy";
			dtf.ShortTimePattern = "h:mm tt";
			dtf.YearMonthPattern = "MMMM, yyyy";
			this.CurrentCulture = this._parse(cultureInfo);
			break;
	}
}
});

Sys.CultureInfo._setup();












Type.registerNamespace('Sys.Serialization');

Sys.Serialization.JavaScriptSerializer = function Sys$Serialization$JavaScriptSerializer() {
	/// <summary locid="M:J#Sys.Serialization.JavaScriptSerializer.#ctor" />
	if (arguments.length !== 0) throw Error.parameterCount();
}
Sys.Serialization.JavaScriptSerializer.registerClass('Sys.Serialization.JavaScriptSerializer');

merge(Sys.Serialization.JavaScriptSerializer, {
_esc: {
	charsRegExs: { '"': /\"/g, '\\': /\\/g }, /*"*/
	chars: ['\\', '"'],
	dateRegEx: /(^|[^\\])\"\\\/Date\((-?[0-9]+)(?:[a-zA-Z]|(?:\+|-)[0-9]{4})?\)\\\/\"/g, /* " */
	escapeChars: {'\\':'\\\\', '"':'\\"', "\b":"\\b", "\t":"\\t", "\n":"\\n", "\f":"\\f", "\r":"\\r"},
	escapeRegExG: /[\"\\\x00-\x1F]/g,
	escapeRegEx: /[\"\\\x00-\x1F]/i,
	jsonRegEx: /[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/g,
	jsonStringRegEx: /\"(\\.|[^\"\\])*\"/g /*"*/
},
_init: function() {
	var esc = this._esc,
		toEsc = esc.chars,
		toEscRE = esc.charsRegExs,
		escChars = esc.escapeChars;
	for (var i = 0; i < 32; i++) {
		var c = String.fromCharCode(i);
		toEsc[i+2] = c;
		toEscRE[c] = new RegExp(c, 'g');
		escChars[c] = escChars[c] || ("\\u" + ("000" + i.toString(16)).slice(-4));
	}
	this._load = true;
},
_serializeNumberWithBuilder: function(object, stringBuilder) {
	if (!isFinite(object)) {
		throw Error.invalidOperation(Sys.Res.cannotSerializeNonFiniteNumbers);
	}
	stringBuilder.append(String(object));
},




_serializeStringWithBuilder: function(string, stringBuilder) {
	stringBuilder.append('"');
	var esc = this._esc;
	if (esc.escapeRegEx.test(string)) {
		if (!this._load) {
			this._init();
		}
		if (string.length < 128) {
			string = string.replace(esc.escapeRegExG,
				function(x) { return esc.escapeChars[x]; });
		}
		else {
			for (var i = 0; i < 34; i++) {
				var c = esc.chars[i];
				if (string.indexOf(c) !== -1) {
					var escChar = esc.escapeChars[c];
					string = (isBrowser("Opera") || isBrowser("Firefox")) ?
						string.split(c).join(escChar) :
						string.replace(esc.charsRegExs[c], escChar);
				}
			}
	   }
	}
	stringBuilder.append(string).append('"');
},
_serializeWithBuilder: function(object, stringBuilder, sort, prevObjects) {
	var i;
	switch (typeof object) {
	case 'object':
		if (object) {
			if (prevObjects){
				if (Sys._indexOf(prevObjects, object) !== -1) {
					throw Error.invalidOperation(Sys.Res.cannotSerializeObjectWithCycle);
				}
			}
			else {
				prevObjects = [];
			}
			try {
				prevObjects.push(object);
				if (Number.isInstanceOfType(object)) {
					this._serializeNumberWithBuilder(object, stringBuilder);
				}
				else if (Boolean.isInstanceOfType(object)) {
					stringBuilder.append(object);
				}
				else if (String.isInstanceOfType(object)) {
					this._serializeStringWithBuilder(object, stringBuilder);
				}
				else if (object instanceof Array) {
					stringBuilder.append('[');
					for (i = 0; i < object.length; ++i) {
						if (i) {
							stringBuilder.append(',');
						}
						this._serializeWithBuilder(object[i], stringBuilder, false, prevObjects);
					}
					stringBuilder.append(']');
				}
				else {
					if (Date.isInstanceOfType(object)) {
						stringBuilder.append('"\\/Date(').
							append(object.getTime()).
							append(')\\/"');
						break;
					}

					var properties = [],
						propertyCount = 0;
					for (var name in object) {
						if (name.charAt(0) !== '$') {
							if (name === '__type' && propertyCount) {
								properties[propertyCount++] = properties[0];
								properties[0] = name;
							}
							else {
								properties[propertyCount++] = name;
							}
						}
					}
					if (sort) properties.sort();

					stringBuilder.append('{');
					var needComma;
					for (i=0; i < propertyCount; i++) {
						var prop = properties[i], value = object[prop],
							type = typeof(value);
						if (type !== 'undefined' && type !== 'function') {
							if (needComma) {
								stringBuilder.append(',');
							}
							this._serializeWithBuilder(prop, stringBuilder, sort, prevObjects);
							stringBuilder.append(':');
							this._serializeWithBuilder(value, stringBuilder, sort, prevObjects);
							needComma = true;
						}
					}
				stringBuilder.append('}');
				}
			}
			finally {
				Array.removeAt(prevObjects, prevObjects.length - 1);
			}
		}
		else {
			stringBuilder.append('null');
		}
		break;

	case 'number':
		this._serializeNumberWithBuilder(object, stringBuilder);
		break;

	case 'string':
		this._serializeStringWithBuilder(object, stringBuilder);
		break;

	case 'boolean':
		stringBuilder.append(object);
		break;

	default:
		stringBuilder.append('null');
		break;
	}
}
});

Sys.Serialization.JavaScriptSerializer.serialize = function Sys$Serialization$JavaScriptSerializer$serialize(object) {
	/// <summary locid="M:J#Sys.Serialization.JavaScriptSerializer.serialize" />
	/// <param name="object" mayBeNull="true"></param>
	/// <returns type="String"></returns>

	var stringBuilder = new Sys.StringBuilder();
	Sys.Serialization.JavaScriptSerializer._serializeWithBuilder(object, stringBuilder, false);
	return stringBuilder.toString();
}

Sys.Serialization.JavaScriptSerializer.deserialize = function Sys$Serialization$JavaScriptSerializer$deserialize(data, secure) {
	/// <summary locid="M:J#Sys.Serialization.JavaScriptSerializer.deserialize" />
	/// <param name="data" type="String"></param>
	/// <param name="secure" type="Boolean" optional="true" mayBeNull="true"></param>
	/// <returns></returns>

	if (!data.length) throw Error.argument('data', Sys.Res.cannotDeserializeEmptyString);
	var er, esc = Sys.Serialization.JavaScriptSerializer._esc;
	try {
		var exp = data.replace(esc.dateRegEx, "$1new Date($2)");
		if (secure && esc.jsonRegEx.test(exp.replace(esc.jsonStringRegEx, ''))) throw null;

		return window.eval('(' + exp + ')');
	}
	catch (er) {
		 throw Error.argument('data', Sys.Res.cannotDeserializeInvalidJson);
	}
}





Type.registerNamespace('Sys.UI');

Sys.EventHandlerList = function Sys$EventHandlerList() {
	/// <summary locid="M:J#Sys.EventHandlerList.#ctor" />
	if (arguments.length !== 0) throw Error.parameterCount();
	this._list = {};
}


	function Sys$EventHandlerList$_addHandler(id, handler) {
		Array.add(this._getEvent(id, true), handler);
	}
	function Sys$EventHandlerList$addHandler(id, handler) {
		/// <summary locid="M:J#Sys.EventHandlerList.addHandler" />
		/// <param name="id" type="String"></param>
		/// <param name="handler" type="Function"></param>

		this._addHandler(id, handler);
	}
	function Sys$EventHandlerList$_removeHandler(id, handler) {
		var evt = this._getEvent(id);
		if (!evt) return;
		Array.remove(evt, handler);
	}
	function Sys$EventHandlerList$_removeHandlers(id) {
		if (!id) {
			this._list = {};
		}
		else {
			var evt = this._getEvent(id);
			if (!evt) return;
			evt.length = 0;
		}
	}
	function Sys$EventHandlerList$removeHandler(id, handler) {
		/// <summary locid="M:J#Sys.EventHandlerList.removeHandler" />
		/// <param name="id" type="String"></param>
		/// <param name="handler" type="Function"></param>

		this._removeHandler(id, handler);
	}
	function Sys$EventHandlerList$getHandler(id) {
		/// <summary locid="M:J#Sys.EventHandlerList.getHandler" />
		/// <param name="id" type="String"></param>
		/// <returns type="Function"></returns>

		var evt = this._getEvent(id);
		if (!evt || (evt.length === 0)) return null;
		evt = Array.clone(evt);
		return function(source, args) {
			for (var i = 0, l = evt.length; i < l; i++) {
				evt[i](source, args);
			}
		};
	}
	function Sys$EventHandlerList$_getEvent(id, create) {
		if (!this._list[id]) {
			if (!create) return null;
			this._list[id] = [];
		}
		return this._list[id];
	}
Sys.EventHandlerList.prototype = {
	_addHandler: Sys$EventHandlerList$_addHandler,
	addHandler: Sys$EventHandlerList$addHandler,
	_removeHandler: Sys$EventHandlerList$_removeHandler,
	_removeHandlers: Sys$EventHandlerList$_removeHandlers,
	removeHandler: Sys$EventHandlerList$removeHandler,
	getHandler: Sys$EventHandlerList$getHandler,
	_getEvent: Sys$EventHandlerList$_getEvent
}
Sys.EventHandlerList.registerClass('Sys.EventHandlerList');
Sys.CommandEventArgs = function Sys$CommandEventArgs(commandName, commandArgument, commandSource) {
	/// <summary locid="M:J#Sys.CommandEventArgs.#ctor" />
	/// <param name="commandName" type="String"></param>
	/// <param name="commandArgument" mayBeNull="true"></param>
	/// <param name="commandSource" mayBeNull="true"></param>

	Sys.CommandEventArgs.initializeBase(this);
	this._commandName = commandName;
	this._commandArgument = commandArgument;
	this._commandSource = commandSource;
}




	function Sys$CommandEventArgs$get_commandName() {
		/// <value type="String" locid="P:J#Sys.CommandEventArgs.commandName"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._commandName;
	}
	function Sys$CommandEventArgs$get_commandArgument() {
		/// <value mayBeNull="true" locid="P:J#Sys.CommandEventArgs.commandArgument"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._commandArgument;
	}
	function Sys$CommandEventArgs$get_commandSource() {
		/// <value mayBeNull="true" locid="P:J#Sys.CommandEventArgs.commandSource"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._commandSource;
	}
Sys.CommandEventArgs.prototype = {
	_commandName: null,
	_commandArgument: null,
	_commandSource: null,
	get_commandName: Sys$CommandEventArgs$get_commandName,
	get_commandArgument: Sys$CommandEventArgs$get_commandArgument,
	get_commandSource: Sys$CommandEventArgs$get_commandSource
}
Sys.CommandEventArgs.registerClass("Sys.CommandEventArgs", Sys.CancelEventArgs);
Sys.INotifyPropertyChange = function Sys$INotifyPropertyChange() {
	/// <summary locid="M:J#Sys.INotifyPropertyChange.#ctor" />
	if (arguments.length !== 0) throw Error.parameterCount();
	throw Error.notImplemented();
}

	function Sys$INotifyPropertyChange$add_propertyChanged(handler) {
	/// <summary locid="E:J#Sys.INotifyPropertyChange.propertyChanged" />

		throw Error.notImplemented();
	}
	function Sys$INotifyPropertyChange$remove_propertyChanged(handler) {

		throw Error.notImplemented();
	}
Sys.INotifyPropertyChange.prototype = {
	add_propertyChanged: Sys$INotifyPropertyChange$add_propertyChanged,
	remove_propertyChanged: Sys$INotifyPropertyChange$remove_propertyChanged
}
Sys.INotifyPropertyChange.registerInterface('Sys.INotifyPropertyChange');
Sys.PropertyChangedEventArgs = function Sys$PropertyChangedEventArgs(propertyName) {
	/// <summary locid="M:J#Sys.PropertyChangedEventArgs.#ctor" />
	/// <param name="propertyName" type="String"></param>

	Sys.PropertyChangedEventArgs.initializeBase(this);
	this._propertyName = propertyName;
}
	function Sys$PropertyChangedEventArgs$get_propertyName() {
		/// <value type="String" locid="P:J#Sys.PropertyChangedEventArgs.propertyName"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._propertyName;
	}
Sys.PropertyChangedEventArgs.prototype = {
	get_propertyName: Sys$PropertyChangedEventArgs$get_propertyName
}
Sys.PropertyChangedEventArgs.registerClass('Sys.PropertyChangedEventArgs', Sys.EventArgs);
Sys.INotifyDisposing = function Sys$INotifyDisposing() {
	/// <summary locid="M:J#Sys.INotifyDisposing.#ctor" />
	if (arguments.length !== 0) throw Error.parameterCount();
	throw Error.notImplemented();
}

	function Sys$INotifyDisposing$add_disposing(handler) {
	/// <summary locid="E:J#Sys.INotifyDisposing.disposing" />

		throw Error.notImplemented();
	}
	function Sys$INotifyDisposing$remove_disposing(handler) {

		throw Error.notImplemented();
	}
Sys.INotifyDisposing.prototype = {
	add_disposing: Sys$INotifyDisposing$add_disposing,
	remove_disposing: Sys$INotifyDisposing$remove_disposing
}
Sys.INotifyDisposing.registerInterface("Sys.INotifyDisposing");
Sys.Component = function Sys$Component() {
	/// <summary locid="M:J#Sys.Component.#ctor" />
	if (arguments.length !== 0) throw Error.parameterCount();
	if (Sys.Application) Sys.Application.registerDisposableObject(this);
}

	function Sys$Component$get_isLinkPending() {
		/// <value type="Boolean" locid="P:J#Sys.Component.isLinkPending"></value>
		return !!this._isLinkPending;
	}
	function Sys$Component$set_isLinkPending(value) {
		this._isLinkPending = value;
	}
	function Sys$Component$get_events() {
		/// <value type="Sys.EventHandlerList" locid="P:J#Sys.Component.events"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return Sys.Observer._getContext(this, true).events;
	}
	function Sys$Component$get_id() {
		/// <value type="String" locid="P:J#Sys.Component.id"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._id || null;
	}
	function Sys$Component$set_id(value) {

		if (this._idSet) throw Error.invalidOperation(Sys.Res.componentCantSetIdTwice);
		this._idSet = true;
		var oldId = this.get_id();
		if (oldId && Sys.Application.findComponent(oldId)) throw Error.invalidOperation(Sys.Res.componentCantSetIdAfterAddedToApp);
		this._id = value;
	}
	function Sys$Component$get_isInitialized() {
		/// <value type="Boolean" locid="P:J#Sys.Component.isInitialized"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return !!this._initialized;
	}
	function Sys$Component$get_isUpdating() {
		/// <value type="Boolean" locid="P:J#Sys.Component.isUpdating"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return !!this._updating;
	}
	function Sys$Component$add_disposing(handler) {
		/// <summary locid="E:J#Sys.Component.disposing" />

		this._addHandler("disposing", handler);
	}
	function Sys$Component$remove_disposing(handler) {

		this._removeHandler("disposing", handler);
	}
	function Sys$Component$add_propertyChanged(handler) {
		/// <summary locid="E:J#Sys.Component.propertyChanged" />

		this._addHandler("propertyChanged", handler);
	}
	function Sys$Component$remove_propertyChanged(handler) {

		this._removeHandler("propertyChanged", handler);
	}
	function Sys$Component$_addHandler(eventName, handler) {
		Sys.Observer.addEventHandler(this, eventName, handler);
	}
	function Sys$Component$_removeHandler(eventName, handler) {
		Sys.Observer.removeEventHandler(this, eventName, handler);
	}
	function Sys$Component$beginUpdate() {
		this._updating = true;
	}
	function Sys$Component$dispose() {
		Sys.Observer.raiseEvent(this, "disposing");
		Sys.Observer.clearEventHandlers(this);
		Sys.Application.unregisterDisposableObject(this);
		Sys.Application.removeComponent(this);
		this._updating = this._initialized = this._observerContext = this._isLinkPending = null;
	}
	function Sys$Component$endUpdate() {
		this._updating = false;
		if (!this._initialized) this.initialize();
		this.updated();
	}
	function Sys$Component$initialize() {
		this._initialized = true;
	}
	function Sys$Component$link() {
		this._isLinkPending = false;
	}
	function Sys$Component$raisePropertyChanged(propertyName) {
		/// <summary locid="M:J#Sys.Component.raisePropertyChanged" />
		/// <param name="propertyName" type="String"></param>

		Sys.Observer.raisePropertyChanged(this, propertyName);
	}
	function Sys$Component$updated() {
	}
Sys.Component.prototype = {
	get_events: Sys$Component$get_events,
	get_id: Sys$Component$get_id,
	set_id: Sys$Component$set_id,
	get_isLinkPending: Sys$Component$get_isLinkPending,
	set_isLinkPending: Sys$Component$set_isLinkPending,
	get_isInitialized: Sys$Component$get_isInitialized,
	get_isUpdating: Sys$Component$get_isUpdating,
	add_disposing: Sys$Component$add_disposing,
	remove_disposing: Sys$Component$remove_disposing,
	add_propertyChanged: Sys$Component$add_propertyChanged,
	remove_propertyChanged: Sys$Component$remove_propertyChanged,
	_addHandler: Sys$Component$_addHandler,
	_removeHandler: Sys$Component$_removeHandler,
	beginUpdate: Sys$Component$beginUpdate,
	dispose: Sys$Component$dispose,
	endUpdate: Sys$Component$endUpdate,
	initialize: Sys$Component$initialize,
	raisePropertyChanged: Sys$Component$raisePropertyChanged,
	updated: Sys$Component$updated,
	link: Sys$Component$link
}
Sys.Component.registerClass('Sys.Component', null, Sys.IDisposable, Sys.INotifyPropertyChange, Sys.INotifyDisposing);

Sys.Component._setProperties = function Sys$Component$_setProperties(target, properties) {
	/// <summary locid="M:J#Sys.Component._setProperties" />
	/// <param name="target"></param>
	/// <param name="properties"></param>

	var current;
	var targetType = Object.getType(target);
	var isObject = (targetType === Object) || (targetType === Sys.UI.DomElement);
	var isComponent = Sys.Component.isInstanceOfType(target) && !target.get_isUpdating();
	if (isComponent) target.beginUpdate();
	for (var name in properties) {
		var val = properties[name];
		var getter = isObject ? null : target["get_" + name];
		if (isObject || typeof(getter) !== 'function') {
			var targetVal = target[name];
			if (!val || (typeof(val) !== 'object') || (isObject && !targetVal)) {
				target[name] = val;
			}
			else {
				this._setProperties(targetVal, val);
			}
		}
		else {
			var setter = target["set_" + name];
			if (typeof(setter) === 'function') {
				setter.apply(target, [val]);
			}
			else if (val instanceof Array) {
				current = getter.apply(target);
				if (!(current instanceof Array)) throw new Error.invalidOperation(String.format(Sys.Res.propertyNotAnArray, name));
				for (var i = 0, j = current.length, l= val.length; i < l; i++, j++) {
					current[j] = val[i];
				}
			}
			else if ((typeof(val) === 'object') && (Object.getType(val) === Object)) {
				current = getter.apply(target);
				if ((typeof(current) === 'undefined') || (current === null)) throw new Error.invalidOperation(String.format(Sys.Res.propertyNullOrUndefined, name));
				this._setProperties(current, val);
			}
			else {
				throw new Error.invalidOperation(String.format(Sys.Res.propertyNotWritable, name));
			}
		}
	}
	if (isComponent) target.endUpdate();
}

Sys.Component._setReferences = function Sys$Component$_setReferences(component, references) {
	var reference, refs = {};
	forIn(references, function(id, name) {
		refs[name] = reference = $find(id);
		if (!reference) throw Error.invalidOperation(String.format(Sys.Res.referenceNotFound, id));
	});
	Sys._setProps(component, refs);
}

$create = Sys.Component.create = function Sys$Component$create(type, properties, events, references, element) {
	/// <summary locid="M:J#Sys.Component.create" />
	/// <param name="type" type="Type"></param>
	/// <param name="properties" optional="true" mayBeNull="true"></param>
	/// <param name="events" optional="true" mayBeNull="true"></param>
	/// <param name="references" optional="true" mayBeNull="true"></param>
	/// <param name="element" domElement="true" optional="true" mayBeNull="true"></param>
	/// <returns type="Object"></returns>

	if (type.inheritsFrom(Sys.UI.Behavior) || type.inheritsFrom(Sys.UI.Control)) {
		if (!element) throw Error.argument('element', Sys.Res.createNoDom);
	}
	else if (element) throw Error.argument('element', Sys.Res.createComponentOnDom);
	var component = (element ? new type(element): new type());
	callIf(component, "beginUpdate");
	if (properties) {
		Sys.Component._setProperties(component, properties);
	}
	if (events) {
		for (var name in events) {
			if (!(component["add_" + name] instanceof Function)) throw new Error.invalidOperation(String.format(Sys.Res.undefinedEvent, name));
			if (!(events[name] instanceof Function)) throw new Error.invalidOperation(Sys.Res.eventHandlerNotFunction);
			component["add_" + name](events[name]);
		}
	}
	Sys.Component._register(component, references);
	return component;
}
Sys.Component._register = function Sys$Component$_register(component, references, dontUpdate) {
	var ret;
	if (Sys.Component.isInstanceOfType(component)) {
		ret = true;
		var app = Sys.Application;
		if (component.get_id()) {
			app.addComponent(component);
		}
		if (app.get_isCreatingComponents()) {
			app._createdComponents.push(component);
			if (references) {
				app._addComponentToSecondPass(component, references);
			}
			else if (!dontUpdate) {
				component.endUpdate();
			}
		}
		else {
			if (references) {
				Sys.Component._setReferences(component, references);
			}
			if (!dontUpdate) {
				component.endUpdate();
			}
		}
	}
	return ret;
}

Sys._getComponent = function Sys$_getComponent(found, selector, context) {
	var component = Sys.Application.findComponent(selector);
	if (component) {
		found.push(component);
	}
}

Sys._2Pass = function Sys$_2Pass(callback) {
	var app = Sys.Application,
		useTwoPass = !app.get_isCreatingComponents();
	if (useTwoPass) app.beginCreateComponents();
	foreach(callback, function(c) { c() });
	if (useTwoPass) app.endCreateComponents();
}
Sys.UI.MouseButton = function Sys$UI$MouseButton() {
	/// <summary locid="M:J#Sys.UI.MouseButton.#ctor" />
	/// <field name="leftButton" type="Number" integer="true" static="true" locid="F:J#Sys.UI.MouseButton.leftButton"></field>
	/// <field name="middleButton" type="Number" integer="true" static="true" locid="F:J#Sys.UI.MouseButton.middleButton"></field>
	/// <field name="rightButton" type="Number" integer="true" static="true" locid="F:J#Sys.UI.MouseButton.rightButton"></field>
	if (arguments.length !== 0) throw Error.parameterCount();
	throw Error.notImplemented();
}




Sys.UI.MouseButton.prototype = {
	leftButton: 0,
	middleButton: 1,
	rightButton: 2
}
Sys.UI.MouseButton.registerEnum("Sys.UI.MouseButton");
Sys.UI.Key = function Sys$UI$Key() {
	/// <summary locid="M:J#Sys.UI.Key.#ctor" />
	/// <field name="backspace" type="Number" integer="true" static="true" locid="F:J#Sys.UI.Key.backspace"></field>
	/// <field name="tab" type="Number" integer="true" static="true" locid="F:J#Sys.UI.Key.tab"></field>
	/// <field name="enter" type="Number" integer="true" static="true" locid="F:J#Sys.UI.Key.enter"></field>
	/// <field name="esc" type="Number" integer="true" static="true" locid="F:J#Sys.UI.Key.esc"></field>
	/// <field name="space" type="Number" integer="true" static="true" locid="F:J#Sys.UI.Key.space"></field>
	/// <field name="pageUp" type="Number" integer="true" static="true" locid="F:J#Sys.UI.Key.pageUp"></field>
	/// <field name="pageDown" type="Number" integer="true" static="true" locid="F:J#Sys.UI.Key.pageDown"></field>
	/// <field name="end" type="Number" integer="true" static="true" locid="F:J#Sys.UI.Key.end"></field>
	/// <field name="home" type="Number" integer="true" static="true" locid="F:J#Sys.UI.Key.home"></field>
	/// <field name="left" type="Number" integer="true" static="true" locid="F:J#Sys.UI.Key.left"></field>
	/// <field name="up" type="Number" integer="true" static="true" locid="F:J#Sys.UI.Key.up"></field>
	/// <field name="right" type="Number" integer="true" static="true" locid="F:J#Sys.UI.Key.right"></field>
	/// <field name="down" type="Number" integer="true" static="true" locid="F:J#Sys.UI.Key.down"></field>
	/// <field name="del" type="Number" integer="true" static="true" locid="F:J#Sys.UI.Key.del"></field>
	if (arguments.length !== 0) throw Error.parameterCount();
	throw Error.notImplemented();
}















Sys.UI.Key.prototype = {
	backspace: 8,
	tab: 9,
	enter: 13,
	esc: 27,
	space: 32,
	pageUp: 33,
	pageDown: 34,
	end: 35,
	home: 36,
	left: 37,
	up: 38,
	right: 39,
	down: 40,
	del: 127
}
Sys.UI.Key.registerEnum("Sys.UI.Key");
Sys.UI.Point = function Sys$UI$Point(x, y) {
	/// <summary locid="M:J#Sys.UI.Point.#ctor" />
	/// <param name="x" type="Number" integer="true"></param>
	/// <param name="y" type="Number" integer="true"></param>
	/// <field name="x" type="Number" integer="true" locid="F:J#Sys.UI.Point.x"></field>
	/// <field name="y" type="Number" integer="true" locid="F:J#Sys.UI.Point.y"></field>

	this.x = x;
	this.y = y;
}
Sys.UI.Point.registerClass('Sys.UI.Point');
Sys.UI.Bounds = function Sys$UI$Bounds(x, y, width, height) {
	/// <summary locid="M:J#Sys.UI.Bounds.#ctor" />
	/// <param name="x" type="Number" integer="true"></param>
	/// <param name="y" type="Number" integer="true"></param>
	/// <param name="width" type="Number" integer="true"></param>
	/// <param name="height" type="Number" integer="true"></param>
	/// <field name="x" type="Number" integer="true" locid="F:J#Sys.UI.Bounds.x"></field>
	/// <field name="y" type="Number" integer="true" locid="F:J#Sys.UI.Bounds.y"></field>
	/// <field name="width" type="Number" integer="true" locid="F:J#Sys.UI.Bounds.width"></field>
	/// <field name="height" type="Number" integer="true" locid="F:J#Sys.UI.Bounds.height"></field>

	this.x = x;
	this.y = y;
	this.height = height;
	this.width = width;
}
Sys.UI.Bounds.registerClass('Sys.UI.Bounds');
Sys.UI.DomEvent = function Sys$UI$DomEvent(eventObject) {
	/// <summary locid="M:J#Sys.UI.DomEvent.#ctor" />
	/// <param name="eventObject"></param>
	/// <field name="altKey" type="Boolean" locid="F:J#Sys.UI.DomEvent.altKey"></field>
	/// <field name="button" type="Sys.UI.MouseButton" locid="F:J#Sys.UI.DomEvent.button"></field>
	/// <field name="charCode" type="Number" integer="true" locid="F:J#Sys.UI.DomEvent.charCode"></field>
	/// <field name="clientX" type="Number" integer="true" locid="F:J#Sys.UI.DomEvent.clientX"></field>
	/// <field name="clientY" type="Number" integer="true" locid="F:J#Sys.UI.DomEvent.clientY"></field>
	/// <field name="ctrlKey" type="Boolean" locid="F:J#Sys.UI.DomEvent.ctrlKey"></field>
	/// <field name="keyCode" type="Number" integer="true" locid="F:J#Sys.UI.DomEvent.keyCode"></field>
	/// <field name="offsetX" type="Number" integer="true" locid="F:J#Sys.UI.DomEvent.offsetX"></field>
	/// <field name="offsetY" type="Number" integer="true" locid="F:J#Sys.UI.DomEvent.offsetY"></field>
	/// <field name="screenX" type="Number" integer="true" locid="F:J#Sys.UI.DomEvent.screenX"></field>
	/// <field name="screenY" type="Number" integer="true" locid="F:J#Sys.UI.DomEvent.screenY"></field>
	/// <field name="shiftKey" type="Boolean" locid="F:J#Sys.UI.DomEvent.shiftKey"></field>
	/// <field name="target" locid="F:J#Sys.UI.DomEvent.target"></field>
	/// <field name="type" type="String" locid="F:J#Sys.UI.DomEvent.type"></field>

	var ev = eventObject;
	var etype = this.type = ev.type.toLowerCase();
	this.rawEvent = ev;
	this.altKey = ev.altKey;
	if (typeof(ev.button) !== 'undefined') {
		this.button = (typeof(ev.which) !== 'undefined') ? ev.button :
			(ev.button === 4) ? Sys.UI.MouseButton.middleButton :
			(ev.button === 2) ? Sys.UI.MouseButton.rightButton :
			Sys.UI.MouseButton.leftButton;
	}
	if (etype === 'keypress') {
		this.charCode = ev.charCode || ev.keyCode;
	}
	else if (ev.keyCode && (ev.keyCode === 46)) {
		this.keyCode = 127;
	}
	else {
		this.keyCode = ev.keyCode;
	}
	this.clientX = ev.clientX;
	this.clientY = ev.clientY;
	this.ctrlKey = ev.ctrlKey;
	this.target = ev.target ? ev.target : ev.srcElement;
	if (etype.substr(0, 3) !== 'key') {
		if ((typeof(ev.offsetX) !== 'undefined') && (typeof(ev.offsetY) !== 'undefined')) {
			this.offsetX = ev.offsetX;
			this.offsetY = ev.offsetY;
		}
		else if (this.target && (this.target.nodeType !== 3) && (typeof(ev.clientX) === 'number')) {
			var loc = Sys.UI.DomElement.getLocation(this.target);
			var w = Sys.UI.DomElement._getWindow(this.target);
			this.offsetX = (w.pageXOffset || 0) + ev.clientX - loc.x;
			this.offsetY = (w.pageYOffset || 0) + ev.clientY - loc.y;
		}
	}
	this.screenX = ev.screenX;
	this.screenY = ev.screenY;
	this.shiftKey = ev.shiftKey;
}

	function Sys$UI$DomEvent$preventDefault() {
		/// <summary locid="M:J#Sys.UI.DomEvent.preventDefault" />
		if (arguments.length !== 0) throw Error.parameterCount();
		if (this.rawEvent.preventDefault) {
			this.rawEvent.preventDefault();
		}
		else if (window.event) {
			this.rawEvent.returnValue = false;
		}
	}
	function Sys$UI$DomEvent$stopPropagation() {
		/// <summary locid="M:J#Sys.UI.DomEvent.stopPropagation" />
		if (arguments.length !== 0) throw Error.parameterCount();
		if (this.rawEvent.stopPropagation) {
			this.rawEvent.stopPropagation();
		}
		else if (window.event) {
			this.rawEvent.cancelBubble = true;
		}
	}
Sys.UI.DomEvent.prototype = {
	preventDefault: Sys$UI$DomEvent$preventDefault,
	stopPropagation: Sys$UI$DomEvent$stopPropagation
}
Sys.UI.DomEvent.registerClass('Sys.UI.DomEvent');

var simulatingEvent = false;
$simulateMutationEvent = Sys.UI.DomEvent.simulate = function Sys$UI$DomEvent$simulateMutationEvent(element, eventName, bubbles, cancelable) {
	// Don't bubble the event by default
	if (arguments.length < 3) {
		bubbles = false;
	}

	// Allow calceling the event by default
	if (arguments.length < 4) {
		cancelable = true;
	}
	
	try {
		simulatingEvent = true;
		if (element.dispatchEvent) {
			var evt = document.createEvent("events");
			evt.initEvent(eventName, bubbles, cancelable);
			element.dispatchEvent(evt);
		}
		else if (element.fireEvent) {
			element.fireEvent("on" + eventName);
		}
	}
	finally {
		simulatingEvent = false;
	}
}

function simulateError(e) {
	setTimeout(function () {
		throw e;
	}, 1);
}

$addHandler = Sys.UI.DomEvent.addHandler = function Sys$UI$DomEvent$addHandler(elements, eventName, handler, autoRemove) {
	/// <summary locid="M:J#Sys.UI.DomEvent.addHandler" />
	/// <param name="elements"></param>
	/// <param name="eventName" type="String"></param>
	/// <param name="handler" type="Function"></param>
	/// <param name="autoRemove" type="Boolean" optional="true" mayBeNull="true"></param>

	if (eventName === "error") throw Error.invalidOperation(Sys.Res.addHandlerCantBeUsedForError);
	Sys._queryAll(elements, function(element) {
		if (!element._events) {
			element._events = {};
		}
		var eventCache = element._events[eventName];
		if (!eventCache) {
			element._events[eventName] = eventCache = [];
		}
		var browserHandler;
		if (element.addEventListener) {
			browserHandler = function(e) {
				if (simulatingEvent && Sys.Browser.name === "Firefox") {
					try {
						return handler.call(element, new Sys.UI.DomEvent(e));
					}
					catch (e) {
						simulateError(e);
					}
				}
				else {
					return handler.call(element, new Sys.UI.DomEvent(e));
				}
			}
			element.addEventListener(eventName, browserHandler, false);
		}
		else if (element.attachEvent) {
			browserHandler = function() {
				var ex, ev = {};
				try {ev = Sys.UI.DomElement._getWindow(element).event} catch(ex) {}
				return handler.call(element, new Sys.UI.DomEvent(ev));
			}
			element.attachEvent('on' + eventName, browserHandler);
		}
		eventCache.push({handler: handler, browserHandler: browserHandler, autoRemove: autoRemove });
		if (autoRemove) {
			Sys.UI.DomElement._onDispose(element, Sys.UI.DomEvent._disposeHandlers);
		}
	});
}

Sys.registerPlugin({
	name: "addHandler",
	description: "A cross-browser way to add a DOM event handler to an element.",
	plugin: Sys.UI.DomEvent.addHandler,
	parameters: [
		{name: "elements", description: "The element or text node, or array of elements or text nodes, that exposes the event. You may also pass a DOM selector or array of DOM selectors."},
		{name: "eventName", type: "String", description: "The name of the event. Do not include the 'on' prefix, for example, 'click' instead of 'onclick'."},
		{name: "handler", type: "Function", description: "The event handler to add."},
		{name: "autoRemove", type: "Boolean", description: "Whether the handler should be removed automatically when the element is disposed of, such as when an UpdatePanel refreshes, or Sys.Application.disposeElement is called."}
	]
});

$addHandlers = Sys.UI.DomEvent.addHandlers = function Sys$UI$DomEvent$addHandlers(elements, events, handlerOwner, autoRemove) {
	/// <summary locid="M:J#Sys.UI.DomEvent.addHandlers" />
	/// <param name="elements"></param>
	/// <param name="events" type="Object"></param>
	/// <param name="handlerOwner" optional="true" mayBeNull="true"></param>
	/// <param name="autoRemove" type="Boolean" optional="true" mayBeNull="true"></param>

	Sys._queryAll(elements, function(element) {
		for (var name in events) {
			var handler = events[name];
			if (typeof(handler) !== 'function') throw Error.invalidOperation(Sys.Res.cantAddNonFunctionhandler);
			if (handlerOwner) {
				handler = Function.createDelegate(handlerOwner, handler);
			}
			$addHandler(element, name, handler, autoRemove || false);
		}
	});
}

Sys.registerPlugin({
	name: "addHandlers",
	description: "Adds a list of event handlers to an element. If a handlerOwner is specified, delegates are created with each of the handlers.",
	plugin: Sys.UI.DomEvent.addHandlers,
	parameters: [
		{name: "elements", description: "The element or text node, or array of element or text nodes, that exposes the event. You may also pass a DOM selector or array of DOM selectors."},
		{name: "events", type: "Object", description: "A dictionary of event handlers."},
		{name: "handlerOwner", description: "The owner of the event handlers that will be the this pointer for the delegates that will be created from the handlers."},
		{name: "autoRemove", type: "Boolean", description: "Whether the handler should be removed automatically when the element is disposed of, such as when an UpdatePanel refreshes, or Sys.Application.disposeElement is called."}
	]
});

$clearHandlers = Sys.UI.DomEvent.clearHandlers = function Sys$UI$DomEvent$clearHandlers(elements) {
	/// <summary locid="M:J#Sys.UI.DomEvent.clearHandlers" />
	/// <param name="elements"></param>

	Sys._queryAll(elements, function(element) {
		Sys.UI.DomEvent._clearHandlers(element, false);
	});
}

Sys.registerPlugin({
	name: "clearHandlers",
	description: "Clears all the event handlers that were added to the element or array of elements. You may also pass a DOM selector or array of DOM selectors.",
	plugin: Sys.UI.DomEvent.clearHandlers,
	parameters: [
		{name: "elements", description: "The element or text node, or an array of elements or text nodes."}
	]
});

Sys.UI.DomEvent._clearHandlers = function Sys$UI$DomEvent$_clearHandlers(elements, autoRemoving) {
	Sys._queryAll(elements, function(element) {
		if (element._events) {
			var cache = element._events;
			for (var name in cache) {
				var handlers = cache[name];
				for (var i = handlers.length - 1; i >= 0; i--) {
					var entry = handlers[i];
					if (!autoRemoving || entry.autoRemove) {
						$removeHandler(element, name, entry.handler);
					}
				}
			}
		}
	});
}

Sys.UI.DomEvent._disposeHandlers = function Sys$UI$DomEvent$_disposeHandlers() {
	Sys.UI.DomEvent._clearHandlers(this, true);
}

$removeHandler = Sys.UI.DomEvent.removeHandler = function Sys$UI$DomEvent$removeHandler(elements, eventName, handler) {
	/// <summary locid="M:J#Sys.UI.DomEvent.removeHandler" />
	/// <param name="elements"></param>
	/// <param name="eventName" type="String"></param>
	/// <param name="handler" type="Function"></param>

	Sys.UI.DomEvent._removeHandler(elements, eventName, handler);
}
Sys.UI.DomEvent._removeHandler = function Sys$UI$DomEvent$_removeHandler(elements, eventName, handler) {
	Sys._queryAll(elements, function(element) {
		var browserHandler = null;
		if ((typeof(element._events) !== 'object') || !element._events) {
			// temporary debugging code, should be removed as soon as cause of error is discovered
			if (typeof(console) !== 'undefined' && console.error) {
				console.error("element events does not exist");
				console.error("handler: " + handler.toString());
				console.error(Sys.Res.eventHandlerInvalid);
			}
			return;
		}
		var cache = element._events[eventName];
		if (!(cache instanceof Array)) {
			// temporary debugging code, should be removed as soon as cause of error is discovered
			if (typeof(console) !== 'undefined' && console.error) {
				console.error("cache is not an array: " + cache);
				console.error("handler: " + handler.toString());
				console.error(Sys.Res.eventHandlerInvalid);
			}
			return;
		}
		for (var i = 0, l = cache.length; i < l; i++) {
			if (cache[i].handler === handler) {
				browserHandler = cache[i].browserHandler;
				break;
			}
		}
		if (typeof(browserHandler) !== 'function') {
			// temporary debugging code, should be removed as soon as cause of error is discovered
			if (typeof(console) !== 'undefined' && console.error) {
				console.error("handler event could not be found");
				console.error("handler: " + handler.toString());
				console.error(Sys.Res.eventHandlerInvalid);
			}
			return;
		}
		if (element.removeEventListener) {
			element.removeEventListener(eventName, browserHandler, false);
		}
		else if (element.detachEvent) {
			element.detachEvent('on' + eventName, browserHandler);
		}
		cache.splice(i, 1);

		if (cache.length === 0) {
		delete element._events[eventName];

		for (var prop in element._events) {
			if (element._events.hasOwnProperty(prop)) {
				return;
			}
		}

		element._events = null;
		}
	});
}

Sys.registerPlugin({
	name: "removeHandler",
	description: "A cross-browser way to remove a DOM event handler from an element. You may also pass a DOM selector or array of DOM selectors.",
	plugin: Sys.UI.DomEvent.removeHandler,
	parameters: [
		{name: "elements", description: "The element or text node, or array of elements or text nodes, that exposes the event."},
		{name: "eventName", type: "String", description: "The name of the event. Do not include the 'on' prefix, for example, 'click' instead of 'onclick'."},
		{name: "handler", type: "Function", description: "The event handler to remove."}
	]
});

Sys.UI.DomEvent._ensureDomNode = function Sys$UI$DomEvent$_ensureDomNode(element) {
	if (element && element.tagName && (element.tagName.toUpperCase() === "SCRIPT")) return;
	var doc = element ? (element.ownerDocument || element.document || element) : null;
	if (!element ||
		((typeof(element.document) !== 'object') && (element != doc) && (typeof(element.nodeType) !== 'number'))) {
		throw Error.argument("element", Sys.Res.argumentDomNode);
	}
}

Sys._queryAll = function Sys$_queryAll(selector, callback) {
	var elements = selector;
	if (typeof(selector) === "string") {
		elements = Sys.query(selector);
	}
	Sys._foreach(elements, function(selector) {
		var elements = selector;
		if (typeof(selector) === "string") {
			elements = Sys.query(selector);
		}
		Sys._foreach(elements, function(element) {
			Sys.UI.DomEvent._ensureDomNode(element);
			var nodeType = element.nodeType;
			if (nodeType === 3 || nodeType === 2 || nodeType === 8) return;
			callback(element);
		});
	});
}
Sys.UI.DomElement = function Sys$UI$DomElement() {
	/// <summary locid="M:J#Sys.UI.DomElement.#ctor" />
	if (arguments.length !== 0) throw Error.parameterCount();
	throw Error.notImplemented();
}
Sys.UI.DomElement.registerClass('Sys.UI.DomElement');

Sys.UI.DomElement.addCssClass = function Sys$UI$DomElement$addCssClass(element, className) {
	/// <summary locid="M:J#Sys.UI.DomElement.addCssClass" />
	/// <param name="element" domElement="true"></param>
	/// <param name="className" type="String"></param>

	if (!Sys.UI.DomElement.containsCssClass(element, className)) {
		if (element.className === '') {
			element.className = className;
		}
		else {
			element.className += ' ' + className;
		}
	}
}

Sys.UI.DomElement.containsCssClass = function Sys$UI$DomElement$containsCssClass(element, className) {
	/// <summary locid="M:J#Sys.UI.DomElement.containsCssClass" />
	/// <param name="element" domElement="true"></param>
	/// <param name="className" type="String"></param>
	/// <returns type="Boolean"></returns>

	return Array.contains(element.className.split(' '), className);
}

Sys.UI.DomElement.getBounds = function Sys$UI$DomElement$getBounds(element) {
	/// <summary locid="M:J#Sys.UI.DomElement.getBounds" />
	/// <param name="element" domElement="true"></param>
	/// <returns type="Sys.UI.Bounds"></returns>

	var offset = Sys.UI.DomElement.getLocation(element);

	return new Sys.UI.Bounds(offset.x, offset.y, element.offsetWidth || 0, element.offsetHeight || 0);
}

$get = Sys.UI.DomElement.getElementById = function Sys$UI$DomElement$getElementById(id, element) {
	/// <summary locid="M:J#Sys.UI.DomElement.getElementById" />
	/// <param name="id" type="String"></param>
	/// <param name="element" domElement="true" optional="true" mayBeNull="true"></param>
	/// <returns domElement="true" mayBeNull="true"></returns>

	return Sys.get("#" + id, element || null);
}

if (document.documentElement.getBoundingClientRect) {
	Sys.UI.DomElement.getLocation = function Sys$UI$DomElement$getLocation(element) {
		/// <summary locid="M:J#Sys.UI.DomElement.getLocation" />
		/// <param name="element" domElement="true"></param>
		/// <returns type="Sys.UI.Point"></returns>

		if (element.self || element.nodeType === 9 ||
			(element === document.documentElement) ||
			(element.parentNode === element.ownerDocument.documentElement)) {
			return new Sys.UI.Point(0, 0);
		}
		var clientRect = element.getBoundingClientRect();
		if (!clientRect) {
			return new Sys.UI.Point(0,0);
		}
		var ex, documentElement = element.ownerDocument.documentElement,
			offsetX = Math.round(clientRect.left) + documentElement.scrollLeft,
			offsetY = Math.round(clientRect.top) + documentElement.scrollTop;
		if (isBrowser("InternetExplorer")) {
			try {
				var f = element.ownerDocument.parentWindow.frameElement || null;
				if (f) {
					var offset = (f.frameBorder === "0" || f.frameBorder === "no") ? 2 : 0;
					offsetX += offset;
					offsetY += offset;
				}
			}
			catch(ex) {
			}
			if (Sys.Browser.version === 7 && !document.documentMode) {
				var body = document.body,
					rect = body.getBoundingClientRect(),
					zoom = (rect.right-rect.left) / body.clientWidth;
				zoom = Math.round(zoom * 100);
				zoom = (zoom - zoom % 5) / 100;
				if (!isNaN(zoom) && (zoom !== 1)) {
					offsetX = Math.round(offsetX / zoom);
					offsetY = Math.round(offsetY / zoom);
				}
			}
			if ((document.documentMode || 0) < 8) {
				offsetX -= documentElement.clientLeft;
				offsetY -= documentElement.clientTop;
			}
		}
		return new Sys.UI.Point(offsetX, offsetY);
	}
}
else if (isBrowser("Safari")) {
	Sys.UI.DomElement.getLocation = function Sys$UI$DomElement$getLocation(element) {
		/// <summary locid="M:J#Sys.UI.DomElement.getLocation" />
		/// <param name="element" domElement="true"></param>
		/// <returns type="Sys.UI.Point"></returns>

		if ((element.window && (element.window === element)) || element.nodeType === 9) return new Sys.UI.Point(0,0);

		var offsetX = 0, offsetY = 0,
			parent,
			previous = null,
			previousStyle = null,
			currentStyle;
		for (parent = element; parent; previous = parent, previousStyle = currentStyle, parent = parent.offsetParent) {
			currentStyle = Sys.UI.DomElement._getCurrentStyle(parent);
			var tagName = parent.tagName ? parent.tagName.toUpperCase() : null;

			if ((parent.offsetLeft || parent.offsetTop) &&
				((tagName !== "BODY") || (!previousStyle || previousStyle.position !== "absolute"))) {
				offsetX += parent.offsetLeft;
				offsetY += parent.offsetTop;
			}

			if (previous && Sys.Browser.version >= 3) {
				offsetX += parseInt(currentStyle.borderLeftWidth);
				offsetY += parseInt(currentStyle.borderTopWidth);
			}
		}

		currentStyle = Sys.UI.DomElement._getCurrentStyle(element);
		var elementPosition = currentStyle ? currentStyle.position : null;
		if (!elementPosition || (elementPosition !== "absolute")) {
			for (parent = element.parentNode; parent; parent = parent.parentNode) {
				tagName = parent.tagName ? parent.tagName.toUpperCase() : null;

				if ((tagName !== "BODY") && (tagName !== "HTML") && (parent.scrollLeft || parent.scrollTop)) {
					offsetX -= (parent.scrollLeft || 0);
					offsetY -= (parent.scrollTop || 0);
				}
				currentStyle = Sys.UI.DomElement._getCurrentStyle(parent);
				var parentPosition = currentStyle ? currentStyle.position : null;

				if (parentPosition && (parentPosition === "absolute")) break;
			}
		}
		return new Sys.UI.Point(offsetX, offsetY);
	}
}
else {
	Sys.UI.DomElement.getLocation = function Sys$UI$DomElement$getLocation(element) {
		/// <summary locid="M:J#Sys.UI.DomElement.getLocation" />
		/// <param name="element" domElement="true"></param>
		/// <returns type="Sys.UI.Point"></returns>

		if ((element.window && (element.window === element)) || element.nodeType === 9) return new Sys.UI.Point(0,0);

		var offsetX = 0, offsetY = 0,
			parent,
			previous = null,
			previousStyle = null,
			currentStyle = null;
		for (parent = element; parent; previous = parent, previousStyle = currentStyle, parent = parent.offsetParent) {
			var tagName = parent.tagName ? parent.tagName.toUpperCase() : null;
			currentStyle = Sys.UI.DomElement._getCurrentStyle(parent);

			if ((parent.offsetLeft || parent.offsetTop) &&
				!((tagName === "BODY") &&
				(!previousStyle || previousStyle.position !== "absolute"))) {

				offsetX += parent.offsetLeft;
				offsetY += parent.offsetTop;
			}

			if (previous !== null && currentStyle) {
				if ((tagName !== "TABLE") && (tagName !== "TD") && (tagName !== "HTML")) {
					offsetX += parseInt(currentStyle.borderLeftWidth) || 0;
					offsetY += parseInt(currentStyle.borderTopWidth) || 0;
				}
				if (tagName === "TABLE" &&
					(currentStyle.position === "relative" || currentStyle.position === "absolute")) {
					offsetX += parseInt(currentStyle.marginLeft) || 0;
					offsetY += parseInt(currentStyle.marginTop) || 0;
				}
			}
		}

		currentStyle = Sys.UI.DomElement._getCurrentStyle(element);
		var elementPosition = currentStyle ? currentStyle.position : null;
		if (!elementPosition || (elementPosition !== "absolute")) {
			for (parent = element.parentNode; parent; parent = parent.parentNode) {
				tagName = parent.tagName ? parent.tagName.toUpperCase() : null;

				if ((tagName !== "BODY") && (tagName !== "HTML") && (parent.scrollLeft || parent.scrollTop)) {

					offsetX -= (parent.scrollLeft || 0);
					offsetY -= (parent.scrollTop || 0);

					currentStyle = Sys.UI.DomElement._getCurrentStyle(parent);
					if (currentStyle) {
						offsetX += parseInt(currentStyle.borderLeftWidth) || 0;
						offsetY += parseInt(currentStyle.borderTopWidth) || 0;
					}
				}
			}
		}
		return new Sys.UI.Point(offsetX, offsetY);
	}
}

Sys.UI.DomElement.isDomElement = function Sys$UI$DomElement$isDomElement(obj) {
	/// <summary locid="M:J#Sys.UI.DomElement.isDomElement" />
	/// <param name="obj"></param>
	/// <returns type="Boolean"></returns>

	return Sys._isDomElement(obj);
}

Sys.UI.DomElement.removeCssClass = function Sys$UI$DomElement$removeCssClass(element, className) {
	/// <summary locid="M:J#Sys.UI.DomElement.removeCssClass" />
	/// <param name="element" domElement="true"></param>
	/// <param name="className" type="String"></param>

	var currentClassName = ' ' + element.className + ' ';
	var index = currentClassName.indexOf(' ' + className + ' ');
	if (index >= 0) {
		element.className = (currentClassName.substr(0, index) + ' ' +
			currentClassName.substring(index + className.length + 1, currentClassName.length)).trim();
	}
}

Sys.UI.DomElement.resolveElement = function Sys$UI$DomElement$resolveElement(elementOrElementId, containerElement) {
	/// <summary locid="M:J#Sys.UI.DomElement.resolveElement" />
	/// <param name="elementOrElementId" mayBeNull="true"></param>
	/// <param name="containerElement" domElement="true" optional="true" mayBeNull="true"></param>
	/// <returns domElement="true"></returns>

	var el = elementOrElementId;
	if (!el) return null;
	if (typeof(el) === "string") {
		el = Sys.get("#" + el, containerElement);
		if (!el) {
			throw Error.argument("elementOrElementId", String.format(Sys.Res.elementNotFound, elementOrElementId));
		}
	}
	else if(!Sys.UI.DomElement.isDomElement(el)) {
		throw Error.argument("elementOrElementId", Sys.Res.expectedElementOrId);
	}
	return el;
}

Sys.UI.DomElement.raiseBubbleEvent = function Sys$UI$DomElement$raiseBubbleEvent(source, args) {
	/// <summary locid="M:J#Sys.UI.DomElement.raiseBubbleEvent" />
	/// <param name="source" domElement="true"></param>
	/// <param name="args" type="Sys.EventArgs"></param>

	var target = source;
	while (target) {
		var control = target.control;
		if (control && control.onBubbleEvent && control.raiseBubbleEvent) {
			if (!control.onBubbleEvent(source, args)) {
				control._raiseBubbleEvent(source, args);
			}
			return;
		}
		target = target.parentNode;
	}
}

Sys.UI.DomElement._ensureGet = function Sys$UI$DomElement$_ensureGet(selector, context, arg) {
	var ret = Sys.get(selector, context);
	if (!ret && typeof(selector) === "string") {
		throw Error.invalidOperation(String.format(Sys.Res.selectorNotFound, selector));
	}
	else if (ret && !this.isDomElement(ret)) {
		throw Error.invalidOperation(String.format(Sys.Res.expectedDomElementOrSelector, arg));
	}
	return ret;
}

Sys.UI.DomElement.setLocation = function Sys$UI$DomElement$setLocation(element, x, y) {
	/// <summary locid="M:J#Sys.UI.DomElement.setLocation" />
	/// <param name="element" domElement="true"></param>
	/// <param name="x" type="Number" integer="true"></param>
	/// <param name="y" type="Number" integer="true"></param>

	var style = element.style;
	style.position = 'absolute';
	style.left = x + "px";
	style.top = y + "px";
}

Sys.UI.DomElement.toggleCssClass = function Sys$UI$DomElement$toggleCssClass(element, className) {
	/// <summary locid="M:J#Sys.UI.DomElement.toggleCssClass" />
	/// <param name="element" domElement="true"></param>
	/// <param name="className" type="String"></param>

	if (Sys.UI.DomElement.containsCssClass(element, className)) {
		Sys.UI.DomElement.removeCssClass(element, className);
	}
	else {
		Sys.UI.DomElement.addCssClass(element, className);
	}
}

Sys.UI.DomElement.getVisibilityMode = function Sys$UI$DomElement$getVisibilityMode(element) {
	/// <summary locid="M:J#Sys.UI.DomElement.getVisibilityMode" />
	/// <param name="element" domElement="true"></param>
	/// <returns type="Sys.UI.VisibilityMode"></returns>

	return (element._visibilityMode === Sys.UI.VisibilityMode.hide) ?
		Sys.UI.VisibilityMode.hide :
		Sys.UI.VisibilityMode.collapse;
}
Sys.UI.DomElement.setVisibilityMode = function Sys$UI$DomElement$setVisibilityMode(element, value) {
	/// <summary locid="M:J#Sys.UI.DomElement.setVisibilityMode" />
	/// <param name="element" domElement="true"></param>
	/// <param name="value" type="Sys.UI.VisibilityMode"></param>

	Sys.UI.DomElement._ensureOldDisplayMode(element);
	if (element._visibilityMode !== value) {
		element._visibilityMode = value;
		if (Sys.UI.DomElement.getVisible(element) === false) {
			if (element._visibilityMode === Sys.UI.VisibilityMode.hide) {
				element.style.display = element._oldDisplayMode;
			}
			else {
				element.style.display = 'none';
			}
		}
		element._visibilityMode = value;
	}
}

Sys.UI.DomElement.getVisible = function Sys$UI$DomElement$getVisible(element) {
	/// <summary locid="M:J#Sys.UI.DomElement.getVisible" />
	/// <param name="element" domElement="true"></param>
	/// <returns type="Boolean"></returns>

	var style = element.currentStyle || Sys.UI.DomElement._getCurrentStyle(element);
	if (!style) return true;
	return (style.visibility !== 'hidden') && (style.display !== 'none');
}
Sys.UI.DomElement.setVisible = function Sys$UI$DomElement$setVisible(element, value, fn) {
	/// <summary locid="M:J#Sys.UI.DomElement.setVisible" />
	/// <param name="element" domElement="true"></param>
	/// <param name="value" type="Boolean"></param>
	/// <param name="fn" type="Function"></param>

	var isInitializing = false;
	if (typeof element._lastVisibility === 'undefined') {
		isInitializing = true;
	}

	element._lastVisibility = value;

	if (value !== Sys.UI.DomElement.getVisible(element)) {
		Sys.UI.DomElement._ensureOldDisplayMode(element);

		if (fn) {
			fn(element, value, isInitializing, element._oldDisplayMode);
		}
		else {
			element.style.visibility = value ? 'visible' : 'hidden';
			if (value || (element._visibilityMode === Sys.UI.VisibilityMode.hide)) {
				element.style.display = element._oldDisplayMode;
			}
			else {
				element.style.display = 'none';
			}
		}
	}
}

Sys.UI.DomElement.setCommand = function Sys$UI$DomElement$setCommand(commandSource, commandName, commandArgument, commandTarget) {
	/// <summary locid="M:J#Sys.UI.DomElement.setCommand" />
	/// <param name="commandSource"></param>
	/// <param name="commandName" type="String" mayBeNull="true"></param>
	/// <param name="commandArgument" mayBeNull="true" optional="true"></param>
	/// <param name="commandTarget" optional="true" mayBeNull="true"></param>

	Sys.UI.DomEvent.addHandler(commandSource, 'click', function() {
		var source = commandTarget || this;
		Sys.UI.DomElement.raiseBubbleEvent(source, new Sys.CommandEventArgs(commandName, commandArgument, this));
	}, true
);
}

Sys.registerPlugin({
	name: "setCommand",
	plugin: Sys.UI.DomElement.setCommand
});

Sys.UI.DomElement._ensureOldDisplayMode = function Sys$UI$DomElement$_ensureOldDisplayMode(element) {
	if (!element._oldDisplayMode) {
		var style = element.currentStyle || Sys.UI.DomElement._getCurrentStyle(element);
		element._oldDisplayMode = style ? style.display : null;
		if (!element._oldDisplayMode || element._oldDisplayMode === 'none') {
			switch(element.tagName.toUpperCase()) {
				case 'DIV': case 'P': case 'ADDRESS': case 'BLOCKQUOTE': case 'BODY': case 'COL':
				case 'COLGROUP': case 'DD': case 'DL': case 'DT': case 'FIELDSET': case 'FORM':
				case 'H1': case 'H2': case 'H3': case 'H4': case 'H5': case 'H6': case 'HR':
				case 'IFRAME': case 'LEGEND': case 'OL': case 'PRE': case 'TABLE': case 'TD':
				case 'TH': case 'TR': case 'UL':
					element._oldDisplayMode = 'block';
					break;
				case 'LI':
					element._oldDisplayMode = 'list-item';
					break;
				default:
					element._oldDisplayMode = 'inline';
			}
		}
	}
}

Sys.UI.DomElement._getWindow = function Sys$UI$DomElement$_getWindow(element) {
	var doc = element.ownerDocument || element.document || element;
	return doc.defaultView || doc.parentWindow;
}

Sys.UI.DomElement._getCurrentStyle = function Sys$UI$DomElement$_getCurrentStyle(element) {
	if (element.nodeType === 3) return null;
	var w = Sys.UI.DomElement._getWindow(element);
	if (element.documentElement) element = element.documentElement;
	var computedStyle = (w && (element !== w) && w.getComputedStyle) ?
		w.getComputedStyle(element, null) :
		element.currentStyle || element.style;
	if (!computedStyle && isBrowser("Safari") && element.style) {
		var oldDisplay = element.style.display;
		var oldPosition = element.style.position;
		element.style.position = 'absolute';
		element.style.display = 'block';
		var style = w.getComputedStyle(element, null);
		element.style.display = oldDisplay;
		element.style.position = oldPosition;
		computedStyle = {};
		for (var n in style) {
			computedStyle[n] = style[n];
		}
		computedStyle.display = 'none';
	}
	return computedStyle;
}

Sys.UI.DomElement._onDispose = function Sys$UI$DomElement$_onDispose(element, fn) {
	var queue, d = element.dispose;
	if (d !== Sys.UI.DomElement._dispose) {
		element.dispose = Sys.UI.DomElement._dispose;
		element.__msajaxdispose = queue = [];
		if (typeof(d) === "function") {
			queue.push(d);
		}
	}
	else {
		queue = element.__msajaxdispose;
	}
	queue.push(fn);
}

Sys.UI.DomElement._dispose = function Sys$UI$DomElement$_dispose() {
	var queue = this.__msajaxdispose;
	if (queue) {
		for (var i = 0, l = queue.length; i < l; i++) {
			queue[i].apply(this);
		}
	}
	if (this.control && typeof(this.control.dispose) === "function") {
		this.control.dispose();
	}
	this.__msajaxdispose = null;
	this.dispose = null;
}
Sys.IContainer = function Sys$IContainer() {
	throw Error.notImplemented();
}

	function Sys$IContainer$addComponent(component) {
		/// <summary locid="M:J#Sys.IContainer.addComponent" />
		/// <param name="component" type="Sys.Component"></param>

		throw Error.notImplemented();
	}
	function Sys$IContainer$removeComponent(component) {
		/// <summary locid="M:J#Sys.IContainer.removeComponent" />
		/// <param name="component" type="Sys.Component"></param>

		throw Error.notImplemented();
	}
	function Sys$IContainer$findComponent(id) {
		/// <summary locid="M:J#Sys.IContainer.findComponent" />
		/// <param name="id" type="String"></param>
		/// <returns type="Sys.Component"></returns>

		throw Error.notImplemented();
	}
	function Sys$IContainer$getComponents() {
		/// <summary locid="M:J#Sys.IContainer.getComponents" />
		/// <returns type="Array" elementType="Sys.Component"></returns>
		if (arguments.length !== 0) throw Error.parameterCount();
		throw Error.notImplemented();
	}
Sys.IContainer.prototype = {
	addComponent: Sys$IContainer$addComponent,
	removeComponent: Sys$IContainer$removeComponent,
	findComponent: Sys$IContainer$findComponent,
	getComponents: Sys$IContainer$getComponents
}
Sys.IContainer.registerInterface("Sys.IContainer");

Sys.ApplicationLoadEventArgs = function Sys$ApplicationLoadEventArgs(components, isPartialLoad) {
	/// <summary locid="M:J#Sys.ApplicationLoadEventArgs.#ctor" />
	/// <param name="components" type="Array" elementType="Sys.Component"></param>
	/// <param name="isPartialLoad" type="Boolean"></param>

	Sys.ApplicationLoadEventArgs.initializeBase(this);
	this._components = components;
	this._isPartialLoad = isPartialLoad;
}
	function Sys$ApplicationLoadEventArgs$get_components() {
		/// <value type="Array" elementType="Sys.Component" locid="P:J#Sys.ApplicationLoadEventArgs.components"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._components;
	}
	function Sys$ApplicationLoadEventArgs$get_isPartialLoad() {
		/// <value type="Boolean" locid="P:J#Sys.ApplicationLoadEventArgs.isPartialLoad"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._isPartialLoad;
	}
Sys.ApplicationLoadEventArgs.prototype = {
	get_components: Sys$ApplicationLoadEventArgs$get_components,
	get_isPartialLoad: Sys$ApplicationLoadEventArgs$get_isPartialLoad
}
Sys.ApplicationLoadEventArgs.registerClass('Sys.ApplicationLoadEventArgs', Sys.EventArgs);
Sys._Application = function Sys$_Application() {
	/// <summary locid="M:J#Sys.Application.#ctor" />
	if (arguments.length !== 0) throw Error.parameterCount();
	Sys._Application.initializeBase(this);

	this._disposableObjects = [];
	this._components = {};
	this._createdComponents = [];
	this._secondPassComponents = [];

	this._unloadHandlerDelegate = Function.createDelegate(this, this._unloadHandler);
	Sys.UI.DomEvent.addHandler(window, "unload", this._unloadHandlerDelegate);
}



	function Sys$_Application$get_isCreatingComponents() {
		/// <value type="Boolean" locid="P:J#Sys.Application.isCreatingComponents"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return !!this._creatingComponents;
	}
	function Sys$_Application$get_isDisposing() {
		/// <value type="Boolean" locid="P:J#Sys.Application.isDisposing"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return !!this._disposing;
	}
	function Sys$_Application$add_init(handler) {
		/// <summary locid="E:J#Sys.Application.init" />

		if (this._initialized) {
			handler(this, Sys.EventArgs.Empty);
		}
		else {
			this._addHandler("init", handler);
		}
	}
	function Sys$_Application$remove_init(handler) {

		this._removeHandler("init", handler);
	}
	function Sys$_Application$add_load(handler) {
		/// <summary locid="E:J#Sys.Application.load" />

		this._addHandler("load", handler);
	}
	function Sys$_Application$remove_load(handler) {

		this._removeHandler("load", handler);
	}
	function Sys$_Application$add_unload(handler) {
		/// <summary locid="E:J#Sys.Application.unload" />

		this._addHandler("unload", handler);
	}
	function Sys$_Application$remove_unload(handler) {

		this._removeHandler("unload", handler);
	}
	function Sys$_Application$addComponent(component) {
		/// <summary locid="M:J#Sys.Application.addComponent" />
		/// <param name="component" type="Sys.Component"></param>

		var id = component.get_id();
		if (!id) throw Error.invalidOperation(Sys.Res.cantAddWithoutId);
		if (typeof(this._components[id]) !== 'undefined') throw Error.invalidOperation(String.format(Sys.Res.appDuplicateComponent, id));
		this._components[id] = component;
	}
	function Sys$_Application$beginCreateComponents() {
		/// <summary locid="M:J#Sys.Application.beginCreateComponents" />
		if (arguments.length !== 0) throw Error.parameterCount();
		this._creatingComponents = true;
	}
	function Sys$_Application$dispose() {
		/// <summary locid="M:J#Sys.Application.dispose" />
		if (arguments.length !== 0) throw Error.parameterCount();
		if (!this._disposing) {
			this._disposing = true;
			if (this._timerCookie) {
				window.clearTimeout(this._timerCookie);
				delete this._timerCookie;
			}
			if (this._endRequestHandler) {
				Sys.WebForms.PageRequestManager.getInstance().remove_endRequest(this._endRequestHandler);
				delete this._endRequestHandler;
			}
			if (this._beginRequestHandler) {
				Sys.WebForms.PageRequestManager.getInstance().remove_beginRequest(this._beginRequestHandler);
				delete this._beginRequestHandler;
			}
			if (window.pageUnload) {
				window.pageUnload(this, Sys.EventArgs.Empty);
			}
			Sys.Observer.raiseEvent(this, "unload");
			var disposableObjects = Array.clone(this._disposableObjects);
			for (var i = 0, l = disposableObjects.length; i < l; i++) {
				var object = disposableObjects[i];
				if (typeof(object) !== "undefined") {
					object.dispose();
					delete object.__msdisposeindex;
				}
			}
			this._disposableObjects.length = 0;

			Sys.UI.DomEvent.removeHandler(window, "unload", this._unloadHandlerDelegate);

			if (Sys._ScriptLoader) {
				var sl = Sys._ScriptLoader.getInstance();
				if (sl) {
					sl.dispose();
				}
			}

			Sys._Application.callBaseMethod(this, 'dispose');
		}
	}
	function Sys$_Application$disposeElement(element, childNodesOnly) {
		/// <summary locid="M:J#Sys._Application.disposeElement" />
		/// <param name="element"></param>
		/// <param name="childNodesOnly" type="Boolean"></param>

		if (element.nodeType === 1) {
			var d, c, i, list,
				allElements = element.getElementsByTagName("*"),
				length = allElements.length,
				children = new Array(length);
			for (i = 0; i < length; i++) {
				children[i] = allElements[i];
			}
			for (i = length - 1; i >= 0; i--) {
				var child = children[i];
				d = child.dispose;
				if (d && typeof(d) === "function") {
					child.dispose();
					child.dispose = null;
					child.__msajaxdispose = null;
				}
				else {
					c = child.control;
					if (c && typeof(c.dispose) === "function") {
						c.dispose();
					}
				}
				list = child._behaviors;
				if (list) {
					this._disposeComponents(list);
				}
				list = child._components;
				if (list) {
					this._disposeComponents(list);
					child._components = null;
				}
			}
			if (!childNodesOnly) {
				d = element.dispose;
				if (d && typeof(d) === "function") {
					element.dispose();
					element.dispose = null;
					element.__msajaxdispose = null;
				}
				else {
					c = element.control;
					if (c && typeof(c.dispose) === "function") {
						c.dispose();
					}
				}
				list = element._behaviors;
				if (list) {
					this._disposeComponents(list);
				}
				list = element._components;
				if (list) {
					this._disposeComponents(list);
					element._components = null;
				}
			}
		}
	}
	function Sys$_Application$endCreateComponents() {
		/// <summary locid="M:J#Sys.Application.endCreateComponents" />
		if (arguments.length !== 0) throw Error.parameterCount();
		var components = this._secondPassComponents;
		for (var i = 0, l = components.length; i < l; i++) {
			var entry = components[i],
				component = entry.component;
			Sys.Component._setReferences(component, entry.references);
			component.endUpdate();
		}
		this._secondPassComponents = [];
		this._creatingComponents = false;
	}
	function Sys$_Application$findComponent(id, parent) {
		/// <summary locid="M:J#Sys.Application.findComponent" />
		/// <param name="id" type="String"></param>
		/// <param name="parent" optional="true" mayBeNull="true"></param>
		/// <returns type="Sys.Component" mayBeNull="true"></returns>

		return (parent ?
			((Sys.IContainer.isInstanceOfType(parent)) ?
				parent.findComponent(id) :
				parent[id] || null) :
			Sys.Application._components[id] || null);
	}
	function Sys$_Application$getComponents() {
		/// <summary locid="M:J#Sys.Application.getComponents" />
		/// <returns type="Array" elementType="Sys.Component"></returns>
		if (arguments.length !== 0) throw Error.parameterCount();
		var res = [];
		var components = this._components;
		for (var name in components) {
			if (components.hasOwnProperty(name)) {
				res.push(components[name]);
			}
		}
		return res;
	}
	function Sys$_Application$initialize() {
		/// <summary locid="M:J#Sys.Application.initialize" />
		if (arguments.length !== 0) throw Error.parameterCount();
		window.setTimeout(Function.createDelegate(this, this._doInitialize), 0);
	}
	function Sys$_Application$_doInitialize() {
		if(!this.get_isInitialized() && !this._disposing) {
			Sys._Application.callBaseMethod(this, 'initialize');
			this._raiseInit();
			if (this.get_stateString) {
				if (Sys.WebForms && Sys.WebForms.PageRequestManager) {
					this._beginRequestHandler = Function.createDelegate(this, this._onPageRequestManagerBeginRequest);
					Sys.WebForms.PageRequestManager.getInstance().add_beginRequest(this._beginRequestHandler);
					this._endRequestHandler = Function.createDelegate(this, this._onPageRequestManagerEndRequest);
					Sys.WebForms.PageRequestManager.getInstance().add_endRequest(this._endRequestHandler);
				}
				var loadedEntry = this.get_stateString();
				if (loadedEntry !== this._currentEntry) {
					this._navigate(loadedEntry);
				}
				else {
					this._ensureHistory();
				}
			}
			this.raiseLoad();
		}
	}
	function Sys$_Application$notifyScriptLoaded() {
		/// <summary locid="M:J#Sys.Application.notifyScriptLoaded" />
		if (arguments.length !== 0) throw Error.parameterCount();
	}
	function Sys$_Application$registerDisposableObject(object) {
		/// <summary locid="M:J#Sys.Application.registerDisposableObject" />
		/// <param name="object" type="Sys.IDisposable"></param>

		if (!this._disposing) {
			var objects = this._disposableObjects,
				i = objects.length;
			objects[i] = object;
			object.__msdisposeindex = i;
		}
	}
	function Sys$_Application$raiseLoad() {
		/// <summary locid="M:J#Sys.Application.raiseLoad" />
		if (arguments.length !== 0) throw Error.parameterCount();
		var args = new Sys.ApplicationLoadEventArgs(Array.clone(this._createdComponents), !!this._loaded);
		this._loaded = true;
		Sys.Observer.raiseEvent(this, "load", args);
		if (window.pageLoad) {
			window.pageLoad(this, args);
		}
		this._createdComponents = [];
	}
	function Sys$_Application$removeComponent(component) {
		/// <summary locid="M:J#Sys.Application.removeComponent" />
		/// <param name="component" type="Sys.Component"></param>

		var id = component.get_id();
		if (id) delete this._components[id];
	}
	function Sys$_Application$unregisterDisposableObject(object) {
		/// <summary locid="M:J#Sys.Application.unregisterDisposableObject" />
		/// <param name="object" type="Sys.IDisposable"></param>

		if (!this._disposing) {
			var i = object.__msdisposeindex;
			if (typeof(i) === "number") {
				var disposableObjects = this._disposableObjects;
				delete disposableObjects[i];
				delete object.__msdisposeindex;
				if (++this._deleteCount > 1000) {
					var newArray = [];
					for (var j = 0, l = disposableObjects.length; j < l; j++) {
						object = disposableObjects[j];
						if (typeof(object) !== "undefined") {
							object.__msdisposeindex = newArray.length;
							newArray.push(object);
						}
					}
					this._disposableObjects = newArray;
					this._deleteCount = 0;
				}
			}
		}
	}
	function Sys$_Application$_addComponentToSecondPass(component, references) {
		this._secondPassComponents.push({component: component, references: references});
	}
	function Sys$_Application$_disposeComponents(list) {
		if (list) {
			for (var i = list.length - 1; i >= 0; i--) {
				var item = list[i];
				if (typeof(item.dispose) === "function") {
					item.dispose();
				}
			}
		}
	}
	function Sys$_Application$_raiseInit() {
		this.beginCreateComponents();
		Sys.Observer.raiseEvent(this, "init");
		this.endCreateComponents();
	   }

	function CleanupPrototype(type) {
		if (type && type.prototype) {
			for (key in type.prototype) {
				if (type.prototype.hasOwnProperty(key))
					type.prototype[key] = null;
			}
			if (type.prototype.constructor)
				type.prototype.constructor = null;
		}
	}

	function Sys$_Application$_unloadHandler(event) {

		// Skip disposal logic except for older versions of Internet Explorer
		if (Sys.Browser.agent !== Sys.Browser.InternetExplorer || Sys.Browser.version > 9) return;

		try {
			this.dispose();
			window.$find = null;
			window.Type = null;
			window._events = null;

			CleanupPrototype(Function);
			CleanupPrototype(Object);
			CleanupPrototype(String);
			CleanupPrototype(Array);
			CleanupPrototype(RegExp);
			CleanupPrototype(Number);
			CleanupPrototype(Boolean);
			CleanupPrototype(Date);
			CleanupPrototype(Error);

			for (var type in Sys.__upperCaseTypes)
				CleanupPrototype(Sys.__upperCaseTypes[type]);

			window.Sys = null;
			window.onload = null;
			window.onunload = null;
			window.__msajaxdispose = null;
			window.dispose = null;
		}
		catch (e)
		{}
	}
Sys._Application.prototype = {
	_deleteCount: 0,
	get_isCreatingComponents: Sys$_Application$get_isCreatingComponents,
	get_isDisposing: Sys$_Application$get_isDisposing,
	add_init: Sys$_Application$add_init,
	remove_init: Sys$_Application$remove_init,
	add_load: Sys$_Application$add_load,
	remove_load: Sys$_Application$remove_load,
	add_unload: Sys$_Application$add_unload,
	remove_unload: Sys$_Application$remove_unload,
	addComponent: Sys$_Application$addComponent,
	beginCreateComponents: Sys$_Application$beginCreateComponents,
	dispose: Sys$_Application$dispose,
	disposeElement: Sys$_Application$disposeElement,
	endCreateComponents: Sys$_Application$endCreateComponents,
	findComponent: Sys$_Application$findComponent,
	getComponents: Sys$_Application$getComponents,
	initialize: Sys$_Application$initialize,
	_doInitialize: Sys$_Application$_doInitialize,
	notifyScriptLoaded: Sys$_Application$notifyScriptLoaded,
	registerDisposableObject: Sys$_Application$registerDisposableObject,
	raiseLoad: Sys$_Application$raiseLoad,
	removeComponent: Sys$_Application$removeComponent,
	unregisterDisposableObject: Sys$_Application$unregisterDisposableObject,
	_addComponentToSecondPass: Sys$_Application$_addComponentToSecondPass,
	_disposeComponents: Sys$_Application$_disposeComponents,
	_raiseInit: Sys$_Application$_raiseInit,
	_unloadHandler: Sys$_Application$_unloadHandler
}
Sys._Application.registerClass('Sys._Application', Sys.Component, Sys.IContainer);

Sys.Application = new Sys._Application();
window.$find = Sys.Application.findComponent;


Sys.onReady(function() {
	Sys.Application._doInitialize();
});


Sys.UI.Behavior = function Sys$UI$Behavior(element) {
	/// <summary locid="M:J#Sys.UI.Behavior.#ctor" />
	/// <param name="element" domElement="true"></param>

	Sys.UI.Behavior.initializeBase(this);
	this._element = element;
	var behaviors = (element._behaviors = element._behaviors || []);
	behaviors.push(this);
}

	function Sys$UI$Behavior$get_element() {
		/// <value domElement="true" locid="P:J#Sys.UI.Behavior.element"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._element;
	}
	function Sys$UI$Behavior$get_id() {
		/// <value type="String" locid="P:J#Sys.UI.Behavior.id"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		var baseId = Sys.UI.Behavior.callBaseMethod(this, 'get_id');
		if (baseId) return baseId;
		if (!this._element || !this._element.id) return '';
		return this._element.id + '$' + this.get_name();
	}
	function Sys$UI$Behavior$get_name() {
		/// <value type="String" locid="P:J#Sys.UI.Behavior.name"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		if (this._name) return this._name;
		var name = Object.getTypeName(this);
		var i = name.lastIndexOf('.');
		if (i !== -1) name = name.substr(i + 1);
		if (!this._initialized) this._name = name;
		return name;
	}
	function Sys$UI$Behavior$set_name(value) {

		if ((value === '') || (value.charAt(0) === ' ') || (value.charAt(value.length - 1) === ' '))
			throw Error.argument('value', Sys.Res.invalidId);
		if (typeof(this._element[value]) !== 'undefined')
			throw Error.invalidOperation(String.format(Sys.Res.behaviorDuplicateName, value));
		if (this.get_isInitialized()) throw Error.invalidOperation(Sys.Res.cantSetNameAfterInit);
		this._name = value;
	}
	function Sys$UI$Behavior$initialize() {
		Sys.UI.Behavior.callBaseMethod(this, 'initialize');
		var name = this.get_name();
		if (name) this._element[name] = this;
	}
	function Sys$UI$Behavior$dispose() {
		Sys.UI.Behavior.callBaseMethod(this, 'dispose');
		var e = this._element;
		if (e) {
			var name = this.get_name();
			if (name) {
				e[name] = null;
			}
			var behaviors = e._behaviors;
			Array.remove(behaviors, this);
			if (!behaviors.length) {
				e._behaviors = null;
			}
			delete this._element;
		}
	}
Sys.UI.Behavior.prototype = {
	get_element: Sys$UI$Behavior$get_element,
	get_id: Sys$UI$Behavior$get_id,
	get_name: Sys$UI$Behavior$get_name,
	set_name: Sys$UI$Behavior$set_name,
	initialize: Sys$UI$Behavior$initialize,
	dispose: Sys$UI$Behavior$dispose
}
Sys.UI.Behavior.registerClass('Sys.UI.Behavior', Sys.Component);

Sys.UI.Behavior.getBehaviorByName = function Sys$UI$Behavior$getBehaviorByName(element, name) {
	/// <summary locid="M:J#Sys.UI.Behavior.getBehaviorByName" />
	/// <param name="element" domElement="true"></param>
	/// <param name="name" type="String"></param>
	/// <returns type="Sys.UI.Behavior" mayBeNull="true"></returns>

	var b = element[name];
	return (b && Sys.UI.Behavior.isInstanceOfType(b)) ? b : null;
}

Sys.UI.Behavior.getBehaviors = function Sys$UI$Behavior$getBehaviors(element) {
	/// <summary locid="M:J#Sys.UI.Behavior.getBehaviors" />
	/// <param name="element" domElement="true"></param>
	/// <returns type="Array" elementType="Sys.UI.Behavior"></returns>

	if (!element._behaviors) return [];
	return Array.clone(element._behaviors);
}

Sys.UI.Behavior.getBehaviorsByType = function Sys$UI$Behavior$getBehaviorsByType(element, type) {
	/// <summary locid="M:J#Sys.UI.Behavior.getBehaviorsByType" />
	/// <param name="element" domElement="true"></param>
	/// <param name="type" type="Type"></param>
	/// <returns type="Array" elementType="Sys.UI.Behavior"></returns>

	var behaviors = element._behaviors;
	var results = [];
	if (behaviors) {
		for (var i = 0, l = behaviors.length; i < l; i++) {
			if (type.isInstanceOfType(behaviors[i])) {
				results.push(behaviors[i]);
			}
		}
	}
	return results;
}
Sys.UI.VisibilityMode = function Sys$UI$VisibilityMode() {
	/// <summary locid="M:J#Sys.UI.VisibilityMode.#ctor" />
	/// <field name="hide" type="Number" integer="true" static="true" locid="F:J#Sys.UI.VisibilityMode.hide"></field>
	/// <field name="collapse" type="Number" integer="true" static="true" locid="F:J#Sys.UI.VisibilityMode.collapse"></field>
	if (arguments.length !== 0) throw Error.parameterCount();
	throw Error.notImplemented();
}



Sys.UI.VisibilityMode.prototype = {
	hide: 0,
	collapse: 1
}
Sys.UI.VisibilityMode.registerEnum("Sys.UI.VisibilityMode");

Sys.UI.Control = function Sys$UI$Control(element) {
	/// <summary locid="M:J#Sys.UI.Control.#ctor" />
	/// <param name="element" domElement="true"></param>

	if (typeof(element.control) !== 'undefined') throw Error.invalidOperation(Sys.Res.controlAlreadyDefined);
	Sys.UI.Control.initializeBase(this);

	this._element = element;
	element.control = this;
	var role = this.get_role();
	if (role) {
		element.setAttribute("role", role);
	}
}




	function Sys$UI$Control$get_element() {
		/// <value domElement="true" locid="P:J#Sys.UI.Control.element"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._element;
	}
	function Sys$UI$Control$get_id() {
		/// <value type="String" locid="P:J#Sys.UI.Control.id"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._id || (this._element ? this._element.id : "");
	}
	function Sys$UI$Control$get_parent() {
		/// <value type="Sys.UI.Control" locid="P:J#Sys.UI.Control.parent"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		if (this._parent) return this._parent;
		if (!this._element) return null;
		var parentElement = this._element.parentNode;
		while (parentElement) {
			if (parentElement.control) {
				return parentElement.control;
			}
			parentElement = parentElement.parentNode;
		}
		return null;
	}
	function Sys$UI$Control$set_parent(value) {

		if (!this._element) throw Error.invalidOperation(Sys.Res.cantBeCalledAfterDispose);
		var parents = [this];
		var current = value;
		while (current) {
			if (Array.contains(parents, current)) throw Error.invalidOperation(Sys.Res.circularParentChain);
			parents[parents.length] = current;
			current = current.get_parent();
		}
		this._parent = value;
	}
	function Sys$UI$Control$get_role() {
		/// <value type="String" locid="P:J#Sys.UI.Control.role"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return null;
	}
	function Sys$UI$Control$get_visibilityMode() {
		/// <value type="Sys.UI.VisibilityMode" locid="P:J#Sys.UI.Control.visibilityMode"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		if (!this._element) throw Error.invalidOperation(Sys.Res.cantBeCalledAfterDispose);
		return Sys.UI.DomElement.getVisibilityMode(this._element);
	}
	function Sys$UI$Control$set_visibilityMode(value) {

		if (!this._element) throw Error.invalidOperation(Sys.Res.cantBeCalledAfterDispose);
		Sys.UI.DomElement.setVisibilityMode(this._element, value);
	}
	function Sys$UI$Control$get_visibilityFunction() {
		/// <value type="Function" locid="P:J#Sys.UI.Control.visibilityFunction"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._visibilityFunction;
	}
	function Sys$UI$Control$set_visibilityFunction(value) {

		this._visibilityFunction = value;
	}
	function Sys$UI$Control$get_visible() {
		/// <value type="Boolean" locid="P:J#Sys.UI.Control.visible"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		if (!this._element) throw Error.invalidOperation(Sys.Res.cantBeCalledAfterDispose);
		return Sys.UI.DomElement.getVisible(this._element);
	}
	function Sys$UI$Control$set_visible(value) {

		if (!this._element) throw Error.invalidOperation(Sys.Res.cantBeCalledAfterDispose);
		Sys.UI.DomElement.setVisible(this._element, value, this.get_visibilityFunction())
	}
	function Sys$UI$Control$addCssClass(className) {
		/// <summary locid="M:J#Sys.UI.Control.addCssClass" />
		/// <param name="className" type="String"></param>

		if (!this._element) throw Error.invalidOperation(Sys.Res.cantBeCalledAfterDispose);
		Sys.UI.DomElement.addCssClass(this._element, className);
	}
	function Sys$UI$Control$dispose() {
		Sys.UI.Control.callBaseMethod(this, 'dispose');
		if (this._element) {
			this._element.control = null;
			delete this._element;
		}
		if (this._parent) delete this._parent;
	}
	function Sys$UI$Control$onBubbleEvent(source, args) {
		/// <summary locid="M:J#Sys.UI.Control.onBubbleEvent" />
		/// <param name="source"></param>
		/// <param name="args" type="Sys.EventArgs"></param>
		/// <returns type="Boolean"></returns>

		return false;
	}
	function Sys$UI$Control$raiseBubbleEvent(source, args) {
		/// <summary locid="M:J#Sys.UI.Control.raiseBubbleEvent" />
		/// <param name="source"></param>
		/// <param name="args" type="Sys.EventArgs"></param>

		this._raiseBubbleEvent(source, args);
	}
	function Sys$UI$Control$_raiseBubbleEvent(source, args) {
		var currentTarget = this.get_parent();
		while (currentTarget) {
			if (currentTarget.onBubbleEvent(source, args)) {
				return;
			}
			currentTarget = currentTarget.get_parent();
		}
	}
	function Sys$UI$Control$removeCssClass(className) {
		/// <summary locid="M:J#Sys.UI.Control.removeCssClass" />
		/// <param name="className" type="String"></param>

		if (!this._element) throw Error.invalidOperation(Sys.Res.cantBeCalledAfterDispose);
		Sys.UI.DomElement.removeCssClass(this._element, className);
	}
	function Sys$UI$Control$toggleCssClass(className) {
		/// <summary locid="M:J#Sys.UI.Control.toggleCssClass" />
		/// <param name="className" type="String"></param>

		if (!this._element) throw Error.invalidOperation(Sys.Res.cantBeCalledAfterDispose);
		Sys.UI.DomElement.toggleCssClass(this._element, className);
	}
Sys.UI.Control.prototype = {
	_parent: null,
	_visibilityMode: Sys.UI.VisibilityMode.hide,
	get_element: Sys$UI$Control$get_element,
	get_id: Sys$UI$Control$get_id,
	get_parent: Sys$UI$Control$get_parent,
	set_parent: Sys$UI$Control$set_parent,
	get_role: Sys$UI$Control$get_role,
	get_visibilityMode: Sys$UI$Control$get_visibilityMode,
	set_visibilityMode: Sys$UI$Control$set_visibilityMode,
	get_visibilityFunction: Sys$UI$Control$get_visibilityFunction,
	set_visibilityFunction: Sys$UI$Control$set_visibilityFunction,
	get_visible: Sys$UI$Control$get_visible,
	set_visible: Sys$UI$Control$set_visible,
	addCssClass: Sys$UI$Control$addCssClass,
	dispose: Sys$UI$Control$dispose,
	onBubbleEvent: Sys$UI$Control$onBubbleEvent,
	raiseBubbleEvent: Sys$UI$Control$raiseBubbleEvent,
	_raiseBubbleEvent: Sys$UI$Control$_raiseBubbleEvent,
	removeCssClass: Sys$UI$Control$removeCssClass,
	toggleCssClass: Sys$UI$Control$toggleCssClass
}
Sys.UI.Control.registerClass('Sys.UI.Control', Sys.Component);






Sys.HistoryEventArgs = function Sys$HistoryEventArgs(state) {
	/// <summary locid="M:J#Sys.HistoryEventArgs.#ctor" />
	/// <param name="state" type="Object"></param>

	Sys.HistoryEventArgs.initializeBase(this);
	this._state = state;
}

	function Sys$HistoryEventArgs$get_state() {
		/// <value type="Object" locid="P:J#Sys.HistoryEventArgs.state"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._state;
	}
Sys.HistoryEventArgs.prototype = {
	get_state: Sys$HistoryEventArgs$get_state
}
Sys.HistoryEventArgs.registerClass('Sys.HistoryEventArgs', Sys.EventArgs);


Sys.Application._appLoadHandler = null;
Sys.Application._beginRequestHandler = null;
Sys.Application._clientId = null;
Sys.Application._currentEntry = '';
Sys.Application._endRequestHandler = null;
Sys.Application._history = null;
Sys.Application._enableHistory = false;
Sys.Application._historyEnabledInScriptManager = false;
Sys.Application._historyFrame = null;
Sys.Application._historyInitialized = false;
Sys.Application._historyPointIsNew = false;
Sys.Application._ignoreTimer = false;
Sys.Application._initialState = null;
Sys.Application._state = {};
Sys.Application._timerCookie = 0;
Sys.Application._timerHandler = null;
Sys.Application._uniqueId = null;



Sys._Application.prototype.get_stateString = function Sys$_Application$get_stateString() {
	/// <summary locid="M:J#Sys._Application.get_stateString" />
	if (arguments.length !== 0) throw Error.parameterCount();
	var hash = null;
	if (isBrowser("Firefox")) {
		var href = window.location.href;
		var hashIndex = href.indexOf('#');
		if (hashIndex !== -1) {
			hash = href.substring(hashIndex + 1);
		}
		else {
			hash = "";
		}
		return hash;
	}
	else {
		hash = window.location.hash;
	}
	if ((hash.length > 0) && (hash.charAt(0) === '#')) {
		hash = hash.substring(1);
	}

	return hash;
};

Sys._Application.prototype.get_enableHistory = function Sys$_Application$get_enableHistory() {
	/// <summary locid="M:J#Sys._Application.get_enableHistory" />
	if (arguments.length !== 0) throw Error.parameterCount();
	return this._enableHistory;
};

Sys._Application.prototype.set_enableHistory = function Sys$_Application$set_enableHistory(value) {
	if (this._initialized && !this._initializing) {
		throw Error.invalidOperation(Sys.Res.historyCannotEnableHistory);
	}
	else if (this._historyEnabledInScriptManager && !value) {
		throw Error.invalidOperation(Sys.Res.invalidHistorySettingCombination);
	}
	this._enableHistory = value;
};

Sys._Application.prototype.add_navigate = function Sys$_Application$add_navigate(handler) {
	/// <summary locid="E:J#Sys.Application.navigate" />
	/// <param name="handler" type="Function"></param>

	this._addHandler("navigate", handler);
};

Sys._Application.prototype.remove_navigate = function Sys$_Application$remove_navigate(handler) {
	/// <summary locid="M:J#Sys._Application.remove_navigate" />
	/// <param name="handler" type="Function"></param>

	this._removeHandler("navigate", handler);
};

Sys._Application.prototype.addHistoryPoint = function Sys$_Application$addHistoryPoint(state, title) {
	/// <summary locid="M:J#Sys.Application.addHistoryPoint" />
	/// <param name="state" type="Object"></param>
	/// <param name="title" type="String" optional="true" mayBeNull="true"></param>

	if (!this._enableHistory) throw Error.invalidOperation(Sys.Res.historyCannotAddHistoryPointWithHistoryDisabled);
	for (var n in state) {
		var v = state[n];
		var t = typeof(v);
		if ((v !== null) && ((t === 'object') || (t === 'function') || (t === 'undefined'))) {
			throw Error.argument('state', Sys.Res.stateMustBeStringDictionary);
		}
	}
	this._ensureHistory();
	var initialState = this._state;
	for (var key in state) {
		var value = state[key];
		if (value === null) {
			if (typeof(initialState[key]) !== 'undefined') {
				delete initialState[key];
			}
		}
		else {
			initialState[key] = value;
		}
	}
	var entry = this._serializeState(initialState);
	this._historyPointIsNew = true;
	this._setState(entry, title);
	this._raiseNavigate();
};

Sys._Application.prototype.setServerId = function Sys$_Application$setServerId(clientId, uniqueId) {
	/// <summary locid="M:J#Sys.Application.setServerId" />
	/// <param name="clientId" type="String"></param>
	/// <param name="uniqueId" type="String"></param>

	this._clientId = clientId;
	this._uniqueId = uniqueId;
};

Sys._Application.prototype.setServerState = function Sys$_Application$setServerState(value) {
	/// <summary locid="M:J#Sys.Application.setServerState" />
	/// <param name="value" type="String"></param>

	this._ensureHistory();
	this._state.__s = value;
	this._updateHiddenField(value);
};

Sys._Application.prototype._deserializeState = function Sys$_Application$_deserializeState(entry) {
	var result = {};
	entry = entry || '';
	var serverSeparator = entry.indexOf('&&');
	if ((serverSeparator !== -1) && (serverSeparator + 2 < entry.length)) {
		result.__s = entry.substr(serverSeparator + 2);
		entry = entry.substr(0, serverSeparator);
	}
	var tokens = entry.split('&');
	for (var i = 0, l = tokens.length; i < l; i++) {
		var token = tokens[i];
		var equal = token.indexOf('=');
		if ((equal !== -1) && (equal + 1 < token.length)) {
			var name = token.substr(0, equal);
			var value = token.substr(equal + 1);
			result[name] = decodeURIComponent(value);
		}
	}
	return result;
};

Sys._Application.prototype._enableHistoryInScriptManager = function Sys$_Application$_enableHistoryInScriptManager() {
	this._enableHistory = true;
	this._historyEnabledInScriptManager = true;
};

Sys._Application.prototype._ensureHistory = function Sys$_Application$_ensureHistory() {
	if (!this._historyInitialized && this._enableHistory) {
		if (isBrowser("InternetExplorer") && (Sys.Browser.documentMode < 8)) {
			this._historyFrame = Sys.get('#__historyFrame');
			if (!this._historyFrame) throw Error.invalidOperation(Sys.Res.historyMissingFrame);
			this._ignoreIFrame = true;
		}
		this._timerHandler = Function.createDelegate(this, this._onIdle);
		this._timerCookie = window.setTimeout(this._timerHandler, 100);
		try {
			this._initialState = this._deserializeState(this.get_stateString());
		} catch(e) {}
		this._historyInitialized = true;
	}
};

Sys._Application.prototype._navigate = function Sys$_Application$_navigate(entry) {
	this._ensureHistory();

	var state = this._deserializeState(entry);
	if (this._uniqueId) {
		var oldServerEntry = this._state.__s || '';
		var newServerEntry = state.__s || '';
		if (newServerEntry !== oldServerEntry) {
			this._updateHiddenField(newServerEntry);
			__doPostBack(this._uniqueId, newServerEntry);
			this._state = state;
			return;
		}
	}
	this._setState(entry);
	this._state = state;
	this._raiseNavigate();
};

Sys._Application.prototype._onIdle = function Sys$_Application$_onIdle() {
	delete this._timerCookie;
	var entry = this.get_stateString();
	if (entry !== this._currentEntry) {
		if (!this._ignoreTimer) {
			this._historyPointIsNew = false;
			this._navigate(entry);
		}
	}
	else {
		this._ignoreTimer = false;
	}
	this._timerCookie = window.setTimeout(this._timerHandler, 100);
};

Sys._Application.prototype._onIFrameLoad = function Sys$_Application$_onIFrameLoad(entry) {
	this._ensureHistory();
	if (!this._ignoreIFrame) {
		this._historyPointIsNew = false;
		this._navigate(entry);
	}
	this._ignoreIFrame = false;
};

Sys._Application.prototype._onPageRequestManagerBeginRequest = function Sys$_Application$_onPageRequestManagerBeginRequest(sender, args) {
	this._ignoreTimer = true;
	this._originalTitle = document.title;
};

Sys._Application.prototype._onPageRequestManagerEndRequest = function Sys$_Application$_onPageRequestManagerEndRequest(sender, args) {
	var dataItem = args.get_dataItems()[this._clientId];
	var originalTitle = this._originalTitle;
	this._originalTitle = null;

	var eventTarget = Sys.get("#__EVENTTARGET");
	if (eventTarget && eventTarget.value === this._uniqueId) {
		eventTarget.value = '';
	}
	if (typeof(dataItem) !== 'undefined') {
		this.setServerState(dataItem);
		this._historyPointIsNew = true;
	}
	else {
		this._ignoreTimer = false;
	}
	var entry = this._serializeState(this._state);
	if (entry !== this._currentEntry) {
		this._ignoreTimer = true;
		if (typeof(originalTitle) === "string") {
			if (Sys.Browser.agent !== Sys.Browser.InternetExplorer || Sys.Browser.version > 7) {
				var newTitle = document.title;
				document.title = originalTitle;
				this._setState(entry);
				document.title = newTitle;
			}
			else {
				this._setState(entry);
			}
			this._raiseNavigate();
		}
		else {
			this._setState(entry);
			this._raiseNavigate();
		}
	}
};

Sys._Application.prototype._raiseNavigate = function Sys$_Application$_raiseNavigate() {
	var isNew = this._historyPointIsNew;
	var stateClone = {};
	for (var key in this._state) {
		if (key !== '__s') {
			stateClone[key] = this._state[key];
		}
	}
	var args = new Sys.HistoryEventArgs(stateClone);
	Sys.Observer.raiseEvent(this, "navigate", args);
	if (!isNew) {
		var err;
		try {
			if (isBrowser("Firefox") && window.location.hash &&
				(!window.frameElement || window.top.location.hash)) {
				(Sys.Browser.version < 3.5) ?
					window.history.go(0) :
					location.hash = this.get_stateString();
			}
		}
		catch(err) {
		}
	}
};

Sys._Application.prototype._serializeState = function Sys$_Application$_serializeState(state) {
	var serialized = [];
	for (var key in state) {
		var value = state[key];
		if (key === '__s') {
			var serverState = value;
		}
		else {
			if (key.indexOf('=') !== -1) throw Error.argument('state', Sys.Res.stateFieldNameInvalid);
			serialized[serialized.length] = key + '=' + encodeURIComponent(value);
		}
	}
	return serialized.join('&') + (serverState ? '&&' + serverState : '');
};

Sys._Application.prototype._setState = function Sys$_Application$_setState(entry, title) {
	if (this._enableHistory) {
		entry = entry || '';
		if (entry !== this._currentEntry) {
			if (window.theForm) {
				var action = window.theForm.action;
				var hashIndex = action.indexOf('#');
				window.theForm.action = ((hashIndex !== -1) ? action.substring(0, hashIndex) : action) + '#' + entry;
			}
			if (this._historyFrame && this._historyPointIsNew) {
				this._ignoreIFrame = true;
				var frameDoc = this._historyFrame.contentWindow.document;
				frameDoc.open("javascript:'<html></html>'");
				frameDoc.write("<html><head><title>" + (title || document.title) +
					"</title><scri" + "pt type=\"text/javascript\">parent.Sys.Application._onIFrameLoad(" +
					Sys.Serialization.JavaScriptSerializer.serialize(entry) +
					");</scri" + "pt></head><body></body></html>");
				frameDoc.close();
			}
			this._ignoreTimer = false;
			this._currentEntry = entry;
			if (this._historyFrame || this._historyPointIsNew) {
				var currentHash = this.get_stateString();
				if (entry !== currentHash) {
					var loc = document.location;
					if (loc.href.length - loc.hash.length + entry.length > 2048) {
						throw Error.invalidOperation(String.format(Sys.Res.urlTooLong, 2048));
					}
					window.location.hash = entry;
					this._currentEntry = this.get_stateString();
					if ((typeof(title) !== 'undefined') && (title !== null)) {
						document.title = title;
					}
				}
			}
			this._historyPointIsNew = false;
		}
	}
};

Sys._Application.prototype._updateHiddenField = function Sys$_Application$_updateHiddenField(value) {
	if (this._clientId) {
		var serverStateField = document.getElementById(this._clientId);
		if (serverStateField) {
			serverStateField.value = value;
		}
	}
};






if (!window.XMLHttpRequest) {
	window.XMLHttpRequest = function window$XMLHttpRequest() {
		var progIDs = [ 'Msxml2.XMLHTTP.3.0', 'Msxml2.XMLHTTP' ];
		for (var i = 0, l = progIDs.length; i < l; i++) {
			try {
				return new ActiveXObject(progIDs[i]);
			}
			catch (ex) {
			}
		}
		return null;
	}
}

Type.registerNamespace('Sys.Net');

Sys.Net.WebRequestExecutor = function Sys$Net$WebRequestExecutor() {
	/// <summary locid="M:J#Sys.Net.WebRequestExecutor.#ctor" />
	if (arguments.length !== 0) throw Error.parameterCount();
	this._webRequest = null;
	this._resultObject = null;
}


	function Sys$Net$WebRequestExecutor$get_webRequest() {
		/// <value type="Sys.Net.WebRequest" locid="P:J#Sys.Net.WebRequestExecutor.webRequest"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._webRequest;
	}

	function Sys$Net$WebRequestExecutor$_set_webRequest(value) {
		if (this.get_started()) {
			throw Error.invalidOperation(String.format(Sys.Res.cannotCallOnceStarted, 'set_webRequest'));
		}

		this._webRequest = value;
	}


	function Sys$Net$WebRequestExecutor$get_started() {
		/// <value type="Boolean" locid="P:J#Sys.Net.WebRequestExecutor.started"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		throw Error.notImplemented();
	}

	function Sys$Net$WebRequestExecutor$get_responseAvailable() {
		/// <value type="Boolean" locid="P:J#Sys.Net.WebRequestExecutor.responseAvailable"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		throw Error.notImplemented();
	}

	function Sys$Net$WebRequestExecutor$get_timedOut() {
		/// <value type="Boolean" locid="P:J#Sys.Net.WebRequestExecutor.timedOut"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		throw Error.notImplemented();
	}
	function Sys$Net$WebRequestExecutor$get_aborted() {
		/// <value type="Boolean" locid="P:J#Sys.Net.WebRequestExecutor.aborted"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		throw Error.notImplemented();
	}
	function Sys$Net$WebRequestExecutor$get_responseData() {
		/// <value type="String" locid="P:J#Sys.Net.WebRequestExecutor.responseData"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		throw Error.notImplemented();
	}
	function Sys$Net$WebRequestExecutor$get_statusCode() {
		/// <value type="Number" locid="P:J#Sys.Net.WebRequestExecutor.statusCode"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		throw Error.notImplemented();
	}
	function Sys$Net$WebRequestExecutor$get_statusText() {
		/// <value type="String" locid="P:J#Sys.Net.WebRequestExecutor.statusText"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		throw Error.notImplemented();
	}
	function Sys$Net$WebRequestExecutor$get_xml() {
		/// <value locid="P:J#Sys.Net.WebRequestExecutor.xml"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		throw Error.notImplemented();
	}
	function Sys$Net$WebRequestExecutor$get_object() {
		/// <value locid="P:J#Sys.Net.WebRequestExecutor.object"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		if (!this._resultObject) {
			this._resultObject = Sys.Serialization.JavaScriptSerializer.deserialize(this.get_responseData());
		}
		return this._resultObject;
	}


	function Sys$Net$WebRequestExecutor$executeRequest() {
		/// <summary locid="M:J#Sys.Net.WebRequestExecutor.executeRequest" />
		if (arguments.length !== 0) throw Error.parameterCount();
		throw Error.notImplemented();
	}
	function Sys$Net$WebRequestExecutor$abort() {
		/// <summary locid="M:J#Sys.Net.WebRequestExecutor.abort" />
		if (arguments.length !== 0) throw Error.parameterCount();
		throw Error.notImplemented();
	}
	function Sys$Net$WebRequestExecutor$getResponseHeader(header) {
		/// <summary locid="M:J#Sys.Net.WebRequestExecutor.getResponseHeader" />
		/// <param name="header" type="String"></param>

		throw Error.notImplemented();
	}
	function Sys$Net$WebRequestExecutor$getAllResponseHeaders() {
		/// <summary locid="M:J#Sys.Net.WebRequestExecutor.getAllResponseHeaders" />
		if (arguments.length !== 0) throw Error.parameterCount();
		throw Error.notImplemented();
	}
Sys.Net.WebRequestExecutor.prototype = {
	get_webRequest: Sys$Net$WebRequestExecutor$get_webRequest,
	_set_webRequest: Sys$Net$WebRequestExecutor$_set_webRequest,
	get_started: Sys$Net$WebRequestExecutor$get_started,
	get_responseAvailable: Sys$Net$WebRequestExecutor$get_responseAvailable,
	get_timedOut: Sys$Net$WebRequestExecutor$get_timedOut,
	get_aborted: Sys$Net$WebRequestExecutor$get_aborted,
	get_responseData: Sys$Net$WebRequestExecutor$get_responseData,
	get_statusCode: Sys$Net$WebRequestExecutor$get_statusCode,
	get_statusText: Sys$Net$WebRequestExecutor$get_statusText,
	get_xml: Sys$Net$WebRequestExecutor$get_xml,
	get_object: Sys$Net$WebRequestExecutor$get_object,
	executeRequest: Sys$Net$WebRequestExecutor$executeRequest,
	abort: Sys$Net$WebRequestExecutor$abort,
	getResponseHeader: Sys$Net$WebRequestExecutor$getResponseHeader,
	getAllResponseHeaders: Sys$Net$WebRequestExecutor$getAllResponseHeaders
}
Sys.Net.WebRequestExecutor.registerClass('Sys.Net.WebRequestExecutor');
Sys.Net.XMLDOM = function Sys$Net$XMLDOM(markup) {
	/// <summary locid="M:J#Sys.Net.XMLDOM.#ctor" />
	/// <param name="markup" type="String"></param>

	if (!window.DOMParser) {
		var progIDs = [ 'Msxml2.DOMDocument.3.0', 'Msxml2.DOMDocument' ];
		for (var i = 0, l = progIDs.length; i < l; i++) {
			try {
				var xmlDOM = new ActiveXObject(progIDs[i]);
				xmlDOM.async = false;
				xmlDOM.loadXML(markup);
				xmlDOM.setProperty('SelectionLanguage', 'XPath');
				return xmlDOM;
			}
			catch (ex) {
			}
		}
	}
	else {
		try {
			var domParser = new window.DOMParser();
			return domParser.parseFromString(markup, 'text/xml');
		}
		catch (ex) {
		}
	}
	return null;
}

Sys.Net.XMLHttpExecutor = function Sys$Net$XMLHttpExecutor() {
	/// <summary locid="M:J#Sys.Net.XMLHttpExecutor.#ctor" />
	if (arguments.length !== 0) throw Error.parameterCount();

	Sys.Net.XMLHttpExecutor.initializeBase(this);

	var _this = this;
	this._xmlHttpRequest = null;
	this._webRequest = null;
	this._responseAvailable = false;
	this._timedOut = false;
	this._timer = null;
	this._aborted = false;
	this._started = false;

	this._onReadyStateChange = (function () {

		if (_this._xmlHttpRequest.readyState === 4
) {
			try {
				if (typeof(_this._xmlHttpRequest.status) === "undefined") {
					return;
				}
			}
			catch(ex) {
				return;
			}
			_this._clearTimer();
			_this._responseAvailable = true;
				_this._webRequest.completed(Sys.EventArgs.Empty);
				if (_this._xmlHttpRequest != null) {
					_this._xmlHttpRequest.onreadystatechange = Function.emptyMethod;
					_this._xmlHttpRequest = null;
				}
		}
	});

	this._clearTimer = (function() {
		if (_this._timer != null) {
			window.clearTimeout(_this._timer);
			_this._timer = null;
		}
	});

	this._onTimeout = (function() {
		if (!_this._responseAvailable) {
			_this._clearTimer();
			_this._timedOut = true;
			_this._xmlHttpRequest.onreadystatechange = Function.emptyMethod;
			_this._xmlHttpRequest.abort();
			_this._webRequest.completed(Sys.EventArgs.Empty);
			_this._xmlHttpRequest = null;
		}
	});

}



	function Sys$Net$XMLHttpExecutor$get_timedOut() {
		/// <value type="Boolean" locid="P:J#Sys.Net.XMLHttpExecutor.timedOut"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._timedOut;
	}

	function Sys$Net$XMLHttpExecutor$get_started() {
		/// <value type="Boolean" locid="P:J#Sys.Net.XMLHttpExecutor.started"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._started;
	}

	function Sys$Net$XMLHttpExecutor$get_responseAvailable() {
		/// <value type="Boolean" locid="P:J#Sys.Net.XMLHttpExecutor.responseAvailable"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._responseAvailable;
	}

	function Sys$Net$XMLHttpExecutor$get_aborted() {
		/// <value type="Boolean" locid="P:J#Sys.Net.XMLHttpExecutor.aborted"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._aborted;
	}

	function Sys$Net$XMLHttpExecutor$executeRequest() {
		/// <summary locid="M:J#Sys.Net.XMLHttpExecutor.executeRequest" />
		if (arguments.length !== 0) throw Error.parameterCount();
		this._webRequest = this.get_webRequest();

		if (this._started) {
			throw Error.invalidOperation(String.format(Sys.Res.cannotCallOnceStarted, 'executeRequest'));
		}
		if (this._webRequest === null) {
			throw Error.invalidOperation(Sys.Res.nullWebRequest);
		}

		var body = this._webRequest.get_body();
		var headers = this._webRequest.get_headers();
		this._xmlHttpRequest = new XMLHttpRequest();
		this._xmlHttpRequest.onreadystatechange = this._onReadyStateChange;
		var verb = this._webRequest.get_httpVerb();
		this._xmlHttpRequest.open(verb, this._webRequest.getResolvedUrl(), true
);
		this._xmlHttpRequest.setRequestHeader("X-Requested-With", "XMLHttpRequest");
		if (headers) {
			for (var header in headers) {
				var val = headers[header];
				if (typeof(val) !== "function")
					this._xmlHttpRequest.setRequestHeader(header, val);
			}
		}

		if (verb.toLowerCase() === "post") {
			if ((headers === null) || !headers['Content-Type']) {
				this._xmlHttpRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=utf-8');
			}

			if (!body) {
				body = "";
			}
		}

		var timeout = this._webRequest.get_timeout();
		if (timeout > 0) {
			this._timer = window.setTimeout(Function.createDelegate(this, this._onTimeout), timeout);
		}
		this._xmlHttpRequest.send(body);
		this._started = true;
	}

	function Sys$Net$XMLHttpExecutor$getResponseHeader(header) {
		/// <summary locid="M:J#Sys.Net.XMLHttpExecutor.getResponseHeader" />
		/// <param name="header" type="String"></param>
		/// <returns type="String"></returns>

		if (!this._responseAvailable) {
			throw Error.invalidOperation(String.format(Sys.Res.cannotCallBeforeResponse, 'getResponseHeader'));
		}
		if (!this._xmlHttpRequest) {
			throw Error.invalidOperation(String.format(Sys.Res.cannotCallOutsideHandler, 'getResponseHeader'));
		}

		var result;
		try {
			result = this._xmlHttpRequest.getResponseHeader(header);
		} catch (e) {
		}
		if (!result) result = "";
		return result;
	}

	function Sys$Net$XMLHttpExecutor$getAllResponseHeaders() {
		/// <summary locid="M:J#Sys.Net.XMLHttpExecutor.getAllResponseHeaders" />
		/// <returns type="String"></returns>
		if (arguments.length !== 0) throw Error.parameterCount();
		if (!this._responseAvailable) {
			throw Error.invalidOperation(String.format(Sys.Res.cannotCallBeforeResponse, 'getAllResponseHeaders'));
		}
		if (!this._xmlHttpRequest) {
			throw Error.invalidOperation(String.format(Sys.Res.cannotCallOutsideHandler, 'getAllResponseHeaders'));
		}

		return this._xmlHttpRequest.getAllResponseHeaders();
	}

	function Sys$Net$XMLHttpExecutor$get_responseData() {
		/// <value type="String" locid="P:J#Sys.Net.XMLHttpExecutor.responseData"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		if (!this._responseAvailable) {
			throw Error.invalidOperation(String.format(Sys.Res.cannotCallBeforeResponse, 'get_responseData'));
		}
		if (!this._xmlHttpRequest) {
			throw Error.invalidOperation(String.format(Sys.Res.cannotCallOutsideHandler, 'get_responseData'));
		}

		return this._xmlHttpRequest.responseText;
	}

	function Sys$Net$XMLHttpExecutor$get_statusCode() {
		/// <value type="Number" locid="P:J#Sys.Net.XMLHttpExecutor.statusCode"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		if (!this._responseAvailable) {
			throw Error.invalidOperation(String.format(Sys.Res.cannotCallBeforeResponse, 'get_statusCode'));
		}
		if (!this._xmlHttpRequest) {
			throw Error.invalidOperation(String.format(Sys.Res.cannotCallOutsideHandler, 'get_statusCode'));
		}
		var result = 0;
		try {
			result = this._xmlHttpRequest.status;
		}
		catch(ex) {
		}
		return result;
	}

	function Sys$Net$XMLHttpExecutor$get_statusText() {
		/// <value type="String" locid="P:J#Sys.Net.XMLHttpExecutor.statusText"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		if (!this._responseAvailable) {
			throw Error.invalidOperation(String.format(Sys.Res.cannotCallBeforeResponse, 'get_statusText'));
		}
		if (!this._xmlHttpRequest) {
			throw Error.invalidOperation(String.format(Sys.Res.cannotCallOutsideHandler, 'get_statusText'));
		}

		return this._xmlHttpRequest.statusText;
	}

	function Sys$Net$XMLHttpExecutor$get_xml() {
		/// <value locid="P:J#Sys.Net.XMLHttpExecutor.xml"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		if (!this._responseAvailable) {
			throw Error.invalidOperation(String.format(Sys.Res.cannotCallBeforeResponse, 'get_xml'));
		}
		if (!this._xmlHttpRequest) {
			throw Error.invalidOperation(String.format(Sys.Res.cannotCallOutsideHandler, 'get_xml'));
		}

		var xml = this._xmlHttpRequest.responseXML;
		if (!xml || !xml.documentElement) {

			xml = Sys.Net.XMLDOM(this._xmlHttpRequest.responseText);

			if (!xml || !xml.documentElement)
				return null;
		}
		else if (navigator.userAgent.indexOf('MSIE') !== -1) {
			xml.setProperty('SelectionLanguage', 'XPath');
		}

		if (xml.documentElement.namespaceURI === "http://www.mozilla.org/newlayout/xml/parsererror.xml" &&
			xml.documentElement.tagName === "parsererror") {
			return null;
		}
		if (xml.documentElement.firstChild && xml.documentElement.firstChild.tagName === "parsererror") {
			return null;
		}
		return xml;
	}

	function Sys$Net$XMLHttpExecutor$abort() {
		/// <summary locid="M:J#Sys.Net.XMLHttpExecutor.abort" />
		if (arguments.length !== 0) throw Error.parameterCount();
		if (!this._started) {
			throw Error.invalidOperation(Sys.Res.cannotAbortBeforeStart);
		}

		if (this._aborted || this._responseAvailable || this._timedOut)
			return;

		this._aborted = true;

		this._clearTimer();

		if (this._xmlHttpRequest && !this._responseAvailable) {

			this._xmlHttpRequest.onreadystatechange = Function.emptyMethod;
			this._xmlHttpRequest.abort();
			this._xmlHttpRequest = null;

			this._webRequest.completed(Sys.EventArgs.Empty);
		}
	}
Sys.Net.XMLHttpExecutor.prototype = {
	get_timedOut: Sys$Net$XMLHttpExecutor$get_timedOut,
	get_started: Sys$Net$XMLHttpExecutor$get_started,
	get_responseAvailable: Sys$Net$XMLHttpExecutor$get_responseAvailable,
	get_aborted: Sys$Net$XMLHttpExecutor$get_aborted,
	executeRequest: Sys$Net$XMLHttpExecutor$executeRequest,
	getResponseHeader: Sys$Net$XMLHttpExecutor$getResponseHeader,
	getAllResponseHeaders: Sys$Net$XMLHttpExecutor$getAllResponseHeaders,
	get_responseData: Sys$Net$XMLHttpExecutor$get_responseData,
	get_statusCode: Sys$Net$XMLHttpExecutor$get_statusCode,
	get_statusText: Sys$Net$XMLHttpExecutor$get_statusText,
	get_xml: Sys$Net$XMLHttpExecutor$get_xml,
	abort: Sys$Net$XMLHttpExecutor$abort
}
Sys.Net.XMLHttpExecutor.registerClass('Sys.Net.XMLHttpExecutor', Sys.Net.WebRequestExecutor);
Sys.Net._WebRequestManager = function Sys$Net$_WebRequestManager() {
	/// <summary locid="P:J#Sys.Net.WebRequestManager.#ctor" />
	if (arguments.length !== 0) throw Error.parameterCount();
	this._defaultTimeout = 0;
	this._defaultExecutorType = "Sys.Net.XMLHttpExecutor";
}


	function Sys$Net$_WebRequestManager$add_invokingRequest(handler) {
		/// <summary locid="E:J#Sys.Net.WebRequestManager.invokingRequest" />

		Sys.Observer.addEventHandler(this, "invokingRequest", handler);
	}
	function Sys$Net$_WebRequestManager$remove_invokingRequest(handler) {

		Sys.Observer.removeEventHandler(this, "invokingRequest", handler);
	}

	function Sys$Net$_WebRequestManager$add_completedRequest(handler) {
		/// <summary locid="E:J#Sys.Net.WebRequestManager.completedRequest" />

		Sys.Observer.addEventHandler(this, "completedRequest", handler);
	}
	function Sys$Net$_WebRequestManager$remove_completedRequest(handler) {

		Sys.Observer.removeEventHandler(this, "completedRequest", handler);
	}
	function Sys$Net$_WebRequestManager$get_defaultTimeout() {
		/// <value type="Number" locid="P:J#Sys.Net.WebRequestManager.defaultTimeout"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._defaultTimeout;
	}
	function Sys$Net$_WebRequestManager$set_defaultTimeout(value) {

		if (value < 0) {
			throw Error.argumentOutOfRange("value", value, Sys.Res.invalidTimeout);
		}

		this._defaultTimeout = value;
	}

	function Sys$Net$_WebRequestManager$get_defaultExecutorType() {
		/// <value type="String" locid="P:J#Sys.Net.WebRequestManager.defaultExecutorType"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._defaultExecutorType;
	}
	function Sys$Net$_WebRequestManager$set_defaultExecutorType(value) {

		this._defaultExecutorType = value;
	}

	function Sys$Net$_WebRequestManager$executeRequest(webRequest) {
		/// <summary locid="M:J#Sys.Net.WebRequestManager.executeRequest" />
		/// <param name="webRequest" type="Sys.Net.WebRequest"></param>

		var executor = webRequest.get_executor();
		if (!executor) {

			var er, failed = false;
			try {
				var executorType = window.eval(this._defaultExecutorType);
				executor = new executorType();
			} catch (er) {
				failed = true;
			}

			if (failed  || !Sys.Net.WebRequestExecutor.isInstanceOfType(executor) || !executor) {
				throw Error.argument("defaultExecutorType", String.format(Sys.Res.invalidExecutorType, this._defaultExecutorType));
			}

			webRequest.set_executor(executor);
		}

		if (executor.get_aborted()) {
			return;
		}

		var evArgs = new Sys.Net.NetworkRequestEventArgs(webRequest);
		Sys.Observer.raiseEvent(this, "invokingRequest", evArgs);
		if (!evArgs.get_cancel()) {
			executor.executeRequest();
		}
	}
Sys.Net._WebRequestManager.prototype = {
	add_invokingRequest: Sys$Net$_WebRequestManager$add_invokingRequest,
	remove_invokingRequest: Sys$Net$_WebRequestManager$remove_invokingRequest,
	add_completedRequest: Sys$Net$_WebRequestManager$add_completedRequest,
	remove_completedRequest: Sys$Net$_WebRequestManager$remove_completedRequest,
	get_defaultTimeout: Sys$Net$_WebRequestManager$get_defaultTimeout,
	set_defaultTimeout: Sys$Net$_WebRequestManager$set_defaultTimeout,
	get_defaultExecutorType: Sys$Net$_WebRequestManager$get_defaultExecutorType,
	set_defaultExecutorType: Sys$Net$_WebRequestManager$set_defaultExecutorType,
	executeRequest: Sys$Net$_WebRequestManager$executeRequest
}

Sys.Net._WebRequestManager.registerClass('Sys.Net._WebRequestManager');


Sys.Net.WebRequestManager = new Sys.Net._WebRequestManager();
Sys.Net.NetworkRequestEventArgs = function Sys$Net$NetworkRequestEventArgs(webRequest) {
	/// <summary locid="M:J#Sys.Net.NetworkRequestEventArgs.#ctor" />
	/// <param name="webRequest" type="Sys.Net.WebRequest"></param>

	Sys.Net.NetworkRequestEventArgs.initializeBase(this);
	this._webRequest = webRequest;
}


	function Sys$Net$NetworkRequestEventArgs$get_webRequest() {
		/// <value type="Sys.Net.WebRequest" locid="P:J#Sys.Net.NetworkRequestEventArgs.webRequest"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._webRequest;
	}
Sys.Net.NetworkRequestEventArgs.prototype = {
	get_webRequest: Sys$Net$NetworkRequestEventArgs$get_webRequest
}

Sys.Net.NetworkRequestEventArgs.registerClass('Sys.Net.NetworkRequestEventArgs', Sys.CancelEventArgs);
Sys.Net.WebRequest = function Sys$Net$WebRequest() {
	/// <summary locid="M:J#Sys.Net.WebRequest.#ctor" />
	if (arguments.length !== 0) throw Error.parameterCount();
	this._url = "";
	this._headers = { };
	this._body = null;
	this._userContext = null;
	this._httpVerb = null;
	this._executor = null;
	this._invokeCalled = false;
	this._timeout = 0;
}



	function Sys$Net$WebRequest$add_completed(handler) {
	/// <summary locid="E:J#Sys.Net.WebRequest.completed" />

		Sys.Observer.addEventHandler(this, "completed", handler);
	}
	function Sys$Net$WebRequest$remove_completed(handler) {

		Sys.Observer.removeEventHandler(this, "completed", handler);
	}

	function Sys$Net$WebRequest$completed(eventArgs) {
		/// <summary locid="M:J#Sys.Net.WebRequest.completed" />
		/// <param name="eventArgs" type="Sys.EventArgs"></param>

		function raise(source, sender, eventName) {
			var handler = Sys.Observer._getContext(source, true).events.getHandler(eventName);
			if (handler) {
				handler(sender, eventArgs);
			}
		}
		raise(Sys.Net.WebRequestManager, this._executor, "completedRequest");
		raise(this, this._executor, "completed");
		Sys.Observer.clearEventHandlers(this, "completed");
	}

	function Sys$Net$WebRequest$get_url() {
		/// <value type="String" locid="P:J#Sys.Net.WebRequest.url"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._url;
	}
	function Sys$Net$WebRequest$set_url(value) {

		this._url = value;
	}

	function Sys$Net$WebRequest$get_headers() {
		/// <value locid="P:J#Sys.Net.WebRequest.headers"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._headers;
	}

	function Sys$Net$WebRequest$get_httpVerb() {
		/// <value type="String" locid="P:J#Sys.Net.WebRequest.httpVerb"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		if (this._httpVerb === null) {
			if (this._body === null) {
				return "GET";
			}
			return "POST";
		}
		return this._httpVerb;
	}
	function Sys$Net$WebRequest$set_httpVerb(value) {

		if (value.length === 0) {
			throw Error.argument('value', Sys.Res.invalidHttpVerb);
		}

		this._httpVerb = value;
	}

	function Sys$Net$WebRequest$get_body() {
		/// <value mayBeNull="true" locid="P:J#Sys.Net.WebRequest.body"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._body;
	}
	function Sys$Net$WebRequest$set_body(value) {

		this._body = value;
	}

	function Sys$Net$WebRequest$get_userContext() {
		/// <value mayBeNull="true" locid="P:J#Sys.Net.WebRequest.userContext"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._userContext;
	}
	function Sys$Net$WebRequest$set_userContext(value) {

		this._userContext = value;
	}

	function Sys$Net$WebRequest$get_executor() {
		/// <value type="Sys.Net.WebRequestExecutor" locid="P:J#Sys.Net.WebRequest.executor"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._executor;
	}
	function Sys$Net$WebRequest$set_executor(value) {

		if (this._executor !== null && this._executor.get_started()) {
			throw Error.invalidOperation(Sys.Res.setExecutorAfterActive);
		}

		this._executor = value;
		this._executor._set_webRequest(this);
	}

	function Sys$Net$WebRequest$get_timeout() {
		/// <value type="Number" locid="P:J#Sys.Net.WebRequest.timeout"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		if (this._timeout === 0) {
			return Sys.Net.WebRequestManager.get_defaultTimeout();
		}
		return this._timeout;
	}
	function Sys$Net$WebRequest$set_timeout(value) {

		if (value < 0) {
			throw Error.argumentOutOfRange("value", value, Sys.Res.invalidTimeout);
		}

		this._timeout = value;
	}

	function Sys$Net$WebRequest$getResolvedUrl() {
		/// <summary locid="M:J#raise" />
		/// <returns type="String"></returns>
		if (arguments.length !== 0) throw Error.parameterCount();
		return Sys.Net.WebRequest._resolveUrl(this._url);
	}

	function Sys$Net$WebRequest$invoke() {
		/// <summary locid="M:J#raise" />
		if (arguments.length !== 0) throw Error.parameterCount();
		if (this._invokeCalled) {
			throw Error.invalidOperation(Sys.Res.invokeCalledTwice);
		}

		Sys.Net.WebRequestManager.executeRequest(this);
		this._invokeCalled = true;
	}
Sys.Net.WebRequest.prototype = {
	add_completed: Sys$Net$WebRequest$add_completed,
	remove_completed: Sys$Net$WebRequest$remove_completed,
	completed: Sys$Net$WebRequest$completed,
	get_url: Sys$Net$WebRequest$get_url,
	set_url: Sys$Net$WebRequest$set_url,
	get_headers: Sys$Net$WebRequest$get_headers,
	get_httpVerb: Sys$Net$WebRequest$get_httpVerb,
	set_httpVerb: Sys$Net$WebRequest$set_httpVerb,
	get_body: Sys$Net$WebRequest$get_body,
	set_body: Sys$Net$WebRequest$set_body,
	get_userContext: Sys$Net$WebRequest$get_userContext,
	set_userContext: Sys$Net$WebRequest$set_userContext,
	get_executor: Sys$Net$WebRequest$get_executor,
	set_executor: Sys$Net$WebRequest$set_executor,
	get_timeout: Sys$Net$WebRequest$get_timeout,
	set_timeout: Sys$Net$WebRequest$set_timeout,
	getResolvedUrl: Sys$Net$WebRequest$getResolvedUrl,
	invoke: Sys$Net$WebRequest$invoke
}


Sys.Net.WebRequest._resolveUrl = function Sys$Net$WebRequest$_resolveUrl(url, baseUrl) {
	if (url && url.indexOf('://') !== -1) {
		return url;
	}

	if (!baseUrl || baseUrl.length === 0) {
		var baseElement = document.getElementsByTagName('base')[0];
		if (baseElement && baseElement.href && baseElement.href.length > 0) {
			baseUrl = baseElement.href;
		}
		else {
			baseUrl = document.URL;
		}
	}

	var qsStart = baseUrl.indexOf('?');
	if (qsStart !== -1) {
		baseUrl = baseUrl.substr(0, qsStart);
	}
	qsStart = baseUrl.indexOf('#');
	if (qsStart !== -1) {
		baseUrl = baseUrl.substr(0, qsStart);
	}
	baseUrl = baseUrl.substr(0, baseUrl.lastIndexOf('/') + 1);

	if (!url || url.length === 0) {
		return baseUrl;
	}

	if (url.charAt(0) === '/') {
		var slashslash = baseUrl.indexOf('://');
		if (slashslash === -1) {
			throw Error.argument("baseUrl", Sys.Res.badBaseUrl1);
		}

		var nextSlash = baseUrl.indexOf('/', slashslash + 3);
		if (nextSlash === -1) {
			throw Error.argument("baseUrl", Sys.Res.badBaseUrl2);
		}

		return baseUrl.substr(0, nextSlash) + url;
	}
	else {
		var lastSlash = baseUrl.lastIndexOf('/');
		if (lastSlash === -1) {
			throw Error.argument("baseUrl", Sys.Res.badBaseUrl3);
		}

		return baseUrl.substr(0, lastSlash+1) + url;
	}
}

Sys.Net.WebRequest._createQueryString = function Sys$Net$WebRequest$_createQueryString(queryString, encodeMethod, addParams) {
	encodeMethod = encodeMethod || encodeURIComponent;
	var i = 0, obj, val, arg, sb = new Sys.StringBuilder();
	if (queryString) {
		for (arg in queryString) {
			obj = queryString[arg];
			if (typeof(obj) === "function") continue;
			val = Sys.Serialization.JavaScriptSerializer.serialize(obj);
			if (i++) {
				sb.append('&');
			}
			sb.append(arg);
			sb.append('=');
			sb.append(encodeMethod(val));
		}
	}
	if (addParams) {
		if (i) {
			sb.append('&');
		}
		sb.append(addParams);
	}
	return sb.toString();
}

Sys.Net.WebRequest._createUrl = function Sys$Net$WebRequest$_createUrl(url, queryString, addParams) {
	if (!queryString && !addParams) {
		return url;
	}
	var qs = Sys.Net.WebRequest._createQueryString(queryString, null, addParams);
	return qs.length
		? url + ((url && url.indexOf('?') >= 0) ? "&" : "?") + qs
		: url;
}

Sys.Net.WebRequest.registerClass('Sys.Net.WebRequest');






Type.registerNamespace('Sys.Net');

Sys.Net.WebServiceProxy = function Sys$Net$WebServiceProxy() {
}

	function Sys$Net$WebServiceProxy$get_timeout() {
		/// <value type="Number" locid="P:J#Sys.Net.WebServiceProxy.timeout"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._timeout || 0;
	}
	function Sys$Net$WebServiceProxy$set_timeout(value) {

		if (value < 0) {
			throw Error.argumentOutOfRange('value', value, Sys.Res.invalidTimeout);
		}
		this._timeout = value;
	}
	function Sys$Net$WebServiceProxy$get_defaultUserContext() {
		/// <value mayBeNull="true" locid="P:J#Sys.Net.WebServiceProxy.defaultUserContext"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return (typeof(this._userContext) === "undefined") ? null : this._userContext;
	}
	function Sys$Net$WebServiceProxy$set_defaultUserContext(value) {

		this._userContext = value;
	}
	function Sys$Net$WebServiceProxy$get_defaultSucceededCallback() {
		/// <value type="Function" mayBeNull="true" locid="P:J#Sys.Net.WebServiceProxy.defaultSucceededCallback"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._succeeded || null;
	}
	function Sys$Net$WebServiceProxy$set_defaultSucceededCallback(value) {

		this._succeeded = value;
	}
	function Sys$Net$WebServiceProxy$get_defaultFailedCallback() {
		/// <value type="Function" mayBeNull="true" locid="P:J#Sys.Net.WebServiceProxy.defaultFailedCallback"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._failed || null;
	}
	function Sys$Net$WebServiceProxy$set_defaultFailedCallback(value) {

		this._failed = value;
	}
	function Sys$Net$WebServiceProxy$get_enableJsonp() {
		/// <value type="Boolean" locid="P:J#Sys.Net.WebServiceProxy.enableJsonp"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return !!this._jsonp;
	}
	function Sys$Net$WebServiceProxy$set_enableJsonp(value) {

		this._jsonp = value;
	}
	function Sys$Net$WebServiceProxy$get_path() {
		/// <value type="String" locid="P:J#Sys.Net.WebServiceProxy.path"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._path || null;
	}
	function Sys$Net$WebServiceProxy$set_path(value) {

		this._path = value;
	}
	function Sys$Net$WebServiceProxy$get_jsonpCallbackParameter() {
		/// <value type="String" locid="P:J#Sys.Net.WebServiceProxy.jsonpCallbackParameter"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._callbackParameter || "callback";
	}
	function Sys$Net$WebServiceProxy$set_jsonpCallbackParameter(value) {

		this._callbackParameter = value;
	}
	function Sys$Net$WebServiceProxy$_invoke(servicePath, methodName, useGet, params, onSuccess, onFailure, userContext) {
		/// <summary locid="M:J#Sys.Net.WebServiceProxy._invoke" />
		/// <param name="servicePath" type="String"></param>
		/// <param name="methodName" type="String"></param>
		/// <param name="useGet" type="Boolean"></param>
		/// <param name="params"></param>
		/// <param name="onSuccess" type="Function" mayBeNull="true" optional="true"></param>
		/// <param name="onFailure" type="Function" mayBeNull="true" optional="true"></param>
		/// <param name="userContext" mayBeNull="true" optional="true"></param>
		/// <returns type="Sys.Net.WebRequest" mayBeNull="true"></returns>


		onSuccess = onSuccess || this.get_defaultSucceededCallback();
		onFailure = onFailure || this.get_defaultFailedCallback();
		if (userContext === null || typeof userContext === 'undefined') userContext = this.get_defaultUserContext();
		return Sys.Net.WebServiceProxy.invoke(servicePath, methodName, useGet, params, onSuccess, onFailure, userContext, this.get_timeout(), this.get_enableJsonp(), this.get_jsonpCallbackParameter());
	}
Sys.Net.WebServiceProxy.prototype = {
	get_timeout: Sys$Net$WebServiceProxy$get_timeout,
	set_timeout: Sys$Net$WebServiceProxy$set_timeout,
	get_defaultUserContext: Sys$Net$WebServiceProxy$get_defaultUserContext,
	set_defaultUserContext: Sys$Net$WebServiceProxy$set_defaultUserContext,
	get_defaultSucceededCallback: Sys$Net$WebServiceProxy$get_defaultSucceededCallback,
	set_defaultSucceededCallback: Sys$Net$WebServiceProxy$set_defaultSucceededCallback,
	get_defaultFailedCallback: Sys$Net$WebServiceProxy$get_defaultFailedCallback,
	set_defaultFailedCallback: Sys$Net$WebServiceProxy$set_defaultFailedCallback,
	get_enableJsonp: Sys$Net$WebServiceProxy$get_enableJsonp,
	set_enableJsonp: Sys$Net$WebServiceProxy$set_enableJsonp,
	get_path: Sys$Net$WebServiceProxy$get_path,
	set_path: Sys$Net$WebServiceProxy$set_path,
	get_jsonpCallbackParameter: Sys$Net$WebServiceProxy$get_jsonpCallbackParameter,
	set_jsonpCallbackParameter: Sys$Net$WebServiceProxy$set_jsonpCallbackParameter,
	_invoke: Sys$Net$WebServiceProxy$_invoke
}
Sys.Net.WebServiceProxy.registerClass('Sys.Net.WebServiceProxy');

Sys.Net.WebServiceProxy.invoke = function Sys$Net$WebServiceProxy$invoke(servicePath, methodName, useGet, params, onSuccess, onFailure, userContext, timeout, enableJsonp, jsonpCallbackParameter) {
	/// <summary locid="M:J#Sys.Net.WebServiceProxy.invoke" />
	/// <param name="servicePath" type="String"></param>
	/// <param name="methodName" type="String" mayBeNull="true" optional="true"></param>
	/// <param name="useGet" type="Boolean" optional="true" mayBeNull="true"></param>
	/// <param name="params" mayBeNull="true" optional="true"></param>
	/// <param name="onSuccess" type="Function" mayBeNull="true" optional="true"></param>
	/// <param name="onFailure" type="Function" mayBeNull="true" optional="true"></param>
	/// <param name="userContext" mayBeNull="true" optional="true"></param>
	/// <param name="timeout" type="Number" optional="true" mayBeNull="true"></param>
	/// <param name="enableJsonp" type="Boolean" optional="true" mayBeNull="true"></param>
	/// <param name="jsonpCallbackParameter" type="String" optional="true" mayBeNull="true"></param>
	/// <returns type="Sys.Net.WebRequest" mayBeNull="true"></returns>

	var schemeHost = (enableJsonp !== false) ? Sys.Net.WebServiceProxy._xdomain.exec(servicePath) : null,
		tempCallback, jsonp = schemeHost && (schemeHost.length === 3) &&
			((schemeHost[1] !== location.protocol) || (schemeHost[2] !== location.host));
	useGet = jsonp || useGet;
	if (jsonp) {
		jsonpCallbackParameter = jsonpCallbackParameter || "callback";
		tempCallback = "_jsonp" + Sys._jsonp++;
	}
	if (!params) params = {};
	var urlParams = params;
	if (!useGet || !urlParams) urlParams = {};
	var error, timeoutcookie = null, body = null,
		url = Sys.Net.WebRequest._createUrl(methodName
			? (servicePath+"/"+encodeURIComponent(methodName))
			: servicePath, urlParams, jsonp ? (jsonpCallbackParameter + "=Sys." + tempCallback) : null);
	if (jsonp) {
		function jsonpComplete(data, statusCode) {
			if (timeoutcookie !== null) {
				window.clearTimeout(timeoutcookie);
				timeoutcookie = null;
			}
			delete Sys[tempCallback];
			tempCallback = null;
			if ((typeof(statusCode) !== "undefined") && (statusCode !== 200)) {
				if (onFailure) {
					error = new Sys.Net.WebServiceError(false,
							data.Message || String.format(Sys.Res.webServiceFailedNoMsg, methodName),
							data.StackTrace || null,
							data.ExceptionType || null,
							data);
					error._statusCode = statusCode;
					onFailure(error, userContext, methodName);
				}
				else {
					if (data.StackTrace && data.Message) {
						error = data.StackTrace + "-- " + data.Message;
					}
					else {
						error = data.StackTrace || data.Message;
					}
					error = String.format(error ? Sys.Res.webServiceFailed : Sys.Res.webServiceFailedNoMsg, methodName, error);
					throw Sys.Net.WebServiceProxy._createFailedError(methodName, String.format(Sys.Res.webServiceFailed, methodName, error));
				}
			}
			else if (onSuccess) {
				onSuccess(data, userContext, methodName);
			}
		}
		Sys[tempCallback] = jsonpComplete;
		Sys._loadJsonp(url, function() {
			if (tempCallback) {
				jsonpComplete({ Message: String.format(Sys.Res.webServiceFailedNoMsg, methodName) }, -1);
			}
		});
		return null;
	}
	var request = new Sys.Net.WebRequest();
	request.set_url(url);
	request.get_headers()['Content-Type'] = 'application/json; charset=utf-8';
	if (!useGet) {
		body = Sys.Serialization.JavaScriptSerializer.serialize(params);
		if (body === "{}") body = "";
	}
	request.set_body(body);
	request.add_completed(onComplete);
	if (timeout && timeout > 0) request.set_timeout(timeout);
	request.invoke();
	function onComplete(response, eventArgs) {
		if (response.get_responseAvailable()) {
			var ex, statusCode = response.get_statusCode();
			var result = null;
			try {
				var contentType = response.getResponseHeader("Content-Type");
				result = contentType.startsWith("application/json") ? response.get_object() :
					(contentType.startsWith("text/xml") ? response.get_xml() : response.get_responseData());
			}
			catch (ex) {
			}

			var error = response.getResponseHeader("jsonerror");
			var errorObj = (error === "true");
			if (errorObj) {
				if (result) {
					result = new Sys.Net.WebServiceError(false, result.Message, result.StackTrace, result.ExceptionType, result);
				}
			}
			else if (contentType.startsWith("application/json")) {
				result = (!result || (typeof(result.d) === "undefined")) ? result : result.d;
			}
			if (((statusCode < 200) || (statusCode >= 300)) || errorObj) {
				if (onFailure) {
					if (!result || !errorObj) {
						result = new Sys.Net.WebServiceError(false
, String.format(Sys.Res.webServiceFailedNoMsg, methodName));
					}
					result._statusCode = statusCode;
					onFailure(result, userContext, methodName);
				}
				else {
					if (result && errorObj) {
						error = result.get_exceptionType() + "-- " + result.get_message();
					}
					else {
						error = response.get_responseData();
					}
					throw Sys.Net.WebServiceProxy._createFailedError(methodName, String.format(Sys.Res.webServiceFailed, methodName, error));
				}
			}
			else if (onSuccess) {
				onSuccess(result, userContext, methodName);
			}
		}
		else {
			var timedOut = response.get_timedOut(),
				msg = String.format((timedOut ? Sys.Res.webServiceTimedOut : Sys.Res.webServiceFailedNoMsg), methodName);
			if (onFailure) {
				onFailure(new Sys.Net.WebServiceError(timedOut, msg, "", ""), userContext, methodName);
			}
			else {
				throw Sys.Net.WebServiceProxy._createFailedError(methodName, msg);
			}
		}
	}

	return request;
}

Sys.Net.WebServiceProxy._createFailedError = function Sys$Net$WebServiceProxy$_createFailedError(methodName, errorMessage) {
	var displayMessage = "Sys.Net.WebServiceFailedException: " + errorMessage;
	var e = Error.create(displayMessage, { 'name': 'Sys.Net.WebServiceFailedException', 'methodName': methodName });
	e.popStackFrame();
	return e;
}

Sys.Net.WebServiceProxy._defaultFailedCallback = function Sys$Net$WebServiceProxy$_defaultFailedCallback(err, methodName) {
	var error = err.get_exceptionType() + "-- " + err.get_message();
	throw Sys.Net.WebServiceProxy._createFailedError(methodName, String.format(Sys.Res.webServiceFailed, methodName, error));
}



Sys.Net.WebServiceProxy._generateTypedConstructor = function Sys$Net$WebServiceProxy$_generateTypedConstructor(type) {
	return function(properties) {
		if (properties) {
			for (var name in properties) {
				this[name] = properties[name];
			}
		}
		this.__type = type;
	}
}


Sys._jsonp = 0;


Sys.Net.WebServiceProxy._xdomain = /^\s*([a-zA-Z0-9\+\-\.]+\:)\/\/([^?#\/]+)/;

Sys._loadJsonp = function _loadJsonp(src, callback) {
	var script = createElement('script');
	script.type = 'text/javascript';
	script.src = src;
	var attachEvent = script.attachEvent;
	function onEvent() {
		if (!attachEvent || /loaded|complete/.test(script.readyState)) {
			if (attachEvent) {
				script.detachEvent("onreadystatechange", onEvent);
			}
			else {
				script.removeEventListener("load", onEvent, false);
				script.removeEventListener("error", onEvent, false);
			}
			callback.apply(script);
			script = null;
		}
	}
	if (attachEvent) {
		script.attachEvent("onreadystatechange", onEvent);
	}
	else {
		script.addEventListener("load", onEvent, false);
		script.addEventListener("error", onEvent, false);
	}
	document.getElementsByTagName("head")[0].appendChild(script);
}

Sys.Net.WebServiceError = function Sys$Net$WebServiceError(timedOut, message, stackTrace, exceptionType, errorObject) {
	/// <summary locid="M:J#Sys.Net.WebServiceError.#ctor" />
	/// <param name="timedOut" type="Boolean"></param>
	/// <param name="message" type="String" mayBeNull="true"></param>
	/// <param name="stackTrace" type="String" mayBeNull="true" optional="true"></param>
	/// <param name="exceptionType" type="String" mayBeNull="true" optional="true"></param>
	/// <param name="errorObject" type="Object" mayBeNull="true" optional="true"></param>

	this._timedOut = timedOut;
	this._message = message;
	this._stackTrace = stackTrace;
	this._exceptionType = exceptionType;
	this._errorObject = errorObject;
	this._statusCode = -1;
}


	function Sys$Net$WebServiceError$get_timedOut() {
		/// <value type="Boolean" locid="P:J#Sys.Net.WebServiceError.timedOut"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._timedOut;
	}

	function Sys$Net$WebServiceError$get_statusCode() {
		/// <value type="Number" locid="P:J#Sys.Net.WebServiceError.statusCode"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._statusCode;
	}

	function Sys$Net$WebServiceError$get_message() {
		/// <value type="String" locid="P:J#Sys.Net.WebServiceError.message"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._message;
	}

	function Sys$Net$WebServiceError$get_stackTrace() {
		/// <value type="String" locid="P:J#Sys.Net.WebServiceError.stackTrace"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._stackTrace || "";
	}

	function Sys$Net$WebServiceError$get_exceptionType() {
		/// <value type="String" locid="P:J#Sys.Net.WebServiceError.exceptionType"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._exceptionType || "";
	}

	function Sys$Net$WebServiceError$get_errorObject() {
		/// <value type="Object" locid="P:J#Sys.Net.WebServiceError.errorObject"></value>
		if (arguments.length !== 0) throw Error.parameterCount();
		return this._errorObject || null;
	}
Sys.Net.WebServiceError.prototype = {
	get_timedOut: Sys$Net$WebServiceError$get_timedOut,
	get_statusCode: Sys$Net$WebServiceError$get_statusCode,
	get_message: Sys$Net$WebServiceError$get_message,
	get_stackTrace: Sys$Net$WebServiceError$get_stackTrace,
	get_exceptionType: Sys$Net$WebServiceError$get_exceptionType,
	get_errorObject: Sys$Net$WebServiceError$get_errorObject
}
Sys.Net.WebServiceError.registerClass('Sys.Net.WebServiceError');


Type.registerNamespace("Sys.Services");






var ns = Sys.Services;


var service = "Service",
	role = "Role",
	auth = "Authentication",
	profile = "Profile";
function setPath(path) {
	this._path = path;
}

ns[auth+service] = {
	set_path: setPath,
	_setAuthenticated: function(auth) {
		this._auth = auth;
	}
};
ns["_" + auth + service] = {};


ns[profile + service] = { set_path: setPath };
ns["_" + profile + service] = {};
ns.ProfileGroup = function ns$ProfileGroup(properties) {
	this._propertygroup = properties;
}


ns[role + service] = { set_path: setPath };
ns["_" + role + service] = {};


}

if (Sys.loader) {
	Sys.loader.registerScript("MicrosoftAjax", null, execute);
}
else {
	execute();
}

})(window, window.Sys);
var $get, $create, $addHandler, $addHandlers, $clearHandlers;






Type.registerNamespace('Sys');

Sys.Res={
'invokeCalledTwice':'Cannot call invoke more than once.',
'argumentTypeName':'Value is not the name of an existing type.',
'cantBeCalledAfterDispose':'Can\'t be called after dispose.',
'webServiceFailed':'The server method \'{0}\' failed with the following error: {1}',
'componentCantSetIdAfterAddedToApp':'The id property of a component can\'t be set after it\'s been added to the Application object.',
'behaviorDuplicateName':'A behavior with name \'{0}\' already exists or it is the name of an existing property on the target element.',
'notATypeName':'Value is not a valid type name.',
'elementNotFound':'An element with id \'{0}\' could not be found.',
'stateMustBeStringDictionary':'The state object can only have null and string fields.',
'invalidExecutorType':'Could not create a valid Sys.Net.WebRequestExecutor from: {0}.',
'boolTrueOrFalse':'Value must be \'true\' or \'false\'.',
'cannotCallBeforeResponse':'Cannot call {0} when responseAvailable is false.',
'scriptLoadFailedNoHead':'ScriptLoader requires pages to contain a <head> element.',
'stringFormatInvalid':'The format string is invalid.',
'referenceNotFound':'Component \'{0}\' was not found.',
'enumReservedName':'\'{0}\' is a reserved name that can\'t be used as an enum value name.',
'circularParentChain':'The chain of control parents can\'t have circular references.',
'namespaceContainsNonObject':'Object {0} already exists and is not an object.',
'undefinedEvent':'\'{0}\' is not an event.',
'invalidTimeout':'Value must be greater than or equal to zero.',
'cannotAbortBeforeStart':'Cannot abort when executor has not started.',
'observableConflict':'Object already contains a member with the name \'{0}\'.',
'invalidHttpVerb':'httpVerb cannot be set to an empty or null string.',
'nullWebRequest':'Cannot call executeRequest with a null webRequest.',
'historyCannotEnableHistory':'Cannot set enableHistory after initialization.',
'eventHandlerInvalid':'Handler was not added through the Sys.UI.DomEvent.addHandler method.',
'scriptLoadFailedDebug':'The script \'{0}\' failed to load. Check for:\r\n Inaccessible path.\r\n Script errors. (IE) Enable \'Display a notification about every script error\' under advanced settings.',
'propertyNotWritable':'\'{0}\' is not a writable property.',
'enumInvalidValueName':'\'{0}\' is not a valid name for an enum value.',
'cannotCallOnceStarted':'Cannot call {0} once started.',
'controlAlreadyDefined':'A control is already associated with the element.',
'addHandlerCantBeUsedForError':'Can\'t add a handler for the error event using this method. Please set the window.onerror property instead.',
'badBaseUrl1':'Base URL does not contain ://.',
'badBaseUrl2':'Base URL does not contain another /.',
'badBaseUrl3':'Cannot find last / in base URL.',
'setExecutorAfterActive':'Cannot set executor after it has become active.',
'cantAddNonFunctionhandler':'Can\'t add a handler that is not a function.',
'invalidNameSpace':'Value is not a valid namespace identifier.',
'notAnInterface':'Value is not a valid interface.',
'eventHandlerNotFunction':'Handler must be a function.',
'propertyNotAnArray':'\'{0}\' is not an Array property.',
'namespaceContainsClass':'Object {0} already exists as a class, enum, or interface.',
'typeRegisteredTwice':'Type {0} has already been registered. The type may be defined multiple times or the script file that defines it may have already been loaded. A possible cause is a change of settings during a partial update.',
'cantSetNameAfterInit':'The name property can\'t be set on this object after initialization.',
'historyMissingFrame':'For the history feature to work in IE, the page must have an iFrame element with id \'__historyFrame\' pointed to a page that gets its title from the \'title\' query string parameter and calls Sys.Application._onIFrameLoad() on the parent window. This can be done by setting EnableHistory to true on ScriptManager.',
'appDuplicateComponent':'Two components with the same id \'{0}\' can\'t be added to the application.',
'historyCannotAddHistoryPointWithHistoryDisabled':'A history point can only be added if enableHistory is set to true.',
'expectedElementOrId':'Value must be a DOM element or DOM element id.',
'selectorNotFound':'An element with selector \'{0}\' could not be found.',
'cannotCallOutsideHandler':'Cannot call {0} outside of a completed event handler.',
'methodNotFound':'No method found with name \'{0}\'.',
'arrayParseBadFormat':'Value must be a valid string representation for an array. It must start with a \'[\' and end with a \']\'.',
'cannotSerializeObjectWithCycle':'Cannot serialize object with cyclic reference within child properties.',
'stateFieldNameInvalid':'State field names must not contain any \'=\' characters.',
'stringFormatBraceMismatch':'The format string contains an unmatched opening or closing brace.',
'enumValueNotInteger':'An enumeration definition can only contain integer values.',
'propertyNullOrUndefined':'Cannot set the properties of \'{0}\' because it returned a null value.',
'expectedDomElementOrSelector':'\'{0}\' must be a DOM element or DOM element selector.',
'argumentDomNode':'Value must be a DOM element or a text node.',
'componentCantSetIdTwice':'The id property of a component can\'t be set more than once.',
'createComponentOnDom':'Value must be null for Components that are not Controls or Behaviors.',
'createNoDom':'Value must not be null for Controls and Behaviors.',
'cantAddWithoutId':'Can\'t add a component that doesn\'t have an id.',
'urlTooLong':'The history state must be small enough to not make the url larger than {0} characters.',
'notObservable':'Instances of type \'{0}\' cannot be observed.',
'badTypeName':'Value is not the name of the type being registered or the name is a reserved word.',
'argumentInteger':'Value must be an integer.',
'argumentType':'Object cannot be converted to the required type.',
'argumentNull':'Value cannot be null.',
'scriptAlreadyLoaded':'The script \'{0}\' has been referenced multiple times. If referencing Microsoft AJAX scripts explicitly, set the MicrosoftAjaxMode property of the ScriptManager to Explicit.',
'scriptDependencyNotFound':'The script \'{0}\' failed to load because it is dependent on script \'{1}\'.',
'formatBadFormatSpecifier':'Format specifier was invalid.',
'requiredScriptReferenceNotIncluded':'\'{0}\' requires that you have included a script reference to \'{1}\'.',
'webServiceFailedNoMsg':'The server method \'{0}\' failed.',
'argumentDomElement':'Value must be a DOM element.',
'actualValue':'Actual value was {0}.',
'enumInvalidValue':'\'{0}\' is not a valid value for enum {1}.',
'scriptLoadFailed':'The script \'{0}\' could not be loaded.',
'parameterCount':'Parameter count mismatch.',
'cannotDeserializeEmptyString':'Cannot deserialize empty string.',
'formatInvalidString':'Input string was not in a correct format.',
'argument':'Value does not fall within the expected range.',
'cannotDeserializeInvalidJson':'Cannot deserialize. The data does not correspond to valid JSON.',
'cannotSerializeNonFiniteNumbers':'Cannot serialize non finite numbers.',
'argumentUndefined':'Value cannot be undefined.',
'webServiceInvalidReturnType':'The server method \'{0}\' returned an invalid type. Expected type: {1}',
'servicePathNotSet':'The path to the web service has not been set.',
'argumentTypeWithTypes':'Object of type \'{0}\' cannot be converted to type \'{1}\'.',
'paramName':'Parameter name: {0}',
'nullReferenceInPath':'Null reference while evaluating data path: \'{0}\'.',
'format':'One of the identified items was in an invalid format.',
'assertFailedCaller':'Assertion Failed: {0}\r\nat {1}',
'argumentOutOfRange':'Specified argument was out of the range of valid values.',
'webServiceTimedOut':'The server method \'{0}\' timed out.',
'notImplemented':'The method or operation is not implemented.',
'assertFailed':'Assertion Failed: {0}',
'invalidOperation':'Operation is not valid due to the current state of the object.',
'breakIntoDebugger':'{0}\r\n\r\nBreak into debugger?'
};


/***/ }),

/***/ "../../../Public/ExoWeb/ExoWeb/client/ref/aspnetajax/MicrosoftAjaxTemplates.debug.js":
/*!****************************************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Public/ExoWeb/ExoWeb/client/ref/aspnetajax/MicrosoftAjaxTemplates.debug.js ***!
  \****************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

// Name:        MicrosoftAjaxTemplates.debug.js
// Assembly:    System.Web.Ajax
// Version:     3.0.31106.0
// FileVersion: 3.0.31106.0
/// <reference name="MicrosoftAjaxComponentModel.js" />
/// <reference name="MicrosoftAjaxSerialization.js" />



(function () {

	function execute() {
		Type._registerScript("MicrosoftAjaxTemplates.js", ["MicrosoftAjaxComponentModel.js", "MicrosoftAjaxSerialization.js"]);

		var merge = Sys._merge,
			foreach = Sys._foreach,
			forIn = Sys._forIn,
			indexOf = Sys._indexOf,
			isBrowser = Sys._isBrowser;

		function serialize(obj) {
			return Sys.Serialization.JavaScriptSerializer.serialize(obj);
		}

		Type.registerNamespace("Sys.Net");

		Sys.Net.WebRequestEventArgs = function Sys$Net$WebRequestEventArgs(executor, error, result) {
			/// <summary locid="M:J#Sys.Net.WebRequestEventArgs.#ctor" />
			/// <param name="executor" type="Sys.Net.WebRequestExecutor" mayBeNull="true"></param>
			/// <param name="error" type="Sys.Net.WebServiceError" optional="true" mayBeNull="true"></param>
			/// <param name="result" optional="true" mayBeNull="true"></param>
			this._executor = executor;
			this._error = error || null;
			this._result = typeof (result) === "undefined" ? null : result;
			Sys.Net.WebRequestEventArgs.initializeBase(this);
		}

		function Sys$Net$WebRequestEventArgs$get_error() {
			/// <value type="Sys.Net.WebServiceError" mayBeNull="true" locid="P:J#Sys.Net.WebRequestEventArgs.error"></value>
			return this._error || null;
		}
		function Sys$Net$WebRequestEventArgs$get_executor() {
			/// <value type="Sys.Net.WebRequestExecutor" mayBeNull="true" locid="P:J#Sys.Net.WebRequestEventArgs.executor"></value>
			return this._executor;
		}
		function Sys$Net$WebRequestEventArgs$get_result() {
			/// <value mayBeNull="true" locid="P:J#Sys.Net.WebRequestEventArgs.result"></value>
			return this._result;
		}
		Sys.Net.WebRequestEventArgs.prototype = {
			get_error: Sys$Net$WebRequestEventArgs$get_error,
			get_executor: Sys$Net$WebRequestEventArgs$get_executor,
			get_result: Sys$Net$WebRequestEventArgs$get_result
		};
		Sys.Net.WebRequestEventArgs.registerClass("Sys.Net.WebRequestEventArgs", Sys.EventArgs);

		Type.registerNamespace("Sys.Data");

		Sys.Data.DataEventArgs = function Sys$Data$DataEventArgs(data) {
			/// <summary locid="M:J#Sys.Data.DataEventArgs.#ctor" />
			/// <param name="data" mayBeNull="true"></param>
			this._data = data;
			Sys.Data.DataEventArgs.initializeBase(this);
		}

		function Sys$Data$DataEventArgs$get_data() {
			/// <value mayBeNull="true" locid="P:J#Sys.Data.DataEventArgs.data"></value>
			var d = this._data;
			return (typeof (d) === "undefined" ? null : d);
		}
		function Sys$Data$DataEventArgs$set_data(value) {
			this._data = value;
		}
		function Sys$Data$DataEventArgs$get_itemPlaceholder() {
			/// <value mayBeNull="true" locid="P:J#Sys.Data.DataEventArgs.itemPlaceholder"></value>
			return this._placeholder || null;
		}
		function Sys$Data$DataEventArgs$set_itemPlaceholder(value) {
			this._placeholder = value;
		}
		function Sys$Data$DataEventArgs$get_itemTemplate() {
			/// <value mayBeNull="true" locid="P:J#Sys.Data.DataEventArgs.itemTemplate"></value>
			return this._itemTemplate || null;
		}
		function Sys$Data$DataEventArgs$set_itemTemplate(value) {
			this._itemTemplate = value;
		}
		Sys.Data.DataEventArgs.prototype = {
			get_data: Sys$Data$DataEventArgs$get_data,
			set_data: Sys$Data$DataEventArgs$set_data,
			get_itemPlaceholder: Sys$Data$DataEventArgs$get_itemPlaceholder,
			set_itemPlaceholder: Sys$Data$DataEventArgs$set_itemPlaceholder,
			get_itemTemplate: Sys$Data$DataEventArgs$get_itemTemplate,
			set_itemTemplate: Sys$Data$DataEventArgs$set_itemTemplate
		};
		Sys.Data.DataEventArgs.registerClass("Sys.Data.DataEventArgs", Sys.CancelEventArgs);

		if (!Sys.Data.IDataProvider) {
			Sys.Data.IDataProvider = function Sys$Data$IDataProvider() {
			}

			function Sys$Data$IDataProvider$fetchData(operation, parameters, mergeOption, httpVerb, succeededCallback, failedCallback, timeout, userContext) {
				/// <summary locid="M:J#Sys.Data.IDataProvider.fetchData" />
				/// <param name="operation"></param>
				/// <param name="parameters" type="Object" mayBeNull="true" optional="true"></param>
				/// <param name="mergeOption" type="Sys.Data.MergeOption" mayBeNull="true" optional="true"></param>
				/// <param name="httpVerb" type="String" mayBeNull="true" optional="true"></param>
				/// <param name="succeededCallback" type="Function" mayBeNull="true" optional="true"></param>
				/// <param name="failedCallback" type="Function" mayBeNull="true" optional="true"></param>
				/// <param name="timeout" type="Number" integer="true" mayBeNull="true" optional="true"></param>
				/// <param name="userContext" mayBeNull="true" optional="true"></param>
				/// <returns type="Sys.Net.WebRequest"></returns>
				throw Error.notImplemented();
			}
			Sys.Data.IDataProvider.prototype = {
				fetchData: Sys$Data$IDataProvider$fetchData
			}
			Sys.Data.IDataProvider.registerInterface("Sys.Data.IDataProvider");
		}
		if (!Sys.Data.MergeOption) {
			Sys.Data.MergeOption = function Sys$Data$MergeOption() {
				/// <summary locid="M:J#Sys.Data.MergeOption.#ctor" />
				/// <field name="appendOnly" type="Number" integer="true" static="true" locid="F:J#Sys.Data.MergeOption.appendOnly"></field>
				/// <field name="overwriteChanges" type="Number" integer="true" static="true" locid="F:J#Sys.Data.MergeOption.overwriteChanges"></field>
				throw Error.notImplemented();
			}




			Sys.Data.MergeOption.prototype = {
				appendOnly: 0,
				overwriteChanges: 1
			}
			Sys.Data.MergeOption.registerEnum("Sys.Data.MergeOption");

		}

		Type.registerNamespace("Sys.UI");

		Sys.Application.registerMarkupExtension = function Sys$Application$registerMarkupExtension(extensionName, extension, isExpression) {
			/// <summary locid="M:J#Sys.Application.registerMarkupExtension" />
			/// <param name="extensionName" type="String"></param>
			/// <param name="extension" type="Function"></param>
			/// <param name="isExpression" type="Boolean" optional="true"></param>
			if (!this._extensions) {
				this._extensions = {};
			}
			isExpression = ((typeof (isExpression) === "undefined") || (isExpression === true));
			this._extensions[extensionName] = { expression: isExpression, extension: extension };
		}
		Sys.Application._getMarkupExtension = function Sys$Application$_getMarkupExtension(name) {
			var extension = this._extensions ? this._extensions[name] : null;
			if (!extension) {
				throw Error.invalidOperation(String.format(Sys.UI.TemplatesRes.cannotFindMarkupExtension, name));
			}
			return extension;
		}
		Sys.UI.Template = function Sys$UI$Template(element) {
			/// <summary locid="M:J#Sys.UI.Template.#ctor" />
			/// <param name="element" domElement="true" mayBeNull="false"></param>
			this._element = element;
			this._instantiateIn = null;
			this._instanceId = 0;
		}

		function Sys$UI$Template$get_element() {
			/// <value domElement="true" locid="P:J#Sys.UI.Template.element"></value>
			return this._element;
		}
		function Sys$UI$Template$dispose() {
			this._element = null;
			this._instantiateIn = null;
		}
		function Sys$UI$Template$_appendTextNode(code, storeElementCode, text) {
			code.push(storeElementCode, "document.createTextNode(", serialize(text), "));\n");
		}
		function Sys$UI$Template$_appendAttributeSetter(code, typeIndex, attrib, expression, isExpression, booleanValue) {
			var ns = attrib.ns, name = attrib.name, restricted = (!ns && Sys.UI.Template._isRestricted(name));
			if (restricted) {
				expression = "Sys.UI.Template._checkAttribute('" + name + "', " + expression + ")";
			}
			switch (attrib.type) {
				case 1:
					code.push("  $component = $element;\n  ");
					if (isExpression) {
						if (attrib.textNode) {
							code.push("container.appendChild(document.createTextNode(", expression, "));\n");
						}
						else {
							code.push("$element.", name, " = ", expression, ";\n");
						}
					}
					else {
						code.push(expression, ";\n");
					}
					if (attrib.textNode || name === "innerHTML") return true;
					break;
				case 2:
					if (isExpression) {
						name = serialize(name);
						code.push("  $component = $element;\n    (", expression,
								") ? Sys.UI.DomElement.addCssClass($element, ", name,
								") : Sys.UI.DomElement.removeCssClass($element, ", name, ");\n");
					}
					else {
						code.push("  $component = $element;\n  ", expression, ";\n");
					}
					break;
				case 3:
					var index = typeIndex[ns];
					if (index.isClass) {
						code.push("  $component = __componentIndex['", ns, "'];\n");
						if (isExpression) {
							var map = attrib.map;
							if (map.type === 1) {
								code.push("  $component.", map.setterName, "(", expression, ");\n");
							}
							else if (map.type === 2) {
								code.push("  __f = ", expression, ";\n",
									  "  $component.", map.setterName, '(typeof(__f) === "function" ? __f : new Function("sender", "args", __f));\n');
							}
							else {
								code.push("  $component['", map.name, "'] = ", expression, ";\n");
							}
						}
						else {
							code.push("  ", expression, ";\n");
						}
					}
					else {
						if (!isExpression) {
							throw Error.invalidOperation();
						}
						var prop = serialize(attrib.name) + ": " + expression;
						if (!index.props) {
							index.props = prop;
						}
						else {
							index.props += ", " + prop;
						}
					}
					break;
				case 4:
					this["_" + name] = expression;
					break;
				default:
					if (isExpression) {
						if (/^on/i.test(name)) {
							code.push("  $component = $element;\n  $element." + name + " = new Function(" +
							(document.attachEvent ? "" : "'event', ") + expression + ");\n");
						}
						else {
							if (booleanValue) {
								code.push("  $component = $element;\n  if (" + expression +
										") {\n    __e = document.createAttribute('" + name +
										"');\n    __e.nodeValue = \"" + booleanValue + "\";\n    $element.setAttributeNode(__e);\n  }\n");
							}
							else {
								code.push("  $component = $element;\n  __e = document.createAttribute('" + name + "');\n  __e.nodeValue = " +
									expression + ";\n  $element.setAttributeNode(__e);\n");
							}
						}
					}
					else {
						code.push("  $component = $element;\n  " + expression + ";\n");
					}
					break;
			}
			return false;
		}
		function Sys$UI$Template$_processAttribute(code, typeIndex, attrib, value, booleanValue) {
			value = this._getAttributeExpression(attrib, value);
			if (value) {
				return this._appendAttributeSetter(code, typeIndex, attrib,
				value.code, value.isExpression, booleanValue);
			}
			return false;
		}
		function Sys$UI$Template$_getAttributeExpression(attrib, value, noSerialize) {
			var type = typeof (value);
			if (type === "undefined") return null;
			if (value === null) return { isExpression: true, code: "null" };
			if (!attrib.isNative && (type === "string")) {
				if (value.startsWith("{{") && value.endsWith("}}")) {
					return { isExpression: true, code: value.slice(2, -2).trim() };
				}
				else if (value.startsWith("{") && value.endsWith("}")) {
					var ext = Sys.Application._getExtensionCode(value.slice(1, -1)),
					properties = ext.properties,
					props = "";
					for (var name in properties) {
						var subValue = this._getAttributeExpression(attrib, properties[name]);
						if (subValue && subValue.isExpression) {
							var prop = serialize(name) + ":" + subValue.code;
							if (props) {
								props += "," + prop;
							}
							else {
								props = prop;
							}
						}
					}
					return { isExpression: ext.instance.expression,
						code: "Sys.Application._getMarkupExtension(" + serialize(ext.name) + ").extension($component, " +
						serialize((attrib.type === 2 ? "class:" : "") + attrib.name) +
						", $context, {" + props + "})"
					};
				}
			}
			if (attrib.isId) {
				noSerialize = true;
				value = '$id(' + serialize(value) + ')';
			}
			return { isExpression: true, code: (noSerialize ? value : serialize(value)) };
		}
		function Sys$UI$Template$_processBooleanAttribute(element, code, typeIndex, name) {
			var value, isNative, node = element.getAttributeNode("sys:" + name);
			if (!node) {
				isNative = true;
				node = element.getAttributeNode(name);
				if (node && (node.specified || (node.nodeValue === true))) {
					value = true;
				}
				else if (element.getAttribute(name) === name) {
					value = true;
				}
				else {
					return;
				}
			}
			else {
				value = node.nodeValue;
				if (value === "true") {
					value = true;
				}
				else if (value === "false") {
					return;
				}
			}
			this._processAttribute(code, typeIndex, { name: name, isNative: isNative }, value, name);
		}
		function Sys$UI$Template$_processBooleanAttributes(element, code, typeIndex, attributes) {
			var name, node, value;
			for (var i = 0, l = attributes.length; i < l; i++) {
				this._processBooleanAttribute(element, code, typeIndex, attributes[i]);
			}
		}
		function Sys$UI$Template$_processCodeBlock(name, element, code) {
			var value = this._getExplicitAttribute(null, null, element, name);
			if (value) {
				value = this._getAttributeExpression({ name: name }, value, true).code;
				code.push((name === "sys:if") ? ("  if (" + value + ") {\n")
						: ("  " + value + "\n"));
			}
			return !!value;
		}
		function Sys$UI$Template$_getExplicitAttribute(code, typeIndex, element, name, processName, isNative, attrib) {
			var e, node, value;
			if (name === "style" && element.style) {
				value = element.style.cssText;
			}
			else {
				try {
					// JBP: In IE9 the getAttributeNode method handles 'class' special, in that it appears to actually create
					// a new 'class' attribute and sets the value to empty string if it doesn't exist on the element.
					// This behavior appears to affect the sys:class attribute value, as it is also set to empty string after the getAttributeNode method is called.

					if (name.toLowerCase() === "class" && Sys.Browser.agent === Sys.Browser['InternetExplorer'] && Sys.Browser.version >= 9) {
						if (!element.className) {
							return;
						} else {
							// HACK: evaluate the sys:class attribute, which somehow sets the class attribute equal to sys:class value
							element.getAttributeNode("sys:class");
						}
					}

					node = element.getAttributeNode(name);

					if (node && node.specified) {
						value = node.nodeValue;
					}
				}
				catch (e) {
				}
			}
			if (value && processName) {
				this._processAttribute(code, typeIndex, merge({ name: processName, type: 1, isNative: isNative }, attrib), value);
			}
			return value;
		}
		function Sys$UI$Template$_buildTemplateCode(nestedTemplates, element, code, depth) {
			var i, j, l, m, typeName, isInput, isButton,
			expressionRegExp = Sys.UI.Template._expressionRegExp,
			storeElementCode = "  " + (depth ? ("__p[__d-1].appendChild(") : "__topElements.push("),
			useDirect = isBrowser("InternetExplorer") && Sys.Browser.version < 9;
			code.push("  __d++;\n");
			for (i = 0, l = element.childNodes.length; i < l; i++) {
				var childNode = element.childNodes[i], text = childNode.nodeValue;

				if (childNode.nodeType === 8) {
					code.push(storeElementCode + "document.createComment(" + serialize(text) + "));\n");
				}
				else if (childNode.nodeType === 3) {
					var trimText = text.trim();
					if (trimText.startsWith("{") && trimText.endsWith("}") && (!trimText.startsWith("{{") || !trimText.endsWith("}}"))) {
						var attribName, setComponentCode;
						setComponentCode = '$component=$element;\n';
						if (element.tagName.toLowerCase() === "textarea") {
							attribName = "value";
						}
						else {
							attribName = "innerText";
						}
						var expr = this._getAttributeExpression({ name: attribName }, trimText);
						if (expr.isExpression) {
							code.push(storeElementCode, "document.createTextNode(", expr.code, "));\n");
						}
						else {
							code.push('$component=$element;\n', '  ', expr.code, ';\n');
						}
					}
					else {
						var match = expressionRegExp.exec(text), lastIndex = 0;
						while (match) {
							var catchUpText = text.substring(lastIndex, match.index);
							if (catchUpText) {
								this._appendTextNode(code, storeElementCode, catchUpText);
							}
							code.push(storeElementCode, "document.createTextNode(", match[1], "));\n");
							lastIndex = match.index + match[0].length;
							match = expressionRegExp.exec(text);
						}
						if (lastIndex < text.length) {
							this._appendTextNode(code, storeElementCode, text.substr(lastIndex));
						}
					}
				}
				else {
					var attributes = childNode.attributes,
						typeNames = null, sysAttribute = null, typeIndex = {},
						tagName = childNode.tagName.toLowerCase(),
						booleanAttributes, dp1 = depth + 1, contentTemplate;
					if (tagName === "script") {
						continue;
					}
					var isCodeIfGenerated = this._processCodeBlock("sys:if", childNode, code);
					this._processCodeBlock("sys:codebefore", childNode, code);
					contentTemplate = this._getExplicitAttribute(null, null, childNode, "sys:content-template");
					if (contentTemplate) {
						if (contentTemplate.constructor !== String) throw new Error("The sys:content-template attribute value must be a string.");
						code.push("  __contentTemplates.push('" + contentTemplate + "');\n");
					}
					isButton = (tagName === "button");
					isInput = isButton || (tagName === "input");
					if (isInput) {
						var typeExpression = childNode.getAttribute("sys:type");
						typeExpression = typeExpression ?
						this._getAttributeExpression({ name: "type" }, typeExpression) :
						this._getAttributeExpression({ name: "type", isNative: true }, childNode.getAttribute("type"));
						var nameExpression = childNode.getAttribute("sys:name");
						nameExpression = nameExpression ?
						this._getAttributeExpression({ name: "name" }, nameExpression) :
						this._getAttributeExpression({ name: "name", isNative: true }, childNode.getAttribute("name"));
						if (!typeExpression.isExpression || !nameExpression.isExpression) {
							throw Error.invalidOperation(Sys.UI.TemplatesRes.mustSetInputElementsExplicitly);
						}
						code.push("  $element=container=__p[__d]=Sys.UI.Template._createInput(" + typeExpression.code + ", " + nameExpression.code + ", " + isButton + ");\n");
						booleanAttributes = Sys.UI.Template._inputBooleanAttributes;
						this._processBooleanAttributes(childNode, code, typeIndex, booleanAttributes[" list"]);
					}
					else {
						code.push("  $element=container=__p[__d]=document.createElement('" + childNode.nodeName + "');\n");
					}
					if (!depth) {
						code.push(" $element.__mstcindex = $context._tcindex;\n");
					}
					this._getExplicitAttribute(code, typeIndex, childNode, "sys:id", "id", false, { isId: true }) ||
					this._getExplicitAttribute(code, typeIndex, childNode, "id", "id", true, { isId: true });

					typeNames = this._getExplicitAttribute(code, typeIndex, childNode, "sys:attach");
					if (typeNames) {
						typeNames = typeNames.split(',');
						code.push("  __componentIndex = {}\n");
						for (j = 0, m = typeNames.length; j < m; j++) {
							typeName = typeNames[j].trim();
							if (typeIndex[typeName]) continue;
							var type = Sys.Application._findType(childNode, typeName, useDirect);
							if (!type) {
								throw Error.invalidOperation(String.format(Sys.UI.TemplatesRes.invalidAttach, "sys:attach", typeName));
							}
							var isComponent, isControlOrBehavior, isContext, isContentTemplate, isClass = typeof (type) !== "string";
							if (isClass) {
								isComponent = type.inheritsFrom(Sys.Component);
								isControlOrBehavior = (isComponent && (type.inheritsFrom(Sys.UI.Behavior) || type.inheritsFrom(Sys.UI.Control)));
								isContext = type.implementsInterface(Sys.UI.ITemplateContextConsumer);
								isContentTemplate = type.implementsInterface(Sys.UI.IContentTemplateConsumer);
							}
							typeIndex[typeName] = { type: type, isClass: isClass, isComponent: isComponent };
							if (isClass) {
								code.push("  __componentIndex['" + typeName + "'] = $component = new " + type.getName());
								if (isControlOrBehavior) {
									code.push("($element);\n");
								}
								else {
									code.push("();\n  Sys.Application._registerComponent($element, $component);\n");
								}
								if (isComponent) {
									code.push("  $component.beginUpdate();\n");
								}
								if (isContext) {
									code.push("  $component.set_templateContext($context);\n");
								}
								if (isContentTemplate) {
									code.push("  if (__parentContentTemplate && __parentContentTemplate.length > 0) $component.addContentTemplate(__parentContentTemplate);\n");
									code.push("  if (__contentTemplates.length > 0) $component.addContentTemplate(__contentTemplates.join(' '));\n");
								}
								var idattr = typeName + ":id",
								typeattr = Sys.Application._splitAttribute(idattr, false, typeIndex);
								typeattr.isId = true;
								this._getExplicitAttribute(code, typeIndex, childNode, idattr, "id", false, typeattr);
							}
						}
					}
					this._getExplicitAttribute(code, typeIndex, childNode, "style", "style.cssText", true);
					this._getExplicitAttribute(code, typeIndex, childNode, "class", "className", true);
					if (!isInput) {
						booleanAttributes = Sys.UI.Template._booleanAttributes[tagName] ||
						Sys.UI.Template._commonBooleanAttributes;
						this._processBooleanAttributes(childNode, code, typeIndex, booleanAttributes[" list"]);
					}
					var isSelect = (tagName === "select"),
					delayedAttributes = null,
					split = Sys.Application._splitAttribute,
					skipChildren = false,
					skip = { 'id': 1, 'class': 1, 'style': 1, 'sys:attach': 1, 'sys:id': 1, 'sys:disabled': 1, 'sys:checked': 1, 'sys:readonly': 1, 'sys:ismap': 1, 'sys:multiple': 1, 'sys:selected': 1, 'sys:if': 1, 'sys:codebefore': 1, 'sys:codeafter': 1, 'sys:content-template': 1 };
					for (j = 0, m = attributes.length; j < m; j++) {
						var attribute = attributes[j], name = attribute.nodeName, lowerName = name.toLowerCase();

						// HACK: IE includes user-defined attributes, as well as attributes added to an element
						// via JavaScript. This causes undesirable behavior when these attributes are copied to
						// a DOM element via template rendering. For example, in the case of jQuery data, the
						// template element and resulting rendered element will share the same data cache since
						// they have the same value for the expando attribute that is used as the cache key.
						if (name.indexOf("jQuery") === 0)
							continue;

						if (!attribute.specified && (!isInput || lowerName !== "value")) continue;
						if (skip[lowerName] || booleanAttributes[lowerName]) continue;
						if (isInput && Sys.UI.Template._inputRequiredAttributes[lowerName]) continue;
						var attrib = split(name, isSelect, typeIndex),
						ns = attrib.ns,
						value = attribute.nodeValue,
						atype = attrib.type;
						name = attrib.name;
						if (atype === 1) {
							if (isSelect && (!ns || ns === "sys")) {
								delayedAttributes = delayedAttributes || [];
								delayedAttributes.push([attrib, value]);
								continue;
							}
							skip[name.toLowerCase()] = true;
						}
						else if (atype === 0) {
							skip[name.toLowerCase()] = true;
						}
						else if (atype === 3 && name === "id" && typeIndex[ns] && typeIndex[ns].isClass) {
							continue;
						}
						if (this._processAttribute(code, typeIndex, attrib, value)) {
							skipChildren = true;
						}
					}
					if (this._command) {
						code.push(" Sys.UI.DomElement.setCommand($element, " + this._command + ", " + (this._commandargument || 'null') + ", Sys.UI.DomElement._ensureGet(" + (this._commandtarget || 'null') + ", $context, 'sys:commandtarget'));\n");
						this._command = null;
					}
					this._commandargument = null;
					this._commandtarget = null;

					code.push(storeElementCode + "$element);\n");
					for (typeName in typeIndex) {
						var index = typeIndex[typeName];
						if (index.isClass) {
							code.push("  $context._registerComponent(__componentIndex['" + typeName + "']);\n");
						}
						else {
							code.push("  $context._registerIf(");
							code.push(index.type);
							code.push("($element, ");
							code.push("{" + (index.props || "") + "}, $context));\n");
						}
					}
					if (Sys.UI.Template._isTemplate(childNode)) {
						var nestedTemplate = new Sys.UI.Template(childNode);
						nestedTemplate.recompile();
						nestedTemplates.push(childNode._msajaxtemplate);
						code.push("  $element._msajaxtemplate = this.get_element()._msajaxtemplate[2][" + (nestedTemplates.length - 1) + "];\n");
					}
					else if (!skipChildren) {
						this._buildTemplateCode(nestedTemplates, childNode, code, dp1);
						code.push("  $element=container=__p[__d];\n");
					}
					if (delayedAttributes) {
						for (j = 0, m = delayedAttributes.length; j < m; j++) {
							attribute = delayedAttributes[j];
							this._processAttribute(code, typeIndex, attribute[0], attribute[1]);
						}
					}
					if (contentTemplate) {
						code.push("  __contentTemplates.pop();\n");
					}
					this._processCodeBlock("sys:codeafter", childNode, code);
					if (isCodeIfGenerated) {
						code.push("  }\n");
					}
				}
			}
			code.push("  --__d;\n");
		}
		function Sys$UI$Template$_ensureCompiled() {
			if (!this._instantiateIn) {
				var element = this.get_element();
				if (element._msajaxtemplate) {
					this._instantiateIn = element._msajaxtemplate[0];
				}
				else {
					this.recompile();
				}
			}
		}
		function Sys$UI$Template$recompile() {
			/// <summary locid="M:J#Sys.UI.Template.recompile" />
			var element = this.get_element(),
			code = [" $index = (typeof($index) === 'number' ? $index : __instanceId);\n var fragment=document.createDocumentFragment(), $component, __componentIndex, __e, __f, __topElements = [], __d = 0, __p = [fragment], $element = __containerElement, container = fragment, $context = new Sys.UI.TemplateContext(), __contentTemplates = [], $id = function(prefix) { return $context.getInstanceId(prefix); };\n $context.data = (typeof(__data) === 'undefined' ? null : __data);\n $context.components = [];\n $context.nodes = __topElements;\n $context.dataItem = $dataItem;\n $context.index = $index;\n $context.parentContext = __parentContext;\n $context.rootContext = __parentContext.rootContext;\n $context.containerElement = __containerElement;\n $context.insertBeforeNode = __referenceNode;\n $context.template = this;\n with($dataItem || {}) {\n"],
			nestedTemplates = [];
			this._buildTemplateCode(nestedTemplates, element, code, 0);
			code.push("}\n __containerElement.appendChild(fragment);\n $context._onInstantiated(__referenceNode);\n return $context;");
			code = code.join('');
			element._msajaxtemplate = [this._instantiateIn = new Function("__containerElement", "$rootContext", "$vm", "$emit", "__data", "$dataItem", "$index", "__referenceNode", "__parentContext", "__parentContentTemplate", "__instanceId", code), element, nestedTemplates];
		}
		function Sys$UI$Template$instantiateIn(containerElement, data, dataItem, dataIndex, nodeToInsertTemplateBefore, parentContext, parentContentTemplate) {
			/// <summary locid="M:J#$id" />
			/// <param name="containerElement"></param>
			/// <param name="data" optional="true" mayBeNull="true"></param>
			/// <param name="dataItem" optional="true" mayBeNull="true"></param>
			/// <param name="dataIndex" optional="true" mayBeNull="true" type="Number" integer="true"></param>
			/// <param name="nodeToInsertTemplateBefore" optional="true" mayBeNull="true"></param>
			/// <param name="parentContext" type="Sys.UI.TemplateContext" optional="true" mayBeNull="true"></param>
			/// <param name="parentContentTemplate" type="String" optional="true" mayBeNull="true"></param>
			/// <returns type="Sys.UI.TemplateContext"></returns>
			containerElement = Sys.UI.DomElement._ensureGet(containerElement, null, "containerElement");
			nodeToInsertTemplateBefore = Sys.UI.DomElement._ensureGet(nodeToInsertTemplateBefore, null, "nodeToInsertTemplateBefore");
			this._ensureCompiled();
			return this._instantiateIn(containerElement, parentContext.rootContext, parentContext.rootContext.vm, parentContext.rootContext.vm ? parentContext.rootContext.vm.$emit.bind(parentContext.rootContext.vm) : null, data, dataItem, dataIndex, nodeToInsertTemplateBefore, parentContext, parentContentTemplate, this._instanceId++);
		}

		Sys.UI.Template.prototype = {
			get_element: Sys$UI$Template$get_element,
			dispose: Sys$UI$Template$dispose,
			_appendTextNode: Sys$UI$Template$_appendTextNode,
			_appendAttributeSetter: Sys$UI$Template$_appendAttributeSetter,
			_processAttribute: Sys$UI$Template$_processAttribute,
			_getAttributeExpression: Sys$UI$Template$_getAttributeExpression,
			_processBooleanAttribute: Sys$UI$Template$_processBooleanAttribute,
			_processBooleanAttributes: Sys$UI$Template$_processBooleanAttributes,
			_processCodeBlock: Sys$UI$Template$_processCodeBlock,
			_getExplicitAttribute: Sys$UI$Template$_getExplicitAttribute,
			_buildTemplateCode: Sys$UI$Template$_buildTemplateCode,
			_ensureCompiled: Sys$UI$Template$_ensureCompiled,
			recompile: Sys$UI$Template$recompile,
			instantiateIn: Sys$UI$Template$instantiateIn
		}
		Sys.UI.Template._isRestricted = function Sys$UI$Template$_isRestricted(name) {
			var restricted = Sys.UI.Template._getRestrictedIndex();
			return restricted.attributes[name.toLowerCase()];
		}
		Sys.UI.Template._checkAttribute = function Sys$UI$Template$_checkAttribute(name, value) {
			if (value === null || value === undefined) return value;
			var newValue = value, restricted = Sys.UI.Template._getRestrictedIndex();
			if (restricted.attributes[name.toLowerCase()]) {
				if (typeof (value) !== "string") {
					value = value.toString();
				}
				var match = Sys.UI.Template._protocolRegExp.exec(value.toLowerCase());
				if (match) {
					if (!restricted.protocols[match[1]]) {
						newValue = "";
					}
				}
			}
			return newValue;
		}
		Sys.UI.Template._getIdFunction = function Sys$UI$Template$_getIdFunction(instance) {
			return function (prefix) {
				return prefix + instance;
			}
		}
		Sys.UI.Template._createInput = function Sys$UI$Template$_createInput(type, name, isButton) {
			var err, element, callee = arguments.callee, dynamic = callee._dynamic;
			if (dynamic === true) {
				element = document.createElement(isButton ? 'button' : 'input');
				if (type) {
					element.setAttribute("type", type);
				}
				if (name) {
					element.setAttribute("name", name);
				}
			}
			else {
				var html = isButton ? "<button " : "<input ";
				if (type) {
					html += "type='" + type + "' ";
				}
				if (name) {
					html += "name='" + name + "' ";
				}
				html += isButton ? "></button>" : "/>";
				try {
					element = document.createElement(html);
				}
				catch (err) {
					dynamic = true;
				}
				if (typeof (dynamic) === "undefined") {
					dynamc = (element.tagName.toLowerCase() !== (isButton ? "button" : "input"));
				}
				callee._dynamic = dynamic;
				if (dynamic) {
					element = callee(type, name, isButton);
				}
			}
			return element;
		}
		Sys.UI.Template._isTemplate = function Sys$UI$Template$_isTemplate(element) {
			var className = element.className;
			return (className && ((className === "sys-template") || /(^| )sys\-template($| )/.test(className)));
		}
		Sys.UI.Template._inputRequiredAttributes = { "type": 1, "name": 1, "sys:type": 1, "sys:name": 1 };





		Sys.UI.Template._commonBooleanAttributes = { disabled: true, " list": ["disabled"] };
		Sys.UI.Template._inputBooleanAttributes =
	{ disabled: true, checked: true, readonly: true,
		" list": ["disabled", "checked", "readonly"]
	};
		Sys.UI.Template._booleanAttributes = {
			"input": Sys.UI.Template._inputBooleanAttributes,
			"select": { disabled: true, multiple: true, " list": ["disabled", "multiple"] },
			"option": { disabled: true, selected: true, " list": ["disabled", "selected"] },
			"img": { disabled: true, ismap: true, " list": ["disabled", "ismap"] },
			"textarea": { disabled: true, readonly: true, " list": ["disabled", "readonly"] }
		};
		Sys.UI.Template._expressionRegExp = /\{\{\s*([\w\W]*?)\s*\}\}/g;
		Sys.UI.Template.allowedProtocols = [
	"http",
	"https",
	"data"
];
		Sys.UI.Template.restrictedAttributes = [
	"src",
	"href",
	"codebase",
	"cite",
	"background",
	"action",
	"longdesc",
	"profile",
	"usemap",
	"classid",
	"data"
];
		Sys.UI.Template._getRestrictedIndex = function Sys$UI$Template$_getRestrictedIndex() {
			var i, l, protocolIndex, attributeIndex,
		protocols = Sys.UI.Template.allowedProtocols || [],
		attributes = Sys.UI.Template.restrictedAttributes || [],
		index = Sys.UI.Template._restrictedIndex;
			if (!index || (index.allowedProtocols !== protocols) || (index.restrictedAttributes !== attributes)) {
				index = { allowedProtocols: protocols, restrictedAttributes: attributes };
				index.protocols = protocolIndex = {};
				for (i = 0, l = protocols.length; i < l; i++) {
					protocolIndex[protocols[i]] = true;
				}
				index.attributes = attributeIndex = {};
				for (i = 0, l = attributes.length; i < l; i++) {
					attributeIndex[attributes[i]] = true;
				}
				Sys.UI.Template._restrictedIndex = index;
			}
			return index;
		}
		Sys.UI.Template.registerClass("Sys.UI.Template", null, Sys.IDisposable);











		Sys.UI.Template._protocolRegExp = /^\s*([a-zA-Z0-9\+\-\.]+)\:/;

		Sys.UI.Template.findContext = function Sys$UI$Template$findContext(element) {
			/// <summary locid="M:J#Sys.UI.Template.findContext" />
			/// <param name="element" domElement="true"></param>
			/// <returns type="Sys.UI.TemplateContext"></returns>
			var tc;
			do {
				tc = Sys.UI.TemplateContext._contexts[element.__mstcindex];
				element = element.parentNode;
			} while (!tc && element);
			return tc || Sys.Application.get_templateContext();
		}

		Sys._Application.prototype.get_templateContext = function Sys$_Application$get_templateContext() {
			/// <summary locid="M:J#Sys._Application.get_templateContext" />
			return this._context || null;
		}



		Sys._Application.prototype._baseDispose = Sys._Application.prototype.dispose;
		Sys._Application.prototype.dispose = function Sys$_Application$dispose() {
			var ctx = this._context;
			if (ctx) ctx.dispose();
			this._context = null;
			this._baseDispose();
		}

		Sys._Application.prototype.removeComponent = function Sys$_Application$removeComponent(component) {
			/// <summary locid="M:J#Sys._Application.removeComponent" />
			/// <param name="component" type="Sys.Component"></param>
			var id = component.get_id();
			if (id) delete this._components[id];
			var ctx = this._context;
			if (ctx) {
				var tc = component.__tc;
				if (tc && tc[0] === ctx._tcindex) {
					delete ctx.components[tc[1]];
				}
			}
		}
		Sys.UI.TemplateContext = function Sys$UI$TemplateContext(tcindex) {
			/// <summary locid="M:J#Sys.UI.TemplateContext.#ctor" />
			/// <field name="data" locid="F:J#Sys.UI.TemplateContext.data"></field>
			/// <field name="dataItem" locid="F:J#Sys.UI.TemplateContext.dataItem"></field>
			/// <field name="index" type="Number" integer="true" locid="F:J#Sys.UI.TemplateContext.index"></field>
			/// <field name="getInstanceId" type="Function" locid="F:J#Sys.UI.TemplateContext.getInstanceId"></field>
			/// <field name="parentContext" type="Sys.UI.TemplateContext" locid="F:J#Sys.UI.TemplateContext.parentContext"></field>
			/// <field name="containerElement" domElement="true" locid="F:J#Sys.UI.TemplateContext.containerElement"></field>
			/// <field name="components" type="Array" elementType="Object" locid="F:J#Sys.UI.TemplateContext.components"></field>
			/// <field name="nodes" type="Array" elementDomElement="true" locid="F:J#Sys.UI.TemplateContext.nodes"></field>
			var index = this._tcindex = tcindex || Sys.UI.TemplateContext._tcindex++;
			Sys.UI.TemplateContext._contexts[index] = this;
			this._completed = [];
			Sys.UI.TemplateContext.initializeBase(this);
		}











		function Sys$UI$TemplateContext$dispose() {
			/// <summary locid="M:J#Sys.UI.TemplateContext.dispose" />
			if (!this._global) {
				var nodes = this.nodes;
				if (nodes) {
					for (var i = 0, l = nodes.length; i < l; i++) {
						var element = nodes[i];
						if (element.nodeType === 1) {
							Sys.Application.disposeElement(element, false);
						}
					}
				}
				var components = this.components;
				if (components) {
					for (var i = 0, l = components.length; i < l; i++) {
						delete components[i].__tc;
					}
				}
			}
			delete Sys.UI.TemplateContext._contexts[this._tcindex];
			this.nodes = this.dataItem = this.components = this.getInstanceId =
		this.containerElement = this.insertBeforeNode = this.parentContext = this.data = null;
			this.isDisposed = true;
		}
		function Sys$UI$TemplateContext$query(selector) {
			return this._find(selector);
		}
		function Sys$UI$TemplateContext$get(selector) {
			return this._find(selector, true);
		}
		function Sys$UI$TemplateContext$_find(selector, single) {
			return /^[#\$](\w|[$:\.\-])+$/.test(selector) ?
			this._findById(selector.substr(0, 1), selector.substr(1), single) :
			Sys._find(selector, this.nodes, single);
		}
		function Sys$UI$TemplateContext$_findById(kind, id, single) {
			var element = null;
			for (var context = this; !element && context; context = context.parentContext) {
				var nodes = context.nodes,
				instanceId = kind + context.getInstanceId(id);
				if (context._global) {
					element = Sys.get(instanceId) || Sys.get(instanceId, nodes);
				}
				else {
					element = Sys.get(instanceId, nodes);
				}
			}
			element = element || Sys.get(kind + id);
			return single ? element : (element ? [element] : []);
		}
		function Sys$UI$TemplateContext$getInstanceId(prefix) {
			/// <summary locid="M:J#Sys.UI.TemplateContext.getInstanceId" />
			/// <param name="prefix" type="String"></param>
			/// <returns type="String"></returns>
			return prefix + (this._global ? "" : this._tcindex);
		}
		function Sys$UI$TemplateContext$initializeComponents() {
			/// <summary locid="M:J#Sys.UI.TemplateContext.initializeComponents" />
			var components = this.components;
			if (components) {
				var i = components.length - 1, index = this._lastIndex;
				this._lastIndex = i;
				for (; i > index; i--) {
					var component = components[i];
					if (component && Sys.Component.isInstanceOfType(component)) {
						if (component.get_isUpdating()) {
							component.endUpdate();
						}
						else if (!component.get_isInitialized()) {
							component.initialize();
						}
					}
				}
			}
		}
		function Sys$UI$TemplateContext$add_instantiated(handler) {
			/// <summary locid="E:J#Sys.UI.DataViewTemplateContext.instantiated" />
			Sys.Observer.addEventHandler(this, "instantiated", handler);
		}
		function Sys$UI$TemplateContext$remove_instantiated(handler) {
			Sys.Observer.removeEventHandler(this, "instantiated", handler);
		}
		function Sys$UI$TemplateContext$_onInstantiated(referenceNode, leaveInPlace) {
			foreach(this._completed, function (callback) {
				callback();
			});
			this._completed = [];
			if (!leaveInPlace) {
				var container = this.containerElement;
				foreach(this.nodes, function (node) {
					container.insertBefore(node, referenceNode || null);
				});
			}
			Sys.Observer.raiseEvent(this, "instantiated");
		}
		function Sys$UI$TemplateContext$_registerComponent(component) {
			var components = this.components;
			component.__tc = [this._tcindex, components.length];
			components.push(component);
			Sys.Component._register(component, null, true);
		}
		function Sys$UI$TemplateContext$_registerIf(result) {
			if (result instanceof Array) {
				for (var i = 0, l = result.length; i < l; i++) {
					this._registerComponent(result[i]);
				}
			}
			else if (result && typeof (result) === 'object') {
				this._registerComponent(result);
			}
		}
		Sys.UI.TemplateContext.prototype = {
			data: null,
			dataItem: null,
			index: 0,
			parentContext: null,
			containerElement: null,
			insertBeforeNode: null,
			components: null,
			nodes: null,
			isDisposed: false,
			_lastIndex: -1,
			dispose: Sys$UI$TemplateContext$dispose,
			query: Sys$UI$TemplateContext$query,
			get: Sys$UI$TemplateContext$get,
			_find: Sys$UI$TemplateContext$_find,
			_findById: Sys$UI$TemplateContext$_findById,
			getInstanceId: Sys$UI$TemplateContext$getInstanceId,
			initializeComponents: Sys$UI$TemplateContext$initializeComponents,
			add_instantiated: Sys$UI$TemplateContext$add_instantiated,
			remove_instantiated: Sys$UI$TemplateContext$remove_instantiated,
			_onInstantiated: Sys$UI$TemplateContext$_onInstantiated,
			_registerComponent: Sys$UI$TemplateContext$_registerComponent,
			_registerIf: Sys$UI$TemplateContext$_registerIf
		}
		Sys.UI.TemplateContext.registerClass("Sys.UI.TemplateContext", null, Sys.IDisposable);
		Sys.UI.TemplateContext._tcindex = 0;
		Sys.UI.TemplateContext._contexts = [];
		Sys.UI.ITemplateContextConsumer = function Sys$UI$ITemplateContextConsumer() {
			throw Error.notImplemented();
		}

		function Sys$UI$ITemplateContextConsumer$get_templateContext() {
			/// <value type="Sys.UI.TemplateContext" mayBeNull="true" locid="P:J#Sys.UI.ITemplateContextConsumer.templateContext"></value>
			throw Error.notImplemented();
		}
		function Sys$UI$ITemplateContextConsumer$set_templateContext(value) {
			throw Error.notImplemented();
		}
		Sys.UI.ITemplateContextConsumer.prototype = {
			get_templateContext: Sys$UI$ITemplateContextConsumer$get_templateContext,
			set_templateContext: Sys$UI$ITemplateContextConsumer$set_templateContext
		}
		Sys.UI.ITemplateContextConsumer.registerInterface("Sys.UI.ITemplateContextConsumer");

		Sys.UI.IContentTemplateConsumer = function Sys$UI$IContentTemplateConsumer() {
			throw Error.notImplemented();
		};
		function Sys$UI$IContentTemplateConsumer$addContentTemplate(tmpl) {
			/// <value type="String" locid="M:J#Sys.UI.IContentTemplateConsumer.addContentTemplate"></value>
			/// <param name="bindingContext" type="Object" optional="false" mayBeNull="false"></param>
			if (tmpl.constructor !== String) throw new Error("Method \"addContentTemplate\" requires an argument of type String.");
			if (tmpl.length > 0) {
				if (this._contentTemplate) {
					this._contentTemplate += " ";
					this._contentTemplate += tmpl;
				}
				else {
					this._contentTemplate = tmpl;
				}
			}
		}
		Sys.UI.IContentTemplateConsumer.prototype = {
			addContentTemplate: Sys$UI$IContentTemplateConsumer$addContentTemplate
		};
		Sys.UI.IContentTemplateConsumer.registerInterface("Sys.UI.IContentTemplateConsumer");

		Sys.Application._caseIndex = {};

		Sys.Application._prototypeIndex = {};

		Sys.Application._context = new Sys.UI.TemplateContext();
		Sys.Application._context._global = true;
		Sys.Application._context.rootContext = Sys.Application._context;

		Sys.Application.activateElement = function Sys$Application$activateElement(element, bindingContext, recursive, useGlobalContext, vm) {
			/// <summary locid="M:J#Sys.Application.activateElement" />
			/// <param name="element" domElement="true"></param>
			/// <param name="bindingContext" type="Object" optional="true" mayBeNull="true"></param>
			/// <param name="recursive" optional="true" mayBeNull="true"></param>
			/// <returns type="Sys.UI.TemplateContext"></returns>
			return Sys.Application.activateElements(element, bindingContext || null, (recursive !== false), (useGlobalContext !== false), vm);
		};

		Sys.Application.activateElements = function Sys$Application$activateElements(elements, bindingContext, recursive, useGlobalContext, vm) {
			/// <summary locid="M:J#Sys.Application.activateElements" />
			/// <param name="elements"></param>
			/// <param name="bindingContext" optional="true" mayBeNull="true"></param>
			/// <param name="recursive" optional="true" mayBeNull="true"></param>
			/// <returns type="Sys.UI.TemplateContext"></returns>
			var app = Sys.Application,
				tc = useGlobalContext === false ? new Sys.UI.TemplateContext() : app._context,
				useDirect = isBrowser("InternetExplorer") && Sys.Browser.version < 9;
			tc.dataItem = tc.data = typeof (bindingContext) === "undefined" ? null : bindingContext;
			tc.rootContext = tc;
			tc.vm = vm;
			tc.components = tc.components || [];
			tc.nodes = elements;
			recursive = (recursive !== false);
			Sys._queryAll(elements, function (element) {
				app._activateElement(element, tc, useDirect, null, recursive);
			});
			tc.initializeComponents();
			tc._onInstantiated(null, true);
			return tc;
		};

		Sys.registerPlugin({
			name: "activateElements",
			plugin: Sys.Application.activateElements,
			returnType: "Sys.UI.TemplateContext",
			parameters: [
		{ name: "elements", description: "The element or array of elements to activate. You may also pass DOM selectors or array of DOM selectors." },
		{ name: "bindingContext", description: "The binding context." },
		{ name: "recursive", type: "Boolean", description: "Specifies whether processing should occur recursively." }
	]
		});

		Sys.Application._findType = function Sys$Application$_findType(element, prefix, useDirect) {
			var er, err, type, xmlns = "xmlns:" + prefix;
			function getType() {
				var ns;
				try { ns = useDirect ? element[xmlns] : element.getAttribute(xmlns); }
				catch (er) { }
				if (ns && ns.substr(0, 11) === "javascript:") {
					ns = ns.substr(11);
					type = null;
					try {
						type = Type.parse(ns);
					}
					catch (er) {
						err = String.format(Sys.UI.TemplatesRes.invalidTypeNamespace, ns);
						return;
					}
					if (type && type.__class) {
						return;
					}
					else {
						type = ns;
					}
				}
			}
			for (; element; element = element.parentNode) {
				getType();
				if (err) {
					throw Error.invalidOperation(err);
				}
				if (type) return type;
			}
			element = document.body;
			getType();
			if (err) {
				throw Error.invalidOperation(err);
			}
			return type;
		}

		Sys.Application._activateElement = function Sys$Application$_activateElement(parent, templateContext, useDirect, parentContentTemplates, recursive) {
			if (recursive) {
				recursive = !Sys.UI.Template._isTemplate(parent);
			}
			var i = -1,
		allElements = recursive ? (useDirect ? parent.all : parent.getElementsByTagName("*")) : [],
		isTemplate = /(^| )sys\-template($| )/,
		isIgnore = /(^| )sys\-ignore($| )/,
			expandosAreLast = useDirect && Sys.Browser.version <= 7,
		element = parent;
			do {
				if (element.nodeType !== 1) continue;
				///// this code is inline rather than factored out into a function because
				///// performance testing has shown that calling the factored method causes activation
				///// to be measurably slower in IE, due to the overhead of invoking a function.
				///// begin element activation

				var err, j, m, typeList = null, entry = null, index = null, fnIndex = null, contentTemplate = null,
			activated = false,
			nodeName = null,
			attributes = element.attributes,
			alength = attributes.length - 1,
			attributes2 = null;
				if (alength >= 0 && (!expandosAreLast || attributes[alength].expando) && !element.__msajaxactivated) {
					for (j = alength; j >= 0; j--) {
						var attribute = attributes[j];
						if (expandosAreLast && !attribute.expando) break;
						if (!attribute.specified || attribute.nodeName.indexOf(':') < 0) continue;
						activated = true;
						nodeName = attribute.nodeName;
						var value = attribute.nodeValue;
						switch (nodeName) {
							case "sys:attach":
								typeList = value.split(',');
								break;
							case "sys:command":
								var command = Sys.Application._getPropertyValue(null, null, null, value, templateContext, element, null, true);
								var commandArg = Sys.Application._getCommandAttr(element, templateContext, "sys:commandargument", useDirect),
						commandTarget = Sys.Application._getCommandAttr(element, templateContext, "sys:commandtarget", useDirect);
								Sys.UI.DomElement.setCommand(element, command || "", commandArg || null, Sys.UI.DomElement._ensureGet(commandTarget, templateContext, "sys:commandtarget"));
								break;
							case "sys:content-template":
								contentTemplate = Sys.Application._getPropertyValue(null, null, null, value, templateContext, element, null, true);
								break;
							default:
								attributes2 = attributes2 || [];
								attributes2.push(attribute);
						}
					}
					if (contentTemplate !== null && typeList === null) {
						throw Error.invalidOperation("invalidSysContentTemplate");
					}
					if (activated) {
						element.__msajaxactivated = true;
						if (typeList) {
							index = {};
							for (var k = 0, n = typeList.length; k < n; k++) {
								var typeName = typeList[k].trim();
								if (index[typeName]) continue;
								var type = Sys.Application._findType(element, typeName, useDirect);
								if (!type) {
									throw Error.invalidOperation(String.format(Sys.UI.TemplatesRes.invalidAttach, "sys:attach", typeName));
								}
								var props = null, isComponent = 0, isControlOrBehavior = 0, isContext = 0, isContentTemplate = 0,
							isClass = (typeof (type) !== "string"),
							instance = null;
								if (isClass) {
									isComponent = type.inheritsFrom(Sys.Component);
									isControlOrBehavior = (isComponent && (type.inheritsFrom(Sys.UI.Behavior) || type.inheritsFrom(Sys.UI.Control)));
									isContext = type.implementsInterface(Sys.UI.ITemplateContextConsumer);
									isContentTemplate = type.implementsInterface(Sys.UI.IContentTemplateConsumer);
									instance = isControlOrBehavior ? new type(element) : new type();
									if (isComponent) {
										instance.beginUpdate();
									}
									if (!isControlOrBehavior) {
										Sys.Application._registerComponent(element, instance);
									}
									if (isContext) {
										instance.set_templateContext(templateContext);
									}
									if (isContentTemplate) {
										if (contentTemplate !== null) {
											instance.addContentTemplate(contentTemplate);
										}
										if (parentContentTemplates) {
											instance.addContentTemplate(parentContentTemplates);
										}
									}
									else if (contentTemplate !== null) {
										throw Error.invalidOperation("invalidSysContentTemplate");
									}
									entry = { instance: instance, isClass: true, typeName: typeName, type: type };
								}
								else if (contentTemplate !== null) {
									throw Error.invalidOperation("invalidSysContentTemplate");
								}
								else {
									props = {};
									instance = Type.parse(type);
									entry = { instance: instance, props: props, typeName: typeName, type: type };
									if (!fnIndex) {
										fnIndex = [entry];
									}
									else {
										fnIndex[fnIndex.length] = entry;
									}
								}
								index[typeName] = entry;
							}
						}
						if (attributes2) {
							for (j = attributes2.length - 1; j >= 0; j--) {
								attribute = attributes2[j];
								nodeName = attribute.nodeName;
								value = attribute.nodeValue;
								var isSelect = (/^select$/i.test(element.tagName)),
							attrib = Sys.Application._splitAttribute(nodeName, isSelect, index),
							atype = attrib.type,
							ns = attrib.ns,
							name = attrib.name;
								if (atype < 0) continue;
								if (atype === 3) {
									entry = attrib.index;
									var target = entry.instance;
									value = Sys.Application._getPropertyValue(attrib, target, name, value, templateContext, element);
									if (typeof (value) === "undefined") continue;
									if (entry.isClass) {
										switch (attrib.map.type) {
											case 1:
												attrib.map.setter.call(target, value);
												break;
											case 2:
												attrib.map.setter.call(target, typeof (value) === "function" ? value : new Function("sender", "args", value));
												break;
											default:
												target[name] = value;
										}
									}
									else {
										entry.props[name] = value;
									}
								}
								else if (atype <= 2) {
									if (attrib.textNode || (name === "innerHTML")) {
										Sys.Application._clearContent(element);
									}
									value = Sys.Application._getPropertyValue(attrib, element, name, value, templateContext, element);
									if (typeof (value) === "undefined") continue;
									switch (attrib.type) {
										case 0:
											if (/^on/i.test(name)) {
												if (typeof value === 'function') {
													element[name] = value;
												}
												else {
													element[name] = document.attachEvent ? new Function(value) : new Function("event", value);
												}
												break;
											}
											if (isSelect && (name === "value")) {
												element.value = value;
												break;
											}
											var booleans = Sys.UI.Template._booleanAttributes,
										lowerTag = element.tagName.toLowerCase(),
										isbool = (name === "disabled") || (booleans[lowerTag] && booleans[lowerTag][name]);
											if (isbool) {
												if (name === "selected") {
													element.selected = value;
												}
												if (!value) {
													element.removeAttribute(name);
													break;
												}
												else if (name === "checked") {
													element.setAttribute(name, name);
													break;
												}
											}
											var a = document.createAttribute(name);
											a.nodeValue = isbool ? name : value;
											element.setAttributeNode(a);
											break;
										case 1:
											if (attrib.textNode) {
												Sys.Application._clearContent(element);
												element.appendChild(document.createTextNode(value));
											}
											else {
												Sys.Observer.setValue(element, name, value);
											}
											break;
										case 2:
											value ? Sys.UI.DomElement.addCssClass(element, name) : Sys.UI.DomElement.removeCssClass(element, name);
											break;
									}
								}
							}
						}
						if (fnIndex) {
							for (j = 0, m = fnIndex.length; j < m; j++) {
								entry = fnIndex[j];
								templateContext._registerIf(entry.instance(element, entry.props, templateContext));
							}
						}
						if (index) {
							for (entry in index) {
								if (index.hasOwnProperty(entry)) {
									entry = index[entry];
									if (entry && entry.isClass) {
										templateContext._registerComponent(entry.instance);
									}
								}
							}
						}
					}
					///// end element activation
				}
				if (recursive) {
					var className = element.className;
					if (className && (className.length >= 10) && (className === "sys-template" || className === "sys-ignore" || isTemplate.test(className) || isIgnore.test(className))) {
						var next = element.nextSibling;
						while (next && (next.nodeType !== 1)) {
							next = next.nextSibling;
						}
						while (!next) {
							element = element.parentNode;
							if (element === parent) {
								break;
							}
							next = element.nextSibling;
							while (next && (next.nodeType !== 1)) {
								next = next.nextSibling;
							}
						}
						if (!next || (next.nodeType !== 1)) {
							break;
						}
						do {
							element = allElements[i + 1];
							if (element === next) break;
							i++;
						}
						while (element);
					}
				}
			}
			while (!!(element = allElements[++i]));
		}

		function Sys$Application$_elementToString(el) {
			if (!el.tagName) {
				return "unknown element";
			}
			var str = el.tagName.toLowerCase();
			if (str === "input") {
				str += "[" + el.type + "]";
			}
			if (el.id) {
				str += "#" + el.id;
			}
			if (el.className) {
				el.className.split(/\s+/g).forEach(function (c) {
					str += "." + c;
				});
			}
			return str;
		}

		// a non-control targeting data attribute, i.e. "data-sys-class"
		var sysDataAttrExpr = /^data\-sys\-([a-z_]*)$/;

		// a control targeting data attribute, i.e.: "data-dataview-data"
		var controlDataAttrExpr = /^data\-([a-z_]*)\-([a-z_]*)$/;

		// a non-control targeting data attribute, i.e. "data-sys-class"
		var sysAttrExpr = /^sys\:([a-z_]*)$/;

		Sys.Application._linkAttributes = function Sys$Application$_linkAttributes(element, parentContext, attachedName) {
			var i, attr, dataAttr, msDataAttrib, isSelect, isTextArea, match, attrName, value, target, targetProp, link, typeIndex, attrLinksElementContent, controlType;

			if (element.control && attachedName) {
				typeIndex = {};
				controlType = element.control.constructor;
				typeIndex[attachedName] = { type: controlType, isClass: true, isComponent: controlType.inheritsFrom && controlType.inheritsFrom(Sys.Component) };
			}

			for (i = 0; i < element.attributes.length; i++) {
				attr = element.attributes[i];
				attrName = attr.name;

				// test for a "data attribute", i.e. "data-dataview-data"
				if (sysDataAttrExpr.test(attrName)) {
					dataAttr = { raw: attrName, prefix: "sys" };
					dataAttr.name = sysDataAttrExpr.exec(attr.name)[1];
					link = true;
				}
				else if (controlDataAttrExpr.test(attrName)) {
					dataAttr = { raw: attrName };
					match = controlDataAttrExpr.exec(attrName);
					dataAttr.control = dataAttr.prefix = match[1];
					dataAttr.name = match[2];
					link = true;
				}
				else if (sysAttrExpr.test(attrName)) {
					dataAttr = { raw: attrName, prefix: "sys" };
					dataAttr.name = sysAttrExpr.exec(attr.name)[1];
					link = false;
				}

				// if this is a data attribute, then link or bind it to the target and remove it from the DOM
				if (dataAttr) {
					target = dataAttr.control ? element.control : element;

					if (target) {
						isSelect = element.tagName === "SELECT";
						isTextArea = element.tagName === "TEXTAREA";
						msDataAttrib = Sys.Application._splitAttribute(dataAttr.prefix + ":" + dataAttr.name, isSelect, typeIndex);
						targetProp = msDataAttrib.name;

						// For inner html and text, the child nodes of the element should not be
						// linked since they are dynamic content that is not defined within the
						// original template markup source, and could potentially be unsafe.
						if (targetProp === "innerHTML" || targetProp === "innerText" || (isTextArea && targetProp === "value")) {
							attrLinksElementContent = true;
						}

						value = Sys.Application._getPropertyValue(msDataAttrib, target, targetProp, attr.nodeValue, parentContext, element, null, false, { isLinkPending: !element.control && link });
						if (value !== undefined) {
							Sys.Observer.setValue(target, msDataAttrib.name || targetProp, value);
						}

						dataAttr = null;

						if (!link) {
							element.removeAttribute(attr.name);
							i -= 1;
						}
					}
				}
			}

			return attrLinksElementContent;
		};

		// marks the beginning or end of a context, i.e. "/item" or "item _$t202"
		var itemCommentExpr = /^(\/|)item(\:([\$_A-Za-z0-9]+)|)$/;

		Sys.Application._linkContexts = function Sys$Application$_linkContexts(parentContext, parentControl, parentData, parentElement, currentContext, parentContentTemplates, recursive, generateIds) {
			var children, newContext, preceedingText, ctxIdx, tcIdx, isSelect, i, node, match, marker, tmplIdx, tmpl, generatesContext, value, foundBinding, isArrayData, generateChildIds,
				isSingleExternalContext, lastIndex, targetProp, msAttrib, text, trimText, exprRegExp, attachName, isContentTemplate, contentTemplate, childContentTemplates, ctxAttr,
				isTextNode, isElementNode, isCommentNode;

			ctxIdx = -1;
			isSingleExternalContext = !recursive && currentContext;
			isArrayData = parentData && parentData instanceof Array;
			isSelect = parentElement.tagName === "SELECT";
			exprRegExp = Sys.UI.Template._expressionRegExp;

			// Copy child nodes into array to isolate from external changes to the DOM
			i = -1;
			children = [];
			while (node = parentElement.childNodes[++i]) {
				children[i] = node;
			}

			for (i = 0; i < children.length; i++) {
				node = children[i];
				marker = tmplIdx = tmpl = match = value = null;
				generatesContext = foundBinding = false;
				generateChildIds = generateIds;
				isElementNode = node.nodeType === 1;
				isTextNode = node.nodeType === 3;
				isCommentNode = node.nodeType === 8;

				// Look for binding expressions in text nodes
				// NOTE: based on _buildTemplateCode
				if (isTextNode) {
					text = node.nodeValue;
					trimText = text.trim();

					// An extension takes the place of node value
					if ((trimText.startsWith("{") && trimText.endsWith("}") && (!trimText.startsWith("{{") || !trimText.endsWith("}}")))) {
						foundBinding = true;
						targetProp = (parentElement.tagName.toLowerCase() === "textarea" ? "value" : "innerText");
						msAttrib = Sys.Application._splitAttribute(targetProp, isSelect);
						value = Sys.Application._getPropertyValue(msAttrib, parentElement, targetProp, text, currentContext, parentElement, null, false);
					}
					// Multiple expressions can be nested within a block of text
					else {
						lastIndex = 0;
						match = exprRegExp.exec(text);
						while (match) {
							if (!foundBinding) {
								value = "";
								foundBinding = true;
								targetProp = (parentElement.tagName.toLowerCase() === "textarea" ? "value" : "innerText");
								msAttrib = Sys.Application._splitAttribute(targetProp, isSelect);
							}
							value += text.substring(lastIndex, match.index) || "";
							value += Sys.Application._getPropertyValue(msAttrib, parentElement, targetProp, match[0], currentContext, parentElement, null, false) || "";
							lastIndex = match.index + match[0].length;
							match = exprRegExp.exec(text);
						}
						if (foundBinding && lastIndex < text.length) {
							value += text.substr(lastIndex);
						}
					}

					// Update the node's value
					if (foundBinding) {
						node.nodeValue = value || "";
					}

					continue;
				}

				// If this is top-level then look for context markers
				if (!recursive) {
					if (isCommentNode && (match = itemCommentExpr.exec(node.nodeValue))) {
						if (match[1] === "") {
							tcIdx = match[3];
							marker = { begin: true, end: false };
						}
						else if (match[1] === "/") {
							marker = { begin: false, end: true };
						}
					}
					else if (isElementNode && node.hasAttribute("data-sys-ctx")) {
						ctxAttr = node.getAttribute("data-sys-ctx");

						if (ctxAttr.indexOf("/") === 0) {
							marker = { begin: false, end: true };
						}
						else {
							tcIdx = ctxAttr;
							marker = { begin: true, end: false };
						}
					}

					if (marker) {
						if (isSingleExternalContext) {
							if (isElementNode) {
								throw new Error("Unexpected context marker in DOM for element '" + Sys$Application$_elementToString(node) + "': context was provided by caller.");
							} else if (isCommentNode) {
								throw new Error("Unexpected context marker in DOM for comment '" + node.nodeValue + "': context was provided by caller.");
							} else {
								throw new Error("Unexpected context marker in DOM: context was provided by caller");
							}
						}

						// Start a new context after this node
						if (marker.begin) {

							// Verify that there isn't currently an active context
							if (currentContext) {
								// There should be no context either because it is supplied by the caller
								// (i.e. Content), we have only just entered the method and haven't yet encountered
								// a context begin marker, or the node was preceeded by a context end marker
								throw new Error("There is already a context in use. This may be caused by invalid markup.");
							}

							if (!tcIdx) {
								throw new Error("Could not find context id for newly created context.");
							}

							// Start new context for a new item when a context begin marker is found (mimicks compiled code)
							newContext = new Sys.UI.TemplateContext(tcIdx);

							newContext.data = parentData;
							newContext.components = [];

							// Use the preceeding text nodes if there are any
							if (preceedingText) {
								newContext.nodes = preceedingText.slice();
							} else {
								newContext.nodes = [];
							}

							newContext.index = ++ctxIdx;

							// Set the index and use it to retrieve the data item for the context
							if (isArrayData) {
								if (ctxIdx >= parentData.length) {
									throw new Error("Unexpected number of contexts: expected " + parentData.length + " but found at least " + (ctxIdx + 1));
								}
								newContext.dataItem = parentData[ctxIdx];
							} else if (ctxIdx > 0) {

								throw new Error("Found multiple contexts in DOM, but data is not an array.");
							} else {
								newContext.dataItem = parentData;
							}

							newContext.parentContext = parentContext;
							newContext.containerElement = parentElement;

							// Get the template from the parent control (i.e. dataview)
							if (parentControl._getTemplate) {
								newContext.template = parentControl._getTemplate();
							}

							// Pre-compile the template if necessary, since we will need to access nested templates
							newContext.template._ensureCompiled();

							// Clear out text nodes array
							preceedingText = null;

							// Add the context to the parent control and use it as the current context
							parentControl._contexts.push(newContext);
							currentContext = newContext;
						}
						// End the current context when a context end marker is found
						else if (marker.end) {
							currentContext._onInstantiated(null, true);

							// Reset variables tied to the current context
							currentContext = null;
						}

						// Remove elements since they may still be shown by the browser
						// in some cases, even if they are hidden (i.e. OPTION).
						if (isElementNode) {
							parentElement.removeChild(node);
						}

						// Continue to the next node if this node was a marker
						continue;
					}
					else {
						// Save text nodes to be included in the following context
						if (isTextNode && !currentContext) {
							if (preceedingText) {
								preceedingText.push(node);
							}
							else {
								preceedingText = [node];
							}
						}
						else {
							if (!currentContext) {
								if (isElementNode) {
									throw new Error("Found element '" + Sys$Application$_elementToString(node) + "' outside of an active context.");
								} else if (isCommentNode) {
									throw new Error("Found comment '" + node.nodeValue + "' outside of an active context.");
								} else {
									throw new Error("Found unknown node '" + node.nodeValue + "' outside of an active context.");
								}
							}

							// Only top-level (non-recursive) nodes are added to the context nodes list
							currentContext.nodes.push(node);
						}
					}
				}

				// Only elements
				if (isElementNode) {

					// If a template index attribute was specified, then us it for templated controls
					if (node.hasAttribute("data-sys-tmplidx")) {
						tmplIdx = parseInt(node.getAttribute("data-sys-tmplidx"), 10);
					}

					// Assign context index (mimics compiled code)
					node.__mstcindex = currentContext._tcindex;

					if (node.hasAttribute("data-continue")) {
						// Children were allowed to continue rendering, so don't start generating ids
					}
					else if (!generateChildIds) {
						// Detect special attributes that would have been taken care of by server-side rendering.
						if (node.hasAttribute("sys:attach") || node.hasAttribute("sys:if") || node.hasAttribute("sys:content-template")) {
							generateChildIds = true;
						}
					}

					// If a sys:if attribute exists, then potentially remove the element from the DOM
					// don't remove it immediately since its contents could affect linking (e.g. child template index)
					if (node.hasAttribute("sys:if")) {
						value = node.getAttribute("sys:if");
						if (Sys.Application._getPropertyValue(null, null, null, value, currentContext, node, null, true)) {
							node.removeAttribute("sys:if");
						}
						else {
							parentElement.removeChild(node);
							continue;
						}
					}

					// generate client id
					if (node.hasAttribute("sys:id")) {
						if (node.id) {
							throw new Error("Found a sys:id binding in pre-rendered markup, but the element already has an id.");
						}

						value = node.getAttribute("sys:id");

						// Evaluate expression value in the current context
						if (value.startsWith("{") && value.endsWith("}")) {
							msAttrib = Sys.Application._splitAttribute("id", false);
							value = Sys.Application._getPropertyValue(msAttrib, parentElement, "id", value, currentContext, parentElement, null, true);
						}
						// Otherwise, call getInstanceId to generate a unique id
						else {
							value = currentContext.getInstanceId(value);
						}

						node.id = value;

						node.removeAttribute("sys:id");
					}
					else if (generateChildIds && node.hasAttribute("id")) {
						value = node.id;
						node.id = currentContext.getInstanceId(value);
					}

					// Detect content-template attribute
					if (node.hasAttribute("data-sys-content-template")) {
						contentTemplate = node.getAttribute("data-sys-content-template");
					}
					else {
						contentTemplate = null;
					}

					// Detect tcindex attribute
					tcIdx = node.getAttribute("data-sys-tcindex");

					// a control was rendered server-side, so link it and it's attributes
					if (node.hasAttribute("data-sys-attach")) {
						attachName = node.getAttribute("data-sys-attach");
						Sys.Application._linkControlElement(node, currentContext);

						// Provide control with content template names if it requires them.
						// NOTE: The assumption that the control's constructor will be a function is OK
						// here since we must assume that it is indeed a control for purposes of linking.
						// Also, attaching controls to label elements would cause other problems anyway.
						isContentTemplate = node.control.constructor.implementsInterface(Sys.UI.IContentTemplateConsumer);
						if (isContentTemplate) {
							if (contentTemplate) {
								node.control.addContentTemplate(contentTemplate);
							}
							if (parentContentTemplates) {
								node.control.addContentTemplate(parentContentTemplates);
							}
						}
						else if (contentTemplate !== null) {
							throw Error.invalidOperation("invalidSysContentTemplate");
						}

						// set the server-generated ctx id
						if (node.control._setTemplateCtxId) {
							node.control._setTemplateCtxId(tcIdx);
						}

						Sys.Application._linkAttributes(node, currentContext, attachName);

						// determine whether the control is a context-generating control (i.e. dataview), in
						// which case it will be responsible for linking it's own content
						if (node.control._generatesContext) {
							generatesContext = node.control._generatesContext();
						}

						// if the control gets its template from it's parent's template it should use
						if (generatesContext && node.control._setTemplate) {
							if (typeof (tmplIdx) !== "number") {
								throw new Error("A templated control is attached to the node, but no template index was specified.");
							}
							tmpl = new Sys.UI.Template(currentContext.template.get_element()._msajaxtemplate[2][tmplIdx][1]);
							tmpl._ensureCompiled();
							node.control._setTemplate(tmpl);
						}

						// register the control with the context here rather than when
						// linking the control (so that attributes can be linked first?)
						currentContext._registerComponent(node.control);
					}

					if (parentContentTemplates) {
						childContentTemplates = parentContentTemplates;
						if (contentTemplate) {
							childContentTemplates += " " + contentTemplate;
						}
					}
					else if (contentTemplate) {
						childContentTemplates = contentTemplate;
					}
					else {
						childContentTemplates = null;
					}

					// if the element doesn't generate a context, then recursively link it's children
					if (!generatesContext) {
						// if the node is a template (class = "sys-template"), then increment the child template index so that
						// context-generating controls that follow will be assigned the correct template
						if (Sys.UI.Template._isTemplate(node)) {
							attachName = node.getAttribute("sys:attach");
							Sys.Application._activateElement(node, currentContext, isBrowser("InternetExplorer") && Sys.Browser.version < 9, childContentTemplates, true);
							Sys.Application._linkAttributes(node, currentContext, attachName);
						}
						else {
							// If the node has any attributes that weren't rendered (i.e. "sys:" attributes), then activate only this node
							if (Array.prototype.some.call(node.attributes, function (a) { return a.name.indexOf(":") >= 0; })) {
								Sys.Application._activateElement(node, currentContext, isBrowser("InternetExplorer") && Sys.Browser.version < 9, childContentTemplates, false);
							}
							if (!Sys.Application._linkAttributes(node, currentContext, attachName)) {
								// The element did NOT have an attribute that results in linking the content
								// of the element (i.e. innerHTML or innerText), so recursively link child nodes.
								Sys.Application._linkContexts(parentContext, parentControl, parentData, node, currentContext, childContentTemplates, true, generateChildIds);
							}
						}
					}
				}
			}

			if (!recursive && isArrayData && !isSingleExternalContext && ctxIdx != parentData.length - 1) {
				throw new Error("Unexpected number of contexts: expected " + parentData.length + " but found " + (ctxIdx + 1));
			}
		};

		Sys.Application._linkControlElement = function Sys$Application$_linkControlElement(element, parentContext) {
			if (!element.hasAttribute("data-sys-attach")) {
				throw new Error("Element '" + Sys$Application$_elementToString(element) + "' is not a control.");
			}

			var controlType = element.getAttribute("data-sys-attach"),
				type = Sys.Application._findType(element, controlType, isBrowser("InternetExplorer") && Sys.Browser.version < 9),
				isContext = type.implementsInterface(Sys.UI.ITemplateContextConsumer),
				control = new type(element);

			control.beginUpdate();
			control.set_isLinkPending(true);
			if (isContext) {
				control.set_templateContext(parentContext);
			}

			return controlType;
		};

		Sys.Application.linkElement = function (element, tmplElement) {
			var appContext, control, controlType, tmpl, contentTemplate, isContentTemplate;

			// Initialize the application context
			appContext = Sys.Application._context;
			appContext.dataItem = null;
			appContext.components = appContext.components || [];
			appContext.nodes = [element];

			// Initialize the root control
			controlType = Sys.Application._linkControlElement(element, appContext);

			// NOTE: Assumption that the control is an MsAjax control is OK here, since we
			// are linking the element if it is not a control then it is an error scenario.
			control = element.control;

			// Detect content-template attribute
			if (element.hasAttribute("data-sys-content-template")) {
				isContentTemplate = control.constructor.implementsInterface(Sys.UI.IContentTemplateConsumer);
				if (!isContentTemplate) {
					throw Error.invalidOperation("invalidSysContentTemplate");
				}
				contentTemplate = element.getAttribute("data-sys-content-template");
				if (contentTemplate) {
					control.addContentTemplate(contentTemplate);
				}
			}

			// Set the template
			if (control._setTemplate) {
				tmpl = new Sys.UI.Template(tmplElement);
				tmpl._ensureCompiled();
				control._setTemplate(tmpl);
			}

			Sys.Application._linkAttributes(element, appContext, controlType);

			appContext._registerComponent(control);
			appContext.initializeComponents();
			appContext._onInstantiated(null, true);
		};

		Sys.Application._clearContent = function Sys$Application$_clearContent(element) {
			var err;
			Sys.Application.disposeElement(element, true);
			try { element.innerHTML = ""; }
			catch (err) {
				while (element.firstChild) {
					element.removeChild(element.firstChild);
				}
			}
		}
		Sys.Application._getCommandAttr = function Sys$Application$_getCommandAttr(element, templateContext, name, useDirect) {
			var err, value = null;
			try {
				value = useDirect ? element[name] : element.getAttribute(name);
				value = value ? Sys.Application._getPropertyValue(null, null, null, value, templateContext, element, null, true) : null;
			}
			catch (err) { }
			return value;
		}
		Sys.Application._directAttributes = {
			"style": "style.cssText",
			"class": "className",
			"cellpadding": "cellPadding",
			"cellspacing": "cellSpacing",
			"colspan": "colSpan",
			"rowspan": "rowSpan",
			"contenteditable": "contentEditable",
			"valign": "vAlign",
			"innertext": "innerText",
			"innerhtml": "innerHTML"
		}
		Sys.Application._splitAttribute = function Sys$Application$_splitAttribute(attributeName, isSelect, typeIndex) {
			var nameParts = attributeName.split(':'),
			ns = nameParts.length > 1 ? nameParts[0] : null,
			name = nameParts[ns ? 1 : 0],
			type = -1,
			textNode, map, index, isSys = (ns === "sys"),
			lowerName = name.toLowerCase(),
			isNative = !ns;
			if (!ns || isSys) {
				var newName = Sys.Application._directAttributes[lowerName];
				if (newName) {
					type = 1;
					if (name === "innertext") {
						textNode = true;
					}
					name = newName;
				}
				else if (isSelect) {
					if (lowerName === "selectedindex") {
						name = "selectedIndex";
						type = 1;
					}
					else if (name === "value") {
						type = 1;
					}
					else if (isSys) {
						type = 0;
						ns = null;
					}
				}
				else if (isSys) {
					if ((name === "command") || (name === "commandargument") || (name === "commandtarget")) {
						type = 4;
					}
					else if (name.indexOf("style-") === 0) {
						name = "style." + Sys.Application._translateStyleName(name.substr(6));
						type = 1;
					}
					else if (name.indexOf("class-") === 0) {
						name = name.substr(6);
						type = 2;
					}
					else {
						ns = null;
						type = 0;
					}
				}
			}
			else if (typeIndex) {
				index = typeIndex[ns];
				if (index) {
					type = 3;
					if (index.isClass) {
						map = Sys.Application._translateName(name, index.type);
						name = map.name;
					}
				}
				else {
					name = ns + ":" + name;
					ns = null;
					type = -1;
				}
			}
			else {
				name = ns + ":" + name;
				ns = null;
				type = -1;
			}
			return { ns: ns, name: name, type: type, map: map, index: index, textNode: textNode, isNative: isNative };
		}

		Sys.Application._translateStyleName = function Sys$Application$_translateStyleName(name) {
			if (name.indexOf('-') === -1) return name;
			var parts = name.toLowerCase().split('-'),
		newName = parts[0];
			for (var i = 1, l = parts.length; i < l; i++) {
				var part = parts[i];
				newName += part.substr(0, 1).toUpperCase() + part.substr(1);
			}
			return newName;
		}

		Sys.Application._getExtensionCode = function Sys$Application$_getExtensionCode(extension, doEval, templateContext, element) {
			extension = extension.trim();
			var name, properties, propertyBag = {}, spaceIndex = extension.indexOf(' ');
			if (spaceIndex !== -1) {
				name = extension.substr(0, spaceIndex);
				properties = extension.substr(spaceIndex + 1);
				if (properties) {
					properties = properties.replace(/\\,/g, '\u0000').split(",");
					for (var i = 0, l = properties.length; i < l; i++) {
						var property = properties[i].replace(/\u0000/g, ","),
						equalIndex = property.indexOf('='),
						pValue, pName;
						if (equalIndex !== -1) {
							pName = property.substr(0, equalIndex).trim();
							pValue = property.substr(equalIndex + 1).trim();
							if (doEval) {
								pValue = this._getPropertyValue(null, null, null, pValue, templateContext, element, true);
							}
						}
						else {
							pName = "$default";
							pValue = property.trim();
						}
						propertyBag[pName] = pValue;
					}
				}
			}
			else {
				name = extension;
			}
			return { instance: Sys.Application._getMarkupExtension(name), name: name, properties: propertyBag };
		}

		Sys.Application._getPropertyValue = function Sys$Application$_getPropertyValue(attrib, target, name, value, templateContext, element, inExtension, suppressExtension, additionalProperties) {
			var propertyValue = value.replace(/&lt;/, "<").replace(/&gt;/, ">");
			if (propertyValue.startsWith("{{") && propertyValue.endsWith("}}")) {
				propertyValue = this._evaluateExpression(propertyValue.slice(2, -2), templateContext, element);
			}
			else if (!suppressExtension && !inExtension && propertyValue.startsWith("{") && propertyValue.endsWith("}")) {
				var extension = this._getExtensionCode(propertyValue.slice(1, -1), true, templateContext, element);
				propertyValue = extension.instance.extension(target, (attrib.type === 2 ? "class:" : "") + name, templateContext, merge(additionalProperties || {}, extension.properties));
			}
			return propertyValue;
		}
		Sys.Application._tryName = function Sys$Application$_tryName(name, type) {
			var prototype = type.prototype,
		setterName = "set_" + name, setter = prototype[setterName];
			if (setter) {
				return { name: name, setterName: setterName, setter: setter, type: 1 };
			}
			if (name.startsWith('on')) {
				setterName = "add_" + name.substr(2);
				var adder = prototype[setterName];
				if (adder) {
					return { name: name, setterName: setterName, setter: adder, type: 2 };
				}
			}
			if (typeof (prototype[name]) !== "undefined") {
				return { name: name };
			}
			return null;
		}
		Sys.Application._translateName = function Sys$Application$_translateName(name, type) {
			if (name && (name !== name.toLowerCase())) {
				throw Error.invalidOperation(String.format(Sys.UI.TemplatesRes.invalidAttributeName, name));
			}
			var cache, index = Sys.Application._prototypeIndex[type.__typeName];
			if (index) {
				cache = index[name];
				if (cache) return cache;
			}
			else {
				index = {};
			}
			type.resolveInheritance();
			cache = Sys.Application._tryName(name, type);
			if (!cache) {
				var casedName = Sys.Application._mapToPrototype(name, type);
				if (casedName && (casedName !== name)) {
					cache = Sys.Application._tryName(casedName, type);
				}
				if (!cache) {
					cache = { name: name };
				}
			}
			index[name] = cache;
			return cache;
		}
		Sys.Application._mapToPrototype = function Sys$Application$_mapToPrototype(name, type) {
			if (!type) {
				throw new Error("type is undefined (name=\"" + name + "\").");
			}

			if (!type.__typeName) {
				throw new Error("\"" + type + "\" is not a valid type (name=\"" + name + "\").");
			}

			var fixedName, caseIndex = Sys.Application._caseIndex[type.__typeName];
			if (!caseIndex) {
				caseIndex = {};
				type.resolveInheritance();
				for (var memberName in type.prototype) {
					if (memberName.startsWith("get_") || memberName.startsWith("set_") || memberName.startsWith("add_")) {
						memberName = memberName.substr(4);
					}
					else if (memberName.startsWith("remove_")) {
						memberName = memberName.substr(7);
					}
					caseIndex[memberName.toLowerCase()] = memberName;
				}
				Sys.Application._caseIndex[type.__typeName] = caseIndex;
			}
			name = name.toLowerCase();
			if (name.startsWith('on')) {
				fixedName = caseIndex[name.substr(2)];
				if (fixedName) {
					fixedName = "on" + fixedName;
				}
				else {
					fixedName = caseIndex[name];
				}
			}
			else {
				fixedName = caseIndex[name];
			}
			return fixedName;
		}

		Sys.Application._doEval = function Sys$Application$_doEval(__expression, $context) {
			with ($context.dataItem || {}) {
				return eval("(" + __expression + ")");
			}
		};
		Sys.Application._evaluateExpression = function Sys$Application$_evaluateExpression(expression, $context, $element) {
			var fn = new Function("$rootContext", "$context", "$element", "$dataItem", "$index", "$id", "$vm", "$emit", "return " + expression + ";");
			return fn($context.rootContext, $context, $element, $context.dataItem, $context.index, $context.rootContext.vm, $context.rootContext.vm ? $context.rootContext.vm.$emit.bind($context.rootContext.vm) : null, function (prefix) { return $context.getInstanceId(prefix); });
		};

		Sys.Application._registerComponent = function Sys$Application$_registerComponent(element, component) {
			var components = element._components;
			if (!components) {
				element._components = components = [];
			}
			components[components.length] = component;
		}

		Sys.Application._activateOnPartial = function Sys$Application$_activateOnPartial(panel, rendering) {
			this._doUpdatePanel(panel, rendering);
			if (Sys.activateDom) {
				Sys.Application.activateElement(panel);
			}
		}

		Sys.Application._raiseInit = function Sys$Application$_raiseInit() {
			this.beginCreateComponents();
			Sys.Observer.raiseEvent(this, "init");
			if (Sys.activateDom) {
				Sys.Application.activateElement(document.documentElement);
			}
			if (Sys.WebForms && Sys.WebForms.PageRequestManager) {
				var prm = Sys.WebForms.PageRequestManager.getInstance();
				prm._doUpdatePanel = prm._updatePanel;
				prm._updatePanel = Sys.Application._activateOnPartial;
			}
			this.endCreateComponents();
		}
		Sys.BindingMode = function Sys$BindingMode() {
		}






		Sys.BindingMode.prototype = {
			auto: 0,
			oneTime: 1,
			oneWay: 2,
			twoWay: 3,
			oneWayToSource: 4
		}
		Sys.BindingMode.registerEnum("Sys.BindingMode");
		Sys.Binding = function Sys$Binding() {
			Sys.Binding.initializeBase(this);
			this._sourceHandlers = [];
			this._targetHandlers = [];
			this._onSourceChanged = Function.createDelegate(this, this._sourceChanged);
			this._onTargetChanged = Function.createDelegate(this, this._targetChanged);
			this._onOptionsUpdated = Function.createDelegate(this, this._optionsUpdated);
			this._onDispose = Function.createDelegate(this, this.dispose);
		}


		function Sys$Binding$get_convert() {
			/// <value mayBeNull="true" locid="P:J#Sys.Binding.convert"></value>
			return this._convert || null;
		}
		function Sys$Binding$set_convert(value) {
			this._convert = value;
			this._convertFn = this._resolveFunction(value);
		}
		function Sys$Binding$get_convertBack() {
			/// <value mayBeNull="true" locid="P:J#Sys.Binding.convertBack"></value>
			return this._convertBack || null;
		}
		function Sys$Binding$set_convertBack(value) {
			this._convertBack = value;
			this._convertBackFn = this._resolveFunction(value);
		}
		function Sys$Binding$get_ignoreErrors() {
			/// <value type="Boolean" mayBeNull="false" locid="P:J#Sys.Binding.ignoreErrors"></value>
			return !!this._ignoreErrors;
		}
		function Sys$Binding$set_ignoreErrors(value) {
			this._ignoreErrors = value;
		}
		function Sys$Binding$get_mode() {
			/// <value type="Sys.BindingMode" mayBeNull="false" locid="P:J#Sys.Binding.mode"></value>
			return this._mode || Sys.BindingMode.auto;
		}
		function Sys$Binding$set_mode(value) {
			if (this._initialized) {
				throw Error.invalidOperation(String.format(Sys.UI.TemplatesRes.commonNotAfterInit, "Binding", "mode"));
			}
			this._mode = value;
		}
		function Sys$Binding$get_defaultValue() {
			/// <value mayBeNull="true" locid="P:J#Sys.Binding.defaultValue"></value>
			return this._defaultValue;
		}
		function Sys$Binding$set_defaultValue(value) {
			this._defaultValue = value;
		}
		function Sys$Binding$get_source() {
			/// <value mayBeNull="true" locid="P:J#Sys.Binding.source"></value>
			return this._source || null;
		}
		function Sys$Binding$set_source(value) {
			if (this._initialized) {
				throw Error.invalidOperation(String.format(Sys.UI.TemplatesRes.commonNotAfterInit, "Binding", "source"));
			}
			this._source = value;
		}
		function Sys$Binding$get_templateContext() {
			/// <value mayBeNull="true" type="Sys.UI.TemplateContext" locid="P:J#Sys.Binding.templateContext"></value>
			return this._templateContext || null;
		}
		function Sys$Binding$set_templateContext(value) {
			this._templateContext = value;
		}
		function Sys$Binding$get_path() {
			/// <value type="String" mayBeNull="true" locid="P:J#Sys.Binding.path"></value>
			return this._path || "";
		}
		function Sys$Binding$set_path(value) {
			if (this._initialized) {
				throw Error.invalidOperation(String.format(Sys.UI.TemplatesRes.commonNotAfterInit, "Binding", "path"));
			}
			this._path = value;
			this._pathArray = value ? value.split('.') : null;
		}
		function Sys$Binding$get_target() {
			/// <value mayBeNull="true" locid="P:J#Sys.Binding.target"></value>
			return this._target || null;
		}
		function Sys$Binding$set_target(value) {
			if (this._initialized) {
				throw Error.invalidOperation(String.format(Sys.UI.TemplatesRes.commonNotAfterInit, "Binding", "target"));
			}
			this._target = value;
		}
		function Sys$Binding$get_targetProperty() {
			/// <value type="String" mayBeNull="true" locid="P:J#Sys.Binding.targetProperty"></value>
			return this._targetProperty || "";
		}
		function Sys$Binding$set_targetProperty(value) {
			if (this._initialized) {
				throw Error.invalidOperation(String.format(Sys.UI.TemplatesRes.commonNotAfterInit, "Binding", "targetProperty"));
			}
			this._targetProperty = value;
			this._targetPropertyArray = value ? value.split('.') : null;
		}
		function Sys$Binding$_addBinding(element) {
			if (element.nodeType === 3) {
				element = element.parentNode;
				if (!element) return;
			}
			var bindings = element.__msajaxbindings = element.__msajaxbindings || [];
			bindings.push(this);
			Sys.UI.DomElement._onDispose(element, Sys.Binding._disposeBindings);
		}
		function Sys$Binding$dispose() {
			/// <summary locid="M:J#Sys.Binding.dispose" />
			if (!this._disposed) {
				this._disposed = true;
				this._watchObject(null);
				this._watchObject(null, true);
				this._targetHandlers = null;
				this._sourceHandlers = null;
				var source = this._source,
				target = this._target;
				if (source) {
					if (this._sourceOption) Sys.Observer.removeEventHandler(source, "optionsChanged", this._onOptionsUpdated);
					if (Sys.INotifyDisposing.isImplementedBy(source)) source.remove_disposing(this._onDispose);
				}
				if (target) {
					if (this._targetOption) Sys.Observer.removeEventHandler(target, "optionsChanged", this._onOptionsUpdated);
					if (Sys.INotifyDisposing.isImplementedBy(target)) target.remove_disposing(this._onDispose);
				}
				this._convert = this._convertBack = this._convertFn = this._convertBackFn = this._lastSource = this._lastTarget =
					this._source = this._target = this._path = this._pathArray = this._defaultValue = this._targetProperty =
					this._targetPropertyArray = this._templateContext = this._updateSource = this._sourceOption = this._updateTarget =
					this._targetOption = this._mode = this._onOptionsUpdated = this._onTargetChanged = this._onSourceChanged =
					this._onDispose = null;
			}
			Sys.Binding.callBaseMethod(this, 'dispose');
		}
		function Sys$Binding$_getPropertyFromIndex(obj, path, startIndex, endIndex) {
			for (var i = startIndex; i <= endIndex; i++) {
				if (obj === null || typeof (obj) === "undefined") {
					return null;
				}
				obj = this._getPropertyData(obj, path[i]);
			}
			return obj;
		}
		function Sys$Binding$_getPropertyData(obj, name) {
			if (typeof (obj["get_" + name]) === "function") {
				return obj["get_" + name]();
			}
			else {
				return obj[name];
			}
		}
		function Sys$Binding$_watchObject(object, isSource) {
			var path = isSource ? this._pathArray : this._targetPropertyArray,
			handlers = isSource ? this._sourceHandlers : this._targetHandlers,
			observable = !!object;
			if (path) {
				for (var i = 0; i < path.length; i++) {
					var property = path[i],
					handler = handlers[i];
					if (!handler || handler.object !== object) {
						if (handler) {
							this._forget(handler);
							handlers[i] = null;
						}
						if (observable) {
							handlers[i] = this._listen(object, property, isSource);

							// if the leaf of the path is a vue ref, listen to the value as well
							if (i === path.length - 1 && _isVueRef(object[property])) {
								path.push('value');
							}
						}
					}
					if (observable) {
						object = this._getPropertyData(object, property);
						observable = (object && (typeof (object) === "object" || (object instanceof Array) || Sys._isDomElement(object)) || _isVueType(object));
					}
					else {
						object = null;
					}
				}

				// clean up orphaned leaf handlers
				for (var i = path.length; i < handlers.length; i++) {
					if (handlers[i]) {
						this._forget(handlers[i]);
						handlers[i] = null;
					}
				}
			}
		}
		function Sys$Binding$_isInput(element, property) {
			var ret,
			tag = (Sys.UI.DomElement.isDomElement(element) && element.nodeType === 1 && element.tagName) ?
				element.tagName.toLowerCase() : "";
			if (tag === "select" || tag === "input" || tag === "textarea") {
				property = (property || "").toLowerCase();
				if (property === "value" || property === "selectedindex" || property === "checked") {
					if (tag !== "input" || (tag === "input" && !/button|image|hidden|submit|reset/i.test(element.type))) {
						ret = tag;
					}
				}
			}
			return ret;
		}
		function _isVueRef(value) {
			return window.Vue && Vue.isRef(value);
		}
		function _isVueReactive(value) {
			return window.Vue && Vue.isReactive(value);
		}
		function _isVueType(value) {
			return _isVueRef(value) || _isVueReactive(value);
		}
		function Sys$Binding$_listen(object, property, isSource) {
			var _this = this,
			listener = isSource ? this._onSourceChanged : this._onTargetChanged,
			handlers = {
				listener: listener,
				object: object,
				pc: function (sender, args) {
					var changed = args.get_propertyName();
					if (!changed || changed === property) {
						listener();
					}
				},
				dom: []
			};
			Sys.Observer._addEventHandler(object, "propertyChanged", handlers.pc);
			var isInput = this._isInput(object, property),
				adder = Sys.UI.DomEvent.addHandler;
			if (_isVueType(object) || _isVueType(object[property])) {
				var o = object;
				var deps = [function () { return o[property]; }];
				var isList = false;
				if (Array.isArray(object[property])) {
					isList = true;
					deps.push(function () { return o[property].length; });
				}
				handlers.dispose = Vue.watch(deps, function (newVals) {
					listener();
					if (isList)
						Sys.Observer.raiseCollectionChanged(newVals[0]);
				}.bind(this));
			}
			if (isInput) {
				handlers.dom.push("change");
				adder(object, "change", listener);
				if (isInput !== "textarea") {
					handlers.dom.push("click");
					adder(object, "click", listener);
					if (isInput === "select") {
						handlers.dom.push("keyup");
						adder(object, "keyup", listener);
					}
				}
			}
			object = null;
			return handlers;
		}
		function Sys$Binding$_forget(handler) {
			var object = handler.object,
			dom = handler.dom;
			if (handler.pc)
				Sys.Observer._removeEventHandler(object, "propertyChanged", handler.pc);
			for (var i = 0, l = dom.length; i < l; i++) {
				Sys.UI.DomEvent.removeHandler(object, dom[i], handler.listener);
			}
			if (handler.dispose)
				handler.dispose();
		}
		function Sys$Binding$_resolveFunction(value) {
			var e, ret;
			if (typeof (value) === 'function') {
				ret = value;
			}
			else {
				if (typeof (value) !== "string") {
					throw Error.invalidOperation(String.format(Sys.UI.TemplatesRes.invalidFunctionName, value));
				}
				ret = Sys.converters[value];
				if (!ret) {
					try {
						ret = Type.parse(value);
					}
					catch (e) {
						throw Error.invalidOperation(String.format(Sys.UI.TemplatesRes.functionNotFound, value));
					}
				}
			}
			return ret;
		}
		function Sys$Binding$link() {
			/// <summary locid="M:J#Sys.Binding.link" />
			if (this.get_mode() === Sys.BindingMode.oneWayToSource) {
				this._targetChanged(false);
			}
			else {
				this._sourceChanged(false);
			}
			Sys.Binding.callBaseMethod(this, 'link');
		}
		function Sys$Binding$update(mode) {
			/// <summary locid="M:J#Sys.Binding.update" />
			/// <param name="mode" optional="true" mayBeNull="true"></param>
			if (!this._initialized) {
				throw Error.invalidOperation(Sys.UI.TemplatesRes.updateBeforeInit);
			}
			mode = mode || this.get_mode();
			if (mode === Sys.BindingMode.oneWayToSource) {
				this._targetChanged(true);
			}
			else {
				this._sourceChanged(true);
			}
		}
		function Sys$Binding$_notSet(name) {
			throw Error.invalidOperation(String.format(Sys.UI.TemplatesRes.bindingPropertyNotSet, name));
		}

		function Sys$Binding$initialize() {
			if (!this.get_isInitialized()) {
				if (!this.get_targetProperty()) {
					this._notSet("targetProperty");
				}
				var tc = this.get_templateContext();
				if (!tc) {
					this._doInitialize();
				}
				else {
					tc._completed.push(Function.createDelegate(this, this._doInitialize));
				}
			}
		}
		function Sys$Binding$_doInitialize() {
			var source = this.get_source(),
				target = this.get_target();
			if (typeof (source) === "string") {
				this.set_source(source = this._resolveReference(source) || null);
			}
			if (typeof (target) === "string") {
				this.set_target(target = this._resolveReference(target) || null);
			}
			var mode = this.get_mode();
			if (target && (mode === Sys.BindingMode.auto)) {
				mode = "oneWay";
				if ((this._isInput(target, this._targetPropertyArray ? this._targetPropertyArray[0] : "")) ||
				Sys.INotifyPropertyChange.isImplementedBy(target)) {
					mode = "twoWay";
				}
				mode = Sys.BindingMode[mode];
				this.set_mode(mode);
			}
			Sys.Binding.callBaseMethod(this, 'initialize');
			if (this.get_isLinkPending()) {
				this.link();
			}
			else {
				this.update(mode);
			}

			if (mode !== Sys.BindingMode.oneTime) {
				if (source) {
					if (mode !== Sys.BindingMode.oneWayToSource) {
						this._watchObject(source, true);
						if (Sys.INotifyDisposing.isImplementedBy(source)) {
							source.add_disposing(this._onDispose);
						}
					}
					if (Sys.UI.DomElement.isDomElement(source)) {
						this._addBinding(source);
					}
				}
				if (target) {
					if (mode !== Sys.BindingMode.oneWay) {
						this._watchObject(target);
						if (Sys.INotifyDisposing.isImplementedBy(target)) {
							target.add_disposing(this._onDispose);
						}
					}
					if (Sys.UI.DomElement.isDomElement(target)) {
						this._addBinding(target);
					}
				}
			}
			function listen(e, p) {
				if (Sys.UI.DomElement.isDomElement(e) && /^select$/i.test(e.tagName) && /^(selectedIndex|value)$/i.test(p)) {
					Sys.Observer.addEventHandler(e, "optionsChanged", this._onOptionsUpdated);
					return true;
				}
				return false;
			}
			if (source && mode >= 3) {
				this._sourceOption = listen.call(this, source, this.get_path());
			}
			if (target && mode <= 3) {
				this._targetOption = listen.call(this, target, this.get_targetProperty());
			}
		}
		function Sys$Binding$_isChecked(element, name) {
			return (name === "checked") && (element.tagName.toLowerCase() === "input");
		}
		function Sys$Binding$_optionsUpdated(select) {
			if (!this._disposed) {
				this.update(select === this.get_source() ? 4 : 2);
			}
		}
		function Sys$Binding$_sourceChanged(force) {
			if (this._disposed) return;
			var er,
				link = force === false,
				target = this.get_target(),
				source = this.get_source();
			force = force === true;
			if (!target) return;
			source = (source && this._pathArray)
					? this._getPropertyFromIndex(source, this._pathArray, 0, this._pathArray.length - 1)
					: source;
			if (_isVueRef(source)) {
				source = source.value;
			}
			if (!this._updateSource && (force || link || (source !== this._lastSource))) {
				try {
					this._updateTarget = true;
					this._lastSource = this._lastTarget = source;
					if (!link) {
						if (this._convertFn) {
							if (this._ignoreErrors) {
								try {
									source = this._convertFn(source, this);
								}
								catch (er) { }
							}
							else {
								source = this._convertFn(source, this);
							}
						}
						if ((source === null) || (typeof (source) === "undefined")) {
							source = this.get_defaultValue();
						}
						if (this._targetProperty && this._targetProperty.startsWith("class:")) {
							var className = this._targetProperty.substr(6).trim();
							source ? Sys.UI.DomElement.addCssClass(target, className) : Sys.UI.DomElement.removeCssClass(target, className);
						}
						else {
							var targetArrayLength = this._targetPropertyArray.length;
							target = this._getPropertyFromIndex(target, this._targetPropertyArray, 0, targetArrayLength - 2);
							if ((target !== null) && (typeof (target) !== "undefined")) {
								var name = this._targetPropertyArray[targetArrayLength - 1],
								isElement = Sys.UI.DomElement.isDomElement(target);
								if (isElement) {
									source = Sys.UI.Template._checkAttribute(name, source);
									if (source === null || source === undefined) {
										source = "";
									}
								}
								if (isElement && (name === "innerHTML" || name === "innerText")) {
									Sys.Application._clearContent(target);
									if (name === "innerHTML") {
										target.innerHTML = source;
									}
									else {
										target.appendChild(document.createTextNode(source));
									}
									Sys.Observer.raisePropertyChanged(target, name);
								}
								else if (isElement && (name === "tabIndex" || name === "tabindex")) {
									Sys.Observer._setValue(target, "tabIndex", source);
								}
								else {
									Sys.Observer._setValue(target, name, source);
								}
								if (source && isElement && this._isChecked(target, name)) {
									var a = document.createAttribute(name);
									a.nodeValue = name;
									target.setAttributeNode(a);
								}
							}
						}
					}
				}
				finally {
					this._updateTarget = false;
				}
			}
			if (!force && !link) {
				this._watchObject(this.get_source(), true);
			}
		}
		function Sys$Binding$_targetChanged(force) {
			if (this._disposed) return;
			var link = force === false,
				target = this.get_target(),
				source = this.get_source();
			force = force === true;
			if (!source) return;
			target = !target ? null : this._getPropertyFromIndex(target, this._targetPropertyArray,
												0, this._targetPropertyArray.length - 1);
			if (!this._updateTarget && (force || link || (target !== this._lastTarget))) {
				try {
					this._updateSource = true;
					this._lastTarget = this._lastSource = target;
					if (!link) {
						if (this._convertBackFn) {
							if (this._ignoreErrors) {
								try {
									target = this._convertBackFn(target, this);
								}
								catch (e) { }
							}
							else {
								target = this._convertBackFn(target, this);
							}
						}
						if (this._pathArray) {
							var sourceArrayLength = this._pathArray.length;
							source = this._getPropertyFromIndex(source, this._pathArray, 0, sourceArrayLength - 2);
							if ((source !== null) && (typeof (source) !== "undefined")) {
								var name = this._pathArray[sourceArrayLength - 1],
								isElement = Sys.UI.DomElement.isDomElement(source);
								if (isElement) {
									target = Sys.UI.Template._checkAttribute(name, target);
									if (name === "innerHTML") {
										Sys.Application._clearContent(source);
									}
								}
								Sys.Observer._setValue(source, name, target);
								if (target && isElement && this._isChecked(source, name)) {
									var a = document.createAttribute(name);
									a.nodeValue = name;
									source.setAttributeNode(a);
								}
							}
						}
					}
				}
				finally {
					this._updateSource = false;
				}
			}
			if (!force && !link) {
				this._watchObject(this.get_target());
			}
		}
		function Sys$Binding$_resolveReference(str) {
			var ref = Sys.get(str, this.get_templateContext());
			if ((ref === null) || (typeof (ref) === "undefined")) {
				throw Error.invalidOperation(String.format(Sys.UI.TemplatesRes.unresolvedReference, str));
			}
			return ref || null;
		}
		Sys.Binding.prototype = {
			_defaultValue: null,
			get_convert: Sys$Binding$get_convert,
			set_convert: Sys$Binding$set_convert,
			get_convertBack: Sys$Binding$get_convertBack,
			set_convertBack: Sys$Binding$set_convertBack,
			get_ignoreErrors: Sys$Binding$get_ignoreErrors,
			set_ignoreErrors: Sys$Binding$set_ignoreErrors,
			get_mode: Sys$Binding$get_mode,
			set_mode: Sys$Binding$set_mode,
			get_defaultValue: Sys$Binding$get_defaultValue,
			set_defaultValue: Sys$Binding$set_defaultValue,
			get_source: Sys$Binding$get_source,
			set_source: Sys$Binding$set_source,
			get_templateContext: Sys$Binding$get_templateContext,
			set_templateContext: Sys$Binding$set_templateContext,
			get_path: Sys$Binding$get_path,
			set_path: Sys$Binding$set_path,
			get_target: Sys$Binding$get_target,
			set_target: Sys$Binding$set_target,
			get_targetProperty: Sys$Binding$get_targetProperty,
			set_targetProperty: Sys$Binding$set_targetProperty,
			_addBinding: Sys$Binding$_addBinding,
			dispose: Sys$Binding$dispose,
			_getPropertyFromIndex: Sys$Binding$_getPropertyFromIndex,
			_getPropertyData: Sys$Binding$_getPropertyData,
			_watchObject: Sys$Binding$_watchObject,
			_isInput: Sys$Binding$_isInput,
			_listen: Sys$Binding$_listen,
			_forget: Sys$Binding$_forget,
			_resolveFunction: Sys$Binding$_resolveFunction,
			update: Sys$Binding$update,
			link: Sys$Binding$link,
			_notSet: Sys$Binding$_notSet,
			initialize: Sys$Binding$initialize,
			_doInitialize: Sys$Binding$_doInitialize,
			_isChecked: Sys$Binding$_isChecked,
			_optionsUpdated: Sys$Binding$_optionsUpdated,
			_sourceChanged: Sys$Binding$_sourceChanged,
			_targetChanged: Sys$Binding$_targetChanged,
			_resolveReference: Sys$Binding$_resolveReference
		}
		Sys.Binding._disposeBindings = function Sys$Binding$_disposeBindings() {
			var bindings = this.__msajaxbindings;
			if (bindings) {
				for (var i = 0, l = bindings.length; i < l; i++) {
					bindings[i].dispose();
				}
			}
			this.__msajaxbindings = null;
		}
		Sys.Binding.registerClass("Sys.Binding", Sys.Component, Sys.UI.ITemplateContextConsumer);
		Sys.converters = Sys.converters || {};

		Sys.Binding.bind = function Sys$Binding$bind(targetOrOptions, property, source, path, options) {
			if (arguments.length > 1) {
				options = merge({
					target: targetOrOptions,
					targetProperty: property,
					source: source,
					path: path,
					templateContext: Sys._isInstanceOfType(Sys.UI.TemplateContext, this) ? this : null
				}, options);
			}
			else {
				options = targetOrOptions;
			}
			var value = options.mode;
			if (typeof (value) === "string") {
				options.mode = Sys.BindingMode.parse(value);
			}
			value = options.ignoreErrors;
			if (typeof (value) === "string") {
				options.ignoreErrors = Boolean.parse(value);
			}
			var binding = new Sys.Binding();
			forIn(options, function (v, n) {
				if (typeof (v) !== "undefined") Sys.Observer.setValue(binding, n, v);
			});
			binding.initialize();
			return binding;
		}

		Sys.registerPlugin({
			name: "bind",
			plugin: Sys.Binding.bind
		});

		Sys.Application.registerMarkupExtension(
"binding",
function (component, targetProperty, templateContext, properties) {
	var options = merge({
		source: templateContext.dataItem,
		templateContext: templateContext,
		target: component,
		targetProperty: targetProperty
	}, properties);
	options.path = options.path || options.$default;
	delete options.$default;
	var binding = Sys.Binding.bind(options);
	templateContext.components.push(binding);
},
false);
		Sys.UI.DataView = function Sys$UI$DataView(element) {
			/// <summary locid="M:J#Sys.UI.DataView.#ctor" />
			/// <param name="element"></param>
			Sys.UI.DataView.initializeBase(this, [element]);
		}

		// Global dataview configuration
		Sys.UI.DataView.config = {
			useOptimalUpdates: false
		};

		function Sys$UI$DataView$add_command(handler) {
			/// <summary locid="E:J#Sys.UI.DataView.command" />
			this._addHandler("command", handler);
		}
		function Sys$UI$DataView$remove_command(handler) {
			this._removeHandler("command", handler);
		}
		function Sys$UI$DataView$add_rendering(handler) {
			/// <summary locid="E:J#Sys.UI.DataView.rendering" />
			this._addHandler("rendering", handler);
		}
		function Sys$UI$DataView$remove_rendering(handler) {
			this._removeHandler("rendering", handler);
		}
		function Sys$UI$DataView$add_rendered(handler) {
			/// <summary locid="E:J#Sys.UI.DataView.rendered" />
			this._addHandler("rendered", handler);
		}
		function Sys$UI$DataView$remove_rendered(handler) {
			this._removeHandler("rendered", handler);
		}
		function Sys$UI$DataView$add_itemRendered(handler) {
			/// <summary locid="E:J#Sys.UI.DataView.itemRendered" />
			this._addHandler("itemRendered", handler);
		}
		function Sys$UI$DataView$remove_itemRendered(handler) {
			this._removeHandler("itemRendered", handler);
		}
		function Sys$UI$DataView$add_itemRendering(handler) {
			/// <summary locid="E:J#Sys.UI.DataView.itemRendering" />
			this._addHandler("itemRendering", handler);
		}
		function Sys$UI$DataView$remove_itemRendering(handler) {
			this._removeHandler("itemRendering", handler);
		}
		function Sys$UI$DataView$add_fetchFailed(handler) {
			/// <summary locid="E:J#Sys.UI.DataView.fetchFailed" />
			this._addHandler("fetchFailed", handler);
		}
		function Sys$UI$DataView$remove_fetchFailed(handler) {
			this._removeHandler("fetchFailed", handler);
		}
		function Sys$UI$DataView$add_fetchSucceeded(handler) {
			/// <summary locid="E:J#Sys.UI.DataView.fetchSucceeded" />
			this._addHandler("fetchSucceeded", handler);
		}
		function Sys$UI$DataView$remove_fetchSucceeded(handler) {
			this._removeHandler("fetchSucceeded", handler);
		}
		function Sys$UI$DataView$get_viewData() {
			/// <value mayBeNull="true" locid="P:J#Sys.UI.DataView.viewData"></value>
			return this._viewData || null;
		}
		function Sys$UI$DataView$get_data() {
			/// <value mayBeNull="true" locid="P:J#Sys.UI.DataView.data"></value>
			return this._data;
		}
		function Sys$UI$DataView$set_data(value) {
			if (!this._setData || (this._data !== value)) {
				this._loadData(value);
			}
		}
		function Sys$UI$DataView$get_dataProvider() {
			/// <value mayBeNull="true" locid="P:J#Sys.UI.DataView.dataProvider"></value>
			return this._provider || null;
		}
		function Sys$UI$DataView$set_dataProvider(value) {
			this._dataProvider = this._wsp = this._wspClass = null;
			if (Sys.Data.IDataProvider.isImplementedBy(value)) {
				this._dataProvider = value;
			}
			else if (Sys.Net.WebServiceProxy.isInstanceOfType(value)) {
				this._wsp = value;
			}
			else if (Type.isClass(value) && value.inheritsFrom(Sys.Net.WebServiceProxy) && typeof (value.get_path) === "function") {
				this._wspClass = value;
			}
			else if ((value !== null) && (typeof (value) !== "string")) {
				throw Error.argument("dataProvider", Sys.UI.TemplatesRes.invalidDataProviderType);
			}
			this._provider = value;
			if (this.get_autoFetch() && this._isActive()) {
				if (value) {
					this._doAutoFetch();
				}
			}
			else {
				this._stale = true;
			}
		}
		function Sys$UI$DataView$get_autoFetch() {
			/// <value locid="P:J#Sys.UI.DataView.autoFetch"></value>
			return this._autoFetch;
		}
		function Sys$UI$DataView$set_autoFetch(value) {
			var was = this._autoFetch;
			if (typeof (value) === "string") {
				value = Boolean.parse(value);
			}
			else if (typeof (value) !== "boolean") {
				throw Error.invalidOperation(Sys.UI.TemplatesRes.stringOrBoolean);
			}
			this._autoFetch = value;
			if (this._isActive() && this._stale && !was && value) {
				this._doAutoFetch();
			}
		}
		function Sys$UI$DataView$get_isFetching() {
			/// <value type="Boolean" locid="P:J#Sys.UI.DataView.isFetching"></value>
			return this._fetching;
		}
		function Sys$UI$DataView$get_httpVerb() {
			/// <value type="String" locid="P:J#Sys.UI.DataView.httpVerb"></value>
			return this._httpVerb || "POST";
		}
		function Sys$UI$DataView$set_httpVerb(value) {
			this._httpVerb = value;
		}
		function Sys$UI$DataView$get_contexts() {
			/// <value type="Array" elementType="Sys.UI.TemplateContext" elementMayBeNull="true" locid="P:J#Sys.UI.DataView.contexts"></value>
			return this._contexts;
		}
		function Sys$UI$DataView$get_fetchParameters() {
			/// <value type="Object" mayBeNull="true" locid="P:J#Sys.UI.DataView.fetchParameters"></value>
			return this._fetchParameters;
		}
		function Sys$UI$DataView$set_fetchParameters(value) {
			if (this._fetchParameters !== value) {
				this._fetchParameters = value;
				if (this.get_autoFetch() && this._isActive()) {
					this._doAutoFetch();
				}
				else {
					this._stale = true;
				}
			}
		}
		function Sys$UI$DataView$get_selectedData() {
			/// <value mayBeNull="true" locid="P:J#Sys.UI.DataView.selectedData"></value>
			var selectedIndex = this.get_selectedIndex();
			if (selectedIndex > -1) {
				var data = this.get_viewData();
				if ((data instanceof Array) && (selectedIndex < data.length)) {
					return data[selectedIndex];
				}
			}
			return null;
		}
		function Sys$UI$DataView$get_selectedIndex() {
			/// <value locid="P:J#Sys.UI.DataView.selectedIndex"></value>
			return this._selectedIndex;
		}
		function Sys$UI$DataView$set_selectedIndex(value) {
			value = this._validateIndexInput(value);
			if (value < -1) {
				throw Error.argumentOutOfRange("value", value);
			}
			if (!this.get_isInitialized() || !this._setData) {
				this._selectedIndex = value;
			}
			else {
				this._applySelectedIndex(value);
			}
		}
		function Sys$UI$DataView$get_initialSelectedIndex() {
			/// <value locid="P:J#Sys.UI.DataView.initialSelectedIndex"></value>
			return this._initialSelectedIndex;
		}
		function Sys$UI$DataView$set_initialSelectedIndex(value) {
			value = this._validateIndexInput(value);
			if (value < -1) {
				throw Error.argumentOutOfRange("value", value);
			}
			if (value !== this.get_initialSelectedIndex()) {
				this._initialSelectedIndex = value;
				this._raiseChanged("initialSelectedIndex");
			}
		}
		function Sys$UI$DataView$get_selectedItemClass() {
			/// <value type="String" locid="P:J#Sys.UI.DataView.selectedItemClass"></value>
			return this._selectedItemClass || "";
		}
		function Sys$UI$DataView$set_selectedItemClass(value) {
			var name = this.get_selectedItemClass();
			if (value !== name) {
				var index = this.get_selectedIndex();
				this._addRemoveCssClass(index, name, Sys.UI.DomElement.removeCssClass);
				this._addRemoveCssClass(index, value, Sys.UI.DomElement.addCssClass);
				this._selectedItemClass = value;
			}
		}
		function Sys$UI$DataView$get_timeout() {
			/// <value type="Number" integer="true" locid="P:J#Sys.UI.DataView.timeout"></value>
			return this._timeout;
		}
		function Sys$UI$DataView$set_timeout(value) {
			this._timeout = value;
		}
		function Sys$UI$DataView$get_fetchOperation() {
			/// <value mayBeNull="true" locid="P:J#Sys.UI.DataView.fetchOperation"></value>
			return this._query || "";
		}
		function Sys$UI$DataView$set_fetchOperation(value) {
			if (this._query !== value) {
				this._query = value;
				if (this.get_autoFetch() && this._isActive()) {
					if (value) {
						this._doAutoFetch();
					}
				}
				else {
					this._stale = true;
				}
			}
		}
		function Sys$UI$DataView$get_itemPlaceholder() {
			/// <value mayBeNull="true" locid="P:J#Sys.UI.DataView.itemPlaceholder"></value>
			return this._placeholder || null;
		}
		function Sys$UI$DataView$set_itemPlaceholder(value) {
			if (this._placeholder !== value) {
				this._placeholder = value;
				this._dirty = true;
				this._raiseChanged("itemPlaceholder");
			}
		}
		function Sys$UI$DataView$get_templateContext() {
			/// <value mayBeNull="true" type="Sys.UI.TemplateContext" locid="P:J#Sys.UI.DataView.templateContext"></value>
			return this._parentContext || Sys.UI.Template.findContext(this.get_element());
		}
		function Sys$UI$DataView$set_templateContext(value) {
			if (this._parentContext !== value) {
				this._parentContext = value;
				this._dirty = true;
				this._raiseChanged("templateContext");
			}
		}
		function Sys$UI$DataView$get_itemTemplate() {
			/// <value mayBeNull="true" locid="P:J#Sys.UI.DataView.itemTemplate"></value>
			return this._template || null;
		}
		function Sys$UI$DataView$set_itemTemplate(value) {
			if (this._template !== value) {
				this._template = value;
				this._dirty = true;
				if (this._dvTemplate) {
					this._dvTemplate.dispose();
					this._dvTemplate = null;
				}
				if (this._isActive()) {
					this.raisePropertyChanged("itemTemplate");
					this.refresh();
				}
				else {
					this._changed = true;
				}
			}
		}
		function Sys$UI$DataView$_applySelectedIndex(value, force) {
			var currentIndex = this.get_selectedIndex();
			if (force || (value !== currentIndex)) {
				var data = this.get_viewData();
				if (!(data instanceof Array)) {
					data = [data];
				}
				var outOfRange = (value < -1) || (value >= data.length);
				if (outOfRange) {
					throw Error.argumentOutOfRange("value", value);
				}
				this._selectedIndex = value;
				this._currentData = ((value === -1) || outOfRange) ? null : data[value];
				var className = this.get_selectedItemClass();
				this._addRemoveCssClass(currentIndex, className, Sys.UI.DomElement.removeCssClass);
				this._addRemoveCssClass(value, className, Sys.UI.DomElement.addCssClass);
				if (!this.get_isUpdating()) {
					if (value !== currentIndex) {
						this.raisePropertyChanged('selectedIndex');
					}
				}
				else {
					this._changed = true;
				}
			}
			if (!this.get_isUpdating()) {
				this._raiseSelectedData();
			}
			else {
				this._changed = true;
			}
		}
		function Sys$UI$DataView$_addRemoveCssClass(index, className, addRemove) {
			if (className && (index > -1)) {
				var items = this.get_contexts(), l = items ? items.length : -1;
				if (l && (index < l)) {
					var elementsSet = items[index].nodes;
					if (elementsSet) {
						for (var i = 0, len = elementsSet.length; i < len; i++) {
							var element = elementsSet[i];
							if (element.nodeType === 1) {
								addRemove(element, className);
							}
						}
					}
				}
			}
		}
		function Sys$UI$DataView$get_useOptimalUpdates() {
			return this._useOptimalUpdates;
		}
		function Sys$UI$DataView$set_useOptimalUpdates(value) {
			this._useOptimalUpdates = value;
		}
		function Sys$UI$DataView$_collectionChanged(sender, args) {
			var oldSelected = this._currentData,
			changes = args.get_changes(),
			selectedIndex = this.get_selectedIndex(), oldIndex = selectedIndex;
			if (this._isActive()) {
				this._changing = true;

				// Determine if the changes contain an add event that occurs before a remove event which preceeds it in the array.
				// i.e.: array = [0, 1], add 2 at index 2, then remove at index 0, resulting in [1, 2]
				var containsAddBeforePrecedingRemove = changes.some(function (evt, i) {
					return evt.action === Sys.NotifyCollectionChangedAction.add && changes.some(function (other, j) {
						return j > i && other.action === Sys.NotifyCollectionChangedAction.remove && other.oldStartingIndex <= evt.newStartingIndex;
					});
				});

				// If an add event occurs before a remove which preceeds it in the array, then fall back to a non-optimal refresh.
				if (containsAddBeforePrecedingRemove) {
					this.refresh();
				}
				else {
					// Determine if the template uses the $index argument by inspecting the compiled template code.
					var template = this._ensureTemplate(this._getTemplate());
					template._ensureCompiled();
					var templateUsesDollarIndex = /with\s*\(.*\$index/.test(template._instantiateIn.toString().replace(/(\r\n|\n|\r)/gm, ""));

					var useOptimalUpdates = this.get_useOptimalUpdates() != null ? this.get_useOptimalUpdates() : Sys.UI.DataView.config.useOptimalUpdates;
					if (useOptimalUpdates !== true || templateUsesDollarIndex) {
						this.refresh();
					}
					else {
						var _this = this;
						foreach(changes, function (evt) {
							var i, arr, start, len;
							if (evt.oldItems && evt.oldItems.length > 0) {
								arr = evt.oldItems;
								start = evt.oldStartingIndex;
								len = arr.length;

								_this._clearContainers(_this._placeholders, start, len);
								_this._contexts.splice(start, len);
							}
							else if (evt.newItems && evt.newItems.length > 0) {
								arr = evt.newItems;
								start = evt.newStartingIndex;
								len = arr.length;

								for (i = 0; i < len; i++) {
									_this._contexts.splice(start + i, 0, null);
								}
								_this.refresh(start, len)
							}
						});
					}
				}
			}
			else {
				this._dirty = true;
				return;
			}
			var data = this.get_viewData();
			if ((selectedIndex !== -1) && (selectedIndex < data.length) &&
			(data[selectedIndex] === oldSelected)) {
				return;
			}
			for (var i = 0, l = changes.length; i < l; i++) {
				var change = changes[i];
				if (change.action === Sys.NotifyCollectionChangedAction.add) {
					if (selectedIndex >= change.newStartingIndex) {
						selectedIndex += change.newItems.length;
					}
				}
				else {
					var index = change.oldStartingIndex, len = change.oldItems.length, lastIndex = index + len - 1;
					if (selectedIndex > lastIndex) {
						selectedIndex -= len;
					}
					else if (selectedIndex >= index) {
						selectedIndex = -1;
						break;
					}
				}
			}
			if (selectedIndex !== oldIndex) {
				this.set_selectedIndex(selectedIndex);
			}
		}
		function Sys$UI$DataView$_elementContains(container, element, excludeSelf) {
			if (container === element) {
				return !excludeSelf;
			}
			do {
				element = element.parentNode;
				if (element === container) return true;
			}
			while (element);
			return false;
		}
		function Sys$UI$DataView$_raiseChanged(name) {
			if (this._isActive()) {
				this.raisePropertyChanged(name);
			}
			else {
				this._changed = true;
			}
		}
		function Sys$UI$DataView$_raiseFailed(request, error) {
			var args = new Sys.Net.WebRequestEventArgs(request ? request.get_executor() : null, error);
			this.onFetchFailed(args);
			Sys.Observer.raiseEvent(this, "fetchFailed", args);
		}
		function Sys$UI$DataView$_raiseSelectedData() {
			if (this._lastData !== this._currentData) {
				this._lastData = this._currentData;
				this.raisePropertyChanged('selectedData');
			}
		}
		function Sys$UI$DataView$_raiseSucceeded(request, result) {
			var args = new Sys.Net.WebRequestEventArgs(request ? request.get_executor() : null, null, result);
			this.onFetchSucceeded(args);
			Sys.Observer.raiseEvent(this, "fetchSucceeded", args);
		}
		function Sys$UI$DataView$_ensureTemplate(template) {
			if (!Sys.UI.Template.isInstanceOfType(template)) {
				template = Sys.UI.DomElement._ensureGet(template, this.get_templateContext(), "itemTemplate");
				if (template) {
					template = new Sys.UI.Template(template);
				}
			}
			return template;
		}
		function Sys$UI$DataView$_setTemplate(value) {
			if (this._dvTemplate) {
				throw Error.invalidOperation(Sys.UI.TemplatesRes.templateAlreadyDefined);
			}
			this._dvTemplate = value;
		}
		function Sys$UI$DataView$_getTemplate() {
			if (this._dvTemplate) return this._dvTemplate;
			var template = this.get_itemTemplate();
			if (!template) {
				var element = this.get_element();
				if (Sys.UI.Template._isTemplate(element)) {
					this._dvTemplate = template = new Sys.UI.Template(element);
				}
			}
			else if (!Sys.UI.Template.isInstanceOfType(template)) {
				template = Sys.UI.DomElement._ensureGet(template, this.get_templateContext(), "itemTemplate");
				var e = this.get_element();
				if ((e !== template) && this._elementContains(e, template, true)) {
					throw Error.invalidOperation(Sys.UI.TemplatesRes.misplacedTemplate);
				}
				this._dvTemplate = template = new Sys.UI.Template(template);
			}
			else {
				if (this._elementContains(this.get_element(), template.get_element(), true)) {
					throw Error.invalidOperation(Sys.UI.TemplatesRes.misplacedTemplate);
				}
			}
			return template;
		}
		function Sys$UI$DataView$_loadData(value) {
			this._swapData(this._data, value);
			this._data = value;
			this._setData = true;
			this._stale = false;
			this._dirty = true;
			if (this._isActive()) {
				if (this.get_isLinkPending()) {
					this.link();
				}
				else {
					this.refresh();
				}
				this.raisePropertyChanged("data");
			}
			else {
				this._changed = true;
			}
		}
		function Sys$UI$DataView$_resetSelectedIndex() {
			var data = this.get_viewData(), initialSelectedIndex = this.get_initialSelectedIndex(),
			selectedIndex = this.get_selectedIndex();
			if (!(data instanceof Array) || (initialSelectedIndex >= data.length)) {
				if (selectedIndex !== -1) {
					this.set_selectedIndex(-1);
					return;
				}
			}
			else if (selectedIndex !== initialSelectedIndex) {
				this.set_selectedIndex(initialSelectedIndex);
				return;
			}
			this._currentData = this.get_selectedData();
			this._raiseSelectedData();
		}
		function Sys$UI$DataView$_initializeResults(start, count) {
			for (var i = start || 0, len = count ? (start + count) : this._contexts.length; i < len; i++) {
				var ctx = this._contexts[i];
				if (ctx) ctx.initializeComponents();
			}
		}
		function Sys$UI$DataView$_isActive() {
			return (this.get_isInitialized() && !this.get_isUpdating());
		}
		function Sys$UI$DataView$_raiseCommand(args) {
			this.onCommand(args);
			Sys.Observer.raiseEvent(this, "command", args);
		}
		function Sys$UI$DataView$_raiseItem(type, args) {
			this['onItem' + type](args);
			Sys.Observer.raiseEvent(this, "item" + type, args);
		}
		function Sys$UI$DataView$abortFetch() {
			/// <summary locid="M:J#Sys.UI.DataView.abortFetch" />
			if (this._request) {
				this._request.get_executor().abort();
				this._request = null;
			}
			if (this._fetching) {
				this._fetching = false;
				this._raiseChanged("isFetching");
			}
		}
		function Sys$UI$DataView$onBubbleEvent(source, args) {
			/// <summary locid="M:J#Sys.UI.DataView.onBubbleEvent" />
			/// <param name="source"></param>
			/// <param name="args" type="Sys.EventArgs"></param>
			/// <returns type="Boolean"></returns>
			if (Sys.CommandEventArgs.isInstanceOfType(args)) {
				this._raiseCommand(args);
				if (args.get_cancel()) {
					return true;
				}
				else {
					var name = args.get_commandName();
					if (name && (name.toLowerCase() === "select")) {
						var index = this._findContextIndex(source);
						if (index !== -1) {
							this.set_selectedIndex(index);
							return true;
						}
					}
				}
			}
			return false;
		}
		function Sys$UI$DataView$onRendering(args) {
			/// <summary locid="M:J#Sys.UI.DataView.onRendering" />
			/// <param name="args" type="Sys.Data.DataEventArgs"></param>
		}
		function Sys$UI$DataView$onFetchFailed(args) {
			/// <summary locid="M:J#Sys.UI.DataView.onFetchFailed" />
			/// <param name="args" type="Sys.Net.WebRequestEventArgs"></param>
		}
		function Sys$UI$DataView$onFetchSucceeded(args) {
			/// <summary locid="M:J#Sys.UI.DataView.onFetchSucceeded" />
			/// <param name="args" type="Sys.Net.WebRequestEventArgs"></param>
		}
		function Sys$UI$DataView$_doAutoFetch() {
			var e;
			try {
				if (this._dataProvider || this._provider) {
					this.fetchData();
					this._stale = false;
				}
			}
			catch (e) {
				this._raiseFailed(null, null);
			}
		}
		function Sys$UI$DataView$_findContextIndex(source) {
			var containers = this._containers;
			if (source && containers) {
				var results = this.get_contexts();
				if (results) {
					var element = Sys.UI.DomElement._ensureGet(source, this.get_templateContext(), "source");
					if (element) {
						var parent = element.parentNode, dvElement = this.get_element(), cindex = -1;
						while (parent && ((cindex = Sys._indexOf(containers, parent)) < 0) && (parent !== dvElement)) {
							element = parent;
							parent = parent.parentNode;
						}
						if (cindex > -1) {
							var container = containers[cindex];
							for (var i = 0, l = results.length; i < l; i++) {
								var result = results[i];
								if ((result.containerElement === container) && (Sys._indexOf(result.nodes, element) > -1)) {
									return i;
								}
							}
						}
					}
				}
			}
			return -1;
		}
		function Sys$UI$DataView$findContext(source) {
			/// <summary locid="M:J#Sys.UI.DataView.findContext" />
			/// <param name="source"></param>
			/// <returns type="Sys.UI.TemplateContext" mayBeNull="true"></returns>
			var index = this._findContextIndex(source);
			return (index !== -1) ? this.get_contexts()[index] : null;
		}
		function Sys$UI$DataView$_clearContainer(container, placeholder, startNode, endNode) {
			var count = placeholder ? placeholder.__msajaxphcount : -1;
			if ((count > -1) && placeholder) placeholder.__msajaxphcount = 0;
			if (count < 0) {
				if (placeholder) {
					container.removeChild(placeholder);
				}
				if (!startNode) {
					Sys.Application.disposeElement(container, true);
				}
				var cleared = false;
				if (!startNode) {
					try {
						container.innerHTML = "";
						cleared = true;
					}
					catch (err) { }
				}
				if (!cleared) {
					var child = startNode || container.firstChild, nextChild;
					while (child) {
						nextChild = child === endNode ? null : child.nextSibling;
						Sys.Application.disposeElement(child, false);
						container.removeChild(child);
						child = nextChild;
					}
				}
				if (placeholder) {
					container.appendChild(placeholder);
				}
			}
			else if (count > 0) {
				var i, l, start, children = container.childNodes;
				for (i = 0, l = children.length; i < l; i++) {
					if (children[i] === placeholder) {
						break;
					}
				}
				start = i - count;
				for (i = 0; i < count; i++) {
					var element = children[start];
					Sys.Application.disposeElement(element, false);
					container.removeChild(element);
				}
			}
		}
		function Sys$UI$DataView$_clearContainers(placeholders, start, count) {
			var i, len;
			for (i = 0, len = placeholders.length; i < len; i++) {
				var ph = placeholders[i],
				container = ph ? ph.parentNode : this.get_element();
				this._clearContainer(container, ph);
			}
			for (i = start || 0, len = count ? (start + count) : this._contexts.length; i < len; i++) {
				var ctx = this._contexts[i];
				ctx.nodes = null;
				ctx.dispose();
			}
		}
		function Sys$UI$DataView$_isAlone(container, ph) {
			var childNodes = container.childNodes;
			if (childNodes.length === 1) return true;
			var node = container.firstChild, notWhitespace = /\S/;
			while (node) {
				if (node !== ph) {
					var type = node.nodeType;
					if (type === 3) {
						if (notWhitespace.test(node.nodeValue)) return false;
					}
					else if (type !== 8) {
						return false;
					}
				}
				node = node.nextSibling;
			}
			return true;
		}
		function Sys$UI$DataView$_generatesContext() {
			return true;
		}
		function Sys$UI$DataView$refresh(start, count) {
			/// <summary locid="M:J#Sys.UI.DataView.refresh" />
			if (!this._setData) return;
			var collectionChange = this._changing;
			this._changing = false;
			var data = this.get_data(),
				pctx = this.get_templateContext(),
				renderArgs = new Sys.Data.DataEventArgs(data);
			renderArgs._itemTemplate = this._getTemplate();
			renderArgs._placeholder = Sys.UI.DomElement._ensureGet(this.get_itemPlaceholder(), pctx, "itemPlaceholder");
			this.onRendering(renderArgs);
			Sys.Observer.raiseEvent(this, "rendering", renderArgs);
			if (renderArgs.get_cancel()) return;
			data = renderArgs.get_data();
			this._viewData = data;

			var template = this._ensureTemplate(renderArgs._itemTemplate);
			this._dirty = false;
			var ph = Sys.UI.DomElement._ensureGet(renderArgs._placeholder, pctx, "itemPlaceholder"),
				element = this.get_element(),
				result, itemTemplate, args,
				contentTemplate = this._contentTemplate;
			if (this._placeholders && arguments.length === 0) {
				this._clearContainers(this._placeholders);
			}
			var list = data;
			var len, i;
			if ((data === null) || (typeof (data) === "undefined")) {
				i = 0;
				len = 0;
			}
			else if (!(data instanceof Array)) {
				list = [data];
				i = 0;
				len = 1;
			}
			else {
				i = start || 0;
				len = count ? (start + count) : data.length;
			}
			function clearAndShow() {
				if (!this._cleared) {
					if (Sys.UI.Template._isTemplate(element)) {
						var selfTemplate = new Sys.UI.Template(element);
						selfTemplate._ensureCompiled();
						selfTemplate.dispose();
						Sys.UI.DomElement.removeCssClass(element, "sys-template");
					}
					this._clearContainer(element, null);
					element.__msajaxphcount = -1;
					this._cleared = true;
				}
			}
			if (!len && template && template.get_element() === element) {
				clearAndShow.call(this);
			}
			var currentPh, lastPh, placeholders, container, containers, optionsChanged, insertBefore;
			if (arguments.length === 0) {
				this._placeholders = placeholders = [];
				this._containers = containers = [];
				this._contexts = new Array(len);
			}
			else {
				placeholders = this._placeholders;
				containers = this._containers;
				var nextContext = this._contexts[start + count];
				if (nextContext && nextContext.nodes) {
					insertBefore = nextContext.nodes[0];
				}
			}
			for (; i < len; i++) {
				var item = list[i];
				args = new Sys.UI.DataViewItemEventArgs(item);
				args._itemTemplate = template;
				args._placeholder = ph;
				this._raiseItem("Rendering", args);
				itemTemplate = this._ensureTemplate(args._itemTemplate);
				currentPh = Sys.UI.DomElement._ensureGet(args._placeholder, pctx, "itemPlaceholder");
				currentPh = currentPh ? (currentPh.__msajaxphoption || currentPh) : null;
				if (currentPh !== lastPh) {
					container = currentPh ? currentPh.parentNode : element;
					if (Sys._indexOf(placeholders, currentPh) < 0) {
						if (currentPh) {
							if (/^option$/i.test(currentPh.tagName) && /select/i.test(container.tagName)) {
								var newPh = document.createElement('_hiddenPlaceholder');
								container.replaceChild(newPh, currentPh);
								currentPh.__msajaxphoption = newPh;
								newPh.appendChild(currentPh);
								currentPh = newPh;
							}
							currentPh.style.display = 'none';
							var phcount = currentPh.__msajaxphcount;
							if (typeof (phcount) === "undefined" && this._isAlone(container, currentPh)) {
								currentPh.__msajaxphcount = -1;
								this._clearContainer(container, currentPh);
							}
						}
						else {
							clearAndShow.call(this);
						}
						placeholders.push(currentPh);
						if (Sys._indexOf(containers, container) < 0) {
							containers.push(container);
							if (/^select$/i.test(container.tagName)) {
								optionsChanged = optionsChanged || [];
								optionsChanged.push(container);
							}
						}
					}
				}
				lastPh = currentPh;
				if (itemTemplate) {
					result = itemTemplate.instantiateIn(container, data, item, i, currentPh || insertBefore, pctx, contentTemplate);
				}
				else {
					result = merge(new Sys.UI.TemplateContext(), {
						nodes: [],
						dataItem: item,
						data: data,
						index: i,
						parentContext: pctx
					});
				}
				args._ctx = result;
				this._contexts[i] = result;
				this._raiseItem("Rendered", result);
				if (itemTemplate && currentPh) {
					var count = currentPh.__msajaxphcount || 0;
					if (count > -1) {
						currentPh.__msajaxphcount = count + result.nodes.length;
					}
				}
			}
			if (optionsChanged) {
				for (i = 0; i < optionsChanged.length; i++) {
					Sys.Observer.raiseEvent(optionsChanged[i], "optionsChanged", Sys.EventArgs.Empty);
				}
			}

			if (!collectionChange) {
				if (!this._rendered && this.get_selectedIndex() > -1) {
					this._applySelectedIndex(this.get_selectedIndex(), true);
				}
				else {
					this._resetSelectedIndex();
				}
			}
			this._rendered = true;

			var selectedClass = this.get_selectedItemClass();
			if (selectedClass) {
				var selectedIndex = this.get_selectedIndex();
				if (selectedIndex !== -1) {
					this._addRemoveCssClass(selectedIndex, selectedClass, Sys.UI.DomElement.addCssClass);
				}
			}
			this.raisePropertyChanged("viewData");
			Sys.Observer.raiseEvent(this, "rendered", renderArgs);
			this._initializeResults(start, count);
		}
		function Sys$UI$DataView$_swapData(oldData, newData) {
			if (oldData) {
				switch (this._eventType) {
					case 1:
						oldData.remove_collectionChanged(this._changedHandler);
						break;
					case 2:
						Sys.Observer.removeCollectionChanged(oldData, this._changedHandler);
						break;
				}
			}
			this._eventType = 0;
			if (newData) {
				if (!this._changedHandler) {
					this._changedHandler = Function.createDelegate(this, this._collectionChanged);
				}
				if (typeof (newData.add_collectionChanged) === "function") {
					newData.add_collectionChanged(this._changedHandler);
					this._eventType = 1;
				}
				else if (newData instanceof Array) {
					Sys.Observer.addCollectionChanged(newData, this._changedHandler);
					this._eventType = 2;
				}
			}
		}
		function Sys$UI$DataView$_validateIndexInput(value) {
			var type = typeof (value);
			if (type === "string") {
				value = parseInt(value);
				if (isNaN(value)) {
					throw Error.argument(Sys.UI.TemplatesRes.invalidSelectedIndexValue);
				}
			}
			else if (type !== "number") {
				throw Error.argument(Sys.UI.TemplatesRes.invalidSelectedIndexValue);
			}
			return value;
		}
		function Sys$UI$DataView$dispose() {
			/// <summary locid="M:J#dispose" />
			if (this._placeholders && !Sys.Application.get_isDisposing()) {
				this._clearContainers(this._placeholders);
			}
			if (this._dvTemplate) {
				this._dvTemplate.dispose();
			}
			if (this.get_isFetching()) {
				this.abortFetch();
				this._fetching = false;
			}
			this._swapData(this._data, null);
			this._currentData = this._lastData = this._placeholders = this._containers = this._placeholder = this._contexts =
				this._autoFetch = this._parentContext = this._dvTemplate = this._request = this._dataProvider = this._wsp =
				this._wspClass = this._fetching = this._initialSelectedIndex = this._selectedIndex = this._provider = this._data =
				this._fetchParameters = this._query = this._contentTemplate = this._changed = this._dirty = this._eventType =
				this._stale = this._timeout = this._visibilityMode = this._changing = this._changedHandler = this._viewData =
				this._cleared = this._rendered = this._setData = null;
			Sys.UI.DataView.callBaseMethod(this, "dispose");
		}
		function Sys$UI$DataView$initialize() {
			/// <summary locid="M:J#initialize" />
			Sys.UI.DataView.callBaseMethod(this, "initialize");
			if (this.get_isLinkPending()) {
				if (this.hasOwnProperty("_data")) {
					this.link();
				}
			}
			else {
				this.refresh();
				this.updated();
			}
		}
		function Sys$UI$DataView$fetchData(succeededCallback, failedCallback, mergeOption, userContext) {
			/// <summary locid="M:J#fetchData" />
			/// <param name="succeededCallback" type="Function" mayBeNull="true" optional="true"></param>
			/// <param name="failedCallback" type="Function" mayBeNull="true" optional="true"></param>
			/// <param name="mergeOption" type="Sys.Data.MergeOption" mayBeNull="true" optional="true"></param>
			/// <param name="userContext" mayBeNull="true" optional="true"></param>
			/// <returns type="Sys.Net.WebRequest"></returns>
			this._stale = false;
			var request, _this = this;
			function onSuccess(data) {
				_this._loadData(data);
				_this._fetching = false;
				_this._request = null;
				_this._raiseChanged("isFetching");
				_this._raiseSucceeded(request, data);
				if (succeededCallback) {
					succeededCallback(data, userContext, "fetchData");
				}
			}
			function onFail(error) {
				_this._fetching = false;
				_this._request = null;
				_this._raiseChanged("isFetching");
				_this._raiseFailed(request, error);
				if (failedCallback) {
					failedCallback(error, userContext, "fetchData");
				}
			}
			if (this._fetching) {
				this.abortFetch();
			}
			var dataProvider = this._dataProvider,
			wsp = this._wsp,
			wspc = this._wspClass,
			query = this.get_fetchOperation(),
			parameters = this.get_fetchParameters() || null,
			httpVerb = this.get_httpVerb() || "POST",
			timeout = this.get_timeout() || 0;
			if (typeof (mergeOption) === "undefined") {
				mergeOption = null;
			}
			if (dataProvider) {
				request = dataProvider.fetchData(query, parameters, mergeOption, httpVerb, onSuccess, onFail, timeout, userContext);
			}
			else if (wsp) {
				var path = wsp.get_path();
				if (!path) {
					var type = Object.getType(wsp);
					if (type && (typeof (type.get_path) === "function")) {
						path = type.get_path();
					}
				}
				Type._checkDependency("MicrosoftAjaxWebServices.js", "Sys.UI.DataView.fetchData");
				request = Sys.UI.DataView._fetchWSP(null, path, query, parameters, httpVerb, onSuccess, onFail, timeout || wsp.get_timeout());
			}
			else {
				Type._checkDependency("MicrosoftAjaxWebServices.js", "Sys.UI.DataView.fetchData");
				if (wspc) {
					request = Sys.UI.DataView._fetchWSP(null, wspc.get_path(), query, parameters, httpVerb, onSuccess,
														 onFail, timeout || wspc.get_timeout());
				}
				else {
					request = Sys.UI.DataView._fetchWSP(null, this._provider, query, parameters, httpVerb, onSuccess, onFail, timeout);
				}
			}
			this._request = request;
			this._fetching = true;
			this._raiseChanged("isFetching");
			return request;
		}
		function Sys$UI$DataView$onCommand(args) {
			/// <summary locid="M:J#Sys.UI.DataView.onCommand" />
			/// <param name="args" type="Sys.CommandEventArgs"></param>
		}
		function Sys$UI$DataView$onItemRendering(args) {
			/// <summary locid="M:J#Sys.UI.DataView.onItemRendering" />
			/// <param name="args" type="Sys.UI.DataViewItemEventArgs"></param>
		}
		function Sys$UI$DataView$onItemRendered(args) {
			/// <summary locid="M:J#Sys.UI.DataView.onItemRendered" />
			/// <param name="args" type="Sys.UI.DataViewItemEventArgs"></param>
		}
		function Sys$UI$DataView$updated() {
			/// <summary locid="M:J#Sys.UI.DataView.updated" />
			if (this._stale && this.get_autoFetch()) {
				this._doAutoFetch();
			}
			if (this._dirty) {
				this.refresh();
			}
			if (this._changed) {
				this.raisePropertyChanged("");
				this._changed = false;
			}
		}
		function Sys$UI$DataView$link() {
			/// <summary locid="M:J#Sys.UI.DataView.link" />

			// Make sure that the control doesn't appear that it needs to re-render
			this._changed = false;
			this._dirty = false;

			// Would normally be set up by "refresh"
			this._contexts = [];
			this._placeholders = [null];
			this._containers = [this.get_element()];

			Sys.Application._linkContexts(this.get_templateContext(), this, this.get_data(), this.get_element(), null, this._contentTemplate);

			// Would normally be called at the end of "refresh"
			this._initializeResults();

			Sys.UI.DataView.callBaseMethod(this, "link");
		}
		Sys.UI.DataView.prototype = {
			_autoFetch: false,
			_fetching: false,
			_changed: false,
			_data: null,
			_dataProvider: null,
			_wsp: null,
			_wspClass: null,
			_dirty: false,
			_stale: true,
			_dvTemplate: null,
			_eventType: 0,
			_httpVerb: null,
			_initialSelectedIndex: -1,
			_fetchParameters: null,
			_parentContext: null,
			_placeholder: null,
			_query: null,
			_contexts: null,
			_selectedIndex: -1,
			_selectedItemClass: null,
			_template: null,
			_timeout: 0,
			_request: null,
			add_command: Sys$UI$DataView$add_command,
			remove_command: Sys$UI$DataView$remove_command,
			add_rendering: Sys$UI$DataView$add_rendering,
			remove_rendering: Sys$UI$DataView$remove_rendering,
			add_rendered: Sys$UI$DataView$add_rendered,
			remove_rendered: Sys$UI$DataView$remove_rendered,
			add_itemRendered: Sys$UI$DataView$add_itemRendered,
			remove_itemRendered: Sys$UI$DataView$remove_itemRendered,
			add_itemRendering: Sys$UI$DataView$add_itemRendering,
			remove_itemRendering: Sys$UI$DataView$remove_itemRendering,
			add_fetchFailed: Sys$UI$DataView$add_fetchFailed,
			remove_fetchFailed: Sys$UI$DataView$remove_fetchFailed,
			add_fetchSucceeded: Sys$UI$DataView$add_fetchSucceeded,
			remove_fetchSucceeded: Sys$UI$DataView$remove_fetchSucceeded,
			get_viewData: Sys$UI$DataView$get_viewData,
			get_data: Sys$UI$DataView$get_data,
			set_data: Sys$UI$DataView$set_data,
			get_dataProvider: Sys$UI$DataView$get_dataProvider,
			set_dataProvider: Sys$UI$DataView$set_dataProvider,
			get_autoFetch: Sys$UI$DataView$get_autoFetch,
			set_autoFetch: Sys$UI$DataView$set_autoFetch,
			get_isFetching: Sys$UI$DataView$get_isFetching,
			get_httpVerb: Sys$UI$DataView$get_httpVerb,
			set_httpVerb: Sys$UI$DataView$set_httpVerb,
			get_contexts: Sys$UI$DataView$get_contexts,
			get_fetchParameters: Sys$UI$DataView$get_fetchParameters,
			set_fetchParameters: Sys$UI$DataView$set_fetchParameters,
			get_selectedData: Sys$UI$DataView$get_selectedData,
			get_selectedIndex: Sys$UI$DataView$get_selectedIndex,
			set_selectedIndex: Sys$UI$DataView$set_selectedIndex,
			get_initialSelectedIndex: Sys$UI$DataView$get_initialSelectedIndex,
			set_initialSelectedIndex: Sys$UI$DataView$set_initialSelectedIndex,
			get_selectedItemClass: Sys$UI$DataView$get_selectedItemClass,
			set_selectedItemClass: Sys$UI$DataView$set_selectedItemClass,
			get_timeout: Sys$UI$DataView$get_timeout,
			set_timeout: Sys$UI$DataView$set_timeout,
			get_fetchOperation: Sys$UI$DataView$get_fetchOperation,
			set_fetchOperation: Sys$UI$DataView$set_fetchOperation,
			get_itemPlaceholder: Sys$UI$DataView$get_itemPlaceholder,
			set_itemPlaceholder: Sys$UI$DataView$set_itemPlaceholder,
			get_templateContext: Sys$UI$DataView$get_templateContext,
			set_templateContext: Sys$UI$DataView$set_templateContext,
			get_itemTemplate: Sys$UI$DataView$get_itemTemplate,
			set_itemTemplate: Sys$UI$DataView$set_itemTemplate,
			get_useOptimalUpdates: Sys$UI$DataView$get_useOptimalUpdates,
			set_useOptimalUpdates: Sys$UI$DataView$set_useOptimalUpdates,
			_applySelectedIndex: Sys$UI$DataView$_applySelectedIndex,
			_addRemoveCssClass: Sys$UI$DataView$_addRemoveCssClass,
			_collectionChanged: Sys$UI$DataView$_collectionChanged,
			_elementContains: Sys$UI$DataView$_elementContains,
			_raiseChanged: Sys$UI$DataView$_raiseChanged,
			_raiseFailed: Sys$UI$DataView$_raiseFailed,
			_raiseSelectedData: Sys$UI$DataView$_raiseSelectedData,
			_raiseSucceeded: Sys$UI$DataView$_raiseSucceeded,
			_ensureTemplate: Sys$UI$DataView$_ensureTemplate,
			_setTemplate: Sys$UI$DataView$_setTemplate,
			_getTemplate: Sys$UI$DataView$_getTemplate,
			_loadData: Sys$UI$DataView$_loadData,
			_resetSelectedIndex: Sys$UI$DataView$_resetSelectedIndex,
			_initializeResults: Sys$UI$DataView$_initializeResults,
			_isActive: Sys$UI$DataView$_isActive,
			_raiseCommand: Sys$UI$DataView$_raiseCommand,
			_raiseItem: Sys$UI$DataView$_raiseItem,
			abortFetch: Sys$UI$DataView$abortFetch,
			onBubbleEvent: Sys$UI$DataView$onBubbleEvent,
			onRendering: Sys$UI$DataView$onRendering,
			onFetchFailed: Sys$UI$DataView$onFetchFailed,
			onFetchSucceeded: Sys$UI$DataView$onFetchSucceeded,
			_doAutoFetch: Sys$UI$DataView$_doAutoFetch,
			_findContextIndex: Sys$UI$DataView$_findContextIndex,
			findContext: Sys$UI$DataView$findContext,
			_clearContainer: Sys$UI$DataView$_clearContainer,
			_clearContainers: Sys$UI$DataView$_clearContainers,
			_isAlone: Sys$UI$DataView$_isAlone,
			_generatesContext: Sys$UI$DataView$_generatesContext,
			refresh: Sys$UI$DataView$refresh,
			_swapData: Sys$UI$DataView$_swapData,
			_validateIndexInput: Sys$UI$DataView$_validateIndexInput,
			dispose: Sys$UI$DataView$dispose,
			initialize: Sys$UI$DataView$initialize,
			fetchData: Sys$UI$DataView$fetchData,
			onCommand: Sys$UI$DataView$onCommand,
			onItemRendering: Sys$UI$DataView$onItemRendering,
			onItemRendered: Sys$UI$DataView$onItemRendered,
			updated: Sys$UI$DataView$updated,
			link: Sys$UI$DataView$link
		}
		Sys.UI.DataView.registerClass("Sys.UI.DataView", Sys.UI.Control, Sys.UI.ITemplateContextConsumer, Sys.UI.IContentTemplateConsumer);
		Sys.registerComponent(Sys.UI.DataView);

		Sys.UI.DataView._fetchWSP = function Sys$UI$DataView$_fetchWSP(dataContext, uri, operation, parameters, httpVerb, succeededCallback, failedCallback, timeout, context) {
			if (!uri) {
				throw Error.invalidOperation(Sys.UI.TemplatesRes.requiredUri);
			}
			return Sys.Net.WebServiceProxy.invoke(
		uri, operation,
		httpVerb === "GET", parameters, succeededCallback,
		failedCallback, context, timeout);
		}
		Sys.UI.DataViewItemEventArgs = function Sys$UI$DataViewItemEventArgs(dataItem, itemContext) {
			/// <summary locid="M:J#Sys.UI.DataViewItemEventArgs.#ctor" />
			/// <param name="dataItem"></param>
			/// <param name="itemContext" type="Sys.UI.TemplateContext" mayBeNull="true" optional="true"></param>
			Sys.UI.DataViewItemEventArgs.initializeBase(this);
			this._ctx = itemContext;
			this._data = dataItem || null;
		}

		function Sys$UI$DataViewItemEventArgs$get_dataItem() {
			/// <value locid="P:J#Sys.UI.DataViewItemEventArgs.dataItem"></value>
			return this._data;
		}
		function Sys$UI$DataViewItemEventArgs$get_itemContext() {
			/// <value type="Sys.UI.TemplateContext" locid="P:J#Sys.UI.DataViewItemEventArgs.itemContext"></value>
			return this._ctx || null;
		}
		function Sys$UI$DataViewItemEventArgs$get_itemPlaceholder() {
			/// <value mayBeNull="true" locid="P:J#Sys.UI.DataViewItemEventArgs.itemPlaceholder"></value>
			return this._placeholder || null;
		}
		function Sys$UI$DataViewItemEventArgs$set_itemPlaceholder(value) {
			this._placeholder = value;
		}
		function Sys$UI$DataViewItemEventArgs$get_itemTemplate() {
			/// <value mayBeNull="true" locid="P:J#Sys.UI.DataViewItemEventArgs.itemTemplate"></value>
			return this._itemTemplate || null;
		}
		function Sys$UI$DataViewItemEventArgs$set_itemTemplate(value) {
			this._itemTemplate = value;
		}
		Sys.UI.DataViewItemEventArgs.prototype = {
			get_dataItem: Sys$UI$DataViewItemEventArgs$get_dataItem,
			get_itemContext: Sys$UI$DataViewItemEventArgs$get_itemContext,
			get_itemPlaceholder: Sys$UI$DataViewItemEventArgs$get_itemPlaceholder,
			set_itemPlaceholder: Sys$UI$DataViewItemEventArgs$set_itemPlaceholder,
			get_itemTemplate: Sys$UI$DataViewItemEventArgs$get_itemTemplate,
			set_itemTemplate: Sys$UI$DataViewItemEventArgs$set_itemTemplate
		}
		Sys.UI.DataViewItemEventArgs.registerClass("Sys.UI.DataViewItemEventArgs", Sys.EventArgs);
	}

	if (window.Sys && Sys.loader) {
		Sys.loader.registerScript("Templates", null, execute);
	}
	else {
		execute();
	}

})();

Type.registerNamespace('Sys.UI');

Sys.UI.TemplatesRes={
'commonNotAfterInit':'{0} \'{1}\' cannot be set after initialize.',
'unresolvedReference':'Sys.Binding could not find an element or component with the selector \"{0}\".',
'stringOrBoolean':'Value must be the string \"true\", \"false\", or a Boolean.',
'elementNotFound':'An element with id \'{0}\' could not be found.',
'updateBeforeInit':'Update cannot be called before initialize.',
'invalidAttributeName':'Invalid attribute name \'{0}\'. Declared attribute names must be in lowercase.',
'invalidFunctionName':'\'{0}\' must be of type Function or the name of a function as a String.',
'invalidDataProviderType':'Value must be a service URI, an instance of Sys.Net.WebServiceProxy, or class that implements Sys.Data.IDataProvider.',
'requiredUri':'A serviceUri must be set prior to calling fetchData.',
'invalidAttach':'Invalid attribute \'{0}\', the type \'{1}\' is not a registered namespace.',
'cannotActivate':'Could not activate element with id \'{0}\', the element could not be found.',
'misplacedTemplate':'DataView item template must not be a child element of the DataView.',
'templateAlreadyDefined': 'DataView template is already defined.',
'functionNotFound':'A function with the name \'{0}\' could not be found.',
'bindingPropertyNotSet':'Binding \'{0}\' must be set prior to initialize.',
'invalidSelectedIndexValue':'Value must be a Number or a String that can be converted to a Number.',
'mustSetInputElementsExplicitly':'Input elements \'type\' and \'name\' attributes must be explicitly set.',
'invalidTypeNamespace':'Invalid type namespace declaration, \'{0}\' is not a valid type.',
'cannotFindMarkupExtension':'A markup extension with the name \'{0}\' could not be found.',
'invalidSysContentTemplate': 'The sys:content-template attribute must be used on or within an control that implements Sys.UI.IContentTemplateConsumer.'
};


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9DOi9Vc2Vycy9UeWxlclRyb3R0ZXIvcmVwb3MvQ29nbml0byBGb3Jtcy9Db2duaXRvLlNlcnZpY2VzL1NjcmlwdHMvY29tcG9uZW50L2NvZ25pdG8tZGlhbG9nLmpzIiwid2VicGFjazovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL0M6L1VzZXJzL1R5bGVyVHJvdHRlci9yZXBvcy9Db2duaXRvIEZvcm1zL0NvZ25pdG8uU2VydmljZXMvU2NyaXB0cy9qcXVlcnkvanF1ZXJ5LTEuOC4zLm1pbi5qcyIsIndlYnBhY2s6Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9DOi9Vc2Vycy9UeWxlclRyb3R0ZXIvcmVwb3MvQ29nbml0byBGb3Jtcy9Db2duaXRvLlNlcnZpY2VzL1NjcmlwdHMvcmVxdWlyZWQvQ29nbml0by1pbml0LWV4b3dlYi5qcyIsIndlYnBhY2s6Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9DOi9Vc2Vycy9UeWxlclRyb3R0ZXIvcmVwb3MvQ29nbml0byBGb3Jtcy9Db2duaXRvLlNlcnZpY2VzL1NjcmlwdHMvcmVxdWlyZWQvY29nbml0by1pbml0LWRlcGVuZGVuY2llcy5qcyIsIndlYnBhY2s6Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9DOi9Vc2Vycy9UeWxlclRyb3R0ZXIvcmVwb3MvQ29nbml0byBGb3Jtcy9Db2duaXRvLlNlcnZpY2VzL1NjcmlwdHMvcmVxdWlyZWQvanF1ZXJ5Lnhkci5qcyIsIndlYnBhY2s6Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9DOi9Vc2Vycy9UeWxlclRyb3R0ZXIvcmVwb3MvQ29nbml0byBGb3Jtcy9QdWJsaWMvRXhvV2ViL0V4b1dlYi9jbGllbnQvZGlzdC9leG93ZWItbXNhamF4LmpzIiwid2VicGFjazovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL0M6L1VzZXJzL1R5bGVyVHJvdHRlci9yZXBvcy9Db2duaXRvIEZvcm1zL1B1YmxpYy9FeG9XZWIvRXhvV2ViL2NsaWVudC9yZWYvYXNwbmV0YWpheC9NaWNyb3NvZnRBamF4LmRlYnVnLmpzIiwid2VicGFjazovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL0M6L1VzZXJzL1R5bGVyVHJvdHRlci9yZXBvcy9Db2duaXRvIEZvcm1zL1B1YmxpYy9FeG9XZWIvRXhvV2ViL2NsaWVudC9yZWYvYXNwbmV0YWpheC9NaWNyb3NvZnRBamF4VGVtcGxhdGVzLmRlYnVnLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLENBQUM7QUFDRDtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyx1QkFBdUI7O0FBRTNEOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0Esb0JBQW9CLHFDQUFxQztBQUN6RDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBLHlGQUF5RixrQ0FBa0M7QUFDM0gsaUVBQWlFLGlDQUFpQzs7QUFFbEc7QUFDQSxHQUFHO0FBQ0g7QUFDQSxzREFBc0Qsa0NBQWtDO0FBQ3hGLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsNEI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSw0QkFBNEIsY0FBYyxvQkFBb0Isb0JBQW9CO0FBQ2xGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLFFBQVE7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sS0FBSzs7QUFFTDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQ0FBcUMseUNBQXlDLCtDQUErQzs7QUFFN0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsQ0FBQyxVOzs7Ozs7Ozs7OztBQzVkRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsZUFBZSxlQUFlLHVDQUF1QyxRQUFRLElBQUksbUJBQW1CLDBCQUEwQixnREFBZ0QsMkNBQTJDLElBQUksd0ZBQXdGLFVBQVUsY0FBYyxTQUFTLFNBQVMsZUFBZSw4RUFBOEUsU0FBUyxhQUFhLFNBQVMsY0FBYyxTQUFTLGNBQWMsb0RBQW9ELGlCQUFpQixVQUFVLHlCQUF5QixTQUFTLG1CQUFtQix3REFBd0Qsc0JBQXNCLGFBQWEsRUFBRSwwQ0FBMEMsaUJBQWlCLEVBQUUsdUJBQXVCLDJCQUEyQixzQkFBc0IsRUFBRSxzQ0FBc0MsZ0JBQWdCLDRCQUE0Qiw2QkFBNkIsRUFBRSxlQUFlLGlEQUFpRCwyREFBMkQsU0FBUyxpQkFBaUIscUZBQXFGLGlCQUFpQixpQ0FBaUMsaURBQWlELE1BQU0sZ0JBQWdCLFlBQVksaUNBQWlDLElBQUksNkJBQTZCLDJCQUEyQixXQUFXLGlCQUFpQixNQUFNLCtoQkFBK2hCLGVBQWUsZ0pBQWdKLGVBQWUsOENBQThDLGlCQUFpQixtQkFBbUIsK0RBQStELElBQUksOEJBQThCLFNBQVMsaUJBQWlCLDBFQUEwRSxpQkFBaUIsZ0NBQWdDLElBQUksd1BBQXdQLFFBQVEsSUFBSSwrR0FBK0csU0FBUyxtQkFBbUIsaUJBQWlCLGdEQUFnRCxxQkFBcUIsMkRBQTJELElBQUkseVFBQXlRLFNBQVMsbUJBQW1CLCtHQUErRyxrQkFBa0IsK0RBQStELG1EQUFtRCxtQkFBbUIsa0RBQWtELGVBQWUsc0JBQXNCLHVEQUF1RCxxR0FBcUcsK0JBQStCLHFOQUFxTixxQkFBcUIsTUFBTSx1Q0FBdUMsbUVBQW1FLEVBQUUsdUNBQXVDLHlDQUF5QyxlQUFlLHFCQUFxQixnQ0FBZ0Msb0RBQW9ELHdCQUF3QixJQUFJLDZGQUE2Rix5QkFBeUIsb0JBQW9CLFFBQVEsUUFBUSw2Q0FBNkMsYUFBYSxnR0FBZ0csNkNBQTZDLGlCQUFpQix5Q0FBeUMsc0NBQXNDLFlBQVksb0JBQW9CLG1CQUFtQiwwREFBMEQsa0NBQWtDLHNGQUFzRix1Q0FBdUMsYUFBYSxNQUFNLG1CQUFtQixLQUFLLFlBQVksb0NBQW9DLElBQUksTUFBTSxTQUFTLE9BQU8sd0NBQXdDLGlCQUFpQiw2Q0FBNkMsS0FBSyw4R0FBOEcsS0FBSyxTQUFTLGFBQWEsbUJBQW1CLHdHQUF3RyxvREFBb0QsTUFBTSxnQ0FBZ0MsU0FBUyxPQUFPLFNBQVMsT0FBTyxpRUFBaUUsSUFBSSxPQUFPLHdCQUF3QixjQUFjLElBQUksNEJBQTRCLFdBQVcsY0FBYyxJQUFJLGdEQUFnRCxXQUFXLGNBQWMsNkJBQTZCLElBQUksY0FBYyxpQkFBaUIsdUJBQXVCLG1EQUFtRCxJQUFJLCtCQUErQixFQUFFLG1CQUFtQix1REFBdUQsY0FBYyxlQUFlLHVHQUF1RyxJQUFJLHVCQUF1QixrRUFBa0UsY0FBYyx3QkFBd0Isc0JBQXNCLGlCQUFpQixxSEFBcUgsbUVBQW1FLDBCQUEwQixrQkFBa0Isa0NBQWtDLElBQUksdUJBQXVCLDREQUE0RCxZQUFZLCtCQUErQixJQUFJLDZDQUE2Qyx5RkFBeUYsaUNBQWlDLHlHQUF5RyxpQkFBaUIsY0FBYyw2SUFBNkksY0FBYyxZQUFZLHNDQUFzQyxZQUFZLG1CQUFtQiwyQ0FBMkMsMEJBQTBCLHlHQUF5RyxnQkFBZ0IsbUNBQW1DLG9CQUFvQixhQUFhLHVDQUF1QyxFQUFFLEdBQUcseVBBQXlQLCtFQUErRSx5QkFBeUIsMEJBQTBCLDBCQUEwQixHQUFHLGlDQUFpQyxnRUFBZ0UsVUFBVSxnRUFBZ0UsZ0ZBQWdGLFlBQVksb0JBQW9CLE1BQU0sNEJBQTRCLDZCQUE2QixNQUFNLElBQUksK0lBQStJLHNCQUFzQix1Q0FBdUMsaUJBQWlCLFNBQVMsU0FBUyxLQUFLLFlBQVksSUFBSSw2Q0FBNkMsa0NBQWtDLGVBQWUsdUVBQXVFLDBQQUEwUCw2QkFBNkIscU1BQXFNLG1FQUFtRSxFQUFFLDBIQUEwSCwyQkFBMkIsZUFBZSw2SkFBNkosTUFBTSxxQkFBcUIsa0JBQWtCLG1DQUFtQyxVQUFVLGtCQUFrQiwrREFBK0QsdUJBQXVCLHdHQUF3RywrS0FBK0ssNkNBQTZDLGdDQUFnQyxjQUFjLFVBQVUsMkNBQTJDLDhEQUE4RCwwSEFBMEgscURBQXFELG1CQUFtQixvQkFBb0Isb0JBQW9CLGlCQUFpQiw4REFBOEQsMkJBQTJCLG9DQUFvQyw2SkFBNkosb0JBQW9CLHdCQUF3QixtQkFBbUIsc0NBQXNDLGdCQUFnQixtREFBbUQsa0JBQWtCLGtCQUFrQixpQkFBaUIsbUJBQW1CLGtCQUFrQixtRkFBbUYsaUJBQWlCLCtDQUErQyxxQkFBcUIsR0FBRyxnQkFBZ0IsK0NBQStDLHdDQUF3Qyx5QkFBeUIsZ0NBQWdDLGtDQUFrQyw2QkFBNkIsZ0RBQWdELGdEQUFnRCxzQkFBc0IsSUFBSSwyS0FBMkssd0NBQXdDLFVBQVUsVUFBVSx1QkFBdUIsMERBQTBELDhDQUE4Qyw0QkFBNEIsbUJBQW1CLHFDQUFxQyx3Q0FBd0MsaUhBQWlILHdCQUF3Qiw4QkFBOEIsb0NBQW9DLDJCQUEyQixzQkFBc0IsNEJBQTRCLHVCQUF1Qix5Q0FBeUMsa0JBQWtCLGtEQUFrRCwyQkFBMkIsZ0VBQWdFLElBQUksd0dBQXdHLFNBQVMsU0FBUyxnQkFBZ0IsMkJBQTJCLDJCQUEyQix3QkFBd0IsU0FBUyxtQkFBbUIsb0JBQW9CLDJCQUEyQixNQUFNLHdOQUF3Tix1QkFBdUIsc0NBQXNDLDJEQUEyRCxnR0FBZ0csNEJBQTRCLHNCQUFzQixRQUFRLHNDQUFzQyxJQUFJLHVJQUF1SSxTQUFTLElBQUkseUdBQXlHLGtCQUFrQix3QkFBd0IsMENBQTBDLGlCQUFpQixLQUFLLHVCQUF1QiwwQ0FBMEMsd0JBQXdCLDhEQUE4RCxzQkFBc0IsOENBQThDLE1BQU0sTUFBTSx5Q0FBeUMsVUFBVSxJQUFJLGlDQUFpQyxXQUFXLDZDQUE2QyxVQUFVLElBQUkscUNBQXFDLFNBQVMscUNBQXFDLDZCQUE2QixhQUFhLHdDQUF3Qyx5QkFBeUIsY0FBYyxvSUFBb0kseUJBQXlCLE1BQU0sTUFBTSw0QkFBNEIsMkNBQTJDLElBQUksaUNBQWlDLFNBQVMscUJBQXFCLDhCQUE4QiwyQkFBMkIsSUFBSSxnQkFBZ0Isa0NBQWtDLG9CQUFvQixzQkFBc0IsMEJBQTBCLFVBQVUsSUFBSSxzQ0FBc0MsU0FBUyxxQkFBcUIsa0hBQWtILFVBQVUsSUFBSSwyQ0FBMkMsdURBQXVELDRCQUE0Qiw0QkFBNEIsVUFBVSxvR0FBb0csOENBQThDLG1DQUFtQyxnQ0FBZ0MsK0JBQStCLDBCQUEwQixzQ0FBc0MsSUFBSSxlQUFlLHlEQUF5RCxzQkFBc0IsK0JBQStCLElBQUksNkNBQTZDLElBQUkscUNBQXFDLGdCQUFnQiw0QkFBNEIsRUFBRSw0QkFBNEIsd0VBQXdFLDhHQUE4RyxLQUFLLHVDQUF1QyxnQ0FBZ0MsU0FBUyxJQUFJLDBDQUEwQyxVQUFVLDRCQUE0QixlQUFlLElBQUksbUJBQW1CLFNBQVMsd0JBQXdCLFdBQVcsR0FBRyxxQkFBcUIsMEZBQTBGLHFDQUFxQyxFQUFFLFFBQVEsTUFBTSx3QkFBd0IsNkNBQTZDLElBQUksaURBQWlELGtEQUFrRCxPQUFPLGtEQUFrRCxLQUFLLE1BQU0sS0FBSyxpREFBaUQsSUFBSSxlQUFlLE1BQU0sZUFBZSxlQUFlLHVCQUF1QixnQkFBZ0IsNkVBQTZFLEVBQUUsYUFBYSwyQkFBMkIsWUFBWSxtQkFBbUIseUNBQXlDLFVBQVUsd0JBQXdCLHdDQUF3QyxPQUFPLGlCQUFpQix5QkFBeUIsa0JBQWtCLGlCQUFpQixvQkFBb0Isb0JBQW9CLHFCQUFxQixTQUFTLGlCQUFpQiwrQkFBK0IsbUJBQW1CLFNBQVMsd0JBQXdCLDZFQUE2RSxpQkFBaUIsdUNBQXVDLGtCQUFrQixZQUFZLFVBQVUsVUFBVSxxQkFBcUIsb0xBQW9MLGlCQUFpQixTQUFTLG1CQUFtQiw4Q0FBOEMsaUJBQWlCLGdCQUFnQiw4QkFBOEIsdUJBQXVCLGtCQUFrQixtQ0FBbUMsOEJBQThCLDBIQUEwSCxPQUFPLEVBQUUsT0FBTyxZQUFZLHFCQUFxQixnQ0FBZ0MsTUFBTSw0Q0FBNEMsa0JBQWtCLGNBQWMsb0JBQW9CLElBQUksaUNBQWlDLGVBQWUsMEJBQTBCLGdDQUFnQyxrQkFBa0Isd0hBQXdILG1CQUFtQixVQUFVLDRDQUE0QyxpREFBaUQsT0FBTyx3REFBd0QsSUFBSSx5R0FBeUcsMENBQTBDLEVBQUUscUJBQXFCLG1EQUFtRCxnTkFBZ04sNEJBQTRCLDJDQUEyQyxxQ0FBcUMseUJBQXlCLFdBQVcsWUFBWSxHQUFHLHF0QkFBcXRCLGFBQWEseUNBQXlDLGNBQWMsMEJBQTBCLElBQUksY0FBYyxTQUFTLG1CQUFtQiwwRkFBMEYsa0JBQWtCLDRiQUE0YiwrQkFBK0IsZ0RBQWdELCtDQUErQyxvQkFBb0IseUJBQXlCLFNBQVMsU0FBUyxjQUFjLGdCQUFnQixzQ0FBc0MsZ0VBQWdFLFNBQVMsUUFBUSxTQUFTLGdCQUFnQixNQUFNLG9OQUFvTixTQUFTLFNBQVMsNkxBQTZMLDJCQUEyQiw4QkFBOEIsWUFBWSxXQUFXLGNBQWMsVUFBVSxjQUFjLGtCQUFrQixPQUFPLHVKQUF1SiwrREFBK0QsWUFBWSx1TkFBdU4sK0ZBQStGLFlBQVksZUFBZSxvUEFBb1Asd0NBQXdDLEdBQUcsU0FBUyxTQUFTLGdCQUFnQixjQUFjLFVBQVUsUUFBUSw2RkFBNkYsdUVBQXVFLHFCQUFxQixtRUFBbUUsd0JBQXdCLG9CQUFvQixxRkFBcUYsMEdBQTBHLDZKQUE2SiwwRkFBMEYsNEJBQTRCLG9CQUFvQixnRUFBZ0UsU0FBUyw4QkFBOEIsNkZBQTZGLElBQUksbUJBQW1CLHFDQUFxQyx1SEFBdUgsdUJBQXVCLHdCQUF3Qix3QkFBd0IscURBQXFELGlEQUFpRCxFQUFFLGFBQWEsbUJBQW1CLG1DQUFtQyxVQUFVLHlFQUF5RSw4QkFBOEIsSUFBSSxpRkFBaUYsNEJBQTRCLFNBQVMsK0NBQStDLGVBQWUsK0VBQStFLDhIQUE4SCxPQUFPLHFCQUFxQixjQUFjLGdDQUFnQyxpQkFBaUIsbUNBQW1DLEVBQUUscUNBQXFDLHdCQUF3Qiw0QkFBNEIscUJBQXFCLEdBQUcsRUFBRSxVQUFVLHNCQUFzQixNQUFNLG1IQUFtSCx1QkFBdUIsVUFBVSw0RUFBNEUsZ0JBQWdCLG9DQUFvQyxtRUFBbUUsc0JBQXNCLDJCQUEyQixxQkFBcUIsa0NBQWtDLGdEQUFnRCw2QkFBNkIscUJBQXFCLEVBQUUsR0FBRyxFQUFFLGFBQWEsb0JBQW9CLFFBQVEsbUhBQW1ILHdCQUF3QixzQkFBc0IsaURBQWlELEVBQUUscUJBQXFCLDRCQUE0QixrQkFBa0IsRUFBRSxxQkFBcUIsdUVBQXVFLHNCQUFzQixrQkFBa0IsaUJBQWlCLEVBQUUsd0JBQXdCLDhCQUE4Qix1QkFBdUIsMkRBQTJELDJCQUEyQiw0Q0FBNEMsSUFBSSxpRUFBaUUseUJBQXlCLEVBQUUsNlJBQTZSLGFBQWEsbUJBQW1CLG9EQUFvRCx3QkFBd0IsNEJBQTRCLHFCQUFxQixFQUFFLG9CQUFvQixvREFBb0Qsd0JBQXdCLDhDQUE4QyxJQUFJLFVBQVUsZUFBZSxXQUFXLEVBQUUsc0JBQXNCLGtCQUFrQixnREFBZ0QsZ0RBQWdELEVBQUUsNERBQTRELElBQUksOERBQThELHlDQUF5QyxJQUFJLDZDQUE2QyxzQkFBc0IsbUJBQW1CLFlBQVkseUJBQXlCLGtCQUFrQixnREFBZ0QsbURBQW1ELEVBQUUseUVBQXlFLElBQUksOENBQThDLDJEQUEyRCxJQUFJLG1FQUFtRSwyQkFBMkIsWUFBWSwyQkFBMkIscUNBQXFDLDZDQUE2Qyx1REFBdUQsdUJBQXVCLHlEQUF5RCxTQUFTLHVEQUF1RCxnTEFBZ0wsRUFBRSxzQkFBc0Isc0NBQXNDLElBQUksZ0dBQWdHLFNBQVMsaUJBQWlCLG9CQUFvQixpRUFBaUUsZ0JBQWdCLDRIQUE0SCx1QkFBdUIsNkhBQTZILGdMQUFnTCxFQUFFLFVBQVUsVUFBVSxRQUFRLGdCQUFnQix5QkFBeUIsc0NBQXNDLFNBQVMsZ0JBQWdCLGtIQUFrSCxJQUFJLDBLQUEwSywyQkFBMkIsVUFBVSxTQUFTLG1CQUFtQixxQkFBcUIsMkNBQTJDLDRDQUE0QyxxQ0FBcUMsVUFBVSx3QkFBd0IsdUJBQXVCLDJCQUEyQiw4Q0FBOEMsMkRBQTJELDZGQUE2RixhQUFhLGtCQUFrQixPQUFPLDBFQUEwRSxvRkFBb0YsMEJBQTBCLGdCQUFnQixzQ0FBc0MsV0FBVyxnSEFBZ0gsWUFBWSxNQUFNLGtCQUFrQiwrRUFBK0UsbUVBQW1FLGNBQWMsbURBQW1ELFFBQVEsa0JBQWtCLGdFQUFnRSxxQkFBcUIsaURBQWlELFlBQVksVUFBVSxzUUFBc1Esc0JBQXNCLHVCQUF1Qiw4TEFBOEwsWUFBWSxVQUFVLGdCQUFnQixxQ0FBcUMsbUdBQW1HLEVBQUUsSUFBSSxrQkFBa0Isb0JBQW9CLGtHQUFrRyxxQkFBcUIsTUFBTSw0R0FBNEcsU0FBUyx3QkFBd0Isc0JBQXNCLGtCQUFrQixNQUFNLDZFQUE2RSxxQkFBcUIsNEJBQTRCLHVFQUF1RSx5Q0FBeUMsd0NBQXdDLGtCQUFrQiw2Q0FBNkMsRUFBRSwrQkFBK0IsOEJBQThCLG9CQUFvQixjQUFjLEVBQUUsK0VBQStFLHdDQUF3QyxnQkFBZ0IsMEJBQTBCLHFCQUFxQixFQUFFLEVBQUUscUNBQXFDLGdCQUFnQix3Q0FBd0MsbUJBQW1CLDZCQUE2QixFQUFFLDRFQUE0RSxnQkFBZ0IsbUJBQW1CLDJFQUEyRSxHQUFHLGtEQUFrRCwwREFBMEQsa0JBQWtCLGdCQUFnQixxREFBcUQsRUFBRSx1Q0FBdUMsNENBQTRDLGtCQUFrQiw2REFBNkQsRUFBRSxFQUFFLCtMQUErTCwwRUFBMEUsU0FBUyx3QkFBd0IsMEJBQTBCLHlEQUF5RCxvR0FBb0csd0NBQXdDLDBHQUEwRywwQ0FBMEMsV0FBVyxzRkFBc0YsNERBQTRELGFBQWEscUlBQXFJLDBTQUEwUyxRQUFRLFVBQVUsNEJBQTRCLHFEQUFxRCxvQkFBb0IsdUNBQXVDLFdBQVcsS0FBSywyQ0FBMkMsMkNBQTJDLFNBQVMsNEJBQTRCLGlKQUFpSixXQUFXLDJNQUEyTSxzSEFBc0gsbUVBQW1FLGNBQWMsb0NBQW9DLDJCQUEyQix1Q0FBdUMseUNBQXlDLHNMQUFzTCw4UEFBOFAsVUFBVSxpRkFBaUYsT0FBTyxzR0FBc0csd0NBQXdDLDBEQUEwRCwwREFBMEQsRUFBRSxpQ0FBaUMsdUVBQXVFLFFBQVEsc0NBQXNDLHVEQUF1RCw0SEFBNEgsZ1VBQWdVLHNCQUFzQiwwQkFBMEIsbURBQW1ELDhHQUE4RyxNQUFNLGlGQUFpRixtREFBbUQsUUFBUSwyREFBMkQsUUFBUSxVQUFVLElBQUksNkhBQTZILGtCQUFrQixpQkFBaUIsRUFBRSx3QkFBd0IsNkJBQTZCLE1BQU0sc0NBQXNDLDBDQUEwQyx1REFBdUQsc0tBQXNLLDJHQUEyRyw2REFBNkQsZ01BQWdNLFdBQVcsa0VBQWtFLHlFQUF5RSxhQUFhLHlJQUF5SSxxQ0FBcUMsNllBQTZZLGlCQUFpQix5QkFBeUIsMENBQTBDLGlEQUFpRCw0QkFBNEIsRUFBRSxvQkFBb0IsaUpBQWlKLFVBQVUsTUFBTSxZQUFZLFFBQVEsdUJBQXVCLE9BQU8sd0JBQXdCLGVBQWUsc0JBQXNCLDBDQUEwQyx3QkFBd0Isc0RBQXNELDRCQUE0Qiw4QkFBOEIsdUNBQXVDLEVBQUUsdURBQXVELDZDQUE2QyxnQ0FBZ0Msb0RBQW9ELHFEQUFxRCxpQkFBaUIsYUFBYSwyRUFBMkUsc0JBQXNCLHNEQUFzRCw4S0FBOEssb0JBQW9CLHVDQUF1QyxvQkFBb0IsbUJBQW1CLDBCQUEwQiwyQkFBMkIseUJBQXlCLDBEQUEwRCw0QkFBNEIsNkJBQTZCLHlCQUF5Qiw4REFBOEQscUNBQXFDLHNDQUFzQyx1QkFBdUIsOEVBQThFLFFBQVEsNkNBQTZDLGVBQWUsb0JBQW9CLDZDQUE2QywwREFBMEQsdUdBQXVHLEVBQUUsa0RBQWtELGlCQUFpQixvQ0FBb0MsOERBQThELHdFQUF3RSwrRUFBK0Usb0JBQW9CLG9DQUFvQyxFQUFFLDBCQUEwQiwySEFBMkgscUJBQXFCLG9DQUFvQyxpQ0FBaUMsRUFBRSxrREFBa0QsaUJBQWlCLHNJQUFzSSxrRUFBa0UsK0NBQStDLDBEQUEwRCxxQ0FBcUMsTUFBTSxzREFBc0QsZUFBZSxpR0FBaUcsOEZBQThGLG9DQUFvQyxFQUFFLG9CQUFvQixlQUFlLGdJQUFnSSxxQkFBcUIsZ0VBQWdFLEVBQUUsa0NBQWtDLGdDQUFnQyxlQUFlLHNCQUFzQixnREFBZ0Qsb0JBQW9CLGlCQUFpQixtQ0FBbUMscUJBQXFCLHdDQUF3QyxFQUFFLGFBQWEsdUJBQXVCLFFBQVEsdUJBQXVCLGlDQUFpQyxpQ0FBaUMsWUFBWSxpR0FBaUcsdUJBQXVCLGlDQUFpQywwQ0FBMEMsd0RBQXdELDBCQUEwQixFQUFFLHVCQUF1QiwwQkFBMEIscUJBQXFCLFFBQVEsOEpBQThKLHVCQUF1Qiw4QkFBOEIsWUFBWSxtRkFBbUYsMkJBQTJCLEVBQUUsc0JBQXNCLDJCQUEyQixzQkFBc0IsMEJBQTBCLHNCQUFzQix3Q0FBd0MsWUFBWSxtQkFBbUIseURBQXlELDRCQUE0Qix3QkFBd0IsNEJBQTRCLG1FQUFtRSx1QkFBdUIsNEJBQTRCLDBCQUEwQixFQUFFLDhCQUE4QixrREFBa0Qsb0JBQW9CLHFEQUFxRCwrQ0FBK0MsZ0dBQWdHLGFBQWEsV0FBVyxlQUFlLHFCQUFxQixxQkFBcUIsNENBQTRDLEVBQUUsME9BQTBPLHNCQUFzQixxRkFBcUYsbURBQW1ELHFEQUFxRDtBQUM3aDRDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsb0JBQW9CLFFBQVEsT0FBTyx5QkFBeUIsbUNBQW1DLHlCQUF5Qiw0Q0FBNEMsbURBQW1ELCtCQUErQixjQUFjLHFHQUFxRyxLQUFLLGdFQUFnRSxvR0FBb0csc0NBQXNDLGNBQWMsbUJBQW1CLCtCQUErQixnQ0FBZ0MsZUFBZSxtQkFBbUIsK0JBQStCLCtDQUErQyxjQUFjLHFCQUFxQiw0QkFBNEIsd0NBQXdDLElBQUksZ0NBQWdDLEVBQUUsRUFBRSxtQkFBbUIsa0JBQWtCLHdCQUF3QixFQUFFLEVBQUUsa0JBQWtCLGdCQUFnQixTQUFTLGlCQUFpQixpQ0FBaUMsMkJBQTJCLDJCQUEyQixFQUFFLEVBQUUsb0VBQW9FLEtBQUssOEZBQThGLGtJQUFrSSxZQUFZLGdEQUFnRCxtQkFBbUIsNkNBQTZDLCtCQUErQixrREFBa0QsaUJBQWlCLE1BQU0sdURBQXVELHFDQUFxQyxPQUFPLHVCQUF1QixnQ0FBZ0MseUNBQXlDLHFCQUFxQixLQUFLLHdDQUF3QyxlQUFlLGVBQWUsa0NBQWtDLG1CQUFtQixJQUFJLDBCQUEwQixTQUFTLE1BQU0sdUJBQXVCLHdDQUF3QyxJQUFJLHVEQUF1RCxTQUFTLHlCQUF5QixxRUFBcUUseUhBQXlILHdEQUF3RCxJQUFJLGtDQUFrQyxNQUFNLFNBQVMsTUFBTSxvQkFBb0IsSUFBSSwwQkFBMEIsaUJBQWlCLGVBQWUsSUFBSSx5REFBeUQscUVBQXFFLEVBQUUsZUFBZSwrRkFBK0YsYUFBYSx3QkFBd0IsdUJBQXVCLDBCQUEwQiwwREFBMEQsRUFBRSxJQUFJLCtDQUErQyxLQUFLLHdEQUF3RCxVQUFVLElBQUksbUNBQW1DLGtJQUFrSSxVQUFVLGFBQWEsaUJBQWlCLG9EQUFvRCx1SEFBdUgsOEJBQThCLGdCQUFnQixLQUFLLFNBQVMsUUFBUSxPQUFPLGlCQUFpQixVQUFVLE1BQU0sc0JBQXNCLGlDQUFpQyxrQkFBa0IsUUFBUSxPQUFPLGVBQWUsTUFBTSwrQ0FBK0MsUUFBUSxhQUFhLGtEQUFrRCw0QkFBNEIsdUJBQXVCLG1CQUFtQix1QkFBdUIsSUFBSSxnQkFBZ0IsU0FBUyx1QkFBdUIsaUNBQWlDLHFCQUFxQixxR0FBcUcsOERBQThELDRCQUE0QixtQ0FBbUMsS0FBSyxLQUFLLHFDQUFxQywyRkFBMkYsMkVBQTJFLFFBQVEscUNBQXFDLGVBQWUsOE1BQThNLDBCQUEwQixJQUFJLDRCQUE0QixTQUFTLGlCQUFpQix5QkFBeUIsZUFBZSxRQUFRLE1BQU0sdUJBQXVCLCtEQUErRCxJQUFJLDZyQkFBNnJCLDJaQUEyWixlQUFlLDZCQUE2QixJQUFJLFlBQVksU0FBUyxTQUFTLFFBQVEsUUFBUSxrQkFBa0IsOEVBQThFLG1CQUFtQixtSUFBbUksbUJBQW1CLGlDQUFpQyxrREFBa0QsbUNBQW1DLG1CQUFtQix3TkFBd04sbUJBQW1CLFNBQVMsNkRBQTZELCtCQUErQiw2RkFBNkYsa0RBQWtELEVBQUUsSUFBSSxtQ0FBbUMsVUFBVSxjQUFjLGVBQWUsVUFBVSxjQUFjLFVBQVUsd0JBQXdCLHlCQUF5QixnQ0FBZ0Msb0NBQW9DLHdCQUF3Qiw0QkFBNEIsTUFBTSx5QkFBeUIsdURBQXVELG1CQUFtQixFQUFFLHdCQUF3Qix3Q0FBd0MsVUFBVSxPQUFPLFlBQVksVUFBVSxzQkFBc0IsOENBQThDLGlDQUFpQyx1Q0FBdUMsMkRBQTJELCtEQUErRCx5Q0FBeUMsOENBQThDLGVBQWUsdUNBQXVDLFVBQVUscUJBQXFCLGFBQWEsNEtBQTRLLGVBQWUsdURBQXVELEVBQUUsaUJBQWlCLGdDQUFnQyxrQkFBa0IsK0JBQStCLE9BQU8sc0JBQXNCLG9DQUFvQywwQkFBMEIsK0JBQStCLGlCQUFpQixvQ0FBb0MsMEJBQTBCLCtGQUErRixzQkFBc0Isc0VBQXNFLGVBQWUsc0NBQXNDLFlBQVksYUFBYSxPQUFPLDhCQUE4QixTQUFTLFNBQVMsd0JBQXdCLG1FQUFtRSwyQkFBMkIsK0VBQStFLFdBQVcsS0FBSywwQkFBMEIsTUFBTSxpQkFBaUIsTUFBTSwrQkFBK0IsTUFBTSx1QkFBdUIsWUFBWSxpQkFBaUIsaUhBQWlILG1CQUFtQixvTEFBb0wsb0JBQW9CLFFBQVEsMExBQTBMLFNBQVMsa0JBQWtCLHFDQUFxQyxpQ0FBaUMsYUFBYSxxQ0FBcUMsOERBQThELHVCQUF1QixpQkFBaUIsMEJBQTBCLFNBQVMsOENBQThDLGdEQUFnRCxFQUFFLG1CQUFtQixtQkFBbUIsc0VBQXNFLG1GQUFtRixFQUFFLHNCQUFzQixtQkFBbUIsa0JBQWtCLDZQQUE2UCx5QkFBeUIsNkJBQTZCLHVCQUF1Qix5QkFBeUIsNEJBQTRCLEVBQUUscURBQXFELGtDQUFrQyxhQUFhLFFBQVEsVUFBVSw0RUFBNEUsd0JBQXdCLElBQUksNERBQTRELFdBQVcsc0JBQXNCLHVGQUF1Rix1R0FBdUcsOEJBQThCLElBQUkscUNBQXFDLGNBQWMsZ0JBQWdCLEtBQUssVUFBVSxrQkFBa0IsdUNBQXVDLGdDQUFnQyxzQ0FBc0MsSUFBSSw0QkFBNEIsa0JBQWtCLHNDQUFzQyxvQkFBb0IsbUJBQW1CLHdCQUF3Qix5QkFBeUIsbUJBQW1CLHdEQUF3RCxzQkFBc0IsdUJBQXVCLHNCQUFzQix1QkFBdUIscUJBQXFCLCtCQUErQiw0REFBNEQsc0JBQXNCLGdFQUFnRSxvQkFBb0IsMEJBQTBCLG1CQUFtQixNQUFNLG1CQUFtQixFQUFFLEVBQUUsc0RBQXNELGdCQUFnQixTQUFTLG9CQUFvQiwyQkFBMkIsa0JBQWtCLFFBQVEsd0hBQXdILHlKQUF5SiwrQkFBK0Isb0RBQW9ELG1CQUFtQiwyQkFBMkIsbUJBQW1CLHNCQUFzQix5RkFBeUYsb0JBQW9CLHlDQUF5QyxvQkFBb0IsVUFBVSx1QkFBdUIsWUFBWSx1QkFBdUIsa0JBQWtCLHVCQUF1QixZQUFZLElBQUksZUFBZSxTQUFTLHNCQUFzQixZQUFZLElBQUksZUFBZSxTQUFTLHVCQUF1QixvQkFBb0IsT0FBTyxXQUFXLFNBQVMsdUJBQXVCLG9CQUFvQixNQUFNLFdBQVcsU0FBUyxJQUFJLDJDQUEyQyw2SUFBNkksZUFBZSxNQUFNLHVCQUF1QixtRUFBbUUsb0RBQW9ELHdCQUF3QixNQUFNLGVBQWUsY0FBYyxvQ0FBb0MsUUFBUSxFQUFFLDZCQUE2Qiw4QkFBOEIsU0FBUyx3Q0FBd0MseUNBQXlDLGVBQWUsTUFBTSx5QkFBeUIsbUJBQW1CLHNCQUFzQixLQUFLLE9BQU8sOEJBQThCLDJCQUEyQixVQUFVLG9CQUFvQiwrREFBK0QsMkJBQTJCLCtCQUErQixPQUFPLDRCQUE0QixJQUFJLHFDQUFxQyxnQkFBZ0IsVUFBVSwrQkFBK0IsOE1BQThNLGNBQWMsK0RBQStELHdIQUF3SCwwREFBMEQsRUFBRSxjQUFjLCtCQUErQiwyRUFBMkUscUNBQXFDLHNFQUFzRSxFQUFFLDBCQUEwQix1QkFBdUIsdUJBQXVCLHlDQUF5Qyx3REFBd0QsK0dBQStHLElBQUksc0JBQXNCLDhCQUE4QixjQUFjLFNBQVMsb0RBQW9ELFVBQVUsUUFBUSw0QkFBNEIscUJBQXFCLGtCQUFrQixrQkFBa0IsSUFBSSw4QkFBOEIsZ0JBQWdCLFdBQVcsNERBQTRELDZEQUE2RCxrQkFBa0IsdURBQXVELFVBQVUsbUNBQW1DLEVBQUUsR0FBRywyQkFBMkIsaUNBQWlDLG9CQUFvQixjQUFjLFNBQVMsbUJBQW1CLDJCQUEyQixzQkFBc0IsaUJBQWlCLG1CQUFtQixzQkFBc0IsS0FBSyx5R0FBeUcseUNBQXlDLGFBQWEsaUJBQWlCLHVCQUF1QixvREFBb0QsbUJBQW1CLElBQUksc0NBQXNDLEVBQUUsb0RBQW9ELElBQUksa0RBQWtELFdBQVcsWUFBWSxJQUFJLG9CQUFvQixnQkFBZ0IsTUFBTSxTQUFTLGlCQUFpQiw2QkFBNkIsOEJBQThCLFFBQVEsSUFBSSxzQ0FBc0MsRUFBRSxpQkFBaUIsNkNBQTZDLG9CQUFvQixnREFBZ0QsZ0JBQWdCLGlJQUFpSSx1QkFBdUIseUZBQXlGLElBQUksa0JBQWtCLDJDQUEyQyxFQUFFLGdEQUFnRCxVQUFVLE1BQU0sZUFBZSxnRUFBZ0UsbUJBQW1CLHlJQUF5SSxtQkFBbUIseUZBQXlGLHNEQUFzRCxxQkFBcUIsb0VBQW9FLEVBQUUsMEJBQTBCLFFBQVEsbUJBQW1CLG1CQUFtQixpQ0FBaUMscUJBQXFCLDZCQUE2Qiw4QkFBOEIsK0JBQStCLGtCQUFrQiwyQkFBMkIsa0JBQWtCLCtCQUErQixxQkFBcUIsOEJBQThCLHFCQUFxQixrQ0FBa0MsMkJBQTJCLGdDQUFnQywyQkFBMkIsb0NBQW9DLHNCQUFzQixrQ0FBa0MsZ0JBQWdCLHNCQUFzQiwrQkFBK0Isc0JBQXNCLG9HQUFvRyxlQUFlLHNCQUFzQixzQkFBc0Isb01BQW9NLEVBQUUsVUFBVSx1QkFBdUIsc0dBQXNHLHFCQUFxQixvQkFBb0Isd0RBQXdELGtDQUFrQyxTQUFTLHVCQUF1QixhQUFhLEVBQUUsaURBQWlELFVBQVUsRUFBRSxvVUFBb1Usa1BBQWtQLEVBQUUsV0FBVyxvVkFBb1Ysb0RBQW9ELG9CQUFvQiw2Q0FBNkMsVUFBVSw2REFBNkQsYUFBYSxpQkFBaUIsaUNBQWlDLHFHQUFxRywwQkFBMEIscUJBQXFCLGdEQUFnRCxnQ0FBZ0MsRUFBRSxZQUFZLGlEQUFpRCw0Q0FBNEMsaUJBQWlCLGVBQWUsd0NBQXdDLGdCQUFnQixTQUFTLGVBQWUsWUFBWSx1QkFBdUIsNkNBQTZDLGtDQUFrQyx1QkFBdUIsNkJBQTZCLGtDQUFrQyxFQUFFLGtCQUFrQixzQkFBc0IsNkJBQTZCLG9DQUFvQyxFQUFFLG1CQUFtQixxQ0FBcUMsOERBQThELFFBQVEsbUJBQW1CLDhDQUE4Qyw2REFBNkQsRUFBRSxvQkFBb0IsOENBQThDLDhFQUE4RSxFQUFFLG1CQUFtQiw2REFBNkQscUNBQXFDLEVBQUUscUJBQXFCLHlCQUF5QiwrREFBK0Qsa0JBQWtCLDZEQUE2RCxpREFBaUQsRUFBRSxxQkFBcUIseUJBQXlCLDhEQUE4RCxzQkFBc0IsY0FBYyxrQkFBa0IsNkpBQTZKLFlBQVksa0JBQWtCLGNBQWMsa0JBQWtCLGlFQUFpRSxhQUFhLDZCQUE2QixZQUFZLHFCQUFxQix3REFBd0QseUJBQXlCLEVBQUUsa0JBQWtCLGlDQUFpQyxpQkFBaUIsbUJBQW1CLDREQUE0RCxvS0FBb0ssNkJBQTZCLElBQUksS0FBSyxJQUFJLGlCQUFpQiwwRUFBMEUsSUFBSSxXQUFXLDBCQUEwQiwwQkFBMEIseUJBQXlCLGtJQUFrSSx5QkFBeUIsZ0NBQWdDLDhEQUE4RCx5Q0FBeUMsaUJBQWlCLGdDQUFnQyxHQUFHLG9CQUFvQix5QkFBeUIsMEJBQTBCLHdCQUF3QiwwQ0FBMEMsMEZBQTBGLHdCQUF3QixFQUFFLGdEQUFnRCxjQUFjLGlDQUFpQyxrQkFBa0IsRUFBRSxZQUFZLDJJQUEySSxJQUFJLGdHQUFnRyxTQUFTLGlDQUFpQyxxQkFBcUIsb0VBQW9FLDJGQUEyRiwwQ0FBMEMsRUFBRSxhQUFhLEVBQUUsZ0NBQWdDLGlCQUFpQix3VUFBd1UseUJBQXlCLGVBQWUsUUFBUSx5R0FBeUcsZUFBZSxvQkFBb0IsdUVBQXVFLDJGQUEyRixLQUFLLElBQUksa0VBQWtFLHVDQUF1QyxFQUFFLFVBQVUsc0JBQXNCLFlBQVksMFJBQTBSLEtBQUssd0JBQXdCLDBDQUEwQyxLQUFLLGtCQUFrQixrQkFBa0IseUJBQXlCLDJDQUEyQywrREFBK0QsZUFBZSxzQ0FBc0MscUNBQXFDLGlMQUFpTCxJQUFJLGVBQWUsK0lBQStJLEtBQUsseUZBQXlGLHVHQUF1RyxlQUFlLDRCQUE0QiwyQkFBMkIsa0NBQWtDLG9EQUFvRCxlQUFlLHVIQUF1SCx1QkFBdUIseUdBQXlHLEtBQUssZUFBZSw0TUFBNE0sU0FBUyx5QkFBeUIsc0ZBQXNGLGVBQWUsbURBQW1ELG1GQUFtRiwwR0FBMEcsYUFBYSxRQUFRLHNCQUFzQixrQkFBa0Isd05BQXdOLE9BQU8scUNBQXFDLDBCQUEwQixLQUFLLGlEQUFpRCw2Q0FBNkMsWUFBWSxpQkFBaUIsZ0JBQWdCLDBCQUEwQixvQkFBb0Isa0JBQWtCLHdCQUF3QixtQkFBbUIsZUFBZSx3QkFBd0Isa0ZBQWtGLHlCQUF5QixXQUFXLFVBQVUsR0FBRywwUEFBMFAsYUFBYSxLQUFLLHdEQUF3RCxLQUFLLCtCQUErQiwrRUFBK0UsYUFBYSxrQkFBa0IscUNBQXFDLHVDQUF1Qyx5QkFBeUIsaUJBQWlCLG1CQUFtQixpQkFBaUIsZ0JBQWdCLHNCQUFzQiwwQkFBMEIsc0ZBQXNGLDZDQUE2QyxHQUFHLEVBQUUsVUFBVSxVQUFVLFNBQVMsa0JBQWtCLE1BQU0scUJBQXFCLHVCQUF1QixZQUFZLDZGQUE2RixXQUFXLGlEQUFpRCx5QkFBeUIsK0NBQStDLHFDQUFxQyxrRkFBa0YsdUlBQXVJLHNGQUFzRixPQUFPLFdBQVcsd0RBQXdELHVCQUF1QiwyQkFBMkIsK05BQStOLHNCQUFzQixhQUFhLDJDQUEyQyxZQUFZLDJCQUEyQixVQUFVLEVBQUUsbUNBQW1DLG1EQUFtRCxnUEFBZ1Asa0RBQWtELHNEQUFzRCw4UEFBOFAsRUFBRSx3Q0FBd0MsZUFBZSxvQkFBb0IsOEVBQThFLGlCQUFpQixZQUFZLHFCQUFxQix3RkFBd0YsRUFBRSx3Q0FBd0Msa0JBQWtCLG1IQUFtSCxtQkFBbUIsMEdBQTBHLDhKQUE4SixFQUFFLGFBQWEsd0RBQXdELGtCQUFrQixpQkFBaUIsdUJBQXVCLFlBQVksK0JBQStCLEdBQUcsRUFBRSw2RUFBNkUsZUFBZSxrQkFBa0IsTUFBTSxhQUFhLCtDQUErQyxFQUFFLEVBQUUsMkRBQTJELG9JQUFvSSxvQ0FBb0MsZ0NBQWdDLEVBQUUsUUFBUSxvQ0FBb0MsZUFBZSxpQkFBaUIsbUJBQW1CLGtEQUFrRCxLQUFLLElBQUksbUNBQW1DLFdBQVcscUNBQXFDLEVBQUUsc0xBQXNMLGFBQWEscUJBQXFCLHNDQUFzQywyQkFBMkIsMkJBQTJCLHFEQUFxRCxvQkFBb0IsNkZBQTZGLG9CQUFvQixvQkFBb0IscURBQXFELE9BQU8sd0NBQXdDLEdBQUcsd0NBQXdDLFNBQVMsRUFBRSxzQkFBc0IsMkJBQTJCLG1DQUFtQyw2REFBNkQseUhBQXlILHdCQUF3QixFQUFFLCtCQUErQixvQ0FBb0MsOE9BQThPLE1BQU0saUJBQWlCLElBQUksVUFBVSxVQUFVLHVCQUF1QixVQUFVLFNBQVMsK0JBQStCLDBCQUEwQiwwREFBMEQsNEJBQTRCLGtDQUFrQyx3SEFBd0gsMkRBQTJELHNDQUFzQyxtQkFBbUIsWUFBWSx3REFBd0QsUUFBUSxpR0FBaUcsb0JBQW9CLHFCQUFxQixFQUFFLG9DQUFvQyx1QkFBdUIsaURBQWlELHlDQUF5QyxHQUFHLEVBQUUsVUFBVSx3QkFBd0IsNkJBQTZCLHlCQUF5QiwyQkFBMkIseUJBQXlCLCtEQUErRCxlQUFlLDJKQUEySixpREFBaUQsbUhBQW1ILFdBQVcsa0NBQWtDLGlCQUFpQixzQ0FBc0MsYUFBYSwrRUFBK0UsY0FBYyxtQkFBbUIsOERBQThELG9CQUFvQixvQkFBb0Isc21CQUFzbUIsVUFBVSw4QkFBOEIsUUFBUSxvQ0FBb0Msc0lBQXNJLE1BQU0sTUFBTSxzQkFBc0IsNENBQTRDLE9BQU8sc0JBQXNCLGlCQUFpQixRQUFRLFlBQVksa0NBQWtDLG9CQUFvQiwrQkFBK0IsTUFBTSxVQUFVLGVBQWUsYUFBYSw0QkFBNEIscUJBQXFCLG9CQUFvQiw4QkFBOEIsOEJBQThCLG1CQUFtQiwyQ0FBMkMsNEZBQTRGLE1BQU0sTUFBTSxtQ0FBbUMsK0JBQStCLFlBQVksa1pBQWtaLFdBQVcsNEJBQTRCLDhCQUE4QiwrQ0FBK0MsMk1BQTJNLDRHQUE0RyxpS0FBaUssZ0lBQWdJLDZCQUE2QixzREFBc0QseUVBQXlFLFdBQVcsU0FBUyw2QkFBNkIsWUFBWSxxQkFBcUIsZUFBZSwrQkFBK0IsK0NBQStDLG1CQUFtQixhQUFhLElBQUksSUFBSSxhQUFhLFVBQVUsZ0JBQWdCLGdCQUFnQiwwQkFBMEIsU0FBUyx5QkFBeUIsU0FBUyxFQUFFLG9EQUFvRCxhQUFhLDBDQUEwQyxtQ0FBbUMscUJBQXFCLEVBQUUsNkNBQTZDLHFLQUFxSyxtUkFBbVIsNENBQTRDLHVDQUF1QyxZQUFZLHFCQUFxQixPQUFPLG1EQUFtRCw0QkFBNEIsTUFBTSxXQUFXLEVBQUUsYUFBYSxTQUFTLG1HQUFtRyxXQUFXLCtCQUErQixhQUFhLDBCQUEwQiwyQkFBMkIsRUFBRSxxQ0FBcUMsMEJBQTBCLDBDQUEwQyxFQUFFLHFDQUFxQyxrQkFBa0IscUVBQXFFLE9BQU8sbUJBQW1CLDRCQUE0QixnQkFBZ0IsNkNBQTZDLFlBQVksNENBQTRDLDBKQUEwSiwrQkFBK0Isa0JBQWtCLHNCQUFzQixFQUFFLDhCQUE4Qix5QkFBeUIsSUFBSSxLQUFLLDhDQUE4QyxnQ0FBZ0MsZ0JBQWdCLG9CQUFvQix5Q0FBeUMsRUFBRSx1QkFBdUIsNENBQTRDLG1DQUFtQyxNQUFNLE9BQU8sbUJBQW1CLGtCQUFrQixtSkFBbUosK0RBQStELCtFQUErRSxJQUFJLHNDQUFzQyxVQUFVLG1DQUFtQyxnQkFBZ0IsY0FBYyxJQUFJLGtIQUFrSCxLQUFLLFdBQVcsNEJBQTRCLEtBQUssZ0JBQWdCLGdDQUFnQyxJQUFJLHNCQUFzQixVQUFVLElBQUksZUFBZSxTQUFTLEtBQUssaUVBQWlFLFNBQVMsV0FBVyxlQUFlLDhEQUE4RCxzREFBc0Qsa0JBQWtCLGFBQWEsRUFBRSxzSEFBc0gsbUJBQW1CLHdFQUF3RSxNQUFNLHlEQUF5RCwyQkFBMkIseUNBQXlDLHFDQUFxQyxTQUFTLFVBQVUsMEJBQTBCLFNBQVMsR0FBRyx5QkFBeUIsc0JBQXNCLDZDQUE2Qyx5QkFBeUIsSUFBSSx5Q0FBeUMseUJBQXlCLDRCQUE0QixFQUFFLFVBQVUsYUFBYSx5Q0FBeUMsWUFBWSxZQUFZLHVCQUF1QixlQUFlLCtCQUErQixXQUFXLHNDQUFzQyxnQkFBZ0IsNkJBQTZCLDJEQUEyRCxpQkFBaUIsK0JBQStCLGlTQUFpUyx1Q0FBdUMsYUFBYSxVQUFVLGdCQUFnQixNQUFNLDBJQUEwSSxpQkFBaUIsOEtBQThLLDhDQUE4QyxnQkFBZ0IsNkRBQTZELDhDQUE4QyxjQUFjLHdCQUF3QixnSUFBZ0ksRUFBRSxhQUFhLHlCQUF5Qiw4REFBOEQsVUFBVSxRQUFRLDJCQUEyQix1REFBdUQseUJBQXlCLE9BQU8sZUFBZSwwREFBMEQsc0JBQXNCLGtCQUFrQixhQUFhLGNBQWMsTUFBTSxnR0FBZ0csOERBQThELDhCQUE4QixxREFBcUQsZUFBZSxJQUFJLHFGQUFxRiwyQkFBMkIsR0FBRyxFQUFFLFFBQVEseUVBQXlFLGVBQWUsVUFBVSxlQUFlLGFBQWEsa0JBQWtCLGVBQWUsd0JBQXdCLDhCQUE4QixFQUFFLHdCQUF3Qix1Q0FBdUMsS0FBSyxzRkFBc0YsZ09BQWdPLHNDQUFzQyxpQ0FBaUMsSUFBSSxVQUFVLG1CQUFtQixTQUFTLG1CQUFtQixpQ0FBaUMsWUFBWSxzQkFBc0IscUJBQXFCLHFCQUFxQixjQUFjLFdBQVcsMENBQTBDLHNCQUFzQixLQUFLLHVCQUF1Qix1RUFBdUUsaUJBQWlCLHFCQUFxQixrQkFBa0IsU0FBUyxhQUFhLGdDQUFnQyxhQUFhLDZEQUE2RCxtQ0FBbUMsa0JBQWtCLFNBQVMsRUFBRSxzQkFBc0Isd0JBQXdCLDREQUE0RCw2QkFBNkIsRUFBRSxxQkFBcUIsYUFBYSxnQ0FBZ0Msd1NBQXdTLDhCQUE4QixHQUFHLFVBQVUsdUJBQXVCLGlDQUFpQyxxSUFBcUksY0FBYywyQkFBMkIsMEJBQTBCLDRDQUE0QywySEFBMkgsS0FBSyxLQUFLLDRFQUE0RSxtQ0FBbUMsbUNBQW1DLHVDQUF1Qyx5Q0FBeUMsYUFBYSxvQkFBb0IsWUFBWSw4RUFBOEUsYUFBYSxZQUFZLHdNQUF3TSxxQ0FBcUMseUJBQXlCLDJCQUEyQixvQ0FBb0Msd0RBQXdELGtCQUFrQixpQkFBaUIsR0FBRyxFQUFFLFFBQVEsaURBQWlELGVBQWUsa0JBQWtCLG9CQUFvQixxQ0FBcUMsWUFBWSxpRUFBaUUsZ0VBQWdFLDZCQUE2QixFQUFFLFFBQVEsOEJBQThCLGVBQWUsUUFBUSx5Q0FBeUMsZUFBZSxzQkFBc0IseUZBQXlGLHFDQUFxQyxNQUFNLGlPQUFpTyxrQkFBa0IsRUFBRSxFQUFFLGVBQWUsS0FBcUMsRUFBRSx5SkFBVSxTQUFTLGlDQUFnQixFQUFFLG1DQUFDLFdBQVcsU0FBUztBQUFBLG9HQUFDLENBQUM7QUFDdGorQzs7Ozs7Ozs7Ozs7O0FDckJBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7OztBQUdGO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLDBCQUEwQixnSEFBZ0g7O0FBRTFJO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsb0NBQW9DO0FBQzNELEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUYsQ0FBQzs7Ozs7Ozs7Ozs7O0FDM09EOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsQ0FBQyxrQjs7Ozs7Ozs7Ozs7QUNSRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEVBQThFO0FBQzlFOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjs7Ozs7Ozs7Ozs7O0FDeERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUU7QUFDRjtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwREFBMEQsU0FBUztBQUNuRTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixhQUFhLGVBQWUsbUJBQW1CO0FBQ3pFLDBFQUEwRSxtQkFBbUIsZUFBZSxtQkFBbUI7QUFDL0gsd0RBQXdELGFBQWE7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IseUJBQXlCO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsNkJBQTZCLEtBQUs7O0FBRWxDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxpQkFBaUIsU0FBUztBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QyxVQUFVO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLFVBQVU7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsbUNBQW1DLHlFQUF5RTtBQUM1Rzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0Esc0NBQXNDLDRCQUE0QjtBQUNsRSxtQztBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLG9EQUFvRCxVQUFVO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLDJCQUEyQiw2Q0FBNkM7O0FBRXhFO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxZQUFZOztBQUVaOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxPQUFPO0FBQ1A7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsMERBQTBELFlBQVk7O0FBRXRFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQSw2REFBNkQ7QUFDN0Q7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsVUFBVSxPQUFPLFVBQVU7QUFDN0Q7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxrQ0FBa0MsU0FBUztBQUMzQztBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxtQ0FBbUMsU0FBUztBQUM1QztBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxtQ0FBbUMsU0FBUztBQUM1QztBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGtEQUFrRDtBQUNsRDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxrREFBa0Q7QUFDbEQ7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxtQ0FBbUMsU0FBUztBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxtQ0FBbUMsU0FBUztBQUM1QztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxRQUFRLFlBQVk7QUFDcEI7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBOztBQUVBLG1DQUFtQyxTQUFTO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBLG1DQUFtQyxTQUFTO0FBQzVDO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsaUJBQWlCLGdCQUFnQjtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPLFNBQVM7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxtQ0FBbUMsU0FBUztBQUM1QztBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsOENBQThDLHVCQUF1QjtBQUNyRTtBQUNBLHFDQUFxQyxtQkFBbUI7QUFDeEQ7QUFDQSx1Q0FBdUMsaUJBQWlCO0FBQ3hEO0FBQ0EsdURBQXVELDBDQUEwQztBQUNqRztBQUNBLHdDQUF3QyxxQkFBcUI7QUFDN0Q7QUFDQSx5Q0FBeUMsdUJBQXVCO0FBQ2hFO0FBQ0EscURBQXFELHVDQUF1QztBQUM1RjtBQUNBLGlEQUFpRCxpQ0FBaUM7QUFDbEY7QUFDQSxzREFBc0Qsd0NBQXdDO0FBQzlGO0FBQ0Esd0RBQXdELHdDQUF3QztBQUNoRztBQUNBLDREQUE0RCw0Q0FBNEM7QUFDeEc7QUFDQSxxREFBcUQsdUNBQXVDO0FBQzVGO0FBQ0EsMENBQTBDLDBCQUEwQjtBQUNwRTtBQUNBLGtEQUFrRCxrQ0FBa0M7QUFDcEY7QUFDQSx1REFBdUQsa0NBQWtDO0FBQ3pGO0FBQ0EscURBQXFELHlDQUF5QztBQUM5RjtBQUNBLCtDQUErQywrQkFBK0I7QUFDOUU7QUFDQSxvREFBb0Qsc0NBQXNDO0FBQzFGO0FBQ0EsMkRBQTJELDhDQUE4QztBQUN6RztBQUNBLG1EQUFtRCxxQ0FBcUM7QUFDeEY7QUFDQSx5REFBeUQsNENBQTRDO0FBQ3JHO0FBQ0EscUNBQXFDLG1CQUFtQjtBQUN4RDtBQUNBLG9EQUFvRCx1Q0FBdUM7QUFDM0Y7QUFDQSwrREFBK0QsK0NBQStDO0FBQzlHO0FBQ0EsMkNBQTJDLDJCQUEyQjtBQUN0RTtBQUNBLHNEQUFzRCx3Q0FBd0M7QUFDOUY7QUFDQSxvREFBb0Qsc0NBQXNDOztBQUUxRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSx1REFBdUQ7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxpQkFBaUI7QUFDakI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLFdBQVc7QUFDdkM7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsdURBQXVEO0FBQ3ZELHNCQUFzQjtBQUN0QixlQUFlO0FBQ2YsZUFBZTtBQUNmLHNEQUFzRDtBQUN0RCxhQUFhO0FBQ2I7O0FBRUE7QUFDQTtBQUNBLG1DQUFtQztBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9FQUFvRTtBQUNwRTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsbUNBQW1DO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0VBQW9FO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxtRUFBbUUseUNBQXlDO0FBQzVHO0FBQ0EsNkRBQTZELDZDQUE2QztBQUMxRztBQUNBLGlEQUFpRCwrQkFBK0I7QUFDaEY7QUFDQSxxRUFBcUUsaURBQWlEO0FBQ3RIO0FBQ0EsdUVBQXVFLG1EQUFtRDtBQUMxSDtBQUNBLDhDQUE4Qyw0QkFBNEI7QUFDMUU7QUFDQSw4REFBOEQsNENBQTRDO0FBQzFHO0FBQ0Esd0VBQXdFLHFEQUFxRDtBQUM3SDtBQUNBLDBDQUEwQyxzQkFBc0I7QUFDaEU7QUFDQSw0Q0FBNEMsd0JBQXdCOztBQUVwRTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx3Q0FBd0MsYUFBYTtBQUNyRCxtQ0FBbUM7QUFDbkM7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGNBQWM7O0FBRWQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQSxpREFBaUQsU0FBUztBQUMxRDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSwyQkFBMkIsMkJBQTJCOztBQUV0RDtBQUNBO0FBQ0EsRUFBRTs7QUFFRjs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsS0FBSztBQUNMO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLHFGQUFxRjtBQUNoSDtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxrQkFBa0Isa0JBQWtCO0FBQ3BDOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsY0FBYzs7QUFFZDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxzQ0FBc0MsUUFBUTtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsNENBQTRDLDBGQUEwRixFQUFFO0FBQ3hJOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EseUNBQXlDLGdCQUFnQjs7QUFFekQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUgsOEVBQThFLDBCQUEwQjtBQUN4RyxFQUFFOztBQUVGO0FBQ0EsNEZBQTRGO0FBQzVGLEVBQUU7O0FBRUY7QUFDQSw0RkFBNEY7QUFDNUYsRUFBRTs7QUFFRjtBQUNBLDBGQUEwRjtBQUMxRixFQUFFOztBQUVGO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0Esa0JBQWtCLHNCQUFzQjtBQUN4Qzs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esa0JBQWtCLFNBQVM7QUFDM0I7QUFDQTs7QUFFQTtBQUNBLG1CQUFtQixtQkFBbUI7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSx3QkFBd0IsTUFBTTtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRCxvQkFBb0I7QUFDekU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdEQUF3RCw2QkFBNkIsRUFBRTtBQUN2RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsMEJBQTBCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxREFBcUQsNkJBQTZCLEVBQUU7QUFDcEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQix3QkFBd0I7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsZ0JBQWdCO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTzs7QUFFUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBLHlEQUF5RCxzQ0FBc0M7O0FBRS9GOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QyxjQUFjLEVBQUU7QUFDOUQsaURBQWlELGFBQWEsRUFBRTtBQUNoRTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsY0FBYyxFQUFFO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw0REFBNEQsUUFBUSxtQkFBbUIsY0FBYyxFQUFFO0FBQ3ZHO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsYUFBYSxrQkFBa0I7QUFDL0I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxhQUFhLDBCQUEwQjtBQUN2QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHdCQUF3QixVQUFVO0FBQ2xDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLGlCQUFpQixtQkFBbUIsc0NBQXNDLEVBQUUsY0FBYztBQUMxRixpQkFBaUIsbUJBQW1CLCtCQUErQixFQUFFLGNBQWM7QUFDbkYsZUFBZSxtQkFBbUIsK0JBQStCLEVBQUUsY0FBYztBQUNqRixjQUFjLG1CQUFtQiw2QkFBNkIsRUFBRSxjQUFjO0FBQzlFLGlCQUFpQixtQkFBbUIsa0RBQWtELEVBQUUsY0FBYztBQUN0RyxZQUFZLG1CQUFtQiwyQ0FBMkMsRUFBRSxjQUFjO0FBQzFGLFlBQVksbUJBQW1CLDJDQUEyQyxFQUFFLGNBQWM7QUFDMUYsVUFBVSxtQkFBbUIseUNBQXlDLEVBQUUsY0FBYztBQUN0RixTQUFTLG1CQUFtQixtQ0FBbUMsRUFBRSxjQUFjO0FBQy9FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSCwwQztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxFQUFFOztBQUVGOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxxRUFBcUU7QUFDckU7QUFDQTs7QUFFQTtBQUNBLHFFQUFxRTs7QUFFckU7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDJCQUEyQixlQUFlO0FBQzFDO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBLCtCQUErQixxQkFBcUI7QUFDcEQ7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixnQkFBZ0I7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTs7QUFFQTs7QUFFQSxxQkFBcUIsMEJBQTBCO0FBQy9DOztBQUVBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjs7QUFFM0I7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUEsaUJBQWlCOztBQUVqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxtQkFBbUIsc0JBQXNCO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLGlDQUFpQztBQUM1RDs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsTUFBTTtBQUNOOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsNEJBQTRCLFNBQVM7QUFDckMsMkJBQTJCLFNBQVMsZ0JBQWdCLGNBQWM7QUFDbEUsNEJBQTRCLFNBQVMsaUJBQWlCLGNBQWM7QUFDcEUsMkJBQTJCLFNBQVMsc0JBQXNCLGNBQWM7QUFDeEUsaUNBQWlDLFNBQVMsdUJBQXVCLGNBQWM7QUFDL0UsdUNBQXVDLFNBQVMsbUNBQW1DLGNBQWM7QUFDakcsOEJBQThCLFNBQVMsb0JBQW9CLGNBQWM7QUFDekUscUNBQXFDLFNBQVMsZ0NBQWdDLGNBQWM7QUFDNUYsOEJBQThCLFNBQVMseUJBQXlCLGNBQWM7QUFDOUUsZ0NBQWdDLFNBQVMsc0JBQXNCLGNBQWM7QUFDN0UsaUNBQWlDLFNBQVMsdUJBQXVCLGNBQWM7QUFDL0Usd0RBQXdELElBQUksRUFBRSxTQUFTO0FBQ3ZFLDJEQUEyRCxJQUFJLEVBQUUsU0FBUztBQUMxRSxzREFBc0QsSUFBSSxNQUFNLElBQUksRUFBRSxTQUFTO0FBQy9FLDRCQUE0QixTQUFTLG1CQUFtQixJQUFJO0FBQzVELDJCQUEyQixTQUFTLGtCQUFrQixJQUFJO0FBQzFELDJCQUEyQixTQUFTLGtCQUFrQixJQUFJLE1BQU0sSUFBSTtBQUNwRSw4QkFBOEIsU0FBUyxzQkFBc0IsSUFBSTtBQUNqRSwrQkFBK0IsU0FBUyx1QkFBdUIsSUFBSTtBQUNuRSx3QkFBd0IsU0FBUztBQUNqQyw4QkFBOEIsU0FBUyxtQkFBbUIsY0FBYyxXQUFXLGFBQWE7QUFDaEcsK0JBQStCLFNBQVMsbUJBQW1CLGNBQWMsWUFBWSxhQUFhO0FBQ2xHLDhCQUE4QixTQUFTLG1CQUFtQixjQUFjLEtBQUssYUFBYTtBQUMxRiwrQkFBK0IsU0FBUyxtQkFBbUIsY0FBYztBQUN6RSxvQ0FBb0MsU0FBUyxtQkFBbUIsY0FBYyxrQkFBa0IsYUFBYTtBQUM3RywwQ0FBMEMsU0FBUyxtQkFBbUIsY0FBYyw4QkFBOEIsYUFBYTtBQUMvSCxpQ0FBaUMsU0FBUyxtQkFBbUIsY0FBYyxlQUFlLGFBQWE7QUFDdkcsd0NBQXdDLFNBQVMsbUJBQW1CLGNBQWMsMkJBQTJCLGFBQWE7QUFDMUgsaUNBQWlDLFNBQVMsbUJBQW1CLGNBQWMsU0FBUyxhQUFhO0FBQ2pHLGtDQUFrQyxTQUFTLG1CQUFtQixjQUFjO0FBQzVFLG1DQUFtQyxTQUFTLG1CQUFtQixjQUFjLGlCQUFpQixhQUFhO0FBQzNHLG9DQUFvQyxTQUFTLG1CQUFtQixjQUFjLGtCQUFrQixhQUFhO0FBQzdHLDJCQUEyQixTQUFTLHVCQUF1QixrQkFBa0I7QUFDN0Usa0NBQWtDLFNBQVMsbUJBQW1CLElBQUk7QUFDbEUsaUNBQWlDLFNBQVMsa0JBQWtCLElBQUk7QUFDaEUsZ0RBQWdELFNBQVMsa0JBQWtCLElBQUksTUFBTSxJQUFJO0FBQ3pGLG1EQUFtRCxTQUFTLHVCQUF1QixZQUFZO0FBQy9GLGdEQUFnRCxTQUFTO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7O0FBRWxCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSw0RUFBNEUsK0JBQStCLEVBQUU7QUFDN0c7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7O0FBRWQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLDZCQUE2QjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsdUNBQXVDLGdDQUFnQyxFQUFFO0FBQ3pFO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esb0JBQW9CLGdCQUFnQjtBQUNwQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1RUFBdUUsWUFBWTtBQUNuRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsRztBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxrQkFBa0I7QUFDaEM7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixzQkFBc0IsRUFBRTtBQUNsRDs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixrQkFBa0I7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkMsRUFBRSwwQ0FBMEMsRUFBRTtBQUN6RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0EsbUJBQW1CLEVBQUUsRUFBRSxFQUFFO0FBQ3pCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx3Q0FBd0MsZUFBZTtBQUN2RCx3Q0FBd0MsWUFBWTs7QUFFcEQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSwwQ0FBMEMsRUFBRSxZQUFZLEVBQUU7QUFDMUQ7QUFDQTtBQUNBLGtFQUFrRSxFQUFFLFlBQVksRUFBRSxjQUFjLEVBQUU7QUFDbEc7QUFDQTtBQUNBO0FBQ0EsbUVBQW1FLEVBQUU7QUFDckU7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsdUJBQXVCLEdBQUc7QUFDMUI7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLGdDQUFnQyxNQUFNO0FBQ3RDO0FBQ0E7O0FBRUE7QUFDQSx3QkFBd0IsTUFBTTtBQUM5QjtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBLHFCQUFxQixHQUFHO0FBQ3hCO0FBQ0Esd0NBQXdDLEVBQUUsRUFBRSxFQUFFO0FBQzlDOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUEsc0JBQXNCLEdBQUc7QUFDekI7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxxRUFBcUUsRUFBRSxnQkFBZ0IsRUFBRTtBQUN6RjtBQUNBLEdBQUc7QUFDSDtBQUNBLHFCQUFxQixHQUFHO0FBQ3hCOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGtEQUFrRCxFQUFFLDhCQUE4QixFQUFFLG1CQUFtQixFQUFFO0FBQ3pHOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLDZDQUE2QyxnQkFBZ0I7O0FBRTdEO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdFQUF3RSxFQUFFLEVBQUUsRUFBRTs7QUFFOUU7QUFDQSx1RkFBdUYsRUFBRSxFQUFFLEVBQUU7O0FBRTdGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTLElBQUk7QUFDYjtBQUNBOztBQUVBLHNDQUFzQyxTQUFTO0FBQy9DOztBQUVBLGlCQUFpQiwwQkFBMEI7QUFDM0M7QUFDQTs7QUFFQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksYUFBYTtBQUN6QjtBQUNBO0FBQ0E7O0FBRUEsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxpQ0FBaUM7QUFDakM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsRUFBRSxFQUFFLEVBQUUseUZBQXlGLEVBQUUsRUFBRSxFQUFFO0FBQ3RIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLHFCQUFxQixZQUFZO0FBQ2pDOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBLHFDQUFxQywyQkFBMkIsRUFBRTtBQUNsRTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxtREFBbUQ7QUFDbkQ7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQztBQUN0QyxxQkFBcUI7QUFDckI7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLG1FQUFtRTtBQUN4RjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLEdBQUc7QUFDSDtBQUNBLHFDQUFxQyxZQUFZO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxzQ0FBc0MseURBQXlEO0FBQy9GOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQywrREFBK0Q7QUFDckc7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsMkZBQTJGLEVBQUUsVUFBVSxFQUFFO0FBQ3pHO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIscUJBQXFCO0FBQ25EO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsbURBQW1ELDJHQUEyRyxFQUFFO0FBQ2hLO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDRDQUE0QyxpR0FBaUc7O0FBRTdJO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLDhDQUE4QztBQUNoRTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQjs7QUFFaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixFQUFFLEdBQUcsRUFBRTtBQUNqQztBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxtREFBbUQ7QUFDbkQ7QUFDQSxpREFBaUQ7QUFDakQ7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsNENBQTRDLFNBQVM7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsbURBQW1ELFdBQVc7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxjQUFjLEVBQUUsWUFBWSxFQUFFLG1CQUFtQixFQUFFLGNBQWMsRUFBRTtBQUNuRTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJOztBQUVKO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJOztBQUVKO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQSxvREFBb0Q7QUFDcEQ7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLG1EQUFtRCxpQkFBaUI7QUFDcEU7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLG1EQUFtRCx5RUFBeUU7QUFDNUg7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsbURBQW1ELG1EQUFtRDtBQUN0RztBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsbURBQW1ELHFCQUFxQjtBQUN4RTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLG1EQUFtRCxrQ0FBa0M7QUFDckYsR0FBRztBQUNIO0FBQ0E7QUFDQSxvREFBb0Qsd0VBQXdFO0FBQzVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxtREFBbUQscUJBQXFCO0FBQ3hFO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxtREFBbUQsdUVBQXVFO0FBQzFIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxtREFBbUQscUhBQXFIO0FBQ3hLO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsNERBQTRELHNDQUFzQyxjQUFjLEVBQUUsRUFBRSxFQUFFOztBQUV0SDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsa0JBQWtCOztBQUVsQjtBQUNBO0FBQ0EsNERBQTRELFlBQVksRUFBRTtBQUMxRTs7QUFFQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxtQkFBbUIsVUFBVTtBQUM3Qjs7QUFFQSxpQkFBaUIsMEJBQTBCO0FBQzNDO0FBQ0E7O0FBRUEsa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLGVBQWU7QUFDM0I7QUFDQTtBQUNBOztBQUVBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsaUNBQWlDO0FBQ2pDOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxlQUFlLHdCQUF3QixFQUFFOztBQUU3RTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRCxFQUFFOztBQUVwRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLEVBQUUsbUNBQW1DLEVBQUUsRUFBRSxFQUFFOztBQUVwRTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHlCQUF5QixFQUFFLGlDQUFpQyxFQUFFLEVBQUUsRUFBRTs7QUFFbEU7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsRUFBRSwrQkFBK0IsRUFBRTtBQUM3RDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsb0JBQW9CLDZCQUE2QjtBQUNqRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLDZCQUE2QjtBQUMvRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esb0JBQW9CLG1CQUFtQjtBQUN2QztBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLGtCQUFrQixpQ0FBaUM7QUFDbkQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBLEdBQUc7QUFDSDtBQUNBLGtCQUFrQiw2QkFBNkI7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsTUFBTTs7QUFFTjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDJDQUEyQyxnRkFBZ0YsRUFBRTtBQUM3SDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0RBQWtELHFCQUFxQixFQUFFO0FBQ3pFLDBCQUEwQixFQUFFLEdBQUcsRUFBRTtBQUNqQztBQUNBO0FBQ0EsRUFBRTs7QUFFRjs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EscUNBQXFDLFFBQVE7QUFDN0M7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdURBQXVELDJCQUEyQixFQUFFO0FBQ3BGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esc0NBQXNDLHlEQUF5RDtBQUMvRjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsK0RBQStEO0FBQ3JHOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDJDQUEyQyxrQkFBa0I7QUFDN0QsdUNBQXVDLDRCQUE0QjtBQUNuRSxrREFBa0QsMkJBQTJCO0FBQzdFLDZDQUE2Qyw0QkFBNEI7QUFDekUsK0NBQStDLDRCQUE0QjtBQUMzRSwrQ0FBK0MsK0JBQStCOztBQUU5RTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLE1BQU07O0FBRU47QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSwyREFBMkQsMkRBQTJELEVBQUU7QUFDeEg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBLDREO0FBQ0E7QUFDQSxXQUFXO0FBQ1gsVUFBVTtBQUNWO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxzRUFBc0U7QUFDdEU7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsK0NBQStDO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULFFBQVE7QUFDUjtBQUNBLE1BQU07O0FBRU47QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsMEJBQTBCLEVBQUU7QUFDbEU7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUU7QUFDeEQsMENBQTBDLEVBQUUsRUFBRSxFQUFFO0FBQ2hEO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLHNGQUFzRixFQUFFO0FBQ3hGOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGdEO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwyQ0FBMkMseUNBQXlDO0FBQ3BGO0FBQ0E7QUFDQSw4Q0FBOEMsNENBQTRDO0FBQzFGOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QyxhQUFhLEVBQUU7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDJDQUEyQyxjQUFjOztBQUV6RDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsU0FBUztBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLFNBQVM7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0Esd0NBQXdDLFNBQVM7QUFDakQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDJDQUEyQyxjQUFjOztBQUV6RCxvREFBb0QsNkNBQTZDOztBQUVqRztBQUNBOztBQUVBO0FBQ0EsNENBQTRDLHlEQUF5RDs7QUFFckc7QUFDQSxpREFBaUQsbUhBQW1IOztBQUVwSztBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSxvQkFBb0Isb0JBQW9CO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLCtCQUErQixtQkFBbUI7QUFDbEQ7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsaURBQWlELCtCQUErQjs7QUFFaEY7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLG9CQUFvQixFQUFFLEVBQUUsRUFBRTtBQUMxQjtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLDZDQUE2QywyQ0FBMkM7QUFDeEYsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsMkNBQTJDLHVEQUF1RDtBQUNsRzs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUEsbUJBQW1CLFNBQVM7QUFDNUIsK0JBQStCLFNBQVM7O0FBRXhDO0FBQ0EsR0FBRzs7QUFFSDtBQUNBLDREO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQSxvQkFBb0IsRUFBRSxFQUFFLEVBQUU7QUFDMUI7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLCtCQUErQixvQkFBb0I7QUFDbkQ7QUFDQTtBQUNBLCtCQUErQixvQkFBb0I7QUFDbkQ7O0FBRUE7QUFDQSxzQ0FBc0MsdUNBQXVDO0FBQzdFLHNDQUFzQyx1Q0FBdUM7O0FBRTdFO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZ0JBQWdCO0FBQ2hCLFFBQVEsZ0NBQWdDLEVBQUUsWUFBWTtBQUN0RCxRQUFRLGdDQUFnQyxFQUFFLFlBQVk7QUFDdEQ7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQSx1RDs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLGtHQUFrRyxJQUFJLDhDQUE4QyxJQUFJO0FBQ3hKO0FBQ0E7QUFDQSxtREFBbUQsSUFBSTtBQUN2RCxvREFBb0QsSUFBSTtBQUN4RDtBQUNBLGdEQUFnRCxJQUFJO0FBQ3BELCtDQUErQyxJQUFJLHFDQUFxQzs7QUFFeEYsNEJBQTRCLFNBQVMsK0I7QUFDckMsR0FBRzs7QUFFSDtBQUNBO0FBQ0Esb0JBQW9CLEVBQUUsRUFBRSxFQUFFLGlCQUFpQixFQUFFLFFBQVEsRUFBRTtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDhDQUE4QyxtQ0FBbUM7QUFDakYsMENBQTBDLHdCQUF3QjtBQUNsRTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMsc0RBQXNEO0FBQ2xHO0FBQ0E7QUFDQTtBQUNBLDhDQUE4Qyx3QkFBd0I7QUFDdEU7QUFDQTs7QUFFQTtBQUNBLHVEQUF1RCxrQ0FBa0M7QUFDekY7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsMkNBQTJDLHdEQUF3RDtBQUNuRzs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esd0NBQXdDLHNDQUFzQyxFQUFFO0FBQ2hGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0Esa0JBQWtCLDRCQUE0QjtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLGtCQUFrQiw0QkFBNEI7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0Esb0JBQW9CLEVBQUUsRUFBRSxFQUFFLG1CQUFtQixFQUFFO0FBQy9DO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0Esa0RBQWtELGlDQUFpQztBQUNuRjtBQUNBLCtDQUErQywwQ0FBMEM7QUFDekYsaURBQWlELCtCQUErQjtBQUNoRjtBQUNBO0FBQ0EsK0NBQStDLCtCQUErQjtBQUM5RTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsK0JBQStCLGNBQWM7O0FBRTdDLDRCQUE0QixTQUFTO0FBQ3JDLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esa0RBQWtELHlEQUF5RDtBQUMzRzs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsOENBQThDLDBEQUEwRDtBQUN4RztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLCtDQUErQywrQkFBK0I7QUFDOUU7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLGdEQUFnRCw4Q0FBOEM7QUFDOUY7O0FBRUE7QUFDQSxpREFBaUQsK0JBQStCOztBQUVoRjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLCtCQUErQixjQUFjO0FBQzdDLGVBQWUsYUFBYTs7QUFFNUIsNEJBQTRCLFNBQVM7QUFDckMsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxrREFBa0QseURBQXlEOztBQUUzRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0Esc0NBQXNDLHFCQUFxQjtBQUMzRCxzQ0FBc0MscUJBQXFCOztBQUUzRDtBQUNBO0FBQ0EsaUZBQWlGLElBQUksdUJBQXVCLElBQUk7QUFDaEgsa0VBQWtFLElBQUk7QUFDdEUsbURBQW1ELElBQUk7O0FBRXZEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQSxvQkFBb0IsRUFBRSxFQUFFLEVBQUUsaUJBQWlCLEVBQUUsUUFBUSxFQUFFO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0ZBQXNGLGtCQUFrQjs7QUFFeEc7QUFDQSw4Q0FBOEMsNkJBQTZCO0FBQzNFLDZDQUE2QyxnR0FBZ0c7QUFDN0ksMkNBQTJDLDBCQUEwQjs7QUFFckU7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLG9CQUFvQixFQUFFLEVBQUUsRUFBRSxlQUFlLEVBQUU7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLDJFQUEyRSxJQUFJLDhDQUE4QyxJQUFJO0FBQ2pJO0FBQ0EscURBQXFELElBQUk7QUFDekQsb0RBQW9ELElBQUkscUNBQXFDOztBQUU3Riw0QkFBNEIsU0FBUztBQUNyQztBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsdUNBQXVDLGNBQWM7QUFDckQsd0NBQXdDLFlBQVk7QUFDcEQseUNBQXlDLCtCQUErQjtBQUN4RSw2Q0FBNkMsWUFBWTs7QUFFekQ7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSx1Q0FBdUMsY0FBYztBQUNyRCwyQ0FBMkMsa0JBQWtCO0FBQzdELDBDQUEwQyxpQkFBaUI7QUFDM0QsdUNBQXVDLG9CQUFvQjtBQUMzRCx3Q0FBd0MsWUFBWTtBQUNwRCw2Q0FBNkMsWUFBWTtBQUN6RCx5Q0FBeUMsZ0JBQWdCOztBQUV6RDtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0Esa0RBQWtELHdCQUF3QjtBQUMxRSw2Q0FBNkMsbUJBQW1CO0FBQ2hFOztBQUVBOztBQUVBO0FBQ0EsRUFBRTs7QUFFRjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsNENBQTRDLGdCQUFnQjtBQUM1RCw0Q0FBNEMsbUJBQW1CO0FBQy9ELDZDQUE2QyxvQkFBb0I7O0FBRWpFO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsdUNBQXVDLGNBQWM7QUFDckQsMENBQTBDLHNEQUFzRDtBQUNoRyx5Q0FBeUMsZ0JBQWdCOztBQUV6RDs7QUFFQTtBQUNBOztBQUVBLGdHQUFnRztBQUNoRzs7QUFFQTtBQUNBLHNDQUFzQyx1QkFBdUIsRUFBRTtBQUMvRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsUUFBUTtBQUMvQztBQUNBOztBQUVBOztBQUVBO0FBQ0Esb0JBQW9CLGtCQUFrQjtBQUN0QztBQUNBOztBQUVBO0FBQ0Esd0NBQXdDLFFBQVE7QUFDaEQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QyxRQUFRO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSwwQ0FBMEMsaUJBQWlCOztBQUUzRDtBQUNBOztBQUVBO0FBQ0EsbUNBQW1DLFFBQVE7QUFDM0M7O0FBRUE7QUFDQSxnR0FBZ0csNkRBQTZEOztBQUU3SjtBQUNBLHFEQUFxRCxNQUFNO0FBQzNELDBFQUEwRSw2REFBNkQ7QUFDdkk7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsMkRBQTJELDRDQUE0Qzs7QUFFdkc7QUFDQTtBQUNBLDJDQUEyQyxRQUFRO0FBQ25EO0FBQ0E7QUFDQSxpREFBaUQsNENBQTRDO0FBQzdGO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwyQ0FBMkMsUUFBUTtBQUNuRDtBQUNBO0FBQ0EsaURBQWlELDRDQUE0QztBQUM3RjtBQUNBOztBQUVBO0FBQ0E7QUFDQSwyREFBMkQsNENBQTRDOztBQUV2Ryx3Q0FBd0MsUUFBUTtBQUNoRDtBQUNBOztBQUVBO0FBQ0EsZ0dBQWdHLDZEQUE2RDs7QUFFN0o7QUFDQSxxREFBcUQsTUFBTTtBQUMzRCwwRUFBMEUsNkRBQTZEO0FBQ3ZJO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLDBDQUEwQyxpQkFBaUI7QUFDM0QsK0NBQStDLHNCQUFzQjtBQUNyRTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsU0FBUztBQUNwQztBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0Esc0dBQXNHO0FBQ3RHOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsUUFBUTtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUixPQUFPO0FBQ1A7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EseUdBQXlHLEVBQUUsYUFBYSxFQUFFO0FBQzFIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLHNHQUFzRztBQUN0Rzs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDO0FBQy9DOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0Esb0dBQW9HO0FBQ3BHOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0M7QUFDL0M7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxrR0FBa0c7QUFDbEc7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLGtCQUFrQiw4Q0FBOEM7O0FBRWhFO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSxNQUFNOztBQUVOO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTs7QUFFQSxtREFBbUQsc0ZBQXNGOztBQUV6STtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLGtHQUFrRztBQUNsRzs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDO0FBQy9DOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLDRHQUE0RztBQUM1Rzs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDO0FBQy9DOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0Esa0dBQWtHO0FBQ2xHOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0M7QUFDL0M7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLG9HQUFvRztBQUNwRzs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDO0FBQy9DOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyx5Q0FBeUM7QUFDbkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxHQUFHO0FBQ3JDO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQSxPQUFPO0FBQ1AsTUFBTTtBQUNOOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsa0JBQWtCLHdCQUF3QjtBQUMxQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0EsOEZBQThGLEVBQUUsRUFBRSxFQUFFO0FBQ3BHO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsYUFBYSw2REFBNkQ7QUFDMUU7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsaUJBQWlCLCtEQUErRDtBQUNoRixLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQSxxQ0FBcUMsUUFBUTtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxHQUFHO0FBQ0g7QUFDQSxxQ0FBcUMsUUFBUTtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBLGtCQUFrQixzQkFBc0I7QUFDeEM7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxFQUFFOztBQUVGOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxFQUFFLEVBQUUsRUFBRTtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBLGdEQUFnRCwwREFBMEQ7O0FBRTFHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQix3QkFBd0I7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0Esd0NBQXdDLGVBQWU7QUFDdkQsMENBQTBDLGNBQWM7O0FBRXhEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLCtDQUErQyw4QkFBOEIsRUFBRTtBQUMvRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLDBCQUEwQiwrQ0FBK0M7QUFDekU7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxnREFBZ0QsdUJBQXVCOztBQUV2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGdEQUFnRCx3QkFBd0I7O0FBRXhFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxpRUFBaUUsRUFBRTs7QUFFbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07O0FBRU47QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsNkRBQTZELHdDQUF3QyxFQUFFO0FBQ3ZHLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esb0JBQW9CLGtCQUFrQjtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLDBDQUEwQyxFQUFFO0FBQzVDO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsMkdBQTJHLEVBQUU7QUFDN0c7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLE1BQU07QUFDTiwrSEFBK0gsRUFBRSxHQUFHLEVBQUU7QUFDdEk7QUFDQSxLQUFLO0FBQ0wsb0hBQW9ILEVBQUU7QUFDdEg7O0FBRUE7QUFDQTtBQUNBLG1JQUFtSSxFQUFFLEVBQUUsRUFBRTtBQUN6STs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsbUVBQW1FLEVBQUU7QUFDckU7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esc0RBQXNELDBCQUEwQixFQUFFO0FBQ2xGO0FBQ0E7QUFDQTtBQUNBLCtEQUErRCwyQkFBMkIsRUFBRTs7QUFFNUY7QUFDQTtBQUNBO0FBQ0EsZ0VBQWdFLDZDQUE2QyxFQUFFOztBQUUvRztBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsNEJBQTRCLHdCQUF3Qjs7QUFFcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxRQUFRO0FBQ1I7QUFDQSxNQUFNO0FBQ047O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsNEJBQTRCLHdCQUF3QjtBQUNwRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZ0RBQWdELDhDQUE4QztBQUM5Rjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsT0FBTztBQUNQLE1BQU07QUFDTixLQUFLO0FBQ0wsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUU7QUFDN0U7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1IsT0FBTzs7QUFFUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSw0REFBNEQsRUFBRSxtQkFBbUIsRUFBRTtBQUNuRjtBQUNBLEtBQUs7QUFDTCxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1IsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLEtBQUs7QUFDTCxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQSxVQUFVO0FBQ1YsU0FBUztBQUNULFFBQVE7QUFDUjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFVBQVU7QUFDVixTQUFTO0FBQ1QsUUFBUTtBQUNSLE9BQU87QUFDUDtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0EsTUFBTTs7QUFFTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7QUFDVCxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sS0FBSztBQUNMLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELHFCQUFxQjtBQUN0RSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUixPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1IsT0FBTztBQUNQO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULFFBQVE7QUFDUjtBQUNBO0FBQ0EsT0FBTztBQUNQOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLEtBQUs7QUFDTCxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLEtBQUs7QUFDTDtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsdUJBQXVCLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUU7QUFDNUU7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLE1BQU07QUFDTjtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5R0FBeUcsZ0NBQWdDLEVBQUU7QUFDM0ksS0FBSztBQUNMLElBQUk7QUFDSixHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxzQkFBc0IsWUFBWTtBQUNsQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLG1EQUFtRCxFQUFFLEVBQUUsRUFBRSx5Q0FBeUMsRUFBRTtBQUNwRzs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBOztBQUVBLHdCQUF3QixxQkFBcUI7QUFDN0M7QUFDQTtBQUNBO0FBQ0Esa0RBQWtELEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSwwQkFBMEIsRUFBRTtBQUN4RjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLCtFQUErRTtBQUM1SDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IscUZBQXFGO0FBQ3pHOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esa0JBQWtCLHVCQUF1QjtBQUN6QztBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSx5RUFBeUU7O0FBRXpFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0Esb0NBQW9DLHdCQUF3QixFQUFFO0FBQzlEO0FBQ0EsMENBQTBDLHdCQUF3QixFQUFFO0FBQ3BFOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFO0FBQ3hFO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUEsK0NBQStDLHVGQUF1Rjs7QUFFdEk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixLQUFLOztBQUVMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsTUFBTTtBQUNOLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxrQkFBa0Isa0JBQWtCO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IseUNBQXlDO0FBQ2pFOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHdCQUF3Qix5Q0FBeUM7QUFDakU7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx3QkFBd0IseUNBQXlDO0FBQ2pFOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0Esa0NBQWtDLGNBQWM7QUFDaEQ7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBLCtCQUErQiw0Q0FBNEM7QUFDM0UsRUFBRTs7QUFFRjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBLG9FQUFvRSxFQUFFLEVBQUUsRUFBRTtBQUMxRTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx5Q0FBeUMsRUFBRSxFQUFFLEVBQUU7O0FBRS9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0VBQWtFLEVBQUUsRUFBRSxFQUFFO0FBQ3hFO0FBQ0E7O0FBRUE7QUFDQSx3QkFBd0IsR0FBRztBQUMzQjtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCOztBQUVBO0FBQ0EsS0FBSztBQUNMLElBQUk7QUFDSjtBQUNBO0FBQ0EsMkNBQTJDLEVBQUUsRUFBRSxFQUFFO0FBQ2pEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw4QkFBOEIsNENBQTRDO0FBQzFFLEVBQUU7O0FBRUY7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGtCQUFrQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esb0JBQW9CLGtCQUFrQjtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxvRkFBb0YsRUFBRSxFQUFFLEVBQUU7QUFDMUY7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxrRUFBa0UsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFO0FBQzVFOztBQUVBO0FBQ0EsdUNBQXVDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRTs7QUFFakQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSw2Q0FBNkMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRTtBQUM1RCxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsbUJBQW1CLCtCQUErQjtBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsMERBQTBELEVBQUUsRUFBRSxFQUFFO0FBQ2hFOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHNEQUFzRCxFQUFFLGNBQWMsRUFBRSxFQUFFLEVBQUUsMENBQTBDLEVBQUU7QUFDeEg7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxrQkFBa0IscUJBQXFCO0FBQ3ZDO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLDZDQUE2QyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsMEJBQTBCLEVBQUU7QUFDbkY7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBLDRDQUE0QyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUU7O0FBRXREO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QywrRUFBK0U7QUFDeEg7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIOztBQUVBO0FBQ0EsK0JBQStCLDRDQUE0QztBQUMzRSxFQUFFOztBQUVGO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQseUJBQXlCLEVBQUUsb0RBQW9ELHlCQUF5QixFQUFFLHFCQUFxQixzQkFBc0IsRUFBRTtBQUMxTSwrQkFBK0IsRUFBRSxPQUFPLEVBQUUsRUFBRSxFQUFFO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTs7QUFFQSxnQkFBZ0I7QUFDaEI7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLEtBQUs7O0FBRUw7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDZCQUE2Qjs7QUFFN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsVUFBVTtBQUNWO0FBQ0EsUUFBUTtBQUNSOztBQUVBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7O0FBRVI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULFFBQVE7QUFDUjtBQUNBLG9FQUFvRSxFQUFFLFlBQVksRUFBRTtBQUNwRixRQUFRO0FBQ1I7QUFDQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVOztBQUVWO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0Esb0RBQW9ELEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUU7QUFDbkY7QUFDQSxXQUFXO0FBQ1g7QUFDQSxRQUFRO0FBQ1I7QUFDQSxNQUFNO0FBQ047O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEVBQTRFLHNEQUFzRCxHQUFHLEVBQUU7O0FBRXZJO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWCxVQUFVO0FBQ1Y7QUFDQSxtREFBbUQsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRTtBQUNsRjtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDhFQUE4RSw0Q0FBNEMsRUFBRTs7QUFFNUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLHVEQUF1RCxFQUFFO0FBQ3pEOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVOztBQUVWO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsTUFBTTtBQUNOOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLGNBQWM7QUFDZDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSw2RUFBNkUsZ0NBQWdDO0FBQzdHO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsbUNBQW1DLDRCQUE0QjtBQUMvRDtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0Esc0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osS0FBSztBQUNMOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxLQUFLO0FBQ0w7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0Esc0RBQXNELEVBQUUsNEJBQTRCLEVBQUU7QUFDdEY7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsSUFBSTtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0Esa0NBQWtDLHFCQUFxQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLDJCQUEyQixXQUFXO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1EO0FBQ25EO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixtQ0FBbUM7QUFDdkQ7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJFQUEyRSwyQkFBMkIsRUFBRTtBQUN4RyxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQSxxQkFBcUIsRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLGVBQWUsRUFBRSxrQkFBa0IsRUFBRSxhQUFhLEVBQUU7QUFDbkc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUNBQWlDLFFBQVE7QUFDekM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsRUFBRTs7QUFFRjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsOEZBQThGLEVBQUUsUUFBUSxFQUFFLFlBQVksRUFBRTtBQUN4SDs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBLG1CQUFtQiwrQkFBK0I7QUFDbEQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwREFBMEQsRUFBRTtBQUM1RDs7QUFFQTs7QUFFQTtBQUNBLDJDQUEyQyxFQUFFLCtCQUErQixFQUFFO0FBQzlFOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMERBQTBELEVBQUU7QUFDNUQ7O0FBRUE7O0FBRUE7QUFDQSx3Q0FBd0MsRUFBRSwrQkFBK0IsRUFBRTtBQUMzRTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCxPQUFPO0FBQzFEO0FBQ0E7QUFDQSxtRUFBbUUsa0RBQWtELEVBQUU7QUFDdkgsbUVBQW1FLGtEQUFrRCxFQUFFO0FBQ3ZIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEscUNBQXFDLHFEQUFxRDtBQUMxRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYjs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsVUFBVTtBQUNWOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLGdCQUFnQix5QkFBeUI7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2RUFBNkUscURBQXFEO0FBQ2xJO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhEQUE4RCxlQUFlLEVBQUU7QUFDL0UsK0NBQStDLG1DQUFtQyxFQUFFLEdBQUc7QUFDdkYsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsMEVBQTBFLEVBQUU7QUFDNUU7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJO0FBQ0osR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFJQUFxSTtBQUNySTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxrRUFBa0UsOEJBQThCLEVBQUU7QUFDbEcsa0VBQWtFLDhCQUE4QixFQUFFO0FBQ2xHO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQSxxREFBcUQsRUFBRSxJQUFJLEVBQUU7QUFDN0QsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsRUFBRTs7QUFFRjtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0hBQW9IOztBQUVwSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsdUhBQXVILEVBQUU7QUFDekg7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNEQUFzRCxFQUFFLElBQUksRUFBRTtBQUM5RCxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0Qsa0NBQWtDO0FBQ2xGLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRCxtQ0FBbUM7QUFDeEYsUUFBUTtBQUNSOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLEVBQUU7QUFDM0M7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsTUFBTTtBQUNOLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLHlEQUF5RDtBQUN6RDtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sS0FBSztBQUNMLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHFCQUFxQixFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUU7QUFDbEMsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsd0RBQXdELG1CQUFtQjtBQUMzRTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLHdDQUF3QztBQUMvRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLE1BQU07QUFDTjtBQUNBLE1BQU07QUFDTjtBQUNBLE1BQU07QUFDTjtBQUNBLE1BQU07QUFDTjtBQUNBLE1BQU07QUFDTjtBQUNBOztBQUVBO0FBQ0EscURBQXFELEVBQUUsRUFBRSxFQUFFO0FBQzNEO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQsb0NBQW9DLEVBQUU7QUFDekY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsd0RBQXdELEVBQUU7QUFDL0Y7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxPQUFPO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCLHVCQUF1QjtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQSxFQUFFOztBQUVGOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsMkRBQTJELHNFQUFzRSxFQUFFO0FBQ25JO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxFQUFFOztBQUVGOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSx5REFBeUQ7QUFDekQ7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsMkRBQTJEO0FBQzNEO0FBQ0EsT0FBTztBQUNQLE1BQU07QUFDTixLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsdURBQXVELHlDQUF5QyxFQUFFO0FBQ2xHLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIscUJBQXFCO0FBQzFDO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esd0JBQXdCLEVBQUUsRUFBRSxFQUFFO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTs7QUFFQSxpQkFBaUIsbUNBQW1DO0FBQ3BEO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSxrQkFBa0IscUJBQXFCO0FBQ3ZDO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0Esd0JBQXdCLFlBQVksOENBQThDO0FBQ2xGOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0Esd0JBQXdCO0FBQ3hCOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSw4QkFBOEIseUJBQXlCOztBQUV2RDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EscUJBQXFCOztBQUVyQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrRUFBK0UsU0FBUztBQUN4RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLFNBQVM7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0VBQStFLFNBQVM7QUFDeEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyxPQUFPO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsV0FBVztBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxvQ0FBb0MsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUU7QUFDNUQ7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMseUVBQXlFO0FBQ3ZGO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFOztBQUVGO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsNkJBQTZCO0FBQzFDO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFOztBQUVGO0FBQ0E7QUFDQSxlQUFlOztBQUVmO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLGVBQWU7QUFDMUI7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUgsRUFBRTs7QUFFRjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsQ0FBQzs7Ozs7Ozs7Ozs7O0FDMzRwQkQ7QUFDQTtBQUNBO0FBQ0E7OztBQUdBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QyxPQUFPO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGdCQUFnQjtBQUNoQixnQkFBZ0I7QUFDaEIsYUFBYTtBQUNiLFlBQVk7QUFDWixnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxPQUFPO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxPQUFPO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Ysc0RBQXNEO0FBQ3REO0FBQ0EsbUNBQW1DLEtBQUssRUFBRTtBQUMxQzs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLE9BQU87QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsT0FBTztBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLGlCQUFpQjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxpQkFBaUI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLGtCQUFrQjtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSx5Q0FBeUMsc0RBQXNEO0FBQy9GO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSx5Q0FBeUMsMERBQTBEO0FBQ25HO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHlDQUF5QywrREFBK0Q7QUFDeEc7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EseUNBQXlDLDRCQUE0QjtBQUNyRTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUEseUNBQXlDLHNDQUFzQztBQUMvRTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUEseUNBQXlDLG9DQUFvQztBQUM3RTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0EseUNBQXlDLG9DQUFvQztBQUM3RTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRixnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsZUFBZTtBQUNmLDhCQUE4QjtBQUM5QiwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSw2QkFBNkI7QUFDN0IsZUFBZTtBQUNmO0FBQ0E7QUFDQTs7QUFFQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7O0FBR0E7Ozs7Ozs7OztBQVNBLGtFQUFrRSxrQkFBa0IsaUNBQWlDLGtCQUFrQixrQ0FBa0Msa0JBQWtCO0FBQzNMLG9EQUFvRCxrQkFBa0IsaUNBQWlDLGtCQUFrQjs7QUFFekg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QyxPQUFPO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsT0FBTztBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlHQUFpRztBQUNqRztBQUNBO0FBQ0EsdUpBQXVKLDBCQUEwQiwrQkFBK0I7QUFDaE4sMEJBQTBCO0FBQzFCLFFBQVEsRUFBRTtBQUNWO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLDJDQUEyQyxPQUFPO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEMsT0FBTztBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGtDQUFrQyxPQUFPO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHFCQUFxQixZQUFZO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLGtCQUFrQjtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCLGFBQWE7QUFDYixZQUFZO0FBQ1osV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7Ozs7QUFJQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyxhQUFhO0FBQzVEO0FBQ0E7QUFDQTtBQUNBLGdGQUFnRixpQkFBaUI7QUFDakc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixZQUFZO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGdDQUFnQyxRQUFRO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLFFBQVE7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzRUFBc0U7QUFDdEU7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQSx1Q0FBdUMsT0FBTztBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsUUFBUTtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLE9BQU87QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDBEQUEwRCxFQUFFOztBQUU1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsRUFBRTtBQUMxQjtBQUNBO0FBQ0Esd0JBQXdCLEVBQUU7QUFDMUI7QUFDQTtBQUNBLHdCQUF3QixFQUFFO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsRUFBRTtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDZCQUE2QixPQUFPO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxPQUFPO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxRQUFRO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QyxPQUFPO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTs7QUFFUjs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHdCQUF3QixXQUFXO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUEsUUFBUTs7QUFFUjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSw4QkFBOEIsaXlCQUFpeUIscUJBQXFCLG9DQUFvQyx3S0FBd0ssdWdDQUF1Z0M7QUFDdGpFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDs7Ozs7Ozs7Ozs7OztBQWFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGVBQWUsMEJBQTBCO0FBQ3pDO0FBQ0Esc0VBQXNFLEVBQUU7QUFDeEUsZUFBZSxtRkFBbUY7QUFDbEc7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLFFBQVE7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOzs7OztBQUtEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQiwyQkFBMkIsRUFBRTtBQUM5QztBQUNBO0FBQ0Esa0JBQWtCLFFBQVE7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG1CQUFtQjtBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsNEJBQTRCO0FBQzVCO0FBQ0EsY0FBYyxtQkFBbUI7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsT0FBTztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzREFBc0QsT0FBTztBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsTUFBTTtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7OztBQWdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLGlEQUFpRDtBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQiwwRUFBMEU7QUFDN0Y7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHLG1MQUFtTDtBQUN0TCxHQUFHLG9KQUFvSjtBQUN2SixHQUFHLDRFQUE0RTtBQUMvRSxHQUFHO0FBQ0g7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUcsa0xBQWtMO0FBQ3JMLEdBQUcsK0VBQStFO0FBQ2xGLEdBQUcsNkpBQTZKO0FBQ2hLLEdBQUc7QUFDSDtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLFFBQVE7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLE9BQU87QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsRUFBRTtBQUNGOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHLHVIQUF1SDtBQUMxSCxHQUFHLG9KQUFvSjtBQUN2SixHQUFHO0FBQ0g7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLFFBQVE7QUFDaEM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLFFBQVE7QUFDNUM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixRQUFRO0FBQ2hDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLFFBQVE7QUFDNUM7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsT0FBTztBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0RBQWdELE9BQU87QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLFlBQVk7QUFDMUI7QUFDQTtBQUNBLHVCQUF1QixRQUFRO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLE9BQU87QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0QsT0FBTztBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyw2Q0FBNkM7QUFDaEY7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLFFBQVE7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7O0FBR0E7QUFDQTtBQUNBLENBQUM7OztBQUdEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsT0FBTztBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxPQUFPO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsT0FBTztBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EscUNBQXFDLE9BQU87QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsNkZBQTZGO0FBQzdGOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7Ozs7OztBQU9BOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsb0VBQW9FO0FBQ3ZGO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkRBQTJEO0FBQzNEO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx1Q0FBdUMsd0VBQXdFO0FBQy9HO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTs7O0FBR0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7Ozs7Ozs7QUFPQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTs7O0FBR0Esc0JBQXNCO0FBQ3RCOzs7QUFHQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsQ0FBQztBQUNEOzs7Ozs7O0FBT0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUMsRUFBRSxxQ0FBcUMsRUFBRTtBQUNsRjtBQUNBLGlEQUFpRCxFQUFFO0FBQ25EO0FBQ0EseUNBQXlDLEVBQUU7QUFDM0M7QUFDQSxrRkFBa0YsRUFBRTtBQUNwRjtBQUNBLHlDQUF5QyxFQUFFO0FBQzNDO0FBQ0E7QUFDQSxrQ0FBa0MsRUFBRTtBQUNwQyx1QkFBdUIsRUFBRTtBQUN6QjtBQUNBLHNDQUFzQyxFQUFFO0FBQ3hDLHFCQUFxQixFQUFFO0FBQ3ZCO0FBQ0E7QUFDQSx3RUFBd0UsRUFBRTtBQUMxRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QyxFQUFFO0FBQ3pDLDBCQUEwQixFQUFFO0FBQzVCLDJCQUEyQixFQUFFO0FBQzdCLHNDQUFzQyxFQUFFO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLEVBQUU7QUFDM0Isa0NBQWtDLEVBQUU7QUFDcEMsNkJBQTZCLEVBQUU7QUFDL0I7QUFDQTtBQUNBLDREQUE0RCxFQUFFO0FBQzlEO0FBQ0E7QUFDQSxnREFBZ0QsRUFBRTtBQUNsRCx5Q0FBeUMsRUFBRTtBQUMzQywrQ0FBK0MsRUFBRTtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkRBQTJELEVBQUU7QUFDN0QsbUNBQW1DLEVBQUU7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNGQUFzRixFQUFFO0FBQ3hGLHNDQUFzQyxFQUFFO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLEVBQUU7QUFDdkMsMENBQTBDLEVBQUUsdURBQXVELEVBQUU7QUFDckc7QUFDQSx5Q0FBeUMsRUFBRSw0REFBNEQsRUFBRTtBQUN6Ryw4Q0FBOEMsRUFBRTtBQUNoRDtBQUNBLGlDQUFpQyxFQUFFO0FBQ25DLHVCQUF1QixFQUFFLGtDQUFrQyxFQUFFO0FBQzdELGtDQUFrQyxFQUFFO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0RBQW9ELEVBQUUsNkNBQTZDLEVBQUU7QUFDckc7QUFDQSwyQ0FBMkMsRUFBRSxrQ0FBa0MsRUFBRTtBQUNqRiw4QkFBOEIsRUFBRTtBQUNoQyxxRUFBcUUsRUFBRTtBQUN2RTtBQUNBLHlDQUF5QyxFQUFFLFFBQVEsRUFBRTtBQUNyRDtBQUNBLDJDQUEyQyxFQUFFO0FBQzdDO0FBQ0EsbUNBQW1DLEVBQUU7QUFDckM7QUFDQSxzQkFBc0IsRUFBRTtBQUN4Qjs7Ozs7Ozs7Ozs7O0FDOWxQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnRkFBZ0Y7QUFDaEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QztBQUN4QztBQUNBO0FBQ0EsbUZBQW1GO0FBQ25GO0FBQ0E7QUFDQSx5REFBeUQ7QUFDekQ7QUFDQTtBQUNBO0FBQ0EsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QztBQUN6QztBQUNBLG9FQUFvRTtBQUNwRTtBQUNBO0FBQ0EseUNBQXlDLHFCQUFxQjtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0E7QUFDQTtBQUNBLHVFQUF1RTtBQUN2RTtBQUNBO0FBQ0EsNENBQTRDO0FBQzVDLHNIQUFzSDtBQUN0SDtBQUNBO0FBQ0EscUVBQXFFO0FBQ3JFO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEM7QUFDMUMsbUVBQW1FO0FBQ25FO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQztBQUMzQyxjQUFjO0FBQ2QsY0FBYywrQ0FBK0MscUNBQXFDLEtBQUs7QUFDdkc7QUFDQTtBQUNBLDJDQUEyQyxtREFBbUQ7QUFDOUYsd0JBQXdCLG1DQUFtQztBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5Qyx1QkFBdUI7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQSw0QkFBNEIsd0JBQXdCO0FBQ3BELGFBQWE7QUFDYjtBQUNBLGdDQUFnQyx1QkFBdUI7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxvQkFBb0IsY0FBYztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxpQ0FBaUM7QUFDN0U7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLE9BQU87QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLGFBQWE7QUFDdkQsNERBQTREO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQsaURBQWlEO0FBQ3BHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEIsNkNBQTZDLE9BQU87QUFDcEQ7O0FBRUE7QUFDQSxvRkFBb0Y7QUFDcEY7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLDBCQUEwQiwrQkFBK0IsNEJBQTRCO0FBQ3BIO0FBQ0EsOENBQThDO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyxtQkFBbUI7QUFDbEU7QUFDQSw4RUFBOEU7QUFDOUU7QUFDQTtBQUNBLHNDQUFzQyx3QkFBd0I7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkVBQTZFO0FBQzdFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkRBQTJEO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0VBQXNFO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxlQUFlO0FBQ25ELG9DQUFvQywrQkFBK0I7QUFDbkU7QUFDQTtBQUNBLG9DQUFvQyxlQUFlO0FBQ25ELG9DQUFvQywrQkFBK0I7QUFDbkU7QUFDQTtBQUNBO0FBQ0Esd0pBQXdKO0FBQ3hKO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0dBQW9HO0FBQ3BHO0FBQ0E7QUFDQSwyREFBMkQ7QUFDM0Q7QUFDQSxvRkFBb0YsYUFBYTtBQUNqRywrRUFBK0UsYUFBYTs7QUFFNUY7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDO0FBQ3hDLHVDQUF1QyxPQUFPO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBLCtCQUErQjtBQUMvQjtBQUNBO0FBQ0EsdUJBQXVCLDZEQUE2RDtBQUNwRjtBQUNBO0FBQ0EsK0NBQStDO0FBQy9DO0FBQ0E7QUFDQSwrREFBK0Q7QUFDL0Q7QUFDQTtBQUNBLGdKQUFnSjtBQUNoSixxSEFBcUg7QUFDckg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsdUNBQXVDLE9BQU87QUFDOUM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaU9BQWlPO0FBQ2pPO0FBQ0E7QUFDQTtBQUNBOztBQUVBLDZDQUE2QztBQUM3QztBQUNBO0FBQ0E7QUFDQSxzRkFBc0Y7QUFDdEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQiw0QkFBNEIsYUFBYTtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwSEFBMEg7QUFDMUg7QUFDQTtBQUNBO0FBQ0EsK0NBQStDO0FBQy9DO0FBQ0E7QUFDQSwrQ0FBK0MsT0FBTztBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDO0FBQzVDO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEVBQTRFLHlSQUF5Uix1Q0FBdUMsR0FBRyxvRUFBb0UsNEJBQTRCLGtDQUFrQyxpQ0FBaUMsMkJBQTJCLDRDQUE0QyxzREFBc0Qsa0RBQWtELCtDQUErQyw0QkFBNEIsdUJBQXVCLEdBQUc7QUFDdDBCO0FBQ0E7QUFDQSxlQUFlLDRDQUE0Qyw2Q0FBNkMsbUJBQW1CO0FBQzNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEM7Ozs7OztBQU05Qyw4Q0FBOEM7QUFDOUM7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLG9FQUFvRTtBQUNsRixjQUFjLG9FQUFvRTtBQUNsRixXQUFXLDhEQUE4RDtBQUN6RSxnQkFBZ0I7QUFDaEI7QUFDQSx5Q0FBeUMsRUFBRSxrQkFBa0IsRUFBRTtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxxQ0FBcUMsT0FBTztBQUM1QztBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsT0FBTztBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7O0FBWUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7OztBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsT0FBTztBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLE9BQU87QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIscUJBQXFCO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsV0FBVztBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsT0FBTztBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUcsNElBQTRJO0FBQy9JLEdBQUcsOERBQThEO0FBQ2pFLEdBQUc7QUFDSDtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLCtEQUErRDtBQUN4RSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUyxTQUFTO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLFFBQVE7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkMsT0FBTztBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsUUFBUTtBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxPQUFPO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQjtBQUMvQjs7QUFFQSxjQUFjLCtCQUErQjtBQUM3QztBQUNBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsd0lBQXdJLDBDQUEwQztBQUNsTDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGNBQWMscUJBQXFCO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxnQ0FBZ0MsMEJBQTBCLCtCQUErQiw0QkFBNEI7QUFDckg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFROztBQUVSO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsNkJBQTZCLHVCQUF1QjtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9FQUFvRSxpQ0FBaUMsRUFBRTtBQUN2RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsUUFBUSx3QkFBd0I7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLE9BQU87QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EseUNBQXlDO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkMsT0FBTztBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7O0FBRUE7QUFDQSwwQ0FBMEMscUJBQXFCO0FBQy9ELG1DQUFtQyxnQ0FBZ0M7QUFDbkU7QUFDQTtBQUNBLDZFQUE2RSwrQkFBK0I7QUFDNUc7QUFDQSxzSkFBc0o7QUFDdEo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBLDBJQUEwSTtBQUMxSSxvT0FBb08sdUNBQXVDLEVBQUU7QUFDN1E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsZUFBZTtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLGlCQUFpQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDZCQUE2QixxQkFBcUI7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixvQkFBb0IsRUFBRTtBQUNuRDtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsMkJBQTJCLEVBQUU7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsT0FBTztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QyxPQUFPO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MsU0FBUztBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsbUJBQW1CLFNBQVM7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLE9BQU87QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtGQUFrRixTQUFTO0FBQzNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyxPQUFPO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLE9BQU87QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsV0FBVztBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLFNBQVM7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4RUFBOEUsU0FBUztBQUN2RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVMsU0FBUztBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsMkJBQTJCO0FBQzFDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxDQUFDOztBQUVEOztBQUVBO0FBQ0EsdUJBQXVCLEVBQUUsSUFBSSxFQUFFO0FBQy9CLCtGQUErRixFQUFFO0FBQ2pHO0FBQ0EseUNBQXlDLEVBQUU7QUFDM0M7QUFDQSxrREFBa0QsRUFBRTtBQUNwRCwwQkFBMEIsRUFBRTtBQUM1QjtBQUNBO0FBQ0Esc0NBQXNDLEVBQUUsZ0JBQWdCLEVBQUU7QUFDMUQsd0RBQXdELEVBQUU7QUFDMUQ7QUFDQTtBQUNBLGdEQUFnRCxFQUFFO0FBQ2xELG9DQUFvQyxFQUFFO0FBQ3RDO0FBQ0E7QUFDQSwrREFBK0QsRUFBRTtBQUNqRSxpRUFBaUUsRUFBRTtBQUNuRTtBQUNBIiwiZmlsZSI6ImxpYnJhcnktc2NyaXB0cy43MWQ3MmZkODU3NTIzMzNiNDkwZi5qcyIsInNvdXJjZXNDb250ZW50IjpbIjsgKGZ1bmN0aW9uICgkKSB7XHJcblx0dmFyIERpYWxvZyA9IGZ1bmN0aW9uIChvcHRpb25zLCBlbGVtZW50KSB7XHJcblx0XHR0aGlzLl9vcHRpb25zID0gJC5leHRlbmQoe30sIERpYWxvZy5kZWZhdWx0cywgb3B0aW9ucyk7XHJcblx0XHR0aGlzLl9kaWFsb2dWaXNpYmxlID0gZmFsc2U7XHJcblx0XHR0aGlzLl9oYXNUZW1wbGF0ZSA9IGZhbHNlO1xyXG5cdFx0dGhpcy5fY2hlY2twb2ludCA9IG51bGw7XHJcblx0XHR0aGlzLl9pc0V4ZWN1dGluZyA9IG5ldyBFeG9XZWIuU2lnbmFsKCk7XHJcblx0XHR0aGlzLl9kZWZhdWx0QnV0dG9uID0gbnVsbDtcclxuXHRcdHRoaXMuX2FjY2VsZXJhdG9ycyA9IHt9O1xyXG5cclxuXHRcdC8vIElmIGFuIGluc3RhbmNlL3Byb3BlcnR5IHdhcyBzcGVjaWZpZWQsIGJ1dCBubyBidXR0b25zLCBjcmVhdGUgZGVmYXVsdCBidXR0b25zXHJcblx0XHRpZiAodGhpcy5fb3B0aW9ucy5pbnN0YW5jZSkge1xyXG5cdFx0XHRpZiAoIXRoaXMuX29wdGlvbnMuYnV0dG9ucykge1xyXG5cdFx0XHRcdHRoaXMuX29wdGlvbnMuYnV0dG9ucyA9IFtcclxuXHRcdFx0XHRcdHtcclxuXHRcdFx0XHRcdFx0bGFiZWw6IFwiQ2FuY2VsXCIsXHJcblx0XHRcdFx0XHRcdGlzQ2FuY2VsOiB0cnVlXHJcblx0XHRcdFx0XHR9LFxyXG5cdFx0XHRcdFx0e1xyXG5cdFx0XHRcdFx0XHRsYWJlbDogXCJPa1wiLFxyXG5cdFx0XHRcdFx0XHRhdXRvQ2xvc2U6IGZhbHNlLFxyXG5cdFx0XHRcdFx0XHRjbGljazogZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0XHRcdHRoaXMuX2NoZWNrcG9pbnQgPSBudWxsO1xyXG5cdFx0XHRcdFx0XHRcdHRoaXMuY2xvc2UoZmFsc2UpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XVxyXG5cdFx0XHR9XHJcblx0XHR9IGVsc2UgaWYgKCF0aGlzLl9vcHRpb25zLmJ1dHRvbnMpIHtcclxuXHRcdFx0dGhpcy5fb3B0aW9ucy5idXR0b25zID0ge1xyXG5cdFx0XHRcdFwiT2tcIjogZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0dGhpcy5jbG9zZShmYWxzZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKGVsZW1lbnQpIHtcclxuXHRcdFx0dGhpcy4kZWxlbWVudCA9ICQoZWxlbWVudCk7XHJcblx0XHRcdHRoaXMuJGVsZW1lbnQuYmluZChcImNsaWNrXCIsIHRoaXMub3Blbi5iaW5kKHRoaXMsIGVsZW1lbnQpKTtcclxuXHRcdH1cclxuXHJcblx0XHQvL3RoaXMuJGVsZW1lbnQuYXBwZW5kKHRoaXMuX2NyZWF0ZSgpKTtcclxuXHRcdHRoaXMuX2RpYWxvZyA9IHRoaXMuX2NyZWF0ZSgpO1xyXG5cclxuXHRcdC8vIENyZWF0ZSBhbmQgYWRkIHRoZSBkaWFsb2cgVUkgZWxlbWVudHMgb25jZSB0aGUgRE9NIGlzIHJlYWR5XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblx0XHR2YXIgcmVhZHlEZXBzID0gW1wiRXhvV2ViLmRvbVwiXTtcclxuXHRcdGlmICh0aGlzLl9vcHRpb25zLnRlbXBsYXRlRGVwKVxyXG5cdFx0XHRyZWFkeURlcHMucHVzaCh0aGlzLl9vcHRpb25zLnRlbXBsYXRlRGVwKTtcclxuXHRcdENvZ25pdG8ucmVhZHkoXCJhcHBlbmQtZGlhbG9nLVwiICsgb3B0aW9ucy50aXRsZSwgcmVhZHlEZXBzLCBmdW5jdGlvbiAoJCkge1xyXG5cdFx0XHR2YXIgY29nbml0b0NvbnRhaW5lciA9ICQoJy5jLWFwcC1jb250YWluZXInKTtcclxuXHRcdFx0dmFyIGNvZ25pdG9EaXYgPSBjb2duaXRvQ29udGFpbmVyLmxlbmd0aCA/IGNvZ25pdG9Db250YWluZXIgOiAkKCcuY29nbml0bzpmaXJzdCcpO1xyXG5cdFx0XHR0aGF0Ll9kaWFsb2cuYXBwZW5kVG8oY29nbml0b0Rpdi5sZW5ndGggPT0gMCB8fCBDb2duaXRvLmNvbmZpZy5mbGFncy5BcHBOYXYgPyBkb2N1bWVudC5ib2R5IDogY29nbml0b0Rpdik7XHJcblxyXG5cdFx0XHQvLyBGb3JjZSBhY3RpdmF0aW9uIGlmIHVzaW5nIHRlbXBsYXRlc1xyXG5cdFx0XHRpZiAodGhhdC5fb3B0aW9ucy50ZW1wbGF0ZU5hbWUpXHJcblx0XHRcdFx0U3lzLkFwcGxpY2F0aW9uLmFjdGl2YXRlRWxlbWVudCh0aGF0Ll9kaWFsb2dbMF0pO1xyXG5cdFx0fSk7XHJcblx0fTtcclxuXHJcblx0RGlhbG9nLmRlZmF1bHRzID0ge1xyXG5cdFx0dGl0bGU6IFwiXCIsXHJcblx0XHR3aWR0aDogNDAwLFxyXG5cdFx0aGVpZ2h0OiAyMDAsXHJcblx0XHR0ZXh0OiBcIlwiLFxyXG5cdFx0c291cmNlOiBcIlwiLFxyXG5cdFx0b3BlbjogdW5kZWZpbmVkLFxyXG5cdFx0Y2FuY2VsOiB1bmRlZmluZWQsXHJcblx0XHRpbnN0YW5jZTogbnVsbCxcclxuXHRcdHByb3BlcnR5OiBudWxsLFxyXG5cdFx0dGVtcGxhdGVOYW1lOiBudWxsLFxyXG5cdFx0Y2xvc2VPbkVzY2FwZTogdHJ1ZSxcclxuXHRcdGluY2x1ZGVDbG9zZUJ1dHRvbjogdHJ1ZSxcclxuXHRcdGNvbnRlbnRTZWxlY3RvcjogbnVsbCxcclxuXHRcdGNsb3NlT25PdmVybGF5Q2xpY2s6IHRydWUsXHJcblx0XHRtb2RhbENsYXNzOiBcIlwiLFxyXG5cdFx0Y29udGVudENsYXNzOiBcIlwiLFxyXG5cdFx0b25DbG9zZTogbnVsbFxyXG5cdH07XHJcblxyXG5cdERpYWxvZy5hY3RpdmVEaWFsb2dzID0gW107XHJcblxyXG5cdGNvbnN0IHpNb2RhbE92ZXJsYXkgPSAxMDQwO1xyXG5cclxuXHREaWFsb2cucHJvdG90eXBlID0ge1xyXG5cdFx0X2NyZWF0ZTogZnVuY3Rpb24gKCkge1xyXG5cdFx0XHR2YXIgZGlhbG9nUGFuZSA9ICQoXCI8ZGl2IGNsYXNzPSdjLW1vZGFsIHNjcm9sbGJhcicgLz5cIik7XHJcblx0XHRcdGRpYWxvZ1BhbmUuYWRkQ2xhc3ModGhpcy5fb3B0aW9ucy5tb2RhbENsYXNzKVxyXG5cdFx0XHRcdFx0XHRcdFx0LmFwcGVuZChcIjxkaXYgY2xhc3M9J2MtbW9kYWwtb3ZlcmxheSc+PC9kaXY+XCIpXHJcblx0XHRcdHZhciBkaWFsb2dDb250YWluZXIgPSBkaWFsb2dQYW5lO1xyXG5cclxuXHRcdFx0ZGlhbG9nQ29udGFpbmVyLmFwcGVuZCh0aGlzLl9jcmVhdGVDb250ZW50KCkpO1xyXG5cclxuXHRcdFx0Ly8gT25seSBpbmNsdWRlIHRoZSB0aXRsZSBiYXIgaWYgYSB0aXRsZSB3YXMgc3BlY2lmaWVkXHJcblx0XHRcdGlmICh0aGlzLl9vcHRpb25zLnRpdGxlKSB7XHJcblx0XHRcdFx0ZGlhbG9nQ29udGFpbmVyLnByZXBlbmQodGhpcy5fY3JlYXRlVGl0bGUoKSk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdGRpYWxvZ0NvbnRhaW5lci5jaGlsZHJlbigpLmNzcyh7IFwicGFkZGluZy10b3BcIjogXCIwcHhcIiB9KTtcclxuXHJcblx0XHRcdGRpYWxvZ0NvbnRhaW5lci5hcHBlbmQodGhpcy5fY3JlYXRlQnV0dG9ucygpKTtcclxuXHJcblx0XHRcdC8vIEVuc3VyZSB0aGF0IGNsaWNrcyBpbnNpZGUgdGhlIGRpYWxvZyBkbyBub3QgcHJvcGFnYXRlIGJleW9uZCB0aGUgZGlhbG9nIGNvbnRleHRcclxuXHRcdFx0ZGlhbG9nUGFuZS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHtcclxuXHRcdFx0XHQoZXZlbnQub3JpZ2luYWxFdmVudCB8fCBldmVudCkuZGlhbG9nID0gdHJ1ZTtcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gZGlhbG9nUGFuZTtcclxuXHRcdH0sXHJcblx0XHRfY3JlYXRlVGl0bGU6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0dmFyIHRpdGxlUGFuZSA9ICQoXCI8ZGl2IGNsYXNzPSdjLW1vZGFsLXRpdGxlLWJhcicgLz5cIik7XHJcblx0XHRcdHRpdGxlUGFuZS5hcHBlbmQoXCI8ZGl2IGNsYXNzPSdjLW1vZGFsLXRpdGxlJz5cIiArIHRoaXMuX29wdGlvbnMudGl0bGUgKyBcIjwvZGl2PlwiKVxyXG5cclxuXHRcdFx0aWYgKHRoaXMuX29wdGlvbnMuaW5jbHVkZUNsb3NlQnV0dG9uKSB7XHJcblx0XHRcdFx0dmFyIGNsb3NlUGFuZSA9ICQoXCI8ZGl2IGNsYXNzPSdjLW1vZGFsLWNsb3NlJyAvPlwiKSAvLyBjbG9zZSBidXR0b25cclxuXHRcdFx0XHRjbG9zZVBhbmUuYXBwZW5kKFwiPGkgY2xhc3M9J2ljb24tcmVtb3ZlJyAvPlwiKTtcclxuXHRcdFx0XHRjbG9zZVBhbmUuYmluZChcImNsaWNrXCIsIHRoaXMuY2xvc2UuYmluZCh0aGlzKSk7XHJcblx0XHRcdFx0dGl0bGVQYW5lLmFwcGVuZChjbG9zZVBhbmUpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZXR1cm4gdGl0bGVQYW5lO1xyXG5cdFx0fSxcclxuXHRcdF9jcmVhdGVDb250ZW50OiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHZhciBjb250ZW50Q29udGFpbmVyID0gJChcIjxkaXYgY2xhc3M9J2MtbW9kYWwtY29udGVudC1jb250YWluZXInIC8+XCIpO1xyXG5cdFx0XHR2YXIgY29udGVudFBhbmUgPSAkKFwiPGRpdiBjbGFzcz0nYy1tb2RhbC1jb250ZW50JyAvPlwiKTtcclxuXHRcdFx0Y29udGVudENvbnRhaW5lci5hZGRDbGFzcyh0aGlzLl9vcHRpb25zLmNvbnRlbnRDbGFzcyk7XHJcblx0XHRcdGNvbnRlbnRDb250YWluZXIuYXBwZW5kKGNvbnRlbnRQYW5lKTtcclxuXHRcdFx0aWYgKHRoaXMuX29wdGlvbnMudGV4dCkge1xyXG5cdFx0XHRcdHZhciB0ZXh0Q29udGFpbmVyID0gJChcIjxwPlwiKTtcclxuXHRcdFx0XHRpZiAodGhpcy5fb3B0aW9ucy50ZXh0LmNvbnN0cnVjdG9yID09PSBTdHJpbmcpXHJcblx0XHRcdFx0XHR0ZXh0Q29udGFpbmVyLmh0bWwodGhpcy5fb3B0aW9ucy50ZXh0KTtcclxuXHRcdFx0XHRjb250ZW50UGFuZS5hcHBlbmQodGV4dENvbnRhaW5lcik7XHJcblx0XHRcdH0gZWxzZSBpZiAodGhpcy5fb3B0aW9ucy5jb250ZW50U2VsZWN0b3IpIHtcclxuXHRcdFx0XHRjb250ZW50UGFuZS5hcHBlbmQoJCh0aGlzLl9vcHRpb25zLmNvbnRlbnRTZWxlY3Rvcikuc2hvdygpKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gSWYgdGVtcGxhdGUgbmFtZSBwcm92aWRlZCwgbG9hZCBleGlzdGluZywgb3RoZXJ3aXNlIGNyZWF0ZSBuZXcgdGVtcGxhdGVcclxuXHRcdFx0aWYgKHRoaXMuX29wdGlvbnMuaW5zdGFuY2UgJiYgdGhpcy5fb3B0aW9ucy50ZW1wbGF0ZU5hbWUpXHJcblx0XHRcdFx0Y29udGVudFBhbmUuYXBwZW5kKHRoaXMuX2xvYWRUZW1wbGF0ZSgpKTtcclxuXHRcdFx0ZWxzZSBpZiAodGhpcy5fb3B0aW9ucy5pbnN0YW5jZSlcclxuXHRcdFx0XHRjb250ZW50UGFuZS5hcHBlbmQodGhpcy5fY3JlYXRlVGVtcGxhdGUoKSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gY29udGVudENvbnRhaW5lcjtcclxuXHRcdH0sXHJcblx0XHRfY3JlYXRlQnV0dG9uczogZnVuY3Rpb24gKCkge1xyXG5cdFx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblx0XHRcdHZhciBidXR0b25QYW5lID0gJChcIjxkaXYgY2xhc3M9J2MtbW9kYWwtYnV0dG9uLWJhcicgLz5cIik7XHJcblx0XHRcdHZhciBsZWZ0QnV0dG9ucyA9ICQoXCI8ZGl2IGNsYXNzPSdjLW1vZGFsLWJ1dHRvbnMtbGVmdCcgLz5cIik7XHJcblx0XHRcdHZhciByaWdodEJ1dHRvbnMgPSAkKFwiPGRpdiBjbGFzcz0nYy1tb2RhbC1idXR0b25zLXJpZ2h0JyAvPlwiKTtcclxuXHRcdFx0aWYgKHRoaXMuX29wdGlvbnMuYnV0dG9ucykge1xyXG5cdFx0XHRcdCQuZWFjaCh0aGlzLl9vcHRpb25zLmJ1dHRvbnMsIGZ1bmN0aW9uIChuYW1lLCBwcm9wcykge1xyXG5cdFx0XHRcdFx0dmFyIGJ1dHRvbjtcclxuXHRcdFx0XHRcdHZhciBleGVjdXRlID0gZnVuY3Rpb24gKCkgeyB9O1xyXG5cdFx0XHRcdFx0dmFyIGF1dG9DbG9zZSA9IHRydWU7XHJcblx0XHRcdFx0XHR2YXIgaXNBbGlnbmVkUmlnaHQgPSB0cnVlO1xyXG5cdFx0XHRcdFx0dmFyIGlzQWN0aW9uID0gZmFsc2U7XHJcblx0XHRcdFx0XHR2YXIgaXNEZWZhdWx0ID0gZmFsc2U7XHJcblx0XHRcdFx0XHR2YXIgaXNUYWIgPSBmYWxzZTtcclxuXHRcdFx0XHRcdHZhciBpc0NhbmNlbCA9IGZhbHNlO1xyXG5cclxuXHRcdFx0XHRcdC8vIENhbiB1c2UgYXJyYXkgdG8gcGFzcyBpbiBhZGRpdGlvbmFsIG9wdGlvbnNcclxuXHRcdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHRoYXQuX29wdGlvbnMuYnV0dG9ucykpIHtcclxuXHRcdFx0XHRcdFx0bmFtZSA9IHByb3BzLmxhYmVsO1xyXG5cdFx0XHRcdFx0XHRpZiAoJC5pc0Z1bmN0aW9uKHByb3BzLmNsaWNrKSkgZXhlY3V0ZSA9IHByb3BzLmNsaWNrO1xyXG5cdFx0XHRcdFx0XHRpZiAocHJvcHMuYWxpZ24gPT09IFwibGVmdFwiKSBpc0FsaWduZWRSaWdodCA9IGZhbHNlO1xyXG5cdFx0XHRcdFx0XHRhdXRvQ2xvc2UgPSBwcm9wcy5hdXRvQ2xvc2UgIT0gZmFsc2U7XHJcblx0XHRcdFx0XHRcdGlzQWN0aW9uID0gcHJvcHMuaXNBY3Rpb247XHJcblx0XHRcdFx0XHRcdGlzVGFiID0gcHJvcHMuaXNUYWI7XHJcblx0XHRcdFx0XHRcdGlzQ2FuY2VsID0gcHJvcHMuaXNDYW5jZWw7XHJcblx0XHRcdFx0XHRcdGlzRGVmYXVsdCA9IHByb3BzLmlzRGVmYXVsdDtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRpZiAoJC5pc0Z1bmN0aW9uKHByb3BzKSkge1xyXG5cdFx0XHRcdFx0XHRcdGV4ZWN1dGUgPSBwcm9wcztcclxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRpZiAocHJvcHMuZXhlY3V0ZSAmJiAkLmlzRnVuY3Rpb24ocHJvcHMuZXhlY3V0ZSkpIGV4ZWN1dGUgPSBwcm9wcy5leGVjdXRlO1xyXG5cdFx0XHRcdFx0XHRcdGlzRGVmYXVsdCA9IHByb3BzLmlzRGVmYXVsdDtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdC8vIFRhYmJlZCBidXR0b25cclxuXHRcdFx0XHRcdGlmIChpc1RhYikge1xyXG5cdFx0XHRcdFx0XHRidXR0b24gPSBwcm9wcy5pc0RlZmF1bHRUYWIgPyAkKFwiPGEgY2xhc3M9J2MtbW9kYWwtdGFiIGMtbW9kYWwtdGFiLWFjdGl2ZSc+XCIgKyBuYW1lICsgXCI8L2E+XCIpIDogJChcIjxhIGNsYXNzPSdjLW1vZGFsLXRhYic+XCIgKyBuYW1lICsgXCI8L2E+XCIpO1xyXG5cdFx0XHRcdFx0XHRpc0FsaWduZWRSaWdodCA9IGZhbHNlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdHZhciBhY3Rpb25TdHlsZSA9IGlzQWN0aW9uID8gXCIgYy1tb2RhbC1idXR0b24tYWN0aW9uXCIgOiBcIlwiO1xyXG5cdFx0XHRcdFx0XHRhY3Rpb25TdHlsZSArPSBpc0NhbmNlbCA/IFwiIGMtbW9kYWwtYnV0dG9uLWNhbmNlbCBidXR0b24tLXNlY29uZGFyeVwiIDogXCIgYnV0dG9uLS1wcmltYXJ5XCI7XHJcblx0XHRcdFx0XHRcdGJ1dHRvbiA9IGlzQWxpZ25lZFJpZ2h0ID8gJChcIjxhIGNsYXNzPSdjLW1vZGFsLWJ1dHRvblwiICsgYWN0aW9uU3R5bGUgKyBcIic+XCIgKyBuYW1lICsgXCI8L2E+XCIpIDogJChcIjxhIGNsYXNzPSdjLW1vZGFsLWJ1dHRvbiBjLW1vZGFsLWJ1dHRvbi1sZWZ0XCIgKyBhY3Rpb25TdHlsZSArIFwiJz5cIiArIG5hbWUgKyBcIjwvYT5cIik7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRpZiAoaXNEZWZhdWx0KSB0aGF0Ll9kZWZhdWx0QnV0dG9uID0gYnV0dG9uO1xyXG5cclxuXHRcdFx0XHRcdHZhciBhY2NlbGVyYXRvckNoYXIgPSBudWxsO1xyXG5cdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBuYW1lLmxlbmd0aCAmJiAhYWNjZWxlcmF0b3JDaGFyOyBpKyspIHtcclxuXHRcdFx0XHRcdFx0aWYgKCF0aGF0Ll9hY2NlbGVyYXRvcnNbbmFtZVtpXS50b0xvd2VyQ2FzZSgpXSkgYWNjZWxlcmF0b3JDaGFyID0gbmFtZVtpXS50b0xvd2VyQ2FzZSgpO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdHRoYXQuX2FjY2VsZXJhdG9yc1thY2NlbGVyYXRvckNoYXJdID0gYnV0dG9uO1xyXG5cclxuXHRcdFx0XHRcdGJ1dHRvbi5iaW5kKFwiY2xpY2tcIiwgdGhhdC5fYnV0dG9uV3JhcHBlci5iaW5kKHRoYXQsIGJ1dHRvblBhbmUsIGV4ZWN1dGUsIGF1dG9DbG9zZSwgaXNDYW5jZWwsIGJ1dHRvbikpO1xyXG5cdFx0XHRcdFx0aXNBbGlnbmVkUmlnaHQgPyByaWdodEJ1dHRvbnMuYXBwZW5kKGJ1dHRvbikgOiBsZWZ0QnV0dG9ucy5hcHBlbmQoYnV0dG9uKTtcclxuXHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdFx0YnV0dG9uUGFuZS5hcHBlbmQobGVmdEJ1dHRvbnMpO1xyXG5cdFx0XHRcdGJ1dHRvblBhbmUuYXBwZW5kKHJpZ2h0QnV0dG9ucyk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiBidXR0b25QYW5lO1xyXG5cdFx0fSxcclxuXHRcdF9jcmVhdGVUZW1wbGF0ZTogZnVuY3Rpb24gKCkge1xyXG5cdFx0XHR2YXIgdGVtcGxhdGVQYW5lID0gJChcIjxkaXYgY2xhc3M9J3N5cy10ZW1wbGF0ZScgc3lzOmF0dGFjaD0nZGF0YXZpZXcnIGRhdGF2aWV3OmRhdGE9J3t+IFwiICsgdGhpcy5fb3B0aW9ucy5pbnN0YW5jZSArIFwiIH0nIHN5czpjb250ZW50LXRlbXBsYXRlPSdmb3JtJyAvPlwiKTtcclxuXHRcdFx0dGVtcGxhdGVQYW5lLmFwcGVuZChcIjxkaXYgc3lzOmF0dGFjaD0nY29udGVudCcgY29udGVudDpkYXRhPSd7QCBcIiArIHRoaXMuX29wdGlvbnMucHJvcGVydHkgKyBcIn0nIC8+XCIpO1xyXG5cclxuXHRcdFx0cmV0dXJuIHRlbXBsYXRlUGFuZTtcclxuXHRcdH0sXHJcblx0XHRfbG9hZFRlbXBsYXRlOiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHJldHVybiAkKFwiPGRpdiBzeXM6YXR0YWNoPSdjb250ZW50JyBjb250ZW50OmRhdGE9J3t+IFwiICsgdGhpcy5fb3B0aW9ucy5pbnN0YW5jZSArIFwiIH0nIGNvbnRlbnQ6dGVtcGxhdGU9J1wiICsgdGhpcy5fb3B0aW9ucy50ZW1wbGF0ZU5hbWUgKyBcIic+PC9kaXY+XCIpO1xyXG5cdFx0fSxcclxuXHRcdF9idXR0b25XcmFwcGVyOiBmdW5jdGlvbiAoYnV0dG9uUGFuZSwgYnV0dG9uRnVuYywgYXV0b0Nsb3NlLCBpc0NhbmNlbCwgYnV0dG9uLCBldmVudCkge1xyXG5cdFx0XHRpZiAodGhpcy5faXNFeGVjdXRpbmcuaXNBY3RpdmUoKSkgcmV0dXJuO1xyXG5cclxuXHRcdFx0aWYgKCFpc0NhbmNlbCAmJiBidXR0b24uaGFzQ2xhc3MoXCJjLW1vZGFsLWJ1dHRvblwiKSlcclxuXHRcdFx0XHRidXR0b24uYWRkQ2xhc3MoXCJjLW1vZGFsLWJ1dHRvbi1leGVjdXRpbmdcIik7XHJcblxyXG5cdFx0XHRidXR0b25GdW5jLmNhbGwodGhpcywgZXZlbnQsIGJ1dHRvbik7XHJcblxyXG5cdFx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblx0XHRcdHRoaXMuX2lzRXhlY3V0aW5nLndhaXRGb3JBbGwoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdGlmIChhdXRvQ2xvc2UgJiYgdGhhdC5fZGlhbG9nVmlzaWJsZSkgdGhhdC5jbG9zZShpc0NhbmNlbCk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fSxcclxuXHRcdF9iaW5kVG86IGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcblx0XHRcdGlmIChlbGVtZW50KSAkKGVsZW1lbnQpLmJpbmQoXCJjbGlja1wiLCB0aGlzLm9wZW4uYmluZCh0aGlzKSk7XHJcblx0XHR9LFxyXG5cdFx0X2NyZWF0ZUNoZWNrcG9pbnQ6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0dGhpcy5fY2hlY2twb2ludCA9IGNvbnRleHQuc2VydmVyLmNoZWNrcG9pbnQoKTtcclxuXHRcdH0sXHJcblx0XHRvcGVuOiBmdW5jdGlvbiAob3JpZ0V2dCkge1x0XHRcdFxyXG5cdFx0XHRpZiAodGhpcy5fb3B0aW9ucy5vcGVuKSB7XHJcblx0XHRcdFx0aWYgKCF0aGlzLl9vcHRpb25zLm9wZW4uY2FsbCh0aGlzLCBvcmlnRXZ0KSlcclxuXHJcblx0XHRcdFx0XHQvLyBJbmRpY2F0ZSB0aGF0IHRoZSBkaWFsb2cgd2FzIG5vdCBvcGVuZWRcclxuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0JCgnYm9keScpLmFkZENsYXNzKCdjLW1vZGFsLWFjdGl2ZScpO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMuX29wdGlvbnMudXJsKSB7XHJcblx0XHRcdFx0dGhpcy5fZGlhbG9nLmZpbmQoXCIuYy1tb2RhbC1jb250ZW50XCIpLnJlbW92ZSgpO1xyXG5cclxuXHRcdFx0XHR2YXIgY29udGVudENvbnRhaW5lciA9IHRoaXMuX2RpYWxvZy5maW5kKFwiLmMtbW9kYWwtY29udGVudC1jb250YWluZXJcIik7XHJcblxyXG5cdFx0XHRcdHRoaXMuZnJhbWUgPSAkKFwiPGlmcmFtZVwiXHJcblx0XHRcdFx0XHQrICh0aGlzLl9vcHRpb25zLm5hbWUgPyBcIiBuYW1lPSdcIiArIHRoaXMuX29wdGlvbnMubmFtZSArIFwiJ1wiIDogXCJcIilcclxuXHRcdFx0XHRcdCsgXCIgc3R5bGU9J3dpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7IG92ZXJmbG93LXg6IGhpZGRlbjsgb3ZlcmZsb3cteTogaGlkZGVuOyAtbXMtb3ZlcmZsb3ctc3R5bGU6IHNjcm9sbGJhcidcIlxyXG5cdFx0XHRcdFx0KyBcIiBzcmM9J1wiICsgdGhpcy5fb3B0aW9ucy51cmwgKyBcIidcIlxyXG5cdFx0XHRcdFx0KyBcIj48L2lmcmFtZT5cIilcclxuXHRcdFx0XHRcdC5hcHBlbmRUbyhjb250ZW50Q29udGFpbmVyKVxyXG5cdFx0XHRcdFx0LmdldCgwKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh0aGlzLl9vcHRpb25zLnRleHQgaW5zdGFuY2VvZiBGdW5jdGlvbilcclxuXHRcdFx0XHR0aGlzLl9kaWFsb2cuZmluZChcIi5jLW1vZGFsLWNvbnRlbnQgcFwiKS5odG1sKHRoaXMuX29wdGlvbnMudGV4dCgpKTtcclxuXHJcblx0XHRcdGlmIChvcmlnRXZ0KSB7XHJcblx0XHRcdFx0dGhpcy4kZWxlbWVudCA9ICQob3JpZ0V2dC5jdXJyZW50VGFyZ2V0KTtcclxuXHRcdFx0XHRpZiAob3JpZ0V2dC5wcmV2ZW50RGVmYXVsdCBpbnN0YW5jZW9mIEZ1bmN0aW9uKVxyXG5cdFx0XHRcdFx0b3JpZ0V2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBFeHBvc2UgdGhlIGV2ZW50IHRoYXQgY2F1c2VkIHRoZSBkaWFsb2cgdG8gb3BlblxyXG5cdFx0XHR0aGlzLmV2ZW50ID0gb3JpZ0V2dDtcclxuXHJcblx0XHRcdGlmICh0aGlzLl9vcHRpb25zLmNoZWNrcG9pbnQpIHtcclxuXHRcdFx0XHR3aW5kb3cuY29udGV4dC5zZXJ2ZXIuYmVnaW5DYXB0dXJpbmdDaGFuZ2VzKCk7XHJcblx0XHRcdFx0dGhpcy5fY2hlY2twb2ludCA9IGNvbnRleHQuc2VydmVyLmNoZWNrcG9pbnQoKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gU2hvdyB0aGUgb3ZlcmxheSBhbmQgc3VwcG9ydCBhdXRvbWF0aWMgY2xvc3VyZSB3aGVuIHRoZSBvdmVybGF5IGlzIGNsaWNrZWRcclxuXHRcdFx0aWYgKENvZ25pdG8uc2hvd092ZXJsYXkgJiYgRGlhbG9nLmFjdGl2ZURpYWxvZ3MubGVuZ3RoID09IDApIHtcclxuXHRcdFx0XHRDb2duaXRvLnNob3dPdmVybGF5KGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdHZhciBkaWFsb2dzID0gRGlhbG9nLmFjdGl2ZURpYWxvZ3M7XHJcblx0XHRcdFx0XHREaWFsb2cuYWN0aXZlRGlhbG9ncyA9IFtdO1xyXG5cdFx0XHRcdFx0Zm9yICh2YXIgZCA9IGRpYWxvZ3MubGVuZ3RoIC0gMTsgZCA+PSAwOyBkLS0pIHtcclxuXHRcdFx0XHRcdFx0dmFyIGRpYWxvZyA9IGRpYWxvZ3NbZF07XHJcblx0XHRcdFx0XHRcdGlmIChkaWFsb2cuX29wdGlvbnMuY2xvc2VPbk92ZXJsYXlDbGljaylcclxuXHRcdFx0XHRcdFx0XHRkaWFsb2cuY2xvc2UodHJ1ZSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIFNldCB0aGUgd2lkdGggYW5kIGhlaWdodFxyXG5cdFx0XHR0aGlzLl9kaWFsb2cuY3NzKHtcclxuXHRcdFx0XHRcIm1heC13aWR0aFwiOiB0aGlzLl9vcHRpb25zLndpZHRoICsgKCQuaXNOdW1lcmljKHRoaXMuX29wdGlvbnMud2lkdGgpID8gXCJweFwiIDogXCJcIilcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHQvLyBTaG93IHRoZSBkaWFsb2dcclxuXHRcdFx0dGhpcy5fZGlhbG9nLmNzcyhcIm9wYWNpdHlcIiwgMSlcclxuXHRcdFx0XHRcdFx0XHRcdFx0LmFkZENsYXNzKFwiaXMtYWN0aXZlXCIpXHJcblx0XHRcdFx0XHRcdFx0XHRcdC5mYWRlSW4oKTtcclxuXHJcblx0XHRcdC8vIEZhZGUgaW4gYW4gb3ZlcmxheSBhYm92ZSB0aGUgYWN0aXZlIGRpYWxvZywgaWYgc3RhY2tpbmdcclxuXHRcdFx0aWYgKERpYWxvZy5hY3RpdmVEaWFsb2dzLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHR2YXIgZGlhbG9nID0gRGlhbG9nLmFjdGl2ZURpYWxvZ3NbRGlhbG9nLmFjdGl2ZURpYWxvZ3MubGVuZ3RoIC0gMV07XHJcblx0XHRcdFx0JChkaWFsb2cuX2RpYWxvZykuY3NzKFwiei1pbmRleFwiLCB6TW9kYWxPdmVybGF5IC0gMSk7XHJcblx0XHRcdFx0ZGlhbG9nLl9kaWFsb2cuZmluZChcIi5jLW1vZGFsLW92ZXJsYXlcIikuZmFkZUluKCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIEFkZCB0aGUgZGlhbG9nIHRvIHRoZSBhY3RpdmUgZGlhbG9nIHN0YWNrXHJcblx0XHRcdERpYWxvZy5hY3RpdmVEaWFsb2dzLnB1c2godGhpcyk7XHJcblxyXG5cdFx0XHR0aGlzLl9kaWFsb2dWaXNpYmxlID0gdHJ1ZTtcclxuXHJcblx0XHRcdC8vIEluZGljYXRlIHRoYXQgdGhlIGRpYWxvZyB3YXMgb3BlbmVkXHJcblx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0fSxcclxuXHRcdGNsb3NlOiBmdW5jdGlvbiAoaXNDYW5jZWwpIHtcclxuXHJcblx0XHRcdGlmICh0aGlzLmZyYW1lKSB7XHJcblx0XHRcdFx0dmFyIGZyYW1lID0gdGhpcy5mcmFtZTtcclxuXHJcblx0XHRcdFx0Ly8gQ2xlYW4gdXAgdGhlIGlmcmFtZVxyXG5cdFx0XHRcdC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTIxMjg0NTgvaWZyYW1lcy1hbmQtbWVtb3J5LW1hbmFnZW1lbnQtaW4tamF2YXNjcmlwdFxyXG5cdFx0XHRcdGZyYW1lLnNyYyA9IFwiYWJvdXQ6YmxhbmtcIjtcclxuXHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdGZyYW1lLmNvbnRlbnRXaW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcblx0XHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0JChmcmFtZSkucmVtb3ZlKCk7XHJcblx0XHRcdFx0XHR9LCAxMDAwKTtcclxuXHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdFx0ZGVsZXRlIHRoaXMuZnJhbWU7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICgkKCcuYy1tb2RhbC5pcy1hY3RpdmUsIC5jLW1vZGFsW3N0eWxlKj1cImRpc3BsYXk6IGJsb2NrXCJdJykubGVuZ3RoID09PSAxKVxyXG5cdFx0XHRcdCQoJ2JvZHknKS5yZW1vdmVDbGFzcygnYy1tb2RhbC1hY3RpdmUnKTtcclxuXHJcblx0XHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHRcdFx0aWYgKHRoaXMuX2NoZWNrcG9pbnQgJiYgdGhpcy5fb3B0aW9ucy5jaGVja3BvaW50KSB7XHJcblx0XHRcdFx0aWYgKGlzQ2FuY2VsKVxyXG5cdFx0XHRcdFx0Y29udGV4dC5zZXJ2ZXIucm9sbGJhY2sodGhpcy5fY2hlY2twb2ludCk7XHJcblx0XHRcdFx0Y29udGV4dC5zZXJ2ZXIuc3RvcENhcHR1cmluZ0NoYW5nZXMoKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKGlzQ2FuY2VsICYmIHRoaXMuX29wdGlvbnMuY2FuY2VsKSB7XHJcblx0XHRcdFx0dGhpcy5fb3B0aW9ucy5jYW5jZWwuY2FsbCh0aGlzKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKHR5cGVvZiAodGhpcy5fb3B0aW9ucy5vbkNsb3NlKSA9PT0gXCJmdW5jdGlvblwiKVxyXG5cdFx0XHRcdHRoaXMuX29wdGlvbnMub25DbG9zZS5jYWxsKHRoaXMpO1xyXG5cclxuXHRcdFx0JChcIi5jLW1vZGFsLWJ1dHRvbjp2aXNpYmxlXCIpLnJlbW92ZUNsYXNzKFwiYy1tb2RhbC1idXR0b24tZXhlY3V0aW5nXCIpO1xyXG5cdFx0XHR0aGlzLl9kaWFsb2cucmVtb3ZlQ2xhc3MoXCJpcy1hY3RpdmVcIik7XHJcblx0XHRcdHRoaXMuX2RpYWxvZy5mYWRlT3V0KGZ1bmN0aW9uICgpIHsgdGhhdC5faXNFeGVjdXRpbmcgPSBuZXcgRXhvV2ViLlNpZ25hbCgpOyB0aGF0Ll9kaWFsb2cuZmluZChcIi5jLW1vZGFsLW92ZXJsYXlcIikuaGlkZSgpIH0pO1xyXG5cclxuXHRcdFx0RGlhbG9nLmFjdGl2ZURpYWxvZ3MucG9wKHRoaXMpO1xyXG5cclxuXHRcdFx0Ly8gRmFkZSBvdXQgdGhlIG92ZXJsYXkgYWJvdmUgdGhlIGFjdGl2ZSBkaWFsb2csIGlmIHN0YWNraW5nXHJcblx0XHRcdGlmIChEaWFsb2cuYWN0aXZlRGlhbG9ncy5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0dmFyIGRpYWxvZyA9IERpYWxvZy5hY3RpdmVEaWFsb2dzW0RpYWxvZy5hY3RpdmVEaWFsb2dzLmxlbmd0aCAtIDFdO1xyXG5cdFx0XHRcdCQoZGlhbG9nLl9kaWFsb2cpLmNzcyhcInotaW5kZXhcIiwgXCJcIik7XHJcblx0XHRcdFx0ZGlhbG9nLl9kaWFsb2cuZmluZChcIi5jLW1vZGFsLW92ZXJsYXlcIikuZmFkZU91dCgpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBIaWRlIHRoZSBvdmVybGF5LCBpZiB0aGlzIGlzIHRoZSBmaW5hbCBkaWFsb2dcclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdHdpbmRvdy5Db2duaXRvICYmIENvZ25pdG8uaGlkZU92ZXJsYXkoKTtcclxuXHJcblx0XHRcdHRoaXMuX2RpYWxvZ1Zpc2libGUgPSBmYWxzZTtcclxuXHRcdH0sXHJcblx0XHRwZW5kaW5nOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2lzRXhlY3V0aW5nLnBlbmRpbmcoY2FsbGJhY2spO1xyXG5cdFx0fSxcclxuXHRcdG9yUGVuZGluZzogZnVuY3Rpb24gKGNhbGxiYWNrKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9pc0V4ZWN1dGluZy5vclBlbmRpbmcoY2FsbGJhY2spO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdHZhciB0aGF0ID0gdGhpcztcclxuXHJcblx0Ly8gRm9yIHNvbWUgdW5rbm93biByZWFzb24sIHRoZSBldmVudCBpcyBiZWluZyBib3VuZGVkIG11bHRpcGxlIHRpbWVzLiAgVG8gZW5zdXJlIHRoZSBldmVudCBpcyBvbmx5IGJvdW5kZWQgb25jZSwgdGhlIGV2ZW50IGlzIHVuYmluZCBiZWZvcmUgaXQgaXMgYmluZC5cclxuXHQkKGRvY3VtZW50KVxyXG5cdFx0Lm9uKFwia2V5dXAuY29nbml0by5kaWFsb2dcIiwgZnVuY3Rpb24gKGUpIHtcclxuXHRcdFx0aWYgKERpYWxvZy5hY3RpdmVEaWFsb2dzLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHR2YXIgZGlhbG9nID0gRGlhbG9nLmFjdGl2ZURpYWxvZ3NbRGlhbG9nLmFjdGl2ZURpYWxvZ3MubGVuZ3RoIC0gMV07XHJcblxyXG5cdFx0XHRcdGlmIChlLmFsdEtleSB8fCBlLmN0cmxLZXkpXHJcblx0XHRcdFx0XHRyZXR1cm47XHJcblxyXG5cdFx0XHRcdHN3aXRjaCAoZS5rZXlDb2RlKSB7XHJcblx0XHRcdFx0XHRjYXNlIDI3OlxyXG5cdFx0XHRcdFx0XHRpZiAoZGlhbG9nLl9vcHRpb25zLmNsb3NlT25Fc2NhcGUpIHtcclxuXHRcdFx0XHRcdFx0XHRkaWFsb2cuY2xvc2UuY2FsbChkaWFsb2csIHRydWUpO1xyXG5cdFx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdGRlZmF1bHQ6XHJcblx0XHRcdFx0XHRcdGlmICghJChlLnRhcmdldCkuaXMoXCJpbnB1dCwgdGV4dGFyZWFcIikpIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgY2hhckNvZGUgPSBlLndoaWNoIHx8IGUua2V5Q29kZTtcclxuXHRcdFx0XHRcdFx0XHR2YXIgY2hhciA9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2hhckNvZGUpLnRvTG93ZXJDYXNlKCk7XHJcblx0XHRcdFx0XHRcdFx0aWYgKGRpYWxvZy5fYWNjZWxlcmF0b3JzW2NoYXJdICYmICFkaWFsb2cuX2FjY2VsZXJhdG9yc1tjaGFyXS5pcyhcIltkaXNhYmxlZF0sIC5kaXNhYmxlZFwiKSlcclxuXHRcdFx0XHRcdFx0XHRcdGRpYWxvZy5fYWNjZWxlcmF0b3JzW2NoYXJdLnRyaWdnZXIoXCJjbGlja1wiKTtcclxuXHRcdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0pXHJcblxyXG5cdFx0Ly8gSGlkZSB0aGUgZGlhbG9nIHdoZW4gdGhlIHRpdGxlIGJhciBpcyBjbGlja2VkIChzbyB1c2VycyBjYW4gcGVlayB1bmRlciB0aGUgZGlhbG9nKVxyXG5cdFx0Lm9uKFwibW91c2Vkb3duLmNvZ25pdG8uZGlhbG9nXCIsIFwiLmMtbW9kYWwtdGl0bGUtYmFyXCIsIGZ1bmN0aW9uIChldmVudCkge1xyXG5cdFx0XHRpZiAoRGlhbG9nLmFjdGl2ZURpYWxvZ3MubGVuZ3RoID4gMCAmJiAkKGV2ZW50LnNyY0VsZW1lbnQpLmNsb3Nlc3QoXCIuYy1tb2RhbC1jbG9zZVwiKS5sZW5ndGggPT0gMCkge1xyXG5cdFx0XHRcdHZhciBkaWFsb2cgPSBEaWFsb2cuYWN0aXZlRGlhbG9nc1tEaWFsb2cuYWN0aXZlRGlhbG9ncy5sZW5ndGggLSAxXTtcclxuXHRcdFx0XHQkKGRpYWxvZy5fZGlhbG9nKS5jc3MoXCJvcGFjaXR5XCIsIDAuMDUpO1xyXG5cdFx0XHRcdCQoZG9jdW1lbnQpLm9uKFwibW91c2Vtb3ZlLmNvZ25pdG8uZGlhbG9nXCIsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdCQoZGlhbG9nLl9kaWFsb2cpLmNzcyhcIm9wYWNpdHlcIiwgMSk7XHJcblx0XHRcdFx0XHQkKGRvY3VtZW50KS5vZmYoXCJtb3VzZW1vdmUuY29nbml0by5kaWFsb2dcIik7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHRcdH0pXHJcblxyXG5cdFx0Ly8gSGlkZSB0aGUgZGlhbG9nIHdoZW4gdGhlIHRpdGxlIGJhciBpcyBjbGlja2VkIChzbyB1c2VycyBjYW4gcGVlayB1bmRlciB0aGUgZGlhbG9nKVxyXG5cdFx0Lm9uKFwiY2xpY2tcIiwgXCIuYy1tb2RhbC1vdmVybGF5XCIsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0aWYgKERpYWxvZy5hY3RpdmVEaWFsb2dzLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHR2YXIgZGlhbG9nID0gRGlhbG9nLmFjdGl2ZURpYWxvZ3NbRGlhbG9nLmFjdGl2ZURpYWxvZ3MubGVuZ3RoIC0gMV07XHJcblx0XHRcdFx0ZGlhbG9nLmNsb3NlKHRydWUpO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHJcblx0JC5mbi5kaWFsb2cgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0Ly8gRGV0ZXJtaW5lIGlmIHRoZSBwYWdlIGlzIGhvc3RlZCBpbiBhbiBpZnJhbWUgZGlhbG9nLlxyXG5cdFx0XHR2YXIgZnJhbWUgPSB3aW5kb3cuZnJhbWVFbGVtZW50O1xyXG5cdFx0XHRpZiAoZnJhbWUgJiYgJChmcmFtZS5wYXJlbnRFbGVtZW50KS5pcyhcIi5jLW1vZGFsLWNvbnRlbnQtY29udGFpbmVyXCIpKSB7XHJcblx0XHRcdFx0Ly8gRGV0ZXJtaW5lIGlmIHRoZSBpZnJhbWUncyBwYXJlbnQgd2luZG93IGNvbnRhaW5zIHRoZSBDb2duaXRvIGpRdWVyeSBkaWFsb2cgZnVuY3Rpb24uXHJcblx0XHRcdFx0aWYgKHdpbmRvdy5wYXJlbnQuJCAmJiB3aW5kb3cucGFyZW50LiQuZm4gJiYgd2luZG93LnBhcmVudC4kLmZuLmRpYWxvZykge1xyXG5cclxuXHRcdFx0XHRcdC8vIENvbnZlcnQgY29udGVudCBzZWxlY3RvcnMgaW50byB0ZXh0IGJlZm9yZSBwcm9tb3RpbmcgdG8gcGFyZW50IHdpbmRvd1xyXG5cdFx0XHRcdFx0aWYgKG9wdGlvbnMuY29udGVudFNlbGVjdG9yKSB7XHJcblx0XHRcdFx0XHRcdG9wdGlvbnMudGV4dCA9ICQob3B0aW9ucy5jb250ZW50U2VsZWN0b3IpLmh0bWwoKTtcclxuXHRcdFx0XHRcdFx0b3B0aW9ucy5jb250ZW50U2VsZWN0b3IgPSBudWxsO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdC8vIENhbGwgdGhlIGRpYWxvZyBmdW5jdGlvbiBvbiB0aGUgcGFyZW50IHdpbmRvdyBzbyB0aGF0IGFsbCBkaWFsb2dzIG9wZW4gaW5cclxuXHRcdFx0XHRcdC8vIHRoZSBvdXRlcm1vc3Qgd2luZG93LCBzbyB0aGV5IGRvbid0IGhhdmUgdG8gYmUgbmVzdGVkIHdpdGhpbiBvbmUgYW5vdGhlci5cclxuXHRcdFx0XHRcdHJldHVybiB3aW5kb3cucGFyZW50LiQuZm4uZGlhbG9nKG9wdGlvbnMpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fSBjYXRjaCAoZSkge1xyXG5cdFx0XHQvLyBJZ25vcmUgcG90ZW50aWFsIGNyb3NzLWRvbWFpbiBlcnJvcnMgd2hlbiBhdHRlbXB0aW5nIHRvIGFjY2VzcyB0aGUgZnJhbWUgZWxlbWVudC4uLlxyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBkaWFsb2cgPSBuZXcgRGlhbG9nKG9wdGlvbnMpO1xyXG5cclxuXHRcdC8vIENhbGxlZCBpbiB0aGUgY29udGV4dCBvZiBhIHNlbGVjdG9yXHJcblx0XHRpZiAodGhpcy5sZW5ndGggPiAwKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdHZhciAkdGhpcyA9ICQodGhpcyk7XHJcblx0XHRcdFx0dmFyIGRhdGEgPSAkdGhpcy5kYXRhKFwiY29nbml0by5kaWFsb2dcIik7XHJcblxyXG5cdFx0XHRcdGlmICghZGF0YSkgJHRoaXMuZGF0YShcImNvZ25pdG8uZGlhbG9nXCIsIChkYXRhID0gZGlhbG9nKSk7XHJcblxyXG5cdFx0XHRcdGRhdGEuX2JpbmRUbyh0aGlzKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gQ2FsbGVkIGluIHRoZSBjb250ZXh0IG9mIGFuIGFzc2lnbm1lbnRcclxuXHRcdHZhciB2aWV3cG9ydCA9ICQoKG9wdGlvbnMudmlld3BvcnQgfHwgKG9wdGlvbnMudmlld3BvcnQgPSBkb2N1bWVudC5ib2R5KSkpO1xyXG5cdFx0dmFyIHN0b3JhZ2UgPSB2aWV3cG9ydC5kYXRhKFwiY29nbml0by5kaWFsb2dcIik7XHJcblx0XHRpZiAoIXN0b3JhZ2UpIHZpZXdwb3J0LmRhdGEoXCJjb2duaXRvLmRpYWxvZ1wiLCAoc3RvcmFnZSA9IFtdKSk7XHJcblxyXG5cdFx0dmFyIGRhdGEgPSBkaWFsb2c7XHJcblx0XHRzdG9yYWdlLnB1c2goZGF0YSk7XHJcblxyXG5cdFx0cmV0dXJuIGRhdGE7XHJcblx0fTtcclxuXHJcblx0JC5mbi5kaWFsb2cuY29uc3RydWN0b3IgPSBEaWFsb2c7XHJcbn0pKGpRdWVyeSk7Iiwi77u/LyohXG4gKiBqUXVlcnkgSmF2YVNjcmlwdCBMaWJyYXJ5IHYxLjguM1xuICogaHR0cDovL2pxdWVyeS5jb20vXG4gKlxuICogSW5jbHVkZXMgU2l6emxlLmpzXG4gKiBodHRwOi8vc2l6emxlanMuY29tL1xuICpcbiAqIENvcHlyaWdodCAyMDEyIGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnNcbiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZVxuICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZVxuICpcbiAqIERhdGU6IFR1ZSBOb3YgMTMgMjAxMiAwODoyMDozMyBHTVQtMDUwMCAoRWFzdGVybiBTdGFuZGFyZCBUaW1lKVxuICovXG4oZnVuY3Rpb24obix0KXtmdW5jdGlvbiBoZihuKXt2YXIgdD15dFtuXT17fTtyZXR1cm4gaS5lYWNoKG4uc3BsaXQoaCksZnVuY3Rpb24obixpKXt0W2ldPSEwfSksdH1mdW5jdGlvbiBsaShuLHIsdSl7aWYodT09PXQmJm4ubm9kZVR5cGU9PT0xKXt2YXIgZj1cImRhdGEtXCIrci5yZXBsYWNlKGNpLFwiLSQxXCIpLnRvTG93ZXJDYXNlKCk7aWYodT1uLmdldEF0dHJpYnV0ZShmKSx0eXBlb2YgdT09XCJzdHJpbmdcIil7dHJ5e3U9dT09PVwidHJ1ZVwiPyEwOnU9PT1cImZhbHNlXCI/ITE6dT09PVwibnVsbFwiP251bGw6K3UrXCJcIj09PXU/K3U6aGkudGVzdCh1KT9pLnBhcnNlSlNPTih1KTp1fWNhdGNoKGUpe31pLmRhdGEobixyLHUpfWVsc2UgdT10fXJldHVybiB1fWZ1bmN0aW9uIHB0KG4pe2Zvcih2YXIgdCBpbiBuKWlmKCh0IT09XCJkYXRhXCJ8fCFpLmlzRW1wdHlPYmplY3Qoblt0XSkpJiZ0IT09XCJ0b0pTT05cIilyZXR1cm4hMTtyZXR1cm4hMH1mdW5jdGlvbiB2KCl7cmV0dXJuITF9ZnVuY3Rpb24gaXQoKXtyZXR1cm4hMH1mdW5jdGlvbiBrKG4pe3JldHVybiFufHwhbi5wYXJlbnROb2RlfHxuLnBhcmVudE5vZGUubm9kZVR5cGU9PT0xMX1mdW5jdGlvbiBucihuLHQpe2RvIG49blt0XTt3aGlsZShuJiZuLm5vZGVUeXBlIT09MSk7cmV0dXJuIG59ZnVuY3Rpb24gdHIobix0LHIpe2lmKHQ9dHx8MCxpLmlzRnVuY3Rpb24odCkpcmV0dXJuIGkuZ3JlcChuLGZ1bmN0aW9uKG4saSl7dmFyIHU9ISF0LmNhbGwobixpLG4pO3JldHVybiB1PT09cn0pO2lmKHQubm9kZVR5cGUpcmV0dXJuIGkuZ3JlcChuLGZ1bmN0aW9uKG4pe3JldHVybiBuPT09dD09PXJ9KTtpZih0eXBlb2YgdD09XCJzdHJpbmdcIil7dmFyIHU9aS5ncmVwKG4sZnVuY3Rpb24obil7cmV0dXJuIG4ubm9kZVR5cGU9PT0xfSk7aWYoZGYudGVzdCh0KSlyZXR1cm4gaS5maWx0ZXIodCx1LCFyKTt0PWkuZmlsdGVyKHQsdSl9cmV0dXJuIGkuZ3JlcChuLGZ1bmN0aW9uKG4pe3JldHVybiBpLmluQXJyYXkobix0KT49MD09PXJ9KX1mdW5jdGlvbiBpcihuKXt2YXIgaT1yci5zcGxpdChcInxcIiksdD1uLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtpZih0LmNyZWF0ZUVsZW1lbnQpd2hpbGUoaS5sZW5ndGgpdC5jcmVhdGVFbGVtZW50KGkucG9wKCkpO3JldHVybiB0fWZ1bmN0aW9uIG9lKG4sdCl7cmV0dXJuIG4uZ2V0RWxlbWVudHNCeVRhZ05hbWUodClbMF18fG4uYXBwZW5kQ2hpbGQobi5vd25lckRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodCkpfWZ1bmN0aW9uIGhyKG4sdCl7aWYodC5ub2RlVHlwZT09PTEmJmkuaGFzRGF0YShuKSl7dmFyIHUsZixvLHM9aS5fZGF0YShuKSxyPWkuX2RhdGEodCxzKSxlPXMuZXZlbnRzO2lmKGUpe2RlbGV0ZSByLmhhbmRsZTtyLmV2ZW50cz17fTtmb3IodSBpbiBlKWZvcihmPTAsbz1lW3VdLmxlbmd0aDtmPG87ZisrKWkuZXZlbnQuYWRkKHQsdSxlW3VdW2ZdKX1yLmRhdGEmJihyLmRhdGE9aS5leHRlbmQoe30sci5kYXRhKSl9fWZ1bmN0aW9uIGNyKG4sdCl7dmFyIHI7dC5ub2RlVHlwZT09PTEmJih0LmNsZWFyQXR0cmlidXRlcyYmdC5jbGVhckF0dHJpYnV0ZXMoKSx0Lm1lcmdlQXR0cmlidXRlcyYmdC5tZXJnZUF0dHJpYnV0ZXMobikscj10Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkscj09PVwib2JqZWN0XCI/KHQucGFyZW50Tm9kZSYmKHQub3V0ZXJIVE1MPW4ub3V0ZXJIVE1MKSxpLnN1cHBvcnQuaHRtbDVDbG9uZSYmbi5pbm5lckhUTUwmJiFpLnRyaW0odC5pbm5lckhUTUwpJiYodC5pbm5lckhUTUw9bi5pbm5lckhUTUwpKTpyPT09XCJpbnB1dFwiJiZlci50ZXN0KG4udHlwZSk/KHQuZGVmYXVsdENoZWNrZWQ9dC5jaGVja2VkPW4uY2hlY2tlZCx0LnZhbHVlIT09bi52YWx1ZSYmKHQudmFsdWU9bi52YWx1ZSkpOnI9PT1cIm9wdGlvblwiP3Quc2VsZWN0ZWQ9bi5kZWZhdWx0U2VsZWN0ZWQ6cj09PVwiaW5wdXRcInx8cj09PVwidGV4dGFyZWFcIj90LmRlZmF1bHRWYWx1ZT1uLmRlZmF1bHRWYWx1ZTpyPT09XCJzY3JpcHRcIiYmdC50ZXh0IT09bi50ZXh0JiYodC50ZXh0PW4udGV4dCksdC5yZW1vdmVBdHRyaWJ1dGUoaS5leHBhbmRvKSl9ZnVuY3Rpb24gcnQobil7cmV0dXJuIHR5cGVvZiBuLmdldEVsZW1lbnRzQnlUYWdOYW1lIT1cInVuZGVmaW5lZFwiP24uZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCIqXCIpOnR5cGVvZiBuLnF1ZXJ5U2VsZWN0b3JBbGwhPVwidW5kZWZpbmVkXCI/bi5xdWVyeVNlbGVjdG9yQWxsKFwiKlwiKTpbXX1mdW5jdGlvbiBscihuKXtlci50ZXN0KG4udHlwZSkmJihuLmRlZmF1bHRDaGVja2VkPW4uY2hlY2tlZCl9ZnVuY3Rpb24gcHIobix0KXtpZih0IGluIG4pcmV0dXJuIHQ7Zm9yKHZhciByPXQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkrdC5zbGljZSgxKSx1PXQsaT15ci5sZW5ndGg7aS0tOylpZih0PXlyW2ldK3IsdCBpbiBuKXJldHVybiB0O3JldHVybiB1fWZ1bmN0aW9uIGZ0KG4sdCl7cmV0dXJuIG49dHx8bixpLmNzcyhuLFwiZGlzcGxheVwiKT09PVwibm9uZVwifHwhaS5jb250YWlucyhuLm93bmVyRG9jdW1lbnQsbil9ZnVuY3Rpb24gd3Iobix0KXtmb3IodmFyIHIsbyxlPVtdLGY9MCxzPW4ubGVuZ3RoO2Y8cztmKyspKHI9bltmXSxyLnN0eWxlKSYmKGVbZl09aS5fZGF0YShyLFwib2xkZGlzcGxheVwiKSx0PyhlW2ZdfHxyLnN0eWxlLmRpc3BsYXkhPT1cIm5vbmVcInx8KHIuc3R5bGUuZGlzcGxheT1cIlwiKSxyLnN0eWxlLmRpc3BsYXk9PT1cIlwiJiZmdChyKSYmKGVbZl09aS5fZGF0YShyLFwib2xkZGlzcGxheVwiLGdyKHIubm9kZU5hbWUpKSkpOihvPXUocixcImRpc3BsYXlcIiksZVtmXXx8bz09PVwibm9uZVwifHxpLl9kYXRhKHIsXCJvbGRkaXNwbGF5XCIsbykpKTtmb3IoZj0wO2Y8cztmKyspKHI9bltmXSxyLnN0eWxlKSYmKHQmJnIuc3R5bGUuZGlzcGxheSE9PVwibm9uZVwiJiZyLnN0eWxlLmRpc3BsYXkhPT1cIlwifHwoci5zdHlsZS5kaXNwbGF5PXQ/ZVtmXXx8XCJcIjpcIm5vbmVcIikpO3JldHVybiBufWZ1bmN0aW9uIGJyKG4sdCxpKXt2YXIgcj1sZS5leGVjKHQpO3JldHVybiByP01hdGgubWF4KDAsclsxXS0oaXx8MCkpKyhyWzJdfHxcInB4XCIpOnR9ZnVuY3Rpb24ga3Iobix0LHIsZil7Zm9yKHZhciBlPXI9PT0oZj9cImJvcmRlclwiOlwiY29udGVudFwiKT80OnQ9PT1cIndpZHRoXCI/MTowLG89MDtlPDQ7ZSs9MilyPT09XCJtYXJnaW5cIiYmKG8rPWkuY3NzKG4scitjW2VdLCEwKSksZj8ocj09PVwiY29udGVudFwiJiYoby09cGFyc2VGbG9hdCh1KG4sXCJwYWRkaW5nXCIrY1tlXSkpfHwwKSxyIT09XCJtYXJnaW5cIiYmKG8tPXBhcnNlRmxvYXQodShuLFwiYm9yZGVyXCIrY1tlXStcIldpZHRoXCIpKXx8MCkpOihvKz1wYXJzZUZsb2F0KHUobixcInBhZGRpbmdcIitjW2VdKSl8fDAsciE9PVwicGFkZGluZ1wiJiYobys9cGFyc2VGbG9hdCh1KG4sXCJib3JkZXJcIitjW2VdK1wiV2lkdGhcIikpfHwwKSk7cmV0dXJuIG99ZnVuY3Rpb24gZHIobix0LHIpe3ZhciBmPXQ9PT1cIndpZHRoXCI/bi5vZmZzZXRXaWR0aDpuLm9mZnNldEhlaWdodCxlPSEwLG89aS5zdXBwb3J0LmJveFNpemluZyYmaS5jc3MobixcImJveFNpemluZ1wiKT09PVwiYm9yZGVyLWJveFwiO2lmKGY8PTB8fGY9PW51bGwpe2lmKGY9dShuLHQpLChmPDB8fGY9PW51bGwpJiYoZj1uLnN0eWxlW3RdKSx1dC50ZXN0KGYpKXJldHVybiBmO2U9byYmKGkuc3VwcG9ydC5ib3hTaXppbmdSZWxpYWJsZXx8Zj09PW4uc3R5bGVbdF0pO2Y9cGFyc2VGbG9hdChmKXx8MH1yZXR1cm4gZitrcihuLHQscnx8KG8/XCJib3JkZXJcIjpcImNvbnRlbnRcIiksZSkrXCJweFwifWZ1bmN0aW9uIGdyKG4pe2lmKG5pW25dKXJldHVybiBuaVtuXTt2YXIgZj1pKFwiPFwiK24rXCI+XCIpLmFwcGVuZFRvKHIuYm9keSksdD1mLmNzcyhcImRpc3BsYXlcIik7cmV0dXJuIGYucmVtb3ZlKCksKHQ9PT1cIm5vbmVcInx8dD09PVwiXCIpJiYoeT1yLmJvZHkuYXBwZW5kQ2hpbGQoeXx8aS5leHRlbmQoci5jcmVhdGVFbGVtZW50KFwiaWZyYW1lXCIpLHtmcmFtZUJvcmRlcjowLHdpZHRoOjAsaGVpZ2h0OjB9KSkscCYmeS5jcmVhdGVFbGVtZW50fHwocD0oeS5jb250ZW50V2luZG93fHx5LmNvbnRlbnREb2N1bWVudCkuZG9jdW1lbnQscC53cml0ZShcIjwhZG9jdHlwZSBodG1sPjxodG1sPjxib2R5PlwiKSxwLmNsb3NlKCkpLGY9cC5ib2R5LmFwcGVuZENoaWxkKHAuY3JlYXRlRWxlbWVudChuKSksdD11KGYsXCJkaXNwbGF5XCIpLHIuYm9keS5yZW1vdmVDaGlsZCh5KSksbmlbbl09dCx0fWZ1bmN0aW9uIHRpKG4sdCxyLHUpe3ZhciBmO2lmKGkuaXNBcnJheSh0KSlpLmVhY2godCxmdW5jdGlvbih0LGkpe3J8fHdlLnRlc3Qobik/dShuLGkpOnRpKG4rXCJbXCIrKHR5cGVvZiBpPT1cIm9iamVjdFwiP3Q6XCJcIikrXCJdXCIsaSxyLHUpfSk7ZWxzZSBpZihyfHxpLnR5cGUodCkhPT1cIm9iamVjdFwiKXUobix0KTtlbHNlIGZvcihmIGluIHQpdGkobitcIltcIitmK1wiXVwiLHRbZl0scix1KX1mdW5jdGlvbiBldShuKXtyZXR1cm4gZnVuY3Rpb24odCxyKXt0eXBlb2YgdCE9XCJzdHJpbmdcIiYmKHI9dCx0PVwiKlwiKTt2YXIgdSxvLGYscz10LnRvTG93ZXJDYXNlKCkuc3BsaXQoaCksZT0wLGM9cy5sZW5ndGg7aWYoaS5pc0Z1bmN0aW9uKHIpKWZvcig7ZTxjO2UrKyl1PXNbZV0sZj0vXlxcKy8udGVzdCh1KSxmJiYodT11LnN1YnN0cigxKXx8XCIqXCIpLG89blt1XT1uW3VdfHxbXSxvW2Y/XCJ1bnNoaWZ0XCI6XCJwdXNoXCJdKHIpfX1mdW5jdGlvbiBldChuLGkscix1LGYsZSl7Zj1mfHxpLmRhdGFUeXBlc1swXTtlPWV8fHt9O2VbZl09ITA7Zm9yKHZhciBvLHM9bltmXSxoPTAsbD1zP3MubGVuZ3RoOjAsYz1uPT09aWk7aDxsJiYoY3x8IW8pO2grKylvPXNbaF0oaSxyLHUpLHR5cGVvZiBvPT1cInN0cmluZ1wiJiYoIWN8fGVbb10/bz10OihpLmRhdGFUeXBlcy51bnNoaWZ0KG8pLG89ZXQobixpLHIsdSxvLGUpKSk7cmV0dXJuIWMmJm98fGVbXCIqXCJdfHwobz1ldChuLGkscix1LFwiKlwiLGUpKSxvfWZ1bmN0aW9uIG91KG4scil7dmFyIHUsZixlPWkuYWpheFNldHRpbmdzLmZsYXRPcHRpb25zfHx7fTtmb3IodSBpbiByKXJbdV0hPT10JiYoKGVbdV0/bjpmfHwoZj17fSkpW3VdPXJbdV0pO2YmJmkuZXh0ZW5kKCEwLG4sZil9ZnVuY3Rpb24gdW8obixpLHIpe3ZhciBvLHUsZSxzLGg9bi5jb250ZW50cyxmPW4uZGF0YVR5cGVzLGM9bi5yZXNwb25zZUZpZWxkcztmb3IodSBpbiBjKXUgaW4gciYmKGlbY1t1XV09clt1XSk7d2hpbGUoZlswXT09PVwiKlwiKWYuc2hpZnQoKSxvPT09dCYmKG89bi5taW1lVHlwZXx8aS5nZXRSZXNwb25zZUhlYWRlcihcImNvbnRlbnQtdHlwZVwiKSk7aWYobylmb3IodSBpbiBoKWlmKGhbdV0mJmhbdV0udGVzdChvKSl7Zi51bnNoaWZ0KHUpO2JyZWFrfWlmKGZbMF1pbiByKWU9ZlswXTtlbHNle2Zvcih1IGluIHIpe2lmKCFmWzBdfHxuLmNvbnZlcnRlcnNbdStcIiBcIitmWzBdXSl7ZT11O2JyZWFrfXN8fChzPXUpfWU9ZXx8c31pZihlKXJldHVybiBlIT09ZlswXSYmZi51bnNoaWZ0KGUpLHJbZV19ZnVuY3Rpb24gZm8obix0KXt2YXIgaSxvLHIsZSxzPW4uZGF0YVR5cGVzLnNsaWNlKCksZj1zWzBdLHU9e30saD0wO2lmKG4uZGF0YUZpbHRlciYmKHQ9bi5kYXRhRmlsdGVyKHQsbi5kYXRhVHlwZSkpLHNbMV0pZm9yKGkgaW4gbi5jb252ZXJ0ZXJzKXVbaS50b0xvd2VyQ2FzZSgpXT1uLmNvbnZlcnRlcnNbaV07Zm9yKDtyPXNbKytoXTspaWYociE9PVwiKlwiKXtpZihmIT09XCIqXCImJmYhPT1yKXtpZihpPXVbZitcIiBcIityXXx8dVtcIiogXCIrcl0sIWkpZm9yKG8gaW4gdSlpZihlPW8uc3BsaXQoXCIgXCIpLGVbMV09PT1yJiYoaT11W2YrXCIgXCIrZVswXV18fHVbXCIqIFwiK2VbMF1dLGkpKXtpPT09ITA/aT11W29dOnVbb10hPT0hMCYmKHI9ZVswXSxzLnNwbGljZShoLS0sMCxyKSk7YnJlYWt9aWYoaSE9PSEwKWlmKGkmJm4udGhyb3dzKXQ9aSh0KTtlbHNlIHRyeXt0PWkodCl9Y2F0Y2goYyl7cmV0dXJue3N0YXRlOlwicGFyc2VyZXJyb3JcIixlcnJvcjppP2M6XCJObyBjb252ZXJzaW9uIGZyb20gXCIrZitcIiB0byBcIityfX19Zj1yfXJldHVybntzdGF0ZTpcInN1Y2Nlc3NcIixkYXRhOnR9fWZ1bmN0aW9uIGN1KCl7dHJ5e3JldHVybiBuZXcgbi5YTUxIdHRwUmVxdWVzdH1jYXRjaCh0KXt9fWZ1bmN0aW9uIHNvKCl7dHJ5e3JldHVybiBuZXcgbi5BY3RpdmVYT2JqZWN0KFwiTWljcm9zb2Z0LlhNTEhUVFBcIil9Y2F0Y2godCl7fX1mdW5jdGlvbiBsdSgpe3JldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Yj10fSwwKSxiPWkubm93KCl9ZnVuY3Rpb24gYW8obix0KXtpLmVhY2godCxmdW5jdGlvbih0LGkpe2Zvcih2YXIgdT0oZFt0XXx8W10pLmNvbmNhdChkW1wiKlwiXSkscj0wLGY9dS5sZW5ndGg7cjxmO3IrKylpZih1W3JdLmNhbGwobix0LGkpKXJldHVybn0pfWZ1bmN0aW9uIGF1KG4sdCxyKXt2YXIgZSxvPTAsYz1jdC5sZW5ndGgsZj1pLkRlZmVycmVkKCkuYWx3YXlzKGZ1bmN0aW9uKCl7ZGVsZXRlIGguZWxlbX0pLGg9ZnVuY3Rpb24oKXtmb3IodmFyIG89Ynx8bHUoKSx0PU1hdGgubWF4KDAsdS5zdGFydFRpbWUrdS5kdXJhdGlvbi1vKSxzPXQvdS5kdXJhdGlvbnx8MCxpPTEtcyxyPTAsZT11LnR3ZWVucy5sZW5ndGg7cjxlO3IrKyl1LnR3ZWVuc1tyXS5ydW4oaSk7cmV0dXJuIGYubm90aWZ5V2l0aChuLFt1LGksdF0pLGk8MSYmZT90OihmLnJlc29sdmVXaXRoKG4sW3VdKSwhMSl9LHU9Zi5wcm9taXNlKHtlbGVtOm4scHJvcHM6aS5leHRlbmQoe30sdCksb3B0czppLmV4dGVuZCghMCx7c3BlY2lhbEVhc2luZzp7fX0sciksb3JpZ2luYWxQcm9wZXJ0aWVzOnQsb3JpZ2luYWxPcHRpb25zOnIsc3RhcnRUaW1lOmJ8fGx1KCksZHVyYXRpb246ci5kdXJhdGlvbix0d2VlbnM6W10sY3JlYXRlVHdlZW46ZnVuY3Rpb24odCxyKXt2YXIgZj1pLlR3ZWVuKG4sdS5vcHRzLHQscix1Lm9wdHMuc3BlY2lhbEVhc2luZ1t0XXx8dS5vcHRzLmVhc2luZyk7cmV0dXJuIHUudHdlZW5zLnB1c2goZiksZn0sc3RvcDpmdW5jdGlvbih0KXtmb3IodmFyIGk9MCxyPXQ/dS50d2VlbnMubGVuZ3RoOjA7aTxyO2krKyl1LnR3ZWVuc1tpXS5ydW4oMSk7cmV0dXJuIHQ/Zi5yZXNvbHZlV2l0aChuLFt1LHRdKTpmLnJlamVjdFdpdGgobixbdSx0XSksdGhpc319KSxzPXUucHJvcHM7Zm9yKHZvKHMsdS5vcHRzLnNwZWNpYWxFYXNpbmcpO288YztvKyspaWYoZT1jdFtvXS5jYWxsKHUsbixzLHUub3B0cyksZSlyZXR1cm4gZTtyZXR1cm4gYW8odSxzKSxpLmlzRnVuY3Rpb24odS5vcHRzLnN0YXJ0KSYmdS5vcHRzLnN0YXJ0LmNhbGwobix1KSxpLmZ4LnRpbWVyKGkuZXh0ZW5kKGgse2FuaW06dSxxdWV1ZTp1Lm9wdHMucXVldWUsZWxlbTpufSkpLHUucHJvZ3Jlc3ModS5vcHRzLnByb2dyZXNzKS5kb25lKHUub3B0cy5kb25lLHUub3B0cy5jb21wbGV0ZSkuZmFpbCh1Lm9wdHMuZmFpbCkuYWx3YXlzKHUub3B0cy5hbHdheXMpfWZ1bmN0aW9uIHZvKG4sdCl7dmFyIHIsZixlLHUsbztmb3IociBpbiBuKWlmKGY9aS5jYW1lbENhc2UociksZT10W2ZdLHU9bltyXSxpLmlzQXJyYXkodSkmJihlPXVbMV0sdT1uW3JdPXVbMF0pLHIhPT1mJiYobltmXT11LGRlbGV0ZSBuW3JdKSxvPWkuY3NzSG9va3NbZl0sbyYmXCJleHBhbmRcImluIG8pe3U9by5leHBhbmQodSk7ZGVsZXRlIG5bZl07Zm9yKHIgaW4gdSlyIGluIG58fChuW3JdPXVbcl0sdFtyXT1lKX1lbHNlIHRbZl09ZX1mdW5jdGlvbiB5byhuLHQscil7dmFyIG8sdSxhLHYscyx5LGwsZixiLGg9dGhpcyxlPW4uc3R5bGUscD17fSx3PVtdLGM9bi5ub2RlVHlwZSYmZnQobik7ci5xdWV1ZXx8KGY9aS5fcXVldWVIb29rcyhuLFwiZnhcIiksZi51bnF1ZXVlZD09bnVsbCYmKGYudW5xdWV1ZWQ9MCxiPWYuZW1wdHkuZmlyZSxmLmVtcHR5LmZpcmU9ZnVuY3Rpb24oKXtmLnVucXVldWVkfHxiKCl9KSxmLnVucXVldWVkKyssaC5hbHdheXMoZnVuY3Rpb24oKXtoLmFsd2F5cyhmdW5jdGlvbigpe2YudW5xdWV1ZWQtLTtpLnF1ZXVlKG4sXCJmeFwiKS5sZW5ndGh8fGYuZW1wdHkuZmlyZSgpfSl9KSk7bi5ub2RlVHlwZT09PTEmJihcImhlaWdodFwiaW4gdHx8XCJ3aWR0aFwiaW4gdCkmJihyLm92ZXJmbG93PVtlLm92ZXJmbG93LGUub3ZlcmZsb3dYLGUub3ZlcmZsb3dZXSxpLmNzcyhuLFwiZGlzcGxheVwiKT09PVwiaW5saW5lXCImJmkuY3NzKG4sXCJmbG9hdFwiKT09PVwibm9uZVwiJiYoaS5zdXBwb3J0LmlubGluZUJsb2NrTmVlZHNMYXlvdXQmJmdyKG4ubm9kZU5hbWUpIT09XCJpbmxpbmVcIj9lLnpvb209MTplLmRpc3BsYXk9XCJpbmxpbmUtYmxvY2tcIikpO3Iub3ZlcmZsb3cmJihlLm92ZXJmbG93PVwiaGlkZGVuXCIsaS5zdXBwb3J0LnNocmlua1dyYXBCbG9ja3N8fGguZG9uZShmdW5jdGlvbigpe2Uub3ZlcmZsb3c9ci5vdmVyZmxvd1swXTtlLm92ZXJmbG93WD1yLm92ZXJmbG93WzFdO2Uub3ZlcmZsb3dZPXIub3ZlcmZsb3dbMl19KSk7Zm9yKG8gaW4gdClpZihhPXRbb10saG8uZXhlYyhhKSl7aWYoZGVsZXRlIHRbb10seT15fHxhPT09XCJ0b2dnbGVcIixhPT09KGM/XCJoaWRlXCI6XCJzaG93XCIpKWNvbnRpbnVlO3cucHVzaChvKX1pZih2PXcubGVuZ3RoLHYpZm9yKHM9aS5fZGF0YShuLFwiZnhzaG93XCIpfHxpLl9kYXRhKG4sXCJmeHNob3dcIix7fSksKFwiaGlkZGVuXCJpbiBzKSYmKGM9cy5oaWRkZW4pLHkmJihzLmhpZGRlbj0hYyksYz9pKG4pLnNob3coKTpoLmRvbmUoZnVuY3Rpb24oKXtpKG4pLmhpZGUoKX0pLGguZG9uZShmdW5jdGlvbigpe3ZhciB0O2kucmVtb3ZlRGF0YShuLFwiZnhzaG93XCIsITApO2Zvcih0IGluIHApaS5zdHlsZShuLHQscFt0XSl9KSxvPTA7bzx2O28rKyl1PXdbb10sbD1oLmNyZWF0ZVR3ZWVuKHUsYz9zW3VdOjApLHBbdV09c1t1XXx8aS5zdHlsZShuLHUpLHUgaW4gc3x8KHNbdV09bC5zdGFydCxjJiYobC5lbmQ9bC5zdGFydCxsLnN0YXJ0PXU9PT1cIndpZHRoXCJ8fHU9PT1cImhlaWdodFwiPzE6MCkpfWZ1bmN0aW9uIGYobix0LGkscix1KXtyZXR1cm4gbmV3IGYucHJvdG90eXBlLmluaXQobix0LGkscix1KX1mdW5jdGlvbiBsdChuLHQpe3ZhciByLGk9e2hlaWdodDpufSx1PTA7Zm9yKHQ9dD8xOjA7dTw0O3UrPTItdClyPWNbdV0saVtcIm1hcmdpblwiK3JdPWlbXCJwYWRkaW5nXCIrcl09bjtyZXR1cm4gdCYmKGkub3BhY2l0eT1pLndpZHRoPW4pLGl9ZnVuY3Rpb24gdnUobil7cmV0dXJuIGkuaXNXaW5kb3cobik/bjpuLm5vZGVUeXBlPT09OT9uLmRlZmF1bHRWaWV3fHxuLnBhcmVudFdpbmRvdzohMX12YXIgdWksZyxyPW4uZG9jdW1lbnQseXU9bi5sb2NhdGlvbixwdT1uLm5hdmlnYXRvcix3dT1uLmpRdWVyeSxidT1uLiQsZmk9QXJyYXkucHJvdG90eXBlLnB1c2gsbz1BcnJheS5wcm90b3R5cGUuc2xpY2UsZWk9QXJyYXkucHJvdG90eXBlLmluZGV4T2Ysa3U9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZyxhdD1PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LHZ0PVN0cmluZy5wcm90b3R5cGUudHJpbSxpPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIG5ldyBpLmZuLmluaXQobix0LHVpKX0sbnQ9L1tcXC0rXT8oPzpcXGQqXFwufClcXGQrKD86W2VFXVtcXC0rXT9cXGQrfCkvLnNvdXJjZSxkdT0vXFxTLyxoPS9cXHMrLyxndT0vXltcXHNcXHVGRUZGXFx4QTBdK3xbXFxzXFx1RkVGRlxceEEwXSskL2csbmY9L14oPzpbXiM8XSooPFtcXHdcXFddKz4pW14+XSokfCMoW1xcd1xcLV0qKSQpLyxvaT0vXjwoXFx3KylcXHMqXFwvPz4oPzo8XFwvXFwxPnwpJC8sdGY9L15bXFxdLDp7fVxcc10qJC8scmY9Lyg/Ol58OnwsKSg/OlxccypcXFspKy9nLHVmPS9cXFxcKD86W1wiXFxcXFxcL2JmbnJ0XXx1W1xcZGEtZkEtRl17NH0pL2csZmY9L1wiW15cIlxcXFxcXHJcXG5dKlwifHRydWV8ZmFsc2V8bnVsbHwtPyg/OlxcZFxcZCpcXC58KVxcZCsoPzpbZUVdW1xcLStdP1xcZCt8KS9nLGVmPS9eLW1zLS8sb2Y9Ly0oW1xcZGEtel0pL2dpLHNmPWZ1bmN0aW9uKG4sdCl7cmV0dXJuKHQrXCJcIikudG9VcHBlckNhc2UoKX0sdHQ9ZnVuY3Rpb24oKXtyLmFkZEV2ZW50TGlzdGVuZXI/KHIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIix0dCwhMSksaS5yZWFkeSgpKTpyLnJlYWR5U3RhdGU9PT1cImNvbXBsZXRlXCImJihyLmRldGFjaEV2ZW50KFwib25yZWFkeXN0YXRlY2hhbmdlXCIsdHQpLGkucmVhZHkoKSl9LHNpPXt9LHl0LGhpLGNpLHcsc3QsaHUscmk7aS5mbj1pLnByb3RvdHlwZT17Y29uc3RydWN0b3I6aSxpbml0OmZ1bmN0aW9uKG4sdSxmKXt2YXIgZSxvLHM7aWYoIW4pcmV0dXJuIHRoaXM7aWYobi5ub2RlVHlwZSlyZXR1cm4gdGhpcy5jb250ZXh0PXRoaXNbMF09bix0aGlzLmxlbmd0aD0xLHRoaXM7aWYodHlwZW9mIG49PVwic3RyaW5nXCIpe2lmKGU9bi5jaGFyQXQoMCk9PT1cIjxcIiYmbi5jaGFyQXQobi5sZW5ndGgtMSk9PT1cIj5cIiYmbi5sZW5ndGg+PTM/W251bGwsbixudWxsXTpuZi5leGVjKG4pLGUmJihlWzFdfHwhdSkpe2lmKGVbMV0pcmV0dXJuIHU9dSBpbnN0YW5jZW9mIGk/dVswXTp1LHM9dSYmdS5ub2RlVHlwZT91Lm93bmVyRG9jdW1lbnR8fHU6cixuPWkucGFyc2VIVE1MKGVbMV0scywhMCksb2kudGVzdChlWzFdKSYmaS5pc1BsYWluT2JqZWN0KHUpJiZ0aGlzLmF0dHIuY2FsbChuLHUsITApLGkubWVyZ2UodGhpcyxuKTtpZihvPXIuZ2V0RWxlbWVudEJ5SWQoZVsyXSksbyYmby5wYXJlbnROb2RlKXtpZihvLmlkIT09ZVsyXSlyZXR1cm4gZi5maW5kKG4pO3RoaXMubGVuZ3RoPTE7dGhpc1swXT1vfXJldHVybiB0aGlzLmNvbnRleHQ9cix0aGlzLnNlbGVjdG9yPW4sdGhpc31yZXR1cm4hdXx8dS5qcXVlcnk/KHV8fGYpLmZpbmQobik6dGhpcy5jb25zdHJ1Y3Rvcih1KS5maW5kKG4pfXJldHVybiBpLmlzRnVuY3Rpb24obik/Zi5yZWFkeShuKToobi5zZWxlY3RvciE9PXQmJih0aGlzLnNlbGVjdG9yPW4uc2VsZWN0b3IsdGhpcy5jb250ZXh0PW4uY29udGV4dCksaS5tYWtlQXJyYXkobix0aGlzKSl9LHNlbGVjdG9yOlwiXCIsanF1ZXJ5OlwiMS44LjNcIixsZW5ndGg6MCxzaXplOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubGVuZ3RofSx0b0FycmF5OmZ1bmN0aW9uKCl7cmV0dXJuIG8uY2FsbCh0aGlzKX0sZ2V0OmZ1bmN0aW9uKG4pe3JldHVybiBuPT1udWxsP3RoaXMudG9BcnJheSgpOm48MD90aGlzW3RoaXMubGVuZ3RoK25dOnRoaXNbbl19LHB1c2hTdGFjazpmdW5jdGlvbihuLHQscil7dmFyIHU9aS5tZXJnZSh0aGlzLmNvbnN0cnVjdG9yKCksbik7cmV0dXJuIHUucHJldk9iamVjdD10aGlzLHUuY29udGV4dD10aGlzLmNvbnRleHQsdD09PVwiZmluZFwiP3Uuc2VsZWN0b3I9dGhpcy5zZWxlY3RvcisodGhpcy5zZWxlY3Rvcj9cIiBcIjpcIlwiKStyOnQmJih1LnNlbGVjdG9yPXRoaXMuc2VsZWN0b3IrXCIuXCIrdCtcIihcIityK1wiKVwiKSx1fSxlYWNoOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIGkuZWFjaCh0aGlzLG4sdCl9LHJlYWR5OmZ1bmN0aW9uKG4pe3JldHVybiBpLnJlYWR5LnByb21pc2UoKS5kb25lKG4pLHRoaXN9LGVxOmZ1bmN0aW9uKG4pe3JldHVybiBuPStuLG49PT0tMT90aGlzLnNsaWNlKG4pOnRoaXMuc2xpY2UobixuKzEpfSxmaXJzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVxKDApfSxsYXN0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZXEoLTEpfSxzbGljZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLnB1c2hTdGFjayhvLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxcInNsaWNlXCIsby5jYWxsKGFyZ3VtZW50cykuam9pbihcIixcIikpfSxtYXA6ZnVuY3Rpb24obil7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGkubWFwKHRoaXMsZnVuY3Rpb24odCxpKXtyZXR1cm4gbi5jYWxsKHQsaSx0KX0pKX0sZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucHJldk9iamVjdHx8dGhpcy5jb25zdHJ1Y3RvcihudWxsKX0scHVzaDpmaSxzb3J0OltdLnNvcnQsc3BsaWNlOltdLnNwbGljZX07aS5mbi5pbml0LnByb3RvdHlwZT1pLmZuO2kuZXh0ZW5kPWkuZm4uZXh0ZW5kPWZ1bmN0aW9uKCl7dmFyIG8sZSx1LHIscyxoLG49YXJndW1lbnRzWzBdfHx7fSxmPTEsbD1hcmd1bWVudHMubGVuZ3RoLGM9ITE7Zm9yKHR5cGVvZiBuPT1cImJvb2xlYW5cIiYmKGM9bixuPWFyZ3VtZW50c1sxXXx8e30sZj0yKSx0eXBlb2Ygbj09XCJvYmplY3RcInx8aS5pc0Z1bmN0aW9uKG4pfHwobj17fSksbD09PWYmJihuPXRoaXMsLS1mKTtmPGw7ZisrKWlmKChvPWFyZ3VtZW50c1tmXSkhPW51bGwpZm9yKGUgaW4gbykodT1uW2VdLHI9b1tlXSxuIT09cikmJihjJiZyJiYoaS5pc1BsYWluT2JqZWN0KHIpfHwocz1pLmlzQXJyYXkocikpKT8ocz8ocz0hMSxoPXUmJmkuaXNBcnJheSh1KT91OltdKTpoPXUmJmkuaXNQbGFpbk9iamVjdCh1KT91Ont9LG5bZV09aS5leHRlbmQoYyxoLHIpKTpyIT09dCYmKG5bZV09cikpO3JldHVybiBufTtpLmV4dGVuZCh7bm9Db25mbGljdDpmdW5jdGlvbih0KXtyZXR1cm4gbi4kPT09aSYmKG4uJD1idSksdCYmbi5qUXVlcnk9PT1pJiYobi5qUXVlcnk9d3UpLGl9LGlzUmVhZHk6ITEscmVhZHlXYWl0OjEsaG9sZFJlYWR5OmZ1bmN0aW9uKG4pe24/aS5yZWFkeVdhaXQrKzppLnJlYWR5KCEwKX0scmVhZHk6ZnVuY3Rpb24obil7aWYobj09PSEwPyEtLWkucmVhZHlXYWl0OiFpLmlzUmVhZHkpe2lmKCFyLmJvZHkpcmV0dXJuIHNldFRpbWVvdXQoaS5yZWFkeSwxKTsoaS5pc1JlYWR5PSEwLG4hPT0hMCYmLS1pLnJlYWR5V2FpdD4wKXx8KGcucmVzb2x2ZVdpdGgocixbaV0pLGkuZm4udHJpZ2dlciYmaShyKS50cmlnZ2VyKFwicmVhZHlcIikub2ZmKFwicmVhZHlcIikpfX0saXNGdW5jdGlvbjpmdW5jdGlvbihuKXtyZXR1cm4gaS50eXBlKG4pPT09XCJmdW5jdGlvblwifSxpc0FycmF5OkFycmF5LmlzQXJyYXl8fGZ1bmN0aW9uKG4pe3JldHVybiBpLnR5cGUobik9PT1cImFycmF5XCJ9LGlzV2luZG93OmZ1bmN0aW9uKG4pe3JldHVybiBuIT1udWxsJiZuPT1uLndpbmRvd30saXNOdW1lcmljOmZ1bmN0aW9uKG4pe3JldHVybiFpc05hTihwYXJzZUZsb2F0KG4pKSYmaXNGaW5pdGUobil9LHR5cGU6ZnVuY3Rpb24obil7cmV0dXJuIG49PW51bGw/U3RyaW5nKG4pOnNpW2t1LmNhbGwobildfHxcIm9iamVjdFwifSxpc1BsYWluT2JqZWN0OmZ1bmN0aW9uKG4pe2lmKCFufHxpLnR5cGUobikhPT1cIm9iamVjdFwifHxuLm5vZGVUeXBlfHxpLmlzV2luZG93KG4pKXJldHVybiExO3RyeXtpZihuLmNvbnN0cnVjdG9yJiYhYXQuY2FsbChuLFwiY29uc3RydWN0b3JcIikmJiFhdC5jYWxsKG4uY29uc3RydWN0b3IucHJvdG90eXBlLFwiaXNQcm90b3R5cGVPZlwiKSlyZXR1cm4hMX1jYXRjaCh1KXtyZXR1cm4hMX1mb3IodmFyIHIgaW4gbik7cmV0dXJuIHI9PT10fHxhdC5jYWxsKG4scil9LGlzRW1wdHlPYmplY3Q6ZnVuY3Rpb24obil7Zm9yKHZhciB0IGluIG4pcmV0dXJuITE7cmV0dXJuITB9LGVycm9yOmZ1bmN0aW9uKG4pe3Rocm93IG5ldyBFcnJvcihuKTt9LHBhcnNlSFRNTDpmdW5jdGlvbihuLHQsdSl7dmFyIGY7cmV0dXJuIW58fHR5cGVvZiBuIT1cInN0cmluZ1wiP251bGw6KHR5cGVvZiB0PT1cImJvb2xlYW5cIiYmKHU9dCx0PTApLHQ9dHx8cixmPW9pLmV4ZWMobikpP1t0LmNyZWF0ZUVsZW1lbnQoZlsxXSldOihmPWkuYnVpbGRGcmFnbWVudChbbl0sdCx1P251bGw6W10pLGkubWVyZ2UoW10sKGYuY2FjaGVhYmxlP2kuY2xvbmUoZi5mcmFnbWVudCk6Zi5mcmFnbWVudCkuY2hpbGROb2RlcykpfSxwYXJzZUpTT046ZnVuY3Rpb24odCl7aWYoIXR8fHR5cGVvZiB0IT1cInN0cmluZ1wiKXJldHVybiBudWxsO2lmKHQ9aS50cmltKHQpLG4uSlNPTiYmbi5KU09OLnBhcnNlKXJldHVybiBuLkpTT04ucGFyc2UodCk7aWYodGYudGVzdCh0LnJlcGxhY2UodWYsXCJAXCIpLnJlcGxhY2UoZmYsXCJdXCIpLnJlcGxhY2UocmYsXCJcIikpKXJldHVybiBuZXcgRnVuY3Rpb24oXCJyZXR1cm4gXCIrdCkoKTtpLmVycm9yKFwiSW52YWxpZCBKU09OOiBcIit0KX0scGFyc2VYTUw6ZnVuY3Rpb24ocil7dmFyIHUsZjtpZighcnx8dHlwZW9mIHIhPVwic3RyaW5nXCIpcmV0dXJuIG51bGw7dHJ5e24uRE9NUGFyc2VyPyhmPW5ldyBET01QYXJzZXIsdT1mLnBhcnNlRnJvbVN0cmluZyhyLFwidGV4dC94bWxcIikpOih1PW5ldyBBY3RpdmVYT2JqZWN0KFwiTWljcm9zb2Z0LlhNTERPTVwiKSx1LmFzeW5jPVwiZmFsc2VcIix1LmxvYWRYTUwocikpfWNhdGNoKGUpe3U9dH1yZXR1cm4gdSYmdS5kb2N1bWVudEVsZW1lbnQmJiF1LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwicGFyc2VyZXJyb3JcIikubGVuZ3RofHxpLmVycm9yKFwiSW52YWxpZCBYTUw6IFwiK3IpLHV9LG5vb3A6ZnVuY3Rpb24oKXt9LGdsb2JhbEV2YWw6ZnVuY3Rpb24odCl7dCYmZHUudGVzdCh0KSYmKG4uZXhlY1NjcmlwdHx8ZnVuY3Rpb24odCl7bi5ldmFsLmNhbGwobix0KX0pKHQpfSxjYW1lbENhc2U6ZnVuY3Rpb24obil7cmV0dXJuIG4ucmVwbGFjZShlZixcIm1zLVwiKS5yZXBsYWNlKG9mLHNmKX0sbm9kZU5hbWU6ZnVuY3Rpb24obix0KXtyZXR1cm4gbi5ub2RlTmFtZSYmbi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09dC50b0xvd2VyQ2FzZSgpfSxlYWNoOmZ1bmN0aW9uKG4scix1KXt2YXIgZixlPTAsbz1uLmxlbmd0aCxzPW89PT10fHxpLmlzRnVuY3Rpb24obik7aWYodSl7aWYocyl7Zm9yKGYgaW4gbilpZihyLmFwcGx5KG5bZl0sdSk9PT0hMSlicmVha31lbHNlIGZvcig7ZTxvOylpZihyLmFwcGx5KG5bZSsrXSx1KT09PSExKWJyZWFrfWVsc2UgaWYocyl7Zm9yKGYgaW4gbilpZihyLmNhbGwobltmXSxmLG5bZl0pPT09ITEpYnJlYWt9ZWxzZSBmb3IoO2U8bzspaWYoci5jYWxsKG5bZV0sZSxuW2UrK10pPT09ITEpYnJlYWs7cmV0dXJuIG59LHRyaW06dnQmJiF2dC5jYWxsKFwi77u/wqBcIik/ZnVuY3Rpb24obil7cmV0dXJuIG49PW51bGw/XCJcIjp2dC5jYWxsKG4pfTpmdW5jdGlvbihuKXtyZXR1cm4gbj09bnVsbD9cIlwiOihuK1wiXCIpLnJlcGxhY2UoZ3UsXCJcIil9LG1ha2VBcnJheTpmdW5jdGlvbihuLHQpe3ZhciByLHU9dHx8W107cmV0dXJuIG4hPW51bGwmJihyPWkudHlwZShuKSxuLmxlbmd0aD09bnVsbHx8cj09PVwic3RyaW5nXCJ8fHI9PT1cImZ1bmN0aW9uXCJ8fHI9PT1cInJlZ2V4cFwifHxpLmlzV2luZG93KG4pP2ZpLmNhbGwodSxuKTppLm1lcmdlKHUsbikpLHV9LGluQXJyYXk6ZnVuY3Rpb24obix0LGkpe3ZhciByO2lmKHQpe2lmKGVpKXJldHVybiBlaS5jYWxsKHQsbixpKTtmb3Iocj10Lmxlbmd0aCxpPWk/aTwwP01hdGgubWF4KDAscitpKTppOjA7aTxyO2krKylpZihpIGluIHQmJnRbaV09PT1uKXJldHVybiBpfXJldHVybi0xfSxtZXJnZTpmdW5jdGlvbihuLGkpe3ZhciBmPWkubGVuZ3RoLHU9bi5sZW5ndGgscj0wO2lmKHR5cGVvZiBmPT1cIm51bWJlclwiKWZvcig7cjxmO3IrKyluW3UrK109aVtyXTtlbHNlIHdoaWxlKGlbcl0hPT10KW5bdSsrXT1pW3IrK107cmV0dXJuIG4ubGVuZ3RoPXUsbn0sZ3JlcDpmdW5jdGlvbihuLHQsaSl7dmFyIHUsZj1bXSxyPTAsZT1uLmxlbmd0aDtmb3IoaT0hIWk7cjxlO3IrKyl1PSEhdChuW3JdLHIpLGkhPT11JiZmLnB1c2gobltyXSk7cmV0dXJuIGZ9LG1hcDpmdW5jdGlvbihuLHIsdSl7dmFyIGYsaCxlPVtdLHM9MCxvPW4ubGVuZ3RoLGM9biBpbnN0YW5jZW9mIGl8fG8hPT10JiZ0eXBlb2Ygbz09XCJudW1iZXJcIiYmKG8+MCYmblswXSYmbltvLTFdfHxvPT09MHx8aS5pc0FycmF5KG4pKTtpZihjKWZvcig7czxvO3MrKylmPXIobltzXSxzLHUpLGYhPW51bGwmJihlW2UubGVuZ3RoXT1mKTtlbHNlIGZvcihoIGluIG4pZj1yKG5baF0saCx1KSxmIT1udWxsJiYoZVtlLmxlbmd0aF09Zik7cmV0dXJuIGUuY29uY2F0LmFwcGx5KFtdLGUpfSxndWlkOjEscHJveHk6ZnVuY3Rpb24obixyKXt2YXIgZixlLHU7cmV0dXJuKHR5cGVvZiByPT1cInN0cmluZ1wiJiYoZj1uW3JdLHI9bixuPWYpLCFpLmlzRnVuY3Rpb24obikpP3Q6KGU9by5jYWxsKGFyZ3VtZW50cywyKSx1PWZ1bmN0aW9uKCl7cmV0dXJuIG4uYXBwbHkocixlLmNvbmNhdChvLmNhbGwoYXJndW1lbnRzKSkpfSx1Lmd1aWQ9bi5ndWlkPW4uZ3VpZHx8aS5ndWlkKyssdSl9LGFjY2VzczpmdW5jdGlvbihuLHIsdSxmLGUsbyxzKXt2YXIgYyxsPXU9PW51bGwsaD0wLGE9bi5sZW5ndGg7aWYodSYmdHlwZW9mIHU9PVwib2JqZWN0XCIpe2ZvcihoIGluIHUpaS5hY2Nlc3MobixyLGgsdVtoXSwxLG8sZik7ZT0xfWVsc2UgaWYoZiE9PXQpe2lmKGM9cz09PXQmJmkuaXNGdW5jdGlvbihmKSxsJiYoYz8oYz1yLHI9ZnVuY3Rpb24obix0LHIpe3JldHVybiBjLmNhbGwoaShuKSxyKX0pOihyLmNhbGwobixmKSxyPW51bGwpKSxyKWZvcig7aDxhO2grKylyKG5baF0sdSxjP2YuY2FsbChuW2hdLGgscihuW2hdLHUpKTpmLHMpO2U9MX1yZXR1cm4gZT9uOmw/ci5jYWxsKG4pOmE/cihuWzBdLHUpOm99LG5vdzpmdW5jdGlvbigpe3JldHVybihuZXcgRGF0ZSkuZ2V0VGltZSgpfX0pO2kucmVhZHkucHJvbWlzZT1mdW5jdGlvbih0KXtpZighZylpZihnPWkuRGVmZXJyZWQoKSxyLnJlYWR5U3RhdGU9PT1cImNvbXBsZXRlXCIpc2V0VGltZW91dChpLnJlYWR5LDEpO2Vsc2UgaWYoci5hZGRFdmVudExpc3RlbmVyKXIuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIix0dCwhMSksbi5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLGkucmVhZHksITEpO2Vsc2V7ci5hdHRhY2hFdmVudChcIm9ucmVhZHlzdGF0ZWNoYW5nZVwiLHR0KTtuLmF0dGFjaEV2ZW50KFwib25sb2FkXCIsaS5yZWFkeSk7dmFyIHU9ITE7dHJ5e3U9bi5mcmFtZUVsZW1lbnQ9PW51bGwmJnIuZG9jdW1lbnRFbGVtZW50fWNhdGNoKGUpe311JiZ1LmRvU2Nyb2xsJiZmdW5jdGlvbiBmKCl7aWYoIWkuaXNSZWFkeSl7dHJ5e3UuZG9TY3JvbGwoXCJsZWZ0XCIpfWNhdGNoKG4pe3JldHVybiBzZXRUaW1lb3V0KGYsNTApfWkucmVhZHkoKX19KCl9cmV0dXJuIGcucHJvbWlzZSh0KX07aS5lYWNoKFwiQm9vbGVhbiBOdW1iZXIgU3RyaW5nIEZ1bmN0aW9uIEFycmF5IERhdGUgUmVnRXhwIE9iamVjdFwiLnNwbGl0KFwiIFwiKSxmdW5jdGlvbihuLHQpe3NpW1wiW29iamVjdCBcIit0K1wiXVwiXT10LnRvTG93ZXJDYXNlKCl9KTt1aT1pKHIpO3l0PXt9O2kuQ2FsbGJhY2tzPWZ1bmN0aW9uKG4pe249dHlwZW9mIG49PVwic3RyaW5nXCI/eXRbbl18fGhmKG4pOmkuZXh0ZW5kKHt9LG4pO3ZhciBmLGMsbyxsLHMsZSxyPVtdLHU9IW4ub25jZSYmW10sYT1mdW5jdGlvbih0KXtmb3IoZj1uLm1lbW9yeSYmdCxjPSEwLGU9bHx8MCxsPTAscz1yLmxlbmd0aCxvPSEwO3ImJmU8cztlKyspaWYocltlXS5hcHBseSh0WzBdLHRbMV0pPT09ITEmJm4uc3RvcE9uRmFsc2Upe2Y9ITE7YnJlYWt9bz0hMTtyJiYodT91Lmxlbmd0aCYmYSh1LnNoaWZ0KCkpOmY/cj1bXTpoLmRpc2FibGUoKSl9LGg9e2FkZDpmdW5jdGlvbigpe2lmKHIpe3ZhciB0PXIubGVuZ3RoOyhmdW5jdGlvbiB1KHQpe2kuZWFjaCh0LGZ1bmN0aW9uKHQsZil7dmFyIGU9aS50eXBlKGYpO2U9PT1cImZ1bmN0aW9uXCI/bi51bmlxdWUmJmguaGFzKGYpfHxyLnB1c2goZik6ZiYmZi5sZW5ndGgmJmUhPT1cInN0cmluZ1wiJiZ1KGYpfSl9KShhcmd1bWVudHMpO28/cz1yLmxlbmd0aDpmJiYobD10LGEoZikpfXJldHVybiB0aGlzfSxyZW1vdmU6ZnVuY3Rpb24oKXtyZXR1cm4gciYmaS5lYWNoKGFyZ3VtZW50cyxmdW5jdGlvbihuLHQpe2Zvcih2YXIgdTsodT1pLmluQXJyYXkodCxyLHUpKT4tMTspci5zcGxpY2UodSwxKSxvJiYodTw9cyYmcy0tLHU8PWUmJmUtLSl9KSx0aGlzfSxoYXM6ZnVuY3Rpb24obil7cmV0dXJuIGkuaW5BcnJheShuLHIpPi0xfSxlbXB0eTpmdW5jdGlvbigpe3JldHVybiByPVtdLHRoaXN9LGRpc2FibGU6ZnVuY3Rpb24oKXtyZXR1cm4gcj11PWY9dCx0aGlzfSxkaXNhYmxlZDpmdW5jdGlvbigpe3JldHVybiFyfSxsb2NrOmZ1bmN0aW9uKCl7cmV0dXJuIHU9dCxmfHxoLmRpc2FibGUoKSx0aGlzfSxsb2NrZWQ6ZnVuY3Rpb24oKXtyZXR1cm4hdX0sZmlyZVdpdGg6ZnVuY3Rpb24obix0KXtyZXR1cm4gdD10fHxbXSx0PVtuLHQuc2xpY2U/dC5zbGljZSgpOnRdLHImJighY3x8dSkmJihvP3UucHVzaCh0KTphKHQpKSx0aGlzfSxmaXJlOmZ1bmN0aW9uKCl7cmV0dXJuIGguZmlyZVdpdGgodGhpcyxhcmd1bWVudHMpLHRoaXN9LGZpcmVkOmZ1bmN0aW9uKCl7cmV0dXJuISFjfX07cmV0dXJuIGh9O2kuZXh0ZW5kKHtEZWZlcnJlZDpmdW5jdGlvbihuKXt2YXIgdT1bW1wicmVzb2x2ZVwiLFwiZG9uZVwiLGkuQ2FsbGJhY2tzKFwib25jZSBtZW1vcnlcIiksXCJyZXNvbHZlZFwiXSxbXCJyZWplY3RcIixcImZhaWxcIixpLkNhbGxiYWNrcyhcIm9uY2UgbWVtb3J5XCIpLFwicmVqZWN0ZWRcIl0sW1wibm90aWZ5XCIsXCJwcm9ncmVzc1wiLGkuQ2FsbGJhY2tzKFwibWVtb3J5XCIpXV0sZj1cInBlbmRpbmdcIixyPXtzdGF0ZTpmdW5jdGlvbigpe3JldHVybiBmfSxhbHdheXM6ZnVuY3Rpb24oKXtyZXR1cm4gdC5kb25lKGFyZ3VtZW50cykuZmFpbChhcmd1bWVudHMpLHRoaXN9LHRoZW46ZnVuY3Rpb24oKXt2YXIgbj1hcmd1bWVudHM7cmV0dXJuIGkuRGVmZXJyZWQoZnVuY3Rpb24ocil7aS5lYWNoKHUsZnVuY3Rpb24odSxmKXt2YXIgZT1mWzBdLG89blt1XTt0W2ZbMV1dKGkuaXNGdW5jdGlvbihvKT9mdW5jdGlvbigpe3ZhciBuPW8uYXBwbHkodGhpcyxhcmd1bWVudHMpO24mJmkuaXNGdW5jdGlvbihuLnByb21pc2UpP24ucHJvbWlzZSgpLmRvbmUoci5yZXNvbHZlKS5mYWlsKHIucmVqZWN0KS5wcm9ncmVzcyhyLm5vdGlmeSk6cltlK1wiV2l0aFwiXSh0aGlzPT09dD9yOnRoaXMsW25dKX06cltlXSl9KTtuPW51bGx9KS5wcm9taXNlKCl9LHByb21pc2U6ZnVuY3Rpb24obil7cmV0dXJuIG4hPW51bGw/aS5leHRlbmQobixyKTpyfX0sdD17fTtyZXR1cm4gci5waXBlPXIudGhlbixpLmVhY2godSxmdW5jdGlvbihuLGkpe3ZhciBlPWlbMl0sbz1pWzNdO3JbaVsxXV09ZS5hZGQ7byYmZS5hZGQoZnVuY3Rpb24oKXtmPW99LHVbbl4xXVsyXS5kaXNhYmxlLHVbMl1bMl0ubG9jayk7dFtpWzBdXT1lLmZpcmU7dFtpWzBdK1wiV2l0aFwiXT1lLmZpcmVXaXRofSksci5wcm9taXNlKHQpLG4mJm4uY2FsbCh0LHQpLHR9LHdoZW46ZnVuY3Rpb24obil7dmFyIHQ9MCx1PW8uY2FsbChhcmd1bWVudHMpLHI9dS5sZW5ndGgsZT1yIT09MXx8biYmaS5pc0Z1bmN0aW9uKG4ucHJvbWlzZSk/cjowLGY9ZT09PTE/bjppLkRlZmVycmVkKCksYz1mdW5jdGlvbihuLHQsaSl7cmV0dXJuIGZ1bmN0aW9uKHIpe3Rbbl09dGhpcztpW25dPWFyZ3VtZW50cy5sZW5ndGg+MT9vLmNhbGwoYXJndW1lbnRzKTpyO2k9PT1zP2Yubm90aWZ5V2l0aCh0LGkpOi0tZXx8Zi5yZXNvbHZlV2l0aCh0LGkpfX0scyxsLGg7aWYocj4xKWZvcihzPW5ldyBBcnJheShyKSxsPW5ldyBBcnJheShyKSxoPW5ldyBBcnJheShyKTt0PHI7dCsrKXVbdF0mJmkuaXNGdW5jdGlvbih1W3RdLnByb21pc2UpP3VbdF0ucHJvbWlzZSgpLmRvbmUoYyh0LGgsdSkpLmZhaWwoZi5yZWplY3QpLnByb2dyZXNzKGModCxsLHMpKTotLWU7cmV0dXJuIGV8fGYucmVzb2x2ZVdpdGgoaCx1KSxmLnByb21pc2UoKX19KTtpLnN1cHBvcnQ9ZnVuY3Rpb24oKXt2YXIgdSxoLGUsYyxsLGYsbyxhLHYscyx5LHQ9ci5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO2lmKHQuc2V0QXR0cmlidXRlKFwiY2xhc3NOYW1lXCIsXCJ0XCIpLHQuaW5uZXJIVE1MPVwiICA8bGluay8+PHRhYmxlPjxcXC90YWJsZT48YSBocmVmPScvYSc+YTxcXC9hPjxpbnB1dCB0eXBlPSdjaGVja2JveCcvPlwiLGg9dC5nZXRFbGVtZW50c0J5VGFnTmFtZShcIipcIiksZT10LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiYVwiKVswXSwhaHx8IWV8fCFoLmxlbmd0aClyZXR1cm57fTtjPXIuY3JlYXRlRWxlbWVudChcInNlbGVjdFwiKTtsPWMuYXBwZW5kQ2hpbGQoci5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpKTtmPXQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJpbnB1dFwiKVswXTtlLnN0eWxlLmNzc1RleHQ9XCJ0b3A6MXB4O2Zsb2F0OmxlZnQ7b3BhY2l0eTouNVwiO3U9e2xlYWRpbmdXaGl0ZXNwYWNlOnQuZmlyc3RDaGlsZC5ub2RlVHlwZT09PTMsdGJvZHk6IXQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0Ym9keVwiKS5sZW5ndGgsaHRtbFNlcmlhbGl6ZTohIXQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJsaW5rXCIpLmxlbmd0aCxzdHlsZTovdG9wLy50ZXN0KGUuZ2V0QXR0cmlidXRlKFwic3R5bGVcIikpLGhyZWZOb3JtYWxpemVkOmUuZ2V0QXR0cmlidXRlKFwiaHJlZlwiKT09PVwiL2FcIixvcGFjaXR5Oi9eMC41Ly50ZXN0KGUuc3R5bGUub3BhY2l0eSksY3NzRmxvYXQ6ISFlLnN0eWxlLmNzc0Zsb2F0LGNoZWNrT246Zi52YWx1ZT09PVwib25cIixvcHRTZWxlY3RlZDpsLnNlbGVjdGVkLGdldFNldEF0dHJpYnV0ZTp0LmNsYXNzTmFtZSE9PVwidFwiLGVuY3R5cGU6ISFyLmNyZWF0ZUVsZW1lbnQoXCJmb3JtXCIpLmVuY3R5cGUsaHRtbDVDbG9uZTpyLmNyZWF0ZUVsZW1lbnQoXCJuYXZcIikuY2xvbmVOb2RlKCEwKS5vdXRlckhUTUwhPT1cIjw6bmF2PjxcXC86bmF2PlwiLGJveE1vZGVsOnIuY29tcGF0TW9kZT09PVwiQ1NTMUNvbXBhdFwiLHN1Ym1pdEJ1YmJsZXM6ITAsY2hhbmdlQnViYmxlczohMCxmb2N1c2luQnViYmxlczohMSxkZWxldGVFeHBhbmRvOiEwLG5vQ2xvbmVFdmVudDohMCxpbmxpbmVCbG9ja05lZWRzTGF5b3V0OiExLHNocmlua1dyYXBCbG9ja3M6ITEscmVsaWFibGVNYXJnaW5SaWdodDohMCxib3hTaXppbmdSZWxpYWJsZTohMCxwaXhlbFBvc2l0aW9uOiExfTtmLmNoZWNrZWQ9ITA7dS5ub0Nsb25lQ2hlY2tlZD1mLmNsb25lTm9kZSghMCkuY2hlY2tlZDtjLmRpc2FibGVkPSEwO3Uub3B0RGlzYWJsZWQ9IWwuZGlzYWJsZWQ7dHJ5e2RlbGV0ZSB0LnRlc3R9Y2F0Y2gocCl7dS5kZWxldGVFeHBhbmRvPSExfWlmKCF0LmFkZEV2ZW50TGlzdGVuZXImJnQuYXR0YWNoRXZlbnQmJnQuZmlyZUV2ZW50JiYodC5hdHRhY2hFdmVudChcIm9uY2xpY2tcIix5PWZ1bmN0aW9uKCl7dS5ub0Nsb25lRXZlbnQ9ITF9KSx0LmNsb25lTm9kZSghMCkuZmlyZUV2ZW50KFwib25jbGlja1wiKSx0LmRldGFjaEV2ZW50KFwib25jbGlja1wiLHkpKSxmPXIuY3JlYXRlRWxlbWVudChcImlucHV0XCIpLGYudmFsdWU9XCJ0XCIsZi5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsXCJyYWRpb1wiKSx1LnJhZGlvVmFsdWU9Zi52YWx1ZT09PVwidFwiLGYuc2V0QXR0cmlidXRlKFwiY2hlY2tlZFwiLFwiY2hlY2tlZFwiKSxmLnNldEF0dHJpYnV0ZShcIm5hbWVcIixcInRcIiksdC5hcHBlbmRDaGlsZChmKSxvPXIuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLG8uYXBwZW5kQ2hpbGQodC5sYXN0Q2hpbGQpLHUuY2hlY2tDbG9uZT1vLmNsb25lTm9kZSghMCkuY2xvbmVOb2RlKCEwKS5sYXN0Q2hpbGQuY2hlY2tlZCx1LmFwcGVuZENoZWNrZWQ9Zi5jaGVja2VkLG8ucmVtb3ZlQ2hpbGQoZiksby5hcHBlbmRDaGlsZCh0KSx0LmF0dGFjaEV2ZW50KWZvcih2IGlue3N1Ym1pdDohMCxjaGFuZ2U6ITAsZm9jdXNpbjohMH0pYT1cIm9uXCIrdixzPWEgaW4gdCxzfHwodC5zZXRBdHRyaWJ1dGUoYSxcInJldHVybjtcIikscz10eXBlb2YgdFthXT09XCJmdW5jdGlvblwiKSx1W3YrXCJCdWJibGVzXCJdPXM7cmV0dXJuIGkoZnVuY3Rpb24oKXt2YXIgaSx0LGYsZSxoPVwicGFkZGluZzowO21hcmdpbjowO2JvcmRlcjowO2Rpc3BsYXk6YmxvY2s7b3ZlcmZsb3c6aGlkZGVuO1wiLG89ci5nZXRFbGVtZW50c0J5VGFnTmFtZShcImJvZHlcIilbMF07byYmKGk9ci5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLGkuc3R5bGUuY3NzVGV4dD1cInZpc2liaWxpdHk6aGlkZGVuO2JvcmRlcjowO3dpZHRoOjA7aGVpZ2h0OjA7cG9zaXRpb246c3RhdGljO3RvcDowO21hcmdpbi10b3A6MXB4XCIsby5pbnNlcnRCZWZvcmUoaSxvLmZpcnN0Q2hpbGQpLHQ9ci5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLGkuYXBwZW5kQ2hpbGQodCksdC5pbm5lckhUTUw9XCI8dGFibGU+PHRyPjx0ZD48XFwvdGQ+PHRkPnQ8XFwvdGQ+PFxcL3RyPjxcXC90YWJsZT5cIixmPXQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0ZFwiKSxmWzBdLnN0eWxlLmNzc1RleHQ9XCJwYWRkaW5nOjA7bWFyZ2luOjA7Ym9yZGVyOjA7ZGlzcGxheTpub25lXCIscz1mWzBdLm9mZnNldEhlaWdodD09PTAsZlswXS5zdHlsZS5kaXNwbGF5PVwiXCIsZlsxXS5zdHlsZS5kaXNwbGF5PVwibm9uZVwiLHUucmVsaWFibGVIaWRkZW5PZmZzZXRzPXMmJmZbMF0ub2Zmc2V0SGVpZ2h0PT09MCx0LmlubmVySFRNTD1cIlwiLHQuc3R5bGUuY3NzVGV4dD1cImJveC1zaXppbmc6Ym9yZGVyLWJveDstbW96LWJveC1zaXppbmc6Ym9yZGVyLWJveDstd2Via2l0LWJveC1zaXppbmc6Ym9yZGVyLWJveDtwYWRkaW5nOjFweDtib3JkZXI6MXB4O2Rpc3BsYXk6YmxvY2s7d2lkdGg6NHB4O21hcmdpbi10b3A6MSU7cG9zaXRpb246YWJzb2x1dGU7dG9wOjElO1wiLHUuYm94U2l6aW5nPXQub2Zmc2V0V2lkdGg9PT00LHUuZG9lc05vdEluY2x1ZGVNYXJnaW5JbkJvZHlPZmZzZXQ9by5vZmZzZXRUb3AhPT0xLG4uZ2V0Q29tcHV0ZWRTdHlsZSYmKHUucGl4ZWxQb3NpdGlvbj0obi5nZXRDb21wdXRlZFN0eWxlKHQsbnVsbCl8fHt9KS50b3AhPT1cIjElXCIsdS5ib3hTaXppbmdSZWxpYWJsZT0obi5nZXRDb21wdXRlZFN0eWxlKHQsbnVsbCl8fHt3aWR0aDpcIjRweFwifSkud2lkdGg9PT1cIjRweFwiLGU9ci5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLGUuc3R5bGUuY3NzVGV4dD10LnN0eWxlLmNzc1RleHQ9aCxlLnN0eWxlLm1hcmdpblJpZ2h0PWUuc3R5bGUud2lkdGg9XCIwXCIsdC5zdHlsZS53aWR0aD1cIjFweFwiLHQuYXBwZW5kQ2hpbGQoZSksdS5yZWxpYWJsZU1hcmdpblJpZ2h0PSFwYXJzZUZsb2F0KChuLmdldENvbXB1dGVkU3R5bGUoZSxudWxsKXx8e30pLm1hcmdpblJpZ2h0KSksdHlwZW9mIHQuc3R5bGUuem9vbSE9XCJ1bmRlZmluZWRcIiYmKHQuaW5uZXJIVE1MPVwiXCIsdC5zdHlsZS5jc3NUZXh0PWgrXCJ3aWR0aDoxcHg7cGFkZGluZzoxcHg7ZGlzcGxheTppbmxpbmU7em9vbToxXCIsdS5pbmxpbmVCbG9ja05lZWRzTGF5b3V0PXQub2Zmc2V0V2lkdGg9PT0zLHQuc3R5bGUuZGlzcGxheT1cImJsb2NrXCIsdC5zdHlsZS5vdmVyZmxvdz1cInZpc2libGVcIix0LmlubmVySFRNTD1cIjxkaXY+PFxcL2Rpdj5cIix0LmZpcnN0Q2hpbGQuc3R5bGUud2lkdGg9XCI1cHhcIix1LnNocmlua1dyYXBCbG9ja3M9dC5vZmZzZXRXaWR0aCE9PTMsaS5zdHlsZS56b29tPTEpLG8ucmVtb3ZlQ2hpbGQoaSksaT10PWY9ZT1udWxsKX0pLG8ucmVtb3ZlQ2hpbGQodCksaD1lPWM9bD1mPW89dD1udWxsLHV9KCk7aGk9Lyg/Olxce1tcXHNcXFNdKlxcfXxcXFtbXFxzXFxTXSpcXF0pJC87Y2k9LyhbQS1aXSkvZztpLmV4dGVuZCh7Y2FjaGU6e30sZGVsZXRlZElkczpbXSx1dWlkOjAsZXhwYW5kbzpcImpRdWVyeVwiKyhpLmZuLmpxdWVyeStNYXRoLnJhbmRvbSgpKS5yZXBsYWNlKC9cXEQvZyxcIlwiKSxub0RhdGE6e2VtYmVkOiEwLG9iamVjdDpcImNsc2lkOkQyN0NEQjZFLUFFNkQtMTFjZi05NkI4LTQ0NDU1MzU0MDAwMFwiLGFwcGxldDohMH0saGFzRGF0YTpmdW5jdGlvbihuKXtyZXR1cm4gbj1uLm5vZGVUeXBlP2kuY2FjaGVbbltpLmV4cGFuZG9dXTpuW2kuZXhwYW5kb10sISFuJiYhcHQobil9LGRhdGE6ZnVuY3Rpb24obixyLHUsZil7aWYoaS5hY2NlcHREYXRhKG4pKXt2YXIgcyxoLGM9aS5leHBhbmRvLGE9dHlwZW9mIHI9PVwic3RyaW5nXCIsbD1uLm5vZGVUeXBlLG89bD9pLmNhY2hlOm4sZT1sP25bY106bltjXSYmYztpZihlJiZvW2VdJiYoZnx8b1tlXS5kYXRhKXx8IWF8fHUhPT10KXJldHVybiBlfHwobD9uW2NdPWU9aS5kZWxldGVkSWRzLnBvcCgpfHxpLmd1aWQrKzplPWMpLG9bZV18fChvW2VdPXt9LGx8fChvW2VdLnRvSlNPTj1pLm5vb3ApKSwodHlwZW9mIHI9PVwib2JqZWN0XCJ8fHR5cGVvZiByPT1cImZ1bmN0aW9uXCIpJiYoZj9vW2VdPWkuZXh0ZW5kKG9bZV0scik6b1tlXS5kYXRhPWkuZXh0ZW5kKG9bZV0uZGF0YSxyKSkscz1vW2VdLGZ8fChzLmRhdGF8fChzLmRhdGE9e30pLHM9cy5kYXRhKSx1IT09dCYmKHNbaS5jYW1lbENhc2UocildPXUpLGE/KGg9c1tyXSxoPT1udWxsJiYoaD1zW2kuY2FtZWxDYXNlKHIpXSkpOmg9cyxofX0scmVtb3ZlRGF0YTpmdW5jdGlvbihuLHQscil7aWYoaS5hY2NlcHREYXRhKG4pKXt2YXIgZSxvLGgscz1uLm5vZGVUeXBlLHU9cz9pLmNhY2hlOm4sZj1zP25baS5leHBhbmRvXTppLmV4cGFuZG87aWYodVtmXSl7aWYodCYmKGU9cj91W2ZdOnVbZl0uZGF0YSxlKSl7Zm9yKGkuaXNBcnJheSh0KXx8KHQgaW4gZT90PVt0XToodD1pLmNhbWVsQ2FzZSh0KSx0PXQgaW4gZT9bdF06dC5zcGxpdChcIiBcIikpKSxvPTAsaD10Lmxlbmd0aDtvPGg7bysrKWRlbGV0ZSBlW3Rbb11dO2lmKCEocj9wdDppLmlzRW1wdHlPYmplY3QpKGUpKXJldHVybn0ocnx8KGRlbGV0ZSB1W2ZdLmRhdGEscHQodVtmXSkpKSYmKHM/aS5jbGVhbkRhdGEoW25dLCEwKTppLnN1cHBvcnQuZGVsZXRlRXhwYW5kb3x8dSE9dS53aW5kb3c/ZGVsZXRlIHVbZl06dVtmXT1udWxsKX19fSxfZGF0YTpmdW5jdGlvbihuLHQscil7cmV0dXJuIGkuZGF0YShuLHQsciwhMCl9LGFjY2VwdERhdGE6ZnVuY3Rpb24obil7dmFyIHQ9bi5ub2RlTmFtZSYmaS5ub0RhdGFbbi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXTtyZXR1cm4hdHx8dCE9PSEwJiZuLmdldEF0dHJpYnV0ZShcImNsYXNzaWRcIik9PT10fX0pO2kuZm4uZXh0ZW5kKHtkYXRhOmZ1bmN0aW9uKG4scil7dmFyIHUscyxoLG8sbCxlPXRoaXNbMF0sYz0wLGY9bnVsbDtpZihuPT09dCl7aWYodGhpcy5sZW5ndGgmJihmPWkuZGF0YShlKSxlLm5vZGVUeXBlPT09MSYmIWkuX2RhdGEoZSxcInBhcnNlZEF0dHJzXCIpKSl7Zm9yKGg9ZS5hdHRyaWJ1dGVzLGw9aC5sZW5ndGg7YzxsO2MrKylvPWhbY10ubmFtZSxvLmluZGV4T2YoXCJkYXRhLVwiKXx8KG89aS5jYW1lbENhc2Uoby5zdWJzdHJpbmcoNSkpLGxpKGUsbyxmW29dKSk7aS5fZGF0YShlLFwicGFyc2VkQXR0cnNcIiwhMCl9cmV0dXJuIGZ9cmV0dXJuIHR5cGVvZiBuPT1cIm9iamVjdFwiP3RoaXMuZWFjaChmdW5jdGlvbigpe2kuZGF0YSh0aGlzLG4pfSk6KHU9bi5zcGxpdChcIi5cIiwyKSx1WzFdPXVbMV0/XCIuXCIrdVsxXTpcIlwiLHM9dVsxXStcIiFcIixpLmFjY2Vzcyh0aGlzLGZ1bmN0aW9uKHIpe2lmKHI9PT10KXJldHVybiBmPXRoaXMudHJpZ2dlckhhbmRsZXIoXCJnZXREYXRhXCIrcyxbdVswXV0pLGY9PT10JiZlJiYoZj1pLmRhdGEoZSxuKSxmPWxpKGUsbixmKSksZj09PXQmJnVbMV0/dGhpcy5kYXRhKHVbMF0pOmY7dVsxXT1yO3RoaXMuZWFjaChmdW5jdGlvbigpe3ZhciB0PWkodGhpcyk7dC50cmlnZ2VySGFuZGxlcihcInNldERhdGFcIitzLHUpO2kuZGF0YSh0aGlzLG4scik7dC50cmlnZ2VySGFuZGxlcihcImNoYW5nZURhdGFcIitzLHUpfSl9LG51bGwscixhcmd1bWVudHMubGVuZ3RoPjEsbnVsbCwhMSkpfSxyZW1vdmVEYXRhOmZ1bmN0aW9uKG4pe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtpLnJlbW92ZURhdGEodGhpcyxuKX0pfX0pO2kuZXh0ZW5kKHtxdWV1ZTpmdW5jdGlvbihuLHQscil7dmFyIHU7aWYobilyZXR1cm4gdD0odHx8XCJmeFwiKStcInF1ZXVlXCIsdT1pLl9kYXRhKG4sdCksciYmKCF1fHxpLmlzQXJyYXkocik/dT1pLl9kYXRhKG4sdCxpLm1ha2VBcnJheShyKSk6dS5wdXNoKHIpKSx1fHxbXX0sZGVxdWV1ZTpmdW5jdGlvbihuLHQpe3Q9dHx8XCJmeFwiO3ZhciByPWkucXVldWUobix0KSxlPXIubGVuZ3RoLHU9ci5zaGlmdCgpLGY9aS5fcXVldWVIb29rcyhuLHQpLG89ZnVuY3Rpb24oKXtpLmRlcXVldWUobix0KX07dT09PVwiaW5wcm9ncmVzc1wiJiYodT1yLnNoaWZ0KCksZS0tKTt1JiYodD09PVwiZnhcIiYmci51bnNoaWZ0KFwiaW5wcm9ncmVzc1wiKSxkZWxldGUgZi5zdG9wLHUuY2FsbChuLG8sZikpOyFlJiZmJiZmLmVtcHR5LmZpcmUoKX0sX3F1ZXVlSG9va3M6ZnVuY3Rpb24obix0KXt2YXIgcj10K1wicXVldWVIb29rc1wiO3JldHVybiBpLl9kYXRhKG4scil8fGkuX2RhdGEobixyLHtlbXB0eTppLkNhbGxiYWNrcyhcIm9uY2UgbWVtb3J5XCIpLmFkZChmdW5jdGlvbigpe2kucmVtb3ZlRGF0YShuLHQrXCJxdWV1ZVwiLCEwKTtpLnJlbW92ZURhdGEobixyLCEwKX0pfSl9fSk7aS5mbi5leHRlbmQoe3F1ZXVlOmZ1bmN0aW9uKG4scil7dmFyIHU9MjtyZXR1cm4odHlwZW9mIG4hPVwic3RyaW5nXCImJihyPW4sbj1cImZ4XCIsdS0tKSxhcmd1bWVudHMubGVuZ3RoPHUpP2kucXVldWUodGhpc1swXSxuKTpyPT09dD90aGlzOnRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciB0PWkucXVldWUodGhpcyxuLHIpO2kuX3F1ZXVlSG9va3ModGhpcyxuKTtuPT09XCJmeFwiJiZ0WzBdIT09XCJpbnByb2dyZXNzXCImJmkuZGVxdWV1ZSh0aGlzLG4pfSl9LGRlcXVldWU6ZnVuY3Rpb24obil7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2kuZGVxdWV1ZSh0aGlzLG4pfSl9LGRlbGF5OmZ1bmN0aW9uKG4sdCl7cmV0dXJuIG49aS5meD9pLmZ4LnNwZWVkc1tuXXx8bjpuLHQ9dHx8XCJmeFwiLHRoaXMucXVldWUodCxmdW5jdGlvbih0LGkpe3ZhciByPXNldFRpbWVvdXQodCxuKTtpLnN0b3A9ZnVuY3Rpb24oKXtjbGVhclRpbWVvdXQocil9fSl9LGNsZWFyUXVldWU6ZnVuY3Rpb24obil7cmV0dXJuIHRoaXMucXVldWUobnx8XCJmeFwiLFtdKX0scHJvbWlzZTpmdW5jdGlvbihuLHIpe3ZhciB1LGU9MSxvPWkuRGVmZXJyZWQoKSxmPXRoaXMscz10aGlzLmxlbmd0aCxoPWZ1bmN0aW9uKCl7LS1lfHxvLnJlc29sdmVXaXRoKGYsW2ZdKX07Zm9yKHR5cGVvZiBuIT1cInN0cmluZ1wiJiYocj1uLG49dCksbj1ufHxcImZ4XCI7cy0tOyl1PWkuX2RhdGEoZltzXSxuK1wicXVldWVIb29rc1wiKSx1JiZ1LmVtcHR5JiYoZSsrLHUuZW1wdHkuYWRkKGgpKTtyZXR1cm4gaCgpLG8ucHJvbWlzZShyKX19KTt2YXIgcyxhaSx2aSx5aT0vW1xcdFxcclxcbl0vZyxjZj0vXFxyL2csbGY9L14oPzpidXR0b258aW5wdXQpJC9pLGFmPS9eKD86YnV0dG9ufGlucHV0fG9iamVjdHxzZWxlY3R8dGV4dGFyZWEpJC9pLHZmPS9eYSg/OnJlYXwpJC9pLHBpPS9eKD86YXV0b2ZvY3VzfGF1dG9wbGF5fGFzeW5jfGNoZWNrZWR8Y29udHJvbHN8ZGVmZXJ8ZGlzYWJsZWR8aGlkZGVufGxvb3B8bXVsdGlwbGV8b3BlbnxyZWFkb25seXxyZXF1aXJlZHxzY29wZWR8c2VsZWN0ZWQpJC9pLHdpPWkuc3VwcG9ydC5nZXRTZXRBdHRyaWJ1dGU7aS5mbi5leHRlbmQoe2F0dHI6ZnVuY3Rpb24obix0KXtyZXR1cm4gaS5hY2Nlc3ModGhpcyxpLmF0dHIsbix0LGFyZ3VtZW50cy5sZW5ndGg+MSl9LHJlbW92ZUF0dHI6ZnVuY3Rpb24obil7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2kucmVtb3ZlQXR0cih0aGlzLG4pfSl9LHByb3A6ZnVuY3Rpb24obix0KXtyZXR1cm4gaS5hY2Nlc3ModGhpcyxpLnByb3Asbix0LGFyZ3VtZW50cy5sZW5ndGg+MSl9LHJlbW92ZVByb3A6ZnVuY3Rpb24obil7cmV0dXJuIG49aS5wcm9wRml4W25dfHxuLHRoaXMuZWFjaChmdW5jdGlvbigpe3RyeXt0aGlzW25dPXQ7ZGVsZXRlIHRoaXNbbl19Y2F0Y2goaSl7fX0pfSxhZGRDbGFzczpmdW5jdGlvbihuKXt2YXIgcixmLG8sdCxlLHUscztpZihpLmlzRnVuY3Rpb24obikpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbih0KXtpKHRoaXMpLmFkZENsYXNzKG4uY2FsbCh0aGlzLHQsdGhpcy5jbGFzc05hbWUpKX0pO2lmKG4mJnR5cGVvZiBuPT1cInN0cmluZ1wiKWZvcihyPW4uc3BsaXQoaCksZj0wLG89dGhpcy5sZW5ndGg7ZjxvO2YrKylpZih0PXRoaXNbZl0sdC5ub2RlVHlwZT09PTEpaWYodC5jbGFzc05hbWV8fHIubGVuZ3RoIT09MSl7Zm9yKGU9XCIgXCIrdC5jbGFzc05hbWUrXCIgXCIsdT0wLHM9ci5sZW5ndGg7dTxzO3UrKyllLmluZGV4T2YoXCIgXCIrclt1XStcIiBcIik8MCYmKGUrPXJbdV0rXCIgXCIpO3QuY2xhc3NOYW1lPWkudHJpbShlKX1lbHNlIHQuY2xhc3NOYW1lPW47cmV0dXJuIHRoaXN9LHJlbW92ZUNsYXNzOmZ1bmN0aW9uKG4pe3ZhciBlLHIsdSxmLHMsbyxjO2lmKGkuaXNGdW5jdGlvbihuKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKHQpe2kodGhpcykucmVtb3ZlQ2xhc3Mobi5jYWxsKHRoaXMsdCx0aGlzLmNsYXNzTmFtZSkpfSk7aWYobiYmdHlwZW9mIG49PVwic3RyaW5nXCJ8fG49PT10KWZvcihlPShufHxcIlwiKS5zcGxpdChoKSxvPTAsYz10aGlzLmxlbmd0aDtvPGM7bysrKWlmKHU9dGhpc1tvXSx1Lm5vZGVUeXBlPT09MSYmdS5jbGFzc05hbWUpe2ZvcihyPShcIiBcIit1LmNsYXNzTmFtZStcIiBcIikucmVwbGFjZSh5aSxcIiBcIiksZj0wLHM9ZS5sZW5ndGg7ZjxzO2YrKyl3aGlsZShyLmluZGV4T2YoXCIgXCIrZVtmXStcIiBcIik+PTApcj1yLnJlcGxhY2UoXCIgXCIrZVtmXStcIiBcIixcIiBcIik7dS5jbGFzc05hbWU9bj9pLnRyaW0ocik6XCJcIn1yZXR1cm4gdGhpc30sdG9nZ2xlQ2xhc3M6ZnVuY3Rpb24obix0KXt2YXIgcj10eXBlb2Ygbix1PXR5cGVvZiB0PT1cImJvb2xlYW5cIjtyZXR1cm4gaS5pc0Z1bmN0aW9uKG4pP3RoaXMuZWFjaChmdW5jdGlvbihyKXtpKHRoaXMpLnRvZ2dsZUNsYXNzKG4uY2FsbCh0aGlzLHIsdGhpcy5jbGFzc05hbWUsdCksdCl9KTp0aGlzLmVhY2goZnVuY3Rpb24oKXtpZihyPT09XCJzdHJpbmdcIilmb3IodmFyIGYscz0wLG89aSh0aGlzKSxlPXQsYz1uLnNwbGl0KGgpO2Y9Y1tzKytdOyllPXU/ZTohby5oYXNDbGFzcyhmKSxvW2U/XCJhZGRDbGFzc1wiOlwicmVtb3ZlQ2xhc3NcIl0oZik7ZWxzZShyPT09XCJ1bmRlZmluZWRcInx8cj09PVwiYm9vbGVhblwiKSYmKHRoaXMuY2xhc3NOYW1lJiZpLl9kYXRhKHRoaXMsXCJfX2NsYXNzTmFtZV9fXCIsdGhpcy5jbGFzc05hbWUpLHRoaXMuY2xhc3NOYW1lPXRoaXMuY2xhc3NOYW1lfHxuPT09ITE/XCJcIjppLl9kYXRhKHRoaXMsXCJfX2NsYXNzTmFtZV9fXCIpfHxcIlwiKX0pfSxoYXNDbGFzczpmdW5jdGlvbihuKXtmb3IodmFyIGk9XCIgXCIrbitcIiBcIix0PTAscj10aGlzLmxlbmd0aDt0PHI7dCsrKWlmKHRoaXNbdF0ubm9kZVR5cGU9PT0xJiYoXCIgXCIrdGhpc1t0XS5jbGFzc05hbWUrXCIgXCIpLnJlcGxhY2UoeWksXCIgXCIpLmluZGV4T2YoaSk+PTApcmV0dXJuITA7cmV0dXJuITF9LHZhbDpmdW5jdGlvbihuKXt2YXIgcix1LGUsZj10aGlzWzBdO3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPWkuaXNGdW5jdGlvbihuKSx0aGlzLmVhY2goZnVuY3Rpb24odSl7dmFyIGYsbz1pKHRoaXMpO3RoaXMubm9kZVR5cGU9PT0xJiYoZj1lP24uY2FsbCh0aGlzLHUsby52YWwoKSk6bixmPT1udWxsP2Y9XCJcIjp0eXBlb2YgZj09XCJudW1iZXJcIj9mKz1cIlwiOmkuaXNBcnJheShmKSYmKGY9aS5tYXAoZixmdW5jdGlvbihuKXtyZXR1cm4gbj09bnVsbD9cIlwiOm4rXCJcIn0pKSxyPWkudmFsSG9va3NbdGhpcy50eXBlXXx8aS52YWxIb29rc1t0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldLHImJlwic2V0XCJpbiByJiZyLnNldCh0aGlzLGYsXCJ2YWx1ZVwiKSE9PXR8fCh0aGlzLnZhbHVlPWYpKX0pKTpmPyhyPWkudmFsSG9va3NbZi50eXBlXXx8aS52YWxIb29rc1tmLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldLHImJlwiZ2V0XCJpbiByJiYodT1yLmdldChmLFwidmFsdWVcIikpIT09dCk/dToodT1mLnZhbHVlLHR5cGVvZiB1PT1cInN0cmluZ1wiP3UucmVwbGFjZShjZixcIlwiKTp1PT1udWxsP1wiXCI6dSk6dm9pZCAwfX0pO2kuZXh0ZW5kKHt2YWxIb29rczp7b3B0aW9uOntnZXQ6ZnVuY3Rpb24obil7dmFyIHQ9bi5hdHRyaWJ1dGVzLnZhbHVlO3JldHVybiF0fHx0LnNwZWNpZmllZD9uLnZhbHVlOm4udGV4dH19LHNlbGVjdDp7Z2V0OmZ1bmN0aW9uKG4pe2Zvcih2YXIgZSx0LG89bi5vcHRpb25zLHI9bi5zZWxlY3RlZEluZGV4LHU9bi50eXBlPT09XCJzZWxlY3Qtb25lXCJ8fHI8MCxzPXU/bnVsbDpbXSxoPXU/cisxOm8ubGVuZ3RoLGY9cjwwP2g6dT9yOjA7ZjxoO2YrKylpZih0PW9bZl0sKHQuc2VsZWN0ZWR8fGY9PT1yKSYmKGkuc3VwcG9ydC5vcHREaXNhYmxlZD8hdC5kaXNhYmxlZDp0LmdldEF0dHJpYnV0ZShcImRpc2FibGVkXCIpPT09bnVsbCkmJighdC5wYXJlbnROb2RlLmRpc2FibGVkfHwhaS5ub2RlTmFtZSh0LnBhcmVudE5vZGUsXCJvcHRncm91cFwiKSkpe2lmKGU9aSh0KS52YWwoKSx1KXJldHVybiBlO3MucHVzaChlKX1yZXR1cm4gc30sc2V0OmZ1bmN0aW9uKG4sdCl7dmFyIHI9aS5tYWtlQXJyYXkodCk7cmV0dXJuIGkobikuZmluZChcIm9wdGlvblwiKS5lYWNoKGZ1bmN0aW9uKCl7dGhpcy5zZWxlY3RlZD1pLmluQXJyYXkoaSh0aGlzKS52YWwoKSxyKT49MH0pLHIubGVuZ3RofHwobi5zZWxlY3RlZEluZGV4PS0xKSxyfX19LGF0dHJGbjp7fSxhdHRyOmZ1bmN0aW9uKG4scix1LGYpe3ZhciBlLG8saCxjPW4ubm9kZVR5cGU7aWYobiYmYyE9PTMmJmMhPT04JiZjIT09Mil7aWYoZiYmaS5pc0Z1bmN0aW9uKGkuZm5bcl0pKXJldHVybiBpKG4pW3JdKHUpO2lmKHR5cGVvZiBuLmdldEF0dHJpYnV0ZT09XCJ1bmRlZmluZWRcIilyZXR1cm4gaS5wcm9wKG4scix1KTtpZihoPWMhPT0xfHwhaS5pc1hNTERvYyhuKSxoJiYocj1yLnRvTG93ZXJDYXNlKCksbz1pLmF0dHJIb29rc1tyXXx8KHBpLnRlc3Qocik/YWk6cykpLHUhPT10KXtpZih1PT09bnVsbCl7aS5yZW1vdmVBdHRyKG4scik7cmV0dXJufXJldHVybiBvJiZcInNldFwiaW4gbyYmaCYmKGU9by5zZXQobix1LHIpKSE9PXQ/ZToobi5zZXRBdHRyaWJ1dGUocix1K1wiXCIpLHUpfXJldHVybiBvJiZcImdldFwiaW4gbyYmaCYmKGU9by5nZXQobixyKSkhPT1udWxsP2U6KGU9bi5nZXRBdHRyaWJ1dGUociksZT09PW51bGw/dDplKX19LHJlbW92ZUF0dHI6ZnVuY3Rpb24obix0KXt2YXIgdSxmLHIsZSxvPTA7aWYodCYmbi5ub2RlVHlwZT09PTEpZm9yKGY9dC5zcGxpdChoKTtvPGYubGVuZ3RoO28rKylyPWZbb10sciYmKHU9aS5wcm9wRml4W3JdfHxyLGU9cGkudGVzdChyKSxlfHxpLmF0dHIobixyLFwiXCIpLG4ucmVtb3ZlQXR0cmlidXRlKHdpP3I6dSksZSYmdSBpbiBuJiYoblt1XT0hMSkpfSxhdHRySG9va3M6e3R5cGU6e3NldDpmdW5jdGlvbihuLHQpe2lmKGxmLnRlc3Qobi5ub2RlTmFtZSkmJm4ucGFyZW50Tm9kZSlpLmVycm9yKFwidHlwZSBwcm9wZXJ0eSBjYW4ndCBiZSBjaGFuZ2VkXCIpO2Vsc2UgaWYoIWkuc3VwcG9ydC5yYWRpb1ZhbHVlJiZ0PT09XCJyYWRpb1wiJiZpLm5vZGVOYW1lKG4sXCJpbnB1dFwiKSl7dmFyIHI9bi52YWx1ZTtyZXR1cm4gbi5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsdCksciYmKG4udmFsdWU9ciksdH19fSx2YWx1ZTp7Z2V0OmZ1bmN0aW9uKG4sdCl7cmV0dXJuIHMmJmkubm9kZU5hbWUobixcImJ1dHRvblwiKT9zLmdldChuLHQpOnQgaW4gbj9uLnZhbHVlOm51bGx9LHNldDpmdW5jdGlvbihuLHQscil7aWYocyYmaS5ub2RlTmFtZShuLFwiYnV0dG9uXCIpKXJldHVybiBzLnNldChuLHQscik7bi52YWx1ZT10fX19LHByb3BGaXg6e3RhYmluZGV4OlwidGFiSW5kZXhcIixyZWFkb25seTpcInJlYWRPbmx5XCIsXCJmb3JcIjpcImh0bWxGb3JcIixcImNsYXNzXCI6XCJjbGFzc05hbWVcIixtYXhsZW5ndGg6XCJtYXhMZW5ndGhcIixjZWxsc3BhY2luZzpcImNlbGxTcGFjaW5nXCIsY2VsbHBhZGRpbmc6XCJjZWxsUGFkZGluZ1wiLHJvd3NwYW46XCJyb3dTcGFuXCIsY29sc3BhbjpcImNvbFNwYW5cIix1c2VtYXA6XCJ1c2VNYXBcIixmcmFtZWJvcmRlcjpcImZyYW1lQm9yZGVyXCIsY29udGVudGVkaXRhYmxlOlwiY29udGVudEVkaXRhYmxlXCJ9LHByb3A6ZnVuY3Rpb24obixyLHUpe3ZhciBlLGYscyxvPW4ubm9kZVR5cGU7aWYobiYmbyE9PTMmJm8hPT04JiZvIT09MilyZXR1cm4gcz1vIT09MXx8IWkuaXNYTUxEb2MobikscyYmKHI9aS5wcm9wRml4W3JdfHxyLGY9aS5wcm9wSG9va3Nbcl0pLHUhPT10P2YmJlwic2V0XCJpbiBmJiYoZT1mLnNldChuLHUscikpIT09dD9lOm5bcl09dTpmJiZcImdldFwiaW4gZiYmKGU9Zi5nZXQobixyKSkhPT1udWxsP2U6bltyXX0scHJvcEhvb2tzOnt0YWJJbmRleDp7Z2V0OmZ1bmN0aW9uKG4pe3ZhciBpPW4uZ2V0QXR0cmlidXRlTm9kZShcInRhYmluZGV4XCIpO3JldHVybiBpJiZpLnNwZWNpZmllZD9wYXJzZUludChpLnZhbHVlLDEwKTphZi50ZXN0KG4ubm9kZU5hbWUpfHx2Zi50ZXN0KG4ubm9kZU5hbWUpJiZuLmhyZWY/MDp0fX19fSk7YWk9e2dldDpmdW5jdGlvbihuLHIpe3ZhciB1LGY9aS5wcm9wKG4scik7cmV0dXJuIGY9PT0hMHx8dHlwZW9mIGYhPVwiYm9vbGVhblwiJiYodT1uLmdldEF0dHJpYnV0ZU5vZGUocikpJiZ1Lm5vZGVWYWx1ZSE9PSExP3IudG9Mb3dlckNhc2UoKTp0fSxzZXQ6ZnVuY3Rpb24obix0LHIpe3ZhciB1O3JldHVybiB0PT09ITE/aS5yZW1vdmVBdHRyKG4scik6KHU9aS5wcm9wRml4W3JdfHxyLHUgaW4gbiYmKG5bdV09ITApLG4uc2V0QXR0cmlidXRlKHIsci50b0xvd2VyQ2FzZSgpKSkscn19O3dpfHwodmk9e25hbWU6ITAsaWQ6ITAsY29vcmRzOiEwfSxzPWkudmFsSG9va3MuYnV0dG9uPXtnZXQ6ZnVuY3Rpb24obixpKXt2YXIgcjtyZXR1cm4gcj1uLmdldEF0dHJpYnV0ZU5vZGUoaSksciYmKHZpW2ldP3IudmFsdWUhPT1cIlwiOnIuc3BlY2lmaWVkKT9yLnZhbHVlOnR9LHNldDpmdW5jdGlvbihuLHQsaSl7dmFyIHU9bi5nZXRBdHRyaWJ1dGVOb2RlKGkpO3JldHVybiB1fHwodT1yLmNyZWF0ZUF0dHJpYnV0ZShpKSxuLnNldEF0dHJpYnV0ZU5vZGUodSkpLHUudmFsdWU9dCtcIlwifX0saS5lYWNoKFtcIndpZHRoXCIsXCJoZWlnaHRcIl0sZnVuY3Rpb24obix0KXtpLmF0dHJIb29rc1t0XT1pLmV4dGVuZChpLmF0dHJIb29rc1t0XSx7c2V0OmZ1bmN0aW9uKG4saSl7aWYoaT09PVwiXCIpcmV0dXJuIG4uc2V0QXR0cmlidXRlKHQsXCJhdXRvXCIpLGl9fSl9KSxpLmF0dHJIb29rcy5jb250ZW50ZWRpdGFibGU9e2dldDpzLmdldCxzZXQ6ZnVuY3Rpb24obix0LGkpe3Q9PT1cIlwiJiYodD1cImZhbHNlXCIpO3Muc2V0KG4sdCxpKX19KTtpLnN1cHBvcnQuaHJlZk5vcm1hbGl6ZWR8fGkuZWFjaChbXCJocmVmXCIsXCJzcmNcIixcIndpZHRoXCIsXCJoZWlnaHRcIl0sZnVuY3Rpb24obixyKXtpLmF0dHJIb29rc1tyXT1pLmV4dGVuZChpLmF0dHJIb29rc1tyXSx7Z2V0OmZ1bmN0aW9uKG4pe3ZhciBpPW4uZ2V0QXR0cmlidXRlKHIsMik7cmV0dXJuIGk9PT1udWxsP3Q6aX19KX0pO2kuc3VwcG9ydC5zdHlsZXx8KGkuYXR0ckhvb2tzLnN0eWxlPXtnZXQ6ZnVuY3Rpb24obil7cmV0dXJuIG4uc3R5bGUuY3NzVGV4dC50b0xvd2VyQ2FzZSgpfHx0fSxzZXQ6ZnVuY3Rpb24obix0KXtyZXR1cm4gbi5zdHlsZS5jc3NUZXh0PXQrXCJcIn19KTtpLnN1cHBvcnQub3B0U2VsZWN0ZWR8fChpLnByb3BIb29rcy5zZWxlY3RlZD1pLmV4dGVuZChpLnByb3BIb29rcy5zZWxlY3RlZCx7Z2V0OmZ1bmN0aW9uKG4pe3ZhciB0PW4ucGFyZW50Tm9kZTtyZXR1cm4gdCYmKHQuc2VsZWN0ZWRJbmRleCx0LnBhcmVudE5vZGUmJnQucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4KSxudWxsfX0pKTtpLnN1cHBvcnQuZW5jdHlwZXx8KGkucHJvcEZpeC5lbmN0eXBlPVwiZW5jb2RpbmdcIik7aS5zdXBwb3J0LmNoZWNrT258fGkuZWFjaChbXCJyYWRpb1wiLFwiY2hlY2tib3hcIl0sZnVuY3Rpb24oKXtpLnZhbEhvb2tzW3RoaXNdPXtnZXQ6ZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0QXR0cmlidXRlKFwidmFsdWVcIik9PT1udWxsP1wib25cIjpuLnZhbHVlfX19KTtpLmVhY2goW1wicmFkaW9cIixcImNoZWNrYm94XCJdLGZ1bmN0aW9uKCl7aS52YWxIb29rc1t0aGlzXT1pLmV4dGVuZChpLnZhbEhvb2tzW3RoaXNdLHtzZXQ6ZnVuY3Rpb24obix0KXtpZihpLmlzQXJyYXkodCkpcmV0dXJuIG4uY2hlY2tlZD1pLmluQXJyYXkoaShuKS52YWwoKSx0KT49MH19KX0pO3ZhciB3dD0vXig/OnRleHRhcmVhfGlucHV0fHNlbGVjdCkkL2ksYmk9L14oW15cXC5dKnwpKD86XFwuKC4rKXwpJC8seWY9Lyg/Ol58XFxzKWhvdmVyKFxcLlxcUyt8KVxcYi8scGY9L15rZXkvLHdmPS9eKD86bW91c2V8Y29udGV4dG1lbnUpfGNsaWNrLyxraT0vXig/OmZvY3VzaW5mb2N1c3xmb2N1c291dGJsdXIpJC8sZGk9ZnVuY3Rpb24obil7cmV0dXJuIGkuZXZlbnQuc3BlY2lhbC5ob3Zlcj9uOm4ucmVwbGFjZSh5ZixcIm1vdXNlZW50ZXIkMSBtb3VzZWxlYXZlJDFcIil9O2kuZXZlbnQ9e2FkZDpmdW5jdGlvbihuLHIsdSxmLGUpe3ZhciBhLHMsdix5LHAsbyxiLGwsdyxjLGg7aWYobi5ub2RlVHlwZSE9PTMmJm4ubm9kZVR5cGUhPT04JiZyJiZ1JiYoYT1pLl9kYXRhKG4pKSl7Zm9yKHUuaGFuZGxlciYmKHc9dSx1PXcuaGFuZGxlcixlPXcuc2VsZWN0b3IpLHUuZ3VpZHx8KHUuZ3VpZD1pLmd1aWQrKyksdj1hLmV2ZW50cyx2fHwoYS5ldmVudHM9dj17fSkscz1hLmhhbmRsZSxzfHwoYS5oYW5kbGU9cz1mdW5jdGlvbihuKXtyZXR1cm4gdHlwZW9mIGkhPVwidW5kZWZpbmVkXCImJighbnx8aS5ldmVudC50cmlnZ2VyZWQhPT1uLnR5cGUpP2kuZXZlbnQuZGlzcGF0Y2guYXBwbHkocy5lbGVtLGFyZ3VtZW50cyk6dH0scy5lbGVtPW4pLHI9aS50cmltKGRpKHIpKS5zcGxpdChcIiBcIikseT0wO3k8ci5sZW5ndGg7eSsrKXA9YmkuZXhlYyhyW3ldKXx8W10sbz1wWzFdLGI9KHBbMl18fFwiXCIpLnNwbGl0KFwiLlwiKS5zb3J0KCksaD1pLmV2ZW50LnNwZWNpYWxbb118fHt9LG89KGU/aC5kZWxlZ2F0ZVR5cGU6aC5iaW5kVHlwZSl8fG8saD1pLmV2ZW50LnNwZWNpYWxbb118fHt9LGw9aS5leHRlbmQoe3R5cGU6byxvcmlnVHlwZTpwWzFdLGRhdGE6ZixoYW5kbGVyOnUsZ3VpZDp1Lmd1aWQsc2VsZWN0b3I6ZSxuZWVkc0NvbnRleHQ6ZSYmaS5leHByLm1hdGNoLm5lZWRzQ29udGV4dC50ZXN0KGUpLG5hbWVzcGFjZTpiLmpvaW4oXCIuXCIpfSx3KSxjPXZbb10sY3x8KGM9dltvXT1bXSxjLmRlbGVnYXRlQ291bnQ9MCxoLnNldHVwJiZoLnNldHVwLmNhbGwobixmLGIscykhPT0hMXx8KG4uYWRkRXZlbnRMaXN0ZW5lcj9uLmFkZEV2ZW50TGlzdGVuZXIobyxzLCExKTpuLmF0dGFjaEV2ZW50JiZuLmF0dGFjaEV2ZW50KFwib25cIitvLHMpKSksaC5hZGQmJihoLmFkZC5jYWxsKG4sbCksbC5oYW5kbGVyLmd1aWR8fChsLmhhbmRsZXIuZ3VpZD11Lmd1aWQpKSxlP2Muc3BsaWNlKGMuZGVsZWdhdGVDb3VudCsrLDAsbCk6Yy5wdXNoKGwpLGkuZXZlbnQuZ2xvYmFsW29dPSEwO249bnVsbH19LGdsb2JhbDp7fSxyZW1vdmU6ZnVuY3Rpb24obix0LHIsdSxmKXt2YXIgbCxwLGUsdyxoLGIsYSx2LGMsbyxzLHk9aS5oYXNEYXRhKG4pJiZpLl9kYXRhKG4pO2lmKHkmJih2PXkuZXZlbnRzKSl7Zm9yKHQ9aS50cmltKGRpKHR8fFwiXCIpKS5zcGxpdChcIiBcIiksbD0wO2w8dC5sZW5ndGg7bCsrKXtpZihwPWJpLmV4ZWModFtsXSl8fFtdLGU9dz1wWzFdLGg9cFsyXSwhZSl7Zm9yKGUgaW4gdilpLmV2ZW50LnJlbW92ZShuLGUrdFtsXSxyLHUsITApO2NvbnRpbnVlfWZvcihjPWkuZXZlbnQuc3BlY2lhbFtlXXx8e30sZT0odT9jLmRlbGVnYXRlVHlwZTpjLmJpbmRUeXBlKXx8ZSxvPXZbZV18fFtdLGI9by5sZW5ndGgsaD1oP25ldyBSZWdFeHAoXCIoXnxcXFxcLilcIitoLnNwbGl0KFwiLlwiKS5zb3J0KCkuam9pbihcIlxcXFwuKD86LipcXFxcLnwpXCIpK1wiKFxcXFwufCQpXCIpOm51bGwsYT0wO2E8by5sZW5ndGg7YSsrKXM9b1thXSwoZnx8dz09PXMub3JpZ1R5cGUpJiYoIXJ8fHIuZ3VpZD09PXMuZ3VpZCkmJighaHx8aC50ZXN0KHMubmFtZXNwYWNlKSkmJighdXx8dT09PXMuc2VsZWN0b3J8fHU9PT1cIioqXCImJnMuc2VsZWN0b3IpJiYoby5zcGxpY2UoYS0tLDEpLHMuc2VsZWN0b3ImJm8uZGVsZWdhdGVDb3VudC0tLGMucmVtb3ZlJiZjLnJlbW92ZS5jYWxsKG4scykpO28ubGVuZ3RoPT09MCYmYiE9PW8ubGVuZ3RoJiYoYy50ZWFyZG93biYmYy50ZWFyZG93bi5jYWxsKG4saCx5LmhhbmRsZSkhPT0hMXx8aS5yZW1vdmVFdmVudChuLGUseS5oYW5kbGUpLGRlbGV0ZSB2W2VdKX1pLmlzRW1wdHlPYmplY3QodikmJihkZWxldGUgeS5oYW5kbGUsaS5yZW1vdmVEYXRhKG4sXCJldmVudHNcIiwhMCkpfX0sY3VzdG9tRXZlbnQ6e2dldERhdGE6ITAsc2V0RGF0YTohMCxjaGFuZ2VEYXRhOiEwfSx0cmlnZ2VyOmZ1bmN0aW9uKHUsZixlLG8pe2lmKCFlfHxlLm5vZGVUeXBlIT09MyYmZS5ub2RlVHlwZSE9PTgpe3ZhciB3LGQsYyxoLGwsdixhLHkscCxrLHM9dS50eXBlfHx1LGI9W107aWYoIWtpLnRlc3QocytpLmV2ZW50LnRyaWdnZXJlZCkmJihzLmluZGV4T2YoXCIhXCIpPj0wJiYocz1zLnNsaWNlKDAsLTEpLGQ9ITApLHMuaW5kZXhPZihcIi5cIik+PTAmJihiPXMuc3BsaXQoXCIuXCIpLHM9Yi5zaGlmdCgpLGIuc29ydCgpKSxlJiYhaS5ldmVudC5jdXN0b21FdmVudFtzXXx8aS5ldmVudC5nbG9iYWxbc10pKXtpZih1PXR5cGVvZiB1PT1cIm9iamVjdFwiP3VbaS5leHBhbmRvXT91Om5ldyBpLkV2ZW50KHMsdSk6bmV3IGkuRXZlbnQocyksdS50eXBlPXMsdS5pc1RyaWdnZXI9ITAsdS5leGNsdXNpdmU9ZCx1Lm5hbWVzcGFjZT1iLmpvaW4oXCIuXCIpLHUubmFtZXNwYWNlX3JlPXUubmFtZXNwYWNlP25ldyBSZWdFeHAoXCIoXnxcXFxcLilcIitiLmpvaW4oXCJcXFxcLig/Oi4qXFxcXC58KVwiKStcIihcXFxcLnwkKVwiKTpudWxsLHY9cy5pbmRleE9mKFwiOlwiKTwwP1wib25cIitzOlwiXCIsIWUpe3c9aS5jYWNoZTtmb3IoYyBpbiB3KXdbY10uZXZlbnRzJiZ3W2NdLmV2ZW50c1tzXSYmaS5ldmVudC50cmlnZ2VyKHUsZix3W2NdLmhhbmRsZS5lbGVtLCEwKTtyZXR1cm59aWYodS5yZXN1bHQ9dCx1LnRhcmdldHx8KHUudGFyZ2V0PWUpLGY9ZiE9bnVsbD9pLm1ha2VBcnJheShmKTpbXSxmLnVuc2hpZnQodSksYT1pLmV2ZW50LnNwZWNpYWxbc118fHt9LCFhLnRyaWdnZXJ8fGEudHJpZ2dlci5hcHBseShlLGYpIT09ITEpe2lmKHA9W1tlLGEuYmluZFR5cGV8fHNdXSwhbyYmIWEubm9CdWJibGUmJiFpLmlzV2luZG93KGUpKXtmb3Ioaz1hLmRlbGVnYXRlVHlwZXx8cyxoPWtpLnRlc3QoaytzKT9lOmUucGFyZW50Tm9kZSxsPWU7aDtoPWgucGFyZW50Tm9kZSlwLnB1c2goW2gsa10pLGw9aDtsPT09KGUub3duZXJEb2N1bWVudHx8cikmJnAucHVzaChbbC5kZWZhdWx0Vmlld3x8bC5wYXJlbnRXaW5kb3d8fG4sa10pfWZvcihjPTA7YzxwLmxlbmd0aCYmIXUuaXNQcm9wYWdhdGlvblN0b3BwZWQoKTtjKyspaD1wW2NdWzBdLHUudHlwZT1wW2NdWzFdLHk9KGkuX2RhdGEoaCxcImV2ZW50c1wiKXx8e30pW3UudHlwZV0mJmkuX2RhdGEoaCxcImhhbmRsZVwiKSx5JiZ5LmFwcGx5KGgsZikseT12JiZoW3ZdLHkmJmkuYWNjZXB0RGF0YShoKSYmeS5hcHBseSYmeS5hcHBseShoLGYpPT09ITEmJnUucHJldmVudERlZmF1bHQoKTtyZXR1cm4gdS50eXBlPXMsb3x8dS5pc0RlZmF1bHRQcmV2ZW50ZWQoKXx8YS5fZGVmYXVsdCYmYS5fZGVmYXVsdC5hcHBseShlLm93bmVyRG9jdW1lbnQsZikhPT0hMXx8cz09PVwiY2xpY2tcIiYmaS5ub2RlTmFtZShlLFwiYVwiKXx8IWkuYWNjZXB0RGF0YShlKXx8diYmZVtzXSYmKHMhPT1cImZvY3VzXCImJnMhPT1cImJsdXJcInx8dS50YXJnZXQub2Zmc2V0V2lkdGghPT0wKSYmIWkuaXNXaW5kb3coZSkmJihsPWVbdl0sbCYmKGVbdl09bnVsbCksaS5ldmVudC50cmlnZ2VyZWQ9cyxlW3NdKCksaS5ldmVudC50cmlnZ2VyZWQ9dCxsJiYoZVt2XT1sKSksdS5yZXN1bHR9fX19LGRpc3BhdGNoOmZ1bmN0aW9uKHIpe3I9aS5ldmVudC5maXgocnx8bi5ldmVudCk7dmFyIGYsYyxlLGwsYSxoLHYsdSxzLHk9KGkuX2RhdGEodGhpcyxcImV2ZW50c1wiKXx8e30pW3IudHlwZV18fFtdLHA9eS5kZWxlZ2F0ZUNvdW50LGs9by5jYWxsKGFyZ3VtZW50cyksZD0hci5leGNsdXNpdmUmJiFyLm5hbWVzcGFjZSx3PWkuZXZlbnQuc3BlY2lhbFtyLnR5cGVdfHx7fSxiPVtdO2lmKGtbMF09cixyLmRlbGVnYXRlVGFyZ2V0PXRoaXMsIXcucHJlRGlzcGF0Y2h8fHcucHJlRGlzcGF0Y2guY2FsbCh0aGlzLHIpIT09ITEpe2lmKHAmJiEoci5idXR0b24mJnIudHlwZT09PVwiY2xpY2tcIikpZm9yKGU9ci50YXJnZXQ7ZSE9dGhpcztlPWUucGFyZW50Tm9kZXx8dGhpcylpZihlLmRpc2FibGVkIT09ITB8fHIudHlwZSE9PVwiY2xpY2tcIil7Zm9yKGE9e30sdj1bXSxmPTA7ZjxwO2YrKyl1PXlbZl0scz11LnNlbGVjdG9yLGFbc109PT10JiYoYVtzXT11Lm5lZWRzQ29udGV4dD9pKHMsdGhpcykuaW5kZXgoZSk+PTA6aS5maW5kKHMsdGhpcyxudWxsLFtlXSkubGVuZ3RoKSxhW3NdJiZ2LnB1c2godSk7di5sZW5ndGgmJmIucHVzaCh7ZWxlbTplLG1hdGNoZXM6dn0pfWZvcih5Lmxlbmd0aD5wJiZiLnB1c2goe2VsZW06dGhpcyxtYXRjaGVzOnkuc2xpY2UocCl9KSxmPTA7ZjxiLmxlbmd0aCYmIXIuaXNQcm9wYWdhdGlvblN0b3BwZWQoKTtmKyspZm9yKGg9YltmXSxyLmN1cnJlbnRUYXJnZXQ9aC5lbGVtLGM9MDtjPGgubWF0Y2hlcy5sZW5ndGgmJiFyLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkKCk7YysrKXU9aC5tYXRjaGVzW2NdLChkfHwhci5uYW1lc3BhY2UmJiF1Lm5hbWVzcGFjZXx8ci5uYW1lc3BhY2VfcmUmJnIubmFtZXNwYWNlX3JlLnRlc3QodS5uYW1lc3BhY2UpKSYmKHIuZGF0YT11LmRhdGEsci5oYW5kbGVPYmo9dSxsPSgoaS5ldmVudC5zcGVjaWFsW3Uub3JpZ1R5cGVdfHx7fSkuaGFuZGxlfHx1LmhhbmRsZXIpLmFwcGx5KGguZWxlbSxrKSxsIT09dCYmKHIucmVzdWx0PWwsbD09PSExJiYoci5wcmV2ZW50RGVmYXVsdCgpLHIuc3RvcFByb3BhZ2F0aW9uKCkpKSk7cmV0dXJuIHcucG9zdERpc3BhdGNoJiZ3LnBvc3REaXNwYXRjaC5jYWxsKHRoaXMsciksci5yZXN1bHR9fSxwcm9wczpcImF0dHJDaGFuZ2UgYXR0ck5hbWUgcmVsYXRlZE5vZGUgc3JjRWxlbWVudCBhbHRLZXkgYnViYmxlcyBjYW5jZWxhYmxlIGN0cmxLZXkgY3VycmVudFRhcmdldCBldmVudFBoYXNlIG1ldGFLZXkgcmVsYXRlZFRhcmdldCBzaGlmdEtleSB0YXJnZXQgdGltZVN0YW1wIHZpZXcgd2hpY2hcIi5zcGxpdChcIiBcIiksZml4SG9va3M6e30sa2V5SG9va3M6e3Byb3BzOlwiY2hhciBjaGFyQ29kZSBrZXkga2V5Q29kZVwiLnNwbGl0KFwiIFwiKSxmaWx0ZXI6ZnVuY3Rpb24obix0KXtyZXR1cm4gbi53aGljaD09bnVsbCYmKG4ud2hpY2g9dC5jaGFyQ29kZSE9bnVsbD90LmNoYXJDb2RlOnQua2V5Q29kZSksbn19LG1vdXNlSG9va3M6e3Byb3BzOlwiYnV0dG9uIGJ1dHRvbnMgY2xpZW50WCBjbGllbnRZIGZyb21FbGVtZW50IG9mZnNldFggb2Zmc2V0WSBwYWdlWCBwYWdlWSBzY3JlZW5YIHNjcmVlblkgdG9FbGVtZW50XCIuc3BsaXQoXCIgXCIpLGZpbHRlcjpmdW5jdGlvbihuLGkpe3ZhciBvLHUsZixlPWkuYnV0dG9uLHM9aS5mcm9tRWxlbWVudDtyZXR1cm4gbi5wYWdlWD09bnVsbCYmaS5jbGllbnRYIT1udWxsJiYobz1uLnRhcmdldC5vd25lckRvY3VtZW50fHxyLHU9by5kb2N1bWVudEVsZW1lbnQsZj1vLmJvZHksbi5wYWdlWD1pLmNsaWVudFgrKHUmJnUuc2Nyb2xsTGVmdHx8ZiYmZi5zY3JvbGxMZWZ0fHwwKS0odSYmdS5jbGllbnRMZWZ0fHxmJiZmLmNsaWVudExlZnR8fDApLG4ucGFnZVk9aS5jbGllbnRZKyh1JiZ1LnNjcm9sbFRvcHx8ZiYmZi5zY3JvbGxUb3B8fDApLSh1JiZ1LmNsaWVudFRvcHx8ZiYmZi5jbGllbnRUb3B8fDApKSwhbi5yZWxhdGVkVGFyZ2V0JiZzJiYobi5yZWxhdGVkVGFyZ2V0PXM9PT1uLnRhcmdldD9pLnRvRWxlbWVudDpzKSxuLndoaWNofHxlPT09dHx8KG4ud2hpY2g9ZSYxPzE6ZSYyPzM6ZSY0PzI6MCksbn19LGZpeDpmdW5jdGlvbihuKXtpZihuW2kuZXhwYW5kb10pcmV0dXJuIG47dmFyIGYsZSx0PW4sdT1pLmV2ZW50LmZpeEhvb2tzW24udHlwZV18fHt9LG89dS5wcm9wcz90aGlzLnByb3BzLmNvbmNhdCh1LnByb3BzKTp0aGlzLnByb3BzO2ZvcihuPWkuRXZlbnQodCksZj1vLmxlbmd0aDtmOyllPW9bLS1mXSxuW2VdPXRbZV07cmV0dXJuIG4udGFyZ2V0fHwobi50YXJnZXQ9dC5zcmNFbGVtZW50fHxyKSxuLnRhcmdldC5ub2RlVHlwZT09PTMmJihuLnRhcmdldD1uLnRhcmdldC5wYXJlbnROb2RlKSxuLm1ldGFLZXk9ISFuLm1ldGFLZXksdS5maWx0ZXI/dS5maWx0ZXIobix0KTpufSxzcGVjaWFsOntsb2FkOntub0J1YmJsZTohMH0sZm9jdXM6e2RlbGVnYXRlVHlwZTpcImZvY3VzaW5cIn0sYmx1cjp7ZGVsZWdhdGVUeXBlOlwiZm9jdXNvdXRcIn0sYmVmb3JldW5sb2FkOntzZXR1cDpmdW5jdGlvbihuLHQscil7aS5pc1dpbmRvdyh0aGlzKSYmKHRoaXMub25iZWZvcmV1bmxvYWQ9cil9LHRlYXJkb3duOmZ1bmN0aW9uKG4sdCl7dGhpcy5vbmJlZm9yZXVubG9hZD09PXQmJih0aGlzLm9uYmVmb3JldW5sb2FkPW51bGwpfX19LHNpbXVsYXRlOmZ1bmN0aW9uKG4sdCxyLHUpe3ZhciBmPWkuZXh0ZW5kKG5ldyBpLkV2ZW50LHIse3R5cGU6bixpc1NpbXVsYXRlZDohMCxvcmlnaW5hbEV2ZW50Ont9fSk7dT9pLmV2ZW50LnRyaWdnZXIoZixudWxsLHQpOmkuZXZlbnQuZGlzcGF0Y2guY2FsbCh0LGYpO2YuaXNEZWZhdWx0UHJldmVudGVkKCkmJnIucHJldmVudERlZmF1bHQoKX19O2kuZXZlbnQuaGFuZGxlPWkuZXZlbnQuZGlzcGF0Y2g7aS5yZW1vdmVFdmVudD1yLnJlbW92ZUV2ZW50TGlzdGVuZXI/ZnVuY3Rpb24obix0LGkpe24ucmVtb3ZlRXZlbnRMaXN0ZW5lciYmbi5yZW1vdmVFdmVudExpc3RlbmVyKHQsaSwhMSl9OmZ1bmN0aW9uKG4sdCxpKXt2YXIgcj1cIm9uXCIrdDtuLmRldGFjaEV2ZW50JiYodHlwZW9mIG5bcl09PVwidW5kZWZpbmVkXCImJihuW3JdPW51bGwpLG4uZGV0YWNoRXZlbnQocixpKSl9O2kuRXZlbnQ9ZnVuY3Rpb24obix0KXtpZighKHRoaXMgaW5zdGFuY2VvZiBpLkV2ZW50KSlyZXR1cm4gbmV3IGkuRXZlbnQobix0KTtuJiZuLnR5cGU/KHRoaXMub3JpZ2luYWxFdmVudD1uLHRoaXMudHlwZT1uLnR5cGUsdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQ9bi5kZWZhdWx0UHJldmVudGVkfHxuLnJldHVyblZhbHVlPT09ITF8fG4uZ2V0UHJldmVudERlZmF1bHQmJm4uZ2V0UHJldmVudERlZmF1bHQoKT9pdDp2KTp0aGlzLnR5cGU9bjt0JiZpLmV4dGVuZCh0aGlzLHQpO3RoaXMudGltZVN0YW1wPW4mJm4udGltZVN0YW1wfHxpLm5vdygpO3RoaXNbaS5leHBhbmRvXT0hMH07aS5FdmVudC5wcm90b3R5cGU9e3ByZXZlbnREZWZhdWx0OmZ1bmN0aW9uKCl7dGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQ9aXQ7dmFyIG49dGhpcy5vcmlnaW5hbEV2ZW50O24mJihuLnByZXZlbnREZWZhdWx0P24ucHJldmVudERlZmF1bHQoKTpuLnJldHVyblZhbHVlPSExKX0sc3RvcFByb3BhZ2F0aW9uOmZ1bmN0aW9uKCl7dGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZD1pdDt2YXIgbj10aGlzLm9yaWdpbmFsRXZlbnQ7biYmKG4uc3RvcFByb3BhZ2F0aW9uJiZuLnN0b3BQcm9wYWdhdGlvbigpLG4uY2FuY2VsQnViYmxlPSEwKX0sc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOmZ1bmN0aW9uKCl7dGhpcy5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZD1pdDt0aGlzLnN0b3BQcm9wYWdhdGlvbigpfSxpc0RlZmF1bHRQcmV2ZW50ZWQ6dixpc1Byb3BhZ2F0aW9uU3RvcHBlZDp2LGlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkOnZ9O2kuZWFjaCh7bW91c2VlbnRlcjpcIm1vdXNlb3ZlclwiLG1vdXNlbGVhdmU6XCJtb3VzZW91dFwifSxmdW5jdGlvbihuLHQpe2kuZXZlbnQuc3BlY2lhbFtuXT17ZGVsZWdhdGVUeXBlOnQsYmluZFR5cGU6dCxoYW5kbGU6ZnVuY3Rpb24obil7dmFyIGYsZT10aGlzLHI9bi5yZWxhdGVkVGFyZ2V0LHU9bi5oYW5kbGVPYmosbz11LnNlbGVjdG9yO3JldHVybiByJiYocj09PWV8fGkuY29udGFpbnMoZSxyKSl8fChuLnR5cGU9dS5vcmlnVHlwZSxmPXUuaGFuZGxlci5hcHBseSh0aGlzLGFyZ3VtZW50cyksbi50eXBlPXQpLGZ9fX0pO2kuc3VwcG9ydC5zdWJtaXRCdWJibGVzfHwoaS5ldmVudC5zcGVjaWFsLnN1Ym1pdD17c2V0dXA6ZnVuY3Rpb24oKXtpZihpLm5vZGVOYW1lKHRoaXMsXCJmb3JtXCIpKXJldHVybiExO2kuZXZlbnQuYWRkKHRoaXMsXCJjbGljay5fc3VibWl0IGtleXByZXNzLl9zdWJtaXRcIixmdW5jdGlvbihuKXt2YXIgdT1uLnRhcmdldCxyPWkubm9kZU5hbWUodSxcImlucHV0XCIpfHxpLm5vZGVOYW1lKHUsXCJidXR0b25cIik/dS5mb3JtOnQ7ciYmIWkuX2RhdGEocixcIl9zdWJtaXRfYXR0YWNoZWRcIikmJihpLmV2ZW50LmFkZChyLFwic3VibWl0Ll9zdWJtaXRcIixmdW5jdGlvbihuKXtuLl9zdWJtaXRfYnViYmxlPSEwfSksaS5fZGF0YShyLFwiX3N1Ym1pdF9hdHRhY2hlZFwiLCEwKSl9KX0scG9zdERpc3BhdGNoOmZ1bmN0aW9uKG4pe24uX3N1Ym1pdF9idWJibGUmJihkZWxldGUgbi5fc3VibWl0X2J1YmJsZSx0aGlzLnBhcmVudE5vZGUmJiFuLmlzVHJpZ2dlciYmaS5ldmVudC5zaW11bGF0ZShcInN1Ym1pdFwiLHRoaXMucGFyZW50Tm9kZSxuLCEwKSl9LHRlYXJkb3duOmZ1bmN0aW9uKCl7aWYoaS5ub2RlTmFtZSh0aGlzLFwiZm9ybVwiKSlyZXR1cm4hMTtpLmV2ZW50LnJlbW92ZSh0aGlzLFwiLl9zdWJtaXRcIil9fSk7aS5zdXBwb3J0LmNoYW5nZUJ1YmJsZXN8fChpLmV2ZW50LnNwZWNpYWwuY2hhbmdlPXtzZXR1cDpmdW5jdGlvbigpe2lmKHd0LnRlc3QodGhpcy5ub2RlTmFtZSkpcmV0dXJuKHRoaXMudHlwZT09PVwiY2hlY2tib3hcInx8dGhpcy50eXBlPT09XCJyYWRpb1wiKSYmKGkuZXZlbnQuYWRkKHRoaXMsXCJwcm9wZXJ0eWNoYW5nZS5fY2hhbmdlXCIsZnVuY3Rpb24obil7bi5vcmlnaW5hbEV2ZW50LnByb3BlcnR5TmFtZT09PVwiY2hlY2tlZFwiJiYodGhpcy5fanVzdF9jaGFuZ2VkPSEwKX0pLGkuZXZlbnQuYWRkKHRoaXMsXCJjbGljay5fY2hhbmdlXCIsZnVuY3Rpb24obil7dGhpcy5fanVzdF9jaGFuZ2VkJiYhbi5pc1RyaWdnZXImJih0aGlzLl9qdXN0X2NoYW5nZWQ9ITEpO2kuZXZlbnQuc2ltdWxhdGUoXCJjaGFuZ2VcIix0aGlzLG4sITApfSkpLCExO2kuZXZlbnQuYWRkKHRoaXMsXCJiZWZvcmVhY3RpdmF0ZS5fY2hhbmdlXCIsZnVuY3Rpb24obil7dmFyIHQ9bi50YXJnZXQ7d3QudGVzdCh0Lm5vZGVOYW1lKSYmIWkuX2RhdGEodCxcIl9jaGFuZ2VfYXR0YWNoZWRcIikmJihpLmV2ZW50LmFkZCh0LFwiY2hhbmdlLl9jaGFuZ2VcIixmdW5jdGlvbihuKXshdGhpcy5wYXJlbnROb2RlfHxuLmlzU2ltdWxhdGVkfHxuLmlzVHJpZ2dlcnx8aS5ldmVudC5zaW11bGF0ZShcImNoYW5nZVwiLHRoaXMucGFyZW50Tm9kZSxuLCEwKX0pLGkuX2RhdGEodCxcIl9jaGFuZ2VfYXR0YWNoZWRcIiwhMCkpfSl9LGhhbmRsZTpmdW5jdGlvbihuKXt2YXIgdD1uLnRhcmdldDtpZih0aGlzIT09dHx8bi5pc1NpbXVsYXRlZHx8bi5pc1RyaWdnZXJ8fHQudHlwZSE9PVwicmFkaW9cIiYmdC50eXBlIT09XCJjaGVja2JveFwiKXJldHVybiBuLmhhbmRsZU9iai5oYW5kbGVyLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0sdGVhcmRvd246ZnVuY3Rpb24oKXtyZXR1cm4gaS5ldmVudC5yZW1vdmUodGhpcyxcIi5fY2hhbmdlXCIpLCF3dC50ZXN0KHRoaXMubm9kZU5hbWUpfX0pO2kuc3VwcG9ydC5mb2N1c2luQnViYmxlc3x8aS5lYWNoKHtmb2N1czpcImZvY3VzaW5cIixibHVyOlwiZm9jdXNvdXRcIn0sZnVuY3Rpb24obix0KXt2YXIgdT0wLGY9ZnVuY3Rpb24obil7aS5ldmVudC5zaW11bGF0ZSh0LG4udGFyZ2V0LGkuZXZlbnQuZml4KG4pLCEwKX07aS5ldmVudC5zcGVjaWFsW3RdPXtzZXR1cDpmdW5jdGlvbigpe3UrKz09MCYmci5hZGRFdmVudExpc3RlbmVyKG4sZiwhMCl9LHRlYXJkb3duOmZ1bmN0aW9uKCl7LS11PT0wJiZyLnJlbW92ZUV2ZW50TGlzdGVuZXIobixmLCEwKX19fSk7aS5mbi5leHRlbmQoe29uOmZ1bmN0aW9uKG4scix1LGYsZSl7dmFyIG8scztpZih0eXBlb2Ygbj09XCJvYmplY3RcIil7dHlwZW9mIHIhPVwic3RyaW5nXCImJih1PXV8fHIscj10KTtmb3IocyBpbiBuKXRoaXMub24ocyxyLHUsbltzXSxlKTtyZXR1cm4gdGhpc31pZih1PT1udWxsJiZmPT1udWxsPyhmPXIsdT1yPXQpOmY9PW51bGwmJih0eXBlb2Ygcj09XCJzdHJpbmdcIj8oZj11LHU9dCk6KGY9dSx1PXIscj10KSksZj09PSExKWY9djtlbHNlIGlmKCFmKXJldHVybiB0aGlzO3JldHVybiBlPT09MSYmKG89ZixmPWZ1bmN0aW9uKG4pe3JldHVybiBpKCkub2ZmKG4pLG8uYXBwbHkodGhpcyxhcmd1bWVudHMpfSxmLmd1aWQ9by5ndWlkfHwoby5ndWlkPWkuZ3VpZCsrKSksdGhpcy5lYWNoKGZ1bmN0aW9uKCl7aS5ldmVudC5hZGQodGhpcyxuLGYsdSxyKX0pfSxvbmU6ZnVuY3Rpb24obix0LGkscil7cmV0dXJuIHRoaXMub24obix0LGksciwxKX0sb2ZmOmZ1bmN0aW9uKG4scix1KXt2YXIgZixlO2lmKG4mJm4ucHJldmVudERlZmF1bHQmJm4uaGFuZGxlT2JqKXJldHVybiBmPW4uaGFuZGxlT2JqLGkobi5kZWxlZ2F0ZVRhcmdldCkub2ZmKGYubmFtZXNwYWNlP2Yub3JpZ1R5cGUrXCIuXCIrZi5uYW1lc3BhY2U6Zi5vcmlnVHlwZSxmLnNlbGVjdG9yLGYuaGFuZGxlciksdGhpcztpZih0eXBlb2Ygbj09XCJvYmplY3RcIil7Zm9yKGUgaW4gbil0aGlzLm9mZihlLHIsbltlXSk7cmV0dXJuIHRoaXN9cmV0dXJuKHI9PT0hMXx8dHlwZW9mIHI9PVwiZnVuY3Rpb25cIikmJih1PXIscj10KSx1PT09ITEmJih1PXYpLHRoaXMuZWFjaChmdW5jdGlvbigpe2kuZXZlbnQucmVtb3ZlKHRoaXMsbix1LHIpfSl9LGJpbmQ6ZnVuY3Rpb24obix0LGkpe3JldHVybiB0aGlzLm9uKG4sbnVsbCx0LGkpfSx1bmJpbmQ6ZnVuY3Rpb24obix0KXtyZXR1cm4gdGhpcy5vZmYobixudWxsLHQpfSxsaXZlOmZ1bmN0aW9uKG4sdCxyKXtpKHRoaXMuY29udGV4dCkub24obix0aGlzLnNlbGVjdG9yLHQscik7cmV0dXJuIHRoaXN9LGRpZTpmdW5jdGlvbihuLHQpe3JldHVybiBpKHRoaXMuY29udGV4dCkub2ZmKG4sdGhpcy5zZWxlY3Rvcnx8XCIqKlwiLHQpLHRoaXN9LGRlbGVnYXRlOmZ1bmN0aW9uKG4sdCxpLHIpe3JldHVybiB0aGlzLm9uKHQsbixpLHIpfSx1bmRlbGVnYXRlOmZ1bmN0aW9uKG4sdCxpKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD09PTE/dGhpcy5vZmYobixcIioqXCIpOnRoaXMub2ZmKHQsbnx8XCIqKlwiLGkpfSx0cmlnZ2VyOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2kuZXZlbnQudHJpZ2dlcihuLHQsdGhpcyl9KX0sdHJpZ2dlckhhbmRsZXI6ZnVuY3Rpb24obix0KXtpZih0aGlzWzBdKXJldHVybiBpLmV2ZW50LnRyaWdnZXIobix0LHRoaXNbMF0sITApfSx0b2dnbGU6ZnVuY3Rpb24obil7dmFyIHQ9YXJndW1lbnRzLHU9bi5ndWlkfHxpLmd1aWQrKyxyPTAsZj1mdW5jdGlvbih1KXt2YXIgZj0oaS5fZGF0YSh0aGlzLFwibGFzdFRvZ2dsZVwiK24uZ3VpZCl8fDApJXI7cmV0dXJuIGkuX2RhdGEodGhpcyxcImxhc3RUb2dnbGVcIituLmd1aWQsZisxKSx1LnByZXZlbnREZWZhdWx0KCksdFtmXS5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fCExfTtmb3IoZi5ndWlkPXU7cjx0Lmxlbmd0aDspdFtyKytdLmd1aWQ9dTtyZXR1cm4gdGhpcy5jbGljayhmKX0saG92ZXI6ZnVuY3Rpb24obix0KXtyZXR1cm4gdGhpcy5tb3VzZWVudGVyKG4pLm1vdXNlbGVhdmUodHx8bil9fSk7aS5lYWNoKFwiYmx1ciBmb2N1cyBmb2N1c2luIGZvY3Vzb3V0IGxvYWQgcmVzaXplIHNjcm9sbCB1bmxvYWQgY2xpY2sgZGJsY2xpY2sgbW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZWVudGVyIG1vdXNlbGVhdmUgY2hhbmdlIHNlbGVjdCBzdWJtaXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBlcnJvciBjb250ZXh0bWVudVwiLnNwbGl0KFwiIFwiKSxmdW5jdGlvbihuLHQpe2kuZm5bdF09ZnVuY3Rpb24obixpKXtyZXR1cm4gaT09bnVsbCYmKGk9bixuPW51bGwpLGFyZ3VtZW50cy5sZW5ndGg+MD90aGlzLm9uKHQsbnVsbCxuLGkpOnRoaXMudHJpZ2dlcih0KX07cGYudGVzdCh0KSYmKGkuZXZlbnQuZml4SG9va3NbdF09aS5ldmVudC5rZXlIb29rcyk7d2YudGVzdCh0KSYmKGkuZXZlbnQuZml4SG9va3NbdF09aS5ldmVudC5tb3VzZUhvb2tzKX0pO1xuLyohXG5cdCAqIFNpenpsZSBDU1MgU2VsZWN0b3IgRW5naW5lXG5cdCAqIENvcHlyaWdodCAyMDEyIGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnNcblx0ICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG5cdCAqIGh0dHA6Ly9zaXp6bGVqcy5jb20vXG5cdCAqL1xuKGZ1bmN0aW9uKG4sdCl7ZnVuY3Rpb24gcihuLHQsaSxyKXtpPWl8fFtdO3Q9dHx8aDt2YXIgZSx1LG8sZixzPXQubm9kZVR5cGU7aWYoIW58fHR5cGVvZiBuIT1cInN0cmluZ1wiKXJldHVybiBpO2lmKHMhPT0xJiZzIT09OSlyZXR1cm5bXTtpZihvPWcodCksIW8mJiFyJiYoZT13aS5leGVjKG4pKSlpZihmPWVbMV0pe2lmKHM9PT05KWlmKHU9dC5nZXRFbGVtZW50QnlJZChmKSx1JiZ1LnBhcmVudE5vZGUpe2lmKHUuaWQ9PT1mKXJldHVybiBpLnB1c2godSksaX1lbHNlIHJldHVybiBpO2Vsc2UgaWYodC5vd25lckRvY3VtZW50JiYodT10Lm93bmVyRG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZikpJiZndCh0LHUpJiZ1LmlkPT09ZilyZXR1cm4gaS5wdXNoKHUpLGl9ZWxzZXtpZihlWzJdKXJldHVybiBwLmFwcGx5KGksdy5jYWxsKHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUobiksMCkpLGk7aWYoKGY9ZVszXSkmJm9pJiZ0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUpcmV0dXJuIHAuYXBwbHkoaSx3LmNhbGwodC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGYpLDApKSxpfXJldHVybiBkdChuLnJlcGxhY2UoaXQsXCIkMVwiKSx0LGkscixvKX1mdW5jdGlvbiBrKG4pe3JldHVybiBmdW5jdGlvbih0KXt2YXIgaT10Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuIGk9PT1cImlucHV0XCImJnQudHlwZT09PW59fWZ1bmN0aW9uIHNpKG4pe3JldHVybiBmdW5jdGlvbih0KXt2YXIgaT10Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuKGk9PT1cImlucHV0XCJ8fGk9PT1cImJ1dHRvblwiKSYmdC50eXBlPT09bn19ZnVuY3Rpb24geShuKXtyZXR1cm4gcyhmdW5jdGlvbih0KXtyZXR1cm4gdD0rdCxzKGZ1bmN0aW9uKGkscil7Zm9yKHZhciB1LGY9bihbXSxpLmxlbmd0aCx0KSxlPWYubGVuZ3RoO2UtLTspaVt1PWZbZV1dJiYoaVt1XT0hKHJbdV09aVt1XSkpfSl9KX1mdW5jdGlvbiB1dChuLHQsaSl7aWYobj09PXQpcmV0dXJuIGk7Zm9yKHZhciByPW4ubmV4dFNpYmxpbmc7cjspe2lmKHI9PT10KXJldHVybi0xO3I9ci5uZXh0U2libGluZ31yZXR1cm4gMX1mdW5jdGlvbiBmdChuLHQpe3ZhciBvLGYsaCxzLGksYyxsLGE9cmlbZV1bbitcIiBcIl07aWYoYSlyZXR1cm4gdD8wOmEuc2xpY2UoMCk7Zm9yKGk9bixjPVtdLGw9dS5wcmVGaWx0ZXI7aTspeyghb3x8KGY9dmkuZXhlYyhpKSkpJiYoZiYmKGk9aS5zbGljZShmWzBdLmxlbmd0aCl8fGkpLGMucHVzaChoPVtdKSk7bz0hMTsoZj15aS5leGVjKGkpKSYmKGgucHVzaChvPW5ldyB0aShmLnNoaWZ0KCkpKSxpPWkuc2xpY2Uoby5sZW5ndGgpLG8udHlwZT1mWzBdLnJlcGxhY2UoaXQsXCIgXCIpKTtmb3IocyBpbiB1LmZpbHRlcikoZj1ydFtzXS5leGVjKGkpKSYmKCFsW3NdfHwoZj1sW3NdKGYpKSkmJihoLnB1c2gobz1uZXcgdGkoZi5zaGlmdCgpKSksaT1pLnNsaWNlKG8ubGVuZ3RoKSxvLnR5cGU9cyxvLm1hdGNoZXM9Zik7aWYoIW8pYnJlYWt9cmV0dXJuIHQ/aS5sZW5ndGg6aT9yLmVycm9yKG4pOnJpKG4sYykuc2xpY2UoMCl9ZnVuY3Rpb24gcHQobix0LGkpe3ZhciByPXQuZGlyLHU9aSYmdC5kaXI9PT1cInBhcmVudE5vZGVcIixmPWNpKys7cmV0dXJuIHQuZmlyc3Q/ZnVuY3Rpb24odCxpLGYpe3doaWxlKHQ9dFtyXSlpZih1fHx0Lm5vZGVUeXBlPT09MSlyZXR1cm4gbih0LGksZil9OmZ1bmN0aW9uKHQsaSxvKXtpZihvKXt3aGlsZSh0PXRbcl0paWYoKHV8fHQubm9kZVR5cGU9PT0xKSYmbih0LGksbykpcmV0dXJuIHR9ZWxzZSBmb3IodmFyIHMsaD10dCtcIiBcIitmK1wiIFwiLGM9aCtvdDt0PXRbcl07KWlmKHV8fHQubm9kZVR5cGU9PT0xKXtpZigocz10W2VdKT09PWMpcmV0dXJuIHQuc2l6c2V0O2lmKHR5cGVvZiBzPT1cInN0cmluZ1wiJiZzLmluZGV4T2YoaCk9PT0wKXtpZih0LnNpenNldClyZXR1cm4gdH1lbHNle2lmKHRbZV09YyxuKHQsaSxvKSlyZXR1cm4gdC5zaXpzZXQ9ITAsdDt0LnNpenNldD0hMX19fX1mdW5jdGlvbiB3dChuKXtyZXR1cm4gbi5sZW5ndGg+MT9mdW5jdGlvbih0LGkscil7Zm9yKHZhciB1PW4ubGVuZ3RoO3UtLTspaWYoIW5bdV0odCxpLHIpKXJldHVybiExO3JldHVybiEwfTpuWzBdfWZ1bmN0aW9uIGV0KG4sdCxpLHIsdSl7Zm9yKHZhciBlLG89W10sZj0wLHM9bi5sZW5ndGgsaD10IT1udWxsO2Y8cztmKyspKGU9bltmXSkmJighaXx8aShlLHIsdSkpJiYoby5wdXNoKGUpLGgmJnQucHVzaChmKSk7cmV0dXJuIG99ZnVuY3Rpb24gYnQobix0LGkscix1LGYpe3JldHVybiByJiYhcltlXSYmKHI9YnQocikpLHUmJiF1W2VdJiYodT1idCh1LGYpKSxzKGZ1bmN0aW9uKGYsZSxvLHMpe3ZhciBsLGMsYSx3PVtdLHk9W10sYj1lLmxlbmd0aCxrPWZ8fHJyKHR8fFwiKlwiLG8ubm9kZVR5cGU/W29dOm8sW10pLHY9biYmKGZ8fCF0KT9ldChrLHcsbixvLHMpOmssaD1pP3V8fChmP246Ynx8cik/W106ZTp2O2lmKGkmJmkodixoLG8scykscilmb3IobD1ldChoLHkpLHIobCxbXSxvLHMpLGM9bC5sZW5ndGg7Yy0tOykoYT1sW2NdKSYmKGhbeVtjXV09ISh2W3lbY11dPWEpKTtpZihmKXtpZih1fHxuKXtpZih1KXtmb3IobD1bXSxjPWgubGVuZ3RoO2MtLTspKGE9aFtjXSkmJmwucHVzaCh2W2NdPWEpO3UobnVsbCxoPVtdLGwscyl9Zm9yKGM9aC5sZW5ndGg7Yy0tOykoYT1oW2NdKSYmKGw9dT9sdC5jYWxsKGYsYSk6d1tjXSk+LTEmJihmW2xdPSEoZVtsXT1hKSl9fWVsc2UgaD1ldChoPT09ZT9oLnNwbGljZShiLGgubGVuZ3RoKTpoKSx1P3UobnVsbCxlLGgscyk6cC5hcHBseShlLGgpfSl9ZnVuY3Rpb24ga3Qobil7Zm9yKHZhciBzLHIsaSxvPW4ubGVuZ3RoLGg9dS5yZWxhdGl2ZVtuWzBdLnR5cGVdLGM9aHx8dS5yZWxhdGl2ZVtcIiBcIl0sdD1oPzE6MCxsPXB0KGZ1bmN0aW9uKG4pe3JldHVybiBuPT09c30sYywhMCksYT1wdChmdW5jdGlvbihuKXtyZXR1cm4gbHQuY2FsbChzLG4pPi0xfSxjLCEwKSxmPVtmdW5jdGlvbihuLHQsaSl7cmV0dXJuIWgmJihpfHx0IT09bnQpfHwoKHM9dCkubm9kZVR5cGU/bChuLHQsaSk6YShuLHQsaSkpfV07dDxvO3QrKylpZihyPXUucmVsYXRpdmVbblt0XS50eXBlXSlmPVtwdCh3dChmKSxyKV07ZWxzZXtpZihyPXUuZmlsdGVyW25bdF0udHlwZV0uYXBwbHkobnVsbCxuW3RdLm1hdGNoZXMpLHJbZV0pe2ZvcihpPSsrdDtpPG87aSsrKWlmKHUucmVsYXRpdmVbbltpXS50eXBlXSlicmVhaztyZXR1cm4gYnQodD4xJiZ3dChmKSx0PjEmJm4uc2xpY2UoMCx0LTEpLmpvaW4oXCJcIikucmVwbGFjZShpdCxcIiQxXCIpLHIsdDxpJiZrdChuLnNsaWNlKHQsaSkpLGk8byYma3Qobj1uLnNsaWNlKGkpKSxpPG8mJm4uam9pbihcIlwiKSl9Zi5wdXNoKHIpfXJldHVybiB3dChmKX1mdW5jdGlvbiBpcihuLHQpe3ZhciBmPXQubGVuZ3RoPjAsZT1uLmxlbmd0aD4wLGk9ZnVuY3Rpb24obyxzLGMsbCxhKXt2YXIgeSxiLGssdz1bXSxkPTAsdj1cIjBcIixnPW8mJltdLGl0PWEhPW51bGwscnQ9bnQsZnQ9b3x8ZSYmdS5maW5kLlRBRyhcIipcIixhJiZzLnBhcmVudE5vZGV8fHMpLHV0PXR0Kz1ydD09bnVsbD8xOk1hdGguRTtmb3IoaXQmJihudD1zIT09aCYmcyxvdD1pLmVsKTsoeT1mdFt2XSkhPW51bGw7disrKXtpZihlJiZ5KXtmb3IoYj0wO2s9bltiXTtiKyspaWYoayh5LHMsYykpe2wucHVzaCh5KTticmVha31pdCYmKHR0PXV0LG90PSsraS5lbCl9ZiYmKCh5PSFrJiZ5KSYmZC0tLG8mJmcucHVzaCh5KSl9aWYoZCs9dixmJiZ2IT09ZCl7Zm9yKGI9MDtrPXRbYl07YisrKWsoZyx3LHMsYyk7aWYobyl7aWYoZD4wKXdoaWxlKHYtLSlnW3ZdfHx3W3ZdfHwod1t2XT1saS5jYWxsKGwpKTt3PWV0KHcpfXAuYXBwbHkobCx3KTtpdCYmIW8mJncubGVuZ3RoPjAmJmQrdC5sZW5ndGg+MSYmci51bmlxdWVTb3J0KGwpfXJldHVybiBpdCYmKHR0PXV0LG50PXJ0KSxnfTtyZXR1cm4gaS5lbD0wLGY/cyhpKTppfWZ1bmN0aW9uIHJyKG4sdCxpKXtmb3IodmFyIHU9MCxmPXQubGVuZ3RoO3U8Zjt1KyspcihuLHRbdV0saSk7cmV0dXJuIGl9ZnVuY3Rpb24gZHQobix0LGkscixmKXt2YXIgbyxlLHMsYyxsLGg9ZnQobiksYT1oLmxlbmd0aDtpZighciYmaC5sZW5ndGg9PT0xKXtpZihlPWhbMF09aFswXS5zbGljZSgwKSxlLmxlbmd0aD4yJiYocz1lWzBdKS50eXBlPT09XCJJRFwiJiZ0Lm5vZGVUeXBlPT09OSYmIWYmJnUucmVsYXRpdmVbZVsxXS50eXBlXSl7aWYodD11LmZpbmQuSUQocy5tYXRjaGVzWzBdLnJlcGxhY2UodixcIlwiKSx0LGYpWzBdLCF0KXJldHVybiBpO249bi5zbGljZShlLnNoaWZ0KCkubGVuZ3RoKX1mb3Iobz1ydC5QT1MudGVzdChuKT8tMTplLmxlbmd0aC0xO28+PTA7by0tKXtpZihzPWVbb10sdS5yZWxhdGl2ZVtjPXMudHlwZV0pYnJlYWs7aWYoKGw9dS5maW5kW2NdKSYmKHI9bChzLm1hdGNoZXNbMF0ucmVwbGFjZSh2LFwiXCIpLHl0LnRlc3QoZVswXS50eXBlKSYmdC5wYXJlbnROb2RlfHx0LGYpKSl7aWYoZS5zcGxpY2UobywxKSxuPXIubGVuZ3RoJiZlLmpvaW4oXCJcIiksIW4pcmV0dXJuIHAuYXBwbHkoaSx3LmNhbGwociwwKSksaTticmVha319fXJldHVybiBodChuLGgpKHIsdCxmLGkseXQudGVzdChuKSksaX1mdW5jdGlvbiBoaSgpe312YXIgb3Qsc3QsdSxkLGcsZ3QsaHQsY3QsYixudCxuaT0hMCxjPVwidW5kZWZpbmVkXCIsZT0oXCJzaXpjYWNoZVwiK01hdGgucmFuZG9tKCkpLnJlcGxhY2UoXCIuXCIsXCJcIiksdGk9U3RyaW5nLGg9bi5kb2N1bWVudCxvPWguZG9jdW1lbnRFbGVtZW50LHR0PTAsY2k9MCxsaT1bXS5wb3AscD1bXS5wdXNoLHc9W10uc2xpY2UsbHQ9W10uaW5kZXhPZnx8ZnVuY3Rpb24obil7Zm9yKHZhciB0PTAsaT10aGlzLmxlbmd0aDt0PGk7dCsrKWlmKHRoaXNbdF09PT1uKXJldHVybiB0O3JldHVybi0xfSxzPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIG5bZV09dD09bnVsbHx8dCxufSxhdD1mdW5jdGlvbigpe3ZhciBuPXt9LHQ9W107cmV0dXJuIHMoZnVuY3Rpb24oaSxyKXtyZXR1cm4gdC5wdXNoKGkpPnUuY2FjaGVMZW5ndGgmJmRlbGV0ZSBuW3Quc2hpZnQoKV0sbltpK1wiIFwiXT1yfSxuKX0saWk9YXQoKSxyaT1hdCgpLHVpPWF0KCksZj1cIltcXFxceDIwXFxcXHRcXFxcclxcXFxuXFxcXGZdXCIsYT1cIig/OlxcXFxcXFxcLnxbLVxcXFx3XXxbXlxcXFx4MDAtXFxcXHhhMF0pK1wiLGFpPWEucmVwbGFjZShcIndcIixcIncjXCIpLGZpPVwiXFxcXFtcIitmK1wiKihcIithK1wiKVwiK2YrXCIqKD86KFsqXiR8IX5dPz0pXCIrZitcIiooPzooWydcXFwiXSkoKD86XFxcXFxcXFwufFteXFxcXFxcXFxdKSo/KVxcXFwzfChcIithaStcIil8KXwpXCIrZitcIipcXFxcXVwiLHZ0PVwiOihcIithK1wiKSg/OlxcXFwoKD86KFsnXFxcIl0pKCg/OlxcXFxcXFxcLnxbXlxcXFxcXFxcXSkqPylcXFxcMnwoW14oKVtcXFxcXV0qfCg/Oig/OlwiK2ZpK1wiKXxbXjpdfFxcXFxcXFxcLikqfC4qKSlcXFxcKXwpXCIsZWk9XCI6KGV2ZW58b2RkfGVxfGd0fGx0fG50aHxmaXJzdHxsYXN0KSg/OlxcXFwoXCIrZitcIiooKD86LVxcXFxkKT9cXFxcZCopXCIrZitcIipcXFxcKXwpKD89W14tXXwkKVwiLGl0PW5ldyBSZWdFeHAoXCJeXCIrZitcIit8KCg/Ol58W15cXFxcXFxcXF0pKD86XFxcXFxcXFwuKSopXCIrZitcIiskXCIsXCJnXCIpLHZpPW5ldyBSZWdFeHAoXCJeXCIrZitcIiosXCIrZitcIipcIikseWk9bmV3IFJlZ0V4cChcIl5cIitmK1wiKihbXFxcXHgyMFxcXFx0XFxcXHJcXFxcblxcXFxmPit+XSlcIitmK1wiKlwiKSxwaT1uZXcgUmVnRXhwKHZ0KSx3aT0vXig/OiMoW1xcd1xcLV0rKXwoXFx3Kyl8XFwuKFtcXHdcXC1dKykpJC8seXQ9L1tcXHgyMFxcdFxcclxcblxcZl0qWyt+XS8sYmk9L2hcXGQvaSxraT0vaW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbi9pLHY9L1xcXFwoPyFcXFxcKS9nLHJ0PXtJRDpuZXcgUmVnRXhwKFwiXiMoXCIrYStcIilcIiksQ0xBU1M6bmV3IFJlZ0V4cChcIl5cXFxcLihcIithK1wiKVwiKSxOQU1FOm5ldyBSZWdFeHAoXCJeXFxcXFtuYW1lPVsnXFxcIl0/KFwiK2ErXCIpWydcXFwiXT9cXFxcXVwiKSxUQUc6bmV3IFJlZ0V4cChcIl4oXCIrYS5yZXBsYWNlKFwid1wiLFwidypcIikrXCIpXCIpLEFUVFI6bmV3IFJlZ0V4cChcIl5cIitmaSksUFNFVURPOm5ldyBSZWdFeHAoXCJeXCIrdnQpLFBPUzpuZXcgUmVnRXhwKGVpLFwiaVwiKSxDSElMRDpuZXcgUmVnRXhwKFwiXjoob25seXxudGh8Zmlyc3R8bGFzdCktY2hpbGQoPzpcXFxcKFwiK2YrXCIqKGV2ZW58b2RkfCgoWystXXwpKFxcXFxkKilufClcIitmK1wiKig/OihbKy1dfClcIitmK1wiKihcXFxcZCspfCkpXCIrZitcIipcXFxcKXwpXCIsXCJpXCIpLG5lZWRzQ29udGV4dDpuZXcgUmVnRXhwKFwiXlwiK2YrXCIqWz4rfl18XCIrZWksXCJpXCIpfSxsPWZ1bmN0aW9uKG4pe3ZhciB0PWguY3JlYXRlRWxlbWVudChcImRpdlwiKTt0cnl7cmV0dXJuIG4odCl9Y2F0Y2goaSl7cmV0dXJuITF9ZmluYWxseXt0PW51bGx9fSxkaT1sKGZ1bmN0aW9uKG4pe3JldHVybiBuLmFwcGVuZENoaWxkKGguY3JlYXRlQ29tbWVudChcIlwiKSksIW4uZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCIqXCIpLmxlbmd0aH0pLGdpPWwoZnVuY3Rpb24obil7cmV0dXJuIG4uaW5uZXJIVE1MPVwiPGEgaHJlZj0nIyc+PFxcL2E+XCIsbi5maXJzdENoaWxkJiZ0eXBlb2Ygbi5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSE9PWMmJm4uZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoXCJocmVmXCIpPT09XCIjXCJ9KSxucj1sKGZ1bmN0aW9uKG4pe24uaW5uZXJIVE1MPVwiPHNlbGVjdD48XFwvc2VsZWN0PlwiO3ZhciB0PXR5cGVvZiBuLmxhc3RDaGlsZC5nZXRBdHRyaWJ1dGUoXCJtdWx0aXBsZVwiKTtyZXR1cm4gdCE9PVwiYm9vbGVhblwiJiZ0IT09XCJzdHJpbmdcIn0pLG9pPWwoZnVuY3Rpb24obil7cmV0dXJuKG4uaW5uZXJIVE1MPVwiPGRpdiBjbGFzcz0naGlkZGVuIGUnPjxcXC9kaXY+PGRpdiBjbGFzcz0naGlkZGVuJz48XFwvZGl2PlwiLCFuLmdldEVsZW1lbnRzQnlDbGFzc05hbWV8fCFuLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJlXCIpLmxlbmd0aCk/ITE6KG4ubGFzdENoaWxkLmNsYXNzTmFtZT1cImVcIixuLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJlXCIpLmxlbmd0aD09PTIpfSksdHI9bChmdW5jdGlvbihuKXtuLmlkPWUrMDtuLmlubmVySFRNTD1cIjxhIG5hbWU9J1wiK2UrXCInPjxcXC9hPjxkaXYgbmFtZT0nXCIrZStcIic+PFxcL2Rpdj5cIjtvLmluc2VydEJlZm9yZShuLG8uZmlyc3RDaGlsZCk7dmFyIHQ9aC5nZXRFbGVtZW50c0J5TmFtZSYmaC5nZXRFbGVtZW50c0J5TmFtZShlKS5sZW5ndGg9PT0yK2guZ2V0RWxlbWVudHNCeU5hbWUoZSswKS5sZW5ndGg7cmV0dXJuIHN0PSFoLmdldEVsZW1lbnRCeUlkKGUpLG8ucmVtb3ZlQ2hpbGQobiksdH0pO3RyeXt3LmNhbGwoby5jaGlsZE5vZGVzLDApWzBdLm5vZGVUeXBlfWNhdGNoKHVyKXt3PWZ1bmN0aW9uKG4pe2Zvcih2YXIgdCxpPVtdO3Q9dGhpc1tuXTtuKyspaS5wdXNoKHQpO3JldHVybiBpfX1yLm1hdGNoZXM9ZnVuY3Rpb24obix0KXtyZXR1cm4gcihuLG51bGwsbnVsbCx0KX07ci5tYXRjaGVzU2VsZWN0b3I9ZnVuY3Rpb24obix0KXtyZXR1cm4gcih0LG51bGwsbnVsbCxbbl0pLmxlbmd0aD4wfTtkPXIuZ2V0VGV4dD1mdW5jdGlvbihuKXt2YXIgcixpPVwiXCIsdT0wLHQ9bi5ub2RlVHlwZTtpZih0KXtpZih0PT09MXx8dD09PTl8fHQ9PT0xMSl7aWYodHlwZW9mIG4udGV4dENvbnRlbnQ9PVwic3RyaW5nXCIpcmV0dXJuIG4udGV4dENvbnRlbnQ7Zm9yKG49bi5maXJzdENoaWxkO247bj1uLm5leHRTaWJsaW5nKWkrPWQobil9ZWxzZSBpZih0PT09M3x8dD09PTQpcmV0dXJuIG4ubm9kZVZhbHVlfWVsc2UgZm9yKDtyPW5bdV07dSsrKWkrPWQocik7cmV0dXJuIGl9O2c9ci5pc1hNTD1mdW5jdGlvbihuKXt2YXIgdD1uJiYobi5vd25lckRvY3VtZW50fHxuKS5kb2N1bWVudEVsZW1lbnQ7cmV0dXJuIHQ/dC5ub2RlTmFtZSE9PVwiSFRNTFwiOiExfTtndD1yLmNvbnRhaW5zPW8uY29udGFpbnM/ZnVuY3Rpb24obix0KXt2YXIgcj1uLm5vZGVUeXBlPT09OT9uLmRvY3VtZW50RWxlbWVudDpuLGk9dCYmdC5wYXJlbnROb2RlO3JldHVybiBuPT09aXx8ISEoaSYmaS5ub2RlVHlwZT09PTEmJnIuY29udGFpbnMmJnIuY29udGFpbnMoaSkpfTpvLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uP2Z1bmN0aW9uKG4sdCl7cmV0dXJuIHQmJiEhKG4uY29tcGFyZURvY3VtZW50UG9zaXRpb24odCkmMTYpfTpmdW5jdGlvbihuLHQpe3doaWxlKHQ9dC5wYXJlbnROb2RlKWlmKHQ9PT1uKXJldHVybiEwO3JldHVybiExfTtyLmF0dHI9ZnVuY3Rpb24obix0KXt2YXIgaSxyPWcobik7cmV0dXJuKHJ8fCh0PXQudG9Mb3dlckNhc2UoKSksaT11LmF0dHJIYW5kbGVbdF0pP2kobik6cnx8bnI/bi5nZXRBdHRyaWJ1dGUodCk6KGk9bi5nZXRBdHRyaWJ1dGVOb2RlKHQpLGk/dHlwZW9mIG5bdF09PVwiYm9vbGVhblwiP25bdF0/dDpudWxsOmkuc3BlY2lmaWVkP2kudmFsdWU6bnVsbDpudWxsKX07dT1yLnNlbGVjdG9ycz17Y2FjaGVMZW5ndGg6NTAsY3JlYXRlUHNldWRvOnMsbWF0Y2g6cnQsYXR0ckhhbmRsZTpnaT97fTp7aHJlZjpmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRBdHRyaWJ1dGUoXCJocmVmXCIsMil9LHR5cGU6ZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0QXR0cmlidXRlKFwidHlwZVwiKX19LGZpbmQ6e0lEOnN0P2Z1bmN0aW9uKG4sdCxpKXtpZih0eXBlb2YgdC5nZXRFbGVtZW50QnlJZCE9PWMmJiFpKXt2YXIgcj10LmdldEVsZW1lbnRCeUlkKG4pO3JldHVybiByJiZyLnBhcmVudE5vZGU/W3JdOltdfX06ZnVuY3Rpb24obixpLHIpe2lmKHR5cGVvZiBpLmdldEVsZW1lbnRCeUlkIT09YyYmIXIpe3ZhciB1PWkuZ2V0RWxlbWVudEJ5SWQobik7cmV0dXJuIHU/dS5pZD09PW58fHR5cGVvZiB1LmdldEF0dHJpYnV0ZU5vZGUhPT1jJiZ1LmdldEF0dHJpYnV0ZU5vZGUoXCJpZFwiKS52YWx1ZT09PW4/W3VdOnQ6W119fSxUQUc6ZGk/ZnVuY3Rpb24obix0KXtpZih0eXBlb2YgdC5nZXRFbGVtZW50c0J5VGFnTmFtZSE9PWMpcmV0dXJuIHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUobil9OmZ1bmN0aW9uKG4sdCl7dmFyIGY9dC5nZXRFbGVtZW50c0J5VGFnTmFtZShuKSxpLHIsdTtpZihuPT09XCIqXCIpe2ZvcihyPVtdLHU9MDtpPWZbdV07dSsrKWkubm9kZVR5cGU9PT0xJiZyLnB1c2goaSk7cmV0dXJuIHJ9cmV0dXJuIGZ9LE5BTUU6dHImJmZ1bmN0aW9uKG4sdCl7aWYodHlwZW9mIHQuZ2V0RWxlbWVudHNCeU5hbWUhPT1jKXJldHVybiB0LmdldEVsZW1lbnRzQnlOYW1lKG5hbWUpfSxDTEFTUzpvaSYmZnVuY3Rpb24obix0LGkpe2lmKHR5cGVvZiB0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUhPT1jJiYhaSlyZXR1cm4gdC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKG4pfX0scmVsYXRpdmU6e1wiPlwiOntkaXI6XCJwYXJlbnROb2RlXCIsZmlyc3Q6ITB9LFwiIFwiOntkaXI6XCJwYXJlbnROb2RlXCJ9LFwiK1wiOntkaXI6XCJwcmV2aW91c1NpYmxpbmdcIixmaXJzdDohMH0sXCJ+XCI6e2RpcjpcInByZXZpb3VzU2libGluZ1wifX0scHJlRmlsdGVyOntBVFRSOmZ1bmN0aW9uKG4pe3JldHVybiBuWzFdPW5bMV0ucmVwbGFjZSh2LFwiXCIpLG5bM109KG5bNF18fG5bNV18fFwiXCIpLnJlcGxhY2UodixcIlwiKSxuWzJdPT09XCJ+PVwiJiYoblszXT1cIiBcIituWzNdK1wiIFwiKSxuLnNsaWNlKDAsNCl9LENISUxEOmZ1bmN0aW9uKG4pe3JldHVybiBuWzFdPW5bMV0udG9Mb3dlckNhc2UoKSxuWzFdPT09XCJudGhcIj8oblsyXXx8ci5lcnJvcihuWzBdKSxuWzNdPSsoblszXT9uWzRdKyhuWzVdfHwxKToyKihuWzJdPT09XCJldmVuXCJ8fG5bMl09PT1cIm9kZFwiKSksbls0XT0rKG5bNl0rbls3XXx8blsyXT09PVwib2RkXCIpKTpuWzJdJiZyLmVycm9yKG5bMF0pLG59LFBTRVVETzpmdW5jdGlvbihuKXt2YXIgdCxpO3JldHVybiBydC5DSElMRC50ZXN0KG5bMF0pP251bGw6KG5bM10/blsyXT1uWzNdOih0PW5bNF0pJiYocGkudGVzdCh0KSYmKGk9ZnQodCwhMCkpJiYoaT10LmluZGV4T2YoXCIpXCIsdC5sZW5ndGgtaSktdC5sZW5ndGgpJiYodD10LnNsaWNlKDAsaSksblswXT1uWzBdLnNsaWNlKDAsaSkpLG5bMl09dCksbi5zbGljZSgwLDMpKX19LGZpbHRlcjp7SUQ6c3Q/ZnVuY3Rpb24obil7cmV0dXJuIG49bi5yZXBsYWNlKHYsXCJcIiksZnVuY3Rpb24odCl7cmV0dXJuIHQuZ2V0QXR0cmlidXRlKFwiaWRcIik9PT1ufX06ZnVuY3Rpb24obil7cmV0dXJuIG49bi5yZXBsYWNlKHYsXCJcIiksZnVuY3Rpb24odCl7dmFyIGk9dHlwZW9mIHQuZ2V0QXR0cmlidXRlTm9kZSE9PWMmJnQuZ2V0QXR0cmlidXRlTm9kZShcImlkXCIpO3JldHVybiBpJiZpLnZhbHVlPT09bn19LFRBRzpmdW5jdGlvbihuKXtyZXR1cm4gbj09PVwiKlwiP2Z1bmN0aW9uKCl7cmV0dXJuITB9OihuPW4ucmVwbGFjZSh2LFwiXCIpLnRvTG93ZXJDYXNlKCksZnVuY3Rpb24odCl7cmV0dXJuIHQubm9kZU5hbWUmJnQubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PW59KX0sQ0xBU1M6ZnVuY3Rpb24obil7dmFyIHQ9aWlbZV1bbitcIiBcIl07cmV0dXJuIHR8fCh0PW5ldyBSZWdFeHAoXCIoXnxcIitmK1wiKVwiK24rXCIoXCIrZitcInwkKVwiKSkmJmlpKG4sZnVuY3Rpb24obil7cmV0dXJuIHQudGVzdChuLmNsYXNzTmFtZXx8dHlwZW9mIG4uZ2V0QXR0cmlidXRlIT09YyYmbi5nZXRBdHRyaWJ1dGUoXCJjbGFzc1wiKXx8XCJcIil9KX0sQVRUUjpmdW5jdGlvbihuLHQsaSl7cmV0dXJuIGZ1bmN0aW9uKHUpe3ZhciBmPXIuYXR0cih1LG4pO3JldHVybiBmPT1udWxsP3Q9PT1cIiE9XCI6dD8oZis9XCJcIix0PT09XCI9XCI/Zj09PWk6dD09PVwiIT1cIj9mIT09aTp0PT09XCJePVwiP2kmJmYuaW5kZXhPZihpKT09PTA6dD09PVwiKj1cIj9pJiZmLmluZGV4T2YoaSk+LTE6dD09PVwiJD1cIj9pJiZmLnN1YnN0cihmLmxlbmd0aC1pLmxlbmd0aCk9PT1pOnQ9PT1cIn49XCI/KFwiIFwiK2YrXCIgXCIpLmluZGV4T2YoaSk+LTE6dD09PVwifD1cIj9mPT09aXx8Zi5zdWJzdHIoMCxpLmxlbmd0aCsxKT09PWkrXCItXCI6ITEpOiEwfX0sQ0hJTEQ6ZnVuY3Rpb24obix0LGkscil7cmV0dXJuIG49PT1cIm50aFwiP2Z1bmN0aW9uKG4pe3ZhciB0LHUsZj1uLnBhcmVudE5vZGU7aWYoaT09PTEmJnI9PT0wKXJldHVybiEwO2lmKGYpZm9yKHU9MCx0PWYuZmlyc3RDaGlsZDt0O3Q9dC5uZXh0U2libGluZylpZih0Lm5vZGVUeXBlPT09MSYmKHUrKyxuPT09dCkpYnJlYWs7cmV0dXJuIHUtPXIsdT09PWl8fHUlaT09MCYmdS9pPj0wfTpmdW5jdGlvbih0KXt2YXIgaT10O3N3aXRjaChuKXtjYXNlXCJvbmx5XCI6Y2FzZVwiZmlyc3RcIjp3aGlsZShpPWkucHJldmlvdXNTaWJsaW5nKWlmKGkubm9kZVR5cGU9PT0xKXJldHVybiExO2lmKG49PT1cImZpcnN0XCIpcmV0dXJuITA7aT10O2Nhc2VcImxhc3RcIjp3aGlsZShpPWkubmV4dFNpYmxpbmcpaWYoaS5ub2RlVHlwZT09PTEpcmV0dXJuITE7cmV0dXJuITB9fX0sUFNFVURPOmZ1bmN0aW9uKG4sdCl7dmFyIGYsaT11LnBzZXVkb3Nbbl18fHUuc2V0RmlsdGVyc1tuLnRvTG93ZXJDYXNlKCldfHxyLmVycm9yKFwidW5zdXBwb3J0ZWQgcHNldWRvOiBcIituKTtyZXR1cm4gaVtlXT9pKHQpOmkubGVuZ3RoPjE/KGY9W24sbixcIlwiLHRdLHUuc2V0RmlsdGVycy5oYXNPd25Qcm9wZXJ0eShuLnRvTG93ZXJDYXNlKCkpP3MoZnVuY3Rpb24obixyKXtmb3IodmFyIHUsZj1pKG4sdCksZT1mLmxlbmd0aDtlLS07KXU9bHQuY2FsbChuLGZbZV0pLG5bdV09IShyW3VdPWZbZV0pfSk6ZnVuY3Rpb24obil7cmV0dXJuIGkobiwwLGYpfSk6aX19LHBzZXVkb3M6e25vdDpzKGZ1bmN0aW9uKG4pe3ZhciBpPVtdLHI9W10sdD1odChuLnJlcGxhY2UoaXQsXCIkMVwiKSk7cmV0dXJuIHRbZV0/cyhmdW5jdGlvbihuLGkscix1KXtmb3IodmFyIGUsbz10KG4sbnVsbCx1LFtdKSxmPW4ubGVuZ3RoO2YtLTspKGU9b1tmXSkmJihuW2ZdPSEoaVtmXT1lKSl9KTpmdW5jdGlvbihuLHUsZil7cmV0dXJuIGlbMF09bix0KGksbnVsbCxmLHIpLCFyLnBvcCgpfX0pLGhhczpzKGZ1bmN0aW9uKG4pe3JldHVybiBmdW5jdGlvbih0KXtyZXR1cm4gcihuLHQpLmxlbmd0aD4wfX0pLGNvbnRhaW5zOnMoZnVuY3Rpb24obil7cmV0dXJuIGZ1bmN0aW9uKHQpe3JldHVybih0LnRleHRDb250ZW50fHx0LmlubmVyVGV4dHx8ZCh0KSkuaW5kZXhPZihuKT4tMX19KSxlbmFibGVkOmZ1bmN0aW9uKG4pe3JldHVybiBuLmRpc2FibGVkPT09ITF9LGRpc2FibGVkOmZ1bmN0aW9uKG4pe3JldHVybiBuLmRpc2FibGVkPT09ITB9LGNoZWNrZWQ6ZnVuY3Rpb24obil7dmFyIHQ9bi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybiB0PT09XCJpbnB1dFwiJiYhIW4uY2hlY2tlZHx8dD09PVwib3B0aW9uXCImJiEhbi5zZWxlY3RlZH0sc2VsZWN0ZWQ6ZnVuY3Rpb24obil7cmV0dXJuIG4ucGFyZW50Tm9kZSYmbi5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXgsbi5zZWxlY3RlZD09PSEwfSxwYXJlbnQ6ZnVuY3Rpb24obil7cmV0dXJuIXUucHNldWRvcy5lbXB0eShuKX0sZW1wdHk6ZnVuY3Rpb24obil7dmFyIHQ7Zm9yKG49bi5maXJzdENoaWxkO247KXtpZihuLm5vZGVOYW1lPlwiQFwifHwodD1uLm5vZGVUeXBlKT09PTN8fHQ9PT00KXJldHVybiExO249bi5uZXh0U2libGluZ31yZXR1cm4hMH0saGVhZGVyOmZ1bmN0aW9uKG4pe3JldHVybiBiaS50ZXN0KG4ubm9kZU5hbWUpfSx0ZXh0OmZ1bmN0aW9uKG4pe3ZhciB0LGk7cmV0dXJuIG4ubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PVwiaW5wdXRcIiYmKHQ9bi50eXBlKT09PVwidGV4dFwiJiYoKGk9bi5nZXRBdHRyaWJ1dGUoXCJ0eXBlXCIpKT09bnVsbHx8aS50b0xvd2VyQ2FzZSgpPT09dCl9LHJhZGlvOmsoXCJyYWRpb1wiKSxjaGVja2JveDprKFwiY2hlY2tib3hcIiksZmlsZTprKFwiZmlsZVwiKSxwYXNzd29yZDprKFwicGFzc3dvcmRcIiksaW1hZ2U6ayhcImltYWdlXCIpLHN1Ym1pdDpzaShcInN1Ym1pdFwiKSxyZXNldDpzaShcInJlc2V0XCIpLGJ1dHRvbjpmdW5jdGlvbihuKXt2YXIgdD1uLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuIHQ9PT1cImlucHV0XCImJm4udHlwZT09PVwiYnV0dG9uXCJ8fHQ9PT1cImJ1dHRvblwifSxpbnB1dDpmdW5jdGlvbihuKXtyZXR1cm4ga2kudGVzdChuLm5vZGVOYW1lKX0sZm9jdXM6ZnVuY3Rpb24obil7dmFyIHQ9bi5vd25lckRvY3VtZW50O3JldHVybiBuPT09dC5hY3RpdmVFbGVtZW50JiYoIXQuaGFzRm9jdXN8fHQuaGFzRm9jdXMoKSkmJiEhKG4udHlwZXx8bi5ocmVmfHx+bi50YWJJbmRleCl9LGFjdGl2ZTpmdW5jdGlvbihuKXtyZXR1cm4gbj09PW4ub3duZXJEb2N1bWVudC5hY3RpdmVFbGVtZW50fSxmaXJzdDp5KGZ1bmN0aW9uKCl7cmV0dXJuWzBdfSksbGFzdDp5KGZ1bmN0aW9uKG4sdCl7cmV0dXJuW3QtMV19KSxlcTp5KGZ1bmN0aW9uKG4sdCxpKXtyZXR1cm5baTwwP2krdDppXX0pLGV2ZW46eShmdW5jdGlvbihuLHQpe2Zvcih2YXIgaT0wO2k8dDtpKz0yKW4ucHVzaChpKTtyZXR1cm4gbn0pLG9kZDp5KGZ1bmN0aW9uKG4sdCl7Zm9yKHZhciBpPTE7aTx0O2krPTIpbi5wdXNoKGkpO3JldHVybiBufSksbHQ6eShmdW5jdGlvbihuLHQsaSl7Zm9yKHZhciByPWk8MD9pK3Q6aTstLXI+PTA7KW4ucHVzaChyKTtyZXR1cm4gbn0pLGd0OnkoZnVuY3Rpb24obix0LGkpe2Zvcih2YXIgcj1pPDA/aSt0Omk7KytyPHQ7KW4ucHVzaChyKTtyZXR1cm4gbn0pfX07Y3Q9by5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbj9mdW5jdGlvbihuLHQpe3JldHVybiBuPT09dD8oYj0hMCwwKTooIW4uY29tcGFyZURvY3VtZW50UG9zaXRpb258fCF0LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uP24uY29tcGFyZURvY3VtZW50UG9zaXRpb246bi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbih0KSY0KT8tMToxfTpmdW5jdGlvbihuLHQpe3ZhciBpO2lmKG49PT10KXJldHVybiBiPSEwLDA7aWYobi5zb3VyY2VJbmRleCYmdC5zb3VyY2VJbmRleClyZXR1cm4gbi5zb3VyY2VJbmRleC10LnNvdXJjZUluZGV4O3ZhciBlLGgsdT1bXSxmPVtdLG89bi5wYXJlbnROb2RlLHM9dC5wYXJlbnROb2RlLHI9bztpZihvPT09cylyZXR1cm4gdXQobix0KTtpZihvKXtpZighcylyZXR1cm4gMX1lbHNlIHJldHVybi0xO3doaWxlKHIpdS51bnNoaWZ0KHIpLHI9ci5wYXJlbnROb2RlO2ZvcihyPXM7cjspZi51bnNoaWZ0KHIpLHI9ci5wYXJlbnROb2RlO2ZvcihlPXUubGVuZ3RoLGg9Zi5sZW5ndGgsaT0wO2k8ZSYmaTxoO2krKylpZih1W2ldIT09ZltpXSlyZXR1cm4gdXQodVtpXSxmW2ldKTtyZXR1cm4gaT09PWU/dXQobixmW2ldLC0xKTp1dCh1W2ldLHQsMSl9O1swLDBdLnNvcnQoY3QpO25pPSFiO3IudW5pcXVlU29ydD1mdW5jdGlvbihuKXt2YXIgcix1PVtdLHQ9MSxpPTA7aWYoYj1uaSxuLnNvcnQoY3QpLGIpe2Zvcig7cj1uW3RdO3QrKylyPT09blt0LTFdJiYoaT11LnB1c2godCkpO3doaWxlKGktLSluLnNwbGljZSh1W2ldLDEpfXJldHVybiBufTtyLmVycm9yPWZ1bmN0aW9uKG4pe3Rocm93IG5ldyBFcnJvcihcIlN5bnRheCBlcnJvciwgdW5yZWNvZ25pemVkIGV4cHJlc3Npb246IFwiK24pO307aHQ9ci5jb21waWxlPWZ1bmN0aW9uKG4sdCl7dmFyIHIsdT1bXSxmPVtdLGk9dWlbZV1bbitcIiBcIl07aWYoIWkpe2Zvcih0fHwodD1mdChuKSkscj10Lmxlbmd0aDtyLS07KWk9a3QodFtyXSksaVtlXT91LnB1c2goaSk6Zi5wdXNoKGkpO2k9dWkobixpcihmLHUpKX1yZXR1cm4gaX07aC5xdWVyeVNlbGVjdG9yQWxsJiZmdW5jdGlvbigpe3ZhciB1LHM9ZHQsaD0vJ3xcXFxcL2csYz0vXFw9W1xceDIwXFx0XFxyXFxuXFxmXSooW14nXCJcXF1dKilbXFx4MjBcXHRcXHJcXG5cXGZdKlxcXS9nLG49W1wiOmZvY3VzXCJdLHQ9W1wiOmFjdGl2ZVwiXSxpPW8ubWF0Y2hlc1NlbGVjdG9yfHxvLm1vek1hdGNoZXNTZWxlY3Rvcnx8by53ZWJraXRNYXRjaGVzU2VsZWN0b3J8fG8ub01hdGNoZXNTZWxlY3Rvcnx8by5tc01hdGNoZXNTZWxlY3RvcjtsKGZ1bmN0aW9uKHQpe3QuaW5uZXJIVE1MPVwiPHNlbGVjdD48b3B0aW9uIHNlbGVjdGVkPScnPjxcXC9vcHRpb24+PFxcL3NlbGVjdD5cIjt0LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbc2VsZWN0ZWRdXCIpLmxlbmd0aHx8bi5wdXNoKFwiXFxcXFtcIitmK1wiKig/OmNoZWNrZWR8ZGlzYWJsZWR8aXNtYXB8bXVsdGlwbGV8cmVhZG9ubHl8c2VsZWN0ZWR8dmFsdWUpXCIpO3QucXVlcnlTZWxlY3RvckFsbChcIjpjaGVja2VkXCIpLmxlbmd0aHx8bi5wdXNoKFwiOmNoZWNrZWRcIil9KTtsKGZ1bmN0aW9uKHQpe3QuaW5uZXJIVE1MPVwiPHAgdGVzdD0nJz48XFwvcD5cIjt0LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbdGVzdF49JyddXCIpLmxlbmd0aCYmbi5wdXNoKFwiWypeJF09XCIrZitcIiooPzpcXFwiXFxcInwnJylcIik7dC5pbm5lckhUTUw9XCI8aW5wdXQgdHlwZT0naGlkZGVuJy8+XCI7dC5xdWVyeVNlbGVjdG9yQWxsKFwiOmVuYWJsZWRcIikubGVuZ3RofHxuLnB1c2goXCI6ZW5hYmxlZFwiLFwiOmRpc2FibGVkXCIpfSk7bj1uZXcgUmVnRXhwKG4uam9pbihcInxcIikpO2R0PWZ1bmN0aW9uKHQsaSxyLHUsZil7aWYoIXUmJiFmJiYhbi50ZXN0KHQpKXt2YXIgbyxsLGE9ITAsYz1lLHk9aSx2PWkubm9kZVR5cGU9PT05JiZ0O2lmKGkubm9kZVR5cGU9PT0xJiZpLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkhPT1cIm9iamVjdFwiKXtmb3Iobz1mdCh0KSwoYT1pLmdldEF0dHJpYnV0ZShcImlkXCIpKT9jPWEucmVwbGFjZShoLFwiXFxcXCQmXCIpOmkuc2V0QXR0cmlidXRlKFwiaWRcIixjKSxjPVwiW2lkPSdcIitjK1wiJ10gXCIsbD1vLmxlbmd0aDtsLS07KW9bbF09YytvW2xdLmpvaW4oXCJcIik7eT15dC50ZXN0KHQpJiZpLnBhcmVudE5vZGV8fGk7dj1vLmpvaW4oXCIsXCIpfWlmKHYpdHJ5e3JldHVybiBwLmFwcGx5KHIsdy5jYWxsKHkucXVlcnlTZWxlY3RvckFsbCh2KSwwKSkscn1jYXRjaChiKXt9ZmluYWxseXthfHxpLnJlbW92ZUF0dHJpYnV0ZShcImlkXCIpfX1yZXR1cm4gcyh0LGkscix1LGYpfTtpJiYobChmdW5jdGlvbihuKXt1PWkuY2FsbChuLFwiZGl2XCIpO3RyeXtpLmNhbGwobixcIlt0ZXN0IT0nJ106c2l6emxlXCIpO3QucHVzaChcIiE9XCIsdnQpfWNhdGNoKHIpe319KSx0PW5ldyBSZWdFeHAodC5qb2luKFwifFwiKSksci5tYXRjaGVzU2VsZWN0b3I9ZnVuY3Rpb24oZixlKXtpZihlPWUucmVwbGFjZShjLFwiPSckMSddXCIpLCFnKGYpJiYhdC50ZXN0KGUpJiYhbi50ZXN0KGUpKXRyeXt2YXIgbz1pLmNhbGwoZixlKTtpZihvfHx1fHxmLmRvY3VtZW50JiZmLmRvY3VtZW50Lm5vZGVUeXBlIT09MTEpcmV0dXJuIG99Y2F0Y2gocyl7fXJldHVybiByKGUsbnVsbCxudWxsLFtmXSkubGVuZ3RoPjB9KX0oKTt1LnBzZXVkb3MubnRoPXUucHNldWRvcy5lcTt1LmZpbHRlcnM9aGkucHJvdG90eXBlPXUucHNldWRvczt1LnNldEZpbHRlcnM9bmV3IGhpO3IuYXR0cj1pLmF0dHI7aS5maW5kPXI7aS5leHByPXIuc2VsZWN0b3JzO2kuZXhwcltcIjpcIl09aS5leHByLnBzZXVkb3M7aS51bmlxdWU9ci51bmlxdWVTb3J0O2kudGV4dD1yLmdldFRleHQ7aS5pc1hNTERvYz1yLmlzWE1MO2kuY29udGFpbnM9ci5jb250YWluc30pKG4pO3ZhciBiZj0vVW50aWwkLyxrZj0vXig/OnBhcmVudHN8cHJldig/OlVudGlsfEFsbCkpLyxkZj0vXi5bXjojXFxbXFwuLF0qJC8sZ2k9aS5leHByLm1hdGNoLm5lZWRzQ29udGV4dCxnZj17Y2hpbGRyZW46ITAsY29udGVudHM6ITAsbmV4dDohMCxwcmV2OiEwfTtpLmZuLmV4dGVuZCh7ZmluZDpmdW5jdGlvbihuKXt2YXIgdCxmLG8sdSxlLHIscz10aGlzO2lmKHR5cGVvZiBuIT1cInN0cmluZ1wiKXJldHVybiBpKG4pLmZpbHRlcihmdW5jdGlvbigpe2Zvcih0PTAsZj1zLmxlbmd0aDt0PGY7dCsrKWlmKGkuY29udGFpbnMoc1t0XSx0aGlzKSlyZXR1cm4hMH0pO2ZvcihyPXRoaXMucHVzaFN0YWNrKFwiXCIsXCJmaW5kXCIsbiksdD0wLGY9dGhpcy5sZW5ndGg7dDxmO3QrKylpZihvPXIubGVuZ3RoLGkuZmluZChuLHRoaXNbdF0sciksdD4wKWZvcih1PW87dTxyLmxlbmd0aDt1KyspZm9yKGU9MDtlPG87ZSsrKWlmKHJbZV09PT1yW3VdKXtyLnNwbGljZSh1LS0sMSk7YnJlYWt9cmV0dXJuIHJ9LGhhczpmdW5jdGlvbihuKXt2YXIgdCxyPWkobix0aGlzKSx1PXIubGVuZ3RoO3JldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbigpe2Zvcih0PTA7dDx1O3QrKylpZihpLmNvbnRhaW5zKHRoaXMsclt0XSkpcmV0dXJuITB9KX0sbm90OmZ1bmN0aW9uKG4pe3JldHVybiB0aGlzLnB1c2hTdGFjayh0cih0aGlzLG4sITEpLFwibm90XCIsbil9LGZpbHRlcjpmdW5jdGlvbihuKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2sodHIodGhpcyxuLCEwKSxcImZpbHRlclwiLG4pfSxpczpmdW5jdGlvbihuKXtyZXR1cm4hIW4mJih0eXBlb2Ygbj09XCJzdHJpbmdcIj9naS50ZXN0KG4pP2kobix0aGlzLmNvbnRleHQpLmluZGV4KHRoaXNbMF0pPj0wOmkuZmlsdGVyKG4sdGhpcykubGVuZ3RoPjA6dGhpcy5maWx0ZXIobikubGVuZ3RoPjApfSxjbG9zZXN0OmZ1bmN0aW9uKG4sdCl7Zm9yKHZhciByLGY9MCxvPXRoaXMubGVuZ3RoLHU9W10sZT1naS50ZXN0KG4pfHx0eXBlb2YgbiE9XCJzdHJpbmdcIj9pKG4sdHx8dGhpcy5jb250ZXh0KTowO2Y8bztmKyspZm9yKHI9dGhpc1tmXTtyJiZyLm93bmVyRG9jdW1lbnQmJnIhPT10JiZyLm5vZGVUeXBlIT09MTE7KXtpZihlP2UuaW5kZXgocik+LTE6aS5maW5kLm1hdGNoZXNTZWxlY3RvcihyLG4pKXt1LnB1c2gocik7YnJlYWt9cj1yLnBhcmVudE5vZGV9cmV0dXJuIHU9dS5sZW5ndGg+MT9pLnVuaXF1ZSh1KTp1LHRoaXMucHVzaFN0YWNrKHUsXCJjbG9zZXN0XCIsbil9LGluZGV4OmZ1bmN0aW9uKG4pe3JldHVybiBuP3R5cGVvZiBuPT1cInN0cmluZ1wiP2kuaW5BcnJheSh0aGlzWzBdLGkobikpOmkuaW5BcnJheShuLmpxdWVyeT9uWzBdOm4sdGhpcyk6dGhpc1swXSYmdGhpc1swXS5wYXJlbnROb2RlP3RoaXMucHJldkFsbCgpLmxlbmd0aDotMX0sYWRkOmZ1bmN0aW9uKG4sdCl7dmFyIHU9dHlwZW9mIG49PVwic3RyaW5nXCI/aShuLHQpOmkubWFrZUFycmF5KG4mJm4ubm9kZVR5cGU/W25dOm4pLHI9aS5tZXJnZSh0aGlzLmdldCgpLHUpO3JldHVybiB0aGlzLnB1c2hTdGFjayhrKHVbMF0pfHxrKHJbMF0pP3I6aS51bmlxdWUocikpfSxhZGRCYWNrOmZ1bmN0aW9uKG4pe3JldHVybiB0aGlzLmFkZChuPT1udWxsP3RoaXMucHJldk9iamVjdDp0aGlzLnByZXZPYmplY3QuZmlsdGVyKG4pKX19KTtpLmZuLmFuZFNlbGY9aS5mbi5hZGRCYWNrO2kuZWFjaCh7cGFyZW50OmZ1bmN0aW9uKG4pe3ZhciB0PW4ucGFyZW50Tm9kZTtyZXR1cm4gdCYmdC5ub2RlVHlwZSE9PTExP3Q6bnVsbH0scGFyZW50czpmdW5jdGlvbihuKXtyZXR1cm4gaS5kaXIobixcInBhcmVudE5vZGVcIil9LHBhcmVudHNVbnRpbDpmdW5jdGlvbihuLHQscil7cmV0dXJuIGkuZGlyKG4sXCJwYXJlbnROb2RlXCIscil9LG5leHQ6ZnVuY3Rpb24obil7cmV0dXJuIG5yKG4sXCJuZXh0U2libGluZ1wiKX0scHJldjpmdW5jdGlvbihuKXtyZXR1cm4gbnIobixcInByZXZpb3VzU2libGluZ1wiKX0sbmV4dEFsbDpmdW5jdGlvbihuKXtyZXR1cm4gaS5kaXIobixcIm5leHRTaWJsaW5nXCIpfSxwcmV2QWxsOmZ1bmN0aW9uKG4pe3JldHVybiBpLmRpcihuLFwicHJldmlvdXNTaWJsaW5nXCIpfSxuZXh0VW50aWw6ZnVuY3Rpb24obix0LHIpe3JldHVybiBpLmRpcihuLFwibmV4dFNpYmxpbmdcIixyKX0scHJldlVudGlsOmZ1bmN0aW9uKG4sdCxyKXtyZXR1cm4gaS5kaXIobixcInByZXZpb3VzU2libGluZ1wiLHIpfSxzaWJsaW5nczpmdW5jdGlvbihuKXtyZXR1cm4gaS5zaWJsaW5nKChuLnBhcmVudE5vZGV8fHt9KS5maXJzdENoaWxkLG4pfSxjaGlsZHJlbjpmdW5jdGlvbihuKXtyZXR1cm4gaS5zaWJsaW5nKG4uZmlyc3RDaGlsZCl9LGNvbnRlbnRzOmZ1bmN0aW9uKG4pe3JldHVybiBpLm5vZGVOYW1lKG4sXCJpZnJhbWVcIik/bi5jb250ZW50RG9jdW1lbnR8fG4uY29udGVudFdpbmRvdy5kb2N1bWVudDppLm1lcmdlKFtdLG4uY2hpbGROb2Rlcyl9fSxmdW5jdGlvbihuLHQpe2kuZm5bbl09ZnVuY3Rpb24ocix1KXt2YXIgZj1pLm1hcCh0aGlzLHQscik7cmV0dXJuIGJmLnRlc3Qobil8fCh1PXIpLHUmJnR5cGVvZiB1PT1cInN0cmluZ1wiJiYoZj1pLmZpbHRlcih1LGYpKSxmPXRoaXMubGVuZ3RoPjEmJiFnZltuXT9pLnVuaXF1ZShmKTpmLHRoaXMubGVuZ3RoPjEmJmtmLnRlc3QobikmJihmPWYucmV2ZXJzZSgpKSx0aGlzLnB1c2hTdGFjayhmLG4sby5jYWxsKGFyZ3VtZW50cykuam9pbihcIixcIikpfX0pO2kuZXh0ZW5kKHtmaWx0ZXI6ZnVuY3Rpb24obix0LHIpe3JldHVybiByJiYobj1cIjpub3QoXCIrbitcIilcIiksdC5sZW5ndGg9PT0xP2kuZmluZC5tYXRjaGVzU2VsZWN0b3IodFswXSxuKT9bdFswXV06W106aS5maW5kLm1hdGNoZXMobix0KX0sZGlyOmZ1bmN0aW9uKG4scix1KXtmb3IodmFyIGU9W10sZj1uW3JdO2YmJmYubm9kZVR5cGUhPT05JiYodT09PXR8fGYubm9kZVR5cGUhPT0xfHwhaShmKS5pcyh1KSk7KWYubm9kZVR5cGU9PT0xJiZlLnB1c2goZiksZj1mW3JdO3JldHVybiBlfSxzaWJsaW5nOmZ1bmN0aW9uKG4sdCl7Zm9yKHZhciBpPVtdO247bj1uLm5leHRTaWJsaW5nKW4ubm9kZVR5cGU9PT0xJiZuIT09dCYmaS5wdXNoKG4pO3JldHVybiBpfX0pO3ZhciBycj1cImFiYnJ8YXJ0aWNsZXxhc2lkZXxhdWRpb3xiZGl8Y2FudmFzfGRhdGF8ZGF0YWxpc3R8ZGV0YWlsc3xmaWdjYXB0aW9ufGZpZ3VyZXxmb290ZXJ8aGVhZGVyfGhncm91cHxtYXJrfG1ldGVyfG5hdnxvdXRwdXR8cHJvZ3Jlc3N8c2VjdGlvbnxzdW1tYXJ5fHRpbWV8dmlkZW9cIixuZT0vIGpRdWVyeVxcZCs9XCIoPzpudWxsfFxcZCspXCIvZyxidD0vXlxccysvLHVyPS88KD8hYXJlYXxicnxjb2x8ZW1iZWR8aHJ8aW1nfGlucHV0fGxpbmt8bWV0YXxwYXJhbSkoKFtcXHc6XSspW14+XSopXFwvPi9naSxmcj0vPChbXFx3Ol0rKS8sdGU9Lzx0Ym9keS9pLGllPS88fCYjP1xcdys7LyxyZT0vPCg/OnNjcmlwdHxzdHlsZXxsaW5rKS9pLHVlPS88KD86c2NyaXB0fG9iamVjdHxlbWJlZHxvcHRpb258c3R5bGUpL2ksa3Q9bmV3IFJlZ0V4cChcIjwoPzpcIitycitcIilbXFxcXHMvPl1cIixcImlcIiksZXI9L14oPzpjaGVja2JveHxyYWRpbykkLyxvcj0vY2hlY2tlZFxccyooPzpbXj1dfD1cXHMqLmNoZWNrZWQuKS9pLGZlPS9cXC8oamF2YXxlY21hKXNjcmlwdC9pLGVlPS9eXFxzKjwhKD86XFxbQ0RBVEFcXFt8XFwtXFwtKXxbXFxdXFwtXXsyfT5cXHMqJC9nLGU9e29wdGlvbjpbMSxcIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz5cIixcIjxcXC9zZWxlY3Q+XCJdLGxlZ2VuZDpbMSxcIjxmaWVsZHNldD5cIixcIjxcXC9maWVsZHNldD5cIl0sdGhlYWQ6WzEsXCI8dGFibGU+XCIsXCI8XFwvdGFibGU+XCJdLHRyOlsyLFwiPHRhYmxlPjx0Ym9keT5cIixcIjxcXC90Ym9keT48XFwvdGFibGU+XCJdLHRkOlszLFwiPHRhYmxlPjx0Ym9keT48dHI+XCIsXCI8XFwvdHI+PFxcL3Rib2R5PjxcXC90YWJsZT5cIl0sY29sOlsyLFwiPHRhYmxlPjx0Ym9keT48XFwvdGJvZHk+PGNvbGdyb3VwPlwiLFwiPFxcL2NvbGdyb3VwPjxcXC90YWJsZT5cIl0sYXJlYTpbMSxcIjxtYXA+XCIsXCI8XFwvbWFwPlwiXSxfZGVmYXVsdDpbMCxcIlwiLFwiXCJdfSxzcj1pcihyKSxkdD1zci5hcHBlbmRDaGlsZChyLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIikpO2Uub3B0Z3JvdXA9ZS5vcHRpb247ZS50Ym9keT1lLnRmb290PWUuY29sZ3JvdXA9ZS5jYXB0aW9uPWUudGhlYWQ7ZS50aD1lLnRkO2kuc3VwcG9ydC5odG1sU2VyaWFsaXplfHwoZS5fZGVmYXVsdD1bMSxcIlg8ZGl2PlwiLFwiPFxcL2Rpdj5cIl0pO2kuZm4uZXh0ZW5kKHt0ZXh0OmZ1bmN0aW9uKG4pe3JldHVybiBpLmFjY2Vzcyh0aGlzLGZ1bmN0aW9uKG4pe3JldHVybiBuPT09dD9pLnRleHQodGhpcyk6dGhpcy5lbXB0eSgpLmFwcGVuZCgodGhpc1swXSYmdGhpc1swXS5vd25lckRvY3VtZW50fHxyKS5jcmVhdGVUZXh0Tm9kZShuKSl9LG51bGwsbixhcmd1bWVudHMubGVuZ3RoKX0sd3JhcEFsbDpmdW5jdGlvbihuKXtpZihpLmlzRnVuY3Rpb24obikpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbih0KXtpKHRoaXMpLndyYXBBbGwobi5jYWxsKHRoaXMsdCkpfSk7aWYodGhpc1swXSl7dmFyIHQ9aShuLHRoaXNbMF0ub3duZXJEb2N1bWVudCkuZXEoMCkuY2xvbmUoITApO3RoaXNbMF0ucGFyZW50Tm9kZSYmdC5pbnNlcnRCZWZvcmUodGhpc1swXSk7dC5tYXAoZnVuY3Rpb24oKXtmb3IodmFyIG49dGhpcztuLmZpcnN0Q2hpbGQmJm4uZmlyc3RDaGlsZC5ub2RlVHlwZT09PTE7KW49bi5maXJzdENoaWxkO3JldHVybiBufSkuYXBwZW5kKHRoaXMpfXJldHVybiB0aGlzfSx3cmFwSW5uZXI6ZnVuY3Rpb24obil7cmV0dXJuIGkuaXNGdW5jdGlvbihuKT90aGlzLmVhY2goZnVuY3Rpb24odCl7aSh0aGlzKS53cmFwSW5uZXIobi5jYWxsKHRoaXMsdCkpfSk6dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIHQ9aSh0aGlzKSxyPXQuY29udGVudHMoKTtyLmxlbmd0aD9yLndyYXBBbGwobik6dC5hcHBlbmQobil9KX0sd3JhcDpmdW5jdGlvbihuKXt2YXIgdD1pLmlzRnVuY3Rpb24obik7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihyKXtpKHRoaXMpLndyYXBBbGwodD9uLmNhbGwodGhpcyxyKTpuKX0pfSx1bndyYXA6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wYXJlbnQoKS5lYWNoKGZ1bmN0aW9uKCl7aS5ub2RlTmFtZSh0aGlzLFwiYm9keVwiKXx8aSh0aGlzKS5yZXBsYWNlV2l0aCh0aGlzLmNoaWxkTm9kZXMpfSkuZW5kKCl9LGFwcGVuZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywhMCxmdW5jdGlvbihuKXsodGhpcy5ub2RlVHlwZT09PTF8fHRoaXMubm9kZVR5cGU9PT0xMSkmJnRoaXMuYXBwZW5kQ2hpbGQobil9KX0scHJlcGVuZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywhMCxmdW5jdGlvbihuKXsodGhpcy5ub2RlVHlwZT09PTF8fHRoaXMubm9kZVR5cGU9PT0xMSkmJnRoaXMuaW5zZXJ0QmVmb3JlKG4sdGhpcy5maXJzdENoaWxkKX0pfSxiZWZvcmU6ZnVuY3Rpb24oKXtpZighayh0aGlzWzBdKSlyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsITEsZnVuY3Rpb24obil7dGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShuLHRoaXMpfSk7aWYoYXJndW1lbnRzLmxlbmd0aCl7dmFyIG49aS5jbGVhbihhcmd1bWVudHMpO3JldHVybiB0aGlzLnB1c2hTdGFjayhpLm1lcmdlKG4sdGhpcyksXCJiZWZvcmVcIix0aGlzLnNlbGVjdG9yKX19LGFmdGVyOmZ1bmN0aW9uKCl7aWYoIWsodGhpc1swXSkpcmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCExLGZ1bmN0aW9uKG4pe3RoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobix0aGlzLm5leHRTaWJsaW5nKX0pO2lmKGFyZ3VtZW50cy5sZW5ndGgpe3ZhciBuPWkuY2xlYW4oYXJndW1lbnRzKTtyZXR1cm4gdGhpcy5wdXNoU3RhY2soaS5tZXJnZSh0aGlzLG4pLFwiYWZ0ZXJcIix0aGlzLnNlbGVjdG9yKX19LHJlbW92ZTpmdW5jdGlvbihuLHQpe2Zvcih2YXIgcix1PTA7KHI9dGhpc1t1XSkhPW51bGw7dSsrKSghbnx8aS5maWx0ZXIobixbcl0pLmxlbmd0aCkmJih0fHxyLm5vZGVUeXBlIT09MXx8KGkuY2xlYW5EYXRhKHIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCIqXCIpKSxpLmNsZWFuRGF0YShbcl0pKSxyLnBhcmVudE5vZGUmJnIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChyKSk7cmV0dXJuIHRoaXN9LGVtcHR5OmZ1bmN0aW9uKCl7Zm9yKHZhciBuLHQ9MDsobj10aGlzW3RdKSE9bnVsbDt0KyspZm9yKG4ubm9kZVR5cGU9PT0xJiZpLmNsZWFuRGF0YShuLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKSk7bi5maXJzdENoaWxkOyluLnJlbW92ZUNoaWxkKG4uZmlyc3RDaGlsZCk7cmV0dXJuIHRoaXN9LGNsb25lOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIG49bj09bnVsbD8hMTpuLHQ9dD09bnVsbD9uOnQsdGhpcy5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gaS5jbG9uZSh0aGlzLG4sdCl9KX0saHRtbDpmdW5jdGlvbihuKXtyZXR1cm4gaS5hY2Nlc3ModGhpcyxmdW5jdGlvbihuKXt2YXIgcj10aGlzWzBdfHx7fSx1PTAsZj10aGlzLmxlbmd0aDtpZihuPT09dClyZXR1cm4gci5ub2RlVHlwZT09PTE/ci5pbm5lckhUTUwucmVwbGFjZShuZSxcIlwiKTp0O2lmKHR5cGVvZiBuPT1cInN0cmluZ1wiJiYhcmUudGVzdChuKSYmKGkuc3VwcG9ydC5odG1sU2VyaWFsaXplfHwha3QudGVzdChuKSkmJihpLnN1cHBvcnQubGVhZGluZ1doaXRlc3BhY2V8fCFidC50ZXN0KG4pKSYmIWVbKGZyLmV4ZWMobil8fFtcIlwiLFwiXCJdKVsxXS50b0xvd2VyQ2FzZSgpXSl7bj1uLnJlcGxhY2UodXIsXCI8JDE+PFxcLyQyPlwiKTt0cnl7Zm9yKDt1PGY7dSsrKXI9dGhpc1t1XXx8e30sci5ub2RlVHlwZT09PTEmJihpLmNsZWFuRGF0YShyLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKSksci5pbm5lckhUTUw9bik7cj0wfWNhdGNoKG8pe319ciYmdGhpcy5lbXB0eSgpLmFwcGVuZChuKX0sbnVsbCxuLGFyZ3VtZW50cy5sZW5ndGgpfSxyZXBsYWNlV2l0aDpmdW5jdGlvbihuKXtyZXR1cm4gayh0aGlzWzBdKT90aGlzLmxlbmd0aD90aGlzLnB1c2hTdGFjayhpKGkuaXNGdW5jdGlvbihuKT9uKCk6biksXCJyZXBsYWNlV2l0aFwiLG4pOnRoaXM6aS5pc0Z1bmN0aW9uKG4pP3RoaXMuZWFjaChmdW5jdGlvbih0KXt2YXIgcj1pKHRoaXMpLHU9ci5odG1sKCk7ci5yZXBsYWNlV2l0aChuLmNhbGwodGhpcyx0LHUpKX0pOih0eXBlb2YgbiE9XCJzdHJpbmdcIiYmKG49aShuKS5kZXRhY2goKSksdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5uZXh0U2libGluZyxyPXRoaXMucGFyZW50Tm9kZTtpKHRoaXMpLnJlbW92ZSgpO3Q/aSh0KS5iZWZvcmUobik6aShyKS5hcHBlbmQobil9KSl9LGRldGFjaDpmdW5jdGlvbihuKXtyZXR1cm4gdGhpcy5yZW1vdmUobiwhMCl9LGRvbU1hbmlwOmZ1bmN0aW9uKG4scix1KXtuPVtdLmNvbmNhdC5hcHBseShbXSxuKTt2YXIgaCxvLGYsYSxlPTAscz1uWzBdLGM9W10sbD10aGlzLmxlbmd0aDtpZighaS5zdXBwb3J0LmNoZWNrQ2xvbmUmJmw+MSYmdHlwZW9mIHM9PVwic3RyaW5nXCImJm9yLnRlc3QocykpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2kodGhpcykuZG9tTWFuaXAobixyLHUpfSk7aWYoaS5pc0Z1bmN0aW9uKHMpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oZil7dmFyIGU9aSh0aGlzKTtuWzBdPXMuY2FsbCh0aGlzLGYscj9lLmh0bWwoKTp0KTtlLmRvbU1hbmlwKG4scix1KX0pO2lmKHRoaXNbMF0pe2lmKGg9aS5idWlsZEZyYWdtZW50KG4sdGhpcyxjKSxmPWguZnJhZ21lbnQsbz1mLmZpcnN0Q2hpbGQsZi5jaGlsZE5vZGVzLmxlbmd0aD09PTEmJihmPW8pLG8pZm9yKHI9ciYmaS5ub2RlTmFtZShvLFwidHJcIiksYT1oLmNhY2hlYWJsZXx8bC0xO2U8bDtlKyspdS5jYWxsKHImJmkubm9kZU5hbWUodGhpc1tlXSxcInRhYmxlXCIpP29lKHRoaXNbZV0sXCJ0Ym9keVwiKTp0aGlzW2VdLGU9PT1hP2Y6aS5jbG9uZShmLCEwLCEwKSk7Zj1vPW51bGw7Yy5sZW5ndGgmJmkuZWFjaChjLGZ1bmN0aW9uKG4sdCl7dC5zcmM/aS5hamF4P2kuYWpheCh7dXJsOnQuc3JjLHR5cGU6XCJHRVRcIixkYXRhVHlwZTpcInNjcmlwdFwiLGFzeW5jOiExLGdsb2JhbDohMSx0aHJvd3M6ITB9KTppLmVycm9yKFwibm8gYWpheFwiKTppLmdsb2JhbEV2YWwoKHQudGV4dHx8dC50ZXh0Q29udGVudHx8dC5pbm5lckhUTUx8fFwiXCIpLnJlcGxhY2UoZWUsXCJcIikpO3QucGFyZW50Tm9kZSYmdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHQpfSl9cmV0dXJuIHRoaXN9fSk7aS5idWlsZEZyYWdtZW50PWZ1bmN0aW9uKG4sdSxmKXt2YXIgbyxzLGgsZT1uWzBdO3JldHVybiB1PXV8fHIsdT0hdS5ub2RlVHlwZSYmdVswXXx8dSx1PXUub3duZXJEb2N1bWVudHx8dSxuLmxlbmd0aD09PTEmJnR5cGVvZiBlPT1cInN0cmluZ1wiJiZlLmxlbmd0aDw1MTImJnU9PT1yJiZlLmNoYXJBdCgwKT09PVwiPFwiJiYhdWUudGVzdChlKSYmKGkuc3VwcG9ydC5jaGVja0Nsb25lfHwhb3IudGVzdChlKSkmJihpLnN1cHBvcnQuaHRtbDVDbG9uZXx8IWt0LnRlc3QoZSkpJiYocz0hMCxvPWkuZnJhZ21lbnRzW2VdLGg9byE9PXQpLG98fChvPXUuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLGkuY2xlYW4obix1LG8sZikscyYmKGkuZnJhZ21lbnRzW2VdPWgmJm8pKSx7ZnJhZ21lbnQ6byxjYWNoZWFibGU6c319O2kuZnJhZ21lbnRzPXt9O2kuZWFjaCh7YXBwZW5kVG86XCJhcHBlbmRcIixwcmVwZW5kVG86XCJwcmVwZW5kXCIsaW5zZXJ0QmVmb3JlOlwiYmVmb3JlXCIsaW5zZXJ0QWZ0ZXI6XCJhZnRlclwiLHJlcGxhY2VBbGw6XCJyZXBsYWNlV2l0aFwifSxmdW5jdGlvbihuLHQpe2kuZm5bbl09ZnVuY3Rpb24ocil7dmFyIG8sdT0wLHM9W10sZj1pKHIpLGg9Zi5sZW5ndGgsZT10aGlzLmxlbmd0aD09PTEmJnRoaXNbMF0ucGFyZW50Tm9kZTtpZigoZT09bnVsbHx8ZSYmZS5ub2RlVHlwZT09PTExJiZlLmNoaWxkTm9kZXMubGVuZ3RoPT09MSkmJmg9PT0xKXJldHVybiBmW3RdKHRoaXNbMF0pLHRoaXM7Zm9yKDt1PGg7dSsrKW89KHU+MD90aGlzLmNsb25lKCEwKTp0aGlzKS5nZXQoKSxpKGZbdV0pW3RdKG8pLHM9cy5jb25jYXQobyk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKHMsbixmLnNlbGVjdG9yKX19KTtpLmV4dGVuZCh7Y2xvbmU6ZnVuY3Rpb24obix0LHIpe3ZhciBmLG8sdSxlO2lmKGkuc3VwcG9ydC5odG1sNUNsb25lfHxpLmlzWE1MRG9jKG4pfHwha3QudGVzdChcIjxcIituLm5vZGVOYW1lK1wiPlwiKT9lPW4uY2xvbmVOb2RlKCEwKTooZHQuaW5uZXJIVE1MPW4ub3V0ZXJIVE1MLGR0LnJlbW92ZUNoaWxkKGU9ZHQuZmlyc3RDaGlsZCkpLCghaS5zdXBwb3J0Lm5vQ2xvbmVFdmVudHx8IWkuc3VwcG9ydC5ub0Nsb25lQ2hlY2tlZCkmJihuLm5vZGVUeXBlPT09MXx8bi5ub2RlVHlwZT09PTExKSYmIWkuaXNYTUxEb2MobikpZm9yKGNyKG4sZSksZj1ydChuKSxvPXJ0KGUpLHU9MDtmW3VdOysrdSlvW3VdJiZjcihmW3VdLG9bdV0pO2lmKHQmJihocihuLGUpLHIpKWZvcihmPXJ0KG4pLG89cnQoZSksdT0wO2ZbdV07Kyt1KWhyKGZbdV0sb1t1XSk7cmV0dXJuIGY9bz1udWxsLGV9LGNsZWFuOmZ1bmN0aW9uKG4sdCx1LGYpe3ZhciBoLGMsbyxwLHYsZCxzLHcsYSxiLGsseT10PT09ciYmc3IsbD1bXTtmb3IodCYmdHlwZW9mIHQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCE9XCJ1bmRlZmluZWRcInx8KHQ9ciksaD0wOyhvPW5baF0pIT1udWxsO2grKylpZih0eXBlb2Ygbz09XCJudW1iZXJcIiYmKG8rPVwiXCIpLG8pe2lmKHR5cGVvZiBvPT1cInN0cmluZ1wiKWlmKGllLnRlc3Qobykpe2Zvcih5PXl8fGlyKHQpLHM9dC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLHkuYXBwZW5kQ2hpbGQocyksbz1vLnJlcGxhY2UodXIsXCI8JDE+PFxcLyQyPlwiKSxwPShmci5leGVjKG8pfHxbXCJcIixcIlwiXSlbMV0udG9Mb3dlckNhc2UoKSx2PWVbcF18fGUuX2RlZmF1bHQsZD12WzBdLHMuaW5uZXJIVE1MPXZbMV0rbyt2WzJdO2QtLTspcz1zLmxhc3RDaGlsZDtpZighaS5zdXBwb3J0LnRib2R5KWZvcih3PXRlLnRlc3QobyksYT1wPT09XCJ0YWJsZVwiJiYhdz9zLmZpcnN0Q2hpbGQmJnMuZmlyc3RDaGlsZC5jaGlsZE5vZGVzOnZbMV09PT1cIjx0YWJsZT5cIiYmIXc/cy5jaGlsZE5vZGVzOltdLGM9YS5sZW5ndGgtMTtjPj0wOy0tYylpLm5vZGVOYW1lKGFbY10sXCJ0Ym9keVwiKSYmIWFbY10uY2hpbGROb2Rlcy5sZW5ndGgmJmFbY10ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChhW2NdKTshaS5zdXBwb3J0LmxlYWRpbmdXaGl0ZXNwYWNlJiZidC50ZXN0KG8pJiZzLmluc2VydEJlZm9yZSh0LmNyZWF0ZVRleHROb2RlKGJ0LmV4ZWMobylbMF0pLHMuZmlyc3RDaGlsZCk7bz1zLmNoaWxkTm9kZXM7cy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHMpfWVsc2Ugbz10LmNyZWF0ZVRleHROb2RlKG8pO28ubm9kZVR5cGU/bC5wdXNoKG8pOmkubWVyZ2UobCxvKX1pZihzJiYobz1zPXk9bnVsbCksIWkuc3VwcG9ydC5hcHBlbmRDaGVja2VkKWZvcihoPTA7KG89bFtoXSkhPW51bGw7aCsrKWkubm9kZU5hbWUobyxcImlucHV0XCIpP2xyKG8pOnR5cGVvZiBvLmdldEVsZW1lbnRzQnlUYWdOYW1lIT1cInVuZGVmaW5lZFwiJiZpLmdyZXAoby5nZXRFbGVtZW50c0J5VGFnTmFtZShcImlucHV0XCIpLGxyKTtpZih1KWZvcihiPWZ1bmN0aW9uKG4pe2lmKCFuLnR5cGV8fGZlLnRlc3Qobi50eXBlKSlyZXR1cm4gZj9mLnB1c2gobi5wYXJlbnROb2RlP24ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChuKTpuKTp1LmFwcGVuZENoaWxkKG4pfSxoPTA7KG89bFtoXSkhPW51bGw7aCsrKWkubm9kZU5hbWUobyxcInNjcmlwdFwiKSYmYihvKXx8KHUuYXBwZW5kQ2hpbGQobyksdHlwZW9mIG8uZ2V0RWxlbWVudHNCeVRhZ05hbWUhPVwidW5kZWZpbmVkXCImJihrPWkuZ3JlcChpLm1lcmdlKFtdLG8uZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIikpLGIpLGwuc3BsaWNlLmFwcGx5KGwsW2grMSwwXS5jb25jYXQoaykpLGgrPWsubGVuZ3RoKSk7cmV0dXJuIGx9LGNsZWFuRGF0YTpmdW5jdGlvbihuLHQpe2Zvcih2YXIgZix1LHIsZSxoPTAsbz1pLmV4cGFuZG8scz1pLmNhY2hlLGM9aS5zdXBwb3J0LmRlbGV0ZUV4cGFuZG8sbD1pLmV2ZW50LnNwZWNpYWw7KHI9bltoXSkhPW51bGw7aCsrKWlmKCh0fHxpLmFjY2VwdERhdGEocikpJiYodT1yW29dLGY9dSYmc1t1XSxmKSl7aWYoZi5ldmVudHMpZm9yKGUgaW4gZi5ldmVudHMpbFtlXT9pLmV2ZW50LnJlbW92ZShyLGUpOmkucmVtb3ZlRXZlbnQocixlLGYuaGFuZGxlKTtzW3VdJiYoZGVsZXRlIHNbdV0sYz9kZWxldGUgcltvXTpyLnJlbW92ZUF0dHJpYnV0ZT9yLnJlbW92ZUF0dHJpYnV0ZShvKTpyW29dPW51bGwsaS5kZWxldGVkSWRzLnB1c2godSkpfX19KSxmdW5jdGlvbigpe3ZhciB0LG47aS51YU1hdGNoPWZ1bmN0aW9uKG4pe249bi50b0xvd2VyQ2FzZSgpO3ZhciB0PS8oY2hyb21lKVsgXFwvXShbXFx3Ll0rKS8uZXhlYyhuKXx8Lyh3ZWJraXQpWyBcXC9dKFtcXHcuXSspLy5leGVjKG4pfHwvKG9wZXJhKSg/Oi4qdmVyc2lvbnwpWyBcXC9dKFtcXHcuXSspLy5leGVjKG4pfHwvKG1zaWUpIChbXFx3Ll0rKS8uZXhlYyhuKXx8bi5pbmRleE9mKFwiY29tcGF0aWJsZVwiKTwwJiYvKG1vemlsbGEpKD86Lio/IHJ2OihbXFx3Ll0rKXwpLy5leGVjKG4pfHxbXTtyZXR1cm57YnJvd3Nlcjp0WzFdfHxcIlwiLHZlcnNpb246dFsyXXx8XCIwXCJ9fTt0PWkudWFNYXRjaChwdS51c2VyQWdlbnQpO249e307dC5icm93c2VyJiYoblt0LmJyb3dzZXJdPSEwLG4udmVyc2lvbj10LnZlcnNpb24pO24uY2hyb21lP24ud2Via2l0PSEwOm4ud2Via2l0JiYobi5zYWZhcmk9ITApO2kuYnJvd3Nlcj1uO2kuc3ViPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbih0LGkpe3JldHVybiBuZXcgbi5mbi5pbml0KHQsaSl9aS5leHRlbmQoITAsbix0aGlzKTtuLnN1cGVyY2xhc3M9dGhpcztuLmZuPW4ucHJvdG90eXBlPXRoaXMoKTtuLmZuLmNvbnN0cnVjdG9yPW47bi5zdWI9dGhpcy5zdWI7bi5mbi5pbml0PWZ1bmN0aW9uKHIsdSl7cmV0dXJuIHUmJnUgaW5zdGFuY2VvZiBpJiYhKHUgaW5zdGFuY2VvZiBuKSYmKHU9bih1KSksaS5mbi5pbml0LmNhbGwodGhpcyxyLHUsdCl9O24uZm4uaW5pdC5wcm90b3R5cGU9bi5mbjt2YXIgdD1uKHIpO3JldHVybiBufX0oKTt2YXIgdSx5LHAsZ3Q9L2FscGhhXFwoW14pXSpcXCkvaSxzZT0vb3BhY2l0eT0oW14pXSopLyxoZT0vXih0b3B8cmlnaHR8Ym90dG9tfGxlZnQpJC8sY2U9L14obm9uZXx0YWJsZSg/IS1jW2VhXSkuKykvLGFyPS9ebWFyZ2luLyxsZT1uZXcgUmVnRXhwKFwiXihcIitudCtcIikoLiopJFwiLFwiaVwiKSx1dD1uZXcgUmVnRXhwKFwiXihcIitudCtcIikoPyFweClbYS16JV0rJFwiLFwiaVwiKSxhZT1uZXcgUmVnRXhwKFwiXihbLStdKT0oXCIrbnQrXCIpXCIsXCJpXCIpLG5pPXtCT0RZOlwiYmxvY2tcIn0sdmU9e3Bvc2l0aW9uOlwiYWJzb2x1dGVcIix2aXNpYmlsaXR5OlwiaGlkZGVuXCIsZGlzcGxheTpcImJsb2NrXCJ9LHZyPXtsZXR0ZXJTcGFjaW5nOjAsZm9udFdlaWdodDo0MDB9LGM9W1wiVG9wXCIsXCJSaWdodFwiLFwiQm90dG9tXCIsXCJMZWZ0XCJdLHlyPVtcIldlYmtpdFwiLFwiT1wiLFwiTW96XCIsXCJtc1wiXSx5ZT1pLmZuLnRvZ2dsZTtpLmZuLmV4dGVuZCh7Y3NzOmZ1bmN0aW9uKG4scil7cmV0dXJuIGkuYWNjZXNzKHRoaXMsZnVuY3Rpb24obixyLHUpe3JldHVybiB1IT09dD9pLnN0eWxlKG4scix1KTppLmNzcyhuLHIpfSxuLHIsYXJndW1lbnRzLmxlbmd0aD4xKX0sc2hvdzpmdW5jdGlvbigpe3JldHVybiB3cih0aGlzLCEwKX0saGlkZTpmdW5jdGlvbigpe3JldHVybiB3cih0aGlzKX0sdG9nZ2xlOmZ1bmN0aW9uKG4sdCl7dmFyIHI9dHlwZW9mIG49PVwiYm9vbGVhblwiO3JldHVybiBpLmlzRnVuY3Rpb24obikmJmkuaXNGdW5jdGlvbih0KT95ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk6dGhpcy5lYWNoKGZ1bmN0aW9uKCl7KHI/bjpmdCh0aGlzKSk/aSh0aGlzKS5zaG93KCk6aSh0aGlzKS5oaWRlKCl9KX19KTtpLmV4dGVuZCh7Y3NzSG9va3M6e29wYWNpdHk6e2dldDpmdW5jdGlvbihuLHQpe2lmKHQpe3ZhciBpPXUobixcIm9wYWNpdHlcIik7cmV0dXJuIGk9PT1cIlwiP1wiMVwiOml9fX19LGNzc051bWJlcjp7ZmlsbE9wYWNpdHk6ITAsZm9udFdlaWdodDohMCxsaW5lSGVpZ2h0OiEwLG9wYWNpdHk6ITAsb3JwaGFuczohMCx3aWRvd3M6ITAsekluZGV4OiEwLHpvb206ITB9LGNzc1Byb3BzOntmbG9hdDppLnN1cHBvcnQuY3NzRmxvYXQ/XCJjc3NGbG9hdFwiOlwic3R5bGVGbG9hdFwifSxzdHlsZTpmdW5jdGlvbihuLHIsdSxmKXtpZihuJiZuLm5vZGVUeXBlIT09MyYmbi5ub2RlVHlwZSE9PTgmJm4uc3R5bGUpe3ZhciBvLHMsZSxoPWkuY2FtZWxDYXNlKHIpLGM9bi5zdHlsZTtpZihyPWkuY3NzUHJvcHNbaF18fChpLmNzc1Byb3BzW2hdPXByKGMsaCkpLGU9aS5jc3NIb29rc1tyXXx8aS5jc3NIb29rc1toXSx1IT09dCl7aWYocz10eXBlb2YgdSxzPT09XCJzdHJpbmdcIiYmKG89YWUuZXhlYyh1KSkmJih1PShvWzFdKzEpKm9bMl0rcGFyc2VGbG9hdChpLmNzcyhuLHIpKSxzPVwibnVtYmVyXCIpLHU9PW51bGx8fHM9PT1cIm51bWJlclwiJiZpc05hTih1KSlyZXR1cm47aWYocyE9PVwibnVtYmVyXCJ8fGkuY3NzTnVtYmVyW2hdfHwodSs9XCJweFwiKSwhZXx8IShcInNldFwiaW4gZSl8fCh1PWUuc2V0KG4sdSxmKSkhPT10KXRyeXtjW3JdPXV9Y2F0Y2gobCl7fX1lbHNlIHJldHVybiBlJiZcImdldFwiaW4gZSYmKG89ZS5nZXQobiwhMSxmKSkhPT10P286Y1tyXX19LGNzczpmdW5jdGlvbihuLHIsZixlKXt2YXIgbyxjLHMsaD1pLmNhbWVsQ2FzZShyKTtyZXR1cm4ocj1pLmNzc1Byb3BzW2hdfHwoaS5jc3NQcm9wc1toXT1wcihuLnN0eWxlLGgpKSxzPWkuY3NzSG9va3Nbcl18fGkuY3NzSG9va3NbaF0scyYmXCJnZXRcImluIHMmJihvPXMuZ2V0KG4sITAsZSkpLG89PT10JiYobz11KG4scikpLG89PT1cIm5vcm1hbFwiJiZyIGluIHZyJiYobz12cltyXSksZnx8ZSE9PXQpPyhjPXBhcnNlRmxvYXQobyksZnx8aS5pc051bWVyaWMoYyk/Y3x8MDpvKTpvfSxzd2FwOmZ1bmN0aW9uKG4sdCxpKXt2YXIgdSxyLGY9e307Zm9yKHIgaW4gdClmW3JdPW4uc3R5bGVbcl0sbi5zdHlsZVtyXT10W3JdO3U9aS5jYWxsKG4pO2ZvcihyIGluIHQpbi5zdHlsZVtyXT1mW3JdO3JldHVybiB1fX0pO24uZ2V0Q29tcHV0ZWRTdHlsZT91PWZ1bmN0aW9uKHQscil7dmFyIGYsbyxzLGgsZT1uLmdldENvbXB1dGVkU3R5bGUodCxudWxsKSx1PXQuc3R5bGU7cmV0dXJuIGUmJihmPWUuZ2V0UHJvcGVydHlWYWx1ZShyKXx8ZVtyXSxmIT09XCJcInx8aS5jb250YWlucyh0Lm93bmVyRG9jdW1lbnQsdCl8fChmPWkuc3R5bGUodCxyKSksdXQudGVzdChmKSYmYXIudGVzdChyKSYmKG89dS53aWR0aCxzPXUubWluV2lkdGgsaD11Lm1heFdpZHRoLHUubWluV2lkdGg9dS5tYXhXaWR0aD11LndpZHRoPWYsZj1lLndpZHRoLHUud2lkdGg9byx1Lm1pbldpZHRoPXMsdS5tYXhXaWR0aD1oKSksZn06ci5kb2N1bWVudEVsZW1lbnQuY3VycmVudFN0eWxlJiYodT1mdW5jdGlvbihuLHQpe3ZhciBmLHUsaT1uLmN1cnJlbnRTdHlsZSYmbi5jdXJyZW50U3R5bGVbdF0scj1uLnN0eWxlO3JldHVybiBpPT1udWxsJiZyJiZyW3RdJiYoaT1yW3RdKSx1dC50ZXN0KGkpJiYhaGUudGVzdCh0KSYmKGY9ci5sZWZ0LHU9bi5ydW50aW1lU3R5bGUmJm4ucnVudGltZVN0eWxlLmxlZnQsdSYmKG4ucnVudGltZVN0eWxlLmxlZnQ9bi5jdXJyZW50U3R5bGUubGVmdCksci5sZWZ0PXQ9PT1cImZvbnRTaXplXCI/XCIxZW1cIjppLGk9ci5waXhlbExlZnQrXCJweFwiLHIubGVmdD1mLHUmJihuLnJ1bnRpbWVTdHlsZS5sZWZ0PXUpKSxpPT09XCJcIj9cImF1dG9cIjppfSk7aS5lYWNoKFtcImhlaWdodFwiLFwid2lkdGhcIl0sZnVuY3Rpb24obix0KXtpLmNzc0hvb2tzW3RdPXtnZXQ6ZnVuY3Rpb24obixyLGYpe2lmKHIpcmV0dXJuIG4ub2Zmc2V0V2lkdGg9PT0wJiZjZS50ZXN0KHUobixcImRpc3BsYXlcIikpP2kuc3dhcChuLHZlLGZ1bmN0aW9uKCl7cmV0dXJuIGRyKG4sdCxmKX0pOmRyKG4sdCxmKX0sc2V0OmZ1bmN0aW9uKG4scix1KXtyZXR1cm4gYnIobixyLHU/a3Iobix0LHUsaS5zdXBwb3J0LmJveFNpemluZyYmaS5jc3MobixcImJveFNpemluZ1wiKT09PVwiYm9yZGVyLWJveFwiKTowKX19fSk7aS5zdXBwb3J0Lm9wYWNpdHl8fChpLmNzc0hvb2tzLm9wYWNpdHk9e2dldDpmdW5jdGlvbihuLHQpe3JldHVybiBzZS50ZXN0KCh0JiZuLmN1cnJlbnRTdHlsZT9uLmN1cnJlbnRTdHlsZS5maWx0ZXI6bi5zdHlsZS5maWx0ZXIpfHxcIlwiKT8uMDEqcGFyc2VGbG9hdChSZWdFeHAuJDEpK1wiXCI6dD9cIjFcIjpcIlwifSxzZXQ6ZnVuY3Rpb24obix0KXt2YXIgcj1uLnN0eWxlLHU9bi5jdXJyZW50U3R5bGUsZT1pLmlzTnVtZXJpYyh0KT9cImFscGhhKG9wYWNpdHk9XCIrdCoxMDArXCIpXCI6XCJcIixmPXUmJnUuZmlsdGVyfHxyLmZpbHRlcnx8XCJcIjsoci56b29tPTEsdD49MSYmaS50cmltKGYucmVwbGFjZShndCxcIlwiKSk9PT1cIlwiJiZyLnJlbW92ZUF0dHJpYnV0ZSYmKHIucmVtb3ZlQXR0cmlidXRlKFwiZmlsdGVyXCIpLHUmJiF1LmZpbHRlcikpfHwoci5maWx0ZXI9Z3QudGVzdChmKT9mLnJlcGxhY2UoZ3QsZSk6ZitcIiBcIitlKX19KTtpKGZ1bmN0aW9uKCl7aS5zdXBwb3J0LnJlbGlhYmxlTWFyZ2luUmlnaHR8fChpLmNzc0hvb2tzLm1hcmdpblJpZ2h0PXtnZXQ6ZnVuY3Rpb24obix0KXtyZXR1cm4gaS5zd2FwKG4se2Rpc3BsYXk6XCJpbmxpbmUtYmxvY2tcIn0sZnVuY3Rpb24oKXtpZih0KXJldHVybiB1KG4sXCJtYXJnaW5SaWdodFwiKX0pfX0pOyFpLnN1cHBvcnQucGl4ZWxQb3NpdGlvbiYmaS5mbi5wb3NpdGlvbiYmaS5lYWNoKFtcInRvcFwiLFwibGVmdFwiXSxmdW5jdGlvbihuLHQpe2kuY3NzSG9va3NbdF09e2dldDpmdW5jdGlvbihuLHIpe2lmKHIpe3ZhciBmPXUobix0KTtyZXR1cm4gdXQudGVzdChmKT9pKG4pLnBvc2l0aW9uKClbdF0rXCJweFwiOmZ9fX19KX0pO2kuZXhwciYmaS5leHByLmZpbHRlcnMmJihpLmV4cHIuZmlsdGVycy5oaWRkZW49ZnVuY3Rpb24obil7cmV0dXJuIG4ub2Zmc2V0V2lkdGg9PT0wJiZuLm9mZnNldEhlaWdodD09PTB8fCFpLnN1cHBvcnQucmVsaWFibGVIaWRkZW5PZmZzZXRzJiYobi5zdHlsZSYmbi5zdHlsZS5kaXNwbGF5fHx1KG4sXCJkaXNwbGF5XCIpKT09PVwibm9uZVwifSxpLmV4cHIuZmlsdGVycy52aXNpYmxlPWZ1bmN0aW9uKG4pe3JldHVybiFpLmV4cHIuZmlsdGVycy5oaWRkZW4obil9KTtpLmVhY2goe21hcmdpbjpcIlwiLHBhZGRpbmc6XCJcIixib3JkZXI6XCJXaWR0aFwifSxmdW5jdGlvbihuLHQpe2kuY3NzSG9va3Nbbit0XT17ZXhwYW5kOmZ1bmN0aW9uKGkpe2Zvcih2YXIgdT10eXBlb2YgaT09XCJzdHJpbmdcIj9pLnNwbGl0KFwiIFwiKTpbaV0sZj17fSxyPTA7cjw0O3IrKylmW24rY1tyXSt0XT11W3JdfHx1W3ItMl18fHVbMF07cmV0dXJuIGZ9fTthci50ZXN0KG4pfHwoaS5jc3NIb29rc1tuK3RdLnNldD1icil9KTt2YXIgcGU9LyUyMC9nLHdlPS9cXFtcXF0kLyxudT0vXFxyP1xcbi9nLGJlPS9eKD86Y29sb3J8ZGF0ZXxkYXRldGltZXxkYXRldGltZS1sb2NhbHxlbWFpbHxoaWRkZW58bW9udGh8bnVtYmVyfHBhc3N3b3JkfHJhbmdlfHNlYXJjaHx0ZWx8dGV4dHx0aW1lfHVybHx3ZWVrKSQvaSxrZT0vXig/OnNlbGVjdHx0ZXh0YXJlYSkvaTtpLmZuLmV4dGVuZCh7c2VyaWFsaXplOmZ1bmN0aW9uKCl7cmV0dXJuIGkucGFyYW0odGhpcy5zZXJpYWxpemVBcnJheSgpKX0sc2VyaWFsaXplQXJyYXk6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lbGVtZW50cz9pLm1ha2VBcnJheSh0aGlzLmVsZW1lbnRzKTp0aGlzfSkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubmFtZSYmIXRoaXMuZGlzYWJsZWQmJih0aGlzLmNoZWNrZWR8fGtlLnRlc3QodGhpcy5ub2RlTmFtZSl8fGJlLnRlc3QodGhpcy50eXBlKSl9KS5tYXAoZnVuY3Rpb24obix0KXt2YXIgcj1pKHRoaXMpLnZhbCgpO3JldHVybiByPT1udWxsP251bGw6aS5pc0FycmF5KHIpP2kubWFwKHIsZnVuY3Rpb24obil7cmV0dXJue25hbWU6dC5uYW1lLHZhbHVlOm4ucmVwbGFjZShudSxcIlxcclxcblwiKX19KTp7bmFtZTp0Lm5hbWUsdmFsdWU6ci5yZXBsYWNlKG51LFwiXFxyXFxuXCIpfX0pLmdldCgpfX0pO2kucGFyYW09ZnVuY3Rpb24obixyKXt2YXIgdSxmPVtdLGU9ZnVuY3Rpb24obix0KXt0PWkuaXNGdW5jdGlvbih0KT90KCk6dD09bnVsbD9cIlwiOnQ7ZltmLmxlbmd0aF09ZW5jb2RlVVJJQ29tcG9uZW50KG4pK1wiPVwiK2VuY29kZVVSSUNvbXBvbmVudCh0KX07aWYocj09PXQmJihyPWkuYWpheFNldHRpbmdzJiZpLmFqYXhTZXR0aW5ncy50cmFkaXRpb25hbCksaS5pc0FycmF5KG4pfHxuLmpxdWVyeSYmIWkuaXNQbGFpbk9iamVjdChuKSlpLmVhY2gobixmdW5jdGlvbigpe2UodGhpcy5uYW1lLHRoaXMudmFsdWUpfSk7ZWxzZSBmb3IodSBpbiBuKXRpKHUsblt1XSxyLGUpO3JldHVybiBmLmpvaW4oXCImXCIpLnJlcGxhY2UocGUsXCIrXCIpfTt2YXIgbCxhLGRlPS8jLiokLyxnZT0vXiguKj8pOlsgXFx0XSooW15cXHJcXG5dKilcXHI/JC9tZyxubz0vXig/OkdFVHxIRUFEKSQvLHRvPS9eXFwvXFwvLyx0dT0vXFw/Lyxpbz0vPHNjcmlwdFxcYltePF0qKD86KD8hPFxcL3NjcmlwdD4pPFtePF0qKSo8XFwvc2NyaXB0Pi9naSxybz0vKFs/Jl0pXz1bXiZdKi8saXU9L14oW1xcd1xcK1xcLlxcLV0rOikoPzpcXC9cXC8oW15cXC8/IzpdKikoPzo6KFxcZCspfCl8KS8scnU9aS5mbi5sb2FkLGlpPXt9LHV1PXt9LGZ1PVtcIiovXCJdK1tcIipcIl07dHJ5e2E9eXUuaHJlZn1jYXRjaChwbyl7YT1yLmNyZWF0ZUVsZW1lbnQoXCJhXCIpO2EuaHJlZj1cIlwiO2E9YS5ocmVmfWw9aXUuZXhlYyhhLnRvTG93ZXJDYXNlKCkpfHxbXTtpLmZuLmxvYWQ9ZnVuY3Rpb24obixyLHUpe2lmKHR5cGVvZiBuIT1cInN0cmluZ1wiJiZydSlyZXR1cm4gcnUuYXBwbHkodGhpcyxhcmd1bWVudHMpO2lmKCF0aGlzLmxlbmd0aClyZXR1cm4gdGhpczt2YXIgZixvLHMsaD10aGlzLGU9bi5pbmRleE9mKFwiIFwiKTtyZXR1cm4gZT49MCYmKGY9bi5zbGljZShlLG4ubGVuZ3RoKSxuPW4uc2xpY2UoMCxlKSksaS5pc0Z1bmN0aW9uKHIpPyh1PXIscj10KTpyJiZ0eXBlb2Ygcj09XCJvYmplY3RcIiYmKG89XCJQT1NUXCIpLGkuYWpheCh7dXJsOm4sdHlwZTpvLGRhdGFUeXBlOlwiaHRtbFwiLGRhdGE6cixjb21wbGV0ZTpmdW5jdGlvbihuLHQpe3UmJmguZWFjaCh1LHN8fFtuLnJlc3BvbnNlVGV4dCx0LG5dKX19KS5kb25lKGZ1bmN0aW9uKG4pe3M9YXJndW1lbnRzO2guaHRtbChmP2koXCI8ZGl2PlwiKS5hcHBlbmQobi5yZXBsYWNlKGlvLFwiXCIpKS5maW5kKGYpOm4pfSksdGhpc307aS5lYWNoKFwiYWpheFN0YXJ0IGFqYXhTdG9wIGFqYXhDb21wbGV0ZSBhamF4RXJyb3IgYWpheFN1Y2Nlc3MgYWpheFNlbmRcIi5zcGxpdChcIiBcIiksZnVuY3Rpb24obix0KXtpLmZuW3RdPWZ1bmN0aW9uKG4pe3JldHVybiB0aGlzLm9uKHQsbil9fSk7aS5lYWNoKFtcImdldFwiLFwicG9zdFwiXSxmdW5jdGlvbihuLHIpe2lbcl09ZnVuY3Rpb24obix1LGYsZSl7cmV0dXJuIGkuaXNGdW5jdGlvbih1KSYmKGU9ZXx8ZixmPXUsdT10KSxpLmFqYXgoe3R5cGU6cix1cmw6bixkYXRhOnUsc3VjY2VzczpmLGRhdGFUeXBlOmV9KX19KTtpLmV4dGVuZCh7Z2V0U2NyaXB0OmZ1bmN0aW9uKG4scil7cmV0dXJuIGkuZ2V0KG4sdCxyLFwic2NyaXB0XCIpfSxnZXRKU09OOmZ1bmN0aW9uKG4sdCxyKXtyZXR1cm4gaS5nZXQobix0LHIsXCJqc29uXCIpfSxhamF4U2V0dXA6ZnVuY3Rpb24obix0KXtyZXR1cm4gdD9vdShuLGkuYWpheFNldHRpbmdzKToodD1uLG49aS5hamF4U2V0dGluZ3MpLG91KG4sdCksbn0sYWpheFNldHRpbmdzOnt1cmw6YSxpc0xvY2FsOi9eKD86YWJvdXR8YXBwfGFwcFxcLXN0b3JhZ2V8LitcXC1leHRlbnNpb258ZmlsZXxyZXN8d2lkZ2V0KTokLy50ZXN0KGxbMV0pLGdsb2JhbDohMCx0eXBlOlwiR0VUXCIsY29udGVudFR5cGU6XCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7IGNoYXJzZXQ9VVRGLThcIixwcm9jZXNzRGF0YTohMCxhc3luYzohMCxhY2NlcHRzOnt4bWw6XCJhcHBsaWNhdGlvbi94bWwsIHRleHQveG1sXCIsaHRtbDpcInRleHQvaHRtbFwiLHRleHQ6XCJ0ZXh0L3BsYWluXCIsanNvbjpcImFwcGxpY2F0aW9uL2pzb24sIHRleHQvamF2YXNjcmlwdFwiLFwiKlwiOmZ1fSxjb250ZW50czp7eG1sOi94bWwvLGh0bWw6L2h0bWwvLGpzb246L2pzb24vfSxyZXNwb25zZUZpZWxkczp7eG1sOlwicmVzcG9uc2VYTUxcIix0ZXh0OlwicmVzcG9uc2VUZXh0XCJ9LGNvbnZlcnRlcnM6e1wiKiB0ZXh0XCI6bi5TdHJpbmcsXCJ0ZXh0IGh0bWxcIjohMCxcInRleHQganNvblwiOmkucGFyc2VKU09OLFwidGV4dCB4bWxcIjppLnBhcnNlWE1MfSxmbGF0T3B0aW9uczp7Y29udGV4dDohMCx1cmw6ITB9fSxhamF4UHJlZmlsdGVyOmV1KGlpKSxhamF4VHJhbnNwb3J0OmV1KHV1KSxhamF4OmZ1bmN0aW9uKG4scil7ZnVuY3Rpb24gYihuLHIsaCxsKXt2YXIgYSx0dCxiLGl0LHAsdj1yO2UhPT0yJiYoZT0yLGQmJmNsZWFyVGltZW91dChkKSxjPXQsaz1sfHxcIlwiLGYucmVhZHlTdGF0ZT1uPjA/NDowLGgmJihpdD11byh1LGYsaCkpLG4+PTIwMCYmbjwzMDB8fG49PT0zMDQ/KHUuaWZNb2RpZmllZCYmKHA9Zi5nZXRSZXNwb25zZUhlYWRlcihcIkxhc3QtTW9kaWZpZWRcIikscCYmKGkubGFzdE1vZGlmaWVkW29dPXApLHA9Zi5nZXRSZXNwb25zZUhlYWRlcihcIkV0YWdcIikscCYmKGkuZXRhZ1tvXT1wKSksbj09PTMwND8odj1cIm5vdG1vZGlmaWVkXCIsYT0hMCk6KGE9Zm8odSxpdCksdj1hLnN0YXRlLHR0PWEuZGF0YSxiPWEuZXJyb3IsYT0hYikpOihiPXYsKCF2fHxuKSYmKHY9XCJlcnJvclwiLG48MCYmKG49MCkpKSxmLnN0YXR1cz1uLGYuc3RhdHVzVGV4dD0ocnx8dikrXCJcIixhP250LnJlc29sdmVXaXRoKHMsW3R0LHYsZl0pOm50LnJlamVjdFdpdGgocyxbZix2LGJdKSxmLnN0YXR1c0NvZGUodyksdz10LHkmJmcudHJpZ2dlcihcImFqYXhcIisoYT9cIlN1Y2Nlc3NcIjpcIkVycm9yXCIpLFtmLHUsYT90dDpiXSkscnQuZmlyZVdpdGgocyxbZix2XSkseSYmKGcudHJpZ2dlcihcImFqYXhDb21wbGV0ZVwiLFtmLHVdKSwtLWkuYWN0aXZlfHxpLmV2ZW50LnRyaWdnZXIoXCJhamF4U3RvcFwiKSkpfXZhciB0dCxpdDt0eXBlb2Ygbj09XCJvYmplY3RcIiYmKHI9bixuPXQpO3I9cnx8e307dmFyIG8sayxwLGMsZCxhLHksdix1PWkuYWpheFNldHVwKHt9LHIpLHM9dS5jb250ZXh0fHx1LGc9cyE9PXUmJihzLm5vZGVUeXBlfHxzIGluc3RhbmNlb2YgaSk/aShzKTppLmV2ZW50LG50PWkuRGVmZXJyZWQoKSxydD1pLkNhbGxiYWNrcyhcIm9uY2UgbWVtb3J5XCIpLHc9dS5zdGF0dXNDb2RlfHx7fSx1dD17fSxmdD17fSxlPTAsb3Q9XCJjYW5jZWxlZFwiLGY9e3JlYWR5U3RhdGU6MCxzZXRSZXF1ZXN0SGVhZGVyOmZ1bmN0aW9uKG4sdCl7aWYoIWUpe3ZhciBpPW4udG9Mb3dlckNhc2UoKTtuPWZ0W2ldPWZ0W2ldfHxuO3V0W25dPXR9cmV0dXJuIHRoaXN9LGdldEFsbFJlc3BvbnNlSGVhZGVyczpmdW5jdGlvbigpe3JldHVybiBlPT09Mj9rOm51bGx9LGdldFJlc3BvbnNlSGVhZGVyOmZ1bmN0aW9uKG4pe3ZhciBpO2lmKGU9PT0yKXtpZighcClmb3IocD17fTtpPWdlLmV4ZWMoayk7KXBbaVsxXS50b0xvd2VyQ2FzZSgpXT1pWzJdO2k9cFtuLnRvTG93ZXJDYXNlKCldfXJldHVybiBpPT09dD9udWxsOml9LG92ZXJyaWRlTWltZVR5cGU6ZnVuY3Rpb24obil7cmV0dXJuIGV8fCh1Lm1pbWVUeXBlPW4pLHRoaXN9LGFib3J0OmZ1bmN0aW9uKG4pe3JldHVybiBuPW58fG90LGMmJmMuYWJvcnQobiksYigwLG4pLHRoaXN9fTtpZihudC5wcm9taXNlKGYpLGYuc3VjY2Vzcz1mLmRvbmUsZi5lcnJvcj1mLmZhaWwsZi5jb21wbGV0ZT1ydC5hZGQsZi5zdGF0dXNDb2RlPWZ1bmN0aW9uKG4pe2lmKG4pe3ZhciB0O2lmKGU8Milmb3IodCBpbiBuKXdbdF09W3dbdF0sblt0XV07ZWxzZSB0PW5bZi5zdGF0dXNdLGYuYWx3YXlzKHQpfXJldHVybiB0aGlzfSx1LnVybD0oKG58fHUudXJsKStcIlwiKS5yZXBsYWNlKGRlLFwiXCIpLnJlcGxhY2UodG8sbFsxXStcIi8vXCIpLHUuZGF0YVR5cGVzPWkudHJpbSh1LmRhdGFUeXBlfHxcIipcIikudG9Mb3dlckNhc2UoKS5zcGxpdChoKSx1LmNyb3NzRG9tYWluPT1udWxsJiYoYT1pdS5leGVjKHUudXJsLnRvTG93ZXJDYXNlKCkpLHUuY3Jvc3NEb21haW49ISEoYSYmKGFbMV0hPT1sWzFdfHxhWzJdIT09bFsyXXx8KGFbM118fChhWzFdPT09XCJodHRwOlwiPzgwOjQ0MykpIT0obFszXXx8KGxbMV09PT1cImh0dHA6XCI/ODA6NDQzKSkpKSksdS5kYXRhJiZ1LnByb2Nlc3NEYXRhJiZ0eXBlb2YgdS5kYXRhIT1cInN0cmluZ1wiJiYodS5kYXRhPWkucGFyYW0odS5kYXRhLHUudHJhZGl0aW9uYWwpKSxldChpaSx1LHIsZiksZT09PTIpcmV0dXJuIGY7eT11Lmdsb2JhbDt1LnR5cGU9dS50eXBlLnRvVXBwZXJDYXNlKCk7dS5oYXNDb250ZW50PSFuby50ZXN0KHUudHlwZSk7eSYmaS5hY3RpdmUrKz09MCYmaS5ldmVudC50cmlnZ2VyKFwiYWpheFN0YXJ0XCIpO3UuaGFzQ29udGVudHx8KHUuZGF0YSYmKHUudXJsKz0odHUudGVzdCh1LnVybCk/XCImXCI6XCI/XCIpK3UuZGF0YSxkZWxldGUgdS5kYXRhKSxvPXUudXJsLHUuY2FjaGU9PT0hMSYmKHR0PWkubm93KCksaXQ9dS51cmwucmVwbGFjZShybyxcIiQxXz1cIit0dCksdS51cmw9aXQrKGl0PT09dS51cmw/KHR1LnRlc3QodS51cmwpP1wiJlwiOlwiP1wiKStcIl89XCIrdHQ6XCJcIikpKTsodS5kYXRhJiZ1Lmhhc0NvbnRlbnQmJnUuY29udGVudFR5cGUhPT0hMXx8ci5jb250ZW50VHlwZSkmJmYuc2V0UmVxdWVzdEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLHUuY29udGVudFR5cGUpO3UuaWZNb2RpZmllZCYmKG89b3x8dS51cmwsaS5sYXN0TW9kaWZpZWRbb10mJmYuc2V0UmVxdWVzdEhlYWRlcihcIklmLU1vZGlmaWVkLVNpbmNlXCIsaS5sYXN0TW9kaWZpZWRbb10pLGkuZXRhZ1tvXSYmZi5zZXRSZXF1ZXN0SGVhZGVyKFwiSWYtTm9uZS1NYXRjaFwiLGkuZXRhZ1tvXSkpO2Yuc2V0UmVxdWVzdEhlYWRlcihcIkFjY2VwdFwiLHUuZGF0YVR5cGVzWzBdJiZ1LmFjY2VwdHNbdS5kYXRhVHlwZXNbMF1dP3UuYWNjZXB0c1t1LmRhdGFUeXBlc1swXV0rKHUuZGF0YVR5cGVzWzBdIT09XCIqXCI/XCIsIFwiK2Z1K1wiOyBxPTAuMDFcIjpcIlwiKTp1LmFjY2VwdHNbXCIqXCJdKTtmb3IodiBpbiB1LmhlYWRlcnMpZi5zZXRSZXF1ZXN0SGVhZGVyKHYsdS5oZWFkZXJzW3ZdKTtpZih1LmJlZm9yZVNlbmQmJih1LmJlZm9yZVNlbmQuY2FsbChzLGYsdSk9PT0hMXx8ZT09PTIpKXJldHVybiBmLmFib3J0KCk7b3Q9XCJhYm9ydFwiO2Zvcih2IGlue3N1Y2Nlc3M6MSxlcnJvcjoxLGNvbXBsZXRlOjF9KWZbdl0odVt2XSk7aWYoYz1ldCh1dSx1LHIsZiksYyl7Zi5yZWFkeVN0YXRlPTE7eSYmZy50cmlnZ2VyKFwiYWpheFNlbmRcIixbZix1XSk7dS5hc3luYyYmdS50aW1lb3V0PjAmJihkPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtmLmFib3J0KFwidGltZW91dFwiKX0sdS50aW1lb3V0KSk7dHJ5e2U9MTtjLnNlbmQodXQsYil9Y2F0Y2goc3Qpe2lmKGU8MiliKC0xLHN0KTtlbHNlIHRocm93IHN0O319ZWxzZSBiKC0xLFwiTm8gVHJhbnNwb3J0XCIpO3JldHVybiBmfSxhY3RpdmU6MCxsYXN0TW9kaWZpZWQ6e30sZXRhZzp7fX0pO3ZhciBzdT1bXSxlbz0vXFw/LyxvdD0vKD0pXFw/KD89JnwkKXxcXD9cXD8vLG9vPWkubm93KCk7aS5hamF4U2V0dXAoe2pzb25wOlwiY2FsbGJhY2tcIixqc29ucENhbGxiYWNrOmZ1bmN0aW9uKCl7dmFyIG49c3UucG9wKCl8fGkuZXhwYW5kbytcIl9cIitvbysrO3JldHVybiB0aGlzW25dPSEwLG59fSk7aS5hamF4UHJlZmlsdGVyKFwianNvbiBqc29ucFwiLGZ1bmN0aW9uKHIsdSxmKXt2YXIgZSxzLG8saD1yLmRhdGEsYz1yLnVybCxsPXIuanNvbnAhPT0hMSxhPWwmJm90LnRlc3QoYyksdj1sJiYhYSYmdHlwZW9mIGg9PVwic3RyaW5nXCImJiEoci5jb250ZW50VHlwZXx8XCJcIikuaW5kZXhPZihcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiKSYmb3QudGVzdChoKTtpZihyLmRhdGFUeXBlc1swXT09PVwianNvbnBcInx8YXx8dilyZXR1cm4gZT1yLmpzb25wQ2FsbGJhY2s9aS5pc0Z1bmN0aW9uKHIuanNvbnBDYWxsYmFjayk/ci5qc29ucENhbGxiYWNrKCk6ci5qc29ucENhbGxiYWNrLHM9bltlXSxhP3IudXJsPWMucmVwbGFjZShvdCxcIiQxXCIrZSk6dj9yLmRhdGE9aC5yZXBsYWNlKG90LFwiJDFcIitlKTpsJiYoci51cmwrPShlby50ZXN0KGMpP1wiJlwiOlwiP1wiKStyLmpzb25wK1wiPVwiK2UpLHIuY29udmVydGVyc1tcInNjcmlwdCBqc29uXCJdPWZ1bmN0aW9uKCl7cmV0dXJuIG98fGkuZXJyb3IoZStcIiB3YXMgbm90IGNhbGxlZFwiKSxvWzBdfSxyLmRhdGFUeXBlc1swXT1cImpzb25cIixuW2VdPWZ1bmN0aW9uKCl7bz1hcmd1bWVudHN9LGYuYWx3YXlzKGZ1bmN0aW9uKCl7bltlXT1zO3JbZV0mJihyLmpzb25wQ2FsbGJhY2s9dS5qc29ucENhbGxiYWNrLHN1LnB1c2goZSkpO28mJmkuaXNGdW5jdGlvbihzKSYmcyhvWzBdKTtvPXM9dH0pLFwic2NyaXB0XCJ9KTtpLmFqYXhTZXR1cCh7YWNjZXB0czp7c2NyaXB0OlwidGV4dC9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9lY21hc2NyaXB0LCBhcHBsaWNhdGlvbi94LWVjbWFzY3JpcHRcIn0sY29udGVudHM6e3NjcmlwdDovamF2YXNjcmlwdHxlY21hc2NyaXB0L30sY29udmVydGVyczp7XCJ0ZXh0IHNjcmlwdFwiOmZ1bmN0aW9uKG4pe3JldHVybiBpLmdsb2JhbEV2YWwobiksbn19fSk7aS5hamF4UHJlZmlsdGVyKFwic2NyaXB0XCIsZnVuY3Rpb24obil7bi5jYWNoZT09PXQmJihuLmNhY2hlPSExKTtuLmNyb3NzRG9tYWluJiYobi50eXBlPVwiR0VUXCIsbi5nbG9iYWw9ITEpfSk7aS5hamF4VHJhbnNwb3J0KFwic2NyaXB0XCIsZnVuY3Rpb24obil7aWYobi5jcm9zc0RvbWFpbil7dmFyIGksdT1yLmhlYWR8fHIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJoZWFkXCIpWzBdfHxyLmRvY3VtZW50RWxlbWVudDtyZXR1cm57c2VuZDpmdW5jdGlvbihmLGUpe2k9ci5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO2kuYXN5bmM9XCJhc3luY1wiO24uc2NyaXB0Q2hhcnNldCYmKGkuY2hhcnNldD1uLnNjcmlwdENoYXJzZXQpO2kuc3JjPW4udXJsO2kub25sb2FkPWkub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKG4scil7KHJ8fCFpLnJlYWR5U3RhdGV8fC9sb2FkZWR8Y29tcGxldGUvLnRlc3QoaS5yZWFkeVN0YXRlKSkmJihpLm9ubG9hZD1pLm9ucmVhZHlzdGF0ZWNoYW5nZT1udWxsLHUmJmkucGFyZW50Tm9kZSYmdS5yZW1vdmVDaGlsZChpKSxpPXQscnx8ZSgyMDAsXCJzdWNjZXNzXCIpKX07dS5pbnNlcnRCZWZvcmUoaSx1LmZpcnN0Q2hpbGQpfSxhYm9ydDpmdW5jdGlvbigpe2lmKGkpaS5vbmxvYWQoMCwxKX19fX0pO3N0PW4uQWN0aXZlWE9iamVjdD9mdW5jdGlvbigpe2Zvcih2YXIgbiBpbiB3KXdbbl0oMCwxKX06ITE7aHU9MDtpLmFqYXhTZXR0aW5ncy54aHI9bi5BY3RpdmVYT2JqZWN0P2Z1bmN0aW9uKCl7cmV0dXJuIXRoaXMuaXNMb2NhbCYmY3UoKXx8c28oKX06Y3UsZnVuY3Rpb24obil7aS5leHRlbmQoaS5zdXBwb3J0LHthamF4OiEhbixjb3JzOiEhbiYmXCJ3aXRoQ3JlZGVudGlhbHNcImluIG59KX0oaS5hamF4U2V0dGluZ3MueGhyKCkpO2kuc3VwcG9ydC5hamF4JiZpLmFqYXhUcmFuc3BvcnQoZnVuY3Rpb24ocil7aWYoIXIuY3Jvc3NEb21haW58fGkuc3VwcG9ydC5jb3JzKXt2YXIgdTtyZXR1cm57c2VuZDpmdW5jdGlvbihmLGUpe3ZhciBoLHMsbz1yLnhocigpO2lmKHIudXNlcm5hbWU/by5vcGVuKHIudHlwZSxyLnVybCxyLmFzeW5jLHIudXNlcm5hbWUsci5wYXNzd29yZCk6by5vcGVuKHIudHlwZSxyLnVybCxyLmFzeW5jKSxyLnhockZpZWxkcylmb3IocyBpbiByLnhockZpZWxkcylvW3NdPXIueGhyRmllbGRzW3NdO3IubWltZVR5cGUmJm8ub3ZlcnJpZGVNaW1lVHlwZSYmby5vdmVycmlkZU1pbWVUeXBlKHIubWltZVR5cGUpO3IuY3Jvc3NEb21haW58fGZbXCJYLVJlcXVlc3RlZC1XaXRoXCJdfHwoZltcIlgtUmVxdWVzdGVkLVdpdGhcIl09XCJYTUxIdHRwUmVxdWVzdFwiKTt0cnl7Zm9yKHMgaW4gZilvLnNldFJlcXVlc3RIZWFkZXIocyxmW3NdKX1jYXRjaChjKXt9by5zZW5kKHIuaGFzQ29udGVudCYmci5kYXRhfHxudWxsKTt1PWZ1bmN0aW9uKG4sZil7dmFyIHMsYSx2LGMsbDt0cnl7aWYodSYmKGZ8fG8ucmVhZHlTdGF0ZT09PTQpKWlmKHU9dCxoJiYoby5vbnJlYWR5c3RhdGVjaGFuZ2U9aS5ub29wLHN0JiZkZWxldGUgd1toXSksZilvLnJlYWR5U3RhdGUhPT00JiZvLmFib3J0KCk7ZWxzZXtzPW8uc3RhdHVzO3Y9by5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKTtjPXt9O2w9by5yZXNwb25zZVhNTDtsJiZsLmRvY3VtZW50RWxlbWVudCYmKGMueG1sPWwpO3RyeXtjLnRleHQ9by5yZXNwb25zZVRleHR9Y2F0Y2gocCl7fXRyeXthPW8uc3RhdHVzVGV4dH1jYXRjaChwKXthPVwiXCJ9c3x8IXIuaXNMb2NhbHx8ci5jcm9zc0RvbWFpbj9zPT09MTIyMyYmKHM9MjA0KTpzPWMudGV4dD8yMDA6NDA0fX1jYXRjaCh5KXtmfHxlKC0xLHkpfWMmJmUocyxhLGMsdil9O3IuYXN5bmM/by5yZWFkeVN0YXRlPT09ND9zZXRUaW1lb3V0KHUsMCk6KGg9KytodSxzdCYmKHd8fCh3PXt9LGkobikudW5sb2FkKHN0KSksd1toXT11KSxvLm9ucmVhZHlzdGF0ZWNoYW5nZT11KTp1KCl9LGFib3J0OmZ1bmN0aW9uKCl7dSYmdSgwLDEpfX19fSk7dmFyIGIsaHQsaG89L14oPzp0b2dnbGV8c2hvd3xoaWRlKSQvLGNvPW5ldyBSZWdFeHAoXCJeKD86KFstK10pPXwpKFwiK250K1wiKShbYS16JV0qKSRcIixcImlcIiksbG89L3F1ZXVlSG9va3MkLyxjdD1beW9dLGQ9e1wiKlwiOltmdW5jdGlvbihuLHQpe3ZhciBvLHMscj10aGlzLmNyZWF0ZVR3ZWVuKG4sdCksZT1jby5leGVjKHQpLGg9ci5jdXIoKSx1PStofHwwLGY9MSxjPTIwO2lmKGUpe2lmKG89K2VbMl0scz1lWzNdfHwoaS5jc3NOdW1iZXJbbl0/XCJcIjpcInB4XCIpLHMhPT1cInB4XCImJnUpe3U9aS5jc3Moci5lbGVtLG4sITApfHxvfHwxO2RvIGY9Znx8XCIuNVwiLHU9dS9mLGkuc3R5bGUoci5lbGVtLG4sdStzKTt3aGlsZShmIT09KGY9ci5jdXIoKS9oKSYmZiE9PTEmJi0tYyl9ci51bml0PXM7ci5zdGFydD11O3IuZW5kPWVbMV0/dSsoZVsxXSsxKSpvOm99cmV0dXJuIHJ9XX07aS5BbmltYXRpb249aS5leHRlbmQoYXUse3R3ZWVuZXI6ZnVuY3Rpb24obix0KXtpLmlzRnVuY3Rpb24obik/KHQ9bixuPVtcIipcIl0pOm49bi5zcGxpdChcIiBcIik7Zm9yKHZhciByLHU9MCxmPW4ubGVuZ3RoO3U8Zjt1Kyspcj1uW3VdLGRbcl09ZFtyXXx8W10sZFtyXS51bnNoaWZ0KHQpfSxwcmVmaWx0ZXI6ZnVuY3Rpb24obix0KXt0P2N0LnVuc2hpZnQobik6Y3QucHVzaChuKX19KTtpLlR3ZWVuPWY7Zi5wcm90b3R5cGU9e2NvbnN0cnVjdG9yOmYsaW5pdDpmdW5jdGlvbihuLHQscix1LGYsZSl7dGhpcy5lbGVtPW47dGhpcy5wcm9wPXI7dGhpcy5lYXNpbmc9Znx8XCJzd2luZ1wiO3RoaXMub3B0aW9ucz10O3RoaXMuc3RhcnQ9dGhpcy5ub3c9dGhpcy5jdXIoKTt0aGlzLmVuZD11O3RoaXMudW5pdD1lfHwoaS5jc3NOdW1iZXJbcl0/XCJcIjpcInB4XCIpfSxjdXI6ZnVuY3Rpb24oKXt2YXIgbj1mLnByb3BIb29rc1t0aGlzLnByb3BdO3JldHVybiBuJiZuLmdldD9uLmdldCh0aGlzKTpmLnByb3BIb29rcy5fZGVmYXVsdC5nZXQodGhpcyl9LHJ1bjpmdW5jdGlvbihuKXt2YXIgdCxyPWYucHJvcEhvb2tzW3RoaXMucHJvcF07cmV0dXJuIHRoaXMucG9zPXRoaXMub3B0aW9ucy5kdXJhdGlvbj90PWkuZWFzaW5nW3RoaXMuZWFzaW5nXShuLHRoaXMub3B0aW9ucy5kdXJhdGlvbipuLDAsMSx0aGlzLm9wdGlvbnMuZHVyYXRpb24pOnQ9bix0aGlzLm5vdz0odGhpcy5lbmQtdGhpcy5zdGFydCkqdCt0aGlzLnN0YXJ0LHRoaXMub3B0aW9ucy5zdGVwJiZ0aGlzLm9wdGlvbnMuc3RlcC5jYWxsKHRoaXMuZWxlbSx0aGlzLm5vdyx0aGlzKSxyJiZyLnNldD9yLnNldCh0aGlzKTpmLnByb3BIb29rcy5fZGVmYXVsdC5zZXQodGhpcyksdGhpc319O2YucHJvdG90eXBlLmluaXQucHJvdG90eXBlPWYucHJvdG90eXBlO2YucHJvcEhvb2tzPXtfZGVmYXVsdDp7Z2V0OmZ1bmN0aW9uKG4pe3ZhciB0O3JldHVybiBuLmVsZW1bbi5wcm9wXSE9bnVsbCYmKCFuLmVsZW0uc3R5bGV8fG4uZWxlbS5zdHlsZVtuLnByb3BdPT1udWxsKT9uLmVsZW1bbi5wcm9wXToodD1pLmNzcyhuLmVsZW0sbi5wcm9wLCExLFwiXCIpLCF0fHx0PT09XCJhdXRvXCI/MDp0KX0sc2V0OmZ1bmN0aW9uKG4pe2kuZnguc3RlcFtuLnByb3BdP2kuZnguc3RlcFtuLnByb3BdKG4pOm4uZWxlbS5zdHlsZSYmKG4uZWxlbS5zdHlsZVtpLmNzc1Byb3BzW24ucHJvcF1dIT1udWxsfHxpLmNzc0hvb2tzW24ucHJvcF0pP2kuc3R5bGUobi5lbGVtLG4ucHJvcCxuLm5vdytuLnVuaXQpOm4uZWxlbVtuLnByb3BdPW4ubm93fX19O2YucHJvcEhvb2tzLnNjcm9sbFRvcD1mLnByb3BIb29rcy5zY3JvbGxMZWZ0PXtzZXQ6ZnVuY3Rpb24obil7bi5lbGVtLm5vZGVUeXBlJiZuLmVsZW0ucGFyZW50Tm9kZSYmKG4uZWxlbVtuLnByb3BdPW4ubm93KX19O2kuZWFjaChbXCJ0b2dnbGVcIixcInNob3dcIixcImhpZGVcIl0sZnVuY3Rpb24obix0KXt2YXIgcj1pLmZuW3RdO2kuZm5bdF09ZnVuY3Rpb24odSxmLGUpe3JldHVybiB1PT1udWxsfHx0eXBlb2YgdT09XCJib29sZWFuXCJ8fCFuJiZpLmlzRnVuY3Rpb24odSkmJmkuaXNGdW5jdGlvbihmKT9yLmFwcGx5KHRoaXMsYXJndW1lbnRzKTp0aGlzLmFuaW1hdGUobHQodCwhMCksdSxmLGUpfX0pO2kuZm4uZXh0ZW5kKHtmYWRlVG86ZnVuY3Rpb24obix0LGkscil7cmV0dXJuIHRoaXMuZmlsdGVyKGZ0KS5jc3MoXCJvcGFjaXR5XCIsMCkuc2hvdygpLmVuZCgpLmFuaW1hdGUoe29wYWNpdHk6dH0sbixpLHIpfSxhbmltYXRlOmZ1bmN0aW9uKG4sdCxyLHUpe3ZhciBlPWkuaXNFbXB0eU9iamVjdChuKSxmPWkuc3BlZWQodCxyLHUpLG89ZnVuY3Rpb24oKXt2YXIgdD1hdSh0aGlzLGkuZXh0ZW5kKHt9LG4pLGYpO2UmJnQuc3RvcCghMCl9O3JldHVybiBlfHxmLnF1ZXVlPT09ITE/dGhpcy5lYWNoKG8pOnRoaXMucXVldWUoZi5xdWV1ZSxvKX0sc3RvcDpmdW5jdGlvbihuLHIsdSl7dmFyIGY9ZnVuY3Rpb24obil7dmFyIHQ9bi5zdG9wO2RlbGV0ZSBuLnN0b3A7dCh1KX07cmV0dXJuIHR5cGVvZiBuIT1cInN0cmluZ1wiJiYodT1yLHI9bixuPXQpLHImJm4hPT0hMSYmdGhpcy5xdWV1ZShufHxcImZ4XCIsW10pLHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBvPSEwLHQ9biE9bnVsbCYmbitcInF1ZXVlSG9va3NcIixlPWkudGltZXJzLHI9aS5fZGF0YSh0aGlzKTtpZih0KXJbdF0mJnJbdF0uc3RvcCYmZihyW3RdKTtlbHNlIGZvcih0IGluIHIpclt0XSYmclt0XS5zdG9wJiZsby50ZXN0KHQpJiZmKHJbdF0pO2Zvcih0PWUubGVuZ3RoO3QtLTspZVt0XS5lbGVtPT09dGhpcyYmKG49PW51bGx8fGVbdF0ucXVldWU9PT1uKSYmKGVbdF0uYW5pbS5zdG9wKHUpLG89ITEsZS5zcGxpY2UodCwxKSk7KG98fCF1KSYmaS5kZXF1ZXVlKHRoaXMsbil9KX19KTtpLmVhY2goe3NsaWRlRG93bjpsdChcInNob3dcIiksc2xpZGVVcDpsdChcImhpZGVcIiksc2xpZGVUb2dnbGU6bHQoXCJ0b2dnbGVcIiksZmFkZUluOntvcGFjaXR5Olwic2hvd1wifSxmYWRlT3V0OntvcGFjaXR5OlwiaGlkZVwifSxmYWRlVG9nZ2xlOntvcGFjaXR5OlwidG9nZ2xlXCJ9fSxmdW5jdGlvbihuLHQpe2kuZm5bbl09ZnVuY3Rpb24obixpLHIpe3JldHVybiB0aGlzLmFuaW1hdGUodCxuLGkscil9fSk7aS5zcGVlZD1mdW5jdGlvbihuLHQscil7dmFyIHU9biYmdHlwZW9mIG49PVwib2JqZWN0XCI/aS5leHRlbmQoe30sbik6e2NvbXBsZXRlOnJ8fCFyJiZ0fHxpLmlzRnVuY3Rpb24obikmJm4sZHVyYXRpb246bixlYXNpbmc6ciYmdHx8dCYmIWkuaXNGdW5jdGlvbih0KSYmdH07cmV0dXJuIHUuZHVyYXRpb249aS5meC5vZmY/MDp0eXBlb2YgdS5kdXJhdGlvbj09XCJudW1iZXJcIj91LmR1cmF0aW9uOnUuZHVyYXRpb24gaW4gaS5meC5zcGVlZHM/aS5meC5zcGVlZHNbdS5kdXJhdGlvbl06aS5meC5zcGVlZHMuX2RlZmF1bHQsKHUucXVldWU9PW51bGx8fHUucXVldWU9PT0hMCkmJih1LnF1ZXVlPVwiZnhcIiksdS5vbGQ9dS5jb21wbGV0ZSx1LmNvbXBsZXRlPWZ1bmN0aW9uKCl7aS5pc0Z1bmN0aW9uKHUub2xkKSYmdS5vbGQuY2FsbCh0aGlzKTt1LnF1ZXVlJiZpLmRlcXVldWUodGhpcyx1LnF1ZXVlKX0sdX07aS5lYXNpbmc9e2xpbmVhcjpmdW5jdGlvbihuKXtyZXR1cm4gbn0sc3dpbmc6ZnVuY3Rpb24obil7cmV0dXJuLjUtTWF0aC5jb3MobipNYXRoLlBJKS8yfX07aS50aW1lcnM9W107aS5meD1mLnByb3RvdHlwZS5pbml0O2kuZngudGljaz1mdW5jdGlvbigpe3ZhciB1LG49aS50aW1lcnMscj0wO2ZvcihiPWkubm93KCk7cjxuLmxlbmd0aDtyKyspdT1uW3JdLHUoKXx8bltyXSE9PXV8fG4uc3BsaWNlKHItLSwxKTtuLmxlbmd0aHx8aS5meC5zdG9wKCk7Yj10fTtpLmZ4LnRpbWVyPWZ1bmN0aW9uKG4pe24oKSYmaS50aW1lcnMucHVzaChuKSYmIWh0JiYoaHQ9c2V0SW50ZXJ2YWwoaS5meC50aWNrLGkuZnguaW50ZXJ2YWwpKX07aS5meC5pbnRlcnZhbD0xMztpLmZ4LnN0b3A9ZnVuY3Rpb24oKXtjbGVhckludGVydmFsKGh0KTtodD1udWxsfTtpLmZ4LnNwZWVkcz17c2xvdzo2MDAsZmFzdDoyMDAsX2RlZmF1bHQ6NDAwfTtpLmZ4LnN0ZXA9e307aS5leHByJiZpLmV4cHIuZmlsdGVycyYmKGkuZXhwci5maWx0ZXJzLmFuaW1hdGVkPWZ1bmN0aW9uKG4pe3JldHVybiBpLmdyZXAoaS50aW1lcnMsZnVuY3Rpb24odCl7cmV0dXJuIG49PT10LmVsZW19KS5sZW5ndGh9KTtyaT0vXig/OmJvZHl8aHRtbCkkL2k7aS5mbi5vZmZzZXQ9ZnVuY3Rpb24obil7aWYoYXJndW1lbnRzLmxlbmd0aClyZXR1cm4gbj09PXQ/dGhpczp0aGlzLmVhY2goZnVuY3Rpb24odCl7aS5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsbix0KX0pO3ZhciB1LG8scyxoLGMsbCxhLGY9e3RvcDowLGxlZnQ6MH0scj10aGlzWzBdLGU9ciYmci5vd25lckRvY3VtZW50O2lmKGUpcmV0dXJuKG89ZS5ib2R5KT09PXI/aS5vZmZzZXQuYm9keU9mZnNldChyKToodT1lLmRvY3VtZW50RWxlbWVudCwhaS5jb250YWlucyh1LHIpKT9mOih0eXBlb2Ygci5nZXRCb3VuZGluZ0NsaWVudFJlY3QhPVwidW5kZWZpbmVkXCImJihmPXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkpLHM9dnUoZSksaD11LmNsaWVudFRvcHx8by5jbGllbnRUb3B8fDAsYz11LmNsaWVudExlZnR8fG8uY2xpZW50TGVmdHx8MCxsPXMucGFnZVlPZmZzZXR8fHUuc2Nyb2xsVG9wLGE9cy5wYWdlWE9mZnNldHx8dS5zY3JvbGxMZWZ0LHt0b3A6Zi50b3ArbC1oLGxlZnQ6Zi5sZWZ0K2EtY30pfTtpLm9mZnNldD17Ym9keU9mZnNldDpmdW5jdGlvbihuKXt2YXIgdD1uLm9mZnNldFRvcCxyPW4ub2Zmc2V0TGVmdDtyZXR1cm4gaS5zdXBwb3J0LmRvZXNOb3RJbmNsdWRlTWFyZ2luSW5Cb2R5T2Zmc2V0JiYodCs9cGFyc2VGbG9hdChpLmNzcyhuLFwibWFyZ2luVG9wXCIpKXx8MCxyKz1wYXJzZUZsb2F0KGkuY3NzKG4sXCJtYXJnaW5MZWZ0XCIpKXx8MCkse3RvcDp0LGxlZnQ6cn19LHNldE9mZnNldDpmdW5jdGlvbihuLHQscil7dmFyIGY9aS5jc3MobixcInBvc2l0aW9uXCIpO2Y9PT1cInN0YXRpY1wiJiYobi5zdHlsZS5wb3NpdGlvbj1cInJlbGF0aXZlXCIpO3ZhciBlPWkobiksbz1lLm9mZnNldCgpLGw9aS5jc3MobixcInRvcFwiKSxhPWkuY3NzKG4sXCJsZWZ0XCIpLHY9KGY9PT1cImFic29sdXRlXCJ8fGY9PT1cImZpeGVkXCIpJiZpLmluQXJyYXkoXCJhdXRvXCIsW2wsYV0pPi0xLHU9e30scz17fSxoLGM7dj8ocz1lLnBvc2l0aW9uKCksaD1zLnRvcCxjPXMubGVmdCk6KGg9cGFyc2VGbG9hdChsKXx8MCxjPXBhcnNlRmxvYXQoYSl8fDApO2kuaXNGdW5jdGlvbih0KSYmKHQ9dC5jYWxsKG4scixvKSk7dC50b3AhPW51bGwmJih1LnRvcD10LnRvcC1vLnRvcCtoKTt0LmxlZnQhPW51bGwmJih1LmxlZnQ9dC5sZWZ0LW8ubGVmdCtjKTtcInVzaW5nXCJpbiB0P3QudXNpbmcuY2FsbChuLHUpOmUuY3NzKHUpfX07aS5mbi5leHRlbmQoe3Bvc2l0aW9uOmZ1bmN0aW9uKCl7aWYodGhpc1swXSl7dmFyIHU9dGhpc1swXSxuPXRoaXMub2Zmc2V0UGFyZW50KCksdD10aGlzLm9mZnNldCgpLHI9cmkudGVzdChuWzBdLm5vZGVOYW1lKT97dG9wOjAsbGVmdDowfTpuLm9mZnNldCgpO3JldHVybiB0LnRvcC09cGFyc2VGbG9hdChpLmNzcyh1LFwibWFyZ2luVG9wXCIpKXx8MCx0LmxlZnQtPXBhcnNlRmxvYXQoaS5jc3ModSxcIm1hcmdpbkxlZnRcIikpfHwwLHIudG9wKz1wYXJzZUZsb2F0KGkuY3NzKG5bMF0sXCJib3JkZXJUb3BXaWR0aFwiKSl8fDAsci5sZWZ0Kz1wYXJzZUZsb2F0KGkuY3NzKG5bMF0sXCJib3JkZXJMZWZ0V2lkdGhcIikpfHwwLHt0b3A6dC50b3Atci50b3AsbGVmdDp0LmxlZnQtci5sZWZ0fX19LG9mZnNldFBhcmVudDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe2Zvcih2YXIgbj10aGlzLm9mZnNldFBhcmVudHx8ci5ib2R5O24mJiFyaS50ZXN0KG4ubm9kZU5hbWUpJiZpLmNzcyhuLFwicG9zaXRpb25cIik9PT1cInN0YXRpY1wiOyluPW4ub2Zmc2V0UGFyZW50O3JldHVybiBufHxyLmJvZHl9KX19KTtpLmVhY2goe3Njcm9sbExlZnQ6XCJwYWdlWE9mZnNldFwiLHNjcm9sbFRvcDpcInBhZ2VZT2Zmc2V0XCJ9LGZ1bmN0aW9uKG4scil7dmFyIHU9L1kvLnRlc3Qocik7aS5mbltuXT1mdW5jdGlvbihmKXtyZXR1cm4gaS5hY2Nlc3ModGhpcyxmdW5jdGlvbihuLGYsZSl7dmFyIG89dnUobik7aWYoZT09PXQpcmV0dXJuIG8/ciBpbiBvP29bcl06by5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbZl06bltmXTtvP28uc2Nyb2xsVG8odT9pKG8pLnNjcm9sbExlZnQoKTplLHU/ZTppKG8pLnNjcm9sbFRvcCgpKTpuW2ZdPWV9LG4sZixhcmd1bWVudHMubGVuZ3RoLG51bGwpfX0pO2kuZWFjaCh7SGVpZ2h0OlwiaGVpZ2h0XCIsV2lkdGg6XCJ3aWR0aFwifSxmdW5jdGlvbihuLHIpe2kuZWFjaCh7cGFkZGluZzpcImlubmVyXCIrbixjb250ZW50OnIsXCJcIjpcIm91dGVyXCIrbn0sZnVuY3Rpb24odSxmKXtpLmZuW2ZdPWZ1bmN0aW9uKGYsZSl7dmFyIG89YXJndW1lbnRzLmxlbmd0aCYmKHV8fHR5cGVvZiBmIT1cImJvb2xlYW5cIikscz11fHwoZj09PSEwfHxlPT09ITA/XCJtYXJnaW5cIjpcImJvcmRlclwiKTtyZXR1cm4gaS5hY2Nlc3ModGhpcyxmdW5jdGlvbihyLHUsZil7dmFyIGU7cmV0dXJuIGkuaXNXaW5kb3cocik/ci5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbXCJjbGllbnRcIituXTpyLm5vZGVUeXBlPT09OT8oZT1yLmRvY3VtZW50RWxlbWVudCxNYXRoLm1heChyLmJvZHlbXCJzY3JvbGxcIituXSxlW1wic2Nyb2xsXCIrbl0sci5ib2R5W1wib2Zmc2V0XCIrbl0sZVtcIm9mZnNldFwiK25dLGVbXCJjbGllbnRcIituXSkpOmY9PT10P2kuY3NzKHIsdSxmLHMpOmkuc3R5bGUocix1LGYscyl9LHIsbz9mOnQsbyxudWxsKX19KX0pO24ualF1ZXJ5PW4uJD1pO3R5cGVvZiBkZWZpbmU9PVwiZnVuY3Rpb25cIiYmZGVmaW5lLmFtZCYmZGVmaW5lLmFtZC5qUXVlcnkmJmRlZmluZShcImpxdWVyeVwiLFtdLGZ1bmN0aW9uKCl7cmV0dXJuIGl9KX0pKHdpbmRvdyk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1qcXVlcnktMS44LjMubWluLmpzLm1hcFxuIiwiLy8gQWRkIHN1cHBvcnQgZm9yIFwibWFpbHRvXCIgaW4gbGlua3Mgd2hlbiByZW5kZXJpbmcgdGVtcGxhdGVzXHJcblN5cy5VSS5UZW1wbGF0ZS5hbGxvd2VkUHJvdG9jb2xzLnB1c2goXCJtYWlsdG9cIik7XHJcblN5cy5VSS5UZW1wbGF0ZS5hbGxvd2VkUHJvdG9jb2xzLnB1c2goXCJmaWxlXCIpO1xyXG5TeXMuVUkuVGVtcGxhdGUuYWxsb3dlZFByb3RvY29scy5wdXNoKFwiaW50ZW50XCIpO1xyXG5cclxuRXhvV2ViLmNvbmZpZy5hdXRvQWN0aXZhdGlvbiA9IGZhbHNlO1xyXG5FeG9XZWIuY29uZmlnLmFsbG93VHlwZUxhenlMb2FkaW5nID0gZmFsc2U7XHJcbkV4b1dlYi5jb25maWcuZW5hYmxlQmF0Y2hDaGFuZ2VzID0gZmFsc2U7XHJcbkV4b1dlYi5jb25maWcuYWxsb3dPYmplY3RMYXp5TG9hZGluZyA9IHRydWU7XHJcbkV4b1dlYi5jb25maWcuYWxsb3dMaXN0TGF6eUxvYWRpbmcgPSB0cnVlO1xyXG5FeG9XZWIuY29uZmlnLmNhbGN1bGF0aW9uRXJyb3JEZWZhdWx0ID0gbnVsbDtcclxuXHJcbihmdW5jdGlvbiAoJCkge1xyXG5cdEV4b1dlYi5zZXRMb2dFcnJvclByb3ZpZGVyKGZ1bmN0aW9uIChtZXNzYWdlLCBlKSB7XHJcblx0XHQvLyBUaGlzIG1ldGhvZCBkb2VzIG5vdGhpbmcsIGJ1dCBpdCBpcyBuZWVkZWQgaW4gb3JkZXIgdG8gb3ZlcnJpZGUgdGhlIGRlZmF1bHRcclxuXHRcdC8vIFwibG9nIGVycm9yIHByb3ZpZGVyXCIgcmVnaXN0ZXJlZCBpbiBXZWJTZXJ2aWNlLmpzIGluIEV4b1dlYlxyXG5cdH0pO1xyXG5cclxuXHJcblx0ZnVuY3Rpb24gdXBkYXRlTmF0aXZlVGltZUZpZWxkKCkge1xyXG5cdFx0aWYgKHRoaXMudmFsdWUpIHtcclxuXHRcdFx0JCh0aGlzKS5yZW1vdmVDbGFzcyhcImMtdGltZXBpY2tlci1lbXB0eVwiKTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdCQodGhpcykuYWRkQ2xhc3MoXCJjLXRpbWVwaWNrZXItZW1wdHlcIik7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBzZXR1cE5hdGl2ZVRpbWVGaWVsZCgpIHtcclxuXHRcdHZhciBmaWZ0ZWVuTWludXRlc0luU2Vjb25kcyA9IDkwMDtcclxuXHJcblx0XHQkKHRoaXMpLmF0dHIoXCJzdGVwXCIsIGZpZnRlZW5NaW51dGVzSW5TZWNvbmRzKTtcclxuXHJcblx0XHQkKHRoaXMpLmF0dHIoXCJub3ZhbGlkYXRlXCIsIFwiXCIpO1xyXG5cclxuXHRcdC8vIEFkZCBhIGNsYXNzIHRvIGFuIGFuY2VzdG9yIGhpZGUgdGhlIGljb24gaW4gY2FzZSByZW1vdmFsIGZhaWxzIGR1ZSB0byBjaGFuZ2VzIGluIERPTSBzdHJ1Y3R1cmVcclxuXHRcdCQodGhpcykuY2xvc2VzdChcIi5jLWVkaXRvclwiKS5hZGRDbGFzcyhcImMtdXNlLW5hdGl2ZS1kYXRldGltZS1maWVsZHNcIik7XHJcblxyXG5cdFx0JCh0aGlzKS5jbG9zZXN0KFwiLmMtZWRpdG9yLXRpbWVcIikubmV4dChcIi5jLWVkaXRvci10aW1lLWljb25cIikucmVtb3ZlKCk7XHJcblxyXG5cdFx0dXBkYXRlTmF0aXZlVGltZUZpZWxkLmNhbGwodGhpcyk7XHJcblxyXG5cdFx0Ly8gRG9uJ3QgYWxsb3cgdGFiYmluZyBpbnRvIHRoZSB0ZXh0IGZpZWxkIG9uIG1vYmlsZSBkZXZpY2VzXHJcblx0XHQkKHRoaXMpLnNpYmxpbmdzKCdbdHlwZT1cInRleHRcIl0nKS5hdHRyKCd0YWJpbmRleCcsIC0xKTtcclxuXHJcblx0XHQvLyBEb24ndCBjaGFuZ2UgZm9jdXMgb24gaU9TLCBzaW5jZSBpdCBjYXVzZXMgdGhlIHBpY2tlciB0byBoaWRlIGFuZCBhcHBlYXJzIHRvIHRyYW5zZmVyIHRoZVxyXG5cdFx0Ly8gSEg6bW0gdGltZSB2YWx1ZSB0byB0aGUgZm9jdXNzZWQgdGV4dCBmaWVsZCwgYWxzbywgaU9TIGRvZXNuJ3Qgc2hvdyBmb2N1cyBpbmRpY2F0aW9uIGFueXdheVxyXG5cdFx0aWYgKCFDb2duaXRvLmlzRGV2aWNlVHlwZSgnaXBob25lfGlwb2R8aXBhZCcpKSB7XHJcblxyXG5cdFx0XHRpZiAoQ29nbml0by5pc0RldmljZVR5cGUoJ2FuZHJvaWQnKSkge1xyXG5cdFx0XHRcdC8vIERvbid0IGFsbG93IHRhYmJpbmcgaW50byB0aGUgdGltZSBmaWVsZCBpbiBhbmRyb2lkXHJcblx0XHRcdFx0Ly8gVGhpcyBlbXVsYXRlcyB0aGUgbmF0aXZlIGJlaGF2aW9yIG9mIHRoZSAndGltZScgZmllbGQgKGFzIHdlbGwgYXMgJ3NlbGVjdCcpIG9uIGFuZHJvaWRcclxuXHRcdFx0XHQkKHRoaXMpLmF0dHIoJ3RhYmluZGV4JywgLTEpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBTZXQgZm9jdXMgdG8gZmF1eCBpbnB1dCB3aGVuIG5hdGl2ZSB0aW1lIGlucHV0IGlzIGNsaWNrZWQgKGZvciB2aXN1YWwgZm9jdXMgaW5kaWNhdGlvbilcclxuXHRcdFx0JCh0aGlzKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0JCh0aGlzKS5zaWJsaW5ncygnW3R5cGU9XCJ0ZXh0XCJdJykuZm9jdXMoKTtcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gY3JlYXRlVGltZVBpY2tlcigpIHtcclxuXHRcdC8vIG9ubHkgZW5hYmxlIHRpbWVwaWNrZXIgZm9yIGN1bHR1cmVzIHRoYXQgYXJlIGNvbXBhdGlibGUgd2l0aCBlbi1VU1xyXG5cdFx0dmFyIGxvbmdUaW1lUGF0dGVybiA9IFN5cy5DdWx0dXJlSW5mby5DdXJyZW50Q3VsdHVyZS5kYXRlVGltZUZvcm1hdC5Mb25nVGltZVBhdHRlcm47XHJcblx0XHRpZiAobG9uZ1RpbWVQYXR0ZXJuLm1hdGNoKFwiXmg/aFs6Ll1tbVs6Ll1zcyB0dCRcIikgKXtcclxuXHRcdFx0JCh0aGlzKS50aW1lcGlja2VyKHtcclxuXHRcdFx0XHRBTURlc2lnbmF0b3I6IFN5cy5DdWx0dXJlSW5mby5DdXJyZW50Q3VsdHVyZS5kYXRlVGltZUZvcm1hdC5BTURlc2lnbmF0b3IsXHJcblx0XHRcdFx0UE1EZXNpZ25hdG9yOiBTeXMuQ3VsdHVyZUluZm8uQ3VycmVudEN1bHR1cmUuZGF0ZVRpbWVGb3JtYXQuUE1EZXNpZ25hdG9yLFxyXG5cdFx0XHRcdHRpbWVTZXBhcmF0b3I6IFN5cy5DdWx0dXJlSW5mby5DdXJyZW50Q3VsdHVyZS5kYXRlVGltZUZvcm1hdC5UaW1lU2VwYXJhdG9yLFxyXG5cdFx0XHRcdHR3b0RpZ2l0SG91ckZvcm1hdDogbG9uZ1RpbWVQYXR0ZXJuLnN1YnN0cmluZygwLCAyKSA9PSBcImhoXCJcclxuXHRcdFx0fSlcclxuXHRcdFx0Lm9uKFwiY2hhbmdlVGltZS50aW1lcGlja2VyXCIsIGZ1bmN0aW9uIChlKSB7XHJcblx0XHRcdFx0JHNpbXVsYXRlTXV0YXRpb25FdmVudCh0aGlzLCBcImNoYW5nZVwiLCBmYWxzZSwgdHJ1ZSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdFx0Ly8gMjQgaG91ciB0aW1lXHJcblx0XHRlbHNlIGlmIChsb25nVGltZVBhdHRlcm4ubWF0Y2goXCJeSD9IWzouXW1tWzouXXNzJFwiKSkge1xyXG5cdFx0XHQkKHRoaXMpLnRpbWVwaWNrZXIoe1xyXG5cdFx0XHRcdHNob3dNZXJpZGlhbjogZmFsc2UsXHJcblx0XHRcdFx0dGltZVNlcGFyYXRvcjogU3lzLkN1bHR1cmVJbmZvLkN1cnJlbnRDdWx0dXJlLmRhdGVUaW1lRm9ybWF0LlRpbWVTZXBhcmF0b3IsXHJcblx0XHRcdFx0dHdvRGlnaXRIb3VyRm9ybWF0OiBsb25nVGltZVBhdHRlcm4uc3Vic3RyaW5nKDAsIDIpID09IFwiSEhcIlxyXG5cdFx0XHR9KVxyXG5cdFx0XHQub24oXCJjaGFuZ2VUaW1lLnRpbWVwaWNrZXJcIiwgZnVuY3Rpb24gKGUpIHtcclxuXHRcdFx0XHQkc2ltdWxhdGVNdXRhdGlvbkV2ZW50KHRoaXMsIFwiY2hhbmdlXCIsIGZhbHNlLCB0cnVlKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBjcmVhdGVTaWduYXR1cmUoKSB7XHJcblxyXG5cdFx0dmFyIHNpZyA9ICQodGhpcykucGFyZW50KCk7XHJcblxyXG5cdFx0d2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHR2YXIganNpZ25hdHVyZSA9IHNpZy5jaGlsZHJlbigpLmZpcnN0KCk7XHJcblx0XHRcdHZhciBpbWcgPSBzaWcuZmluZChcImltZ1wiKTtcclxuXHJcblx0XHRcdC8vIElmIG5vIGNvbnRyb2xzIGZvdW5kLCBhYm9ydFxyXG5cdFx0XHRpZiAoIWpzaWduYXR1cmUubGVuZ3RoIHx8ICFpbWcubGVuZ3RoKSByZXR1cm47XHJcblxyXG5cdFx0XHQvLyBJbml0aWFsaXplIHRoZSBzaWduYXR1cmUgY29udHJvbFxyXG5cdFx0XHRqc2lnbmF0dXJlLmpTaWduYXR1cmUoeyBcImJhY2tncm91bmQtY29sb3JcIjogXCJ0cmFuc3BhcmVudFwiLCBjb2xvcjogaW1nLmNzcyhcImNvbG9yXCIpLCBcImRlY29yLWNvbG9yXCI6IFwiI2VlZVwiLCBoZWlnaHQ6IDE1MCwgd2lkdGg6IFwiMTAwJVwiIH0pO1xyXG5cclxuXHRcdFx0Ly8gSGlkZSB0aGUgc2lnbmF0dXJlIGNvbnRyb2wgaWYgYSBzaWduYXR1cmUgaXMgYWxyZWFkeSBwcmVzZW50XHJcblx0XHRcdC8vIFRoZSAubm90IGlzIHRvIGV4bGN1ZGUgdGhlIGMtcmVhZG9ubHkgYWRkZWQgdG8gY29udGFpbmVyIGMtZmllbGQgYW5kIGMtc2VjdGlvbiBmb3IgcmVhZC1vbmx5IHN1cHBvcnRcclxuXHRcdFx0aWYgKGltZy5hdHRyKFwic3JjXCIpLmxlbmd0aCB8fCBzaWcuY2xvc2VzdChcIi5jLXJlYWRvbmx5XCIpLm5vdChcIi5jLWZpZWxkLCAuYy1zZWN0aW9uXCIpLmxlbmd0aCkge1xyXG5cdFx0XHRcdGpzaWduYXR1cmUuaGlkZSgpO1xyXG5cclxuXHRcdFx0XHRpZiAoaW1nLmF0dHIoXCJzcmNcIikubGVuZ3RoKSB7XHJcblx0XHRcdFx0XHRzaWcuYWRkQ2xhc3MoXCJjLXNpZ25hdHVyZS1wcmVzZW50XCIpO1xyXG5cclxuXHRcdFx0XHRcdC8vIFRvIGhhdmUgc3ltbWV0cnkgd2l0aCBvdGhlciBzaWduYXR1cmUgaHRtbFxyXG5cdFx0XHRcdFx0c2lnLmNsb3Nlc3QoJy5jLWVkaXRvcicpLmZpbmQoJz4gZGl2JykuYWRkQ2xhc3MoXCJjLXNpZ25hdHVyZS1wcmVzZW50XCIpO1xyXG5cdFx0XHRcdFx0anNpZ25hdHVyZS5qU2lnbmF0dXJlKFwiaW1wb3J0RGF0YVwiLCBpbWcuYXR0cihcInNyY1wiKSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBPdGhlcndpc2UsIGhpZGUgdGhlIGltYWdlIHBsYWNlaG9sZGVyXHJcblx0XHRcdGVsc2VcclxuXHRcdFx0XHRpbWcuaGlkZSgpO1xyXG5cclxuXHRcdFx0aWYgKCQoanNpZ25hdHVyZSkucGFyZW50cyhcIi5jLXNpZ25hdHVyZVwiKS5oYXNDbGFzcyhcImMtcmVhZG9ubHlcIikpIHtcclxuXHRcdFx0XHQkKGpzaWduYXR1cmUpLmpTaWduYXR1cmUoXCJkaXNhYmxlXCIpXHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIFN1YnNjcmliZSB0byBjaGFuZ2UgZXZlbnRcclxuXHRcdFx0anNpZ25hdHVyZS5iaW5kKCdjaGFuZ2UnLCBmdW5jdGlvbiAoZSkge1xyXG5cclxuXHRcdFx0XHQvLyBHZXQgdGhlIHNpZ25hdHVyZVxyXG5cdFx0XHRcdHZhciBzaWduYXR1cmUgPSAkcGFyZW50Q29udGV4dERhdGEodGhpcyk7XHJcblxyXG5cdFx0XHRcdC8vIE5vIHNpZ25hdHVyZSBwcmVzZW50XHJcblx0XHRcdFx0aWYgKGpzaWduYXR1cmUualNpZ25hdHVyZShcImdldERhdGFcIiwgXCJuYXRpdmVcIikubGVuZ3RoICE9PSAwICYmIGpzaWduYXR1cmUuaXMoXCI6dmlzaWJsZVwiKSkge1xyXG5cdFx0XHRcdFx0Ly8gU2V0IHRoZSBzaWduYXR1cmUgU1ZHIGFuZCBQTkcgcHJvcGVydGllc1xyXG5cdFx0XHRcdFx0c2lnbmF0dXJlLnNldF9TdmcoXCJkYXRhOlwiICsganNpZ25hdHVyZS5qU2lnbmF0dXJlKFwiZ2V0RGF0YVwiLCBcInN2Z2Jhc2U2NFwiKS5qb2luKFwiLFwiKSk7XHJcblx0XHRcdFx0XHRzaWduYXR1cmUuc2V0X1BuZyhcImRhdGE6XCIgKyBqc2lnbmF0dXJlLmpTaWduYXR1cmUoXCJnZXREYXRhXCIsIFwiaW1hZ2VcIikuam9pbihcIixcIikpO1xyXG5cclxuXHRcdFx0XHRcdC8vIEFkZCBhIGNsYXNzIHRvIGluZGljYXRlIHRoYXQgYSBzaWduYXR1cmUgaXMgcHJlc2VudFxyXG5cdFx0XHRcdFx0anNpZ25hdHVyZS5wYXJlbnQoKS5hZGRDbGFzcyhcImMtc2lnbmF0dXJlLXByZXNlbnRcIik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdH0sIDApO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gY3JlYXRlQXV0b0NvbXBsZXRlKCkge1xyXG5cdFx0JCh0aGlzKS50eXBlYWhlYWQoe1xyXG5cdFx0ICAgIG1pbkxlbmd0aDogMCxcclxuICAgICAgICAgICAgc291cmNlOiBudWxsXHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdC8vIFRoZSB0b2dnbGUgaGFzIGJlZW4gcmUtaW1wbGVtZW50ZWQgdG8gbm8gbG9uZ2VyIGRlcGVuZCBvbiBjb2duaXRvLXRvZ2dsZS5qc1xyXG5cdC8vZnVuY3Rpb24gY3JlYXRlVG9nZ2xlKCkge1xyXG5cdC8vXHR2YXIgdGhhdCA9ICQodGhpcyk7XHJcblx0Ly9cdCQodGhpcylbJ2Jvb3RzdHJhcFN3aXRjaCddKCk7XHJcblx0Ly9cdCQodGhpcykuYm9vdHN0cmFwU3dpdGNoKCdzZXRBbmltYXRlZCcsIHRydWUpO1xyXG5cdC8vXHQkKHRoaXMpLnBhcmVudHMoXCIuaGFzLXN3aXRjaFwiKS5vbihcInN3aXRjaC1jaGFuZ2VcIiwgZnVuY3Rpb24gKCkge1xyXG5cdC8vXHRcdCRzaW11bGF0ZU11dGF0aW9uRXZlbnQodGhhdFswXSwgXCJjaGFuZ2VcIiwgZmFsc2UsIHRydWUpO1xyXG5cdC8vXHR9KTtcclxuXHQvL31cclxuXHJcblx0ZnVuY3Rpb24gY3JlYXRlUGxhY2Vob2xkZXIoKSB7XHJcblx0XHRpZiAoISQuZm4ucGxhY2Vob2xkZXIpIHJldHVybjtcclxuXHJcblx0XHQkKHRoaXMpLnBsYWNlaG9sZGVyKCk7XHJcblx0fVxyXG5cclxuXHQkKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuZXZlcih7XHJcblx0XHRzZWxlY3RvcjogXCJkaXYuYy1zaWduYXR1cmUgaW1nXCIsXHJcblx0XHRib3VuZDogY3JlYXRlU2lnbmF0dXJlXHJcblx0fSk7XHJcblxyXG5cdCQoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KS5ldmVyKHtcclxuXHRcdHNlbGVjdG9yOiBcImlucHV0W3R5cGU9dGV4dF0uYy10aW1lcGlja2VyXCIsXHJcblx0XHRib3VuZDogY3JlYXRlVGltZVBpY2tlclxyXG5cdH0pO1xyXG5cclxuXHQkKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuZXZlcih7XHJcblx0XHRzZWxlY3RvcjogXCJpbnB1dFt0eXBlPXRpbWVdLmMtdGltZXBpY2tlclwiLFxyXG5cdFx0Ym91bmQ6IHNldHVwTmF0aXZlVGltZUZpZWxkXHJcblx0fSk7XHJcblxyXG5cdCQoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KS5vbihcImlucHV0IGNoYW5nZSBmb2N1c1wiLCBcImlucHV0W3R5cGU9dGltZV0uYy10aW1lcGlja2VyXCIsIHVwZGF0ZU5hdGl2ZVRpbWVGaWVsZCk7XHJcblxyXG5cdCQoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KS5ldmVyKHtcclxuXHRcdHNlbGVjdG9yOiBcImlucHV0LmMtYXV0b2NvbXBsZXRlXCIsXHJcblx0XHRib3VuZDogY3JlYXRlQXV0b0NvbXBsZXRlXHJcblx0fSk7XHJcblxyXG5cdC8vIFRoZSB0b2dnbGUgaGFzIGJlZW4gcmUtaW1wbGVtZW50ZWQgdG8gbm8gbG9uZ2VyIGRlcGVuZCBvbiBjb2duaXRvLXRvZ2dsZS5qc1xyXG5cdC8vJChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpLmV2ZXIoe1xyXG5cdC8vXHRzZWxlY3RvcjogXCJpbnB1dC5jLXRvZ2dsZVwiLFxyXG5cdC8vXHRib3VuZDogY3JlYXRlVG9nZ2xlXHJcblx0Ly99KTtcclxuXHJcblx0JChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpLmV2ZXIoe1xyXG5cdFx0c2VsZWN0b3I6IFwiaW5wdXQsdGV4dGFyZWFcIixcclxuXHRcdGJvdW5kOiBjcmVhdGVQbGFjZWhvbGRlclxyXG5cdH0pO1xyXG5cclxuXHQkKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuZXZlcih7XHJcblx0XHRzZWxlY3RvcjogXCJpbnB1dC5jLW1hc2tcIixcclxuXHRcdGJvdW5kOiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHZhciBtYXNrID0gJCh0aGlzKS5hdHRyKFwiZGF0YS1tYXNrXCIpO1xyXG5cdFx0XHQkKHRoaXMpLm1hc2sobWFzaywgeyBhdXRvY2xlYXI6IGZhbHNlLCBhdXRvaW5pdDogZmFsc2UgfSk7XHJcblx0XHR9LFxyXG5cdFx0dW5ib3VuZDogZnVuY3Rpb24gKCkge1xyXG5cdFx0XHQkKHRoaXMpLnVubWFzaygpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHQvLyBDbGVhciBzaWduYXR1cmVzIHdoZW4gZGVsZXRlIGJ1dHRvbiBpcyBjbGlja2VkXHJcblx0JChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIuYy1zaWduYXR1cmUtcHJlc2VudCAuYy1zaWduYXR1cmUtZ2x5cGhcIiwgZnVuY3Rpb24gKCkge1xyXG5cdFx0Ly8gR2V0IHRoZSBzaWduYXR1cmVcclxuXHRcdHZhciBzaWduYXR1cmUgPSAkcGFyZW50Q29udGV4dERhdGEodGhpcyk7XHJcblxyXG5cdFx0Ly8gQ2xlYXIgdGhlIHNpZ25hdHVyZSBTVkcgYW5kIFBORyBwcm9wZXJ0aWVzXHJcblx0XHRzaWduYXR1cmUuc2V0X1N2ZyhudWxsKTtcclxuXHRcdHNpZ25hdHVyZS5zZXRfUG5nKG51bGwpO1xyXG5cclxuXHRcdC8vIFJlbW92ZSBzaWduYXR1cmUgaW5kaWNhdG9yXHJcblx0XHQkKHRoaXMpLnBhcmVudCgpLnJlbW92ZUNsYXNzKFwiYy1zaWduYXR1cmUtcHJlc2VudFwiKTtcclxuXHJcblx0XHQvLyBSZXNldCBhbmQgc2hvdyB0aGUgc2lnbmF0dXJlIGNvbnRyb2xcclxuXHRcdCQodGhpcykucGFyZW50KCkuY2hpbGRyZW4oKS5maXJzdCgpLmpTaWduYXR1cmUoXCJyZXNldFwiKS5zaG93KCk7XHJcblx0XHQkKHRoaXMpLnBhcmVudCgpLmNoaWxkcmVuKFwiaW1nXCIpLmhpZGUoKTtcclxuXHRcdHdpbmRvdy5zZXRUaW1lb3V0KENvZ25pdG8ucmVzaXplKTtcclxuXHR9KTtcclxuXHJcblx0Ly8gVG9nZ2xlXHJcblx0Ly8gVHJpZ2dlciB0b2dnbGUgd2l0aCBKUyBpbnN0ZWFkIG9mIDxsYWJlbD4gcGVyIEFYRSByZXBvcnRcclxuXHQkKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkub24oJ2NsaWNrJywgJy5jLXRvZ2dsZS0tY29udGFpbmVyJywgZnVuY3Rpb24gKCkge1xyXG5cdFx0JCh0aGlzKS5zaWJsaW5ncygnW3R5cGU9XCJjaGVja2JveFwiXScpLnRyaWdnZXIoJ2NsaWNrJykudHJpZ2dlcignZm9jdXMnKTtcclxuXHR9KTtcclxuXHJcbn0pKEV4b0pRdWVyeSB8fCBqUXVlcnkpO1xyXG4iLCJ3aW5kb3cuQ29nbml0byA9IHdpbmRvdy5Db2duaXRvIHx8IHt9O1xyXG5cclxuKGZ1bmN0aW9uKHdpbmRvdywgalF1ZXJ5KSB7XHJcblx0aWYgKCFqUXVlcnkpIHtcclxuXHRcdGNvbnNvbGUuZXJyb3IoXCJqUXVlcnkgbm90IGxvYWRlZC4gIENvZ25pdG8gZGVwZW5kcyBvbiBqUXVlcnkgMS43K1wiKTtcclxuXHR9XHJcblx0XHJcblx0d2luZG93LkV4b0pRdWVyeSA9IGpRdWVyeS5ub0NvbmZsaWN0KHRydWUpO1xyXG59KSh3aW5kb3csIGpRdWVyeSk7Iiwi77u/aWYgKHdpbmRvdy5YRG9tYWluUmVxdWVzdCkge1xyXG5cdGpRdWVyeS5hamF4VHJhbnNwb3J0KGZ1bmN0aW9uIChzKSB7XHJcblx0XHRpZiAocy5jcm9zc0RvbWFpbiAvKiYmIHMuYXN5bmMqLykge1xyXG5cdFx0XHRpZiAocy50aW1lb3V0KSB7XHJcblx0XHRcdFx0cy54ZHJUaW1lb3V0ID0gcy50aW1lb3V0O1xyXG5cdFx0XHRcdGRlbGV0ZSBzLnRpbWVvdXQ7XHJcblx0XHRcdH1cclxuXHRcdFx0dmFyIHhkcjtcclxuXHRcdFx0cmV0dXJuIHtcclxuXHRcdFx0XHRzZW5kOiBmdW5jdGlvbiAoXywgY29tcGxldGUpIHtcclxuXHRcdFx0XHRcdGZ1bmN0aW9uIGNhbGxiYWNrKHN0YXR1cywgc3RhdHVzVGV4dCwgcmVzcG9uc2UsIHJlc3BvbnNlSGVhZGVycykge1xyXG5cdFx0XHRcdFx0XHR4ZHIub25sb2FkID0geGRyLm9uZXJyb3IgPSB4ZHIub250aW1lb3V0ID0geGRyLm9ucHJvZ3Jlc3MgPSBmdW5jdGlvbigpIHsgfTtcclxuXHRcdFx0XHRcdFx0eGRyID0gdW5kZWZpbmVkO1xyXG5cclxuXHRcdFx0XHRcdFx0aWYgKHJlc3BvbnNlLnRleHQuc2xpY2UoMCwgOSkgPT09IFwiaWU5ZXJyb3I6XCIpIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UudGV4dC5zdWJzdHJpbmcoOSkpO1xyXG5cdFx0XHRcdFx0XHRcdHN0YXR1cyA9IGRhdGEuc3RhdHVzO1xyXG5cdFx0XHRcdFx0XHRcdHN0YXR1c1RleHQgPSBkYXRhLmRlc2NyaXB0aW9uO1xyXG5cdFx0XHRcdFx0XHRcdHJlc3BvbnNlLnRleHQgPSBcIlwiO1xyXG5cdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRjb21wbGV0ZShzdGF0dXMsIHN0YXR1c1RleHQsIHJlc3BvbnNlLCByZXNwb25zZUhlYWRlcnMpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0eGRyID0gbmV3IFhEb21haW5SZXF1ZXN0KCk7XHJcblxyXG5cdFx0XHRcdFx0aWYgKHMudXJsLnNsaWNlKDAsIDUpID09PSBcImh0dHBzXCIgJiYgd2luZG93LmxvY2F0aW9uLnByb3RvY29sID09PSBcImh0dHA6XCIpIHtcclxuXHRcdFx0XHRcdFx0cy51cmwgPSBzLnVybC5yZXBsYWNlKFwiaHR0cHNcIiwgXCJodHRwXCIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdHhkci5vcGVuKHMudHlwZSwgcy51cmwpO1xyXG5cdFx0XHRcdFx0eGRyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0Y2FsbGJhY2soMjAwLCBcIk9LXCIsIHtcclxuXHRcdFx0XHRcdFx0XHR0ZXh0OiB4ZHIucmVzcG9uc2VUZXh0XHJcblx0XHRcdFx0XHRcdH0sIFwiQ29udGVudC1UeXBlOiBcIiArIHhkci5jb250ZW50VHlwZSk7XHJcblx0XHRcdFx0XHR9O1xyXG5cdFx0XHRcdFx0eGRyLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdGNhbGxiYWNrKDUwMCwgXCJHZW5lcmFsIGVycm9yLlwiKTtcclxuXHRcdFx0XHRcdH07XHJcblx0XHRcdFx0XHR4ZHIub25wcm9ncmVzcyA9IGZ1bmN0aW9uICgpIHsgfTtcclxuXHRcdFx0XHRcdGlmIChzLnhkclRpbWVvdXQpIHtcclxuXHRcdFx0XHRcdFx0eGRyLm9udGltZW91dCA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0XHRjYWxsYmFjaygwLCBcInRpbWVvdXRcIik7XHJcblx0XHRcdFx0XHRcdH07XHJcblx0XHRcdFx0XHRcdHhkci50aW1lb3V0ID0gcy54ZHJUaW1lb3V0O1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0eGRyLnNlbmQoKHMuaGFzQ29udGVudCAmJiBzLmRhdGEpIHx8IG51bGwpO1xyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0YWJvcnQ6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdGlmICh4ZHIpIHtcclxuXHRcdFx0XHRcdFx0eGRyLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7IH07XHJcblx0XHRcdFx0XHRcdHhkci5hYm9ydCgpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fTtcclxuXHRcdH1cclxuXHR9KTtcclxufVxyXG4iLCJ3aW5kb3cuRXhvV2ViID0ge307XHJcbndpbmRvdy5FeG9XZWIuTW9kZWwgPSB7fTtcclxud2luZG93LkV4b1dlYi5NYXBwZXIgPSB7fTtcclxud2luZG93LkV4b1dlYi5VSSA9IHt9O1xyXG53aW5kb3cuRXhvV2ViLlZpZXcgPSB7fTtcclxud2luZG93LkV4b1dlYi5Eb3ROZXQgPSB7fTtcclxuXHJcbihmdW5jdGlvbihqUXVlcnkpIHtcclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuQ29uZmlnXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0dmFyIGNvbmZpZyA9IHtcclxuXHRcdC8vIEF2b2lkIHBhdHRlcm5zIHRoYXQgY2FuIG1ha2UgZGVidWdnaW5nIG1vcmUgZGlmZmljdWx0LCB0cnkvY2F0Y2ggZm9yIGV4YW1wbGUuXHJcblx0XHRkZWJ1ZzogZmFsc2UsXHJcblxyXG5cdFx0Ly8gSW5kaWNhdGVzIHRoYXQgc2lnbmFsIHNob3VsZCB1c2Ugd2luZG93LnNldFRpbWVvdXQgd2hlbiBpbnZva2luZyBjYWxsYmFja3MuIFRoaXMgaXNcclxuXHRcdC8vIGRvbmUgaW4gb3JkZXIgdG8gZ2V0IGFyb3VuZCBwcm9ibGVtcyB3aXRoIGJyb3dzZXIgY29tcGxhaW5pbmcgYWJvdXQgbG9uZy1ydW5uaW5nIHNjcmlwdC5cclxuXHRcdHNpZ25hbFRpbWVvdXQ6IGZhbHNlLFxyXG5cclxuXHRcdC8vIFRoZSBtYXhpbXVtIG51bWJlciBvZiBwZW5kaW5nIHNpZ25hbHMgdG8gZXhlY3V0ZSBhcyBhIGJhdGNoLlxyXG5cdFx0Ly8gQnkgZGVmYXVsdCB0aGlzIGlzIG51bGwsIHdoaWNoIG1lYW5zIHRoYXQgbm8gbWF4aW11bSBpcyBlbmZvcmNlZC5cclxuXHRcdHNpZ25hbE1heEJhdGNoU2l6ZTogbnVsbCxcclxuXHJcblx0XHQvLyBDYXVzZXMgdGhlIHF1ZXJ5IHByb2Nlc3NpbmcgdG8gbG9hZCBtb2RlbCByb290cyBpbiB0aGUgcXVlcnkgaW5kaXZpZHVhbGx5LiBCeSBkZWZhdWx0IHRoZXkgYXJlIGJhdGNoLWxvYWRlZC5cclxuXHRcdGluZGl2aWR1YWxRdWVyeUxvYWRpbmc6IGZhbHNlLFxyXG5cclxuXHRcdC8vIFVuaXF1ZWx5IGlkZW50aWZpZXMgdGhpcyBhcHBsaWNhdGlvbiBpZiBtb3JlIHRoYW4gb25lIGFwcCBpcyBob3N0ZWQgdW5kZXIgdGhlIHNhbWUgZG9tYWluIG5hbWUuXHJcblx0XHRhcHBJbnN0YW5jZUlkOiBcIj9cIixcclxuXHJcblx0XHQvLyBBdXRvbWF0aWMgRE9NIGFjdGl2YXRpb24gd2hlbiBkb2N1bWVudC5yZWFkeSBmaXJlc1xyXG5cdFx0YXV0b0FjdGl2YXRpb246IHRydWUsXHJcblxyXG5cdFx0Ly8gQ29udHJvbHMgZGlmZmVyZW50IHdoZXRoZXIgbGF6eSBsb2FkaW5nIGFyZSBhbGxvd2VkLiBJZiBzZXQgdG8gZmFsc2UsIGFuIGVycm9yIGlzIHJhaXNlZCB3aGVuIGxhenkgbG9hZGluZyBvY2N1cnMuXHJcblx0XHRhbGxvd1R5cGVMYXp5TG9hZGluZzogdHJ1ZSxcclxuXHRcdGFsbG93T2JqZWN0TGF6eUxvYWRpbmc6IHRydWUsXHJcblx0XHRhbGxvd0xpc3RMYXp5TG9hZGluZzogdHJ1ZSxcclxuXHJcblx0XHQvLyBBbGxvd3MgYWRkaXRpb25hbCBzY29wZSB2YXJpYWJsZXMgdG8gYmUgaW50cm9kdWNlZCBmb3IgZHluYW1pY2FsbHkgY29tcGlsZWQgZXhwcmVzc2lvbnNcclxuXHRcdGV4cHJlc3Npb25TY29wZTogbnVsbCxcclxuXHJcblx0XHQvLyBTcGVjaWZpZXMgdGhlIGRlZmF1bHQgZGVmYXVsdElmRXJyb3IgdmFsdWUgZm9yIENhbGN1bGF0ZWRQcm9wZXJ0eVJ1bGUgaW5zdGFuY2VzXHJcblx0XHRjYWxjdWxhdGlvbkVycm9yRGVmYXVsdDogdW5kZWZpbmVkLFxyXG5cclxuXHRcdC8vIFNwZWNpZmllcyB3aGV0aGVyIHRoZSBhZGFwdGVyIHNob3VsZCB1cGRhdGUgYSBjb250cm9sJ3MgdmFsdWUgd2hlbiB0aGUgZGlzcGxheVxyXG5cdFx0Ly8gdmFsdWUgaXMgdXBkYXRlZCB3aGlsZSBiZWluZyBzZXQsIGZvciBleGFtcGxlIGR1ZSB0byBhcHBseWluZyBhIGZvcm1hdC5cclxuXHRcdGF1dG9SZWZvcm1hdDogdHJ1ZSxcclxuXHJcblx0XHQvLyBTcGVjaWZpZXMgd2hldGhlciBjaGFuZ2VzIHNob3VsZCBiZSBjb2xsZWN0ZWQgaW4gbG9naWNhbCBiYXRjaGVzLlxyXG5cdFx0ZW5hYmxlQmF0Y2hDaGFuZ2VzOiB0cnVlLFxyXG5cclxuXHRcdC8vIFNwZWNpZmllcyB3aGV0aGVyIFwicnVuYXdheVwiIHJ1bGVzIHNob3VsZCBiZSBkZXRlY3RlZCwgZS5nLiB0aGUgY2FzZSB3aGVyZSBhXHJcblx0XHQvLyBydWxlIGNhdXNlcyBpdHNlbGYgdG8gYmUgcmUtZW50ZXJlZCBjb250aW51YWxseSAod2hldGVyIGRpcmVjdGx5IG9yIGluZGlyZWN0bHkpLlxyXG5cdFx0ZGV0ZWN0UnVuYXdheVJ1bGVzOiBmYWxzZSxcclxuXHJcblx0XHQvLyBDb250cm9scyB0aGUgbWF4aW11bSBudW1iZXIgb2YgdGltZXMgdGhhdCBhIGNoaWxkIGV2ZW50IHNjb3BlIGNhbiB0cmFuc2ZlciBldmVudHNcclxuXHRcdC8vIHRvIGl0cyBwYXJlbnQgd2hpbGUgdGhlIHBhcmVudCBzY29wZSBpcyBleGl0aW5nLiBBIGxhcmdlIG51bWJlciBpbmRpY2F0ZXMgdGhhdFxyXG5cdFx0Ly8gcnVsZXMgYXJlIG5vdCByZWFjaGluZyBzdGVhZHktc3RhdGUuIFRlY2huaWNhbGx5IHNvbWV0aGluZyBvdGhlciB0aGFuIHJ1bGVzIGNvdWxkXHJcblx0XHQvLyBjYXVzZSB0aGlzIHNjZW5hcmlvLCBidXQgaW4gcHJhY3RpY2UgdGhleSBhcmUgdGhlIHByaW1hcnkgdXNlLWNhc2UgZm9yIGV2ZW50IHNjb3BlLiBcclxuXHRcdG5vbkV4aXRpbmdTY29wZU5lc3RpbmdDb3VudDogMTAwXHJcblx0fTtcclxuXHJcblx0RXhvV2ViLmNvbmZpZyA9IGNvbmZpZztcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5VbmxvYWRcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHQvLyBBdHRhY2ggdG8gdGhlIHVubG9hZCBldmVudCBhbmQgY2hhbmdlIHRoZSBwYWdlIHN0YXRlIHNvIHRoYXQgc2NyaXB0cyBjYW5cclxuXHQvLyB0b2dnbGUgdGhlaXIgYmVoYXZpb3IgYW5kIG5vdCBkbyB0aGluZ3MgdGhhdCB3aWxsIGZhaWwgZHVyaW5nIHVubG9hZC4gXHJcblx0RXhvV2ViLndpbmRvd0lzVW5sb2FkaW5nID0gZmFsc2U7XHJcblx0aWYgKHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKSB7XHJcblx0XHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInVubG9hZFwiLCBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdEV4b1dlYi53aW5kb3dJc1VubG9hZGluZyA9IHRydWU7XHJcblx0XHR9LCBmYWxzZSk7XHJcblx0fSBlbHNlIGlmICh3aW5kb3cuYXR0YWNoRXZlbnQpIHtcclxuXHRcdHdpbmRvdy5hdHRhY2hFdmVudChcIm9udW5sb2FkXCIsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0RXhvV2ViLndpbmRvd0lzVW5sb2FkaW5nID0gdHJ1ZTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5FcnJvcnNcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHRmdW5jdGlvbiBBcmd1bWVudFR5cGVFcnJvcihhcmd1bWVudE5hbWUsIGV4cGVjdGVkVHlwZSwgYWN0dWFsVmFsdWUpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNBcmd1bWVudFR5cGVFcnJvci4jY3RvclwiPlxyXG5cdFx0Ly8vIEFuIGVycm9yIHR5cGUgdGhhdCBpcyByYWlzZWQgd2hlbiBhbiBhcmd1bWVudCB0byBhIGZ1bmN0aW9uXHJcblx0XHQvLy8gaXMgb2YgdGhlIHdyb25nIHR5cGUuXHJcblx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiYXJndW1lbnROYW1lXCIgdHlwZT1cIlN0cmluZ1wiPlRoZSBuYW1lIG9mIHRoZSBhcmd1bWVudCB0aGF0IHdhcyBvZiB0aGUgd3JvbmcgdHlwZS48L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiZXhwZWN0ZWRUeXBlXCIgdHlwZT1cIlN0cmluZ1wiPlRoZSBleHBlY3RlZCB0eXBlIG9mIHRoZSBhcmd1bWVudHMuPC9wYXJhbT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cInZhbHVlXCI+VGhlIGFjdHVhbCBudW1iZXIgb2YgYXJndW1lbnRzIHRoYXQgd2VyZSBnaXZlbi48L3BhcmFtPlxyXG5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAzKSB0aHJvdyBuZXcgQXJndW1lbnRzTGVuZ3RoRXJyb3IoMywgYXJndW1lbnRzLmxlbmd0aCk7XHJcblx0XHRpZiAoYXJndW1lbnROYW1lID09IG51bGwpIHRocm93IG5ldyBBcmd1bWVudE51bGxFcnJvcihcImFyZ3VtZW50TmFtZVwiKTtcclxuXHRcdGlmICh0eXBlb2YoYXJndW1lbnROYW1lKSAhPT0gXCJzdHJpbmdcIikgdGhyb3cgbmV3IEFyZ3VtZW50VHlwZUVycm9yKFwiYXJndW1lbnROYW1lXCIsIFwic3RyaW5nXCIsIGFyZ3VtZW50TmFtZSk7XHJcblx0XHRpZiAoZXhwZWN0ZWRUeXBlID09IG51bGwpIHRocm93IG5ldyBBcmd1bWVudE51bGxFcnJvcihcImV4cGVjdGVkVHlwZVwiKTtcclxuXHRcdGlmICh0eXBlb2YoZXhwZWN0ZWRUeXBlKSAhPT0gXCJzdHJpbmdcIikgdGhyb3cgbmV3IEFyZ3VtZW50VHlwZUVycm9yKFwiZXhwZWN0ZWRUeXBlXCIsIFwic3RyaW5nXCIsIGV4cGVjdGVkVHlwZSk7XHJcblxyXG5cdFx0dGhpcy5uYW1lID0gXCJBcmd1bWVudFR5cGVFcnJvclwiO1xyXG5cdFx0dGhpcy5hcmd1bWVudE5hbWUgPSBhcmd1bWVudE5hbWU7XHJcblx0XHR0aGlzLmV4cGVjdGVkVHlwZSA9IGV4cGVjdGVkVHlwZTtcclxuXHRcdHRoaXMuYWN0dWFsVmFsdWUgPSBhY3R1YWxWYWx1ZTtcclxuXHRcdHRoaXMubWVzc2FnZSA9IFwiQXJndW1lbnQgJ1wiICsgYXJndW1lbnROYW1lICsgXCInIG11c3QgYmUgb2YgdHlwZSBcIiArIGV4cGVjdGVkVHlwZSArIFwiOiBcIiArIGFjdHVhbFZhbHVlICsgXCIuXCI7XHJcblx0fVxyXG5cclxuXHRBcmd1bWVudFR5cGVFcnJvci5wcm90b3R5cGUgPSBuZXcgRXJyb3IoKTtcclxuXHRBcmd1bWVudFR5cGVFcnJvci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBBcmd1bWVudFR5cGVFcnJvcjtcclxuXHJcblx0RXhvV2ViLkFyZ3VtZW50VHlwZUVycm9yID0gQXJndW1lbnRUeXBlRXJyb3I7XHJcblx0d2luZG93LkFyZ3VtZW50VHlwZUVycm9yID0gQXJndW1lbnRUeXBlRXJyb3I7XHJcblxyXG5cdGZ1bmN0aW9uIEFyZ3VtZW50c0xlbmd0aEVycm9yKGV4cGVjdGVkLCBhY3R1YWwpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNBcmd1bWVudHNMZW5ndGhFcnJvci4jY3RvclwiPlxyXG5cdFx0Ly8vIEFuIGVycm9yIHR5cGUgdGhhdCBpcyByYWlzZWQgd2hlbiB0aGUgd3JvbmcgbnVtYmVyXHJcblx0XHQvLy8gb2YgYXJndW1lbnRzIGlzIHBhc3NlZCB0byBhIGZ1bmN0aW9uLlxyXG5cdFx0Ly8vIDwvc3VtbWFyeT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImV4cGVjdGVkXCIgdHlwZT1cIk51bWJlclwiPlRoZSBleHBlY3RlZCBudW1iZXIgb2YgYXJndW1lbnRzLjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJhY3R1YWxcIiB0eXBlPVwiTnVtYmVyXCI+VGhlIGFjdHVhbCBudW1iZXIgb2YgYXJndW1lbnRzIHRoYXQgd2VyZSBnaXZlbi48L3BhcmFtPlxyXG5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAyKSB0aHJvdyBuZXcgQXJndW1lbnRzTGVuZ3RoRXJyb3IoMiwgYXJndW1lbnRzLmxlbmd0aCk7XHJcblx0XHRpZiAoZXhwZWN0ZWQgPT0gbnVsbCkgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEVycm9yKFwiZXhwZWN0ZWRcIik7XHJcblx0XHRpZiAoYWN0dWFsID09IG51bGwpIHRocm93IG5ldyBBcmd1bWVudE51bGxFcnJvcihcImFjdHVhbFwiKTtcclxuXHRcdGlmICh0eXBlb2YoZXhwZWN0ZWQpICE9PSBcIm51bWJlclwiKSB0aHJvdyBuZXcgQXJndW1lbnRUeXBlRXJyb3IoXCJleHBlY3RlZFwiLCBcIm51bWJlclwiLCBleHBlY3RlZCk7XHJcblx0XHRpZiAodHlwZW9mKGFjdHVhbCkgIT09IFwibnVtYmVyXCIpIHRocm93IG5ldyBBcmd1bWVudFR5cGVFcnJvcihcImFjdHVhbFwiLCBcIm51bWJlclwiLCBhY3R1YWwpO1xyXG5cclxuXHRcdHRoaXMubmFtZSA9IFwiQXJndW1lbnRzTGVuZ3RoRXJyb3JcIjtcclxuXHRcdHRoaXMuZXhwZWN0ZWQgPSBleHBlY3RlZDtcclxuXHRcdHRoaXMuYWN0dWFsID0gYWN0dWFsO1xyXG5cdFx0dGhpcy5tZXNzYWdlID0gXCJUaGUgbnVtYmVyIG9mIGFyZ3VtZW50cyBpcyBub3QgY29ycmVjdCwgZXhwZWN0ZWQgXCIgKyBleHBlY3RlZCArIFwiLCBhY3R1YWwgXCIgKyBhY3R1YWwgKyBcIi5cIjtcclxuXHR9XHJcblxyXG5cdEFyZ3VtZW50c0xlbmd0aEVycm9yLnByb3RvdHlwZSA9IG5ldyBFcnJvcigpO1xyXG5cdEFyZ3VtZW50c0xlbmd0aEVycm9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEFyZ3VtZW50c0xlbmd0aEVycm9yO1xyXG5cclxuXHRFeG9XZWIuQXJndW1lbnRzTGVuZ3RoRXJyb3IgPSBBcmd1bWVudHNMZW5ndGhFcnJvcjtcclxuXHR3aW5kb3cuQXJndW1lbnRzTGVuZ3RoRXJyb3IgPSBBcmd1bWVudHNMZW5ndGhFcnJvcjtcclxuXHJcblx0ZnVuY3Rpb24gQXJndW1lbnROdWxsRXJyb3IoYXJndW1lbnROYW1lLCByZWFzb24pIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNBcmd1bWVudE51bGxFcnJvci4jY3RvclwiPlxyXG5cdFx0Ly8vIEFuIGVycm9yIHR5cGUgdGhhdCBpcyByYWlzZWQgd2hlbiBhbiBhcmd1bWVudCBpc1xyXG5cdFx0Ly8vIG51bGwgb3IgdW5kZWZpbmVkIGFuZCBpdCBtdXN0IGhhdmUgYSB2YWx1ZS5cclxuXHRcdC8vLyA8L3N1bW1hcnk+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJhcmd1bWVudE5hbWVcIiB0eXBlPVwiU3RyaW5nXCI+VGhlIG5hbWUgb2YgdGhlIGFyZ3VtZW50IHRoYXQgd2FzIG51bGwuPC9wYXJhbT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cInJlYXNvblwiIHR5cGU9XCJTdHJpbmdcIj5UaGUgcmVhc29uIHRoYXQgdGhlIGFyZ3VtZW50IGNhbm5vdCBiZSBudWxsLjwvcGFyYW0+XHJcblxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPCAxICYmIGFyZ3VtZW50cy5sZW5ndGggPiAyKSB0aHJvdyBuZXcgQXJndW1lbnRzTGVuZ3RoRXJyb3IoMiwgYXJndW1lbnRzLmxlbmd0aCk7XHJcblx0XHRpZiAoYXJndW1lbnROYW1lID09IG51bGwpIHRocm93IG5ldyBBcmd1bWVudE51bGxFcnJvcihcImFyZ3VtZW50TmFtZVwiKTtcclxuXHRcdGlmICh0eXBlb2YoYXJndW1lbnROYW1lKSAhPT0gXCJzdHJpbmdcIikgdGhyb3cgbmV3IEFyZ3VtZW50VHlwZUVycm9yKFwiYXJndW1lbnROYW1lXCIsIFwic3RyaW5nXCIsIGFyZ3VtZW50TmFtZSk7XHJcblx0XHRpZiAocmVhc29uICE9IG51bGwgJiYgdHlwZW9mKHJlYXNvbikgIT09IFwic3RyaW5nXCIpIHRocm93IG5ldyBBcmd1bWVudFR5cGVFcnJvcihcInJlYXNvblwiLCBcInN0cmluZ1wiLCByZWFzb24pO1xyXG5cclxuXHRcdHRoaXMubmFtZSA9IFwiQXJndW1lbnROdWxsRXJyb3JcIjtcclxuXHRcdHRoaXMuYXJndW1lbnROYW1lID0gYXJndW1lbnROYW1lO1xyXG5cdFx0dGhpcy5yZWFzb24gPSByZWFzb247XHJcblx0XHR0aGlzLm1lc3NhZ2UgPSBcIkFyZ3VtZW50ICdcIiArIGFyZ3VtZW50TmFtZSArIFwiJyBjYW5ub3QgYmUgbnVsbCBvciB1bmRlZmluZWRcIiArIChyZWFzb24gPyBcIjogXCIgKyByZWFzb24gKyBcIi5cIiA6IFwiLlwiKTtcclxuXHR9XHJcblxyXG5cdEFyZ3VtZW50TnVsbEVycm9yLnByb3RvdHlwZSA9IG5ldyBFcnJvcigpO1xyXG5cdEFyZ3VtZW50TnVsbEVycm9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEFyZ3VtZW50TnVsbEVycm9yO1xyXG5cclxuXHRFeG9XZWIuQXJndW1lbnROdWxsRXJyb3IgPSBBcmd1bWVudE51bGxFcnJvcjtcclxuXHR3aW5kb3cuQXJndW1lbnROdWxsRXJyb3IgPSBBcmd1bWVudE51bGxFcnJvcjtcclxuXHJcblx0ZnVuY3Rpb24gQXJndW1lbnRFcnJvcihhcmd1bWVudE5hbWUsIHJlYXNvbikge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI0FyZ3VtZW50TnVsbEVycm9yLiNjdG9yXCI+XHJcblx0XHQvLy8gQW4gZXJyb3IgdHlwZSB0aGF0IGlzIHJhaXNlZCB3aGVuIGFuIGFyZ3VtZW50IGhhcyBhbiBpbnZhbGlkIHZhbHVlLlxyXG5cdFx0Ly8vIDwvc3VtbWFyeT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImFyZ3VtZW50TmFtZVwiIHR5cGU9XCJTdHJpbmdcIj5UaGUgbmFtZSBvZiB0aGUgYXJndW1lbnQgdGhhdCB3YXMgbnVsbC48L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwicmVhc29uXCIgdHlwZT1cIlN0cmluZ1wiPlRoZSByZWFzb24gdGhhdCB0aGUgYXJndW1lbnQgY2Fubm90IGJlIG51bGwuPC9wYXJhbT5cclxuXHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMikgdGhyb3cgbmV3IEFyZ3VtZW50c0xlbmd0aEVycm9yKDIsIGFyZ3VtZW50cy5sZW5ndGgpO1xyXG5cdFx0aWYgKGFyZ3VtZW50TmFtZSA9PSBudWxsKSB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXJyb3IoXCJhcmd1bWVudE5hbWVcIik7XHJcblx0XHRpZiAodHlwZW9mIChhcmd1bWVudE5hbWUpICE9PSBcInN0cmluZ1wiKSB0aHJvdyBuZXcgQXJndW1lbnRUeXBlRXJyb3IoXCJhcmd1bWVudE5hbWVcIiwgXCJzdHJpbmdcIiwgYXJndW1lbnROYW1lKTtcclxuXHRcdGlmIChyZWFzb24gPT0gbnVsbCkgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEVycm9yKFwicmVhc29uXCIpO1xyXG5cdFx0aWYgKHR5cGVvZiAocmVhc29uKSAhPT0gXCJzdHJpbmdcIikgdGhyb3cgbmV3IEFyZ3VtZW50VHlwZUVycm9yKFwicmVhc29uXCIsIFwic3RyaW5nXCIsIHJlYXNvbik7XHJcblxyXG5cdFx0dGhpcy5uYW1lID0gXCJBcmd1bWVudEVycm9yXCI7XHJcblx0XHR0aGlzLmFyZ3VtZW50TmFtZSA9IGFyZ3VtZW50TmFtZTtcclxuXHRcdHRoaXMucmVhc29uID0gcmVhc29uO1xyXG5cdFx0dGhpcy5tZXNzYWdlID0gXCJBcmd1bWVudCAnXCIgKyBhcmd1bWVudE5hbWUgKyBcIicgaGFzIGFuIGludmFsaWQgdmFsdWVcIiArIChyZWFzb24gPyBcIjogXCIgKyByZWFzb24gKyBcIi5cIiA6IFwiLlwiKTtcclxuXHR9XHJcblxyXG5cdEFyZ3VtZW50RXJyb3IucHJvdG90eXBlID0gbmV3IEVycm9yKCk7XHJcblx0QXJndW1lbnRFcnJvci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBBcmd1bWVudEVycm9yO1xyXG5cclxuXHRFeG9XZWIuQXJndW1lbnRFcnJvciA9IEFyZ3VtZW50RXJyb3I7XHJcblx0d2luZG93LkFyZ3VtZW50RXJyb3IgPSBBcmd1bWVudEVycm9yO1xyXG5cclxuXHR2YXIgbG9nRXJyb3JQcm92aWRlciA9IG51bGw7XHJcblxyXG5cdGZ1bmN0aW9uIHNldExvZ0Vycm9yUHJvdmlkZXIoZm4pIHtcclxuXHRcdC8vLyA8c3VtbWFyeT5cclxuXHRcdC8vLyBQcm92aWRlIGFuIGltcGxlbWVudGF0aW9uIG9mIHRoZSBMb2dFcnJvciBwcm92aWRlci5cclxuXHRcdC8vLyA8L3N1bW1hcnk+XHJcblx0XHQvLy8gPHJlbWFya3M+XHJcblx0XHQvLy9cclxuXHRcdC8vLyBFdmVudCBwcm9wb2dhdGlvblxyXG5cdFx0Ly8vID09PT09PT09PT09PT09PT09XHJcblx0XHQvLy9cclxuXHRcdC8vLyBXaGVuIHRoZSBnbG9iYWwgZXJyb3IgZXZlbnQgb2NjdXJzLCB0aGUgbG9nIGVycm9yIGhhbmRsZXIgaXMgY2FsbGVkIGxhc3RcclxuXHRcdC8vLyBiZWZvcmUgZXhpdGluZy4gIFRoaXMgYWxsb3dzIGV4aXN0aW5nIHN1YnNjcmliZXJzIHRvIGhhbmRsZSB0aGUgZXJyb3IgYW5kXHJcblx0XHQvLy8gcHJldmVudCBwcm9wb2dhdGlvbiwgYWxzbyBwcmV2ZW50aW5nIHRoZSBlcnJvciBmcm9tIGJlaW5nIGxvZ2dlZC4gU3Vic2NyaWJlcnNcclxuXHRcdC8vLyB0aGF0IGF0dGFjaCB0byB0aGUgZXJyb3IgZXZlbnQgYWZ0ZXIgdGhlIGxvZyBlcnJvciBoYW5kbGVyIGlzIHN1YnNjcmliZWRcclxuXHRcdC8vLyAoaS5lLiBhZnRlciB0aGUgZnJhbWV3b3JrIHNjcmlwdCBoYXMgbG9hZGVkKSBzaG91bGQgZXhlY3V0ZSB0aGVpciBsb2dpY1xyXG5cdFx0Ly8vIGZpcnN0LCB0aGVuIGNhbGwgdGhlIG9yaWdpbmFsIGV2ZW50IGhhbmRsZXIuICBVbmxpa2Ugb3RoZXIgaGFuZGxlcnMsIHRoZVxyXG5cdFx0Ly8vIGxvZyBlcnJvciBoYW5kbGVyIG1heSBOT1Qgc2lnbmFsIHRoYXQgdGhlIGVycm9yIHdhcyBoYW5kbGVkIHRvIHByZXZlbnRcclxuXHRcdC8vLyBwcm9wb2dhdGlvbi4gIFRoZSBFeG9XZWIuZXJyb3IgZXZlbnQgY2FuIGJlIHVzZWQgZm9yIHRoYXQgcHVycG9zZS4gSWYgdGhlXHJcblx0XHQvLy8gZXJyb3IgcmVhY2hlcyB0aGUgbG9nZ2luZyBwaGFzZSBpdCBpcyBhc3N1bWVkIHRoYXQgaXQgd2lsbCBub3QgYmUgaGFuZGxlZC4gIFxyXG5cdFx0Ly8vXHJcblx0XHQvLy8gVGhlIGV2ZW50IGhhbmRsZXIncyBhcmd1bWVudChzKVxyXG5cdFx0Ly8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHRcdC8vL1xyXG5cdFx0Ly8vIFRoZSBmdW5jdGlvbiBpcyBjYWxsZWQgd2l0aCBhIHNpbmdsZSBvYmplY3QsIHJlZmVycmVkIHRvIGFzIFwiZXJyb3JEYXRhXCIuXHJcblx0XHQvLy8gVGhlIGRlZmF1bHQgb2JqZWN0IHRoYXQgaXMgcGFzc2VkIGNvbnRhaW5zIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllcywgd2hpY2hcclxuXHRcdC8vLyBjb3JyZXNwb25kIHRvIHRoZSBmb3JtYXQgb2YgdGhlIFNlcnZpY2VFcnJvciBvYmplY3Q6XHJcblx0XHQvLy9cclxuXHRcdC8vL1x0XHRcIm1lc3NhZ2VcIjogVGhlIGVycm9yIG1lc3NhZ2UuXHJcblx0XHQvLy9cdFx0XCJ0eXBlXCI6IFRoZSB0eXBlIG9mIGVycm9yLiAgQnkgZGVmYXVsdCB0aGlzIGlzIHNpbXBseSBcIkVycm9yXCIuICBBIGN1c3RvbSBldmVudFxyXG5cdFx0Ly8vXHRcdFx0aGFuZGxlciBtYXkgY2hvb3NlIHRvIGF0dGVtcHQgdG8gaW5mZXIgdGhlIGVycm9yIHR5cGUgZnJvbSB0aGUgbWVzc2FnZS5cclxuXHRcdC8vL1x0XHRcInVybFwiOiBUaGUgVVJMIHdoZXJlIHRoZSBlcnJvciBvY2N1cnJlZC4gIEJ5IGRlZmF1bHQgdGhpcyBpcyB0aGUgY3VycmVudCBVUkwuXHJcblx0XHQvLy9cdFx0XCJyZWZlcmVyVXJsXCI6IEJ5IGRlZmF1bHQgdGhpcyBpcyB0aGUgYGRvY3VtZW50LnJlZmVycmVyYCBwcm9wZXJ0eS5cclxuXHRcdC8vL1x0XHRcImFkZGl0aW9uYWxJbmZvXCI6IEJ5IGRlZmF1bHQgdGhpcyBpcyBhbiBvYmplY3Qgd2l0aCBgdXJsYCBhbmQgYGxpbmVOdW1iZXJgXHJcblx0XHQvLy9cdFx0XHRwcm9wZXJ0aWVzLCB3aGljaCBjb3JyZXNwb25kIHRvIHRoZSBhcmd1bWVudHMgb2YgdGhhdCBuYW1lIHdoaWNoIHdlcmVcclxuXHRcdC8vL1x0XHRcdHBhc3NlZCB0byB0aGUgZ2xvYmFsIGVycm9yIGV2ZW50LiAgQ3VzdG9tIGVycm9yXHRoYW5kbGVycyBjYW4gcmVtb3ZlIHRoZXNlXHJcblx0XHQvLy9cdFx0XHRwcm9wZXJ0aWVzIGFuZC9vciBpbmNsdWRlIGN1c3RvbSBkYXRhLiAgQWRkaXRpb25hbCBwcm9wZXJ0aWVzIHNob3VsZCB1c2VcclxuXHRcdC8vL1x0XHRcdHByaW1hdGl2ZSB0eXBlcywgYW5kIHNob3VsZCBiZSBvbmx5IG9uZSBsZXZlbCBkZWVwLiAgSW4gb3RoZXIgd29yZHMsXHJcblx0XHQvLy9cdFx0XHRgZXJyb3JEYXRhW1wiRm9vLkJhclwiXSA9IDFgLCBub3QgYGVycm9yRGF0YS5Gb28gPSB7IEJhcjogMSB9YC5cclxuXHRcdC8vL1xyXG5cdFx0Ly8vIDwvcmVtYXJrcz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImZuXCIgdHlwZT1cIkZ1bmN0aW9uXCI+VGhlIGVycm9yIHByb3ZpZGVyIGZ1bmN0aW9uLjwvcGFyYW0+XHJcblxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDEpIHRocm93IG5ldyBBcmd1bWVudHNMZW5ndGhFcnJvcigxLCBhcmd1bWVudHMubGVuZ3RoKTtcclxuXHRcdGlmIChmbiA9PSBudWxsKSB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXJyb3IoXCJmblwiKTtcclxuXHRcdGlmICh0eXBlb2YoZm4pICE9PSBcImZ1bmN0aW9uXCIpIHRocm93IG5ldyBBcmd1bWVudFR5cGVFcnJvcihcImZuXCIsIFwiZnVuY3Rpb25cIiwgZm4pO1xyXG5cclxuXHRcdGxvZ0Vycm9yUHJvdmlkZXIgPSBmbjtcclxuXHR9XHJcblxyXG5cdEV4b1dlYi5zZXRMb2dFcnJvclByb3ZpZGVyID0gc2V0TG9nRXJyb3JQcm92aWRlcjtcclxuXHJcblx0dmFyIGVycm9yRXZlbnRGbnMgPSBbXTtcclxuXHJcblx0ZnVuY3Rpb24gYWRkRXJyb3IgKGZuKSB7XHJcblx0XHQvLy8gPHN1bW1hcnk+XHJcblx0XHQvLy8gQXR0YWNoIGFuIGV2ZW50IGhhbmRsZXIgdG8gdGhlIGdsb2JhbCBlcnJvciBldmVudC5cclxuXHRcdC8vLyA8L3N1bW1hcnk+XHJcblx0XHQvLy8gPHJlbWFya3M+XHJcblx0XHQvLy9cclxuXHRcdC8vLyBUaW1pbmcgb2YgZXZlbnRcclxuXHRcdC8vLyA9PT09PT09PT09PT09PT1cclxuXHRcdC8vL1xyXG5cdFx0Ly8vIFRoZSBFeG9XZWIgZXJyb3IgZXZlbnQgaXMgY2FsbGVkIHdoZW4gYSBnbG9iYWwgZXJyb3IgZXZlbnQgaXMgcmFpc2VkLCBpbW1lZGlhdGVseVxyXG5cdFx0Ly8vIGJlZm9yZSB0aGUgXCJsb2cgZXJyb3JcIiBwcm92aWRlciBpcyBjYWxsZWQuXHJcblx0XHQvLy9cclxuXHRcdC8vLyBUaGUgZXZlbnQgaGFuZGxlcidzIGFyZ3VtZW50KHMpXHJcblx0XHQvLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cdFx0Ly8vXHJcblx0XHQvLy8gVGhlIGV2ZW50IGhhbmRsZXIgaXMgcGFzc2VkIGZvdXIgYXJndW1lbnRzIGluIHRvdGFsOiB0aGUgb3JpZ2luYWwgdGhyZWUgYXJndW1lbnRzXHJcblx0XHQvLy8gb2YgdGhlIGdsb2JhbCBlcnJvciBoYW5kbGVyIChtZXNzYWdlLCB1cmwsIGxpbmVOdW1iZXIsIGNvbE51bWJlciwgZXJyb3JPYmopLCBhcyB3ZWxsIGFzIHRoZSBcImVycm9yRGF0YVwiXHJcblx0XHQvLy8gb2JqZWN0LCB3aGljaCB3aWxsIHVsdGltYXRlbHkgYmUgcGFzc2VkIHRvIHRoZSBcImxvZyBlcnJvclwiIHByb3ZpZGVyLiBUaGUgZXZlbnRcclxuXHRcdC8vLyBoYW5kbGVyIG1heSBjaG9vc2UgdG8gbW9kaWZpZWQgYW55IG9mIHRoZSBlcnJvckRhdGEgb2JqZWN0J3MgcHJvcGVydGllcy5cclxuXHRcdC8vLyBcclxuXHRcdC8vLyA8L3JlbWFya3M+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJmblwiIHR5cGU9XCJGdW5jdGlvblwiPlRoZSBlcnJvciBldmVudCBmdW5jdGlvbi4gU2lnbmF0dXJlOiBmIChtZXNzYWdlLCB1cmwsIGxpbmVOdW1iZXIsIGNvbE51bWJlciwgZXJyb3JPYmosIGVycm9yRGF0YSkuPC9wYXJhbT5cclxuXHJcblx0XHRpZiAoZm4gPT0gbnVsbCkgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEVycm9yKFwiZm5cIik7XHJcblx0XHRpZiAodHlwZW9mKGZuKSAhPT0gXCJmdW5jdGlvblwiKSB0aHJvdyBuZXcgQXJndW1lbnRUeXBlRXJyb3IoXCJmblwiLCBcImZ1bmN0aW9uXCIsIGZuKTtcclxuXHJcblx0XHRlcnJvckV2ZW50Rm5zLnB1c2goZm4pO1xyXG5cdH1cclxuXHJcblx0RXhvV2ViLmFkZEVycm9yID0gYWRkRXJyb3I7XHJcblxyXG5cdGZ1bmN0aW9uIHJlbW92ZUVycm9yKGZuKSB7XHJcblx0XHQvLy8gPHN1bW1hcnk+XHJcblx0XHQvLy8gUmVtb3ZlcyBhbiBldmVudCBoYW5kbGVyIHRvIHRoZSBnbG9iYWwgZXJyb3IgZXZlbnQuXHJcblx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiZm5cIiB0eXBlPVwiRnVuY3Rpb25cIj5UaGUgZXJyb3IgZXZlbnQgZnVuY3Rpb24uPC9wYXJhbT5cclxuXHJcblx0XHRpZiAoZm4gPT0gbnVsbCkgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEVycm9yKFwiZm5cIik7XHJcblx0XHRpZiAodHlwZW9mIChmbikgIT09IFwiZnVuY3Rpb25cIikgdGhyb3cgbmV3IEFyZ3VtZW50VHlwZUVycm9yKFwiZm5cIiwgXCJmdW5jdGlvblwiLCBmbik7XHJcblxyXG5cdFx0dmFyIGlkeCA9IGVycm9yRXZlbnRGbnMuaW5kZXhPZihmbik7XHJcblx0XHRpZiAoaWR4IDwgMCkge1xyXG5cdFx0XHR0aHJvdyBuZXcgQXJndW1lbnRFcnJvcihcImZuXCIsIFwiVGhlIGdpdmVuIGZ1bmN0aW9uIHdhcyBub3QgZm91bmQgaW4gdGhlIGxpc3Qgb2YgZXJyb3IgaGFuZGxlcnMuXCIpO1xyXG5cdFx0fVxyXG5cdFx0ZXJyb3JFdmVudEZucy5zcGxpY2UoaWR4LCAxKTtcclxuXHR9XHJcblxyXG5cdEV4b1dlYi5yZW1vdmVFcnJvciA9IHJlbW92ZUVycm9yO1xyXG5cclxuXHQvKlxyXG5cdCogSGFuZGxlcyBhbiBlcnJvciB0aGF0IFxyXG5cdCovXHJcblx0ZnVuY3Rpb24gaGFuZGxlRXJyb3IobWVzc2FnZSwgdXJsLCBsaW5lTnVtYmVyLCBjb2xOdW1iZXIsIGVycm9yT2JqLCBjdXN0b21FcnJvckRhdGEsIHJhaXNlRXZlbnRzLCBvblN1Y2Nlc3MsIG9uRmFpbHVyZSkge1xyXG5cclxuXHRcdC8vIEluaXRpYWxpemUgdGhlIGRlZmF1bHQgZXJyb3IgZGF0YSBiYXNlZCBvbiB0aGUgZXJyb3IuXHJcblx0XHR2YXIgY2FuY2VsbGVkID0gZmFsc2UsXHJcblx0XHRcdGVycm9yRGF0YSA9IGpRdWVyeS5leHRlbmQoe1xyXG5cdFx0XHRcdG1lc3NhZ2U6IG1lc3NhZ2UsXHJcblx0XHRcdFx0dHlwZTogXCJFcnJvclwiLFxyXG5cdFx0XHRcdHVybDogd2luZG93LmxvY2F0aW9uLmhyZWYsXHJcblx0XHRcdFx0cmVmZXJlclVybDogZG9jdW1lbnQucmVmZXJyZXIsXHJcblx0XHRcdFx0c3RhY2tUcmFjZTogZXJyb3JPYmogPyBlcnJvck9iai5zdGFjayA6IFwiXCIsXHJcblx0XHRcdFx0YWRkaXRpb25hbEluZm86IHtcclxuXHRcdFx0XHRcdHVybDogdXJsLFxyXG5cdFx0XHRcdFx0bGluZU51bWJlcjogbGluZU51bWJlcixcclxuXHRcdFx0XHRcdGNvbHVtbk51bWJlcjogY29sTnVtYmVyXHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9LCBjdXN0b21FcnJvckRhdGEpO1xyXG5cclxuXHRcdGlmIChyYWlzZUV2ZW50cykge1xyXG5cdFx0XHQvLyBUaGUgZXJyb3Igd2FzIG5vdCBoYW5kbGVkLCBzbyByYWlzZSB0aGUgZXJyb3IgZXZlbnQuXHJcblx0XHRcdGVycm9yRXZlbnRGbnMuZm9yRWFjaChmdW5jdGlvbiAoZm4pIHtcclxuXHRcdFx0XHQvLyBTa2lwIGlmIHRoZSBldmVudCBoYXMgYmVlbiBjYW5jZWxsZWQuXHJcblx0XHRcdFx0aWYgKGNhbmNlbGxlZCkge1xyXG5cdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0dmFyIHJlc3VsdCA9IGZuKG1lc3NhZ2UsIHVybCwgbGluZU51bWJlciwgY29sTnVtYmVyLCBlcnJvck9iaiwgZXJyb3JEYXRhKTtcclxuXHRcdFx0XHRpZiAocmVzdWx0ID09PSB0cnVlKSB7XHJcblx0XHRcdFx0XHQvLyBDYW5jZWwgdGhlIGV2ZW50IGlmIHRoZSByZXN1bHQgaW5kaWNhdGVzIHRoYXQgdGhlIGV2ZW50IHdhcyBoYW5kbGVkLlxyXG5cdFx0XHRcdFx0Y2FuY2VsbGVkID0gdHJ1ZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmICghY2FuY2VsbGVkICYmIGxvZ0Vycm9yUHJvdmlkZXIpIHtcclxuXHRcdFx0Ly8gTG9nIHRoZSBlcnJvci5cclxuXHRcdFx0bG9nRXJyb3JQcm92aWRlcihlcnJvckRhdGEsIG9uU3VjY2Vzcywgb25GYWlsdXJlKTtcclxuXHRcdH1cclxuXHJcblx0fVxyXG5cclxuXHQvKlxyXG5cdCogRXhwbGljaXRseSBsb2dzIGFuIGVycm9yIHdpdGhvdXQgdGhyb3dpbmcuXHJcblx0KiBSYWlzaW5nIHRoZSAnZXJyb3InIGV2ZW50IGlzIG9wdGlvbmFsLlxyXG5cdCovXHJcblx0ZnVuY3Rpb24gbG9nRXJyb3IobWVzc2FnZSwgdXJsLCBsaW5lTnVtYmVyLCBjb2xOdW1iZXIsIGVycm9yT2JqLCBlcnJvckRhdGEsIHJhaXNlRXZlbnRzLCBvblN1Y2Nlc3MsIG9uRmFpbHVyZSkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5PlxyXG5cdFx0Ly8vIExvZ3MgYW4gZXJyb3IuXHJcblx0XHQvLy8gXHJcblx0XHQvLy8gU2lnbmF0dXJlOlxyXG5cdFx0Ly8vIEV4b1dlYi5sb2dFcnJvcihtZXNzYWdlIG9yIGVycm9yWywgdXJsLCBsaW5lTnVtYmVyXVssIGVycm9yRGF0YV1bLCByYWlzZUV2ZW50c11bLCBvblN1Y2Nlc3NdWywgb25GYWlsdXJlXSk7XHJcblx0XHQvLy8gXHJcblx0XHQvLy8gRXhhbXBsZXM6XHJcblx0XHQvLy8gXHJcblx0XHQvLy8gRXhvV2ViLmxvZ0Vycm9yKGUpO1xyXG5cdFx0Ly8vIEV4b1dlYi5sb2dFcnJvcignTWVzc2FnZScsICdodHRwOi8vLi4uJywgMTQpO1xyXG5cdFx0Ly8vIEV4b1dlYi5sb2dFcnJvcignTWVzc2FnZScsICdodHRwOi8vLi4uJywgMTQsIDEyKTtcclxuXHRcdC8vLyBFeG9XZWIubG9nRXJyb3IoJ01lc3NhZ2UnLCAnaHR0cDovLy4uLicsIDE0LCAxMiwgZSk7XHJcblx0XHQvLy8gRXhvV2ViLmxvZ0Vycm9yKGUsIHsgZm9vOiBcImJhclwiIH0sIGZ1bmN0aW9uICgpIHsgLyogb24gc3VjY2VzcyAqLyB9KTtcclxuXHRcdC8vLyBFeG9XZWIubG9nRXJyb3IoJ01lc3NhZ2UnLCAnaHR0cDovLy4uLicsIDE0LCAxMiwgdHJ1ZSwgZnVuY3Rpb24gKCkgeyAvKiBvbiBzdWNjZXNzICovIH0sIGZ1bmN0aW9uICgpIHsgLyogb24gZmFpbHVyZSAqLyB9KTtcclxuXHRcdC8vLyBFeG9XZWIubG9nRXJyb3IoJ01lc3NhZ2UnLCAnaHR0cDovLy4uLicsIDE0LCAxMiwgeyBmb286IFwiYmFyXCIgfSwgdHJ1ZSk7XHJcblx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwibWVzc2FnZVwiIHR5cGU9XCJTdHJpbmdcIj5UaGUgZXJyb3IgbWVzc2FnZS48L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwidXJsXCIgdHlwZT1cIlN0cmluZ1wiIG9wdGlvbmFsPVwidHJ1ZVwiPlRoZSB1cmwgd2hlcmUgdGhlIGVycm9yIG9jY3VycmVkLjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJsaW5lTnVtYmVyXCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCIgb3B0aW9uYWw9XCJ0cnVlXCI+VGhlIGxpbmUgbnVtYmVyIHdoZXJlIHRoZSBlcnJvciBvY2N1cnJlZC48L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiY29sTnVtYmVyXCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCIgb3B0aW9uYWw9XCJ0cnVlXCI+VGhlIGNvbHVtbiBudW1iZXIgd2hlcmUgdGhlIGVycm9yIG9jY3VycmVkLjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJlcnJvck9ialwiIHR5cGU9XCJFcnJvclwiIG9wdGlvbmFsPVwidHJ1ZVwiPk5hdGl2ZSBFcnJvciBvYmplY3QuPC9wYXJhbT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImVycm9yRGF0YVwiIHR5cGU9XCJPYmplY3RcIiBvcHRpb25hbD1cInRydWVcIj5DdXN0b20gZGF0YSB0byBpbmNsdWRlIHdpdGggdGhlIGVycm9yLjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJyYWlzZUV2ZW50c1wiIHR5cGU9XCJCb29sZWFuXCIgb3B0aW9uYWw9XCJ0cnVlXCI+XHJcblx0XHQvLy8gV2hldGhlciBvciBub3QgdG8gcmFpc2UgdGhlIGVycm9yIGV2ZW50IHdoZW4gaGFuZGxpbmcgdGhlIGVycm9yLiBXaGVuIGNhbGxlZCB2aWEgaW50ZXJuYWwgZnJhbWV3b3JrXHJcblx0XHQvLy8gbWV0aG9kcyAoZS5nLiB0aGUgZ2xvYmFsIGVycm9yIGV2ZW50IGhhbmRsZXIpIHRoZSBldmVudHMgd2lsbCBiZSByYWlzZWQsIGJ1dCB3aGVuIGNhbGxlZCBleHRlcm5hbGx5XHJcblx0XHQvLy8gdGhlIGNhbGxlciBtdXN0IHNwZWNpZnkgdGhhdCB0aGV5IHdhbnQgZXZlbnRzIHRvIGJlIHJhaXNlZCB0byBhdm9pZCB1bndhbnRlZCBzaWRlLWVmZmVjdHMuXHJcblx0XHQvLy8gPC9wYXJhbT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cIm9uU3VjY2Vzc1wiIHR5cGU9XCJGdW5jdGlvblwiIG9wdGlvbmFsPVwidHJ1ZVwiPlRoZSBjYWxsYmFjayB0byBpbnZva2Ugd2hlbiBsb2dnaW5nIHRoZSBlcnJvciBzdWNjZWVkcy48L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwib25GYWlsdXJlXCIgdHlwZT1cIkZ1bmN0aW9uXCIgb3B0aW9uYWw9XCJ0cnVlXCI+VGhlIGNhbGxiYWNrIHRvIGludm9rZSB3aGVuIGxvZ2dpbmcgdGhlIGVycm9yIGZhaWxzLjwvcGFyYW0+XHJcblxyXG5cdFx0Ly8gRW5zdXJlIHRoYXQgdGhlIG1lc3NhZ2UgKG9yIGVycm9yKSBhcmd1bWVudCB3YXMgcGFzc2VkIGluXHJcblx0XHRpZiAobWVzc2FnZSA9PSBudWxsKSB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXJyb3IoXCJtZXNzYWdlXCIpO1xyXG5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID4gOSkge1xyXG5cdFx0XHR0aHJvdyBuZXcgQXJndW1lbnRzTGVuZ3RoRXJyb3IoOSwgYXJndW1lbnRzLmxlbmd0aCk7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpLFxyXG5cdFx0XHRzdWNjZXNzQ2FsbGJhY2sgPSBudWxsLFxyXG5cdFx0XHRmYWlsdXJlQ2FsbGJhY2sgPSBudWxsLFxyXG5cdFx0XHRlcnJvciA9IG51bGwsXHJcblx0XHRcdHJhaXNlRXJyb3JFdmVudHMgPSBmYWxzZSxcclxuXHRcdFx0Y3VzdG9tRXJyb3JEYXRhID0gbnVsbDtcclxuXHJcblx0XHRpZiAoaXNGdW5jdGlvbihhcmdzW2FyZ3MubGVuZ3RoIC0gMV0pKSB7XHJcblx0XHRcdHN1Y2Nlc3NDYWxsYmFjayA9IGFyZ3MucG9wKCk7XHJcblx0XHRcdGlmIChpc0Z1bmN0aW9uKGFyZ3NbYXJncy5sZW5ndGggLSAxXSkpIHtcclxuXHRcdFx0XHRmYWlsdXJlQ2FsbGJhY2sgPSBzdWNjZXNzQ2FsbGJhY2s7XHJcblx0XHRcdFx0c3VjY2Vzc0NhbGxiYWNrID0gYXJncy5wb3AoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChpc0Jvb2xlYW4oYXJnc1thcmdzLmxlbmd0aCAtIDFdKSkge1xyXG5cdFx0XHRyYWlzZUVycm9yRXZlbnRzID0gYXJncy5wb3AoKTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoYXJncy5sZW5ndGggPiAxICYmIGFyZ3NbYXJncy5sZW5ndGggLSAxXSBpbnN0YW5jZW9mIE9iamVjdCAmJiAhKGFyZ3NbYXJncy5sZW5ndGggLSAxXSBpbnN0YW5jZW9mIEVycm9yKSkge1xyXG5cdFx0XHRjdXN0b21FcnJvckRhdGEgPSBhcmdzLnBvcCgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIEFuIEVycm9yIG9yIHN0cmluZyB3YXMgcGFzc2VkIGluXHJcblx0XHRpZiAoYXJncy5sZW5ndGggPT09IDEpIHtcclxuXHRcdFx0aWYgKG1lc3NhZ2UgaW5zdGFuY2VvZiBFcnJvcikge1xyXG5cdFx0XHRcdC8vIFJld3JpdGUgYXJndW1lbnRzXHJcblx0XHRcdFx0ZXJyb3IgPSBtZXNzYWdlO1xyXG5cclxuXHRcdFx0XHQvLyBQYXNzIGFsb25nIHRoZSBpbmZvcm1hdGlvbiBmcm9tIHRoZSBlcnJvclxyXG5cdFx0XHRcdGhhbmRsZUVycm9yKGVycm9yLm1lc3NhZ2UsIGVycm9yLmZpbGVOYW1lLCBlcnJvci5saW5lTnVtYmVyLCBlcnJvci5jb2x1bW5OdW1iZXIsIG1lc3NhZ2UsIGN1c3RvbUVycm9yRGF0YSwgcmFpc2VFcnJvckV2ZW50cywgc3VjY2Vzc0NhbGxiYWNrLCBmYWlsdXJlQ2FsbGJhY2spO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdC8vIFBhc3MgYWxvbmcgdGhlIG1lc3NhZ2UgYW5kIHNpbXVsYXRlIHRoZSBvdGhlciBpbmZvcm1hdGlvblxyXG5cdFx0XHRcdGhhbmRsZUVycm9yKG1lc3NhZ2UudG9TdHJpbmcoKSwgXCI/XCIsIFwiLTFcIiwgXCItMVwiLCBudWxsLCBjdXN0b21FcnJvckRhdGEsIHJhaXNlRXJyb3JFdmVudHMsIHN1Y2Nlc3NDYWxsYmFjaywgZmFpbHVyZUNhbGxiYWNrKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0Ly8gQ2hlY2sgZm9yIHttZXNzYWdlLCB1cmwsIGxpbmVOdW1iZXJ9IG1vZGVcclxuXHRcdGVsc2UgaWYgKGFyZ3MubGVuZ3RoID49IDMpIHtcclxuXHRcdFx0Ly8gVmFsaWRhdGUgYXJnc1xyXG5cdFx0XHRpZiAoIShtZXNzYWdlLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpKSB0aHJvdyBuZXcgQXJndW1lbnRUeXBlRXJyb3IoXCJtZXNzYWdlXCIsIFwic3RyaW5nXCIsIG1lc3NhZ2UpO1xyXG5cdFx0XHRpZiAodXJsLmNvbnN0cnVjdG9yICE9PSBTdHJpbmcpIHRocm93IG5ldyBBcmd1bWVudFR5cGVFcnJvcihcInVybFwiLCBcInN0cmluZ1wiLCB1cmwpO1xyXG5cdFx0XHRpZiAobGluZU51bWJlciAhPSBudWxsICYmIHR5cGVvZiAobGluZU51bWJlcikgIT09IFwibnVtYmVyXCIpIHRocm93IG5ldyBBcmd1bWVudFR5cGVFcnJvcihcImxpbmVOdW1iZXJcIiwgXCJudW1iZXJcIiwgbGluZU51bWJlcik7XHJcblxyXG5cdFx0XHQvLyBQYXNzIGFsb25nIHRoZSBpbmZvcm1hdGlvblxyXG5cdFx0XHRoYW5kbGVFcnJvcihtZXNzYWdlLCB1cmwsIGxpbmVOdW1iZXIsIHR5cGVvZiBjb2xOdW1iZXIgPT09IFwibnVtYmVyXCIgPyBjb2xOdW1iZXIgOiAtMSwgZXJyb3JPYmogaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yT2JqIDogbnVsbCwgY3VzdG9tRXJyb3JEYXRhLCByYWlzZUVycm9yRXZlbnRzLCBzdWNjZXNzQ2FsbGJhY2ssIGZhaWx1cmVDYWxsYmFjayk7XHJcblx0XHR9XHJcblx0XHQvLyBJbmNvcnJlY3QgbnVtYmVyIG9mIGFyZ3VtZW50c1xyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRocm93IG5ldyBBcmd1bWVudHNMZW5ndGhFcnJvcigzLCBhcmd1bWVudHMubGVuZ3RoKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdEV4b1dlYi5sb2dFcnJvciA9IGxvZ0Vycm9yO1xyXG5cclxuXHQvKlxyXG5cdCogQXR0YWNoZXMgdG8gdGhlIGdsb2JhbCBlcnJvciBldmVudCBhbmQgbG9ncyB0aGUgZXJyb3IgaWZcclxuXHQqIGxvZ2dpbmcgaXMgaW1wbGVtZW50ZWQgYW5kIHRoZSBlcnJvciBpcyBub3QgaGFuZGxlZC5cclxuXHQqL1xyXG5cdHZhciBvbGRPbkVycm9yID0gd2luZG93Lm9uZXJyb3I7XHJcblx0d2luZG93Lm9uZXJyb3IgPSBmdW5jdGlvbiAobWVzc2FnZSwgdXJsLCBsaW5lTnVtYmVyLCBjb2xOdW1iZXIsIGVycm9yT2JqKSB7XHJcblxyXG5cdFx0aWYgKCF3aW5kb3cuRXhvV2ViIHx8IEV4b1dlYi53aW5kb3dJc1VubG9hZGluZykge1xyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gQ2FsbCBwcmV2aW91cyBoYW5kbGVyLlxyXG5cdFx0aWYgKG9sZE9uRXJyb3IgJiYgb2xkT25FcnJvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpID09PSB0cnVlKSB7XHJcblx0XHRcdC8vIFByZXZpb3VzIGhhbmRsZXIgaGFzIGhhbmRsZWQgdGhlIGVycm9yLCBzbyBleGl0IG5vdyBhbmQgcHJldmVudCBwcm9wb2dhdGlvbi5cclxuXHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gUGFzcyB0aGUgZXJyb3IgYWxvbmcgdG8gZXZlbnQgc3Vic2NyaWJlcnMgYW5kIHRoZW4gbG9nLlxyXG5cdFx0aGFuZGxlRXJyb3IobWVzc2FnZSwgdXJsLCBsaW5lTnVtYmVyLCBjb2xOdW1iZXIsIGVycm9yT2JqLCBudWxsLCB0cnVlKTtcclxuXHJcblx0XHQvLyBMZXQgZGVmYXVsdCBoYW5kbGVyIHJ1bi5cclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHJcblx0fTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5XYXJuaW5nc1xyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdHZhciBsb2dXYXJuaW5nUHJvdmlkZXIgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xyXG5cdFx0Ly8gaWYgdGhlIGNvbnNvbGUgaXMgZGVmaW5lZCB0aGVuIGxvZyB0aGUgbWVzc2FnZVxyXG5cdFx0aWYgKHR5cGVvZiAoY29uc29sZSkgIT09IFwidW5kZWZpbmVkXCIpIHtcclxuXHRcdFx0aWYgKGNvbnNvbGUud2Fybikge1xyXG5cdFx0XHRcdGNvbnNvbGUud2FybihtZXNzYWdlKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdGZ1bmN0aW9uIHNldExvZ1dhcm5pbmdQcm92aWRlcihmbikge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5PlxyXG5cdFx0Ly8vIFByb3ZpZGUgYW4gaW1wbGVtZW50YXRpb24gb2YgdGhlIGxvZ1dhcm5pbmcgcHJvdmlkZXIuXHJcblx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cdFx0Ly8vIDxyZW1hcmtzPlxyXG5cdFx0Ly8vXHJcblx0XHQvLy8gVGhlIGV2ZW50IGhhbmRsZXIncyBhcmd1bWVudChzKVxyXG5cdFx0Ly8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHRcdC8vL1xyXG5cdFx0Ly8vIFRoZSBmdW5jdGlvbiBpcyBjYWxsZWQgd2l0aCBhIHNpbmdsZSB2YWx1ZSwgdGhlIHdhcm5pbmcgbWVzc2FnZS5cclxuXHRcdC8vXHJcblx0XHQvLy8gPC9yZW1hcmtzPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiZm5cIiB0eXBlPVwiRnVuY3Rpb25cIj5UaGUgd2FybmluZyBwcm92aWRlciBmdW5jdGlvbi48L3BhcmFtPlxyXG5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAxKSB0aHJvdyBuZXcgQXJndW1lbnRzTGVuZ3RoRXJyb3IoMSwgYXJndW1lbnRzLmxlbmd0aCk7XHJcblx0XHRpZiAoZm4gPT0gbnVsbCkgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEVycm9yKFwiZm5cIik7XHJcblx0XHRpZiAodHlwZW9mKGZuKSAhPT0gXCJmdW5jdGlvblwiKSB0aHJvdyBuZXcgQXJndW1lbnRUeXBlRXJyb3IoXCJmblwiLCBcImZ1bmN0aW9uXCIsIGZuKTtcclxuXHJcblx0XHRsb2dXYXJuaW5nUHJvdmlkZXIgPSBmbjtcclxuXHR9XHJcblxyXG5cdEV4b1dlYi5zZXRMb2dXYXJuaW5nUHJvdmlkZXIgPSBzZXRMb2dXYXJuaW5nUHJvdmlkZXI7XHJcblxyXG5cdGZ1bmN0aW9uIGxvZ1dhcm5pbmcobWVzc2FnZSkge1xyXG5cdFx0aWYgKGxvZ1dhcm5pbmdQcm92aWRlcikge1xyXG5cdFx0XHQvLyBMb2cgdGhlIHdhcm5pbmcuXHJcblx0XHRcdGxvZ1dhcm5pbmdQcm92aWRlcihtZXNzYWdlKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdEV4b1dlYi5sb2dXYXJuaW5nID0gbG9nV2FybmluZztcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5UeXBlQ2hlY2tpbmdcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHR2YXIgdHlwZUV4cHIgPSAvXFxzKFthLXp8QS1aXSspLztcclxuXHJcblx0ZnVuY3Rpb24gdHlwZShvYmopIHtcclxuXHRcdGlmIChvYmogPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRyZXR1cm4gXCJ1bmRlZmluZWRcIjtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKG9iaiA9PT0gbnVsbCkge1xyXG5cdFx0XHRyZXR1cm4gXCJudWxsXCI7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0cmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmopLm1hdGNoKHR5cGVFeHByKVsxXS50b0xvd2VyQ2FzZSgpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRFeG9XZWIudHlwZSA9IHR5cGU7XHJcblxyXG5cdGZ1bmN0aW9uIGlzTnVsbE9yVW5kZWZpbmVkKG9iaikge1xyXG5cdFx0cmV0dXJuIG9iaiA9PT0gbnVsbCB8fCBvYmogPT09IHVuZGVmaW5lZDtcclxuXHR9XHJcblx0RXhvV2ViLmlzTnVsbE9yVW5kZWZpbmVkID0gaXNOdWxsT3JVbmRlZmluZWQ7XHJcblxyXG5cdGZ1bmN0aW9uIGlzQXJyYXkob2JqKSB7XHJcblx0XHRyZXR1cm4gdHlwZShvYmopID09PSBcImFycmF5XCI7XHJcblx0fVxyXG5cdEV4b1dlYi5pc0FycmF5ID0gaXNBcnJheTtcclxuXHJcblx0ZnVuY3Rpb24gaXNTdHJpbmcob2JqKSB7XHJcblx0XHRyZXR1cm4gdHlwZShvYmopID09PSBcInN0cmluZ1wiO1xyXG5cdH1cclxuXHRFeG9XZWIuaXNTdHJpbmcgPSBpc1N0cmluZztcclxuXHJcblx0ZnVuY3Rpb24gaXNOdW1iZXIob2JqKSB7XHJcblx0XHRyZXR1cm4gdHlwZShvYmopID09PSBcIm51bWJlclwiO1xyXG5cdH1cclxuXHRFeG9XZWIuaXNOdW1iZXIgPSBpc051bWJlcjtcclxuXHJcblx0dmFyIGludGVnZXJFeHByID0gL14tP1swLTldezEsMTB9JC87XHJcblxyXG5cdGZ1bmN0aW9uIGlzSW50ZWdlcihvYmopIHtcclxuXHRcdHJldHVybiBpc051bWJlcihvYmopICYmICFpc05hTihvYmopICYmIGludGVnZXJFeHByLnRlc3Qob2JqLnRvU3RyaW5nKCkpICYmIChvYmogPj0gLTIxNDc0ODM2NDggJiYgb2JqIDw9IDIxNDc0ODM2NDcpO1xyXG5cdH1cclxuXHRFeG9XZWIuaXNJbnRlZ2VyID0gaXNJbnRlZ2VyO1xyXG5cclxuXHRmdW5jdGlvbiBpc05hdHVyYWwob2JqKSB7XHJcblx0XHRyZXR1cm4gaXNJbnRlZ2VyKG9iaikgJiYgb2JqID4gMDtcclxuXHR9XHJcblx0RXhvV2ViLmlzTmF0dXJhbCA9IGlzTmF0dXJhbDtcclxuXHJcblx0ZnVuY3Rpb24gaXNXaG9sZShvYmopIHtcclxuXHRcdHJldHVybiBpc0ludGVnZXIob2JqKSAmJiBvYmogPj0gMDtcclxuXHR9XHJcblx0RXhvV2ViLmlzV2hvbGUgPSBpc1dob2xlO1xyXG5cclxuXHR2YXIgZGVjaW1hbEV4cHIgPSAvXi0/WzAtOV0rXFwuWzAtOV0rJC87XHJcblxyXG5cdGZ1bmN0aW9uIGlzRGVjaW1hbChvYmopIHtcclxuXHRcdHJldHVybiBpc051bWJlcihvYmopICYmICFpc05hTihvYmopICYmIGRlY2ltYWxFeHByLnRlc3Qob2JqLnRvU3RyaW5nKCkpO1xyXG5cdH1cclxuXHRFeG9XZWIuaXNEZWNpbWFsID0gaXNEZWNpbWFsO1xyXG5cclxuXHRmdW5jdGlvbiBpc0Z1bmN0aW9uKG9iaikge1xyXG5cdFx0cmV0dXJuIHR5cGUob2JqKSA9PT0gXCJmdW5jdGlvblwiO1xyXG5cdH1cclxuXHRFeG9XZWIuaXNGdW5jdGlvbiA9IGlzRnVuY3Rpb247XHJcblxyXG5cdGZ1bmN0aW9uIGlzQm9vbGVhbihvYmopIHtcclxuXHRcdHJldHVybiB0eXBlKG9iaikgPT09IFwiYm9vbGVhblwiO1xyXG5cdH1cclxuXHRFeG9XZWIuaXNCb29sZWFuID0gaXNCb29sZWFuO1xyXG5cclxuXHRmdW5jdGlvbiBpc0RhdGUob2JqKSB7XHJcblx0XHRyZXR1cm4gdHlwZShvYmopID09PSBcImRhdGVcIjtcclxuXHR9XHJcblx0RXhvV2ViLmlzRGF0ZSA9IGlzRGF0ZTtcclxuXHJcblx0ZnVuY3Rpb24gaXNPYmplY3Qob2JqKSB7XHJcblx0XHRyZXR1cm4gdHlwZShvYmopID09PSBcIm9iamVjdFwiIHx8IChvYmogJiYgb2JqIGluc3RhbmNlb2YgT2JqZWN0KTtcclxuXHR9XHJcblx0RXhvV2ViLmlzT2JqZWN0ID0gaXNPYmplY3Q7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuUmFuZG9tXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gcmFuZG9tSW50ZWdlcihtaW4sIG1heCkge1xyXG5cdFx0dmFyIHNjYWxlO1xyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcclxuXHRcdFx0bWluID0gMDtcclxuXHRcdFx0bWF4ID0gOTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcclxuXHRcdFx0aWYgKCFpc0ludGVnZXIobWluKSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIk1pbmltdW0gYXJndW1lbnQgbXVzdCBiZSBhbiBpbnRlZ2VyLlwiKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKG1pbiA8IDApIHtcclxuXHRcdFx0XHRtYXggPSAwO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdG1heCA9IG1pbjtcclxuXHRcdFx0XHRtaW4gPSAwO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmICghaXNJbnRlZ2VyKG1pbikpIHtcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiTWluaW11bSBhcmd1bWVudCBtdXN0IGJlIGFuIGludGVnZXIuXCIpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAoIWlzSW50ZWdlcihtYXgpKSB7XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIk1heGltdW0gYXJndW1lbnQgbXVzdCBiZSBhbiBpbnRlZ2VyLlwiKTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKG1pbiA+PSBtYXgpIHtcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiTWluaW11bSBhcmd1bWVudCBtdXN0IGJlIGxlc3MgdGhhbiBtYXhpbXVtIGFyZ3VtZW50LlwiKTtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgcmFuZCA9IE1hdGgucmFuZG9tKCk7XHJcblx0XHRyZXR1cm4gcmFuZCA9PT0gMSA/IG1heCA6IE1hdGguZmxvb3IocmFuZCAqIChtYXggLSBtaW4gKyAxKSkgKyBtaW47XHJcblx0fVxyXG5cclxuXHRFeG9XZWIucmFuZG9tSW50ZWdlciA9IHJhbmRvbUludGVnZXI7XHJcblxyXG5cdGZ1bmN0aW9uIHJhbmRvbVRleHQobGVuLCBpbmNsdWRlRGlnaXRzKSB7XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJMZW5ndGggYXJndW1lbnQgaXMgcmVxdWlyZWQuXCIpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAoIWlzTmF0dXJhbChsZW4pKSB7XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIkxlbmd0aCBhcmd1bWVudCBtdXN0IGJlIGEgbmF0dXJhbCBudW1iZXIuXCIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciByZXN1bHQgPSBcIlwiO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xyXG5cdFx0XHR2YXIgbWluID0gMDtcclxuXHRcdFx0dmFyIG1heCA9IGluY2x1ZGVEaWdpdHMgPyAzNSA6IDI1O1xyXG5cdFx0XHR2YXIgcmFuZCA9IHJhbmRvbUludGVnZXIobWluLCBtYXgpO1xyXG5cdFx0XHR2YXIgY2hhckNvZGU7XHJcblx0XHRcdGlmIChyYW5kIDw9IDI1KSB7XHJcblx0XHRcdFx0Ly8gQWxwaGE6IGFkZCA5NyBmb3IgJ2EnXHJcblx0XHRcdFx0Y2hhckNvZGUgPSByYW5kICsgOTc7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0Ly8gTnVtOiBzdGFydCBhdCAwIGFuZCBhZGQgNDggZm9yIDBcclxuXHRcdFx0XHRjaGFyQ29kZSA9IChyYW5kIC0gMjYpICsgNDg7XHJcblx0XHRcdH1cclxuXHRcdFx0cmVzdWx0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2hhckNvZGUpO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHJlc3VsdDtcclxuXHR9XHJcblxyXG5cdEV4b1dlYi5yYW5kb21UZXh0ID0gcmFuZG9tVGV4dDtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5GdW5jdGlvblxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdHZhciBvdmVycmlkYWJsZU5vbkVudW1lcmF0ZWRNZXRob2RzO1xyXG5cclxuXHRmb3IgKHZhciBtIGluIHt9KSB7XHJcblx0XHRpZiAobSA9PSBcInRvU3RyaW5nXCIpIHtcclxuXHRcdFx0b3ZlcnJpZGFibGVOb25FbnVtZXJhdGVkTWV0aG9kcyA9IFtdO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGlmICghb3ZlcnJpZGFibGVOb25FbnVtZXJhdGVkTWV0aG9kcylcclxuXHRcdG92ZXJyaWRhYmxlTm9uRW51bWVyYXRlZE1ldGhvZHMgPSBbXCJ0b1N0cmluZ1wiLCBcInRvTG9jYWxlU3RyaW5nXCIsIFwidmFsdWVPZlwiXTtcclxuXHJcblx0ZnVuY3Rpb24gYWRkUHJvdG90eXBlTWVtYmVyKG9iaiwgbmFtZSwgbWVtYmVyKSB7XHJcblxyXG5cdFx0Ly8gbWV0aG9kXHJcblx0XHRpZiAobWVtYmVyIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuXHRcdFx0b2JqW25hbWVdID0gbWVtYmVyO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIHByb3BlcnR5XHJcblx0XHRlbHNlIGlmIChtZW1iZXIgaW5zdGFuY2VvZiBPYmplY3QpIHtcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwgbmFtZSwgbWVtYmVyKTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBmaWVsZFxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdG9ialtuYW1lXSA9IG1lbWJlcjtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdEZ1bmN0aW9uLnByb3RvdHlwZS5taXhpbiA9IGZ1bmN0aW9uIG1peGluKG1lbWJlcnMsIG9iaikge1xyXG5cdFx0aWYgKCFvYmopIHtcclxuXHRcdFx0b2JqID0gdGhpcy5wcm90b3R5cGU7XHJcblx0XHR9XHJcblxyXG5cdFx0Zm9yICh2YXIgbSBpbiBtZW1iZXJzKSB7XHJcblx0XHRcdHZhciBtZW1iZXIgPSBtZW1iZXJzW21dO1xyXG5cdFx0XHRpZiAobWVtYmVycy5oYXNPd25Qcm9wZXJ0eShtKSkge1xyXG5cdFx0XHRcdGFkZFByb3RvdHlwZU1lbWJlcihvYmosIG0sIG1lbWJlcik7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHQvLyBJRSdzIFwiaW5cIiBvcGVyYXRvciBkb2Vzbid0IHJldHVybiBrZXlzIGZvciBuYXRpdmUgcHJvcGVydGllcyBvbiB0aGUgT2JqZWN0IHByb3RvdHlwZVxyXG5cdFx0b3ZlcnJpZGFibGVOb25FbnVtZXJhdGVkTWV0aG9kcy5mb3JFYWNoKGZ1bmN0aW9uIChtKSB7XHJcblx0XHRcdHZhciBtZW1iZXIgPSBtZW1iZXJzW21dO1xyXG5cdFx0XHRpZiAobWVtYmVycy5oYXNPd25Qcm9wZXJ0eShtKSkge1xyXG5cdFx0XHRcdGFkZFByb3RvdHlwZU1lbWJlcihvYmosIG0sIG1lbWJlcik7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH07XHJcblxyXG5cdEZ1bmN0aW9uLnByb3RvdHlwZS5kb250RG91YmxlVXAgPSBmdW5jdGlvbiBGdW5jdGlvbiRkb250RG91YmxlVXAob3B0aW9ucykge1xyXG5cdFx0dmFyIHByb2NlZWQgPSB0aGlzO1xyXG5cdFx0dmFyIGNhbGxzID0gW107XHJcblx0XHJcblx0XHQvLyBJcyB0aGUgZnVuY3Rpb24gYWxyZWFkeSBiZWluZyBjYWxsZWQgd2l0aCB0aGUgc2FtZSBhcmd1bWVudHM/XHJcblx0XHRyZXR1cm4gZnVuY3Rpb24gZG9udERvdWJsZVVwKCkge1xyXG5cdFx0XHR2YXIgaSwgaWxlbiwgaiwgamxlbiwgb3JpZ0NhbGxiYWNrLCBvcmlnVGhpc1B0ciwgcGFydGl0aW9uZWRBcmcsIHBhcnRpdGlvbmVkQXJnSWR4LCBncm91cEJ5LCBjYWxsc0luUHJvZ3Jlc3MsIGNhbGwsIHNob3VsZEpvaW5DYWxsLCBvdGhlclBhcnRpdGlvbmVkQXJnLCBwYXJ0aXRpb25lZEluQ2FsbCwgam9pbkFyZ0lkeCwgYXJncztcclxuXHRcclxuXHRcdFx0Ly8gTWFrZSBhIGNvcHkgb2YgdGhlIGludm9jYXRpb24gYXJndW1lbnRzLlxyXG5cdFx0XHRhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcclxuXHJcblx0XHRcdC8vIEV4dHJhY3QgY2FsbGJhY2sgYW5kIHRoaXNQdHIgYXJndW1lbnRzLCBpZiB0aGV5IGV4aXN0LlxyXG5cdFx0XHRpZiAob3B0aW9ucy5jYWxsYmFja0FyZyA8IGFyZ3VtZW50cy5sZW5ndGgpIHtcclxuXHRcdFx0XHRvcmlnQ2FsbGJhY2sgPSBhcmd1bWVudHNbb3B0aW9ucy5jYWxsYmFja0FyZ107XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKG9wdGlvbnMudGhpc1B0ckFyZyA8IGFyZ3VtZW50cy5sZW5ndGgpIHtcclxuXHRcdFx0XHRvcmlnVGhpc1B0ciA9IGFyZ3VtZW50c1tvcHRpb25zLnRoaXNQdHJBcmddO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBEZXRlcm1pbmUgd2hhdCBhcmd1bWVudHMgY2FuIGJlIHBhcnRpdGlvbmVkIGludG8gc2VwYXJhdGUgY2FsbHNcclxuXHRcdFx0aWYgKG9wdGlvbnMucGFydGl0aW9uZWRBcmcgIT09IG51bGwgJiYgb3B0aW9ucy5wYXJ0aXRpb25lZEFyZyAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0cGFydGl0aW9uZWRBcmcgPSBhcmd1bWVudHNbb3B0aW9ucy5wYXJ0aXRpb25lZEFyZ107XHJcblx0XHRcdFx0aWYgKCEocGFydGl0aW9uZWRBcmcgaW5zdGFuY2VvZiBBcnJheSkpIHtcclxuXHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIlRoZSBwYXJ0aXRpb25lZCBhcmd1bWVudCBtdXN0IGJlIGFuIGFycmF5LlwiKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIENyZWF0ZSBhIGNvcHkgb2YgdGhlIGFyZ3VtZW50LlxyXG5cdFx0XHRcdHBhcnRpdGlvbmVkQXJnID0gcGFydGl0aW9uZWRBcmcuY29weSgpO1xyXG5cclxuXHRcdFx0XHRwYXJ0aXRpb25lZEFyZ0lkeCA9IC0xO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBEZXRlcm1pbmUgd2hhdCB2YWx1ZXMgdG8gdXNlIHRvIGdyb3VwIGNhbGxlcnNcclxuXHRcdFx0Z3JvdXBCeSA9IFtdO1xyXG5cdFx0XHRpZiAob3B0aW9ucy5ncm91cEJ5ICYmIG9wdGlvbnMuZ3JvdXBCeSBpbnN0YW5jZW9mIEFycmF5KSB7XHJcblx0XHRcdFx0Zm9yIChpID0gMCwgaWxlbiA9IG9wdGlvbnMuZ3JvdXBCeS5sZW5ndGg7IGkgPCBpbGVuOyBpKyspIHtcclxuXHRcdFx0XHRcdGlmIChwYXJ0aXRpb25lZEFyZyAhPT0gdW5kZWZpbmVkICYmIG9wdGlvbnMuZ3JvdXBCeVtpXSA9PT0gb3B0aW9ucy5wYXJ0aXRpb25lZEFyZykge1xyXG5cdFx0XHRcdFx0XHRwYXJ0aXRpb25lZEFyZ0lkeCA9IGdyb3VwQnkubGVuZ3RoO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0Z3JvdXBCeS5wdXNoKGFyZ3VtZW50c1tvcHRpb25zLmdyb3VwQnlbaV1dKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAob3B0aW9ucy5ncm91cEJ5ICE9PSBudWxsICYmIG9wdGlvbnMuZ3JvdXBCeSAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0Z3JvdXBCeS5wdXNoKGFyZ3VtZW50c1tvcHRpb25zLmdyb3VwQnldKTtcclxuXHRcdFx0XHRpZiAob3B0aW9ucy5ncm91cEJ5ID09PSBvcHRpb25zLnBhcnRpdGlvbmVkQXJnKSB7XHJcblx0XHRcdFx0XHRwYXJ0aXRpb25lZEFyZ0lkeCA9IDA7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdGZvciAoaSA9IDAsIGlsZW4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWxlbjsgKytpKSB7XHJcblx0XHRcdFx0XHRpZiAoaSAhPT0gb3B0aW9ucy5jYWxsYmFja0FyZyAmJiBpICE9PSBvcHRpb25zLnRoaXNQdHJBcmcpIHtcclxuXHRcdFx0XHRcdFx0aWYgKHBhcnRpdGlvbmVkQXJnICE9PSB1bmRlZmluZWQgJiYgaSA9PT0gb3B0aW9ucy5wYXJ0aXRpb25lZEFyZykge1xyXG5cdFx0XHRcdFx0XHRcdHBhcnRpdGlvbmVkQXJnSWR4ID0gZ3JvdXBCeS5sZW5ndGg7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0Z3JvdXBCeS5wdXNoKGFyZ3VtZW50c1tpXSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBWZXJpZnkgdGhhdCB0aGUgdGhlIHBhcnRpdGlvbmVkIGFyZ3VtZW50IGlzIHBhcnQgb2YgdGhlIGdyb3VwaW5nLlxyXG5cdFx0XHRpZiAocGFydGl0aW9uZWRBcmdJZHggPT09IC0xKSB7XHJcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBwYXJ0aXRpb25lZEFyZyBvcHRpb24uXCIpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBJcyB0aGlzIGNhbGwgYWxyZWFkeSBpbiBwcm9ncmVzcz9cclxuXHRcdFx0Y2FsbHNJblByb2dyZXNzID0gW107XHJcblx0XHRcdGZvciAoaSA9IDAsIGlsZW4gPSBjYWxscy5sZW5ndGg7IChwYXJ0aXRpb25lZEFyZyA9PT0gdW5kZWZpbmVkIHx8IHBhcnRpdGlvbmVkQXJnLmxlbmd0aCA+IDApICYmIGkgPCBpbGVuOyBpKyspIHtcclxuXHRcdFx0XHRjYWxsID0gY2FsbHNbaV07XHJcblxyXG5cdFx0XHRcdC8vIFRPRE86IGhhbmRsZSBvcHRpb25hbCBwYXJhbXMgYmV0dGVyXHJcblx0XHRcdFx0aWYgKGdyb3VwQnkubGVuZ3RoICE9IGNhbGwuZ3JvdXBCeS5sZW5ndGgpIHtcclxuXHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gT25seSBqb2luIGNhbGxzIHRvZ2V0aGVyIGlmIHRoZXkgd2VyZSBjYWxsZWQgb24gdGhlIHNhbWUgb2JqZWN0LlxyXG5cdFx0XHRcdHNob3VsZEpvaW5DYWxsID0gdGhpcyA9PT0gY2FsbC5jb250ZXh0O1xyXG5cclxuXHRcdFx0XHQvLyBNYWtlIHN1cmUgYWxsIG9mIHRoZSBhcmd1bWVudHMgbWF0Y2guXHJcblx0XHRcdFx0Zm9yIChqID0gMCwgamxlbiA9IGdyb3VwQnkubGVuZ3RoOyBzaG91bGRKb2luQ2FsbCAmJiBqIDwgamxlbjsgaisrKSB7XHJcblx0XHRcdFx0XHRpZiAoaiA9PT0gcGFydGl0aW9uZWRBcmdJZHgpIHtcdFxyXG5cdFx0XHRcdFx0XHQvLyBBdHRlbXB0IHRvIGZpbmQgaXRlbXMgaW4gcGFydGl0aW9uZWQgYXJndW1lbnQgdGhhdCBhcmUgaW4gcHJvZ3Jlc3MgYW5kIHJlbW92ZSB0aGVtXHJcblx0XHRcdFx0XHRcdHNob3VsZEpvaW5DYWxsID0gY2FsbC5ncm91cEJ5W2pdLnNvbWUoZnVuY3Rpb24ocCkge1xyXG5cdFx0XHRcdFx0XHRcdHJldHVybiBwYXJ0aXRpb25lZEFyZy5pbmRleE9mKHApID49IDA7XHJcblx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAoZ3JvdXBCeVtqXSAhPT0gY2FsbC5ncm91cEJ5W2pdKSB7XHJcblx0XHRcdFx0XHRcdHNob3VsZEpvaW5DYWxsID0gZmFsc2U7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRpZiAoc2hvdWxkSm9pbkNhbGwpIHtcclxuXHJcblx0XHRcdFx0XHRwYXJ0aXRpb25lZEluQ2FsbCA9IFtdO1xyXG5cclxuXHRcdFx0XHRcdC8vIFJlbW92ZSBwYXJ0aXRpb25lZCBhcmdzIHRoYXQgd2lsbCBiZSBzYXRpc2ZpZWQgYnkgdGhlIGNhbGwgaW4gcHJvZ3Jlc3MuXHJcblx0XHRcdFx0XHRpZiAocGFydGl0aW9uZWRBcmcgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0XHRvdGhlclBhcnRpdGlvbmVkQXJnID0gY2FsbC5ncm91cEJ5W3BhcnRpdGlvbmVkQXJnSWR4XTtcclxuXHRcdFx0XHRcdFx0Zm9yIChqID0gMCwgamxlbiA9IG90aGVyUGFydGl0aW9uZWRBcmcubGVuZ3RoOyBqIDwgamxlbjsgaisrKSB7XHJcblx0XHRcdFx0XHRcdFx0am9pbkFyZ0lkeCA9IHBhcnRpdGlvbmVkQXJnLmluZGV4T2Yob3RoZXJQYXJ0aXRpb25lZEFyZ1tqXSk7XHJcblx0XHRcdFx0XHRcdFx0aWYgKGpvaW5BcmdJZHggPj0gMCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0cGFydGl0aW9uZWRJbkNhbGwucHVzaChvdGhlclBhcnRpdGlvbmVkQXJnW2pdKTtcclxuXHRcdFx0XHRcdFx0XHRcdHBhcnRpdGlvbmVkQXJnLnNwbGljZShqb2luQXJnSWR4LCAxKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRjYWxsc0luUHJvZ3Jlc3MucHVzaCh7IGNhbGw6IGNhbGwsIHBhcnRpdGlvbmVkOiBwYXJ0aXRpb25lZEluQ2FsbCB9KTtcclxuXHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoY2FsbHNJblByb2dyZXNzLmxlbmd0aCA9PT0gMCB8fCAocGFydGl0aW9uZWRBcmcgIT09IHVuZGVmaW5lZCAmJiBwYXJ0aXRpb25lZEFyZy5sZW5ndGggPiAwKSkge1xyXG5cclxuXHRcdFx0XHQvLyB0cmFjayB0aGUgbmV4dCBjYWxsIHRoYXQgaXMgYWJvdXQgdG8gYmUgbWFkZVxyXG5cdFx0XHRcdGNhbGwgPSB7IGNhbGxiYWNrOiBGdW5jdG9yKCksIGdyb3VwQnk6IGdyb3VwQnksIGNvbnRleHQ6IHRoaXMgfTtcclxuXHRcdFx0XHJcblx0XHRcdFx0Y2FsbHMucHVzaChjYWxsKTtcclxuXHJcblx0XHRcdFx0Ly8gbWFrZSBzdXJlIHRoZSBvcmlnaW5hbCBjYWxsYmFjayBpcyBpbnZva2VkIGFuZCB0aGF0IGNsZWFudXAgb2NjdXJzXHJcblx0XHRcdFx0Y2FsbC5jYWxsYmFjay5hZGQoZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHRpZiAoY2FsbHMuaW5kZXhPZihjYWxsKSA8IDApIHtcclxuXHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiQ2FsbCBub3QgZm91bmQuXCIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0aWYgKG9yaWdDYWxsYmFjaykge1xyXG5cdFx0XHRcdFx0XHRvcmlnQ2FsbGJhY2suYXBwbHkob3JpZ1RoaXNQdHIgfHwgdGhpcywgYXJndW1lbnRzKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGlmIChvcHRpb25zLm1lbW9pemUgPT09IHRydWUpIHtcclxuXHRcdFx0XHRcdFx0Y2FsbC5jb21wbGV0ZSA9IHRydWU7XHJcblx0XHRcdFx0XHRcdGNhbGwucmVzcG9uc2UgPSB7XHJcblx0XHRcdFx0XHRcdFx0dGhpc1B0cjogdGhpcyxcclxuXHRcdFx0XHRcdFx0XHRhcmdzOiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpXHJcblx0XHRcdFx0XHRcdH07XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0Y2FsbHMucmVtb3ZlKGNhbGwpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0pO1xyXG5cclxuXHRcdFx0XHQvLyBDb3B5IHRoZSBhcmdzXHJcblx0XHRcdFx0bmV3QXJncyA9IGFyZ3Muc2xpY2UoKTtcclxuXHJcblx0XHRcdFx0Ly8gdXNlIHJlbWFpbmluZyBwYXJ0aXRpb25lZCBhcmdzIGlmIGluIGVmZmVjdFxyXG5cdFx0XHRcdGlmIChwYXJ0aXRpb25lZEFyZyAhPT0gdW5kZWZpbmVkICYmIHBhcnRpdGlvbmVkQXJnLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHRcdG5ld0FyZ3Nbb3B0aW9ucy5wYXJ0aXRpb25lZEFyZ10gPSBwYXJ0aXRpb25lZEFyZztcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIHBhc3MgdGhlIG5ldyBjYWxsYmFjayB0byB0aGUgaW5uZXIgZnVuY3Rpb25cclxuXHRcdFx0XHRuZXdBcmdzW29wdGlvbnMuY2FsbGJhY2tBcmddID0gY2FsbC5jYWxsYmFjaztcclxuXHJcblx0XHRcdFx0Y2FsbC5hcmdzID0gbmV3QXJncztcclxuXHJcblx0XHRcdFx0cHJvY2VlZC5hcHBseSh0aGlzLCBuZXdBcmdzKTtcclxuXHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChjYWxsc0luUHJvZ3Jlc3MubGVuZ3RoID4gMCAmJiBvcmlnQ2FsbGJhY2spIHtcclxuXHRcdFxyXG5cdFx0XHRcdC8vIHdhaXQgZm9yIHRoZSBvcmlnaW5hbCBjYWxsIHRvIGNvbXBsZXRlXHJcblx0XHRcdFx0Zm9yRWFjaChjYWxsc0luUHJvZ3Jlc3MsIGZ1bmN0aW9uKGNhbGwpIHtcclxuXHJcblx0XHRcdFx0XHR2YXIgaW52b2NhdGlvbkFyZ3M7XHJcblxyXG5cdFx0XHRcdFx0aWYgKG9wdGlvbnMucGFydGl0aW9uZWRGaWx0ZXIpIHtcclxuXHRcdFx0XHRcdFx0aW52b2NhdGlvbkFyZ3MgPSBhcmdzLnNsaWNlKCk7XHJcblx0XHRcdFx0XHRcdGludm9jYXRpb25BcmdzW29wdGlvbnMucGFydGl0aW9uZWRBcmddID0gY2FsbC5wYXJ0aXRpb25lZDtcclxuXHRcdFx0XHRcdFx0aW52b2NhdGlvbkFyZ3Nbb3B0aW9ucy5jYWxsYmFja0FyZ10gPSBvcmlnQ2FsbGJhY2s7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0dmFyIGNhbGxiYWNrQXJncztcclxuXHJcblx0XHRcdFx0XHRpZiAoY2FsbC5jYWxsLmNvbXBsZXRlID09PSB0cnVlKSB7XHJcblx0XHRcdFx0XHRcdGlmIChvcHRpb25zLnBhcnRpdGlvbmVkRmlsdGVyKSB7XHJcblx0XHRcdFx0XHRcdFx0Y2FsbGJhY2tBcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoY2FsbC5jYWxsLnJlc3BvbnNlLmFyZ3MpO1xyXG5cdFx0XHRcdFx0XHRcdG9wdGlvbnMucGFydGl0aW9uZWRGaWx0ZXIuY2FsbChvcmlnVGhpc1B0ciB8fCB0aGlzLCBjYWxsLmNhbGwuYXJncywgaW52b2NhdGlvbkFyZ3MsIGNhbGxiYWNrQXJncyk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0Y2FsbGJhY2tBcmdzID0gY2FsbC5jYWxsLnJlc3BvbnNlLmFyZ3M7XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdG9yaWdDYWxsYmFjay5hcHBseShvcmlnVGhpc1B0ciB8fCBjYWxsLmNhbGwucmVzcG9uc2UudGhpc1B0ciwgY2FsbGJhY2tBcmdzKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRjYWxsLmNhbGwuY2FsbGJhY2suYWRkKGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdFx0XHRcdGlmIChvcHRpb25zLnBhcnRpdGlvbmVkRmlsdGVyKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRjYWxsYmFja0FyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xyXG5cdFx0XHRcdFx0XHRcdFx0b3B0aW9ucy5wYXJ0aXRpb25lZEZpbHRlci5jYWxsKG9yaWdUaGlzUHRyIHx8IHRoaXMsIGNhbGwuY2FsbC5hcmdzLCBpbnZvY2F0aW9uQXJncywgY2FsbGJhY2tBcmdzKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0XHRjYWxsYmFja0FyZ3MgPSBhcmd1bWVudHM7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFxyXG5cdFx0XHRcdFx0XHRcdG9yaWdDYWxsYmFjay5hcHBseShvcmlnVGhpc1B0ciB8fCB0aGlzLCBjYWxsYmFja0FyZ3MpO1xyXG5cdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdH1cclxuXHRcdH07XHJcblx0fTtcclxuXHJcblx0RnVuY3Rpb24ucHJvdG90eXBlLmNhY2hlZCA9IGZ1bmN0aW9uIEZ1bmN0aW9uJGNhY2hlZChvcHRpb25zKSB7XHJcblx0XHR2YXIgcHJvY2VlZCA9IHRoaXM7XHJcblx0XHR2YXIgY2FjaGUgPSB7fTtcclxuXHJcblx0XHR2YXIga2V5Z2VuID0gKG9wdGlvbnMgJiYgb3B0aW9ucy5rZXkpIHx8IGZ1bmN0aW9uKGFyZykgeyByZXR1cm4gYXJnOyB9O1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbiBjYWNoZWQoKSB7XHJcblx0XHRcdHZhciBrZXkgPSBrZXlnZW4uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuXHRcdFx0cmV0dXJuIGNhY2hlLmhhc093blByb3BlcnR5KGtleSkgPyBjYWNoZVtrZXldIDogKGNhY2hlW2tleV0gPSBwcm9jZWVkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpO1xyXG5cdFx0fTtcclxuXHR9O1xyXG5cclxuXHRmdW5jdGlvbiBiaW5kKG9iaikge1xyXG5cdFx0dmFyIHNsaWNlID0gW10uc2xpY2UsXHJcblx0XHRcdGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSksXHJcblx0XHRcdHNlbGYgPSB0aGlzLFxyXG5cdFx0XHRub3AgPSBmdW5jdGlvbiAoKSB7fSxcclxuXHRcdFx0Ym91bmQgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0cmV0dXJuIHNlbGYuYXBwbHkodGhpcyBpbnN0YW5jZW9mIG5vcCA/IHRoaXMgOiAob2JqIHx8IHt9KSxcclxuXHRcdFx0XHRcdGFyZ3MuY29uY2F0KHNsaWNlLmNhbGwoYXJndW1lbnRzKSkpO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdG5vcC5wcm90b3R5cGUgPSBzZWxmLnByb3RvdHlwZTtcclxuXHRcdGJvdW5kLnByb3RvdHlwZSA9IG5ldyBub3AoKTtcclxuXHJcblx0XHRyZXR1cm4gYm91bmQ7XHJcblx0fVxyXG5cclxuXHQvLyBGdW5jdGlvbi5wcm90b3R5cGUuYmluZCBwb2x5ZmlsbFxyXG5cdGlmICghRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQpXHJcblx0XHRGdW5jdGlvbi5wcm90b3R5cGUuYmluZCA9IGJpbmQ7XHJcblxyXG5cdEZ1bmN0aW9uLnByb3RvdHlwZS5wcmVwYXJlID0gZnVuY3Rpb24gcHJlcGFyZSh0aGlzUHRyLCBhcmdzKSB7XHJcblx0XHQvLy8gPHN1bW1hcnk+XHJcblx0XHQvLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBpbnZva2UgdGhpcyBmdW5jdGlvbiB3aXRoIHRoZSBnaXZlblxyXG5cdFx0Ly8vIHRoaXMgdmFsdWUgYW5kIGFyZ3VtZW50cywgcmVnYXJkbGVzcyBvZiBob3cgdGhlIHJldHVybmVkIFxyXG5cdFx0Ly8vIGZ1bmN0aW9uIGlzIGludm9rZWQuXHJcblx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cclxuXHRcdHZhciBmdW5jID0gdGhpcztcclxuXHRcdHJldHVybiBmdW5jdGlvbiBwcmVwYXJlJGZuKCkge1xyXG5cdFx0XHRyZXR1cm4gZnVuYy5hcHBseSh0aGlzUHRyIHx8IHRoaXMsIGFyZ3MgfHwgW10pO1xyXG5cdFx0fTtcclxuXHR9O1xyXG5cclxuXHRGdW5jdGlvbi5wcm90b3R5cGUucHJlcGVuZEFyZ3VtZW50cyA9IGZ1bmN0aW9uIHByZXBlbmRBcmd1bWVudHMoLyogYXJnMSwgYXJnMiwgLi4uICovKSB7XHJcblx0XHR2YXIgZnVuYyA9IHRoaXM7XHJcblx0XHR2YXIgYWRkaXRpb25hbCA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7XHJcblx0XHRyZXR1cm4gZnVuY3Rpb24gcHJlcGVuZEFyZ3VtZW50cyRmbigpIHtcclxuXHRcdFx0dmFyIGFyZ3MgPSBbXTtcclxuXHRcdFx0QXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkoYXJncywgYWRkaXRpb25hbCk7XHJcblx0XHRcdEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGFyZ3MsIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cykpO1xyXG5cdFx0XHRyZXR1cm4gZnVuYy5hcHBseSh0aGlzLCBhcmdzKTtcclxuXHRcdH07XHJcblx0fTtcclxuXHJcblx0RnVuY3Rpb24ucHJvdG90eXBlLmFwcGVuZEFyZ3VtZW50cyA9IGZ1bmN0aW9uIGFwcGVuZEFyZ3VtZW50cygvKiBhcmcxLCBhcmcyLCAuLi4gKi8pIHtcclxuXHRcdHZhciBmdW5jID0gdGhpcztcclxuXHRcdHZhciBhZGRpdGlvbmFsID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcclxuXHRcdHJldHVybiBmdW5jdGlvbiBhcHBlbmRBcmd1bWVudHMkZm4oKSB7XHJcblx0XHRcdHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcclxuXHRcdFx0QXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkoYXJncywgYWRkaXRpb25hbCk7XHJcblx0XHRcdHJldHVybiBmdW5jLmFwcGx5KHRoaXMsIGFyZ3MpO1xyXG5cdFx0fTtcclxuXHR9O1xyXG5cclxuXHRGdW5jdGlvbi5wcm90b3R5cGUuc3BsaWNlQXJndW1lbnRzID0gZnVuY3Rpb24gc3BsaWNlQXJndW1lbnRzKC8qIHN0YXJ0LCBob3dtYW55LCBpdGVtMSwgaXRlbTIsIC4uLiAqLykge1xyXG5cdFx0dmFyIGZ1bmMgPSB0aGlzO1xyXG5cdFx0dmFyIHNwbGljZUFyZ3MgPSBhcmd1bWVudHM7XHJcblx0XHRyZXR1cm4gZnVuY3Rpb24gc3BsaWNlQXJndW1lbnRzJGZuKCkge1xyXG5cdFx0XHR2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7XHJcblx0XHRcdGFyZ3Muc3BsaWNlLmFwcGx5KGFyZ3MsIHNwbGljZUFyZ3MpO1xyXG5cdFx0XHRyZXR1cm4gZnVuYy5hcHBseSh0aGlzLCBhcmdzKTtcclxuXHRcdH07XHJcblx0fTtcclxuXHJcblx0RnVuY3Rpb24ucHJvdG90eXBlLnNsaWNlQXJndW1lbnRzID0gZnVuY3Rpb24gc2xpY2VBcmd1bWVudHMoLyogc3RhcnQsIGVuZCAqLykge1xyXG5cdFx0dmFyIGZ1bmMgPSB0aGlzO1xyXG5cdFx0dmFyIHNsaWNlQXJncyA9IGFyZ3VtZW50cztcclxuXHRcdHJldHVybiBmdW5jdGlvbiBzcGxpY2VBcmd1bWVudHMkZm4oKSB7XHJcblx0XHRcdHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcclxuXHRcdFx0YXJncyA9IGFyZ3Muc2xpY2UuYXBwbHkoYXJncywgc2xpY2VBcmdzKTtcclxuXHRcdFx0cmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJncyk7XHJcblx0XHR9O1xyXG5cdH07XHJcblxyXG5cdGZ1bmN0aW9uIG1lcmdlRnVuY3Rpb25zKGZuMSwgZm4yLCBvcHRpb25zKSB7XHJcblx0XHQvLyByZXR1cm4gZWFybHkgaWYgb25lIG9yIGJvdGggZnVuY3Rpb25zIGFyZSBub3QgZGVmaW5lZFxyXG5cdFx0aWYgKCFmbjEgJiYgIWZuMikgcmV0dXJuO1xyXG5cdFx0aWYgKCFmbjIpIHJldHVybiBmbjE7XHJcblx0XHRpZiAoIWZuMSkgcmV0dXJuIGZuMjtcclxuXHJcblx0XHRpZiAob3B0aW9ucyAmJiBvcHRpb25zLmFzeW5jID09PSB0cnVlKSB7XHJcblx0XHRcdHJldHVybiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0dmFyIGlkeCA9IG9wdGlvbnMuY2FsbGJhY2tJbmRleCB8fCAwO1xyXG5cdFx0XHRcdHZhciBjYWxsYmFjayA9IGFyZ3VtZW50c1tpZHhdO1xyXG5cclxuXHRcdFx0XHQvLyBFbnN1cmUgdGhhdCB0aGVyZSBpcyBhIGNhbGxiYWNrIGZ1bmN0aW9uXHJcblx0XHRcdFx0aWYgKGNhbGxiYWNrID09IG51bGwpIHRocm93IG5ldyBBcmd1bWVudE51bGxFcnJvcihcImNhbGxiYWNrXCIsIFwiJ21lcmdlRnVuY3Rpb25zJyB3YXMgY2FsbGVkIGluIGFzeW5jIG1vZGVcIik7XHJcblx0XHRcdFx0aWYgKHR5cGVvZihjYWxsYmFjaykgIT09IFwiZnVuY3Rpb25cIikgdGhyb3cgbmV3IEFyZ3VtZW50VHlwZUVycm9yKFwiY2FsbGJhY2tcIiwgXCJmdW5jdGlvblwiLCBjYWxsYmFjayk7XHJcblxyXG5cdFx0XHRcdHZhciBzaWduYWwgPSBuZXcgU2lnbmFsKFwibWVyZ2VGdW5jdGlvbnNcIik7XHJcblxyXG5cdFx0XHRcdC8vIHJlcGxhY2UgY2FsbGJhY2sgZnVuY3Rpb24gd2l0aCBzaWduYWwgcGVuZGluZyBhbmQgaW52b2tlIGNhbGxiYWNrIHdoZW4gYm90aCBhcmUgY29tcGxldGVcclxuXHRcdFx0XHR2YXIgYXJnczEgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xyXG5cdFx0XHRcdGFyZ3MxLnNwbGljZShpZHgsIDEsIHNpZ25hbC5wZW5kaW5nKCkpO1xyXG5cdFx0XHRcdGZuMS5hcHBseSh0aGlzLCBhcmdzMSk7XHJcblxyXG5cdFx0XHRcdHZhciBhcmdzMiA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7XHJcblx0XHRcdFx0YXJnczIuc3BsaWNlKGlkeCwgMSwgc2lnbmFsLnBlbmRpbmcoKSk7XHJcblx0XHRcdFx0Zm4yLmFwcGx5KHRoaXMsIGFyZ3MyKTtcclxuXHJcblx0XHRcdFx0c2lnbmFsLndhaXRGb3JBbGwoY2FsbGJhY2ssIChvcHRpb25zLnRoaXNQdHJJbmRleCAmJiBhcmd1bWVudHNbb3B0aW9ucy50aGlzUHRySW5kZXhdKSB8fCB0aGlzKTtcclxuXHRcdFx0fTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5hbmRSZXN1bHRzID09PSB0cnVlKSB7XHJcblx0XHRcdHJldHVybiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0cmV0dXJuIGZuMS5hcHBseSh0aGlzLCBhcmd1bWVudHMpICYmIGZuMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0XHR9O1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLm9yUmVzdWx0cyA9PT0gdHJ1ZSkge1xyXG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdHJldHVybiBmbjEuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCBmbjIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuXHRcdFx0fTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdGZuMS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0XHRcdGZuMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0XHR9O1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gZXF1YWxzKG9iaikge1xyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKG90aGVyKSB7XHJcblx0XHRcdHJldHVybiBvYmogPT09IG90aGVyO1xyXG5cdFx0fTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIG5vdChmbikge1xyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRyZXR1cm4gIWZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcblx0XHR9O1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gYmVmb3JlKG9yaWdpbmFsLCBmbikge1xyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0XHRvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0fTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGFmdGVyKG9yaWdpbmFsLCBmbikge1xyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0XHRmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0fTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGNhbGxBcmd1bWVudChhcmcpIHtcclxuXHRcdGFyZy5jYWxsKCk7XHJcblx0fVxyXG5cclxuXHR2YXIgZnVuY1JlZ2V4ID0gL2Z1bmN0aW9uXFxzKihbXFx3X1xcJF0qKS9pO1xyXG5cdGZ1bmN0aW9uIHBhcnNlRnVuY3Rpb25OYW1lKGYpIHtcclxuXHRcdHZhciByZXN1bHQgPSBmdW5jUmVnZXguZXhlYyhmKTtcclxuXHRcdHJldHVybiByZXN1bHQgPyAocmVzdWx0WzFdIHx8IFwie2Fub255bW91c31cIikgOiBcInthbm9ueW1vdXN9XCI7XHJcblx0fVxyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLkFycmF5XHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gYWRkUmFuZ2UoYXJyLCBpdGVtcykge1xyXG5cdFx0YXJyLnB1c2guYXBwbHkoYXJyLCBpdGVtcyk7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBjb250YWlucyhhcnIsIGl0ZW0sIGZyb20pIHtcclxuXHRcdHJldHVybiBhcnIuaW5kZXhPZihpdGVtLCBmcm9tKSA+PSAwO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gY29weShhcnIpIHtcclxuXHRcdHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnIpO1xyXG5cdH1cclxuXHJcblx0Ly8gRmlsdGVycyBvdXQgZHVwbGljYXRlIGl0ZW1zIGZyb20gdGhlIGdpdmVuIGFycmF5LlxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0ZnVuY3Rpb24gZGlzdGluY3QoYXJyKSB7XHJcblx0XHR2YXIgcmVzdWx0ID0gW107XHJcblxyXG5cdFx0Zm9yKHZhciBpID0gMCwgbGVuID0gYXJyLmxlbmd0aDsgaSA8IGxlbjsgaSsrKVxyXG5cdFx0XHRpZiAocmVzdWx0LmluZGV4T2YoYXJyW2ldKSA8IDApXHJcblx0XHRcdFx0cmVzdWx0LnB1c2goYXJyW2ldKTtcclxuXHJcblx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gZXZlcnkoYXJyLCBjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0Zm9yICh2YXIgaSA9IDAsIGxlbiA9IGFyci5sZW5ndGg7IGkgPCBsZW47IGkrKylcclxuXHRcdFx0aWYgKGkgaW4gYXJyICYmICFjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcywgYXJyW2ldLCBpLCBhcnIpKVxyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHJcblx0XHRyZXR1cm4gdHJ1ZTtcclxuXHR9XHJcblxyXG5cdC8vIEJhc2VkIG9uIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL0FycmF5L2ZpbGwjcG9seWZpbGxcclxuXHRmdW5jdGlvbiBmaWxsKGFyciwgdmFsdWUpIHtcclxuXHRcdC8vIFN0ZXBzIDEtMi5cclxuXHRcdGlmIChhcnIgPT0gbnVsbCkge1xyXG5cdFx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKCdBcnJheSBpcyBudWxsIG9yIG5vdCBkZWZpbmVkJyk7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIE8gPSBPYmplY3QoYXJyKTtcclxuXHJcblx0XHQvLyBTdGVwcyAzLTUuXHJcblx0XHR2YXIgbGVuID0gTy5sZW5ndGggPj4+IDA7XHJcblxyXG5cdFx0Ly8gU3RlcHMgNi03LlxyXG5cdFx0dmFyIHN0YXJ0ID0gYXJndW1lbnRzWzJdO1xyXG5cdFx0dmFyIHJlbGF0aXZlU3RhcnQgPSBzdGFydCA+PiAwO1xyXG5cclxuXHRcdC8vIFN0ZXAgOC5cclxuXHRcdHZhciBrID0gcmVsYXRpdmVTdGFydCA8IDAgP1xyXG5cdFx0XHRNYXRoLm1heChsZW4gKyByZWxhdGl2ZVN0YXJ0LCAwKSA6XHJcblx0XHRcdE1hdGgubWluKHJlbGF0aXZlU3RhcnQsIGxlbik7XHJcblxyXG5cdFx0Ly8gU3RlcHMgOS0xMC5cclxuXHRcdHZhciBlbmQgPSBhcmd1bWVudHNbM107XHJcblx0XHR2YXIgcmVsYXRpdmVFbmQgPSBlbmQgPT09IHVuZGVmaW5lZCA/XHJcblx0XHRcdGxlbiA6IGVuZCA+PiAwO1xyXG5cclxuXHRcdC8vIFN0ZXAgMTEuXHJcblx0XHR2YXIgZmluYWxWYWx1ZSA9IHJlbGF0aXZlRW5kIDwgMCA/XHJcblx0XHRcdE1hdGgubWF4KGxlbiArIHJlbGF0aXZlRW5kLCAwKSA6XHJcblx0XHRcdE1hdGgubWluKHJlbGF0aXZlRW5kLCBsZW4pO1xyXG5cclxuXHRcdC8vIFN0ZXAgMTIuXHJcblx0XHR3aGlsZSAoayA8IGZpbmFsVmFsdWUpIHtcclxuXHRcdFx0T1trXSA9IHZhbHVlO1xyXG5cdFx0XHRrKys7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gU3RlcCAxMy5cclxuXHRcdHJldHVybiBPO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gZmlsdGVyKGFyciwgY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdHZhciByZXN1bHQgPSBbXTtcclxuXHRcdGZvciAodmFyIGkgPSAwLCBsZW4gPSBhcnIubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0aWYgKGkgaW4gYXJyKSB7XHJcblx0XHRcdFx0dmFyIHZhbCA9IGFycltpXTsgLy8gY2FsbGJhY2sgbWF5IG11dGF0ZSBvcmlnaW5hbCBpdGVtXHJcblx0XHRcdFx0aWYgKGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzLCB2YWwsIGksIGFycikpXHJcblx0XHRcdFx0XHRyZXN1bHQucHVzaCh2YWwpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHJlc3VsdDtcclxuXHR9XHJcblxyXG5cdC8vIEJhc2VkIG9uIGh0dHBzOi8vdmFuaWxsYWpzdG9vbGtpdC5jb20vcG9seWZpbGxzL2FycmF5ZmluZC9cclxuXHRmdW5jdGlvbiBmaW5kKGFyciwgY2FsbGJhY2spIHtcclxuXHRcdC8vIDEuIExldCBPIGJlID8gVG9PYmplY3QodGhpcyB2YWx1ZSkuXHJcblx0XHRpZiAoYXJyID09IG51bGwpIHtcclxuXHRcdFx0dGhyb3cgbmV3IFR5cGVFcnJvcignQXJyYXkgaXMgbnVsbCBvciBub3QgZGVmaW5lZCcpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBvID0gT2JqZWN0KGFycik7XHJcblxyXG5cdFx0Ly8gMi4gTGV0IGxlbiBiZSA/IFRvTGVuZ3RoKD8gR2V0KE8sIFwibGVuZ3RoXCIpKS5cclxuXHRcdHZhciBsZW4gPSBvLmxlbmd0aCA+Pj4gMDtcclxuXHJcblx0XHQvLyAzLiBJZiBJc0NhbGxhYmxlKGNhbGxiYWNrKSBpcyBmYWxzZSwgdGhyb3cgYSBUeXBlRXJyb3IgZXhjZXB0aW9uLlxyXG5cdFx0aWYgKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xyXG5cdFx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKCdjYWxsYmFjayBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyA0LiBJZiB0aGlzQXJnIHdhcyBzdXBwbGllZCwgbGV0IFQgYmUgdGhpc0FyZzsgZWxzZSBsZXQgVCBiZSB1bmRlZmluZWQuXHJcblx0XHR2YXIgdGhpc0FyZyA9IGFyZ3VtZW50c1syXTtcclxuXHJcblx0XHQvLyA1LiBMZXQgayBiZSAwLlxyXG5cdFx0dmFyIGsgPSAwO1xyXG5cclxuXHRcdC8vIDYuIFJlcGVhdCwgd2hpbGUgayA8IGxlblxyXG5cdFx0d2hpbGUgKGsgPCBsZW4pIHtcclxuXHRcdFx0Ly8gYS4gTGV0IFBrIGJlICEgVG9TdHJpbmcoaykuXHJcblx0XHRcdC8vIGIuIExldCBrVmFsdWUgYmUgPyBHZXQoTywgUGspLlxyXG5cdFx0XHQvLyBjLiBMZXQgdGVzdFJlc3VsdCBiZSBUb0Jvb2xlYW4oPyBDYWxsKGNhbGxiYWNrLCBULCDDr8K/wr0ga1ZhbHVlLCBrLCBPIMOvwr/CvSkpLlxyXG5cdFx0XHQvLyBkLiBJZiB0ZXN0UmVzdWx0IGlzIHRydWUsIHJldHVybiBrVmFsdWUuXHJcblx0XHRcdHZhciBrVmFsdWUgPSBvW2tdO1xyXG5cdFx0XHRpZiAoY2FsbGJhY2suY2FsbCh0aGlzQXJnLCBrVmFsdWUsIGssIG8pKSB7XHJcblx0XHRcdFx0cmV0dXJuIGtWYWx1ZTtcclxuXHRcdFx0fVxyXG5cdFx0XHQvLyBlLiBJbmNyZWFzZSBrIGJ5IDEuXHJcblx0XHRcdGsrKztcclxuXHRcdH1cclxuXHJcblx0XHQvLyA3LiBSZXR1cm4gdW5kZWZpbmVkLlxyXG5cdFx0cmV0dXJuIHVuZGVmaW5lZDtcclxuXHR9XHJcblxyXG5cdC8vIEJhc2VkIG9uIGh0dHBzOi8vdmFuaWxsYWpzdG9vbGtpdC5jb20vcG9seWZpbGxzL2FycmF5ZmluZGluZGV4L1xyXG5cdGZ1bmN0aW9uIGZpbmRJbmRleChhcnIsIHByZWRpY2F0ZSkge1xyXG5cdFx0aWYgKGFyciA9PSBudWxsKSB7XHJcblx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoJ0FycmF5IGlzIG51bGwgb3Igbm90IGRlZmluZWQnKTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyAxLiBMZXQgTyBiZSA/IFRvT2JqZWN0KHRoaXMgdmFsdWUpLlxyXG5cdFx0dmFyIG8gPSBPYmplY3QoYXJyKTtcclxuXHJcblx0XHQvLyAyLiBMZXQgbGVuIGJlID8gVG9MZW5ndGgoPyBHZXQoTywgXCJsZW5ndGhcIikpLlxyXG5cdFx0dmFyIGxlbiA9IG8ubGVuZ3RoID4+PiAwO1xyXG5cclxuXHRcdC8vIDMuIElmIElzQ2FsbGFibGUocHJlZGljYXRlKSBpcyBmYWxzZSwgdGhyb3cgYSBUeXBlRXJyb3IgZXhjZXB0aW9uLlxyXG5cdFx0aWYgKHR5cGVvZiBwcmVkaWNhdGUgIT09ICdmdW5jdGlvbicpIHtcclxuXHRcdFx0dGhyb3cgbmV3IFR5cGVFcnJvcigncHJlZGljYXRlIG11c3QgYmUgYSBmdW5jdGlvbicpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIDQuIElmIHRoaXNBcmcgd2FzIHN1cHBsaWVkLCBsZXQgVCBiZSB0aGlzQXJnOyBlbHNlIGxldCBUIGJlIHVuZGVmaW5lZC5cclxuXHRcdHZhciB0aGlzQXJnID0gYXJndW1lbnRzWzJdO1xyXG5cclxuXHRcdC8vIDUuIExldCBrIGJlIDAuXHJcblx0XHR2YXIgayA9IDA7XHJcblxyXG5cdFx0Ly8gNi4gUmVwZWF0LCB3aGlsZSBrIDwgbGVuXHJcblx0XHR3aGlsZSAoayA8IGxlbikge1xyXG5cdFx0XHQvLyBhLiBMZXQgUGsgYmUgISBUb1N0cmluZyhrKS5cclxuXHRcdFx0Ly8gYi4gTGV0IGtWYWx1ZSBiZSA/IEdldChPLCBQaykuXHJcblx0XHRcdC8vIGMuIExldCB0ZXN0UmVzdWx0IGJlIFRvQm9vbGVhbig/IENhbGwocHJlZGljYXRlLCBULCDDr8K/wr0ga1ZhbHVlLCBrLCBPIMOvwr/CvSkpLlxyXG5cdFx0XHQvLyBkLiBJZiB0ZXN0UmVzdWx0IGlzIHRydWUsIHJldHVybiBrLlxyXG5cdFx0XHR2YXIga1ZhbHVlID0gb1trXTtcclxuXHRcdFx0aWYgKHByZWRpY2F0ZS5jYWxsKHRoaXNBcmcsIGtWYWx1ZSwgaywgbykpIHtcclxuXHRcdFx0XHRyZXR1cm4gaztcclxuXHRcdFx0fVxyXG5cdFx0XHQvLyBlLiBJbmNyZWFzZSBrIGJ5IDEuXHJcblx0XHRcdGsrKztcclxuXHRcdH1cclxuXHJcblx0XHQvLyA3LiBSZXR1cm4gLTEuXHJcblx0XHRyZXR1cm4gLTE7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBmaXJzdChhcnIsIGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRmb3IgKHZhciBpID0gMCwgbGVuID0gYXJyLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcblx0XHRcdGlmIChpIGluIGFycikge1xyXG5cdFx0XHRcdHZhciB2YWwgPSBhcnJbaV07XHJcblx0XHRcdFx0aWYgKCFjYWxsYmFjayB8fCBjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcywgdmFsLCBpLCBhcnIpID09PSB0cnVlKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gdmFsO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBudWxsO1xyXG5cdH1cclxuXHJcblx0Ly8gQmFzZWQgb24gaHR0cHM6Ly92YW5pbGxhanN0b29sa2l0LmNvbS9wb2x5ZmlsbHMvYXJyYXlmbGF0L1xyXG5cdGZ1bmN0aW9uIGZsYXQoYXJyLCBkZXB0aCkge1xyXG5cdFx0Ly8gSWYgbm8gZGVwdGggaXMgc3BlY2lmaWVkLCBkZWZhdWx0IHRvIDFcclxuXHRcdGlmIChkZXB0aCA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdGRlcHRoID0gMTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBSZWN1cnNpdmVseSByZWR1Y2Ugc3ViLWFycmF5cyB0byB0aGUgc3BlY2lmaWVkIGRlcHRoXHJcblx0XHR2YXIgZmxhdHRlbiA9IGZ1bmN0aW9uIChhcnIsIGRlcHRoKSB7XHJcblxyXG5cdFx0XHQvLyBJZiBkZXB0aCBpcyAwLCByZXR1cm4gdGhlIGFycmF5IGFzLWlzXHJcblx0XHRcdGlmIChkZXB0aCA8IDEpIHtcclxuXHRcdFx0XHRyZXR1cm4gYXJyLnNsaWNlKCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIE90aGVyd2lzZSwgY29uY2F0ZW5hdGUgaW50byB0aGUgcGFyZW50IGFycmF5XHJcblx0XHRcdHJldHVybiBhcnIucmVkdWNlKGZ1bmN0aW9uIChhY2MsIHZhbCkge1xyXG5cdFx0XHRcdHJldHVybiBhY2MuY29uY2F0KEFycmF5LmlzQXJyYXkodmFsKSA/IGZsYXR0ZW4odmFsLCBkZXB0aCAtIDEpIDogdmFsKTtcclxuXHRcdFx0fSwgW10pO1xyXG5cclxuXHRcdH07XHJcblxyXG5cdFx0cmV0dXJuIGZsYXR0ZW4oYXJyLCBkZXB0aCk7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBmbGF0TWFwKGFyciwgY2FsbGJhY2tGbikge1xyXG5cdFx0cmV0dXJuIGZsYXQoQXJyYXkucHJvdG90eXBlLm1hcC5hcHBseShhcnIsIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpLCAxKTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGZvckVhY2goYXJyLCBjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0Zm9yICh2YXIgaSA9IDAsIGxlbiA9IGFyci5sZW5ndGg7IGkgPCBsZW47IGkrKylcclxuXHRcdFx0aWYgKGkgaW4gYXJyKVxyXG5cdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzLCBhcnJbaV0sIGksIGFycik7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBpbmRleE9mKGFyciwgZWx0LCBmcm9tKSB7XHJcblx0XHR2YXIgbGVuID0gYXJyLmxlbmd0aDtcclxuXHRcdGZyb20gPSBOdW1iZXIoZnJvbSkgfHwgMDtcclxuXHRcdGZyb20gPSAoZnJvbSA8IDApID8gTWF0aC5jZWlsKGZyb20pIDogTWF0aC5mbG9vcihmcm9tKTtcclxuXHRcdGlmIChmcm9tIDwgMCkgZnJvbSArPSBsZW47XHJcblxyXG5cdFx0Zm9yICg7IGZyb20gPCBsZW47IGZyb20rKylcclxuXHRcdFx0aWYgKGZyb20gaW4gYXJyICYmIGFycltmcm9tXSA9PT0gZWx0KVxyXG5cdFx0XHRcdHJldHVybiBmcm9tO1xyXG5cclxuXHRcdHJldHVybiAtMTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGluc2VydChhcnIsIGluZGV4LCBpdGVtKSB7XHJcblx0XHRhcnIuc3BsaWNlLmNhbGwoYXJyLCBpbmRleCwgMCwgaXRlbSk7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBpbnNlcnRSYW5nZShhcnIsIGluZGV4LCBpdGVtcykge1xyXG5cdFx0dmFyIGFyZ3MgPSBpdGVtcy5zbGljZSgpO1xyXG5cdFx0YXJncy5zcGxpY2UoMCwgMCwgaW5kZXgsIDApO1xyXG5cdFx0YXJyLnNwbGljZS5hcHBseShhcnIsIGFyZ3MpO1xyXG5cdH1cclxuXHJcblx0Ly8gRmluZHMgdGhlIHNldCBpbnRlcnNlY3Rpb24gb2YgdGhlIHR3byBnaXZlbiBhcnJheXMuICBUaGUgaXRlbXNcclxuXHQvLyBpbiB0aGUgcmVzdWx0aW5nIGxpc3QgYXJlIGRpc3RpbmN0IGFuZCBpbiBubyBwYXJ0aWN1bGFyIG9yZGVyLlxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHRmdW5jdGlvbiBpbnRlcnNlY3QoYXJyMSwgYXJyMikge1xyXG5cdFx0cmV0dXJuIGRpc3RpbmN0KGZpbHRlcihhcnIxLCBmdW5jdGlvbihpdGVtKSB7XHJcblx0XHRcdHJldHVybiBhcnIyLmluZGV4T2YoaXRlbSkgPj0gMDtcclxuXHRcdH0pKTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGxhc3QoYXJyLCBjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0dmFyIHJlc3VsdCA9IG51bGw7XHJcblxyXG5cdFx0Zm9yICh2YXIgaSA9IDAsIGxlbiA9IGFyci5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG5cdFx0XHRpZiAoaSBpbiBhcnIpIHtcclxuXHRcdFx0XHR2YXIgdmFsID0gYXJyW2ldO1xyXG5cdFx0XHRcdGlmICghY2FsbGJhY2sgfHwgY2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMsIHZhbCwgaSwgYXJyKSA9PT0gdHJ1ZSkge1xyXG5cdFx0XHRcdFx0cmVzdWx0ID0gdmFsO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiByZXN1bHQ7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBsYXN0SW5kZXhPZihhcnIsIGl0ZW0sIGZyb20pIHtcclxuXHRcdHZhciBsZW4gPSBhcnIubGVuZ3RoO1xyXG5cclxuXHRcdGlmIChsZW4gPT09IDApIHJldHVybiAtMTtcclxuXHJcblx0XHR2YXIgbiA9IGxlbjtcclxuXHRcdGlmIChmcm9tKSB7XHJcblx0XHRcdG4gPSBOdW1iZXIoZnJvbSk7XHJcblxyXG5cdFx0XHRpZiAobiAhPT0gbilcclxuXHRcdFx0XHRuID0gMDtcclxuXHRcdFx0ZWxzZSBpZiAobiAhPT0gMCAmJiBuICE9PSAoMSAvIDApICYmIG4gIT09IC0oMSAvIDApKVxyXG5cdFx0XHRcdG4gPSAobiA+IDAgfHwgLTEpICogTWF0aC5mbG9vcihNYXRoLmFicyhuKSk7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIGsgPSBuID49IDAgPyBNYXRoLm1pbihuLCBsZW4gLSAxKSA6IGxlbiAtIE1hdGguYWJzKG4pO1xyXG5cclxuXHRcdHdoaWxlIChrID49IDApXHJcblx0XHRcdGlmIChrIGluIGFyciAmJiBhcnJba10gPT09IGl0ZW0pXHJcblx0XHRcdFx0cmV0dXJuIGs7XHJcblxyXG5cdFx0cmV0dXJuIC0xO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gbWFwKGFyciwgY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdHZhciByZXN1bHQgPSBbXTtcclxuXHJcblx0XHRmb3IgKHZhciBpID0gMCwgbGVuID0gYXJyLmxlbmd0aDsgaSA8IGxlbjsgaSsrKVxyXG5cdFx0XHRpZiAoaSBpbiBhcnIpXHJcblx0XHRcdFx0cmVzdWx0W2ldID0gY2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMsIGFycltpXSwgaSwgYXJyKTtcclxuXHJcblx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gbWFwVG9BcnJheShhcnIsIGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHR2YXIgcmVzdWx0ID0gW107XHJcblxyXG5cdFx0Zm9yRWFjaChhcnIsIGZ1bmN0aW9uKGl0ZW0sIGksIGEpIHtcclxuXHRcdFx0YWRkUmFuZ2UocmVzdWx0LCBjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcywgaXRlbSwgaSwgYSkpO1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0cmV0dXJuIHJlc3VsdDtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIG9ic2VydmFibGVTcGxpY2UoYXJyLCBldmVudHMsIGluZGV4LCByZW1vdmVDb3VudCwgYWRkSXRlbXMpIHtcclxuXHRcdHZhciByZW1vdmVkSXRlbXM7XHJcblxyXG5cdFx0aWYgKHJlbW92ZUNvdW50KSB7XHJcblx0XHRcdGlmIChyZW1vdmVDb3VudCA+IDEgJiYgYXJyLnJlbW92ZVJhbmdlKSB7XHJcblx0XHRcdFx0cmVtb3ZlZEl0ZW1zID0gYXJyLnJlbW92ZVJhbmdlKGluZGV4LCByZW1vdmVDb3VudCk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAocmVtb3ZlQ291bnQgPT09IDEgJiYgYXJyLnJlbW92ZUF0KSB7XHJcblx0XHRcdFx0cmVtb3ZlZEl0ZW1zID0gW2Fyci5yZW1vdmVBdChpbmRleCldO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHJlbW92ZWRJdGVtcyA9IGFyci5zcGxpY2UoaW5kZXgsIHJlbW92ZUNvdW50KTtcclxuXHRcdFx0fVxyXG5cdFxyXG5cdFx0XHRpZiAoZXZlbnRzKSB7XHJcblx0XHRcdFx0ZXZlbnRzLnB1c2goe1xyXG5cdFx0XHRcdFx0YWN0aW9uOiBTeXMuTm90aWZ5Q29sbGVjdGlvbkNoYW5nZWRBY3Rpb24ucmVtb3ZlLFxyXG5cdFx0XHRcdFx0b2xkU3RhcnRpbmdJbmRleDogaW5kZXgsXHJcblx0XHRcdFx0XHRvbGRJdGVtczogcmVtb3ZlZEl0ZW1zLFxyXG5cdFx0XHRcdFx0bmV3U3RhcnRpbmdJbmRleDogbnVsbCxcclxuXHRcdFx0XHRcdG5ld0l0ZW1zOiBudWxsXHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRpZiAoYWRkSXRlbXMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRpZiAoYWRkSXRlbXMubGVuZ3RoID4gMSAmJiBhcnIuaW5zZXJ0UmFuZ2UpIHtcclxuXHRcdFx0XHRhcnIuaW5zZXJ0UmFuZ2UoaW5kZXgsIGFkZEl0ZW1zKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmIChhZGRJdGVtcy5sZW5ndGggPT09IDEgJiYgYXJyLmluc2VydCkge1xyXG5cdFx0XHRcdGFyci5pbnNlcnQoaW5kZXgsIGFkZEl0ZW1zWzBdKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRpbnNlcnRSYW5nZShhcnIsIGluZGV4LCBhZGRJdGVtcyk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChldmVudHMpIHtcclxuXHRcdFx0XHRldmVudHMucHVzaCh7XHJcblx0XHRcdFx0XHRhY3Rpb246IFN5cy5Ob3RpZnlDb2xsZWN0aW9uQ2hhbmdlZEFjdGlvbi5hZGQsXHJcblx0XHRcdFx0XHRvbGRTdGFydGluZ0luZGV4OiBudWxsLFxyXG5cdFx0XHRcdFx0b2xkSXRlbXM6IG51bGwsXHJcblx0XHRcdFx0XHRuZXdTdGFydGluZ0luZGV4OiBpbmRleCxcclxuXHRcdFx0XHRcdG5ld0l0ZW1zOiBhZGRJdGVtc1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBwZWVrKGFycikge1xyXG5cdFx0dmFyIHBlZWtWYWwgPSBhcnIucG9wKCk7XHJcblx0XHRhcnIucHVzaChwZWVrVmFsKTtcclxuXHRcdHJldHVybiBwZWVrVmFsO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gcHVyZ2UoYXJyLCBjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0dmFyIHJlc3VsdCA9IG51bGw7XHJcblxyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0aWYgKGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzLCBhcnJbaV0sIGksIGFycikgPT09IHRydWUpIHtcclxuXHRcdFx0XHQvLyBJbnZva2UgcmVtb3ZlQXQgbWV0aG9kIGlmIGl0IGV4aXN0cy5cclxuXHRcdFx0XHRpZiAoYXJyLnJlbW92ZUF0KVxyXG5cdFx0XHRcdFx0YXJyLnJlbW92ZUF0KGkpO1xyXG5cdFx0XHRcdGVsc2VcclxuXHRcdFx0XHRcdGFyci5zcGxpY2UoaSwgMSk7XHJcblxyXG5cdFx0XHRcdC8vIExhenkgY3JlYXRlIHJlc3VsdCBhcnJheS5cclxuXHRcdFx0XHRpZiAocmVzdWx0ID09PSBudWxsKSB7XHJcblx0XHRcdFx0XHRyZXN1bHQgPSBbXTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIEFkZCBpbmRleCAoYWNjb3VudGluZyBmb3IgcHJldmlvdXNseSByZW1vdmVkXHJcblx0XHRcdFx0Ly8gaXRlbXMgdGhhdCBhcmUgbm93IGluIHRoZSByZXR1cm4gdmFsdWUpLlxyXG5cdFx0XHRcdHJlc3VsdC5wdXNoKGkgKyByZXN1bHQubGVuZ3RoKTtcclxuXHJcblx0XHRcdFx0Ly8gRGVjcmVtZW50IHRvIGFjY291bnQgZm9yIHJlbW92YWwuXHJcblx0XHRcdFx0aS0tO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHJlc3VsdDtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHJlZHVjZShhcnIsIGFjY3VtbGF0b3IsIGluaXRpYWxWYWx1ZSl7XHJcblx0XHR2YXIgaSA9IDAsIGxlbiA9IGFyci5sZW5ndGgsIGN1cnI7XHJcblxyXG5cdFx0aWYodHlwZW9mKGFjY3VtbGF0b3IpICE9PSBcImZ1bmN0aW9uXCIpXHJcblx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoXCJGaXJzdCBhcmd1bWVudCBpcyBub3QgYSBmdW5jdGlvbi5cIik7XHJcblxyXG5cdFx0aWYoIWxlbiAmJiBhcmd1bWVudHMubGVuZ3RoIDw9IDIpXHJcblx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoXCJBcnJheSBsZW5ndGggaXMgMCBhbmQgbm8gaW50aWFsIHZhbHVlIHdhcyBnaXZlbi5cIik7XHJcblxyXG5cdFx0aWYoYXJndW1lbnRzLmxlbmd0aCA8PSAyKSB7XHJcblx0XHRcdGlmIChsZW4gPT09IDApXHJcblx0XHRcdFx0dGhyb3cgbmV3IFR5cGVFcnJvcihcIkVtcHR5IGFycmF5IGFuZCBubyBzZWNvbmQgYXJndW1lbnRcIik7XHJcblxyXG5cdFx0XHRjdXJyID0gYXJyW2krK107IC8vIEluY3JlYXNlIGkgdG8gc3RhcnQgc2VhcmNoaW5nIHRoZSBzZWNvbmRseSBkZWZpbmVkIGVsZW1lbnQgaW4gdGhlIGFycmF5XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0Y3VyciA9IGFyZ3VtZW50c1syXTtcclxuXHRcdH1cclxuXHJcblx0XHRmb3IoOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0aWYgKGkgaW4gYXJyKSB7XHJcblx0XHRcdFx0Y3VyciA9IGFjY3VtbGF0b3IuY2FsbCh1bmRlZmluZWQsIGN1cnIsIGFycltpXSwgaSwgYXJyKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBjdXJyO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gcmVtb3ZlKGFyciwgaXRlbSkge1xyXG5cdFx0dmFyIGlkeCA9IGFyci5pbmRleE9mKGl0ZW0pO1xyXG5cdFx0aWYgKGlkeCA8IDApXHJcblx0XHRcdHJldHVybiBmYWxzZTtcclxuXHJcblx0XHRhcnIuc3BsaWNlKGlkeCwgMSk7XHJcblx0XHRyZXR1cm4gdHJ1ZTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHJlbW92ZUF0KGFyciwgaW5kZXgpIHtcclxuXHRcdGFyci5zcGxpY2UoaW5kZXgsIDEpO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gcmVtb3ZlUmFuZ2UoYXJyLCBpbmRleCwgY291bnQpIHtcclxuXHRcdHJldHVybiBhcnIuc3BsaWNlKGluZGV4LCBjb3VudCk7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBzaW5nbGUoYXJyLCBjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0dmFyIGl0ZW1zO1xyXG5cdFx0aWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0aXRlbXMgPSBmaWx0ZXIoYXJyLCBjYWxsYmFjaywgdGhpc1B0cik7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0aXRlbXMgPSBhcnI7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKGl0ZW1zLmxlbmd0aCA+IDEpXHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIkV4cGVjdGVkIGEgc2luZ2xlIGl0ZW0sIGJ1dCBmb3VuZCBcIiArIGl0ZW1zLmxlbmd0aCArIFwiLlwiKTtcclxuXHJcblx0XHRpZiAoaXRlbXMubGVuZ3RoID09PSAwKSB7XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIkV4cGVjdGVkIGEgc2luZ2xlIGl0ZW0sIGJ1dCBkaWQgbm90IGZpbmQgYSBtYXRjaC5cIik7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIGl0ZW1zWzBdO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gc29tZShhcnIsIGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRmb3IgKHZhciBpID0gMCwgbGVuID0gYXJyLmxlbmd0aDsgaSA8IGxlbjsgaSsrKVxyXG5cdFx0XHRpZiAoaSBpbiBhcnIgJiYgY2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMsIGFycltpXSwgaSwgYXJyKSlcclxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHJcblx0XHRyZXR1cm4gZmFsc2U7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiB1cGRhdGUoYXJyLCB0YXJnZXQvKiwgdHJhY2tFdmVudHMsIGVxdWFsaXR5Rm4qLykge1xyXG5cdFx0dmFyIHNvdXJjZSA9IGFyciwgdHJhY2tFdmVudHMgPSBhcmd1bWVudHNbMl0sIGV2ZW50cyA9IHRyYWNrRXZlbnRzID8gW10gOiBudWxsLCBwb2ludGVyID0gMCwgc3JjU2VlayA9IDAsIHRndFNlZWsgPSAwLCBlcXVhbGl0eUZuID0gYXJndW1lbnRzWzNdO1xyXG5cclxuXHRcdHdoaWxlIChzcmNTZWVrIDwgc291cmNlLmxlbmd0aCkge1xyXG5cdFx0XHRpZiAoc291cmNlW3NyY1NlZWtdID09PSB0YXJnZXRbdGd0U2Vla10pIHtcclxuXHRcdFx0XHRpZiAocG9pbnRlciA9PT0gc3JjU2VlayAmJiBwb2ludGVyID09PSB0Z3RTZWVrKSB7XHJcblx0XHRcdFx0XHQvLyBpdGVtcyBtYXRjaCwgc28gYWR2YW5jZVxyXG5cdFx0XHRcdFx0cG9pbnRlciA9IHNyY1NlZWsgPSB0Z3RTZWVrID0gcG9pbnRlciArIDE7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0Ly8gcmVtb3ZlIHJhbmdlIGZyb20gc291cmNlIGFuZCBhZGQgcmFuZ2UgZnJvbSB0YXJnZXRcclxuXHRcdFx0XHRcdG9ic2VydmFibGVTcGxpY2Uoc291cmNlLCBldmVudHMsIHBvaW50ZXIsIHNyY1NlZWsgLSBwb2ludGVyLCB0YXJnZXQuc2xpY2UocG9pbnRlciwgdGd0U2VlaykpO1xyXG5cclxuXHRcdFx0XHRcdC8vIHJlc2V0IHRvIGluZGV4IGZvbGxvdyB0YXJnZXQgc2VlayBsb2NhdGlvbiBzaW5jZSBhcnJheXMgbWF0Y2ggdXAgdG8gdGhhdCBwb2ludFxyXG5cdFx0XHRcdFx0cG9pbnRlciA9IHNyY1NlZWsgPSB0Z3RTZWVrID0gdGd0U2VlayArIDE7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKHRndFNlZWsgPj0gdGFyZ2V0Lmxlbmd0aCkge1xyXG5cdFx0XHRcdC8vIHJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgdGFyZ2V0IGFycmF5LCBzbyBhZHZhbmNlIHRoZSBzcmMgcG9pbnRlciBhbmQgdGVzdCBhZ2FpblxyXG5cdFx0XHRcdHRndFNlZWsgPSBwb2ludGVyO1xyXG5cdFx0XHRcdHNyY1NlZWsgKz0gMTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHQvLyBhZHZhbmNlIHRvIHRoZSBuZXh0IHRhcmdldCBpdGVtIHRvIHRlc3RcclxuXHRcdFx0XHR0Z3RTZWVrICs9IDE7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRvYnNlcnZhYmxlU3BsaWNlKHNvdXJjZSwgZXZlbnRzLCBwb2ludGVyLCBzcmNTZWVrIC0gcG9pbnRlciwgdGFyZ2V0LnNsaWNlKHBvaW50ZXIsIE1hdGgubWF4KHRndFNlZWssIHRhcmdldC5sZW5ndGgpKSk7XHJcblxyXG5cdFx0cmV0dXJuIGV2ZW50cztcclxuXHR9XHJcblxyXG5cdGlmICghQXJyYXkucHJvdG90eXBlLmFkZFJhbmdlKVxyXG5cdFx0QXJyYXkucHJvdG90eXBlLmFkZFJhbmdlID0gZnVuY3Rpb24oaXRlbXMpIHsgYWRkUmFuZ2UodGhpcywgaXRlbXMpOyB9O1xyXG5cdGlmICghQXJyYXkucHJvdG90eXBlLmNvcHkpXHJcblx0XHRBcnJheS5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gY29weSh0aGlzKTsgfTtcclxuXHRpZiAoIUFycmF5LnByb3RvdHlwZS5jbGVhcilcclxuXHRcdEFycmF5LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsgdGhpcy5sZW5ndGggPSAwOyB9O1xyXG5cdGlmICghQXJyYXkucHJvdG90eXBlLmNvbnRhaW5zKVxyXG5cdFx0QXJyYXkucHJvdG90eXBlLmNvbnRhaW5zID0gZnVuY3Rpb24gKGVsdC8qLCBmcm9tKi8pIHsgcmV0dXJuIGNvbnRhaW5zKHRoaXMsIGVsdCwgYXJndW1lbnRzWzFdKTsgfTtcclxuXHRpZiAoIUFycmF5LnByb3RvdHlwZS5kZXF1ZXVlKVxyXG5cdFx0QXJyYXkucHJvdG90eXBlLmRlcXVldWUgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMuc2hpZnQoKTsgfTtcclxuXHRpZiAoIUFycmF5LnByb3RvdHlwZS5kaXN0aW5jdClcclxuXHRcdEFycmF5LnByb3RvdHlwZS5kaXN0aW5jdCA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gZGlzdGluY3QodGhpcyk7IH07XHJcblx0aWYgKCFBcnJheS5wcm90b3R5cGUuZXZlcnkpXHJcblx0XHRBcnJheS5wcm90b3R5cGUuZXZlcnkgPSBmdW5jdGlvbihmdW4gLyosIHRoaXNwKi8pIHsgcmV0dXJuIGV2ZXJ5KHRoaXMsIGZ1biwgYXJndW1lbnRzWzFdKTsgfTtcclxuXHRpZiAoIUFycmF5LnByb3RvdHlwZS5maWxsKVxyXG5cdFx0QXJyYXkucHJvdG90eXBlLmZpbGwgPSBmdW5jdGlvbih2YWx1ZSwgdGltZXMpIHsgcmV0dXJuIGZpbGwodGhpcywgdmFsdWUsIHRpbWVzKTsgfTtcclxuXHRpZiAoIUFycmF5LnByb3RvdHlwZS5maWx0ZXIpXHJcblx0XHRBcnJheS5wcm90b3R5cGUuZmlsdGVyID0gZnVuY3Rpb24oZnVuLyosIHRoaXNwICovKSB7IHJldHVybiBmaWx0ZXIodGhpcywgZnVuLCBhcmd1bWVudHNbMV0pOyB9O1xyXG5cdGlmICghQXJyYXkucHJvdG90eXBlLmZpbmQpXHJcblx0XHRBcnJheS5wcm90b3R5cGUuZmluZCA9IGZ1bmN0aW9uKGNhbGxiYWNrRm4sIHRoaXNBcmcpIHsgcmV0dXJuIGZpbmQodGhpcywgY2FsbGJhY2tGbiwgdGhpc0FyZyk7IH07XHJcblx0aWYgKCFBcnJheS5wcm90b3R5cGUuZmluZEluZGV4KVxyXG5cdFx0QXJyYXkucHJvdG90eXBlLmZpbmRJbmRleCA9IGZ1bmN0aW9uKHByZWRpY2F0ZSwgdGhpc0FyZykgeyByZXR1cm4gZmluZEluZGV4KHRoaXMsIHByZWRpY2F0ZSwgdGhpc0FyZyk7IH07XHJcblx0aWYgKCFBcnJheS5wcm90b3R5cGUuZmlyc3QpXHJcblx0XHRBcnJheS5wcm90b3R5cGUuZmlyc3QgPSBmdW5jdGlvbihmdW4vKiwgdGhpc3AgKi8pIHsgcmV0dXJuIGZpcnN0KHRoaXMsIGZ1biwgYXJndW1lbnRzWzFdKTsgfTtcclxuXHRpZiAoIUFycmF5LnByb3RvdHlwZS5mbGF0KVxyXG5cdFx0QXJyYXkucHJvdG90eXBlLmZsYXQgPSBmdW5jdGlvbihkZXB0aCkgeyByZXR1cm4gZmxhdCh0aGlzLCBkZXB0aCk7IH07XHJcblx0aWYgKCFBcnJheS5wcm90b3R5cGUuZmxhdE1hcClcclxuXHRcdEFycmF5LnByb3RvdHlwZS5mbGF0TWFwID0gZnVuY3Rpb24oY2FsbGJhY2tGbikgeyByZXR1cm4gZmxhdE1hcCh0aGlzLCBjYWxsYmFja0ZuKTsgfTtcclxuXHRpZiAoIUFycmF5LnByb3RvdHlwZS5mb3JFYWNoKVxyXG5cdFx0QXJyYXkucHJvdG90eXBlLmZvckVhY2ggPSBmdW5jdGlvbihmdW4gLyosIHRoaXNwKi8pIHsgZm9yRWFjaCh0aGlzLCBmdW4sIGFyZ3VtZW50c1sxXSk7IH07XHJcblx0aWYgKCFBcnJheS5wcm90b3R5cGUuaW5kZXhPZilcclxuXHRcdEFycmF5LnByb3RvdHlwZS5pbmRleE9mID0gZnVuY3Rpb24oZWx0LyosIGZyb20qLykgeyByZXR1cm4gaW5kZXhPZih0aGlzLCBlbHQsIGFyZ3VtZW50c1sxXSk7IH07XHJcblx0aWYgKCFBcnJheS5wcm90b3R5cGUuaW50ZXJzZWN0KVxyXG5cdFx0QXJyYXkucHJvdG90eXBlLmludGVyc2VjdCA9IGZ1bmN0aW9uKGl0ZW1zKSB7IHJldHVybiBpbnRlcnNlY3QodGhpcywgaXRlbXMpOyB9O1xyXG5cdGlmICghQXJyYXkucHJvdG90eXBlLmxhc3QpXHJcblx0XHRBcnJheS5wcm90b3R5cGUubGFzdCA9IGZ1bmN0aW9uKGZ1bi8qLCB0aGlzcCAqLykgeyByZXR1cm4gbGFzdCh0aGlzLCBmdW4sIGFyZ3VtZW50c1sxXSk7IH07XHJcblx0aWYgKCFBcnJheS5wcm90b3R5cGUubGFzdEluZGV4T2YpXHJcblx0XHRBcnJheS5wcm90b3R5cGUubGFzdEluZGV4T2YgPSBmdW5jdGlvbiAoaXRlbS8qLCBmcm9tKi8pIHsgcmV0dXJuIGxhc3RJbmRleE9mKHRoaXMsIGl0ZW0sIGFyZ3VtZW50c1sxXSk7IH07XHJcblx0aWYgKCFBcnJheS5wcm90b3R5cGUubWFwKVxyXG5cdFx0QXJyYXkucHJvdG90eXBlLm1hcCA9IGZ1bmN0aW9uKGZ1biAvKiwgdGhpc3AqLykgeyByZXR1cm4gbWFwKHRoaXMsIGZ1biwgYXJndW1lbnRzWzFdKTsgfTtcclxuXHRpZiAoIUFycmF5LnByb3RvdHlwZS5tYXBUb0FycmF5KVxyXG5cdFx0QXJyYXkucHJvdG90eXBlLm1hcFRvQXJyYXkgPSBmdW5jdGlvbihmdW4vKiwgdGhpc3AqLykgeyByZXR1cm4gbWFwVG9BcnJheSh0aGlzLCBmdW4sIGFyZ3VtZW50c1sxXSk7IH07XHJcblx0aWYgKCFBcnJheS5wcm90b3R5cGUucGVlaylcclxuXHRcdEFycmF5LnByb3RvdHlwZS5wZWVrID0gZnVuY3Rpb24oKSB7IHJldHVybiBwZWVrKHRoaXMpOyB9O1xyXG5cdGlmICghQXJyYXkucHJvdG90eXBlLnB1cmdlKVxyXG5cdFx0QXJyYXkucHJvdG90eXBlLnB1cmdlID0gZnVuY3Rpb24oZnVuLyosIHRoaXNwKi8pIHsgcmV0dXJuIHB1cmdlKHRoaXMsIGZ1biwgYXJndW1lbnRzWzFdKTsgfTtcclxuXHRpZiAoIUFycmF5LnByb3RvdHlwZS5yZWR1Y2UpXHJcblx0XHRBcnJheS5wcm90b3R5cGUucmVkdWNlID0gZnVuY3Rpb24oYWNjdW11bGF0b3IsIGludGlhbFZhbHVlKSB7IHJldHVybiByZWR1Y2UodGhpcywgYWNjdW11bGF0b3IsIGludGlhbFZhbHVlKTsgfTtcclxuXHRpZiAoIUFycmF5LnByb3RvdHlwZS5yZW1vdmUpXHJcblx0XHRBcnJheS5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oaXRlbSkgeyByZXR1cm4gcmVtb3ZlKHRoaXMsIGl0ZW0pOyB9O1xyXG5cdGlmICghQXJyYXkucHJvdG90eXBlLnNpbmdsZSlcclxuXHRcdEFycmF5LnByb3RvdHlwZS5zaW5nbGUgPSBmdW5jdGlvbihmdW4vKiwgdGhpc3AgKi8pIHsgcmV0dXJuIHNpbmdsZSh0aGlzLCBmdW4sIGFyZ3VtZW50c1sxXSk7IH07XHJcblx0aWYgKCFBcnJheS5wcm90b3R5cGUuc29tZSlcclxuXHRcdEFycmF5LnByb3RvdHlwZS5zb21lID0gZnVuY3Rpb24oZnVuIC8qLCB0aGlzcCovKSB7IHJldHVybiBzb21lKHRoaXMsIGZ1biwgYXJndW1lbnRzWzFdKTsgfTtcclxuXHJcblx0Ly8gQmFzZWQgb24gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvQXJyYXkvZnJvbSNwb2x5ZmlsbFxyXG5cdHZhciBmcm9tID0gKGZ1bmN0aW9uICgpIHtcclxuXHRcdHZhciBzeW1ib2xJdGVyYXRvcjtcclxuXHRcdHRyeSB7XHJcblx0XHRcdHN5bWJvbEl0ZXJhdG9yID0gU3ltYm9sLml0ZXJhdG9yXHJcblx0XHRcdFx0PyBTeW1ib2wuaXRlcmF0b3JcclxuXHRcdFx0XHQ6ICdTeW1ib2woU3ltYm9sLml0ZXJhdG9yKSc7XHJcblx0XHR9IGNhdGNoIChlKSB7XHJcblx0XHRcdHN5bWJvbEl0ZXJhdG9yID0gJ1N5bWJvbChTeW1ib2wuaXRlcmF0b3IpJztcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgdG9TdHIgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nO1xyXG5cdFx0dmFyIGlzQ2FsbGFibGUgPSBmdW5jdGlvbiAoZm4pIHtcclxuXHRcdFx0cmV0dXJuIChcclxuXHRcdFx0XHR0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicgfHxcclxuXHRcdFx0XHR0b1N0ci5jYWxsKGZuKSA9PT0gJ1tvYmplY3QgRnVuY3Rpb25dJ1xyXG5cdFx0XHQpO1xyXG5cdFx0fTtcclxuXHRcdHZhciB0b0ludGVnZXIgPSBmdW5jdGlvbiAodmFsdWUpIHtcclxuXHRcdFx0dmFyIG51bWJlciA9IE51bWJlcih2YWx1ZSk7XHJcblx0XHRcdGlmIChpc05hTihudW1iZXIpKSByZXR1cm4gMDtcclxuXHRcdFx0aWYgKG51bWJlciA9PT0gMCB8fCAhaXNGaW5pdGUobnVtYmVyKSkgcmV0dXJuIG51bWJlcjtcclxuXHRcdFx0cmV0dXJuIChudW1iZXIgPiAwID8gMSA6IC0xKSAqIE1hdGguZmxvb3IoTWF0aC5hYnMobnVtYmVyKSk7XHJcblx0XHR9O1xyXG5cdFx0dmFyIG1heFNhZmVJbnRlZ2VyID0gTWF0aC5wb3coMiwgNTMpIC0gMTtcclxuXHRcdHZhciB0b0xlbmd0aCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG5cdFx0XHR2YXIgbGVuID0gdG9JbnRlZ2VyKHZhbHVlKTtcclxuXHRcdFx0cmV0dXJuIE1hdGgubWluKE1hdGgubWF4KGxlbiwgMCksIG1heFNhZmVJbnRlZ2VyKTtcclxuXHRcdH07XHJcblxyXG5cdFx0dmFyIHNldEdldEl0ZW1IYW5kbGVyID0gZnVuY3Rpb24gc2V0R2V0SXRlbUhhbmRsZXIoaXNJdGVyYXRvciwgaXRlbXMpIHtcclxuXHRcdFx0dmFyIGl0ZXJhdG9yID0gaXNJdGVyYXRvciAmJiBpdGVtc1tzeW1ib2xJdGVyYXRvcl0oKTtcclxuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uIGdldEl0ZW0oaykge1xyXG5cdFx0XHRcdHJldHVybiBpc0l0ZXJhdG9yID8gaXRlcmF0b3IubmV4dCgpIDogaXRlbXNba107XHJcblx0XHRcdH07XHJcblx0XHR9O1xyXG5cclxuXHRcdHZhciBnZXRBcnJheSA9IGZ1bmN0aW9uIGdldEFycmF5KFxyXG5cdFx0XHRULFxyXG5cdFx0XHRBLFxyXG5cdFx0XHRsZW4sXHJcblx0XHRcdGdldEl0ZW0sXHJcblx0XHRcdGlzSXRlcmF0b3IsXHJcblx0XHRcdG1hcEZuXHJcblx0XHQpIHtcclxuXHRcdFx0Ly8gMTYuIExldCBrIGJlIDAuXHJcblx0XHRcdHZhciBrID0gMDtcclxuXHJcblx0XHRcdC8vIDE3LiBSZXBlYXQsIHdoaWxlIGsgPCBsZW7Dr8K/wr0gb3Igd2hpbGUgaXRlcmF0b3IgaXMgZG9uZSAoYWxzbyBzdGVwcyBhIC0gaClcclxuXHRcdFx0d2hpbGUgKGsgPCBsZW4gfHwgaXNJdGVyYXRvcikge1xyXG5cdFx0XHRcdHZhciBpdGVtID0gZ2V0SXRlbShrKTtcclxuXHRcdFx0XHR2YXIga1ZhbHVlID0gaXNJdGVyYXRvciA/IGl0ZW0udmFsdWUgOiBpdGVtO1xyXG5cclxuXHRcdFx0XHRpZiAoaXNJdGVyYXRvciAmJiBpdGVtLmRvbmUpIHtcclxuXHRcdFx0XHRcdHJldHVybiBBO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRpZiAobWFwRm4pIHtcclxuXHRcdFx0XHRcdFx0QVtrXSA9XHJcblx0XHRcdFx0XHRcdFx0dHlwZW9mIFQgPT09ICd1bmRlZmluZWQnXHJcblx0XHRcdFx0XHRcdFx0XHQ/IG1hcEZuKGtWYWx1ZSwgaylcclxuXHRcdFx0XHRcdFx0XHRcdDogbWFwRm4uY2FsbChULCBrVmFsdWUsIGspO1xyXG5cdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0QVtrXSA9IGtWYWx1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ayArPSAxO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoaXNJdGVyYXRvcikge1xyXG5cdFx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoXHJcblx0XHRcdFx0XHQnQXJyYXkuZnJvbTogcHJvdmlkZWQgYXJyYXlMaWtlIG9yIGl0ZXJhdG9yIGhhcyBsZW5ndGggbW9yZSB0aGVuIDIgKiogNTIgLSAxJ1xyXG5cdFx0XHRcdCk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0QS5sZW5ndGggPSBsZW47XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiBBO1xyXG5cdFx0fTtcclxuXHJcblx0XHQvLyBUaGUgbGVuZ3RoIHByb3BlcnR5IG9mIHRoZSBmcm9tIG1ldGhvZCBpcyAxLlxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uIGZyb20oYXJyYXlMaWtlT3JJdGVyYXRvciAvKiwgbWFwRm4sIHRoaXNBcmcgKi8pIHtcclxuXHRcdFx0Ly8gMS4gTGV0IEMgYmUgdGhlIHRoaXMgdmFsdWUuXHJcblx0XHRcdHZhciBDID0gdGhpcztcclxuXHJcblx0XHRcdC8vIDIuIExldCBpdGVtcyBiZSBUb09iamVjdChhcnJheUxpa2VPckl0ZXJhdG9yKS5cclxuXHRcdFx0dmFyIGl0ZW1zID0gT2JqZWN0KGFycmF5TGlrZU9ySXRlcmF0b3IpO1xyXG5cdFx0XHR2YXIgaXNJdGVyYXRvciA9IGlzQ2FsbGFibGUoaXRlbXNbc3ltYm9sSXRlcmF0b3JdKTtcclxuXHJcblx0XHRcdC8vIDMuIFJldHVybklmQWJydXB0KGl0ZW1zKS5cclxuXHRcdFx0aWYgKGFycmF5TGlrZU9ySXRlcmF0b3IgPT0gbnVsbCAmJiAhaXNJdGVyYXRvcikge1xyXG5cdFx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoXHJcblx0XHRcdFx0XHQnQXJyYXkuZnJvbSByZXF1aXJlcyBhbiBhcnJheS1saWtlIG9iamVjdCBvciBpdGVyYXRvciAtIG5vdCBudWxsIG9yIHVuZGVmaW5lZCdcclxuXHRcdFx0XHQpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyA0LiBJZiBtYXBmbiBpcyB1bmRlZmluZWQsIHRoZW4gbGV0IG1hcHBpbmcgYmUgZmFsc2UuXHJcblx0XHRcdHZhciBtYXBGbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdm9pZCB1bmRlZmluZWQ7XHJcblx0XHRcdHZhciBUO1xyXG5cdFx0XHRpZiAodHlwZW9mIG1hcEZuICE9PSAndW5kZWZpbmVkJykge1xyXG5cdFx0XHRcdC8vIDUuIGVsc2VcclxuXHRcdFx0XHQvLyA1LiBhIElmIElzQ2FsbGFibGUobWFwZm4pIGlzIGZhbHNlLCB0aHJvdyBhIFR5cGVFcnJvciBleGNlcHRpb24uXHJcblx0XHRcdFx0aWYgKCFpc0NhbGxhYmxlKG1hcEZuKSkge1xyXG5cdFx0XHRcdFx0dGhyb3cgbmV3IFR5cGVFcnJvcihcclxuXHRcdFx0XHRcdFx0J0FycmF5LmZyb206IHdoZW4gcHJvdmlkZWQsIHRoZSBzZWNvbmQgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJ1xyXG5cdFx0XHRcdFx0KTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIDUuIGIuIElmIHRoaXNBcmcgd2FzIHN1cHBsaWVkLCBsZXQgVCBiZSB0aGlzQXJnOyBlbHNlIGxldCBUIGJlIHVuZGVmaW5lZC5cclxuXHRcdFx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDIpIHtcclxuXHRcdFx0XHRcdFQgPSBhcmd1bWVudHNbMl07XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyAxMC4gTGV0IGxlblZhbHVlIGJlIEdldChpdGVtcywgXCJsZW5ndGhcIikuXHJcblx0XHRcdC8vIDExLiBMZXQgbGVuIGJlIFRvTGVuZ3RoKGxlblZhbHVlKS5cclxuXHRcdFx0dmFyIGxlbiA9IHRvTGVuZ3RoKGl0ZW1zLmxlbmd0aCk7XHJcblxyXG5cdFx0XHQvLyAxMy4gSWYgSXNDb25zdHJ1Y3RvcihDKSBpcyB0cnVlLCB0aGVuXHJcblx0XHRcdC8vIDEzLiBhLiBMZXQgQSBiZSB0aGUgcmVzdWx0IG9mIGNhbGxpbmcgdGhlIFtbQ29uc3RydWN0XV0gaW50ZXJuYWwgbWV0aG9kXHJcblx0XHRcdC8vIG9mIEMgd2l0aCBhbiBhcmd1bWVudCBsaXN0IGNvbnRhaW5pbmcgdGhlIHNpbmdsZSBpdGVtIGxlbi5cclxuXHRcdFx0Ly8gMTQuIGEuIEVsc2UsIExldCBBIGJlIEFycmF5Q3JlYXRlKGxlbikuXHJcblx0XHRcdHZhciBBID0gaXNDYWxsYWJsZShDKSA/IE9iamVjdChuZXcgQyhsZW4pKSA6IG5ldyBBcnJheShsZW4pO1xyXG5cclxuXHRcdFx0cmV0dXJuIGdldEFycmF5KFxyXG5cdFx0XHRcdFQsXHJcblx0XHRcdFx0QSxcclxuXHRcdFx0XHRsZW4sXHJcblx0XHRcdFx0c2V0R2V0SXRlbUhhbmRsZXIoaXNJdGVyYXRvciwgaXRlbXMpLFxyXG5cdFx0XHRcdGlzSXRlcmF0b3IsXHJcblx0XHRcdFx0bWFwRm5cclxuXHRcdFx0KTtcclxuXHRcdH07XHJcblx0fSkoKTtcclxuXHJcblx0Ly8gQmFzZWQgb24gaHR0cHM6Ly92YW5pbGxhanN0b29sa2l0LmNvbS9wb2x5ZmlsbHMvYXJyYXlpc2FycmF5L1xyXG5cdGZ1bmN0aW9uIGlzQXJyYXkodmFsdWUpIHtcclxuXHRcdHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsdWUpID09PSAnW29iamVjdCBBcnJheV0nO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gb2YoKSB7XHJcblx0XHRyZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcclxuXHR9XHJcblxyXG5cdGlmICghQXJyYXkuZnJvbSlcclxuXHRcdEFycmF5LmZyb20gPSBmcm9tO1xyXG5cdGlmICghQXJyYXkuaXNBcnJheSlcclxuXHRcdEFycmF5LmlzQXJyYXkgPSBpc0FycmF5O1xyXG5cdGlmICghQXJyYXkub2YpXHJcblx0XHRBcnJheS5vZiA9IG9mO1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLlN0cmluZ1xyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdC8vIEFkZCBTdHJpbmcudHJpbSgpIGlmIG5vdCBuYXRpdmVseSBzdXBwb3J0ZWRcclxuXHRpZiAodHlwZW9mIFN0cmluZy5wcm90b3R5cGUudHJpbSAhPT0gJ2Z1bmN0aW9uJykge1xyXG5cdFx0U3RyaW5nLnByb3RvdHlwZS50cmltID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCAnJyk7XHJcblx0XHR9XHJcblx0fVxyXG5cdGZ1bmN0aW9uIGlzTnVsbE9yRW1wdHkoc3RyKSB7XHJcblx0XHRyZXR1cm4gc3RyID09PSBudWxsIHx8IHN0ciA9PT0gdW5kZWZpbmVkIHx8IHN0ciA9PT0gXCJcIjtcclxuXHR9XHJcblxyXG5cdC8vIEJhc2VkIG9uIGh0dHBzOi8vdmFuaWxsYWpzdG9vbGtpdC5jb20vcG9seWZpbGxzL3N0cmluZ2VuZHN3aXRoL1xyXG5cdGZ1bmN0aW9uIGVuZHNXaXRoKHN0ciwgc2VhcmNoU3RyLCBwb3NpdGlvbikge1xyXG5cdFx0Ly8gVGhpcyB3b3JrcyBtdWNoIGJldHRlciB0aGFuID49IGJlY2F1c2VcclxuXHRcdC8vIGl0IGNvbXBlbnNhdGVzIGZvciBOYU46XHJcblx0XHRpZiAoIShwb3NpdGlvbiA8IHN0ci5sZW5ndGgpKSB7XHJcblx0XHRcdHBvc2l0aW9uID0gc3RyLmxlbmd0aDtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHBvc2l0aW9uIHw9IDA7IC8vIHJvdW5kIHBvc2l0aW9uXHJcblx0XHR9XHJcblx0XHRyZXR1cm4gc3RyLnN1YnN0cihwb3NpdGlvbiAtIHNlYXJjaFN0ci5sZW5ndGgsIHNlYXJjaFN0ci5sZW5ndGgpID09PSBzZWFyY2hTdHI7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBpbmNsdWRlcyhzdHIsIHNlYXJjaCwgc3RhcnQpIHtcclxuXHRcdGlmIChzZWFyY2ggaW5zdGFuY2VvZiBSZWdFeHApIHtcclxuXHRcdFx0dGhyb3cgVHlwZUVycm9yKCdmaXJzdCBhcmd1bWVudCBtdXN0IG5vdCBiZSBhIFJlZ0V4cCcpO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHN0YXJ0ID09PSB1bmRlZmluZWQpIHsgc3RhcnQgPSAwOyB9XHJcblx0XHRyZXR1cm4gc3RyLmluZGV4T2Yoc2VhcmNoLCBzdGFydCkgIT09IC0xO1xyXG5cdH1cclxuXHJcblx0Ly8gaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vVGhlQnJlbm55LzAzOWFkZDUwOWM4N2EzMTQzYjljMDc3Zjc2YWE1NTBiXHJcblx0ZnVuY3Rpb24gbWF0Y2hBbGwgKHN0ciwgcngpIHtcclxuXHRcdGlmICh0eXBlb2YgcnggPT09IFwic3RyaW5nXCIpIHJ4ID0gbmV3IFJlZ0V4cChyeCwgXCJnXCIpOyAvLyBjb2VyY2UgYSBzdHJpbmcgdG8gYmUgYSBnbG9iYWwgcmVnZXhcclxuXHRcdHJ4ID0gbmV3IFJlZ0V4cChyeCk7IC8vIENsb25lIHRoZSByZWdleCBzbyB3ZSBkb24ndCB1cGRhdGUgdGhlIGxhc3QgaW5kZXggb24gdGhlIHJlZ2V4IHRoZXkgcGFzcyB1c1xyXG5cdFx0dmFyIGNhcCA9IFtdOyAvLyB0aGUgc2luZ2xlIGNhcHR1cmVcclxuXHRcdHZhciBhbGwgPSBbXTsgLy8gYWxsIHRoZSBjYXB0dXJlcyAocmV0dXJuIHRoaXMpXHJcblx0XHR3aGlsZSAoKGNhcCA9IHJ4LmV4ZWMoc3RyKSkgIT09IG51bGwpIGFsbC5wdXNoKGNhcCk7IC8vIGV4ZWN1dGUgYW5kIGFkZFxyXG5cdFx0cmV0dXJuIGFsbDsgLy8gcHJvZml0IVxyXG5cdH1cclxuXHJcblx0Ly8gQmFzZWQgb24gaHR0cHM6Ly92YW5pbGxhanN0b29sa2l0LmNvbS9wb2x5ZmlsbHMvc3RyaW5ncGFkZW5kL1xyXG5cdGZ1bmN0aW9uIHBhZEVuZChzdHIsIHRhcmdldExlbmd0aCwgcGFkU3RyaW5nKSB7XHJcblx0XHR0YXJnZXRMZW5ndGggPSB0YXJnZXRMZW5ndGggPj4gMDsgLy9mbG9vciBpZiBudW1iZXIgb3IgY29udmVydCBub24tbnVtYmVyIHRvIDA7XHJcblx0XHRwYWRTdHJpbmcgPSBTdHJpbmcoKHR5cGVvZiBwYWRTdHJpbmcgIT09ICd1bmRlZmluZWQnID8gcGFkU3RyaW5nIDogJyAnKSk7XHJcblx0XHRpZiAoc3RyLmxlbmd0aCA+IHRhcmdldExlbmd0aCkge1xyXG5cdFx0XHRyZXR1cm4gU3RyaW5nKHN0cik7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGFyZ2V0TGVuZ3RoID0gdGFyZ2V0TGVuZ3RoIC0gc3RyLmxlbmd0aDtcclxuXHRcdFx0aWYgKHRhcmdldExlbmd0aCA+IHBhZFN0cmluZy5sZW5ndGgpIHtcclxuXHRcdFx0XHRwYWRTdHJpbmcgKz0gcmVwZWF0KHBhZFN0cmluZywgdGFyZ2V0TGVuZ3RoIC8gcGFkU3RyaW5nLmxlbmd0aCk7IC8vYXBwZW5kIHRvIG9yaWdpbmFsIHRvIGVuc3VyZSB3ZSBhcmUgbG9uZ2VyIHRoYW4gbmVlZGVkXHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIFN0cmluZyhzdHIpICsgcGFkU3RyaW5nLnNsaWNlKDAsIHRhcmdldExlbmd0aCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvLyBCYXNlZCBvbiBodHRwczovL3ZhbmlsbGFqc3Rvb2xraXQuY29tL3BvbHlmaWxscy9zdHJpbmdwYWRzdGFydC9cclxuXHRmdW5jdGlvbiBwYWRTdGFydChzdHIsIHRhcmdldExlbmd0aCwgcGFkU3RyaW5nKSB7XHJcblx0XHR0YXJnZXRMZW5ndGggPSB0YXJnZXRMZW5ndGggPj4gMDsgLy90cnVuY2F0ZSBpZiBudW1iZXIgb3IgY29udmVydCBub24tbnVtYmVyIHRvIDA7XHJcblx0XHRwYWRTdHJpbmcgPSBTdHJpbmcoKHR5cGVvZiBwYWRTdHJpbmcgIT09ICd1bmRlZmluZWQnID8gcGFkU3RyaW5nIDogJyAnKSk7XHJcblx0XHRpZiAoc3RyLmxlbmd0aCA+IHRhcmdldExlbmd0aCkge1xyXG5cdFx0XHRyZXR1cm4gU3RyaW5nKHN0cik7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGFyZ2V0TGVuZ3RoID0gdGFyZ2V0TGVuZ3RoIC0gc3RyLmxlbmd0aDtcclxuXHRcdFx0aWYgKHRhcmdldExlbmd0aCA+IHBhZFN0cmluZy5sZW5ndGgpIHtcclxuXHRcdFx0XHRwYWRTdHJpbmcgKz0gcmVwZWF0KHBhZFN0cmluZywgdGFyZ2V0TGVuZ3RoIC8gcGFkU3RyaW5nLmxlbmd0aCk7IC8vYXBwZW5kIHRvIG9yaWdpbmFsIHRvIGVuc3VyZSB3ZSBhcmUgbG9uZ2VyIHRoYW4gbmVlZGVkXHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHBhZFN0cmluZy5zbGljZSgwLCB0YXJnZXRMZW5ndGgpICsgU3RyaW5nKHN0cik7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvLyBCYXNlZCBvbiBodHRwczovL3ZhbmlsbGFqc3Rvb2xraXQuY29tL3BvbHlmaWxscy9zdHJpbmdyZXBlYXQvXHJcblx0ZnVuY3Rpb24gcmVwZWF0KHN0ciwgY291bnQpIHtcclxuXHRcdGlmIChzdHIgPT0gbnVsbClcclxuXHRcdFx0dGhyb3cgbmV3IFR5cGVFcnJvcignY2FuXFwndCBjb252ZXJ0ICcgKyBzdHIgKyAnIHRvIG9iamVjdCcpO1xyXG5cclxuXHRcdHZhciByZXN1bHQgPSAnJyArIHN0cjtcclxuXHRcdC8vIFRvIGNvbnZlcnQgc3RyaW5nIHRvIGludGVnZXIuXHJcblx0XHRjb3VudCA9ICtjb3VudDtcclxuXHRcdC8vIENoZWNrIE5hTlxyXG5cdFx0aWYgKGNvdW50ICE9IGNvdW50KVxyXG5cdFx0XHRjb3VudCA9IDA7XHJcblxyXG5cdFx0aWYgKGNvdW50IDwgMClcclxuXHRcdFx0dGhyb3cgbmV3IFJhbmdlRXJyb3IoJ3JlcGVhdCBjb3VudCBtdXN0IGJlIG5vbi1uZWdhdGl2ZScpO1xyXG5cclxuXHRcdGlmIChjb3VudCA9PSBJbmZpbml0eSlcclxuXHRcdFx0dGhyb3cgbmV3IFJhbmdlRXJyb3IoJ3JlcGVhdCBjb3VudCBtdXN0IGJlIGxlc3MgdGhhbiBpbmZpbml0eScpO1xyXG5cclxuXHRcdGNvdW50ID0gTWF0aC5mbG9vcihjb3VudCk7XHJcblx0XHRpZiAocmVzdWx0Lmxlbmd0aCA9PSAwIHx8IGNvdW50ID09IDApXHJcblx0XHRcdHJldHVybiAnJztcclxuXHJcblx0XHQvLyBFbnN1cmluZyBjb3VudCBpcyBhIDMxLWJpdCBpbnRlZ2VyIGFsbG93cyB1cyB0byBoZWF2aWx5IG9wdGltaXplIHRoZVxyXG5cdFx0Ly8gbWFpbiBwYXJ0LiBCdXQgYW55d2F5LCBtb3N0IGN1cnJlbnQgKEF1Z3VzdCAyMDE0KSBicm93c2VycyBjYW4ndCBoYW5kbGVcclxuXHRcdC8vIHN0cmluZ3MgMSA8PCAyOCBjaGFycyBvciBsb25nZXIsIHNvOlxyXG5cdFx0aWYgKHJlc3VsdC5sZW5ndGggKiBjb3VudCA+PSAxIDw8IDI4KVxyXG5cdFx0XHR0aHJvdyBuZXcgUmFuZ2VFcnJvcigncmVwZWF0IGNvdW50IG11c3Qgbm90IG92ZXJmbG93IG1heGltdW0gc3RyaW5nIHNpemUnKTtcclxuXHJcblx0XHR2YXIgbWF4Q291bnQgPSByZXN1bHQubGVuZ3RoICogY291bnQ7XHJcblx0XHRjb3VudCA9IE1hdGguZmxvb3IoTWF0aC5sb2coY291bnQpIC8gTWF0aC5sb2coMikpO1xyXG5cdFx0d2hpbGUgKGNvdW50KSB7XHJcblx0XHRcdHJlc3VsdCArPSByZXN1bHQ7XHJcblx0XHRcdGNvdW50LS07XHJcblx0XHR9XHJcblx0XHRyZXN1bHQgKz0gcmVzdWx0LnN1YnN0cmluZygwLCBtYXhDb3VudCAtIHJlc3VsdC5sZW5ndGgpO1xyXG5cdFx0cmV0dXJuIHJlc3VsdDtcclxuXHR9XHJcblxyXG5cdC8vIEJhc2VkIG9uIGh0dHBzOi8vdmFuaWxsYWpzdG9vbGtpdC5jb20vcG9seWZpbGxzL3N0cmluZ3JlcGxhY2VhbGwvXHJcblx0ZnVuY3Rpb24gcmVwbGFjZUFsbChzdHIsIHN1YnN0ciwgbmV3U3Vic3RyKSB7XHJcblx0XHQvLyBJZiBhIHJlZ2V4IHBhdHRlcm5cclxuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoc3Vic3RyKS50b0xvd2VyQ2FzZSgpID09PSAnW29iamVjdCByZWdleHBdJykge1xyXG5cdFx0XHRyZXR1cm4gc3RyLnJlcGxhY2Uoc3Vic3RyLCBuZXdTdWJzdHIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIElmIGEgc3RyaW5nXHJcblx0XHRyZXR1cm4gc3RyLnJlcGxhY2UobmV3IFJlZ0V4cChzdWJzdHIsICdnJyksIG5ld1N1YnN0cik7XHJcblx0fVxyXG5cclxuXHQvLyBCYXNlZCBvbiBodHRwczovL3ZhbmlsbGFqc3Rvb2xraXQuY29tL3BvbHlmaWxscy9zdHJpbmdzdGFydHN3aXRoL1xyXG5cdGZ1bmN0aW9uIHN0YXJ0c1dpdGgoc3RyLCBzZWFyY2hTdHJpbmcsIHBvc2l0aW9uKSB7XHJcblx0XHRyZXR1cm4gc3RyLnNsaWNlKHBvc2l0aW9uIHx8IDAsIHNlYXJjaFN0cmluZy5sZW5ndGgpID09PSBzZWFyY2hTdHJpbmc7XHJcblx0fVxyXG5cclxuXHQvLyBCYXNlZCBvbiBodHRwczovL3ZhbmlsbGFqc3Rvb2xraXQuY29tL3BvbHlmaWxscy9zdHJpbmd0cmltZW5kL1xyXG5cdGZ1bmN0aW9uIHRyaW1FbmQoc3RyKSB7XHJcblx0XHRyZXR1cm4gc3RyLnJlcGxhY2UobmV3IFJlZ0V4cCgvW1xceDA5XFx4MEFcXHgwQlxceDBDXFx4MERcXHgyMFxceEEwXFx1MTY4MFxcdTIwMDBcXHUyMDAxXFx1MjAwMlxcdTIwMDNcXHUyMDA0XFx1MjAwNVxcdTIwMDZcXHUyMDA3XFx1MjAwOFxcdTIwMDlcXHUyMDBBXFx1MjAyRlxcdTIwNUZcXHUzMDAwXFx1MjAyOFxcdTIwMjlcXHVGRUZGXSsvLnNvdXJjZSArICckJywgJ2cnKSwgJycpO1xyXG5cdH1cclxuXHJcblx0Ly8gQmFzZWQgb24gaHR0cHM6Ly92YW5pbGxhanN0b29sa2l0LmNvbS9wb2x5ZmlsbHMvc3RyaW5ndHJpbXN0YXJ0L1xyXG5cdGZ1bmN0aW9uIHRyaW1TdGFydChzdHIpIHtcclxuXHRcdHJldHVybiBzdHIucmVwbGFjZShuZXcgUmVnRXhwKCdeJyArIC9bXFx4MDlcXHgwQVxceDBCXFx4MENcXHgwRFxceDIwXFx4QTBcXHUxNjgwXFx1MjAwMFxcdTIwMDFcXHUyMDAyXFx1MjAwM1xcdTIwMDRcXHUyMDA1XFx1MjAwNlxcdTIwMDdcXHUyMDA4XFx1MjAwOVxcdTIwMEFcXHUyMDJGXFx1MjA1RlxcdTMwMDBcXHUyMDI4XFx1MjAyOVxcdUZFRkZdKy8uc291cmNlLCAnZycpLCAnJyk7XHJcblx0fVxyXG5cclxuXHRpZiAoIVN0cmluZy5wcm90b3R5cGUuZW5kc1dpdGgpXHJcblx0XHRTdHJpbmcucHJvdG90eXBlLmVuZHNXaXRoID0gZnVuY3Rpb24gKHNlYXJjaFN0ciAvKiwgcG9zaXRpb24qLykgeyByZXR1cm4gZW5kc1dpdGgodGhpcywgcngsIGFyZ3VtZW50c1sxXSk7IH07XHJcblx0aWYgKCFTdHJpbmcucHJvdG90eXBlLmluY2x1ZGVzKVxyXG5cdFx0U3RyaW5nLnByb3RvdHlwZS5pbmNsdWRlcyA9IGZ1bmN0aW9uIChzZWFyY2ggLyosIHN0YXJ0Ki8pIHsgcmV0dXJuIGluY2x1ZGVzKHRoaXMsIHNlYXJjaCwgYXJndW1lbnRzWzFdKTsgfTtcclxuXHRpZiAoIVN0cmluZy5wcm90b3R5cGUubWF0Y2hBbGwpXHJcblx0XHRTdHJpbmcucHJvdG90eXBlLm1hdGNoQWxsID0gZnVuY3Rpb24gKHJlZ2V4cCkgeyByZXR1cm4gbWF0Y2hBbGwodGhpcywgcmVnZXhwKTsgfTtcclxuXHRpZiAoIVN0cmluZy5wcm90b3R5cGUucGFkRW5kKVxyXG5cdFx0U3RyaW5nLnByb3RvdHlwZS5wYWRFbmQgPSBmdW5jdGlvbiAodGFyZ2V0TGVuZ3RoIC8qLCBwYWRTdHJpbmcqLykgeyByZXR1cm4gcGFkRW5kKHRoaXMsIHRhcmdldExlbmd0aCwgYXJndW1lbnRzWzFdKTsgfTtcclxuXHRpZiAoIVN0cmluZy5wcm90b3R5cGUucGFkU3RhcnQpXHJcblx0XHRTdHJpbmcucHJvdG90eXBlLnBhZFN0YXJ0ID0gZnVuY3Rpb24gKHRhcmdldExlbmd0aCAvKiwgcGFkU3RyaW5nKi8pIHsgcmV0dXJuIHBhZFN0YXJ0KHRoaXMsIHRhcmdldExlbmd0aCwgYXJndW1lbnRzWzFdKTsgfTtcclxuXHRpZiAoIVN0cmluZy5wcm90b3R5cGUucmVwZWF0KVxyXG5cdFx0U3RyaW5nLnByb3RvdHlwZS5yZXBlYXQgPSBmdW5jdGlvbiAoY291bnQpIHsgcmV0dXJuIHJlcGVhdCh0aGlzLCBjb3VudCk7IH07XHJcblx0aWYgKCFTdHJpbmcucHJvdG90eXBlLnJlcGxhY2VBbGwpXHJcblx0XHRTdHJpbmcucHJvdG90eXBlLnJlcGxhY2VBbGwgPSBmdW5jdGlvbiAoc3Vic3RyLCBuZXdTdWJzdHIpIHsgcmV0dXJuIHJlcGxhY2VBbGwodGhpcywgc3Vic3RyLCBuZXdTdWJzdHIpOyB9O1xyXG5cdGlmICghU3RyaW5nLnByb3RvdHlwZS5zdGFydHNXaXRoKVxyXG5cdFx0U3RyaW5nLnByb3RvdHlwZS5zdGFydHNXaXRoID0gZnVuY3Rpb24gKHNlYXJjaFN0cmluZyAvKiwgcG9zaXRpb24qLykgeyByZXR1cm4gc3RhcnRzV2l0aCh0aGlzLCBzZWFyY2hTdHJpbmcsIGFyZ3VtZW50c1sxXSk7IH07XHJcblx0aWYgKCFTdHJpbmcucHJvdG90eXBlLnRyaW1FbmQpXHJcblx0XHRTdHJpbmcucHJvdG90eXBlLnRyaW1FbmQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0cmltRW5kKHRoaXMpOyB9O1xyXG5cdGlmICghU3RyaW5nLnByb3RvdHlwZS50cmltU3RhcnQpXHJcblx0XHRTdHJpbmcucHJvdG90eXBlLnRyaW1TdGFydCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRyaW1TdGFydCh0aGlzKTsgfTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5DYWNoZVxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdHZhciBjYWNoZUluaXRlZCA9IGZhbHNlO1xyXG5cclxuXHR2YXIgc2NyaXB0VGFnID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIik7XHJcblx0dmFyIHJlZmVycmVyID0gc2NyaXB0VGFnW3NjcmlwdFRhZy5sZW5ndGggLSAxXS5zcmM7XHJcblxyXG5cdHZhciBjYWNoZUhhc2g7XHJcblxyXG5cdHZhciBtYXRjaCA9IC9bPyZdY2FjaGVoYXNoPShbXiZdKikvaS5leGVjKHJlZmVycmVyKTtcclxuXHRpZiAobWF0Y2gpIHtcclxuXHRcdGNhY2hlSGFzaCA9IG1hdGNoWzFdO1xyXG5cdH1cclxuXHJcblx0RXhvV2ViLmNhY2hlSGFzaCA9IGNhY2hlSGFzaDtcclxuXHJcblx0Ly8gRGV0ZXJtaW5lIGlmIGxvY2FsIHN0b3JhZ2UgaXMgc3VwcG9ydGVkLCB1bmRlcnN0YW5kaW5nIFxyXG5cdHZhciB1c2VMb2NhbFN0b3JhZ2UgPSBmYWxzZTtcclxuXHR0cnkge1xyXG5cdFx0dmFyIHRlc3RMUyA9IFwiYy1sb2NhbFN0b3JhZ2VcIjtcclxuXHRcdHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0ZXN0TFMsIHRlc3RMUyk7XHJcblx0XHR3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGVzdExTKTtcclxuXHRcdHVzZUxvY2FsU3RvcmFnZSA9IHRydWU7XHJcblx0fVxyXG5cdGNhdGNoIChlKVxyXG5cdHsgfVxyXG5cclxuXHRpZiAodXNlTG9jYWxTdG9yYWdlKSB7XHJcblxyXG5cdFx0RXhvV2ViLmNhY2hlID0gZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcclxuXHRcdFx0dmFyIGxvY2FsS2V5ID0ga2V5O1xyXG5cclxuXHRcdFx0Ly8gZGVmZXIgaW5pdCBvZiB0aGUgY2FjaGUgc28gdGhhdCB0aGUgYXBwSW5zdGFuY2VJZCBjYW4gYmUgc2V0XHJcblx0XHRcdGlmICghY2FjaGVJbml0ZWQpIHtcclxuXHRcdFx0XHRjYWNoZUluaXRlZCA9IHRydWU7XHJcblxyXG5cdFx0XHRcdC8vIGlmIHRoZXJlJ3MgYW4gb2xkZXIgdmVyc2lvbiBvZiBjYWNoaW5nLCBjbGVhciB0aGUgZW50aXJlIGNhY2hlICh0aGUgb2xkIHdheSlcclxuXHRcdFx0XHRpZiAod2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiY2FjaGVIYXNoXCIpKVxyXG5cdFx0XHRcdFx0d2luZG93LmxvY2FsU3RvcmFnZS5jbGVhcigpO1xyXG5cclxuXHRcdFx0XHQvLyBGbHVzaCB0aGUgbG9jYWwgc3RvcmFnZSBjYWNoZSBpZiB0aGUgY2FjaGUgaGFzaCBoYXMgY2hhbmdlZFxyXG5cdFx0XHRcdGlmIChjYWNoZUhhc2ggJiYgRXhvV2ViLmNhY2hlKFwiY2FjaGVIYXNoXCIpICE9IGNhY2hlSGFzaCkge1xyXG5cdFx0XHRcdFx0RXhvV2ViLmNsZWFyQ2FjaGUoKTtcclxuXHRcdFx0XHRcdEV4b1dlYi5jYWNoZShcImNhY2hlSGFzaFwiLCBjYWNoZUhhc2gpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gc2NvcGUgdGhlIGNhY2hlIHRvIEV4b1dlYiBhbmQgdG8gYSBwYXJ0aWN1bGFyIGFwcCBpZiB0aGVyZSBhcmUgbXVsdGlwbGUgYXBwcyBob3N0ZWQgYXQgdGhlIHNhbWUgZG9tYWluLlxyXG5cdFx0XHRsb2NhbEtleSA9IFwiRXhvV2ViOmNhY2hlOlwiICsgRXhvV2ViLmNvbmZpZy5hcHBJbnN0YW5jZUlkICsgXCI6XCIgKyBsb2NhbEtleTtcclxuXHJcblx0XHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHtcclxuXHRcdFx0XHR2YWx1ZSA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShsb2NhbEtleSk7XHJcblx0XHRcdFx0cmV0dXJuIHZhbHVlID8gSlNPTi5wYXJzZSh2YWx1ZSkgOiBudWxsO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMikge1xyXG5cdFx0XHRcdHZhciBqc29uID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xyXG5cdFx0XHRcdHRyeSB7XHJcblx0XHRcdFx0XHR3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0obG9jYWxLZXksIGpzb24pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRjYXRjaCAoZSkge1xyXG5cdFx0XHRcdFx0bG9nV2FybmluZyhlLm1lc3NhZ2UpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRyZXR1cm4gdmFsdWU7XHJcblx0XHRcdH1cclxuXHRcdH07XHJcblxyXG5cdFx0RXhvV2ViLmNsZWFyQ2FjaGUgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHdpbmRvdy5sb2NhbFN0b3JhZ2UuY2xlYXIoKTtcclxuXHRcdH07XHJcblx0fVxyXG5cclxuXHQvLyBDYWNoaW5nIE5vdCBTdXBwb3J0ZWRcclxuXHRlbHNlIHtcclxuXHRcdEV4b1dlYi5jYWNoZSA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7IHJldHVybiBudWxsOyB9O1xyXG5cdFx0RXhvV2ViLmNsZWFyQ2FjaGUgPSBmdW5jdGlvbiAoKSB7IH07XHJcblx0fVxyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLkFjdGl2aXR5XHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0dmFyIGFjdGl2aXR5Q2FsbGJhY2tzID0gW107XHJcblxyXG5cdGZ1bmN0aW9uIHJlZ2lzdGVyQWN0aXZpdHkobGFiZWwsIGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRpZiAobGFiZWwgPT0gbnVsbCkgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEVycm9yKFwibGFiZWxcIik7XHJcblx0XHRpZiAodHlwZW9mIChsYWJlbCkgIT09IFwic3RyaW5nXCIpIHRocm93IG5ldyBBcmd1bWVudFR5cGVFcnJvcihcImxhYmVsXCIsIFwic3RyaW5nXCIsIGxhYmVsKTtcclxuXHRcdGlmIChjYWxsYmFjayA9PSBudWxsKSB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXJyb3IoXCJjYWxsYmFja1wiKTtcclxuXHRcdGlmICh0eXBlb2YgKGNhbGxiYWNrKSAhPT0gXCJmdW5jdGlvblwiKSB0aHJvdyBuZXcgQXJndW1lbnRUeXBlRXJyb3IoXCJjYWxsYmFja1wiLCBcImZ1bmN0aW9uXCIsIGNhbGxiYWNrKTtcclxuXHJcblx0XHR2YXIgaXRlbSA9IHsgbGFiZWw6IGxhYmVsLCBjYWxsYmFjazogY2FsbGJhY2sgfTtcclxuXHJcblx0XHRpZiAodGhpc1B0cikge1xyXG5cdFx0XHRjYWxsYmFjay50aGlzUHRyID0gdGhpc1B0cjtcclxuXHRcdH1cclxuXHJcblx0XHRhY3Rpdml0eUNhbGxiYWNrcy5wdXNoKGl0ZW0pO1xyXG5cdH1cclxuXHJcblx0RXhvV2ViLnJlZ2lzdGVyQWN0aXZpdHkgPSByZWdpc3RlckFjdGl2aXR5O1xyXG5cclxuXHRmdW5jdGlvbiBpc0J1c3koLyogbG9nQnVzeUxhYmVsICovKSB7XHJcblx0XHR2YXIgYnVzeSA9IGZhbHNlO1xyXG5cdFx0dmFyIGxvZ0J1c3lMYWJlbCA9IGFyZ3VtZW50c1swXTtcclxuXHJcblx0XHRnZXRCdXN5SXRlbXMoZnVuY3Rpb24gKGl0ZW0pIHtcclxuXHRcdFx0YnVzeSA9IHRydWU7XHJcblxyXG5cdFx0XHRpZiAobG9nQnVzeUxhYmVsKSB7XHJcblx0XHRcdFx0Y29uc29sZS5sb2coXCJJdGVtIFxcXCJcIiArIGl0ZW0ubGFiZWwgKyBcIlxcXCIgaXMgYnVzeS5cIik7XHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHJcblx0XHRyZXR1cm4gYnVzeTtcclxuXHR9XHJcblxyXG5cdEV4b1dlYi5pc0J1c3kgPSBpc0J1c3k7XHJcblxyXG5cdGZ1bmN0aW9uIGdldEJ1c3lJdGVtcyhvbkJ1c3lJdGVtRm91bmQpIHtcclxuXHRcdHZhciBidXN5SXRlbXMgPSBbXTtcclxuXHJcblx0XHRmb3IgKHZhciBpID0gMCwgbGVuID0gYWN0aXZpdHlDYWxsYmFja3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0dmFyIGl0ZW0gPSBhY3Rpdml0eUNhbGxiYWNrc1tpXTtcclxuXHJcblx0XHRcdGlmIChpdGVtLmNhbGxiYWNrLmNhbGwoaXRlbS50aGlzUHRyIHx8IHRoaXMpID09PSB0cnVlKSB7XHJcblx0XHRcdFx0YnVzeUl0ZW1zLnB1c2goaXRlbSk7XHJcblxyXG5cdFx0XHRcdGlmIChvbkJ1c3lJdGVtRm91bmQgJiYgb25CdXN5SXRlbUZvdW5kKGl0ZW0pID09PSB0cnVlKVxyXG5cdFx0XHRcdFx0cmV0dXJuIGJ1c3lJdGVtcztcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBidXN5SXRlbXM7XHJcblx0fVxyXG5cclxuXHRFeG9XZWIuZ2V0QnVzeUl0ZW1zID0gZ2V0QnVzeUl0ZW1zO1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLkJhdGNoXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0dmFyIGJhdGNoSW5kZXggPSAwO1xyXG5cdHZhciBhbGxCYXRjaGVzID0gW107XHJcblx0dmFyIGN1cnJlbnRCYXRjaCA9IG51bGw7XHJcblxyXG5cdGZ1bmN0aW9uIEJhdGNoKGxhYmVsKSB7XHJcblx0XHR0aGlzLl9pbmRleCA9IGJhdGNoSW5kZXgrKztcclxuXHRcdHRoaXMuX2xhYmVscyA9IFtsYWJlbF07XHJcblx0XHR0aGlzLl9yb290TGFiZWwgPSBsYWJlbDtcclxuXHRcdHRoaXMuX3N1YnNjcmliZXJzID0gW107XHJcblxyXG5cdFx0YWxsQmF0Y2hlcy5wdXNoKHRoaXMpO1xyXG5cdH1cclxuXHJcblx0cmVnaXN0ZXJBY3Rpdml0eShcIkJhdGNoXCIsIGZ1bmN0aW9uKCkge1xyXG5cdFx0cmV0dXJuIEJhdGNoLmFsbCgpLmxlbmd0aCA+IDA7XHJcblx0fSk7XHJcblxyXG5cdEJhdGNoLmFsbCA9IGZ1bmN0aW9uIEJhdGNoXyRhbGwoaW5jbHVkZUVuZGVkKSB7XHJcblx0XHRyZXR1cm4gYWxsQmF0Y2hlcy5maWx0ZXIoZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRyZXR1cm4gaW5jbHVkZUVuZGVkIHx8ICFlLmlzRW5kZWQoKTtcclxuXHRcdH0pO1xyXG5cdH07XHJcblxyXG5cdEJhdGNoLmN1cnJlbnQgPSBmdW5jdGlvbiBCYXRjaF8kY3VycmVudCgpIHtcclxuXHRcdHJldHVybiBjdXJyZW50QmF0Y2g7XHJcblx0fTtcclxuXHJcblx0QmF0Y2guc3VzcGVuZEN1cnJlbnQgPSBmdW5jdGlvbiBCYXRjaF8kc3VzcGVuZEN1cnJlbnQobWVzc2FnZSkge1xyXG5cdFx0aWYgKGN1cnJlbnRCYXRjaCAhPT0gbnVsbCkge1xyXG5cdFx0XHR2YXIgYmF0Y2ggPSBjdXJyZW50QmF0Y2g7XHJcblx0XHRcdGN1cnJlbnRCYXRjaCA9IG51bGw7XHJcblx0XHRcdHJldHVybiBiYXRjaDtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRCYXRjaC5zdGFydCA9IGZ1bmN0aW9uIEJhdGNoXyRzdGFydChsYWJlbCkge1xyXG5cdFx0aWYgKGN1cnJlbnRCYXRjaCkge1xyXG5cdFx0XHRjdXJyZW50QmF0Y2guX2JlZ2luKGxhYmVsKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRjdXJyZW50QmF0Y2ggPSBuZXcgQmF0Y2gobGFiZWwpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBjdXJyZW50QmF0Y2g7XHJcblx0fTtcclxuXHJcblx0QmF0Y2gucmVzdW1lID0gZnVuY3Rpb24gQmF0Y2hfJHJlc3VtZShiYXRjaCkge1xyXG5cdFx0aWYgKGJhdGNoKSB7XHJcblx0XHRcdChiYXRjaC5fdHJhbnNmZXJyZWRUbyB8fCBiYXRjaCkuX3Jlc3VtZSgpO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdEJhdGNoLmVuZCA9IGZ1bmN0aW9uIEJhdGNoXyRlbmQoYmF0Y2gpIHtcclxuXHRcdChiYXRjaC5fdHJhbnNmZXJyZWRUbyB8fCBiYXRjaCkuX2VuZCgpO1xyXG5cdH07XHJcblxyXG5cdEJhdGNoLndoZW5Eb25lID0gZnVuY3Rpb24gQmF0Y2hfJHdoZW5Eb25lKGZuLCB0aGlzUHRyKSB7XHJcblx0XHRpZiAoY3VycmVudEJhdGNoKSB7XHJcblx0XHRcdGN1cnJlbnRCYXRjaC53aGVuRG9uZShmbiwgdGhpc1B0cik7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0Zm4uY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdEJhdGNoLmN1cnJlbnQgPSBmdW5jdGlvbiBCYXRjaF8kY3VycmVudCgpIHtcclxuXHRcdHJldHVybiBjdXJyZW50QmF0Y2g7XHJcblx0fTtcclxuXHJcblx0QmF0Y2gubWl4aW4oe1xyXG5cdFx0X2JlZ2luOiBmdW5jdGlvbiBCYXRjaCRfYmVnaW4obGFiZWwpIHtcclxuXHRcdFx0dGhpcy5fbGFiZWxzLnB1c2gobGFiZWwpO1xyXG5cclxuXHRcdFx0cmV0dXJuIHRoaXM7XHJcblx0XHR9LFxyXG5cdFx0X2VuZDogZnVuY3Rpb24gQmF0Y2gkX2VuZCgpIHtcclxuXHRcdFx0Ly8gQ2Fubm90IGVuZCBhIGJhdGNoIHRoYXQgaGFzIGFscmVhZHkgYmVlbiBlbmRlZC5cclxuXHRcdFx0aWYgKHRoaXMuaXNFbmRlZCgpKSB7XHJcblx0XHRcdFx0cmV0dXJuIHRoaXM7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIFJlbW92ZSB0aGUgbGFzdCBsYWJlbCBmcm9tIHRoZSBsaXN0LlxyXG5cdFx0XHR2YXIgbGFiZWwgPSB0aGlzLl9sYWJlbHMucG9wKCk7XHJcblxyXG5cdFx0XHRpZiAodGhpcy5pc0VuZGVkKCkpIHtcclxuXHRcdFx0XHQvLyBJZiB3ZSBhcmUgZW5kaW5nIHRoZSBjdXJyZW50IGJhdGNoLCB0aGVuIG51bGwgb3V0IHRoZSBjdXJyZW50IGJhdGNoIFxyXG5cdFx0XHRcdC8vIHZhcmlhYmxlIHNvIHRoYXQgbmV3IGJhdGNoZXMgY2FuIGJlIGNyZWF0ZWQgd2l0aCBhIG5ldyByb290IGxhYmVsLlxyXG5cdFx0XHRcdGlmIChjdXJyZW50QmF0Y2ggPT09IHRoaXMpIHtcclxuXHRcdFx0XHRcdGN1cnJlbnRCYXRjaCA9IG51bGw7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBJbnZva2UgdGhlIHN1YnNjcmliZXJzLlxyXG5cdFx0XHRcdHZhciBzdWJzY3JpYmVyID0gdGhpcy5fc3Vic2NyaWJlcnMuZGVxdWV1ZSgpO1xyXG5cdFx0XHRcdHdoaWxlIChzdWJzY3JpYmVyKSB7XHJcblx0XHRcdFx0XHRzdWJzY3JpYmVyLmZuLmFwcGx5KHN1YnNjcmliZXIudGhpc1B0ciB8fCB0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0XHRcdFx0c3Vic2NyaWJlciA9IHRoaXMuX3N1YnNjcmliZXJzLmRlcXVldWUoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiB0aGlzO1xyXG5cdFx0fSxcclxuXHRcdF90cmFuc2ZlclRvOiBmdW5jdGlvbiBCYXRjaCRfdHJhbnNmZXJUbyhvdGhlckJhdGNoKSB7XHJcblx0XHRcdC8vIFRyYW5zZmVycyB0aGlzIGJhdGNoJ3MgbGFiZWxzIGFuZCBzdWJzY3JpYmVycyB0byB0aGVcclxuXHRcdFx0Ly8gZ2l2ZW4gYmF0Y2guICBGcm9tIHRoaXMgcG9pbnQgZm9yd2FyZCB0aGlzIGJhdGNoIGRlZmVyc1xyXG5cdFx0XHQvLyBpdHMgYmVoYXZpb3IgdG8gdGhlIGdpdmVuIGJhdGNoLlxyXG5cclxuXHRcdFx0Ly8gVHJhbnNmZXIgbGFiZWxzIGZyb20gb25lIGJhdGNoIHRvIGFub3RoZXIuXHJcblx0XHRcdG90aGVyQmF0Y2guX2xhYmVscy5hZGRSYW5nZSh0aGlzLl9sYWJlbHMpO1xyXG5cdFx0XHR0aGlzLl9sYWJlbHMuY2xlYXIoKTtcclxuXHRcdFx0b3RoZXJCYXRjaC5fc3Vic2NyaWJlcnMuYWRkUmFuZ2UodGhpcy5fc3Vic2NyaWJlcnMpO1xyXG5cdFx0XHR0aGlzLl9zdWJzY3JpYmVycy5jbGVhcigpO1xyXG5cdFx0XHR0aGlzLl90cmFuc2ZlcnJlZFRvID0gb3RoZXJCYXRjaDtcclxuXHRcdH0sXHJcblx0XHRfcmVzdW1lOiBmdW5jdGlvbiBCYXRjaCRfcmVzdW1lKCkge1xyXG5cdFx0XHQvLyBJZ25vcmUgcmVzdW1lIG9uIGEgYmF0Y2ggdGhhdCBoYXMgYWxyZWFkeSBiZWVuIGVuZGVkLlxyXG5cdFx0XHRpZiAodGhpcy5pc0VuZGVkKCkpIHtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChjdXJyZW50QmF0Y2ggIT09IG51bGwpIHtcclxuXHRcdFx0XHQvLyBJZiB0aGVyZSBpcyBhIGN1cnJlbnQgYmF0Y2ggdGhlbiBzaW1wbGUgdHJhbnNmZXIgdGhlIGxhYmVscyB0byBpdC5cclxuXHRcdFx0XHR0aGlzLl90cmFuc2ZlclRvKGN1cnJlbnRCYXRjaCk7XHJcblx0XHRcdFx0cmV0dXJuIGN1cnJlbnRCYXRjaDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Y3VycmVudEJhdGNoID0gdGhpcztcclxuXHJcblx0XHRcdHJldHVybiB0aGlzO1xyXG5cdFx0fSxcclxuXHRcdGlzRW5kZWQ6IGZ1bmN0aW9uIEJhdGNoJGlzRW5kZWQoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9sYWJlbHMubGVuZ3RoID09PSAwO1xyXG5cdFx0fSxcclxuXHRcdHdoZW5Eb25lOiBmdW5jdGlvbiBCYXRjaCR3aGVuRG9uZShmbiwgdGhpc1B0cikge1xyXG5cdFx0XHR0aGlzLl9zdWJzY3JpYmVycy5wdXNoKHsgZm46IGZuLCB0aGlzUHRyOiB0aGlzUHRyIH0pO1xyXG5cclxuXHRcdFx0cmV0dXJuIHRoaXM7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdEV4b1dlYi5CYXRjaCA9IEJhdGNoO1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLlNpZ25hbFxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdHZhciBwZW5kaW5nU2lnbmFsVGltZW91dHMgPSBudWxsO1xyXG5cclxuXHRmdW5jdGlvbiBTaWduYWwoZGVidWdMYWJlbCkge1xyXG5cdFx0dGhpcy5fd2FpdEZvckFsbCA9IFtdO1xyXG5cdFx0dGhpcy5fcGVuZGluZyA9IDA7XHJcblx0XHR0aGlzLl9kZWJ1Z0xhYmVsID0gZGVidWdMYWJlbDtcclxuXHR9XHJcblxyXG5cdHZhciBzZXR1cENhbGxiYWNrcyA9IGZ1bmN0aW9uIHNldHVwQ2FsbGJhY2tzKCkge1xyXG5cdFx0d2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHR2YXIgY2FsbGJhY2tzLCBtYXhCYXRjaCA9IGlzTnVtYmVyKGNvbmZpZy5zaWduYWxNYXhCYXRjaFNpemUpID8gY29uZmlnLnNpZ25hbE1heEJhdGNoU2l6ZSA6IG51bGw7XHJcblx0XHRcdGlmIChtYXhCYXRjaCAmJiBwZW5kaW5nU2lnbmFsVGltZW91dHMubGVuZ3RoID4gbWF4QmF0Y2gpIHtcclxuXHRcdFx0XHQvLyBFeGNlZWRzIG1heCBiYXRjaCBzaXplLCBzbyBvbmx5IGludm9rZSB0aGUgbWF4IG51bWJlciBhbmQgZGVsYXkgdGhlIHJlc3RcclxuXHRcdFx0XHRjYWxsYmFja3MgPSBwZW5kaW5nU2lnbmFsVGltZW91dHMuc3BsaWNlKDAsIG1heEJhdGNoKTtcclxuXHRcdFx0XHRzZXR1cENhbGxiYWNrcygpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdC8vIE5vIG1heCBiYXRjaCwgb3IgZG9lcyBub3QgZXhjZWVkIHNpemUsIHNvIGNhbGwgYWxsIHBlbmRpbmcgY2FsbGJhY2tzXHJcblx0XHRcdFx0Y2FsbGJhY2tzID0gcGVuZGluZ1NpZ25hbFRpbWVvdXRzO1xyXG5cdFx0XHRcdHBlbmRpbmdTaWduYWxUaW1lb3V0cyA9IG51bGw7XHJcblx0XHRcdH1cclxuXHRcdFx0Ly8gQ2FsbCBlYWNoIGNhbGxiYWNrIGluIG9yZGVyXHJcblx0XHRcdGNhbGxiYWNrcy5mb3JFYWNoKGNhbGxBcmd1bWVudCk7XHJcblx0XHR9LCAxKTtcclxuXHR9O1xyXG5cclxuXHRmdW5jdGlvbiBkb0NhbGxiYWNrKG5hbWUsIHRoaXNQdHIsIGNhbGxiYWNrLCBhcmdzLCBleGVjdXRlSW1tZWRpYXRlbHkpIHtcclxuXHRcdGlmIChleGVjdXRlSW1tZWRpYXRlbHkgPT09IGZhbHNlIHx8IChjb25maWcuc2lnbmFsVGltZW91dCA9PT0gdHJ1ZSAmJiBleGVjdXRlSW1tZWRpYXRlbHkgIT09IHRydWUpKSB7XHJcblx0XHRcdHZhciBiYXRjaCA9IEJhdGNoLnN1c3BlbmRDdXJyZW50KFwiX2RvQ2FsbGJhY2tcIik7XHJcblxyXG5cdFx0XHQvLyBtYW5hZ2UgYSBxdWV1ZSBvZiBjYWxsYmFja3MgdG8gZW5zdXJlIHRoZSBvcmRlciBvZiBleGVjdXRpb25cclxuXHJcblx0XHRcdHZhciBzZXR1cCA9IGZhbHNlO1xyXG5cdFx0XHRpZiAocGVuZGluZ1NpZ25hbFRpbWVvdXRzID09PSBudWxsKSB7XHJcblx0XHRcdFx0cGVuZGluZ1NpZ25hbFRpbWVvdXRzID0gW107XHJcblx0XHRcdFx0c2V0dXAgPSB0cnVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRwZW5kaW5nU2lnbmFsVGltZW91dHMucHVzaChmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRCYXRjaC5yZXN1bWUoYmF0Y2gpO1xyXG5cdFx0XHRcdGNhbGxiYWNrLmFwcGx5KHRoaXNQdHIsIGFyZ3MgfHwgW10pO1xyXG5cdFx0XHR9KTtcclxuXHJcblx0XHRcdGlmIChzZXR1cCkge1xyXG5cdFx0XHRcdHNldHVwQ2FsbGJhY2tzKCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRjYWxsYmFjay5hcHBseSh0aGlzUHRyLCBhcmdzIHx8IFtdKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdFNpZ25hbC5taXhpbih7XHJcblx0XHRwZW5kaW5nOiBmdW5jdGlvbiBTaWduYWwkcGVuZGluZyhjYWxsYmFjaywgdGhpc1B0ciwgZXhlY3V0ZUltbWVkaWF0ZWx5KSB7XHJcblx0XHRcdGlmICh0aGlzLl9wZW5kaW5nID09PSAwKSB7XHJcblx0XHRcdFx0U2lnbmFsLmFsbFBlbmRpbmcucHVzaCh0aGlzKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dGhpcy5fcGVuZGluZysrO1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fZ2VuQ2FsbGJhY2soY2FsbGJhY2ssIHRoaXNQdHIsIGV4ZWN1dGVJbW1lZGlhdGVseSk7XHJcblx0XHR9LFxyXG5cdFx0b3JQZW5kaW5nOiBmdW5jdGlvbiBTaWduYWwkb3JQZW5kaW5nKGNhbGxiYWNrLCB0aGlzUHRyLCBleGVjdXRlSW1tZWRpYXRlbHkpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2dlbkNhbGxiYWNrKGNhbGxiYWNrLCB0aGlzUHRyLCBleGVjdXRlSW1tZWRpYXRlbHkpO1xyXG5cdFx0fSxcclxuXHRcdF9kb0NhbGxiYWNrOiBmdW5jdGlvbiBTaWduYWwkX2RvQ2FsbGJhY2sobmFtZSwgdGhpc1B0ciwgY2FsbGJhY2ssIGFyZ3MsIGV4ZWN1dGVJbW1lZGlhdGVseSkge1xyXG5cdFx0XHRkb0NhbGxiYWNrLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcblx0XHR9LFxyXG5cdFx0X2dlbkNhbGxiYWNrOiBmdW5jdGlvbiBTaWduYWwkX2dlbkNhbGxiYWNrKGNhbGxiYWNrLCB0aGlzUHRyLCBleGVjdXRlSW1tZWRpYXRlbHkpIHtcclxuXHRcdFx0dmFyIHNpZ25hbCA9IHRoaXMsIGNhbGxlZCA9IGZhbHNlO1xyXG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24gU2lnbmFsJF9nZW5DYWxsYmFjayRyZXN1bHQoKSB7XHJcblx0XHRcdFx0c2lnbmFsLl9kb0NhbGxiYWNrKFwicGVuZGluZ1wiLCB0aGlzUHRyIHx8IHRoaXMsIGZ1bmN0aW9uIFNpZ25hbCRfZ2VuQ2FsbGJhY2skZm4oKSB7XHJcblxyXG5cdFx0XHRcdFx0Ly8gVGhyb3cgYW4gZXJyb3IgaWYgdGhlIHNpZ25hbCBjYWxsYmFjayBoYXMgYWxyZWFkeSBiZWVuIGNhbGxlZFxyXG5cdFx0XHRcdFx0aWYgKGNhbGxlZCkgdGhyb3cgbmV3IEVycm9yKFwiKFwiICsgc2lnbmFsLl9kZWJ1Z0xhYmVsICsgXCIpIHNpZ25hbCBjYWxsYmFjayB3YXMgY2FsbGVkIG1vcmUgdGhhbiBvbmNlLlwiKTtcclxuXHJcblx0XHRcdFx0XHQvLyBSZWNvcmQgdGhlIGZhY3QgdGhhdCB0aGUgY2FsbGJhY2sgaGFzIGFscmVhZHkgYmVlbiBjYWxsZWQgaW4gY2FzZSBpdCBpcyBjYWxsZWQgYWdhaW5cclxuXHRcdFx0XHRcdGNhbGxlZCA9IHRydWU7XHJcblxyXG5cdFx0XHRcdFx0Ly8gSW52b2tlIHRoZSBjYWxsYmFjayBpZiBpdCBleGlzdHNcclxuXHRcdFx0XHRcdGlmIChjYWxsYmFjaykgY2FsbGJhY2suYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuXHJcblx0XHRcdFx0XHQvLyBTaWduYWwgdGhhdCB0aGUgY2FsbGJhY2sgaXMgY29tcGxldGVcclxuXHRcdFx0XHRcdHNpZ25hbC5vbmVEb25lKCk7XHJcblxyXG5cdFx0XHRcdH0sIGFyZ3VtZW50cywgZXhlY3V0ZUltbWVkaWF0ZWx5KTtcclxuXHRcdFx0fTtcclxuXHRcdH0sXHJcblx0XHR3YWl0Rm9yQWxsOiBmdW5jdGlvbiBTaWduYWwkd2FpdEZvckFsbChjYWxsYmFjaywgdGhpc1B0ciwgZXhlY3V0ZUltbWVkaWF0ZWx5KSB7XHJcblx0XHRcdGlmICghY2FsbGJhY2spIHtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICh0aGlzLl9wZW5kaW5nID09PSAwKSB7XHJcblx0XHRcdFx0dGhpcy5fZG9DYWxsYmFjayhcIndhaXRGb3JBbGxcIiwgdGhpc1B0ciwgY2FsbGJhY2ssIFtdLCBleGVjdXRlSW1tZWRpYXRlbHkpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMuX3dhaXRGb3JBbGwucHVzaCh7IFwiY2FsbGJhY2tcIjogY2FsbGJhY2ssIFwidGhpc1B0clwiOiB0aGlzUHRyLCBcImV4ZWN1dGVJbW1lZGlhdGVseVwiOiBleGVjdXRlSW1tZWRpYXRlbHkgfSk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRvbmVEb25lOiBmdW5jdGlvbiBTaWduYWwkb25lRG9uZSgpIHtcclxuXHRcdFx0LS10aGlzLl9wZW5kaW5nO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMuX3BlbmRpbmcgPT09IDApIHtcclxuXHRcdFx0XHRTaWduYWwuYWxsUGVuZGluZy5yZW1vdmUodGhpcyk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHdoaWxlICh0aGlzLl9wZW5kaW5nID09PSAwICYmIHRoaXMuX3dhaXRGb3JBbGwubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdHZhciBpdGVtID0gdGhpcy5fd2FpdEZvckFsbC5kZXF1ZXVlKCk7XHJcblx0XHRcdFx0dGhpcy5fZG9DYWxsYmFjayhcIndhaXRGb3JBbGxcIiwgaXRlbS50aGlzUHRyLCBpdGVtLmNhbGxiYWNrLCBbXSwgaXRlbS5leGVjdXRlSW1tZWRpYXRlbHkpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0aXNBY3RpdmU6IGZ1bmN0aW9uIFNpZ25hbCRpc0FjdGl2ZSgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX3BlbmRpbmcgPiAwO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHRTaWduYWwuYWxsUGVuZGluZyA9IFtdO1xyXG5cclxuXHRTaWduYWwuYmVnaW4gPSBmdW5jdGlvbiAoZGVidWdMYWJlbCkge1xyXG5cdFx0cmV0dXJuIG5ldyBTaWduYWwoZGVidWdMYWJlbCk7XHJcblx0fTtcclxuXHJcblx0RXhvV2ViLlNpZ25hbCA9IFNpZ25hbDtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5GdW5jdG9yXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gRnVuY3RvcigpIHtcclxuXHRcdHZhciBmdW5jcyA9IFtdO1xyXG5cclxuXHRcdHZhciBmID0gZnVuY3Rpb24gRnVuY3RvciRmbigpIHtcclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBmdW5jcy5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRcdHZhciBpdGVtID0gZnVuY3NbaV07XHJcblxyXG5cdFx0XHRcdC8vIERvbid0IHJlLXJ1biBvbmUtdGltZSBzdWJzY3JpcHRpb25zIHRoYXQgaGF2ZSBhbHJlYWR5IGJlZW4gYXBwbGllZC5cclxuXHRcdFx0XHRpZiAoaXRlbS5hcHBsaWVkID09PSB0cnVlKSB7XHJcblx0XHRcdFx0XHRjb250aW51ZTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIEVuc3VyZSB0aGF0IHRoZXJlIGlzIGVpdGhlciBubyBmaWx0ZXIgb3IgdGhlIGZpbHRlciBwYXNzZXMuXHJcblx0XHRcdFx0aWYgKCFpdGVtLmZpbHRlciB8fCBpdGVtLmZpbHRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpID09PSB0cnVlKSB7XHJcblx0XHRcdFx0XHQvLyBJZiBoYW5kbGVyIGlzIHNldCB0byBleGVjdXRlIG9uY2UsXHJcblx0XHRcdFx0XHQvLyByZW1vdmUgdGhlIGhhbmRsZXIgYmVmb3JlIGNhbGxpbmcuXHJcblx0XHRcdFx0XHRpZiAoaXRlbS5vbmNlID09PSB0cnVlKSB7XHJcblx0XHRcdFx0XHRcdC8vIE1hcmsgYXMgYXBwbGllZCBidXQgbGVhdmUgaXRlbSBpbiBhcnJheSB0byBhdm9pZCBwb3RlbnRpYWxcclxuXHRcdFx0XHRcdFx0Ly8gcHJvYmxlbXMgZHVlIHRvIHJlLWVudHJ5IGludG8gZXZlbnQgaW52YWxpZGF0aW5nIGl0ZXJhdGlvblxyXG5cdFx0XHRcdFx0XHQvLyBpbmRleC4gSW4gc29tZSBjYXNlcyByZS1lbnRyeSB3b3VsZCBiZSBhIHJlZC1mbGFnLCBidXQgZm9yXHJcblx0XHRcdFx0XHRcdC8vIFwiZ2xvYmFsXCIgZXZlbnRzLCB3aGVyZSB0aGUgY29udGV4dCBvZiB0aGUgZXZlbnQgaXMgZGVyaXZlZFxyXG5cdFx0XHRcdFx0XHQvLyBmcm9tIHRoZSBhcmd1bWVudHMsIHRoZSBldmVudCBjb3VsZCBlYXNpbHkgYmUgcmUtZW50ZXJlZFxyXG5cdFx0XHRcdFx0XHQvLyBpbiBhIGRpZmZlcmVudCBjb250ZXh0IHdpdGggZGlmZmVyZW50IGFyZ3VtZW50cy5cclxuXHRcdFx0XHRcdFx0aXRlbS5hcHBsaWVkID0gdHJ1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyBDYWxsIHRoZSBoYW5kbGVyIGZ1bmN0aW9uLlxyXG5cdFx0XHRcdFx0aXRlbS5mbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHJcblx0XHRmLl9mdW5jcyA9IGZ1bmNzO1xyXG5cdFx0Zi5hZGQgPSBGdW5jdG9yJGFkZDtcclxuXHRcdGYucmVtb3ZlID0gRnVuY3RvciRyZW1vdmU7XHJcblx0XHRmLmlzRW1wdHkgPSBGdW5jdG9yJGlzRW1wdHk7XHJcblx0XHRmLmNsZWFyID0gRnVuY3RvciRjbGVhcjtcclxuXHJcblx0XHRyZXR1cm4gZjtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIEZ1bmN0b3IkYWRkKGZuLCBmaWx0ZXIsIG9uY2UpIHtcclxuXHRcdHZhciBpdGVtID0geyBmbjogZm4gfTtcclxuXHJcblx0XHRpZiAoZmlsdGVyICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0aXRlbS5maWx0ZXIgPSBmaWx0ZXI7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKG9uY2UgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRpdGVtLm9uY2UgPSBvbmNlO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuX2Z1bmNzLnB1c2goaXRlbSk7XHJcblxyXG5cdFx0cmV0dXJuIGZuO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gRnVuY3RvciRyZW1vdmUob2xkKSB7XHJcblx0XHRmb3IgKHZhciBpID0gdGhpcy5fZnVuY3MubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcclxuXHRcdFx0aWYgKHRoaXMuX2Z1bmNzW2ldLmZuID09PSBvbGQpIHtcclxuXHRcdFx0XHR0aGlzLl9mdW5jcy5zcGxpY2UoaSwgMSk7XHJcblx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gZmFsc2U7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBGdW5jdG9yJGNsZWFyKCkge1xyXG5cdFx0dGhpcy5fZnVuY3MubGVuZ3RoID0gMDtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIEZ1bmN0b3IkaXNFbXB0eShhcmdzKSB7XHJcblx0XHRyZXR1cm4gIXRoaXMuX2Z1bmNzLnNvbWUoZnVuY3Rpb24gKGl0ZW0pIHsgcmV0dXJuIGl0ZW0uYXBwbGllZCAhPT0gdHJ1ZSAmJiAoIWFyZ3MgfHwgIWl0ZW0uZmlsdGVyIHx8IGl0ZW0uZmlsdGVyLmFwcGx5KHRoaXMsIGFyZ3MpKTsgfSwgdGhpcyk7XHJcblx0fVxyXG5cclxuXHR2YXIgZnVuY3RvckV2ZW50c0luUHJvZ3Jlc3MgPSAwO1xyXG5cclxuXHQvLyBidXN5IGlmIHRoZXJlIGFyZSBhbnkgZXZlbnRzIGluIHByb2dyZXNzXHJcblx0cmVnaXN0ZXJBY3Rpdml0eShcIkZ1bmN0b3JcIiwgZnVuY3Rpb24oKSB7XHJcblx0XHRyZXR1cm4gZnVuY3RvckV2ZW50c0luUHJvZ3Jlc3MgPiAwO1xyXG5cdH0pO1xyXG5cclxuXHRGdW5jdG9yLmV2ZW50aW5nID0ge1xyXG5cdFx0X2FkZEV2ZW50OiBmdW5jdGlvbiBGdW5jdG9yJF9hZGRFdmVudChuYW1lLCBmdW5jLCBmaWx0ZXIsIG9uY2UpIHtcclxuXHRcdFx0aWYgKCF0aGlzW1wiX1wiICsgbmFtZV0pIHtcclxuXHRcdFx0XHR0aGlzW1wiX1wiICsgbmFtZV0gPSBuZXcgRnVuY3RvcigpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0aGlzW1wiX1wiICsgbmFtZV0uYWRkKGZ1bmMsIGZpbHRlciwgb25jZSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gZnVuYztcclxuXHRcdH0sXHJcblx0XHRfcmVtb3ZlRXZlbnQ6IGZ1bmN0aW9uIEZ1bmN0b3IkX3JlbW92ZUV2ZW50KG5hbWUsIGZ1bmMpIHtcclxuXHRcdFx0dmFyIGhhbmRsZXIgPSB0aGlzW1wiX1wiICsgbmFtZV07XHJcblx0XHRcdGlmIChoYW5kbGVyKSB7XHJcblx0XHRcdFx0aGFuZGxlci5yZW1vdmUoZnVuYyk7XHJcblx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdH0sXHJcblx0XHRfcmFpc2VFdmVudDogZnVuY3Rpb24gRnVuY3RvciRfcmFpc2VFdmVudChuYW1lLCBhcmdzQXJyYXkpIHtcclxuXHRcdFx0dmFyIGhhbmRsZXIgPSB0aGlzW1wiX1wiICsgbmFtZV07XHJcblx0XHRcdGlmIChoYW5kbGVyKSB7XHJcblx0XHRcdFx0dHJ5IHtcclxuXHRcdFx0XHRcdGZ1bmN0b3JFdmVudHNJblByb2dyZXNzKys7XHJcblx0XHRcdFx0XHRoYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3NBcnJheSB8fCBbXSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGZpbmFsbHkge1xyXG5cdFx0XHRcdFx0ZnVuY3RvckV2ZW50c0luUHJvZ3Jlc3MtLTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRfY2xlYXJFdmVudDogZnVuY3Rpb24gRnVuY3RvciRfY2xlYXJFdmVudChuYW1lKSB7XHJcblx0XHRcdHZhciBldnROYW1lID0gXCJfXCIgKyBuYW1lO1xyXG5cdFx0XHRpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShldnROYW1lKSkge1xyXG5cdFx0XHRcdHRoaXNbZXZ0TmFtZV0gPSBudWxsO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0X2dldEV2ZW50SGFuZGxlcjogZnVuY3Rpb24gRnVuY3RvciRfZ2V0RXZlbnRIYW5kbGVyKG5hbWUpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXNbXCJfXCIgKyBuYW1lXTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRFeG9XZWIuRnVuY3RvciA9IEZ1bmN0b3I7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuRnVuY3Rpb25DaGFpblxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIEZ1bmN0aW9uQ2hhaW4oc3RlcHMsIHRoaXNQdHIpIHtcclxuXHRcdGlmICghKHN0ZXBzIGluc3RhbmNlb2YgQXJyYXkpKSB7XHJcblx0XHRcdHRocm93IG5ldyBBcmd1bWVudFR5cGVFcnJvcihcInN0ZXBzXCIsIFwiYXJyYXlcIiwgc3RlcHMpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuX3N0ZXBzID0gc3RlcHM7XHJcblx0XHR0aGlzLl90aGlzUHRyID0gdGhpc1B0cjtcclxuXHR9XHJcblxyXG5cdEZ1bmN0aW9uQ2hhaW4ucHJlcGFyZSA9IGZ1bmN0aW9uIEZ1bmN0aW9uQ2hhaW4kX2ludm9rZSgpIHtcclxuXHRcdC8vIFJldHVybiBhIGZ1bmN0aW9uIHRoYXQgY2FuIGJlIGludm9rZWQgd2l0aCBjYWxsYmFjayBhbmQgdGhpc1B0ci5cclxuXHRcdC8vIFVzZWZ1bCBmb3IgYXNzaWduaW5nIHRvIGEgcHJvdG90eXBlIG1lbWJlciwgc2luY2UgXCJ0aGlzXCIgaXMgdXNlZFxyXG5cdFx0Ly8gYXMgdGhlIHRoaXNQdHIgZm9yIHRoZSBjaGFpbiBpZiBcInRoaXNQdHJcIiBhcmd1bWVudCBpcyBub3Qgc3VwcGxpZWQsXHJcblx0XHQvLyB3aGlsZSBcInRoaXNQdHJcIiBvZiBpbnZvY2F0aW9uIGlzIHVzZWQgYXMgdGhlIGFyZ3VtZW50IHRvIFwiaW52b2tlXCIuXHJcblxyXG5cdFx0dmFyIHN0ZXBzLFxyXG5cdFx0XHR0aGlzUHRyT3V0ZXIgPSBudWxsO1xyXG5cclxuXHRcdC8vIG5vIGFyZ3MgPT4gZW1wdHkgY2hhaW5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XHJcblx0XHRcdHN0ZXBzID0gW107XHJcblx0XHR9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgYXJndW1lbnRzWzBdIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuXHRcdFx0Ly8gT25lIGFycmF5IGFyZyA9PiBhcnJheSBvZiBzdGVwc1xyXG5cdFx0XHRzdGVwcyA9IGFyZ3VtZW50c1swXTtcclxuXHRcdH0gZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMiAmJiBhcmd1bWVudHNbMF0gaW5zdGFuY2VvZiBBcnJheSkge1xyXG5cdFx0XHQvLyBUd28gYXJncyAoZmlyc3QgYXJyYXkpID0+IGFycmF5IG9mIHN0ZXBzIGFuZCB0aGlzIHBvaW50ZXJcclxuXHRcdFx0c3RlcHMgPSBhcmd1bWVudHNbMF07XHJcblx0XHRcdHRoaXNQdHJPdXRlciA9IGFyZ3VtZW50c1sxXTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdC8vIE90aGVyd2lzZSwgYXNzdW1lIGFyZ3VtZW50cyBjb3JyZXNwb25kIHRvIHN0ZXBzXHJcblx0XHRcdHN0ZXBzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24oY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdFx0dmFyIGNoYWluID0gbmV3IEZ1bmN0aW9uQ2hhaW4oc3RlcHMsIHRoaXNQdHJPdXRlciB8fCB0aGlzKTtcclxuXHRcdFx0Y2hhaW4uaW52b2tlKGNhbGxiYWNrLCB0aGlzUHRyKTtcclxuXHRcdH07XHJcblx0fTtcclxuXHJcblx0RnVuY3Rpb25DaGFpbi5mb3JFYWNoQXN5bmMgPSBmdW5jdGlvbiAoaXRlbXMsIHN0ZXBGdW5jdGlvbiwgY2FsbGJhY2spIHtcclxuXHRcdGlmIChpdGVtcy5sZW5ndGggPT09IDApIHtcclxuXHRcdFx0aWYgKGNhbGxiYWNrKSB7XHJcblx0XHRcdFx0Y2FsbGJhY2soKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIGNoYWluID0gbmV3IEZ1bmN0aW9uQ2hhaW4oaXRlbXMubWFwKGZ1bmN0aW9uIChpdGVtKSB7XHJcblx0XHRcdHJldHVybiBmdW5jdGlvbiAoY2IsIHRoaXNQdHIpIHtcclxuXHRcdFx0XHRzdGVwRnVuY3Rpb24uY2FsbCh0aGlzUHRyIHx8IHRoaXMsIGl0ZW0sIGNiLCB0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdFx0XHR9O1xyXG5cdFx0fSkpO1xyXG5cdFx0Y2hhaW4uaW52b2tlKGNhbGxiYWNrKTtcclxuXHR9O1xyXG5cclxuXHRmdW5jdGlvbiBkb1N0ZXAoaWR4LCBjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0dmFyIG91dGVyQ2FsbGJhY2sgPSBjYWxsYmFjaztcclxuXHRcdHZhciBvdXRlclRoaXNQdHIgPSB0aGlzUHRyO1xyXG5cdFx0dmFyIG5leHRTdGVwID0gaWR4ICsgMSA8IHRoaXMuX3N0ZXBzLmxlbmd0aCA/XHJcblx0XHRcdGRvU3RlcC5wcmVwZW5kQXJndW1lbnRzKGlkeCArIDEsIG91dGVyQ2FsbGJhY2ssIG91dGVyVGhpc1B0cikuYmluZCh0aGlzKSA6XHJcblx0XHRcdGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdGlmIChvdXRlckNhbGxiYWNrICYmIG91dGVyQ2FsbGJhY2sgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG5cdFx0XHRcdFx0b3V0ZXJDYWxsYmFjay5hcHBseShvdXRlclRoaXNQdHIgfHwgdGhpcywgYXJndW1lbnRzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH07XHJcblxyXG5cdFx0dGhpcy5fc3RlcHNbaWR4XS5jYWxsKHRoaXMuX3RoaXNQdHIgfHwgdGhpcywgbmV4dFN0ZXApO1xyXG5cdH1cclxuXHJcblx0RnVuY3Rpb25DaGFpbi5taXhpbih7XHJcblx0XHRpbnZva2U6IGZ1bmN0aW9uKGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRcdGRvU3RlcC5jYWxsKHRoaXMsIDAsIGNhbGxiYWNrLCB0aGlzUHRyKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0RXhvV2ViLkZ1bmN0aW9uQ2hhaW4gPSBGdW5jdGlvbkNoYWluO1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLkV2ZW50U2NvcGVcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHR2YXIgY3VycmVudEV2ZW50U2NvcGUgPSBudWxsO1xyXG5cclxuXHRmdW5jdGlvbiBFdmVudFNjb3BlKCkge1xyXG5cdFx0Ly8gSWYgdGhlcmUgaXMgYSBjdXJyZW50IGV2ZW50IHNjb3BlXHJcblx0XHQvLyB0aGVuIGl0IHdpbGwgYmUgdGhlIHBhcmVudCBvZiB0aGUgbmV3IGV2ZW50IHNjb3BlXHJcblx0XHR2YXIgcGFyZW50ID0gY3VycmVudEV2ZW50U2NvcGU7XHJcblxyXG5cdFx0Ly8gRGVmaW5lIHRoZSBwYXJlbnQgcHJvcGVydHlcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInBhcmVudFwiLCB7IHZhbHVlOiBwYXJlbnQgfSk7XHJcblxyXG5cdFx0Ly8gRGVmaW5lIHRoZSBpc0FjdGl2ZSBwcm9wZXJ0eVxyXG5cdFx0dGhpcy5pc0FjdGl2ZSA9IHRydWU7XHJcblxyXG5cdFx0Ly8gU2V0IHRoaXMgdG8gYmUgdGhlIGN1cnJlbnQgZXZlbnQgc2NvcGVcclxuXHRcdGN1cnJlbnRFdmVudFNjb3BlID0gdGhpcztcclxuXHR9XHJcblxyXG5cdEV2ZW50U2NvcGUubWl4aW4oRnVuY3Rvci5ldmVudGluZyk7XHJcblxyXG5cdEV2ZW50U2NvcGUubWl4aW4oe1xyXG5cdFx0YWJvcnQ6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0aWYgKCF0aGlzLmlzQWN0aXZlKSB7XHJcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiVGhlIGV2ZW50IHNjb3BlIGNhbm5vdCBiZSBhYm9ydGVkIGJlY2F1c2UgaXQgaXMgbm90IGFjdGl2ZS5cIik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRyeSB7XHJcblx0XHRcdFx0dmFyIGFib3J0SGFuZGxlciA9IHRoaXMuX2dldEV2ZW50SGFuZGxlcihcImFib3J0XCIpO1xyXG5cdFx0XHRcdGlmIChhYm9ydEhhbmRsZXIgJiYgIWFib3J0SGFuZGxlci5pc0VtcHR5KCkpIHtcclxuXHRcdFx0XHRcdC8vIEludm9rZSBhbGwgc3Vic2NyaWJlcnNcclxuXHRcdFx0XHRcdGFib3J0SGFuZGxlcigpO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gQ2xlYXIgdGhlIGV2ZW50cyB0byBlbnN1cmUgdGhhdCB0aGV5IGFyZW4ndFxyXG5cdFx0XHRcdC8vIGluYWR2ZXJ0YW50bHkgcmFpc2VkIGFnYWluIHRocm91Z2ggdGhpcyBzY29wZVxyXG5cdFx0XHRcdHRoaXMuX2NsZWFyRXZlbnQoXCJhYm9ydFwiKTtcclxuXHRcdFx0XHR0aGlzLl9jbGVhckV2ZW50KFwiZXhpdFwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRmaW5hbGx5IHtcclxuXHRcdFx0XHQvLyBUaGUgZXZlbnQgc2NvcGUgaXMgbm8gbG9uZ2VyIGFjdGl2ZVxyXG5cdFx0XHRcdHRoaXMuaXNBY3RpdmUgPSBmYWxzZTtcclxuXHJcblx0XHRcdFx0aWYgKGN1cnJlbnRFdmVudFNjb3BlICYmIGN1cnJlbnRFdmVudFNjb3BlID09PSB0aGlzKSB7XHJcblx0XHRcdFx0XHQvLyBSb2xsIGJhY2sgdG8gdGhlIGNsb3Nlc3QgYWN0aXZlIHNjb3BlXHJcblx0XHRcdFx0XHR3aGlsZSAoY3VycmVudEV2ZW50U2NvcGUgJiYgIWN1cnJlbnRFdmVudFNjb3BlLmlzQWN0aXZlKSB7XHJcblx0XHRcdFx0XHRcdGN1cnJlbnRFdmVudFNjb3BlID0gY3VycmVudEV2ZW50U2NvcGUucGFyZW50O1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdGV4aXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRpZiAoIXRoaXMuaXNBY3RpdmUpIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJUaGUgZXZlbnQgc2NvcGUgY2Fubm90IGJlIGV4aXRlZCBiZWNhdXNlIGl0IGlzIG5vdCBhY3RpdmUuXCIpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0cnkge1xyXG5cdFx0XHRcdHZhciBleGl0SGFuZGxlciA9IHRoaXMuX2dldEV2ZW50SGFuZGxlcihcImV4aXRcIik7XHJcblx0XHRcdFx0aWYgKGV4aXRIYW5kbGVyICYmICFleGl0SGFuZGxlci5pc0VtcHR5KCkpIHtcclxuXHJcblx0XHRcdFx0XHQvLyBJZiB0aGVyZSBpcyBubyBwYXJlbnQgc2NvcGUsIHRoZW4gZ28gYWhlYWQgYW5kIGV4ZWN1dGUgdGhlICdleGl0JyBldmVudFxyXG5cdFx0XHRcdFx0aWYgKHRoaXMucGFyZW50ID09PSBudWxsIHx8ICF0aGlzLnBhcmVudC5pc0FjdGl2ZSkge1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gUmVjb3JkIHRoZSBpbml0aWFsIHZlcnNpb24gYW5kIGluaXRpYWwgbnVtYmVyIG9mIHN1YnNjcmliZXJzXHJcblx0XHRcdFx0XHRcdHRoaXMuX2V4aXRFdmVudFZlcnNpb24gPSAwO1xyXG5cdFx0XHRcdFx0XHR0aGlzLl9leGl0RXZlbnRIYW5kbGVyQ291bnQgPSBleGl0SGFuZGxlci5fZnVuY3MubGVuZ3RoO1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gSW52b2tlIGFsbCBzdWJzY3JpYmVyc1xyXG5cdFx0XHRcdFx0XHRleGl0SGFuZGxlcigpO1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gRGVsZXRlIHRoZSBmaWVsZHMgdG8gaW5kaWNhdGUgdGhhdCByYWlzaW5nIHRoZSBleGl0IGV2ZW50IHN1Y2VlZGVkXHJcblx0XHRcdFx0XHRcdGRlbGV0ZSB0aGlzLl9leGl0RXZlbnRIYW5kbGVyQ291bnQ7XHJcblx0XHRcdFx0XHRcdGRlbGV0ZSB0aGlzLl9leGl0RXZlbnRWZXJzaW9uO1xyXG5cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mIHdpbmRvdy5FeG9XZWIuY29uZmlnLm5vbkV4aXRpbmdTY29wZU5lc3RpbmdDb3VudCA9PT0gXCJudW1iZXJcIikge1xyXG5cdFx0XHRcdFx0XHRcdHZhciBtYXhOZXN0aW5nID0gd2luZG93LkV4b1dlYi5jb25maWcubm9uRXhpdGluZ1Njb3BlTmVzdGluZ0NvdW50IC0gMTtcclxuXHRcdFx0XHRcdFx0XHRpZiAodGhpcy5wYXJlbnQuaGFzT3duUHJvcGVydHkoXCJfZXhpdEV2ZW50VmVyc2lvblwiKSAmJiB0aGlzLnBhcmVudC5fZXhpdEV2ZW50VmVyc2lvbiA+PSBtYXhOZXN0aW5nKSB7XHJcblx0XHRcdFx0XHRcdFx0XHR0aGlzLmFib3J0KCk7XHJcblx0XHRcdFx0XHRcdFx0XHRsb2dXYXJuaW5nKFwiRXZlbnQgc2NvcGUgJ2V4aXQnIHN1YnNjcmliZXJzIHdlcmUgZGlzY2FyZGVkIGR1ZSB0byBub24tZXhpdGluZy5cIik7XHJcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBNb3ZlIHN1YnNjcmliZXJzIHRvIHRoZSBwYXJlbnQgc2NvcGVcclxuXHRcdFx0XHRcdFx0dGhpcy5wYXJlbnQuX2FkZEV2ZW50KFwiZXhpdFwiLCBleGl0SGFuZGxlcik7XHJcblxyXG5cdFx0XHRcdFx0XHRpZiAodGhpcy5wYXJlbnQuaGFzT3duUHJvcGVydHkoXCJfZXhpdEV2ZW50VmVyc2lvblwiKSkge1xyXG5cdFx0XHRcdFx0XHRcdHRoaXMucGFyZW50Ll9leGl0RXZlbnRWZXJzaW9uKys7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyBDbGVhciB0aGUgZXZlbnRzIHRvIGVuc3VyZSB0aGF0IHRoZXkgYXJlbid0XHJcblx0XHRcdFx0XHQvLyBpbmFkdmVydGFudGx5IHJhaXNlZCBhZ2FpbiB0aHJvdWdoIHRoaXMgc2NvcGVcclxuXHRcdFx0XHRcdHRoaXMuX2NsZWFyRXZlbnQoXCJleGl0XCIpO1xyXG5cdFx0XHRcdFx0dGhpcy5fY2xlYXJFdmVudChcImFib3J0XCIpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRmaW5hbGx5IHtcclxuXHRcdFx0XHQvLyBUaGUgZXZlbnQgc2NvcGUgaXMgbm8gbG9uZ2VyIGFjdGl2ZVxyXG5cdFx0XHRcdHRoaXMuaXNBY3RpdmUgPSBmYWxzZTtcclxuXHJcblx0XHRcdFx0aWYgKGN1cnJlbnRFdmVudFNjb3BlICYmIGN1cnJlbnRFdmVudFNjb3BlID09PSB0aGlzKSB7XHJcblx0XHRcdFx0XHQvLyBSb2xsIGJhY2sgdG8gdGhlIGNsb3Nlc3QgYWN0aXZlIHNjb3BlXHJcblx0XHRcdFx0XHR3aGlsZSAoY3VycmVudEV2ZW50U2NvcGUgJiYgIWN1cnJlbnRFdmVudFNjb3BlLmlzQWN0aXZlKSB7XHJcblx0XHRcdFx0XHRcdGN1cnJlbnRFdmVudFNjb3BlID0gY3VycmVudEV2ZW50U2NvcGUucGFyZW50O1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHRmdW5jdGlvbiBFdmVudFNjb3BlJG9uRXhpdChjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0aWYgKGN1cnJlbnRFdmVudFNjb3BlID09PSBudWxsKSB7XHJcblx0XHRcdC8vIEltbWVkaWF0ZWx5IGludm9rZSB0aGUgY2FsbGJhY2tcclxuXHRcdFx0aWYgKHRoaXNQdHIpIHtcclxuXHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdGNhbGxiYWNrKCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKCFjdXJyZW50RXZlbnRTY29wZS5pc0FjdGl2ZSkge1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJUaGUgY3VycmVudCBldmVudCBzY29wZSBjYW5ub3QgYmUgaW5hY3RpdmUuXCIpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdC8vIFN1YnNjcmliZSB0byB0aGUgZXhpdCBldmVudFxyXG5cdFx0XHRjdXJyZW50RXZlbnRTY29wZS5fYWRkRXZlbnQoXCJleGl0XCIsIGNhbGxiYWNrLmJpbmQodGhpc1B0cikpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gRXZlbnRTY29wZSRvbkFib3J0KGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRpZiAoY3VycmVudEV2ZW50U2NvcGUgIT09IG51bGwpIHtcclxuXHRcdFx0aWYgKCFjdXJyZW50RXZlbnRTY29wZS5pc0FjdGl2ZSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIlRoZSBjdXJyZW50IGV2ZW50IHNjb3BlIGNhbm5vdCBiZSBpbmFjdGl2ZS5cIik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIFN1YnNjcmliZSB0byB0aGUgYWJvcnQgZXZlbnRcclxuXHRcdFx0Y3VycmVudEV2ZW50U2NvcGUuX2FkZEV2ZW50KFwiYWJvcnRcIiwgY2FsbGJhY2suYmluZCh0aGlzUHRyKSk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBFdmVudFNjb3BlJHBlcmZvcm0oY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdC8vIENyZWF0ZSBhbiBldmVudCBzY29wZVxyXG5cdFx0dmFyIHNjb3BlID0gbmV3IEV2ZW50U2NvcGUoKTtcclxuXHRcdHRyeSB7XHJcblx0XHRcdC8vIEludm9rZSB0aGUgY2FsbGJhY2tcclxuXHRcdFx0aWYgKHRoaXNQdHIpIHtcclxuXHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdGNhbGxiYWNrKCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGZpbmFsbHkge1xyXG5cdFx0XHQvLyBFeGl0IHRoZSBldmVudCBzY29wZVxyXG5cdFx0XHRzY29wZS5leGl0KCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvLyBFeHBvcnQgcHVibGljIGZ1bmN0aW9uc1xyXG5cdHZhciBldmVudFNjb3BlQXBpID0ge1xyXG5cdFx0b25FeGl0OiBFdmVudFNjb3BlJG9uRXhpdCxcclxuXHRcdG9uQWJvcnQ6IEV2ZW50U2NvcGUkb25BYm9ydCxcclxuXHRcdHBlcmZvcm06IEV2ZW50U2NvcGUkcGVyZm9ybVxyXG5cdH07XHJcblxyXG5cdEV4b1dlYi5FdmVudFNjb3BlID0gZXZlbnRTY29wZUFwaTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5FdmFsV3JhcHBlclxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdC8vIEhlbHBlciBjbGFzcyBmb3IgaW50ZXJwcmV0aW5nIGV4cHJlc3Npb25zXHJcblx0ZnVuY3Rpb24gRXZhbFdyYXBwZXIodmFsdWUpIHtcclxuXHRcdHRoaXMudmFsdWUgPSB2YWx1ZTtcclxuXHR9XHJcblxyXG5cdEV2YWxXcmFwcGVyLm1peGluKHtcclxuXHRcdGdldDogZnVuY3Rpb24gRXZhbFdyYXBwZXIkZ2V0KG1lbWJlcikge1xyXG5cdFx0XHR2YXIgcHJvcFZhbHVlID0gZ2V0VmFsdWUodGhpcy52YWx1ZSwgbWVtYmVyKTtcclxuXHJcblx0XHRcdGlmIChwcm9wVmFsdWUgPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdHByb3BWYWx1ZSA9IHdpbmRvd1ttZW1iZXJdO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAocHJvcFZhbHVlID09PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKG1lbWJlciArIFwiIGlzIHVuZGVmaW5lZFwiKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIG5ldyBFdmFsV3JhcHBlcihwcm9wVmFsdWUpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHRFeG9XZWIuRXZhbFdyYXBwZXIgPSBFdmFsV3JhcHBlcjtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5UcmFuc2Zvcm1cclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHRmdW5jdGlvbiBUcmFuc2Zvcm0oYXJyYXksIGZvckxpdmUpIHtcclxuXHRcdGlmIChhcnJheSA9PSBudWxsKSB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXJyb3IoXCJhcnJheVwiLCBcInRyYW5zZm9ybSBpbnB1dCBpcyByZXF1aXJlZFwiKTtcclxuXHRcdGlmICghKGFycmF5IGluc3RhbmNlb2YgQXJyYXkpKSB0aHJvdyBuZXcgQXJndW1lbnRUeXBlRXJyb3IoXCJhcnJheVwiLCBcImFycmF5XCIsIGFycmF5KTtcclxuXHJcblx0XHR0aGlzLl9hcnJheSA9IGFycmF5O1xyXG5cdFx0dGhpcy5yb290SW5wdXQgPSBhcnJheTtcclxuXHRcdGlmIChmb3JMaXZlID09PSB0cnVlKSB7XHJcblx0XHRcdHRoaXMuX2xpdmVQZW5kaW5nID0gdHJ1ZTtcclxuXHRcdFx0dGhpcy5fbGl2ZUNvbXBsZXRlID0gZmFsc2U7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBUcmFuc2Zvcm1Hcm91cChncm91cCwgaXRlbXMpIHtcclxuXHRcdHRoaXMuZ3JvdXAgPSBncm91cDtcclxuXHRcdHRoaXMuaXRlbXMgPSBpdGVtcztcclxuXHR9XHJcblxyXG5cdHZhciBjb21waWxlRmlsdGVyRnVuY3Rpb24gPSAoZnVuY3Rpb24gVHJhbnNmb3JtJGNvbXBpbGVGaWx0ZXJGdW5jdGlvbihmaWx0ZXIpIHtcclxuXHRcdHZhciBwYXJzZXIgPSAvKChbYS16XyRdWzAtOWEtel8kXSopKFsuXT8pKXwoKCcoW14nXXxcXCcpKicpfChcIihbXlwiXXxcXFwiKSpcIikpL2dpO1xyXG5cdFx0dmFyIHNraXBXb3JkcyA9IFtcInRydWVcIiwgXCJmYWxzZVwiLCBcIiRpbmRleFwiLCBcIm51bGxcIl07XHJcblxyXG5cdFx0ZmlsdGVyID0gZmlsdGVyLnJlcGxhY2UocGFyc2VyLCBmdW5jdGlvbiAobWF0Y2gsIGlnbm9yZWQsIG5hbWUsIG1vcmUsIHN0ckxpdGVyYWwpIHtcclxuXHRcdFx0aWYgKChzdHJMaXRlcmFsICE9PSB1bmRlZmluZWQgJiYgc3RyTGl0ZXJhbCAhPT0gbnVsbCAmJiBzdHJMaXRlcmFsLmxlbmd0aCA+IDApIHx8IHNraXBXb3Jkcy5pbmRleE9mKG5hbWUpID49IDApIHtcclxuXHRcdFx0XHRyZXR1cm4gbWF0Y2g7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChuYW1lID09PSBcIiRpdGVtXCIpIHtcclxuXHRcdFx0XHRyZXR1cm4gbW9yZSA/IFwiXCIgOiBuYW1lO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAobW9yZS5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0cmV0dXJuIFwiZ2V0KCdcIiArIG5hbWUgKyBcIicpXCIgKyBtb3JlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZXR1cm4gXCJnZXQoJ1wiICsgbmFtZSArIFwiJykudmFsdWVcIjtcclxuXHRcdH0pO1xyXG5cclxuXHRcdHJldHVybiBuZXcgRnVuY3Rpb24oXCIkaXRlbVwiLCBcIiRpbmRleFwiLCBcIndpdGgobmV3IEV4b1dlYi5FdmFsV3JhcHBlcigkaXRlbSkpeyByZXR1cm4gKFwiICsgZmlsdGVyICsgXCIpO31cIik7XHJcblx0fSkuY2FjaGVkKCk7XHJcblxyXG5cdHZhciBjb21waWxlU2VsZWN0RnVuY3Rpb24gPSAoZnVuY3Rpb24gVHJhbnNmb3JtJGNvbXBpbGVTZWxlY3RGdW5jdGlvbihzZWxlY3Rvcikge1xyXG5cdFx0cmV0dXJuIG5ldyBGdW5jdGlvbihcIiRpdGVtXCIsIFwiJGluZGV4XCIsIFwicmV0dXJuIEV4b1dlYi5ldmFsUGF0aCgkaXRlbSwgJ1wiICsgc2VsZWN0b3IgKyBcIicpO1wiKTtcclxuXHR9KS5jYWNoZWQoKTtcclxuXHJcblx0dmFyIGNvbXBpbGVTZWxlY3RNYW55RnVuY3Rpb24gPSAoZnVuY3Rpb24gVHJhbnNmb3JtJGNvbXBpbGVTZWxlY3RNYW55RnVuY3Rpb24oc2VsZWN0b3IpIHtcclxuXHRcdHJldHVybiBuZXcgRnVuY3Rpb24oXCIkaXRlbVwiLCBcIiRpbmRleFwiLCBcInJldHVybiBFeG9XZWIuZXZhbFBhdGgoJGl0ZW0sICdcIiArIHNlbGVjdG9yICsgXCInKTtcIik7XHJcblx0fSkuY2FjaGVkKCk7XHJcblxyXG5cdHZhciBjb21waWxlR3JvdXBzRnVuY3Rpb24gPSAoZnVuY3Rpb24gVHJhbnNmb3JtJGNvbXBpbGVHcm91cHNGdW5jdGlvbihncm91cHMpIHtcclxuXHRcdHJldHVybiBuZXcgRnVuY3Rpb24oXCIkaXRlbVwiLCBcIiRpbmRleFwiLCBcInJldHVybiBFeG9XZWIuZXZhbFBhdGgoJGl0ZW0sICdcIiArIGdyb3VwcyArIFwiJyk7XCIpO1xyXG5cdH0pLmNhY2hlZCgpO1xyXG5cclxuXHR2YXIgY29tcGlsZU9yZGVyaW5nRnVuY3Rpb24gPSAoZnVuY3Rpb24gVHJhbnNmb3JtJGNvbXBpbGVPcmRlcmluZ0Z1bmN0aW9uKG9yZGVyaW5nKSB7XHJcblx0XHR2YXIgb3JkZXJpbmdzID0gW107XHJcblx0XHR2YXIgcGFyc2VyID0gL1xccyooW2EtejAtOV8uXSspKFxccytudWxsKT8oXFxzKyhhc2N8ZGVzYykpPyhcXHMrbnVsbCk/ICooLHwkKS9naTtcclxuXHJcblx0XHRvcmRlcmluZy5yZXBsYWNlKHBhcnNlciwgZnVuY3Rpb24gKG1hdGNoLCBwYXRoLCBudWxsc0ZpcnN0LCB3cywgZGlyLCBudWxsc0xhc3QpIHtcclxuXHRcdFx0dmFyIGlzTnVsbHNGaXJzdCA9IChudWxsc0ZpcnN0ICE9PSB1bmRlZmluZWQgJiYgbnVsbHNGaXJzdCAhPT0gbnVsbCAmJiBudWxsc0ZpcnN0Lmxlbmd0aCA+IDApO1xyXG5cdFx0XHR2YXIgaXNOdWxsc0xhc3QgPSAobnVsbHNMYXN0ICE9PSB1bmRlZmluZWQgJiYgbnVsbHNMYXN0ICE9PSBudWxsICYmIG51bGxzTGFzdC5sZW5ndGggPiAwKTtcclxuXHRcdFx0b3JkZXJpbmdzLnB1c2goe1xyXG5cdFx0XHRcdHBhdGg6IHBhdGgsXHJcblx0XHRcdFx0YWI6IGRpciA9PT0gXCJkZXNjXCIgPyAxIDogLTEsXHJcblx0XHRcdFx0bnVsbHM6IGlzTnVsbHNMYXN0IHx8ICghd3MgJiYgaXNOdWxsc0ZpcnN0KSA/IDEgOiAtMVxyXG5cdFx0XHR9KTtcclxuXHRcdH0pO1xyXG5cclxuXHRcdGZ1bmN0aW9uIGJlZm9yZShhLCBiKSB7XHJcblx0XHRcdGlmIChhICE9PSBudWxsICYmIGEgIT09IHVuZGVmaW5lZCAmJiBhLmNvbnN0cnVjdG9yID09PSBTdHJpbmcgJiYgYiAhPT0gbnVsbCAmJiBiICE9PSB1bmRlZmluZWQgJiYgYi5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XHJcblx0XHRcdFx0YSA9IGEudG9Mb3dlckNhc2UoKTtcclxuXHRcdFx0XHRiID0gYi50b0xvd2VyQ2FzZSgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiBhIDwgYjtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24gY29tcGFyZShhT2JqLCBiT2JqKSB7XHJcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgb3JkZXJpbmdzLmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdFx0dmFyIG9yZGVyID0gb3JkZXJpbmdzW2ldO1xyXG5cclxuXHRcdFx0XHR2YXIgYSA9IGV2YWxQYXRoKGFPYmosIG9yZGVyLnBhdGgsIG51bGwsIG51bGwpO1xyXG5cdFx0XHRcdHZhciBiID0gZXZhbFBhdGgoYk9iaiwgb3JkZXIucGF0aCwgbnVsbCwgbnVsbCk7XHJcblxyXG5cdFx0XHRcdGlmIChhID09PSBudWxsICYmIGIgIT09IG51bGwpIHtcclxuXHRcdFx0XHRcdHJldHVybiBvcmRlci5udWxscztcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKGEgIT09IG51bGwgJiYgYiA9PT0gbnVsbCkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIC1vcmRlci5udWxscztcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKGJlZm9yZShhLCBiKSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIG9yZGVyLmFiO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAoYmVmb3JlKGIsIGEpKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gLW9yZGVyLmFiO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIDA7XHJcblx0XHR9O1xyXG5cdH0pLmNhY2hlZCgpO1xyXG5cclxuXHR2YXIgdHJhbnNmb3JtcyA9IHtcclxuXHRcdHdoZXJlOiBmdW5jdGlvbiB3aGVyZShpbnB1dCwgZmlsdGVyLCB0aGlzUHRyKSB7XHJcblx0XHRcdHZhciBmaWx0ZXJGbiA9IGZpbHRlciBpbnN0YW5jZW9mIEZ1bmN0aW9uID8gZmlsdGVyIDogY29tcGlsZUZpbHRlckZ1bmN0aW9uKGZpbHRlcik7XHJcblx0XHRcdHJldHVybiBpbnB1dC5maWx0ZXIoZmlsdGVyRm4sIHRoaXNQdHIpO1xyXG5cdFx0fSxcclxuXHRcdHNlbGVjdDogZnVuY3Rpb24gc2VsZWN0KGlucHV0LCBzZWxlY3RvciwgdGhpc1B0cikge1xyXG5cdFx0XHR2YXIgbWFwRm4gPSBzZWxlY3RvciBpbnN0YW5jZW9mIEZ1bmN0aW9uID8gc2VsZWN0b3IgOiBjb21waWxlU2VsZWN0RnVuY3Rpb24oc2VsZWN0b3IpO1xyXG5cdFx0XHRyZXR1cm4gaW5wdXQubWFwKG1hcEZuLCB0aGlzUHRyKTtcclxuXHRcdH0sXHJcblx0XHRzZWxlY3RNYW55OiBmdW5jdGlvbiBzZWxlY3QoaW5wdXQsIHNlbGVjdG9yLCB0aGlzUHRyKSB7XHJcblx0XHRcdHZhciBtYXBGbiA9IHNlbGVjdG9yIGluc3RhbmNlb2YgRnVuY3Rpb24gPyBzZWxlY3RvciA6IGNvbXBpbGVTZWxlY3RGdW5jdGlvbihzZWxlY3Rvcik7XHJcblx0XHRcdHJldHVybiBpbnB1dC5tYXBUb0FycmF5KG1hcEZuLCB0aGlzUHRyKTtcclxuXHRcdH0sXHJcblx0XHRncm91cEJ5OiBmdW5jdGlvbiBncm91cEJ5KGlucHV0LCBncm91cHMsIHRoaXNQdHIpIHtcclxuXHRcdFx0dmFyIGdyb3VwRm4gPSBncm91cHMgaW5zdGFuY2VvZiBGdW5jdGlvbiA/IGdyb3VwcyA6IGNvbXBpbGVHcm91cHNGdW5jdGlvbihncm91cHMpO1xyXG5cclxuXHRcdFx0dmFyIHJlc3VsdCA9IFtdO1xyXG5cdFx0XHR2YXIgbGVuID0gaW5wdXQubGVuZ3RoO1xyXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XHJcblx0XHRcdFx0dmFyIGl0ZW0gPSBpbnB1dFtpXTtcclxuXHRcdFx0XHR2YXIgZ3JvdXBLZXkgPSBncm91cEZuLmFwcGx5KHRoaXNQdHIgfHwgaXRlbSwgW2l0ZW0sIGldKTtcclxuXHJcblx0XHRcdFx0dmFyIGdyb3VwID0gbnVsbDtcclxuXHRcdFx0XHRmb3IgKHZhciBnID0gMDsgZyA8IHJlc3VsdC5sZW5ndGg7ICsrZykge1xyXG5cdFx0XHRcdFx0aWYgKHJlc3VsdFtnXS5ncm91cCA9PSBncm91cEtleSkge1xyXG5cdFx0XHRcdFx0XHRncm91cCA9IHJlc3VsdFtnXTtcclxuXHRcdFx0XHRcdFx0Z3JvdXAuaXRlbXMucHVzaChpdGVtKTtcclxuXHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRpZiAoIWdyb3VwKSB7XHJcblx0XHRcdFx0XHRyZXN1bHQucHVzaChuZXcgVHJhbnNmb3JtR3JvdXAoZ3JvdXBLZXksIFtpdGVtXSkpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdH0sXHJcblx0XHRvcmRlckJ5OiBmdW5jdGlvbiBvcmRlckJ5KGlucHV0LCBvcmRlcmluZywgdGhpc1B0cikge1xyXG5cdFx0XHR2YXIgc29ydEZuID0gb3JkZXJpbmcgaW5zdGFuY2VvZiBGdW5jdGlvbiA/IG9yZGVyaW5nIDogY29tcGlsZU9yZGVyaW5nRnVuY3Rpb24ob3JkZXJpbmcpO1xyXG5cdFx0XHRyZXR1cm4gaW5wdXQuY29weSgpLnNvcnQodGhpc1B0ciA/IHNvcnRGbi5iaW5kKHRoaXNQdHIpIDogc29ydEZuKTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRmdW5jdGlvbiBjb3B5VHJhbnNmb3JtKHN0ZXBzLCBhcnJheSwgbGl2ZSkge1xyXG5cdFx0dmFyIHJlc3VsdCA9ICR0cmFuc2Zvcm0oYXJyYXksIGxpdmUpO1xyXG5cdFx0c3RlcHMuZm9yRWFjaChmdW5jdGlvbiAoc3RlcCkge1xyXG5cdFx0XHRyZXN1bHQgPSByZXN1bHRbc3RlcC5fdHJhbnNmb3JtLm1ldGhvZF0uY2FsbChyZXN1bHQsIHN0ZXAuX3RyYW5zZm9ybS5hcmcsIHN0ZXAuX3RyYW5zZm9ybS50aGlzUHRyKVxyXG5cdFx0fSk7XHJcblx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gbWFrZVRyYW5zZm9ybShhcnJheSwgcHJpb3JUcmFuc2Zvcm0sIG1ldGhvZCwgYXJnLCB0aGlzUHRyKSB7XHJcblx0XHQvLyBNYWtlIHN1cmUgdGhhdCB0aGUgc2FtZSB0cmFuc2Zvcm0gaXMgbm90IG1hZGUgbGl2ZSBtb3JlIHRoYW4gb25jZSBzaW5jZSB0aGlzIGNhbiBjYXVzZSBjb2xsaXNpb25zLlxyXG5cdFx0aWYgKHByaW9yVHJhbnNmb3JtLl9saXZlQ29tcGxldGUgPT09IHRydWUpIHtcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGNhbGwgbGl2ZSBvbiB0aGUgc2FtZSB0cmFuc2Zvcm0gbXVsdGlwbGUgdGltZXMuXCIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciByZXN1bHQ7XHJcblxyXG5cdFx0Ly8gV2hlbiBjcmVhdGluZyBhIGxpdmUgdHJhbnNmb3JtLCB0aGUgcmVzdWx0IGNhbm5vdCBiZSB1c2VkIGRpcmVjdGx5IGFzIGFuIGFycmF5IHRvXHJcblx0XHQvLyBkaXNjb3VyYWdlIHVzaW5nIHBhcnQgb2YgdGhlIHJlc3VsdCB3aGVuIHRoZSBpbnRlbnRpb24gaXMgdG8gZXZlbnR1YWxseSBjYWxsIFwibGl2ZVwiLlxyXG5cdFx0Ly8gV2hlbiBsaXZlIG1vZGUgaXMgbm90IHVzZWQsIHRoZW4gaWYgbGl2ZSBpcyBldmVudHVhbGx5IGNhbGxlZCBpdCB3aWxsIHJlc3VsdCBpbiBhIG5vbi1vcHRpbWFsXHJcblx0XHQvLyBjb3B5aW5nIG9mIHRoZSB0cmFuc2Zvcm0uXHJcblx0XHRpZiAocHJpb3JUcmFuc2Zvcm0uX2xpdmVQZW5kaW5nID09PSB0cnVlKSB7XHJcblx0XHRcdHJlc3VsdCA9IG5ldyBUcmFuc2Zvcm0oYXJyYXksIHRydWUpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdEZ1bmN0aW9uLm1peGluKFRyYW5zZm9ybS5wcm90b3R5cGUsIGFycmF5KTtcclxuXHRcdFx0cmVzdWx0ID0gYXJyYXk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmVzdWx0Ll9wcmlvciA9IHByaW9yVHJhbnNmb3JtO1xyXG5cdFx0cmVzdWx0LnJvb3RJbnB1dCA9IHByaW9yVHJhbnNmb3JtLnJvb3RJbnB1dDtcclxuXHRcdHJlc3VsdC5fdHJhbnNmb3JtID0geyBtZXRob2Q6IG1ldGhvZCwgYXJnOiBhcmcsIHRoaXNQdHI6IHRoaXNQdHIgfTtcclxuXHRcdHJldHVybiByZXN1bHQ7XHJcblx0fVxyXG5cclxuXHRUcmFuc2Zvcm0ubWl4aW4oe1xyXG5cdFx0aW5wdXQ6IGZ1bmN0aW9uIFRyYW5zZm9ybSRpbnB1dCgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2FycmF5IHx8IHRoaXM7XHJcblx0XHR9LFxyXG5cdFx0d2hlcmU6IGZ1bmN0aW9uIFRyYW5zZm9ybSR3aGVyZShmaWx0ZXIsIHRoaXNQdHIpIHtcclxuXHRcdFx0dmFyIG91dHB1dCA9IHRyYW5zZm9ybXMud2hlcmUodGhpcy5pbnB1dCgpLCBmaWx0ZXIsIHRoaXNQdHIpO1xyXG5cdFx0XHRyZXR1cm4gbWFrZVRyYW5zZm9ybShvdXRwdXQsIHRoaXMsIFwid2hlcmVcIiwgZmlsdGVyLCB0aGlzUHRyKTtcclxuXHRcdH0sXHJcblx0XHRzZWxlY3Q6IGZ1bmN0aW9uIFRyYW5zZm9ybSRzZWxlY3Qoc2VsZWN0b3IsIHRoaXNQdHIpIHtcclxuXHRcdFx0dmFyIG91dHB1dCA9IHRyYW5zZm9ybXMuc2VsZWN0KHRoaXMuaW5wdXQoKSwgc2VsZWN0b3IsIHRoaXNQdHIpO1xyXG5cdFx0XHRyZXR1cm4gbWFrZVRyYW5zZm9ybShvdXRwdXQsIHRoaXMsIFwic2VsZWN0XCIsIHNlbGVjdG9yLCB0aGlzUHRyKTtcclxuXHRcdH0sXHJcblx0XHRzZWxlY3RNYW55OiBmdW5jdGlvbiBUcmFuc2Zvcm0kc2VsZWN0TWFueShzZWxlY3RvciwgdGhpc1B0cikge1xyXG5cdFx0XHR2YXIgb3V0cHV0ID0gdHJhbnNmb3Jtcy5zZWxlY3RNYW55KHRoaXMuaW5wdXQoKSwgc2VsZWN0b3IsIHRoaXNQdHIpO1xyXG5cdFx0XHRyZXR1cm4gbWFrZVRyYW5zZm9ybShvdXRwdXQsIHRoaXMsIFwic2VsZWN0TWFueVwiLCBzZWxlY3RvciwgdGhpc1B0cik7XHJcblx0XHR9LFxyXG5cdFx0Z3JvdXBCeTogZnVuY3Rpb24gVHJhbnNmb3JtJGdyb3VwQnkoZ3JvdXBzLCB0aGlzUHRyKSB7XHJcblx0XHRcdHZhciBvdXRwdXQgPSB0cmFuc2Zvcm1zLmdyb3VwQnkodGhpcy5pbnB1dCgpLCBncm91cHMsIHRoaXNQdHIpO1xyXG5cdFx0XHRpZiAodGhpcy5fbGl2ZVBlbmRpbmcpIHtcclxuXHRcdFx0XHQvLyBtYWtlIHRoZSBpdGVtcyBhcnJheSBvYnNlcnZhYmxlIGlmIHRoZSB0cmFuc2Zvcm0gaXMgaW4gbGl2ZSBtb2RlXHJcblx0XHRcdFx0b3V0cHV0LmZvckVhY2goZnVuY3Rpb24gKGdyb3VwKSB7XHJcblx0XHRcdFx0XHRFeG9XZWIuT2JzZXJ2ZXIubWFrZU9ic2VydmFibGUoZ3JvdXAuaXRlbXMpO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiBtYWtlVHJhbnNmb3JtKG91dHB1dCwgdGhpcywgXCJncm91cEJ5XCIsIGdyb3VwcywgdGhpc1B0cik7XHJcblx0XHR9LFxyXG5cdFx0b3JkZXJCeTogZnVuY3Rpb24gVHJhbnNmb3JtJG9yZGVyQnkob3JkZXJpbmcsIHRoaXNQdHIpIHtcclxuXHRcdFx0dmFyIG91dHB1dCA9IHRyYW5zZm9ybXMub3JkZXJCeSh0aGlzLmlucHV0KCksIG9yZGVyaW5nLCB0aGlzUHRyKTtcclxuXHRcdFx0cmV0dXJuIG1ha2VUcmFuc2Zvcm0ob3V0cHV0LCB0aGlzLCBcIm9yZGVyQnlcIiwgb3JkZXJpbmcsIHRoaXNQdHIpO1xyXG5cdFx0fSxcclxuXHRcdGxpdmU6IGZ1bmN0aW9uIFRyYW5zZm9ybSRsaXZlKCkge1xyXG5cdFx0XHQvLyBXYXRjaGVzIGZvciBjaGFuZ2VzIG9uIHRoZSByb290IGlucHV0IGludG8gdGhlIHRyYW5zZm9ybVxyXG5cdFx0XHQvLyBhbmQgcmFpc2VzIG9ic2VydmFibGUgY2hhbmdlIGV2ZW50cyBvbiB0aGlzIGl0ZW0gYXMgdGhlIFxyXG5cdFx0XHQvLyByZXN1bHRzIGNoYW5nZS5cclxuXHJcblx0XHRcdHZhciB0cmFuc2Zvcm0sIHN0ZXBzID0gW10sIHJvb3RTdGVwO1xyXG5cclxuXHRcdFx0Ly8gZGV0ZXJtaW5lIHRoZSBzZXQgb2YgdHJhbnNmb3JtIHN0ZXBzIGFuZCB0aGUgbGV2ZWwgb2YgbmVzdGVkIGdyb3VwaW5nXHJcblx0XHRcdGZvciAodmFyIHN0ZXAgPSB0aGlzOyBzdGVwOyBzdGVwID0gc3RlcC5fcHJpb3IpIHtcclxuXHRcdFx0XHRpZiAoc3RlcC5fcHJpb3IpIHtcclxuXHRcdFx0XHRcdHN0ZXBzLnNwbGljZSgwLCAwLCBzdGVwKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRyb290U3RlcCA9IHN0ZXA7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBjb3B5IGFuZCByZXR1cm4gYSBsaXZlLW1vZGUgdHJhbnNmb3JtIGlmIGxpdmUgbW9kZSB3YXMgbm90IHVzZWQgb3JpZ2luYWxseVxyXG5cdFx0XHRpZiAodGhpcy5fbGl2ZVBlbmRpbmcgIT09IHRydWUpIHtcclxuXHRcdFx0XHRyZXR1cm4gY29weVRyYW5zZm9ybShzdGVwcywgcm9vdFN0ZXAuaW5wdXQoKSwgdHJ1ZSkubGl2ZSgpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBtYWtlIGEgY29weSBvZiB0aGUgZmluYWwgdHJhbnNmb3JtZWQgZGF0YSBhbmQgbWFrZSBpdCBvYnNlcnZhYmxlXHJcblx0XHRcdHZhciBvdXRwdXQgPSB0aGlzLmlucHV0KCkuY29weSgpO1xyXG5cdFx0XHRFeG9XZWIuT2JzZXJ2ZXIubWFrZU9ic2VydmFibGUob3V0cHV0KTtcclxuXHRcdFx0b3V0cHV0LnJvb3RJbnB1dCA9IHRoaXMucm9vdElucHV0O1xyXG5cclxuXHRcdFx0Ly8gd2F0Y2ggZm9yIGNoYW5nZXMgdG8gcm9vdCBpbnB1dCBhbmQgdXBkYXRlIHRoZSB0cmFuc2Zvcm0gc3RlcHMgYXMgbmVlZGVkXHJcblx0XHRcdEV4b1dlYi5PYnNlcnZlci5hZGRDb2xsZWN0aW9uQ2hhbmdlZChyb290U3RlcC5pbnB1dCgpLCBmdW5jdGlvbiBUcmFuc2Zvcm0kbGl2ZSRjb2xsZWN0aW9uQ2hhbmdlZChzZW5kZXIsIGFyZ3MpIHtcclxuXHRcdFx0XHR2YXIgY2hhbmdlcywgc3RlcElucHV0LCBzdGVwUmVzdWx0LCBtb2RpZmllZEl0ZW1zQXJyYXlzID0gW107XHJcblxyXG5cdFx0XHRcdC8vU3lzLk5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkQWN0aW9uLmFkZDtcclxuXHJcblx0XHRcdFx0Ly8gY29weSB0aGUgc2V0IG9mIGNoYW5nZXMgc2luY2UgdGhleSB3aWxsIGJlIG1hbmlwdWxhdGVkXHJcblx0XHRcdFx0Y2hhbmdlcyA9IGFyZ3MuZ2V0X2NoYW5nZXMoKS5tYXAoZnVuY3Rpb24gKGMpIHtcclxuXHRcdFx0XHRcdHJldHVybiB7XHJcblx0XHRcdFx0XHRcdGFjdGlvbjogYy5hY3Rpb24sXHJcblx0XHRcdFx0XHRcdG9sZEl0ZW1zOiBjLm9sZEl0ZW1zID8gYy5vbGRJdGVtcy5jb3B5KCkgOiBudWxsLFxyXG5cdFx0XHRcdFx0XHRvbGRTdGFydGluZ0luZGV4OiBjLm9sZFN0YXJ0aW5nSW5kZXgsXHJcblx0XHRcdFx0XHRcdG5ld0l0ZW1zOiBjLm5ld0l0ZW1zID8gYy5uZXdJdGVtcy5jb3B5KCkgOiBudWxsLFxyXG5cdFx0XHRcdFx0XHRuZXdTdGFydGluZ0luZGV4OiBjLm5ld1N0YXJ0aW5nSW5kZXhcclxuXHRcdFx0XHRcdH07XHJcblx0XHRcdFx0fSk7XHJcblxyXG5cdFx0XHRcdC8vIG1ha2UgYSBjb3BpZWQgdmVyc2lvbiBvZiB0aGUgaW5wdXQgc28gdGhhdCBpdCBjYW4gYmUgbWFuaXB1bGF0ZWQgd2l0aG91dCBhZmZlY3RpbmcgdGhlIHJlc3VsdFxyXG5cdFx0XHRcdHN0ZXBJbnB1dCA9IHJvb3RTdGVwLmlucHV0KCkuY29weSgpO1xyXG5cclxuXHRcdFx0XHQvLyByZS1ydW4gdGhlIHRyYW5zZm9ybSBvbiB0aGUgbmV3bHkgY2hhbmdlZCBpbnB1dFxyXG5cdFx0XHRcdHN0ZXBzLmZvckVhY2goZnVuY3Rpb24gKHN0ZXApIHtcclxuXHRcdFx0XHRcdC8vIHN0b3JlIGEgcmVmZXJlbmNlIHRvIHRoZSBvdXRwdXQgb2YgdGhpcyBzdGVwXHJcblx0XHRcdFx0XHRzdGVwUmVzdWx0ID0gc3RlcC5pbnB1dCgpO1xyXG5cclxuXHRcdFx0XHRcdGlmIChzdGVwLl90cmFuc2Zvcm0ubWV0aG9kID09PSBcIndoZXJlXCIpIHtcclxuXHRcdFx0XHRcdFx0Y2hhbmdlcy5wdXJnZShmdW5jdGlvbiAoY2hhbmdlKSB7XHJcblx0XHRcdFx0XHRcdFx0aWYgKGNoYW5nZS5vbGRJdGVtcykge1xyXG5cdFx0XHRcdFx0XHRcdFx0dmFyIG9sZEl0ZW1zID0gY2hhbmdlLm9sZEl0ZW1zO1xyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gZGV0ZXJtaW5lIHdoaWNoIHJlbW92ZWQgaXRlbXMgbWFkZSBpdCB0aHJvdWdoIHRoZSBmaWx0ZXJcclxuXHRcdFx0XHRcdFx0XHRcdGNoYW5nZS5vbGRJdGVtcyA9IHRyYW5zZm9ybXNbc3RlcC5fdHJhbnNmb3JtLm1ldGhvZF0oY2hhbmdlLm9sZEl0ZW1zLCBzdGVwLl90cmFuc2Zvcm0uYXJnLCBzdGVwLl90cmFuc2Zvcm0udGhpc1B0cik7XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoY2hhbmdlLm9sZEl0ZW1zLmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHQvLyBub25lIG9mIHRoZSByZW1vdmVkIGl0ZW1zIG1ha2UgaXQgdGhyb3VnaCB0aGUgZmlsdGVyLCBzbyBkaXNjYXJkXHJcblx0XHRcdFx0XHRcdFx0XHRcdGNoYW5nZS5vbGRJdGVtcyA9IG51bGw7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGNoYW5nZS5vbGRTdGFydGluZ0luZGV4ID0gbnVsbDtcclxuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gZmluZCB0aGUgYWN0dWFsIGluZGV4IG9mIHRoZSBmaXJzdCByZW1vdmVkIGl0ZW0gaW4gdGhlIHJlc3VsdGluZyBhcnJheVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRjaGFuZ2Uub2xkU3RhcnRpbmdJbmRleCA9IHN0ZXBSZXN1bHQuaW5kZXhPZihjaGFuZ2Uub2xkSXRlbXNbMF0pO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gcmVtb3ZlIHRoZSBmaWx0ZXJlZCBpdGVtcyBmcm9tIHRoZSByZXN1bHQgYXJyYXlcclxuXHRcdFx0XHRcdFx0XHRcdFx0c3RlcFJlc3VsdC5zcGxpY2UoY2hhbmdlLm9sZFN0YXJ0aW5nSW5kZXgsIGNoYW5nZS5vbGRJdGVtcy5sZW5ndGgpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRlbHNlIGlmIChjaGFuZ2UubmV3SXRlbXMpIHtcclxuXHRcdFx0XHRcdFx0XHRcdHZhciBuZXdJdGVtcyA9IGNoYW5nZS5uZXdJdGVtcztcclxuXHRcdFx0XHRcdFx0XHRcdC8vIGRldGVybWluZSB3aGljaCBhZGRlZCBpdGVtcyB3aWxsIG1ha2UgaXQgdGhyb3VnaCB0aGUgZmlsdGVyXHJcblx0XHRcdFx0XHRcdFx0XHRjaGFuZ2UubmV3SXRlbXMgPSB0cmFuc2Zvcm1zW3N0ZXAuX3RyYW5zZm9ybS5tZXRob2RdKGNoYW5nZS5uZXdJdGVtcywgc3RlcC5fdHJhbnNmb3JtLmFyZywgc3RlcC5fdHJhbnNmb3JtLnRoaXNQdHIpO1xyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKGNoYW5nZS5uZXdJdGVtcy5sZW5ndGggPT09IDApIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gbm9uZSBvZiB0aGUgbmV3IGl0ZW1zIHdpbGwgbWFrZSBpdCB0aHJvdWdoIHRoZSBmaWx0ZXIsIHNvIGRpc2NhcmRcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y2hhbmdlLm5ld0l0ZW1zID0gbnVsbDtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y2hhbmdlLm5ld1N0YXJ0aW5nSW5kZXggPSBudWxsO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHQvLyBpZiBub3QgYWRkZWQgdG8gdGhlIGJlZ2lubmluZyBvciBlbmQgb2YgdGhlIGxpc3QsIGRldGVybWluZVxyXG5cdFx0XHRcdFx0XHRcdFx0XHQvLyB0aGUgcmVhbCBzdGFydGluZyBpbmRleCBieSBmaW5kaW5nIHRoZSBpbmRleCBvZiB0aGUgcHJldmlvdXMgaXRlbVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoY2hhbmdlLm5ld1N0YXJ0aW5nSW5kZXggIT09IDAgJiYgKGNoYW5nZS5uZXdTdGFydGluZ0luZGV4ICsgY2hhbmdlLm5ld0l0ZW1zLmxlbmd0aCkgIT09IHN0ZXBJbnB1dC5sZW5ndGgpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgZm91bmQgPSBmYWxzZTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRmb3IgKHZhciBpZHggPSBjaGFuZ2UubmV3U3RhcnRpbmdJbmRleCAtIDE7ICFmb3VuZCAmJiBpZHggPj0gMDsgaWR4LS0pIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChzdGVwUmVzdWx0LmluZGV4T2Yoc3RlcElucHV0W2lkeF0pID49IDApIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Zm91bmQgPSB0cnVlO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRjaGFuZ2UubmV3U3RhcnRpbmdJbmRleCA9IGlkeCArIDE7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdC8vIHNwbGljZSB0aGUgZmlsdGVyZWQgaXRlbXMgaW50byB0aGUgcmVzdWx0IGFycmF5XHJcblx0XHRcdFx0XHRcdFx0XHRcdHZhciBzcGxpY2VBcmdzID0gY2hhbmdlLm5ld0l0ZW1zLmNvcHkoKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0c3BsaWNlQXJncy5zcGxpY2UoMCwgMCwgY2hhbmdlLm5ld1N0YXJ0aW5nSW5kZXgsIDApO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRBcnJheS5wcm90b3R5cGUuc3BsaWNlLmFwcGx5KHN0ZXBSZXN1bHQsIHNwbGljZUFyZ3MpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIGlmIChzdGVwLl90cmFuc2Zvcm0ubWV0aG9kID09PSBcInNlbGVjdFwiKSB7XHJcblx0XHRcdFx0XHRcdGNoYW5nZXMuZm9yRWFjaChmdW5jdGlvbiAoY2hhbmdlKSB7XHJcblx0XHRcdFx0XHRcdFx0aWYgKGNoYW5nZS5vbGRJdGVtcykge1xyXG5cdFx0XHRcdFx0XHRcdFx0Y2hhbmdlLm9sZEl0ZW1zID0gc3RlcFJlc3VsdC5zcGxpY2UoY2hhbmdlLm9sZFN0YXJ0aW5nSW5kZXgsIGNoYW5nZS5vbGRJdGVtcy5sZW5ndGgpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRlbHNlIGlmIChjaGFuZ2UubmV3SXRlbXMpIHtcclxuXHRcdFx0XHRcdFx0XHRcdHZhciBtYXBGbiA9IHN0ZXAuX3RyYW5zZm9ybS5hcmcgaW5zdGFuY2VvZiBGdW5jdGlvbiA/IHN0ZXAuX3RyYW5zZm9ybS5hcmcgOiBjb21waWxlU2VsZWN0RnVuY3Rpb24oc3RlcC5fdHJhbnNmb3JtLmFyZyk7XHJcblx0XHRcdFx0XHRcdFx0XHRjaGFuZ2UubmV3SXRlbXMgPSBjaGFuZ2UubmV3SXRlbXMubWFwKGZ1bmN0aW9uIChpdGVtKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBtYXBGbi5jYWxsKHN0ZXAuX3RyYW5zZm9ybS50aGlzUHRyIHx8IGl0ZW0sIGl0ZW0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0fSk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gc3BsaWNlIHRoZSBmaWx0ZXJlZCBpdGVtcyBpbnRvIHRoZSByZXN1bHQgYXJyYXlcclxuXHRcdFx0XHRcdFx0XHRcdHZhciBzcGxpY2VBcmdzID0gY2hhbmdlLm5ld0l0ZW1zLmNvcHkoKTtcclxuXHRcdFx0XHRcdFx0XHRcdHNwbGljZUFyZ3Muc3BsaWNlKDAsIDAsIGNoYW5nZS5uZXdTdGFydGluZ0luZGV4LCAwKTtcclxuXHRcdFx0XHRcdFx0XHRcdEFycmF5LnByb3RvdHlwZS5zcGxpY2UuYXBwbHkoc3RlcFJlc3VsdCwgc3BsaWNlQXJncyk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2UgaWYgKHN0ZXAuX3RyYW5zZm9ybS5tZXRob2QgPT09IFwic2VsZWN0TWFueVwiKSB7XHJcblx0XHRcdFx0XHRcdGNoYW5nZXMuZm9yRWFjaChmdW5jdGlvbiAoY2hhbmdlKSB7XHJcblx0XHRcdFx0XHRcdFx0aWYgKGNoYW5nZS5vbGRJdGVtcykge1xyXG5cdFx0XHRcdFx0XHRcdFx0dmFyIG1hcEZuID0gc3RlcC5fdHJhbnNmb3JtLmFyZyBpbnN0YW5jZW9mIEZ1bmN0aW9uID8gc3RlcC5fdHJhbnNmb3JtLmFyZyA6IGNvbXBpbGVTZWxlY3RNYW55RnVuY3Rpb24oc3RlcC5fdHJhbnNmb3JtLmFyZyk7XHJcblx0XHRcdFx0XHRcdFx0XHR2YXIgb2xkSXRlbXNNYW55ID0gY2hhbmdlLm9sZEl0ZW1zLm1hcFRvQXJyYXkoZnVuY3Rpb24gKGl0ZW0pIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIG1hcEZuLmNhbGwoc3RlcC5fdHJhbnNmb3JtLnRoaXNQdHIgfHwgaXRlbSwgaXRlbSk7XHJcblx0XHRcdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdFx0XHRcdHZhciBvbGRQcmVjZWVkaW5nID0gc3RlcElucHV0LnNsaWNlKDAsIGNoYW5nZS5vbGRTdGFydGluZ0luZGV4KTtcclxuXHRcdFx0XHRcdFx0XHRcdHZhciBvbGRQcmVjZWVkaW5nTWFueSA9IG9sZFByZWNlZWRpbmcubWFwVG9BcnJheShmdW5jdGlvbiAoaXRlbSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gbWFwRm4uY2FsbChzdGVwLl90cmFuc2Zvcm0udGhpc1B0ciB8fCBpdGVtLCBpdGVtKTtcclxuXHRcdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0Y2hhbmdlLm9sZEl0ZW1zID0gc3RlcFJlc3VsdC5zcGxpY2Uob2xkUHJlY2VlZGluZ01hbnkubGVuZ3RoLCBvbGRJdGVtc01hbnkubGVuZ3RoKTtcclxuXHRcdFx0XHRcdFx0XHRcdGNoYW5nZS5vbGRTdGFydGluZ0luZGV4ID0gb2xkUHJlY2VlZGluZ01hbnkubGVuZ3RoO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRlbHNlIGlmIChjaGFuZ2UubmV3SXRlbXMpIHtcclxuXHRcdFx0XHRcdFx0XHRcdHZhciBtYXBGbiA9IHN0ZXAuX3RyYW5zZm9ybS5hcmcgaW5zdGFuY2VvZiBGdW5jdGlvbiA/IHN0ZXAuX3RyYW5zZm9ybS5hcmcgOiBjb21waWxlU2VsZWN0TWFueUZ1bmN0aW9uKHN0ZXAuX3RyYW5zZm9ybS5hcmcpO1xyXG5cdFx0XHRcdFx0XHRcdFx0Y2hhbmdlLm5ld0l0ZW1zID0gY2hhbmdlLm5ld0l0ZW1zLm1hcFRvQXJyYXkoZnVuY3Rpb24gKGl0ZW0pIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIG1hcEZuLmNhbGwoc3RlcC5fdHJhbnNmb3JtLnRoaXNQdHIgfHwgaXRlbSwgaXRlbSk7XHJcblx0XHRcdFx0XHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHQvLyBzcGxpY2UgdGhlIGZpbHRlcmVkIGl0ZW1zIGludG8gdGhlIHJlc3VsdCBhcnJheVxyXG5cdFx0XHRcdFx0XHRcdFx0dmFyIHNwbGljZUFyZ3MgPSBjaGFuZ2UubmV3SXRlbXMuY29weSgpO1xyXG5cdFx0XHRcdFx0XHRcdFx0c3BsaWNlQXJncy5zcGxpY2UoMCwgMCwgY2hhbmdlLm5ld1N0YXJ0aW5nSW5kZXgsIDApO1xyXG5cdFx0XHRcdFx0XHRcdFx0QXJyYXkucHJvdG90eXBlLnNwbGljZS5hcHBseShzdGVwUmVzdWx0LCBzcGxpY2VBcmdzKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAoc3RlcC5fdHJhbnNmb3JtLm1ldGhvZCA9PT0gXCJncm91cEJ5XCIpIHtcclxuXHRcdFx0XHRcdFx0dmFyIGdyb3VwRm4gPSBzdGVwLl90cmFuc2Zvcm0uYXJnIGluc3RhbmNlb2YgRnVuY3Rpb24gPyBzdGVwLl90cmFuc2Zvcm0uYXJnIDogY29tcGlsZUdyb3Vwc0Z1bmN0aW9uKHN0ZXAuX3RyYW5zZm9ybS5hcmcpO1xyXG5cdFx0XHRcdFx0XHR2YXIgY29weU9mUmVzdWx0cyA9IHN0ZXBSZXN1bHQuY29weSgpO1xyXG5cdFx0XHRcdFx0XHRjaGFuZ2VzLmZvckVhY2goZnVuY3Rpb24gKGNoYW5nZSkge1xyXG5cdFx0XHRcdFx0XHRcdGlmIChjaGFuZ2Uub2xkSXRlbXMpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGNoYW5nZS5vbGRJdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHZhciBncm91cEtleSA9IGdyb3VwRm4uY2FsbChzdGVwLl90cmFuc2Zvcm0udGhpc1B0ciB8fCBpdGVtLCBpdGVtKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIGdyb3VwID0gY29weU9mUmVzdWx0cy5maWx0ZXIoZnVuY3Rpb24gKGcpIHsgcmV0dXJuIGcuZ3JvdXAgPT09IGdyb3VwS2V5OyB9KVswXTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gYmVnaW4gYW5kIGVuZCB1cGRhdGUgb24gaXRlbXMgYXJyYXlcclxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKG1vZGlmaWVkSXRlbXNBcnJheXMuaW5kZXhPZihncm91cC5pdGVtcykgPCAwKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Z3JvdXAuaXRlbXMuYmVnaW5VcGRhdGUoKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRtb2RpZmllZEl0ZW1zQXJyYXlzLnB1c2goZ3JvdXAuaXRlbXMpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRcdC8vIHJlbW92ZSB0aGUgaXRlbVxyXG5cdFx0XHRcdFx0XHRcdFx0XHR2YXIgaWR4ID0gZ3JvdXAuaXRlbXMuaW5kZXhPZihpdGVtKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Z3JvdXAuaXRlbXMucmVtb3ZlKGl0ZW0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoaWR4ID09PSAwKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIGdyb3VwSW5kZXggPSBjb3B5T2ZSZXN1bHRzLmluZGV4T2YoZ3JvdXApLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c291cmNlSW5kZXggPSBzdGVwSW5wdXQuaW5kZXhPZihncm91cC5pdGVtc1swXSksXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR0YXJnZXRJbmRleCA9IG51bGw7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Zm9yIChpID0gMDsgaSA8IGNvcHlPZlJlc3VsdHMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChzb3VyY2VJbmRleCA+IHN0ZXBJbnB1dC5pbmRleE9mKGNvcHlPZlJlc3VsdHNbaV0uaXRlbXNbMF0pKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHRhcmdldEluZGV4ID0gaSArIDE7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAodGFyZ2V0SW5kZXggIT09IG51bGwpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGNvcHlPZlJlc3VsdHMuc3BsaWNlKGdyb3VwSW5kZXgsIDEpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Y29weU9mUmVzdWx0cy5zcGxpY2UodGFyZ2V0SW5kZXgsIDAsIGdyb3VwKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKGdyb3VwLml0ZW1zLmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8vIHJlbW92ZSB0aGUgZ3JvdXAgZnJvbSB0aGUgY29weSBvZiB0aGUgYXJyYXlcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRjb3B5T2ZSZXN1bHRzLnNwbGljZShjb3B5T2ZSZXN1bHRzLmluZGV4T2YoZ3JvdXApLCAxKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdGVsc2UgaWYgKGNoYW5nZS5uZXdJdGVtcykge1xyXG5cdFx0XHRcdFx0XHRcdFx0Y2hhbmdlLm5ld0l0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIGdyb3VwS2V5ID0gZ3JvdXBGbi5jYWxsKHN0ZXAuX3RyYW5zZm9ybS50aGlzUHRyIHx8IGl0ZW0sIGl0ZW0pLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGdyb3VwID0gY29weU9mUmVzdWx0cy5maWx0ZXIoZnVuY3Rpb24gKGcpIHsgcmV0dXJuIGcuZ3JvdXAgPT09IGdyb3VwS2V5OyB9KVswXSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRzb3VyY2VJbmRleCxcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR0YXJnZXRJbmRleCxcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRyZXNlcXVlbmNlR3JvdXAgPSBmYWxzZSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRncm91cEluZGV4LFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoZ3JvdXApIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBiZWdpbiBhbmQgZW5kIHVwZGF0ZSBvbiBpdGVtcyBhcnJheVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChtb2RpZmllZEl0ZW1zQXJyYXlzLmluZGV4T2YoZ3JvdXAuaXRlbXMpIDwgMCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Z3JvdXAuaXRlbXMuYmVnaW5VcGRhdGUoKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdG1vZGlmaWVkSXRlbXNBcnJheXMucHVzaChncm91cC5pdGVtcyk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHNvdXJjZUluZGV4ID0gc3RlcElucHV0LmluZGV4T2YoaXRlbSksIHRhcmdldEluZGV4ID0gbnVsbDtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRmb3IgKGkgPSAwOyBpIDwgZ3JvdXAuaXRlbXMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChzb3VyY2VJbmRleCA8IHN0ZXBJbnB1dC5pbmRleE9mKGdyb3VwLml0ZW1zW2ldKSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR0YXJnZXRJbmRleCA9IGk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAodGFyZ2V0SW5kZXggIT09IG51bGwpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGdyb3VwLml0ZW1zLmluc2VydCh0YXJnZXRJbmRleCwgaXRlbSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBncm91cCdzIGluZGV4IG1heSBoYXZlIGNoYW5nZWQgYXMgYSByZXN1bHRcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmICh0YXJnZXRJbmRleCA9PT0gMCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRyZXNlcXVlbmNlR3JvdXAgPSB0cnVlO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGdyb3VwLml0ZW1zLmFkZChpdGVtKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Z3JvdXAgPSBuZXcgVHJhbnNmb3JtR3JvdXAoZ3JvdXBLZXksIFtpdGVtXSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0RXhvV2ViLk9ic2VydmVyLm1ha2VPYnNlcnZhYmxlKGdyb3VwLml0ZW1zKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRjb3B5T2ZSZXN1bHRzLnB1c2goZ3JvdXApO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHJlc2VxdWVuY2VHcm91cCA9IHRydWU7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmIChyZXNlcXVlbmNlR3JvdXAgPT09IHRydWUpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRncm91cEluZGV4ID0gY29weU9mUmVzdWx0cy5pbmRleE9mKGdyb3VwKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRzb3VyY2VJbmRleCA9IHN0ZXBJbnB1dC5pbmRleE9mKGdyb3VwLml0ZW1zWzBdKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR0YXJnZXRJbmRleCA9IG51bGw7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Zm9yIChpID0gMDsgaSA8IGdyb3VwSW5kZXg7IGkrKykge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHNvdXJjZUluZGV4IDwgc3RlcElucHV0LmluZGV4T2YoY29weU9mUmVzdWx0c1tpXS5pdGVtc1swXSkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0dGFyZ2V0SW5kZXggPSBpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHRhcmdldEluZGV4ICE9PSBudWxsKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRjb3B5T2ZSZXN1bHRzLnNwbGljZShncm91cEluZGV4LCAxKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGNvcHlPZlJlc3VsdHMuc3BsaWNlKHRhcmdldEluZGV4LCAwLCBncm91cCk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH0pO1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gY29sbGVjdCBuZXcgY2hhbmdlcyB0byBncm91cHNcclxuXHRcdFx0XHRcdFx0Y2hhbmdlcyA9IHVwZGF0ZShzdGVwUmVzdWx0LCBjb3B5T2ZSZXN1bHRzLCB0cnVlKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2UgaWYgKHN0ZXAuX3RyYW5zZm9ybS5tZXRob2QgPT09IFwib3JkZXJCeVwiKSB7XHJcblx0XHRcdFx0XHRcdC8vIHNvcnQgdGhlIGlucHV0IGFuZCB1cGRhdGUgdGhlIHN0ZXAgcmVzdWx0IHRvIG1hdGNoXHJcblx0XHRcdFx0XHRcdHZhciBzb3J0ZWQgPSB0cmFuc2Zvcm1zW3N0ZXAuX3RyYW5zZm9ybS5tZXRob2RdKHN0ZXBJbnB1dCwgc3RlcC5fdHJhbnNmb3JtLmFyZywgc3RlcC5fdHJhbnNmb3JtLnRoaXNQdHIpO1xyXG5cdFx0XHRcdFx0XHRjaGFuZ2VzID0gdXBkYXRlKHN0ZXBSZXN1bHQsIHNvcnRlZCwgdHJ1ZSk7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0Ly8gbW92ZSB0aGUgaW5wdXQgZm9yd2FyZCB0byB0aGUgcmVzdWx0IG9mIHRoZSBjdXJyZW50IHN0ZXBcclxuXHRcdFx0XHRcdHN0ZXBJbnB1dCA9IHN0ZXBSZXN1bHQ7XHJcblx0XHRcdFx0fSk7XHJcblxyXG5cdFx0XHRcdC8vIGFwcGx5IGNoYW5nZXMgdG8gdGhlIG91cHV0IGFycmF5XHJcblx0XHRcdFx0b3V0cHV0LmJlZ2luVXBkYXRlKCk7XHJcblx0XHRcdFx0Y2hhbmdlcy5mb3JFYWNoKGZ1bmN0aW9uIChjaGFuZ2UpIHtcclxuXHRcdFx0XHRcdGlmIChjaGFuZ2Uub2xkSXRlbXMpIHtcclxuXHRcdFx0XHRcdFx0b3V0cHV0LnJlbW92ZVJhbmdlKGNoYW5nZS5vbGRTdGFydGluZ0luZGV4LCBjaGFuZ2Uub2xkSXRlbXMubGVuZ3RoKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2UgaWYgKGNoYW5nZS5uZXdJdGVtcykge1xyXG5cdFx0XHRcdFx0XHRvdXRwdXQuaW5zZXJ0UmFuZ2UoY2hhbmdlLm5ld1N0YXJ0aW5nSW5kZXgsIGNoYW5nZS5uZXdJdGVtcyk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdFx0b3V0cHV0LmVuZFVwZGF0ZSgpO1xyXG5cclxuXHRcdFx0XHQvLyByZWxlYXNlIGNoYW5nZXMgdG8gaXRlbXMgYXJyYXlzIG9mIGdyb3VwcywgY2hhbmdlcyB0byB0aGUgYXJyYXkgb2NjdXIgZmlyc3QgdG8gYWxsb3dcclxuXHRcdFx0XHQvLyBmb3IgY2hhbmdlcyB0byBncm91cHMnIGl0ZW1zIHRvIGJlIGlnbm9yZWQgaWYgdGhlIGdyb3VwIGlzIG5vIGxvbmdlciBhIHBhcnQgb2YgdGhlIG91dHB1dFxyXG5cdFx0XHRcdG1vZGlmaWVkSXRlbXNBcnJheXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbXMpIHtcclxuXHRcdFx0XHRcdGl0ZW1zLmVuZFVwZGF0ZSgpO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9KTtcclxuXHJcblx0XHRcdC8vIG1hcmsgdGhlIHRyYW5zZm9ybSBzdGVwcyBhcyBsaXZlIGNvbXBsZXRlXHJcblx0XHRcdHJvb3RTdGVwLl9saXZlQ29tcGxldGUgPSB0cnVlO1xyXG5cdFx0XHRzdGVwcy5mb3JFYWNoKGZ1bmN0aW9uIChzdGVwKSB7XHJcblx0XHRcdFx0c3RlcC5fbGl2ZUNvbXBsZXRlID0gdHJ1ZTtcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gb3V0cHV0O1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHRFeG9XZWIuVHJhbnNmb3JtID0gVHJhbnNmb3JtO1xyXG5cdHdpbmRvdy4kdHJhbnNmb3JtID0gZnVuY3Rpb24gdHJhbnNmb3JtKGFycmF5LCBmb3JMaXZlKSB7IHJldHVybiBuZXcgVHJhbnNmb3JtKGFycmF5LCBmb3JMaXZlKTsgfTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5UcmFuc2xhdG9yXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gVHJhbnNsYXRvcigpIHtcclxuXHRcdHRoaXMuX2ZvcndhcmREaWN0aW9uYXJ5ID0ge307XHJcblx0XHR0aGlzLl9yZXZlcnNlRGljdGlvbmFyeSA9IHt9O1xyXG5cdH1cclxuXHJcblx0VHJhbnNsYXRvci5wcm90b3R5cGUgPSB7XHJcblx0XHRsb29rdXA6IGZ1bmN0aW9uIFRyYW5zbGF0b3IkbG9va3VwKHNvdXJjZSwgY2F0ZWdvcnksIGtleSkge1xyXG5cdFx0XHRpZiAoc291cmNlW2NhdGVnb3J5XSkge1xyXG5cdFx0XHRcdHJldHVybiBzb3VyY2VbY2F0ZWdvcnldW2tleV0gfHwgbnVsbDtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdGZvcndhcmQ6IGZ1bmN0aW9uIFRyYW5zbGF0b3IkZm9yd2FyZChjYXRlZ29yeSwga2V5KSB7XHJcblx0XHRcdHJldHVybiB0aGlzLmxvb2t1cCh0aGlzLl9mb3J3YXJkRGljdGlvbmFyeSwgY2F0ZWdvcnksIGtleSk7XHJcblx0XHR9LFxyXG5cdFx0cmV2ZXJzZTogZnVuY3Rpb24gVHJhbnNsYXRvciRyZXZlcnNlKGNhdGVnb3J5LCBrZXkpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMubG9va3VwKHRoaXMuX3JldmVyc2VEaWN0aW9uYXJ5LCBjYXRlZ29yeSwga2V5KTtcclxuXHRcdH0sXHJcblx0XHRhZGQ6IGZ1bmN0aW9uIFRyYW5zbGF0b3IkYWRkTWFwcGluZyhjYXRlZ29yeSwga2V5LCB2YWx1ZS8qLCBzdXBwcmVzc1JldmVyc2UqLykge1xyXG5cdFx0XHQvLyBsb29rIGZvciBvcHRpb25hbCBzdXBwcmVzcyByZXZlcnNlIGxvb2t1cCBhcmd1bWVudFxyXG5cdFx0XHR2YXIgc3VwcHJlc3NSZXZlcnNlID0gKGFyZ3VtZW50cy5sZW5ndGggPT0gNCAmJiBhcmd1bWVudHNbM10uY29uc3RydWN0b3IgPT09IEJvb2xlYW4pID8gYXJndW1lbnRzWzNdIDogZmFsc2U7XHJcblxyXG5cdFx0XHQvLyBsYXp5IGluaXRpYWxpemUgdGhlIGZvcndhcmQgZGljdGlvbmFyeSBmb3IgdGhlIGNhdGVnb3J5XHJcblx0XHRcdGlmICghdGhpcy5fZm9yd2FyZERpY3Rpb25hcnlbY2F0ZWdvcnldKSB7XHJcblx0XHRcdFx0dGhpcy5fZm9yd2FyZERpY3Rpb25hcnlbY2F0ZWdvcnldID0ge307XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5fZm9yd2FyZERpY3Rpb25hcnlbY2F0ZWdvcnldW2tleV0gPSB2YWx1ZTtcclxuXHJcblx0XHRcdC8vIGRvbid0IGFkZCB0byB0aGUgcmV2ZXJzZSBkaWN0aW9uYXJ5IGlmIHRoZSBzdXBwcmVzcyBmbGFnIGlzIHNwZWNpZmllZFxyXG5cdFx0XHRpZiAoIXN1cHByZXNzUmV2ZXJzZSkge1xyXG5cdFx0XHRcdC8vIGxhenkgaW5pdGlhbGl6ZSB0aGUgcmV2ZXJzZSBkaWN0aW9uYXJ5IGZvciB0aGUgY2F0ZWdvcnlcclxuXHRcdFx0XHRpZiAoIXRoaXMuX3JldmVyc2VEaWN0aW9uYXJ5W2NhdGVnb3J5XSkge1xyXG5cdFx0XHRcdFx0dGhpcy5fcmV2ZXJzZURpY3Rpb25hcnlbY2F0ZWdvcnldID0ge307XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHRoaXMuX3JldmVyc2VEaWN0aW9uYXJ5W2NhdGVnb3J5XVt2YWx1ZV0gPSBrZXk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRFeG9XZWIuVHJhbnNsYXRvciA9IFRyYW5zbGF0b3I7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuVXRpbGl0aWVzXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0Ly8gZGV0ZXJtaW5lIHdoZXRoZXIgT2JqZWN0LmRlZmluZVByb3BlcnR5IGlzIHN1cHBvcnRlZCBhbmQgYWRkIGxlZ2FjeSBzdXBwb3J0IGlzIG5lY2Vzc2FyeS9wb3NzaWJsZVxyXG5cdHZhciBkZWZpbmVQcm9wZXJ0eVN1cHBvcnRlZCA9IGZhbHNlO1xyXG5cdHZhciBkZWZpbmVQcm9wZXJ0eTtcclxuXHJcblx0ZnVuY3Rpb24gZGVmaW5lTGVnYWN5UHJvcGVydHkoKSB7XHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkgPSBmdW5jdGlvbiAob2JqLCBwcm9wLCBkZXNjKSB7XHJcblxyXG5cdFx0XHQvLyBhc3N1bWUgZ2V0dGVyIHdpbGwgb25seSBuZWVkIHRvIGNhbGN1bGF0ZSBvbmNlIGZvbGxvd2luZyB0aGUgY29uc3RydWN0b3JcclxuXHRcdFx0aWYgKFwiZ2V0XCIgaW4gZGVzYykge1xyXG5cdFx0XHRcdGlmICghZGVzYy5pbml0KSB0aHJvdyBuZXcgRXJyb3IoXCJHZXR0ZXJzIGFyZSBub3Qgc3VwcG9ydGVkIGJ5IHRoZSBjdXJyZW50IGJyb3dzZXIuICBVc2UgZGVmaW5lUHJvcGVydHlTdXBwb3J0ZWQgdG8gY2hlY2sgZm9yIGZ1bGwgc3VwcG9ydC5cIik7XHJcblxyXG5cdFx0XHRcdC8vIGFzc3VtZSBvYmplY3RzIHdpdGggcHJvdG90eXBlcyBhcmUgaW5zdGFuY2VzIGFuZCBnbyBhaGVhZCBhbmQgaW5pdGlhbGl6ZSB0aGUgcHJvcGVydHkgdXNpbmcgdGhlIGdldHRlclxyXG5cdFx0XHRcdGlmIChvYmoucHJvdG90eXBlKSB7XHJcblx0XHRcdFx0XHRvYmpbcHJvcF0gPSBkZXNjLmdldC5jYWxsKG9iaiwgb2JqKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIG90aGVyd2lzZSwgY29uZmlndXJlIHRoZSBwcm90b3R5cGUgdG8gaW5pdGlhbGl6ZSB0aGUgcHJvcGVydHkgd2hlbiB0aGUgY29uc3RydWN0b3IgaXMgY2FsbGVkXHJcblx0XHRcdFx0ZWxzZSBpZiAob2JqLmNvbnN0cnVjdG9yKSB7XHJcblx0XHRcdFx0XHR2YXIgaW5pdFByb3BlcnRpZXMgPSBvYmouY29uc3RydWN0b3IuX19pbml0UHJvcGVydGllcztcclxuXHRcdFx0XHRcdGlmICghaW5pdFByb3BlcnRpZXMpIHtcclxuXHRcdFx0XHRcdFx0b2JqLmNvbnN0cnVjdG9yLl9faW5pdFByb3BlcnRpZXMgPSBpbml0UHJvcGVydGllcyA9IHt9O1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0aW5pdFByb3BlcnRpZXNbcHJvcF0gPSBkZXNjLmdldDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIGFzc3VtZSBpdCBpcyBqdXN0IGEgZGF0YSBwcm9wZXJ0eVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRvYmpbcHJvcF0gPSBkZXNjLnZhbHVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyB0aHJvdyBhbiBleGNlcHRpb24gaWYgdGhlIHByb3BlcnR5IGhhcyBhIHNldHRlciwgd2hpY2ggaXMgZGVmaW5pdGVseSBub3Qgc3VwcG9ydGVkXHJcblx0XHRcdGlmIChcInNldFwiIGluIGRlc2MpIHRocm93IG5ldyBFcnJvcihcIlNldHRlcnMgYXJlIG5vdCBzdXBwb3J0ZWQgYnkgdGhlIGN1cnJlbnQgYnJvd3Nlci4gIFVzZSBkZWZpbmVQcm9wZXJ0eVN1cHBvcnRlZCB0byBjaGVjayBmb3IgZnVsbCBzdXBwb3J0LlwiKTtcclxuXHRcdH07XHJcblx0fVxyXG5cclxuXHR0cnkge1xyXG5cdFx0Ly8gZW11bGF0ZSBFUzUgZ2V0dGVyL3NldHRlciBBUEkgdXNpbmcgbGVnYWN5IEFQSXNcclxuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLl9fZGVmaW5lR2V0dGVyX18gJiYgIU9iamVjdC5kZWZpbmVQcm9wZXJ0eSkge1xyXG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkgPSBmdW5jdGlvbiAob2JqLCBwcm9wLCBkZXNjKSB7XHJcblxyXG5cdFx0XHRcdC8vIHByb3BlcnR5IHdpdGggZ2V0dGVyXHJcblx0XHRcdFx0aWYgKFwiZ2V0XCIgaW4gZGVzYykgb2JqLl9fZGVmaW5lR2V0dGVyX18ocHJvcCwgZGVzYy5nZXQpO1xyXG5cclxuXHRcdFx0XHQvLyBwcm9wZXJ0eSB3aXRoIHNldHRlclxyXG5cdFx0XHRcdGlmIChcInNldFwiIGluIGRlc2MpIG9iai5fX2RlZmluZVNldHRlcl9fKHByb3AsIGRlc2Muc2V0KTtcclxuXHJcblx0XHRcdFx0Ly8gZGF0YSBvbmx5IHByb3BlcnR5XHJcblx0XHRcdFx0aWYgKCEoXCJnZXRcIiBpbiBkZXNjIHx8IFwic2V0XCIgaW4gZGVzYykpIHtcclxuXHJcblx0XHRcdFx0XHQvLyByZWFkL3dyaXRlIHByb3BlcnR5XHJcblx0XHRcdFx0XHRpZiAoZGVzYy53cml0YWJsZSkge1xyXG5cdFx0XHRcdFx0XHR2YXIgdmFsdWUgPSBkZXNjLnZhbHVlO1xyXG5cdFx0XHRcdFx0XHRvYmouX19kZWZpbmVHZXR0ZXJfXyhwcm9wLCBmdW5jdGlvbiAoKSB7IHJldHVybiB2YWx1ZTsgfSk7XHJcblx0XHRcdFx0XHRcdG9iai5fX2RlZmluZVNldHRlcl9fKHByb3AsIGZ1bmN0aW9uICh2YWwpIHsgdmFsdWUgPSB2YWw7IH0pO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdC8vIHJlYWQgb25seSBwcm9wZXJ0eVxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdHZhciB2YWx1ZSA9IGRlc2MudmFsdWU7XHJcblx0XHRcdFx0XHRcdG9iai5fX2RlZmluZUdldHRlcl9fKHByb3AsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHZhbHVlOyB9KTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH07XHJcblx0XHRcdGRlZmluZVByb3BlcnR5U3VwcG9ydGVkID0gdHJ1ZTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBvdGhlcndpc2UsIGVuc3VyZSBkZWZpbmVQcm9wZXJ0eSBhY3R1YWxseSB3b3Jrc1xyXG5cdFx0ZWxzZSBpZiAoT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwgXCJ4XCIsIHsgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0cnVlIH0gfSkueCkge1xyXG5cdFx0XHRkZWZpbmVQcm9wZXJ0eVN1cHBvcnRlZCA9IHRydWU7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gZW5hYmxlIGxlZ2FjeSBzdXBwb3J0XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0ZGVmaW5lTGVnYWN5UHJvcGVydHkoKTtcclxuXHRcdH1cclxuXHR9IFxyXG5cclxuXHQvLyBubyBnZXR0ZXIvc2V0dGVyIHN1cHBvcnRcclxuXHRjYXRjaCAoZSkge1xyXG5cclxuXHRcdC8vIGVuYWJsZSBsZWdhY3kgc3VwcG9ydFxyXG5cdFx0ZGVmaW5lTGVnYWN5UHJvcGVydHkoKTtcclxuXHR9XHJcblxyXG5cdC8vIGNsYXNzZXMgdGhhdCBjYWxsIGRlZmluZSBwcm9wZXJ0eSBzaG91bGRcclxuXHRmdW5jdGlvbiBpbml0aWFsaXplTGVnYWN5UHJvcGVydGllcyhvYmopIHtcclxuXHRcdGlmIChkZWZpbmVQcm9wZXJ0eVN1cHBvcnRlZCkgcmV0dXJuO1xyXG5cdFx0dmFyIGluaXRQcm9wZXJ0aWVzID0gb2JqLmNvbnN0cnVjdG9yLl9faW5pdFByb3BlcnRpZXM7XHJcblx0XHRpZiAoaW5pdFByb3BlcnRpZXMpIHtcclxuXHRcdFx0Zm9yICh2YXIgcCBpbiBpbml0UHJvcGVydGllcykge1xyXG5cdFx0XHRcdG9ialtwXSA9IGluaXRQcm9wZXJ0aWVzW3BdLmNhbGwob2JqLCBvYmopO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvLyBldmFsUGF0aCBpbnRlcm5hbCB1dGlsaXR5IGZ1bmN0aW9uXHJcblx0ZnVuY3Rpb24gZXZhbFBhdGgob2JqLCBwYXRoLCBudWxsVmFsdWUsIHVuZGVmaW5lZFZhbHVlKSB7XHJcblx0XHR2YXIgaSwgbmFtZSwgc3RlcHMgPSBwYXRoLnNwbGl0KFwiLlwiKSwgc291cmNlLCB2YWx1ZSA9IG9iajtcclxuXHJcblx0XHRpZiAodmFsdWUgPT09IG51bGwpIHtcclxuXHRcdFx0cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPj0gMyA/IG51bGxWYWx1ZSA6IG51bGw7XHJcblx0XHR9XHJcblx0XHRpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRyZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA+PSA0ID8gdW5kZWZpbmVkVmFsdWUgOiB1bmRlZmluZWQ7XHJcblx0XHR9XHJcblxyXG5cdFx0Zm9yIChpID0gMDsgaSA8IHN0ZXBzLmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdG5hbWUgPSBzdGVwc1tpXTtcclxuXHRcdFx0c291cmNlID0gdmFsdWU7XHJcblx0XHRcdHZhbHVlID0gZ2V0VmFsdWUoc291cmNlLCBuYW1lKTtcclxuXHJcblx0XHRcdGlmICh2YWx1ZSA9PT0gbnVsbCkge1xyXG5cdFx0XHRcdHJldHVybiBhcmd1bWVudHMubGVuZ3RoID49IDMgPyBudWxsVmFsdWUgOiBudWxsO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPj0gNCA/IHVuZGVmaW5lZFZhbHVlIDogdW5kZWZpbmVkO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHZhbHVlO1xyXG5cdH1cclxuXHJcblx0RXhvV2ViLmV2YWxQYXRoID0gZXZhbFBhdGg7XHJcblxyXG5cdGZ1bmN0aW9uIGdldExhc3RUYXJnZXQodGFyZ2V0LCBwcm9wZXJ0eVBhdGgpIHtcclxuXHRcdHZhciBpLCBwYXRoQXJyYXksIGZpbmFsVGFyZ2V0ID0gdGFyZ2V0O1xyXG5cclxuXHRcdGlmIChwcm9wZXJ0eVBhdGggPT0gbnVsbCkgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEVycm9yKFwicHJvcGVydHlQYXRoXCIpO1xyXG5cclxuXHRcdGlmIChwcm9wZXJ0eVBhdGguY29uc3RydWN0b3IgPT0gU3RyaW5nKSB7XHJcblx0XHRcdHBhdGhBcnJheSA9IHByb3BlcnR5UGF0aC5zcGxpdChcIi5cIik7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0aWYgKCEocHJvcGVydHlQYXRoIGluc3RhbmNlb2YgQXJyYXkpKSB0aHJvdyBBcmd1bWVudFR5cGVFcnJvcihcInByb3BlcnR5UGF0aFwiLCBcInN0cmluZ3xhcnJheVwiLCBwcm9wZXJ0eVBhdGgpO1xyXG5cdFx0XHRwYXRoQXJyYXkgPSBwcm9wZXJ0eVBhdGg7XHJcblx0XHR9XHJcblxyXG5cdFx0Zm9yIChpID0gMDsgaSA8IHBhdGhBcnJheS5sZW5ndGggLSAxOyBpKyspIHtcclxuXHRcdFx0aWYgKGZpbmFsVGFyZ2V0KSB7XHJcblx0XHRcdFx0ZmluYWxUYXJnZXQgPSBnZXRWYWx1ZShmaW5hbFRhcmdldCwgcGF0aEFycmF5W2ldKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBmaW5hbFRhcmdldDtcclxuXHR9XHJcblxyXG5cdEV4b1dlYi5nZXRMYXN0VGFyZ2V0ID0gZ2V0TGFzdFRhcmdldDtcclxuXHR3aW5kb3cuJGxhc3RUYXJnZXQgPSBnZXRMYXN0VGFyZ2V0O1xyXG5cclxuXHQvLyBJZiBhIGdldHRlciBtZXRob2QgbWF0Y2hpbmcgdGhlIGdpdmVuIHByb3BlcnR5IG5hbWUgaXMgZm91bmQgb24gdGhlIHRhcmdldCBpdCBpcyBpbnZva2VkIGFuZCByZXR1cm5zIHRoZSBcclxuXHQvLyB2YWx1ZSwgdW5sZXNzIHRoZSB0aGUgdmFsdWUgaXMgdW5kZWZpbmVkLCBpbiB3aGljaCBjYXNlIG51bGwgaXMgcmV0dXJuZWQgaW5zdGVhZC4gIFRoaXMgaXMgZG9uZSBzbyB0aGF0IFxyXG5cdC8vIGNhbGxpbmcgY29kZSBjYW4gaW50ZXJwcmV0IGEgcmV0dXJuIHZhbHVlIG9mIHVuZGVmaW5lZCB0byBtZWFuIHRoYXQgdGhlIHByb3BlcnR5IGl0IHJlcXVlc3RlZCBkb2VzIG5vdCBleGlzdC5cclxuXHQvLyBUT0RPOiBiZXR0ZXIgbmFtZVxyXG5cdGZ1bmN0aW9uIGdldFZhbHVlKHRhcmdldCwgcHJvcGVydHkpIHtcclxuXHRcdHZhciB2YWx1ZTtcclxuXHJcblx0XHQvLyB0aGUgc2VlIGlmIHRoZXJlIGlzIGFuIGV4cGxpY2l0IGdldHRlciBmdW5jdGlvbiBmb3IgdGhlIHByb3BlcnR5XHJcblx0XHR2YXIgZ2V0dGVyID0gdGFyZ2V0W1wiZ2V0X1wiICsgcHJvcGVydHldO1xyXG5cdFx0aWYgKGdldHRlcikge1xyXG5cdFx0XHR2YWx1ZSA9IGdldHRlci5jYWxsKHRhcmdldCk7XHJcblx0XHRcdGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0dmFsdWUgPSBudWxsO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gb3RoZXJ3aXNlIHNlYXJjaCBmb3IgdGhlIHByb3BlcnR5XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0aWYgKChpc09iamVjdCh0YXJnZXQpICYmIHByb3BlcnR5IGluIHRhcmdldCkgfHxcclxuXHRcdFx0XHRPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodGFyZ2V0LCBwcm9wZXJ0eSkgfHxcclxuXHRcdFx0XHQodGFyZ2V0LmNvbnN0cnVjdG9yID09PSBTdHJpbmcgJiYgL15bMC05XSskLy50ZXN0KHByb3BlcnR5KSAmJiBwYXJzZUludChwcm9wZXJ0eSwgMTApIDwgdGFyZ2V0Lmxlbmd0aCkpIHtcclxuXHRcdFx0XHR2YWx1ZSA9IHRhcmdldFtwcm9wZXJ0eV07XHJcblx0XHRcdFx0aWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRcdHZhbHVlID0gbnVsbDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoL1xcLi8udGVzdChwcm9wZXJ0eSkpIHtcclxuXHRcdFx0XHRsb2dXYXJuaW5nKFwiUG9zc2libGUgaW5jb3JyZWN0IHVzYWdlIG9mIFxcXCJnZXRWYWx1ZSgpXFxcIiwgdGhlIHBhdGggXFxcIlwiICsgcHJvcGVydHkgKyBcIlxcXCIgZG9lcyBub3QgZXhpc3Qgb24gdGhlIHRhcmdldCBhbmQgYXBwZWFycyB0byByZXByZXNlbnQgYSBtdWx0aS1ob3AgcGF0aC5cIik7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gdmFsdWU7XHJcblx0fVxyXG5cclxuXHRFeG9XZWIuZ2V0VmFsdWUgPSBnZXRWYWx1ZTtcclxuXHJcblx0ZnVuY3Rpb24gZ2V0Q3Rvcih0eXBlKSB7XHJcblxyXG5cdFx0Ly8gT25seSByZXR1cm4gYSB2YWx1ZSBpZiB0aGUgYXJndW1lbnQgaXMgZGVmaW5lZFxyXG5cdFx0aWYgKHR5cGUgIT09IHVuZGVmaW5lZCAmJiB0eXBlICE9PSBudWxsKSB7XHJcblxyXG5cdFx0XHQvLyBJZiB0aGUgYXJndW1lbnQgaXMgYSBmdW5jdGlvbiB0aGVuIHJldHVybiBpdCBpbW1lZGlhdGVseS5cclxuXHRcdFx0aWYgKGlzVHlwZSh0eXBlLCBGdW5jdGlvbikpIHtcclxuXHRcdFx0XHRyZXR1cm4gdHlwZTtcclxuXHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dmFyIGN0b3I7XHJcblxyXG5cdFx0XHRcdGlmIChpc1R5cGUodHlwZSwgU3RyaW5nKSkge1xyXG5cdFx0XHRcdFx0Ly8gcmVtb3ZlIFwid2luZG93LlwiIGZyb20gdGhlIHR5cGUgbmFtZSBzaW5jZSBpdCBpcyBpbXBsaWVkXHJcblx0XHRcdFx0XHR0eXBlID0gdHlwZS5yZXBsYWNlKC8od2luZG93XFwuKT8oLiopLywgXCIkMlwiKTtcclxuXHJcblx0XHRcdFx0XHQvLyBldmFsdWF0ZSB0aGUgcGF0aFxyXG5cdFx0XHRcdFx0Y3RvciA9IGV2YWxQYXRoKHdpbmRvdywgdHlwZSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyB3YXJuIChhbmQgaW1wbGljaXRseSByZXR1cm4gdW5kZWZpbmVkKSBpZiB0aGUgcmVzdWx0IGlzIG5vdCBhIGphdmFzY3JpcHQgZnVuY3Rpb25cclxuXHRcdFx0XHRpZiAoY3RvciAhPT0gdW5kZWZpbmVkICYmIGN0b3IgIT09IG51bGwgJiYgIWlzVHlwZShjdG9yLCBGdW5jdGlvbikpIHtcclxuXHRcdFx0XHRcdGxvZ1dhcm5pbmcoXCJUaGUgZ2l2ZW4gdHlwZSBcXFwiXCIgKyB0eXBlICsgXCJcXFwiIGlzIG5vdCBhIGZ1bmN0aW9uLlwiKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gY3RvcjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdEV4b1dlYi5nZXRDdG9yID0gZ2V0Q3RvcjtcclxuXHJcblx0ZnVuY3Rpb24gaXNUeXBlKHZhbCwgdHlwZSkge1xyXG5cclxuXHRcdC8vIEV4aXQgZWFybHkgZm9yIGNoZWNraW5nIGZ1bmN0aW9uIHR5cGVcclxuXHRcdGlmICh2YWwgIT09IHVuZGVmaW5lZCAmJiB2YWwgIT09IG51bGwgJiYgdmFsID09PSBGdW5jdGlvbiAmJiB0eXBlICE9PSB1bmRlZmluZWQgJiYgdHlwZSAhPT0gbnVsbCAmJiB0eXBlID09PSBGdW5jdGlvbikge1xyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgY3RvciA9IGdldEN0b3IodHlwZSk7XHJcblxyXG5cdFx0Ly8gZW5zdXJlIGEgZGVmaW5lZCB2YWx1ZSBhbmQgY29uc3RydWN0b3JcclxuXHRcdHJldHVybiB2YWwgIT09IHVuZGVmaW5lZCAmJiB2YWwgIT09IG51bGwgJiZcclxuXHRcdFx0XHRjdG9yICE9PSB1bmRlZmluZWQgJiYgY3RvciAhPT0gbnVsbCAmJlxyXG5cdFx0XHRcdC8vIGFjY29tb2RhdGUgb2JqZWN0cyAoaW5zdGFuY2VvZikgYXMgd2VsbCBhcyBpbnRyaW5zaWMgdmFsdWUgdHlwZXMgKFN0cmluZywgTnVtYmVyLCBldGMpXHJcblx0XHRcdFx0KHZhbCBpbnN0YW5jZW9mIGN0b3IgfHwgdmFsLmNvbnN0cnVjdG9yID09PSBjdG9yKTtcclxuXHR9XHJcblxyXG5cdEV4b1dlYi5pc1R5cGUgPSBpc1R5cGU7XHJcblxyXG5cdGZ1bmN0aW9uIGVhY2hQcm9wKG9iaiwgY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdHZhciBwcm9wO1xyXG5cdFx0Zm9yIChwcm9wIGluIG9iaikge1xyXG5cdFx0XHRpZiAob2JqLmhhc093blByb3BlcnR5KHByb3ApKSB7XHJcblx0XHRcdFx0aWYgKGNhbGxiYWNrLmFwcGx5KHRoaXNQdHIgfHwgdGhpcywgW3Byb3AsIG9ialtwcm9wXV0pID09PSBmYWxzZSkge1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRFeG9XZWIuZWFjaFByb3AgPSBlYWNoUHJvcDtcclxuXHJcblx0ZnVuY3Rpb24gb2JqZWN0VG9BcnJheShvYmopIHtcclxuXHRcdHZhciBsaXN0ID0gW107XHJcblx0XHRlYWNoUHJvcChvYmosIGZ1bmN0aW9uKHByb3AsIHZhbHVlKSB7XHJcblx0XHRcdGxpc3QucHVzaCh2YWx1ZSk7XHJcblx0XHR9KTtcclxuXHRcdHJldHVybiBsaXN0O1xyXG5cdH1cclxuXHJcblx0RXhvV2ViLm9iamVjdFRvQXJyYXkgPSBvYmplY3RUb0FycmF5O1xyXG5cclxuXHRmdW5jdGlvbiAkZm9ybWF0KHN0ciwgdmFsdWVzKSB7XHJcblx0XHR2YXIgc291cmNlO1xyXG5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikge1xyXG5cdFx0XHRyZXR1cm4gc3RyO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID4gMikge1xyXG5cdFx0XHQvLyB1c2UgYXJndW1lbnRzIHBhc3NlZCB0byBmdW5jdGlvbiBhcyBhcnJheVxyXG5cdFx0XHRzb3VyY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHNvdXJjZSA9ICEodmFsdWVzIGluc3RhbmNlb2YgQXJyYXkpID8gW3ZhbHVlc10gOiB2YWx1ZXM7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHN0ci5yZXBsYWNlKC9cXHsoWzAtOV0rKVxcfS9pZywgZnVuY3Rpb24gKG1hdGNoLCBpbmRleFN0cikge1xyXG5cdFx0XHR2YXIgaW5kZXggPSBwYXJzZUludChpbmRleFN0ciwgMTApO1xyXG5cdFx0XHR2YXIgcmVzdWx0ID0gc291cmNlW2luZGV4XTtcclxuXHJcblx0XHRcdGlmIChyZXN1bHQgIT09IG51bGwgJiYgcmVzdWx0ICE9PSB1bmRlZmluZWQgJiYgcmVzdWx0LmNvbnN0cnVjdG9yICE9PSBTdHJpbmcpIHtcclxuXHRcdFx0XHRyZXN1bHQgPSByZXN1bHQudG9TdHJpbmcoKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0d2luZG93LiRmb3JtYXQgPSAkZm9ybWF0O1xyXG5cclxuXHRmdW5jdGlvbiBtYWtlSHVtYW5SZWFkYWJsZSh0ZXh0KSB7XHJcblx0XHRyZXR1cm4gdGV4dC5yZXBsYWNlKC8oW15BLVpdKykoW0EtWl0pL2csIFwiJDEgJDJcIik7XHJcblx0fVxyXG5cclxuXHRFeG9XZWIubWFrZUh1bWFuUmVhZGFibGUgPSBtYWtlSHVtYW5SZWFkYWJsZTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5UaW1lU3BhblxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIFRpbWVTcGFuKG1zKSB7XHJcblx0XHQvLy8gPGZpZWxkIG5hbWU9XCJ0b3RhbFNlY29uZHNcIiB0eXBlPVwiTnVtYmVyXCI+VGhlIHRhcmdldCBlbnRpdHkgdGhlIGNvbmRpdGlvbiBpcyBhc3NvY2lhdGVkIHdpdGguPC9maWVsZD5cclxuXHJcblx0XHR0aGlzLnRvdGFsTWlsbGlzZWNvbmRzID0gbXM7XHJcblxyXG5cdFx0aW5pdGlhbGl6ZUxlZ2FjeVByb3BlcnRpZXModGhpcyk7XHJcblx0fVxyXG5cclxuXHRUaW1lU3Bhbi5taXhpbih7XHJcblx0XHR0b3RhbFNlY29uZHM6IHsgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLnRvdGFsTWlsbGlzZWNvbmRzIC8gMTAwMDsgfSwgaW5pdDogdHJ1ZSB9LFxyXG5cdFx0dG90YWxNaW51dGVzOiB7IGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy50b3RhbFNlY29uZHMgLyA2MDsgfSwgaW5pdDogdHJ1ZSB9LFxyXG5cdFx0dG90YWxIb3VyczogeyBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMudG90YWxNaW51dGVzIC8gNjA7IH0sIGluaXQ6IHRydWUgfSxcclxuXHRcdHRvdGFsRGF5czogeyBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMudG90YWxIb3VycyAvIDI0OyB9LCBpbml0OiB0cnVlIH0sXHJcblx0XHRtaWxsaXNlY29uZHM6IHsgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBNYXRoLmZsb29yKHRoaXMudG90YWxNaWxsaXNlY29uZHMgJSAxMDAwKTsgfSwgaW5pdDogdHJ1ZSB9LFxyXG5cdFx0c2Vjb25kczogeyBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIE1hdGguZmxvb3IodGhpcy50b3RhbFNlY29uZHMgJSA2MCk7IH0sIGluaXQ6IHRydWUgfSxcclxuXHRcdG1pbnV0ZXM6IHsgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBNYXRoLmZsb29yKHRoaXMudG90YWxNaW51dGVzICUgNjApOyB9LCBpbml0OiB0cnVlIH0sXHJcblx0XHRob3VyczogeyBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIE1hdGguZmxvb3IodGhpcy50b3RhbEhvdXJzICUgMjQpOyB9LCBpbml0OiB0cnVlIH0sXHJcblx0XHRkYXlzOiB7IGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gTWF0aC5mbG9vcih0aGlzLnRvdGFsRGF5cyk7IH0sIGluaXQ6IHRydWUgfSxcclxuXHRcdHRvT2JqZWN0OiBmdW5jdGlvbigpIHtcclxuXHRcdFx0cmV0dXJuIHtcclxuXHRcdFx0XHRIb3VyczogdGhpcy5ob3VycyxcclxuXHRcdFx0XHRNaW51dGVzOiB0aGlzLm1pbnV0ZXMsXHJcblx0XHRcdFx0U2Vjb25kczogdGhpcy5zZWNvbmRzLFxyXG5cdFx0XHRcdE1pbGxpc2Vjb25kczogdGhpcy5taWxsaXNlY29uZHMsXHJcblx0XHRcdFx0VGlja3M6IHRoaXMudG90YWxNaWxsaXNlY29uZHMgKiAxMDAwMDAwIC8gMTAwLFxyXG5cdFx0XHRcdERheXM6IHRoaXMuZGF5cyxcclxuXHRcdFx0XHRUb3RhbERheXM6IHRoaXMudG90YWxEYXlzLFxyXG5cdFx0XHRcdFRvdGFsSG91cnM6IHRoaXMudG90YWxIb3VycyxcclxuXHRcdFx0XHRUb3RhbE1pbGxpc2Vjb25kczogdGhpcy50b3RhbE1pbGxpc2Vjb25kcyxcclxuXHRcdFx0XHRUb3RhbE1pbnV0ZXM6IHRoaXMudG90YWxNaW51dGVzLFxyXG5cdFx0XHRcdFRvdGFsU2Vjb25kczogdGhpcy50b3RhbFNlY29uZHNcclxuXHRcdFx0fTtcclxuXHRcdH0sXHJcblx0XHR2YWx1ZU9mOiBmdW5jdGlvbigpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMudG90YWxNaWxsaXNlY29uZHM7XHJcblx0XHR9LFxyXG5cdFx0dG9TdHJpbmc6IGZ1bmN0aW9uIFRpbWVTcGFuJHRvU3RyaW5nKCkgeyBcclxuXHRcdFx0dmFyIG51bTtcclxuXHRcdFx0dmFyIGxhYmVsO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMudG90YWxIb3VycyA8IDEpIHtcclxuXHRcdFx0XHRudW0gPSBNYXRoLnJvdW5kKHRoaXMudG90YWxNaW51dGVzKTtcclxuXHRcdFx0XHRsYWJlbCA9IFwibWludXRlXCI7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAodGhpcy50b3RhbERheXMgPCAxKSB7XHJcblx0XHRcdFx0bnVtID0gTWF0aC5yb3VuZCh0aGlzLnRvdGFsSG91cnMgKiAxMDApIC8gMTAwO1xyXG5cdFx0XHRcdGxhYmVsID0gXCJob3VyXCI7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0bnVtID0gTWF0aC5yb3VuZCh0aGlzLnRvdGFsRGF5cyAqIDEwMCkgLyAxMDA7XHJcblx0XHRcdFx0bGFiZWwgPSBcImRheVwiO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZXR1cm4gbnVtID09IDEgPyAobnVtICsgXCIgXCIgKyBsYWJlbCkgOiAobnVtICsgXCIgXCIgKyBsYWJlbCArIFwic1wiKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0d2luZG93LlRpbWVTcGFuID0gVGltZVNwYW47XHJcblxyXG5cdERhdGUubWl4aW4oe1xyXG5cdFx0c3VidHJhY3Q6IGZ1bmN0aW9uIERhdGUkc3VidHJhY3QoZCkge1xyXG5cdFx0XHRyZXR1cm4gbmV3IFRpbWVTcGFuKHRoaXMgLSBkKTtcclxuXHRcdH0sXHJcblx0XHRhZGQ6IGZ1bmN0aW9uIERhdGUkYWRkKHRpbWVTcGFuKSB7XHJcblx0XHRcdHJldHVybiBuZXcgRGF0ZSh0aGlzLmdldFRpbWUoKSArIHRpbWVTcGFuLnRvdGFsTWlsbGlzZWNvbmRzKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5EYXRlXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0dmFyIGRheU9mV2VlayA9IHt9O1xyXG5cdHZhciBkYXlzID0gW1wic3VuZGF5XCIsIFwibW9uZGF5XCIsIFwidHVlc2RheVwiLCBcIndlZG5lc2RheVwiLCBcInRodXJzZGF5XCIsIFwiZnJpZGF5XCIsIFwic2F0dXJkYXlcIl07XHJcblx0ZGF5cy5mb3JFYWNoKGZ1bmN0aW9uKGRheSwgaSkge1xyXG5cdFx0ZGF5T2ZXZWVrW2RheV0gPSBpO1xyXG5cdH0pO1xyXG5cclxuXHREYXRlLnByb3RvdHlwZS50b0RhdGUgPSBmdW5jdGlvbiB0b0RhdGUoKSB7XHJcblx0XHRyZXR1cm4gbmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLCB0aGlzLmdldE1vbnRoKCksIHRoaXMuZ2V0RGF0ZSgpKTtcclxuXHR9O1xyXG5cclxuXHREYXRlLnByb3RvdHlwZS5hZGRZZWFycyA9IGZ1bmN0aW9uIGFkZFllYXJzKG51bVllYXJzKSB7XHJcblx0XHRyZXR1cm4gbmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpICsgbnVtWWVhcnMsIHRoaXMuZ2V0TW9udGgoKSwgdGhpcy5nZXREYXRlKCksIHRoaXMuZ2V0SG91cnMoKSwgdGhpcy5nZXRNaW51dGVzKCksIHRoaXMuZ2V0U2Vjb25kcygpLCB0aGlzLmdldE1pbGxpc2Vjb25kcygpKTtcclxuXHR9O1xyXG5cclxuXHREYXRlLnByb3RvdHlwZS5hZGREYXlzID0gZnVuY3Rpb24gYWRkRGF5cyhudW1EYXlzLCByZXF1aXJlV2Vla0RheSkge1xyXG5cdFx0dmFyIGRhdGUgPSBuZXcgRGF0ZSh0aGlzLmdldEZ1bGxZZWFyKCksIHRoaXMuZ2V0TW9udGgoKSwgdGhpcy5nZXREYXRlKCkgKyBudW1EYXlzLCB0aGlzLmdldEhvdXJzKCksIHRoaXMuZ2V0TWludXRlcygpLCB0aGlzLmdldFNlY29uZHMoKSwgdGhpcy5nZXRNaWxsaXNlY29uZHMoKSk7XHJcblxyXG5cdFx0Ly8gSWYgcmVxdWlyZVdlZWtEYXkgaXMgdHJ1ZSBhbmQgdGhlIGRheSBmYWxscyBvbiBhIFNhdHVyZGF5IG9yIFN1bmRheSwgdGhlblxyXG5cdFx0Ly8gdGhlIHRoZSByZXN1bHQgd2lsbCBiZSBtb3ZlZCBiYWNrIHRvIHRoZSBwcmVjZWVkaW5nIGZyaWRheSAod2hlbiBzdWJ0cmFjdGluZyBkYXlzKVxyXG5cdFx0Ly8gb3IgZm9yd2FyZCB0byB0aGUgbmV4dCBtb25kYXkgKHdoZW4gYWRkaW5nIGRheXMpLlxyXG5cdFx0aWYgKHJlcXVpcmVXZWVrRGF5ID09PSB0cnVlKSB7XHJcblx0XHRcdC8vIFN1bmRheVxyXG5cdFx0XHRpZiAoZGF0ZS5nZXREYXkoKSA9PT0gMCkge1xyXG5cdFx0XHRcdGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIChudW1EYXlzID49IDAgPyAxIDogLTIpKTtcclxuXHRcdFx0fVxyXG5cdFx0XHQvLyBTYXR1cmRheSBcclxuXHRcdFx0ZWxzZSBpZiAoZGF0ZS5nZXREYXkoKSA9PT0gNikge1xyXG5cdFx0XHRcdGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIChudW1EYXlzID49IDAgPyAyIDogLTEpKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBkYXRlO1xyXG5cdH07XHJcblxyXG5cdHZhciBvbmVIb3VySW5NaWxsaXNlY29uZHMgPSAxMDAwICogNjAgKiA2MDtcclxuXHJcblx0RGF0ZS5wcm90b3R5cGUuYWRkSG91cnMgPSBmdW5jdGlvbiBhZGRIb3VycyhudW1Ib3Vycykge1xyXG5cdFx0cmV0dXJuIG5ldyBEYXRlKCt0aGlzICsgKG9uZUhvdXJJbk1pbGxpc2Vjb25kcyAqIG51bUhvdXJzKSk7XHJcblx0fTtcclxuXHJcblx0ZnVuY3Rpb24gZ2V0RGF5T2ZXZWVrKGRheSkge1xyXG5cdFx0aWYgKGRheSAhPT0gdW5kZWZpbmVkICYmIGRheSAhPT0gbnVsbCAmJiBkYXkuY29uc3RydWN0b3IgPT09IFN0cmluZylcclxuXHRcdFx0ZGF5ID0gZGF5cy5pbmRleE9mKGRheS50b0xvd2VyQ2FzZSgpKTtcclxuXHRcdGVsc2UgaWYgKGRheSAhPT0gdW5kZWZpbmVkICYmIGRheSAhPT0gbnVsbCAmJiBkYXkuY29uc3RydWN0b3IgIT09IE51bWJlcilcclxuXHRcdFx0ZGF5ID0gbnVsbDtcclxuXHJcblx0XHRyZXR1cm4gZGF5ID49IDAgJiYgZGF5IDwgZGF5cy5sZW5ndGggPyBkYXkgOiBudWxsO1xyXG5cdH1cclxuXHJcblx0RGF0ZS5wcm90b3R5cGUuc3RhcnRPZldlZWsgPSBmdW5jdGlvbihzdGFydE9mV2Vla0RheSkge1xyXG5cdFx0dmFyIHN0YXJ0T2ZXZWVrID0gZ2V0RGF5T2ZXZWVrKHN0YXJ0T2ZXZWVrRGF5KSB8fCBkYXlPZldlZWsubW9uZGF5OyAvLyBtb25kYXkgYnkgZGVmYXVsdFxyXG5cdFx0cmV0dXJuIHRoaXMuYWRkRGF5cyhzdGFydE9mV2VlayAtIHRoaXMuZ2V0RGF5KCkpO1xyXG5cdH07XHJcblxyXG5cdERhdGUucHJvdG90eXBlLndlZWtPZlllYXIgPSBmdW5jdGlvbihzdGFydE9mV2Vla0RheSkge1xyXG5cdFx0dmFyIHN0YXJ0T2ZXZWVrID0gZ2V0RGF5T2ZXZWVrKHN0YXJ0T2ZXZWVrRGF5KSB8fCBkYXlPZldlZWsubW9uZGF5OyAvLyBtb25kYXkgYnkgZGVmYXVsdFxyXG5cclxuXHRcdGlmICh0aGlzLnN0YXJ0T2ZXZWVrKHN0YXJ0T2ZXZWVrKS5nZXRZZWFyKCkgPCB0aGlzLmdldFllYXIoKSkge1xyXG5cdFx0XHRyZXR1cm4gMDtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgZmlyc3REYXlPZlllYXIgPSBuZXcgRGF0ZSh0aGlzLmdldEZ1bGxZZWFyKCksIDAsIDEpO1xyXG5cdFx0dmFyIGZpcnN0V2VlayA9IGZpcnN0RGF5T2ZZZWFyLnN0YXJ0T2ZXZWVrKHN0YXJ0T2ZXZWVrKTtcclxuXHRcdGlmIChmaXJzdFdlZWsuZ2V0RnVsbFllYXIoKSA8IGZpcnN0RGF5T2ZZZWFyLmdldEZ1bGxZZWFyKCkpIHtcclxuXHRcdFx0Zmlyc3RXZWVrID0gZmlyc3RXZWVrLmFkZERheXMoNyk7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIHdlZWtzID0gMDtcclxuXHRcdHZhciB0YXJnZXQgPSB0aGlzLnRvRGF0ZSgpO1xyXG5cdFx0Zm9yICh2YXIgZGF5ID0gZmlyc3RXZWVrOyBkYXkgPD0gdGFyZ2V0OyBkYXkgPSBkYXkuYWRkRGF5cyg3KSkge1xyXG5cdFx0XHR3ZWVrcysrO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiB3ZWVrcztcclxuXHR9O1xyXG5cclxuXHREYXRlLnByb3RvdHlwZS53ZWVrRGlmZmVyZW5jZSA9IGZ1bmN0aW9uIChvdGhlciwgc3RhcnRPZldlZWspIHtcclxuXHRcdHZhciBpc05lZ2F0aXZlID0gb3RoZXIgPD0gdGhpcztcclxuXHRcdHZhciBhID0gdGhpcywgYiA9IG90aGVyO1xyXG5cclxuXHRcdGlmIChpc05lZ2F0aXZlKVxyXG5cdFx0e1xyXG5cdFx0XHRhID0gb3RoZXI7XHJcblx0XHRcdGIgPSB0aGlzO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBhV2VlayA9IGEud2Vla09mWWVhcihzdGFydE9mV2Vlayk7XHJcblx0XHR2YXIgYldlZWsgPSBiLndlZWtPZlllYXIoc3RhcnRPZldlZWspO1xyXG5cclxuXHRcdGZvciAodmFyIGkgPSBhLmdldEZ1bGxZZWFyKCk7IGkgPCBiLmdldEZ1bGxZZWFyKCk7IGkrKylcclxuXHRcdFx0YldlZWsgKz0gKG5ldyBEYXRlKGksIDExLCAzMSkpLndlZWtPZlllYXIoc3RhcnRPZldlZWspO1xyXG5cclxuXHRcdHJldHVybiBpc05lZ2F0aXZlID8gYVdlZWsgLSBiV2VlayA6IGJXZWVrIC0gYVdlZWs7XHJcblx0fTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5PYmplY3RcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHQvLyBvcmlnaW5hbCBjb2RlIGdyYWJiZWQgZnJvbSBodHRwOi8vb3Jhbmxvb25leS5jb20vZnVuY3Rpb25hbC1qYXZhc2NyaXB0L1xyXG5cdE9iamVjdC5jb3B5ID0gZnVuY3Rpb24gT2JqZWN0JENvcHkob2JqLCBvcHRpb25zLyosIGxldmVsKi8pIHtcclxuXHRcdGlmICghb3B0aW9ucykge1xyXG5cdFx0XHRvcHRpb25zID0ge307XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gaW5pdGlhbGl6ZSBtYXggbGV2ZWwgdG8gZGVmYXVsdCB2YWx1ZVxyXG5cdFx0aWYgKCFvcHRpb25zLm1heExldmVsKSB7XHJcblx0XHRcdG9wdGlvbnMubWF4TGV2ZWwgPSAyNTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBpbml0aWFsaXplIGxldmVsIHRvIGRlZmF1bHQgdmFsdWVcclxuXHRcdHZhciBsZXZlbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogMDtcclxuXHJcblx0XHRpZiAobGV2ZWwgPj0gb3B0aW9ucy5tYXhMZXZlbCB8fCB0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwgfHwgb2JqID09PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0cmV0dXJuIG9iajsgIC8vIG5vbi1vYmplY3QgaGF2ZSB2YWx1ZSBzZW1hdGljcywgc28gb2JqIGlzIGFscmVhZHkgYSBjb3B5LlxyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGlmIChvYmogaW5zdGFuY2VvZiBBcnJheSkge1xyXG5cdFx0XHRcdHZhciByZXN1bHQgPSBbXTtcclxuXHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IG9iai5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdFx0cmVzdWx0LnB1c2goT2JqZWN0LmNvcHkob2JqW2ldKSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHJldHVybiByZXN1bHQ7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dmFyIHZhbHVlID0gb2JqLnZhbHVlT2YoKTtcclxuXHRcdFx0XHRpZiAob2JqICE9IHZhbHVlKSB7XHJcblx0XHRcdFx0XHQvLyB0aGUgb2JqZWN0IGlzIGEgc3RhbmRhcmQgb2JqZWN0IHdyYXBwZXIgZm9yIGEgbmF0aXZlIHR5cGUsIHNheSBTdHJpbmcuXHJcblx0XHRcdFx0XHQvLyB3ZSBjYW4gbWFrZSBhIGNvcHkgYnkgaW5zdGFudGlhdGluZyBhIG5ldyBvYmplY3QgYXJvdW5kIHRoZSB2YWx1ZS5cclxuXHRcdFx0XHRcdHJldHVybiBuZXcgb2JqLmNvbnN0cnVjdG9yKHZhbHVlKTtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0Ly8gZG9uJ3QgY2xvbmUgZW50aXRpZXNcclxuXHRcdFx0XHRcdGlmICh0eXBlb2YoRW50aXR5KSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBvYmogaW5zdGFuY2VvZiBFbnRpdHkpIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIG9iajtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHQvLyBvaywgd2UgaGF2ZSBhIG5vcm1hbCBvYmplY3QuIGNvcHkgdGhlIHdob2xlIHRoaW5nLCBwcm9wZXJ0eS1ieS1wcm9wZXJ0eS5cclxuXHRcdFx0XHRcdFx0dmFyIGMgPSB7fTtcclxuXHRcdFx0XHRcdFx0Zm9yICh2YXIgcHJvcGVydHkgaW4gb2JqKSB7XHJcblx0XHRcdFx0XHRcdFx0Ly8gT3B0aW9uYWxseSBjb3B5IHByb3BlcnR5IHZhbHVlcyBhcyB3ZWxsXHJcblx0XHRcdFx0XHRcdFx0aWYgKG9wdGlvbnMuY29weUNoaWxkcmVuKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRjW3Byb3BlcnR5XSA9IE9iamVjdC5jb3B5KG9ialtwcm9wZXJ0eV0sIG9wdGlvbnMsIGxldmVsICsgMSk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0Y1twcm9wZXJ0eV0gPSBvYmpbcHJvcGVydHldO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0cmV0dXJuIGM7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0Ly8gQmFzZWQgb24gaHR0cHM6Ly92YW5pbGxhanN0b29sa2l0LmNvbS9wb2x5ZmlsbHMvb2JqZWN0YXNzaWduL1xyXG5cdGZ1bmN0aW9uIGFzc2lnbih0YXJnZXQsIHZhckFyZ3MpIHtcclxuXHRcdGlmICh0YXJnZXQgPT0gbnVsbCkgeyAvLyBUeXBlRXJyb3IgaWYgdW5kZWZpbmVkIG9yIG51bGxcclxuXHRcdFx0dGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNvbnZlcnQgdW5kZWZpbmVkIG9yIG51bGwgdG8gb2JqZWN0Jyk7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIHRvID0gT2JqZWN0KHRhcmdldCk7XHJcblxyXG5cdFx0Zm9yICh2YXIgaW5kZXggPSAxOyBpbmRleCA8IGFyZ3VtZW50cy5sZW5ndGg7IGluZGV4KyspIHtcclxuXHRcdFx0dmFyIG5leHRTb3VyY2UgPSBhcmd1bWVudHNbaW5kZXhdO1xyXG5cclxuXHRcdFx0aWYgKG5leHRTb3VyY2UgIT0gbnVsbCkgeyAvLyBTa2lwIG92ZXIgaWYgdW5kZWZpbmVkIG9yIG51bGxcclxuXHRcdFx0XHRmb3IgKHZhciBuZXh0S2V5IGluIG5leHRTb3VyY2UpIHtcclxuXHRcdFx0XHRcdC8vIEF2b2lkIGJ1Z3Mgd2hlbiBoYXNPd25Qcm9wZXJ0eSBpcyBzaGFkb3dlZFxyXG5cdFx0XHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChuZXh0U291cmNlLCBuZXh0S2V5KSkge1xyXG5cdFx0XHRcdFx0XHR0b1tuZXh0S2V5XSA9IG5leHRTb3VyY2VbbmV4dEtleV07XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdG87XHJcblx0fVxyXG5cclxuXHQvLyBCYXNlZCBvbiBodHRwczovL3ZhbmlsbGFqc3Rvb2xraXQuY29tL3BvbHlmaWxscy9vYmplY3RlbnRyaWVzL1xyXG5cdGZ1bmN0aW9uIGVudHJpZXMob2JqKSB7XHJcblx0XHR2YXIgb3duUHJvcHMgPSBPYmplY3Qua2V5cyhvYmopLFxyXG5cdFx0XHRpID0gb3duUHJvcHMubGVuZ3RoLFxyXG5cdFx0XHRyZXNBcnJheSA9IG5ldyBBcnJheShpKTsgLy8gcHJlYWxsb2NhdGUgdGhlIEFycmF5XHJcblxyXG5cdFx0d2hpbGUgKGktLSlcclxuXHRcdFx0cmVzQXJyYXlbaV0gPSBbb3duUHJvcHNbaV0sIG9ialtvd25Qcm9wc1tpXV1dO1xyXG5cclxuXHRcdHJldHVybiByZXNBcnJheTtcclxuXHR9XHJcblxyXG5cdGlmICghT2JqZWN0LmFzc2lnbilcclxuXHRcdE9iamVjdC5hc3NpZ24gPSBhc3NpZ247XHJcblx0aWYgKCFPYmplY3QuZW50cmllcylcclxuXHRcdE9iamVjdC5lbnRyaWVzID0gZW50cmllcztcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5PYnNlcnZlclxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdHZhciBPYnNlcnZlciA9IHsgfTtcclxuXHJcblx0T2JzZXJ2ZXIuYWRkUGF0aENoYW5nZWQgPSBmdW5jdGlvbiBPYnNlcnZlciRhZGRQYXRoQ2hhbmdlZCh0YXJnZXQsIHBhdGgsIGhhbmRsZXIsIGFsbG93Tm9UYXJnZXQpIHtcclxuXHRcdC8vIFRocm93IGFuIGVycm9yIGlmIHRoZSB0YXJnZXQgaXMgbnVsbCBvciB1bmRlZmluZWQsIHVubGVzcyB0aGUgY2FsbGluZyBjb2RlIHNwZWNpZmllcyB0aGF0IHRoaXMgaXMgb2tcclxuXHRcdGlmICh0YXJnZXQgPT0gbnVsbCkge1xyXG5cdFx0XHRpZiAoYWxsb3dOb1RhcmdldCA9PT0gdHJ1ZSkgcmV0dXJuO1xyXG5cdFx0XHRlbHNlIHRocm93IG5ldyBBcmd1bWVudE51bGxFcnJvcihcInRhcmdldFwiLCBcIidhbGxvd05vVGFyZ2V0JyBpcyBmYWxzZSAtIHBhdGggPSBcXFwiXCIgKyAocGF0aCBpbnN0YW5jZW9mIEFycmF5ID8gcGF0aC5qb2luKFwiLlwiKSA6IHBhdGgpICsgXCJcXFwiXCIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIEVuc3VyZSBhIHNldCBvZiBwYXRoIGNoYW5nZSBoYW5kbGVyc1xyXG5cdFx0aWYgKCF0YXJnZXQuX19wYXRoQ2hhbmdlSGFuZGxlcnMpIHtcclxuXHRcdFx0dGFyZ2V0Ll9fcGF0aENoYW5nZUhhbmRsZXJzID0ge307XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIGxpc3QgPSBwYXRoO1xyXG5cdFx0aWYgKHBhdGggaW5zdGFuY2VvZiBBcnJheSkge1xyXG5cdFx0XHRwYXRoID0gcGF0aC5qb2luKFwiLlwiKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRsaXN0ID0gcGF0aC5zcGxpdChcIi5cIik7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIHJvb3RzID0gW107XHJcblxyXG5cdFx0ZnVuY3Rpb24gcHJvY2Vzc1N0ZXAocGFyZW50LCBpdGVtLCBpbmRleCkge1xyXG5cdFx0XHR2YXIgb2JzZXJ2ZXJzID0gW107XHJcblxyXG5cdFx0XHRmdW5jdGlvbiBhZGRPYnNlcnZlcih2YWx1ZSkge1xyXG5cdFx0XHRcdHZhciBvYnMgPSBuZXcgUHJvcGVydHlPYnNlcnZlcihpdGVtKTtcclxuXHJcblx0XHRcdFx0b2JzZXJ2ZXJzLnB1c2gob2JzKTtcclxuXHRcdFx0XHRpZiAoaW5kZXggPT09IDApIHtcclxuXHRcdFx0XHRcdHJvb3RzLnB1c2gob2JzKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdG9icy5zdGFydCh2YWx1ZSwgaGFuZGxlcik7XHJcblxyXG5cdFx0XHRcdC8vIENvbnRpbnVlIHRvIG5leHQgc3RlcHMgaWYgdGhlcmUgYXJlIGFueVxyXG5cdFx0XHRcdGlmIChpbmRleCArIDEgPCBsaXN0Lmxlbmd0aCkge1xyXG5cdFx0XHRcdFx0cHJvY2Vzc1N0ZXAob2JzLCBsaXN0W2luZGV4ICsgMV0sIGluZGV4ICsgMSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRmdW5jdGlvbiByZW1vdmVPYnNlcnZlcih2YWx1ZSkge1xyXG5cdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgb2JzZXJ2ZXJzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0XHR2YXIgb2JzID0gb2JzZXJ2ZXJzW2ldO1xyXG5cdFx0XHRcdFx0aWYgKG9icy5fc291cmNlID09PSB2YWx1ZSkge1xyXG5cdFx0XHRcdFx0XHRBcnJheS5yZW1vdmVBdChvYnNlcnZlcnMsIGktLSk7XHJcblx0XHRcdFx0XHRcdGlmIChpbmRleCA9PT0gMCkge1xyXG5cdFx0XHRcdFx0XHRcdEFycmF5LnJlbW92ZShyb290cywgb2JzKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0b2JzLnN0b3AoKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIElmIHRoZXJlIGlzIGEgc3RlcCBiZWZvcmUgdGhpcyBvbmUsIHRoZW4gcmVzcG9uZCB0byBcclxuXHRcdFx0Ly8gY2hhbmdlcyB0byB0aGUgdmFsdWUocykgYXQgdGhhdCBzdGVwLlxyXG5cdFx0XHRpZiAocGFyZW50KSB7XHJcblx0XHRcdFx0cGFyZW50Ll9hZGRFdmVudChcInZhbHVlQ2FwdHVyZWRcIiwgYWRkT2JzZXJ2ZXIpO1xyXG5cdFx0XHRcdHBhcmVudC5fYWRkRXZlbnQoXCJ2YWx1ZVJlbGVhc2VkXCIsIHJlbW92ZU9ic2VydmVyKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIHNvdXJjZSA9IGluZGV4ID09PSAwID8gdGFyZ2V0IDogcGFyZW50LnZhbHVlKCk7XHJcblx0XHRcdGlmIChzb3VyY2UgIT09IHVuZGVmaW5lZCAmJiBzb3VyY2UgIT09IG51bGwpIHtcclxuXHRcdFx0XHRpZiAoc291cmNlIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuXHRcdFx0XHRcdEFycmF5LmZvckVhY2goc291cmNlLCBhZGRPYnNlcnZlcik7XHJcblxyXG5cdFx0XHRcdFx0Ly8gV2F0Y2ggZm9yIGNoYW5nZXMgdG8gdGhlIHRhcmdldCBpZiBpdCBpcyBhbiBhcnJheSwgc28gdGhhdCB3ZSBjYW5cclxuXHRcdFx0XHRcdC8vIGFkZCBuZXcgb2JzZXJ2ZXJzLCByZW1vdmUgb2xkIG9uZXMsIGFuZCBjYWxsIHRoZSBoYW5kbGVyLlxyXG5cdFx0XHRcdFx0aWYgKGluZGV4ID09PSAwKSB7XHJcblx0XHRcdFx0XHRcdE9ic2VydmVyLmFkZENvbGxlY3Rpb25DaGFuZ2VkKHNvdXJjZSwgZnVuY3Rpb24oc2VuZGVyLCBhcmdzKSB7XHJcblx0XHRcdFx0XHRcdFx0dmFyIGNoYW5nZXMgPSBhcmdzLmdldF9jaGFuZ2VzKCk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdEFycmF5LmZvckVhY2goY2hhbmdlcy5yZW1vdmVkIHx8IFtdLCByZW1vdmVPYnNlcnZlcik7XHJcblx0XHRcdFx0XHRcdFx0QXJyYXkuZm9yRWFjaChjaGFuZ2VzLmFkZGVkIHx8IFtdLCBhZGRPYnNlcnZlcik7XHJcblx0XHRcdFx0XHRcdFx0aGFuZGxlcigpO1xyXG5cdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRhZGRPYnNlcnZlcihzb3VyY2UpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdC8vIFN0YXJ0IHByb2Nlc3NpbmcgdGhlIHBhdGhcclxuXHRcdHByb2Nlc3NTdGVwKG51bGwsIGxpc3RbMF0sIDApO1xyXG5cclxuXHRcdC8vIFN0b3JlIHRoZSBvYnNlcnZlciBvbiB0aGUgb2JqZWN0XHJcblx0XHR2YXIgcGF0aENoYW5nZUhhbmRsZXJzID0gdGFyZ2V0Ll9fcGF0aENoYW5nZUhhbmRsZXJzW3BhdGhdO1xyXG5cdFx0aWYgKCFwYXRoQ2hhbmdlSGFuZGxlcnMpIHtcclxuXHRcdFx0dGFyZ2V0Ll9fcGF0aENoYW5nZUhhbmRsZXJzW3BhdGhdID0gcGF0aENoYW5nZUhhbmRsZXJzID0gW107XHJcblx0XHR9XHJcblx0XHRwYXRoQ2hhbmdlSGFuZGxlcnMucHVzaCh7IHJvb3RzOiByb290cywgaGFuZGxlcjogaGFuZGxlciB9KTtcclxuXHR9O1xyXG5cclxuXHRPYnNlcnZlci5yZW1vdmVQYXRoQ2hhbmdlZCA9IGZ1bmN0aW9uIFN5cyRPYnNlcnZlciRyZW1vdmVQYXRoQ2hhbmdlZCh0YXJnZXQsIHBhdGgsIGhhbmRsZXIpIHtcclxuXHRcdHBhdGggPSAocGF0aCBpbnN0YW5jZW9mIEFycmF5KSA/IHBhdGguam9pbihcIi5cIikgOiBwYXRoO1xyXG5cclxuXHRcdHZhciBwYXRoQ2hhbmdlSGFuZGxlcnMgPSB0YXJnZXQuX19wYXRoQ2hhbmdlSGFuZGxlcnMgPyB0YXJnZXQuX19wYXRoQ2hhbmdlSGFuZGxlcnNbcGF0aF0gOiBudWxsO1xyXG5cclxuXHRcdGlmIChwYXRoQ2hhbmdlSGFuZGxlcnMpIHtcclxuXHRcdFx0Ly8gU2VhcmNoIHRoZSBsaXN0IGZvciBoYW5kbGVycyB0aGF0IG1hdGNoIHRoZSBnaXZlbiBoYW5kbGVyIGFuZCBzdG9wIGFuZCByZW1vdmUgdGhlbVxyXG5cdFx0XHRwYXRoQ2hhbmdlSGFuZGxlcnMucHVyZ2UoZnVuY3Rpb24ocGF0aENoYW5nZUhhbmRsZXIpIHtcclxuXHRcdFx0XHRpZiAocGF0aENoYW5nZUhhbmRsZXIuaGFuZGxlciA9PT0gaGFuZGxlcikge1xyXG5cdFx0XHRcdFx0QXJyYXkuZm9yRWFjaChwYXRoQ2hhbmdlSGFuZGxlci5yb290cywgZnVuY3Rpb24ob2JzZXJ2ZXIpIHtcclxuXHRcdFx0XHRcdFx0b2JzZXJ2ZXIuc3RvcCgpO1xyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cclxuXHRcdFx0Ly8gSWYgdGhlcmUgYXJlIG5vIG1vcmUgaGFuZGxlcnMgZm9yIHRoaXMgcGF0aCB0aGVuIHJlbW92ZSBpdCBmcm9tIHRoZSBjYWNoZVxyXG5cdFx0XHRpZiAocGF0aENoYW5nZUhhbmRsZXJzLmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0XHRcdC8vIGRlbGV0ZSB0aGUgZGF0YSBzcGVjaWZpYyB0byB0aGlzIHBhdGhcclxuXHRcdFx0XHRkZWxldGUgdGFyZ2V0Ll9fcGF0aENoYW5nZUhhbmRsZXJzW3BhdGhdO1xyXG5cclxuXHRcdFx0XHQvLyBkZXRlcm1pbmUgaWYgdGhlcmUgYXJlIGFueSBvdGhlciBwYXRocyBiZWluZyB3YXRjaGVkXHJcblx0XHRcdFx0dmFyIGhhc0hhbmRsZXJzID0gZmFsc2U7XHJcblx0XHRcdFx0Zm9yICh2YXIgcmVtYWluaW5nSGFuZGxlciBpbiB0YXJnZXQuX19wYXRoQ2hhbmdlSGFuZGxlcnMpIHtcclxuXHRcdFx0XHRcdGlmICh0YXJnZXQuX19wYXRoQ2hhbmdlSGFuZGxlcnMuaGFzT3duUHJvcGVydHkocmVtYWluaW5nSGFuZGxlcikpIHtcclxuXHRcdFx0XHRcdFx0aGFzSGFuZGxlcnMgPSB0cnVlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gbnVsbCBvdXQgdGhlIHByb3BlcnR5IG9mIHRoZSB0YXJnZXQgaWYgdGhlcmUgYXJlIG5vIGxvbmdlciBhbnkgcGF0aHMgYmVpbmcgd2F0Y2hlZFxyXG5cdFx0XHRcdGlmICghaGFzSGFuZGxlcnMpIHtcclxuXHRcdFx0XHRcdHRhcmdldC5fX3BhdGhDaGFuZ2VIYW5kbGVycyA9IG51bGw7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0dmFyIG9ic2VydmFibGVJbnRlcmZhY2UgPSB7XHJcblx0XHRtYWtlT2JzZXJ2YWJsZTogZnVuY3Rpb24gKHRhcmdldCkge1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJPYnNlcnZhYmxlIHByb3ZpZGVyIGhhcyBub3QgYmVlbiBpbXBsZW1lbnRlZC4gIENhbGwgRXhvV2ViLk1vZGVsLnNldE9ic2VydmFibGVQcm92aWRlcigpLlwiKTtcclxuXHRcdH0sXHJcblx0XHRkaXNwb3NlT2JzZXJ2YWJsZTogZnVuY3Rpb24gKHRhcmdldCkge1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJPYnNlcnZhYmxlIHByb3ZpZGVyIGhhcyBub3QgYmVlbiBpbXBsZW1lbnRlZC4gIENhbGwgRXhvV2ViLk1vZGVsLnNldE9ic2VydmFibGVQcm92aWRlcigpLlwiKTtcclxuXHRcdH0sXHJcblx0XHRhZGRDb2xsZWN0aW9uQ2hhbmdlZDogZnVuY3Rpb24gKHRhcmdldCwgaGFuZGxlcikge1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJPYnNlcnZhYmxlIHByb3ZpZGVyIGhhcyBub3QgYmVlbiBpbXBsZW1lbnRlZC4gIENhbGwgRXhvV2ViLk1vZGVsLnNldE9ic2VydmFibGVQcm92aWRlcigpLlwiKTtcclxuXHRcdH0sXHJcblx0XHRyZW1vdmVDb2xsZWN0aW9uQ2hhbmdlZDogZnVuY3Rpb24gKHRhcmdldCwgaGFuZGxlcikge1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJPYnNlcnZhYmxlIHByb3ZpZGVyIGhhcyBub3QgYmVlbiBpbXBsZW1lbnRlZC4gIENhbGwgRXhvV2ViLk1vZGVsLnNldE9ic2VydmFibGVQcm92aWRlcigpLlwiKTtcclxuXHRcdH0sXHJcblx0XHRhZGRQcm9wZXJ0eUNoYW5nZWQ6IGZ1bmN0aW9uICh0YXJnZXQsIHByb3BlcnR5LCBoYW5kbGVyKSB7XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIk9ic2VydmFibGUgcHJvdmlkZXIgaGFzIG5vdCBiZWVuIGltcGxlbWVudGVkLiAgQ2FsbCBFeG9XZWIuTW9kZWwuc2V0T2JzZXJ2YWJsZVByb3ZpZGVyKCkuXCIpO1xyXG5cdFx0fSxcclxuXHRcdHJlbW92ZVByb3BlcnR5Q2hhbmdlZDogZnVuY3Rpb24gKHRhcmdldCwgcHJvcGVydHksIGhhbmRsZXIpIHtcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiT2JzZXJ2YWJsZSBwcm92aWRlciBoYXMgbm90IGJlZW4gaW1wbGVtZW50ZWQuICBDYWxsIEV4b1dlYi5Nb2RlbC5zZXRPYnNlcnZhYmxlUHJvdmlkZXIoKS5cIik7XHJcblx0XHR9LFxyXG5cdFx0cmFpc2VQcm9wZXJ0eUNoYW5nZWQ6IGZ1bmN0aW9uICh0YXJnZXQsIHByb3BlcnR5KSB7XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIk9ic2VydmFibGUgcHJvdmlkZXIgaGFzIG5vdCBiZWVuIGltcGxlbWVudGVkLiAgQ2FsbCBFeG9XZWIuTW9kZWwuc2V0T2JzZXJ2YWJsZVByb3ZpZGVyKCkuXCIpO1xyXG5cdFx0fSxcclxuXHRcdHNldFZhbHVlOiBmdW5jdGlvbiAodGFyZ2V0LCBwcm9wZXJ0eSwgdmFsdWUpIHtcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiT2JzZXJ2YWJsZSBwcm92aWRlciBoYXMgbm90IGJlZW4gaW1wbGVtZW50ZWQuICBDYWxsIEV4b1dlYi5Nb2RlbC5zZXRPYnNlcnZhYmxlUHJvdmlkZXIoKS5cIik7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0Ly8gc2V0cyB0aGUgb2JzZXJ2ZXIgcHJvdmlkZXIgdG8gdXNlLCB2ZXJpZnlpbmcgdGhhdCBpdCBtYXRjaGVzIHRoZSBkZWZpbmVkIGludGVyZmFjZS5cclxuXHRmdW5jdGlvbiBzZXRPYnNlcnZlclByb3ZpZGVyKHByb3ZpZGVyKSB7XHJcblx0XHRmb3IgKHZhciBtZXRob2QgaW4gb2JzZXJ2YWJsZUludGVyZmFjZSkge1xyXG5cdFx0XHR2YXIgZGVmaW5pdGlvbiA9IHByb3ZpZGVyW21ldGhvZF07XHJcblx0XHRcdGlmICghKGRlZmluaXRpb24gaW5zdGFuY2VvZiBGdW5jdGlvbikpIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJPYnNlcnZhYmxlIHByb3ZpZGVyIGRvZXMgbm90IGltcGxlbWVudCAnXCIgKyBtZXRob2QgKyBcIicuXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdE9ic2VydmVyW21ldGhvZF0gPSBkZWZpbml0aW9uO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Ly8gZXhwb3NlIHB1YmxpY2x5XHJcblx0RXhvV2ViLk9ic2VydmVyID0gT2JzZXJ2ZXI7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuUHJvcGVydHlPYnNlcnZlclxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIFByb3BlcnR5T2JzZXJ2ZXIocHJvcCkge1xyXG5cdFx0dGhpcy5fc291cmNlID0gbnVsbDtcclxuXHRcdHRoaXMuX3Byb3AgPSBwcm9wO1xyXG5cdFx0dGhpcy5faGFuZGxlciA9IG51bGw7XHJcblx0fVxyXG5cclxuXHRQcm9wZXJ0eU9ic2VydmVyLm1peGluKEZ1bmN0b3IuZXZlbnRpbmcpO1xyXG5cclxuXHRQcm9wZXJ0eU9ic2VydmVyLm1peGluKHtcclxuXHRcdHZhbHVlOiBmdW5jdGlvbiBQcm9wZXJ0eU9ic2VydmVyJHZhbHVlKCkge1xyXG5cdFx0XHRyZXR1cm4gRXhvV2ViLmdldFZhbHVlKHRoaXMuX3NvdXJjZSwgdGhpcy5fcHJvcCk7XHJcblx0XHR9LFxyXG5cdFx0cmVsZWFzZTogZnVuY3Rpb24gUHJvcGVydHlPYnNlcnZlciRyZWxlYXNlKHZhbHVlKSB7XHJcblx0XHRcdC8vIE5vdGlmeSBzdWJzY3JpYmVycyB0aGF0IHRoZSBvbGQgdmFsdWUgc2hvdWxkIGJlIHJlbGVhc2VkXHJcblx0XHRcdGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5KSB7XHJcblx0XHRcdFx0QXJyYXkuZm9yRWFjaCh2YWx1ZSwgZnVuY3Rpb24oaXRlbSkge1xyXG5cdFx0XHRcdFx0dGhpcy5fcmFpc2VFdmVudChcInZhbHVlUmVsZWFzZWRcIiwgW2l0ZW1dKTtcclxuXHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwidmFsdWVSZWxlYXNlZFwiLCBbdmFsdWVdKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdGNhcHR1cmU6IGZ1bmN0aW9uIFByb3BlcnR5T2JzZXJ2ZXIkY2FwdHVyZSh2YWx1ZSkge1xyXG5cdFx0XHQvLyBOb3RpZnkgc3Vic2NyaWJlcnMgdGhhdCBhIG5ldyB2YWx1ZSB3YXMgY2FwdHVyZWRcclxuXHRcdFx0aWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuXHRcdFx0XHRBcnJheS5mb3JFYWNoKHZhbHVlLCBmdW5jdGlvbihpdGVtKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwidmFsdWVDYXB0dXJlZFwiLCBbaXRlbV0pO1xyXG5cdFx0XHRcdH0sIHRoaXMpO1xyXG5cclxuXHRcdFx0XHR2YXIgX3RoaXMgPSB0aGlzO1xyXG5cclxuXHRcdFx0XHQvLyBIYXZlIHRvIHN0b3JlIHRoZSBhcnJheSBzaW5jZSBpZiB0aGUgdmFsdWUgY2hhbmdlcyB3ZSB3b24ndCBuZWNlc3NhcmlseSBiZSBhYmxlIHRvIHJldHJpZXZlIHRoZSBvcmlnaW5hbCBhcnJheVxyXG5cdFx0XHRcdGlmICh0aGlzLl9jb2xsZWN0aW9uVGFyZ2V0ICE9PSB1bmRlZmluZWQgJiYgdGhpcy5fY29sbGVjdGlvblRhcmdldCAhPT0gbnVsbCkge1xyXG5cdFx0XHRcdFx0T2JzZXJ2ZXIucmVtb3ZlQ29sbGVjdGlvbkNoYW5nZWQodGhpcy5fY29sbGVjdGlvblRhcmdldCwgdGhpcy5fY29sbGVjdGlvbkhhbmRsZXIpO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0dGhpcy5fY29sbGVjdGlvblRhcmdldCA9IHZhbHVlO1xyXG5cclxuXHRcdFx0XHR0aGlzLl9jb2xsZWN0aW9uSGFuZGxlciA9IGZ1bmN0aW9uIGNvbGxlY3Rpb25IYW5kbGVyKHNlbmRlciwgYXJncykge1xyXG5cdFx0XHRcdFx0dmFyIGNoYW5nZXMgPSBhcmdzLmdldF9jaGFuZ2VzKCk7XHJcblxyXG5cdFx0XHRcdFx0Ly8gQ2FsbCB0aGUgYWN0dWFsIGhhbmRsZXJcclxuXHRcdFx0XHRcdF90aGlzLl9oYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcblxyXG5cdFx0XHRcdFx0Ly8gcmVtb3ZlIG9sZCBvYnNlcnZlcnMgYW5kIGFkZCBuZXcgb2JzZXJ2ZXJzXHJcblx0XHRcdFx0XHRBcnJheS5mb3JFYWNoKGNoYW5nZXMucmVtb3ZlZCB8fCBbXSwgZnVuY3Rpb24ocmVtb3ZlZCkge1xyXG5cdFx0XHRcdFx0XHRfdGhpcy5fcmFpc2VFdmVudChcInZhbHVlUmVsZWFzZWRcIiwgW3JlbW92ZWRdKTtcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0QXJyYXkuZm9yRWFjaChjaGFuZ2VzLmFkZGVkIHx8IFtdLCBmdW5jdGlvbihhZGRlZCkge1xyXG5cdFx0XHRcdFx0XHRfdGhpcy5fcmFpc2VFdmVudChcInZhbHVlQ2FwdHVyZWRcIiwgW2FkZGVkXSk7XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9O1xyXG5cclxuXHRcdFx0XHRPYnNlcnZlci5hZGRDb2xsZWN0aW9uQ2hhbmdlZCh0aGlzLl9jb2xsZWN0aW9uVGFyZ2V0LCB0aGlzLl9jb2xsZWN0aW9uSGFuZGxlcik7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5fcmFpc2VFdmVudChcInZhbHVlQ2FwdHVyZWRcIiwgW3ZhbHVlXSk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRzdGFydDogZnVuY3Rpb24gUHJvcGVydHlPYnNlcnZlciRzdGFydChzb3VyY2UsIGhhbmRsZXIpIHtcclxuXHRcdFx0aWYgKHRoaXMuX3NvdXJjZSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBzdGFydCBhbiBvYnNlcnZlciB0aGF0IGlzIGFscmVhZHkgc3RhcnRlZC5cIik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciBfdGhpcyA9IHRoaXM7XHJcblxyXG5cdFx0XHR0aGlzLl9zb3VyY2UgPSBzb3VyY2U7XHJcblx0XHRcdHRoaXMuX2hhbmRsZXIgPSBoYW5kbGVyO1xyXG5cclxuXHRcdFx0dmFyIHZhbHVlID0gdGhpcy52YWx1ZSgpO1xyXG5cclxuXHRcdFx0dGhpcy5fcHJvcEhhbmRsZXIgPSBmdW5jdGlvbiBwcm9wSGFuZGxlcihzZW5kZXIsIGFyZ3MpIHtcclxuXHRcdFx0XHQvLyBDYWxsIHRoZSBhY3R1YWwgaGFuZGxlci5cclxuXHRcdFx0XHRfdGhpcy5faGFuZGxlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cclxuXHRcdFx0XHQvLyBSZWxlYXNlIHRoZSBvbGQgdmFsdWVcclxuXHRcdFx0XHRpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCkge1xyXG5cdFx0XHRcdFx0X3RoaXMucmVsZWFzZSh2YWx1ZSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHR2YWx1ZSA9IF90aGlzLnZhbHVlKCk7XHJcblxyXG5cdFx0XHRcdC8vIFJlbGVhc2UgdGhlIG9sZCB2YWx1ZVxyXG5cdFx0XHRcdGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSBudWxsKSB7XHJcblx0XHRcdFx0XHRfdGhpcy5jYXB0dXJlKHZhbHVlKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHRPYnNlcnZlci5hZGRQcm9wZXJ0eUNoYW5nZWQodGhpcy5fc291cmNlLCB0aGlzLl9wcm9wLCB0aGlzLl9wcm9wSGFuZGxlcik7XHJcblxyXG5cdFx0XHQvLyBJZiB3ZSBjdXJyZW50bHkgaGF2ZSBhIHZhbHVlLCB0aGVuIG5vdGlmeSBzdWJzY3JpYmVyc1xyXG5cdFx0XHRpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCkge1xyXG5cdFx0XHRcdHRoaXMuY2FwdHVyZSh2YWx1ZSk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRzdG9wOiBmdW5jdGlvbiBQcm9wZXJ0eU9ic2VydmVyJHN0b3AoKSB7XHJcblx0XHRcdGlmICh0aGlzLl9zb3VyY2UpIHtcclxuXHRcdFx0XHQvLyBSZW1vdmUgdGhlIHJlZ2lzdGVyZWQgZXZlbnQocylcclxuXHRcdFx0XHRPYnNlcnZlci5yZW1vdmVQcm9wZXJ0eUNoYW5nZWQodGhpcy5fc291cmNlLCB0aGlzLl9wcm9wLCB0aGlzLl9wcm9wSGFuZGxlcik7XHJcblxyXG5cdFx0XHRcdC8vIEhhdmUgdG8gc3RvcmUgdGhlIGFycmF5IHNpbmNlIGlmIHRoZSB2YWx1ZSBjaGFuZ2VzIHdlIHdvbid0IG5lY2Vzc2FyaWx5IGJlIGFibGUgdG8gcmV0cmlldmUgdGhlIG9yaWdpbmFsIGFycmF5XHJcblx0XHRcdFx0aWYgKHRoaXMuX2NvbGxlY3Rpb25UYXJnZXQgIT09IHVuZGVmaW5lZCAmJiB0aGlzLl9jb2xsZWN0aW9uVGFyZ2V0ICE9PSBudWxsKSB7XHJcblx0XHRcdFx0XHRPYnNlcnZlci5yZW1vdmVDb2xsZWN0aW9uQ2hhbmdlZCh0aGlzLl9jb2xsZWN0aW9uVGFyZ2V0LCB0aGlzLl9jb2xsZWN0aW9uSGFuZGxlcik7XHJcblx0XHRcdFx0XHR0aGlzLnJlbGVhc2UodGhpcy5fY29sbGVjdGlvblRhcmdldCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0dmFyIHZhbHVlID0gdGhpcy52YWx1ZSgpO1xyXG5cdFx0XHRcdFx0aWYgKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IG51bGwpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5yZWxlYXNlKHZhbHVlKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIE51bGwgb3V0IHRoZSBzb3VyY2UgdG8gaW5kaWNhdGUgdGhhdCBpdCBpcyBubyBsb25nZXIgd2F0Y2hpbmcgdGhhdCBvYmplY3RcclxuXHRcdFx0XHR0aGlzLl9zb3VyY2UgPSBudWxsO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdEV4b1dlYi5Qcm9wZXJ0eU9ic2VydmVyID0gUHJvcGVydHlPYnNlcnZlcjtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5Nb2RlbC5SZXNvdXJjZVxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdHZhciBSZXNvdXJjZSA9IHtcclxuXHRcdFwiYWxsb3dlZC12YWx1ZXNcIjpcdFx0XHRcdFx0XHRcdFwie3Byb3BlcnR5fSBpcyBub3QgaW4gdGhlIGxpc3Qgb2YgYWxsb3dlZCB2YWx1ZXMuXCIsXHJcblx0XHRcImNvbXBhcmUtYWZ0ZXJcIjpcdFx0XHRcdFx0XHRcdFwie3Byb3BlcnR5fSBtdXN0IGJlIGFmdGVyIHtjb21wYXJlU291cmNlfS5cIixcclxuXHRcdFwiY29tcGFyZS1iZWZvcmVcIjpcdFx0XHRcdFx0XHRcdFwie3Byb3BlcnR5fSBtdXN0IGJlIGJlZm9yZSB7Y29tcGFyZVNvdXJjZX0uXCIsXHJcblx0XHRcImNvbXBhcmUtZXF1YWxcIjpcdFx0XHRcdFx0XHRcdFwie3Byb3BlcnR5fSBtdXN0IGJlIHRoZSBzYW1lIGFzIHtjb21wYXJlU291cmNlfS5cIixcclxuXHRcdFwiY29tcGFyZS1ncmVhdGVyLXRoYW5cIjpcdFx0XHRcdFx0XHRcIntwcm9wZXJ0eX0gbXVzdCBiZSBncmVhdGVyIHRoYW4ge2NvbXBhcmVTb3VyY2V9LlwiLFxyXG5cdFx0XCJjb21wYXJlLWdyZWF0ZXItdGhhbi1vci1lcXVhbFwiOlx0XHRcdFwie3Byb3BlcnR5fSBtdXN0IGJlIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB7Y29tcGFyZVNvdXJjZX0uXCIsXHJcblx0XHRcImNvbXBhcmUtbGVzcy10aGFuXCI6XHRcdFx0XHRcdFx0XCJ7cHJvcGVydHl9IG11c3QgYmUgbGVzcyB0aGFuIHtjb21wYXJlU291cmNlfS5cIixcclxuXHRcdFwiY29tcGFyZS1sZXNzLXRoYW4tb3ItZXF1YWxcIjpcdFx0XHRcdFwie3Byb3BlcnR5fSBtdXN0IGJlIGxlc3MgdGhhbiBvciBlcXVhbCB0byB7Y29tcGFyZVNvdXJjZX0uXCIsXHJcblx0XHRcImNvbXBhcmUtbm90LWVxdWFsXCI6XHRcdFx0XHRcdFx0XCJ7cHJvcGVydHl9IG11c3QgYmUgZGlmZmVyZW50IGZyb20ge2NvbXBhcmVTb3VyY2V9LlwiLFxyXG5cdFx0XCJjb21wYXJlLW9uLW9yLWFmdGVyXCI6XHRcdFx0XHRcdFx0XCJ7cHJvcGVydHl9IG11c3QgYmUgb24gb3IgYWZ0ZXIge2NvbXBhcmVTb3VyY2V9LlwiLFxyXG5cdFx0XCJjb21wYXJlLW9uLW9yLWJlZm9yZVwiOlx0XHRcdFx0XHRcdFwie3Byb3BlcnR5fSBtdXN0IGJlIG9uIG9yIGJlZm9yZSB7Y29tcGFyZVNvdXJjZX0uXCIsXHJcblx0XHRcImxpc3RsZW5ndGgtYXQtbGVhc3RcIjpcdFx0XHRcdFx0XHRcIlBsZWFzZSBzcGVjaWZ5IGF0IGxlYXN0IHttaW59IHtwcm9wZXJ0eX0uXCIsXHJcblx0XHRcImxpc3RsZW5ndGgtYXQtbW9zdFwiOlx0XHRcdFx0XHRcdFwiUGxlYXNlIHNwZWNpZnkgbm8gbW9yZSB0aGFuIHttYXh9IHtwcm9wZXJ0eX0uXCIsXHJcblx0XHRcImxpc3RsZW5ndGgtYmV0d2VlblwiOlx0XHRcdFx0XHRcdFwiUGxlYXNlIHNwZWNpZnkgYmV0d2VlbiB7bWlufSBhbmQge21heH0ge3Byb3BlcnR5fS5cIixcclxuXHRcdFwicmFuZ2UtYXQtbGVhc3RcIjpcdFx0XHRcdFx0XHRcdFwie3Byb3BlcnR5fSBtdXN0IGJlIGF0IGxlYXN0IHttaW59LlwiLFxyXG5cdFx0XCJyYW5nZS1hdC1tb3N0XCI6XHRcdFx0XHRcdFx0XHRcIntwcm9wZXJ0eX0gbXVzdCBiZSBhdCBtb3N0IHttYXh9LlwiLFxyXG5cdFx0XCJyYW5nZS1iZXR3ZWVuXCI6XHRcdFx0XHRcdFx0XHRcIntwcm9wZXJ0eX0gbXVzdCBiZSBiZXR3ZWVuIHttaW59IGFuZCB7bWF4fS5cIixcclxuXHRcdFwicmFuZ2Utb24tb3ItYWZ0ZXJcIjpcdFx0XHRcdFx0XHRcIntwcm9wZXJ0eX0gbXVzdCBiZSBvbiBvciBhZnRlciB7bWlufS5cIixcclxuXHRcdFwicmFuZ2Utb24tb3ItYmVmb3JlXCI6XHRcdFx0XHRcdFx0XCJ7cHJvcGVydHl9IG11c3QgYmUgb24gb3IgYmVmb3JlIHttYXh9LlwiLFxyXG5cdFx0XCJyZXF1aXJlZFwiOlx0XHRcdFx0XHRcdFx0XHRcdFwie3Byb3BlcnR5fSBpcyByZXF1aXJlZC5cIixcclxuXHRcdFwicmVxdWlyZWQtaWYtYWZ0ZXJcIjpcdFx0XHRcdFx0XHRcIntwcm9wZXJ0eX0gaXMgcmVxdWlyZWQgd2hlbiB7Y29tcGFyZVNvdXJjZX0gaXMgYWZ0ZXIge2NvbXBhcmVWYWx1ZX0uXCIsXHJcblx0XHRcInJlcXVpcmVkLWlmLWJlZm9yZVwiOlx0XHRcdFx0XHRcdFwie3Byb3BlcnR5fSBpcyByZXF1aXJlZCB3aGVuIHtjb21wYXJlU291cmNlfSBpcyBiZWZvcmUge2NvbXBhcmVWYWx1ZX0uXCIsXHJcblx0XHRcInJlcXVpcmVkLWlmLWVxdWFsXCI6XHRcdFx0XHRcdFx0XCJ7cHJvcGVydHl9IGlzIHJlcXVpcmVkIHdoZW4ge2NvbXBhcmVTb3VyY2V9IGlzIHtjb21wYXJlVmFsdWV9LlwiLFxyXG5cdFx0XCJyZXF1aXJlZC1pZi1leGlzdHNcIjpcdFx0XHRcdFx0XHRcIntwcm9wZXJ0eX0gaXMgcmVxdWlyZWQgd2hlbiB7Y29tcGFyZVNvdXJjZX0gaXMgc3BlY2lmaWVkLlwiLFxyXG5cdFx0XCJyZXF1aXJlZC1pZi1ncmVhdGVyLXRoYW5cIjpcdFx0XHRcdFx0XCJ7cHJvcGVydHl9IGlzIHJlcXVpcmVkIHdoZW4ge2NvbXBhcmVTb3VyY2V9IGlzIGdyZWF0ZXIgdGhhbiB7Y29tcGFyZVZhbHVlfS5cIixcclxuXHRcdFwicmVxdWlyZWQtaWYtZ3JlYXRlci10aGFuLW9yLWVxdWFsXCI6XHRcdFwie3Byb3BlcnR5fSBpcyByZXF1aXJlZCB3aGVuIHtjb21wYXJlU291cmNlfSBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8ge2NvbXBhcmVWYWx1ZX0uXCIsXHJcblx0XHRcInJlcXVpcmVkLWlmLWxlc3MtdGhhblwiOlx0XHRcdFx0XHRcIntwcm9wZXJ0eX0gaXMgcmVxdWlyZWQgd2hlbiB7Y29tcGFyZVNvdXJjZX0gaXMgbGVzcyB0aGFuIHtjb21wYXJlVmFsdWV9LlwiLFxyXG5cdFx0XCJyZXF1aXJlZC1pZi1sZXNzLXRoYW4tb3ItZXF1YWxcIjpcdFx0XHRcIntwcm9wZXJ0eX0gaXMgcmVxdWlyZWQgd2hlbiB7Y29tcGFyZVNvdXJjZX0gaXMgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHtjb21wYXJlVmFsdWV9LlwiLFxyXG5cdFx0XCJyZXF1aXJlZC1pZi1ub3QtZXF1YWxcIjpcdFx0XHRcdFx0XCJ7cHJvcGVydHl9IGlzIHJlcXVpcmVkIHdoZW4ge2NvbXBhcmVTb3VyY2V9IGlzIG5vdCB7Y29tcGFyZVZhbHVlfS5cIixcclxuXHRcdFwicmVxdWlyZWQtaWYtbm90LWV4aXN0c1wiOlx0XHRcdFx0XHRcIntwcm9wZXJ0eX0gaXMgcmVxdWlyZWQgd2hlbiB7Y29tcGFyZVNvdXJjZX0gaXMgbm90IHNwZWNpZmllZC5cIixcclxuXHRcdFwicmVxdWlyZWQtaWYtb24tb3ItYWZ0ZXJcIjpcdFx0XHRcdFx0XCJ7cHJvcGVydHl9IGlzIHJlcXVpcmVkIHdoZW4ge2NvbXBhcmVTb3VyY2V9IGlzIG9uIG9yIGFmdGVyIHtjb21wYXJlVmFsdWV9LlwiLFxyXG5cdFx0XCJyZXF1aXJlZC1pZi1vbi1vci1iZWZvcmVcIjpcdFx0XHRcdFx0XCJ7cHJvcGVydHl9IGlzIHJlcXVpcmVkIHdoZW4ge2NvbXBhcmVTb3VyY2V9IGlzIG9uIG9yIGJlZm9yZSB7Y29tcGFyZVZhbHVlfS5cIixcclxuXHRcdFwic3RyaW5nLWZvcm1hdFwiOlx0XHRcdFx0XHRcdFx0XCJ7cHJvcGVydHl9IG11c3QgYmUgZm9ybWF0dGVkIGFzIHtmb3JtYXREZXNjcmlwdGlvbn0uXCIsXHJcblx0XHRcInN0cmluZy1sZW5ndGgtYXQtbGVhc3RcIjpcdFx0XHRcdFx0XCJ7cHJvcGVydHl9IG11c3QgYmUgYXQgbGVhc3Qge21pbn0gY2hhcmFjdGVycy5cIixcclxuXHRcdFwic3RyaW5nLWxlbmd0aC1hdC1tb3N0XCI6XHRcdFx0XHRcdFwie3Byb3BlcnR5fSBtdXN0IGJlIGF0IG1vc3Qge21heH0gY2hhcmFjdGVycy5cIixcclxuXHRcdFwic3RyaW5nLWxlbmd0aC1iZXR3ZWVuXCI6ICAgICAgICAgICAgICAgICAgICBcIntwcm9wZXJ0eX0gbXVzdCBiZSBiZXR3ZWVuIHttaW59IGFuZCB7bWF4fSBjaGFyYWN0ZXJzLlwiLFxyXG5cdCAgICBcImZvcm1hdC13aXRoLWRlc2NyaXB0aW9uXCI6ICAgICAgICAgICAgICAgICAgXCJ7cHJvcGVydHl9IG11c3QgYmUgZm9ybWF0dGVkIGFzIHtkZXNjcmlwdGlvbn0uXCIsXHJcblx0XHRcImZvcm1hdC13aXRob3V0LWRlc2NyaXB0aW9uXCI6ICAgICAgICAgICAgICAgXCJ7cHJvcGVydHl9IGlzIG5vdCBwcm9wZXJseSBmb3JtYXR0ZWQuXCIsXHJcblx0ICAgIFwiZm9ybWF0LWN1cnJlbmN5XCI6ICAgICAgICAgICAgICAgICAgICAgICAgICBcIiQjLCMjIy4jI1wiLFxyXG5cdCAgICBcImZvcm1hdC1wZXJjZW50YWdlXCI6ICAgICAgICAgICAgICAgICAgICAgICAgXCIjLiMjJVwiLFxyXG5cdCAgICBcImZvcm1hdC1pbnRlZ2VyXCI6ICAgICAgICAgICAgICAgICAgICAgICAgICAgXCIjLCMjI1wiLFxyXG5cdCAgICBcImZvcm1hdC1kZWNpbWFsXCI6ICAgICAgICAgICAgICAgICAgICAgICAgICAgXCIjLCMjIy4jI1wiLFxyXG5cclxuXHRcdC8vIGdldHMgdGhlIHJlc291cmNlIHdpdGggdGhlIHNwZWNpZmllZCBuYW1lXHJcblx0XHRnZXQ6IGZ1bmN0aW9uIFJlc291cmNlJGdldChuYW1lKSB7XHJcblx0XHRcdHJldHVybiB0aGlzW25hbWVdO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Ly8gcHVibGljbHkgZXhwb3J0IHRoZSByZXNvdXJjZSBvYmplY3RcclxuXHRFeG9XZWIuTW9kZWwuUmVzb3VyY2UgPSBSZXNvdXJjZTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5Nb2RlbC5Gb3JtYXRDb21waWxlclxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdHZhciBmb3JtYXRUZW1wbGF0ZVBhcnNlciA9IC9cXFsoW19hLXpBLVpcXHUwMGFhXFx1MDBiNVxcdTAwYmFcXHUwMGMwLVxcdTAwZDZcXHUwMGQ4LVxcdTAwZjZcXHUwMGY4LVxcdTAyYjhcXHUwMmJiLVxcdTAyYzFcXHUwMmQwLVxcdTAyZDFcXHUwMmUwLVxcdTAyZTRcXHUwMmVlXFx1MDM3MC1cXHUwMzczXFx1MDM3Ni1cXHUwMzc3XFx1MDM3YS1cXHUwMzdkXFx1MDM4NlxcdTAzODgtXFx1MDM4YVxcdTAzOGNcXHUwMzhlLVxcdTAzYTFcXHUwM2EzLVxcdTAzZjVcXHUwM2Y3LVxcdTA0ODFcXHUwNDhhLVxcdTA1MjNcXHUwNTMxLVxcdTA1NTZcXHUwNTU5XFx1MDU2MS1cXHUwNTg3XFx1MDVkMC1cXHUwNWVhXFx1MDVmMC1cXHUwNWYyXFx1MDYyMS1cXHUwNjRhXFx1MDY2MC1cXHUwNjY5XFx1MDY2ZS1cXHUwNjZmXFx1MDY3MS1cXHUwNmQzXFx1MDZkNVxcdTA2ZTUtXFx1MDZlNlxcdTA2ZWUtXFx1MDZmY1xcdTA2ZmZcXHUwNzEwXFx1MDcxMi1cXHUwNzJmXFx1MDc0ZC1cXHUwN2E1XFx1MDdiMVxcdTA3YzAtXFx1MDdlYVxcdTA3ZjQtXFx1MDdmNVxcdTA3ZmFcXHUwOTA0LVxcdTA5MzlcXHUwOTNkXFx1MDk1MFxcdTA5NTgtXFx1MDk2MVxcdTA5NjYtXFx1MDk2ZlxcdTA5NzEtXFx1MDk3MlxcdTA5N2ItXFx1MDk3ZlxcdTA5ODUtXFx1MDk4Y1xcdTA5OGYtXFx1MDk5MFxcdTA5OTMtXFx1MDlhOFxcdTA5YWEtXFx1MDliMFxcdTA5YjJcXHUwOWI2LVxcdTA5YjlcXHUwOWJkXFx1MDljZVxcdTA5ZGMtXFx1MDlkZFxcdTA5ZGYtXFx1MDllMVxcdTA5ZTYtXFx1MDlmMVxcdTBhMDUtXFx1MGEwYVxcdTBhMGYtXFx1MGExMFxcdTBhMTMtXFx1MGEyOFxcdTBhMmEtXFx1MGEzMFxcdTBhMzItXFx1MGEzM1xcdTBhMzUtXFx1MGEzNlxcdTBhMzgtXFx1MGEzOVxcdTBhNTktXFx1MGE1Y1xcdTBhNWVcXHUwYTY2LVxcdTBhNmZcXHUwYTcyLVxcdTBhNzRcXHUwYTg1LVxcdTBhOGRcXHUwYThmLVxcdTBhOTFcXHUwYTkzLVxcdTBhYThcXHUwYWFhLVxcdTBhYjBcXHUwYWIyLVxcdTBhYjNcXHUwYWI1LVxcdTBhYjlcXHUwYWJkXFx1MGFkMFxcdTBhZTAtXFx1MGFlMVxcdTBhZTYtXFx1MGFlZlxcdTBiMDUtXFx1MGIwY1xcdTBiMGYtXFx1MGIxMFxcdTBiMTMtXFx1MGIyOFxcdTBiMmEtXFx1MGIzMFxcdTBiMzItXFx1MGIzM1xcdTBiMzUtXFx1MGIzOVxcdTBiM2RcXHUwYjVjLVxcdTBiNWRcXHUwYjVmLVxcdTBiNjFcXHUwYjY2LVxcdTBiNmZcXHUwYjcxXFx1MGI4M1xcdTBiODUtXFx1MGI4YVxcdTBiOGUtXFx1MGI5MFxcdTBiOTItXFx1MGI5NVxcdTBiOTktXFx1MGI5YVxcdTBiOWNcXHUwYjllLVxcdTBiOWZcXHUwYmEzLVxcdTBiYTRcXHUwYmE4LVxcdTBiYWFcXHUwYmFlLVxcdTBiYjlcXHUwYmQwXFx1MGJlNi1cXHUwYmVmXFx1MGMwNS1cXHUwYzBjXFx1MGMwZS1cXHUwYzEwXFx1MGMxMi1cXHUwYzI4XFx1MGMyYS1cXHUwYzMzXFx1MGMzNS1cXHUwYzM5XFx1MGMzZFxcdTBjNTgtXFx1MGM1OVxcdTBjNjAtXFx1MGM2MVxcdTBjNjYtXFx1MGM2ZlxcdTBjODUtXFx1MGM4Y1xcdTBjOGUtXFx1MGM5MFxcdTBjOTItXFx1MGNhOFxcdTBjYWEtXFx1MGNiM1xcdTBjYjUtXFx1MGNiOVxcdTBjYmRcXHUwY2RlXFx1MGNlMC1cXHUwY2UxXFx1MGNlNi1cXHUwY2VmXFx1MGQwNS1cXHUwZDBjXFx1MGQwZS1cXHUwZDEwXFx1MGQxMi1cXHUwZDI4XFx1MGQyYS1cXHUwZDM5XFx1MGQzZFxcdTBkNjAtXFx1MGQ2MVxcdTBkNjYtXFx1MGQ2ZlxcdTBkN2EtXFx1MGQ3ZlxcdTBkODUtXFx1MGQ5NlxcdTBkOWEtXFx1MGRiMVxcdTBkYjMtXFx1MGRiYlxcdTBkYmRcXHUwZGMwLVxcdTBkYzZcXHUwZTAxLVxcdTBlMzBcXHUwZTMyLVxcdTBlMzNcXHUwZTQwLVxcdTBlNDZcXHUwZTUwLVxcdTBlNTlcXHUwZTgxLVxcdTBlODJcXHUwZTg0XFx1MGU4Ny1cXHUwZTg4XFx1MGU4YVxcdTBlOGRcXHUwZTk0LVxcdTBlOTdcXHUwZTk5LVxcdTBlOWZcXHUwZWExLVxcdTBlYTNcXHUwZWE1XFx1MGVhN1xcdTBlYWEtXFx1MGVhYlxcdTBlYWQtXFx1MGViMFxcdTBlYjItXFx1MGViM1xcdTBlYmRcXHUwZWMwLVxcdTBlYzRcXHUwZWM2XFx1MGVkMC1cXHUwZWQ5XFx1MGVkYy1cXHUwZWRkXFx1MGYwMFxcdTBmMjAtXFx1MGYyOVxcdTBmNDAtXFx1MGY0N1xcdTBmNDktXFx1MGY2Y1xcdTBmODgtXFx1MGY4YlxcdTEwMDAtXFx1MTAyYVxcdTEwM2YtXFx1MTA0OVxcdTEwNTAtXFx1MTA1NVxcdTEwNWEtXFx1MTA1ZFxcdTEwNjFcXHUxMDY1LVxcdTEwNjZcXHUxMDZlLVxcdTEwNzBcXHUxMDc1LVxcdTEwODFcXHUxMDhlXFx1MTA5MC1cXHUxMDk5XFx1MTBhMC1cXHUxMGM1XFx1MTBkMC1cXHUxMGZhXFx1MTBmY1xcdTExMDAtXFx1MTE1OVxcdTExNWYtXFx1MTFhMlxcdTExYTgtXFx1MTFmOVxcdTEyMDAtXFx1MTI0OFxcdTEyNGEtXFx1MTI0ZFxcdTEyNTAtXFx1MTI1NlxcdTEyNThcXHUxMjVhLVxcdTEyNWRcXHUxMjYwLVxcdTEyODhcXHUxMjhhLVxcdTEyOGRcXHUxMjkwLVxcdTEyYjBcXHUxMmIyLVxcdTEyYjVcXHUxMmI4LVxcdTEyYmVcXHUxMmMwXFx1MTJjMi1cXHUxMmM1XFx1MTJjOC1cXHUxMmQ2XFx1MTJkOC1cXHUxMzEwXFx1MTMxMi1cXHUxMzE1XFx1MTMxOC1cXHUxMzVhXFx1MTM4MC1cXHUxMzhmXFx1MTNhMC1cXHUxM2Y0XFx1MTQwMS1cXHUxNjZjXFx1MTY2Zi1cXHUxNjc2XFx1MTY4MS1cXHUxNjlhXFx1MTZhMC1cXHUxNmVhXFx1MTcwMC1cXHUxNzBjXFx1MTcwZS1cXHUxNzExXFx1MTcyMC1cXHUxNzMxXFx1MTc0MC1cXHUxNzUxXFx1MTc2MC1cXHUxNzZjXFx1MTc2ZS1cXHUxNzcwXFx1MTc4MC1cXHUxN2IzXFx1MTdkN1xcdTE3ZGNcXHUxN2UwLVxcdTE3ZTlcXHUxODEwLVxcdTE4MTlcXHUxODIwLVxcdTE4NzdcXHUxODgwLVxcdTE4YThcXHUxOGFhXFx1MTkwMC1cXHUxOTFjXFx1MTk0Ni1cXHUxOTZkXFx1MTk3MC1cXHUxOTc0XFx1MTk4MC1cXHUxOWE5XFx1MTljMS1cXHUxOWM3XFx1MTlkMC1cXHUxOWQ5XFx1MWEwMC1cXHUxYTE2XFx1MWIwNS1cXHUxYjMzXFx1MWI0NS1cXHUxYjRiXFx1MWI1MC1cXHUxYjU5XFx1MWI4My1cXHUxYmEwXFx1MWJhZS1cXHUxYmI5XFx1MWMwMC1cXHUxYzIzXFx1MWM0MC1cXHUxYzQ5XFx1MWM0ZC1cXHUxYzdkXFx1MWQwMC1cXHUxZGJmXFx1MWUwMC1cXHUxZjE1XFx1MWYxOC1cXHUxZjFkXFx1MWYyMC1cXHUxZjQ1XFx1MWY0OC1cXHUxZjRkXFx1MWY1MC1cXHUxZjU3XFx1MWY1OVxcdTFmNWJcXHUxZjVkXFx1MWY1Zi1cXHUxZjdkXFx1MWY4MC1cXHUxZmI0XFx1MWZiNi1cXHUxZmJjXFx1MWZiZVxcdTFmYzItXFx1MWZjNFxcdTFmYzYtXFx1MWZjY1xcdTFmZDAtXFx1MWZkM1xcdTFmZDYtXFx1MWZkYlxcdTFmZTAtXFx1MWZlY1xcdTFmZjItXFx1MWZmNFxcdTFmZjYtXFx1MWZmY1xcdTIwNzFcXHUyMDdmXFx1MjA5MC1cXHUyMDk0XFx1MjEwMlxcdTIxMDdcXHUyMTBhLVxcdTIxMTNcXHUyMTE1XFx1MjExOS1cXHUyMTFkXFx1MjEyNFxcdTIxMjZcXHUyMTI4XFx1MjEyYS1cXHUyMTJkXFx1MjEyZi1cXHUyMTM5XFx1MjEzYy1cXHUyMTNmXFx1MjE0NS1cXHUyMTQ5XFx1MjE0ZVxcdTIxODMtXFx1MjE4NFxcdTJjMDAtXFx1MmMyZVxcdTJjMzAtXFx1MmM1ZVxcdTJjNjAtXFx1MmM2ZlxcdTJjNzEtXFx1MmM3ZFxcdTJjODAtXFx1MmNlNFxcdTJkMDAtXFx1MmQyNVxcdTJkMzAtXFx1MmQ2NVxcdTJkNmZcXHUyZDgwLVxcdTJkOTZcXHUyZGEwLVxcdTJkYTZcXHUyZGE4LVxcdTJkYWVcXHUyZGIwLVxcdTJkYjZcXHUyZGI4LVxcdTJkYmVcXHUyZGMwLVxcdTJkYzZcXHUyZGM4LVxcdTJkY2VcXHUyZGQwLVxcdTJkZDZcXHUyZGQ4LVxcdTJkZGVcXHUzMDA1LVxcdTMwMDZcXHUzMDMxLVxcdTMwMzVcXHUzMDNiLVxcdTMwM2NcXHUzMDQxLVxcdTMwOTZcXHUzMDlkLVxcdTMwOWZcXHUzMGExLVxcdTMwZmFcXHUzMGZjLVxcdTMwZmZcXHUzMTA1LVxcdTMxMmRcXHUzMTMxLVxcdTMxOGVcXHUzMWEwLVxcdTMxYjdcXHUzMWYwLVxcdTMxZmZcXHUzNDAwLVxcdTRkYjVcXHU0ZTAwLVxcdTlmYzNcXHVhMDAwLVxcdWE0OGNcXHVhNTAwLVxcdWE2MGNcXHVhNjEwLVxcdWE2MmJcXHVhNjQwLVxcdWE2NWZcXHVhNjYyLVxcdWE2NmVcXHVhNjgwLVxcdWE2OTdcXHVhNzIyLVxcdWE3ODhcXHVhNzhiLVxcdWE3OGNcXHVhN2ZiLVxcdWE4MDFcXHVhODAzLVxcdWE4MDVcXHVhODA3LVxcdWE4MGFcXHVhODBjLVxcdWE4MjJcXHVhODQwLVxcdWE4NzNcXHVhODgyLVxcdWE4YjNcXHVhOGQwLVxcdWE4ZDlcXHVhOTAwLVxcdWE5MjVcXHVhOTMwLVxcdWE5NDZcXHVhYTAwLVxcdWFhMjhcXHVhYTQwLVxcdWFhNDJcXHVhYTQ0LVxcdWFhNGJcXHVhYTUwLVxcdWFhNTlcXHVhYzAwLVxcdWQ3YTNcXHVmOTAwLVxcdWZhMmRcXHVmYTMwLVxcdWZhNmFcXHVmYTcwLVxcdWZhZDlcXHVmYjAwLVxcdWZiMDZcXHVmYjEzLVxcdWZiMTdcXHVmYjFkXFx1ZmIxZi1cXHVmYjI4XFx1ZmIyYS1cXHVmYjM2XFx1ZmIzOC1cXHVmYjNjXFx1ZmIzZVxcdWZiNDAtXFx1ZmI0MVxcdWZiNDMtXFx1ZmI0NFxcdWZiNDYtXFx1ZmJiMVxcdWZiZDMtXFx1ZmQzZFxcdWZkNTAtXFx1ZmQ4ZlxcdWZkOTItXFx1ZmRjN1xcdWZkZjAtXFx1ZmRmYlxcdWZlNzAtXFx1ZmU3NFxcdWZlNzYtXFx1ZmVmY1xcdWZmMTAtXFx1ZmYxOVxcdWZmMjEtXFx1ZmYzYVxcdWZmNDEtXFx1ZmY1YVxcdWZmNjYtXFx1ZmZiZVxcdWZmYzItXFx1ZmZjN1xcdWZmY2EtXFx1ZmZjZlxcdWZmZDItXFx1ZmZkN1xcdWZmZGEtXFx1ZmZkY11bXy4wLTlhLXpBLVpcXHUwMGFhXFx1MDBiNVxcdTAwYmFcXHUwMGMwLVxcdTAwZDZcXHUwMGQ4LVxcdTAwZjZcXHUwMGY4LVxcdTAyYjhcXHUwMmJiLVxcdTAyYzFcXHUwMmQwLVxcdTAyZDFcXHUwMmUwLVxcdTAyZTRcXHUwMmVlXFx1MDM3MC1cXHUwMzczXFx1MDM3Ni1cXHUwMzc3XFx1MDM3YS1cXHUwMzdkXFx1MDM4NlxcdTAzODgtXFx1MDM4YVxcdTAzOGNcXHUwMzhlLVxcdTAzYTFcXHUwM2EzLVxcdTAzZjVcXHUwM2Y3LVxcdTA0ODFcXHUwNDhhLVxcdTA1MjNcXHUwNTMxLVxcdTA1NTZcXHUwNTU5XFx1MDU2MS1cXHUwNTg3XFx1MDVkMC1cXHUwNWVhXFx1MDVmMC1cXHUwNWYyXFx1MDYyMS1cXHUwNjRhXFx1MDY2MC1cXHUwNjY5XFx1MDY2ZS1cXHUwNjZmXFx1MDY3MS1cXHUwNmQzXFx1MDZkNVxcdTA2ZTUtXFx1MDZlNlxcdTA2ZWUtXFx1MDZmY1xcdTA2ZmZcXHUwNzEwXFx1MDcxMi1cXHUwNzJmXFx1MDc0ZC1cXHUwN2E1XFx1MDdiMVxcdTA3YzAtXFx1MDdlYVxcdTA3ZjQtXFx1MDdmNVxcdTA3ZmFcXHUwOTA0LVxcdTA5MzlcXHUwOTNkXFx1MDk1MFxcdTA5NTgtXFx1MDk2MVxcdTA5NjYtXFx1MDk2ZlxcdTA5NzEtXFx1MDk3MlxcdTA5N2ItXFx1MDk3ZlxcdTA5ODUtXFx1MDk4Y1xcdTA5OGYtXFx1MDk5MFxcdTA5OTMtXFx1MDlhOFxcdTA5YWEtXFx1MDliMFxcdTA5YjJcXHUwOWI2LVxcdTA5YjlcXHUwOWJkXFx1MDljZVxcdTA5ZGMtXFx1MDlkZFxcdTA5ZGYtXFx1MDllMVxcdTA5ZTYtXFx1MDlmMVxcdTBhMDUtXFx1MGEwYVxcdTBhMGYtXFx1MGExMFxcdTBhMTMtXFx1MGEyOFxcdTBhMmEtXFx1MGEzMFxcdTBhMzItXFx1MGEzM1xcdTBhMzUtXFx1MGEzNlxcdTBhMzgtXFx1MGEzOVxcdTBhNTktXFx1MGE1Y1xcdTBhNWVcXHUwYTY2LVxcdTBhNmZcXHUwYTcyLVxcdTBhNzRcXHUwYTg1LVxcdTBhOGRcXHUwYThmLVxcdTBhOTFcXHUwYTkzLVxcdTBhYThcXHUwYWFhLVxcdTBhYjBcXHUwYWIyLVxcdTBhYjNcXHUwYWI1LVxcdTBhYjlcXHUwYWJkXFx1MGFkMFxcdTBhZTAtXFx1MGFlMVxcdTBhZTYtXFx1MGFlZlxcdTBiMDUtXFx1MGIwY1xcdTBiMGYtXFx1MGIxMFxcdTBiMTMtXFx1MGIyOFxcdTBiMmEtXFx1MGIzMFxcdTBiMzItXFx1MGIzM1xcdTBiMzUtXFx1MGIzOVxcdTBiM2RcXHUwYjVjLVxcdTBiNWRcXHUwYjVmLVxcdTBiNjFcXHUwYjY2LVxcdTBiNmZcXHUwYjcxXFx1MGI4M1xcdTBiODUtXFx1MGI4YVxcdTBiOGUtXFx1MGI5MFxcdTBiOTItXFx1MGI5NVxcdTBiOTktXFx1MGI5YVxcdTBiOWNcXHUwYjllLVxcdTBiOWZcXHUwYmEzLVxcdTBiYTRcXHUwYmE4LVxcdTBiYWFcXHUwYmFlLVxcdTBiYjlcXHUwYmQwXFx1MGJlNi1cXHUwYmVmXFx1MGMwNS1cXHUwYzBjXFx1MGMwZS1cXHUwYzEwXFx1MGMxMi1cXHUwYzI4XFx1MGMyYS1cXHUwYzMzXFx1MGMzNS1cXHUwYzM5XFx1MGMzZFxcdTBjNTgtXFx1MGM1OVxcdTBjNjAtXFx1MGM2MVxcdTBjNjYtXFx1MGM2ZlxcdTBjODUtXFx1MGM4Y1xcdTBjOGUtXFx1MGM5MFxcdTBjOTItXFx1MGNhOFxcdTBjYWEtXFx1MGNiM1xcdTBjYjUtXFx1MGNiOVxcdTBjYmRcXHUwY2RlXFx1MGNlMC1cXHUwY2UxXFx1MGNlNi1cXHUwY2VmXFx1MGQwNS1cXHUwZDBjXFx1MGQwZS1cXHUwZDEwXFx1MGQxMi1cXHUwZDI4XFx1MGQyYS1cXHUwZDM5XFx1MGQzZFxcdTBkNjAtXFx1MGQ2MVxcdTBkNjYtXFx1MGQ2ZlxcdTBkN2EtXFx1MGQ3ZlxcdTBkODUtXFx1MGQ5NlxcdTBkOWEtXFx1MGRiMVxcdTBkYjMtXFx1MGRiYlxcdTBkYmRcXHUwZGMwLVxcdTBkYzZcXHUwZTAxLVxcdTBlMzBcXHUwZTMyLVxcdTBlMzNcXHUwZTQwLVxcdTBlNDZcXHUwZTUwLVxcdTBlNTlcXHUwZTgxLVxcdTBlODJcXHUwZTg0XFx1MGU4Ny1cXHUwZTg4XFx1MGU4YVxcdTBlOGRcXHUwZTk0LVxcdTBlOTdcXHUwZTk5LVxcdTBlOWZcXHUwZWExLVxcdTBlYTNcXHUwZWE1XFx1MGVhN1xcdTBlYWEtXFx1MGVhYlxcdTBlYWQtXFx1MGViMFxcdTBlYjItXFx1MGViM1xcdTBlYmRcXHUwZWMwLVxcdTBlYzRcXHUwZWM2XFx1MGVkMC1cXHUwZWQ5XFx1MGVkYy1cXHUwZWRkXFx1MGYwMFxcdTBmMjAtXFx1MGYyOVxcdTBmNDAtXFx1MGY0N1xcdTBmNDktXFx1MGY2Y1xcdTBmODgtXFx1MGY4YlxcdTEwMDAtXFx1MTAyYVxcdTEwM2YtXFx1MTA0OVxcdTEwNTAtXFx1MTA1NVxcdTEwNWEtXFx1MTA1ZFxcdTEwNjFcXHUxMDY1LVxcdTEwNjZcXHUxMDZlLVxcdTEwNzBcXHUxMDc1LVxcdTEwODFcXHUxMDhlXFx1MTA5MC1cXHUxMDk5XFx1MTBhMC1cXHUxMGM1XFx1MTBkMC1cXHUxMGZhXFx1MTBmY1xcdTExMDAtXFx1MTE1OVxcdTExNWYtXFx1MTFhMlxcdTExYTgtXFx1MTFmOVxcdTEyMDAtXFx1MTI0OFxcdTEyNGEtXFx1MTI0ZFxcdTEyNTAtXFx1MTI1NlxcdTEyNThcXHUxMjVhLVxcdTEyNWRcXHUxMjYwLVxcdTEyODhcXHUxMjhhLVxcdTEyOGRcXHUxMjkwLVxcdTEyYjBcXHUxMmIyLVxcdTEyYjVcXHUxMmI4LVxcdTEyYmVcXHUxMmMwXFx1MTJjMi1cXHUxMmM1XFx1MTJjOC1cXHUxMmQ2XFx1MTJkOC1cXHUxMzEwXFx1MTMxMi1cXHUxMzE1XFx1MTMxOC1cXHUxMzVhXFx1MTM4MC1cXHUxMzhmXFx1MTNhMC1cXHUxM2Y0XFx1MTQwMS1cXHUxNjZjXFx1MTY2Zi1cXHUxNjc2XFx1MTY4MS1cXHUxNjlhXFx1MTZhMC1cXHUxNmVhXFx1MTcwMC1cXHUxNzBjXFx1MTcwZS1cXHUxNzExXFx1MTcyMC1cXHUxNzMxXFx1MTc0MC1cXHUxNzUxXFx1MTc2MC1cXHUxNzZjXFx1MTc2ZS1cXHUxNzcwXFx1MTc4MC1cXHUxN2IzXFx1MTdkN1xcdTE3ZGNcXHUxN2UwLVxcdTE3ZTlcXHUxODEwLVxcdTE4MTlcXHUxODIwLVxcdTE4NzdcXHUxODgwLVxcdTE4YThcXHUxOGFhXFx1MTkwMC1cXHUxOTFjXFx1MTk0Ni1cXHUxOTZkXFx1MTk3MC1cXHUxOTc0XFx1MTk4MC1cXHUxOWE5XFx1MTljMS1cXHUxOWM3XFx1MTlkMC1cXHUxOWQ5XFx1MWEwMC1cXHUxYTE2XFx1MWIwNS1cXHUxYjMzXFx1MWI0NS1cXHUxYjRiXFx1MWI1MC1cXHUxYjU5XFx1MWI4My1cXHUxYmEwXFx1MWJhZS1cXHUxYmI5XFx1MWMwMC1cXHUxYzIzXFx1MWM0MC1cXHUxYzQ5XFx1MWM0ZC1cXHUxYzdkXFx1MWQwMC1cXHUxZGJmXFx1MWUwMC1cXHUxZjE1XFx1MWYxOC1cXHUxZjFkXFx1MWYyMC1cXHUxZjQ1XFx1MWY0OC1cXHUxZjRkXFx1MWY1MC1cXHUxZjU3XFx1MWY1OVxcdTFmNWJcXHUxZjVkXFx1MWY1Zi1cXHUxZjdkXFx1MWY4MC1cXHUxZmI0XFx1MWZiNi1cXHUxZmJjXFx1MWZiZVxcdTFmYzItXFx1MWZjNFxcdTFmYzYtXFx1MWZjY1xcdTFmZDAtXFx1MWZkM1xcdTFmZDYtXFx1MWZkYlxcdTFmZTAtXFx1MWZlY1xcdTFmZjItXFx1MWZmNFxcdTFmZjYtXFx1MWZmY1xcdTIwNzFcXHUyMDdmXFx1MjA5MC1cXHUyMDk0XFx1MjEwMlxcdTIxMDdcXHUyMTBhLVxcdTIxMTNcXHUyMTE1XFx1MjExOS1cXHUyMTFkXFx1MjEyNFxcdTIxMjZcXHUyMTI4XFx1MjEyYS1cXHUyMTJkXFx1MjEyZi1cXHUyMTM5XFx1MjEzYy1cXHUyMTNmXFx1MjE0NS1cXHUyMTQ5XFx1MjE0ZVxcdTIxODMtXFx1MjE4NFxcdTJjMDAtXFx1MmMyZVxcdTJjMzAtXFx1MmM1ZVxcdTJjNjAtXFx1MmM2ZlxcdTJjNzEtXFx1MmM3ZFxcdTJjODAtXFx1MmNlNFxcdTJkMDAtXFx1MmQyNVxcdTJkMzAtXFx1MmQ2NVxcdTJkNmZcXHUyZDgwLVxcdTJkOTZcXHUyZGEwLVxcdTJkYTZcXHUyZGE4LVxcdTJkYWVcXHUyZGIwLVxcdTJkYjZcXHUyZGI4LVxcdTJkYmVcXHUyZGMwLVxcdTJkYzZcXHUyZGM4LVxcdTJkY2VcXHUyZGQwLVxcdTJkZDZcXHUyZGQ4LVxcdTJkZGVcXHUzMDA1LVxcdTMwMDZcXHUzMDMxLVxcdTMwMzVcXHUzMDNiLVxcdTMwM2NcXHUzMDQxLVxcdTMwOTZcXHUzMDlkLVxcdTMwOWZcXHUzMGExLVxcdTMwZmFcXHUzMGZjLVxcdTMwZmZcXHUzMTA1LVxcdTMxMmRcXHUzMTMxLVxcdTMxOGVcXHUzMWEwLVxcdTMxYjdcXHUzMWYwLVxcdTMxZmZcXHUzNDAwLVxcdTRkYjVcXHU0ZTAwLVxcdTlmYzNcXHVhMDAwLVxcdWE0OGNcXHVhNTAwLVxcdWE2MGNcXHVhNjEwLVxcdWE2MmJcXHVhNjQwLVxcdWE2NWZcXHVhNjYyLVxcdWE2NmVcXHVhNjgwLVxcdWE2OTdcXHVhNzIyLVxcdWE3ODhcXHVhNzhiLVxcdWE3OGNcXHVhN2ZiLVxcdWE4MDFcXHVhODAzLVxcdWE4MDVcXHVhODA3LVxcdWE4MGFcXHVhODBjLVxcdWE4MjJcXHVhODQwLVxcdWE4NzNcXHVhODgyLVxcdWE4YjNcXHVhOGQwLVxcdWE4ZDlcXHVhOTAwLVxcdWE5MjVcXHVhOTMwLVxcdWE5NDZcXHVhYTAwLVxcdWFhMjhcXHVhYTQwLVxcdWFhNDJcXHVhYTQ0LVxcdWFhNGJcXHVhYTUwLVxcdWFhNTlcXHVhYzAwLVxcdWQ3YTNcXHVmOTAwLVxcdWZhMmRcXHVmYTMwLVxcdWZhNmFcXHVmYTcwLVxcdWZhZDlcXHVmYjAwLVxcdWZiMDZcXHVmYjEzLVxcdWZiMTdcXHVmYjFkXFx1ZmIxZi1cXHVmYjI4XFx1ZmIyYS1cXHVmYjM2XFx1ZmIzOC1cXHVmYjNjXFx1ZmIzZVxcdWZiNDAtXFx1ZmI0MVxcdWZiNDMtXFx1ZmI0NFxcdWZiNDYtXFx1ZmJiMVxcdWZiZDMtXFx1ZmQzZFxcdWZkNTAtXFx1ZmQ4ZlxcdWZkOTItXFx1ZmRjN1xcdWZkZjAtXFx1ZmRmYlxcdWZlNzAtXFx1ZmU3NFxcdWZlNzYtXFx1ZmVmY1xcdWZmMTAtXFx1ZmYxOVxcdWZmMjEtXFx1ZmYzYVxcdWZmNDEtXFx1ZmY1YVxcdWZmNjYtXFx1ZmZiZVxcdWZmYzItXFx1ZmZjN1xcdWZmY2EtXFx1ZmZjZlxcdWZmZDItXFx1ZmZkN1xcdWZmZGEtXFx1ZmZkY10qKShcXDooLis/KSk/XFxdL2lnO1xyXG5cclxuXHR2YXIgbWV0YVBhdGhQYXJzZXIgPSAvXiguKlxcLnwpbWV0YShcXC4uKnwpJC87XHJcblxyXG5cdGZ1bmN0aW9uIGNyZWF0ZVRlbXBsYXRlUGFyc2VyKHRlbXBsYXRlKSB7XHJcblx0ICAgIHZhciBwYXJzZSA9IGZ1bmN0aW9uIHBhcnNlRm9ybWF0VGVtcGxhdGUoKSB7XHJcblx0ICAgICAgICBpZiAoIXRoaXMuX3Rva2Vucykge1xyXG5cdCAgICAgICAgICAgIHRoaXMuX3Rva2VucyA9IFtdO1xyXG5cclxuXHQgICAgICAgICAgICAvLyBSZXBsYWNlIGVzY2FwZWQgXFwsIFsgb3IgXSBjaGFyYWN0ZXJzIHdpdGggcGxhY2Vob2xkZXJzXHJcblx0ICAgICAgICAgICAgdGVtcGxhdGUgPSB0ZW1wbGF0ZS5yZXBsYWNlKC9cXFxcXFxcXC9nLCAnXFx1MDAwMCcpLnJlcGxhY2UoL1xcXFxcXFsvZywgJ1xcdTAwMDEnKS5yZXBsYWNlKC9cXFxcXFxdL2csICdcXHUwMDAyJyk7XHJcblx0ICAgICAgICAgICAgdmFyIGluZGV4ID0gMDtcclxuXHQgICAgICAgICAgICBmb3JtYXRUZW1wbGF0ZVBhcnNlci5sYXN0SW5kZXggPSAwO1xyXG5cdCAgICAgICAgICAgIHZhciBtYXRjaCA9IGZvcm1hdFRlbXBsYXRlUGFyc2VyLmV4ZWModGVtcGxhdGUpO1xyXG5cclxuXHQgICAgICAgICAgICAvLyBQcm9jZXNzIGVhY2ggdG9rZW4gbWF0Y2hcclxuXHQgICAgICAgICAgICB3aGlsZSAobWF0Y2gpIHtcclxuXHQgICAgICAgICAgICAgICAgdmFyIHBhdGggPSBtYXRjaFsxXTtcclxuXHJcblx0ICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBhIHRva2VuIGZvciB0aGUgY3VycmVudCBtYXRjaCwgaW5jbHVkaW5nIHRoZSBwcmVmaXgsIHBhdGggYW5kIGZvcm1hdFxyXG5cdCAgICAgICAgICAgICAgICB0aGlzLl90b2tlbnMucHVzaCh7XHJcblx0ICAgICAgICAgICAgICAgICAgICBwcmVmaXg6IHRlbXBsYXRlLnN1YnN0cmluZyhpbmRleCwgZm9ybWF0VGVtcGxhdGVQYXJzZXIubGFzdEluZGV4IC0gbWF0Y2hbMF0ubGVuZ3RoKS5yZXBsYWNlKC9cXHUwMDAwL2csICdcXFxcJykucmVwbGFjZSgvXFx1MDAwMS9nLCAnWycpLnJlcGxhY2UoL1xcdTAwMDIvZywgJ10nKSxcclxuXHQgICAgICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsXHJcblx0ICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IG1hdGNoWzNdID8gbWF0Y2hbM10ucmVwbGFjZSgvXFx1MDAwMC9nLCAnXFxcXCcpLnJlcGxhY2UoL1xcdTAwMDEvZywgJ1snKS5yZXBsYWNlKC9cXHUwMDAyL2csICddJykgOiBudWxsXHJcblx0ICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuXHQgICAgICAgICAgICAgICAgLy8gVHJhY2sgdGhlIGxhc3QgaW5kZXggYW5kIGZpbmQgdGhlIG5leHQgbWF0Y2hcclxuXHQgICAgICAgICAgICAgICAgaW5kZXggPSBmb3JtYXRUZW1wbGF0ZVBhcnNlci5sYXN0SW5kZXg7XHJcblx0ICAgICAgICAgICAgICAgIG1hdGNoID0gZm9ybWF0VGVtcGxhdGVQYXJzZXIuZXhlYyh0ZW1wbGF0ZSk7XHJcblx0ICAgICAgICAgICAgfVxyXG5cclxuXHQgICAgICAgICAgICAvLyBDYXB0dXJlIGFueSB0cmFpbGluZyBsaXRlcmFsIHRleHQgYXMgYSB0b2tlbiB3aXRob3V0IGEgcGF0aFxyXG5cdCAgICAgICAgICAgIGlmIChpbmRleCA8IHRlbXBsYXRlLmxlbmd0aCkge1xyXG5cdCAgICAgICAgICAgICAgICB0aGlzLl90b2tlbnMucHVzaCh7XHJcblx0ICAgICAgICAgICAgICAgICAgICBwcmVmaXg6IHRlbXBsYXRlLnN1YnN0cmluZyhpbmRleCkucmVwbGFjZSgvXFx1MDAwMC9nLCAnXFxcXCcpLnJlcGxhY2UoL1xcdTAwMDEvZywgJ1snKS5yZXBsYWNlKC9cXHUwMDAyL2csICddJylcclxuXHQgICAgICAgICAgICAgICAgfSk7XHJcblx0ICAgICAgICAgICAgfVxyXG5cdCAgICAgICAgfVxyXG5cdCAgICB9O1xyXG5cdCAgICByZXR1cm4gcGFyc2U7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBjcmVhdGVUZW1wbGF0ZUNvbXBpbGVyKHR5cGUpIHtcclxuXHRcdHZhciBsb2dXYXJuaW5nID0gZnVuY3Rpb24gbG9nQ29tcGlsZUZvcm1hdFRlbXBsYXRlV2FybmluZyhtZXNzYWdlKSB7XHJcblx0XHRcdGlmICh0eXBlb2YgY29uc29sZSAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG5cdFx0XHRcdGlmIChjb25zb2xlLndhcm4gJiYgdHlwZW9mIGNvbnNvbGUud2FybiA9PT0gXCJmdW5jdGlvblwiKVxyXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKG1lc3NhZ2UpO1xyXG5cdFx0XHRcdGVsc2UgaWYgKGNvbnNvbGUubG9nICYmIHR5cGVvZiBjb25zb2xlLmxvZyA9PT0gXCJmdW5jdGlvblwiKVxyXG5cdFx0XHRcdFx0Y29uc29sZS5sb2coXCJXQVJOOiBcIiArIG1lc3NhZ2UpO1xyXG5cdFx0XHR9XHJcblx0XHR9O1xyXG5cclxuXHQgICAgdmFyIGNvbXBpbGUgPSBmdW5jdGlvbiBjb21waWxlRm9ybWF0VGVtcGxhdGUoY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHQgICAgICAgIC8vIEZpcnN0LCBlbnN1cmUgdGhhdCB0aGUgdGVtcGxhdGUgaXMgcGFyc2VkXHJcblx0ICAgICAgICB0aGlzLl9wYXJzZS5jYWxsKHRoaXMpO1xyXG5cclxuXHQgICAgICAgIC8vIERldGVjdCB3aGV0aGVyIHRoZSB0ZW1wbGF0ZSBpcyBiZWluZyBjb21waWxlZCBpbiBhc3luYyBtb2RlXHJcblx0ICAgICAgICB2YXIgaXNBc3luYyA9IGNhbGxiYWNrICYmIGNhbGxiYWNrIGluc3RhbmNlb2YgRnVuY3Rpb247XHJcblxyXG5cdCAgICAgICAgLy8gSWYgdGhlIHRlbXBsYXRlIGlzIGN1cnJlbnRseSBiZWluZyBjb21waWxlZCwgdGhlbiB3YWl0IGZvciBpdCB0byBjb21wbGV0ZVxyXG5cdCAgICAgICAgaWYgKHRoaXMuX2NvbXBpbGVTaWduYWwgJiYgaXNBc3luYykge1xyXG5cdCAgICAgICAgICAgIHRoaXMuX2NvbXBpbGVTaWduYWwud2FpdEZvckFsbChjYWxsYmFjaywgdGhpc1B0cik7XHJcblx0ICAgICAgICAgICAgcmV0dXJuO1xyXG5cdCAgICAgICAgfVxyXG5cclxuXHQgICAgICAgIC8vIElmIHRoZSB0ZW1wbGF0ZSBoYXMgYWxyZWFkeSBiZWVuIGNvbXBpbGVkLCB0aGVuIGludm9rZSB0aGUgY2FsbGJhY2sgaW1tZWRpYXRlbHlcclxuXHQgICAgICAgIGlmICh0aGlzLl9wYXRocyAmJiBpc0FzeW5jKSB7XHJcblx0ICAgICAgICAgICAgY2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdCAgICAgICAgICAgIHJldHVybjtcclxuXHQgICAgICAgIH1cclxuXHJcblx0ICAgICAgICBpZiAoIXRoaXMuX3BhdGhzKSB7XHJcblx0ICAgICAgICAgICAgaWYgKGlzQXN5bmMpIHtcclxuXHQgICAgICAgICAgICAgICAgdGhpcy5fY29tcGlsZVNpZ25hbCA9IG5ldyBTaWduYWwoXCJjb21waWxlRm9ybWF0VGVtcGxhdGVcIik7XHJcblx0ICAgICAgICAgICAgfVxyXG5cclxuXHQgICAgICAgICAgICB0aGlzLl9wYXRocyA9IFtdO1xyXG5cclxuXHQgICAgICAgICAgICB0aGlzLl90b2tlbnMuZm9yRWFjaChmdW5jdGlvbiAodG9rZW4pIHtcclxuXHQgICAgICAgICAgICAgICAgdmFyIHBhdGggPSB0b2tlbi5wYXRoO1xyXG5cdCAgICAgICAgICAgICAgICBpZiAocGF0aCkge1xyXG5cdCAgICAgICAgICAgICAgICAgICAgdmFyIHByb3BlcnR5UGF0aCA9IHBhdGg7XHJcblxyXG5cdCAgICAgICAgICAgICAgICAgICAgLy8gU2VlIGlmIHRoZSBwYXRoIHJlcHJlc2VudHMgYSBwcm9wZXJ0eSBwYXRoIGluIHRoZSBtb2RlbFxyXG5cdCAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuXHQgICAgICAgICAgICAgICAgICAgICAgICAvLyBEZXRlY3QgcHJvcGVydHkgcGF0aCBmb2xsb3dlZCBieSBcIi5tZXRhLi4uXCJcclxuXHQgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eVBhdGggPSBwcm9wZXJ0eVBhdGgucmVwbGFjZShtZXRhUGF0aFBhcnNlciwgXCIkMVwiKTtcclxuXHQgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXNNZXRhUGF0aCA9IHByb3BlcnR5UGF0aC5sZW5ndGggPiAwICYmIHByb3BlcnR5UGF0aC5sZW5ndGggPCBwYXRoLmxlbmd0aDtcclxuXHQgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWxsb3dGb3JtYXQgPSAhaXNNZXRhUGF0aDtcclxuXHQgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhUGF0aCkge1xyXG5cdCAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eVBhdGggPSBwcm9wZXJ0eVBhdGguc3Vic3RyaW5nKDAsIHByb3BlcnR5UGF0aC5sZW5ndGggLSAxKTtcclxuXHQgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG5cdCAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGEgcHJvcGVydHkgcGF0aCByZW1haW5zLCB0aGVuIGF0dGVtcHQgdG8gZmluZCBhIGRlZmF1bHQgZm9ybWF0IGFuZCBwYXRocyBmb3IgdGhlIGZvcm1hdFxyXG5cdCAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0eVBhdGgpIHtcclxuXHQgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb2Nlc3NGb3JtYXRQcm9wZXJ0eSA9IGZ1bmN0aW9uIChwcm9wZXJ0eSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAocHJvcGVydHkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBPbmx5IGFsbG93IGZvcm1hdHMgZm9yIGEgcHJvcGVydHkgcGF0aCB0aGF0IGlzIG5vdCBmb2xsb3dlZCBieSBcIi5tZXRhLi4uXCJcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoYWxsb3dGb3JtYXQpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8vIERldGVybWluZSB0aGUgZGVmYXVsdCBwcm9wZXJ0eSBmb3JtYXRcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBkZWZhdWx0Rm9ybWF0ID0gcHJvcGVydHkuZ2V0X2Zvcm1hdCgpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8vIElmIHRoZSBwYXRoIHJlZmVyZW5jZXMgb25lIG9yIG1vcmUgZW50aXR5IHByb3BlcnRpZXMsIGluY2x1ZGUgcGF0aHMgZm9yIHRoZSBwcm9wZXJ0eSBmb3JtYXQuIE90aGVyd2lzZSwganVzdCBhZGQgdGhlIHBhdGguXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgbGFzdEluZGV4ID0gZm9ybWF0VGVtcGxhdGVQYXJzZXIubGFzdEluZGV4O1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKGRlZmF1bHRGb3JtYXQgJiYgZGVmYXVsdEZvcm1hdC5jb25zdHJ1Y3RvciA9PT0gRm9ybWF0ICYmIGRlZmF1bHRGb3JtYXQgIT09IHRoaXMgJiYgZGVmYXVsdEZvcm1hdC5nZXRQYXRocygpLmxlbmd0aCA+IDApXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHRoaXMuX3BhdGhzLmFkZFJhbmdlKGRlZmF1bHRGb3JtYXQuZ2V0UGF0aHMoKS5tYXAoZnVuY3Rpb24gKHApIHsgcmV0dXJuIHByb3BlcnR5UGF0aCArIFwiLlwiICsgcDsgfSkpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZWxzZVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR0aGlzLl9wYXRocy5wdXNoKHByb3BlcnR5UGF0aCk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRmb3JtYXRUZW1wbGF0ZVBhcnNlci5sYXN0SW5kZXggPSBsYXN0SW5kZXg7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBVc2UgdGhlIGRlZmF1bHQgZm9ybWF0IGZvciB0aGUgcHJvcGVydHlcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmICghdG9rZW4uZm9ybWF0KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHRva2VuLmZvcm1hdCA9IGRlZmF1bHRGb3JtYXQ7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8vIEZvcm1hdHMgYXJlIG5vdCBhbGxvd2VkLCBzbyBqdXN0IGFkZCB0aGUgcGF0aFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dGhpcy5fcGF0aHMucHVzaChwcm9wZXJ0eVBhdGgpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRsb2dXYXJuaW5nKFwiUGF0aCAnXCIgKyBwcm9wZXJ0eVBhdGggKyBcIicgaXMgbm90IHZhbGlkLlwiKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdCAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdC8vIEdldCB0aGUgcHJvcGVydHkgYW5kIHByb2Nlc3MgaXQgZWl0aGVyIGltbWVkaWF0ZWx5LCBvciB3aGVuIHRoZSBwYXRoIGlzIGF2YWlsYWJsZSAoaWYgY29tcGlsaW5nIGluIGFzeW5jIG1vZGUpXHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoaXNBc3luYykge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRNb2RlbC5wcm9wZXJ0eShwcm9wZXJ0eVBhdGgsIHR5cGUsIGZhbHNlLCB0aGlzLl9jb21waWxlU2lnbmFsLnBlbmRpbmcocHJvY2Vzc0Zvcm1hdFByb3BlcnR5LCB0aGlzKSwgdGhpcywgZmFsc2UpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIHByb3BlcnR5ID0gTW9kZWwucHJvcGVydHkocHJvcGVydHlQYXRoLCB0eXBlKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKHByb3BlcnR5KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0cHJvY2Vzc0Zvcm1hdFByb3BlcnR5LmNhbGwodGhpcywgcHJvcGVydHkpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGxvZ1dhcm5pbmcoXCJQYXRoICdcIiArIHByb3BlcnR5UGF0aCArIFwiJyBpcyBub3QgdmFsaWQuXCIpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0ICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cdCAgICAgICAgICAgICAgICAgICAgfVxyXG5cdFx0XHRcdFx0XHRjYXRjaCAoZSkge1xyXG5cdFx0XHRcdFx0XHRcdGxvZ1dhcm5pbmcoZSk7XHJcblx0ICAgICAgICAgICAgICAgICAgICB9XHJcblx0ICAgICAgICAgICAgICAgIH1cclxuXHQgICAgICAgICAgICB9LCB0aGlzKTtcclxuXHJcblx0ICAgICAgICAgICAgLy8gSWYgdGhlIGZvcm1hdCBpcyBiZWluZyBjb21waWxlZCBhc3luYywgdGhlbiBpbnZva2UgdGhlIGNhbGxiYWNrIHdoZW4gY29tcGxldGVcclxuXHQgICAgICAgICAgICBpZiAoaXNBc3luYykge1xyXG5cdCAgICAgICAgICAgICAgICB0aGlzLl9jb21waWxlU2lnbmFsLndhaXRGb3JBbGwoZnVuY3Rpb24gKCkge1xyXG5cdCAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdCAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2NvbXBpbGVTaWduYWw7XHJcblx0ICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xyXG5cdCAgICAgICAgICAgIH1cclxuXHQgICAgICAgIH1cclxuXHQgICAgfTtcclxuXHQgICAgcmV0dXJuIGNvbXBpbGU7XHJcblx0fVxyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLk1vZGVsLkZvcm1hdFxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIEZvcm1hdChvcHRpb25zKSB7XHJcblx0XHRpZiAoIW9wdGlvbnMuaGFzT3duUHJvcGVydHkoXCJzcGVjaWZpZXJcIikgfHwgIWlzU3RyaW5nKG9wdGlvbnMuc3BlY2lmaWVyKSkge1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJGb3JtYXQgc3BlY2lmaWVyIHN0cmluZyBtdXN0IGJlIHByb3ZpZGVkLlwiKTtcclxuXHRcdH1cclxuXHRcdHRoaXMuX3NwZWNpZmllciA9IG9wdGlvbnMuc3BlY2lmaWVyO1xyXG5cdFx0dGhpcy5fcGF0aHMgPSBvcHRpb25zLnBhdGhzO1xyXG5cdFx0dGhpcy5fY29udmVydCA9IG9wdGlvbnMuY29udmVydDtcclxuXHRcdHRoaXMuX2NvbnZlcnRCYWNrID0gb3B0aW9ucy5jb252ZXJ0QmFjaztcclxuXHRcdHRoaXMuX3BhcnNlID0gb3B0aW9ucy5wYXJzZTtcclxuXHRcdHRoaXMuX2NvbXBpbGUgPSBvcHRpb25zLmNvbXBpbGU7XHJcblx0XHR0aGlzLl9kZXNjcmlwdGlvbiA9IG9wdGlvbnMuZGVzY3JpcHRpb247XHJcblx0XHR0aGlzLl9udWxsU3RyaW5nID0gb3B0aW9ucy5udWxsU3RyaW5nIHx8IFwiXCI7XHJcblx0XHR0aGlzLl91bmRlZmluZWRTdHJpbmcgPSBvcHRpb25zLnVuZGVmaW5lZFN0cmluZyB8fCBcIlwiO1xyXG5cdFx0dGhpcy5fZ2V0Rm9ybWF0dGVkVmFsdWUgPSBmdW5jdGlvbiAob2JqKSB7XHJcblx0XHRcdHZhciByZXN1bHQgPSBcIlwiO1xyXG5cdFx0XHRmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5fdG9rZW5zLmxlbmd0aDsgaW5kZXgrKykge1xyXG5cdFx0XHRcdHZhciB0b2tlbiA9IHRoaXMuX3Rva2Vuc1tpbmRleF07XHJcblx0XHRcdFx0aWYgKHRva2VuLnByZWZpeClcclxuXHRcdFx0XHRcdHJlc3VsdCA9IHJlc3VsdCArIHRva2VuLnByZWZpeDtcclxuXHRcdFx0XHRpZiAodG9rZW4ucGF0aCkge1xyXG5cdFx0XHRcdFx0dmFyIHZhbHVlID0gZXZhbFBhdGgob2JqLCB0b2tlbi5wYXRoKTtcclxuXHRcdFx0XHRcdGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsKVxyXG5cdFx0XHRcdFx0XHR2YWx1ZSA9IFwiXCI7XHJcblx0XHRcdFx0XHRlbHNlIGlmICh0b2tlbi5mb3JtYXQpIHtcclxuXHRcdFx0XHRcdFx0aWYgKHRva2VuLmZvcm1hdC5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XHJcblx0XHRcdFx0XHRcdFx0dG9rZW4uZm9ybWF0ID0gZ2V0Rm9ybWF0KHZhbHVlLmNvbnN0cnVjdG9yLCB0b2tlbi5mb3JtYXQpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRpZiAodmFsdWUgaW5zdGFuY2VvZiBBcnJheSlcclxuXHRcdFx0XHRcdFx0XHR2YWx1ZSA9IHZhbHVlLm1hcChmdW5jdGlvbiAodikgeyByZXR1cm4gdG9rZW4uZm9ybWF0LmNvbnZlcnQodik7IH0pLmpvaW4oXCIsIFwiKTtcclxuXHRcdFx0XHRcdFx0ZWxzZVxyXG5cdFx0XHRcdFx0XHRcdHZhbHVlID0gdG9rZW4uZm9ybWF0LmNvbnZlcnQodmFsdWUpO1xyXG5cclxuXHRcdFx0XHRcdFx0aWYgKHRoaXMuX2Zvcm1hdEV2YWwpXHJcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSB0aGlzLl9mb3JtYXRFdmFsKHZhbHVlKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHJlc3VsdCA9IHJlc3VsdCArIHZhbHVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdH07XHJcblxyXG5cdFx0Ly8gZnVuY3Rpb24gdG8gcGVyZm9ybSBhZGRpdGlvbmFsIHBvc3QgZm9ybWF0dGluZ1xyXG5cdFx0dGhpcy5fZm9ybWF0RXZhbCA9IG9wdGlvbnMuZm9ybWF0RXZhbDtcclxuXHR9XHJcblxyXG5cdEZvcm1hdC5mcm9tVGVtcGxhdGUgPSBmdW5jdGlvbiBGb3JtYXQkZnJvbVRlbXBsYXRlKHR5cGUsIHRlbXBsYXRlLCBmb3JtYXRFdmFsKSB7XHJcblxyXG5cdFx0cmV0dXJuIG5ldyBGb3JtYXQoe1xyXG5cdFx0XHRzcGVjaWZpZXI6IHRlbXBsYXRlLFxyXG5cclxuXHRcdFx0cGFyc2U6IGNyZWF0ZVRlbXBsYXRlUGFyc2VyKHRlbXBsYXRlKSxcclxuXHJcblx0XHRcdGNvbXBpbGU6IGNyZWF0ZVRlbXBsYXRlQ29tcGlsZXIodHlwZSksXHJcblxyXG5cdFx0XHRjb252ZXJ0OiBmdW5jdGlvbiBjb252ZXJ0KG9iaikge1xyXG5cdFx0XHRcdGlmIChvYmogPT09IG51bGwgfHwgb2JqID09PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRcdHJldHVybiBcIlwiO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gRW5zdXJlIHRoZSBmb3JtYXQgaGFzIGJlZW4gY29tcGlsZWRcclxuXHRcdFx0XHR0aGlzLl9jb21waWxlKCk7XHJcblxyXG5cdFx0XHRcdHZhciByZXN1bHQgPSBcIlwiO1xyXG5cdFx0XHRcdGlmIChvYmogaW5zdGFuY2VvZiBBcnJheSlcclxuXHRcdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0XHRcdHZhciB2YWx1ZSA9IHRoaXMuX2dldEZvcm1hdHRlZFZhbHVlKG9ialtpXSk7XHJcblxyXG5cdFx0XHRcdFx0XHRpZiAocmVzdWx0ICE9PSBcIlwiICYmIHZhbHVlICE9PSBcIlwiKVxyXG5cdFx0XHRcdFx0XHRcdHJlc3VsdCA9IHJlc3VsdCArIFwiLCBcIiArIHZhbHVlO1xyXG5cdFx0XHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0XHRcdFx0cmVzdWx0ID0gcmVzdWx0ICsgdmFsdWU7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZVxyXG5cdFx0XHRcdFx0cmVzdWx0ID0gdGhpcy5fZ2V0Rm9ybWF0dGVkVmFsdWUob2JqKTtcclxuXHJcblx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdFx0fSxcclxuXHJcblx0XHRcdGZvcm1hdEV2YWw6IGZvcm1hdEV2YWxcclxuXHRcdH0pO1xyXG5cdH07XHJcblxyXG5cdEZvcm1hdC5taXhpbih7XHJcblx0XHRnZXRUb2tlbnM6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0aWYgKHRoaXMuX3BhcnNlKVxyXG5cdFx0XHRcdHRoaXMuX3BhcnNlKCk7XHJcblx0XHRcdHJldHVybiB0aGlzLl90b2tlbnMgfHwgW107XHJcblx0XHR9LFxyXG5cdFx0Z2V0UGF0aHM6IGZ1bmN0aW9uIChjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0XHRpZiAodGhpcy5fY29tcGlsZSkge1xyXG5cdFx0XHRcdGlmIChjYWxsYmFjayAmJiBjYWxsYmFjayBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9jb21waWxlLmNhbGwodGhpcywgZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0XHR2YXIgcGF0aHMgPSB0aGlzLl9wYXRocyB8fCBbXTtcclxuXHRcdFx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMsIHBhdGhzKTtcclxuXHRcdFx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHR0aGlzLl9jb21waWxlKCk7XHJcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fcGF0aHMgfHwgW107XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdHJldHVybiB0aGlzLl9wYXRocyB8fCBbXTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdGNvbnZlcnQ6IGZ1bmN0aW9uICh2YWwpIHtcclxuXHRcdFx0aWYgKHZhbCA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0cmV0dXJuIHRoaXMuX3VuZGVmaW5lZFN0cmluZztcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKHZhbCA9PT0gbnVsbCkge1xyXG5cdFx0XHRcdHJldHVybiB0aGlzLl9udWxsU3RyaW5nO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAodmFsIGluc3RhbmNlb2YgRm9ybWF0RXJyb3IpIHtcclxuXHRcdFx0XHRyZXR1cm4gdmFsLmdldF9pbnZhbGlkVmFsdWUoKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKCF0aGlzLl9jb252ZXJ0KSB7XHJcblx0XHRcdFx0cmV0dXJuIHZhbDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX2NvbnZlcnQodmFsKTtcclxuXHRcdH0sXHJcblx0XHRjb252ZXJ0QmFjazogZnVuY3Rpb24gKHZhbCkge1xyXG5cdFx0XHRpZiAodmFsID09PSBudWxsIHx8IHZhbCA9PSB0aGlzLl9udWxsU3RyaW5nKSB7XHJcblx0XHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICh2YWwgPT09IHVuZGVmaW5lZCB8fCB2YWwgPT0gdGhpcy5fdW5kZWZpbmVkU3RyaW5nKSB7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAodmFsLmNvbnN0cnVjdG9yID09IFN0cmluZykge1xyXG5cdFx0XHRcdHZhbCA9IHZhbC50cmltKCk7XHJcblxyXG5cdFx0XHRcdGlmICh2YWwubGVuZ3RoID09PSAwKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICghdGhpcy5fY29udmVydEJhY2spIHtcclxuXHRcdFx0XHRyZXR1cm4gdmFsO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0cnkge1xyXG5cdFx0XHRcdHJldHVybiB0aGlzLl9jb252ZXJ0QmFjayh2YWwpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGNhdGNoIChlcnIpIHtcclxuXHRcdFx0XHRpZiAoZXJyIGluc3RhbmNlb2YgRm9ybWF0RXJyb3IpIHtcclxuXHRcdFx0XHRcdHJldHVybiBlcnI7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdCAgICByZXR1cm4gbmV3IEZvcm1hdEVycm9yKHRoaXMuX2Rlc2NyaXB0aW9uID8gXHJcblx0ICAgICAgICAgICAgICAgICAgICBSZXNvdXJjZS5nZXQoXCJmb3JtYXQtd2l0aC1kZXNjcmlwdGlvblwiKS5yZXBsYWNlKCd7ZGVzY3JpcHRpb259JywgdGhpcy5fZGVzY3JpcHRpb24pIDpcclxuXHRcdFx0XHRcdFx0UmVzb3VyY2UuZ2V0KFwiZm9ybWF0LXdpdGhvdXQtZGVzY3JpcHRpb25cIiksXHJcblx0XHRcdFx0XHRcdFx0XHR2YWwpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdHRvU3RyaW5nOiBmdW5jdGlvbigpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX3NwZWNpZmllcjtcclxuXHRcdH1cdFxyXG5cdH0pO1xyXG5cclxuXHRGb3JtYXQuaGFzVG9rZW5zID0gZnVuY3Rpb24gaGFzVG9rZW5zKHRlbXBsYXRlKSB7XHJcblx0XHRmb3JtYXRUZW1wbGF0ZVBhcnNlci5sYXN0SW5kZXggPSAwO1xyXG5cdFx0cmV0dXJuIGZvcm1hdFRlbXBsYXRlUGFyc2VyLnRlc3QodGVtcGxhdGUpO1xyXG5cdH1cclxuXHJcblx0RXhvV2ViLk1vZGVsLkZvcm1hdCA9IEZvcm1hdDtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5Nb2RlbC5Nb2RlbFxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIE1vZGVsKCkge1xyXG5cdFx0dGhpcy5fdHlwZXMgPSB7fTtcclxuXHRcdHRoaXMuX3J1bGVRdWV1ZSA9IFtdO1xyXG5cdH1cclxuXHJcblx0TW9kZWwubWl4aW4oRnVuY3Rvci5ldmVudGluZyk7XHJcblxyXG5cdE1vZGVsLm1peGluKHtcclxuXHRcdGRpc3Bvc2U6IGZ1bmN0aW9uIE1vZGVsJGRpc3Bvc2UoKSB7XHJcblx0XHRcdGZvciAodmFyIGtleSBpbiB0aGlzLl90eXBlcykge1xyXG5cdFx0XHRcdGRlbGV0ZSB3aW5kb3dba2V5XTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdGFkZFR5cGU6IGZ1bmN0aW9uIE1vZGVsJGFkZFR5cGUobmFtZSwgYmFzZSwgb3JpZ2luLCBmb3JtYXQpIHtcclxuXHRcdFx0dmFyIHR5cGUgPSBuZXcgVHlwZSh0aGlzLCBuYW1lLCBiYXNlLCBvcmlnaW4sIGZvcm1hdCk7XHJcblx0XHRcdHRoaXMuX3R5cGVzW25hbWVdID0gdHlwZTtcclxuXHRcdFx0cmV0dXJuIHR5cGU7XHJcblx0XHR9LFxyXG5cdFx0dHlwZTogZnVuY3Rpb24gKG5hbWUpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX3R5cGVzW25hbWVdO1xyXG5cdFx0fSxcclxuXHRcdHR5cGVzOiBmdW5jdGlvbiAoZmlsdGVyKSB7XHJcblx0XHRcdHZhciByZXN1bHQgPSBbXSwgdHlwZU5hbWUsIHR5cGU7XHJcblx0XHRcdGZvciAodHlwZU5hbWUgaW4gdGhpcy5fdHlwZXMpIHtcclxuXHRcdFx0XHR0eXBlID0gdGhpcy5fdHlwZXNbdHlwZU5hbWVdO1xyXG5cdFx0XHRcdGlmICghZmlsdGVyIHx8IGZpbHRlcih0eXBlKSkge1xyXG5cdFx0XHRcdFx0cmVzdWx0LnB1c2godHlwZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiByZXN1bHQ7XHJcblx0XHR9LFxyXG5cdFx0YWRkQmVmb3JlQ29udGV4dFJlYWR5OiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHQvLyBPbmx5IGV4ZWN1dGVzIHRoZSBnaXZlbiBoYW5kbGVyIG9uY2UsIHNpbmNlIHRoZSBldmVudCBzaG91bGQgb25seSBmaXJlIG9uY2VcclxuXHRcdFx0aWYgKCF0aGlzLl9jb250ZXh0UmVhZHkpIHtcclxuXHRcdFx0XHR0aGlzLl9hZGRFdmVudChcImJlZm9yZUNvbnRleHRSZWFkeVwiLCBoYW5kbGVyLCBudWxsLCB0cnVlKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRoYW5kbGVyKCk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gcXVldWVzIGEgcnVsZSB0byBiZSByZWdpc3RlcmVkXHJcblx0XHRyZWdpc3RlclJ1bGU6IGZ1bmN0aW9uIE1vZGVsJHJlZ2lzdGVyUnVsZShydWxlKSB7XHJcblx0XHRcdGlmICghdGhpcy5fY29udGV4dFJlYWR5KSB7XHJcblx0XHRcdFx0dGhpcy5fcnVsZVF1ZXVlLnB1c2gocnVsZSk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0cnVsZS5yZWdpc3RlcigpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIHJlZ2lzdGVyIHJ1bGVzIHBlbmRpbmcgcmVnaXN0cmF0aW9uXHJcblx0XHRyZWdpc3RlclJ1bGVzOiBmdW5jdGlvbiBNb2RlbCRyZWdpc3RlclJ1bGVzKCkge1xyXG5cdFx0XHR2YXIgaSwgcnVsZXMgPSB0aGlzLl9ydWxlUXVldWU7XHJcblx0XHRcdHRoaXMuX3J1bGVRdWV1ZSA9IFtdO1xyXG5cdFx0XHRmb3IgKGkgPSAwOyBpIDwgcnVsZXMubGVuZ3RoOyBpICs9IDEpIHtcclxuXHRcdFx0XHRydWxlc1tpXS5yZWdpc3RlcigpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0bm90aWZ5QmVmb3JlQ29udGV4dFJlYWR5OiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHRoaXMuX2NvbnRleHRSZWFkeSA9IHRydWU7XHJcblx0XHRcdHRoaXMucmVnaXN0ZXJSdWxlcygpO1xyXG5cdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwiYmVmb3JlQ29udGV4dFJlYWR5XCIsIFtdKTtcclxuXHRcdH0sXHJcblx0XHRhZGRBZnRlclByb3BlcnR5U2V0OiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9hZGRFdmVudChcImFmdGVyUHJvcGVydHlTZXRcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0bm90aWZ5QWZ0ZXJQcm9wZXJ0eVNldDogZnVuY3Rpb24gKG9iaiwgcHJvcGVydHksIG5ld1ZhbCwgb2xkVmFsKSB7XHJcblx0XHRcdHRoaXMuX3JhaXNlRXZlbnQoXCJhZnRlclByb3BlcnR5U2V0XCIsIFtvYmosIHByb3BlcnR5LCBuZXdWYWwsIG9sZFZhbF0pO1xyXG5cdFx0fSxcclxuXHRcdGFkZE9iamVjdFJlZ2lzdGVyZWQ6IGZ1bmN0aW9uIChmdW5jLCBvYmplY3RPckZ1bmN0aW9uLCBvbmNlKSB7XHJcblx0XHRcdHRoaXMuX2FkZEV2ZW50KFwib2JqZWN0UmVnaXN0ZXJlZFwiLCBmdW5jLCBvYmplY3RPckZ1bmN0aW9uID8gKG9iamVjdE9yRnVuY3Rpb24gaW5zdGFuY2VvZiBGdW5jdGlvbiA/IG9iamVjdE9yRnVuY3Rpb24gOiBlcXVhbHMob2JqZWN0T3JGdW5jdGlvbikpIDogbnVsbCwgb25jZSk7XHJcblx0XHR9LFxyXG5cdFx0cmVtb3ZlT2JqZWN0UmVnaXN0ZXJlZDogZnVuY3Rpb24gKGZ1bmMpIHtcclxuXHRcdFx0dGhpcy5fcmVtb3ZlRXZlbnQoXCJvYmplY3RSZWdpc3RlcmVkXCIsIGZ1bmMpO1xyXG5cdFx0fSxcclxuXHRcdG5vdGlmeU9iamVjdFJlZ2lzdGVyZWQ6IGZ1bmN0aW9uIChvYmopIHtcclxuXHRcdFx0dGhpcy5fcmFpc2VFdmVudChcIm9iamVjdFJlZ2lzdGVyZWRcIiwgW29ial0pO1xyXG5cdFx0fSxcclxuXHRcdGFkZE9iamVjdFVucmVnaXN0ZXJlZDogZnVuY3Rpb24gKGZ1bmMpIHtcclxuXHRcdFx0dGhpcy5fYWRkRXZlbnQoXCJvYmplY3RVbnJlZ2lzdGVyZWRcIiwgZnVuYyk7XHJcblx0XHR9LFxyXG5cdFx0bm90aWZ5T2JqZWN0VW5yZWdpc3RlcmVkOiBmdW5jdGlvbiAob2JqKSB7XHJcblx0XHRcdHRoaXMuX3JhaXNlRXZlbnQoXCJvYmplY3RVbnJlZ2lzdGVyZWRcIiwgW29ial0pO1xyXG5cdFx0fSxcclxuXHRcdGFkZExpc3RDaGFuZ2VkOiBmdW5jdGlvbiAoZnVuYykge1xyXG5cdFx0XHR0aGlzLl9hZGRFdmVudChcImxpc3RDaGFuZ2VkXCIsIGZ1bmMpO1xyXG5cdFx0fSxcclxuXHRcdG5vdGlmeUxpc3RDaGFuZ2VkOiBmdW5jdGlvbiAob2JqLCBwcm9wZXJ0eSwgY2hhbmdlcykge1xyXG5cdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwibGlzdENoYW5nZWRcIiwgW29iaiwgcHJvcGVydHksIGNoYW5nZXNdKTtcclxuXHRcdH0sXHJcblx0XHRfZW5zdXJlTmFtZXNwYWNlOiBmdW5jdGlvbiBNb2RlbCRfZW5zdXJlTmFtZXNwYWNlKG5hbWUsIHBhcmVudE5hbWVzcGFjZSkge1xyXG5cdFx0XHR2YXIgcmVzdWx0LCBuc1Rva2VucywgdGFyZ2V0ID0gcGFyZW50TmFtZXNwYWNlO1xyXG5cclxuXHRcdFx0aWYgKHRhcmdldC5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XHJcblx0XHRcdFx0bnNUb2tlbnMgPSB0YXJnZXQuc3BsaXQoXCIuXCIpO1xyXG5cdFx0XHRcdHRhcmdldCA9IHdpbmRvdztcclxuXHRcdFx0XHRBcnJheS5mb3JFYWNoKG5zVG9rZW5zLCBmdW5jdGlvbiAodG9rZW4pIHtcclxuXHRcdFx0XHRcdHRhcmdldCA9IHRhcmdldFt0b2tlbl07XHJcblxyXG5cdFx0XHRcdFx0aWYgKHRhcmdldCA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIlBhcmVudCBuYW1lc3BhY2UgXFxcIlwiICsgcGFyZW50TmFtZXNwYWNlICsgXCJcXFwiIGNvdWxkIG5vdCBiZSBmb3VuZC5cIik7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH0gZWxzZSBpZiAodGFyZ2V0ID09PSB1bmRlZmluZWQgfHwgdGFyZ2V0ID09PSBudWxsKSB7XHJcblx0XHRcdFx0dGFyZ2V0ID0gd2luZG93O1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBjcmVhdGUgdGhlIG5hbWVzcGFjZSBvYmplY3QgaWYgaXQgZG9lc24ndCBleGlzdCwgb3RoZXJ3aXNlIHJldHVybiB0aGUgZXhpc3RpbmcgbmFtZXNwYWNlXHJcblx0XHRcdGlmICghKG5hbWUgaW4gdGFyZ2V0KSkge1xyXG5cdFx0XHRcdHJlc3VsdCA9IHRhcmdldFtuYW1lXSA9IHt9O1xyXG5cdFx0XHRcdHJldHVybiByZXN1bHQ7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0cmV0dXJuIHRhcmdldFtuYW1lXTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHRmdW5jdGlvbiBlbnN1cmVUeXBlKHR5cGUsIGZvcmNlTG9hZCwgY2FsbGJhY2spIHtcclxuXHJcblx0XHQvLyBpbW1lZGlhdGVseSBpbnZva2UgdGhlIGNhbGxiYWNrIGlmIG5vIHR5cGUgd2FzIHNwZWNpZmllZCBvciB0aGUgdHlwZSBpcyBsb2FkZWRcclxuXHRcdGlmICghdHlwZSB8fCBMYXp5TG9hZGVyLmlzTG9hZGVkKHR5cGUpKSB7XHJcblx0XHRcdHJldHVybiBjYWxsYmFjaygpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGZvcmNlIHR5cGUgbG9hZGluZyBpZiByZXF1ZXN0ZWRcclxuXHRcdGlmIChmb3JjZUxvYWQpIHtcclxuXHRcdFx0TGF6eUxvYWRlci5sb2FkKHR5cGUsIG51bGwsIGZhbHNlLCBjYWxsYmFjayk7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gb3RoZXJ3aXNlLCBvbmx5IGNvbnRpbnVlIHByb2Nlc3Npbmcgd2hlbiBhbmQgaWYgZGVwZW5kZW50IHR5cGVzIGFyZSBsb2FkZWRcclxuXHRcdGVsc2Uge1xyXG5cdFx0XHQkZXh0ZW5kKHR5cGUuX2Z1bGxOYW1lLCBjYWxsYmFjayk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIG51bGw7XHJcblx0fVxyXG5cclxuXHRNb2RlbC5wcm9wZXJ0eSA9IGZ1bmN0aW9uIE1vZGVsJHByb3BlcnR5KHBhdGgsIHRoaXNUeXBlLyosIGZvcmNlTG9hZFR5cGVzLCBjYWxsYmFjaywgdGhpc1B0ciwgd2FpdEZvckdsb2JhbHMqLykge1xyXG5cclxuXHRcdHZhciB0eXBlLFxyXG5cdFx0XHRsb2FkUHJvcGVydHksXHJcblx0XHRcdHNpbmdsZVByb3BlcnR5TmFtZSxcclxuXHRcdFx0dG9rZW5zID0gbnVsbCxcclxuXHRcdFx0Zm9yY2VMb2FkVHlwZXMgPSBhcmd1bWVudHMubGVuZ3RoID49IDMgJiYgdHlwZW9mIGFyZ3VtZW50c1syXSA9PT0gXCJib29sZWFuXCIgPyBhcmd1bWVudHNbMl0gOiBmYWxzZSxcclxuXHRcdFx0Y2FsbGJhY2sgPSBhcmd1bWVudHNbM10sXHJcblx0XHRcdHRoaXNQdHIgPSBhcmd1bWVudHNbNF0sXHJcblx0XHRcdHdhaXRGb3JHbG9iYWxzID0gYXJndW1lbnRzLmxlbmd0aCA+PSA2ICYmIHR5cGVvZiBhcmd1bWVudHNbNV0gPT09IFwiYm9vbGVhblwiID8gYXJndW1lbnRzWzVdIDogdHJ1ZTtcclxuXHJcblx0XHQvLyBBbGxvdyB0aGUgcGF0aCBhcmd1bWVudCB0byBiZSBlaXRoZXIgYSBzdHJpbmcgb3IgUGF0aFRva2VucyBpbnN0YW5jZS5cclxuXHRcdGlmIChwYXRoLmNvbnN0cnVjdG9yID09PSBQYXRoVG9rZW5zKSB7XHJcblx0XHRcdHRva2VucyA9IHBhdGg7XHJcblx0XHRcdHBhdGggPSB0b2tlbnMuZXhwcmVzc2lvbjtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBSZXR1cm4gY2FjaGVkIHByb3BlcnR5IGNoYWlucyBhcyBzb29uIGFzIHBvc3NpYmxlIChpbiBvdGhlciB3b3JkcyxcclxuXHRcdC8vIGRvIGFzIGxpdHRsZSBhcyBwb3NzaWJsZSBwcmlvciB0byByZXR1cm5pbmcgdGhlIGNhY2hlZCBjaGFpbikuXHJcblx0XHRpZiAodGhpc1R5cGUgJiYgdGhpc1R5cGUuX2NoYWlucyAmJiB0aGlzVHlwZS5fY2hhaW5zW3BhdGhdKSB7XHJcblx0XHRcdGlmIChjYWxsYmFjaykge1xyXG5cdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzLCB0aGlzVHlwZS5fY2hhaW5zW3BhdGhdKTtcclxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRyZXR1cm4gdGhpc1R5cGUuX2NoYWluc1twYXRoXTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdC8vIFRoZSBwYXRoIGFyZ3VtZW50IHdhcyBhIHN0cmluZywgc28gdXNlIGl0IHRvIGNyZWF0ZSBhIFBhdGhUb2tlbnMgb2JqZWN0LlxyXG5cdFx0Ly8gRGVsYXkgZG9pbmcgdGhpcyBhcyBhbiBvcHRpbWl6YXRpb24gZm9yIGNhY2hlZCBwcm9wZXJ0eSBjaGFpbnMuXHJcblx0XHRpZiAoIXRva2Vucykge1xyXG5cdFx0XHR0b2tlbnMgPSBuZXcgUGF0aFRva2VucyhwYXRoKTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBnZXQgdGhlIGluc3RhbmNlIHR5cGUsIGlmIHNwZWNpZmllZFxyXG5cdFx0dHlwZSA9IHRoaXNUeXBlIGluc3RhbmNlb2YgRnVuY3Rpb24gPyB0aGlzVHlwZS5tZXRhIDogdGhpc1R5cGU7XHJcblxyXG5cdFx0Ly8gZGV0ZXJtaW5lIGlmIGEgdHlwZWNhc3Qgd2FzIHNwZWNpZmllZCBmb3IgdGhlIHBhdGggdG8gaWRlbnRpZnkgYSBzcGVjaWZpYyBzdWJjbGFzcyB0byB1c2UgYXMgdGhlIHJvb3QgdHlwZVxyXG5cdFx0aWYgKHRva2Vucy5zdGVwc1swXS5wcm9wZXJ0eSA9PT0gXCJ0aGlzXCIgJiYgdG9rZW5zLnN0ZXBzWzBdLmNhc3QpIHtcclxuXHJcblx0XHRcdC8vVHJ5IGFuZCByZXNvbHZlIGNhc3QgdG8gYW4gYWN0dWFsIHR5cGUgaW4gdGhlIG1vZGVsXHJcblx0XHRcdHR5cGUgPSBNb2RlbC5nZXRKc1R5cGUodG9rZW5zLnN0ZXBzWzBdLmNhc3QsIGZhbHNlKS5tZXRhO1xyXG5cdFx0XHR0b2tlbnMuc3RlcHMuZGVxdWV1ZSgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGNyZWF0ZSBhIGZ1bmN0aW9uIHRvIGxhemlseSBsb2FkIGEgcHJvcGVydHkgXHJcblx0XHRsb2FkUHJvcGVydHkgPSBmdW5jdGlvbiAoY29udGFpbmluZ1R5cGUsIHByb3BlcnR5TmFtZSwgcHJvcGVydHlDYWxsYmFjaykge1xyXG5cdFx0XHRlbnN1cmVUeXBlKGNvbnRhaW5pbmdUeXBlLCBmb3JjZUxvYWRUeXBlcywgZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdHByb3BlcnR5Q2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMsIGNvbnRhaW5pbmdUeXBlLnByb3BlcnR5KHByb3BlcnR5TmFtZSkpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH07XHJcblxyXG5cdFx0Ly8gT3B0aW1pemUgZm9yIGEgc2luZ2xlIHByb3BlcnR5IGV4cHJlc3Npb24sIGFzIGl0IGlzIG5laXRoZXIgc3RhdGljIG5vciBhIGNoYWluLlxyXG5cdFx0aWYgKHRva2Vucy5zdGVwcy5sZW5ndGggPT09IDEpIHtcclxuXHRcdFx0c2luZ2xlUHJvcGVydHlOYW1lID0gdG9rZW5zLnN0ZXBzWzBdLnByb3BlcnR5O1xyXG5cdFx0XHRpZiAoY2FsbGJhY2spIHtcclxuXHRcdFx0XHRsb2FkUHJvcGVydHkodHlwZSwgc2luZ2xlUHJvcGVydHlOYW1lLCBjYWxsYmFjayk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0dmFyIHNpbmdsZVByb3BlcnR5ID0gdHlwZS5wcm9wZXJ0eShzaW5nbGVQcm9wZXJ0eU5hbWUpO1xyXG5cdFx0XHRcdGlmIChzaW5nbGVQcm9wZXJ0eSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIHNpbmdsZVByb3BlcnR5O1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJQYXRoICdcIiArIHBhdGggKyBcIicgaXMgbm90IHZhbGlkLlwiKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHQvLyBvdGhlcndpc2UsIGZpcnN0IHNlZSBpZiB0aGUgcGF0aCByZXByZXNlbnRzIGEgcHJvcGVydHkgY2hhaW4sIGFuZCBpZiBub3QsIGEgZ2xvYmFsIHByb3BlcnR5XHJcblx0XHRlbHNlIHtcclxuXHJcblx0XHRcdC8vIHByZWRldGVybWluZSB0aGUgZ2xvYmFsIHR5cGUgbmFtZSBhbmQgcHJvcGVydHkgbmFtZSBiZWZvcmUgc2VlaW5nIGlmIHRoZSBwYXRoIGlzIGFuIGluc3RhbmNlIHBhdGhcclxuXHRcdFx0dmFyIGdsb2JhbFR5cGVOYW1lID0gdG9rZW5zLnN0ZXBzXHJcblx0XHRcdFx0LnNsaWNlKDAsIHRva2Vucy5zdGVwcy5sZW5ndGggLSAxKVxyXG5cdFx0XHRcdC5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsgcmV0dXJuIGl0ZW0ucHJvcGVydHk7IH0pXHJcblx0XHRcdFx0LmpvaW4oXCIuXCIpO1xyXG5cclxuXHRcdFx0dmFyIGdsb2JhbFByb3BlcnR5TmFtZSA9IHRva2Vucy5zdGVwc1t0b2tlbnMuc3RlcHMubGVuZ3RoIC0gMV0ucHJvcGVydHk7XHJcblxyXG5cdFx0XHQvLyBDb3B5IG9mIHRoZSBNb2RlbC5wcm9wZXJ0eSBhcmd1bWVudHMgZm9yIGFzeW5jIHJlLWVudHJ5LlxyXG5cdFx0XHR2YXIgb3V0ZXJBcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcclxuXHJcblx0XHRcdC8vIGNyZWF0ZSBhIGZ1bmN0aW9uIHRvIHNlZSBpZiB0aGUgcGF0aCBpcyBhIGdsb2JhbCBwcm9wZXJ0eSBpZiBpbnN0YW5jZSBwcm9jZXNzaW5nIGZhaWxzXHJcblx0XHRcdHZhciBwcm9jZXNzR2xvYmFsID0gZnVuY3Rpb24gKGluc3RhbmNlUGFyc2VFcnJvcikge1xyXG5cclxuXHRcdFx0XHQvLyBSZXRyaWV2ZSB0aGUgamF2YXNjcmlwdCB0eXBlIGJ5IG5hbWUuXHJcblx0XHRcdFx0dHlwZSA9IE1vZGVsLmdldEpzVHlwZShnbG9iYWxUeXBlTmFtZSwgdHJ1ZSk7XHJcblxyXG5cdFx0XHRcdC8vIEhhbmRsZSBub24tZXhpc3RhbnQgb3Igbm9uLWxvYWRlZCB0eXBlLlxyXG5cdFx0XHRcdGlmICghdHlwZSkge1xyXG5cdFx0XHRcdFx0aWYgKGNhbGxiYWNrKSB7XHJcblx0XHRcdFx0XHRcdGlmICh3YWl0Rm9yR2xvYmFscykge1xyXG5cdFx0XHRcdFx0XHRcdC8vIFJldHJ5IHdoZW4gdHlwZSBpcyBsb2FkZWRcclxuXHRcdFx0XHRcdFx0XHQkZXh0ZW5kKGdsb2JhbFR5cGVOYW1lLCBNb2RlbC5wcm9wZXJ0eS5wcmVwYXJlKE1vZGVsLCBvdXRlckFyZ3MpKTtcclxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRjYWxsYmFjayhudWxsKTtcclxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBHZXQgdGhlIGNvcnJlc3BvbmRpbmcgbWV0YSB0eXBlLlxyXG5cdFx0XHRcdHR5cGUgPSB0eXBlLm1ldGE7XHJcblxyXG5cdFx0XHRcdC8vIHJldHVybiB0aGUgc3RhdGljIHByb3BlcnR5XHJcblx0XHRcdFx0aWYgKGNhbGxiYWNrKSB7XHJcblx0XHRcdFx0XHRsb2FkUHJvcGVydHkodHlwZSwgZ2xvYmFsUHJvcGVydHlOYW1lLCBjYWxsYmFjayk7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdHJldHVybiB0eXBlLnByb3BlcnR5KGdsb2JhbFByb3BlcnR5TmFtZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0aWYgKGNhbGxiYWNrKSB7XHJcblx0XHRcdFx0UHJvcGVydHlDaGFpbi5jcmVhdGUodHlwZSwgdG9rZW5zLCBmb3JjZUxvYWRUeXBlcywgdGhpc1B0ciA/IGNhbGxiYWNrLmJpbmQodGhpc1B0cikgOiBjYWxsYmFjaywgcHJvY2Vzc0dsb2JhbCk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0dmFyIHJlc3VsdCA9IFByb3BlcnR5Q2hhaW4uY3JlYXRlKHR5cGUsIHRva2VucywgZm9yY2VMb2FkVHlwZXMpIHx8IHByb2Nlc3NHbG9iYWwoKTtcclxuXHRcdFx0XHRpZiAocmVzdWx0KSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJQYXRoICdcIiArIHBhdGggKyBcIicgaXMgbm90IHZhbGlkLlwiKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRNb2RlbC5pbnRyaW5zaWNKc1R5cGVzID0gW1wiT2JqZWN0XCIsIFwiU3RyaW5nXCIsIFwiTnVtYmVyXCIsIFwiQm9vbGVhblwiLCBcIkRhdGVcIiwgXCJUaW1lU3BhblwiLCBcIkFycmF5XCJdO1xyXG5cdE1vZGVsLnR5cGVzID0ge307XHJcblx0TW9kZWwuZ2V0SnNUeXBlID0gZnVuY3Rpb24gTW9kZWwkZ2V0SnNUeXBlKG5hbWUsIGFsbG93VW5kZWZpbmVkKSB7XHJcblx0XHQvLy8gPHN1bW1hcnk+XHJcblx0XHQvLy8gUmV0cmlldmVzIHRoZSBKYXZhU2NyaXB0IGNvbnN0cnVjdG9yIGZ1bmN0aW9uIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdpdmVuIGZ1bGwgdHlwZSBuYW1lLlxyXG5cdFx0Ly8vIDwvc3VtbWFyeT5cclxuXHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiT2JqZWN0XCIgLz5cclxuXHJcblx0XHR2YXIgb2JqID0gTW9kZWwudHlwZXM7XHJcblx0XHR2YXIgc3RlcHMgPSBuYW1lLnNwbGl0KFwiLlwiKTtcclxuXHRcdGlmIChzdGVwcy5sZW5ndGggPT09IDEgJiYgTW9kZWwuaW50cmluc2ljSnNUeXBlcy5pbmRleE9mKG5hbWUpID4gLTEpIHtcclxuXHRcdFx0cmV0dXJuIHdpbmRvd1tuYW1lXTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHN0ZXBzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0dmFyIHN0ZXAgPSBzdGVwc1tpXTtcclxuXHRcdFx0XHRvYmogPSBvYmpbc3RlcF07XHJcblx0XHRcdFx0aWYgKG9iaiA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHRpZiAoYWxsb3dVbmRlZmluZWQpIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcigkZm9ybWF0KFwiVGhlIHR5cGUgXFxcInswfVxcXCIgY291bGQgbm90IGJlIGZvdW5kLiAgRmFpbGVkIG9uIHN0ZXAgXFxcInsxfVxcXCIuXCIsIFtuYW1lLCBzdGVwXSkpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gb2JqO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdEV4b1dlYi5Nb2RlbC5Nb2RlbCA9IE1vZGVsO1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLk1vZGVsLkVudGl0eVxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIEVudGl0eSgpIHtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGZvckVhY2hQcm9wZXJ0eShvYmosIGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRmb3IgKHZhciBwcm9wIGluIG9iaikge1xyXG5cdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcywgcHJvcCwgb2JqW3Byb3BdKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGdldFByb3BlcnRpZXMoLypbcHJvcGVydGllc10gb3IgW3Byb3BOYW1lLCBwcm9wVmFsdWVdICovKSB7XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikge1xyXG5cdFx0XHR2YXIgcHJvcGVydGllcyA9IHt9O1xyXG5cdFx0XHRwcm9wZXJ0aWVzW2FyZ3VtZW50c1swXV0gPSBhcmd1bWVudHNbMV07XHJcblx0XHRcdHJldHVybiBwcm9wZXJ0aWVzO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHJldHVybiBhcmd1bWVudHNbMF07XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRFbnRpdHkubWl4aW4oe1xyXG5cdFx0aW5pdDogZnVuY3Rpb24gRW50aXR5JGluaXQoLypbcHJvcGVydGllc10gb3IgW3Byb3BOYW1lLCBwcm9wVmFsdWVdICovKSB7XHJcblx0XHRcdGZvckVhY2hQcm9wZXJ0eShnZXRQcm9wZXJ0aWVzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkge1xyXG5cdFx0XHRcdHZhciBwcm9wID0gdGhpcy5tZXRhLnR5cGUucHJvcGVydHkobmFtZSk7XHJcblxyXG5cdFx0XHRcdGlmICghcHJvcCkge1xyXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiQ291bGQgbm90IGZpbmQgcHJvcGVydHkgXFxcIlwiICsgbmFtZSArIFwiXFxcIiBvbiB0eXBlIFxcXCJcIiArIHRoaXMubWV0YS50eXBlLmdldF9mdWxsTmFtZSgpICsgXCJcXFwiLlwiKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIEluaXRpYWxpemF0aW9uIGlzIG5vdCBmb3JjZS4gIElmIHRoZSBwcm9wZXJ5IGFscmVhZHkgaGFzIGEgdmFsdWUgaXQgd2lsbCBiZSBpZ25vcmVkLlxyXG5cdFx0XHRcdFByb3BlcnR5JF9pbml0LmNhbGwocHJvcCwgdGhpcywgdmFsdWUpO1xyXG5cdFx0XHR9LCB0aGlzKTtcclxuXHRcdH0sXHJcblx0XHRzZXQ6IGZ1bmN0aW9uIEVudGl0eSRzZXQoLypbcHJvcGVydGllc10gb3IgW3Byb3BOYW1lLCBwcm9wVmFsdWVdICovKSB7XHJcblx0XHRcdGZvckVhY2hQcm9wZXJ0eShnZXRQcm9wZXJ0aWVzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkge1xyXG5cdFx0XHRcdHZhciBwcm9wID0gdGhpcy5tZXRhLnR5cGUucHJvcGVydHkobmFtZSk7XHJcblx0XHRcdFx0aWYgKCFwcm9wKSB7XHJcblx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3QgZmluZCBwcm9wZXJ0eSBcXFwiXCIgKyBuYW1lICsgXCJcXFwiIG9uIHR5cGUgXFxcIlwiICsgdGhpcy5tZXRhLnR5cGUuZ2V0X2Z1bGxOYW1lKCkgKyBcIlxcXCIuXCIpO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0UHJvcGVydHkkX3NldHRlci5jYWxsKHByb3AsIHRoaXMsIHZhbHVlLCBmYWxzZSk7XHJcblx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0fSxcclxuXHRcdGdldDogZnVuY3Rpb24gRW50aXR5JGdldChwcm9wTmFtZSkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5tZXRhLnR5cGUucHJvcGVydHkocHJvcE5hbWUpLnZhbHVlKHRoaXMpO1xyXG5cdFx0fSxcclxuXHRcdHRvU3RyaW5nOiBmdW5jdGlvbiBFbnRpdHkkdG9TdHJpbmcoZm9ybWF0KSB7XHJcblx0XHRcdGlmIChmb3JtYXQpIHtcclxuXHRcdFx0XHRmb3JtYXQgPSBnZXRGb3JtYXQodGhpcy5jb25zdHJ1Y3RvciwgZm9ybWF0KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRmb3JtYXQgPSB0aGlzLm1ldGEudHlwZS5nZXRfZm9ybWF0KCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChmb3JtYXQpXHJcblx0XHRcdFx0cmV0dXJuIGZvcm1hdC5jb252ZXJ0KHRoaXMpO1xyXG5cdFx0XHRlbHNlXHJcblx0XHRcdFx0cmV0dXJuIEVudGl0eS50b0lkU3RyaW5nKHRoaXMpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHQvLyBHZXRzIHRoZSB0eXBlZCBzdHJpbmcgaWQgc3VpdGFibGUgZm9yIHJvdW5kdHJpcHBpbmcgdmlhIGZyb21JZFN0cmluZ1xyXG5cdEVudGl0eS50b0lkU3RyaW5nID0gZnVuY3Rpb24gRW50aXR5JHRvSWRTdHJpbmcob2JqKSB7XHJcblx0XHRyZXR1cm4gJGZvcm1hdChcInswfXx7MX1cIiwgW29iai5tZXRhLnR5cGUuZ2V0X2Z1bGxOYW1lKCksIG9iai5tZXRhLmlkXSk7XHJcblx0fTtcclxuXHJcblx0Ly8gR2V0cyBvciBsb2FkcyB0aGUgZW50aXR5IHdpdGggdGhlIHNwZWNpZmllZCB0eXBlZCBzdHJpbmcgaWRcclxuXHRFbnRpdHkuZnJvbUlkU3RyaW5nID0gZnVuY3Rpb24gRW50aXR5JGZyb21JZFN0cmluZyhpZFN0cmluZykge1xyXG5cdFx0Ly8gVHlwZWQgaWRlbnRpZmllcnMgdGFrZSB0aGUgZm9ybSBcInR5cGV8aWRcIi5cclxuXHQgICAgdmFyIHR5cGUgPSBpZFN0cmluZy5zdWJzdHJpbmcoMCwgaWRTdHJpbmcuaW5kZXhPZihcInxcIikpO1xyXG5cdCAgICB2YXIgaWQgPSBpZFN0cmluZy5zdWJzdHJpbmcodHlwZS5sZW5ndGggKyAxKTtcclxuXHJcblx0XHQvLyBVc2UgdGhlIGxlZnQtaGFuZCBwb3J0aW9uIG9mIHRoZSBpZCBzdHJpbmcgYXMgdGhlIG9iamVjdCdzIHR5cGUuXHJcblx0XHR2YXIganN0eXBlID0gRXhvV2ViLk1vZGVsLk1vZGVsLmdldEpzVHlwZSh0eXBlKTtcclxuXHJcblx0XHQvLyBSZXRyaWV2ZSB0aGUgb2JqZWN0IHdpdGggdGhlIGdpdmVuIGlkLlxyXG5cdFx0cmV0dXJuIGpzdHlwZS5tZXRhLmdldChpZCxcclxuXHRcdFx0Ly8gVHlwZWQgaWRlbnRpZmllcnMgbWF5IG9yIG1heSBub3QgYmUgdGhlIGV4YWN0IHR5cGUgb2YgdGhlIGluc3RhbmNlLlxyXG5cdFx0XHQvLyBBbiBpZCBzdHJpbmcgbWF5IGJlIGNvbnN0cnVjdGVkIHdpdGggb25seSBrbm93bGVkZ2Ugb2YgdGhlIGJhc2UgdHlwZS5cclxuXHRcdFx0ZmFsc2VcclxuXHRcdCk7XHJcblx0fTtcclxuXHJcblx0RXhvV2ViLk1vZGVsLkVudGl0eSA9IEVudGl0eTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5Nb2RlbC5UeXBlXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gVHlwZShtb2RlbCwgbmFtZSwgYmFzZVR5cGUsIG9yaWdpbikge1xyXG5cdFx0dGhpcy5fZnVsbE5hbWUgPSBuYW1lO1xyXG5cclxuXHRcdC8vIGlmIG9yaWdpbiBpcyBub3QgcHJvdmlkZWQgaXQgaXMgYXNzdW1lZCB0byBiZSBjbGllbnRcclxuXHRcdHRoaXMuX29yaWdpbiA9IG9yaWdpbiB8fCBcImNsaWVudFwiO1xyXG5cdFx0dGhpcy5fb3JpZ2luRm9yTmV3UHJvcGVydGllcyA9IHRoaXMuX29yaWdpbjtcclxuXHJcblx0XHR0aGlzLl9wb29sID0ge307XHJcblx0XHR0aGlzLl9sZWdhY3lQb29sID0ge307XHJcblx0XHR0aGlzLl9jb3VudGVyID0gMDtcclxuXHRcdHRoaXMuX3Byb3BlcnRpZXMgPSB7fTsgXHJcblx0XHR0aGlzLl9pbnN0YW5jZVByb3BlcnRpZXMgPSB7fTtcclxuXHRcdHRoaXMuX3N0YXRpY1Byb3BlcnRpZXMgPSB7fTtcclxuXHRcdHRoaXMuX3BlbmRpbmdJbml0ID0gW107XHJcblx0XHR0aGlzLl9wZW5kaW5nSW52b2NhdGlvbiA9IFtdO1xyXG5cclxuXHRcdC8vIGRlZmluZSBwcm9wZXJ0aWVzXHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJtb2RlbFwiLCB7IHZhbHVlOiBtb2RlbCB9KTtcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJ1bGVzXCIsIHsgdmFsdWU6IFtdIH0pO1xyXG5cclxuXHRcdC8vIGdlbmVyYXRlIGNsYXNzIGFuZCBjb25zdHJ1Y3RvclxyXG5cdFx0dmFyIGpzdHlwZSA9IE1vZGVsLmdldEpzVHlwZShuYW1lLCB0cnVlKTtcclxuXHJcblx0XHQvLyBjcmVhdGUgbmFtZXNwYWNlcyBhcyBuZWVkZWRcclxuXHRcdHZhciBuYW1lVG9rZW5zID0gbmFtZS5zcGxpdChcIi5cIiksXHJcblx0XHRcdHRva2VuID0gbmFtZVRva2Vucy5kZXF1ZXVlKCksXHJcblx0XHRcdG5hbWVzcGFjZU9iaiA9IE1vZGVsLnR5cGVzLFxyXG5cdFx0XHRnbG9iYWxPYmogPSB3aW5kb3c7XHJcblxyXG5cdFx0d2hpbGUgKG5hbWVUb2tlbnMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRuYW1lc3BhY2VPYmogPSBtb2RlbC5fZW5zdXJlTmFtZXNwYWNlKHRva2VuLCBuYW1lc3BhY2VPYmopO1xyXG5cdFx0XHRnbG9iYWxPYmogPSBtb2RlbC5fZW5zdXJlTmFtZXNwYWNlKHRva2VuLCBnbG9iYWxPYmopO1xyXG5cdFx0XHR0b2tlbiA9IG5hbWVUb2tlbnMuZGVxdWV1ZSgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIHRoZSBmaW5hbCBuYW1lIHRvIHVzZSBpcyB0aGUgbGFzdCB0b2tlblxyXG5cdFx0dmFyIGZpbmFsTmFtZSA9IHRva2VuO1xyXG5cdFx0anN0eXBlID0gZ2VuZXJhdGVDbGFzcyh0aGlzKTtcclxuXHJcblx0XHR0aGlzLl9qc3R5cGUgPSBqc3R5cGU7XHJcblxyXG5cdFx0Ly8gSWYgdGhlIG5hbWVzcGFjZSBhbHJlYWR5IGNvbnRhaW5zIGEgdHlwZSB3aXRoIHRoaXMgbmFtZSwgYXBwZW5kIGEgJyQnIHRvIHRoZSBuYW1lXHJcblx0XHRpZiAoIW5hbWVzcGFjZU9ialtmaW5hbE5hbWVdKSB7XHJcblx0XHRcdG5hbWVzcGFjZU9ialtmaW5hbE5hbWVdID0ganN0eXBlO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdG5hbWVzcGFjZU9ialsnJCcgKyBmaW5hbE5hbWVdID0ganN0eXBlO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIElmIHRoZSBnbG9iYWwgb2JqZWN0IGFscmVhZHkgY29udGFpbnMgYSB0eXBlIHdpdGggdGhpcyBuYW1lLCBhcHBlbmQgYSAnJCcgdG8gdGhlIG5hbWVcclxuXHRcdGlmICghZ2xvYmFsT2JqW2ZpbmFsTmFtZV0pIHtcclxuXHRcdFx0Z2xvYmFsT2JqW2ZpbmFsTmFtZV0gPSBqc3R5cGU7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0Z2xvYmFsT2JqWyckJyArIGZpbmFsTmFtZV0gPSBqc3R5cGU7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gc2V0dXAgaW5oZXJpdGFuY2VcclxuXHRcdHRoaXMuZGVyaXZlZFR5cGVzID0gW107XHJcblx0XHR2YXIgYmFzZUpzVHlwZTtcclxuXHJcblx0XHRpZiAoYmFzZVR5cGUpIHtcclxuXHRcdFx0YmFzZUpzVHlwZSA9IGJhc2VUeXBlLl9qc3R5cGU7XHJcblxyXG5cdFx0XHR0aGlzLmJhc2VUeXBlID0gYmFzZVR5cGU7XHJcblx0XHRcdGJhc2VUeXBlLmRlcml2ZWRUeXBlcy5wdXNoKHRoaXMpO1xyXG5cdFx0XHJcblx0XHRcdC8vIGluaGVyaXQgYWxsIHNob3J0Y3V0IHByb3BlcnRpZXMgdGhhdCBoYXZlIGFsZWFkeSBiZWVuIGRlZmluZWRcclxuXHRcdFx0aW5oZXJpdEJhc2VUeXBlUHJvcFNob3J0Y3V0cyhqc3R5cGUsIGJhc2VUeXBlKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRiYXNlSnNUeXBlID0gRW50aXR5O1xyXG5cdFx0XHR0aGlzLmJhc2VUeXBlID0gbnVsbDtcclxuXHRcdH1cclxuXHJcblx0XHRkaXNhYmxlQ29uc3RydWN0aW9uID0gdHJ1ZTtcclxuXHRcdHRoaXMuX2pzdHlwZS5wcm90b3R5cGUgPSBuZXcgYmFzZUpzVHlwZSgpO1xyXG5cdFx0ZGlzYWJsZUNvbnN0cnVjdGlvbiA9IGZhbHNlO1xyXG5cclxuXHRcdHRoaXMuX2pzdHlwZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSB0aGlzLl9qc3R5cGU7XHJcblxyXG5cdFx0Ly8gaGVscGVyc1xyXG5cdFx0anN0eXBlLm1ldGEgPSB0aGlzO1xyXG5cclxuXHRcdC8vIEFkZCBzZWxmLXJlZmVyZW5jZSB0byBkZWNyZWFzZSB0aGUgbGlrZWxpaG9vZCBvZiBlcnJvcnNcclxuXHRcdC8vIGR1ZSB0byBhbiBhYnNlbmNlIG9mIHRoZSBuZWNlc3NhcnkgdHlwZSB2cy4gZW50aXR5LlxyXG5cdFx0dGhpcy50eXBlID0gdGhpcztcclxuXHR9XHJcblxyXG5cdC8vIGNvcHkgc2hvcnRjdXQgcHJvcGVydGllcyBmcm9tIGEgYmFzZSBtZXRhIHR5cGUgKHJlY3Vyc2l2ZWx5KSB0byBhIHRhcmdldCBqc3R5cGVcclxuXHRmdW5jdGlvbiBpbmhlcml0QmFzZVR5cGVQcm9wU2hvcnRjdXRzKGpzdHlwZSwgYmFzZVR5cGUpIHtcclxuXHRcdGZvciAodmFyIHByb3BOYW1lIGluIGJhc2VUeXBlLl9wcm9wZXJ0aWVzKSB7XHJcblx0XHRcdGpzdHlwZVtcIiRcIiArIHByb3BOYW1lXSA9IGJhc2VUeXBlLl9wcm9wZXJ0aWVzW3Byb3BOYW1lXTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyByZWN1cnNpdmVseSBhZGQgYmFzZSB0eXBlIHByb3BlcnRpZXNcclxuXHRcdGlmIChiYXNlVHlwZS5iYXNlVHlwZSkge1xyXG5cdFx0XHRpbmhlcml0QmFzZVR5cGVQcm9wU2hvcnRjdXRzKGpzdHlwZSwgYmFzZVR5cGUuYmFzZVR5cGUpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0dmFyIGRpc2FibGVDb25zdHJ1Y3Rpb24gPSBmYWxzZTtcclxuXHJcblx0dmFyIHZhbGlkYXRlSWQgPSBmdW5jdGlvbiBUeXBlJHZhbGlkYXRlSWQodHlwZSwgaWQpIHtcclxuXHRcdGlmIChpZCA9PT0gbnVsbCB8fCBpZCA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcigkZm9ybWF0KFwiSWQgY2Fubm90IGJlIHswfSAoZW50aXR5ID0gezF9KS5cIiwgaWQgPT09IG51bGwgPyBcIm51bGxcIiA6IFwidW5kZWZpbmVkXCIsIHR5cGUuZ2V0X2Z1bGxOYW1lKCkpKTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKCFFeG9XZWIuaXNTdHJpbmcoaWQpKSB7XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcigkZm9ybWF0KFwiSWQgbXVzdCBiZSBhIHN0cmluZzogIGVuY291bnRlcmVkIGlkIHswfSBvZiB0eXBlIFxcXCJ7MX1cXFwiIChlbnRpdHkgPSB7Mn0pLlwiLFxyXG5cdFx0XHRcdGlkLnRvU3RyaW5nKCksIHBhcnNlRnVuY3Rpb25OYW1lKGlkLmNvbnN0cnVjdG9yKSwgdHlwZS5nZXRfZnVsbE5hbWUoKSkpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAoaWQgPT09IFwiXCIpIHtcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCRmb3JtYXQoXCJJZCBjYW5ub3QgYmUgYSBibGFuayBzdHJpbmcgKGVudGl0eSA9IHswfSkuXCIsIHR5cGUuZ2V0X2Z1bGxOYW1lKCkpKTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRmdW5jdGlvbiBnZW5lcmF0ZUNsYXNzKHR5cGUpIHtcclxuXHRcdGZ1bmN0aW9uIGNvbnN0cnVjdChpZE9yUHJvcHMsIHByb3BzLCBzdXBwcmVzc01vZGVsRXZlbnQpIHtcclxuXHRcdFx0aWYgKCFkaXNhYmxlQ29uc3RydWN0aW9uKSB7XHJcblx0XHRcdFx0aWYgKGlkT3JQcm9wcyAmJiBpZE9yUHJvcHMuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xyXG5cdFx0XHRcdFx0dmFyIGlkID0gaWRPclByb3BzO1xyXG5cdFx0XHRcdFx0dmFyIG9iaiA9IHR5cGUuZ2V0KGlkLFxyXG5cdFx0XHRcdFx0XHQvLyBXaGVuIGEgY29uc3RydWN0b3IgaXMgY2FsbGVkIHdlIGRvIG5vdCB3YW50IHRvIHNpbGVudGx5XHJcblx0XHRcdFx0XHRcdC8vIHJldHVybiBhbiBpbnN0YW5jZSBvZiBhIHN1YiB0eXBlLCBzbyBmZXRjaCB1c2luZyBleGFjdCB0eXBlLlxyXG5cdFx0XHRcdFx0XHR0cnVlLFxyXG5cdFx0XHRcdFx0XHQvLyBJbmRpY2F0ZSB0aGF0IGFuIG9iamVjdCBpcyBjdXJyZW50bHkgYmVpbmcgY29uc3RydWN0ZWQuXHJcblx0XHRcdFx0XHRcdHRydWUpO1xyXG5cclxuXHRcdFx0XHRcdC8vIElmIHRoZSBpbnN0YW5jZSBhbHJlYWR5IGV4aXN0cywgdGhlbiBpbml0aWFsaXplIHByb3BlcnRpZXMgYW5kIHJldHVybiBpdC5cclxuXHRcdFx0XHRcdGlmIChvYmopIHtcclxuXHRcdFx0XHRcdFx0aWYgKHByb3BzKSB7XHJcblx0XHRcdFx0XHRcdFx0b2JqLmluaXQocHJvcHMpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdHJldHVybiBvYmo7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0Ly8gUmVnaXN0ZXIgdGhlIG5ld2x5IGNvbnN0cnVjdGVkIGV4aXN0aW5nIGluc3RhbmNlLlxyXG5cdFx0XHRcdFx0dHlwZS5yZWdpc3Rlcih0aGlzLCBpZCwgc3VwcHJlc3NNb2RlbEV2ZW50KTtcclxuXHJcblx0XHRcdFx0XHQvLyBJbml0aWFsaXplIHByb3BlcnRpZXMgaWYgcHJvdmlkZWQuXHJcblx0XHRcdFx0XHRpZiAocHJvcHMpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5pbml0KHByb3BzKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHQvLyBSZWdpc3RlciB0aGUgbmV3bHkgY29uc3RydWN0ZWQgbmV3IGluc3RhbmNlLiBJdCB3aWxsXHJcblx0XHRcdFx0XHQvLyBiZSBhc3NpZ25lZCBhIHNlcXVlbnRpYWwgY2xpZW50LWdlbmVyYXRlZCBpZC5cclxuXHRcdFx0XHRcdHR5cGUucmVnaXN0ZXIodGhpcywgbnVsbCwgc3VwcHJlc3NNb2RlbEV2ZW50KTtcclxuXHJcblx0XHRcdFx0XHQvLyBTZXQgcHJvcGVydGllcyBwYXNzZWQgaW50byBjb25zdHJ1Y3Rvci5cclxuXHRcdFx0XHRcdGlmIChpZE9yUHJvcHMpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5zZXQoaWRPclByb3BzKTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyBSYWlzZSBpbml0TmV3IGV2ZW50IGlmIHJlZ2lzdGVyZWQuXHJcblx0XHRcdFx0XHRmb3IgKHZhciB0ID0gdHlwZTsgdDsgdCA9IHQuYmFzZVR5cGUpIHtcclxuXHRcdFx0XHRcdFx0dmFyIGhhbmRsZXIgPSB0Ll9nZXRFdmVudEhhbmRsZXIoXCJpbml0TmV3XCIpO1xyXG5cdFx0XHRcdFx0XHRpZiAoaGFuZGxlcikge1xyXG5cdFx0XHRcdFx0XHRcdGhhbmRsZXIodGhpcywge30pO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIGNvbnN0cnVjdDtcclxuXHR9XHJcblxyXG5cdHZhciBuZXdJZFByZWZpeCA9IFwiK2NcIjtcclxuXHJcblx0VHlwZS5nZXROZXdJZFByZWZpeCA9IGZ1bmN0aW9uIGdldE5ld0lkUHJlZml4KCkge1xyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPiAwKSB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgbWV0aG9kIGdldE5ld0lkUHJlZml4IGRvZXMgbm90IGFjY2VwdCBhcmd1bWVudHNcIik7XHJcblx0XHRyZXR1cm4gbmV3SWRQcmVmaXguc3Vic3RyaW5nKDEpO1xyXG5cdH07XHJcblxyXG5cdFR5cGUuc2V0TmV3SWRQcmVmaXggPSBmdW5jdGlvbiBzZXROZXdJZFByZWZpeChwcmVmaXgpIHtcclxuXHRcdGlmIChwcmVmaXggPT09IG51bGwgfHwgcHJlZml4ID09PSB1bmRlZmluZWQpIHRocm93IG5ldyBFcnJvcihcIlRoZSBuZXcgaWQgcHJlZml4IGFyZ3VtZW50IGlzIHJlcXVpcmVkXCIpO1xyXG5cdFx0aWYgKHR5cGVvZihwcmVmaXgpICE9PSBcInN0cmluZ1wiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiVGhlIG5ldyBpZCBwcmVmaXggbXVzdCBiZSBhIHN0cmluZywgZm91bmQgXCIgKyBwcmVmaXgudG9TdHJpbmcoKSk7XHJcblx0XHRpZiAocHJlZml4Lmxlbmd0aCA9PT0gMCkgdGhyb3cgbmV3IEVycm9yKFwiVGhlIG5ldyBpZCBwcmVmaXggY2Fubm90IGJlIGVtcHR5IHN0cmluZ1wiKTtcclxuXHRcdG5ld0lkUHJlZml4ID0gXCIrXCIgKyBwcmVmaXg7XHJcblx0fTtcclxuXHJcblx0VHlwZS5wcm90b3R5cGUgPSB7XHJcblx0XHQvLyBnZXRzIGFuZCBvcHRpb25hbGx5IHNldHMgdGhlIHBlbmRpbmcgaW5pdGlhbGl6YXRpb24gc3RhdHVzIGZvciBhIHN0YXRpYyBwcm9wZXJ0eSBvbiB0aGUgdHlwZVxyXG5cdFx0cGVuZGluZ0ludm9jYXRpb246IGZ1bmN0aW9uIFR5cGUkcGVuZGluZ0ludm9jYXRpb24ocnVsZSwgdmFsdWUpIHtcclxuXHRcdFx0dmFyIGluZGV4T2ZSdWxlID0gdGhpcy5fcGVuZGluZ0ludm9jYXRpb24uaW5kZXhPZihydWxlKTtcclxuXHRcdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7XHJcblx0XHRcdFx0aWYgKHZhbHVlICYmIGluZGV4T2ZSdWxlIDwgMCkge1xyXG5cdFx0XHRcdFx0dGhpcy5fcGVuZGluZ0ludm9jYXRpb24ucHVzaChydWxlKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSBpZiAoIXZhbHVlICYmIGluZGV4T2ZSdWxlID49IDApIHtcclxuXHRcdFx0XHRcdHRoaXMuX3BlbmRpbmdJbnZvY2F0aW9uLnNwbGljZShpbmRleE9mUnVsZSwgMSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiBpbmRleE9mUnVsZSA+PSAwO1xyXG5cdFx0fSxcclxuXHJcblx0XHRhZGRJbml0TmV3OiBmdW5jdGlvbiBUeXBlJGFkZEluaXROZXcoaGFuZGxlciwgb2JqLCBvbmNlKSB7XHJcblx0XHRcdHRoaXMuX2FkZEV2ZW50KFwiaW5pdE5ld1wiLCBoYW5kbGVyLCBvYmogPyBlcXVhbHMob2JqKSA6IG51bGwsIG9uY2UpO1xyXG5cdFx0XHRyZXR1cm4gdGhpcztcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gZ2V0cyBhbmQgb3B0aW9uYWxseSBzZXRzIHRoZSBwZW5kaW5nIGluaXRpYWxpemF0aW9uIHN0YXR1cyBmb3IgYSBzdGF0aWMgcHJvcGVydHkgb24gdGhlIHR5cGVcclxuXHRcdHBlbmRpbmdJbml0OiBmdW5jdGlvbiBUeXBlJHBlbmRpbmdJbml0KHByb3AsIHZhbHVlKSB7XHJcblx0XHRcdHZhciByZXN1bHQgPSB0aGlzW3Byb3AuX2ZpZWxkTmFtZV0gPT09IHVuZGVmaW5lZCB8fCB0aGlzLl9wZW5kaW5nSW5pdFtwcm9wLmdldF9uYW1lKCldID09PSB0cnVlO1xyXG5cdFx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHtcclxuXHRcdFx0XHRpZiAodmFsdWUpIHtcclxuXHRcdFx0XHRcdHRoaXMuX3BlbmRpbmdJbml0W3Byb3AuZ2V0X25hbWUoKV0gPSB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdGRlbGV0ZSB0aGlzLl9wZW5kaW5nSW5pdFtwcm9wLmdldF9uYW1lKCldO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdFx0fSxcclxuXHRcdGFkZEluaXRFeGlzdGluZzogZnVuY3Rpb24gVHlwZSRhZGRJbml0RXhpc3RpbmcoaGFuZGxlciwgb2JqLCBvbmNlKSB7XHJcblx0XHRcdHRoaXMuX2FkZEV2ZW50KFwiaW5pdEV4aXN0aW5nXCIsIGhhbmRsZXIsIG9iaiA/IGVxdWFscyhvYmopIDogbnVsbCwgb25jZSk7XHJcblx0XHRcdHJldHVybiB0aGlzO1xyXG5cdFx0fSxcclxuXHRcdG5ld0lkOiBmdW5jdGlvbiBUeXBlJG5ld0lkKCkge1xyXG5cdFx0XHQvLyBHZXQgdGhlIG5leHQgaWQgZm9yIHRoaXMgdHlwZSdzIGhlaXJhcmNoeS5cclxuXHRcdFx0Zm9yICh2YXIgbmV4dElkLCB0eXBlID0gdGhpczsgdHlwZTsgdHlwZSA9IHR5cGUuYmFzZVR5cGUpIHtcclxuXHRcdFx0XHRuZXh0SWQgPSBNYXRoLm1heChuZXh0SWQgfHwgMCwgdHlwZS5fY291bnRlcik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIFVwZGF0ZSB0aGUgY291bnRlciBmb3IgZWFjaCB0eXBlIGluIHRoZSBoZWlyYXJjaHkuXHJcblx0XHRcdGZvciAodmFyIHR5cGUgPSB0aGlzOyB0eXBlOyB0eXBlID0gdHlwZS5iYXNlVHlwZSkge1xyXG5cdFx0XHRcdHR5cGUuX2NvdW50ZXIgPSBuZXh0SWQgKyAxO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBSZXR1cm4gdGhlIG5ldyBpZC5cclxuXHRcdFx0cmV0dXJuIG5ld0lkUHJlZml4ICsgbmV4dElkO1xyXG5cdFx0fSxcclxuXHRcdHJlZ2lzdGVyOiBmdW5jdGlvbiBUeXBlJHJlZ2lzdGVyKG9iaiwgaWQsIHN1cHByZXNzTW9kZWxFdmVudCkge1xyXG5cdFx0XHQvLyByZWdpc3RlciBpcyBjYWxsZWQgd2l0aCBzaW5nbGUgYXJndW1lbnQgZnJvbSBkZWZhdWx0IGNvbnN0cnVjdG9yXHJcblx0XHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyKSB7XHJcblx0XHRcdFx0dmFsaWRhdGVJZCh0aGlzLCBpZCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdG9iai5tZXRhID0gbmV3IE9iamVjdE1ldGEodGhpcywgb2JqKTtcclxuXHJcblx0XHRcdGlmICghaWQpIHtcclxuXHRcdFx0XHRpZCA9IHRoaXMubmV3SWQoKTtcclxuXHRcdFx0XHRvYmoubWV0YS5pc05ldyA9IHRydWU7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciBrZXkgPSBpZC50b0xvd2VyQ2FzZSgpO1xyXG5cclxuXHRcdFx0b2JqLm1ldGEuaWQgPSBpZDtcclxuXHRcdFx0T2JzZXJ2ZXIubWFrZU9ic2VydmFibGUob2JqKTtcclxuXHJcblx0XHRcdGZvciAodmFyIHQgPSB0aGlzOyB0OyB0ID0gdC5iYXNlVHlwZSkge1xyXG5cdFx0XHRcdGlmICh0Ll9wb29sLmhhc093blByb3BlcnR5KGtleSkpIHtcclxuXHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcigkZm9ybWF0KFwiT2JqZWN0IFxcXCJ7MH18ezF9XFxcIiBoYXMgYWxyZWFkeSBiZWVuIHJlZ2lzdGVyZWQuXCIsIHRoaXMuZ2V0X2Z1bGxOYW1lKCksIGlkKSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHR0Ll9wb29sW2tleV0gPSBvYmo7XHJcblx0XHRcdFx0aWYgKHQuX2tub3duKSB7XHJcblx0XHRcdFx0XHR0Ll9rbm93bi5hZGQob2JqKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICghc3VwcHJlc3NNb2RlbEV2ZW50KSB7XHJcblx0XHRcdFx0dGhpcy5tb2RlbC5ub3RpZnlPYmplY3RSZWdpc3RlcmVkKG9iaik7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRjaGFuZ2VPYmplY3RJZDogZnVuY3Rpb24gVHlwZSRjaGFuZ2VPYmplY3RJZChvbGRJZCwgbmV3SWQpIHtcclxuXHRcdFx0dmFsaWRhdGVJZCh0aGlzLCBvbGRJZCk7XHJcblx0XHRcdHZhbGlkYXRlSWQodGhpcywgbmV3SWQpO1xyXG5cclxuXHRcdFx0dmFyIG9sZEtleSA9IG9sZElkLnRvTG93ZXJDYXNlKCk7XHJcblx0XHRcdHZhciBuZXdLZXkgPSBuZXdJZC50b0xvd2VyQ2FzZSgpO1xyXG5cclxuXHRcdFx0dmFyIG9iaiA9IHRoaXMuX3Bvb2xbb2xkS2V5XTtcclxuXHJcblx0XHRcdGlmIChvYmopIHtcclxuXHRcdFx0XHRvYmoubWV0YS5sZWdhY3lJZCA9IG9sZElkO1xyXG5cclxuXHRcdFx0XHRmb3IgKHZhciB0ID0gdGhpczsgdDsgdCA9IHQuYmFzZVR5cGUpIHtcclxuXHRcdFx0XHRcdHQuX3Bvb2xbbmV3S2V5XSA9IG9iajtcclxuXHJcblx0XHRcdFx0XHRkZWxldGUgdC5fcG9vbFtvbGRLZXldO1xyXG5cclxuXHRcdFx0XHRcdHQuX2xlZ2FjeVBvb2xbb2xkS2V5XSA9IG9iajtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdG9iai5tZXRhLmlkID0gbmV3SWQ7XHJcblxyXG5cdFx0XHRcdHJldHVybiBvYmo7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0bG9nV2FybmluZygkZm9ybWF0KFwiQXR0ZW1wdGluZyB0byBjaGFuZ2UgaWQ6IEluc3RhbmNlIG9mIHR5cGUgXFxcInswfVxcXCIgd2l0aCBpZCA9IFxcXCJ7MX1cXFwiIGNvdWxkIG5vdCBiZSBmb3VuZC5cIiwgdGhpcy5nZXRfZnVsbE5hbWUoKSwgb2xkSWQpKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdHVucmVnaXN0ZXI6IGZ1bmN0aW9uIFR5cGUkdW5yZWdpc3RlcihvYmopIHtcclxuXHRcdFx0Zm9yICh2YXIgdCA9IHRoaXM7IHQ7IHQgPSB0LmJhc2VUeXBlKSB7XHJcblx0XHRcdFx0ZGVsZXRlIHQuX3Bvb2xbb2JqLm1ldGEuaWQudG9Mb3dlckNhc2UoKV07XHJcblxyXG5cdFx0XHRcdGlmIChvYmoubWV0YS5sZWdhY3lJZCkge1xyXG5cdFx0XHRcdFx0ZGVsZXRlIHQuX2xlZ2FjeVBvb2xbb2JqLm1ldGEubGVnYWN5SWQudG9Mb3dlckNhc2UoKV07XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRpZiAodC5fa25vd24pIHtcclxuXHRcdFx0XHRcdHQuX2tub3duLnJlbW92ZShvYmopO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dGhpcy5tb2RlbC5ub3RpZnlPYmplY3RVbnJlZ2lzdGVyZWQob2JqKTtcclxuXHRcdH0sXHJcblx0XHRnZXQ6IGZ1bmN0aW9uIFR5cGUkZ2V0KGlkLCBleGFjdFR5cGVPbmx5KSB7XHJcblx0XHRcdHZhbGlkYXRlSWQodGhpcywgaWQpO1xyXG5cclxuXHRcdFx0dmFyIGtleSA9IGlkLnRvTG93ZXJDYXNlKCk7XHJcblx0XHRcdHZhciBvYmogPSB0aGlzLl9wb29sW2tleV0gfHwgdGhpcy5fbGVnYWN5UG9vbFtrZXldO1xyXG5cclxuXHRcdFx0Ly8gSWYgZXhhY3RUeXBlT25seSBpcyBzcGVjaWZpZWQsIGRvbid0IHJldHVybiBzdWItdHlwZXMuXHJcblx0XHRcdGlmIChvYmogJiYgZXhhY3RUeXBlT25seSA9PT0gdHJ1ZSAmJiBvYmoubWV0YS50eXBlICE9PSB0aGlzKSB7XHJcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCRmb3JtYXQoXCJUaGUgZW50aXR5IHdpdGggaWQ9J3swfScgaXMgZXhwZWN0ZWQgdG8gYmUgb2YgdHlwZSAnezF9JyBidXQgZm91bmQgdHlwZSAnezJ9Jy5cIiwgaWQsIHRoaXMuX2Z1bGxOYW1lLCBvYmoubWV0YS50eXBlLl9mdWxsTmFtZSkpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZXR1cm4gb2JqO1xyXG5cdFx0fSxcclxuXHRcdC8vIEdldHMgYW4gYXJyYXkgb2YgYWxsIG9iamVjdHMgb2YgdGhpcyB0eXBlIHRoYXQgaGF2ZSBiZWVuIHJlZ2lzdGVyZWQuXHJcblx0XHQvLyBUaGUgcmV0dXJuZWQgYXJyYXkgaXMgb2JzZXJ2YWJsZSBhbmQgY29sbGVjdGlvbiBjaGFuZ2VkIGV2ZW50cyB3aWxsIGJlIHJhaXNlZFxyXG5cdFx0Ly8gd2hlbiBuZXcgb2JqZWN0cyBhcmUgcmVnaXN0ZXJlZCBvciB1bnJlZ2lzdGVyZWQuXHJcblx0XHQvLyBUaGUgYXJyYXkgaXMgaW4gbm8gcGFydGljdWxhciBvcmRlci5cclxuXHRcdGtub3duOiBmdW5jdGlvbiBUeXBlJGtub3duKCkge1xyXG5cdFx0XHR2YXIgbGlzdCA9IHRoaXMuX2tub3duO1xyXG5cdFx0XHRpZiAoIWxpc3QpIHtcclxuXHRcdFx0XHRsaXN0ID0gdGhpcy5fa25vd24gPSBbXTtcclxuXHJcblx0XHRcdFx0Zm9yICh2YXIgaWQgaW4gdGhpcy5fcG9vbCkge1xyXG5cdFx0XHRcdFx0bGlzdC5wdXNoKHRoaXMuX3Bvb2xbaWRdKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdE9ic2VydmVyLm1ha2VPYnNlcnZhYmxlKGxpc3QpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZXR1cm4gbGlzdDtcclxuXHRcdH0sXHJcblx0XHRhZGRQcm9wZXJ0eUFkZGVkOiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9hZGRFdmVudChcInByb3BlcnR5QWRkZWRcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0YWRkUnVsZTogZnVuY3Rpb24gVHlwZSRhZGRSdWxlKGRlZikge1xyXG5cdFx0XHRyZXR1cm4gbmV3IFJ1bGUodGhpcywgZGVmKTtcclxuXHRcdH0sXHJcblx0XHRhZGRQcm9wZXJ0eTogZnVuY3Rpb24gVHlwZSRhZGRQcm9wZXJ0eShkZWYpIHtcclxuXHRcdFx0dmFyIGZvcm1hdCA9IGRlZi5mb3JtYXQ7XHJcblx0XHRcdGlmIChmb3JtYXQgJiYgZm9ybWF0LmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHtcclxuXHRcdFx0XHRmb3JtYXQgPSBnZXRGb3JtYXQoZGVmLnR5cGUsIGZvcm1hdCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciBwcm9wID0gbmV3IFByb3BlcnR5KHRoaXMsIGRlZi5uYW1lLCBkZWYudHlwZSwgZGVmLmxhYmVsLCBkZWYuaGVscHRleHQsIGZvcm1hdCwgZGVmLmlzTGlzdCwgZGVmLmlzU3RhdGljLCBkZWYuaXNQZXJzaXN0ZWQsIGRlZi5pc0NhbGN1bGF0ZWQsIGRlZi5pbmRleCwgZGVmLmRlZmF1bHRWYWx1ZSwgZGVmLmNvbnN0YW50KTtcclxuXHJcblx0XHRcdHRoaXMuX3Byb3BlcnRpZXNbZGVmLm5hbWVdID0gcHJvcDtcclxuXHRcdFx0KGRlZi5pc1N0YXRpYyA/IHRoaXMuX3N0YXRpY1Byb3BlcnRpZXMgOiB0aGlzLl9pbnN0YW5jZVByb3BlcnRpZXMpW2RlZi5uYW1lXSA9IHByb3A7XHJcblxyXG5cdFx0XHQvLyBtb2RpZnkganN0eXBlIHRvIGluY2x1ZGUgZnVuY3Rpb25hbGl0eSBiYXNlZCBvbiB0aGUgdHlwZSBkZWZpbml0aW9uXHJcblx0XHRcdGZ1bmN0aW9uIGdlblByb3BlcnR5U2hvcnRjdXQobXR5cGUsIG92ZXJ3cml0ZSkge1xyXG5cdFx0XHRcdHZhciBzaG9ydGN1dE5hbWUgPSBcIiRcIiArIGRlZi5uYW1lO1xyXG5cdFx0XHRcdGlmICghKHNob3J0Y3V0TmFtZSBpbiBtdHlwZS5fanN0eXBlKSB8fCBvdmVyd3JpdGUpIHtcclxuXHRcdFx0XHRcdG10eXBlLl9qc3R5cGVbc2hvcnRjdXROYW1lXSA9IHByb3A7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRtdHlwZS5kZXJpdmVkVHlwZXMuZm9yRWFjaChmdW5jdGlvbiAodCkge1xyXG5cdFx0XHRcdFx0Z2VuUHJvcGVydHlTaG9ydGN1dCh0LCBmYWxzZSk7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHRcdFx0Z2VuUHJvcGVydHlTaG9ydGN1dCh0aGlzLCB0cnVlKTtcclxuXHJcblx0XHRcdGlmIChwcm9wLmdldF9pc1N0YXRpYygpKSB7XHJcblx0XHRcdFx0Ly8gZm9yIHN0YXRpYyBwcm9wZXJ0aWVzIGFkZCBtZW1iZXIgdG8gamF2YXNjcmlwdCB0eXBlXHJcblx0XHRcdFx0dGhpcy5fanN0eXBlW1wiZ2V0X1wiICsgZGVmLm5hbWVdID0gdGhpcy5fbWFrZUdldHRlcihwcm9wLCBQcm9wZXJ0eSRfZ2V0dGVyLmJpbmQocHJvcCksIHRydWUpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdC8vIGZvciBpbnN0YW5jZSBwcm9wZXJ0aWVzIGFkZCBtZW1iZXIgdG8gYWxsIGluc3RhbmNlcyBvZiB0aGlzIGphdmFzY3JpcHQgdHlwZVxyXG5cdFx0XHRcdHRoaXMuX2pzdHlwZS5wcm90b3R5cGVbXCJnZXRfXCIgKyBkZWYubmFtZV0gPSB0aGlzLl9tYWtlR2V0dGVyKHByb3AsIFByb3BlcnR5JF9nZXR0ZXIuYmluZChwcm9wKSwgdHJ1ZSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChwcm9wLmdldF9pc1N0YXRpYygpKSB7XHJcblx0XHRcdFx0dGhpcy5fanN0eXBlW1wic2V0X1wiICsgZGVmLm5hbWVdID0gdGhpcy5fbWFrZVNldHRlcihwcm9wKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aGlzLl9qc3R5cGUucHJvdG90eXBlW1wic2V0X1wiICsgZGVmLm5hbWVdID0gdGhpcy5fbWFrZVNldHRlcihwcm9wKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dGhpcy5fcmFpc2VFdmVudChcInByb3BlcnR5QWRkZWRcIiwgW3RoaXMsIHsgcHJvcGVydHk6IHByb3B9XSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gcHJvcDtcclxuXHRcdH0sXHJcblx0XHRhZGRNZXRob2Q6IGZ1bmN0aW9uIFR5cGUkYWRkTWV0aG9kKGRlZikge1xyXG5cdFx0XHR2YXIgbWV0aG9kTmFtZSA9IHRoaXMuZ2V0X2Z1bGxOYW1lKCkgKyBcIi5cIiArIGRlZi5uYW1lO1xyXG5cdFx0XHR2YXIgbWV0aG9kID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdC8vc2lnbmF0dXJlOiBwMSwgcDIsIHAjLCBwYXRocywgb25TdWNjZXNzLCBvbkZhaWxcclxuXHJcblx0XHRcdFx0Ly8gRGV0ZWN0IHRoZSBvcHRpb25hbCBzdWNjZXNzIGFuZCBmYWlsdXJlIGNhbGxiYWNrIGRlbGVnYXRlc1xyXG5cdFx0XHRcdHZhciBvblN1Y2Nlc3M7XHJcblx0XHRcdFx0dmFyIG9uRmFpbDtcclxuXHRcdFx0XHR2YXIgcGF0aHMgPSBudWxsO1xyXG5cclxuXHRcdFx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHtcclxuXHRcdFx0XHRcdG9uU3VjY2VzcyA9IGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoIC0gMl07XHJcblx0XHRcdFx0XHRpZiAob25TdWNjZXNzIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuXHRcdFx0XHRcdFx0b25GYWlsID0gYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGggLSAxXTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRvblN1Y2Nlc3MgPSBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMClcclxuXHRcdFx0XHRcdG9uU3VjY2VzcyA9IGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoIC0gMV07XHJcblxyXG5cdFx0XHRcdGlmICghKG9uU3VjY2VzcyBpbnN0YW5jZW9mIEZ1bmN0aW9uKSlcclxuXHRcdFx0XHRcdG9uU3VjY2VzcyA9IHVuZGVmaW5lZDtcclxuXHJcblx0XHRcdFx0dmFyIG9uU3VjY2Vzc0ZuID0gZnVuY3Rpb24gKHJlc3VsdCkge1xyXG5cdFx0XHRcdFx0aWYgKG9uU3VjY2VzcyAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHRcdG9uU3VjY2VzcyhyZXN1bHQuZXZlbnQpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH07XHJcblxyXG5cdFx0XHRcdHZhciBhcmdDb3VudCA9IGFyZ3VtZW50cy5sZW5ndGggLSAob25TdWNjZXNzID09PSB1bmRlZmluZWQgPyAwIDogMSkgLSAob25GYWlsID09PSB1bmRlZmluZWQgPyAwIDogMSk7XHJcblx0XHRcdFx0dmFyIGZpcnN0QXJnQ291bGRCZVBhcmFtZXRlclNldCA9IGFyZ0NvdW50ID4gMCAmJiBhcmd1bWVudHNbMF0gaW5zdGFuY2VvZiBPYmplY3QgJiYgIShkZWYucGFyYW1ldGVycy5sZW5ndGggPT09IDAgfHwgYXJndW1lbnRzWzBdW2RlZi5wYXJhbWV0ZXJzWzBdXSA9PT0gdW5kZWZpbmVkKTtcclxuXHRcdFx0XHR2YXIgaW5zdGFuY2UgPSB0aGlzIGluc3RhbmNlb2YgRW50aXR5ID8gdGhpcyA6IG51bGw7XHJcblxyXG5cdFx0XHRcdGlmIChhcmdDb3VudCA+PSAxICYmIGFyZ0NvdW50IDw9IDIgJiYgYXJndW1lbnRzWzBdIGluc3RhbmNlb2YgT2JqZWN0ICYmXHJcblx0XHRcdFx0XHRcdCgoYXJnQ291bnQgPT0gMSAmJiAoZGVmLnBhcmFtZXRlcnMubGVuZ3RoICE9IDEgfHwgZmlyc3RBcmdDb3VsZEJlUGFyYW1ldGVyU2V0KSkgfHxcclxuXHRcdFx0XHRcdFx0KChhcmdDb3VudCA9PSAyICYmIChkZWYucGFyYW1ldGVycy5sZW5ndGggIT0gMiB8fCAoZmlyc3RBcmdDb3VsZEJlUGFyYW1ldGVyU2V0ICYmIGFyZ3VtZW50c1sxXSBpbnN0YW5jZW9mIEFycmF5KSkpKSkpIHtcclxuXHJcblx0XHRcdFx0XHQvLyBJbnZva2UgdGhlIHNlcnZlciBldmVudFxyXG5cdFx0XHRcdFx0Y29udGV4dC5zZXJ2ZXIucmFpc2VTZXJ2ZXJFdmVudChtZXRob2ROYW1lLCBpbnN0YW5jZSwgYXJndW1lbnRzWzBdLCBmYWxzZSwgb25TdWNjZXNzRm4sIG9uRmFpbCwgYXJnQ291bnQgPT0gMiA/IGFyZ3VtZW50c1sxXSA6IG51bGwpO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gT3RoZXJ3aXNlLCBhc3N1bWUgdGhhdCB0aGUgcGFyYW1ldGVycyB3ZXJlIGFsbCBwYXNzZWQgaW4gc2VxdWVudGlhbCBvcmRlclxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0Ly8gVGhyb3cgYW4gZXJyb3IgaWYgdGhlIGluY29ycmVjdCBudW1iZXIgb2YgYXJndW1lbnRzIHdlcmUgcGFzc2VkIHRvIHRoZSBtZXRob2RcclxuXHRcdFx0XHRcdGlmIChkZWYucGFyYW1ldGVycy5sZW5ndGggPT0gYXJnQ291bnQgLSAxICYmIGFyZ3VtZW50c1thcmdDb3VudCAtIDFdIGluc3RhbmNlb2YgQXJyYXkpXHJcblx0XHRcdFx0XHRcdHBhdGhzID0gYXJndW1lbnRzW2FyZ0NvdW50IC0gMV07XHJcblx0XHRcdFx0XHRlbHNlIGlmIChkZWYucGFyYW1ldGVycy5sZW5ndGggIT0gYXJnQ291bnQpXHJcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcigkZm9ybWF0KFwiSW52YWxpZCBudW1iZXIgb2YgYXJndW1lbnRzIHBhc3NlZCB0byBcXFwiezB9LnsxfVxcXCIgbWV0aG9kLlwiLCB0aGlzLl9mdWxsTmFtZSwgZGVmLm5hbWUpKTtcclxuXHJcblx0XHRcdFx0XHRpZiAoZGVmLmlzU3RhdGljICYmIHBhdGhzKVxyXG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJGZvcm1hdChcIkNhbm5vdCBpbmNsdWRlIHBhdGhzIHdoZW4gaW52b2tpbmcgYSBzdGF0aWMgbWV0aG9kIC0gXFxcInswfS57MX1cXFwiLlwiLCB0aGlzLm1ldGEuX2Z1bGxOYW1lLCBkZWYubmFtZSkpO1xyXG5cclxuXHRcdFx0XHRcdC8vIENvbnN0cnVjdCB0aGUgYXJndW1lbnRzIHRvIHBhc3NcclxuXHRcdFx0XHRcdHZhciBhcmdzID0ge307XHJcblx0XHRcdFx0XHRmb3IgKHZhciBwYXJhbWV0ZXIgaW4gZGVmLnBhcmFtZXRlcnMpIHtcclxuXHRcdFx0XHRcdFx0aWYgKGRlZi5wYXJhbWV0ZXJzLmhhc093blByb3BlcnR5KHBhcmFtZXRlcikpIHtcclxuXHRcdFx0XHRcdFx0XHRhcmdzW2RlZi5wYXJhbWV0ZXJzW3BhcmFtZXRlcl1dID0gYXJndW1lbnRzW3BhcmFtZXRlcl07XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyBJbnZva2UgdGhlIHNlcnZlciBldmVudFxyXG5cdFx0XHRcdFx0Y29udGV4dC5zZXJ2ZXIucmFpc2VTZXJ2ZXJFdmVudChtZXRob2ROYW1lLCBpbnN0YW5jZSwgYXJncywgZmFsc2UsIG9uU3VjY2Vzc0ZuLCBvbkZhaWwsIHBhdGhzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHQvLyBBc3NpZ24gdGhlIG1ldGhvZCB0byB0aGUgdHlwZSBmb3Igc3RhdGljIG1ldGhvZHMsIG90aGVyd2lzZSBhc3NpZ24gaXQgdG8gdGhlIHByb3RvdHlwZSBmb3IgaW5zdGFuY2UgbWV0aG9kc1xyXG5cdFx0XHRpZiAoZGVmLmlzU3RhdGljKSB7XHJcblx0XHRcdFx0dGhpcy5fanN0eXBlW2RlZi5uYW1lXSA9IG1ldGhvZDtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aGlzLl9qc3R5cGUucHJvdG90eXBlW2RlZi5uYW1lXSA9IG1ldGhvZDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdH0sXHRcclxuXHRcdGdldFBhdGg6IGZ1bmN0aW9uKHBhdGgpIHtcclxuXHRcdFx0Ly8gR2V0IHNpbmdsZSBwcm9wZXJ0eVxyXG5cdFx0XHR2YXIgcHJvcGVydHkgPSB0aGlzLnByb3BlcnR5KHBhdGgpO1xyXG5cdFx0XHJcblx0XHRcdC8vIENyZWF0ZSBwcm9wZXJ0eSBjaGFpblxyXG5cdFx0XHRpZiAoIXByb3BlcnR5KSB7XHJcblx0XHRcdFx0cHJvcGVydHkgPSBQcm9wZXJ0eUNoYWluLmNyZWF0ZSh0aGlzLCBuZXcgRXhvV2ViLk1vZGVsLlBhdGhUb2tlbnMocGF0aCkpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBSZXR1cm4gdGhlIHByb3BlcnR5IHBhdGhcclxuXHRcdFx0cmV0dXJuIHByb3BlcnR5O1xyXG5cdFx0fSxcclxuXHRcdGdldFBhdGhzOiBmdW5jdGlvbihwYXRoKSB7XHJcblx0XHRcdHZhciBzdGFydCA9IDA7XHJcblx0XHRcdHZhciBwYXRocyA9IFtdO1xyXG5cclxuXHRcdFx0Ly8gUHJvY2VzcyB0aGUgcGF0aFxyXG5cdFx0XHRpZiAoL3t8LHx9L2cudGVzdChwYXRoKSkge1xyXG5cdFx0XHRcdHZhciBzdGFjayA9IFtdO1xyXG5cdFx0XHRcdHZhciBwYXJlbnQ7XHJcblxyXG5cdFx0XHRcdGZvciAodmFyIGkgPSAwLCBsZW4gPSBwYXRoLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7XHJcblx0XHRcdFx0XHR2YXIgYyA9IHBhdGguY2hhckF0KGkpO1xyXG5cclxuXHRcdFx0XHRcdGlmIChjID09PSBcIntcIiB8fCBjID09PSBcIixcIiB8fCBjID09PSBcIn1cIikge1xyXG5cdFx0XHRcdFx0XHR2YXIgc2VnID0gcGF0aC5zdWJzdHJpbmcoc3RhcnQsIGkpLnRyaW0oKTtcclxuXHRcdFx0XHRcdFx0c3RhcnQgPSBpICsgMTtcclxuXHJcblx0XHRcdFx0XHRcdGlmIChjID09PSBcIntcIikge1xyXG5cdFx0XHRcdFx0XHRcdGlmIChwYXJlbnQpIHtcclxuXHRcdFx0XHRcdFx0XHRcdHN0YWNrLnB1c2gocGFyZW50KTtcclxuXHRcdFx0XHRcdFx0XHRcdHBhcmVudCArPSBcIi5cIiArIHNlZztcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0XHRwYXJlbnQgPSBzZWc7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGVsc2UgeyAvLyAnLCcgb3IgJ30nXHJcblx0XHRcdFx0XHRcdFx0aWYgKHNlZy5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRwYXRocy5wdXNoKHRoaXMuZ2V0UGF0aChwYXJlbnQgPyBwYXJlbnQgKyBcIi5cIiArIHNlZyA6IHNlZykpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0aWYgKGMgPT09IFwifVwiKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRwYXJlbnQgPSAoc3RhY2subGVuZ3RoID09PSAwKSA/IHVuZGVmaW5lZCA6IHN0YWNrLnBvcCgpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0aWYgKHN0YWNrLmxlbmd0aCA+IDAgfHwgcGFyZW50KSB7XHJcblx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJVbmNsb3NlZCAneycgaW4gcGF0aDogXCIgKyBwYXRoKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGlmIChzdGFydCA8IHBhdGgubGVuZ3RoKSB7XHJcblx0XHRcdFx0XHR2YXIgX3NlZyA9IHBhdGguc3Vic3RyaW5nKHN0YXJ0KS50cmltKCk7XHJcblx0XHRcdFx0XHRpZiAoX3NlZy5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0XHRcdHBhdGhzLnB1c2godGhpcy5nZXRQYXRoKF9zZWcpKTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyBTZXQgc3RhcnQgdG8gcGFzdCB0aGUgZW5kIG9mIHRoZSBsaXN0IHRvIGluZGljYXRlIHRoYXQgdGhlIGVudGlyZSBzdHJpbmcgd2FzIHByb2Nlc3NlZFxyXG5cdFx0XHRcdFx0c3RhcnQgPSBwYXRoLmxlbmd0aDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIElmIHRoZSBpbnB1dCBpcyBhIHNpbXBsZSBwcm9wZXJ0eSBvciBwYXRoLCB0aGVuIGFkZCB0aGUgc2luZ2xlIHByb3BlcnR5IG9yIGNoYWluXHJcblx0XHRcdGlmIChzdGFydCA9PT0gMCkge1xyXG5cdFx0XHRcdHBhdGhzLnB1c2godGhpcy5nZXRQYXRoKHBhdGgudHJpbSgpKSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiBwYXRocztcclxuXHRcdH0sXHJcblx0XHRfbWFrZUdldHRlcjogZnVuY3Rpb24gVHlwZSRfbWFrZUdldHRlcihwcm9wZXJ0eSwgZ2V0dGVyLCBza2lwVHlwZUNoZWNrKSB7XHJcblx0XHRcdHJldHVybiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0Ly8gZW5zdXJlIHRoZSBwcm9wZXJ0eSBpcyBpbml0aWFsaXplZFxyXG5cdFx0XHRcdHZhciByZXN1bHQgPSBnZXR0ZXIuY2FsbChwcm9wZXJ0eSwgdGhpcywgc2tpcFR5cGVDaGVjayk7XHJcblxyXG5cdFx0XHRcdC8vIGVuc3VyZSB0aGUgcHJvcGVydHkgaXMgaW5pdGlhbGl6ZWRcclxuXHRcdFx0XHRpZiAocmVzdWx0ID09PSB1bmRlZmluZWQgfHwgKHByb3BlcnR5LmdldF9pc0xpc3QoKSAmJiBMYXp5TG9hZGVyLmlzUmVnaXN0ZXJlZChyZXN1bHQpKSkge1xyXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCRmb3JtYXQoXHJcblx0XHRcdFx0XHRcdFwiUHJvcGVydHkgezB9LnsxfSBpcyBub3QgaW5pdGlhbGl6ZWQuICBNYWtlIHN1cmUgaW5zdGFuY2VzIGFyZSBsb2FkZWQgYmVmb3JlIGFjY2Vzc2luZyBwcm9wZXJ0eSB2YWx1ZXMuICB7Mn18ezN9XCIsXHJcblx0XHRcdFx0XHRcdHByb3BlcnR5Ll9jb250YWluaW5nVHlwZS5nZXRfZnVsbE5hbWUoKSxcclxuXHRcdFx0XHRcdFx0cHJvcGVydHkuZ2V0X25hbWUoKSxcclxuXHRcdFx0XHRcdFx0dGhpcy5tZXRhLnR5cGUuZ2V0X2Z1bGxOYW1lKCksXHJcblx0XHRcdFx0XHRcdHRoaXMubWV0YS5pZFxyXG5cdFx0XHRcdFx0KSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyByZXR1cm4gdGhlIHJlc3VsdFxyXG5cdFx0XHRcdHJldHVybiByZXN1bHQ7XHJcblx0XHRcdH07XHJcblx0XHR9LFxyXG5cdFx0X21ha2VTZXR0ZXI6IGZ1bmN0aW9uIFR5cGUkX21ha2VTZXR0ZXIocHJvcCkge1xyXG5cdFx0XHR2YXIgc2V0dGVyID0gZnVuY3Rpb24gKHZhbCkge1xyXG5cdFx0XHRcdFByb3BlcnR5JF9zZXR0ZXIuY2FsbChwcm9wLCB0aGlzLCB2YWwsIHRydWUpO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0c2V0dGVyLl9fbm90aWZpZXMgPSB0cnVlO1xyXG5cclxuXHRcdFx0cmV0dXJuIHNldHRlcjtcclxuXHRcdH0sXHJcblx0XHRnZXRfZm9ybWF0OiBmdW5jdGlvbiBUeXBlJGdldF9mb3JtYXQoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9mb3JtYXQgPyB0aGlzLl9mb3JtYXQgOiAodGhpcy5iYXNlVHlwZSA/IHRoaXMuYmFzZVR5cGUuZ2V0X2Zvcm1hdCgpIDogdW5kZWZpbmVkKTtcclxuXHRcdH0sXHJcblx0XHRzZXRfZm9ybWF0OiBmdW5jdGlvbiBUeXBlJHNldF9mb3JtYXQodmFsdWUpIHtcclxuXHRcdFx0aWYgKHZhbHVlICYmIHZhbHVlLmNvbnN0cnVjdG9yID09IFN0cmluZylcclxuXHRcdFx0XHR2YWx1ZSA9IGdldEZvcm1hdCh0aGlzLmdldF9qc3R5cGUoKSwgdmFsdWUpO1xyXG5cdFx0XHR0aGlzLl9mb3JtYXQgPSB2YWx1ZTtcclxuXHRcdH0sXHJcblx0XHRnZXRfZnVsbE5hbWU6IGZ1bmN0aW9uIFR5cGUkZ2V0X2Z1bGxOYW1lKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fZnVsbE5hbWU7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X2pzdHlwZTogZnVuY3Rpb24gVHlwZSRnZXRfanN0eXBlKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fanN0eXBlO1xyXG5cdFx0fSxcclxuXHRcdGdldF9wcm9wZXJ0aWVzOiBmdW5jdGlvbiBUeXBlJGdldF9wcm9wZXJ0aWVzKCkge1xyXG5cdFx0XHRyZXR1cm4gRXhvV2ViLm9iamVjdFRvQXJyYXkodGhpcy5fcHJvcGVydGllcyk7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X2FsbHByb3BlcnRpZXM6IGZ1bmN0aW9uIFR5cGUkZ2V0X2FsbHByb3BlcnRpZXMoKSB7XHJcblx0XHRcdHZhciB0ZW1wID0gRXhvV2ViLm9iamVjdFRvQXJyYXkodGhpcy5fcHJvcGVydGllcyk7XHJcblxyXG5cdFx0XHQvL2dvIHVwIHRoZSBiYXNlIHR5cGVzIHVudGlsIHRoZXJlIGFyZSBubyBtb3JlXHJcblx0XHRcdHZhciB0ZW1wT2JqID0gdGhpcztcclxuXHRcdFx0d2hpbGUgKHRlbXBPYmouYmFzZVR5cGUpIHtcclxuXHRcdFx0XHR0ZW1wT2JqID0gdGVtcE9iai5iYXNlVHlwZTtcclxuXHRcdFx0XHR0ZW1wID0gdGVtcE9iai5nZXRfcHJvcGVydGllcygpLmNvbmNhdCh0ZW1wKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIHRlbXA7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X2Jhc2Vwcm9wZXJ0aWVzOiBmdW5jdGlvbiBUeXBlJGdldF9iYXNlcHJvcGVydGllcygpIHtcclxuXHRcdFx0dmFyIHRlbXAgPSBuZXcgQXJyYXkoKTtcclxuXHJcblx0XHRcdC8vZ28gdXAgdGhlIGJhc2UgdHlwZXMgdW50aWwgdGhlcmUgYXJlIG5vIG1vcmVcclxuXHRcdFx0dmFyIHRlbXBPYmogPSB0aGlzO1xyXG5cdFx0XHR2YXIgYWxyZWFkeUJhc2UgPSB0cnVlO1xyXG5cdFx0XHR3aGlsZSAodGVtcE9iai5iYXNlVHlwZSkge1xyXG5cdFx0XHRcdHRlbXBPYmogPSB0ZW1wT2JqLmJhc2VUeXBlO1xyXG5cdFx0XHRcdHRlbXAgPSB0ZW1wT2JqLmdldF9wcm9wZXJ0aWVzKCkuY29uY2F0KHRlbXApO1xyXG5cdFx0XHRcdGFscmVhZHlCYXNlID0gZmFsc2U7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChhbHJlYWR5QmFzZSlcclxuXHRcdFx0XHR0ZW1wID0gdGVtcE9iai5nZXRfcHJvcGVydGllcygpO1xyXG5cclxuXHRcdFx0cmV0dXJuIHRlbXA7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X3N0YXRpY1Byb3BlcnRpZXM6IGZ1bmN0aW9uIFR5cGUkZ2V0X3N0YXRpY1Byb3BlcnRpZXMoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9zdGF0aWNQcm9wZXJ0aWVzO1xyXG5cdFx0fSxcclxuXHRcdGdldF9pbnN0YW5jZVByb3BlcnRpZXM6IGZ1bmN0aW9uIFR5cGUkZ2V0X2luc3RhbmNlUHJvcGVydGllcygpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2luc3RhbmNlUHJvcGVydGllcztcclxuXHRcdH0sXHJcblx0XHRwcm9wZXJ0eTogZnVuY3Rpb24gVHlwZSRwcm9wZXJ0eShuYW1lKSB7XHJcblx0XHRcdHZhciBwcm9wO1xyXG5cdFx0XHRmb3IgKHZhciB0ID0gdGhpczsgdCAmJiAhcHJvcDsgdCA9IHQuYmFzZVR5cGUpIHtcclxuXHRcdFx0XHRwcm9wID0gdC5fcHJvcGVydGllc1tuYW1lXTtcclxuXHJcblx0XHRcdFx0aWYgKHByb3ApIHtcclxuXHRcdFx0XHRcdHJldHVybiBwcm9wO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdH0sXHJcblx0XHRjb25kaXRpb25JZjogZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuXHRcdFx0bmV3IEV4b1dlYi5Nb2RlbC5SdWxlLmNvbmRpdGlvbih0aGlzLCBvcHRpb25zKTtcclxuXHRcdFx0cmV0dXJuIHRoaXM7XHJcblx0XHR9LFxyXG5cdFx0c2V0X29yaWdpbkZvck5ld1Byb3BlcnRpZXM6IGZ1bmN0aW9uIFR5cGUkc2V0X29yaWdpbkZvck5ld1Byb3BlcnRpZXModmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fb3JpZ2luRm9yTmV3UHJvcGVydGllcyA9IHZhbHVlO1xyXG5cdFx0fSxcclxuXHRcdGdldF9vcmlnaW5Gb3JOZXdQcm9wZXJ0aWVzOiBmdW5jdGlvbiBUeXBlJGdldF9vcmlnaW5Gb3JOZXdQcm9wZXJ0aWVzKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JpZ2luRm9yTmV3UHJvcGVydGllcztcclxuXHRcdH0sXHJcblx0XHRzZXRfb3JpZ2luOiBmdW5jdGlvbiBUeXBlJHNldF9vcmlnaW4odmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fb3JpZ2luID0gdmFsdWU7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X29yaWdpbjogZnVuY3Rpb24gVHlwZSRnZXRfb3JpZ2luKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JpZ2luO1xyXG5cdFx0fSxcclxuXHRcdGNvbXBpbGVFeHByZXNzaW9uOiBmdW5jdGlvbiBUeXBlJGNvbXBpbGUoZXhwcmVzc2lvbikge1xyXG5cclxuXHRcdFx0Ly8gdXNlIGV4cG9ydHMgaWYgcmVxdWlyZWRcclxuXHRcdFx0aWYgKHRoaXMuX2V4cG9ydHMgfHwgRXhvV2ViLmNvbmZpZy5leHByZXNzaW9uU2NvcGUpIHtcclxuXHRcdFx0XHRleHByZXNzaW9uID0gXCJyZXR1cm4gZnVuY3Rpb24oKSB7IHJldHVybiBcIiArIGV4cHJlc3Npb24gKyBcIjsgfVwiO1xyXG5cdFx0XHRcdHZhciBhcmdzO1xyXG5cdFx0XHRcdHZhciB2YWx1ZXM7XHJcblxyXG5cdFx0XHRcdC8vIEluY2x1ZGUgZXhwb3J0ZWQgZnVuY3Rpb25zLCBpZiBzcGVjaWZpZWRcclxuXHRcdFx0XHRpZiAodGhpcy5fZXhwb3J0cykge1xyXG5cdFx0XHRcdFx0YXJncyA9IHRoaXMuX2V4cG9ydHMubmFtZXM7XHJcblx0XHRcdFx0XHR2YWx1ZXMgPSB0aGlzLl9leHBvcnRzLmltcGxlbWVudGF0aW9ucztcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIEluY2x1ZGUgZ2xvYmFsIGV4cHJlc3Npb24gc2NvcGUgdmFyaWFibGVzLCBpcyBzcGVjaWZpZWRcclxuXHRcdFx0XHRpZiAoRXhvV2ViLmNvbmZpZy5leHByZXNzaW9uU2NvcGUpIHtcclxuXHRcdFx0XHRcdGlmICghRXhvV2ViLmNvbmZpZy5leHByZXNzaW9uU2NvcGUuX25hbWVzKSB7XHJcblx0XHRcdFx0XHRcdHZhciBzY29wZU5hbWVzID0gW107XHJcblx0XHRcdFx0XHRcdHZhciBzY29wZVZhbHVlcyA9IFtdO1xyXG5cdFx0XHRcdFx0XHRmb3IodmFyIGtleSBpbiBFeG9XZWIuY29uZmlnLmV4cHJlc3Npb25TY29wZSl7XHJcblx0XHRcdFx0XHRcdFx0c2NvcGVOYW1lcy5wdXNoKGtleSk7XHJcblx0XHRcdFx0XHRcdFx0c2NvcGVWYWx1ZXMucHVzaChFeG9XZWIuY29uZmlnLmV4cHJlc3Npb25TY29wZVtrZXldKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRFeG9XZWIuY29uZmlnLmV4cHJlc3Npb25TY29wZS5fbmFtZXMgPSBzY29wZU5hbWVzO1xyXG5cdFx0XHRcdFx0XHRFeG9XZWIuY29uZmlnLmV4cHJlc3Npb25TY29wZS5fdmFsdWVzID0gc2NvcGVWYWx1ZXM7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRhcmdzID0gYXJncyA/IGFyZ3MuY29uY2F0KEV4b1dlYi5jb25maWcuZXhwcmVzc2lvblNjb3BlLl9uYW1lcykgOiBFeG9XZWIuY29uZmlnLmV4cHJlc3Npb25TY29wZS5fbmFtZXM7XHJcblx0XHRcdFx0XHR2YWx1ZXMgPSB2YWx1ZXMgPyB2YWx1ZXMuY29uY2F0KEV4b1dlYi5jb25maWcuZXhwcmVzc2lvblNjb3BlLl92YWx1ZXMpIDogRXhvV2ViLmNvbmZpZy5leHByZXNzaW9uU2NvcGUuX3ZhbHVlcztcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIENvbXBpbGUgdGhlIGV4cHJlc3Npb24gdXNpbmcgdGhlIHNwZWNpZmllZCBleHBvcnRlZCBmdW5jdGlvbnMgYW5kIGdsb2JhbCBzY29wZSB2YXJpYWJsZXNcclxuXHRcdFx0XHR2YXIgY29tcGlsZSA9IEZ1bmN0aW9uLmFwcGx5KG51bGwsIGFyZ3MuY29uY2F0KFtleHByZXNzaW9uXSkpO1xyXG5cdFx0XHRcdHJldHVybiBjb21waWxlLmFwcGx5KG51bGwsIHZhbHVlcyk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIG90aGVyd2lzZSwganVzdCBjcmVhdGUgdGhlIGZ1bmN0aW9uIGJhc2VkIG9uIHRoZSBleHByZXNzaW9uXHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHJldHVybiBuZXcgRnVuY3Rpb24oXCJyZXR1cm4gXCIgKyBleHByZXNzaW9uICsgXCI7XCIpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0c2V0X2V4cG9ydHM6IGZ1bmN0aW9uIFR5cGUkc2V0X2V4cG9ydHMoZXhwb3J0cykge1xyXG5cdFx0XHR2YXIgbmFtZXMgPSBbXTtcclxuXHRcdFx0dmFyIHNjcmlwdCA9IFwicmV0dXJuIFtcIlxyXG5cdFx0XHRmb3IgKHZhciBuYW1lIGluIGV4cG9ydHMpIHtcclxuXHRcdFx0XHRuYW1lcy5wdXNoKG5hbWUpO1xyXG5cdFx0XHRcdHNjcmlwdCArPSBleHBvcnRzW25hbWVdICsgXCIsXCI7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHNjcmlwdC5sZW5ndGggPiA4KSB7XHJcblx0XHRcdFx0c2NyaXB0ID0gc2NyaXB0LnNsaWNlKDAsIC0xKSArIFwiXTtcIjtcclxuXHRcdFx0XHR0aGlzLl9leHBvcnRzID0geyBuYW1lczogbmFtZXMsIGltcGxlbWVudGF0aW9uczogbmV3IEZ1bmN0aW9uKHNjcmlwdCkoKSB9O1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0Ly8gQWRkcyBhIHNpbmdsZSBleHBvcnQgZnVuY3Rpb24gdG8gdGhlIHR5cGUgZm9yIHVzZSBieSBjYWxscyB0byBjb21waWxlRXhwcmVzc2lvbigpLlxyXG5cdFx0YWRkRXhwb3J0OiBmdW5jdGlvbiBUeXBlJGFkZEV4cG9ydChuYW1lLCBmbikge1xyXG5cdFx0XHRpZiAoIXRoaXMuX2V4cG9ydHMpIHtcclxuXHRcdFx0XHR0aGlzLl9leHBvcnRzID0geyBuYW1lczogW25hbWVdLCBpbXBsZW1lbnRhdGlvbnM6IG5ldyBGdW5jdGlvbihcInJldHVybiBbXCIgKyBmbiArIFwiXTtcIikoKSB9O1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKHRoaXMuX2V4cG9ydHMubmFtZXMuaW5kZXhPZihuYW1lKSA9PT0gLTEpIHtcclxuXHRcdFx0XHR0aGlzLl9leHBvcnRzLm5hbWVzLnB1c2gobmFtZSk7XHJcblx0XHRcdFx0dGhpcy5fZXhwb3J0cy5pbXBsZW1lbnRhdGlvbnMucHVzaChuZXcgRnVuY3Rpb24oXCJyZXR1cm4gXCIgKyBmbikoKSk7XHJcblx0XHRcdH1cclxuXHRcdFxyXG5cdFx0fSxcclxuXHRcdGVhY2hCYXNlVHlwZTogZnVuY3Rpb24gVHlwZSRlYWNoQmFzZVR5cGUoY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdFx0Zm9yICh2YXIgYmFzZVR5cGUgPSB0aGlzLmJhc2VUeXBlOyAhIWJhc2VUeXBlOyBiYXNlVHlwZSA9IGJhc2VUeXBlLmJhc2VUeXBlKSB7XHJcblx0XHRcdFx0aWYgKGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzLCBiYXNlVHlwZSkgPT09IGZhbHNlKSB7XHJcblx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0aXNTdWJjbGFzc09mOiBmdW5jdGlvbiBUeXBlJGlzU3ViY2xhc3NPZihtdHlwZSkge1xyXG5cdFx0XHR2YXIgcmVzdWx0ID0gZmFsc2U7XHJcblxyXG5cdFx0XHR0aGlzLmVhY2hCYXNlVHlwZShmdW5jdGlvbiAoYmFzZVR5cGUpIHtcclxuXHRcdFx0XHRpZiAoYmFzZVR5cGUgPT09IG10eXBlKSB7XHJcblx0XHRcdFx0XHRyZXN1bHQgPSB0cnVlO1xyXG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdFx0fSxcclxuXHRcdGlzTG9hZGVkOiBmdW5jdGlvbiAocHJvcCkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojRXhvV2ViLk1vZGVsLlR5cGUuaXNMb2FkZWRcIj5cclxuXHRcdFx0Ly8vIENoZWNrIHdoZXRoZXIgdGhlIFR5cGUgYW5kIG9wdGlvbmFsIHByb3BlcnR5IGFyZSBsb2FkZWQuXHJcblx0XHRcdC8vLyA8L3N1bW1hcnk+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cInByb3BcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCIgdHlwZT1cIk9iamVjdFwiPlRoZSBvcHRpb25hbCBwcm9wZXJ0eSBvYmplY3Qgb3IgcHJvcGVydHkgbmFtZSB0byBjaGVjay48L3BhcmFtPlxyXG5cclxuXHRcdFx0Ly8gRmlyc3Qgc2VlIGlmIHRoZXJlIGlzIGEgbGF6eSBsb2FkZXIgYXR0YWNoZWQgdG8gdGhlIGVudGl0eSAoYW5kIG9wdGlvbmFsIHByb3BlcnR5KS5cclxuXHRcdFx0aWYgKExhenlMb2FkZXIuaXNSZWdpc3RlcmVkKHRoaXMsIG51bGwsIHByb3ApKSB7XHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBJbW1lZGlhdGVseSByZXR1cm4gdHJ1ZSBpZiBhIHByb3BlcnR5IG5hbWUgd2FzIG5vdCBzcGVjaWZpZWRcclxuXHRcdFx0aWYgKHByb3ApIHtcclxuXHRcdFx0XHQvLyBDb2VyY2UgcHJvcGVydHkgbmFtZXMgaW50byBwcm9wZXJ0eSBpbnN0YW5jZXNcclxuXHRcdFx0XHRpZiAoaXNTdHJpbmcocHJvcCkpIHtcclxuXHRcdFx0XHRcdHByb3AgPSB0aGlzLnByb3BlcnR5KHByb3ApO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gT3RoZXJ3aXNlLCBnZXQgdGhlIHByb3BlcnR5IHZhbHVlIGFuZCBkZXRlcm1pbmUgd2hldGhlciB0aGVyZSBpcyBhXHJcblx0XHRcdFx0Ly8gbGF6eSBsb2FkZXIgYXR0YWNoZWQgdG8gdGhlIHByb3BlcnR5IHZhbHVlLCBlLmcuIGVudGl0eSBvciBsaXN0LlxyXG5cdFx0XHRcdHZhciB2YWwgPSBwcm9wLnZhbHVlKHRoaXMuX2pzdHlwZSk7XHJcblx0XHRcdFx0aWYgKHZhbCAhPT0gbnVsbCAmJiB2YWwgIT09IHVuZGVmaW5lZCAmJiBMYXp5TG9hZGVyLmlzUmVnaXN0ZXJlZCh2YWwpKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH0sXHJcblx0XHR0b1N0cmluZzogZnVuY3Rpb24gVHlwZSR0b1N0cmluZygpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuZ2V0X2Z1bGxOYW1lKCk7XHJcblx0XHR9LFxyXG5cdFx0YWRkQ29uZGl0aW9uc0NoYW5nZWQ6IGZ1bmN0aW9uIFR5cGUkYWRkQ29uZGl0aW9uc0NoYW5nZWQoaGFuZGxlciwgY3JpdGVyaWEpIHtcclxuXHRcdFx0dmFyIGZpbHRlcjtcclxuXHJcblx0XHRcdC8vIGNvbmRpdGlvbiB0eXBlIGZpbHRlclxyXG5cdFx0XHRpZiAoY3JpdGVyaWEgaW5zdGFuY2VvZiBDb25kaXRpb25UeXBlKSB7XHJcblx0XHRcdFx0ZmlsdGVyID0gZnVuY3Rpb24gKHNlbmRlciwgYXJncykgeyByZXR1cm4gYXJncy5jb25kaXRpb25UYXJnZXQuY29uZGl0aW9uLnR5cGUgPT09IGNyaXRlcmlhOyB9O1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIHByb3BlcnR5IGZpbHRlclxyXG5cdFx0XHRlbHNlIGlmIChjcml0ZXJpYSBpbnN0YW5jZW9mIFByb3BlcnR5IHx8IGNyaXRlcmlhIGluc3RhbmNlb2YgUHJvcGVydHlDaGFpbikge1xyXG5cdFx0XHRcdGNyaXRlcmlhID0gY3JpdGVyaWEubGFzdFByb3BlcnR5KCk7XHJcblx0XHRcdFx0ZmlsdGVyID0gZnVuY3Rpb24gKHNlbmRlciwgYXJncykgeyByZXR1cm4gYXJncy5jb25kaXRpb25UYXJnZXQucHJvcGVydGllcy5pbmRleE9mKGNyaXRlcmlhKSA+PSAwOyB9O1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBzdWJzY3JpYmUgdG8gdGhlIGV2ZW50XHJcblx0XHRcdHRoaXMuX2FkZEV2ZW50KFwiY29uZGl0aW9uc0NoYW5nZWRcIiwgaGFuZGxlciwgZmlsdGVyKTtcclxuXHJcblx0XHRcdC8vIFJldHVybiB0aGUgdHlwZSBtZXRhIHRvIHN1cHBvcnQgbWV0aG9kIGNoYWluaW5nXHJcblx0XHRcdHJldHVybiB0aGlzO1xyXG5cdFx0fSxcclxuXHRcdHJlbW92ZUNvbmRpdGlvbnNDaGFuZ2VkOiBmdW5jdGlvbiBUeXBlJHJlbW92ZUNvbmRpdGlvbnNDaGFuZ2VkKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fcmVtb3ZlRXZlbnQoXCJjb25kaXRpb25zQ2hhbmdlZFwiLCBoYW5kbGVyKTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRUeXBlLm1peGluKEZ1bmN0b3IuZXZlbnRpbmcpO1xyXG5cdEV4b1dlYi5Nb2RlbC5UeXBlID0gVHlwZTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5Nb2RlbC5Qcm9wZXJ0eVxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0Ly8vIDxyZW1hcmtzPlxyXG5cdC8vLyBJZiB0aGUgaW50ZXJmYWNlIGZvciB0aGlzIGNsYXNzIGlzIGNoYW5nZWQgaXQgc2hvdWxkIGFsc28gYmUgY2hhbmdlZCBpblxyXG5cdC8vLyBQcm9wZXJ0eUNoYWluLCBzaW5jZSBQcm9wZXJ0eUNoYWluIGFjdHMgYXMgYW4gYWdncmVnYXRpb24gb2YgcHJvcGVydGllcyBcclxuXHQvLy8gdGhhdCBjYW4gYmUgdHJlYXRlZCBhcyBhIHNpbmdsZSBwcm9wZXJ0eS5cclxuXHQvLy8gPC9yZW1hcmtzPlxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHRmdW5jdGlvbiBQcm9wZXJ0eShjb250YWluaW5nVHlwZSwgbmFtZSwganN0eXBlLCBsYWJlbCwgaGVscHRleHQsIGZvcm1hdCwgaXNMaXN0LCBpc1N0YXRpYywgaXNQZXJzaXN0ZWQsIGlzQ2FsY3VsYXRlZCwgaW5kZXgsIGRlZmF1bHRWYWx1ZSwgY29uc3RhbnQpIHtcclxuXHRcdHRoaXMuX2NvbnRhaW5pbmdUeXBlID0gY29udGFpbmluZ1R5cGU7XHJcblx0XHR0aGlzLl9uYW1lID0gbmFtZTtcclxuXHRcdHRoaXMuX2ZpZWxkTmFtZSA9IFwiX1wiICsgbmFtZTtcclxuXHRcdHRoaXMuX2pzdHlwZSA9IGpzdHlwZTtcclxuXHRcdHRoaXMuX2xhYmVsID0gbGFiZWwgfHwgbWFrZUh1bWFuUmVhZGFibGUobmFtZSk7XHJcblx0XHR0aGlzLl9oZWxwdGV4dCA9IGhlbHB0ZXh0O1xyXG5cdFx0dGhpcy5fZm9ybWF0ID0gZm9ybWF0O1xyXG5cdFx0dGhpcy5faXNMaXN0ID0gaXNMaXN0ID09PSB0cnVlO1xyXG5cdFx0dGhpcy5faXNTdGF0aWMgPSBpc1N0YXRpYyA9PT0gdHJ1ZTtcclxuXHRcdHRoaXMuX2lzUGVyc2lzdGVkID0gaXNQZXJzaXN0ZWQgPT09IHRydWU7XHJcblx0XHR0aGlzLl9pc0NhbGN1bGF0ZWQgPSBpc0NhbGN1bGF0ZWQgPT09IHRydWU7XHJcblx0XHR0aGlzLl9pbmRleCA9IGluZGV4O1xyXG5cdFx0dGhpcy5fZGVmYXVsdFZhbHVlID1cclxuXHRcdFx0ZGVmYXVsdFZhbHVlICE9PSB1bmRlZmluZWQgPyBkZWZhdWx0VmFsdWUgOlxyXG5cdFx0XHRcdGlzTGlzdCA/IFtdIDpcclxuXHRcdFx0XHRcdGpzdHlwZSA9PT0gQm9vbGVhbiA/IGZhbHNlIDpcclxuXHRcdFx0XHRcdFx0anN0eXBlID09PSBOdW1iZXIgPyAwIDpcclxuXHRcdFx0XHRcdFx0XHRudWxsO1xyXG5cclxuXHRcdHRoaXMuX2NvbnN0YW50ID0gbnVsbDtcclxuXHRcdGlmIChjb25zdGFudCAhPT0gbnVsbCAmJiBjb25zdGFudCAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdC8vIGNvbnN0YW50IHZhbHVlIHNob3VsZCBiZSBsYXppbHkgaW5pdGlhbGl6ZWQgdG8gZW5zdXJlIGFueSB0eXBlIGRlcGVuZGVuY2llcyBoYXZlIGJlZW4gcmVzb2x2ZWRcclxuXHRcdFx0aWYgKGlzTGlzdCAmJiBjb25zdGFudCBpbnN0YW5jZW9mIEFycmF5KSB7XHJcblx0XHRcdFx0dGhpcy5fY29uc3RhbnQgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gY29uc3RhbnQubWFwKGZ1bmN0aW9uIChpKSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiBuZXcganN0eXBlKGkpO1xyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0fTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICghaXNMaXN0ICYmIHR5cGVvZiBjb25zdGFudCA9PT0gXCJvYmplY3RcIikge1xyXG5cdFx0XHRcdHRoaXMuX2NvbnN0YW50ID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0bmV3IGpzdHlwZShpKTtcclxuXHRcdFx0XHR9O1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5fcnVsZXMgPSBbXTtcclxuXHJcblx0XHRpZiAoY29udGFpbmluZ1R5cGUuZ2V0X29yaWdpbkZvck5ld1Byb3BlcnRpZXMoKSkge1xyXG5cdFx0XHR0aGlzLl9vcmlnaW4gPSBjb250YWluaW5nVHlwZS5nZXRfb3JpZ2luRm9yTmV3UHJvcGVydGllcygpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmICh0aGlzLl9vcmlnaW4gPT09IFwiY2xpZW50XCIgJiYgdGhpcy5faXNQZXJzaXN0ZWQpIHtcclxuXHRcdFx0bG9nV2FybmluZygkZm9ybWF0KFwiQ2xpZW50LW9yaWdpbiBwcm9wZXJ0aWVzIHNob3VsZCBub3QgYmUgbWFya2VkIGFzIHBlcnNpc3RlZDogVHlwZSA9IHswfSwgTmFtZSA9IHsxfVwiLCBjb250YWluaW5nVHlwZS5nZXRfZnVsbE5hbWUoKSwgbmFtZSkpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Ly8gdXBkYXRlcyB0aGUgcHJvcGVydHkgYW5kIG1lc3NhZ2Ugb3IgY29uZGl0aW9uVHlwZSBvcHRpb25zIGZvciBwcm9wZXJ0eSBydWxlc1xyXG5cdGZ1bmN0aW9uIHByZXBhcmVQcm9wZXJ0eVJ1bGVPcHRpb25zKHByb3BlcnR5LCBvcHRpb25zLCBlcnJvcikge1xyXG5cdFx0b3B0aW9ucy5wcm9wZXJ0eSA9IHByb3BlcnR5O1xyXG5cdFx0aWYgKGVycm9yICYmIGVycm9yLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHtcclxuXHRcdFx0b3B0aW9ucy5tZXNzYWdlID0gZXJyb3I7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIENvbmRpdGlvblR5cGUpIHtcclxuXHRcdFx0b3B0aW9ucy5jb25kaXRpb25UeXBlID0gZXJyb3I7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gb3B0aW9ucztcclxuXHR9XHJcblxyXG5cdC8vIHVwZGF0ZXMgdGhlIHByb3BlcnR5IGFuZCBtZXNzYWdlIG9yIGNvbmRpdGlvblR5cGUgb3B0aW9ucyBmb3IgcHJvcGVydHkgcnVsZXNcclxuXHRmdW5jdGlvbiBoYXNQcm9wZXJ0eUNoYW5nZWRTdWJzY3JpYmVycyhwcm9wZXJ0eSwgb2JqKSB7XHJcblx0XHR2YXIgY2hhbmdlZEV2ZW50ID0gcHJvcGVydHkuX2dldEV2ZW50SGFuZGxlcihcImNoYW5nZWRcIik7XHJcblx0XHRyZXR1cm4gY2hhbmdlZEV2ZW50ICYmICFjaGFuZ2VkRXZlbnQuaXNFbXB0eShbb2JqXSk7XHJcblx0fVxyXG5cclxuXHQvLyByZWdpc3RlcnMgYSBydWxlIHdpdGggYSBzcGVjaWZpYyBwcm9wZXJ0eVxyXG5cdGZ1bmN0aW9uIHJlZ2lzdGVyUHJvcGVydHlSdWxlKHByb3BlcnR5LCBydWxlKSB7XHJcblx0XHRwcm9wZXJ0eS5fcnVsZXMucHVzaChydWxlKTtcclxuXHJcblx0XHQvLyBSYWlzZSBldmVudHMgaWYgcmVnaXN0ZXJlZC5cclxuXHRcdHZhciBydWxlUmVnaXN0ZXJlZEV2ZW50ID0gcHJvcGVydHkuX2dldEV2ZW50SGFuZGxlcihcInJ1bGVSZWdpc3RlcmVkXCIpO1xyXG5cdFx0aWYgKHJ1bGVSZWdpc3RlcmVkRXZlbnQgJiYgIXJ1bGVSZWdpc3RlcmVkRXZlbnQuaXNFbXB0eSgpKSB7XHJcblx0XHRcdHJ1bGVSZWdpc3RlcmVkRXZlbnQocnVsZSwgeyBwcm9wZXJ0eTogcHJvcGVydHkgfSk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBQcm9wZXJ0eSRfaW5pdChvYmosIHZhbCwgZm9yY2UpIHtcclxuXHRcdHZhciB0YXJnZXQgPSAodGhpcy5faXNTdGF0aWMgPyB0aGlzLl9jb250YWluaW5nVHlwZS5nZXRfanN0eXBlKCkgOiBvYmopO1xyXG5cdFx0dmFyIGN1clZhbCA9IHRhcmdldFt0aGlzLl9maWVsZE5hbWVdO1xyXG5cclxuXHRcdGlmIChjdXJWYWwgIT09IHVuZGVmaW5lZCAmJiAhKGZvcmNlID09PSB1bmRlZmluZWQgfHwgZm9yY2UpKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHR0YXJnZXRbdGhpcy5fZmllbGROYW1lXSA9IHZhbDtcclxuXHJcblx0XHR0YXJnZXQubWV0YS5wZW5kaW5nSW5pdCh0aGlzLCBmYWxzZSk7XHJcblxyXG5cdFx0aWYgKHZhbCBpbnN0YW5jZW9mIEFycmF5KSB7XHJcblx0XHRcdHZhciBfdGhpcyA9IHRoaXM7XHJcblx0XHRcdE9ic2VydmVyLm1ha2VPYnNlcnZhYmxlKHZhbCk7XHJcblx0XHRcdE9ic2VydmVyLmFkZENvbGxlY3Rpb25DaGFuZ2VkKHZhbCwgZnVuY3Rpb24gUHJvcGVydHkkY29sbGVjdGlvbkNoYW5nZWQoc2VuZGVyLCBhcmdzKSB7XHJcblx0XHRcdFx0dmFyIGNoYW5nZXMgPSBhcmdzLmdldF9jaGFuZ2VzKCk7XHJcblxyXG5cdFx0XHRcdC8vIERvbid0IHJhaXNlIHRoZSBjaGFuZ2UgZXZlbnQgdW5sZXNzIHRoZXJlIGlzIGFjdHVhbGx5IGEgY2hhbmdlIHRvIHRoZSBjb2xsZWN0aW9uXHJcblx0XHRcdFx0aWYgKGNoYW5nZXMgJiYgY2hhbmdlcy5zb21lKGZ1bmN0aW9uIChjaGFuZ2UpIHsgcmV0dXJuIChjaGFuZ2UubmV3SXRlbXMgJiYgY2hhbmdlLm5ld0l0ZW1zLmxlbmd0aCA+IDApIHx8IChjaGFuZ2Uub2xkSXRlbXMgJiYgY2hhbmdlLm9sZEl0ZW1zLmxlbmd0aCA+IDApOyB9KSkge1xyXG5cdFx0XHRcdFx0Ly8gTk9URTogcHJvcGVydHkgY2hhbmdlIHNob3VsZCBiZSBicm9hZGNhc3QgYmVmb3JlIHJ1bGVzIGFyZSBydW4gc28gdGhhdCBpZiBcclxuXHRcdFx0XHRcdC8vIGFueSBydWxlIGNhdXNlcyBhIHJvdW5kdHJpcCB0byB0aGUgc2VydmVyIHRoZXNlIGNoYW5nZXMgd2lsbCBiZSBhdmFpbGFibGVcclxuXHRcdFx0XHRcdF90aGlzLl9jb250YWluaW5nVHlwZS5tb2RlbC5ub3RpZnlMaXN0Q2hhbmdlZCh0YXJnZXQsIF90aGlzLCBjaGFuZ2VzKTtcclxuXHJcblx0XHRcdFx0XHQvLyBOT1RFOiBvbGRWYWx1ZSBpcyBub3QgY3VycmVudGx5IGltcGxlbWVudGVkIGZvciBsaXN0c1xyXG5cdFx0XHRcdFx0X3RoaXMuX3JhaXNlRXZlbnQoXCJjaGFuZ2VkXCIsIFt0YXJnZXQsIHsgcHJvcGVydHk6IF90aGlzLCBuZXdWYWx1ZTogdmFsLCBvbGRWYWx1ZTogdW5kZWZpbmVkLCBjaGFuZ2VzOiBjaGFuZ2VzLCBjb2xsZWN0aW9uQ2hhbmdlZDogdHJ1ZSB9XSk7XHJcblxyXG5cdFx0XHRcdFx0T2JzZXJ2ZXIucmFpc2VQcm9wZXJ0eUNoYW5nZWQodGFyZ2V0LCBfdGhpcy5fbmFtZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHJcblx0XHRcdC8vIE92ZXJyaWRlIHRoZSBkZWZhdWx0IHRvU3RyaW5nIG9uIGFycmF5cyBzbyB0aGF0IHdlIGdldCBhIGNvbW1hLWRlbGltaXRlZCBsaXN0XHJcblx0XHRcdHZhbC50b1N0cmluZyA9IFByb3BlcnR5JF9hcnJheVRvU3RyaW5nLmJpbmQodmFsKTtcclxuXHRcdH1cclxuXHJcblx0XHRPYnNlcnZlci5yYWlzZVByb3BlcnR5Q2hhbmdlZCh0YXJnZXQsIHRoaXMuX25hbWUpO1xyXG5cclxuXHRcdC8vIFJldHVybiB0aGUgcHJvcGVydHkgdG8gc3VwcG9ydCBtZXRob2QgY2hhaW5pbmdcclxuXHRcdHJldHVybiB0aGlzO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gUHJvcGVydHkkX2FycmF5VG9TdHJpbmcoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5qb2luKFwiLCBcIik7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBQcm9wZXJ0eSRfZW5zdXJlSW5pdGVkKG9iaikge1xyXG5cdFx0Ly8gRGV0ZXJtaW5lIGlmIHRoZSBwcm9wZXJ0eSBoYXMgYmVlbiBpbml0aWFsaXplZCB3aXRoIGEgdmFsdWVcclxuXHRcdC8vIGFuZCBpbml0aWFsaXplIHRoZSBwcm9wZXJ0eSBpZiBuZWNlc3NhcnlcclxuXHRcdGlmICghb2JqLmhhc093blByb3BlcnR5KHRoaXMuX2ZpZWxkTmFtZSkpIHtcclxuXHJcblx0XHRcdC8vIERvIG5vdCBpbml0aWFsaXplIGNhbGN1bGF0ZWQgcHJvcGVydGllcy4gQ2FsY3VsYXRlZCBwcm9wZXJ0aWVzIHNob3VsZCBiZSBpbml0aWFsaXplZCB1c2luZyBhIHByb3BlcnR5IGdldCBydWxlLiAgXHJcblx0XHRcdGlmICghdGhpcy5nZXRfaXNDYWxjdWxhdGVkKCkpIHtcclxuXHRcdFx0XHR2YXIgdmFsdWUgPSB0aGlzLmdldF9jb25zdGFudCgpICE9PSBudWxsID8gdGhpcy5nZXRfY29uc3RhbnQoKSA6IHRoaXMuZ2V0X2RlZmF1bHRWYWx1ZSgpO1xyXG5cdFx0XHRcdFByb3BlcnR5JF9pbml0LmNhbGwodGhpcywgb2JqLCB2YWx1ZSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIE1hcmsgdGhlIHByb3BlcnR5IGFzIHBlbmRpbmcgaW5pdGlhbGl6YXRpb25cclxuXHRcdFx0b2JqLm1ldGEucGVuZGluZ0luaXQodGhpcywgdHJ1ZSk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBQcm9wZXJ0eSRfZ2V0dGVyKG9iaikge1xyXG5cdFx0Ly8gRW5zdXJlIHRoZSBlbnRpdHkgaXMgbG9hZGVkIGJlZm9yZSBhY2Nlc3NpbmcgcHJvcGVydHkgdmFsdWVzXHJcblx0XHRpZiAoTGF6eUxvYWRlci5pc1JlZ2lzdGVyZWQob2JqKSkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gRW5zdXJlIHRoYXQgdGhlIHByb3BlcnR5IGhhcyBhbiBpbml0aWFsIChwb3NzaWJseSBkZWZhdWx0KSB2YWx1ZVxyXG5cdFx0UHJvcGVydHkkX2Vuc3VyZUluaXRlZC5jYWxsKHRoaXMsIG9iaik7XHJcblxyXG5cdFx0Ly8gUmFpc2UgZ2V0IGV2ZW50c1xyXG5cdFx0Ly8gTk9URTogZ2V0IGV2ZW50cyBtYXkgcmVzdWx0IGluIGEgY2hhbmdlLCBzbyB0aGUgdmFsdWUgY2Fubm90IGJlIGNhY2hlZFxyXG5cdFx0dmFyIGdldEV2ZW50ID0gdGhpcy5fZ2V0RXZlbnRIYW5kbGVyKFwiZ2V0XCIpO1xyXG5cdFx0aWYgKGdldEV2ZW50ICYmICFnZXRFdmVudC5pc0VtcHR5KCkpIHtcclxuXHRcdFx0Z2V0RXZlbnQob2JqLCB7IHByb3BlcnR5OiB0aGlzLCB2YWx1ZTogb2JqW3RoaXMuX2ZpZWxkTmFtZV0gfSk7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gUmV0dXJuIHRoZSBwcm9wZXJ0eSB2YWx1ZVxyXG5cdFx0cmV0dXJuIG9ialt0aGlzLl9maWVsZE5hbWVdO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gUHJvcGVydHkkX3NldHRlcihvYmosIHZhbCwgc2tpcFR5cGVDaGVjaywgYWRkaXRpb25hbEFyZ3MpIHtcclxuXHRcdC8vIEVuc3VyZSB0aGUgZW50aXR5IGlzIGxvYWRlZCBiZWZvcmUgc2V0dGluZyBwcm9wZXJ0eSB2YWx1ZXNcclxuXHRcdGlmIChMYXp5TG9hZGVyLmlzUmVnaXN0ZXJlZChvYmopKSB7XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBzZXQgXCIgKyB0aGlzLmdldF9uYW1lKCkgKyBcIj1cIiArICh2YWwgPT09IHVuZGVmaW5lZCA/IFwiPHVuZGVmaW5lZD5cIiA6IHZhbCkgKyBcIiBmb3IgaW5zdGFuY2UgXCIgKyBvYmoubWV0YS50eXBlLmdldF9mdWxsTmFtZSgpICsgXCJ8XCIgKyBvYmoubWV0YS5pZCArIFwiOiBvYmplY3QgaXMgZ2hvc3RlZC5cIik7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gRW5zdXJlIHRoYXQgdGhlIHByb3BlcnR5IGhhcyBhbiBpbml0aWFsIChwb3NzaWJseSBkZWZhdWx0KSB2YWx1ZVxyXG5cdFx0UHJvcGVydHkkX2Vuc3VyZUluaXRlZC5jYWxsKHRoaXMsIG9iaik7XHJcblxyXG5cdFx0aWYgKCF0aGlzLmNhblNldFZhbHVlKG9iaiwgdmFsKSkge1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2V0IFwiICsgdGhpcy5nZXRfbmFtZSgpICsgXCI9XCIgKyAodmFsID09PSB1bmRlZmluZWQgPyBcIjx1bmRlZmluZWQ+XCIgOiB2YWwpICsgXCIgZm9yIGluc3RhbmNlIFwiICsgb2JqLm1ldGEudHlwZS5nZXRfZnVsbE5hbWUoKSArIFwifFwiICsgb2JqLm1ldGEuaWQgKyBcIjogYSB2YWx1ZSBvZiB0eXBlIFwiICsgKHRoaXMuX2pzdHlwZSAmJiB0aGlzLl9qc3R5cGUubWV0YSA/IHRoaXMuX2pzdHlwZS5tZXRhLmdldF9mdWxsTmFtZSgpIDogcGFyc2VGdW5jdGlvbk5hbWUodGhpcy5fanN0eXBlKSkgKyBcIiB3YXMgZXhwZWN0ZWQuXCIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBvbGQgPSBvYmpbdGhpcy5fZmllbGROYW1lXTtcclxuXHJcblx0XHQvLyBVcGRhdGUgbGlzdHMgYXMgYmF0Y2ggcmVtb3ZlL2FkZCBvcGVyYXRpb25zXHJcblx0XHRpZiAodGhpcy5nZXRfaXNMaXN0KCkpIHtcclxuXHRcdFx0b2xkLmJlZ2luVXBkYXRlKCk7XHJcblx0XHRcdHVwZGF0ZShvbGQsIHZhbCk7XHJcblx0XHRcdG9sZC5lbmRVcGRhdGUoKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cclxuXHRcdFx0Ly8gY29tcGFyZSB2YWx1ZXMgc28gdGhhdCB0aGlzIGNoZWNrIGlzIGFjY3VyYXRlIGZvciBwcmltaXRpdmVzXHJcblx0XHRcdHZhciBvbGRWYWx1ZSA9IChvbGQgPT09IHVuZGVmaW5lZCB8fCBvbGQgPT09IG51bGwpID8gb2xkIDogb2xkLnZhbHVlT2YoKTtcclxuXHRcdFx0dmFyIG5ld1ZhbHVlID0gKHZhbCA9PT0gdW5kZWZpbmVkIHx8IHZhbCA9PT0gbnVsbCkgPyB2YWwgOiB2YWwudmFsdWVPZigpO1xyXG5cclxuXHRcdFx0Ly8gRG8gbm90aGluZyBpZiB0aGUgbmV3IHZhbHVlIGlzIHRoZSBzYW1lIGFzIHRoZSBvbGQgdmFsdWUuIEFjY291bnQgZm9yIE5hTiBudW1iZXJzLCB3aGljaCBhcmVcclxuXHRcdFx0Ly8gbm90IGVxdWl2YWxlbnQgKGV2ZW4gdG8gdGhlbXNlbHZlcykuIEFsdGhvdWdoIGlzTmFOIHJldHVybnMgdHJ1ZSBmb3Igbm9uLU51bWJlciB2YWx1ZXMsIHdlIHdvbid0XHJcblx0XHRcdC8vIGdldCB0aGlzIGZhciBmb3IgTnVtYmVyIHByb3BlcnRpZXMgdW5sZXNzIHRoZSB2YWx1ZSBpcyBhY3R1YWxseSBvZiB0eXBlIE51bWJlciAoYSBudW1iZXIgb3IgTmFOKS5cclxuXHRcdFx0aWYgKG9sZFZhbHVlICE9PSBuZXdWYWx1ZSAmJiAhKHRoaXMuX2pzdHlwZSA9PT0gTnVtYmVyICYmIGlzTmFOKG9sZFZhbHVlKSAmJiBpc05hTihuZXdWYWx1ZSkpKSB7XHJcblx0XHRcdFx0Ly8gU2V0IHRoZSBiYWNraW5nIGZpZWxkIHZhbHVlXHJcblx0XHRcdFx0b2JqW3RoaXMuX2ZpZWxkTmFtZV0gPSB2YWw7XHJcblxyXG5cdFx0XHRcdG9iai5tZXRhLnBlbmRpbmdJbml0KHRoaXMsIGZhbHNlKTtcclxuXHJcblx0XHRcdFx0Ly8gRG8gbm90IHJhaXNlIGNoYW5nZSBpZiB0aGUgcHJvcGVydHkgaGFzIG5vdCBiZWVuIGluaXRpYWxpemVkLiBcclxuXHRcdFx0XHRpZiAob2xkICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRcdHRoaXMucmFpc2VDaGFuZ2VkKG9iaiwgdmFsLCBvbGQsIGFkZGl0aW9uYWxBcmdzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdFByb3BlcnR5Lm1peGluKHtcclxuXHJcblx0XHRkZWZhdWx0VmFsdWU6IGZ1bmN0aW9uIFByb3BlcnR5JGRlZmF1bHRWYWx1ZSh2YWx1ZSkge1xyXG5cdFx0XHR0aGlzLl9kZWZhdWx0VmFsdWUgPSB2YWx1ZTtcclxuXHRcdFx0cmV0dXJuIHRoaXM7XHJcblx0XHR9LFxyXG5cclxuXHRcdGVxdWFsczogZnVuY3Rpb24gUHJvcGVydHkkZXF1YWxzKHByb3ApIHtcclxuXHRcdFx0aWYgKHByb3AgIT09IHVuZGVmaW5lZCAmJiBwcm9wICE9PSBudWxsKSB7XHJcblx0XHRcdFx0aWYgKHByb3AgaW5zdGFuY2VvZiBQcm9wZXJ0eSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMgPT09IHByb3A7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2UgaWYgKHByb3AgaW5zdGFuY2VvZiBQcm9wZXJ0eUNoYWluKSB7XHJcblx0XHRcdFx0XHR2YXIgcHJvcHMgPSBwcm9wLmFsbCgpO1xyXG5cdFx0XHRcdFx0cmV0dXJuIHByb3BzLmxlbmd0aCA9PT0gMSAmJiB0aGlzLmVxdWFscyhwcm9wc1swXSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cclxuXHRcdHJhaXNlQ2hhbmdlZDogZnVuY3Rpb24gKG9iaiwgdmFsLCBvbGQsIGFkZGl0aW9uYWxBcmdzKSB7XHJcblx0XHRcdC8vIE5PVEU6IHByb3BlcnR5IGNoYW5nZSBzaG91bGQgYmUgYnJvYWRjYXN0IGJlZm9yZSBydWxlcyBhcmUgcnVuIHNvIHRoYXQgaWYgXHJcblx0XHRcdC8vIGFueSBydWxlIGNhdXNlcyBhIHJvdW5kdHJpcCB0byB0aGUgc2VydmVyIHRoZXNlIGNoYW5nZXMgd2lsbCBiZSBhdmFpbGFibGVcclxuXHRcdFx0dGhpcy5fY29udGFpbmluZ1R5cGUubW9kZWwubm90aWZ5QWZ0ZXJQcm9wZXJ0eVNldChvYmosIHRoaXMsIHZhbCwgb2xkKTtcclxuXHJcblx0XHRcdHZhciBjaGFuZ2VkRXZlbnQgPSB0aGlzLl9nZXRFdmVudEhhbmRsZXIoXCJjaGFuZ2VkXCIpO1xyXG5cdFx0XHRpZiAoY2hhbmdlZEV2ZW50ICYmICFjaGFuZ2VkRXZlbnQuaXNFbXB0eSgpKSB7XHJcblx0XHRcdFx0Ly8gQ3JlYXRlIHRoZSBldmVudCBhcmd1bWVudCBvYmplY3RcclxuXHRcdFx0XHR2YXIgYXJncyA9IHsgcHJvcGVydHk6IHRoaXMsIG5ld1ZhbHVlOiB2YWwsIG9sZFZhbHVlOiBvbGQgfTtcclxuXHJcblx0XHRcdFx0Ly8gQXNzaWduIGN1c3RvbSBldmVudCBhcmd1bWVudCB2YWx1ZXNcclxuXHRcdFx0XHRpZiAoYWRkaXRpb25hbEFyZ3MpIHtcclxuXHRcdFx0XHRcdGZvciAodmFyIHAgaW4gYWRkaXRpb25hbEFyZ3MpIHtcclxuXHRcdFx0XHRcdFx0aWYgKGFkZGl0aW9uYWxBcmdzLmhhc093blByb3BlcnR5KHApKSB7XHJcblx0XHRcdFx0XHRcdFx0YXJnc1twXSA9IGFkZGl0aW9uYWxBcmdzW3BdO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRjaGFuZ2VkRXZlbnQob2JqLCBhcmdzKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0T2JzZXJ2ZXIucmFpc2VQcm9wZXJ0eUNoYW5nZWQob2JqLCB0aGlzLl9uYW1lKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0cnVsZTogZnVuY3Rpb24gKHR5cGUpIHtcclxuXHRcdFx0aWYgKHR5cGUgPT0gbnVsbCkgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEVycm9yKFwidHlwZVwiKTtcclxuXHRcdFx0aWYgKHR5cGVvZiAodHlwZSkgIT09IFwiZnVuY3Rpb25cIikgdGhyb3cgbmV3IEFyZ3VtZW50VHlwZUVycm9yKFwidHlwZVwiLCBcImZ1bmN0aW9uXCIsIHR5cGUpO1xyXG5cclxuXHRcdFx0cmV0dXJuIGZpcnN0KHRoaXMuX3J1bGVzLCBmdW5jdGlvbiAocnVsZSkge1xyXG5cdFx0XHRcdGlmIChydWxlIGluc3RhbmNlb2YgdHlwZSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdH0sXHJcblx0XHRydWxlczogZnVuY3Rpb24gKGZpbHRlcikge1xyXG5cdFx0XHRyZXR1cm4gZmlsdGVyICYmIGZpbHRlciBpbnN0YW5jZW9mIEZ1bmN0aW9uID8gdGhpcy5fcnVsZXMuZmlsdGVyKGZpbHRlcikgOiB0aGlzLl9ydWxlcy5zbGljZSgpO1xyXG5cdFx0fSxcclxuXHRcdGFkZFJ1bGVSZWdpc3RlcmVkOiBmdW5jdGlvbiBQcm9wZXJ0eSRhZGRSdWxlUmVnaXN0ZXJlZChoYW5kbGVyLCBvYmosIG9uY2UpIHtcclxuXHRcdFx0dGhpcy5fYWRkRXZlbnQoXCJydWxlUmVnaXN0ZXJlZFwiLCBoYW5kbGVyLCBvYmogPyBlcXVhbHMob2JqKSA6IG51bGwsIG9uY2UpO1xyXG5cdFx0XHRyZXR1cm4gdGhpcztcclxuXHRcdH0sXHJcblx0XHRyZW1vdmVSdWxlUmVnaXN0ZXJlZDogZnVuY3Rpb24gUHJvcGVydHkkcmVtb3ZlUnVsZVJlZ2lzdGVyZWQoaGFuZGxlciwgb2JqLCBvbmNlKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUV2ZW50KFwicnVsZVJlZ2lzdGVyZWRcIiwgaGFuZGxlcik7XHJcblx0XHRcdHJldHVybiB0aGlzO1xyXG5cdFx0fSxcclxuXHJcblx0XHR0b1N0cmluZzogZnVuY3Rpb24gUHJvcGVydHkkdG9TdHJpbmcoKSB7XHJcblx0XHRcdGlmICh0aGlzLl9pc1N0YXRpYykge1xyXG5cdFx0XHRcdHJldHVybiB0aGlzLmdldF9wYXRoKCk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0cmV0dXJuICRmb3JtYXQoXCJ0aGlzPHswfT4uezF9XCIsIFt0aGlzLmdldF9jb250YWluaW5nVHlwZSgpLCB0aGlzLmdldF9uYW1lKCldKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfY29udGFpbmluZ1R5cGU6IGZ1bmN0aW9uIFByb3BlcnR5JGdldF9jb250YWluaW5nVHlwZSgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2NvbnRhaW5pbmdUeXBlO1xyXG5cdFx0fSxcclxuXHRcdGlzRGVmaW5lZEJ5OiBmdW5jdGlvbiBQcm9wZXJ0eSRpc0RlZmluZWRCeShtdHlwZSkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fY29udGFpbmluZ1R5cGUgPT09IG10eXBlIHx8IG10eXBlLmlzU3ViY2xhc3NPZih0aGlzLl9jb250YWluaW5nVHlwZSk7XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldF9qc3R5cGU6IGZ1bmN0aW9uIFByb3BlcnR5JGdldF9qc3R5cGUoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9qc3R5cGU7XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldF9pbmRleDogZnVuY3Rpb24gUHJvcGVydHkkZ2V0X2luZGV4KCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5faW5kZXg7XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldF9mb3JtYXQ6IGZ1bmN0aW9uIFByb3BlcnR5JGdldF9mb3JtYXQoKSB7XHJcblx0XHRcdGlmICghdGhpcy5fZm9ybWF0KSB7XHJcblx0XHRcdFx0aWYgKHRoaXMuX2pzdHlwZS5tZXRhIGluc3RhbmNlb2YgRXhvV2ViLk1vZGVsLlR5cGUpXHJcblx0XHRcdFx0XHR0aGlzLl9mb3JtYXQgPSB0aGlzLl9qc3R5cGUubWV0YS5nZXRfZm9ybWF0KCk7IC8vIERlZmF1bHQgdG8gdHlwZS1sZXZlbCBmb3JtYXRzIGZvciBlbnRpdHkgdHlwZXNcclxuXHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0XHR0aGlzLl9mb3JtYXQgPSBnZXRGb3JtYXQodGhpcy5fanN0eXBlLCBcIkdcIik7IC8vIERlZmF1bHQgdG8gZ2VuZXJhbCBmb3JtYXQgZm9yIG5vbi1lbnRpdHkgdHlwZVxyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiB0aGlzLl9mb3JtYXQ7XHJcblx0XHR9LFxyXG5cdFx0c2V0X2Zvcm1hdDogZnVuY3Rpb24gUHJvcGVydHkkc2V0X2Zvcm1hdCh2YWx1ZSkge1xyXG5cdFx0XHR0aGlzLl9mb3JtYXQgPSBnZXRGb3JtYXQodGhpcy5fanN0eXBlLCB2YWx1ZSk7XHJcblx0XHR9LFxyXG5cdFx0Zm9ybWF0OiBmdW5jdGlvbiAodmFsKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLmdldF9mb3JtYXQoKSA/IHRoaXMuZ2V0X2Zvcm1hdCgpLmNvbnZlcnQodmFsKSA6IHZhbDtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0X2RlZmF1bHRWYWx1ZTogZnVuY3Rpb24gUHJvcGVydHkkZ2V0X2RlZmF1bHRWYWx1ZSgpIHtcclxuXHRcdFx0Ly8gY2xvbmUgYXJyYXkgYW5kIGRhdGUgZGVmYXVsdHMgc2luY2UgdGhleSBhcmUgbXV0YWJsZSBqYXZhc2NyaXB0IHR5cGVzXHJcblx0XHRcdHJldHVybiB0aGlzLl9kZWZhdWx0VmFsdWUgaW5zdGFuY2VvZiBBcnJheSA/IHRoaXMuX2RlZmF1bHRWYWx1ZS5zbGljZSgpIDpcclxuXHRcdFx0XHR0aGlzLl9kZWZhdWx0VmFsdWUgaW5zdGFuY2VvZiBEYXRlID8gbmV3IERhdGUoK3RoaXMuX2RlZmF1bHRWYWx1ZSkgOlxyXG5cdFx0XHRcdFx0dGhpcy5fZGVmYXVsdFZhbHVlIGluc3RhbmNlb2YgVGltZVNwYW4gPyBuZXcgVGltZVNwYW4odGhpcy5fZGVmYXVsdFZhbHVlLnRvdGFsTWlsbGlzZWNvbmRzKSA6XHJcblx0XHRcdFx0XHRcdHRoaXMuX2RlZmF1bHRWYWx1ZSBpbnN0YW5jZW9mIEZ1bmN0aW9uID8gdGhpcy5fZGVmYXVsdFZhbHVlKCkgOlxyXG5cdFx0XHRcdFx0XHRcdHRoaXMuX2RlZmF1bHRWYWx1ZTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0X29yaWdpbjogZnVuY3Rpb24gUHJvcGVydHkkZ2V0X29yaWdpbigpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX29yaWdpbiA/IHRoaXMuX29yaWdpbiA6IHRoaXMuX2NvbnRhaW5pbmdUeXBlLmdldF9vcmlnaW4oKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0X2lzRW50aXR5VHlwZTogZnVuY3Rpb24gUHJvcGVydHkkZ2V0X2lzRW50aXR5VHlwZSgpIHtcclxuXHRcdFx0aWYgKCF0aGlzLmdldF9qc3R5cGUoKS5tZXRhKSB7XHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiAhdGhpcy5faXNMaXN0O1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfaXNFbnRpdHlMaXN0VHlwZTogZnVuY3Rpb24gUHJvcGVydHkkZ2V0X2lzRW50aXR5TGlzdFR5cGUoKSB7XHJcblx0XHRcdGlmICghdGhpcy5nZXRfanN0eXBlKCkubWV0YSkge1xyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gdGhpcy5faXNMaXN0O1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfaXNWYWx1ZVR5cGU6IGZ1bmN0aW9uIFByb3BlcnR5JGdldF9pc1ZhbHVlVHlwZSgpIHtcclxuXHRcdFx0cmV0dXJuICF0aGlzLmdldF9qc3R5cGUoKS5tZXRhO1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfaXNMaXN0OiBmdW5jdGlvbiBQcm9wZXJ0eSRnZXRfaXNMaXN0KCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5faXNMaXN0O1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfaXNTdGF0aWM6IGZ1bmN0aW9uIFByb3BlcnR5JGdldF9pc1N0YXRpYygpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2lzU3RhdGljO1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfY29uc3RhbnQ6IGZ1bmN0aW9uIFByb3BlcnR5JGdldF9jb25zdGFudCgpIHtcclxuXHRcdFx0Ly8gaW5pdGlhbGl6ZSBhbmQgY2FjaGUgdGhlIGNvbnN0YW50IHZhbHVlIGlmIHdlIGhhdmUgbm90IGFscmVhZHlcclxuXHRcdFx0aWYgKHR5cGVvZiB0aGlzLl9jb25zdGFudCA9PT0gXCJmdW5jdGlvblwiKVxyXG5cdFx0XHRcdHRoaXMuX2NvbnN0YW50ID0gdGhpcy5fY29uc3RhbnQoKTtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2NvbnN0YW50O1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfaXNQZXJzaXN0ZWQ6IGZ1bmN0aW9uIFByb3BlcnR5JGdldF9pc1BlcnNpc3RlZCgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2lzUGVyc2lzdGVkO1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfaXNDYWxjdWxhdGVkOiBmdW5jdGlvbiBQcm9wZXJ0eSRnZXRfaXNDYWxjdWxhdGVkKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5faXNDYWxjdWxhdGVkO1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfbGFiZWw6IGZ1bmN0aW9uIFByb3BlcnR5JGdldF9sYWJlbCgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2xhYmVsO1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfaGVscHRleHQ6IGZ1bmN0aW9uIFByb3BlcnR5JGdldF9oZWxwdGV4dCgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2hlbHB0ZXh0O1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfbmFtZTogZnVuY3Rpb24gUHJvcGVydHkkZ2V0X25hbWUoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfZmllbGROYW1lOiBmdW5jdGlvbiBQcm9wZXJ0eSRnZXRfZmllbGROYW1lKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fZmllbGROYW1lO1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfcGF0aDogZnVuY3Rpb24gUHJvcGVydHkkZ2V0X3BhdGgoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9pc1N0YXRpYyA/ICh0aGlzLl9jb250YWluaW5nVHlwZS5nZXRfZnVsbE5hbWUoKSArIFwiLlwiICsgdGhpcy5fbmFtZSkgOiB0aGlzLl9uYW1lO1xyXG5cdFx0fSxcclxuXHJcblx0XHRjYW5TZXRWYWx1ZTogZnVuY3Rpb24gUHJvcGVydHkkY2FuU2V0VmFsdWUob2JqLCB2YWwpIHtcclxuXHRcdFx0Ly8gTk9URTogb25seSBhbGxvdyB2YWx1ZXMgb2YgdGhlIGNvcnJlY3QgZGF0YSB0eXBlIHRvIGJlIHNldCBpbiB0aGUgbW9kZWxcclxuXHJcblx0XHRcdGlmICh2YWwgPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdGxvZ1dhcm5pbmcoXCJZb3Ugc2hvdWxkIG5vdCBzZXQgcHJvcGVydHkgdmFsdWVzIHRvIHVuZGVmaW5lZCwgdXNlIG51bGwgaW5zdGVhZDogcHJvcGVydHkgPSAuXCIgKyB0aGlzLl9uYW1lICsgXCIuXCIpO1xyXG5cdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAodmFsID09PSBudWxsKSB7XHJcblx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIGZvciBlbnRpdGllcyBjaGVjayBiYXNlIHR5cGVzIGFzIHdlbGxcclxuXHRcdFx0aWYgKHZhbC5jb25zdHJ1Y3RvciAmJiB2YWwuY29uc3RydWN0b3IubWV0YSkge1xyXG5cdFx0XHRcdGZvciAodmFyIHZhbFR5cGUgPSB2YWwuY29uc3RydWN0b3IubWV0YTsgdmFsVHlwZTsgdmFsVHlwZSA9IHZhbFR5cGUuYmFzZVR5cGUpIHtcclxuXHRcdFx0XHRcdGlmICh2YWxUeXBlLl9qc3R5cGUgPT09IHRoaXMuX2pzdHlwZSkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly9EYXRhIHR5cGVzXHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHZhciB2YWxPYmplY3RUeXBlID0gdmFsLmNvbnN0cnVjdG9yO1xyXG5cclxuXHRcdFx0XHQvL1wiTm9ybWFsaXplXCIgZGF0YSB0eXBlIGluIGNhc2UgaXQgY2FtZSBmcm9tIGFub3RoZXIgZnJhbWUgYXMgd2VsbCBhcyBlbnN1cmUgdGhhdCB0aGUgdHlwZXMgYXJlIHRoZSBzYW1lXHJcblx0XHRcdFx0c3dpdGNoICh0eXBlKHZhbCkpIHtcclxuXHRcdFx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcclxuXHRcdFx0XHRcdFx0dmFsT2JqZWN0VHlwZSA9IFN0cmluZztcclxuXHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRjYXNlIFwibnVtYmVyXCI6XHJcblx0XHRcdFx0XHRcdHZhbE9iamVjdFR5cGUgPSBOdW1iZXI7XHJcblx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0Y2FzZSBcImJvb2xlYW5cIjpcclxuXHRcdFx0XHRcdFx0dmFsT2JqZWN0VHlwZSA9IEJvb2xlYW47XHJcblx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0Y2FzZSBcImRhdGVcIjpcclxuXHRcdFx0XHRcdFx0dmFsT2JqZWN0VHlwZSA9IERhdGU7XHJcblx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0Y2FzZSBcImFycmF5XCI6XHJcblx0XHRcdFx0XHRcdHZhbE9iamVjdFR5cGUgPSBBcnJheTtcclxuXHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyB2YWx1ZSBwcm9wZXJ0eSB0eXBlIGNoZWNrXHJcblx0XHRcdFx0cmV0dXJuIHZhbE9iamVjdFR5cGUgPT09IHRoaXMuX2pzdHlwZSB8fFxyXG5cclxuXHRcdFx0XHRcdC8vIGVudGl0eSBhcnJheSB0eXBlIGNoZWNrXHJcblx0XHRcdFx0XHQodmFsT2JqZWN0VHlwZSA9PT0gQXJyYXkgJiYgdGhpcy5nZXRfaXNMaXN0KCkgJiYgdmFsLmV2ZXJ5KGZ1bmN0aW9uIChjaGlsZCkge1xyXG5cdFx0XHRcdFx0XHRpZiAoY2hpbGQuY29uc3RydWN0b3IgJiYgY2hpbGQuY29uc3RydWN0b3IubWV0YSkge1xyXG5cdFx0XHRcdFx0XHRcdGZvciAodmFyIGNoaWxkVHlwZSA9IGNoaWxkLmNvbnN0cnVjdG9yLm1ldGE7IGNoaWxkVHlwZTsgY2hpbGRUeXBlID0gY2hpbGRUeXBlLmJhc2VUeXBlKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoY2hpbGRUeXBlLl9qc3R5cGUgPT09IHRoaXMuX2pzdHlwZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0cmV0dXJuIGNoaWxkLmNvbnN0cnVjdG9yID09PSB0aGlzLl9qc3R5cGU7XHJcblx0XHRcdFx0XHR9LCB0aGlzKSk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblxyXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIFByb3BlcnR5JHZhbHVlKG9iaiwgdmFsLCBhcmdzKSB7XHJcblx0XHRcdHZhciB0YXJnZXQgPSAodGhpcy5faXNTdGF0aWMgPyB0aGlzLl9jb250YWluaW5nVHlwZS5nZXRfanN0eXBlKCkgOiBvYmopO1xyXG5cclxuXHRcdFx0aWYgKHRhcmdldCA9PT0gdW5kZWZpbmVkIHx8IHRhcmdldCA9PT0gbnVsbCkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcigkZm9ybWF0KFxyXG5cdFx0XHRcdFx0XCJDYW5ub3QgezB9IHZhbHVlIGZvciB7MX1zdGF0aWMgcHJvcGVydHkgXFxcInsyfVxcXCIgb24gdHlwZSBcXFwiezN9XFxcIjogdGFyZ2V0IGlzIG51bGwgb3IgdW5kZWZpbmVkLlwiLFxyXG5cdFx0XHRcdFx0KGFyZ3VtZW50cy5sZW5ndGggPiAxID8gXCJzZXRcIiA6IFwiZ2V0XCIpLCAodGhpcy5faXNTdGF0aWMgPyBcIlwiIDogXCJub24tXCIpLCB0aGlzLmdldF9wYXRoKCksIHRoaXMuX2NvbnRhaW5pbmdUeXBlLmdldF9mdWxsTmFtZSgpKSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkge1xyXG5cdFx0XHRcdFByb3BlcnR5JF9zZXR0ZXIuY2FsbCh0aGlzLCB0YXJnZXQsIHZhbCwgZmFsc2UsIGFyZ3MpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHJldHVybiBQcm9wZXJ0eSRfZ2V0dGVyLmNhbGwodGhpcywgdGFyZ2V0KTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHRpc0luaXRlZDogZnVuY3Rpb24gUHJvcGVydHkkaXNJbml0ZWQob2JqKSB7XHJcblx0XHRcdHZhciB0YXJnZXQgPSAodGhpcy5faXNTdGF0aWMgPyB0aGlzLl9jb250YWluaW5nVHlwZS5nZXRfanN0eXBlKCkgOiBvYmopO1xyXG5cdFx0XHRpZiAoIXRhcmdldC5oYXNPd25Qcm9wZXJ0eSh0aGlzLl9maWVsZE5hbWUpKSB7XHJcblx0XHRcdFx0Ly8gSWYgdGhlIGJhY2tpbmcgZmllbGQgaGFzIG5vdCBiZWVuIGNyZWF0ZWQsIHRoZW4gcHJvcGVydHkgaXMgbm90IGluaXRpYWxpemVkXHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh0aGlzLl9pc0xpc3QpIHtcclxuXHRcdFx0XHR2YXIgdmFsdWUgPSB0YXJnZXRbdGhpcy5fZmllbGROYW1lXTtcclxuXHRcdFx0XHRpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCAhTGF6eUxvYWRlci5pc0xvYWRlZCh2YWx1ZSkpIHtcclxuXHRcdFx0XHRcdC8vIElmIHRoZSBsaXN0IGlzIG5vdC1sb2FkZWQsIHRoZW4gdGhlIHByb3BlcnR5IGlzIG5vdCBpbml0aWFsaXplZFxyXG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gc3RhcnRzIGxpc3RlbmluZyBmb3IgZ2V0IGV2ZW50cyBvbiB0aGUgcHJvcGVydHkuIFVzZSBvYmogYXJndW1lbnQgdG9cclxuXHRcdC8vIG9wdGlvbmFsbHkgZmlsdGVyIHRoZSBldmVudHMgdG8gYSBzcGVjaWZpYyBvYmplY3RcclxuXHRcdGFkZEdldDogZnVuY3Rpb24gUHJvcGVydHkkYWRkR2V0KGhhbmRsZXIsIG9iaiwgb25jZSkge1xyXG5cdFx0XHR0aGlzLl9hZGRFdmVudChcImdldFwiLCBoYW5kbGVyLCBvYmogPyBlcXVhbHMob2JqKSA6IG51bGwsIG9uY2UpO1xyXG5cclxuXHRcdFx0Ly8gUmV0dXJuIHRoZSBwcm9wZXJ0eSB0byBzdXBwb3J0IG1ldGhvZCBjaGFpbmluZ1xyXG5cdFx0XHRyZXR1cm4gdGhpcztcclxuXHRcdH0sXHJcblx0XHRyZW1vdmVHZXQ6IGZ1bmN0aW9uIFByb3BlcnR5JHJlbW92ZUdldChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUV2ZW50KFwiZ2V0XCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHJcblx0XHQvLyBzdGFydHMgbGlzdGVuaW5nIGZvciBjaGFuZ2UgZXZlbnRzIG9uIHRoZSBwcm9wZXJ0eS4gVXNlIG9iaiBhcmd1bWVudCB0b1xyXG5cdFx0Ly8gb3B0aW9uYWxseSBmaWx0ZXIgdGhlIGV2ZW50cyB0byBhIHNwZWNpZmljIG9iamVjdFxyXG5cdFx0YWRkQ2hhbmdlZDogZnVuY3Rpb24gUHJvcGVydHkkYWRkQ2hhbmdlZChoYW5kbGVyLCBvYmosIG9uY2UpIHtcclxuXHRcdFx0dGhpcy5fYWRkRXZlbnQoXCJjaGFuZ2VkXCIsIGhhbmRsZXIsIG9iaiA/IGVxdWFscyhvYmopIDogbnVsbCwgb25jZSk7XHJcblxyXG5cdFx0XHQvLyBSZXR1cm4gdGhlIHByb3BlcnR5IHRvIHN1cHBvcnQgbWV0aG9kIGNoYWluaW5nXHJcblx0XHRcdHJldHVybiB0aGlzO1xyXG5cdFx0fSxcclxuXHRcdHJlbW92ZUNoYW5nZWQ6IGZ1bmN0aW9uIFByb3BlcnR5JHJlbW92ZUNoYW5nZWQoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9yZW1vdmVFdmVudChcImNoYW5nZWRcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cclxuXHRcdGZpcnN0UHJvcGVydHk6IGZ1bmN0aW9uIFByb3BlcnR5JGZpcnN0UHJvcGVydHkoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzO1xyXG5cdFx0fSxcclxuXHRcdGxhc3RQcm9wZXJ0eTogZnVuY3Rpb24gUHJvcGVydHkkbGFzdFByb3BlcnR5KCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcztcclxuXHRcdH0sXHJcblx0XHRwcm9wZXJ0aWVzOiBmdW5jdGlvbiBQcm9wZXJ0eSRwcm9wZXJ0aWVzKCkge1xyXG5cdFx0XHRyZXR1cm4gW3RoaXNdO1xyXG5cdFx0fSxcclxuXHJcblx0XHRsYXN0VGFyZ2V0OiBmdW5jdGlvbiBQcm9wZXJ0eSRsYXN0VGFyZ2V0KG9iaikge1xyXG5cdFx0XHRyZXR1cm4gb2JqO1xyXG5cdFx0fSxcclxuXHJcblx0XHRpZkV4aXN0czogZnVuY3Rpb24gKHBhdGgpIHtcclxuXHRcdFx0TW9kZWwucHJvcGVydHkocGF0aCwgdGhpcy5fY29udGFpbmluZ1R5cGUsIHRydWUsIGZ1bmN0aW9uIChjaGFpbikge1xyXG5cdFx0XHRcdHRoaXMuY2FsY3VsYXRlZCh7XHJcblx0XHRcdFx0XHRiYXNlZE9uOiBbcGF0aF0sXHJcblx0XHRcdFx0XHRmbjogZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gIWlzTnVsbE9yVW5kZWZpbmVkKGNoYWluLnZhbHVlKHRoaXMpKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fSwgdGhpcyk7XHJcblxyXG5cdFx0XHRyZXR1cm4gdGhpcztcclxuXHRcdH0sXHJcblxyXG5cdFx0YWxpYXM6IGZ1bmN0aW9uIChwYXRoLCBldmVudE5hbWUpIHtcclxuXHRcdFx0TW9kZWwucHJvcGVydHkocGF0aCwgdGhpcy5fY29udGFpbmluZ1R5cGUsIHRydWUsIGZ1bmN0aW9uIChjaGFpbikge1xyXG5cdFx0XHRcdHRoaXMuY2FsY3VsYXRlZCh7XHJcblx0XHRcdFx0XHRiYXNlZE9uOiBbKGV2ZW50TmFtZSA/IGV2ZW50TmFtZSArIFwiIG9mIFwiIDogXCJcIikgKyBwYXRoXSxcclxuXHRcdFx0XHRcdGZuOiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiBjaGFpbi52YWx1ZSh0aGlzKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fSwgdGhpcyk7XHJcblxyXG5cdFx0XHRyZXR1cm4gdGhpcztcclxuXHRcdH0sXHJcblxyXG5cdFx0cm9vdGVkUGF0aDogZnVuY3Rpb24gUHJvcGVydHkkcm9vdGVkUGF0aCh0eXBlKSB7XHJcblx0XHRcdGlmICh0aGlzLmlzRGVmaW5lZEJ5KHR5cGUpKSB7XHJcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2lzU3RhdGljID8gdGhpcy5fY29udGFpbmluZ1R5cGUuZ2V0X2Z1bGxOYW1lKCkgKyBcIi5cIiArIHRoaXMuX25hbWUgOiB0aGlzLl9uYW1lO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cclxuXHRcdGxhYmVsOiBmdW5jdGlvbiAobGFiZWwpIHtcclxuXHRcdFx0dGhpcy5fbGFiZWwgPSBsYWJlbDtcclxuXHRcdFx0cmV0dXJuIHRoaXM7XHJcblx0XHR9LFxyXG5cclxuXHRcdGhlbHB0ZXh0OiBmdW5jdGlvbiAoaGVscHRleHQpIHtcclxuXHRcdFx0dGhpcy5faGVscHRleHQgPSBoZWxwdGV4dDtcclxuXHRcdFx0cmV0dXJuIHRoaXM7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIEFkZHMgYSBydWxlIHRvIHRoZSBwcm9wZXJ0eSB0aGF0IHdpbGwgdXBkYXRlIGl0cyB2YWx1ZSBiYXNlZCBvbiBhIGNhbGN1bGF0aW9uLlxyXG5cdFx0Y2FsY3VsYXRlZDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuXHRcdFx0b3B0aW9ucy5wcm9wZXJ0eSA9IHRoaXM7XHJcblx0XHRcdHZhciBkZWZpbmVkVHlwZSA9IG9wdGlvbnMucm9vdFR5cGUgPyBvcHRpb25zLnJvb3RUeXBlLm1ldGEgOiB0aGlzLl9jb250YWluaW5nVHlwZTtcclxuXHRcdFx0ZGVsZXRlIG9wdGlvbnMucm9vdFR5cGU7XHJcblxyXG5cdFx0XHRuZXcgQ2FsY3VsYXRlZFByb3BlcnR5UnVsZShkZWZpbmVkVHlwZSwgb3B0aW9ucyk7XHJcblxyXG5cdFx0XHRyZXR1cm4gdGhpcztcclxuXHRcdH0sXHJcblx0XHRyZXF1aXJlZDogZnVuY3Rpb24gKGVycm9yKSB7XHJcblx0XHRcdHZhciBvcHRpb25zID0gcHJlcGFyZVByb3BlcnR5UnVsZU9wdGlvbnModGhpcywge30sIGVycm9yKTtcclxuXHRcdFx0bmV3IEV4b1dlYi5Nb2RlbC5SdWxlLnJlcXVpcmVkKHRoaXMuX2NvbnRhaW5pbmdUeXBlLCBvcHRpb25zKTtcclxuXHRcdFx0cmV0dXJuIHRoaXM7XHJcblx0XHR9LFxyXG5cdFx0YWxsb3dlZFZhbHVlczogZnVuY3Rpb24gKHNvdXJjZSwgZXJyb3IpIHtcclxuXHRcdFx0dmFyIG9wdGlvbnMgPSBwcmVwYXJlUHJvcGVydHlSdWxlT3B0aW9ucyh0aGlzLCB7IHNvdXJjZTogc291cmNlIH0sIGVycm9yKTtcclxuXHRcdFx0bmV3IEV4b1dlYi5Nb2RlbC5SdWxlLmFsbG93ZWRWYWx1ZXModGhpcy5fY29udGFpbmluZ1R5cGUsIG9wdGlvbnMpO1xyXG5cdFx0XHRyZXR1cm4gdGhpcztcclxuXHRcdH0sXHJcblx0XHRvcHRpb25WYWx1ZXM6IGZ1bmN0aW9uIChzb3VyY2UsIGVycm9yKSB7XHJcblx0XHRcdHZhciBvcHRpb25zID0gcHJlcGFyZVByb3BlcnR5UnVsZU9wdGlvbnModGhpcywgeyBzb3VyY2U6IHNvdXJjZSwgb25Jbml0OiBmYWxzZSwgb25Jbml0TmV3OiBmYWxzZSwgb25Jbml0RXhpc3Rpbmc6IGZhbHNlIH0sIGVycm9yKTtcclxuXHRcdFx0b3B0aW9ucy5pZ25vcmVWYWxpZGF0aW9uID0gdHJ1ZTtcclxuXHRcdFx0bmV3IEV4b1dlYi5Nb2RlbC5SdWxlLmFsbG93ZWRWYWx1ZXModGhpcy5fY29udGFpbmluZ1R5cGUsIG9wdGlvbnMpO1xyXG5cdFx0XHRyZXR1cm4gdGhpcztcclxuXHRcdH0sXHJcblx0XHRjb21wYXJlOiBmdW5jdGlvbiAob3BlcmF0b3IsIHNvdXJjZSwgZXJyb3IpIHtcclxuXHRcdFx0dmFyIG9wdGlvbnMgPSBwcmVwYXJlUHJvcGVydHlSdWxlT3B0aW9ucyh0aGlzLCB7IGNvbXBhcmVPcGVyYXRvcjogb3BlcmF0b3IsIGNvbXBhcmVTb3VyY2U6IHNvdXJjZSB9LCBlcnJvcik7XHJcblx0XHRcdG5ldyBFeG9XZWIuTW9kZWwuUnVsZS5jb21wYXJlKHRoaXMuX2NvbnRhaW5pbmdUeXBlLCBvcHRpb25zKTtcclxuXHRcdFx0cmV0dXJuIHRoaXM7XHJcblx0XHR9LFxyXG5cdFx0cmFuZ2U6IGZ1bmN0aW9uIChtaW4sIG1heCwgZXJyb3IpIHtcclxuXHRcdFx0dmFyIG9wdGlvbnMgPSBwcmVwYXJlUHJvcGVydHlSdWxlT3B0aW9ucyh0aGlzLCB7IG1pbjogbWluLCBtYXg6IG1heCB9LCBlcnJvcik7XHJcblx0XHRcdG5ldyBFeG9XZWIuTW9kZWwuUnVsZS5yYW5nZSh0aGlzLl9jb250YWluaW5nVHlwZSwgb3B0aW9ucyk7XHJcblx0XHRcdHJldHVybiB0aGlzO1xyXG5cdFx0fSxcclxuXHRcdGNvbmRpdGlvbklmOiBmdW5jdGlvbiAob3B0aW9ucywgdHlwZSkge1xyXG5cdFx0XHR2YXIgZGVmaW5lZFR5cGUgPSBvcHRpb25zLnJvb3RUeXBlID8gb3B0aW9ucy5yb290VHlwZS5tZXRhIDogdGhpcy5fY29udGFpbmluZ1R5cGU7XHJcblx0XHRcdGRlbGV0ZSBvcHRpb25zLnJvb3RUeXBlO1xyXG5cclxuXHRcdFx0b3B0aW9ucyA9IHByZXBhcmVQcm9wZXJ0eVJ1bGVPcHRpb25zKHRoaXMsIG9wdGlvbnMsIHR5cGUpO1xyXG5cdFx0XHRuZXcgRXhvV2ViLk1vZGVsLlJ1bGUudmFsaWRhdGVkKGRlZmluZWRUeXBlLCBvcHRpb25zKTtcclxuXHRcdFx0cmV0dXJuIHRoaXM7XHJcblx0XHR9LFxyXG5cdFx0ZXJyb3JJZjogZnVuY3Rpb24gKG9wdGlvbnMsIGVycm9yKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLmNvbmRpdGlvbklmKG9wdGlvbnMsIGVycm9yKTtcclxuXHRcdH0sXHJcblx0XHR3YXJuaW5nSWY6IGZ1bmN0aW9uIChvcHRpb25zLCB3YXJuaW5nKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLmNvbmRpdGlvbklmKGpRdWVyeS5leHRlbmQob3B0aW9ucywgeyBjYXRlZ29yeTogQ29uZGl0aW9uVHlwZS5XYXJuaW5nIH0pLCB3YXJuaW5nKTtcclxuXHRcdH0sXHJcblx0XHRyZXF1aXJlZElmOiBmdW5jdGlvbiAoc291cmNlLCBvcGVyYXRvciwgdmFsdWUsIGVycm9yKSB7XHJcblx0XHRcdGlmIChzb3VyY2UuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xyXG5cdFx0XHRcdHZhciBvcHRpb25zID0gcHJlcGFyZVByb3BlcnR5UnVsZU9wdGlvbnModGhpcywgeyBjb21wYXJlU291cmNlOiBzb3VyY2UsIGNvbXBhcmVPcGVyYXRvcjogb3BlcmF0b3IsIGNvbXBhcmVWYWx1ZTogdmFsdWUgfSwgZXJyb3IpO1xyXG5cdFx0XHRcdG5ldyBFeG9XZWIuTW9kZWwuUnVsZS5yZXF1aXJlZElmKHRoaXMuX2NvbnRhaW5pbmdUeXBlLCBvcHRpb25zKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR2YXIgZGVmaW5lZFR5cGUgPSBzb3VyY2Uucm9vdFR5cGUgPyBzb3VyY2Uucm9vdFR5cGUubWV0YSA6IHRoaXMuX2NvbnRhaW5pbmdUeXBlO1xyXG5cdFx0XHRcdGRlbGV0ZSBzb3VyY2Uucm9vdFR5cGU7XHJcblx0XHRcdFx0c291cmNlID0gcHJlcGFyZVByb3BlcnR5UnVsZU9wdGlvbnModGhpcywgc291cmNlKTtcclxuXHJcblx0XHRcdFx0bmV3IEV4b1dlYi5Nb2RlbC5SdWxlLnJlcXVpcmVkSWYoZGVmaW5lZFR5cGUsIHNvdXJjZSk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHRoaXM7XHJcblx0XHR9LFxyXG5cdFx0c3RyaW5nTGVuZ3RoOiBmdW5jdGlvbiAobWluLCBtYXgsIGVycm9yKSB7XHJcblx0XHRcdHZhciBvcHRpb25zID0gcHJlcGFyZVByb3BlcnR5UnVsZU9wdGlvbnModGhpcywgeyBtaW46IG1pbiwgbWF4OiBtYXggfSwgZXJyb3IpO1xyXG5cdFx0XHRuZXcgRXhvV2ViLk1vZGVsLlJ1bGUuc3RyaW5nTGVuZ3RoKHRoaXMuX2NvbnRhaW5pbmdUeXBlLCBvcHRpb25zKTtcclxuXHRcdFx0cmV0dXJuIHRoaXM7XHJcblx0XHR9LFxyXG5cdFx0c3RyaW5nRm9ybWF0OiBmdW5jdGlvbiAoZGVzY3JpcHRpb24sIGV4cHJlc3Npb24sIHJlZm9ybWF0LCBlcnJvcikge1xyXG5cdFx0XHR2YXIgb3B0aW9ucyA9IHByZXBhcmVQcm9wZXJ0eVJ1bGVPcHRpb25zKHRoaXMsIHsgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uLCBleHByZXNzaW9uOiBleHByZXNzaW9uLCByZWZvcm1hdDogcmVmb3JtYXQgfSwgZXJyb3IpO1xyXG5cdFx0XHRuZXcgRXhvV2ViLk1vZGVsLlJ1bGUuc3RyaW5nRm9ybWF0KHRoaXMuX2NvbnRhaW5pbmdUeXBlLCBvcHRpb25zKTtcclxuXHRcdFx0cmV0dXJuIHRoaXM7XHJcblx0XHR9LFxyXG5cdFx0bGlzdExlbmd0aDogZnVuY3Rpb24gKG9wdGlvbnMsIGVycm9yKSB7XHJcblx0XHRcdHZhciBvcHRpb25zID0gcHJlcGFyZVByb3BlcnR5UnVsZU9wdGlvbnModGhpcywgeyBzdGF0aWNMZW5ndGg6IG9wdGlvbnMuc3RhdGljTGVuZ3RoLCBjb21wYXJlU291cmNlOiBvcHRpb25zLmNvbXBhcmVTb3VyY2UsIGNvbXBhcmVPcGVyYXRvcjogb3B0aW9ucy5jb21wYXJlT3BlcmF0b3IgfSwgZXJyb3IpO1xyXG5cdFx0XHRuZXcgRXhvV2ViLk1vZGVsLlJ1bGUubGlzdExlbmd0aCh0aGlzLl9jb250YWluaW5nVHlwZSwgb3B0aW9ucyk7XHJcblx0XHRcdHJldHVybiB0aGlzO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cdFByb3BlcnR5Lm1peGluKEZ1bmN0b3IuZXZlbnRpbmcpO1xyXG5cdEV4b1dlYi5Nb2RlbC5Qcm9wZXJ0eSA9IFByb3BlcnR5O1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLk1vZGVsLlBhdGhUb2tlbnNcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHRmdW5jdGlvbiBQYXRoVG9rZW5zKGV4cHJlc3Npb24pIHtcclxuXHRcclxuXHRcdC8vIGxlZ2FjeTogcmVtb3ZlIFwidGhpcy5cIiBwcmVmaXggZnJvbSBpbnN0YW5jZSBwcm9wZXJ0aWVzXHJcblx0XHRpZiAoZXhwcmVzc2lvbi5zdWJzdHIoMCwgNSkgPT09IFwidGhpcy5cIilcclxuXHRcdFx0ZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24uc3Vic3RyKDUpO1xyXG5cclxuXHRcdHRoaXMuZXhwcmVzc2lvbiA9IGV4cHJlc3Npb247XHJcblxyXG5cdFx0Ly8gcmVwbGFjZSBcIi5cIiBpbiB0eXBlIGNhc3RzIHNvIHRoYXQgdGhleSBkbyBub3QgaW50ZXJmZXJlIHdpdGggc3BsaXR0aW5nIHBhdGhcclxuXHRcdGV4cHJlc3Npb24gPSBleHByZXNzaW9uLnJlcGxhY2UoLzxbXj5dKj4vaWcsIGZ1bmN0aW9uKGUpIHsgcmV0dXJuIGUucmVwbGFjZSgvXFwuL2lnLCBmdW5jdGlvbigpIHsgcmV0dXJuIFwiJF8kXCI7IH0pOyB9KTtcclxuXHJcblx0XHRpZiAoZXhwcmVzc2lvbi5sZW5ndGggPiAwKSB7XHJcblx0XHRcdHRoaXMuc3RlcHMgPSBleHByZXNzaW9uLnNwbGl0KFwiLlwiKS5tYXAoZnVuY3Rpb24gKHN0ZXApIHtcclxuXHRcdFx0XHQvLyBSZWdleCBwYXR0ZXJuIG1hdGNoZXMgYWxsIGxldHRlcnMgYW5kIGRpZ2l0cyB0aGF0IGFyZSB2YWxpZCBmb3IgamF2YXNjcmlwdCBpZGVudGlmaWVycywgaW5jbHVkaW5nICBcIl9cIlxyXG5cdFx0XHRcdHZhciBwYXJzZWQgPSBzdGVwLm1hdGNoKC9eKFtfMC05YS16QS1aXFx1MDBhYVxcdTAwYjVcXHUwMGJhXFx1MDBjMC1cXHUwMGQ2XFx1MDBkOC1cXHUwMGY2XFx1MDBmOC1cXHUwMmI4XFx1MDJiYi1cXHUwMmMxXFx1MDJkMC1cXHUwMmQxXFx1MDJlMC1cXHUwMmU0XFx1MDJlZVxcdTAzNzAtXFx1MDM3M1xcdTAzNzYtXFx1MDM3N1xcdTAzN2EtXFx1MDM3ZFxcdTAzODZcXHUwMzg4LVxcdTAzOGFcXHUwMzhjXFx1MDM4ZS1cXHUwM2ExXFx1MDNhMy1cXHUwM2Y1XFx1MDNmNy1cXHUwNDgxXFx1MDQ4YS1cXHUwNTIzXFx1MDUzMS1cXHUwNTU2XFx1MDU1OVxcdTA1NjEtXFx1MDU4N1xcdTA1ZDAtXFx1MDVlYVxcdTA1ZjAtXFx1MDVmMlxcdTA2MjEtXFx1MDY0YVxcdTA2NjAtXFx1MDY2OVxcdTA2NmUtXFx1MDY2ZlxcdTA2NzEtXFx1MDZkM1xcdTA2ZDVcXHUwNmU1LVxcdTA2ZTZcXHUwNmVlLVxcdTA2ZmNcXHUwNmZmXFx1MDcxMFxcdTA3MTItXFx1MDcyZlxcdTA3NGQtXFx1MDdhNVxcdTA3YjFcXHUwN2MwLVxcdTA3ZWFcXHUwN2Y0LVxcdTA3ZjVcXHUwN2ZhXFx1MDkwNC1cXHUwOTM5XFx1MDkzZFxcdTA5NTBcXHUwOTU4LVxcdTA5NjFcXHUwOTY2LVxcdTA5NmZcXHUwOTcxLVxcdTA5NzJcXHUwOTdiLVxcdTA5N2ZcXHUwOTg1LVxcdTA5OGNcXHUwOThmLVxcdTA5OTBcXHUwOTkzLVxcdTA5YThcXHUwOWFhLVxcdTA5YjBcXHUwOWIyXFx1MDliNi1cXHUwOWI5XFx1MDliZFxcdTA5Y2VcXHUwOWRjLVxcdTA5ZGRcXHUwOWRmLVxcdTA5ZTFcXHUwOWU2LVxcdTA5ZjFcXHUwYTA1LVxcdTBhMGFcXHUwYTBmLVxcdTBhMTBcXHUwYTEzLVxcdTBhMjhcXHUwYTJhLVxcdTBhMzBcXHUwYTMyLVxcdTBhMzNcXHUwYTM1LVxcdTBhMzZcXHUwYTM4LVxcdTBhMzlcXHUwYTU5LVxcdTBhNWNcXHUwYTVlXFx1MGE2Ni1cXHUwYTZmXFx1MGE3Mi1cXHUwYTc0XFx1MGE4NS1cXHUwYThkXFx1MGE4Zi1cXHUwYTkxXFx1MGE5My1cXHUwYWE4XFx1MGFhYS1cXHUwYWIwXFx1MGFiMi1cXHUwYWIzXFx1MGFiNS1cXHUwYWI5XFx1MGFiZFxcdTBhZDBcXHUwYWUwLVxcdTBhZTFcXHUwYWU2LVxcdTBhZWZcXHUwYjA1LVxcdTBiMGNcXHUwYjBmLVxcdTBiMTBcXHUwYjEzLVxcdTBiMjhcXHUwYjJhLVxcdTBiMzBcXHUwYjMyLVxcdTBiMzNcXHUwYjM1LVxcdTBiMzlcXHUwYjNkXFx1MGI1Yy1cXHUwYjVkXFx1MGI1Zi1cXHUwYjYxXFx1MGI2Ni1cXHUwYjZmXFx1MGI3MVxcdTBiODNcXHUwYjg1LVxcdTBiOGFcXHUwYjhlLVxcdTBiOTBcXHUwYjkyLVxcdTBiOTVcXHUwYjk5LVxcdTBiOWFcXHUwYjljXFx1MGI5ZS1cXHUwYjlmXFx1MGJhMy1cXHUwYmE0XFx1MGJhOC1cXHUwYmFhXFx1MGJhZS1cXHUwYmI5XFx1MGJkMFxcdTBiZTYtXFx1MGJlZlxcdTBjMDUtXFx1MGMwY1xcdTBjMGUtXFx1MGMxMFxcdTBjMTItXFx1MGMyOFxcdTBjMmEtXFx1MGMzM1xcdTBjMzUtXFx1MGMzOVxcdTBjM2RcXHUwYzU4LVxcdTBjNTlcXHUwYzYwLVxcdTBjNjFcXHUwYzY2LVxcdTBjNmZcXHUwYzg1LVxcdTBjOGNcXHUwYzhlLVxcdTBjOTBcXHUwYzkyLVxcdTBjYThcXHUwY2FhLVxcdTBjYjNcXHUwY2I1LVxcdTBjYjlcXHUwY2JkXFx1MGNkZVxcdTBjZTAtXFx1MGNlMVxcdTBjZTYtXFx1MGNlZlxcdTBkMDUtXFx1MGQwY1xcdTBkMGUtXFx1MGQxMFxcdTBkMTItXFx1MGQyOFxcdTBkMmEtXFx1MGQzOVxcdTBkM2RcXHUwZDYwLVxcdTBkNjFcXHUwZDY2LVxcdTBkNmZcXHUwZDdhLVxcdTBkN2ZcXHUwZDg1LVxcdTBkOTZcXHUwZDlhLVxcdTBkYjFcXHUwZGIzLVxcdTBkYmJcXHUwZGJkXFx1MGRjMC1cXHUwZGM2XFx1MGUwMS1cXHUwZTMwXFx1MGUzMi1cXHUwZTMzXFx1MGU0MC1cXHUwZTQ2XFx1MGU1MC1cXHUwZTU5XFx1MGU4MS1cXHUwZTgyXFx1MGU4NFxcdTBlODctXFx1MGU4OFxcdTBlOGFcXHUwZThkXFx1MGU5NC1cXHUwZTk3XFx1MGU5OS1cXHUwZTlmXFx1MGVhMS1cXHUwZWEzXFx1MGVhNVxcdTBlYTdcXHUwZWFhLVxcdTBlYWJcXHUwZWFkLVxcdTBlYjBcXHUwZWIyLVxcdTBlYjNcXHUwZWJkXFx1MGVjMC1cXHUwZWM0XFx1MGVjNlxcdTBlZDAtXFx1MGVkOVxcdTBlZGMtXFx1MGVkZFxcdTBmMDBcXHUwZjIwLVxcdTBmMjlcXHUwZjQwLVxcdTBmNDdcXHUwZjQ5LVxcdTBmNmNcXHUwZjg4LVxcdTBmOGJcXHUxMDAwLVxcdTEwMmFcXHUxMDNmLVxcdTEwNDlcXHUxMDUwLVxcdTEwNTVcXHUxMDVhLVxcdTEwNWRcXHUxMDYxXFx1MTA2NS1cXHUxMDY2XFx1MTA2ZS1cXHUxMDcwXFx1MTA3NS1cXHUxMDgxXFx1MTA4ZVxcdTEwOTAtXFx1MTA5OVxcdTEwYTAtXFx1MTBjNVxcdTEwZDAtXFx1MTBmYVxcdTEwZmNcXHUxMTAwLVxcdTExNTlcXHUxMTVmLVxcdTExYTJcXHUxMWE4LVxcdTExZjlcXHUxMjAwLVxcdTEyNDhcXHUxMjRhLVxcdTEyNGRcXHUxMjUwLVxcdTEyNTZcXHUxMjU4XFx1MTI1YS1cXHUxMjVkXFx1MTI2MC1cXHUxMjg4XFx1MTI4YS1cXHUxMjhkXFx1MTI5MC1cXHUxMmIwXFx1MTJiMi1cXHUxMmI1XFx1MTJiOC1cXHUxMmJlXFx1MTJjMFxcdTEyYzItXFx1MTJjNVxcdTEyYzgtXFx1MTJkNlxcdTEyZDgtXFx1MTMxMFxcdTEzMTItXFx1MTMxNVxcdTEzMTgtXFx1MTM1YVxcdTEzODAtXFx1MTM4ZlxcdTEzYTAtXFx1MTNmNFxcdTE0MDEtXFx1MTY2Y1xcdTE2NmYtXFx1MTY3NlxcdTE2ODEtXFx1MTY5YVxcdTE2YTAtXFx1MTZlYVxcdTE3MDAtXFx1MTcwY1xcdTE3MGUtXFx1MTcxMVxcdTE3MjAtXFx1MTczMVxcdTE3NDAtXFx1MTc1MVxcdTE3NjAtXFx1MTc2Y1xcdTE3NmUtXFx1MTc3MFxcdTE3ODAtXFx1MTdiM1xcdTE3ZDdcXHUxN2RjXFx1MTdlMC1cXHUxN2U5XFx1MTgxMC1cXHUxODE5XFx1MTgyMC1cXHUxODc3XFx1MTg4MC1cXHUxOGE4XFx1MThhYVxcdTE5MDAtXFx1MTkxY1xcdTE5NDYtXFx1MTk2ZFxcdTE5NzAtXFx1MTk3NFxcdTE5ODAtXFx1MTlhOVxcdTE5YzEtXFx1MTljN1xcdTE5ZDAtXFx1MTlkOVxcdTFhMDAtXFx1MWExNlxcdTFiMDUtXFx1MWIzM1xcdTFiNDUtXFx1MWI0YlxcdTFiNTAtXFx1MWI1OVxcdTFiODMtXFx1MWJhMFxcdTFiYWUtXFx1MWJiOVxcdTFjMDAtXFx1MWMyM1xcdTFjNDAtXFx1MWM0OVxcdTFjNGQtXFx1MWM3ZFxcdTFkMDAtXFx1MWRiZlxcdTFlMDAtXFx1MWYxNVxcdTFmMTgtXFx1MWYxZFxcdTFmMjAtXFx1MWY0NVxcdTFmNDgtXFx1MWY0ZFxcdTFmNTAtXFx1MWY1N1xcdTFmNTlcXHUxZjViXFx1MWY1ZFxcdTFmNWYtXFx1MWY3ZFxcdTFmODAtXFx1MWZiNFxcdTFmYjYtXFx1MWZiY1xcdTFmYmVcXHUxZmMyLVxcdTFmYzRcXHUxZmM2LVxcdTFmY2NcXHUxZmQwLVxcdTFmZDNcXHUxZmQ2LVxcdTFmZGJcXHUxZmUwLVxcdTFmZWNcXHUxZmYyLVxcdTFmZjRcXHUxZmY2LVxcdTFmZmNcXHUyMDcxXFx1MjA3ZlxcdTIwOTAtXFx1MjA5NFxcdTIxMDJcXHUyMTA3XFx1MjEwYS1cXHUyMTEzXFx1MjExNVxcdTIxMTktXFx1MjExZFxcdTIxMjRcXHUyMTI2XFx1MjEyOFxcdTIxMmEtXFx1MjEyZFxcdTIxMmYtXFx1MjEzOVxcdTIxM2MtXFx1MjEzZlxcdTIxNDUtXFx1MjE0OVxcdTIxNGVcXHUyMTgzLVxcdTIxODRcXHUyYzAwLVxcdTJjMmVcXHUyYzMwLVxcdTJjNWVcXHUyYzYwLVxcdTJjNmZcXHUyYzcxLVxcdTJjN2RcXHUyYzgwLVxcdTJjZTRcXHUyZDAwLVxcdTJkMjVcXHUyZDMwLVxcdTJkNjVcXHUyZDZmXFx1MmQ4MC1cXHUyZDk2XFx1MmRhMC1cXHUyZGE2XFx1MmRhOC1cXHUyZGFlXFx1MmRiMC1cXHUyZGI2XFx1MmRiOC1cXHUyZGJlXFx1MmRjMC1cXHUyZGM2XFx1MmRjOC1cXHUyZGNlXFx1MmRkMC1cXHUyZGQ2XFx1MmRkOC1cXHUyZGRlXFx1MzAwNS1cXHUzMDA2XFx1MzAzMS1cXHUzMDM1XFx1MzAzYi1cXHUzMDNjXFx1MzA0MS1cXHUzMDk2XFx1MzA5ZC1cXHUzMDlmXFx1MzBhMS1cXHUzMGZhXFx1MzBmYy1cXHUzMGZmXFx1MzEwNS1cXHUzMTJkXFx1MzEzMS1cXHUzMThlXFx1MzFhMC1cXHUzMWI3XFx1MzFmMC1cXHUzMWZmXFx1MzQwMC1cXHU0ZGI1XFx1NGUwMC1cXHU5ZmMzXFx1YTAwMC1cXHVhNDhjXFx1YTUwMC1cXHVhNjBjXFx1YTYxMC1cXHVhNjJiXFx1YTY0MC1cXHVhNjVmXFx1YTY2Mi1cXHVhNjZlXFx1YTY4MC1cXHVhNjk3XFx1YTcyMi1cXHVhNzg4XFx1YTc4Yi1cXHVhNzhjXFx1YTdmYi1cXHVhODAxXFx1YTgwMy1cXHVhODA1XFx1YTgwNy1cXHVhODBhXFx1YTgwYy1cXHVhODIyXFx1YTg0MC1cXHVhODczXFx1YTg4Mi1cXHVhOGIzXFx1YThkMC1cXHVhOGQ5XFx1YTkwMC1cXHVhOTI1XFx1YTkzMC1cXHVhOTQ2XFx1YWEwMC1cXHVhYTI4XFx1YWE0MC1cXHVhYTQyXFx1YWE0NC1cXHVhYTRiXFx1YWE1MC1cXHVhYTU5XFx1YWMwMC1cXHVkN2EzXFx1ZjkwMC1cXHVmYTJkXFx1ZmEzMC1cXHVmYTZhXFx1ZmE3MC1cXHVmYWQ5XFx1ZmIwMC1cXHVmYjA2XFx1ZmIxMy1cXHVmYjE3XFx1ZmIxZFxcdWZiMWYtXFx1ZmIyOFxcdWZiMmEtXFx1ZmIzNlxcdWZiMzgtXFx1ZmIzY1xcdWZiM2VcXHVmYjQwLVxcdWZiNDFcXHVmYjQzLVxcdWZiNDRcXHVmYjQ2LVxcdWZiYjFcXHVmYmQzLVxcdWZkM2RcXHVmZDUwLVxcdWZkOGZcXHVmZDkyLVxcdWZkYzdcXHVmZGYwLVxcdWZkZmJcXHVmZTcwLVxcdWZlNzRcXHVmZTc2LVxcdWZlZmNcXHVmZjEwLVxcdWZmMTlcXHVmZjIxLVxcdWZmM2FcXHVmZjQxLVxcdWZmNWFcXHVmZjY2LVxcdWZmYmVcXHVmZmMyLVxcdWZmYzdcXHVmZmNhLVxcdWZmY2ZcXHVmZmQyLVxcdWZmZDdcXHVmZmRhLVxcdWZmZGNdKykoPChbXyQwLTlhLXpBLVpcXHUwMGFhXFx1MDBiNVxcdTAwYmFcXHUwMGMwLVxcdTAwZDZcXHUwMGQ4LVxcdTAwZjZcXHUwMGY4LVxcdTAyYjhcXHUwMmJiLVxcdTAyYzFcXHUwMmQwLVxcdTAyZDFcXHUwMmUwLVxcdTAyZTRcXHUwMmVlXFx1MDM3MC1cXHUwMzczXFx1MDM3Ni1cXHUwMzc3XFx1MDM3YS1cXHUwMzdkXFx1MDM4NlxcdTAzODgtXFx1MDM4YVxcdTAzOGNcXHUwMzhlLVxcdTAzYTFcXHUwM2EzLVxcdTAzZjVcXHUwM2Y3LVxcdTA0ODFcXHUwNDhhLVxcdTA1MjNcXHUwNTMxLVxcdTA1NTZcXHUwNTU5XFx1MDU2MS1cXHUwNTg3XFx1MDVkMC1cXHUwNWVhXFx1MDVmMC1cXHUwNWYyXFx1MDYyMS1cXHUwNjRhXFx1MDY2MC1cXHUwNjY5XFx1MDY2ZS1cXHUwNjZmXFx1MDY3MS1cXHUwNmQzXFx1MDZkNVxcdTA2ZTUtXFx1MDZlNlxcdTA2ZWUtXFx1MDZmY1xcdTA2ZmZcXHUwNzEwXFx1MDcxMi1cXHUwNzJmXFx1MDc0ZC1cXHUwN2E1XFx1MDdiMVxcdTA3YzAtXFx1MDdlYVxcdTA3ZjQtXFx1MDdmNVxcdTA3ZmFcXHUwOTA0LVxcdTA5MzlcXHUwOTNkXFx1MDk1MFxcdTA5NTgtXFx1MDk2MVxcdTA5NjYtXFx1MDk2ZlxcdTA5NzEtXFx1MDk3MlxcdTA5N2ItXFx1MDk3ZlxcdTA5ODUtXFx1MDk4Y1xcdTA5OGYtXFx1MDk5MFxcdTA5OTMtXFx1MDlhOFxcdTA5YWEtXFx1MDliMFxcdTA5YjJcXHUwOWI2LVxcdTA5YjlcXHUwOWJkXFx1MDljZVxcdTA5ZGMtXFx1MDlkZFxcdTA5ZGYtXFx1MDllMVxcdTA5ZTYtXFx1MDlmMVxcdTBhMDUtXFx1MGEwYVxcdTBhMGYtXFx1MGExMFxcdTBhMTMtXFx1MGEyOFxcdTBhMmEtXFx1MGEzMFxcdTBhMzItXFx1MGEzM1xcdTBhMzUtXFx1MGEzNlxcdTBhMzgtXFx1MGEzOVxcdTBhNTktXFx1MGE1Y1xcdTBhNWVcXHUwYTY2LVxcdTBhNmZcXHUwYTcyLVxcdTBhNzRcXHUwYTg1LVxcdTBhOGRcXHUwYThmLVxcdTBhOTFcXHUwYTkzLVxcdTBhYThcXHUwYWFhLVxcdTBhYjBcXHUwYWIyLVxcdTBhYjNcXHUwYWI1LVxcdTBhYjlcXHUwYWJkXFx1MGFkMFxcdTBhZTAtXFx1MGFlMVxcdTBhZTYtXFx1MGFlZlxcdTBiMDUtXFx1MGIwY1xcdTBiMGYtXFx1MGIxMFxcdTBiMTMtXFx1MGIyOFxcdTBiMmEtXFx1MGIzMFxcdTBiMzItXFx1MGIzM1xcdTBiMzUtXFx1MGIzOVxcdTBiM2RcXHUwYjVjLVxcdTBiNWRcXHUwYjVmLVxcdTBiNjFcXHUwYjY2LVxcdTBiNmZcXHUwYjcxXFx1MGI4M1xcdTBiODUtXFx1MGI4YVxcdTBiOGUtXFx1MGI5MFxcdTBiOTItXFx1MGI5NVxcdTBiOTktXFx1MGI5YVxcdTBiOWNcXHUwYjllLVxcdTBiOWZcXHUwYmEzLVxcdTBiYTRcXHUwYmE4LVxcdTBiYWFcXHUwYmFlLVxcdTBiYjlcXHUwYmQwXFx1MGJlNi1cXHUwYmVmXFx1MGMwNS1cXHUwYzBjXFx1MGMwZS1cXHUwYzEwXFx1MGMxMi1cXHUwYzI4XFx1MGMyYS1cXHUwYzMzXFx1MGMzNS1cXHUwYzM5XFx1MGMzZFxcdTBjNTgtXFx1MGM1OVxcdTBjNjAtXFx1MGM2MVxcdTBjNjYtXFx1MGM2ZlxcdTBjODUtXFx1MGM4Y1xcdTBjOGUtXFx1MGM5MFxcdTBjOTItXFx1MGNhOFxcdTBjYWEtXFx1MGNiM1xcdTBjYjUtXFx1MGNiOVxcdTBjYmRcXHUwY2RlXFx1MGNlMC1cXHUwY2UxXFx1MGNlNi1cXHUwY2VmXFx1MGQwNS1cXHUwZDBjXFx1MGQwZS1cXHUwZDEwXFx1MGQxMi1cXHUwZDI4XFx1MGQyYS1cXHUwZDM5XFx1MGQzZFxcdTBkNjAtXFx1MGQ2MVxcdTBkNjYtXFx1MGQ2ZlxcdTBkN2EtXFx1MGQ3ZlxcdTBkODUtXFx1MGQ5NlxcdTBkOWEtXFx1MGRiMVxcdTBkYjMtXFx1MGRiYlxcdTBkYmRcXHUwZGMwLVxcdTBkYzZcXHUwZTAxLVxcdTBlMzBcXHUwZTMyLVxcdTBlMzNcXHUwZTQwLVxcdTBlNDZcXHUwZTUwLVxcdTBlNTlcXHUwZTgxLVxcdTBlODJcXHUwZTg0XFx1MGU4Ny1cXHUwZTg4XFx1MGU4YVxcdTBlOGRcXHUwZTk0LVxcdTBlOTdcXHUwZTk5LVxcdTBlOWZcXHUwZWExLVxcdTBlYTNcXHUwZWE1XFx1MGVhN1xcdTBlYWEtXFx1MGVhYlxcdTBlYWQtXFx1MGViMFxcdTBlYjItXFx1MGViM1xcdTBlYmRcXHUwZWMwLVxcdTBlYzRcXHUwZWM2XFx1MGVkMC1cXHUwZWQ5XFx1MGVkYy1cXHUwZWRkXFx1MGYwMFxcdTBmMjAtXFx1MGYyOVxcdTBmNDAtXFx1MGY0N1xcdTBmNDktXFx1MGY2Y1xcdTBmODgtXFx1MGY4YlxcdTEwMDAtXFx1MTAyYVxcdTEwM2YtXFx1MTA0OVxcdTEwNTAtXFx1MTA1NVxcdTEwNWEtXFx1MTA1ZFxcdTEwNjFcXHUxMDY1LVxcdTEwNjZcXHUxMDZlLVxcdTEwNzBcXHUxMDc1LVxcdTEwODFcXHUxMDhlXFx1MTA5MC1cXHUxMDk5XFx1MTBhMC1cXHUxMGM1XFx1MTBkMC1cXHUxMGZhXFx1MTBmY1xcdTExMDAtXFx1MTE1OVxcdTExNWYtXFx1MTFhMlxcdTExYTgtXFx1MTFmOVxcdTEyMDAtXFx1MTI0OFxcdTEyNGEtXFx1MTI0ZFxcdTEyNTAtXFx1MTI1NlxcdTEyNThcXHUxMjVhLVxcdTEyNWRcXHUxMjYwLVxcdTEyODhcXHUxMjhhLVxcdTEyOGRcXHUxMjkwLVxcdTEyYjBcXHUxMmIyLVxcdTEyYjVcXHUxMmI4LVxcdTEyYmVcXHUxMmMwXFx1MTJjMi1cXHUxMmM1XFx1MTJjOC1cXHUxMmQ2XFx1MTJkOC1cXHUxMzEwXFx1MTMxMi1cXHUxMzE1XFx1MTMxOC1cXHUxMzVhXFx1MTM4MC1cXHUxMzhmXFx1MTNhMC1cXHUxM2Y0XFx1MTQwMS1cXHUxNjZjXFx1MTY2Zi1cXHUxNjc2XFx1MTY4MS1cXHUxNjlhXFx1MTZhMC1cXHUxNmVhXFx1MTcwMC1cXHUxNzBjXFx1MTcwZS1cXHUxNzExXFx1MTcyMC1cXHUxNzMxXFx1MTc0MC1cXHUxNzUxXFx1MTc2MC1cXHUxNzZjXFx1MTc2ZS1cXHUxNzcwXFx1MTc4MC1cXHUxN2IzXFx1MTdkN1xcdTE3ZGNcXHUxN2UwLVxcdTE3ZTlcXHUxODEwLVxcdTE4MTlcXHUxODIwLVxcdTE4NzdcXHUxODgwLVxcdTE4YThcXHUxOGFhXFx1MTkwMC1cXHUxOTFjXFx1MTk0Ni1cXHUxOTZkXFx1MTk3MC1cXHUxOTc0XFx1MTk4MC1cXHUxOWE5XFx1MTljMS1cXHUxOWM3XFx1MTlkMC1cXHUxOWQ5XFx1MWEwMC1cXHUxYTE2XFx1MWIwNS1cXHUxYjMzXFx1MWI0NS1cXHUxYjRiXFx1MWI1MC1cXHUxYjU5XFx1MWI4My1cXHUxYmEwXFx1MWJhZS1cXHUxYmI5XFx1MWMwMC1cXHUxYzIzXFx1MWM0MC1cXHUxYzQ5XFx1MWM0ZC1cXHUxYzdkXFx1MWQwMC1cXHUxZGJmXFx1MWUwMC1cXHUxZjE1XFx1MWYxOC1cXHUxZjFkXFx1MWYyMC1cXHUxZjQ1XFx1MWY0OC1cXHUxZjRkXFx1MWY1MC1cXHUxZjU3XFx1MWY1OVxcdTFmNWJcXHUxZjVkXFx1MWY1Zi1cXHUxZjdkXFx1MWY4MC1cXHUxZmI0XFx1MWZiNi1cXHUxZmJjXFx1MWZiZVxcdTFmYzItXFx1MWZjNFxcdTFmYzYtXFx1MWZjY1xcdTFmZDAtXFx1MWZkM1xcdTFmZDYtXFx1MWZkYlxcdTFmZTAtXFx1MWZlY1xcdTFmZjItXFx1MWZmNFxcdTFmZjYtXFx1MWZmY1xcdTIwNzFcXHUyMDdmXFx1MjA5MC1cXHUyMDk0XFx1MjEwMlxcdTIxMDdcXHUyMTBhLVxcdTIxMTNcXHUyMTE1XFx1MjExOS1cXHUyMTFkXFx1MjEyNFxcdTIxMjZcXHUyMTI4XFx1MjEyYS1cXHUyMTJkXFx1MjEyZi1cXHUyMTM5XFx1MjEzYy1cXHUyMTNmXFx1MjE0NS1cXHUyMTQ5XFx1MjE0ZVxcdTIxODMtXFx1MjE4NFxcdTJjMDAtXFx1MmMyZVxcdTJjMzAtXFx1MmM1ZVxcdTJjNjAtXFx1MmM2ZlxcdTJjNzEtXFx1MmM3ZFxcdTJjODAtXFx1MmNlNFxcdTJkMDAtXFx1MmQyNVxcdTJkMzAtXFx1MmQ2NVxcdTJkNmZcXHUyZDgwLVxcdTJkOTZcXHUyZGEwLVxcdTJkYTZcXHUyZGE4LVxcdTJkYWVcXHUyZGIwLVxcdTJkYjZcXHUyZGI4LVxcdTJkYmVcXHUyZGMwLVxcdTJkYzZcXHUyZGM4LVxcdTJkY2VcXHUyZGQwLVxcdTJkZDZcXHUyZGQ4LVxcdTJkZGVcXHUzMDA1LVxcdTMwMDZcXHUzMDMxLVxcdTMwMzVcXHUzMDNiLVxcdTMwM2NcXHUzMDQxLVxcdTMwOTZcXHUzMDlkLVxcdTMwOWZcXHUzMGExLVxcdTMwZmFcXHUzMGZjLVxcdTMwZmZcXHUzMTA1LVxcdTMxMmRcXHUzMTMxLVxcdTMxOGVcXHUzMWEwLVxcdTMxYjdcXHUzMWYwLVxcdTMxZmZcXHUzNDAwLVxcdTRkYjVcXHU0ZTAwLVxcdTlmYzNcXHVhMDAwLVxcdWE0OGNcXHVhNTAwLVxcdWE2MGNcXHVhNjEwLVxcdWE2MmJcXHVhNjQwLVxcdWE2NWZcXHVhNjYyLVxcdWE2NmVcXHVhNjgwLVxcdWE2OTdcXHVhNzIyLVxcdWE3ODhcXHVhNzhiLVxcdWE3OGNcXHVhN2ZiLVxcdWE4MDFcXHVhODAzLVxcdWE4MDVcXHVhODA3LVxcdWE4MGFcXHVhODBjLVxcdWE4MjJcXHVhODQwLVxcdWE4NzNcXHVhODgyLVxcdWE4YjNcXHVhOGQwLVxcdWE4ZDlcXHVhOTAwLVxcdWE5MjVcXHVhOTMwLVxcdWE5NDZcXHVhYTAwLVxcdWFhMjhcXHVhYTQwLVxcdWFhNDJcXHVhYTQ0LVxcdWFhNGJcXHVhYTUwLVxcdWFhNTlcXHVhYzAwLVxcdWQ3YTNcXHVmOTAwLVxcdWZhMmRcXHVmYTMwLVxcdWZhNmFcXHVmYTcwLVxcdWZhZDlcXHVmYjAwLVxcdWZiMDZcXHVmYjEzLVxcdWZiMTdcXHVmYjFkXFx1ZmIxZi1cXHVmYjI4XFx1ZmIyYS1cXHVmYjM2XFx1ZmIzOC1cXHVmYjNjXFx1ZmIzZVxcdWZiNDAtXFx1ZmI0MVxcdWZiNDMtXFx1ZmI0NFxcdWZiNDYtXFx1ZmJiMVxcdWZiZDMtXFx1ZmQzZFxcdWZkNTAtXFx1ZmQ4ZlxcdWZkOTItXFx1ZmRjN1xcdWZkZjAtXFx1ZmRmYlxcdWZlNzAtXFx1ZmU3NFxcdWZlNzYtXFx1ZmVmY1xcdWZmMTAtXFx1ZmYxOVxcdWZmMjEtXFx1ZmYzYVxcdWZmNDEtXFx1ZmY1YVxcdWZmNjYtXFx1ZmZiZVxcdWZmYzItXFx1ZmZjN1xcdWZmY2EtXFx1ZmZjZlxcdWZmZDItXFx1ZmZkN1xcdWZmZGEtXFx1ZmZkYyRdKyk+KT8kL2kpO1xyXG5cclxuXHRcdFx0XHRpZiAoIXBhcnNlZCkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHR2YXIgcmVzdWx0ID0geyBwcm9wZXJ0eTogcGFyc2VkWzFdIH07XHJcblxyXG5cdFx0XHRcdGlmIChwYXJzZWRbM10pIHtcclxuXHRcdFx0XHRcdC8vIHJlc3RvcmUgXCIuXCIgaW4gdHlwZSBjYXNlIGV4cHJlc3Npb25cclxuXHRcdFx0XHRcdHJlc3VsdC5jYXN0ID0gcGFyc2VkWzNdLnJlcGxhY2UoL1xcJF9cXCQvaWcsIGZ1bmN0aW9uKCkgeyByZXR1cm4gXCIuXCI7IH0pO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpcy5zdGVwcyA9IFtdO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0UGF0aFRva2Vucy5ub3JtYWxpemVQYXRocyA9IGZ1bmN0aW9uIFBhdGhUb2tlbnMkbm9ybWFsaXplUGF0aHMocGF0aHMpIHtcclxuXHRcdHZhciByZXN1bHQgPSBbXTtcclxuXHJcblx0XHRpZiAocGF0aHMpIHtcclxuXHRcdFx0cGF0aHMuZm9yRWFjaChmdW5jdGlvbiAocCkge1xyXG5cclxuXHRcdFx0XHQvLyBjb2VyY2UgcHJvcGVydHkgYW5kIHByb3BlcnR5IGNoYWlucyBpbnRvIHN0cmluZyBwYXRoc1xyXG5cdFx0XHRcdHAgPSBwIGluc3RhbmNlb2YgUHJvcGVydHkgPyBwLmdldF9uYW1lKCkgOlxyXG5cdFx0XHRcdFx0cCBpbnN0YW5jZW9mIFByb3BlcnR5Q2hhaW4gPyBwLmdldF9wYXRoKCkgOlxyXG5cdFx0XHRcdFx0cDtcclxuXHJcblx0XHRcdFx0dmFyIHN0YWNrID0gW107XHJcblx0XHRcdFx0dmFyIHBhcmVudDtcclxuXHRcdFx0XHR2YXIgc3RhcnQgPSAwO1xyXG5cdFx0XHRcdHZhciBwTGVuID0gcC5sZW5ndGg7XHJcblxyXG5cdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgcExlbjsgKytpKSB7XHJcblx0XHRcdFx0XHR2YXIgYyA9IHAuY2hhckF0KGkpO1xyXG5cclxuXHRcdFx0XHRcdGlmIChjID09PSAneycgfHwgYyA9PT0gJywnIHx8IGMgPT09ICd9Jykge1xyXG5cdFx0XHRcdFx0XHR2YXIgc2VnID0gcC5zdWJzdHJpbmcoc3RhcnQsIGkpLnRyaW0oKTtcclxuXHRcdFx0XHRcdFx0c3RhcnQgPSBpICsgMTtcclxuXHJcblx0XHRcdFx0XHRcdGlmIChjID09PSAneycpIHtcclxuXHRcdFx0XHRcdFx0XHRpZiAocGFyZW50KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRzdGFjay5wdXNoKHBhcmVudCk7XHJcblx0XHRcdFx0XHRcdFx0XHRwYXJlbnQgKz0gXCIuXCIgKyBzZWc7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0cGFyZW50ID0gc2VnO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRlbHNlIHsgICAvLyAnLCcgb3IgJ30nXHJcblx0XHRcdFx0XHRcdFx0aWYgKHNlZy5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRyZXN1bHQucHVzaChuZXcgUGF0aFRva2VucyhwYXJlbnQgPyBwYXJlbnQgKyBcIi5cIiArIHNlZyA6IHNlZykpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0aWYgKGMgPT09ICd9Jykge1xyXG5cdFx0XHRcdFx0XHRcdFx0cGFyZW50ID0gKHN0YWNrLmxlbmd0aCA9PT0gMCkgPyB1bmRlZmluZWQgOiBzdGFjay5wb3AoKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGlmIChzdGFjay5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJVbmNsb3NlZCAneycgaW4gcGF0aDogXCIgKyBwKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGlmIChzdGFydCA9PT0gMCkge1xyXG5cdFx0XHRcdFx0cmVzdWx0LnB1c2gobmV3IFBhdGhUb2tlbnMocC50cmltKCkpKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHJlc3VsdDtcclxuXHR9O1xyXG5cclxuXHRQYXRoVG9rZW5zLm1peGluKHtcclxuXHRcdGJ1aWxkRXhwcmVzc2lvbjogZnVuY3Rpb24gUGF0aFRva2VucyRidWlsZEV4cHJlc3Npb24oKSB7XHJcblx0XHRcdHZhciBwYXRoID0gXCJcIjtcclxuXHRcdFx0dGhpcy5zdGVwcy5mb3JFYWNoKGZ1bmN0aW9uKHN0ZXApIHtcclxuXHRcdFx0XHRwYXRoICs9IChwYXRoID8gXCIuXCIgOiBcIlwiKSArIHN0ZXAucHJvcGVydHkgKyAoc3RlcC5jYXN0ID8gXCI8XCIgKyBzdGVwLmNhc3QgKyBcIj5cIiA6IFwiXCIpO1xyXG5cdFx0XHR9KTtcclxuXHRcdFx0cmV0dXJuIHBhdGg7XHJcblx0XHR9LFxyXG5cdFx0dG9TdHJpbmc6IGZ1bmN0aW9uIFBhdGhUb2tlbnMkdG9TdHJpbmcoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLmV4cHJlc3Npb247XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdEV4b1dlYi5Nb2RlbC5QYXRoVG9rZW5zID0gUGF0aFRva2VucztcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5Nb2RlbC5Qcm9wZXJ0eUNoYWluXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gUHJvcGVydHlDaGFpbihyb290VHlwZSwgcHJvcGVydGllcywgZmlsdGVycykge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5PlxyXG5cdFx0Ly8vIEVuY2Fwc3VsYXRlcyB0aGUgbG9naWMgcmVxdWlyZWQgdG8gd29yayB3aXRoIGEgY2hhaW4gb2YgcHJvcGVydGllcyBhbmRcclxuXHRcdC8vLyBhIHJvb3Qgb2JqZWN0LCBhbGxvd2luZyBpbnRlcmFjdGlvbiB3aXRoIHRoZSBjaGFpbiBhcyBpZiBpdCB3ZXJlIGEgXHJcblx0XHQvLy8gc2luZ2xlIHByb3BlcnR5IG9mIHRoZSByb290IG9iamVjdC5cclxuXHRcdC8vLyA8L3N1bW1hcnk+XHJcblxyXG5cdFx0dmFyIGhhbmRsZXJzID0gbnVsbDtcclxuXHJcblx0XHRmdW5jdGlvbiBvblN0ZXBDaGFuZ2VkKHByaW9yUHJvcCwgc2VuZGVyLCBhcmdzKSB7XHJcblx0XHRcdC8vIHNjYW4gYWxsIGtub3duIG9iamVjdHMgb2YgdGhpcyB0eXBlIGFuZCByYWlzZSBldmVudCBmb3IgYW55IGluc3RhbmNlIGNvbm5lY3RlZFxyXG5cdFx0XHQvLyB0byB0aGUgb25lIHRoYXQgc2VudCB0aGUgZXZlbnQuXHJcblx0XHRcdGlmIChwcmlvclByb3AgIT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0dGhpcy5fcm9vdFR5cGUua25vd24oKS5mb3JFYWNoKGZ1bmN0aW9uKGtub3duKSB7XHJcblx0XHRcdFx0XHRpZiAodGhpcy5jb25uZWN0cyhrbm93biwgc2VuZGVyLCBwcmlvclByb3ApKSB7XHJcblx0XHRcdFx0XHRcdC8vIENvcHkgdGhlIG9yaWdpbmFsIGFyZ3VtZW50cyBzbyB0aGF0IHdlIGRvbid0IGFmZmVjdCBvdGhlciBjb2RlXHJcblx0XHRcdFx0XHRcdHZhciBuZXdBcmdzID0gT2JqZWN0LmNvcHkoYXJncyk7XHJcblxyXG5cdFx0XHRcdFx0Ly8gUmVzZXQgcHJvcGVydHkgdG8gYmUgdGhlIGNoYWluLCBidXQgc3RvcmUgdGhlIG9yaWdpbmFsIHByb3BlcnR5IGFzIFwidHJpZ2dlcmVkQnlcIlxyXG5cdFx0XHRcdFx0bmV3QXJncy5vcmlnaW5hbFNlbmRlciA9IHNlbmRlcjtcclxuXHRcdFx0XHRcdG5ld0FyZ3MudHJpZ2dlcmVkQnkgPSBuZXdBcmdzLnByb3BlcnR5O1xyXG5cdFx0XHRcdFx0bmV3QXJncy5wcm9wZXJ0eSA9IHRoaXM7XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBDYWxsIHRoZSBoYW5kbGVyLCBwYXNzaW5nIHRocm91Z2ggdGhlIGFyZ3VtZW50c1xyXG5cdFx0XHRcdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwiY2hhbmdlZFwiLCBba25vd24sIG5ld0FyZ3NdKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR2YXIgbmV3QXJncyA9IE9iamVjdC5jb3B5KGFyZ3MpO1xyXG5cdFx0XHRcdC8vIFJlc2V0IHByb3BlcnR5IHRvIGJlIHRoZSBjaGFpbiwgYnV0IHN0b3JlIHRoZSBvcmlnaW5hbCBwcm9wZXJ0eSBhcyBcInRyaWdnZXJlZEJ5XCJcclxuXHRcdFx0XHRuZXdBcmdzLm9yaWdpbmFsU2VuZGVyID0gc2VuZGVyO1xyXG5cdFx0XHRcdG5ld0FyZ3MudHJpZ2dlcmVkQnkgPSBuZXdBcmdzLnByb3BlcnR5O1xyXG5cdFx0XHRcdG5ld0FyZ3MucHJvcGVydHkgPSB0aGlzO1xyXG5cclxuXHRcdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwiY2hhbmdlZFwiLCBbc2VuZGVyLCBuZXdBcmdzXSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLl91cGRhdGVQcm9wZXJ0eUNoYW5nZVN1YnNjcmlwdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0dmFyIGhhbmRsZXIgPSB0aGlzLl9nZXRFdmVudEhhbmRsZXIoXCJjaGFuZ2VkXCIpO1xyXG5cdFx0XHR2YXIgZXZlbnRIYW5kbGVyc0V4aXN0ID0gaGFuZGxlciAmJiAhaGFuZGxlci5pc0VtcHR5KCk7XHJcblx0XHRcdHZhciBzdWJzY3JpYmVkVG9Qcm9wZXJ0eUNoYW5nZXMgPSBoYW5kbGVycyAhPT0gbnVsbDtcclxuXHJcblx0XHRcdGlmICghZXZlbnRIYW5kbGVyc0V4aXN0ICYmIHN1YnNjcmliZWRUb1Byb3BlcnR5Q2hhbmdlcykge1xyXG5cdFx0XHRcdC8vIElmIHRoZXJlIGFyZSBubyBtb3JlIHN1YnNjcmliZXJzIHRoZW4gdW5zdWJzY3JpYmUgZnJvbSBwcm9wZXJ0eS1sZXZlbCBldmVudHNcclxuXHRcdFx0XHR0aGlzLl9wcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCwgaW5kZXgpIHtcclxuXHRcdFx0XHRcdHZhciBoYW5kbGVyID0gaGFuZGxlcnNbaW5kZXhdO1xyXG5cdFx0XHRcdFx0cHJvcC5yZW1vdmVDaGFuZ2VkKGhhbmRsZXIpO1xyXG5cdFx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHRcdGhhbmRsZXJzID0gbnVsbDtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmIChldmVudEhhbmRsZXJzRXhpc3QgJiYgIXN1YnNjcmliZWRUb1Byb3BlcnR5Q2hhbmdlcykge1xyXG5cdFx0XHRcdC8vIElmIHRoZXJlIGFyZSBzdWJzY3JpYmVycyBhbmQgd2UgaGF2ZSBub3Qgc3Vic2NyaWJlZCB0byBwcm9wZXJ0eS1sZXZlbCBldmVudHMsIHRoZW4gZG8gc29cclxuXHRcdFx0XHRoYW5kbGVycyA9IFtdO1xyXG5cdFx0XHRcdHRoaXMuX3Byb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wLCBpbmRleCkge1xyXG5cdFx0XHRcdFx0dmFyIHByaW9yUHJvcCA9IChpbmRleCA9PT0gMCkgPyB1bmRlZmluZWQgOiB0aGlzLl9wcm9wZXJ0aWVzW2luZGV4IC0gMV07XHJcblx0XHRcdFx0XHR2YXIgaGFuZGxlciA9IG9uU3RlcENoYW5nZWQuYmluZCh0aGlzKS5wcmVwZW5kQXJndW1lbnRzKHByaW9yUHJvcCk7XHJcblx0XHRcdFx0XHRoYW5kbGVycy5wdXNoKGhhbmRsZXIpO1xyXG5cdFx0XHRcdFx0cHJvcC5hZGRDaGFuZ2VkKGhhbmRsZXIpO1xyXG5cdFx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHR9XHJcblx0XHR9O1xyXG5cclxuXHRcdHRoaXMuX3Jvb3RUeXBlID0gcm9vdFR5cGU7XHJcblx0XHR0aGlzLl9wcm9wZXJ0aWVzID0gcHJvcGVydGllcztcclxuXHRcdHRoaXMuX2ZpbHRlcnMgPSBmaWx0ZXJzO1xyXG5cdH1cclxuXHJcblx0UHJvcGVydHlDaGFpbi5jcmVhdGUgPSBmdW5jdGlvbiBQcm9wZXJ0eUNoYWluJGNyZWF0ZShyb290VHlwZSwgcGF0aFRva2Vucy8qLCBmb3JjZUxvYWRUeXBlcywgc3VjY2VzcywgZmFpbCovKSB7XHJcblx0XHQvLy8gPHN1bW1hcnk+XHJcblx0XHQvLy8gQXR0ZW1wdHMgdG8gc3luY2hyb25vdXNseSBvciBhc3luY2hyb25vdXNseSBjcmVhdGUgYSBwcm9wZXJ0eSBjaGFpbiBmb3IgdGhlIHNwZWNpZmllZCBcclxuXHRcdC8vLyByb290IHR5cGUgYW5kIHBhdGguICBBbHNvIGhhbmRsZXMgY2FjaGluZyBvZiBwcm9wZXJ0eSBjaGFpbnMgYXQgdGhlIHR5cGUgbGV2ZWwuXHJcblx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cclxuXHRcdHZhciB0eXBlID0gcm9vdFR5cGU7XHJcblx0XHR2YXIgcHJvcGVydGllcyA9IFtdO1xyXG5cdFx0dmFyIGZpbHRlcnMgPSBbXTtcclxuXHRcdHZhciBmaWx0ZXJUeXBlcyA9IFtdO1xyXG5cclxuXHRcdC8vIGluaXRpYWxpemUgb3B0aW9uYWwgY2FsbGJhY2sgYXJndW1lbnRzXHJcblx0XHR2YXIgZm9yY2VMb2FkVHlwZXMgPSBhcmd1bWVudHMubGVuZ3RoID49IDMgJiYgYXJndW1lbnRzWzJdICYmIGFyZ3VtZW50c1syXS5jb25zdHJ1Y3RvciA9PT0gQm9vbGVhbiA/IGFyZ3VtZW50c1syXSA6IGZhbHNlO1xyXG5cdFx0dmFyIHN1Y2Nlc3MgPSBhcmd1bWVudHMubGVuZ3RoID49IDQgJiYgYXJndW1lbnRzWzNdICYmIGFyZ3VtZW50c1szXSBpbnN0YW5jZW9mIEZ1bmN0aW9uID8gYXJndW1lbnRzWzNdIDogbnVsbDtcclxuXHRcdHZhciBmYWlsID0gYXJndW1lbnRzLmxlbmd0aCA+PSA1ICYmIGFyZ3VtZW50c1s0XSAmJiBhcmd1bWVudHNbNF0gaW5zdGFuY2VvZiBGdW5jdGlvbiA/XHJcblx0XHRcdGFyZ3VtZW50c1s0XSA6IGZ1bmN0aW9uIChlcnJvcikgeyBpZiAoc3VjY2VzcykgeyB0aHJvdyBuZXcgRXJyb3IoZXJyb3IpOyB9IH07XHJcblxyXG5cdFx0Ly8gcHJvY2VzcyBlYWNoIHN0ZXAgaW4gdGhlIHBhdGggZWl0aGVyIHN5bmNocm9ub3VzbHkgb3IgYXN5bmNocm9ub3VzbHkgZGVwZW5kaW5nIG9uIGFyZ3VtZW50c1xyXG5cdFx0dmFyIHByb2Nlc3NTdGVwID0gZnVuY3Rpb24gUHJvcGVydHlDaGFpbiRwcm9jZXNzU3RlcCgpIHtcclxuXHJcblx0XHRcdC8vIGdldCB0aGUgbmV4dCBzdGVwXHJcblx0XHRcdHZhciBzdGVwID0gcGF0aFRva2Vucy5zdGVwcy5kZXF1ZXVlKCk7XHJcblx0XHRcdGlmICghc3RlcCkge1xyXG5cdFx0XHRcdGZhaWwoJGZvcm1hdChcIlN5bnRheCBlcnJvciBpbiBwcm9wZXJ0eSBwYXRoOiB7MH1cIiwgW3BhdGhUb2tlbnMuZXhwcmVzc2lvbl0pKTtcclxuXHJcblx0XHRcdFx0Ly8gcmV0dXJuIG51bGwgdG8gaW5kaWNhdGUgdGhhdCB0aGUgcGF0aCBpcyBub3QgdmFsaWRcclxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gZ2V0IHRoZSBwcm9wZXJ0eSBmb3IgdGhlIHN0ZXAgXHJcblx0XHRcdHZhciBwcm9wID0gdHlwZS5wcm9wZXJ0eShzdGVwLnByb3BlcnR5KTtcclxuXHRcdFx0aWYgKCFwcm9wKSB7XHJcblx0XHRcdFx0ZmFpbCgkZm9ybWF0KFwiUGF0aCAnezB9JyByZWZlcmVuY2VzIGFuIHVua25vd24gcHJvcGVydHk6IHsxfS57Mn0uXCIsIFtwYXRoVG9rZW5zLmV4cHJlc3Npb24sIHR5cGUuZ2V0X2Z1bGxOYW1lKCksIHN0ZXAucHJvcGVydHldKSk7XHJcblxyXG5cdFx0XHRcdC8vIHJldHVybiBudWxsIGlmIHRoZSBwcm9wZXJ0eSBkb2VzIG5vdCBleGlzdFxyXG5cdFx0XHRcdHJldHVybiBudWxsO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBlbnN1cmUgdGhlIHByb3BlcnR5IGlzIG5vdCBzdGF0aWMgYmVjYXVzZSBwcm9wZXJ0eSBjaGFpbnMgYXJlIG5vdCB2YWxpZCBmb3Igc3RhdGljIHByb3BlcnRpZXNcclxuXHRcdFx0aWYgKHByb3AuZ2V0X2lzU3RhdGljKCkpIHtcclxuXHRcdFx0XHRmYWlsKCRmb3JtYXQoXCJQYXRoICd7MH0nIHJlZmVyZW5jZXMgYSBzdGF0aWMgcHJvcGVydHk6IHsxfS57Mn0uXCIsIFtwYXRoVG9rZW5zLmV4cHJlc3Npb24sIHR5cGUuZ2V0X2Z1bGxOYW1lKCksIHN0ZXAucHJvcGVydHldKSk7XHJcblxyXG5cdFx0XHRcdC8vIHJldHVybiBudWxsIHRvIGluZGljYXRlIHRoYXQgdGhlIHBhdGggcmVmZXJlbmNlcyBhIHN0YXRpYyBwcm9wZXJ0eVxyXG5cdFx0XHRcdHJldHVybiBudWxsO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBzdG9yZSB0aGUgcHJvcGVydHkgZm9yIHRoZSBzdGVwXHJcblx0XHRcdHByb3BlcnRpZXMucHVzaChwcm9wKTtcclxuXHJcblx0XHRcdC8vIGhhbmRsZSBvcHRpb25hbCB0eXBlIGZpbHRlcnNcclxuXHRcdFx0aWYgKHN0ZXAuY2FzdCkge1xyXG5cclxuXHRcdFx0XHQvLyBkZXRlcm1pbmUgdGhlIGZpbHRlciB0eXBlXHJcblx0XHRcdFx0dHlwZSA9IE1vZGVsLmdldEpzVHlwZShzdGVwLmNhc3QsIHRydWUpLm1ldGE7XHJcblx0XHRcdFx0aWYgKCF0eXBlKSB7XHJcblx0XHRcdFx0XHRmYWlsKCRmb3JtYXQoXCJQYXRoICd7MH0nIHJlZmVyZW5jZXMgYW4gaW52YWxpZCB0eXBlOiB7MX1cIiwgW3BhdGhUb2tlbnMuZXhwcmVzc2lvbiwgc3RlcC5jYXN0XSkpO1xyXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHR2YXIganN0eXBlID0gdHlwZS5nZXRfanN0eXBlKCk7XHJcblx0XHRcdFx0ZmlsdGVyVHlwZXNbcHJvcGVydGllcy5sZW5ndGhdID0ganN0eXBlO1xyXG5cdFx0XHRcdGZpbHRlcnNbcHJvcGVydGllcy5sZW5ndGhdID0gZnVuY3Rpb24gKHRhcmdldCkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIHRhcmdldCBpbnN0YW5jZW9mIGpzdHlwZTtcclxuXHRcdFx0XHR9O1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHR5cGUgPSBwcm9wLmdldF9qc3R5cGUoKS5tZXRhO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBwcm9jZXNzIHRoZSBuZXh0IHN0ZXAgaWYgbm90IGF0IHRoZSBlbmQgb2YgdGhlIHBhdGhcclxuXHRcdFx0aWYgKHBhdGhUb2tlbnMuc3RlcHMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdHJldHVybiBlbnN1cmVUeXBlKHR5cGUsIGZvcmNlTG9hZFR5cGVzLCBwcm9jZXNzU3RlcCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIG90aGVyd2lzZSwgY3JlYXRlIGFuZCByZXR1cm4gdGhlIG5ldyBwcm9wZXJ0eSBjaGFpblxyXG5cdFx0XHRlbHNlIHtcclxuXHJcblx0XHRcdFx0Ly8gcHJvY2Vzc2luZyB0aGUgcGF0aCBpcyBjb21wbGV0ZSwgdmVyaWZ5IHRoYXQgY2hhaW4gaXMgbm90IHplcm8tbGVuZ3RoXHJcblx0XHRcdFx0aWYgKHByb3BlcnRpZXMubGVuZ3RoID09PSAwKSB7XHJcblx0XHRcdFx0XHRmYWlsKCRmb3JtYXQoXCJQcm9wZXJ0eUNoYWluIGNhbm5vdCBiZSB6ZXJvLWxlbmd0aC5cIikpO1xyXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBlbnN1cmUgZmlsdGVyIHR5cGVzIG9uIHRoZSBsYXN0IHN0ZXAgYXJlIGxvYWRlZFxyXG5cdFx0XHRcdHZhciBmaWx0ZXJUeXBlU2lnbmFsID0gbmV3IFNpZ25hbChcImZpbHRlclR5cGVcIik7XHJcblx0XHRcdFx0dmFyIGZpbHRlclR5cGUgPSBmaWx0ZXJUeXBlc1twcm9wZXJ0aWVzLmxlbmd0aCAtIDFdO1xyXG5cdFx0XHRcdGlmIChmaWx0ZXJUeXBlKSB7XHJcblx0XHRcdFx0XHRlbnN1cmVUeXBlKGZpbHRlclR5cGUubWV0YSwgZm9yY2VMb2FkVHlwZXMsIGZpbHRlclR5cGVTaWduYWwucGVuZGluZyhudWxsLCBudWxsLCB0cnVlKSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHZhciByZXQ7XHJcblx0XHRcdFx0ZmlsdGVyVHlwZVNpZ25hbC53YWl0Rm9yQWxsKGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdC8vIGNyZWF0ZSBhbmQgY2FjaGUgdGhlIG5ldyBwcm9wZXJ0eSBjaGFpblxyXG5cdFx0XHRcdFx0dmFyIGNoYWluID0gbmV3IFByb3BlcnR5Q2hhaW4ocm9vdFR5cGUsIHByb3BlcnRpZXMsIGZpbHRlcnMpO1xyXG5cdFx0XHRcdFx0aWYgKCFyb290VHlwZS5fY2hhaW5zKSB7XHJcblx0XHRcdFx0XHRcdHJvb3RUeXBlLl9jaGFpbnMgPSB7fTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHJvb3RUeXBlLl9jaGFpbnNbcGF0aFRva2Vucy5leHByZXNzaW9uXSA9IGNoYWluO1xyXG5cclxuXHRcdFx0XHRcdC8vIGlmIGFzeW5jaHJvbm91cyBwcm9jZXNzaW5nIHdhcyBhbGxvd2VkLCBpbnZva2UgdGhlIHN1Y2Nlc3MgY2FsbGJhY2tcclxuXHRcdFx0XHRcdGlmIChzdWNjZXNzKSB7XHJcblx0XHRcdFx0XHRcdHN1Y2Nlc3MoY2hhaW4pO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdC8vIHJldHVybiB0aGUgbmV3IHByb3BlcnR5IGNoYWluXHJcblx0XHRcdFx0XHRyZXQgPSBjaGFpbjtcclxuXHRcdFx0XHR9LCBudWxsLCB0cnVlKTtcclxuXHRcdFx0XHRyZXR1cm4gcmV0O1xyXG5cdFx0XHR9XHJcblx0XHR9O1xyXG5cclxuXHRcdC8vIGJlZ2luIHByb2Nlc3Npbmcgc3RlcHMgaW4gdGhlIHBhdGhcclxuXHRcdHJldHVybiBlbnN1cmVUeXBlKHR5cGUsIGZvcmNlTG9hZFR5cGVzLCBwcm9jZXNzU3RlcCk7XHJcblx0fVxyXG5cclxuXHRQcm9wZXJ0eUNoYWluLm1peGluKEZ1bmN0b3IuZXZlbnRpbmcpO1xyXG5cclxuXHRQcm9wZXJ0eUNoYWluLm1peGluKHtcclxuXHRcdGVxdWFsczogZnVuY3Rpb24gUHJvcGVydHlDaGFpbiRlcXVhbHMocHJvcCkge1xyXG5cdFx0XHRpZiAocHJvcCAhPT0gdW5kZWZpbmVkICYmIHByb3AgIT09IG51bGwpIHtcclxuXHRcdFx0XHRpZiAocHJvcCBpbnN0YW5jZW9mIFByb3BlcnR5KSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gcHJvcC5lcXVhbHModGhpcyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2UgaWYgKHByb3AgaW5zdGFuY2VvZiBQcm9wZXJ0eUNoYWluKSB7XHJcblx0XHRcdFx0XHRpZiAocHJvcC5fcHJvcGVydGllcy5sZW5ndGggIT09IHRoaXMuX3Byb3BlcnRpZXMubGVuZ3RoKSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX3Byb3BlcnRpZXMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHRcdFx0aWYgKCF0aGlzLl9wcm9wZXJ0aWVzW2ldLmVxdWFscyhwcm9wLl9wcm9wZXJ0aWVzW2ldKSkge1xyXG5cdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdGFsbDogZnVuY3Rpb24gUHJvcGVydHlDaGFpbiRhbGwoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9wcm9wZXJ0aWVzO1xyXG5cdFx0fSxcclxuXHRcdGFwcGVuZDogZnVuY3Rpb24gUHJvcGVydHlDaGFpbiRhcHBlbmQocHJvcCkge1xyXG5cdFx0XHRBcnJheS5hZGRSYW5nZSh0aGlzLl9wcm9wZXJ0aWVzLCBwcm9wLmFsbCgpKTtcclxuXHRcdH0sXHJcblx0XHRlYWNoOiBmdW5jdGlvbiBQcm9wZXJ0eUNoYWluJGVhY2gob2JqLCBjYWxsYmFjaywgdGhpc1B0ciwgcHJvcEZpbHRlciAvKiwgdGFyZ2V0LCBwLCBsYXN0UHJvcCovKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeT5cclxuXHRcdFx0Ly8vIEl0ZXJhdGVzIG92ZXIgYWxsIG9iamVjdHMgYWxvbmcgYSBwcm9wZXJ0eSBjaGFpbiBzdGFydGluZyB3aXRoIHRoZSByb290IG9iamVjdCAob2JqKS4gIFRoaXNcclxuXHRcdFx0Ly8vIGlzIGFuYWxvZ291cyB0byB0aGUgQXJyYXkgZm9yRWFjaCBmdW5jdGlvbi4gIFRoZSBjYWxsYmFjayBtYXkgcmV0dXJuIGEgQm9vbGVhbiB2YWx1ZSB0byBpbmRpY2F0ZSBcclxuXHRcdFx0Ly8vIHdoZXRoZXIgb3Igbm90IHRvIGNvbnRpbnVlIGl0ZXJhdGluZy5cclxuXHRcdFx0Ly8vIDwvc3VtbWFyeT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwib2JqXCIgdHlwZT1cIkV4b1dlYi5Nb2RlbC5FbnRpdHlcIj5cclxuXHRcdFx0Ly8vIFRoZSByb290IG9iamVjdCB0byB1c2UgaW4gaXRlcmF0aW5nIG92ZXIgdGhlIGNoYWluLlxyXG5cdFx0XHQvLy8gPC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwiY2FsbGJhY2tcIiB0eXBlPVwiRnVuY3Rpb25cIj5cclxuXHRcdFx0Ly8vIFRoZSBmdW5jdGlvbiB0byBpbnZva2UgYXQgZWFjaCBpdGVyYXRpb24gc3RlcC4gIE1heSByZXR1cm4gYSBCb29sZWFuIHZhbHVlIHRvIGluZGljYXRlIHdoZXRoZXIgXHJcblx0XHRcdC8vLyBvciBub3QgdG8gY29udGludWUgaXRlcmF0aW5nLlxyXG5cdFx0XHQvLy8gPC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwicHJvcEZpbHRlclwiIHR5cGU9XCJFeG9XZWIuTW9kZWwuUHJvcGVydHlcIiBvcHRpb25hbD1cInRydWVcIj5cclxuXHRcdFx0Ly8vIElmIHNwZWNpZmllZCwgb25seSBpdGVyYXRlcyBvdmVyIG9iamVjdHMgdGhhdCBhcmUgUkVUVVJORUQgYnkgdGhlIHByb3BlcnR5IGZpbHRlci4gIEluIG90aGVyXHJcblx0XHRcdC8vLyB3b3Jkcywgc3RlcHMgdGhhdCBjb3JyZXNwb25kIHRvIGEgdmFsdWUgb3IgdmFsdWVzIG9mIHRoZSBjaGFpbiBhdCBhIHNwZWNpZmljIHByb3BlcnR5IHN0ZXApLlxyXG5cdFx0XHQvLy8gRm9yIGV4YW1wbGUsIGlmIHRoZSBjaGFpbiBwYXRoIGlzIFwidGhpcy5Qcm9wQS5MaXN0UHJvcEJcIiwgdGhlbi4uLlxyXG5cdFx0XHQvLy8gICAgIGNoYWluLmVhY2godGFyZ2V0LCBjYWxsYmFjaywgbnVsbCwgTGlzdFByb3BCKTtcclxuXHRcdFx0Ly8vIC4uLndpbGwgaXRlcmF0ZSB0aGUgdmFsdWVzIG9mIHRoZSBsaXN0IHByb3BlcnR5IG9ubHkuXHJcblx0XHRcdC8vLyA8L3BhcmFtPlxyXG5cclxuXHRcdFx0aWYgKG9iaiA9PSBudWxsKSB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXJyb3IoXCJvYmpcIik7XHJcblx0XHRcdGlmIChjYWxsYmFjayA9PSBudWxsKSB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXJyb3IoXCJjYWxsYmFja1wiKTtcclxuXHRcdFx0aWYgKHR5cGVvZiAoY2FsbGJhY2spICE9IFwiZnVuY3Rpb25cIikgdGhyb3cgbmV3IEFyZ3VtZW50VHlwZUVycm9yKFwiY2FsbGJhY2tcIiwgXCJmdW5jdGlvblwiLCBjYWxsYmFjayk7XHJcblxyXG5cdFx0XHQvLyBpbnZva2UgY2FsbGJhY2sgb24gb2JqIGZpcnN0XHJcblx0XHRcdHZhciB0YXJnZXQgPSBhcmd1bWVudHNbNF0gfHwgb2JqO1xyXG5cdFx0XHR2YXIgbGFzdFByb3AgPSBhcmd1bWVudHNbNl0gfHwgbnVsbDtcclxuXHRcdFx0dmFyIHByb3BzID0gdGhpcy5fcHJvcGVydGllcy5zbGljZShhcmd1bWVudHNbNV0gfHwgMCk7XHJcblx0XHRcdGZvciAodmFyIHAgPSBhcmd1bWVudHNbNV0gfHwgMDsgcCA8IHRoaXMuX3Byb3BlcnRpZXMubGVuZ3RoOyBwKyspIHtcclxuXHRcdFx0XHR2YXIgcHJvcCA9IHRoaXMuX3Byb3BlcnRpZXNbcF07XHJcblx0XHRcdFx0dmFyIGlzTGFzdFByb3BlcnR5ID0gcCA9PT0gdGhpcy5fcHJvcGVydGllcy5sZW5ndGggLSAxO1xyXG5cdFx0XHRcdHZhciBjYW5Ta2lwUmVtYWluaW5nUHJvcHMgPSBpc0xhc3RQcm9wZXJ0eSB8fCAocHJvcEZpbHRlciAmJiBsYXN0UHJvcCA9PT0gcHJvcEZpbHRlcik7XHJcblx0XHRcdFx0dmFyIGVuYWJsZUNhbGxiYWNrID0gKCFwcm9wRmlsdGVyIHx8IGxhc3RQcm9wID09PSBwcm9wRmlsdGVyKTtcclxuXHJcblx0XHRcdFx0aWYgKHRhcmdldCBpbnN0YW5jZW9mIEFycmF5KSB7XHJcblx0XHRcdFx0XHQvLyBpZiB0aGUgdGFyZ2V0IGlzIGEgbGlzdCwgaW52b2tlIHRoZSBjYWxsYmFjayBvbmNlIHBlciBpdGVtIGluIHRoZSBsaXN0XHJcblx0XHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRhcmdldC5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRcdFx0XHQvLyB0YWtlIGludG8gYWNjb3VudCBhbnkgYW55IGNoYWluIGZpbHRlcnMgYWxvbmcgdGhlIHdheVxyXG5cdFx0XHRcdFx0XHRpZiAoIXRoaXMuX2ZpbHRlcnNbcF0gfHwgdGhpcy5fZmlsdGVyc1twXSh0YXJnZXRbaV0pKSB7XHJcblxyXG5cdFx0XHRcdFx0XHRcdGlmIChlbmFibGVDYWxsYmFjayAmJiBjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcywgdGFyZ2V0W2ldLCBpLCB0YXJnZXQsIHByb3AsIHAsIHByb3BzKSA9PT0gZmFsc2UpIHtcclxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRcdGlmICghY2FuU2tpcFJlbWFpbmluZ1Byb3BzKSB7XHJcblx0XHRcdFx0XHRcdFx0XHR2YXIgdGFyZ2V0VmFsdWUgPSBwcm9wLnZhbHVlKHRhcmdldFtpXSk7XHJcblx0XHRcdFx0XHRcdFx0XHQvLyBjb250aW51ZSBhbG9uZyB0aGUgY2hhaW4gZm9yIHRoaXMgbGlzdCBpdGVtXHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoIXRhcmdldFZhbHVlIHx8IHRoaXMuZWFjaChvYmosIGNhbGxiYWNrLCB0aGlzUHRyLCBwcm9wRmlsdGVyLCB0YXJnZXRWYWx1ZSwgcCArIDEsIHByb3ApID09PSBmYWxzZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHQvLyBzdWJzZXF1ZW50IHByb3BlcnRpZXMgYWxyZWFkeSB2aXNpdGVkIGluIHByZWNlZGluZyBsb29wXHJcblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHQvLyByZXR1cm4gZWFybHkgaWYgdGhlIHRhcmdldCBpcyBmaWx0ZXJlZCBhbmQgZG9lcyBub3QgbWF0Y2hcclxuXHRcdFx0XHRcdGlmICh0aGlzLl9maWx0ZXJzW3BdICYmIHRoaXMuX2ZpbHRlcnNbcF0odGFyZ2V0KSA9PT0gZmFsc2UpIHtcclxuXHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0Ly8gdGFrZSBpbnRvIGFjY291bnQgYW55IGNoYWluIGZpbHRlcnMgYWxvbmcgdGhlIHdheVxyXG5cdFx0XHRcdFx0aWYgKGVuYWJsZUNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzLCB0YXJnZXQsIC0xLCBudWxsLCBwcm9wLCBwLCBwcm9wcykgPT09IGZhbHNlKSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIGlmIGEgcHJvcGVydHkgZmlsdGVyIGlzIHVzZWQgYW5kIHdhcyBqdXN0IGV2YWx1YXRlZCwgc3RvcCBlYXJseVxyXG5cdFx0XHRcdGlmIChjYW5Ta2lwUmVtYWluaW5nUHJvcHMpIHtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gbW92ZSB0byBuZXh0IHByb3BlcnR5IGluIHRoZSBjaGFpblxyXG5cdFx0XHRcdHRhcmdldCA9IHRhcmdldFtwcm9wLl9maWVsZE5hbWVdO1xyXG5cclxuXHRcdFx0XHQvLyBicmVhayBlYXJseSBpZiB0aGUgdGFyZ2V0IGlzIHVuZGVmaW5lZFxyXG5cdFx0XHRcdGlmICh0YXJnZXQgPT09IHVuZGVmaW5lZCB8fCB0YXJnZXQgPT09IG51bGwpIHtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0bGFzdFByb3AgPSBwcm9wO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH0sXHJcblx0XHRnZXRfcGF0aDogZnVuY3Rpb24gUHJvcGVydHlDaGFpbiRnZXRfcGF0aCgpIHtcclxuXHRcdFx0aWYgKCF0aGlzLl9wYXRoKSB7XHJcblx0XHRcdFx0dGhpcy5fcGF0aCA9IHRoaXMuX2dldFBhdGhGcm9tSW5kZXgoMCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiB0aGlzLl9wYXRoO1xyXG5cdFx0fSxcclxuXHRcdF9nZXRQYXRoRnJvbUluZGV4OiBmdW5jdGlvbiBQcm9wZXJ0eUNoYWluJF9nZXRQYXRoRnJvbUluZGV4KHN0YXJ0SW5kZXgpIHtcclxuXHRcdFx0dmFyIHN0ZXBzID0gW107XHJcblx0XHRcdGlmICh0aGlzLl9wcm9wZXJ0aWVzW3N0YXJ0SW5kZXhdLmdldF9pc1N0YXRpYygpKSB7XHJcblx0XHRcdFx0c3RlcHMucHVzaCh0aGlzLl9wcm9wZXJ0aWVzW3N0YXJ0SW5kZXhdLmdldF9jb250YWluaW5nVHlwZSgpLmdldF9mdWxsTmFtZSgpKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIHByZXZpb3VzU3RlcFR5cGU7XHJcblx0XHRcdHRoaXMuX3Byb3BlcnRpZXMuc2xpY2Uoc3RhcnRJbmRleCkuZm9yRWFjaChmdW5jdGlvbiAocCwgaSkge1xyXG5cdFx0XHRcdGlmIChpICE9PSAwKSB7XHJcblx0XHRcdFx0XHRpZiAocC5nZXRfY29udGFpbmluZ1R5cGUoKSAhPT0gcHJldmlvdXNTdGVwVHlwZSAmJiBwLmdldF9jb250YWluaW5nVHlwZSgpLmlzU3ViY2xhc3NPZihwcmV2aW91c1N0ZXBUeXBlKSkge1xyXG5cdFx0XHRcdFx0XHRzdGVwc1tzdGVwcy5sZW5ndGggLSAxXSA9IHN0ZXBzW3N0ZXBzLmxlbmd0aCAtIDFdICsgXCI8XCIgKyBwLmdldF9jb250YWluaW5nVHlwZSgpLmdldF9mdWxsTmFtZSgpICsgXCI+XCI7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHN0ZXBzLnB1c2gocC5nZXRfbmFtZSgpKTtcclxuXHRcdFx0XHRwcmV2aW91c1N0ZXBUeXBlID0gcC5nZXRfanN0eXBlKCkubWV0YTtcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gc3RlcHMuam9pbihcIi5cIik7XHJcblx0XHR9LFxyXG5cdFx0Zmlyc3RQcm9wZXJ0eTogZnVuY3Rpb24gUHJvcGVydHlDaGFpbiRmaXJzdFByb3BlcnR5KCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fcHJvcGVydGllc1swXTtcclxuXHRcdH0sXHJcblx0XHRsYXN0UHJvcGVydHk6IGZ1bmN0aW9uIFByb3BlcnR5Q2hhaW4kbGFzdFByb3BlcnR5KCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fcHJvcGVydGllc1t0aGlzLl9wcm9wZXJ0aWVzLmxlbmd0aCAtIDFdO1xyXG5cdFx0fSxcclxuXHRcdHByb3BlcnRpZXM6IGZ1bmN0aW9uIFByb3BlcnR5Q2hhaW4kcHJvcGVydGllcygpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX3Byb3BlcnRpZXMuc2xpY2UoKTtcclxuXHRcdH0sXHJcblx0XHRsYXN0VGFyZ2V0OiBmdW5jdGlvbiBQcm9wZXJ0eUNoYWluJGxhc3RUYXJnZXQob2JqKSB7XHJcblx0XHRcdGZvciAodmFyIHAgPSAwOyBwIDwgdGhpcy5fcHJvcGVydGllcy5sZW5ndGggLSAxOyBwKyspIHtcclxuXHRcdFx0XHR2YXIgcHJvcCA9IHRoaXMuX3Byb3BlcnRpZXNbcF07XHJcblxyXG5cdFx0XHRcdC8vIGV4aXQgZWFybHkgb24gbnVsbCBvciB1bmRlZmluZWRcclxuXHRcdFx0XHRpZiAob2JqID09PSB1bmRlZmluZWQgfHwgb2JqID09PSBudWxsKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gb2JqO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0b2JqID0gcHJvcC52YWx1ZShvYmopO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiBvYmo7XHJcblx0XHR9LFxyXG5cclxuXHRcdHByZXBlbmQ6IGZ1bmN0aW9uIFByb3BlcnR5Q2hhaW4kcHJlcGVuZChvdGhlcikge1xyXG5cdFx0XHR2YXIgcHJvcHMgPSBvdGhlciBpbnN0YW5jZW9mIFByb3BlcnR5Q2hhaW4gPyBvdGhlci5hbGwoKSA6IFtvdGhlcl07XHJcblxyXG5cdFx0XHR0aGlzLl9yb290VHlwZSA9IG90aGVyLmdldF9jb250YWluaW5nVHlwZSgpO1xyXG5cdFx0XHRBcnJheS5wcm90b3R5cGUuc3BsaWNlLmFwcGx5KHRoaXMuX3Byb3BlcnRpZXMsIFswLCAwXS5jb25jYXQocHJvcHMpKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Y2FuU2V0VmFsdWU6IGZ1bmN0aW9uIFByb3BlcnR5Q2hhaW4kY2FuU2V0VmFsdWUob2JqLCB2YWx1ZSkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5sYXN0UHJvcGVydHkoKS5jYW5TZXRWYWx1ZSh0aGlzLmxhc3RUYXJnZXQob2JqKSwgdmFsdWUpO1xyXG5cdFx0fSxcclxuXHJcblx0XHQvLyBEZXRlcm1pbmVzIGlmIHRoaXMgcHJvcGVydHkgY2hhaW4gY29ubmVjdHMgdHdvIG9iamVjdHMuXHJcblx0XHRjb25uZWN0czogZnVuY3Rpb24gUHJvcGVydHlDaGFpbiRjb25uZWN0cyhmcm9tUm9vdCwgdG9PYmosIHZpYVByb3BlcnR5KSB7XHJcblx0XHRcdHZhciBjb25uZWN0ZWQgPSBmYWxzZTtcclxuXHJcblx0XHRcdC8vIHBlcmZvcm0gc2ltcGxlIGNvbXBhcmlzb24gaWYgbm8gcHJvcGVydHkgaXMgZGVmaW5lZFxyXG5cdFx0XHRpZiAoIXZpYVByb3BlcnR5KSB7XHJcblx0XHRcdFx0cmV0dXJuIGZyb21Sb290ID09PSB0b09iajtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dGhpcy5lYWNoKGZyb21Sb290LCBmdW5jdGlvbiAodGFyZ2V0KSB7XHJcblx0XHRcdFx0aWYgKHRhcmdldCA9PT0gdG9PYmopIHtcclxuXHRcdFx0XHRcdGNvbm5lY3RlZCA9IHRydWU7XHJcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9LCB0aGlzLCB2aWFQcm9wZXJ0eSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gY29ubmVjdGVkO1xyXG5cdFx0fSxcclxuXHRcdHJvb3RlZFBhdGg6IGZ1bmN0aW9uIFByb3BlcnR5Q2hhaW4kcm9vdGVkUGF0aChyb290VHlwZSkge1xyXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX3Byb3BlcnRpZXMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHRpZiAodGhpcy5fcHJvcGVydGllc1tpXS5pc0RlZmluZWRCeShyb290VHlwZSkpIHtcclxuXHRcdFx0XHRcdHZhciBwYXRoID0gdGhpcy5fZ2V0UGF0aEZyb21JbmRleChpKTtcclxuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9wcm9wZXJ0aWVzW2ldLl9pc1N0YXRpYyA/IHRoaXMuX3Byb3BlcnRpZXNbaV0uZ2V0X2NvbnRhaW5pbmdUeXBlKCkuZ2V0X2Z1bGxOYW1lKCkgKyBcIi5cIiArIHBhdGggOiBwYXRoO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdC8vIHN0YXJ0cyBsaXN0ZW5pbmcgZm9yIHRoZSBnZXQgZXZlbnQgb2YgdGhlIGxhc3QgcHJvcGVydHkgaW4gdGhlIGNoYWluIG9uIGFueSBrbm93biBpbnN0YW5jZXMuIFVzZSBvYmogYXJndW1lbnQgdG9cclxuXHRcdC8vIG9wdGlvbmFsbHkgZmlsdGVyIHRoZSBldmVudHMgdG8gYSBzcGVjaWZpYyBvYmplY3RcclxuXHRcdGFkZEdldDogZnVuY3Rpb24gUHJvcGVydHlDaGFpbiRhZGRHZXQoaGFuZGxlciwgb2JqKSB7XHJcblx0XHRcdHZhciBjaGFpbiA9IHRoaXM7XHJcblxyXG5cdFx0XHR0aGlzLmxhc3RQcm9wZXJ0eSgpLmFkZEdldChmdW5jdGlvbiBQcm9wZXJ0eUNoYWluJF9yYWlzZUdldChzZW5kZXIsIHByb3BlcnR5LCB2YWx1ZSwgaXNJbml0ZWQpIHtcclxuXHRcdFx0XHRoYW5kbGVyKHNlbmRlciwgY2hhaW4sIHZhbHVlLCBpc0luaXRlZCk7XHJcblx0XHRcdH0sIG9iaik7XHJcblxyXG5cdFx0XHQvLyBSZXR1cm4gdGhlIHByb3BlcnR5IHRvIHN1cHBvcnQgbWV0aG9kIGNoYWluaW5nXHJcblx0XHRcdHJldHVybiB0aGlzO1xyXG5cdFx0fSxcclxuXHRcdHJlbW92ZUNoYW5nZWQ6IGZ1bmN0aW9uIFByb3BlcnR5Q2hhaW4kcmVtb3ZlQ2hhbmdlZChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUV2ZW50KFwiY2hhbmdlZFwiLCBoYW5kbGVyKTtcclxuXHJcblx0XHRcdHRoaXMuX3VwZGF0ZVByb3BlcnR5Q2hhbmdlU3Vic2NyaXB0aW9ucygpO1xyXG5cdFx0fSxcclxuXHRcdC8vIHN0YXJ0cyBsaXN0ZW5pbmcgZm9yIGNoYW5nZSBldmVudHMgYWxvbmcgdGhlIHByb3BlcnR5IGNoYWluIG9uIGFueSBrbm93biBpbnN0YW5jZXMuIFVzZSBvYmogYXJndW1lbnQgdG9cclxuXHRcdC8vIG9wdGlvbmFsbHkgZmlsdGVyIHRoZSBldmVudHMgdG8gYSBzcGVjaWZpYyBvYmplY3RcclxuXHRcdGFkZENoYW5nZWQ6IGZ1bmN0aW9uIFByb3BlcnR5Q2hhaW4kYWRkQ2hhbmdlZChoYW5kbGVyLCBvYmosIG9uY2UsIHRvbGVyYXRlUGFydGlhbCkge1xyXG5cdFx0XHR2YXIgZmlsdGVyID0gbWVyZ2VGdW5jdGlvbnMoXHJcblxyXG5cdFx0XHRcdC8vIE9ubHkgcmFpc2UgZm9yIHRoZSBnaXZlbiByb290IG9iamVjdCBpZiBzcGVjaWZpZWRcclxuXHRcdFx0XHRvYmogPyBlcXVhbHMob2JqKSA6IG51bGwsXHJcblxyXG5cdFx0XHRcdHRvbGVyYXRlUGFydGlhbFxyXG5cdFx0XHRcdFx0Ly8gRW5zdXJlIHRoYXQgdGhlIGNoYWluIGNhbiBiZSBhY2Nlc3NlZCB3aXRob3V0IGVycm9yIGlmIHRvbGVyYXRlUGFydGlhbCBpcyB0cnVlXHJcblx0XHRcdFx0XHQ/IChmdW5jdGlvbiAoc2VuZGVyLCBhcmdzKSB7XHJcblx0XHRcdFx0XHRcdHZhciBhbGxDYW5CZUFjY2Vzc2VkID0gdHJ1ZTtcclxuXHRcdFx0XHRcdFx0dGhpcy5lYWNoKHNlbmRlciwgZnVuY3Rpb24gKHRhcmdldCwgdGFyZ2V0SW5kZXgsIHRhcmdldEFycmF5LCBwcm9wZXJ0eSwgcHJvcGVydHlJbmRleCwgcHJvcGVydGllcykge1xyXG5cdFx0XHRcdFx0XHRcdGlmICghcHJvcGVydHkuaXNJbml0ZWQodGFyZ2V0KSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0dmFyIHByb3BlcnR5R2V0V291bGRDYXVzZUVycm9yID0gZmFsc2U7XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoTGF6eUxvYWRlci5pc1JlZ2lzdGVyZWQodGFyZ2V0KSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRwcm9wZXJ0eUdldFdvdWxkQ2F1c2VFcnJvciA9IHRydWU7XHJcblx0XHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHByb3BlcnR5LmdldF9pc0xpc3QoKSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR2YXIgbGlzdCA9IHRhcmdldFtwcm9wZXJ0eS5fZmllbGROYW1lXTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKGxpc3QgJiYgTGF6eUxvYWRlci5pc1JlZ2lzdGVyZWQobGlzdCkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRwcm9wZXJ0eUdldFdvdWxkQ2F1c2VFcnJvciA9IHRydWU7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0XHRpZiAocHJvcGVydHlHZXRXb3VsZENhdXNlRXJyb3IpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0YWxsQ2FuQmVBY2Nlc3NlZCA9IGZhbHNlO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gRXhpdCBpbW1lZGlhdGVseVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIGFsbENhbkJlQWNjZXNzZWQ7XHJcblx0XHRcdFx0XHR9LmJpbmQodGhpcykpXHJcblxyXG5cdFx0XHRcdFx0Ly8gRW5zdXJlIHRoYXQgdGhlIGNoYWluIGlzIGluaXRlZCBmcm9tIHRoZSByb290IGlmIHRvbGVyYXRlUGFydGlhbCBpcyBmYWxzZVxyXG5cdFx0XHRcdFx0OiB0aGlzLmlzSW5pdGVkLmJpbmQodGhpcykuc3BsaWNlQXJndW1lbnRzKDEsIDEsIHRydWUpLFxyXG5cclxuXHRcdFx0XHR7XHJcblx0XHRcdFx0XHQvLyBCb3RoIGZpbHRlcnMgbXVzdCBwYXNzXHJcblx0XHRcdFx0XHRhbmRSZXN1bHRzOiB0cnVlXHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0KTtcclxuXHJcblx0XHRcdHRoaXMuX2FkZEV2ZW50KFwiY2hhbmdlZFwiLCBoYW5kbGVyLCBmaWx0ZXIsIG9uY2UpO1xyXG5cclxuXHRcdFx0dGhpcy5fdXBkYXRlUHJvcGVydHlDaGFuZ2VTdWJzY3JpcHRpb25zKCk7XHJcblxyXG5cdFx0XHQvLyBSZXR1cm4gdGhlIHByb3BlcnR5IGNoYWluIHRvIHN1cHBvcnQgbWV0aG9kIGNoYWluaW5nXHJcblx0XHRcdHJldHVybiB0aGlzO1xyXG5cdFx0fSxcclxuXHRcdC8vIFByb3BlcnR5IHBhc3MtdGhyb3VnaCBtZXRob2RzXHJcblx0XHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cdFx0Z2V0X2NvbnRhaW5pbmdUeXBlOiBmdW5jdGlvbiBQcm9wZXJ0eUNoYWluJGdldF9jb250YWluaW5nVHlwZSgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX3Jvb3RUeXBlO1xyXG5cdFx0fSxcclxuXHRcdGdldF9qc3R5cGU6IGZ1bmN0aW9uIFByb3BlcnR5Q2hhaW4kZ2V0X2pzdHlwZSgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMubGFzdFByb3BlcnR5KCkuZ2V0X2pzdHlwZSgpO1xyXG5cdFx0fSxcclxuXHRcdGdldF9mb3JtYXQ6IGZ1bmN0aW9uIFByb3BlcnR5Q2hhaW4kZ2V0X2Zvcm1hdCgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMubGFzdFByb3BlcnR5KCkuZ2V0X2Zvcm1hdCgpO1xyXG5cdFx0fSxcclxuXHRcdGZvcm1hdDogZnVuY3Rpb24gUHJvcGVydHlDaGFpbiRmb3JtYXQodmFsKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLmxhc3RQcm9wZXJ0eSgpLmZvcm1hdCh2YWwpO1xyXG5cdFx0fSxcclxuXHRcdGdldF9pc0xpc3Q6IGZ1bmN0aW9uIFByb3BlcnR5Q2hhaW4kZ2V0X2lzTGlzdCgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMubGFzdFByb3BlcnR5KCkuZ2V0X2lzTGlzdCgpO1xyXG5cdFx0fSxcclxuXHRcdGdldF9pc1N0YXRpYzogZnVuY3Rpb24gUHJvcGVydHlDaGFpbiRnZXRfaXNTdGF0aWMoKSB7XHJcblx0XHRcdC8vIFRPRE9cclxuXHRcdFx0cmV0dXJuIHRoaXMubGFzdFByb3BlcnR5KCkuZ2V0X2lzU3RhdGljKCk7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X2xhYmVsOiBmdW5jdGlvbiBQcm9wZXJ0eUNoYWluJGdldF9sYWJlbCgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMubGFzdFByb3BlcnR5KCkuZ2V0X2xhYmVsKCk7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X2hlbHB0ZXh0OiBmdW5jdGlvbiBQcm9wZXJ0eUNoYWluJGdldF9oZWxwdGV4dCgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMubGFzdFByb3BlcnR5KCkuZ2V0X2hlbHB0ZXh0KCk7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X25hbWU6IGZ1bmN0aW9uIFByb3BlcnR5Q2hhaW4kZ2V0X25hbWUoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLmxhc3RQcm9wZXJ0eSgpLmdldF9uYW1lKCk7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X2lzVmFsdWVUeXBlOiBmdW5jdGlvbiBQcm9wZXJ0eUNoYWluJGdldF9pc1ZhbHVlVHlwZSgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMubGFzdFByb3BlcnR5KCkuZ2V0X2lzVmFsdWVUeXBlKCk7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X2lzRW50aXR5VHlwZTogZnVuY3Rpb24gUHJvcGVydHlDaGFpbiRnZXRfaXNFbnRpdHlUeXBlKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5sYXN0UHJvcGVydHkoKS5nZXRfaXNFbnRpdHlUeXBlKCk7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X2lzRW50aXR5TGlzdFR5cGU6IGZ1bmN0aW9uIFByb3BlcnR5Q2hhaW4kZ2V0X2lzRW50aXR5TGlzdFR5cGUoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLmxhc3RQcm9wZXJ0eSgpLmdldF9pc0VudGl0eUxpc3RUeXBlKCk7XHJcblx0XHR9LFxyXG5cdFx0cnVsZXM6IGZ1bmN0aW9uIChmaWx0ZXIpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMubGFzdFByb3BlcnR5KCkucnVsZXMoZmlsdGVyKTtcclxuXHRcdH0sXHJcblx0XHR2YWx1ZTogZnVuY3Rpb24gUHJvcGVydHlDaGFpbiR2YWx1ZShvYmosIHZhbCwgY3VzdG9tSW5mbykge1xyXG5cdFx0XHR2YXIgdGFyZ2V0ID0gdGhpcy5sYXN0VGFyZ2V0KG9iaiwgdHJ1ZSk7XHJcblx0XHRcdHZhciBwcm9wID0gdGhpcy5sYXN0UHJvcGVydHkoKTtcclxuXHJcblx0XHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkge1xyXG5cdFx0XHRcdHByb3AudmFsdWUodGFyZ2V0LCB2YWwsIGN1c3RvbUluZm8pO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHJldHVybiB0YXJnZXQgPyBwcm9wLnZhbHVlKHRhcmdldCkgOiB0YXJnZXQ7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRpc0luaXRlZDogZnVuY3Rpb24gUHJvcGVydHlDaGFpbiRpc0luaXRlZChvYmosIGVuZm9yY2VDb21wbGV0ZW5lc3MgLyosIGZyb21JbmRleCwgZnJvbVByb3AqLykge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnk+XHJcblx0XHRcdC8vLyBEZXRlcm1pbmVzIGlmIHRoZSBwcm9wZXJ0eSBjaGFpbiBpcyBpbml0aWFsaXplZCwgYWtpbiB0byBzaW5nbGUgUHJvcGVydHkgaW5pdGlhbGl6YXRpb24uXHJcblx0XHRcdC8vLyA8L3N1bW1hcnk+XHJcblx0XHRcdHZhciBhbGxJbml0ZWQgPSB0cnVlLCBpbml0ZWRQcm9wZXJ0aWVzID0gW10sIGZyb21JbmRleCA9IGFyZ3VtZW50c1syXSB8fCAwLCBmcm9tUHJvcCA9IGFyZ3VtZW50c1szXSB8fCBudWxsLCBleHBlY3RlZFByb3BzID0gdGhpcy5fcHJvcGVydGllcy5sZW5ndGggLSBmcm9tSW5kZXg7XHJcblxyXG5cdFx0XHR0aGlzLmVhY2gob2JqLCBmdW5jdGlvbih0YXJnZXQsIHRhcmdldEluZGV4LCB0YXJnZXRBcnJheSwgcHJvcGVydHksIHByb3BlcnR5SW5kZXgsIHByb3BlcnRpZXMpIHtcclxuXHRcdFx0XHRpZiAodGFyZ2V0QXJyYXkgJiYgZW5mb3JjZUNvbXBsZXRlbmVzcykge1xyXG5cdFx0XHRcdFx0aWYgKHRhcmdldEFycmF5LmV2ZXJ5KGZ1bmN0aW9uKGl0ZW0pIHsgcmV0dXJuIHRoaXMuaXNJbml0ZWQoaXRlbSwgdHJ1ZSwgcHJvcGVydHlJbmRleCwgcHJvcGVydGllc1twcm9wZXJ0eUluZGV4IC0gMV0pOyB9LCB0aGlzKSkge1xyXG5cdFx0XHRcdFx0XHRBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShpbml0ZWRQcm9wZXJ0aWVzLCBwcm9wZXJ0aWVzLnNsaWNlKHByb3BlcnR5SW5kZXgpKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRhbGxJbml0ZWQgPSBmYWxzZTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyBTdG9wIGl0ZXJhdGluZyBhdCBhbiBhcnJheSB2YWx1ZVxyXG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdGlmICghdGFyZ2V0QXJyYXkgfHwgdGFyZ2V0SW5kZXggPT09IDApIHtcclxuXHRcdFx0XHRcdFx0aW5pdGVkUHJvcGVydGllcy5wdXNoKHByb3BlcnR5KTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGlmICghcHJvcGVydHkuaXNJbml0ZWQodGFyZ2V0KSkge1xyXG5cdFx0XHRcdFx0XHRpbml0ZWRQcm9wZXJ0aWVzLnJlbW92ZShwcm9wZXJ0eSk7XHJcblx0XHRcdFx0XHRcdGFsbEluaXRlZCA9IGZhbHNlO1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gRXhpdCBpbW1lZGlhdGVseSBzaW5jZSBjaGFpbiBpcyBub3QgaW5pdGVkXHJcblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH0sIHRoaXMsIG51bGwsIG9iaiwgZnJvbUluZGV4LCBmcm9tUHJvcCk7XHJcblxyXG5cdFx0XHRyZXR1cm4gYWxsSW5pdGVkICYmICghZW5mb3JjZUNvbXBsZXRlbmVzcyB8fCBpbml0ZWRQcm9wZXJ0aWVzLmxlbmd0aCA9PT0gZXhwZWN0ZWRQcm9wcyk7XHJcblx0XHR9LFxyXG5cdFx0dG9TdHJpbmc6IGZ1bmN0aW9uIFByb3BlcnR5Q2hhaW4kdG9TdHJpbmcoKSB7XHJcblx0XHRcdGlmICh0aGlzLl9pc1N0YXRpYykge1xyXG5cdFx0XHRcdHJldHVybiB0aGlzLmdldF9wYXRoKCk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dmFyIHBhdGggPSB0aGlzLl9wcm9wZXJ0aWVzLm1hcChmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5nZXRfbmFtZSgpOyB9KS5qb2luKFwiLlwiKTtcclxuXHRcdFx0XHRyZXR1cm4gJGZvcm1hdChcInRoaXM8ezB9Pi57MX1cIiwgW3RoaXMuZ2V0X2NvbnRhaW5pbmdUeXBlKCksIHBhdGhdKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHRFeG9XZWIuTW9kZWwuUHJvcGVydHlDaGFpbiA9IFByb3BlcnR5Q2hhaW47XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuTW9kZWwuT2JqZWN0TWV0YVxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIE9iamVjdE1ldGEodHlwZSwgb2JqKSB7XHJcblx0XHR0aGlzLl9vYmogPSBvYmo7XHJcblx0XHR0aGlzLnR5cGUgPSB0eXBlO1xyXG5cdFx0dGhpcy5fY29uZGl0aW9ucyA9IHt9O1xyXG5cdFx0dGhpcy5fcGVuZGluZ0luaXQgPSB7fTtcclxuXHRcdHRoaXMuX3BlbmRpbmdJbnZvY2F0aW9uID0gW107XHJcblx0fVxyXG5cclxuXHRPYmplY3RNZXRhLm1peGluKHtcclxuXHJcblx0XHRnZXRfZW50aXR5OiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9vYmo7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIGdldHMgdGhlIHByb3BlcnR5IG9yIHByb3BlcnR5IGNoYWluIGZvciB0aGUgc3BlY2lmaWVkIHByb3BlcnR5IHBhdGhcclxuXHRcdHByb3BlcnR5OiBmdW5jdGlvbiBPYmplY3RNZXRhJHByb3BlcnR5KHByb3BOYW1lLCB0aGlzT25seSkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy50eXBlLnByb3BlcnR5KHByb3BOYW1lLCB0aGlzT25seSk7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIGdldHMgYW5kIG9wdGlvbmFsbHkgc2V0cyB0aGUgcGVuZGluZyBpbml0aWFsaXphdGlvbiBzdGF0dXMgZm9yIGEgcHJvcGVydHkgb24gdGhlIGN1cnJlbnQgaW5zdGFuY2VcclxuXHRcdHBlbmRpbmdJbnZvY2F0aW9uOiBmdW5jdGlvbiBPYmplY3RNZXRhJHBlbmRpbmdJbnZvY2F0aW9uKHJ1bGUsIHZhbHVlKSB7XHJcblx0XHRcdHZhciBpbmRleE9mUnVsZSA9IHRoaXMuX3BlbmRpbmdJbnZvY2F0aW9uLmluZGV4T2YocnVsZSk7XHJcblx0XHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkge1xyXG5cdFx0XHRcdGlmICh2YWx1ZSAmJiBpbmRleE9mUnVsZSA8IDApIHtcclxuXHRcdFx0XHRcdHRoaXMuX3BlbmRpbmdJbnZvY2F0aW9uLnB1c2gocnVsZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2UgaWYgKCF2YWx1ZSAmJiBpbmRleE9mUnVsZSA+PSAwKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9wZW5kaW5nSW52b2NhdGlvbi5zcGxpY2UoaW5kZXhPZlJ1bGUsIDEpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gaW5kZXhPZlJ1bGUgPj0gMDtcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gZ2V0cyBhbmQgb3B0aW9uYWxseSBzZXRzIHRoZSBwZW5kaW5nIGluaXRpYWxpemF0aW9uIHN0YXR1cyBmb3IgYSBwcm9wZXJ0eSBvbiB0aGUgY3VycmVudCBpbnN0YW5jZVxyXG5cdFx0cGVuZGluZ0luaXQ6IGZ1bmN0aW9uIE9iamVjdE1ldGEkcGVuZGluZ0luaXQocHJvcCwgdmFsdWUpIHtcclxuXHRcdFx0dmFyIHJlc3VsdCA9IHRoaXMuX29ialtwcm9wLl9maWVsZE5hbWVdID09PSB1bmRlZmluZWQgfHwgdGhpcy5fcGVuZGluZ0luaXRbcHJvcC5nZXRfbmFtZSgpXSA9PT0gdHJ1ZTtcclxuXHRcdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7XHJcblx0XHRcdFx0aWYgKHZhbHVlKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9wZW5kaW5nSW5pdFtwcm9wLmdldF9uYW1lKCldID0gdHJ1ZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRkZWxldGUgdGhpcy5fcGVuZGluZ0luaXRbcHJvcC5nZXRfbmFtZSgpXTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gZ2V0cyB0aGUgY29uZGl0aW9uIHRhcmdldCB3aXRoIHRoZSBzcGVjaWZpZWQgY29uZGl0aW9uIHR5cGVcclxuXHRcdGdldENvbmRpdGlvbjogZnVuY3Rpb24gT2JqZWN0TWV0YSRnZXRDb25kaXRpb24oY29uZGl0aW9uVHlwZSkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fY29uZGl0aW9uc1tjb25kaXRpb25UeXBlLmNvZGVdO1xyXG5cdFx0fSxcclxuXHJcblx0XHQvLyBzdG9yZXMgdGhlIGNvbmRpdGlvbiB0YXJnZXQgZm9yIHRoZSBjdXJyZW50IGluc3RhbmNlXHJcblx0XHRzZXRDb25kaXRpb246IGZ1bmN0aW9uIE9iamVjdE1ldGEkc2V0Q29uZGl0aW9uKGNvbmRpdGlvblRhcmdldCkge1xyXG5cdFx0XHRpZiAoY29uZGl0aW9uVGFyZ2V0LmNvbmRpdGlvbi50eXBlICE9IGZvcm1hdENvbmRpdGlvblR5cGUpIHtcclxuXHRcdFx0XHR0aGlzLl9jb25kaXRpb25zW2NvbmRpdGlvblRhcmdldC5jb25kaXRpb24udHlwZS5jb2RlXSA9IGNvbmRpdGlvblRhcmdldDtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHQvLyBjbGVhcnMgdGhlIGNvbmRpdGlvbiBmb3IgdGhlIGN1cnJlbnQgaW5zdGFuY2Ugd2l0aCB0aGUgc3BlY2lmaWVkIGNvbmRpdGlvbiB0eXBlXHJcblx0XHRjbGVhckNvbmRpdGlvbjogZnVuY3Rpb24gT2JqZWN0TWV0YSRjbGVhckNvbmRpdGlvbihjb25kaXRpb25UeXBlKSB7XHJcblx0XHRcdGRlbGV0ZSB0aGlzLl9jb25kaXRpb25zW2NvbmRpdGlvblR5cGUuY29kZV07XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIGRldGVybWluZXMgaWYgdGhlIHNldCBvZiBwZXJtaXNzaW9ucyBhcmUgYWxsb3dlZCBmb3IgdGhlIGN1cnJlbnQgaW5zdGFuY2VcclxuXHRcdGlzQWxsb3dlZDogZnVuY3Rpb24gT2JqZWN0TWV0YSRpc0FsbG93ZWQoLypjb2RlcyovKSB7XHJcblx0XHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XHJcblx0XHRcdFx0cmV0dXJuIHVuZGVmaW5lZDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gZW5zdXJlIGVhY2ggY29uZGl0aW9uIHR5cGUgaXMgYWxsb3dlZCBmb3IgdGhlIGN1cnJlbnQgaW5zdGFuY2VcclxuXHRcdFx0Zm9yICh2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGggLSAxOyBjID49IDA7IGMtLSkge1xyXG5cdFx0XHRcdHZhciBjb2RlID0gYXJndW1lbnRzW2NdO1xyXG5cdFx0XHRcdHZhciBjb25kaXRpb25UeXBlID0gQ29uZGl0aW9uVHlwZS5nZXQoY29kZSk7XHJcblxyXG5cdFx0XHRcdC8vIHJldHVybiB1bmRlZmluZWQgaWYgdGhlIGNvbmRpdGlvbiB0eXBlIGRvZXMgbm90IGV4aXN0XHJcblx0XHRcdFx0aWYgKGNvbmRpdGlvblR5cGUgPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIHVuZGVmaW5lZDtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIHRocm93IGFuIGV4Y2VwdGlvbiBpZiB0aGUgY29uZGl0aW9uIHR5cGUgaXMgbm90IGEgcGVybWlzc2lvblxyXG5cdFx0XHRcdGlmICghKGNvbmRpdGlvblR5cGUgaW5zdGFuY2VvZiBDb25kaXRpb25UeXBlLlBlcm1pc3Npb24pKSB7XHJcblx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJDb25kaXRpb24gdHlwZSBcXFwiXCIgKyBjb2RlICsgXCJcXFwiIHNob3VsZCBiZSBhIFBlcm1pc3Npb24uXCIpO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gcmV0dXJuIGZhbHNlIGlmIGEgY29uZGl0aW9uIG9mIHRoZSBjdXJyZW50IHR5cGUgZXhpc3RzIGFuZCBpcyBhIGRlbnkgcGVybWlzc2lvbiBvciBkb2VzIG5vdCBleGlzdCBhbmQgaXMgYSBncmFudCBwZXJtaXNzaW9uXHJcblx0XHRcdFx0aWYgKHRoaXMuX2NvbmRpdGlvbnNbY29uZGl0aW9uVHlwZS5jb2RlXSA/ICFjb25kaXRpb25UeXBlLmlzQWxsb3dlZCA6IGNvbmRpdGlvblR5cGUuaXNBbGxvd2VkKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gZGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBpbnN0YW5jZSBhbmQgb3B0aW9uYWxseSB0aGUgc3BlY2lmaWVkIHByb3BlcnR5IHZhbHVlIGlzIGxvYWRlZFxyXG5cdFx0aXNMb2FkZWQ6IGZ1bmN0aW9uIE9iamVjdE1ldGEkaXNMb2FkZWQocHJvcCkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojRXhvV2ViLk1vZGVsLk9iamVjdE1ldGEuaXNMb2FkZWRcIj5cclxuXHRcdFx0Ly8vIENoZWNrIHdoZXRoZXIgdGhlIGluc3RhbmNlIGFuZCBvcHRpb25hbCBwcm9wZXJ0eSBhcmUgbG9hZGVkLlxyXG5cdFx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJwcm9wXCIgb3B0aW9uYWw9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiIHR5cGU9XCJPYmplY3RcIj5UaGUgb3B0aW9uYWwgcHJvcGVydHkgb2JqZWN0IG9yIHByb3BlcnR5IG5hbWUgdG8gY2hlY2suPC9wYXJhbT5cclxuXHJcblx0XHRcdC8vIEZpcnN0IHNlZSBpZiB0aGVyZSBpcyBhIGxhenkgbG9hZGVyIGF0dGFjaGVkIHRvIHRoZSBlbnRpdHkgKGFuZCBvcHRpb25hbCBwcm9wZXJ0eSkuXHJcblx0XHRcdGlmIChMYXp5TG9hZGVyLmlzUmVnaXN0ZXJlZCh0aGlzLl9vYmosIG51bGwsIHByb3ApKSB7XHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBJbW1lZGlhdGVseSByZXR1cm4gdHJ1ZSBpZiBhIHByb3BlcnR5IG5hbWUgd2FzIG5vdCBzcGVjaWZpZWRcclxuXHRcdFx0aWYgKHByb3ApIHtcclxuXHRcdFx0XHQvLyBDb2VyY2UgcHJvcGVydHkgbmFtZXMgaW50byBwcm9wZXJ0eSBpbnN0YW5jZXNcclxuXHRcdFx0XHRpZiAoaXNTdHJpbmcocHJvcCkpIHtcclxuXHRcdFx0XHRcdHZhciBuYW1lID0gcHJvcDtcclxuXHRcdFx0XHRcdHByb3AgPSB0aGlzLnByb3BlcnR5KHByb3AsIHRydWUpO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdFx0aWYgKCFwcm9wKSB7XHJcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBmaW5kIHByb3BlcnR5IFxcXCJcIiArIG5hbWUgKyBcIlxcXCIgb24gdHlwZSBcXFwiXCIgKyB0aGlzLnR5cGUuZ2V0X2Z1bGxOYW1lKCkgKyBcIlxcXCIuXCIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gT3RoZXJ3aXNlLCBnZXQgdGhlIHByb3BlcnR5IHZhbHVlIGFuZCBkZXRlcm1pbmUgd2hldGhlciB0aGVyZSBpcyBhXHJcblx0XHRcdFx0Ly8gbGF6eSBsb2FkZXIgYXR0YWNoZWQgdG8gdGhlIHByb3BlcnR5IHZhbHVlLCBlLmcuIGVudGl0eSBvciBsaXN0LlxyXG5cdFx0XHRcdHZhciB2YWwgPSBwcm9wLnZhbHVlKHRoaXMuX29iaik7XHJcblx0XHRcdFx0aWYgKHZhbCAhPT0gbnVsbCAmJiB2YWwgIT09IHVuZGVmaW5lZCAmJiBMYXp5TG9hZGVyLmlzUmVnaXN0ZXJlZCh2YWwpKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gZ2V0IHNvbWUgb3IgYWxsIG9mIHRoZSBjb25kaXRpb25cclxuXHRcdGNvbmRpdGlvbnM6IGZ1bmN0aW9uIE9iamVjdE1ldGEkY29uZGl0aW9ucyhjcml0ZXJpYSkge1xyXG5cclxuXHRcdFx0Ly8gY29uZGl0aW9uIHR5cGUgZmlsdGVyXHJcblx0XHRcdGlmIChjcml0ZXJpYSBpbnN0YW5jZW9mIENvbmRpdGlvblR5cGUpIHtcclxuXHRcdFx0XHR2YXIgY29uZGl0aW9uVGFyZ2V0ID0gdGhpcy5fY29uZGl0aW9uc1tjcml0ZXJpYS5jb2RlXTtcclxuXHRcdFx0XHRyZXR1cm4gY29uZGl0aW9uVGFyZ2V0ID8gW2NvbmRpdGlvblRhcmdldC5jb25kaXRpb25dIDogW107XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIHByb3BlcnR5IGZpbHRlclxyXG5cdFx0XHRpZiAoY3JpdGVyaWEgaW5zdGFuY2VvZiBQcm9wZXJ0eSB8fCBjcml0ZXJpYSBpbnN0YW5jZW9mIFByb3BlcnR5Q2hhaW4pIHtcclxuXHRcdFx0XHRjcml0ZXJpYSA9IGNyaXRlcmlhLmxhc3RQcm9wZXJ0eSgpO1xyXG5cdFx0XHRcdHZhciByZXN1bHQgPSBbXTtcclxuXHRcdFx0XHRmb3IgKHZhciB0eXBlIGluIHRoaXMuX2NvbmRpdGlvbnMpIHtcclxuXHRcdFx0XHRcdHZhciBjb25kaXRpb25UYXJnZXQgPSB0aGlzLl9jb25kaXRpb25zW3R5cGVdO1xyXG5cdFx0XHRcdFx0aWYgKGNvbmRpdGlvblRhcmdldC5wcm9wZXJ0aWVzLnNvbWUoZnVuY3Rpb24gKHApIHsgcmV0dXJuIHAuZXF1YWxzKGNyaXRlcmlhKTsgfSkpIHtcclxuXHRcdFx0XHRcdFx0cmVzdWx0LnB1c2goY29uZGl0aW9uVGFyZ2V0LmNvbmRpdGlvbik7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHJldHVybiByZXN1bHQ7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIG90aGVyd2lzZSwganVzdCByZXR1cm4gYWxsIGNvbmRpdGlvbnNcclxuXHRcdFx0dmFyIHJlc3VsdCA9IFtdO1xyXG5cdFx0XHRmb3IgKHZhciB0eXBlIGluIHRoaXMuX2NvbmRpdGlvbnMpIHtcclxuXHRcdFx0XHRyZXN1bHQucHVzaCh0aGlzLl9jb25kaXRpb25zW3R5cGVdLmNvbmRpdGlvbik7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdH0sXHJcblx0XHRkZXN0cm95OiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHRoaXMudHlwZS51bnJlZ2lzdGVyKHRoaXMuX29iaik7XHJcblx0XHR9LFxyXG5cdFx0Ly8gc3RhcnRzIGxpc3RlbmluZyBmb3IgY2hhbmdlIGV2ZW50cyBvbiB0aGUgY29uZGl0aW9ucyBhcnJheS4gVXNlIG9iaiBhcmd1bWVudCB0b1xyXG5cdFx0Ly8gb3B0aW9uYWxseSBmaWx0ZXIgdGhlIGV2ZW50cyB0byBhIHNwZWNpZmljIGNvbmRpdGlvbiB0eXBlIGJ5IHBhc3NpbmcgZWl0aGVyXHJcblx0XHQvLyB0aGUgY29uZGl0aW9uIHR5cGUgY29kZSBvciB0eXBlIGl0c2VsZi5cclxuXHRcdGFkZENvbmRpdGlvbnNDaGFuZ2VkOiBmdW5jdGlvbiBPYmplY3RNZXRhJGFkZENvbmRpdGlvbnNDaGFuZ2VkKGhhbmRsZXIsIGNyaXRlcmlhKSB7XHJcblx0XHRcdHZhciBmaWx0ZXI7XHJcblxyXG5cdFx0XHQvLyBjb25kaXRpb24gdHlwZSBmaWx0ZXJcclxuXHRcdFx0aWYgKGNyaXRlcmlhIGluc3RhbmNlb2YgQ29uZGl0aW9uVHlwZSkge1xyXG5cdFx0XHRcdGZpbHRlciA9IGZ1bmN0aW9uIChzZW5kZXIsIGFyZ3MpIHsgcmV0dXJuIGFyZ3MuY29uZGl0aW9uVGFyZ2V0LmNvbmRpdGlvbi50eXBlID09PSBjcml0ZXJpYTsgfTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gcHJvcGVydHkgZmlsdGVyXHJcblx0XHRcdGVsc2UgaWYgKGNyaXRlcmlhIGluc3RhbmNlb2YgUHJvcGVydHkgfHwgY3JpdGVyaWEgaW5zdGFuY2VvZiBQcm9wZXJ0eUNoYWluKSB7XHJcblx0XHRcdFx0Y3JpdGVyaWEgPSBjcml0ZXJpYS5sYXN0UHJvcGVydHkoKTtcclxuXHRcdFx0XHRmaWx0ZXIgPSBmdW5jdGlvbiAoc2VuZGVyLCBhcmdzKSB7IHJldHVybiBhcmdzLmNvbmRpdGlvblRhcmdldC5wcm9wZXJ0aWVzLmluZGV4T2YoY3JpdGVyaWEpID49IDA7IH07XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIHN1YnNjcmliZSB0byB0aGUgZXZlbnRcclxuXHRcdFx0dGhpcy5fYWRkRXZlbnQoXCJjb25kaXRpb25zQ2hhbmdlZFwiLCBoYW5kbGVyLCBmaWx0ZXIpO1xyXG5cclxuXHRcdFx0Ly8gUmV0dXJuIHRoZSBvYmplY3QgbWV0YSB0byBzdXBwb3J0IG1ldGhvZCBjaGFpbmluZ1xyXG5cdFx0XHRyZXR1cm4gdGhpcztcclxuXHRcdH0sXHJcblx0XHRyZW1vdmVDb25kaXRpb25zQ2hhbmdlZDogZnVuY3Rpb24gT2JqZWN0TWV0YSRyZW1vdmVDb25kaXRpb25zQ2hhbmdlZChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUV2ZW50KFwiY29uZGl0aW9uc0NoYW5nZWRcIiwgaGFuZGxlcik7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdE9iamVjdE1ldGEubWl4aW4oRnVuY3Rvci5ldmVudGluZyk7XHJcblx0RXhvV2ViLk1vZGVsLk9iamVjdE1ldGEgPSBPYmplY3RNZXRhO1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLk1vZGVsLlJ1bGVJbnZvY2F0aW9uVHlwZVxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdHZhciBSdWxlSW52b2NhdGlvblR5cGUgPSB7XHJcblxyXG5cdFx0Ly8vIDxzdW1tYXJ5PlxyXG5cdFx0Ly8vIE9jY3VycyB3aGVuIGFuIGV4aXN0aW5nIGluc3RhbmNlIGlzIGluaXRpYWxpemVkLlxyXG5cdFx0Ly8vIDwvc3VtbWFyeT5cclxuXHRcdEluaXRFeGlzdGluZzogMixcclxuXHJcblx0XHQvLy8gPHN1bW1hcnk+XHJcblx0XHQvLy8gT2NjdXJzIHdoZW4gYSBuZXcgaW5zdGFuY2UgaXMgaW5pdGlhbGl6ZWQuXHJcblx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cdFx0SW5pdE5ldzogNCxcclxuXHJcblx0XHQvLy8gPHN1bW1hcnk+XHJcblx0XHQvLy8gT2NjdXJzIHdoZW4gYSBwcm9wZXJ0eSB2YWx1ZSBpcyByZXRyaWV2ZWQuXHJcblx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cdFx0UHJvcGVydHlHZXQ6IDgsXHJcblxyXG5cdFx0Ly8vIDxzdW1tYXJ5PlxyXG5cdFx0Ly8vIE9jY3VycyB3aGVuIGEgcHJvcGVydHkgdmFsdWUgaXMgY2hhbmdlZC5cclxuXHRcdC8vLyA8L3N1bW1hcnk+XHJcblx0XHRQcm9wZXJ0eUNoYW5nZWQ6IDE2XHJcblx0fVxyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLk1vZGVsLlJ1bGVcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHR2YXIgY3VzdG9tUnVsZUluZGV4ID0gMDtcclxuXHJcblx0ZnVuY3Rpb24gUnVsZShyb290VHlwZSwgb3B0aW9ucykge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5PkNyZWF0ZXMgYSBydWxlIHRoYXQgZXhlY3V0ZXMgYSBkZWxlZ2F0ZSB3aGVuIHNwZWNpZmllZCBtb2RlbCBldmVudHMgb2NjdXIuPC9zdW1tYXJ5PlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwicm9vdFR5cGVcIiB0eXBlPVwiVHlwZVwiPlRoZSBtb2RlbCB0eXBlIHRoZSBydWxlIGlzIGZvci48L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwib3B0aW9uc1wiIHR5cGU9XCJPYmplY3RcIj5cclxuXHRcdC8vL1x0XHRUaGUgb3B0aW9ucyBmb3IgdGhlIHJ1bGUsIGluY2x1ZGluZzpcclxuXHRcdC8vL1x0XHRcdG5hbWU6XHRcdFx0XHR0aGUgb3B0aW9uYWwgdW5pcXVlIG5hbWUgb2YgdGhlIHR5cGUgb2YgdmFsaWRhdGlvbiBydWxlXHJcblx0XHQvLy9cdFx0XHRleGVjdXRlOlx0XHRcdGEgZnVuY3Rpb24gdG8gZXhlY3V0ZSB3aGVuIHRoZSBydWxlIGlzIHRyaWdnZXJlZFxyXG5cdFx0Ly8vXHRcdFx0b25Jbml0Olx0XHRcdFx0dHJ1ZSB0byBpbmRpY2F0ZSB0aGUgcnVsZSBzaG91bGQgcnVuIHdoZW4gYW4gaW5zdGFuY2Ugb2YgdGhlIHJvb3QgdHlwZSBpcyBpbml0aWFsaXplZCwgb3RoZXJ3aXNlIGZhbHNlXHJcblx0XHQvLy9cdFx0XHRvbkluaXROZXc6XHRcdFx0dHJ1ZSB0byBpbmRpY2F0ZSB0aGUgcnVsZSBzaG91bGQgcnVuIHdoZW4gYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIHJvb3QgdHlwZSBpcyBpbml0aWFsaXplZCwgb3RoZXJ3aXNlIGZhbHNlXHJcblx0XHQvLy9cdFx0XHRvbkluaXRFeGlzdGluZzpcdFx0dHJ1ZSB0byBpbmRpY2F0ZSB0aGUgcnVsZSBzaG91bGQgcnVuIHdoZW4gYW4gZXhpc3RpbmcgaW5zdGFuY2Ugb2YgdGhlIHJvb3QgdHlwZSBpcyBpbml0aWFsaXplZCwgb3RoZXJ3aXNlIGZhbHNlXHJcblx0XHQvLy9cdFx0XHRvbkNoYW5nZU9mOlx0XHRcdGFuIGFycmF5IG9mIHByb3BlcnR5IHBhdGhzIChzdHJpbmdzLCBQcm9wZXJ0eSBvciBQcm9wZXJ0eUNoYWluIGluc3RhbmNlcykgdGhhdCBkcml2ZSB3aGVuIHRoZSBydWxlIHNob3VsZCBleGVjdXRlIGR1ZSB0byBwcm9wZXJ0eSBjaGFuZ2VzXHJcblx0XHQvLy9cdFx0XHRyZXR1cm5zOlx0XHRcdGFuIGFycmF5IG9mIHByb3BlcnRpZXMgKHN0cmluZyBuYW1lIG9yIFByb3BlcnR5IGluc3RhbmNlKSB0aGF0IHRoZSBydWxlIGlzIHJlc3BvbnNpYmxlIHRvIGNhbGN1bGF0aW5nIHRoZSB2YWx1ZSBvZlxyXG5cdFx0Ly8vIDwvcGFyYW0+XHJcblx0XHQvLy8gPHJldHVybnMgdHlwZT1cIlJ1bGVcIj5UaGUgbmV3IHJ1bGUuPC9yZXR1cm5zPlxyXG5cclxuXHRcdC8vIGV4aXQgaW1tZWRpYXRlbHkgaWYgY2FsbGVkIHdpdGggbm8gYXJndW1lbnRzXHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gZW5zdXJlIGEgdmFsaWQgcm9vdCB0eXBlIHdhcyBwcm92aWRlZFxyXG5cdFx0aWYgKCEocm9vdFR5cGUgaW5zdGFuY2VvZiBFeG9XZWIuTW9kZWwuVHlwZSkpIHtcclxuXHRcdFx0aWYgKHJvb3RUeXBlICYmIHJvb3RUeXBlLm1ldGEpIHtcclxuXHRcdFx0XHRyb290VHlwZSA9IHJvb3RUeXBlLm1ldGE7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiQSB2YWx1ZSByb290IG1vZGVsIHR5cGUgbXVzdCBiZSBzcGVjaWZpZWQgd2hlbiBjb25zdHJ1Y3RpbmcgcnVsZXMuXCIpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gc3RvcmUgdGhlIGluaXRpYWxpemF0aW9uIG9wdGlvbnMgZm9yIHByb2Nlc3NpbmcgZHVyaW5nIHJlZ2lzdHJhdGlvblxyXG5cdFx0aWYgKG9wdGlvbnMpIHtcclxuXHRcdFx0aWYgKG9wdGlvbnMgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG5cdFx0XHRcdHRoaXMuX29wdGlvbnMgPSB7XHJcblx0XHRcdFx0XHRuYW1lOiByb290VHlwZS5nZXRfZnVsbE5hbWUoKSArIFwiLkN1c3RvbS5cIiArICgrK2N1c3RvbVJ1bGVJbmRleCksXHJcblx0XHRcdFx0XHRleGVjdXRlOiBmdW5jdGlvbiAob2JqKSB7XHJcblx0XHRcdFx0XHRcdC8vIHVzZSB0aGUgcm9vdCBvYmplY3QgYXMgdGhpc1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gb3B0aW9ucy5hcHBseShvYmosIGFyZ3VtZW50cyk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aGlzLl9vcHRpb25zID0gb3B0aW9ucztcclxuXHRcdFx0XHRpZiAoIXRoaXMuX29wdGlvbnMubmFtZSkge1xyXG5cdFx0XHRcdFx0dGhpcy5fb3B0aW9ucy5uYW1lID0gcm9vdFR5cGUuZ2V0X2Z1bGxOYW1lKCkgKyBcIi5DdXN0b20uXCIgKyAoKytjdXN0b21SdWxlSW5kZXgpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMuX29wdGlvbnMgPSB7XHJcblx0XHRcdFx0bmFtZTogcm9vdFR5cGUuZ2V0X2Z1bGxOYW1lKCkgKyBcIi5DdXN0b20uXCIgKyAoKytjdXN0b21SdWxlSW5kZXgpXHJcblx0XHRcdH07XHJcblx0XHR9XHJcblx0XHJcblx0XHQvLyBleHBsaWNpdGx5IG92ZXJyaWRlIGV4ZWN1dGUgaWYgc3BlY2lmaWVkXHJcblx0XHRpZiAodGhpcy5fb3B0aW9ucy5leGVjdXRlIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuXHRcdFx0dGhpcy5leGVjdXRlID0gdGhpcy5fb3B0aW9ucy5leGVjdXRlO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGRlZmluZSBwcm9wZXJ0aWVzIGZvciB0aGUgcnVsZVxyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwicm9vdFR5cGVcIiwgeyB2YWx1ZTogcm9vdFR5cGUgfSk7XHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJuYW1lXCIsIHsgdmFsdWU6IHRoaXMuX29wdGlvbnMubmFtZSB9KTtcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImludm9jYXRpb25UeXBlc1wiLCB7IHZhbHVlOiAwLCB3cml0YWJsZTogdHJ1ZSB9KTtcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInByZWRpY2F0ZXNcIiwgeyB2YWx1ZTogW10sIHdyaXRhYmxlOiB0cnVlIH0pO1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwicmV0dXJuVmFsdWVzXCIsIHsgdmFsdWU6IFtdLCB3cml0YWJsZTogdHJ1ZSB9KTtcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImlzUmVnaXN0ZXJlZFwiLCB7IHZhbHVlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUgfSk7XHJcblxyXG5cdFx0Ly8gcmVnaXN0ZXIgdGhlIHJ1bGUgYWZ0ZXIgbG9hZGluZyBoYXMgY29tcGxldGVkXHJcblx0XHRyb290VHlwZS5tb2RlbC5yZWdpc3RlclJ1bGUodGhpcyk7XHJcblx0fVxyXG5cclxuXHQvLyBiYXNlIHJ1bGUgaW1wbGVtZW50YXRpb25cclxuXHRSdWxlLm1peGluKHtcclxuXHJcblx0XHQvLyBpbmRpY2F0ZXMgdGhhdCB0aGUgcnVsZSBzaG91bGQgcnVuIG9ubHkgZm9yIG5ldyBpbnN0YW5jZXMgd2hlbiBpbml0aWFsaXplZFxyXG5cdFx0b25Jbml0TmV3OiBmdW5jdGlvbiAoKSB7XHJcblxyXG5cdFx0XHQvLyBlbnN1cmUgdGhlIHJ1bGUgaGFzIG5vdCBhbHJlYWR5IGJlZW4gcmVnaXN0ZXJlZFxyXG5cdFx0XHRpZiAoIXRoaXMuX29wdGlvbnMpIHtcclxuXHRcdFx0XHQvL3Rocm93IG5ldyBFcnJvcihcIlJ1bGVzIGNhbm5vdCBiZSBjb25maWd1cmVkIG9uY2UgdGhleSBoYXZlIGJlZW4gcmVnaXN0ZXJlZDogXCIgKyB0aGlzLm5hbWUpO1xyXG5cdFx0XHRcdHJldHVybiB0aGlzO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBjb25maWd1cmUgdGhlIHJ1bGUgdG8gcnVuIG9uIGluaXQgbmV3XHJcblx0XHRcdHRoaXMuaW52b2NhdGlvblR5cGVzIHw9IFJ1bGVJbnZvY2F0aW9uVHlwZS5Jbml0TmV3O1xyXG5cdFx0XHRyZXR1cm4gdGhpcztcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gaW5kaWNhdGVzIHRoYXQgdGhlIHJ1bGUgc2hvdWxkIHJ1biBvbmx5IGZvciBleGlzdGluZyBpbnN0YW5jZXMgd2hlbiBpbml0aWFsaXplZFxyXG5cdFx0b25Jbml0RXhpc3Rpbmc6IGZ1bmN0aW9uICgpIHtcclxuXHJcblx0XHRcdC8vIGVuc3VyZSB0aGUgcnVsZSBoYXMgbm90IGFscmVhZHkgYmVlbiByZWdpc3RlcmVkXHJcblx0XHRcdGlmICghdGhpcy5fb3B0aW9ucykge1xyXG5cdFx0XHRcdC8vdGhyb3cgbmV3IEVycm9yKFwiUnVsZXMgY2Fubm90IGJlIGNvbmZpZ3VyZWQgb25jZSB0aGV5IGhhdmUgYmVlbiByZWdpc3RlcmVkOiBcIiArIHRoaXMubmFtZSk7XHJcblx0XHRcdFx0cmV0dXJuIHRoaXM7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIGNvbmZpZ3VyZSB0aGUgcnVsZSB0byBydW4gb24gaW5pdCBleGlzdGluZ2hcclxuXHRcdFx0dGhpcy5pbnZvY2F0aW9uVHlwZXMgfD0gUnVsZUludm9jYXRpb25UeXBlLkluaXRFeGlzdGluZztcclxuXHRcdFx0cmV0dXJuIHRoaXM7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIGluZGljYXRlcyB0aGF0IHRoZSBydWxlIHNob3VsZCBydW4gZm9yIGJvdGggbmV3IGFuZCBleGlzdGluZyBpbnN0YW5jZXMgd2hlbiBpbml0aWFsaXplZFxyXG5cdFx0b25Jbml0OiBmdW5jdGlvbiAoKSB7XHJcblxyXG5cdFx0XHQvLyBlbnN1cmUgdGhlIHJ1bGUgaGFzIG5vdCBhbHJlYWR5IGJlZW4gcmVnaXN0ZXJlZFxyXG5cdFx0XHRpZiAoIXRoaXMuX29wdGlvbnMpIHtcclxuXHRcdFx0XHQvL3Rocm93IG5ldyBFcnJvcihcIlJ1bGVzIGNhbm5vdCBiZSBjb25maWd1cmVkIG9uY2UgdGhleSBoYXZlIGJlZW4gcmVnaXN0ZXJlZDogXCIgKyB0aGlzLm5hbWUpO1xyXG5cdFx0XHRcdHJldHVybiB0aGlzO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBjb25maWd1cmUgdGhlIHJ1bGUgdG8gcnVuIG9uIGJvdGggaW5pdCBuZXcgYW5kIGluaXQgZXhpc3RpbmdcclxuXHRcdFx0dGhpcy5pbnZvY2F0aW9uVHlwZXMgfD0gUnVsZUludm9jYXRpb25UeXBlLkluaXROZXcgfCBSdWxlSW52b2NhdGlvblR5cGUuSW5pdEV4aXN0aW5nO1xyXG5cdFx0XHRyZXR1cm4gdGhpcztcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gaW5kaWNhdGVzIHRoYXQgdGhlIHJ1bGUgc2hvdWxkIGF1dG9tYXRpY2FsbHkgcnVuIHdoZW4gb25lIG9mIHRoZSBzcGVjaWZpZWQgcHJvcGVydHkgcGF0aHMgY2hhbmdlc1xyXG5cdFx0Ly8gcHJlZGljYXRlczogIGFuIGFycmF5IG9mIHByb3BlcnR5IHBhdGhzIChzdHJpbmdzLCBQcm9wZXJ0eSBvciBQcm9wZXJ0eUNoYWluIGluc3RhbmNlcykgdGhhdCBkcml2ZSB3aGVuIHRoZSBydWxlIHNob3VsZCBleGVjdXRlIGR1ZSB0byBwcm9wZXJ0eSBjaGFuZ2VzXHJcblx0XHRvbkNoYW5nZU9mOiBmdW5jdGlvbiAocHJlZGljYXRlcykge1xyXG5cclxuXHRcdFx0Ly8gZW5zdXJlIHRoZSBydWxlIGhhcyBub3QgYWxyZWFkeSBiZWVuIHJlZ2lzdGVyZWRcclxuXHRcdFx0aWYgKCF0aGlzLl9vcHRpb25zKSB7XHJcblx0XHRcdFx0Ly90aHJvdyBuZXcgRXJyb3IoXCJSdWxlcyBjYW5ub3QgYmUgY29uZmlndXJlZCBvbmNlIHRoZXkgaGF2ZSBiZWVuIHJlZ2lzdGVyZWQ6IFwiICsgdGhpcy5uYW1lKTtcclxuXHRcdFx0XHRyZXR1cm4gdGhpcztcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gYWxsb3cgY2hhbmdlIG9mIHByZWRpY2F0ZXMgdG8gYmUgc3BlY2lmaWVkIGFzIGEgcGFyYW1ldGVyIGFycmF5IHdpdGhvdXQgW10nc1xyXG5cdFx0XHRpZiAocHJlZGljYXRlcyAmJiBwcmVkaWNhdGVzLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHtcclxuXHRcdFx0XHRwcmVkaWNhdGVzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gYWRkIHRvIHRoZSBzZXQgb2YgZXhpc3RpbmcgY2hhbmdlIHByZWRpY2F0ZXNcclxuXHRcdFx0dGhpcy5wcmVkaWNhdGVzID0gdGhpcy5wcmVkaWNhdGVzLmxlbmd0aCA+IDAgPyB0aGlzLnByZWRpY2F0ZXMuY29uY2F0KHByZWRpY2F0ZXMpIDogcHJlZGljYXRlcztcclxuXHJcblx0XHRcdC8vIGFsc28gY29uZmlndXJlIHRoZSBydWxlIHRvIHJ1biBvbiBwcm9wZXJ0eSBjaGFuZ2UgdW5sZXNzIGl0IGhhcyBhbHJlYWR5IGJlZW4gY29uZmlndXJlZCB0byBydW4gb24gcHJvcGVydHkgZ2V0XHJcblx0XHRcdGlmICgodGhpcy5pbnZvY2F0aW9uVHlwZXMgJiBSdWxlSW52b2NhdGlvblR5cGUuUHJvcGVydHlHZXQpID09PSAwKSB7XHJcblx0XHRcdFx0dGhpcy5pbnZvY2F0aW9uVHlwZXMgfD0gUnVsZUludm9jYXRpb25UeXBlLlByb3BlcnR5Q2hhbmdlZDtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gdGhpcztcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gaW5kaWNhdGVzIHRoYXQgdGhlIHJ1bGUgaXMgcmVzcG9uc2libGUgZm9yIGNhbGN1bGF0aW5nIGFuZCByZXR1cm5pbmcgdmFsdWVzIG9mIG9uZSBvciBtb3JlIHByb3BlcnRpZXMgb24gdGhlIHJvb3QgdHlwZVxyXG5cdFx0Ly8gcHJvcGVydGllczpcdGFuIGFycmF5IG9mIHByb3BlcnRpZXMgKHN0cmluZyBuYW1lIG9yIFByb3BlcnR5IGluc3RhbmNlKSB0aGF0IHRoZSBydWxlIGlzIHJlc3BvbnNpYmxlIHRvIGNhbGN1bGF0aW5nIHRoZSB2YWx1ZSBvZlxyXG5cdFx0cmV0dXJuczogZnVuY3Rpb24gKHByb3BlcnRpZXMpIHtcclxuXHRcdFx0aWYgKCF0aGlzLl9vcHRpb25zKSB7XHJcblx0XHRcdFx0Ly90aHJvdyBuZXcgRXJyb3IoXCJSdWxlcyBjYW5ub3QgYmUgY29uZmlndXJlZCBvbmNlIHRoZXkgaGF2ZSBiZWVuIHJlZ2lzdGVyZWQ6IFwiICsgdGhpcy5uYW1lKTtcclxuXHRcdFx0XHRyZXR1cm4gdGhpcztcclxuXHRcdFx0fVxyXG5cdFx0XHQvLyBhbGxvdyByZXR1cm4gcHJvcGVydGllcyB0byBiZSBzcGVjaWZpZWQgYXMgYSBwYXJhbWV0ZXIgYXJyYXkgd2l0aG91dCBbXSdzXHJcblx0XHRcdGlmIChwcm9wZXJ0aWVzICYmIHByb3BlcnRpZXMuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xyXG5cdFx0XHRcdHByb3BlcnRpZXMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICghcHJvcGVydGllcykge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIlJ1bGUgbXVzdCBzcGVjaWZ5IGF0IGxlYXN0IDEgcHJvcGVydHkgZm9yIHJldHVybnMuXCIpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBhZGQgdG8gdGhlIHNldCBvZiBleGlzdGluZyByZXR1cm4gdmFsdWUgcHJvcGVydGllc1xyXG5cdFx0XHR0aGlzLnJldHVyblZhbHVlcyA9IHRoaXMucmV0dXJuVmFsdWVzLmxlbmd0aCA+IDAgPyB0aGlzLnJldHVyblZhbHVlcy5jb25jYXQocHJvcGVydGllcykgOiBwcm9wZXJ0aWVzO1xyXG5cclxuXHRcdFx0Ly8gY29uZmlndXJlIHRoZSBydWxlIHRvIHJ1biBvbiBwcm9wZXJ0eSBnZXQgYW5kIG5vdCBvbiBwcm9wZXJ0eSBjaGFuZ2VcclxuXHRcdFx0dGhpcy5pbnZvY2F0aW9uVHlwZXMgfD0gUnVsZUludm9jYXRpb25UeXBlLlByb3BlcnR5R2V0O1xyXG5cdFx0XHR0aGlzLmludm9jYXRpb25UeXBlcyAmPSB+UnVsZUludm9jYXRpb25UeXBlLlByb3BlcnR5Q2hhbmdlZDtcclxuXHRcdFx0cmV0dXJuIHRoaXM7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIHJlZ2lzdGVycyB0aGUgcnVsZSBiYXNlZCBvbiB0aGUgY29uZmlndXJlZCBpbnZvY2F0aW9uIHR5cGVzLCBwcmVkaWNhdGVzLCBhbmQgcmV0dXJuIHZhbHVlc1xyXG5cdFx0cmVnaXN0ZXI6IGZ1bmN0aW9uIFJ1bGUkcmVnaXN0ZXIoKSB7XHJcblxyXG5cdFx0XHQvLyBjcmVhdGUgYSBzY29wZSB2YXJpYWJsZSB0byByZWZlcmVuY2UgdGhlIGN1cnJlbnQgcnVsZSB3aGVuIGNyZWF0aW5nIGV2ZW50IGhhbmRsZXJzXHJcblx0XHRcdHZhciBydWxlID0gdGhpcztcclxuXHJcblx0XHRcdC8vIHRyYWNrIHRoZSBydWxlIHdpdGggdGhlIHJvb3QgdHlwZVxyXG5cdFx0XHR0aGlzLnJvb3RUeXBlLnJ1bGVzLnB1c2godGhpcyk7XHJcblxyXG5cdFx0XHQvLyBjcmVhdGUgYSBmdW5jdGlvbiB0byBwcm9jZXNzIHRoZSBydWxlJ3Mgb3B0aW9uc1xyXG5cdFx0XHR2YXIgcHJvY2Vzc09wdGlvbnMgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0Ly8gY29uZmlndXJlIHRoZSBydWxlIGJhc2VkIG9uIGFueSBzcGVjaWZpZWQgb3B0aW9uc1xyXG5cdFx0XHRcdGlmICh0aGlzLl9vcHRpb25zKSB7XHJcblx0XHRcdFx0XHRpZiAodGhpcy5fb3B0aW9ucy5vbkluaXQpXHJcblx0XHRcdFx0XHRcdHRoaXMub25Jbml0KCk7XHJcblx0XHRcdFx0XHRpZiAodGhpcy5fb3B0aW9ucy5vbkluaXROZXcpXHJcblx0XHRcdFx0XHRcdHRoaXMub25Jbml0TmV3KCk7XHJcblx0XHRcdFx0XHRpZiAodGhpcy5fb3B0aW9ucy5vbkluaXRFeGlzdGluZylcclxuXHRcdFx0XHRcdFx0dGhpcy5vbkluaXRFeGlzdGluZygpO1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMuX29wdGlvbnMub25DaGFuZ2VPZilcclxuXHRcdFx0XHRcdFx0dGhpcy5vbkNoYW5nZU9mKHRoaXMuX29wdGlvbnMub25DaGFuZ2VPZik7XHJcblx0XHRcdFx0XHRpZiAodGhpcy5fb3B0aW9ucy5yZXR1cm5zKVxyXG5cdFx0XHRcdFx0XHR0aGlzLnJldHVybnModGhpcy5fb3B0aW9ucy5yZXR1cm5zKTtcclxuXHJcblx0XHRcdFx0XHQvLyBsZWdhY3kgc3VwcG9ydCBmb3IgYmFzZWRPbiBvcHRpb24gc3ludGF4XHJcblx0XHRcdFx0XHRpZiAodGhpcy5fb3B0aW9ucy5iYXNlZE9uKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuX29wdGlvbnMuYmFzZWRPbi5mb3JFYWNoKGZ1bmN0aW9uIChpbnB1dCkge1xyXG5cdFx0XHRcdFx0XHRcdHZhciBwYXJ0cyA9IGlucHV0LnNwbGl0KFwiIG9mIFwiKTtcclxuXHRcdFx0XHRcdFx0XHRpZiAocGFydHMubGVuZ3RoID49IDIpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGlmIChwYXJ0c1swXS5zcGxpdChcIixcIikuaW5kZXhPZihcImNoYW5nZVwiKSA+PSAwKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHRoaXMub25DaGFuZ2VPZihbcGFydHNbMV1dKTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0XHR0aGlzLm9uQ2hhbmdlT2YoaW5wdXQpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBpbmRpY2F0ZSB0aGF0IHRoZSBydWxlIHNob3VsZCBub3cgYmUgY29uc2lkZXJlZCByZWdpc3RlcmVkIGFuZCBjYW5ub3QgYmUgcmVjb25maWd1cmVkXHJcblx0XHRcdFx0ZGVsZXRlIHRoaXMuX29wdGlvbnM7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIGNyZWF0ZSBhIGZ1bmN0aW9uIHRvIGRldGVybWluZSB3aGV0aGVyIHRoZSBydWxlIGNhbiBleGVjdXRlIGZvciB0aGUgZ2l2ZW4gYXJndW1lbnRzXHJcblx0XHRcdHZhciBjYW5FeGVjdXRlID0gZnVuY3Rpb24ob2JqLCBhcmdzKSB7XHJcblx0XHRcdFx0Ly8gZW5zdXJlIHRoZSBydWxlIHRhcmdldCBpcyBhIHZhbGlkIHJ1bGUgcm9vdCB0eXBlXHJcblx0XHRcdFx0cmV0dXJuIG9iaiBpbnN0YW5jZW9mIHJ1bGUucm9vdFR5cGUuZ2V0X2pzdHlwZSgpO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0Ly8gY3JlYXRlIGEgZnVuY3Rpb24gdG8gc2FmZWx5IGV4ZWN1dGUgdGhlIHJ1bGVcclxuXHRcdFx0dmFyIGV4ZWN1dGUgPSBmdW5jdGlvbiAob2JqLCBhcmdzKSB7XHJcblx0XHRcdFx0Ly8gRW5zdXJlIHRoYXQgdGhlIHJ1bGUgY2FuIGJlIGV4ZWN1dGVkLlxyXG5cdFx0XHRcdGlmICghY2FuRXhlY3V0ZS5jYWxsKHRoaXMsIG9iaiwgYXJncykpIHJldHVybjtcclxuXHJcblx0XHRcdFx0RXZlbnRTY29wZSRwZXJmb3JtKGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdFx0aWYgKHdpbmRvdy5FeG9XZWIuY29uZmlnLmRldGVjdFJ1bmF3YXlSdWxlcykge1xyXG5cdFx0XHRcdFx0XHRpZiAoY3VycmVudEV2ZW50U2NvcGUucGFyZW50ICYmIGN1cnJlbnRFdmVudFNjb3BlLnBhcmVudC5fZXhpdEV2ZW50VmVyc2lvbikge1xyXG5cdFx0XHRcdFx0XHRcdC8vIERldGVybWluZSB0aGUgbWF4aW11bSBudW1iZXIgbmVzdGVkIGNhbGxzIHRvIEV2ZW50U2NvcGUkcGVyZm9ybVxyXG5cdFx0XHRcdFx0XHRcdC8vIGJlZm9yZSBjb25zaWRlcmluZyBhIHJ1bGUgdG8gYmUgYSBcInJ1bmF3YXlcIiBydWxlLiBcclxuXHRcdFx0XHRcdFx0XHR2YXIgbWF4TmVzdGluZztcclxuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mIHdpbmRvdy5FeG9XZWIuY29uZmlnLm5vbkV4aXRpbmdTY29wZU5lc3RpbmdDb3VudCA9PT0gXCJudW1iZXJcIikge1xyXG5cdFx0XHRcdFx0XHRcdFx0bWF4TmVzdGluZyA9IHdpbmRvdy5FeG9XZWIuY29uZmlnLm5vbkV4aXRpbmdTY29wZU5lc3RpbmdDb3VudCAtIDE7XHJcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdG1heE5lc3RpbmcgPSA5OTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRcdGlmIChjdXJyZW50RXZlbnRTY29wZS5wYXJlbnQuX2V4aXRFdmVudFZlcnNpb24gPiBtYXhOZXN0aW5nKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRsb2dXYXJuaW5nKFwiQWJvcnRpbmcgcnVsZSAnXCIgKyBydWxlLm5hbWUgKyBcIicuXCIpO1xyXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdHJ1bGUuZXhlY3V0ZS5jYWxsKHJ1bGUsIG9iaiwgYXJncyk7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHQvLyBjcmVhdGUgZnVuY3Rpb24gdG8gcGVyZm9ybSBydWxlIHJlZ2lzdHJhdGlvbiBvbmNlIHByZWRpY2F0ZXMgYW5kIHJldHVybiB2YWx1ZXMgaGF2ZSBiZWVuIHByZXBhcmVkXHJcblx0XHRcdHZhciByZWdpc3RlciA9IGZ1bmN0aW9uICgpIHtcclxuXHJcblx0XHRcdFx0Ly8gcmVnaXN0ZXIgZm9yIGluaXQgbmV3XHJcblx0XHRcdFx0aWYgKHRoaXMuaW52b2NhdGlvblR5cGVzICYgUnVsZUludm9jYXRpb25UeXBlLkluaXROZXcpIHtcclxuXHRcdFx0XHRcdHRoaXMucm9vdFR5cGUuYWRkSW5pdE5ldyhmdW5jdGlvbiAoc2VuZGVyLCBhcmdzKSB7XHJcblx0XHRcdFx0XHRcdGV4ZWN1dGUuY2FsbCh0aGlzLCBzZW5kZXIsIGFyZ3MpO1xyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyByZWdpc3RlciBmb3IgaW5pdCBleGlzdGluZ1xyXG5cdFx0XHRcdGlmICh0aGlzLmludm9jYXRpb25UeXBlcyAmIFJ1bGVJbnZvY2F0aW9uVHlwZS5Jbml0RXhpc3RpbmcpIHtcclxuXHRcdFx0XHRcdHRoaXMucm9vdFR5cGUuYWRkSW5pdEV4aXN0aW5nKGZ1bmN0aW9uIChzZW5kZXIsIGFyZ3MpIHtcclxuXHRcdFx0XHRcdFx0ZXhlY3V0ZS5jYWxsKHRoaXMsIHNlbmRlciwgYXJncyk7XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIHJlZ2lzdGVyIGZvciBwcm9wZXJ0eSBjaGFuZ2VcclxuXHRcdFx0XHRpZiAodGhpcy5pbnZvY2F0aW9uVHlwZXMgJiBSdWxlSW52b2NhdGlvblR5cGUuUHJvcGVydHlDaGFuZ2VkKSB7XHJcblx0XHRcdFx0XHR0aGlzLnByZWRpY2F0ZXMuZm9yRWFjaChmdW5jdGlvbiAocHJlZGljYXRlKSB7XHJcblx0XHRcdFx0XHRcdHByZWRpY2F0ZS5hZGRDaGFuZ2VkKFxyXG5cdFx0XHRcdFx0XHRcdGZ1bmN0aW9uIChzZW5kZXIsIGFyZ3MpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGlmIChjYW5FeGVjdXRlLmNhbGwodGhpcywgc2VuZGVyLCBhcmdzKSAmJiAhc2VuZGVyLm1ldGEucGVuZGluZ0ludm9jYXRpb24ocnVsZSkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0c2VuZGVyLm1ldGEucGVuZGluZ0ludm9jYXRpb24ocnVsZSwgdHJ1ZSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdEV2ZW50U2NvcGUkb25FeGl0KGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHNlbmRlci5tZXRhLnBlbmRpbmdJbnZvY2F0aW9uKHJ1bGUsIGZhbHNlKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRleGVjdXRlLmNhbGwodGhpcywgc2VuZGVyLCBhcmdzKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdEV2ZW50U2NvcGUkb25BYm9ydChmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRzZW5kZXIubWV0YS5wZW5kaW5nSW52b2NhdGlvbihydWxlLCBmYWxzZSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH0sXHJcblx0XHRcdFx0XHRcdFx0bnVsbCwgLy8gbm8gb2JqZWN0IGZpbHRlclxyXG5cdFx0XHRcdFx0XHRcdGZhbHNlLCAvLyBzdWJzY3JpYmUgZm9yIGFsbCB0aW1lLCBub3Qgb25jZVxyXG5cdFx0XHRcdFx0XHRcdHRydWUgLy8gdG9sZXJhdGUgbnVsbHMgc2luY2UgcnVsZSBleGVjdXRpb24gbG9naWMgd2lsbCBoYW5kbGUgZ3VhcmQgY29uZGl0aW9uc1xyXG5cdFx0XHRcdFx0XHQpO1xyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyByZWdpc3RlciBmb3IgcHJvcGVydHkgZ2V0XHJcblx0XHRcdFx0aWYgKHRoaXMuaW52b2NhdGlvblR5cGVzICYgUnVsZUludm9jYXRpb25UeXBlLlByb3BlcnR5R2V0ICYmIHRoaXMucmV0dXJuVmFsdWVzKSB7XHJcblxyXG5cdFx0XHRcdFx0Ly8gcmVnaXN0ZXIgZm9yIHByb3BlcnR5IGdldCBldmVudHMgZm9yIGVhY2ggcmV0dXJuIHZhbHVlIHRvIGNhbGN1bGF0ZSB0aGUgcHJvcGVydHkgd2hlbiBhY2Nlc3NlZFxyXG5cdFx0XHRcdFx0dGhpcy5yZXR1cm5WYWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAocmV0dXJuVmFsdWUpIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuVmFsdWUuYWRkR2V0KGZ1bmN0aW9uIChzZW5kZXIsIGFyZ3MpIHtcclxuXHJcblx0XHRcdFx0XHRcdFx0Ly8gcnVuIHRoZSBydWxlIHRvIGluaXRpYWxpemUgdGhlIHByb3BlcnR5IGlmIGl0IGlzIHBlbmRpbmcgaW5pdGlhbGl6YXRpb25cclxuXHRcdFx0XHRcdFx0XHRpZiAoY2FuRXhlY3V0ZS5jYWxsKHRoaXMsIHNlbmRlciwgYXJncykgJiYgc2VuZGVyLm1ldGEucGVuZGluZ0luaXQocmV0dXJuVmFsdWUpKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRzZW5kZXIubWV0YS5wZW5kaW5nSW5pdChyZXR1cm5WYWx1ZSwgZmFsc2UpO1xyXG5cdFx0XHRcdFx0XHRcdFx0ZXhlY3V0ZS5jYWxsKHRoaXMsIHNlbmRlciwgYXJncyk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdH0pO1xyXG5cclxuXHRcdFx0XHRcdC8vIHJlZ2lzdGVyIGZvciBwcm9wZXJ0eSBjaGFuZ2UgZXZlbnRzIGZvciBlYWNoIHByZWRpY2F0ZSB0byBpbnZhbGlkYXRlIHRoZSBwcm9wZXJ0eSB2YWx1ZSB3aGVuIGlucHV0cyBjaGFuZ2VcclxuXHRcdFx0XHRcdHRoaXMucHJlZGljYXRlcy5mb3JFYWNoKGZ1bmN0aW9uIChwcmVkaWNhdGUpIHtcclxuXHRcdFx0XHRcdFx0cHJlZGljYXRlLmFkZENoYW5nZWQoXHJcblx0XHRcdFx0XHRcdFx0ZnVuY3Rpb24gKHNlbmRlciwgYXJncykge1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdC8vIGltbWVkaWF0ZWx5IGV4ZWN1dGUgdGhlIHJ1bGUgaWYgdGhlcmUgYXJlIGV4cGxpY2l0IGV2ZW50IHN1YnNjcmlwdGlvbnMgZm9yIHRoZSBwcm9wZXJ0eVxyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKHJ1bGUucmV0dXJuVmFsdWVzLnNvbWUoZnVuY3Rpb24gKHJldHVyblZhbHVlKSB7IHJldHVybiBoYXNQcm9wZXJ0eUNoYW5nZWRTdWJzY3JpYmVycyhyZXR1cm5WYWx1ZSwgc2VuZGVyKTsgfSkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKGNhbkV4ZWN1dGUuY2FsbCh0aGlzLCBzZW5kZXIsIGFyZ3MpICYmICFzZW5kZXIubWV0YS5wZW5kaW5nSW52b2NhdGlvbihydWxlKSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHNlbmRlci5tZXRhLnBlbmRpbmdJbnZvY2F0aW9uKHJ1bGUsIHRydWUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdEV2ZW50U2NvcGUkb25FeGl0KGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c2VuZGVyLm1ldGEucGVuZGluZ0ludm9jYXRpb24ocnVsZSwgZmFsc2UpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZXhlY3V0ZS5jYWxsKHRoaXMsIHNlbmRlciwgYXJncyk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0RXZlbnRTY29wZSRvbkFib3J0KGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c2VuZGVyLm1ldGEucGVuZGluZ0ludm9jYXRpb24ocnVsZSwgZmFsc2UpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gT3RoZXJ3aXNlLCBqdXN0IG1hcmsgdGhlIHByb3BlcnR5IGFzIHBlbmRpbmcgaW5pdGlhbGl6YXRpb24gYW5kIHJhaXNlIHByb3BlcnR5IGNoYW5nZSBmb3IgVUkgc3Vic2NyaWJlcnNcclxuXHRcdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRydWxlLnJldHVyblZhbHVlcy5mb3JFYWNoKGZ1bmN0aW9uIChyZXR1cm5WYWx1ZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHNlbmRlci5tZXRhLnBlbmRpbmdJbml0KHJldHVyblZhbHVlLCB0cnVlKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdC8vIERlZmVyIGNoYW5nZSBub3RpZmljYXRpb24gdW50aWwgdGhlIHNjb3BlIG9mIHdvcmsgaGFzIGNvbXBsZXRlZFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRFdmVudFNjb3BlJG9uRXhpdChmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0cnVsZS5yZXR1cm5WYWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAocmV0dXJuVmFsdWUpIHsgXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRPYnNlcnZlci5yYWlzZVByb3BlcnR5Q2hhbmdlZChzZW5kZXIsIHJldHVyblZhbHVlLmdldF9uYW1lKCkpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9LFxyXG5cdFx0XHRcdFx0XHRcdG51bGwsIC8vIG5vIG9iamVjdCBmaWx0ZXJcclxuXHRcdFx0XHRcdFx0XHRmYWxzZSwgLy8gc3Vic2NyaWJlIGZvciBhbGwgdGltZSwgbm90IG9uY2VcclxuXHRcdFx0XHRcdFx0XHR0cnVlIC8vIHRvbGVyYXRlIG51bGxzIHNpbmNlIHJ1bGUgZXhlY3V0aW9uIGxvZ2ljIHdpbGwgaGFuZGxlIGd1YXJkIGNvbmRpdGlvbnNcclxuXHRcdFx0XHRcdFx0KTtcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gYWxsb3cgcnVsZSBzdWJjbGFzc2VzIHRvIHBlcmZvcm0gZmluYWwgaW5pdGlhbGl6YXRpb24gd2hlbiByZWdpc3RlcmVkXHJcblx0XHRcdFx0aWYgKHRoaXMub25SZWdpc3RlciBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcblx0XHRcdFx0XHR0aGlzLm9uUmVnaXN0ZXIoKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIE1hcmsgdGhlIHJ1bGUgYXMgc3VjY2Vzc2Z1bGx5IHJlZ2lzdGVyZWRcclxuXHRcdFx0XHR0aGlzLmlzUmVnaXN0ZXJlZCA9IHRydWU7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHQvLyBjcmVhdGUgYSBmdW5jdGlvbiB0byBraWNrIG9mZiB0aGUgcmVnaXN0cmF0aW9uIHByb2Nlc3NcclxuXHRcdFx0dmFyIHN0YXJ0UmVnaXN0ZXIgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0Ly8gcHJvY2VzcyB0aGUgcnVsZSBvcHRpb25zLCB0aGlzIGlzIG9ubHkgZG9uZSBvbmNlXHJcblx0XHRcdFx0cHJvY2Vzc09wdGlvbnMuY2FsbCh0aGlzKTtcclxuXHJcblx0XHRcdFx0Ly8gcmVzb2x2ZSByZXR1cm4gdmFsdWVzLCB3aGljaCBzaG91bGQgYWxsIGJlIGxvYWRlZCBzaW5jZSB0aGUgcm9vdCB0eXBlIGlzIG5vdyBkZWZpbml0ZWx5IGxvYWRlZFxyXG5cdFx0XHRcdGlmICh0aGlzLnJldHVyblZhbHVlcykge1xyXG5cdFx0XHRcdFx0dGhpcy5yZXR1cm5WYWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAocmV0dXJuVmFsdWUsIGkpIHtcclxuXHRcdFx0XHRcdFx0aWYgKCEocmV0dXJuVmFsdWUgaW5zdGFuY2VvZiBQcm9wZXJ0eSkpIHtcclxuXHRcdFx0XHRcdFx0XHR0aGlzLnJldHVyblZhbHVlc1tpXSA9IHRoaXMucm9vdFR5cGUucHJvcGVydHkocmV0dXJuVmFsdWUpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIHJlc29sdmUgYWxsIHByZWRpY2F0ZXMsIGJlY2F1c2UgdGhlIHJ1bGUgY2Fubm90IHJ1biB1bnRpbCB0aGUgZGVwZW5kZW50IHR5cGVzIGhhdmUgYWxsIGJlZW4gbG9hZGVkXHJcblx0XHRcdFx0aWYgKHRoaXMucHJlZGljYXRlcykge1xyXG5cdFx0XHRcdFx0dmFyIHNpZ25hbDtcclxuXHRcdFx0XHRcdHZhciBwcmVkaWNhdGVzID0gW107XHJcblxyXG5cdFx0XHRcdFx0Ly8gc2V0dXAgbG9hZGluZyBvZiBlYWNoIHByb3BlcnR5IHBhdGggdGhhdCB0aGUgY2FsY3VsYXRpb24gaXMgYmFzZWQgb25cclxuXHRcdFx0XHRcdHRoaXMucHJlZGljYXRlcy5mb3JFYWNoKGZ1bmN0aW9uIChwcmVkaWNhdGUsIGkpIHtcclxuXHJcblx0XHRcdFx0XHRcdC8vIHNpbXBseSBjb3B5IHRoZSBwcmVkaWNhdGUgb3ZlciBpZiBoYXMgYWxyZWFkeSBhIHZhbGlkIHByb3BlcnR5IG9yIHByb3BlcnR5IGNoYWluXHJcblx0XHRcdFx0XHRcdGlmIChwcmVkaWNhdGUgaW5zdGFuY2VvZiBQcm9wZXJ0eSB8fCBwcmVkaWNhdGUgaW5zdGFuY2VvZiBQcm9wZXJ0eUNoYWluKSB7XHJcblx0XHRcdFx0XHRcdFx0cHJlZGljYXRlcy5wdXNoKHByZWRpY2F0ZSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdC8vIHBhcnNlIHN0cmluZyBpbnB1dHMsIHdoaWNoIG1heSBiZSBwYXRocyBjb250YWluaW5nIG5lc3Rpbmcge30gaGllcmFyY2hpYWwgc3ludGF4XHJcblx0XHRcdFx0XHRcdGVsc2UgaWYgKHByZWRpY2F0ZS5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XHJcblxyXG5cdFx0XHRcdFx0XHRcdC8vIGNyZWF0ZSBhIHNpZ25hbCBpZiB0aGlzIGlzIHRoZSBmaXJzdCBzdHJpbmctYmFzZWQgaW5wdXRcclxuXHRcdFx0XHRcdFx0XHRpZiAoIXNpZ25hbCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0c2lnbmFsID0gbmV3IFNpZ25hbChcInByZXBhcmUgcnVsZSBwcmVkaWNhdGVzXCIpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0Ly8gbm9ybWFsaXplIHRoZSBwYXRocyB0byBhY2NvbW1vZGF0ZSB7fSBoaWVyYXJjaGlhbCBzeW50YXhcclxuXHRcdFx0XHRcdFx0XHRQYXRoVG9rZW5zLm5vcm1hbGl6ZVBhdGhzKFtwcmVkaWNhdGVdKS5mb3JFYWNoKGZ1bmN0aW9uIChwYXRoKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRNb2RlbC5wcm9wZXJ0eShwYXRoLCB0aGlzLnJvb3RUeXBlLCBmYWxzZSwgc2lnbmFsLnBlbmRpbmcoZnVuY3Rpb24gKGNoYWluKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdC8vIGFkZCB0aGUgcHJlcGFyZWQgcHJvcGVydHkgb3IgcHJvcGVydHkgY2hhaW5cclxuXHRcdFx0XHRcdFx0XHRcdFx0cHJlZGljYXRlcy5wdXNoKGNoYWluKTtcclxuXHRcdFx0XHRcdFx0XHRcdH0sIHRoaXMsIHRydWUpLCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fSwgdGhpcyk7XHJcblxyXG5cdFx0XHRcdFx0Ly8gd2FpdCB1bnRpbCBhbGwgcHJvcGVydHkgaW5mb3JtYXRpb24gaXMgYXZhaWxhYmxlIHRvIGluaXRpYWxpemUgdGhlIHJ1bGVcclxuXHRcdFx0XHRcdGlmIChzaWduYWwpIHtcclxuXHRcdFx0XHRcdFx0c2lnbmFsLndhaXRGb3JBbGwoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0XHRcdHRoaXMucHJlZGljYXRlcyA9IHByZWRpY2F0ZXM7XHJcblx0XHRcdFx0XHRcdFx0cmVnaXN0ZXIuY2FsbCh0aGlzKTtcclxuXHRcdFx0XHRcdFx0fSwgdGhpcywgdHJ1ZSk7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0Ly8gb3RoZXJ3aXNlLCBqdXN0IGltbWVkaWF0ZWx5IHByb2NlZWQgd2l0aCBydWxlIHJlZ2lzdHJhdGlvblxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdHRoaXMucHJlZGljYXRlcyA9IHByZWRpY2F0ZXM7XHJcblx0XHRcdFx0XHRcdHJlZ2lzdGVyLmNhbGwodGhpcyk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0Ly8gT3B0aW9uYWxseSBwZXJmb3JtIGFzeW5jIHByZS1yZWdpc3RyYXRpb24gbG9naWMsIHRoZW4ga2ljayBvZmYgdGhlIHJlZ2lzdHJhdGlvbiBwcm9jZXNzXHJcblx0XHRcdGlmICh0aGlzLnByZVJlZ2lzdGVyKSB7XHJcblx0XHRcdFx0Ly8gSW52b2tlIHRoZSBydWxlJ3MgcHJlLXJlZ2lzdGVyIGxvZ2ljIGlmIGl0IGV4aXN0c1xyXG5cdFx0XHRcdGlmICh0aGlzLnByZVJlZ2lzdGVyKGZ1bmN0aW9uICgpIHsgc3RhcnRSZWdpc3Rlci5jYWxsKHRoaXMpOyB9LCB0aGlzKSA9PT0gZmFsc2UpIHtcclxuXHRcdFx0XHRcdHN0YXJ0UmVnaXN0ZXIuY2FsbCh0aGlzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0c3RhcnRSZWdpc3Rlci5jYWxsKHRoaXMpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vIGNyZWF0ZXMgYSBjb25kaXRpb24gdHlwZSBmb3IgdGhlIHNwZWNpZmllZCBydWxlIGFuZCB0eXBlIG9yIHByb3BlcnR5LCBvZiB0aGUgc3BlY2lmaWVkIGNhdGVnb3J5IHR5cGUgKHVzdWFsbHkgRXJyb3Igb3IgV2FybmluZylcclxuXHRSdWxlLmVuc3VyZUNvbmRpdGlvblR5cGUgPSBmdW5jdGlvbiBSdWxlJGVuc3VyZUNvbmRpdGlvblR5cGUocnVsZU5hbWUsIHR5cGVPclByb3AsIGNhdGVnb3J5LCBzZXRzKSB7XHJcblx0XHR2YXIgZ2VuZXJhdGVkQ29kZSA9XHJcblx0XHRcdHR5cGVPclByb3AgaW5zdGFuY2VvZiBQcm9wZXJ0eSA/ICRmb3JtYXQoXCJ7MH0uezF9LnsyfVwiLCBbdHlwZU9yUHJvcC5nZXRfY29udGFpbmluZ1R5cGUoKS5nZXRfZnVsbE5hbWUoKSwgdHlwZU9yUHJvcC5nZXRfbmFtZSgpLCBydWxlTmFtZV0pIDpcclxuXHRcdFx0dHlwZU9yUHJvcCBpbnN0YW5jZW9mIFR5cGUgPyAkZm9ybWF0KFwiezB9LnsxfVwiLCBbdHlwZU9yUHJvcC5nZXRfZnVsbE5hbWUoKSwgcnVsZU5hbWVdKSA6IFxyXG5cdFx0XHRydWxlTmFtZTtcclxuXHRcdHZhciBjb3VudGVyID0gXCJcIjtcclxuXHJcblx0XHR3aGlsZSAoQ29uZGl0aW9uVHlwZS5nZXQoZ2VuZXJhdGVkQ29kZSArIGNvdW50ZXIpKVxyXG5cdFx0XHRjb3VudGVyKys7XHJcblxyXG5cdFx0Ly8gcmV0dXJuIGEgbmV3IGNsaWVudCBjb25kaXRpb24gdHlwZSBvZiB0aGUgc3BlY2lmaWVkIGNhdGVnb3J5XHJcblx0XHRyZXR1cm4gbmV3IGNhdGVnb3J5KGdlbmVyYXRlZENvZGUgKyBjb3VudGVyLCAkZm9ybWF0KFwiR2VuZXJhdGVkIGNvbmRpdGlvbiB0eXBlIGZvciB7MH0gcnVsZS5cIiwgW3J1bGVOYW1lXSksIG51bGwsIFwiY2xpZW50XCIpO1xyXG5cdH07XHJcblxyXG5cdC8vIGNyZWF0ZXMgYW4gZXJyb3IgZm9yIHRoZSBzcGVjaWZpZWQgcnVsZSBhbmQgdHlwZSBvciBwcm9wZXJ0eVxyXG5cdFJ1bGUuZW5zdXJlRXJyb3IgPSBmdW5jdGlvbiBSdWxlJGVuc3VyZUVycm9yKHJ1bGVOYW1lLCB0eXBlT3JQcm9wLCBzZXRzKSB7XHJcblx0XHRyZXR1cm4gUnVsZS5lbnN1cmVDb25kaXRpb25UeXBlKHJ1bGVOYW1lLCB0eXBlT3JQcm9wLCBDb25kaXRpb25UeXBlLkVycm9yLCBzZXRzKTtcclxuXHR9O1xyXG5cclxuXHQvLyBjcmVhdGVzIGFuIGVycm9yIGZvciB0aGUgc3BlY2lmaWVkIHJ1bGUgYW5kIHR5cGUgb3IgcHJvcGVydHlcclxuXHRSdWxlLmVuc3VyZVdhcm5pbmcgPSBmdW5jdGlvbiBSdWxlJGVuc3VyZVdhcm5pbmcocnVsZU5hbWUsIHR5cGVPclByb3AsIHNldHMpIHtcclxuXHRcdHJldHVybiBSdWxlLmVuc3VyZUNvbmRpdGlvblR5cGUocnVsZU5hbWUsIHR5cGVPclByb3AsIENvbmRpdGlvblR5cGUuV2FybmluZywgc2V0cyk7XHJcblx0fTtcclxuXHJcblx0Ly8gcHVibGljbHkgZXhwb3NlIHRoZSBydWxlXHJcblx0RXhvV2ViLk1vZGVsLlJ1bGUgPSBSdWxlO1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLk1vZGVsLlJ1bGVJbnB1dFxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIFJ1bGVJbnB1dChwcm9wZXJ0eSkge1xyXG5cdFx0dGhpcy5wcm9wZXJ0eSA9IHByb3BlcnR5O1xyXG5cdH1cclxuXHJcblx0UnVsZUlucHV0LnByb3RvdHlwZSA9IHtcclxuXHRcdHNldF9kZXBlbmRzT25Jbml0OiBmdW5jdGlvbiBSdWxlSW5wdXQkc2V0X2RlcGVuZHNPbkluaXQodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5faW5pdCA9IHZhbHVlO1xyXG5cdFx0fSxcclxuXHRcdGdldF9kZXBlbmRzT25Jbml0OiBmdW5jdGlvbiBSdWxlSW5wdXQkZ2V0X2RlcGVuZHNPbkluaXQoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9pbml0ID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IHRoaXMuX2luaXQ7XHJcblx0XHR9LFxyXG5cdFx0c2V0X2RlcGVuZHNPbkNoYW5nZTogZnVuY3Rpb24gUnVsZUlucHV0JHNldF9kZXBlbmRzT25DaGFuZ2UodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fY2hhbmdlID0gdmFsdWU7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X2RlcGVuZHNPbkNoYW5nZTogZnVuY3Rpb24gUnVsZUlucHV0JGdldF9kZXBlbmRzT25DaGFuZ2UoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9jaGFuZ2UgPT09IHVuZGVmaW5lZCA/IHRydWUgOiB0aGlzLl9jaGFuZ2U7XHJcblx0XHR9LFxyXG5cdFx0c2V0X2RlcGVuZHNPbkdldDogZnVuY3Rpb24gUnVsZUlucHV0JHNldF9kZXBlbmRzT25HZXQodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fZ2V0ID0gdmFsdWU7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X2RlcGVuZHNPbkdldDogZnVuY3Rpb24gUnVsZUlucHV0JGdldF9kZXBlbmRzT25HZXQoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9nZXQgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogdGhpcy5fZ2V0O1xyXG5cdFx0fSxcclxuXHRcdGdldF9pc1RhcmdldDogZnVuY3Rpb24gUnVsZUlucHV0JGdldF9pc1RhcmdldCgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2lzVGFyZ2V0ID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IHRoaXMuX2lzVGFyZ2V0O1xyXG5cdFx0fSxcclxuXHRcdHNldF9pc1RhcmdldDogZnVuY3Rpb24gUnVsZUlucHV0JHNldF9pc1RhcmdldCh2YWx1ZSkge1xyXG5cdFx0XHR0aGlzLl9pc1RhcmdldCA9IHZhbHVlO1xyXG5cdFx0fVxyXG5cdH07XHJcblx0RXhvV2ViLk1vZGVsLlJ1bGVJbnB1dCA9IFJ1bGVJbnB1dDtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5Nb2RlbC5Db25kaXRpb25SdWxlXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gQ29uZGl0aW9uUnVsZShyb290VHlwZSwgb3B0aW9ucykge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5PkNyZWF0ZXMgYSBydWxlIHRoYXQgYXNzZXJ0cyBhIGNvbmRpdGlvbiBiYXNlZCBvbiBhIHByZWRpY2F0ZS48L3N1bW1hcnk+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJyb290VHlwZVwiIHR5cGU9XCJUeXBlXCI+VGhlIG1vZGVsIHR5cGUgdGhlIHJ1bGUgaXMgZm9yLjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJvcHRpb25zXCIgdHlwZT1cIk9iamVjdFwiPlxyXG5cdFx0Ly8vXHRcdFRoZSBvcHRpb25zIGZvciB0aGUgcnVsZSwgaW5jbHVkaW5nOlxyXG5cdFx0Ly8vXHRcdFx0YXNzZXJ0Olx0XHRcdFx0YSBwcmVkaWNhdGUgdGhhdCByZXR1cm5zIHRydWUgd2hlbiB0aGUgY29uZGl0aW9uIHNob3VsZCBiZSBhc3NlcnRlZFxyXG5cdFx0Ly8vXHRcdFx0bmFtZTpcdFx0XHRcdHRoZSBvcHRpb25hbCB1bmlxdWUgbmFtZSBvZiB0aGUgdHlwZSBvZiBydWxlXHJcblx0XHQvLy9cdFx0XHRjb25kaXRpb25UeXBlOlx0XHR0aGUgb3B0aW9uYWwgY29uZGl0aW9uIHR5cGUgdG8gdXNlLCB3aGljaCB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgY3JlYXRlZCBpZiBub3Qgc3BlY2lmaWVkXHJcblx0XHQvLy9cdFx0XHRjYXRlZ29yeTpcdFx0XHRDb25kaXRpb25UeXBlLkVycm9yIHx8IENvbmRpdGlvblR5cGUuV2FybmluZyAoZGVmYXVsdHMgdG8gQ29uZGl0aW9uVHlwZS5FcnJvcilcclxuXHRcdC8vL1x0XHRcdG1lc3NhZ2U6XHRcdFx0dGhlIG1lc3NhZ2UgdG8gc2hvdyB0aGUgdXNlciB3aGVuIHRoZSB2YWxpZGF0aW9uIGZhaWxzXHJcblx0XHQvLy9cdFx0XHRwcm9wZXJ0aWVzOlx0XHRcdGFuIGFycmF5IG9mIHByb3BlcnR5IHBhdGhzIHRoZSB2YWxpZGF0aW9uIGNvbmRpdGlvbiBzaG91bGQgYmUgYXR0YWNoZWQgdG8gd2hlbiBhc3NlcnRlZCwgaW4gYWRkaXRpb24gdG8gdGhlIHRhcmdldCBwcm9wZXJ0eVxyXG5cdFx0Ly8vXHRcdFx0c2V0czpcdFx0XHRcdHRoZSBvcHRpb25hbCBhcnJheSBvZiBjb25kaXRpb24gdHlwZSBzZXRzIHRvIGFzc29jaWF0ZSB0aGUgY29uZGl0aW9uIHdpdGhcclxuXHRcdC8vL1x0XHRcdG9uSW5pdDpcdFx0XHRcdHRydWUgdG8gaW5kaWNhdGUgdGhlIHJ1bGUgc2hvdWxkIHJ1biB3aGVuIGFuIGluc3RhbmNlIG9mIHRoZSByb290IHR5cGUgaXMgaW5pdGlhbGl6ZWQsIG90aGVyd2lzZSBmYWxzZVxyXG5cdFx0Ly8vXHRcdFx0b25Jbml0TmV3Olx0XHRcdHRydWUgdG8gaW5kaWNhdGUgdGhlIHJ1bGUgc2hvdWxkIHJ1biB3aGVuIGEgbmV3IGluc3RhbmNlIG9mIHRoZSByb290IHR5cGUgaXMgaW5pdGlhbGl6ZWQsIG90aGVyd2lzZSBmYWxzZVxyXG5cdFx0Ly8vXHRcdFx0b25Jbml0RXhpc3Rpbmc6XHRcdHRydWUgdG8gaW5kaWNhdGUgdGhlIHJ1bGUgc2hvdWxkIHJ1biB3aGVuIGFuIGV4aXN0aW5nIGluc3RhbmNlIG9mIHRoZSByb290IHR5cGUgaXMgaW5pdGlhbGl6ZWQsIG90aGVyd2lzZSBmYWxzZVxyXG5cdFx0Ly8vXHRcdFx0b25DaGFuZ2VPZjpcdFx0XHRhbiBhcnJheSBvZiBwcm9wZXJ0eSBwYXRocyAoc3RyaW5ncywgUHJvcGVydHkgb3IgUHJvcGVydHlDaGFpbiBpbnN0YW5jZXMpIHRoYXQgZHJpdmUgd2hlbiB0aGUgcnVsZSBzaG91bGQgZXhlY3V0ZSBkdWUgdG8gcHJvcGVydHkgY2hhbmdlc1xyXG5cdFx0Ly8vIDwvcGFyYW0+XHJcblx0XHQvLy8gPHJldHVybnMgdHlwZT1cIkNvbmRpdGlvblJ1bGVcIj5UaGUgbmV3IGNvbmRpdGlvbiBydWxlLjwvcmV0dXJucz5cclxuXHJcblx0XHQvLyBleGl0IGltbWVkaWF0ZWx5IGlmIGNhbGxlZCB3aXRoIG5vIGFyZ3VtZW50c1xyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHJldHVybjtcclxuXHJcblx0XHQvLyBlbnN1cmUgdGhlIHJ1bGUgbmFtZSBpcyBzcGVjaWZpZWRcclxuXHRcdG9wdGlvbnMubmFtZSA9IG9wdGlvbnMubmFtZSB8fCBcIkNvbmRpdGlvblwiO1xyXG5cclxuXHRcdC8vIHN0b3JlIHRoZSBjb25kaXRpb24gcHJlZGljYXRlXHJcblx0XHR2YXIgYXNzZXJ0ID0gb3B0aW9ucy5hc3NlcnQgfHwgb3B0aW9ucy5mbjtcclxuXHRcdGlmIChhc3NlcnQpIHtcclxuXHRcdFx0dGhpcy5hc3NlcnQgPSBhc3NlcnQ7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gYXV0b21hdGljYWxseSBydW4gdGhlIGNvbmRpdGlvbiBydWxlIGR1cmluZyBpbml0aWFsaXphdGlvbiBvZiBuZXcgaW5zdGFuY2VzXHJcblx0XHRpZiAoIW9wdGlvbnMuaGFzT3duUHJvcGVydHkoXCJvbkluaXROZXdcIikpIHtcclxuXHRcdFx0b3B0aW9ucy5vbkluaXROZXcgPSB0cnVlO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGNvZXJjZSBzdHJpbmcgdG8gY29uZGl0aW9uIHR5cGVcclxuXHRcdHZhciBjb25kaXRpb25UeXBlID0gb3B0aW9ucy5jb25kaXRpb25UeXBlO1xyXG5cdFx0aWYgKGlzU3RyaW5nKGNvbmRpdGlvblR5cGUpKSB7XHJcblx0XHRcdGNvbmRpdGlvblR5cGUgPSBDb25kaXRpb25UeXBlLmdldChjb25kaXRpb25UeXBlKTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBjcmVhdGUgYSBjb25kaXRpb24gdHlwZSBpZiBub3QgcGFzc2VkIGluLCBkZWZhdWx0aW5nIHRvIEVycm9yIGlmIGEgY29uZGl0aW9uIGNhdGVnb3J5IHdhcyBub3Qgc3BlY2lmaWVkXHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJjb25kaXRpb25UeXBlXCIsIHsgXHJcblx0XHRcdHZhbHVlOiBjb25kaXRpb25UeXBlIHx8IFJ1bGUuZW5zdXJlQ29uZGl0aW9uVHlwZShvcHRpb25zLm5hbWUsIHJvb3RUeXBlLCBvcHRpb25zLmNhdGVnb3J5IHx8IENvbmRpdGlvblR5cGUuRXJyb3IsIG9wdGlvbnMuc2V0cylcclxuXHRcdH0pO1xyXG5cclxuXHRcdC8vIGF1dG9tYXRpY2FsbHkgcnVuIHRoZSBjb25kaXRpb24gcnVsZSBkdXJpbmcgaW5pdGlhbGl6YXRpb24gb2YgZXhpc3RpbmcgaW5zdGFuY2VzIGlmIHRoZSBjb25kaXRpb24gdHlwZSB3YXMgZGVmaW5lZCBvbiB0aGUgY2xpZW50XHJcblx0XHRpZiAoIW9wdGlvbnMuaGFzT3duUHJvcGVydHkoXCJvbkluaXRFeGlzdGluZ1wiKSAmJiB0aGlzLmNvbmRpdGlvblR5cGUub3JpZ2luICE9PSBcInNlcnZlclwiKSB7XHJcblx0XHRcdG9wdGlvbnMub25Jbml0RXhpc3RpbmcgPSB0cnVlO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIHN0b3JlIHRoZSBjb25kaXRpb24gbWVzc2FnZSBhbmQgcHJvcGVydGllc1xyXG5cdFx0aWYgKG9wdGlvbnMubWVzc2FnZSkge1xyXG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJtZXNzYWdlXCIsIHsgdmFsdWU6IG9wdGlvbnMubWVzc2FnZSwgd3JpdGFibGU6IHRydWUgfSk7XHJcblx0XHR9XHJcblx0XHRpZiAob3B0aW9ucy5wcm9wZXJ0aWVzKSB7XHJcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInByb3BlcnRpZXNcIiwgeyB2YWx1ZTogb3B0aW9ucy5wcm9wZXJ0aWVzLCB3cml0YWJsZTogdHJ1ZSB9KTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBDYWxsIHRoZSBiYXNlIHJ1bGUgY29uc3RydWN0b3JcclxuXHRcdFJ1bGUuYXBwbHkodGhpcywgW3Jvb3RUeXBlLCBvcHRpb25zXSk7XHJcblx0fVxyXG5cclxuXHQvLyBzZXR1cCB0aGUgaW5oZXJpdGFuY2UgY2hhaW5cclxuXHRDb25kaXRpb25SdWxlLnByb3RvdHlwZSA9IG5ldyBSdWxlKCk7XHJcblx0Q29uZGl0aW9uUnVsZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBDb25kaXRpb25SdWxlO1xyXG5cclxuXHQvLyBpbXBsZW1lbnQgdGhlIGV4ZWN1dGUgbWV0aG9kXHJcblx0Q29uZGl0aW9uUnVsZS5taXhpbih7XHJcblxyXG5cdFx0Ly8gc3ViY2xhc3NlcyBtYXkgb3ZlcnJpZGUgdGhpcyBmdW5jdGlvbiB0byByZXR1cm4gdGhlIHNldCBvZiBwcm9wZXJ0aWVzIHRvIGF0dGFjaCBjb25kaXRpb25zIHRvIGZvciB0aGlzIHJ1bGVcclxuXHRcdHByb3BlcnRpZXM6IGZ1bmN0aW9uIENvbmRpdGlvblJ1bGUkcHJvcGVydGllcygpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuaGFzT3duUHJvcGVydHkoXCJwcm9wZXJ0aWVzXCIpID8gdGhpcy5wcm9wZXJ0aWVzIDogW107XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIHN1YmNsYXNzZXMgbWF5IG92ZXJyaWRlIHRoaXMgZnVuY3Rpb24gdG8gY2FsY3VsYXRlIGFuIGFwcHJvcHJpYXRlIG1lc3NhZ2UgZm9yIHRoaXMgcnVsZSBkdXJpbmcgdGhlIHJlZ2lzdHJhdGlvbiBwcm9jZXNzXHJcblx0XHRtZXNzYWdlOiBmdW5jdGlvbiBDb25kaXRpb25SdWxlJG1lc3NhZ2UoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLmNvbmRpdGlvblR5cGUubWVzc2FnZTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gc3ViY2xhc3NlcyBtYXkgb3ZlcnJpZGUgdGhpcyBmdW5jdGlvbiB0byBpbmRpY2F0ZSB3aGV0aGVyIHRoZSBjb25kaXRpb24gc2hvdWxkIGJlIGFzc2VydGVkXHJcblx0XHRhc3NlcnQ6IGZ1bmN0aW9uIENvbmRpdGlvblJ1bGUkYXNzZXJ0KG9iaikge1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJDb25kaXRpb25SdWxlLmFzc2VydCgpIG11c3QgYmUgcGFzc2VkIGludG8gdGhlIGNvbnN0cnVjdG9yIG9yIG92ZXJyaWRlbiBieSBzdWJjbGFzc2VzLlwiKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gYXNzZXJ0cyB0aGUgY29uZGl0aW9uIGFuZCBhZGRzIG9yIHJlbW92ZXMgaXQgZnJvbSB0aGUgbW9kZWwgaWYgbmVjZXNzYXJ5XHJcblx0XHRleGVjdXRlOiBmdW5jdGlvbiBDb25kaXRpb25SdWxlJGV4ZWN1dGUob2JqLCBhcmdzKSB7XHJcblxyXG5cdFx0XHR2YXIgYXNzZXJ0O1xyXG5cclxuXHRcdFx0Ly8gY2FsbCBhc3NlcnQgdGhlIHJvb3Qgb2JqZWN0IGFzIFwidGhpc1wiIGlmIHRoZSBhc3NlcnRpb24gZnVuY3Rpb24gd2FzIG92ZXJyaWRlbiBpbiB0aGUgY29uc3RydWN0b3JcclxuXHRcdFx0aWYgKHRoaXMuaGFzT3duUHJvcGVydHkoXCJhc3NlcnRcIikpIHtcclxuXHJcblx0XHRcdFx0Ly8gY29udmVydCBzdHJpbmcgZnVuY3Rpb25zIGludG8gY29tcGlsZWQgZnVuY3Rpb25zIG9uIGZpcnN0IGV4ZWN1dGlvblxyXG5cdFx0XHRcdGlmICh0aGlzLmFzc2VydC5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XHJcblx0XHRcdFx0XHR0aGlzLmFzc2VydCA9IHRoaXMucm9vdFR5cGUuY29tcGlsZUV4cHJlc3Npb24odGhpcy5hc3NlcnQpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRhc3NlcnQgPSB0aGlzLmFzc2VydC5jYWxsKG9iaiwgb2JqLCBhcmdzKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gb3RoZXJ3aXNlLCBhbGxvdyBcInRoaXNcIiB0byBiZSB0aGUgY3VycmVudCBydWxlIHRvIHN1cHBvcnQgc3ViY2xhc3NlcyB0aGF0IG92ZXJyaWRlIGFzc2VydFxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRhc3NlcnQgPSB0aGlzLmFzc2VydChvYmopO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR2YXIgbWVzc2FnZSA9IHRoaXMubWVzc2FnZTtcclxuXHRcdFx0aWYgKG1lc3NhZ2UgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG5cdFx0XHRcdGlmICh0aGlzLmhhc093blByb3BlcnR5KFwibWVzc2FnZVwiKSkge1xyXG5cdFx0XHRcdFx0Ly8gV2hlbiBtZXNzYWdlIGlzIG92ZXJyaWRlbiwgdXNlIHRoZSByb290IG9iamVjdCBhcyB0aGlzXHJcblx0XHRcdFx0XHRtZXNzYWdlID0gbWVzc2FnZS5iaW5kKG9iaik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0bWVzc2FnZSA9IG1lc3NhZ2UuYmluZCh0aGlzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIGNyZWF0ZSBvciByZW1vdmUgdGhlIGNvbmRpdGlvbiBpZiBuZWNlc3NhcnlcclxuXHRcdFx0aWYgKGFzc2VydCAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0dGhpcy5jb25kaXRpb25UeXBlLndoZW4oYXNzZXJ0LCBvYmosXHJcblx0XHRcdFx0XHRcdHRoaXMucHJvcGVydGllcyBpbnN0YW5jZW9mIEZ1bmN0aW9uID8gdGhpcy5wcm9wZXJ0aWVzKG9iaikgOiB0aGlzLnByb3BlcnRpZXMsXHJcblx0XHRcdFx0XHRcdG1lc3NhZ2UpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFxyXG5cdFx0Ly8gZ2V0cyB0aGUgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBjb25kaXRpb24gcnVsZVxyXG5cdFx0dG9TdHJpbmc6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMubWVzc2FnZSB8fCB0aGlzLmNvbmRpdGlvblR5cGUubWVzc2FnZTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0Ly8gZXhwb3NlIHRoZSBydWxlIHB1YmxpY2x5XHJcblx0UnVsZS5jb25kaXRpb24gPSBDb25kaXRpb25SdWxlO1xyXG5cdEV4b1dlYi5Nb2RlbC5Db25kaXRpb25SdWxlID0gQ29uZGl0aW9uUnVsZTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5Nb2RlbC5WYWxpZGF0ZWRQcm9wZXJ0eVJ1bGVcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHRmdW5jdGlvbiBWYWxpZGF0ZWRQcm9wZXJ0eVJ1bGUocm9vdFR5cGUsIG9wdGlvbnMpIHtcclxuXHRcdC8vLyA8c3VtbWFyeT5DcmVhdGVzIGEgcnVsZSB0aGF0IHZhbGlkYXRlcyB0aGUgdmFsdWUgb2YgYSBwcm9wZXJ0eSBpbiB0aGUgbW9kZWwuPC9zdW1tYXJ5PlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwicm9vdFR5cGVcIiB0eXBlPVwiVHlwZVwiPlRoZSBtb2RlbCB0eXBlIHRoZSBydWxlIGlzIGZvci48L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwib3B0aW9uc1wiIHR5cGU9XCJPYmplY3RcIj5cclxuXHRcdC8vL1x0XHRUaGUgb3B0aW9ucyBmb3IgdGhlIHJ1bGUsIGluY2x1ZGluZzpcclxuXHRcdC8vL1x0XHRcdHByb3BlcnR5Olx0XHRcdHRoZSBwcm9wZXJ0eSBiZWluZyB2YWxpZGF0ZWQgKGVpdGhlciBhIFByb3BlcnR5IGluc3RhbmNlIG9yIHN0cmluZyBwcm9wZXJ0eSBuYW1lKVxyXG5cdFx0Ly8vXHRcdFx0aXNWYWxpZDpcdFx0XHRmdW5jdGlvbiAob2JqLCBwcm9wLCB2YWwpIHsgcmV0dXJuIHRydWU7IH0gKGEgcHJlZGljYXRlIHRoYXQgcmV0dXJucyB0cnVlIHdoZW4gdGhlIHByb3BlcnR5IGlzIHZhbGlkKVxyXG5cdFx0Ly8vXHRcdFx0bmFtZTpcdFx0XHRcdHRoZSBvcHRpb25hbCB1bmlxdWUgbmFtZSBvZiB0aGUgdHlwZSBvZiB2YWxpZGF0aW9uIHJ1bGVcclxuXHRcdC8vL1x0XHRcdGNvbmRpdGlvblR5cGU6XHRcdHRoZSBvcHRpb25hbCBjb25kaXRpb24gdHlwZSB0byB1c2UsIHdoaWNoIHdpbGwgYmUgYXV0b21hdGljYWxseSBjcmVhdGVkIGlmIG5vdCBzcGVjaWZpZWRcclxuXHRcdC8vL1x0XHRcdGNhdGVnb3J5Olx0XHRcdENvbmRpdGlvblR5cGUuRXJyb3IgfHwgQ29uZGl0aW9uVHlwZS5XYXJuaW5nIChkZWZhdWx0cyB0byBDb25kaXRpb25UeXBlLkVycm9yKVxyXG5cdFx0Ly8vXHRcdFx0bWVzc2FnZTpcdFx0XHR0aGUgbWVzc2FnZSB0byBzaG93IHRoZSB1c2VyIHdoZW4gdGhlIHZhbGlkYXRpb24gZmFpbHNcdFxyXG5cdFx0Ly8vXHRcdFx0cHJvcGVydGllczpcdFx0XHRhbiBhcnJheSBvZiBwcm9wZXJ0eSBwYXRocyB0aGUgdmFsaWRhdGlvbiBjb25kaXRpb24gc2hvdWxkIGJlIGF0dGFjaGVkIHRvIHdoZW4gYXNzZXJ0ZWQsIGluIGFkZGl0aW9uIHRvIHRoZSB0YXJnZXQgcHJvcGVydHlcclxuXHRcdC8vL1x0XHRcdG9uSW5pdDpcdFx0XHRcdHRydWUgdG8gaW5kaWNhdGUgdGhlIHJ1bGUgc2hvdWxkIHJ1biB3aGVuIGFuIGluc3RhbmNlIG9mIHRoZSByb290IHR5cGUgaXMgaW5pdGlhbGl6ZWQsIG90aGVyd2lzZSBmYWxzZVxyXG5cdFx0Ly8vXHRcdFx0b25Jbml0TmV3Olx0XHRcdHRydWUgdG8gaW5kaWNhdGUgdGhlIHJ1bGUgc2hvdWxkIHJ1biB3aGVuIGEgbmV3IGluc3RhbmNlIG9mIHRoZSByb290IHR5cGUgaXMgaW5pdGlhbGl6ZWQsIG90aGVyd2lzZSBmYWxzZVxyXG5cdFx0Ly8vXHRcdFx0b25Jbml0RXhpc3Rpbmc6XHRcdHRydWUgdG8gaW5kaWNhdGUgdGhlIHJ1bGUgc2hvdWxkIHJ1biB3aGVuIGFuIGV4aXN0aW5nIGluc3RhbmNlIG9mIHRoZSByb290IHR5cGUgaXMgaW5pdGlhbGl6ZWQsIG90aGVyd2lzZSBmYWxzZVxyXG5cdFx0Ly8vXHRcdFx0b25DaGFuZ2VPZjpcdFx0XHRhbiBhcnJheSBvZiBwcm9wZXJ0eSBwYXRocyAoc3RyaW5ncywgUHJvcGVydHkgb3IgUHJvcGVydHlDaGFpbiBpbnN0YW5jZXMpIHRoYXQgZHJpdmUgd2hlbiB0aGUgcnVsZSBzaG91bGQgZXhlY3V0ZSBkdWUgdG8gcHJvcGVydHkgY2hhbmdlc1xyXG5cdFx0Ly8vIDwvcGFyYW0+XHJcblx0XHQvLy8gPHJldHVybnMgdHlwZT1cIlZhbGlkYXRlZFByb3BlcnR5UnVsZVwiPlRoZSBuZXcgdmFsaWRhdGVkIHByb3BlcnR5IHJ1bGUuPC9yZXR1cm5zPlxyXG5cclxuXHRcdC8vIGV4aXQgaW1tZWRpYXRlbHkgaWYgY2FsbGVkIHdpdGggbm8gYXJndW1lbnRzXHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAwKSByZXR1cm47XHJcblxyXG5cdFx0Ly8gZW5zdXJlIHRoZSBydWxlIG5hbWUgaXMgc3BlY2lmaWVkXHJcblx0XHRvcHRpb25zLm5hbWUgPSBvcHRpb25zLm5hbWUgfHwgXCJWYWxpZGF0ZWRQcm9wZXJ0eVwiO1xyXG5cclxuXHRcdC8vIHN0b3JlIHRoZSBwcm9wZXJ0eSBiZWluZyB2YWxpZGF0ZWRcclxuXHRcdHZhciBwcm9wID0gb3B0aW9ucy5wcm9wZXJ0eSBpbnN0YW5jZW9mIFByb3BlcnR5ID8gb3B0aW9ucy5wcm9wZXJ0eSA6IHJvb3RUeXBlLnByb3BlcnR5KG9wdGlvbnMucHJvcGVydHkpO1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwicHJvcGVydHlcIiwgeyB2YWx1ZTogcHJvcCB9KTtcclxuXHJcblx0XHQvLyBvdmVycmlkZSB0aGUgcHJvdG90eXBlIGlzVmFsaWQgZnVuY3Rpb24gaWYgc3BlY2lmaWVkXHJcblx0XHRpZiAob3B0aW9ucy5pc1ZhbGlkIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuXHRcdFx0dGhpcy5pc1ZhbGlkID0gb3B0aW9ucy5pc1ZhbGlkO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGVuc3VyZSB0aGUgcHJvcGVydGllcyBhbmQgcHJlZGljYXRlcyB0byBpbmNsdWRlIHRoZSB0YXJnZXQgcHJvcGVydHlcclxuXHRcdGlmICghb3B0aW9ucy5wcm9wZXJ0aWVzKSB7XHJcblx0XHRcdG9wdGlvbnMucHJvcGVydGllcyA9IFtwcm9wLmdldF9uYW1lKCldO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAob3B0aW9ucy5wcm9wZXJ0aWVzLmluZGV4T2YocHJvcC5nZXRfbmFtZSgpKSA8IDAgJiYgb3B0aW9ucy5wcm9wZXJ0aWVzLmluZGV4T2YocHJvcCkgPCAwKSB7XHJcblx0XHRcdG9wdGlvbnMucHJvcGVydGllcy5wdXNoKHByb3AuZ2V0X25hbWUoKSk7XHJcblx0XHR9XHJcblx0XHRpZiAoIW9wdGlvbnMub25DaGFuZ2VPZikge1xyXG5cdFx0XHRvcHRpb25zLm9uQ2hhbmdlT2YgPSBbcHJvcF07XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChvcHRpb25zLm9uQ2hhbmdlT2YuaW5kZXhPZihwcm9wLmdldF9uYW1lKCkpIDwgMCAmJiBvcHRpb25zLm9uQ2hhbmdlT2YuaW5kZXhPZihwcm9wKSA8IDApIHtcclxuXHRcdFx0b3B0aW9ucy5vbkNoYW5nZU9mLnB1c2gocHJvcCk7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gY3JlYXRlIGEgcHJvcGVydHkgc3BlY2lmaWVkIGNvbmRpdGlvbiB0eXBlIGlmIG5vdCBwYXNzZWQgaW4sIGRlZmF1bHRpbmcgdG8gRXJyb3IgaWYgYSBjb25kaXRpb24gY2F0ZWdvcnkgd2FzIG5vdCBzcGVjaWZpZWRcclxuXHRcdG9wdGlvbnMuY29uZGl0aW9uVHlwZSA9IG9wdGlvbnMuY29uZGl0aW9uVHlwZSB8fCBSdWxlLmVuc3VyZUNvbmRpdGlvblR5cGUob3B0aW9ucy5uYW1lLCB0aGlzLnByb3BlcnR5LCBvcHRpb25zLmNhdGVnb3J5IHx8IENvbmRpdGlvblR5cGUuRXJyb3IpO1xyXG5cclxuXHRcdC8vIFJlcGxhY2UgdGhlIHByb3BlcnR5IGxhYmVsIHRva2VuIGluIHRoZSB2YWxpZGF0aW9uIG1lc3NhZ2UgaWYgcHJlc2VudFxyXG5cdFx0aWYgKG9wdGlvbnMubWVzc2FnZSkge1xyXG5cdFx0XHR2YXIgcnVsZSA9IHRoaXM7XHJcblx0XHRcdHZhciBtZXNzYWdlID0gb3B0aW9ucy5tZXNzYWdlO1xyXG5cdFx0XHR2YXIgaGFzVG9rZW5zID0gRm9ybWF0Lmhhc1Rva2Vucyhwcm9wLmdldF9sYWJlbCgpKTtcclxuXHRcdFxyXG5cdFx0XHRpZiAodHlwZW9mIChtZXNzYWdlKSA9PT0gXCJmdW5jdGlvblwiKSB7XHJcblx0XHRcdFx0Ly8gQ3JlYXRlIGEgZnVuY3Rpb24gdG8gYXBwbHkgdGhlIGZvcm1hdCB0byB0aGUgcHJvcGVydHkgbGFiZWwgd2hlbiBnZW5lcmF0aW5nIHRoZSBtZXNzYWdlXHJcblx0XHRcdFx0b3B0aW9ucy5tZXNzYWdlID0gZnVuY3Rpb24gKG9iaikge1xyXG5cdFx0XHRcdFx0dmFyIG1lc3NhZ2VUZW1wbGF0ZSA9IG1lc3NhZ2UuYXBwbHkodGhpcywgW29ial0pO1xyXG5cdFx0XHRcdFx0cmV0dXJuIG1lc3NhZ2VUZW1wbGF0ZS5yZXBsYWNlKFwie3Byb3BlcnR5fVwiLCBoYXNUb2tlbnMgPyBydWxlLmdldFByb3BlcnR5TGFiZWxGb3JtYXQoKS5jb252ZXJ0KHRoaXMpIDogcHJvcC5nZXRfbGFiZWwoKSk7XHJcblx0XHRcdFx0fTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh0eXBlb2YgKG1lc3NhZ2UpID09PSBcInN0cmluZ1wiICYmIGhhc1Rva2Vucykge1xyXG5cdFx0XHRcdC8vIENyZWF0ZSBhIGZ1bmN0aW9uIHRvIGFwcGx5IHRoZSBmb3JtYXQgdG8gdGhlIHByb3BlcnR5IGxhYmVsIHdoZW4gZ2VuZXJhdGluZyB0aGUgbWVzc2FnZVxyXG5cdFx0XHRcdG9wdGlvbnMubWVzc2FnZSA9IGZ1bmN0aW9uIChvYmopIHtcclxuXHRcdFx0XHRcdHJldHVybiBtZXNzYWdlLnJlcGxhY2UoXCJ7cHJvcGVydHl9XCIsIHJ1bGUuZ2V0UHJvcGVydHlMYWJlbEZvcm1hdCgpLmNvbnZlcnQodGhpcykpO1xyXG5cdFx0XHRcdH07XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dmFyIGxhYmVsID0gcHJvcC5nZXRfbGFiZWwoKTtcclxuXHRcdFx0XHQvLyBFc2NhcGVkIHVuZXNjYXBlZCBxdW90ZXNcclxuXHRcdFx0XHRpZiAobGFiZWwuaW5kZXhPZihcIlxcXCJcIikgPj0gMCkge1xyXG5cdFx0XHRcdFx0dmFyIHRleHQgPSBcIlwiOyB2YXIgcHJldiA9IFwiXCI7XHJcblx0XHRcdFx0XHRsYWJlbC5zcGxpdChcIlwiKS5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XHJcblx0XHRcdFx0XHRcdGlmIChjID09PSBcIlxcXCJcIiAmJiBwcmV2ICE9PSBcIlxcXFxcIilcclxuXHRcdFx0XHRcdFx0XHR0ZXh0ICs9IFwiXFxcXFwiICsgYztcclxuXHRcdFx0XHRcdFx0ZWxzZVxyXG5cdFx0XHRcdFx0XHRcdHRleHQgKz0gYztcclxuXHRcdFx0XHRcdFx0cHJldiA9IGM7XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdGxhYmVsID0gdGV4dDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0b3B0aW9ucy5tZXNzYWdlID0gbWVzc2FnZS5yZXBsYWNlKCd7cHJvcGVydHl9JywgbGFiZWwpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gY2FsbCB0aGUgYmFzZSBydWxlIGNvbnN0cnVjdG9yXHJcblx0XHRDb25kaXRpb25SdWxlLmFwcGx5KHRoaXMsIFtyb290VHlwZSwgb3B0aW9uc10pO1xyXG5cdH1cclxuXHJcblx0Ly8gc2V0dXAgdGhlIGluaGVyaXRhbmNlIGNoYWluXHJcblx0VmFsaWRhdGVkUHJvcGVydHlSdWxlLnByb3RvdHlwZSA9IG5ldyBDb25kaXRpb25SdWxlKCk7XHJcblx0VmFsaWRhdGVkUHJvcGVydHlSdWxlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFZhbGlkYXRlZFByb3BlcnR5UnVsZTtcclxuXHJcblx0Ly8gZXh0ZW5kIHRoZSBiYXNlIHR5cGVcclxuXHRWYWxpZGF0ZWRQcm9wZXJ0eVJ1bGUubWl4aW4oe1xyXG5cclxuXHRcdC8vIHJldHVybnMgZmFsc2UgaWYgdGhlIHByb3BlcnR5IGlzIHZhbGlkLCB0cnVlIGlmIGludmFsaWQsIG9yIHVuZGVmaW5lZCBpZiB1bmtub3duXHJcblx0XHRhc3NlcnQ6IGZ1bmN0aW9uIFZhbGlkYXRlZFByb3BlcnR5UnVsZSRhc3NlcnQob2JqKSB7XHJcblxyXG5cdFx0XHR2YXIgaXNWYWxpZCA9IHRoaXMuaXNWYWxpZChvYmosIHRoaXMucHJvcGVydHksIHRoaXMucHJvcGVydHkudmFsdWUob2JqKSk7XHJcblx0XHRcdHJldHVybiBpc1ZhbGlkID09PSB1bmRlZmluZWQgPyBpc1ZhbGlkIDogIWlzVmFsaWQ7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIHBlcmZvcm0gYWRkaXRpb24gaW5pdGlhbGl6YXRpb24gb2YgdGhlIHJ1bGUgd2hlbiBpdCBpcyByZWdpc3RlcmVkXHJcblx0XHRvblJlZ2lzdGVyOiBmdW5jdGlvbiAoKSB7XHJcblxyXG5cdFx0XHQvLyByZWdpc3RlciB0aGUgcnVsZSB3aXRoIHRoZSB0YXJnZXQgcHJvcGVydHlcclxuXHRcdFx0cmVnaXN0ZXJQcm9wZXJ0eVJ1bGUodGhpcy5wcm9wZXJ0eSwgdGhpcyk7XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldFByb3BlcnR5TGFiZWxGb3JtYXQ6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0Ly8gY29udmVydCB0aGUgcHJvcGVydHkgbGFiZWwgaW50byBhIG1vZGVsIGZvcm1hdFxyXG5cdFx0XHRpZiAoIXRoaXMuX3Byb3BlcnR5TGFiZWxGb3JtYXQpXHJcblx0XHRcdFx0dGhpcy5fcHJvcGVydHlMYWJlbEZvcm1hdCA9IEV4b1dlYi5Nb2RlbC5nZXRGb3JtYXQodGhpcy5yb290VHlwZS5nZXRfanN0eXBlKCksIHRoaXMucHJvcGVydHkuZ2V0X2xhYmVsKCkpO1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fcHJvcGVydHlMYWJlbEZvcm1hdDtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0UHJvcGVydHlMYWJlbDogZnVuY3Rpb24gKG9iaikge1xyXG5cdFx0XHRpZiAoRm9ybWF0Lmhhc1Rva2Vucyh0aGlzLnByb3BlcnR5LmdldF9sYWJlbCgpKSkge1xyXG5cdFx0XHRcdHJldHVybiB0aGlzLmdldFByb3BlcnR5TGFiZWxGb3JtYXQoKS5jb252ZXJ0KG9iaik7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0cmV0dXJuIHRoaXMucHJvcGVydHkuZ2V0X2xhYmVsKCk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblxyXG5cdFx0cHJlUmVnaXN0ZXI6IGZ1bmN0aW9uIChjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0XHQvLyBFeGl0IGlmIHRoZSBydWxlIGlzIG5vIHRpbiBhIHZhbGlkIHN0YXRlXHJcblx0XHRcdGlmICghdGhpcy5yb290VHlwZSkge1xyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gRXhpdCBpZiB0aGUgcHJvcGVydHkgbGFiZWwgZG9lcyBub3QgY29udGFpbiB0b2tlbnNcclxuXHRcdFx0aWYgKCFGb3JtYXQuaGFzVG9rZW5zKHRoaXMucHJvcGVydHkuZ2V0X2xhYmVsKCkpKSB7XHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR2YXIgcmVnaXN0ZXJGb3JtYXRQYXRocyA9IGZ1bmN0aW9uIChmb3JtYXRQYXRocykge1xyXG5cdFx0XHRcdGlmIChmb3JtYXRQYXRocy5sZW5ndGggPD0gMClcclxuXHRcdFx0XHRcdHJldHVybjtcclxuXHJcblx0XHRcdFx0aWYgKCF0aGlzLl9vcHRpb25zKVxyXG5cdFx0XHRcdFx0dGhpcy5fb3B0aW9ucyA9IHt9O1xyXG5cclxuXHRcdFx0XHRpZiAoIXRoaXMuX29wdGlvbnMub25DaGFuZ2VPZilcclxuXHRcdFx0XHRcdHRoaXMuX29wdGlvbnMub25DaGFuZ2VPZiA9IFtdO1xyXG5cclxuXHRcdFx0XHRmb3JtYXRQYXRocy5mb3JFYWNoKGZ1bmN0aW9uIChwKSB7XHJcblx0XHRcdFx0XHR0aGlzLnJvb3RUeXBlLmdldFBhdGhzKHApLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xyXG5cdFx0XHRcdFx0XHRpZiAodGhpcy5fb3B0aW9ucy5vbkNoYW5nZU9mLmluZGV4T2YocHJvcCkgPCAwKSB7XHJcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZiB0aGlzLl9vcHRpb25zLm9uQ2hhbmdlT2YgPT09IFwic3RyaW5nXCIpXHJcblx0XHRcdFx0XHRcdFx0XHR0aGlzLl9vcHRpb25zLm9uQ2hhbmdlT2YgPSBbdGhpcy5fb3B0aW9ucy5vbkNoYW5nZU9mXTtcclxuXHJcblx0XHRcdFx0XHRcdFx0dGhpcy5fb3B0aW9ucy5vbkNoYW5nZU9mLnB1c2gocHJvcCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0Ly8gRW5zdXJlIHRva2VucyBpbmNsdWRlZCBpbiB0aGUgZm9ybWF0IHRyaWdnZXIgcnVsZSBleGVjdXRpb25cclxuXHRcdFx0aWYgKGNhbGxiYWNrICYmIGNhbGxiYWNrIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuXHRcdFx0XHR0aGlzLmdldFByb3BlcnR5TGFiZWxGb3JtYXQoKS5nZXRQYXRocyhmdW5jdGlvbiAoZm9ybWF0UGF0aHMpIHtcclxuXHRcdFx0XHRcdHJlZ2lzdGVyRm9ybWF0UGF0aHMuY2FsbCh0aGlzLCBmb3JtYXRQYXRocyk7XHJcblx0XHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcyk7XHJcblx0XHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0dmFyIGZvcm1hdFBhdGhzID0gdGhpcy5nZXRQcm9wZXJ0eUxhYmVsRm9ybWF0KCkuZ2V0UGF0aHMoKTtcclxuXHRcdFx0XHRyZWdpc3RlckZvcm1hdFBhdGhzLmNhbGwodGhpcywgZm9ybWF0UGF0aHMpO1xyXG5cdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vIEV4cG9zZSB0aGUgcnVsZSBwdWJsaWNseVxyXG5cdFJ1bGUudmFsaWRhdGVkID0gVmFsaWRhdGVkUHJvcGVydHlSdWxlO1xyXG5cdEV4b1dlYi5Nb2RlbC5WYWxpZGF0ZWRQcm9wZXJ0eVJ1bGUgPSBWYWxpZGF0ZWRQcm9wZXJ0eVJ1bGU7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuTW9kZWwuQ2FsY3VsYXRlZFByb3BlcnR5UnVsZVxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIENhbGN1bGF0ZWRQcm9wZXJ0eVJ1bGUocm9vdFR5cGUsIG9wdGlvbnMpIHtcclxuXHRcdC8vLyA8c3VtbWFyeT5DcmVhdGVzIGEgcnVsZSB0aGF0IGNhbGN1bGF0ZXMgdGhlIHZhbHVlIG9mIGEgcHJvcGVydHkgaW4gdGhlIG1vZGVsLjwvc3VtbWFyeT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cInJvb3RUeXBlXCIgdHlwZT1cIlR5cGVcIj5UaGUgbW9kZWwgdHlwZSB0aGUgcnVsZSBpcyBmb3IuPC9wYXJhbT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cIm9wdGlvbnNcIiB0eXBlPVwiT2JqZWN0XCI+XHJcblx0XHQvLy9cdFx0VGhlIG9wdGlvbnMgZm9yIHRoZSBydWxlLCBpbmNsdWRpbmc6XHJcblx0XHQvLy9cdFx0XHRwcm9wZXJ0eTpcdFx0dGhlIHByb3BlcnR5IGJlaW5nIGNhbGN1bGF0ZWQgKGVpdGhlciBhIFByb3BlcnR5IGluc3RhbmNlIG9yIHN0cmluZyBwcm9wZXJ0eSBuYW1lKVxyXG5cdFx0Ly8vXHRcdFx0Y2FsY3VsYXRlOlx0XHRhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgdmFsdWUgdG8gYXNzaWduIHRvIHRoZSBwcm9wZXJ0eSwgb3IgdW5kZWZpbmVkIGlmIHRoZSB2YWx1ZSBjYW5ub3QgYmUgY2FsY3VsYXRlZFxyXG5cdFx0Ly8vXHRcdFx0ZGVmYXVsdElmRXJyb3I6IHRoZSB2YWx1ZSB0byByZXR1cm4gaWYgYW4gZXJyb3Igb2NjdXJzLCBvciB1bmRlZmluZWQgdG8gY2F1c2UgYW4gZXhjZXB0aW9uIHRvIGJlIHRocm93blxyXG5cdFx0Ly8vXHRcdFx0bmFtZTpcdFx0XHR0aGUgb3B0aW9uYWwgdW5pcXVlIG5hbWUgb2YgdGhlIHJ1bGVcclxuXHRcdC8vL1x0XHQgICAgb25Jbml0Olx0XHRcdHRydWUgdG8gaW5kaWNhdGUgdGhlIHJ1bGUgc2hvdWxkIHJ1biB3aGVuIGFuIGluc3RhbmNlIG9mIHRoZSByb290IHR5cGUgaXMgaW5pdGlhbGl6ZWQsIG90aGVyd2lzZSBmYWxzZVxyXG5cdFx0Ly8vXHRcdCAgICBvbkluaXROZXc6XHRcdHRydWUgdG8gaW5kaWNhdGUgdGhlIHJ1bGUgc2hvdWxkIHJ1biB3aGVuIGEgbmV3IGluc3RhbmNlIG9mIHRoZSByb290IHR5cGUgaXMgaW5pdGlhbGl6ZWQsIG90aGVyd2lzZSBmYWxzZVxyXG5cdFx0Ly8vXHRcdCAgICBvbkluaXRFeGlzdGluZzpcdHRydWUgdG8gaW5kaWNhdGUgdGhlIHJ1bGUgc2hvdWxkIHJ1biB3aGVuIGFuIGV4aXN0aW5nIGluc3RhbmNlIG9mIHRoZSByb290IHR5cGUgaXMgaW5pdGlhbGl6ZWQsIG90aGVyd2lzZSBmYWxzZVxyXG5cdFx0Ly8vXHRcdCAgICBvbkNoYW5nZU9mOlx0XHRhbiBhcnJheSBvZiBwcm9wZXJ0eSBwYXRocyAoc3RyaW5ncywgUHJvcGVydHkgb3IgUHJvcGVydHlDaGFpbiBpbnN0YW5jZXMpIHRoYXQgZHJpdmUgd2hlbiB0aGUgcnVsZSBzaG91bGQgZXhlY3V0ZSBkdWUgdG8gcHJvcGVydHkgY2hhbmdlc1xyXG5cdFx0Ly8vIDwvcGFyYW0+XHJcblx0XHQvLy8gPHJldHVybnMgdHlwZT1cIkNhbGN1bGF0ZWRQcm9wZXJ0eVJ1bGVcIj5UaGUgbmV3IGNhbGN1bGF0ZWQgcHJvcGVydHkgcnVsZS48L3JldHVybnM+XHJcblxyXG5cdFx0Ly8gc3RvcmUgdGhlIHByb3BlcnR5IGJlaW5nIHZhbGlkYXRlZFxyXG5cdFx0dmFyIHByb3AgPSBvcHRpb25zLnByb3BlcnR5IGluc3RhbmNlb2YgUHJvcGVydHkgPyBvcHRpb25zLnByb3BlcnR5IDogcm9vdFR5cGUucHJvcGVydHkob3B0aW9ucy5wcm9wZXJ0eSk7XHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJwcm9wZXJ0eVwiLCB7IHZhbHVlOiBwcm9wIH0pO1xyXG5cclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInVzZU9wdGltYWxVcGRhdGVzXCIsIHsgdmFsdWU6IG9wdGlvbnMudXNlT3B0aW1hbFVwZGF0ZXMgIT09IGZhbHNlIH0pO1xyXG5cclxuXHRcdC8vIGVuc3VyZSB0aGUgcnVsZSBuYW1lIGlzIHNwZWNpZmllZFxyXG5cdFx0b3B0aW9ucy5uYW1lID0gb3B0aW9ucy5uYW1lIHx8IChyb290VHlwZS5nZXRfZnVsbE5hbWUoKSArIFwiLlwiICsgcHJvcC5nZXRfbmFtZSgpICsgXCIuQ2FsY3VsYXRlZFwiKTtcclxuXHJcblx0XHQvLyBzdG9yZSB0aGUgY2FsY3VsYXRpb24gZnVuY3Rpb25cclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImNhbGN1bGF0ZVwiLCB7IHZhbHVlOiBvcHRpb25zLmNhbGN1bGF0ZSB8fCBvcHRpb25zLmZuLCB3cml0YWJsZTogdHJ1ZSB9KTtcclxuXHJcblx0XHQvLyBzdG9yZSB0aGUgY2FsY3VsYXRpb24gZnVuY3Rpb25cclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImRlZmF1bHRJZkVycm9yXCIsIHsgdmFsdWU6IG9wdGlvbnMuaGFzT3duUHJvcGVydHkoXCJkZWZhdWx0SWZFcnJvclwiKSA/IG9wdGlvbnMuZGVmYXVsdElmRXJyb3IgOiBFeG9XZWIuY29uZmlnLmNhbGN1bGF0aW9uRXJyb3JEZWZhdWx0IH0pO1xyXG5cclxuXHRcdC8vIGluZGljYXRlIHRoYXQgdGhlIHJ1bGUgaXMgcmVzcG9uc2libGUgZm9yIHJldHVybmluZyB0aGUgdmFsdWUgb2YgdGhlIGNhbGN1bGF0ZWQgcHJvcGVydHlcclxuXHRcdG9wdGlvbnMucmV0dXJucyA9IFtwcm9wXTtcclxuXHJcblx0XHQvLyBDYWxsIHRoZSBiYXNlIHJ1bGUgY29uc3RydWN0b3IgXHJcblx0XHRSdWxlLmFwcGx5KHRoaXMsIFtyb290VHlwZSwgb3B0aW9uc10pO1xyXG5cdH1cclxuXHJcblx0Ly8gc2V0dXAgdGhlIGluaGVyaXRhbmNlIGNoYWluXHJcblx0Q2FsY3VsYXRlZFByb3BlcnR5UnVsZS5wcm90b3R5cGUgPSBuZXcgUnVsZSgpO1xyXG5cdENhbGN1bGF0ZWRQcm9wZXJ0eVJ1bGUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ2FsY3VsYXRlZFByb3BlcnR5UnVsZTtcclxuXHJcblx0Ly8gZXh0ZW5kIHRoZSBiYXNlIHR5cGVcclxuXHRDYWxjdWxhdGVkUHJvcGVydHlSdWxlLm1peGluKHtcclxuXHRcdGV4ZWN1dGU6IGZ1bmN0aW9uIENhbGN1bGF0ZWRQcm9wZXJ0eVJ1bGUkZXhlY3V0ZShvYmopIHtcclxuXHRcdFx0dmFyIHByb3AgPSB0aGlzLnByb3BlcnR5O1xyXG5cclxuXHRcdFx0Ly8gY29udmVydCBzdHJpbmcgZnVuY3Rpb25zIGludG8gY29tcGlsZWQgZnVuY3Rpb25zIG9uIGZpcnN0IGV4ZWN1dGlvblxyXG5cdFx0XHRpZiAodGhpcy5jYWxjdWxhdGUuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xyXG5cdFx0XHRcdHRoaXMuY2FsY3VsYXRlID0gdGhpcy5yb290VHlwZS5jb21waWxlRXhwcmVzc2lvbih0aGlzLmNhbGN1bGF0ZSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIGNhbGN1bGF0ZSB0aGUgbmV3IHByb3BlcnR5IHZhbHVlXHJcblx0XHRcdHZhciBuZXdWYWx1ZTtcclxuXHRcdFx0aWYgKHRoaXMuZGVmYXVsdElmRXJyb3IgPT09IHVuZGVmaW5lZClcclxuXHRcdFx0XHRuZXdWYWx1ZSA9IHRoaXMuY2FsY3VsYXRlLmFwcGx5KG9iaiwgW29ial0pO1xyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0cnkge1xyXG5cdFx0XHRcdFx0bmV3VmFsdWUgPSB0aGlzLmNhbGN1bGF0ZS5hcHBseShvYmosIFtvYmpdKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Y2F0Y2ggKGUpIHtcclxuXHRcdFx0XHRcdG5ld1ZhbHVlID0gdGhpcy5kZWZhdWx0SWZFcnJvcjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIGV4aXQgaW1tZWRpYXRlbHkgaWYgdGhlIGNhbGN1bGF0ZWQgcmVzdWx0IHdhcyB1bmRlZmluZWRcclxuXHRcdFx0aWYgKG5ld1ZhbHVlID09PSB1bmRlZmluZWQpIHJldHVybjtcclxuXHJcblx0XHRcdC8vIG1vZGlmeSBsaXN0IHByb3BlcnRpZXMgdG8gbWF0Y2ggdGhlIGNhbGN1bGF0ZWQgdmFsdWUgaW5zdGVhZCBvZiBvdmVyd3JpdGluZyB0aGUgcHJvcGVydHlcclxuXHRcdFx0aWYgKHByb3AuZ2V0X2lzTGlzdCgpKSB7XHJcblxyXG5cdFx0XHRcdC8vIHJlLWNhbGN1bGF0ZSB0aGUgbGlzdCB2YWx1ZXNcclxuXHRcdFx0XHR2YXIgbmV3TGlzdCA9IG5ld1ZhbHVlO1xyXG5cclxuXHRcdFx0XHQvLyBjb21wYXJlIHRoZSBuZXcgbGlzdCB0byB0aGUgb2xkIG9uZSB0byBzZWUgaWYgY2hhbmdlcyB3ZXJlIG1hZGVcclxuXHRcdFx0XHR2YXIgY3VyTGlzdCA9IHByb3AudmFsdWUob2JqKTtcclxuXHJcblx0XHRcdFx0aWYgKG5ld0xpc3QubGVuZ3RoID09PSBjdXJMaXN0Lmxlbmd0aCkge1xyXG5cdFx0XHRcdFx0dmFyIG5vQ2hhbmdlcyA9IHRydWU7XHJcblxyXG5cdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBuZXdMaXN0Lmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdFx0XHRcdGlmIChuZXdMaXN0W2ldICE9PSBjdXJMaXN0W2ldKSB7XHJcblx0XHRcdFx0XHRcdFx0bm9DaGFuZ2VzID0gZmFsc2U7XHJcblx0XHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRpZiAobm9DaGFuZ2VzKSB7XHJcblx0XHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIHVwZGF0ZSB0aGUgY3VycmVudCBsaXN0IHNvIG9ic2VydmVycyB3aWxsIHJlY2VpdmUgdGhlIGNoYW5nZSBldmVudHNcclxuXHRcdFx0XHRjdXJMaXN0LmJlZ2luVXBkYXRlKCk7XHJcblx0XHRcdFx0aWYgKHRoaXMudXNlT3B0aW1hbFVwZGF0ZXMpXHJcblx0XHRcdFx0XHR1cGRhdGUoY3VyTGlzdCwgbmV3TGlzdCk7XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRjdXJMaXN0LmNsZWFyKCk7XHJcblx0XHRcdFx0XHRjdXJMaXN0LmFkZFJhbmdlKG5ld0xpc3QpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRjdXJMaXN0LmVuZFVwZGF0ZSgpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBvdGhlcndpc2UsIGp1c3Qgc2V0IHRoZSBwcm9wZXJ0eSB0byB0aGUgbmV3IHZhbHVlXHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHByb3AudmFsdWUob2JqLCBuZXdWYWx1ZSwgeyBjYWxjdWxhdGVkOiB0cnVlIH0pO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0dG9TdHJpbmc6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0cmV0dXJuIFwiY2FsY3VsYXRpb24gb2YgXCIgKyB0aGlzLnByb3BlcnR5Ll9uYW1lO1xyXG5cdFx0fSxcclxuXHRcdC8vIHBlcmZvcm0gYWRkaXRpb24gaW5pdGlhbGl6YXRpb24gb2YgdGhlIHJ1bGUgd2hlbiBpdCBpcyByZWdpc3RlcmVkXHJcblx0XHRvblJlZ2lzdGVyOiBmdW5jdGlvbiAoKSB7XHJcblxyXG5cdFx0XHQvLyByZWdpc3RlciB0aGUgcnVsZSB3aXRoIHRoZSB0YXJnZXQgcHJvcGVydHlcclxuXHRcdFx0cmVnaXN0ZXJQcm9wZXJ0eVJ1bGUodGhpcy5wcm9wZXJ0eSwgdGhpcyk7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vIGV4cG9zZSB0aGUgcnVsZSBwdWJsaWNseVxyXG5cdFJ1bGUuY2FsY3VsYXRlZCA9IENhbGN1bGF0ZWRQcm9wZXJ0eVJ1bGU7XHJcblx0RXhvV2ViLk1vZGVsLkNhbGN1bGF0ZWRQcm9wZXJ0eVJ1bGUgPSBDYWxjdWxhdGVkUHJvcGVydHlSdWxlO1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLk1vZGVsLlJlcXVpcmVkUnVsZVxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIFJlcXVpcmVkUnVsZShyb290VHlwZSwgb3B0aW9ucykge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5PkNyZWF0ZXMgYSBydWxlIHRoYXQgdmFsaWRhdGVzIHRoYXQgYSBwcm9wZXJ0eSBoYXMgYSB2YWx1ZS48L3N1bW1hcnk+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJyb290VHlwZVwiIHR5cGU9XCJUeXBlXCI+VGhlIG1vZGVsIHR5cGUgdGhlIHJ1bGUgaXMgZm9yLjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJvcHRpb25zXCIgdHlwZT1cIk9iamVjdFwiPlxyXG5cdFx0Ly8vXHRcdFRoZSBvcHRpb25zIGZvciB0aGUgcnVsZSwgaW5jbHVkaW5nOlxyXG5cdFx0Ly8vXHRcdFx0cHJvcGVydHk6XHRcdFx0dGhlIHByb3BlcnR5IGJlaW5nIHZhbGlkYXRlZCAoZWl0aGVyIGEgUHJvcGVydHkgaW5zdGFuY2Ugb3Igc3RyaW5nIHByb3BlcnR5IG5hbWUpXHJcblx0XHQvLy9cdFx0XHRuYW1lOlx0XHRcdFx0dGhlIG9wdGlvbmFsIHVuaXF1ZSBuYW1lIG9mIHRoZSB0eXBlIG9mIHZhbGlkYXRpb24gcnVsZVxyXG5cdFx0Ly8vXHRcdFx0Y29uZGl0aW9uVHlwZTpcdFx0dGhlIG9wdGlvbmFsIGNvbmRpdGlvbiB0eXBlIHRvIHVzZSwgd2hpY2ggd2lsbCBiZSBhdXRvbWF0aWNhbGx5IGNyZWF0ZWQgaWYgbm90IHNwZWNpZmllZFxyXG5cdFx0Ly8vXHRcdFx0Y2F0ZWdvcnk6XHRcdFx0Q29uZGl0aW9uVHlwZS5FcnJvciB8fCBDb25kaXRpb25UeXBlLldhcm5pbmcgKGRlZmF1bHRzIHRvIENvbmRpdGlvblR5cGUuRXJyb3IpXHJcblx0XHQvLy9cdFx0XHRtZXNzYWdlOlx0XHRcdHRoZSBtZXNzYWdlIHRvIHNob3cgdGhlIHVzZXIgd2hlbiB0aGUgdmFsaWRhdGlvbiBmYWlsc1xyXG5cdFx0Ly8vXHRcdFx0cmVxdWlyZWRWYWx1ZTpcdFx0dGhlIG9wdGlvbmFsIHJlcXVpcmVkIHZhbHVlXHJcblx0XHQvLy8gPC9wYXJhbT5cclxuXHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiUmVxdWlyZWRSdWxlXCI+VGhlIG5ldyByZXF1aXJlZCBydWxlLjwvcmV0dXJucz5cclxuXHJcblx0XHQvLyBlbnN1cmUgdGhlIHJ1bGUgbmFtZSBpcyBzcGVjaWZpZWRcclxuXHRcdG9wdGlvbnMubmFtZSA9IG9wdGlvbnMubmFtZSB8fCBcIlJlcXVpcmVkXCI7XHJcblxyXG5cdFx0Ly8gZW5zdXJlIHRoZSBlcnJvciBtZXNzYWdlIGlzIHNwZWNpZmllZFxyXG5cdFx0b3B0aW9ucy5tZXNzYWdlID0gb3B0aW9ucy5tZXNzYWdlIHx8IFJlc291cmNlLmdldChcInJlcXVpcmVkXCIpO1xyXG5cclxuXHRcdGlmIChvcHRpb25zLnJlcXVpcmVkVmFsdWUpXHJcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJlcXVpcmVkVmFsdWVcIiwgeyB2YWx1ZTogb3B0aW9ucy5yZXF1aXJlZFZhbHVlIH0pO1xyXG5cclxuXHRcdC8vIGNhbGwgdGhlIGJhc2UgdHlwZSBjb25zdHJ1Y3RvclxyXG5cdFx0VmFsaWRhdGVkUHJvcGVydHlSdWxlLmFwcGx5KHRoaXMsIFtyb290VHlwZSwgb3B0aW9uc10pO1xyXG5cdH1cclxuXHJcblx0Ly8gc2V0dXAgdGhlIGluaGVyaXRhbmNlIGNoYWluXHJcblx0UmVxdWlyZWRSdWxlLnByb3RvdHlwZSA9IG5ldyBWYWxpZGF0ZWRQcm9wZXJ0eVJ1bGUoKTtcclxuXHRSZXF1aXJlZFJ1bGUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUmVxdWlyZWRSdWxlO1xyXG5cclxuXHQvLyBkZWZpbmUgYSBnbG9iYWwgZnVuY3Rpb24gdGhhdCBkZXRlcm1pbmVzIGlmIGEgdmFsdWUgZXhpc3RzXHJcblx0UmVxdWlyZWRSdWxlLmhhc1ZhbHVlID0gZnVuY3Rpb24gUmVxdWlyZWRSdWxlJGhhc1ZhbHVlKHZhbCkge1xyXG5cdFx0cmV0dXJuIHZhbCAhPT0gdW5kZWZpbmVkICYmIHZhbCAhPT0gbnVsbCAmJiAodmFsLmNvbnN0cnVjdG9yICE9PSBTdHJpbmcgfHwgdmFsLnRyaW0oKSAhPT0gXCJcIikgJiYgKCEodmFsIGluc3RhbmNlb2YgQXJyYXkpIHx8IHZhbC5sZW5ndGggPiAwKTtcclxuXHR9O1xyXG5cclxuXHQvLyBleHRlbmQgdGhlIGJhc2UgdHlwZVxyXG5cdFJlcXVpcmVkUnVsZS5taXhpbih7XHJcblxyXG5cdFx0Ly8gcmV0dXJucyB0cnVlIGlmIHRoZSBwcm9wZXJ0eSBpcyB2YWxpZCwgb3RoZXJ3aXNlIGZhbHNlXHJcblx0XHRpc1ZhbGlkOiBmdW5jdGlvbiBSZXF1aXJlZFJ1bGUkaXNWYWxpZChvYmosIHByb3AsIHZhbCkge1xyXG5cdFx0XHRpZiAodGhpcy5yZXF1aXJlZFZhbHVlKVxyXG5cdFx0XHRcdHJldHVybiB2YWwgPT09IHRoaXMucmVxdWlyZWRWYWx1ZTtcclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdHJldHVybiBSZXF1aXJlZFJ1bGUuaGFzVmFsdWUodmFsKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gZ2V0IHRoZSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIHJ1bGVcclxuXHRcdHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHJldHVybiAkZm9ybWF0KFwiezB9LnsxfSBpcyByZXF1aXJlZFwiLCBbdGhpcy5wcm9wZXJ0eS5nZXRfY29udGFpbmluZ1R5cGUoKS5nZXRfZnVsbE5hbWUoKSwgdGhpcy5wcm9wZXJ0eS5nZXRfbmFtZSgpXSk7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vIEV4cG9zZSB0aGUgcnVsZSBwdWJsaWNseVxyXG5cdFJ1bGUucmVxdWlyZWQgPSBSZXF1aXJlZFJ1bGU7XHJcblx0RXhvV2ViLk1vZGVsLlJlcXVpcmVkUnVsZSA9IFJlcXVpcmVkUnVsZTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5Nb2RlbC5WYWxpZGF0aW9uUnVsZVxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIFZhbGlkYXRpb25SdWxlKHJvb3RUeXBlLCBvcHRpb25zKSB7XHJcblx0XHQvLy8gPHN1bW1hcnk+Q3JlYXRlcyBhIHJ1bGUgdGhhdCBwZXJmb3JtcyBjdXN0b20gdmFsaWRhdGlvbiBmb3IgYSBwcm9wZXJ0eS48L3N1bW1hcnk+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJyb290VHlwZVwiIHR5cGU9XCJUeXBlXCI+VGhlIG1vZGVsIHR5cGUgdGhlIHJ1bGUgaXMgZm9yLjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJvcHRpb25zXCIgdHlwZT1cIk9iamVjdFwiPlxyXG5cdFx0Ly8vXHRcdFRoZSBvcHRpb25zIGZvciB0aGUgcnVsZSwgaW5jbHVkaW5nOlxyXG5cdFx0Ly8vXHRcdFx0cHJvcGVydHk6XHRcdFx0dGhlIHByb3BlcnR5IGJlaW5nIHZhbGlkYXRlZCAoZWl0aGVyIGEgUHJvcGVydHkgaW5zdGFuY2Ugb3Igc3RyaW5nIHByb3BlcnR5IG5hbWUpXHJcblx0XHQvLy9cdFx0XHRuYW1lOlx0XHRcdFx0dGhlIG9wdGlvbmFsIHVuaXF1ZSBuYW1lIG9mIHRoZSB0eXBlIG9mIHZhbGlkYXRpb24gcnVsZVxyXG5cdFx0Ly8vXHRcdFx0Y29uZGl0aW9uVHlwZTpcdFx0dGhlIG9wdGlvbmFsIGNvbmRpdGlvbiB0eXBlIHRvIHVzZSwgd2hpY2ggd2lsbCBiZSBhdXRvbWF0aWNhbGx5IGNyZWF0ZWQgaWYgbm90IHNwZWNpZmllZFxyXG5cdFx0Ly8vXHRcdFx0Y2F0ZWdvcnk6XHRcdFx0Q29uZGl0aW9uVHlwZS5FcnJvciB8fCBDb25kaXRpb25UeXBlLldhcm5pbmcgKGRlZmF1bHRzIHRvIENvbmRpdGlvblR5cGUuRXJyb3IpXHJcblx0XHQvLy9cdFx0XHRtZXNzYWdlOlx0XHRcdHRoZSBtZXNzYWdlIHRvIHNob3cgdGhlIHVzZXIgd2hlbiB0aGUgdmFsaWRhdGlvbiBmYWlsc1xyXG5cdFx0Ly8vXHRcdFx0cmVxdWlyZWRWYWx1ZTpcdFx0dGhlIG9wdGlvbmFsIHJlcXVpcmVkIHZhbHVlXHJcblx0XHQvLy8gPC9wYXJhbT5cclxuXHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiUmVxdWlyZWRSdWxlXCI+VGhlIG5ldyByZXF1aXJlZCBydWxlLjwvcmV0dXJucz5cclxuXHJcblx0XHQvLyBlbnN1cmUgdGhlIHJ1bGUgbmFtZSBpcyBzcGVjaWZpZWRcclxuXHRcdG9wdGlvbnMubmFtZSA9IG9wdGlvbnMubmFtZSB8fCBcIlZhbGlkYXRpb25cIjtcclxuXHRcclxuXHRcdGlmIChvcHRpb25zLm1lc3NhZ2UpIHtcclxuXHRcdFx0Ly8gRXZhbHVhdGUgdGhlIG1lc3NhZ2UgYXMgYSBsb2NhbGl6YWJsZSByZXNvdXJjZVxyXG5cdFx0XHRpZiAoUmVzb3VyY2UuZ2V0KG9wdGlvbnMubWVzc2FnZSkpXHJcblx0XHRcdFx0b3B0aW9ucy5tZXNzYWdlID0gUmVzb3VyY2UuZ2V0KG9wdGlvbnMubWVzc2FnZSk7XHJcblx0XHR9IGVsc2UgaWYgKG9wdGlvbnMubWVzc2FnZUZuKSB7XHJcblx0XHRcdC8vIFN0b3JlIHRoZSBtZXNzYWdlIGZ1bmN0aW9uIGlmIHNwZWNpZmllZFxyXG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJtZXNzYWdlRm5cIiwgeyB2YWx1ZTogb3B0aW9ucy5tZXNzYWdlRm4sIHdyaXRhYmxlOiB0cnVlIH0pO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0Ly8gU2V0IGEgZGVmYXVsdCBlcnJvciBtZXNzYWdlIGlzIG9uZSBpcyBub3Qgc3BlY2lmaWVkXHJcblx0XHRcdG9wdGlvbnMubWVzc2FnZSA9IFJlc291cmNlLmdldChcInZhbGlkYXRpb25cIik7XHJcblx0XHR9XHJcblx0XHJcblx0XHQvLyBwcmVkaWNhdGUtYmFzZWQgcnVsZVxyXG5cdFx0aWYgKG9wdGlvbnMuaXNFcnJvciB8fCBvcHRpb25zLmZuKSB7XHJcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImlzRXJyb3JcIiwgeyB2YWx1ZTogb3B0aW9ucy5pc0Vycm9yIHx8IG9wdGlvbnMuZm4sIHdyaXRhYmxlOiB0cnVlIH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGNhbGwgdGhlIGJhc2UgdHlwZSBjb25zdHJ1Y3RvclxyXG5cdFx0VmFsaWRhdGVkUHJvcGVydHlSdWxlLmFwcGx5KHRoaXMsIFtyb290VHlwZSwgb3B0aW9uc10pO1xyXG5cdH1cclxuXHJcblx0Ly8gc2V0dXAgdGhlIGluaGVyaXRhbmNlIGNoYWluXHJcblx0VmFsaWRhdGlvblJ1bGUucHJvdG90eXBlID0gbmV3IFZhbGlkYXRlZFByb3BlcnR5UnVsZSgpO1xyXG5cdFZhbGlkYXRpb25SdWxlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFZhbGlkYXRpb25SdWxlO1xyXG5cclxuXHQvLyBleHRlbmQgdGhlIGJhc2UgdHlwZVxyXG5cdFZhbGlkYXRpb25SdWxlLm1peGluKHtcclxuXHJcblx0XHRtZXNzYWdlOiBmdW5jdGlvbiAob2JqKSB7XHJcblx0XHRcdHZhciBtZXNzYWdlID0gXCJcIjtcclxuXHRcdFx0dmFyIHByb3AgPSB0aGlzLnByb3BlcnR5O1xyXG5cdFx0XHR2YXIgaGFzVG9rZW5zID0gRm9ybWF0Lmhhc1Rva2Vucyhwcm9wLmdldF9sYWJlbCgpKTtcclxuXHJcblx0XHRcdGlmICh0aGlzLm1lc3NhZ2VGbikge1xyXG5cdFx0XHRcdC8vIGNvbnZlcnQgc3RyaW5nIGZ1bmN0aW9ucyBpbnRvIGNvbXBpbGVkIGZ1bmN0aW9ucyBvbiBmaXJzdCBleGVjdXRpb25cclxuXHRcdFx0XHRpZiAodGhpcy5tZXNzYWdlRm4uY29uc3RydWN0b3IgPT09IFN0cmluZykge1xyXG5cdFx0XHRcdFx0dGhpcy5tZXNzYWdlRm4gPSB0aGlzLnJvb3RUeXBlLmNvbXBpbGVFeHByZXNzaW9uKHRoaXMubWVzc2FnZUZuKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIEludm9rZSB0aGUgZnVuY3Rpb24gYm91bmQgdG8gdGhlIGVudGl0eSwgYW5kIGFsc28gcGFzcyB0aGUgZW50aXR5IGFzIHRoZSBhcmd1bWVudFxyXG5cdFx0XHRcdC8vIFRoaXMgaXMgY29uc2l0ZW50IHdpdGggaG93IHJ1bGUgJ21lc3NhZ2UnIG9wdGlvbiB0aGF0IGlzIGFuIG93biBwcm9wZXJ0eSBpcyBjYWxsZWQgaW4gdGhpcyBtYW5uZXIgKHNlZTogQ29uZGl0aW9uUnVsZS5qcylcclxuXHRcdFx0XHRtZXNzYWdlID0gdGhpcy5tZXNzYWdlRm4uYXBwbHkob2JqLCBbb2JqXSk7XHJcblxyXG5cdFx0XHRcdC8vIENvbnZlcnQgYSBub24tc3RyaW5nIG1lc3NhZ2UgaW50byBhIHN0cmluZ1xyXG5cdFx0XHRcdGlmIChtZXNzYWdlICE9IG51bGwgJiYgdHlwZW9mIG1lc3NhZ2UgIT09IFwic3RyaW5nXCIpIHtcclxuXHRcdFx0XHRcdGxvZ1dhcm5pbmcoXCJDb252ZXJ0aW5nIG1lc3NhZ2Ugb2YgdHlwZSAnXCIgKyAodHlwZW9mIG1lc3NhZ2UpICsgXCInIGZvciBydWxlICdcIiArIHRoaXMubmFtZSArIFwiJyB0byBhIHN0cmluZy5cIik7XHJcblx0XHRcdFx0XHRtZXNzYWdlID0gbWVzc2FnZS50b1N0cmluZygpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHQvLyBGYWxsIGJhY2sgdG8gdGhlIGRlZmF1bHQgdmFsaWRhdGlvbiBtZXNzYWdlXHJcblx0XHRcdFx0bWVzc2FnZSA9IFJlc291cmNlLmdldChcInZhbGlkYXRpb25cIik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIFJlcGxhY2UgdGhlIHtwcm9wZXJ0eX0gdG9rZW4gd2l0aCB0aGUgcHJvcGVydHkgbGFiZWwgKG9yIGV2YWx1YXRlZCBsYWJlbCBmb3JtYXQpXHJcblx0XHRcdG1lc3NhZ2UgPSBtZXNzYWdlLnJlcGxhY2UoXCJ7cHJvcGVydHl9XCIsIGhhc1Rva2VucyA/IHRoaXMuZ2V0UHJvcGVydHlMYWJlbEZvcm1hdCgpLmNvbnZlcnQob2JqKSA6IHByb3AuZ2V0X2xhYmVsKCkpO1xyXG5cclxuXHRcdFx0cmV0dXJuIG1lc3NhZ2U7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIHJldHVybnMgdHJ1ZSBpZiB0aGUgcHJvcGVydHkgaXMgdmFsaWQsIG90aGVyd2lzZSBmYWxzZVxyXG5cdFx0aXNWYWxpZDogZnVuY3Rpb24gVmFsaWRhdGlvblJ1bGUkaXNWYWxpZChvYmosIHByb3AsIHZhbCkge1x0XHRcclxuXHRcdFx0Ly8gY29udmVydCBzdHJpbmcgZnVuY3Rpb25zIGludG8gY29tcGlsZWQgZnVuY3Rpb25zIG9uIGZpcnN0IGV4ZWN1dGlvblxyXG5cdFx0XHRpZiAodGhpcy5pc0Vycm9yLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHtcclxuXHRcdFx0XHR0aGlzLmlzRXJyb3IgPSB0aGlzLnJvb3RUeXBlLmNvbXBpbGVFeHByZXNzaW9uKHRoaXMuaXNFcnJvcik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRyeSB7XHJcblx0XHRcdFx0aWYgKCF0aGlzLmlzRXJyb3IuYXBwbHkob2JqLCBbb2JqXSkpIHtcclxuXHRcdFx0XHRcdC8vIFRoZSAnaXNFcnJvcicgZnVuY3Rpb24gcmV0dXJuZWQgZmFsc2UsIHNvIGNvbnNpZGVyIHRoZSBvYmplY3QgdG8gYmUgdmFsaWRcclxuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHR2YXIgbWVzc2FnZSA9IHRoaXMubWVzc2FnZTtcclxuXHRcdFx0XHRcdGlmIChtZXNzYWdlIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuXHRcdFx0XHRcdFx0aWYgKHRoaXMuaGFzT3duUHJvcGVydHkoXCJtZXNzYWdlXCIpKSB7XHJcblx0XHRcdFx0XHRcdFx0Ly8gV2hlbiBtZXNzYWdlIGlzIG92ZXJyaWRlbiwgdXNlIHRoZSByb290IG9iamVjdCBhcyB0aGlzIChzZWU6IENvbmRpdGlvblJ1bGUuanMpXHJcblx0XHRcdFx0XHRcdFx0bWVzc2FnZSA9IG1lc3NhZ2UuYmluZChvYmopO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdG1lc3NhZ2UgPSBtZXNzYWdlLmJpbmQodGhpcyk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdC8vIEludm9rZSB0aGUgbWVzc2FnZSBmdW5jdGlvbiB0byBlbnN1cmUgdGhhdCBpdCB3aWxsIHByb2R1Y2UgYSB2YWx1ZVxyXG5cdFx0XHRcdFx0XHRtZXNzYWdlID0gbWVzc2FnZShvYmopO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdC8vIElmIHRoZXJlIGlzIG5vIG1lc3NhZ2UsIHRoZW4gY29uc2lkZXIgdGhlIG9iamVjdCB0byBiZSB2YWxpZFxyXG5cdFx0XHRcdFx0cmV0dXJuICFtZXNzYWdlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRjYXRjaCAoZSkge1xyXG5cdFx0XHRcdC8vIElmICdpc0Vycm9yJyBvciAnbWVzc2FnZUZuJyB0aHJvd3MgYW4gZXJyb3IsIHRoZW4gY29uc2lkZXIgdGhlIG9iamVjdCB0byBiZSB2YWxpZFxyXG5cdFx0XHRcdGxvZ1dhcm5pbmcoZSk7XHJcblx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gZ2V0IHRoZSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIHJ1bGVcclxuXHRcdHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHJldHVybiAkZm9ybWF0KFwiezB9LnsxfSBpcyBpbnZhbGlkXCIsIFt0aGlzLnByb3BlcnR5LmdldF9jb250YWluaW5nVHlwZSgpLmdldF9mdWxsTmFtZSgpLCB0aGlzLnByb3BlcnR5LmdldF9uYW1lKCldKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0Ly8gRXhwb3NlIHRoZSBydWxlIHB1YmxpY2x5XHJcblx0UnVsZS52YWxpZGF0aW9uID0gVmFsaWRhdGlvblJ1bGU7XHJcblx0RXhvV2ViLk1vZGVsLlZhbGlkYXRpb25SdWxlID0gVmFsaWRhdGlvblJ1bGU7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuTW9kZWwuUmFuZ2VSdWxlXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gUmFuZ2VSdWxlKHJvb3RUeXBlLCBvcHRpb25zKSB7XHJcblx0XHQvLy8gPHN1bW1hcnk+Q3JlYXRlcyBhIHJ1bGUgdGhhdCB2YWxpZGF0ZXMgYSBwcm9wZXJ0eSB2YWx1ZSBpcyB3aXRoaW4gYSBzcGVjaWZpYyByYW5nZS48L3N1bW1hcnk+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJyb290VHlwZVwiIHR5cGU9XCJUeXBlXCI+VGhlIG1vZGVsIHR5cGUgdGhlIHJ1bGUgaXMgZm9yLjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJvcHRpb25zXCIgdHlwZT1cIk9iamVjdFwiPlxyXG5cdFx0Ly8vXHRcdFRoZSBvcHRpb25zIGZvciB0aGUgcnVsZSwgaW5jbHVkaW5nOlxyXG5cdFx0Ly8vXHRcdFx0cHJvcGVydHk6XHRcdFx0dGhlIHByb3BlcnR5IGJlaW5nIHZhbGlkYXRlZCAoZWl0aGVyIGEgUHJvcGVydHkgaW5zdGFuY2Ugb3Igc3RyaW5nIHByb3BlcnR5IG5hbWUpXHJcblx0XHQvLy9cdFx0XHRtaW46XHRcdFx0XHR0aGUgbWluaW11bSB2YWxpZCB2YWx1ZSBvZiB0aGUgcHJvcGVydHlcclxuXHRcdC8vL1x0XHRcdG1heDpcdFx0XHRcdHRoZSBtYXhpbXVtIHZhbGlkIHZhbHVlIG9mIHRoZSBwcm9wZXJ0eVxyXG5cdFx0Ly8vXHRcdFx0bWluRm46XHRcdFx0XHRhIGZ1bmN0aW9uIHJldHVybmluZyB0aGUgbWluaW11bSB2YWxpZCB2YWx1ZSBvZiB0aGUgcHJvcGVydHlcclxuXHRcdC8vL1x0XHRcdG1heEZuOlx0XHRcdFx0YSBmdW5jdGlvbiByZXR1cm5pbmcgdGhlIG1heGltdW0gdmFsaWQgdmFsdWUgb2YgdGhlIHByb3BlcnR5XHJcblx0XHQvLy9cdFx0XHRuYW1lOlx0XHRcdFx0dGhlIG9wdGlvbmFsIHVuaXF1ZSBuYW1lIG9mIHRoZSB0eXBlIG9mIHZhbGlkYXRpb24gcnVsZVxyXG5cdFx0Ly8vXHRcdFx0Y29uZGl0aW9uVHlwZTpcdFx0dGhlIG9wdGlvbmFsIGNvbmRpdGlvbiB0eXBlIHRvIHVzZSwgd2hpY2ggd2lsbCBiZSBhdXRvbWF0aWNhbGx5IGNyZWF0ZWQgaWYgbm90IHNwZWNpZmllZFxyXG5cdFx0Ly8vXHRcdFx0Y2F0ZWdvcnk6XHRcdFx0Q29uZGl0aW9uVHlwZS5FcnJvciB8fCBDb25kaXRpb25UeXBlLldhcm5pbmcgKGRlZmF1bHRzIHRvIENvbmRpdGlvblR5cGUuRXJyb3IpXHJcblx0XHQvLy9cdFx0XHRtZXNzYWdlOlx0XHRcdHRoZSBtZXNzYWdlIHRvIHNob3cgdGhlIHVzZXIgd2hlbiB0aGUgdmFsaWRhdGlvbiBmYWlsc1xyXG5cdFx0Ly8vXHRcdCAgICBvbkNoYW5nZU9mOlx0XHRcdGFuIGFycmF5IG9mIHByb3BlcnR5IHBhdGhzIChzdHJpbmdzLCBQcm9wZXJ0eSBvciBQcm9wZXJ0eUNoYWluIGluc3RhbmNlcykgdGhhdCBkcml2ZSB3aGVuIHRoZSBydWxlIHNob3VsZCBleGVjdXRlIGR1ZSB0byBwcm9wZXJ0eSBjaGFuZ2VzXHJcblx0XHQvLy8gPC9wYXJhbT5cclxuXHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiUmFuZ2VSdWxlXCI+VGhlIG5ldyByYW5nZSBydWxlLjwvcmV0dXJucz5cclxuXHJcblx0XHQvLyBleGl0IGltbWVkaWF0ZWx5IGlmIGNhbGxlZCB3aXRoIG5vIGFyZ3VtZW50c1xyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMCkgcmV0dXJuO1xyXG5cclxuXHRcdC8vIGVuc3VyZSB0aGUgcnVsZSBuYW1lIGlzIHNwZWNpZmllZFxyXG5cdFx0b3B0aW9ucy5uYW1lID0gb3B0aW9ucy5uYW1lIHx8IFwiUmFuZ2VcIjtcclxuXHJcblx0XHQvLyBnZXQgdGhlIHByb3BlcnR5IGJlaW5nIHZhbGlkYXRlZCBpbiBvcmRlciB0byBkZXRlcm1pbmUgdGhlIGRhdGEgdHlwZVxyXG5cdFx0dmFyIHByb3BlcnR5ID0gb3B0aW9ucy5wcm9wZXJ0eSBpbnN0YW5jZW9mIFByb3BlcnR5ID8gb3B0aW9ucy5wcm9wZXJ0eSA6IHJvb3RUeXBlLnByb3BlcnR5KG9wdGlvbnMucHJvcGVydHkpO1xyXG5cclxuXHRcdC8vIGNvZXJjZSBkYXRlIHJhbmdlIGNvbnN0YW50c1xyXG5cdFx0aWYgKG9wdGlvbnMubWluICYmIHByb3BlcnR5LmdldF9qc3R5cGUoKSA9PT0gRGF0ZSkge1xyXG5cdFx0XHRvcHRpb25zLm1pbiA9IG5ldyBEYXRlKG9wdGlvbnMubWluKTtcclxuXHRcdH1cclxuXHRcdGlmIChvcHRpb25zLm1heCAmJiBwcm9wZXJ0eS5nZXRfanN0eXBlKCkgPT09IERhdGUpIHtcclxuXHRcdFx0b3B0aW9ucy5tYXggPSBuZXcgRGF0ZShvcHRpb25zLm1heCk7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gY29lcmNlIG51bGwgcmFuZ2VzIHRvIHVuZGVmaW5lZFxyXG5cdFx0aWYgKG9wdGlvbnMubWluID09PSBudWxsKSB7XHJcblx0XHRcdG9wdGlvbnMubWluID0gdW5kZWZpbmVkO1xyXG5cdFx0fVxyXG5cdFx0aWYgKG9wdGlvbnMubWF4ID09PSBudWxsKSB7XHJcblx0XHRcdG9wdGlvbnMubWF4ID0gdW5kZWZpbmVkO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGNvbnZlcnQgY29uc3RhbnQgdmFsdWVzIGludG8gZnVuY3Rpb25zXHJcblx0XHRpZiAoIW9wdGlvbnMubWluRm4pIHtcclxuXHRcdFx0b3B0aW9ucy5taW5GbiA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gb3B0aW9ucy5taW47IH07XHJcblx0XHR9XHJcblx0XHRpZiAoIW9wdGlvbnMubWF4Rm4pIHtcclxuXHRcdFx0b3B0aW9ucy5tYXhGbiA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gb3B0aW9ucy5tYXg7IH07XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gU3RvcmUgdGhlIG1pbiBhbmQgbWF4IGZ1bmN0aW9uc1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwibWluXCIsIHsgdmFsdWU6IG9wdGlvbnMubWluRm4sIHdyaXRhYmxlOiB0cnVlIH0pO1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwibWF4XCIsIHsgdmFsdWU6IG9wdGlvbnMubWF4Rm4sIHdyaXRhYmxlOiB0cnVlIH0pO1xyXG5cclxuXHRcdC8vIGNhbGwgdGhlIGJhc2UgdHlwZSBjb25zdHJ1Y3RvclxyXG5cdFx0VmFsaWRhdGVkUHJvcGVydHlSdWxlLmFwcGx5KHRoaXMsIFtyb290VHlwZSwgb3B0aW9uc10pO1xyXG5cdH1cclxuXHJcblx0Ly8gc2V0dXAgdGhlIGluaGVyaXRhbmNlIGNoYWluXHJcblx0UmFuZ2VSdWxlLnByb3RvdHlwZSA9IG5ldyBWYWxpZGF0ZWRQcm9wZXJ0eVJ1bGUoKTtcclxuXHRSYW5nZVJ1bGUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUmFuZ2VSdWxlO1xyXG5cclxuXHQvLyBleHRlbmQgdGhlIGJhc2UgdHlwZVxyXG5cdFJhbmdlUnVsZS5taXhpbih7XHJcblxyXG5cdFx0Ly8gZ2V0IHRoZSBtaW4gYW5kIG1heCByYW5nZSBpbiBlZmZlY3QgZm9yIHRoaXMgcnVsZSBmb3IgdGhlIHNwZWNpZmllZCBpbnN0YW5jZVxyXG5cdFx0cmFuZ2U6IGZ1bmN0aW9uIFJhbmdlUnVsZSRyYW5nZShvYmopIHtcclxuXHJcblx0XHRcdC8vIGNvbnZlcnQgc3RyaW5nIGZ1bmN0aW9ucyBpbnRvIGNvbXBpbGVkIGZ1bmN0aW9ucyBvbiBmaXJzdCBleGVjdXRpb25cclxuXHRcdFx0aWYgKHRoaXMubWluICYmIHRoaXMubWluLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHtcclxuXHRcdFx0XHR0aGlzLm1pbiA9IHRoaXMucm9vdFR5cGUuY29tcGlsZUV4cHJlc3Npb24odGhpcy5taW4pO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh0aGlzLm1heCAmJiB0aGlzLm1heC5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XHJcblx0XHRcdFx0dGhpcy5tYXggPSB0aGlzLnJvb3RUeXBlLmNvbXBpbGVFeHByZXNzaW9uKHRoaXMubWF4KTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gZGV0ZXJtaW5lIHRoZSBtaW4gYW5kIG1heCB2YWx1ZXMgYmFzZWQgb24gdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIGluc3RhbmNlXHJcblx0XHRcdHZhciByYW5nZSA9IHsgfTtcclxuXHRcdFx0dHJ5IHsgcmFuZ2UubWluID0gdGhpcy5taW4uY2FsbChvYmopOyB9XHRjYXRjaCAoZSkgeyB9XHJcblx0XHRcdHRyeSB7IHJhbmdlLm1heCA9IHRoaXMubWF4LmNhbGwob2JqKTsgfVx0Y2F0Y2ggKGUpIHsgfVxyXG5cdFx0XHRyYW5nZS5taW4gPSByYW5nZS5taW4gPT0gbnVsbCA/IHVuZGVmaW5lZCA6IHJhbmdlLm1pbjtcclxuXHRcdFx0cmFuZ2UubWF4ID0gcmFuZ2UubWF4ID09IG51bGwgPyB1bmRlZmluZWQgOiByYW5nZS5tYXg7XHJcblxyXG5cdFx0XHRyZXR1cm4gcmFuZ2U7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIHJldHVybnMgdHJ1ZSBpZiB0aGUgcHJvcGVydHkgaXMgdmFsaWQsIG90aGVyd2lzZSBmYWxzZVxyXG5cdFx0aXNWYWxpZDogZnVuY3Rpb24gUmFuZ2VSdWxlJGlzVmFsaWQob2JqLCBwcm9wLCB2YWwpIHsgXHJcblxyXG5cdFx0XHR2YXIgcmFuZ2UgPSB0aGlzLnJhbmdlKG9iaik7XHJcblxyXG5cdFx0XHRyZXR1cm4gdmFsID09PSBudWxsIHx8IHZhbCA9PT0gdW5kZWZpbmVkIHx8ICgocmFuZ2UubWluID09PSB1bmRlZmluZWQgfHwgdmFsID49IHJhbmdlLm1pbikgJiYgKHJhbmdlLm1heCA9PT0gdW5kZWZpbmVkIHx8IHZhbCA8PSByYW5nZS5tYXgpKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0bWVzc2FnZTogZnVuY3Rpb24gUmFuZ2VSdWxlJG1lc3NhZ2Uob2JqKSB7XHJcblxyXG5cdFx0XHR2YXIgcmFuZ2UgPSB0aGlzLnJhbmdlKG9iaik7XHJcblxyXG5cdFx0XHQvLyBlbnN1cmUgdGhlIGVycm9yIG1lc3NhZ2UgaXMgc3BlY2lmaWVkXHJcblx0XHRcdHZhciBtZXNzYWdlID1cclxuXHRcdFx0XHQocmFuZ2UubWluICE9PSB1bmRlZmluZWQgJiYgcmFuZ2UubWF4ICE9PSB1bmRlZmluZWQgPyBSZXNvdXJjZS5nZXQoXCJyYW5nZS1iZXR3ZWVuXCIpLnJlcGxhY2UoXCJ7bWlufVwiLCB0aGlzLnByb3BlcnR5LmZvcm1hdChyYW5nZS5taW4pKS5yZXBsYWNlKFwie21heH1cIiwgdGhpcy5wcm9wZXJ0eS5mb3JtYXQocmFuZ2UubWF4KSkgOiAvLyBiZXR3ZWVuIGRhdGUgb3Igb3JkaW5hbFxyXG5cdFx0XHRcdFx0dGhpcy5wcm9wZXJ0eS5nZXRfanN0eXBlKCkgPT09IERhdGUgP1xyXG5cdFx0XHRcdFx0XHRyYW5nZS5taW4gIT09IHVuZGVmaW5lZCA/XHJcblx0XHRcdFx0XHRcdFx0UmVzb3VyY2UuZ2V0KFwicmFuZ2Utb24tb3ItYWZ0ZXJcIikucmVwbGFjZShcInttaW59XCIsIHRoaXMucHJvcGVydHkuZm9ybWF0KHJhbmdlLm1pbikpIDogLy8gb24gb3IgYWZ0ZXIgZGF0ZVxyXG5cdFx0XHRcdFx0XHRcdFJlc291cmNlLmdldChcInJhbmdlLW9uLW9yLWJlZm9yZVwiKS5yZXBsYWNlKFwie21heH1cIiwgdGhpcy5wcm9wZXJ0eS5mb3JtYXQocmFuZ2UubWF4KSkgOiAvLyBvbiBvciBiZWZvcmUgZGF0ZVxyXG5cdFx0XHRcdFx0XHRyYW5nZS5taW4gIT09IHVuZGVmaW5lZCA/XHJcblx0XHRcdFx0XHRcdFx0UmVzb3VyY2UuZ2V0KFwicmFuZ2UtYXQtbGVhc3RcIikucmVwbGFjZShcInttaW59XCIsIHRoaXMucHJvcGVydHkuZm9ybWF0KHJhbmdlLm1pbikpIDogLy8gYXQgbGVhc3Qgb3JkaW5hbFxyXG5cdFx0XHRcdFx0XHRcdFJlc291cmNlLmdldChcInJhbmdlLWF0LW1vc3RcIikucmVwbGFjZShcInttYXh9XCIsIHRoaXMucHJvcGVydHkuZm9ybWF0KHJhbmdlLm1heCkpKTsgLy8gYXQgbW9zdCBvcmRpbmFsXHJcblxyXG5cdFx0XHRyZXR1cm4gbWVzc2FnZS5yZXBsYWNlKCd7cHJvcGVydHl9JywgdGhpcy5nZXRQcm9wZXJ0eUxhYmVsKG9iaikpO1x0XHRcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gZ2V0IHRoZSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIHJ1bGVcclxuXHRcdHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHJldHVybiAkZm9ybWF0KFwiezB9LnsxfSBpbiByYW5nZSwgbWluOiB7Mn0sIG1heDogezN9XCIsXHJcblx0XHRcdFx0W3RoaXMuZ2V0X3Byb3BlcnR5KCkuZ2V0X2NvbnRhaW5pbmdUeXBlKCkuZ2V0X2Z1bGxOYW1lKCksXHJcblx0XHRcdFx0dGhpcy5nZXRfcHJvcGVydHkoKS5nZXRfbmFtZSgpLFxyXG5cdFx0XHRcdHRoaXMubWluID8gXCJcIiA6IHRoaXMubWluLFxyXG5cdFx0XHRcdHRoaXMubWF4ID8gXCJcIiA6IHRoaXMubWF4XSk7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vIEV4cG9zZSB0aGUgcnVsZSBwdWJsaWNseVxyXG5cdFJ1bGUucmFuZ2UgPSBSYW5nZVJ1bGU7XHJcblx0RXhvV2ViLk1vZGVsLlJhbmdlUnVsZSA9IFJhbmdlUnVsZTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5Nb2RlbC5BbGxvd2VkVmFsdWVzUnVsZVxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIEFsbG93ZWRWYWx1ZXNSdWxlKHJvb3RUeXBlLCBvcHRpb25zKSB7XHJcblx0XHQvLy8gPHN1bW1hcnk+Q3JlYXRlcyBhIHJ1bGUgdGhhdCB2YWxpZGF0ZXMgd2hldGhlciBhIHNlbGVjdGVkIHZhbHVlIG9yIHZhbHVlcyBpcyBpbiBhIGxpc3Qgb2YgYWxsb3dlZCB2YWx1ZXMuPC9zdW1tYXJ5PlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwicm9vdFR5cGVcIiB0eXBlPVwiVHlwZVwiPlRoZSBtb2RlbCB0eXBlIHRoZSBydWxlIGlzIGZvci48L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwib3B0aW9uc1wiIHR5cGU9XCJPYmplY3RcIj5cclxuXHRcdC8vL1x0XHRUaGUgb3B0aW9ucyBmb3IgdGhlIHJ1bGUsIGluY2x1ZGluZzpcclxuXHRcdC8vL1x0XHRcdHByb3BlcnR5Olx0XHR0aGUgcHJvcGVydHkgYmVpbmcgdmFsaWRhdGVkIChlaXRoZXIgYSBQcm9wZXJ0eSBpbnN0YW5jZSBvciBzdHJpbmcgcHJvcGVydHkgbmFtZSlcclxuXHRcdC8vL1x0XHRcdHNvdXJjZTpcdFx0XHR0aGUgc291cmNlIHByb3BlcnR5IGZvciB0aGUgYWxsb3dlZCB2YWx1ZXMgKGVpdGhlciBhIFByb3BlcnR5IG9yIFByb3BlcnR5Q2hhaW4gaW5zdGFuY2Ugb3IgYSBzdHJpbmcgcHJvcGVydHkgcGF0aClcclxuXHRcdC8vL1x0XHRcdG5hbWU6XHRcdFx0dGhlIG9wdGlvbmFsIHVuaXF1ZSBuYW1lIG9mIHRoZSBydWxlXHJcblx0XHQvLy9cdFx0XHRjb25kaXRpb25UeXBlOlx0dGhlIG9wdGlvbmFsIGNvbmRpdGlvbiB0eXBlIHRvIHVzZSwgd2hpY2ggd2lsbCBiZSBhdXRvbWF0aWNhbGx5IGNyZWF0ZWQgaWYgbm90IHNwZWNpZmllZFxyXG5cdFx0Ly8vXHRcdFx0Y2F0ZWdvcnk6XHRcdENvbmRpdGlvblR5cGUuRXJyb3IgfHwgQ29uZGl0aW9uVHlwZS5XYXJuaW5nLCBkZWZhdWx0cyB0byBDb25kaXRpb25UeXBlLkVycm9yIGlmIG5vdCBzcGVjaWZpZWRcclxuXHRcdC8vL1x0XHRcdG1lc3NhZ2U6XHRcdHRoZSBtZXNzYWdlIHRvIHNob3cgdGhlIHVzZXIgd2hlbiB0aGUgdmFsaWRhdGlvbiBmYWlsc1xyXG5cdFx0Ly8vIDwvcGFyYW0+XHJcblx0XHQvLy8gPHJldHVybnMgdHlwZT1cIkFsbG93ZWRWYWx1ZXNSdWxlXCI+VGhlIG5ldyBhbGxvd2VkIHZhbHVlcyBydWxlLjwvcmV0dXJucz5cclxuXHJcblx0XHQvLyBlbnN1cmUgdGhlIHJ1bGUgbmFtZSBpcyBzcGVjaWZpZWRcclxuXHRcdG9wdGlvbnMubmFtZSA9IG9wdGlvbnMubmFtZSB8fCBcIkFsbG93ZWRWYWx1ZXNcIjtcclxuXHJcblx0XHQvLyBlbnN1cmUgdGhlIGVycm9yIG1lc3NhZ2UgaXMgc3BlY2lmaWVkXHJcblx0XHRvcHRpb25zLm1lc3NhZ2UgPSBvcHRpb25zLm1lc3NhZ2UgfHwgUmVzb3VyY2UuZ2V0KFwiYWxsb3dlZC12YWx1ZXNcIik7XHJcblxyXG5cdFx0Ly8gZGVmaW5lIHByb3BlcnRpZXMgZm9yIHRoZSBydWxlXHJcblx0XHRpZiAob3B0aW9ucy5zb3VyY2UgaW5zdGFuY2VvZiBQcm9wZXJ0eSB8fCBvcHRpb25zLnNvdXJjZSBpbnN0YW5jZW9mIFByb3BlcnR5Q2hhaW4pIHtcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwic291cmNlUGF0aFwiLCB7IHZhbHVlOiBvcHRpb25zLnNvdXJjZS5nZXRfcGF0aCgpIH0pO1xyXG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJzb3VyY2VcIiwgeyB2YWx1ZTogb3B0aW9ucy5zb3VyY2UgfSk7XHJcblx0XHRcdG9wdGlvbnMub25DaGFuZ2VPZiA9IFtvcHRpb25zLnNvdXJjZV07XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChvcHRpb25zLnNvdXJjZSBpbnN0YW5jZW9mIEZ1bmN0aW9uIHx8IG9wdGlvbnMuZm4pIHtcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwic291cmNlRm5cIiwgeyB2YWx1ZTogb3B0aW9ucy5zb3VyY2UgfHwgb3B0aW9ucy5mbiwgd3JpdGFibGU6IHRydWUgfSk7XHJcblx0XHRcdG9wdGlvbnMuZm4gPSBudWxsO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInNvdXJjZVBhdGhcIiwgeyB2YWx1ZTogb3B0aW9ucy5zb3VyY2UgfSk7XHJcblx0XHRcdG9wdGlvbnMub25DaGFuZ2VPZiA9IFtvcHRpb25zLnNvdXJjZV07XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKG9wdGlvbnMuaWdub3JlVmFsaWRhdGlvbikge1xyXG5cdFx0ICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImlnbm9yZVZhbGlkYXRpb25cIiwgeyB2YWx1ZTogb3B0aW9ucy5pZ25vcmVWYWxpZGF0aW9uIH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGNyZWF0ZSBhIHByb3BlcnR5IHNwZWNpZmllZCBjb25kaXRpb24gdHlwZSBpZiBub3QgcGFzc2VkIGluLCBkZWZhdWx0aW5nIHRvIEVycm9yIGlmIGEgY29uZGl0aW9uIGNhdGVnb3J5IHdhcyBub3Qgc3BlY2lmaWVkXHJcblx0XHRvcHRpb25zLmNvbmRpdGlvblR5cGUgPSBvcHRpb25zLmNvbmRpdGlvblR5cGUgfHwgUnVsZS5lbnN1cmVDb25kaXRpb25UeXBlKG9wdGlvbnMubmFtZSwgdGhpcy5wcm9wZXJ0eSwgb3B0aW9ucy5jYXRlZ29yeSB8fCBDb25kaXRpb25UeXBlLkVycm9yKTtcclxuXHJcblx0XHQvLyBuZXZlciBydW4gYWxsb3dlZCB2YWx1ZXMgcnVsZXMgZHVyaW5nIGluaXRpYWxpemF0aW9uIG9mIGV4aXN0aW5nIGluc3RhbmNlc1xyXG5cdFx0aWYgKCFvcHRpb25zLmhhc093blByb3BlcnR5KFwib25Jbml0RXhpc3RpbmdcIikgJiYgb3B0aW9ucy5jb25kaXRpb25UeXBlLm9yaWdpbiA9PT0gXCJzZXJ2ZXJcIikge1xyXG5cdFx0XHRvcHRpb25zLm9uSW5pdEV4aXN0aW5nID0gZmFsc2U7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gY2FsbCB0aGUgYmFzZSB0eXBlIGNvbnN0cnVjdG9yXHJcblx0XHRWYWxpZGF0ZWRQcm9wZXJ0eVJ1bGUuYXBwbHkodGhpcywgW3Jvb3RUeXBlLCBvcHRpb25zXSk7XHJcblx0fVxyXG5cclxuXHQvLyBzZXR1cCB0aGUgaW5oZXJpdGFuY2UgY2hhaW5cclxuXHRBbGxvd2VkVmFsdWVzUnVsZS5wcm90b3R5cGUgPSBuZXcgVmFsaWRhdGVkUHJvcGVydHlSdWxlKCk7XHJcblx0QWxsb3dlZFZhbHVlc1J1bGUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQWxsb3dlZFZhbHVlc1J1bGU7XHJcblxyXG5cdC8vIGV4dGVuZCB0aGUgYmFzZSB0eXBlXHJcblx0QWxsb3dlZFZhbHVlc1J1bGUubWl4aW4oe1xyXG5cdFx0b25SZWdpc3RlcjogZnVuY3Rpb24gQWxsb3dlZFZhbHVlc1J1bGUkb25SZWdpc3RlcigpIHtcclxuXHJcblx0XHRcdC8vIGdldCB0aGUgYWxsb3dlZCB2YWx1ZXMgc291cmNlLCBpZiBvbmx5IHRoZSBwYXRoIHdhcyBzcGVjaWZpZWRcclxuXHRcdFx0aWYgKCF0aGlzLnNvdXJjZSAmJiAhdGhpcy5zb3VyY2VGbikge1xyXG5cdFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInNvdXJjZVwiLCB7IHZhbHVlOiBNb2RlbC5wcm9wZXJ0eSh0aGlzLnNvdXJjZVBhdGgsIHRoaXMucm9vdFR5cGUpIH0pO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBjYWxsIHRoZSBiYXNlIG1ldGhvZFxyXG5cdFx0XHRWYWxpZGF0ZWRQcm9wZXJ0eVJ1bGUucHJvdG90eXBlLm9uUmVnaXN0ZXIuY2FsbCh0aGlzKTtcclxuXHRcdH0sXHJcblx0XHRpc1ZhbGlkOiBmdW5jdGlvbiBBbGxvd2VkVmFsdWVzUnVsZSRpc1ZhbGlkKG9iaiwgcHJvcCwgdmFsdWUpIHtcclxuXHJcblx0XHQgICAgLy9naXZlcyB0aGUgYWJpbGl0eSB0byBjcmVhdGUgYSBkcm9wIGRvd24gb2YgYXZhaWxhYmxlIG9wdGlvbnNcclxuXHQgICAgICAgIC8vYnV0IGRvZXMgbm90IG5lZWQgdmFsaWRhdGluIChjb21ibyBib3gpXHJcblx0XHQgICAgaWYgKHRoaXMuaWdub3JlVmFsaWRhdGlvbikge1xyXG5cdFx0ICAgICAgICByZXR1cm4gdHJ1ZTtcclxuXHRcdCAgICB9XHJcblxyXG5cdFx0XHQvLyByZXR1cm4gdHJ1ZSBpZiBubyB2YWx1ZSBpcyBjdXJyZW50bHkgc2VsZWN0ZWRcclxuXHRcdFx0aWYgKCF2YWx1ZSkge1xyXG5cdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBnZXQgdGhlIGxpc3Qgb2YgYWxsb3dlZCB2YWx1ZXMgb2YgdGhlIHByb3BlcnR5IGZvciB0aGUgZ2l2ZW4gb2JqZWN0XHJcblx0XHRcdHZhciBhbGxvd2VkID0gdGhpcy52YWx1ZXMob2JqKTtcclxuXHJcblx0XHRcdC8vIHJldHVybiB1bmRlZmluZWQgaWYgdGhlIHNldCBvZiBhbGxvd2VkIHZhbHVlcyBjYW5ub3QgYmUgZGV0ZXJtaW5lZFxyXG5cdFx0XHRpZiAoIUxhenlMb2FkZXIuaXNMb2FkZWQoYWxsb3dlZCkpIHtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIGVuc3VyZSB0aGF0IHRoZSB2YWx1ZSBvciBsaXN0IG9mIHZhbHVlcyBpcyBpbiB0aGUgYWxsb3dlZCB2YWx1ZXMgbGlzdCAoc2luZ2xlIGFuZCBtdWx0aS1zZWxlY3QpXHRcdFx0XHRcclxuXHRcdFx0aWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuXHRcdFx0XHRyZXR1cm4gdmFsdWUuZXZlcnkoZnVuY3Rpb24gKGl0ZW0pIHsgcmV0dXJuIEFycmF5LmNvbnRhaW5zKGFsbG93ZWQsIGl0ZW0pOyB9KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRyZXR1cm4gQXJyYXkuY29udGFpbnMoYWxsb3dlZCwgdmFsdWUpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIFN1YnNjcmliZXMgdG8gY2hhbmdlcyB0byB0aGUgYWxsb3cgdmFsdWUgcHJlZGljYXRlcywgaW5kaWNhdGluZyB0aGF0IHRoZSBhbGxvd2VkIHZhbHVlcyBoYXZlIGNoYW5nZWRcclxuXHRcdGFkZENoYW5nZWQ6IGZ1bmN0aW9uIEFsbG93ZWRWYWx1ZXNSdWxlJGFkZENoYW5nZWQoaGFuZGxlciwgb2JqLCBvbmNlKSB7XHJcblx0XHRcdGZvciAodmFyIHAgPSAwOyBwIDwgdGhpcy5wcmVkaWNhdGVzLmxlbmd0aDsgcCsrKSB7XHJcblx0XHRcdFx0dmFyIHByZWRpY2F0ZSA9IHRoaXMucHJlZGljYXRlc1twXTtcclxuXHRcdFx0XHRpZiAocHJlZGljYXRlICE9PSB0aGlzLnByb3BlcnR5KVxyXG5cdFx0XHRcdFx0cHJlZGljYXRlLmFkZENoYW5nZWQoaGFuZGxlciwgb2JqLCBvbmNlKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHQvLyBVbnN1YnNjcmliZXMgZnJvbSBjaGFuZ2VzIHRvIHRoZSBhbGxvdyB2YWx1ZSBwcmVkaWNhdGVzXHJcblx0XHRyZW1vdmVDaGFuZ2VkOiBmdW5jdGlvbiBBbGxvd2VkVmFsdWVzUnVsZSRyZW1vdmVDaGFuZ2VkKGhhbmRsZXIsIG9iaiwgb25jZSkge1xyXG5cdFx0XHRmb3IgKHZhciBwID0gMDsgcCA8IHRoaXMucHJlZGljYXRlcy5sZW5ndGg7IHArKykge1xyXG5cdFx0XHRcdHZhciBwcmVkaWNhdGUgPSB0aGlzLnByZWRpY2F0ZXNbcF07XHJcblx0XHRcdFx0aWYgKHByZWRpY2F0ZSAhPT0gdGhpcy5wcm9wZXJ0eSlcclxuXHRcdFx0XHRcdHByZWRpY2F0ZS5yZW1vdmVDaGFuZ2VkKGhhbmRsZXIsIG9iaiwgb25jZSk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblxyXG5cdFx0dmFsdWVzOiBmdW5jdGlvbiBBbGxvd2VkVmFsdWVzUnVsZSR2YWx1ZXMob2JqLCBleGl0RWFybHkpIHtcclxuXHRcdFx0aWYgKCF0aGlzLnNvdXJjZSAmJiAhdGhpcy5zb3VyY2VGbikge1xyXG5cdFx0XHRcdGxvZ1dhcm5pbmcoXCJBbGxvd2VkVmFsdWVzIHJ1bGUgb24gdHlwZSBcXFwiXCIgKyB0aGlzLnByb3AuZ2V0X2NvbnRhaW5pbmdUeXBlKCkuZ2V0X2Z1bGxOYW1lKCkgKyBcIlxcXCIgaGFzIG5vdCBiZWVuIGluaXRpYWxpemVkLlwiKTtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIEZ1bmN0aW9uLWJhc2VkIGFsbG93ZWQgdmFsdWVzXHJcblx0XHRcdGlmICh0aGlzLnNvdXJjZUZuKSB7XHJcblxyXG5cdFx0XHRcdC8vIGNvbnZlcnQgc3RyaW5nIGZ1bmN0aW9ucyBpbnRvIGNvbXBpbGVkIGZ1bmN0aW9ucyBvbiBmaXJzdCBleGVjdXRpb25cclxuXHRcdFx0XHRpZiAodGhpcy5zb3VyY2VGbi5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XHJcblx0XHRcdFx0XHR0aGlzLnNvdXJjZUZuID0gdGhpcy5yb290VHlwZS5jb21waWxlRXhwcmVzc2lvbih0aGlzLnNvdXJjZUZuKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHJldHVybiB0aGlzLnNvdXJjZUZuLmNhbGwob2JqLCBvYmopO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBQcm9wZXJ0eSBwYXRoLWJhc2VkIGFsbG93ZWQgdmFsdWVzXHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdC8vIEZvciBub24tc3RhdGljIHByb3BlcnRpZXMsIHZlcmlmeSB0aGF0IGEgZmluYWwgdGFyZ2V0IGV4aXN0cyBhbmRcclxuXHRcdFx0XHQvLyBpZiBub3QgcmV0dXJuIGFuIGFwcHJvcHJpYXRlIG51bGwgb3IgdW5kZWZpbmVkIHZhbHVlIGluc3RlYWQuXHJcblx0XHRcdFx0aWYgKCF0aGlzLnNvdXJjZS5nZXRfaXNTdGF0aWMoKSkge1xyXG5cdFx0XHRcdFx0Ly8gR2V0IHRoZSB2YWx1ZSBvZiB0aGUgbGFzdCB0YXJnZXQgZm9yIHRoZSBzb3VyY2UgcHJvcGVydHkgKGNoYWluKS5cclxuXHRcdFx0XHRcdHZhciBsYXN0VGFyZ2V0ID0gdGhpcy5zb3VyY2UubGFzdFRhcmdldChvYmosIGV4aXRFYXJseSk7XHJcblxyXG5cdFx0XHRcdFx0Ly8gVXNlIHRoZSBsYXN0IHRhcmdldCB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIHRoZSBhYnNlbmNlIG9mIGRhdGEgYW5kXHJcblx0XHRcdFx0XHQvLyBkYXRhIHRoYXQgaGFzIG5vdCBiZWVuIGxvYWRlZCwgaWYgYSBmaW5hbCB2YWx1ZSBjYW5ub3QgYmUgb2J0YWluZWQuXHJcblx0XHRcdFx0XHRpZiAobGFzdFRhcmdldCA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHRcdC8vIFVuZGVmaW5lZCBzaWduaWZpZXMgdW5sb2FkZWQgZGF0YVxyXG5cdFx0XHRcdFx0XHRyZXR1cm4gdW5kZWZpbmVkO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAobGFzdFRhcmdldCA9PT0gbnVsbCkge1xyXG5cdFx0XHRcdFx0XHQvLyBOdWxsIHNpZ25pZmllcyB0aGUgYWJzZW5zY2Ugb2YgYSB2YWx1ZVxyXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIFJldHVybiB0aGUgdmFsdWUgb2YgdGhlIHNvdXJjZSBmb3IgdGhlIGdpdmVuIG9iamVjdFxyXG5cdFx0XHRcdHJldHVybiB0aGlzLnNvdXJjZS52YWx1ZShvYmopO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0dG9TdHJpbmc6IGZ1bmN0aW9uIEFsbG93ZWRWYWx1ZXNSdWxlJHRvU3RyaW5nKCkge1xyXG5cdFx0XHRyZXR1cm4gJGZvcm1hdChcInswfS57MX0gYWxsb3dlZCB2YWx1ZXMgPSB7Mn1cIiwgW3RoaXMucHJvcGVydHkuZ2V0X2NvbnRhaW5pbmdUeXBlKCkuZ2V0X2Z1bGxOYW1lKCksIHRoaXMucHJvcGVydHkuZ2V0X25hbWUoKSwgdGhpcy5fc291cmNlUGF0aF0pO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHQvLyBleHBvc2UgdGhlIHJ1bGUgcHVibGljbHlcclxuXHRSdWxlLmFsbG93ZWRWYWx1ZXMgPSBBbGxvd2VkVmFsdWVzUnVsZTtcclxuXHRFeG9XZWIuTW9kZWwuQWxsb3dlZFZhbHVlc1J1bGUgPSBBbGxvd2VkVmFsdWVzUnVsZTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5Nb2RlbC5Db21wYXJlUnVsZVxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIENvbXBhcmVSdWxlKHJvb3RUeXBlLCBvcHRpb25zKSB7XHJcblx0XHQvLy8gPHN1bW1hcnk+Q3JlYXRlcyBhIHJ1bGUgdGhhdCB2YWxpZGF0ZXMgYSBwcm9wZXJ0eSBieSBjb21wYXJpbmcgaXQgdG8gYW5vdGhlciBwcm9wZXJ0eS48L3N1bW1hcnk+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJyb290VHlwZVwiIHR5cGU9XCJUeXBlXCI+VGhlIG1vZGVsIHR5cGUgdGhlIHJ1bGUgaXMgZm9yLjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJvcHRpb25zXCIgdHlwZT1cIk9iamVjdFwiPlxyXG5cdFx0Ly8vXHRcdFRoZSBvcHRpb25zIGZvciB0aGUgcnVsZSwgaW5jbHVkaW5nOlxyXG5cdFx0Ly8vXHRcdFx0cHJvcGVydHk6XHRcdFx0dGhlIHByb3BlcnR5IGJlaW5nIHZhbGlkYXRlZCAoZWl0aGVyIGEgUHJvcGVydHkgaW5zdGFuY2Ugb3Igc3RyaW5nIHByb3BlcnR5IG5hbWUpXHJcblx0XHQvLy9cdFx0XHRjb21wYXJlU291cmNlOlx0XHR0aGUgc291cmNlIHByb3BlcnR5IHRvIGNvbXBhcmUgdG8gKGVpdGhlciBhIFByb3BlcnR5IG9yIFByb3BlcnR5Q2hhaW4gaW5zdGFuY2Ugb3IgYSBzdHJpbmcgcHJvcGVydHkgcGF0aClcclxuXHRcdC8vL1x0XHRcdGNvbXBhcmVPcGVyYXRvcjpcdHRoZSByZWxhdGlvbmFsIGNvbXBhcmlzb24gb3BlcmF0b3IgdG8gdXNlIChvbmUgb2YgXCJFcXVhbFwiLCBcIk5vdEVxdWFsXCIsIFwiR3JlYXRlclRoYW5cIiwgXCJHcmVhdGVyVGhhbkVxdWFsXCIsIFwiTGVzc1RoYW5cIiBvciBcIkxlc3NUaGFuRXF1YWxcIilcclxuXHRcdC8vL1x0XHRcdG5hbWU6XHRcdFx0XHR0aGUgb3B0aW9uYWwgdW5pcXVlIG5hbWUgb2YgdGhlIHR5cGUgb2YgdmFsaWRhdGlvbiBydWxlXHJcblx0XHQvLy9cdFx0XHRjb25kaXRpb25UeXBlOlx0XHR0aGUgb3B0aW9uYWwgY29uZGl0aW9uIHR5cGUgdG8gdXNlLCB3aGljaCB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgY3JlYXRlZCBpZiBub3Qgc3BlY2lmaWVkXHJcblx0XHQvLy9cdFx0XHRjYXRlZ29yeTpcdFx0XHRDb25kaXRpb25UeXBlLkVycm9yIHx8IENvbmRpdGlvblR5cGUuV2FybmluZyAoZGVmYXVsdHMgdG8gQ29uZGl0aW9uVHlwZS5FcnJvcilcclxuXHRcdC8vL1x0XHRcdG1lc3NhZ2U6XHRcdFx0dGhlIG1lc3NhZ2UgdG8gc2hvdyB0aGUgdXNlciB3aGVuIHRoZSB2YWxpZGF0aW9uIGZhaWxzXHJcblx0XHQvLy8gPC9wYXJhbT5cclxuXHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiQ29tcGFyZVJ1bGVcIj5UaGUgbmV3IGNvbXBhcmUgcnVsZS48L3JldHVybnM+XHJcblxyXG5cdFx0Ly8gZXhpdCBpbW1lZGlhdGVseSBpZiBjYWxsZWQgd2l0aCBubyBhcmd1bWVudHNcclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID09IDApIHJldHVybjtcclxuXHJcblx0XHRvcHRpb25zLm5hbWUgPSBvcHRpb25zLm5hbWUgfHwgXCJDb21wYXJlXCI7XHJcblx0XHJcblx0XHQvLyBlbnN1cmUgY2hhbmdlcyB0byB0aGUgY29tcGFyZSBzb3VyY2UgdHJpZ2dlcnMgcnVsZSBleGVjdXRpb25cclxuXHRcdGlmIChvcHRpb25zLmNvbXBhcmVTb3VyY2UpXHJcblx0XHRcdG9wdGlvbnMub25DaGFuZ2VPZiA9IFtvcHRpb25zLmNvbXBhcmVTb3VyY2VdO1xyXG5cclxuXHRcdC8vIGRlZmluZSBwcm9wZXJ0aWVzIGZvciB0aGUgcnVsZVxyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiY29tcGFyZU9wZXJhdG9yXCIsIHsgdmFsdWU6IG9wdGlvbnMuY29tcGFyZU9wZXJhdG9yIH0pO1xyXG5cdFx0aWYgKG9wdGlvbnMuc291cmNlIGluc3RhbmNlb2YgUHJvcGVydHkgfHwgb3B0aW9ucy5jb21wYXJlU291cmNlIGluc3RhbmNlb2YgUHJvcGVydHlDaGFpbikge1xyXG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJjb21wYXJlUGF0aFwiLCB7IHZhbHVlOiBvcHRpb25zLmNvbXBhcmVTb3VyY2UuZ2V0X3BhdGgoKSB9KTtcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiY29tcGFyZVNvdXJjZVwiLCB7IHZhbHVlOiBvcHRpb25zLmNvbXBhcmVTb3VyY2UgfSk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiY29tcGFyZVBhdGhcIiwgeyB2YWx1ZTogb3B0aW9ucy5jb21wYXJlU291cmNlIH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGNhbGwgdGhlIGJhc2UgdHlwZSBjb25zdHJ1Y3RvclxyXG5cdFx0VmFsaWRhdGVkUHJvcGVydHlSdWxlLmFwcGx5KHRoaXMsIFtyb290VHlwZSwgb3B0aW9uc10pO1xyXG5cdH1cclxuXHJcblx0Ly8gY29tcGFyZXMgdGhlIHNvdXJjZSB2YWx1ZSB0byBhIGNvbXBhcmlzb24gdmFsdWUgdXNpbmcgdGhlIHNwZWNpZmllZCBvcGVyYXRvclxyXG5cdENvbXBhcmVSdWxlLmNvbXBhcmUgPSBmdW5jdGlvbiBDb21wYXJlUnVsZSRjb21wYXJlKHNvdXJjZVZhbHVlLCBjb21wYXJlT3AsIGNvbXBhcmVWYWx1ZSwgZGVmYXVsdFZhbHVlKSB7XHJcblx0XHRpZiAoY29tcGFyZVZhbHVlID09PSB1bmRlZmluZWQgfHwgY29tcGFyZVZhbHVlID09PSBudWxsKSB7XHJcblx0XHRcdHN3aXRjaCAoY29tcGFyZU9wKSB7XHJcblx0XHRcdFx0Y2FzZSBcIkVxdWFsXCI6IHJldHVybiAhUmVxdWlyZWRSdWxlLmhhc1ZhbHVlKHNvdXJjZVZhbHVlKTtcclxuXHRcdFx0XHRjYXNlIFwiTm90RXF1YWxcIjogcmV0dXJuIFJlcXVpcmVkUnVsZS5oYXNWYWx1ZShzb3VyY2VWYWx1ZSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRpZiAoc291cmNlVmFsdWUgIT09IHVuZGVmaW5lZCAmJiBzb3VyY2VWYWx1ZSAhPT0gbnVsbCAmJiBjb21wYXJlVmFsdWUgIT09IHVuZGVmaW5lZCAmJiBjb21wYXJlVmFsdWUgIT09IG51bGwpIHtcclxuXHRcdFx0c3dpdGNoIChjb21wYXJlT3ApIHtcclxuXHRcdFx0XHRjYXNlIFwiRXF1YWxcIjogcmV0dXJuIHNvdXJjZVZhbHVlID09IGNvbXBhcmVWYWx1ZTtcclxuXHRcdFx0XHRjYXNlIFwiTm90RXF1YWxcIjogcmV0dXJuIHNvdXJjZVZhbHVlICE9IGNvbXBhcmVWYWx1ZTtcclxuXHRcdFx0XHRjYXNlIFwiR3JlYXRlclRoYW5cIjogcmV0dXJuIHNvdXJjZVZhbHVlID4gY29tcGFyZVZhbHVlO1xyXG5cdFx0XHRcdGNhc2UgXCJHcmVhdGVyVGhhbkVxdWFsXCI6IHJldHVybiBzb3VyY2VWYWx1ZSA+PSBjb21wYXJlVmFsdWU7XHJcblx0XHRcdFx0Y2FzZSBcIkxlc3NUaGFuXCI6IHJldHVybiBzb3VyY2VWYWx1ZSA8IGNvbXBhcmVWYWx1ZTtcclxuXHRcdFx0XHRjYXNlIFwiTGVzc1RoYW5FcXVhbFwiOiByZXR1cm4gc291cmNlVmFsdWUgPD0gY29tcGFyZVZhbHVlO1xyXG5cdFx0XHR9XHJcblx0XHRcdC8vIEVxdWFsaXR5IGJ5IGRlZmF1bHQuXHJcblx0XHRcdHJldHVybiBzb3VyY2VWYWx1ZSA9PSBjb21wYXJlVmFsdWU7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIGRlZmF1bHRWYWx1ZTtcclxuXHR9O1xyXG5cclxuXHQvLyBzZXR1cCB0aGUgaW5oZXJpdGFuY2UgY2hhaW5cclxuXHRDb21wYXJlUnVsZS5wcm90b3R5cGUgPSBuZXcgVmFsaWRhdGVkUHJvcGVydHlSdWxlKCk7XHJcblx0Q29tcGFyZVJ1bGUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ29tcGFyZVJ1bGU7XHJcblxyXG5cdC8vIGV4dGVuZCB0aGUgYmFzZSB0eXBlXHJcblx0Q29tcGFyZVJ1bGUubWl4aW4oe1xyXG5cclxuXHRcdC8vIHJldHVybiB0cnVlIG9mIHRoZSBjb21wYXJpc29uIGlzIHZhbGlkLCBvdGhlcndpc2UgZmFsc2VcclxuXHRcdGlzVmFsaWQ6IGZ1bmN0aW9uIENvbXBhcmUkaXNWYWxpZChvYmosIHByb3AsIHZhbHVlKSB7XHJcblx0XHRcdHZhciBjb21wYXJlVmFsdWUgPSB0aGlzLmNvbXBhcmVTb3VyY2UudmFsdWUob2JqKTtcclxuXHRcdFx0cmV0dXJuIENvbXBhcmVSdWxlLmNvbXBhcmUodmFsdWUsIHRoaXMuY29tcGFyZU9wZXJhdG9yLCBjb21wYXJlVmFsdWUsIHRydWUpO1xyXG5cdFx0fSxcclxuXHJcblx0XHQvLyBjYWxjdWxhdGVzIHRoZSBhcHByb3ByaWF0ZSBtZXNzYWdlIGJhc2VkIG9uIHRoZSBjb21wYXJpc29uIG9wZXJhdG9yIGFuZCBkYXRhIHR5cGVcclxuXHRcdG1lc3NhZ2U6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0dmFyIG1lc3NhZ2U7XHJcblx0XHRcdHZhciBpc0RhdGUgPSB0aGlzLmNvbXBhcmVTb3VyY2UuZ2V0X2pzdHlwZSgpID09PSBEYXRlO1xyXG5cdFx0XHRpZiAodGhpcy5jb21wYXJlT3BlcmF0b3IgPT09IFwiRXF1YWxcIikge1xyXG5cdFx0XHRcdG1lc3NhZ2UgPSBSZXNvdXJjZS5nZXQoXCJjb21wYXJlLWVxdWFsXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKHRoaXMuY29tcGFyZU9wZXJhdG9yID09PSBcIk5vdEVxdWFsXCIpIHtcclxuXHRcdFx0XHRtZXNzYWdlID0gUmVzb3VyY2UuZ2V0KFwiY29tcGFyZS1ub3QtZXF1YWxcIik7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAodGhpcy5jb21wYXJlT3BlcmF0b3IgPT09IFwiR3JlYXRlclRoYW5cIikge1xyXG5cdFx0XHRcdG1lc3NhZ2UgPSBSZXNvdXJjZS5nZXQoaXNEYXRlID8gXCJjb21wYXJlLWFmdGVyXCIgOiBcImNvbXBhcmUtZ3JlYXRlci10aGFuXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKHRoaXMuY29tcGFyZU9wZXJhdG9yID09PSBcIkdyZWF0ZXJUaGFuRXF1YWxcIikge1xyXG5cdFx0XHRcdG1lc3NhZ2UgPSBSZXNvdXJjZS5nZXQoaXNEYXRlID8gXCJjb21wYXJlLW9uLW9yLWFmdGVyXCIgOiBcImNvbXBhcmUtZ3JlYXRlci10aGFuLW9yLWVxdWFsXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKHRoaXMuY29tcGFyZU9wZXJhdG9yID09PSBcIkxlc3NUaGFuXCIpIHtcclxuXHRcdFx0XHRtZXNzYWdlID0gUmVzb3VyY2UuZ2V0KGlzRGF0ZSA/IFwiY29tcGFyZS1iZWZvcmVcIiA6IFwiY29tcGFyZS1sZXNzLXRoYW5cIik7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAodGhpcy5jb21wYXJlT3BlcmF0b3IgPT09IFwiTGVzc1RoYW5FcXVhbFwiKSB7XHJcblx0XHRcdFx0bWVzc2FnZSA9IFJlc291cmNlLmdldChpc0RhdGUgPyBcImNvbXBhcmUtb24tb3ItYmVmb3JlXCIgOiBcImNvbXBhcmUtbGVzcy10aGFuLW9yLWVxdWFsXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgY29tcGFyaXNvbiBvcGVyYXRvciBmb3IgY29tcGFyZSBydWxlLlwiKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0bWVzc2FnZSA9IG1lc3NhZ2UucmVwbGFjZShcIntjb21wYXJlU291cmNlfVwiLCB0aGlzLmNvbXBhcmVTb3VyY2UuZ2V0X2xhYmVsKCkpO1xyXG5cclxuXHRcdFx0cmV0dXJuIG1lc3NhZ2UucmVwbGFjZSgne3Byb3BlcnR5fScsIHRoaXMuZ2V0UHJvcGVydHlMYWJlbChvYmopKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gcGVyZm9ybSBhZGRpdGlvbiBpbml0aWFsaXphdGlvbiBvZiB0aGUgcnVsZSB3aGVuIGl0IGlzIHJlZ2lzdGVyZWRcclxuXHRcdG9uUmVnaXN0ZXI6IGZ1bmN0aW9uICgpIHtcclxuXHJcblx0XHRcdC8vIGdldCB0aGUgY29tcGFyZSBzb3VyY2UsIGlmIG9ubHkgdGhlIHBhdGggd2FzIHNwZWNpZmllZFxyXG5cdFx0XHRpZiAoIXRoaXMuY29tcGFyZVNvdXJjZSAmJiB0aGlzLmNvbXBhcmVQYXRoKSB7XHJcblx0XHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiY29tcGFyZVNvdXJjZVwiLCB7IHZhbHVlOiBNb2RlbC5wcm9wZXJ0eSh0aGlzLmNvbXBhcmVQYXRoLCB0aGlzLnJvb3RUeXBlKSB9KTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gY2FsbCB0aGUgYmFzZSBtZXRob2RcclxuXHRcdFx0VmFsaWRhdGVkUHJvcGVydHlSdWxlLnByb3RvdHlwZS5vblJlZ2lzdGVyLmNhbGwodGhpcyk7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vIGV4cG9zZSB0aGUgcnVsZSBwdWJsaWNseVxyXG5cdFJ1bGUuY29tcGFyZSA9IENvbXBhcmVSdWxlO1xyXG5cdEV4b1dlYi5Nb2RlbC5Db21wYXJlUnVsZSA9IENvbXBhcmVSdWxlO1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLk1vZGVsLlJlcXVpcmVkSWZSdWxlXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gUmVxdWlyZWRJZlJ1bGUocm9vdFR5cGUsIG9wdGlvbnMpIHtcclxuXHRcdC8vLyA8c3VtbWFyeT5DcmVhdGVzIGEgcnVsZSB0aGF0IGNvbmRpdGlvbmFsbHkgdmFsaWRhdGVzIHdoZXRoZXIgYSBwcm9wZXJ0eSBoYXMgYSB2YWx1ZS48L3N1bW1hcnk+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJyb290VHlwZVwiIHR5cGU9XCJUeXBlXCI+VGhlIG1vZGVsIHR5cGUgdGhlIHJ1bGUgaXMgZm9yLjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJvcHRpb25zXCIgdHlwZT1cIk9iamVjdFwiPlxyXG5cdFx0Ly8vXHRcdFRoZSBvcHRpb25zIGZvciB0aGUgcnVsZSwgaW5jbHVkaW5nOlxyXG5cdFx0Ly8vXHRcdFx0cHJvcGVydHk6XHRcdFx0dGhlIHByb3BlcnR5IGJlaW5nIHZhbGlkYXRlZCAoZWl0aGVyIGEgUHJvcGVydHkgaW5zdGFuY2Ugb3Igc3RyaW5nIHByb3BlcnR5IG5hbWUpXHJcblx0XHQvLy9cdFx0XHRpc1JlcXVpcmVkOlx0XHRcdGEgcHJlZGljYXRlIGZ1bmN0aW9uIGluZGljYXRpbmcgd2hldGhlciB0aGUgcHJvcGVydHkgc2hvdWxkIGJlIHJlcXVpcmVkXHJcblx0XHQvLy9cdFx0XHRjb21wYXJlU291cmNlOlx0XHR0aGUgc291cmNlIHByb3BlcnR5IHRvIGNvbXBhcmUgdG8gKGVpdGhlciBhIFByb3BlcnR5IG9yIFByb3BlcnR5Q2hhaW4gaW5zdGFuY2Ugb3IgYSBzdHJpbmcgcHJvcGVydHkgcGF0aClcclxuXHRcdC8vL1x0XHRcdGNvbXBhcmVPcGVyYXRvcjpcdHRoZSByZWxhdGlvbmFsIGNvbXBhcmlzb24gb3BlcmF0b3IgdG8gdXNlIChvbmUgb2YgXCJFcXVhbFwiLCBcIk5vdEVxdWFsXCIsIFwiR3JlYXRlclRoYW5cIiwgXCJHcmVhdGVyVGhhbkVxdWFsXCIsIFwiTGVzc1RoYW5cIiBvciBcIkxlc3NUaGFuRXF1YWxcIilcclxuXHRcdC8vL1x0XHRcdGNvbXBhcmVWYWx1ZTpcdFx0dGhlIG9wdGlvbmFsIHZhbHVlIHRvIGNvbXBhcmUgdG9cclxuXHRcdC8vL1x0XHRcdG5hbWU6XHRcdFx0XHR0aGUgb3B0aW9uYWwgdW5pcXVlIG5hbWUgb2YgdGhlIHR5cGUgb2YgdmFsaWRhdGlvbiBydWxlXHJcblx0XHQvLy9cdFx0XHRjb25kaXRpb25UeXBlOlx0XHR0aGUgb3B0aW9uYWwgY29uZGl0aW9uIHR5cGUgdG8gdXNlLCB3aGljaCB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgY3JlYXRlZCBpZiBub3Qgc3BlY2lmaWVkXHJcblx0XHQvLy9cdFx0XHRjYXRlZ29yeTpcdFx0XHRDb25kaXRpb25UeXBlLkVycm9yIHx8IENvbmRpdGlvblR5cGUuV2FybmluZyAoZGVmYXVsdHMgdG8gQ29uZGl0aW9uVHlwZS5FcnJvcilcclxuXHRcdC8vL1x0XHRcdG1lc3NhZ2U6XHRcdFx0dGhlIG1lc3NhZ2UgdG8gc2hvdyB0aGUgdXNlciB3aGVuIHRoZSB2YWxpZGF0aW9uIGZhaWxzXHJcblx0XHQvLy9cdFx0ICAgIG9uSW5pdDpcdFx0XHRcdHRydWUgdG8gaW5kaWNhdGUgdGhlIHJ1bGUgc2hvdWxkIHJ1biB3aGVuIGFuIGluc3RhbmNlIG9mIHRoZSByb290IHR5cGUgaXMgaW5pdGlhbGl6ZWQsIG90aGVyd2lzZSBmYWxzZVxyXG5cdFx0Ly8vXHRcdCAgICBvbkluaXROZXc6XHRcdFx0dHJ1ZSB0byBpbmRpY2F0ZSB0aGUgcnVsZSBzaG91bGQgcnVuIHdoZW4gYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIHJvb3QgdHlwZSBpcyBpbml0aWFsaXplZCwgb3RoZXJ3aXNlIGZhbHNlXHJcblx0XHQvLy9cdFx0ICAgIG9uSW5pdEV4aXN0aW5nOlx0XHR0cnVlIHRvIGluZGljYXRlIHRoZSBydWxlIHNob3VsZCBydW4gd2hlbiBhbiBleGlzdGluZyBpbnN0YW5jZSBvZiB0aGUgcm9vdCB0eXBlIGlzIGluaXRpYWxpemVkLCBvdGhlcndpc2UgZmFsc2VcclxuXHRcdC8vL1x0XHQgICAgb25DaGFuZ2VPZjpcdFx0XHRhbiBhcnJheSBvZiBwcm9wZXJ0eSBwYXRocyAoc3RyaW5ncywgUHJvcGVydHkgb3IgUHJvcGVydHlDaGFpbiBpbnN0YW5jZXMpIHRoYXQgZHJpdmUgd2hlbiB0aGUgcnVsZSBzaG91bGQgZXhlY3V0ZSBkdWUgdG8gcHJvcGVydHkgY2hhbmdlc1xyXG5cdFx0Ly8vXHRcdFx0cmVxdWlyZWRWYWx1ZTpcdFx0dGhlIG9wdGlvbmFsIHJlcXVpcmVkIHZhbHVlXHJcblx0XHQvLy8gPC9wYXJhbT5cclxuXHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiUmVxdWlyZWRJZlJ1bGVcIj5UaGUgbmV3IHJlcXVpcmVkIGlmIHJ1bGUuPC9yZXR1cm5zPlxyXG5cclxuXHRcdG9wdGlvbnMubmFtZSA9IG9wdGlvbnMubmFtZSB8fCBcIlJlcXVpcmVkSWZcIjtcclxuXHJcblx0XHQvLyBlbnN1cmUgY2hhbmdlcyB0byB0aGUgY29tcGFyZSBzb3VyY2UgdHJpZ2dlcnMgcnVsZSBleGVjdXRpb25cclxuXHRcdGlmICghb3B0aW9ucy5vbkNoYW5nZU9mICYmIG9wdGlvbnMuY29tcGFyZVNvdXJjZSkge1xyXG5cdFx0XHRvcHRpb25zLm9uQ2hhbmdlT2YgPSBbb3B0aW9ucy5jb21wYXJlU291cmNlXTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBwcmVkaWNhdGUtYmFzZWQgcnVsZVxyXG5cdFx0aWYgKG9wdGlvbnMuaXNSZXF1aXJlZCB8fCBvcHRpb25zLmZuKSB7XHJcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImlzUmVxdWlyZWRcIiwgeyB2YWx1ZTogb3B0aW9ucy5pc1JlcXVpcmVkIHx8IG9wdGlvbnMuZm4sIHdyaXRhYmxlOiB0cnVlIH0pO1xyXG5cdFx0XHRvcHRpb25zLmZuID0gbnVsbDtcclxuXHRcdFx0b3B0aW9ucy5tZXNzYWdlID0gb3B0aW9ucy5tZXNzYWdlIHx8IFJlc291cmNlLmdldChcInJlcXVpcmVkXCIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdFx0Ly8gY29tcGFyaXNvbi1iYXNlZCBydWxlXHJcblx0XHRlbHNlIHtcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiY29tcGFyZVBhdGhcIiwgeyB2YWx1ZTogb3B0aW9ucy5jb21wYXJlU291cmNlIH0pO1xyXG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJjb21wYXJlT3BlcmF0b3JcIiwge1xyXG5cdFx0XHRcdHZhbHVlOiBvcHRpb25zLmNvbXBhcmVPcGVyYXRvciB8fCAob3B0aW9ucy5jb21wYXJlVmFsdWUgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLmNvbXBhcmVWYWx1ZSAhPT0gbnVsbCA/IFwiRXF1YWxcIiA6IFwiTm90RXF1YWxcIiksXHJcblx0XHRcdFx0d3JpdGFibGU6IHRydWVcclxuXHRcdFx0fSk7XHJcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImNvbXBhcmVWYWx1ZVwiLCB7IHZhbHVlOiBvcHRpb25zLmNvbXBhcmVWYWx1ZSwgd3JpdGFibGU6IHRydWUgfSk7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKG9wdGlvbnMucmVxdWlyZWRWYWx1ZSlcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwicmVxdWlyZWRWYWx1ZVwiLCB7IHZhbHVlOiBvcHRpb25zLnJlcXVpcmVkVmFsdWUgfSk7XHJcblxyXG5cdFx0Ly8gY2FsbCB0aGUgYmFzZSB0eXBlIGNvbnN0cnVjdG9yXHJcblx0XHRWYWxpZGF0ZWRQcm9wZXJ0eVJ1bGUuYXBwbHkodGhpcywgW3Jvb3RUeXBlLCBvcHRpb25zXSk7XHJcblx0fVxyXG5cclxuXHQvLyBzZXR1cCB0aGUgaW5oZXJpdGFuY2UgY2hhaW5cclxuXHRSZXF1aXJlZElmUnVsZS5wcm90b3R5cGUgPSBuZXcgVmFsaWRhdGVkUHJvcGVydHlSdWxlKCk7XHJcblx0UmVxdWlyZWRJZlJ1bGUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUmVxdWlyZWRJZlJ1bGU7XHJcblxyXG5cdC8vIGV4dGVuZCB0aGUgYmFzZSB0eXBlXHJcblx0UmVxdWlyZWRJZlJ1bGUubWl4aW4oe1xyXG5cclxuXHRcdC8vIGRldGVybWluZXMgd2hldGhlciB0aGUgcHJvcGVydHkgc2hvdWxkIGJlIGNvbnNpZGVyZWQgcmVxdWlyZWRcclxuXHRcdGlzUmVxdWlyZWQ6IGZ1bmN0aW9uIFJlcXVpcmVkSWZSdWxlJHJlcXVpcmVkKG9iaikge1xyXG5cdFx0XHR2YXIgc291cmNlVmFsdWUgPSB0aGlzLmNvbXBhcmVTb3VyY2UudmFsdWUob2JqKTtcclxuXHRcdFx0cmV0dXJuIENvbXBhcmVSdWxlLmNvbXBhcmUoc291cmNlVmFsdWUsIHRoaXMuY29tcGFyZU9wZXJhdG9yLCB0aGlzLmNvbXBhcmVWYWx1ZSwgZmFsc2UpO1xyXG5cdFx0fSxcclxuXHJcblx0XHQvLyBjYWxjdWxhdGVzIHRoZSBhcHByb3ByaWF0ZSBtZXNzYWdlIGJhc2VkIG9uIHRoZSBjb21wYXJpc29uIG9wZXJhdG9yIGFuZCBkYXRhIHR5cGVcclxuXHRcdG1lc3NhZ2U6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0dmFyIG1lc3NhZ2U7XHJcblx0XHRcdHZhciBpc0RhdGUgPSB0aGlzLmNvbXBhcmVTb3VyY2UuZ2V0X2pzdHlwZSgpID09PSBEYXRlO1xyXG5cdFx0XHRpZiAodGhpcy5jb21wYXJlVmFsdWUgPT09IHVuZGVmaW5lZCB8fCB0aGlzLmNvbXBhcmVWYWx1ZSA9PT0gbnVsbCkge1xyXG5cdFx0XHRcdG1lc3NhZ2UgPSBSZXNvdXJjZS5nZXQodGhpcy5jb21wYXJlT3BlcmF0b3IgPT09IFwiRXF1YWxcIiA/IFwicmVxdWlyZWQtaWYtbm90LWV4aXN0c1wiIDogXCJyZXF1aXJlZC1pZi1leGlzdHNcIik7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAodGhpcy5jb21wYXJlT3BlcmF0b3IgPT09IFwiRXF1YWxcIikge1xyXG5cdFx0XHRcdG1lc3NhZ2UgPSBSZXNvdXJjZS5nZXQoXCJyZXF1aXJlZC1pZi1lcXVhbFwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh0aGlzLmNvbXBhcmVPcGVyYXRvciA9PT0gXCJOb3RFcXVhbFwiKSB7XHJcblx0XHRcdFx0bWVzc2FnZSA9IFJlc291cmNlLmdldChcInJlcXVpcmVkLWlmLW5vdC1lcXVhbFwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh0aGlzLmNvbXBhcmVPcGVyYXRvciA9PT0gXCJHcmVhdGVyVGhhblwiKSB7XHJcblx0XHRcdFx0bWVzc2FnZSA9IFJlc291cmNlLmdldChpc0RhdGUgPyBcInJlcXVpcmVkLWlmLWFmdGVyXCIgOiBcInJlcXVpcmVkLWlmLWdyZWF0ZXItdGhhblwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh0aGlzLmNvbXBhcmVPcGVyYXRvciA9PT0gXCJHcmVhdGVyVGhhbkVxdWFsXCIpIHtcclxuXHRcdFx0XHRtZXNzYWdlID0gUmVzb3VyY2UuZ2V0KGlzRGF0ZSA/IFwicmVxdWlyZWQtaWYtb24tb3ItYWZ0ZXJcIiA6IFwicmVxdWlyZWQtaWYtZ3JlYXRlci10aGFuLW9yLWVxdWFsXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKHRoaXMuY29tcGFyZU9wZXJhdG9yID09PSBcIkxlc3NUaGFuXCIpIHtcclxuXHRcdFx0XHRtZXNzYWdlID0gUmVzb3VyY2UuZ2V0KGlzRGF0ZSA/IFwicmVxdWlyZWQtaWYtYmVmb3JlXCIgOiBcInJlcXVpcmVkLWlmLWxlc3MtdGhhblwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh0aGlzLmNvbXBhcmVPcGVyYXRvciA9PT0gXCJMZXNzVGhhbkVxdWFsXCIpIHtcclxuXHRcdFx0XHRtZXNzYWdlID0gUmVzb3VyY2UuZ2V0KGlzRGF0ZSA/IFwicmVxdWlyZWQtaWYtb24tb3ItYmVmb3JlXCIgOiBcInJlcXVpcmVkLWlmLWxlc3MtdGhhbi1vci1lcXVhbFwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGNvbXBhcmlzb24gb3BlcmF0b3IgZm9yIGNvbXBhcmUgcnVsZS5cIik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdG1lc3NhZ2UgPSBtZXNzYWdlLnJlcGxhY2UoXCJ7Y29tcGFyZVNvdXJjZX1cIiwgdGhpcy5jb21wYXJlU291cmNlLmdldF9sYWJlbCgpKVxyXG5cdFx0XHRcdC5yZXBsYWNlKFwie2NvbXBhcmVWYWx1ZX1cIiwgdGhpcy5jb21wYXJlU291cmNlLmZvcm1hdCh0aGlzLmNvbXBhcmVWYWx1ZSkpO1xyXG5cclxuXHRcdFx0cmV0dXJuIG1lc3NhZ2UucmVwbGFjZSgne3Byb3BlcnR5fScsIHRoaXMuZ2V0UHJvcGVydHlMYWJlbChvYmopKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gcmV0dXJucyBmYWxzZSBpZiB0aGUgcHJvcGVydHkgaXMgdmFsaWQsIHRydWUgaWYgaW52YWxpZCwgb3IgdW5kZWZpbmVkIGlmIHVua25vd25cclxuXHRcdGFzc2VydDogZnVuY3Rpb24gUmVxdWlyZWRJZlJ1bGUkYXNzZXJ0KG9iaikge1xyXG5cdFx0XHR2YXIgaXNSZXE7XHJcblxyXG5cdFx0XHQvLyBjb252ZXJ0IHN0cmluZyBmdW5jdGlvbnMgaW50byBjb21waWxlZCBmdW5jdGlvbnMgb24gZmlyc3QgZXhlY3V0aW9uXHJcblx0XHRcdGlmICh0aGlzLmlzUmVxdWlyZWQuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xyXG5cdFx0XHRcdHRoaXMuaXNSZXF1aXJlZCA9IHRoaXMucm9vdFR5cGUuY29tcGlsZUV4cHJlc3Npb24odGhpcy5pc1JlcXVpcmVkKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKHRoaXMuaGFzT3duUHJvcGVydHkoXCJpc1JlcXVpcmVkXCIpKSB7XHJcblx0XHRcdFx0dHJ5IHtcclxuXHRcdFx0XHRcdGlzUmVxID0gdGhpcy5pc1JlcXVpcmVkLmNhbGwob2JqKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Y2F0Y2ggKGUpIHtcclxuXHRcdFx0XHRcdGlzUmVxID0gZmFsc2U7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdFx0Ly8gb3RoZXJ3aXNlLCBhbGxvdyBcInRoaXNcIiB0byBiZSB0aGUgY3VycmVudCBydWxlIHRvIHN1cHBvcnQgc3ViY2xhc3NlcyB0aGF0IG92ZXJyaWRlIGFzc2VydFxyXG5cdFx0XHRlbHNlXHJcblx0XHRcdFx0aXNSZXEgPSB0aGlzLmlzUmVxdWlyZWQob2JqKTtcclxuXHJcblx0XHRcdGlmICh0aGlzLnJlcXVpcmVkVmFsdWUpXHJcblx0XHRcdFx0cmV0dXJuIGlzUmVxICYmIHRoaXMucHJvcGVydHkudmFsdWUob2JqKSAhPT0gdGhpcy5yZXF1aXJlZFZhbHVlO1xyXG5cdFx0XHRlbHNlXHJcblx0XHRcdFx0cmV0dXJuIGlzUmVxICYmICFSZXF1aXJlZFJ1bGUuaGFzVmFsdWUodGhpcy5wcm9wZXJ0eS52YWx1ZShvYmopKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gcGVyZm9ybSBhZGRpdGlvbiBpbml0aWFsaXphdGlvbiBvZiB0aGUgcnVsZSB3aGVuIGl0IGlzIHJlZ2lzdGVyZWRcclxuXHRcdG9uUmVnaXN0ZXI6IGZ1bmN0aW9uICgpIHtcclxuXHJcblx0XHRcdC8vIGNhbGwgdGhlIGJhc2UgbWV0aG9kXHJcblx0XHRcdFZhbGlkYXRlZFByb3BlcnR5UnVsZS5wcm90b3R5cGUub25SZWdpc3Rlci5jYWxsKHRoaXMpO1xyXG5cclxuXHRcdFx0Ly8gcGVyZm9ybSBhZGRpdGlvbiByZWdpc3RyYXRpb24gZm9yIHJlcXVpcmVkIGlmIHJ1bGVzIHdpdGggYSBjb21wYXJlIHNvdXJjZVxyXG5cdFx0XHRpZiAodGhpcy5jb21wYXJlUGF0aCkge1xyXG5cclxuXHRcdFx0XHQvLyBnZXQgdGhlIGNvbXBhcmUgc291cmNlLCB3aGljaCBpcyBhbHJlYWR5IGEgcnVsZSBwcmVkaWNhdGUgYW5kIHNob3VsZCBpbW1lZGlhdGVseSByZXNvbHZlXHJcblx0XHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiY29tcGFyZVNvdXJjZVwiLCB7IHZhbHVlOiBNb2RlbC5wcm9wZXJ0eSh0aGlzLmNvbXBhcmVQYXRoLCB0aGlzLnJvb3RUeXBlKSB9KTtcclxuXHJcblx0XHRcdFx0Ly8gZmxpcCB0aGUgZXF1YWxpdHkgcnVsZXMgZm9yIGJvb2xlYW4gZGF0YSB0eXBlc1xyXG5cdFx0XHRcdGlmICh0aGlzLmNvbXBhcmVTb3VyY2UuZ2V0X2pzdHlwZSgpID09PSBCb29sZWFuICYmIHRoaXMuY29tcGFyZU9wZXJhdG9yID09IFwiTm90RXF1YWxcIiAmJiAodGhpcy5jb21wYXJlVmFsdWUgPT09IHVuZGVmaW5lZCB8fCB0aGlzLmNvbXBhcmVWYWx1ZSA9PT0gbnVsbCkpIHtcclxuXHRcdFx0XHRcdHRoaXMuY29tcGFyZU9wZXJhdG9yID0gXCJFcXVhbFwiO1xyXG5cdFx0XHRcdFx0dGhpcy5jb21wYXJlVmFsdWUgPSB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHQvLyBFeHBvc2UgdGhlIHJ1bGUgcHVibGljbHlcclxuXHRSdWxlLnJlcXVpcmVkSWYgPSBSZXF1aXJlZElmUnVsZTtcclxuXHRFeG9XZWIuTW9kZWwuUmVxdWlyZWRJZlJ1bGUgPSBSZXF1aXJlZElmUnVsZTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5Nb2RlbC5TdHJpbmdMZW5ndGhSdWxlXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gU3RyaW5nTGVuZ3RoUnVsZShyb290VHlwZSwgb3B0aW9ucykge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5PkNyZWF0ZXMgYSBydWxlIHRoYXQgdmFsaWRhdGVzIHRoYXQgdGhlIGxlbmd0aCBvZiBhIHN0cmluZyBwcm9wZXJ0eSBpcyB3aXRoaW4gYSBzcGVjaWZpYyByYW5nZS48L3N1bW1hcnk+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJyb290VHlwZVwiIHR5cGU9XCJUeXBlXCI+VGhlIG1vZGVsIHR5cGUgdGhlIHJ1bGUgaXMgZm9yLjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJvcHRpb25zXCIgdHlwZT1cIk9iamVjdFwiPlxyXG5cdFx0Ly8vXHRcdFRoZSBvcHRpb25zIGZvciB0aGUgcnVsZSwgaW5jbHVkaW5nOlxyXG5cdFx0Ly8vXHRcdFx0cHJvcGVydHk6XHRcdFx0dGhlIHByb3BlcnR5IGJlaW5nIHZhbGlkYXRlZCAoZWl0aGVyIGEgUHJvcGVydHkgaW5zdGFuY2Ugb3Igc3RyaW5nIHByb3BlcnR5IG5hbWUpXHJcblx0XHQvLy9cdFx0XHRtaW46XHRcdFx0XHR0aGUgbWluaW11bSBsZW5ndGggb2YgdGhlIHByb3BlcnR5XHJcblx0XHQvLy9cdFx0XHRtYXg6XHRcdFx0XHR0aGUgbWF4aW11bSBsZW5ndGggb2YgdGhlIHByb3BlcnR5XHJcblx0XHQvLy9cdFx0XHRuYW1lOlx0XHRcdFx0dGhlIG9wdGlvbmFsIHVuaXF1ZSBuYW1lIG9mIHRoZSB0eXBlIG9mIHZhbGlkYXRpb24gcnVsZVxyXG5cdFx0Ly8vXHRcdFx0Y29uZGl0aW9uVHlwZTpcdFx0dGhlIG9wdGlvbmFsIGNvbmRpdGlvbiB0eXBlIHRvIHVzZSwgd2hpY2ggd2lsbCBiZSBhdXRvbWF0aWNhbGx5IGNyZWF0ZWQgaWYgbm90IHNwZWNpZmllZFxyXG5cdFx0Ly8vXHRcdFx0Y2F0ZWdvcnk6XHRcdFx0Q29uZGl0aW9uVHlwZS5FcnJvciB8fCBDb25kaXRpb25UeXBlLldhcm5pbmcgKGRlZmF1bHRzIHRvIENvbmRpdGlvblR5cGUuRXJyb3IpXHJcblx0XHQvLy9cdFx0XHRtZXNzYWdlOlx0XHRcdHRoZSBtZXNzYWdlIHRvIHNob3cgdGhlIHVzZXIgd2hlbiB0aGUgdmFsaWRhdGlvbiBmYWlsc1xyXG5cdFx0Ly8vIDwvcGFyYW0+XHJcblx0XHQvLy8gPHJldHVybnMgdHlwZT1cIlJhbmdlUnVsZVwiPlRoZSBuZXcgcmFuZ2UgcnVsZS48L3JldHVybnM+XHJcblxyXG5cdFx0Ly8gZW5zdXJlIHRoZSBydWxlIG5hbWUgaXMgc3BlY2lmaWVkXHJcblx0XHRvcHRpb25zLm5hbWUgPSBvcHRpb25zLm5hbWUgfHwgXCJTdHJpbmdMZW5ndGhcIjtcclxuXHJcblx0XHQvLyBzdG9yZSB0aGUgbWluIGFuZCBtYXggbGVuZ3Roc1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwibWluXCIsIHsgdmFsdWU6IG9wdGlvbnMubWluIH0pO1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwibWF4XCIsIHsgdmFsdWU6IG9wdGlvbnMubWF4IH0pO1xyXG5cclxuXHRcdC8vIGVuc3VyZSB0aGUgZXJyb3IgbWVzc2FnZSBpcyBzcGVjaWZpZWRcclxuXHRcdG9wdGlvbnMubWVzc2FnZSA9IG9wdGlvbnMubWVzc2FnZSB8fFxyXG5cdFx0XHQob3B0aW9ucy5taW4gJiYgb3B0aW9ucy5tYXggPyBSZXNvdXJjZS5nZXQoXCJzdHJpbmctbGVuZ3RoLWJldHdlZW5cIikucmVwbGFjZShcInttaW59XCIsIHRoaXMubWluKS5yZXBsYWNlKFwie21heH1cIiwgdGhpcy5tYXgpIDpcclxuXHRcdFx0b3B0aW9ucy5taW4gPyBSZXNvdXJjZS5nZXQoXCJzdHJpbmctbGVuZ3RoLWF0LWxlYXN0XCIpLnJlcGxhY2UoXCJ7bWlufVwiLCB0aGlzLm1pbikgOlxyXG5cdFx0XHRSZXNvdXJjZS5nZXQoXCJzdHJpbmctbGVuZ3RoLWF0LW1vc3RcIikucmVwbGFjZShcInttYXh9XCIsIHRoaXMubWF4KSk7XHJcblxyXG5cdFx0Ly8gY2FsbCB0aGUgYmFzZSB0eXBlIGNvbnN0cnVjdG9yXHJcblx0XHRWYWxpZGF0ZWRQcm9wZXJ0eVJ1bGUuYXBwbHkodGhpcywgW3Jvb3RUeXBlLCBvcHRpb25zXSk7XHJcblx0fVxyXG5cclxuXHQvLyBzZXR1cCB0aGUgaW5oZXJpdGFuY2UgY2hhaW5cclxuXHRTdHJpbmdMZW5ndGhSdWxlLnByb3RvdHlwZSA9IG5ldyBWYWxpZGF0ZWRQcm9wZXJ0eVJ1bGUoKTtcclxuXHRTdHJpbmdMZW5ndGhSdWxlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFN0cmluZ0xlbmd0aFJ1bGU7XHJcblxyXG5cdC8vIGV4dGVuZCB0aGUgYmFzZSB0eXBlXHJcblx0U3RyaW5nTGVuZ3RoUnVsZS5taXhpbih7XHJcblxyXG5cdFx0Ly8gcmV0dXJucyB0cnVlIGlmIHRoZSBwcm9wZXJ0eSBpcyB2YWxpZCwgb3RoZXJ3aXNlIGZhbHNlXHJcblx0XHRpc1ZhbGlkOiBmdW5jdGlvbiBTdHJpbmdMZW5ndGhSdWxlJGlzVmFsaWQob2JqLCBwcm9wLCB2YWwpIHtcclxuXHRcdFx0cmV0dXJuICF2YWwgfHwgdmFsID09PSBcIlwiIHx8ICgoIXRoaXMubWluIHx8IHZhbC5sZW5ndGggPj0gdGhpcy5taW4pICYmICghdGhpcy5tYXggfHwgdmFsLmxlbmd0aCA8PSB0aGlzLm1heCkpO1xyXG5cdFx0fSxcclxuXHJcblx0XHQvLyBnZXQgdGhlIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgcnVsZVxyXG5cdFx0dG9TdHJpbmc6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0cmV0dXJuICRmb3JtYXQoXCJ7MH0uezF9IGluIHJhbmdlLCBtaW46IHsyfSwgbWF4OiB7M31cIixcclxuXHRcdFx0XHRbdGhpcy5nZXRfcHJvcGVydHkoKS5nZXRfY29udGFpbmluZ1R5cGUoKS5nZXRfZnVsbE5hbWUoKSxcclxuXHRcdFx0XHR0aGlzLmdldF9wcm9wZXJ0eSgpLmdldF9uYW1lKCksXHJcblx0XHRcdFx0dGhpcy5taW4gPyBcIlwiIDogdGhpcy5taW4sXHJcblx0XHRcdFx0dGhpcy5tYXggPyBcIlwiIDogdGhpcy5tYXhdKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0Ly8gRXhwb3NlIHRoZSBydWxlIHB1YmxpY2x5XHJcblx0UnVsZS5zdHJpbmdMZW5ndGggPSBTdHJpbmdMZW5ndGhSdWxlO1xyXG5cdEV4b1dlYi5Nb2RlbC5TdHJpbmdMZW5ndGhSdWxlID0gU3RyaW5nTGVuZ3RoUnVsZTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5Nb2RlbC5TdHJpbmdGb3JtYXRSdWxlXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gU3RyaW5nRm9ybWF0UnVsZShyb290VHlwZSwgb3B0aW9ucykge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5PkNyZWF0ZXMgYSBydWxlIHRoYXQgdmFsaWRhdGVzIHRoYXQgYSBzdHJpbmcgcHJvcGVydHkgdmFsdWUgaXMgY29ycmVjdGx5IGZvcm1hdHRlZC48L3N1bW1hcnk+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJyb290VHlwZVwiIHR5cGU9XCJUeXBlXCI+VGhlIG1vZGVsIHR5cGUgdGhlIHJ1bGUgaXMgZm9yLjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJvcHRpb25zXCIgdHlwZT1cIk9iamVjdFwiPlxyXG5cdFx0Ly8vXHRcdFRoZSBvcHRpb25zIGZvciB0aGUgcnVsZSwgaW5jbHVkaW5nOlxyXG5cdFx0Ly8vXHRcdFx0cHJvcGVydHk6XHRcdFx0dGhlIHByb3BlcnR5IGJlaW5nIHZhbGlkYXRlZCAoZWl0aGVyIGEgUHJvcGVydHkgaW5zdGFuY2Ugb3Igc3RyaW5nIHByb3BlcnR5IG5hbWUpXHJcblx0XHQvLy9cdFx0XHRkZXNjcmlwdGlvbjpcdFx0dGhlIGh1bWFuIHJlYWRhYmxlIGRlc2NyaXB0aW9uIG9mIHRoZSBmb3JtYXQsIHN1Y2ggYXMgTU0vREQvWVlZXHJcblx0XHQvLy9cdFx0ICAgIGV4cHJlc3Npb246XHRcdFx0YSByZWd1bGFyIGV4cHJlc3Npb24gc3RyaW5nIG9yIFJlZ0V4cCBpbnN0YW5jZSB0aGF0IHRoZSBwcm9wZXJ0eSB2YWx1ZSBtdXN0IG1hdGNoXHJcblx0XHQvLy9cdFx0ICAgIHJlZm9ybWF0Olx0XHRcdGFuZCBvcHRpb25hbCByZWd1bGFyIGV4cHJlc3Npb24gcmVmb3JtYXQgc3RyaW5nIG9yIHJlZm9ybWF0IGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSB1c2VkIHRvIGNvcnJlY3QgdGhlIHZhbHVlIGlmIGl0IG1hdGNoZXNcclxuXHRcdC8vL1x0XHRcdG5hbWU6XHRcdFx0XHR0aGUgb3B0aW9uYWwgdW5pcXVlIG5hbWUgb2YgdGhlIHR5cGUgb2YgdmFsaWRhdGlvbiBydWxlXHJcblx0XHQvLy9cdFx0XHRjb25kaXRpb25UeXBlOlx0XHR0aGUgb3B0aW9uYWwgY29uZGl0aW9uIHR5cGUgdG8gdXNlLCB3aGljaCB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgY3JlYXRlZCBpZiBub3Qgc3BlY2lmaWVkXHJcblx0XHQvLy9cdFx0XHRjYXRlZ29yeTpcdFx0XHRDb25kaXRpb25UeXBlLkVycm9yIHx8IENvbmRpdGlvblR5cGUuV2FybmluZyAoZGVmYXVsdHMgdG8gQ29uZGl0aW9uVHlwZS5FcnJvcilcclxuXHRcdC8vL1x0XHRcdG1lc3NhZ2U6XHRcdFx0dGhlIG1lc3NhZ2UgdG8gc2hvdyB0aGUgdXNlciB3aGVuIHRoZSB2YWxpZGF0aW9uIGZhaWxzXHJcblx0XHQvLy8gPC9wYXJhbT5cclxuXHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiU3RyaW5nRm9ybWF0UnVsZVwiPlRoZSBuZXcgc3RyaW5nIGZvcm1hdCBydWxlLjwvcmV0dXJucz5cclxuXHJcblx0XHQvLyBleGl0IGltbWVkaWF0ZWx5IGlmIGNhbGxlZCB3aXRoIG5vIGFyZ3VtZW50c1xyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMCkgcmV0dXJuO1xyXG5cclxuXHRcdC8vIGVuc3VyZSB0aGUgcnVsZSBuYW1lIGlzIHNwZWNpZmllZFxyXG5cdFx0b3B0aW9ucy5uYW1lID0gb3B0aW9ucy5uYW1lIHx8IFwiU3RyaW5nRm9ybWF0XCI7XHJcblxyXG5cclxuXHRcdC8vIGVuc3VyZSB0aGUgZXJyb3IgbWVzc2FnZSBpcyBzcGVjaWZpZWRcclxuXHRcdGlmIChSZXNvdXJjZS5nZXQob3B0aW9ucy5tZXNzYWdlKSlcclxuXHQgICAgICAgIG9wdGlvbnMubWVzc2FnZSA9IFJlc291cmNlLmdldChvcHRpb25zLm1lc3NhZ2UpO1xyXG5cdCAgICBlbHNlXHJcblx0ICAgICAgICBvcHRpb25zLm1lc3NhZ2UgPSBvcHRpb25zLm1lc3NhZ2UgfHwgUmVzb3VyY2UuZ2V0KFwic3RyaW5nLWZvcm1hdFwiKS5yZXBsYWNlKFwie2Zvcm1hdERlc2NyaXB0aW9ufVwiLCBvcHRpb25zLmRlc2NyaXB0aW9uKTtcclxuXHJcblx0XHQvLyBkZWZpbmUgcHJvcGVydGllcyBmb3IgdGhlIHJ1bGVcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImRlc2NyaXB0aW9uXCIsIHsgdmFsdWU6IG9wdGlvbnMuZGVzY3JpcHRpb24gfSk7XHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJleHByZXNzaW9uXCIsIHsgdmFsdWU6IG9wdGlvbnMuZXhwcmVzc2lvbiBpbnN0YW5jZW9mIFJlZ0V4cCA/IG9wdGlvbnMuZXhwcmVzc2lvbiA6IFJlZ0V4cChvcHRpb25zLmV4cHJlc3Npb24pIH0pO1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwicmVmb3JtYXRcIiwgeyB2YWx1ZTogb3B0aW9ucy5yZWZvcm1hdCB9KTtcclxuXHJcblx0XHQvLyBjYWxsIHRoZSBiYXNlIHR5cGUgY29uc3RydWN0b3JcclxuXHRcdFZhbGlkYXRlZFByb3BlcnR5UnVsZS5hcHBseSh0aGlzLCBbcm9vdFR5cGUsIG9wdGlvbnNdKTtcclxuXHR9XHJcblxyXG5cdC8vIHNldHVwIHRoZSBpbmhlcml0YW5jZSBjaGFpblxyXG5cdFN0cmluZ0Zvcm1hdFJ1bGUucHJvdG90eXBlID0gbmV3IFZhbGlkYXRlZFByb3BlcnR5UnVsZSgpO1xyXG5cdFN0cmluZ0Zvcm1hdFJ1bGUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gU3RyaW5nRm9ybWF0UnVsZTtcclxuXHJcblx0Ly8gZXh0ZW5kIHRoZSBiYXNlIHR5cGVcclxuXHRTdHJpbmdGb3JtYXRSdWxlLm1peGluKHtcclxuXHJcblx0XHQvLyByZXR1cm5zIHRydWUgaWYgdGhlIHByb3BlcnR5IGlzIHZhbGlkLCBvdGhlcndpc2UgZmFsc2VcclxuXHRcdGlzVmFsaWQ6IGZ1bmN0aW9uIFN0cmluZ0Zvcm1hdFJ1bGUkaXNWYWxpZChvYmosIHByb3AsIHZhbCkge1xyXG5cdFx0XHR2YXIgaXNWYWxpZCA9IHRydWU7XHJcblx0XHRcdGlmICh2YWwgJiYgdmFsICE9IFwiXCIpIHtcclxuXHRcdFx0XHR0aGlzLmV4cHJlc3Npb24ubGFzdEluZGV4ID0gMDtcclxuXHRcdFx0XHRpc1ZhbGlkID0gdGhpcy5leHByZXNzaW9uLnRlc3QodmFsKTtcclxuXHRcdFx0XHRpZiAoaXNWYWxpZCAmJiB0aGlzLnJlZm9ybWF0KSB7XHJcblx0XHRcdFx0XHRpZiAodGhpcy5yZWZvcm1hdCBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcblx0XHRcdFx0XHRcdHZhbCA9IHRoaXMucmVmb3JtYXQodmFsKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHR0aGlzLmV4cHJlc3Npb24ubGFzdEluZGV4ID0gMDtcclxuXHRcdFx0XHRcdFx0dmFsID0gdmFsLnJlcGxhY2UodGhpcy5leHByZXNzaW9uLCB0aGlzLnJlZm9ybWF0KTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHByb3AudmFsdWUob2JqLCB2YWwpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gaXNWYWxpZDtcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gZ2V0IHRoZSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIHJ1bGVcclxuXHRcdHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHJldHVybiAkZm9ybWF0KFwiezB9LnsxfSBmb3JtYXR0ZWQgYXMgezJ9XCIsXHJcblx0XHRcdFx0W3RoaXMuZ2V0X3Byb3BlcnR5LmdldF9jb250YWluaW5nVHlwZSgpLmdldF9mdWxsTmFtZSgpLFxyXG5cdFx0XHRcdHRoaXMuZ2V0X3Byb3BlcnR5KCkuZ2V0X25hbWUoKSxcclxuXHRcdFx0XHR0aGlzLmRlc2NyaXB0aW9uXSk7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vIEV4cG9zZSB0aGUgcnVsZSBwdWJsaWNseVxyXG5cdFJ1bGUuc3RyaW5nRm9ybWF0ID0gU3RyaW5nRm9ybWF0UnVsZTtcclxuXHRFeG9XZWIuTW9kZWwuU3RyaW5nRm9ybWF0UnVsZSA9IFN0cmluZ0Zvcm1hdFJ1bGU7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuTW9kZWwuTGlzdExlbmd0aFJ1bGVcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHRmdW5jdGlvbiBMaXN0TGVuZ3RoUnVsZShyb290VHlwZSwgb3B0aW9ucykge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5PkNyZWF0ZXMgYSBydWxlIHRoYXQgdmFsaWRhdGVzIGEgbGlzdCBwcm9wZXJ0eSBjb250YWlucyBhIHNwZWNpZmljIHJhbmdlIG9mIGl0ZW1zLjwvc3VtbWFyeT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cInJvb3RUeXBlXCIgdHlwZT1cIlR5cGVcIj5UaGUgbW9kZWwgdHlwZSB0aGUgcnVsZSBpcyBmb3IuPC9wYXJhbT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cIm9wdGlvbnNcIiB0eXBlPVwiT2JqZWN0XCI+XHJcblx0XHQvLy9cdFx0VGhlIG9wdGlvbnMgZm9yIHRoZSBydWxlLCBpbmNsdWRpbmc6XHJcblx0XHQvLy9cdFx0XHRwcm9wZXJ0eTpcdFx0XHR0aGUgcHJvcGVydHkgYmVpbmcgdmFsaWRhdGVkIChlaXRoZXIgYSBQcm9wZXJ0eSBpbnN0YW5jZSBvciBzdHJpbmcgcHJvcGVydHkgbmFtZSlcclxuXHRcdC8vL1x0XHRcdG1pbjpcdFx0XHRcdHRoZSBtaW5pbXVtIHZhbGlkIHZhbHVlIG9mIHRoZSBwcm9wZXJ0eVxyXG5cdFx0Ly8vXHRcdFx0bWF4Olx0XHRcdFx0dGhlIG1heGltdW0gdmFsaWQgdmFsdWUgb2YgdGhlIHByb3BlcnR5XHJcblx0XHQvLy9cdFx0XHRtaW5GbjpcdFx0XHRcdGEgZnVuY3Rpb24gcmV0dXJuaW5nIHRoZSBtaW5pbXVtIHZhbGlkIHZhbHVlIG9mIHRoZSBwcm9wZXJ0eVxyXG5cdFx0Ly8vXHRcdFx0bWF4Rm46XHRcdFx0XHRhIGZ1bmN0aW9uIHJldHVybmluZyB0aGUgbWF4aW11bSB2YWxpZCB2YWx1ZSBvZiB0aGUgcHJvcGVydHlcclxuXHRcdC8vL1x0XHRcdG5hbWU6XHRcdFx0XHR0aGUgb3B0aW9uYWwgdW5pcXVlIG5hbWUgb2YgdGhlIHR5cGUgb2YgdmFsaWRhdGlvbiBydWxlXHJcblx0XHQvLy9cdFx0XHRjb25kaXRpb25UeXBlOlx0XHR0aGUgb3B0aW9uYWwgY29uZGl0aW9uIHR5cGUgdG8gdXNlLCB3aGljaCB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgY3JlYXRlZCBpZiBub3Qgc3BlY2lmaWVkXHJcblx0XHQvLy9cdFx0XHRjYXRlZ29yeTpcdFx0XHRDb25kaXRpb25UeXBlLkVycm9yIHx8IENvbmRpdGlvblR5cGUuV2FybmluZyAoZGVmYXVsdHMgdG8gQ29uZGl0aW9uVHlwZS5FcnJvcilcclxuXHRcdC8vL1x0XHRcdG1lc3NhZ2U6XHRcdFx0dGhlIG1lc3NhZ2UgdG8gc2hvdyB0aGUgdXNlciB3aGVuIHRoZSB2YWxpZGF0aW9uIGZhaWxzXHJcblx0XHQvLy9cdFx0ICAgIG9uQ2hhbmdlT2Y6XHRcdFx0YW4gYXJyYXkgb2YgcHJvcGVydHkgcGF0aHMgKHN0cmluZ3MsIFByb3BlcnR5IG9yIFByb3BlcnR5Q2hhaW4gaW5zdGFuY2VzKSB0aGF0IGRyaXZlIHdoZW4gdGhlIHJ1bGUgc2hvdWxkIGV4ZWN1dGUgZHVlIHRvIHByb3BlcnR5IGNoYW5nZXNcclxuXHRcdC8vLyA8L3BhcmFtPlxyXG5cdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJMaXN0TGVuZ3RoUnVsZVwiPlRoZSBuZXcgbGlzdCBsZW5ndGggcnVsZS48L3JldHVybnM+XHJcblxyXG5cdFx0Ly8gZW5zdXJlIHRoZSBydWxlIG5hbWUgaXMgc3BlY2lmaWVkXHJcblx0XHRvcHRpb25zLm5hbWUgPSBvcHRpb25zLm5hbWUgfHwgXCJMaXN0TGVuZ3RoXCI7XHJcblxyXG5cdFx0Ly8gY2FsbCB0aGUgYmFzZSB0eXBlIGNvbnN0cnVjdG9yXHJcblx0XHRSYW5nZVJ1bGUuYXBwbHkodGhpcywgW3Jvb3RUeXBlLCBvcHRpb25zXSk7XHJcblx0fVxyXG5cclxuXHQvLyBzZXR1cCB0aGUgaW5oZXJpdGFuY2UgY2hhaW5cclxuXHRMaXN0TGVuZ3RoUnVsZS5wcm90b3R5cGUgPSBuZXcgUmFuZ2VSdWxlKCk7XHJcblx0TGlzdExlbmd0aFJ1bGUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gTGlzdExlbmd0aFJ1bGU7XHJcblxyXG5cdC8vIGV4dGVuZCB0aGUgYmFzZSB0eXBlXHJcblx0TGlzdExlbmd0aFJ1bGUubWl4aW4oe1xyXG5cclxuXHRcdC8vIHJldHVybnMgdHJ1ZSBpZiB0aGUgcHJvcGVydHkgaXMgdmFsaWQsIG90aGVyd2lzZSBmYWxzZVxyXG5cdFx0aXNWYWxpZDogZnVuY3Rpb24gTGlzdExlbmd0aFJ1bGUkaXNWYWxpZChvYmosIHByb3AsIHZhbCkge1xyXG5cclxuXHRcdFx0dmFyIHJhbmdlID0gdGhpcy5yYW5nZShvYmopO1xyXG5cclxuXHRcdFx0cmV0dXJuIHZhbCA9PT0gbnVsbCB8fCB2YWwgPT09IHVuZGVmaW5lZCB8fCAoKCFyYW5nZS5taW4gfHwgdmFsLmxlbmd0aCA+PSByYW5nZS5taW4pICYmICghcmFuZ2UubWF4IHx8IHZhbC5sZW5ndGggPD0gcmFuZ2UubWF4KSk7XHJcblx0XHR9LFxyXG5cclxuXHRcdG1lc3NhZ2U6IGZ1bmN0aW9uIExpc3RMZW5ndGhSdWxlJG1lc3NhZ2Uob2JqKSB7XHJcblxyXG5cdFx0XHR2YXIgcmFuZ2UgPSB0aGlzLnJhbmdlKG9iaik7XHJcblxyXG5cdFx0XHQvLyBlbnN1cmUgdGhlIGVycm9yIG1lc3NhZ2UgaXMgc3BlY2lmaWVkXHJcblx0XHRcdHZhciBtZXNzYWdlID1cclxuXHRcdFx0XHQocmFuZ2UubWluICYmIHJhbmdlLm1heCA/IFJlc291cmNlLmdldChcImxpc3RsZW5ndGgtYmV0d2VlblwiKS5yZXBsYWNlKFwie21pbn1cIiwgdGhpcy5wcm9wZXJ0eS5mb3JtYXQocmFuZ2UubWluKSkucmVwbGFjZShcInttYXh9XCIsIHRoaXMucHJvcGVydHkuZm9ybWF0KHJhbmdlLm1heCkpIDogXHJcblx0XHRcdFx0XHRcdHJhbmdlLm1pbiA/XHJcblx0XHRcdFx0XHRcdFx0UmVzb3VyY2UuZ2V0KFwibGlzdGxlbmd0aC1hdC1sZWFzdFwiKS5yZXBsYWNlKFwie21pbn1cIiwgdGhpcy5wcm9wZXJ0eS5mb3JtYXQocmFuZ2UubWluKSkgOiAvLyBhdCBsZWFzdCBvcmRpbmFsXHJcblx0XHRcdFx0XHRcdFx0UmVzb3VyY2UuZ2V0KFwibGlzdGxlbmd0aC1hdC1tb3N0XCIpLnJlcGxhY2UoXCJ7bWF4fVwiLCB0aGlzLnByb3BlcnR5LmZvcm1hdChyYW5nZS5tYXgpKSk7IC8vIGF0IG1vc3Qgb3JkaW5hbFxyXG5cclxuXHRcdFx0cmV0dXJuIG1lc3NhZ2UucmVwbGFjZSgne3Byb3BlcnR5fScsIHRoaXMuZ2V0UHJvcGVydHlMYWJlbChvYmopKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0Ly8gRXhwb3NlIHRoZSBydWxlIHB1YmxpY2x5XHJcblx0UnVsZS5saXN0TGVuZ3RoID0gTGlzdExlbmd0aFJ1bGU7XHJcblx0RXhvV2ViLk1vZGVsLkxpc3RMZW5ndGhSdWxlID0gTGlzdExlbmd0aFJ1bGU7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuTW9kZWwuQ29uZGl0aW9uVHlwZVNldFxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIENvbmRpdGlvblR5cGVTZXQobmFtZSkge1xyXG5cdFx0aWYgKGFsbENvbmRpdGlvblR5cGVTZXRzW25hbWVdKSB7XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIkEgc2V0IHdpdGggdGhlIG5hbWUgXFxcIlwiICsgbmFtZSArIFwiXFxcIiBoYXMgYWxyZWFkeSBiZWVuIGNyZWF0ZWQuXCIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm5hbWVcIiwgeyB2YWx1ZTogbmFtZSB9KTtcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInR5cGVzXCIsIHsgdmFsdWU6IFtdIH0pO1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiYWN0aXZlXCIsIHsgdmFsdWU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSB9KTtcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImNvbmRpdGlvbnNcIiwgeyB2YWx1ZTogW10gfSk7XHJcblxyXG5cdFx0YWxsQ29uZGl0aW9uVHlwZVNldHNbbmFtZV0gPSB0aGlzO1xyXG5cdH1cclxuXHJcblx0dmFyIGFsbENvbmRpdGlvblR5cGVTZXRzID0gQ29uZGl0aW9uVHlwZVNldC5hbGxDb25kaXRpb25UeXBlU2V0cyA9IHt9O1xyXG5cclxuXHRDb25kaXRpb25UeXBlU2V0LmFsbCA9IGZ1bmN0aW9uIENvbmRpdGlvblR5cGVTZXQkYWxsKCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5PlxyXG5cdFx0Ly8vIFJldHVybnMgYW4gYXJyYXkgb2YgYWxsIGNvbmRpdGlvbiB0eXBlIHNldHMgdGhhdCBoYXZlIGJlZW4gY3JlYXRlZC5cclxuXHRcdC8vLyBOb3RlIHRoYXQgdGhlIGFycmF5IGlzIGNyZWF0ZWQgZWFjaCB0aW1lIHRoZSBmdW5jdGlvbiBpcyBjYWxsZWQuXHJcblx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJBcnJheVwiIC8+XHJcblxyXG5cdFx0dmFyIGFsbCA9IFtdO1xyXG5cdFx0Zm9yICh2YXIgbmFtZSBpbiBhbGxDb25kaXRpb25UeXBlU2V0cykge1xyXG5cdFx0XHRhbGwucHVzaChhbGxDb25kaXRpb25UeXBlU2V0c1tuYW1lXSk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gYWxsO1xyXG5cdH07XHJcblxyXG5cdENvbmRpdGlvblR5cGVTZXQuZ2V0ID0gZnVuY3Rpb24gQ29uZGl0aW9uVHlwZVNldCRnZXQobmFtZSkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5PlxyXG5cdFx0Ly8vIFJldHVybnMgdGhlIGNvbmRpdGlvbiB0eXBlIHNldCB3aXRoIHRoZSBnaXZlbiBuYW1lLCBpZiBpdCBleGlzdHMuXHJcblx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwibmFtZVwiIHR5cGU9XCJTdHJpbmdcIiAvPlxyXG5cdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJDb25kaXRpb25UeXBlU2V0XCIgLz5cclxuXHJcblx0XHRyZXR1cm4gYWxsQ29uZGl0aW9uVHlwZVNldHNbbmFtZV07XHJcblx0fTtcclxuXHJcblx0Q29uZGl0aW9uVHlwZVNldC5wcm90b3R5cGUgPSB7XHJcblx0XHRhY3RpdmF0ZTogZnVuY3Rpb24gQ29uZGl0aW9uVHlwZVNldCRhY3RpdmF0ZSh2YWx1ZSkge1xyXG5cdFx0XHRpZiAoIXRoaXMuYWN0aXZlKSB7XHJcblx0XHRcdFx0dGhpcy5hY3RpdmUgPSB0cnVlO1xyXG5cdFx0XHRcdHRoaXMuX3JhaXNlRXZlbnQoXCJhY3RpdmF0ZWRcIik7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRkZWFjdGl2YXRlOiBmdW5jdGlvbiBDb25kaXRpb25UeXBlU2V0JGRlYWN0aXZhdGUoKSB7XHJcblx0XHRcdGlmICh0aGlzLmFjdGl2ZSkge1xyXG5cdFx0XHRcdHRoaXMuYWN0aXZlID0gZmFsc2U7XHJcblx0XHRcdFx0dGhpcy5fcmFpc2VFdmVudChcImRlYWN0aXZhdGVkXCIpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0YWRkQWN0aXZhdGVkOiBmdW5jdGlvbiBDb25kaXRpb25UeXBlU2V0JGFkZEFjdGl2YXRlZChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX2FkZEV2ZW50KFwiYWN0aXZhdGVkXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHRcdHJlbW92ZUFjdGl2YXRlZDogZnVuY3Rpb24gQ29uZGl0aW9uVHlwZVNldCRyZW1vdmVBY3RpdmF0ZWQoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9yZW1vdmVFdmVudChcImFjdGl2YXRlZFwiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRhZGREZWFjdGl2YXRlZDogZnVuY3Rpb24gQ29uZGl0aW9uVHlwZVNldCRhZGREZWFjdGl2YXRlZChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX2FkZEV2ZW50KFwiZGVhY3RpdmF0ZWRcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0cmVtb3ZlRGVhY3RpdmF0ZWQ6IGZ1bmN0aW9uIENvbmRpdGlvblR5cGVTZXQkcmVtb3ZlRGVhY3RpdmF0ZWQoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9yZW1vdmVFdmVudChcImRlYWN0aXZhdGVkXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHJcblx0XHRhZGRDb25kaXRpb25zQ2hhbmdlZDogZnVuY3Rpb24gQ29uZGl0aW9uVHlwZVNldCRhZGRDb25kaXRpb25zQ2hhbmdlZChoYW5kbGVyKSB7XHJcblxyXG5cdFx0XHQvLyBzdWJzY3JpYmUgdG8gdGhlIGV2ZW50XHJcblx0XHRcdHRoaXMuX2FkZEV2ZW50KFwiY29uZGl0aW9uc0NoYW5nZWRcIiwgaGFuZGxlcik7XHJcblxyXG5cdFx0XHQvLyBSZXR1cm4gdGhlIGNvbmRpdGlvbiB0eXBlIHRvIHN1cHBvcnQgbWV0aG9kIGNoYWluaW5nXHJcblx0XHRcdHJldHVybiB0aGlzO1xyXG5cdFx0fSxcclxuXHJcblx0XHRyZW1vdmVDb25kaXRpb25zQ2hhbmdlZDogZnVuY3Rpb24gQ29uZGl0aW9uVHlwZVNldCRyZW1vdmVDb25kaXRpb25zQ2hhbmdlZChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUV2ZW50KFwiY29uZGl0aW9uc0NoYW5nZWRcIiwgaGFuZGxlcik7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0Q29uZGl0aW9uVHlwZVNldC5taXhpbihFeG9XZWIuRnVuY3Rvci5ldmVudGluZyk7XHJcblxyXG5cdEV4b1dlYi5Nb2RlbC5Db25kaXRpb25UeXBlU2V0ID0gQ29uZGl0aW9uVHlwZVNldDtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5Nb2RlbC5Db25kaXRpb25UeXBlXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gQ29uZGl0aW9uVHlwZShjb2RlLCBjYXRlZ29yeSwgbWVzc2FnZSwgc2V0cywgb3JpZ2luKSB7XHJcblx0XHQvLyBTbyB0aGF0IHN1YiB0eXBlcyBjYW4gdXNlIGl0J3MgcHJvdG90eXBlLlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChhbGxDb25kaXRpb25UeXBlc1tjb2RlXSkge1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJBIGNvbmRpdGlvbiB0eXBlIHdpdGggdGhlIGNvZGUgXFxcIlwiICsgY29kZSArIFwiXFxcIiBoYXMgYWxyZWFkeSBiZWVuIGNyZWF0ZWQuXCIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImNvZGVcIiwgeyB2YWx1ZTogY29kZSB9KTtcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImNhdGVnb3J5XCIsIHsgdmFsdWU6IGNhdGVnb3J5IH0pO1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwibWVzc2FnZVwiLCB7IHZhbHVlOiBtZXNzYWdlIH0pO1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwic2V0c1wiLCB7IHZhbHVlOiBzZXRzIHx8IFtdIH0pO1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwicnVsZXNcIiwgeyB2YWx1ZTogW10gfSk7XHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJjb25kaXRpb25zXCIsIHsgdmFsdWU6IFtdIH0pO1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwib3JpZ2luXCIsIHsgdmFsdWU6IG9yaWdpbiB9KTtcclxuXHJcblx0XHRpZiAoc2V0cyAmJiBzZXRzLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0QXJyYXkuZm9yRWFjaChzZXRzLCBmdW5jdGlvbihzKSB7XHJcblx0XHRcdFx0cy50eXBlcy5wdXNoKHRoaXMpO1xyXG5cdFx0XHR9LCB0aGlzKTtcclxuXHRcdH1cclxuXHJcblx0XHRhbGxDb25kaXRpb25UeXBlc1tjb2RlXSA9IHRoaXM7XHJcblx0fVxyXG5cclxuXHR2YXIgYWxsQ29uZGl0aW9uVHlwZXMgPSBDb25kaXRpb25UeXBlLmFsbENvbmRpdGlvblR5cGVzID0ge307XHJcblxyXG5cdENvbmRpdGlvblR5cGUuYWxsID0gZnVuY3Rpb24gQ29uZGl0aW9uVHlwZSRhbGwoKSB7XHJcblx0XHQvLy8gPHN1bW1hcnk+XHJcblx0XHQvLy8gUmV0dXJucyBhbiBhcnJheSBvZiBhbGwgY29uZGl0aW9uIHR5cGVzIHRoYXQgaGF2ZSBiZWVuIGNyZWF0ZWQuXHJcblx0XHQvLy8gTm90ZSB0aGF0IHRoZSBhcnJheSBpcyBjcmVhdGVkIGVhY2ggdGltZSB0aGUgZnVuY3Rpb24gaXMgY2FsbGVkLlxyXG5cdFx0Ly8vIDwvc3VtbWFyeT5cclxuXHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiQXJyYXlcIiAvPlxyXG5cclxuXHRcdHZhciBhbGwgPSBbXTtcclxuXHRcdGZvciAodmFyIG5hbWUgaW4gYWxsQ29uZGl0aW9uVHlwZXMpIHtcclxuXHRcdFx0YWxsLnB1c2goYWxsQ29uZGl0aW9uVHlwZXNbbmFtZV0pO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGFsbDtcclxuXHR9XHJcblxyXG5cdENvbmRpdGlvblR5cGUuZ2V0ID0gZnVuY3Rpb24gQ29uZGl0aW9uVHlwZSRnZXQoY29kZSkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5PlxyXG5cdFx0Ly8vIFJldHVybnMgdGhlIGNvbmRpdGlvbiB0eXBlIHdpdGggdGhlIGdpdmVuIGNvZGUsIGlmIGl0IGV4aXN0cy5cclxuXHRcdC8vLyA8L3N1bW1hcnk+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJjb2RlXCIgdHlwZT1cIlN0cmluZ1wiIC8+XHJcblx0XHQvLy8gPHJldHVybnMgdHlwZT1cIkNvbmRpdGlvblR5cGVTZXRcIiAvPlxyXG5cclxuXHRcdHJldHVybiBhbGxDb25kaXRpb25UeXBlc1tjb2RlXTtcclxuXHR9O1xyXG5cclxuXHRDb25kaXRpb25UeXBlLnByb3RvdHlwZSA9IHtcclxuXHJcblx0XHQvLyBhZGRzIG9yIHJlbW92ZXMgYSBjb25kaXRpb24gZnJvbSB0aGUgbW9kZWwgZm9yIHRoZSBzcGVjaWZpZWQgdGFyZ2V0IGlmIG5lY2Vzc2FyeVxyXG5cdFx0d2hlbjogZnVuY3Rpb24gQ29uZGl0aW9uVHlwZSR3aGVuKGNvbmRpdGlvbiwgdGFyZ2V0LCBwcm9wZXJ0aWVzLCBtZXNzYWdlKSB7XHJcblxyXG5cdFx0XHQvLyBnZXQgdGhlIGN1cnJlbnQgY29uZGl0aW9uIGlmIGl0IGV4aXN0c1xyXG5cdFx0XHR2YXIgY29uZGl0aW9uVGFyZ2V0ID0gdGFyZ2V0Lm1ldGEuZ2V0Q29uZGl0aW9uKHRoaXMpO1xyXG5cclxuXHRcdFx0Ly8gYWRkIHRoZSBjb25kaXRpb24gb24gdGhlIHRhcmdldCBpZiBpdCBkb2VzIG5vdCBleGlzdCB5ZXRcclxuXHRcdFx0aWYgKGNvbmRpdGlvbikge1xyXG5cclxuXHRcdFx0XHQvLyBpZiB0aGUgbWVzc2FnZSBpcyBhIGZ1bmN0aW9uLCBpbnZva2UgdG8gZ2V0IHRoZSBhY3R1YWwgbWVzc2FnZVxyXG5cdFx0XHRcdG1lc3NhZ2UgPSBtZXNzYWdlIGluc3RhbmNlb2YgRnVuY3Rpb24gPyBtZXNzYWdlKHRhcmdldCkgOiBtZXNzYWdlO1xyXG5cclxuXHRcdFx0XHQvLyBjcmVhdGUgYSBuZXcgY29uZGl0aW9uIGlmIG9uZSBkb2VzIG5vdCBleGlzdFxyXG5cdFx0XHRcdGlmICghY29uZGl0aW9uVGFyZ2V0KSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gbmV3IENvbmRpdGlvbih0aGlzLCBtZXNzYWdlLCB0YXJnZXQsIHByb3BlcnRpZXMsIFwiY2xpZW50XCIpO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gcmVwbGFjZSB0aGUgY29uZGl0aW9uIGlmIHRoZSBtZXNzYWdlIGhhcyBjaGFuZ2VkXHJcblx0XHRcdFx0ZWxzZSBpZiAobWVzc2FnZSAmJiBtZXNzYWdlICE9IGNvbmRpdGlvblRhcmdldC5jb25kaXRpb24ubWVzc2FnZSkge1xyXG5cclxuXHRcdFx0XHRcdC8vIGRlc3Ryb3kgdGhlIGV4aXN0aW5nIGNvbmRpdGlvblxyXG5cdFx0XHRcdFx0Y29uZGl0aW9uVGFyZ2V0LmNvbmRpdGlvbi5kZXN0cm95KCk7XHJcblxyXG5cdFx0XHRcdFx0Ly8gY3JlYXRlIGEgbmV3IGNvbmRpdGlvbiB3aXRoIHRoZSB1cGRhdGVkIG1lc3NhZ2VcclxuXHRcdFx0XHRcdHJldHVybiBuZXcgQ29uZGl0aW9uKHRoaXMsIG1lc3NhZ2UsIHRhcmdldCwgcHJvcGVydGllcywgXCJjbGllbnRcIik7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBvdGhlcndpc2UsIGp1c3QgcmV0dXJuIHRoZSBleGlzdGluZyBjb25kaXRpb25cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHJldHVybiBjb25kaXRpb25UYXJnZXQuY29uZGl0aW9uO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gRGVzdHJveSB0aGUgY29uZGl0aW9uIGlmIGl0IGV4aXN0cyBvbiB0aGUgdGFyZ2V0IGFuZCBpcyBubyBsb25nZXIgdmFsaWRcclxuXHRcdFx0aWYgKGNvbmRpdGlvblRhcmdldCAhPSBudWxsKVxyXG5cdFx0XHRcdGNvbmRpdGlvblRhcmdldC5jb25kaXRpb24uZGVzdHJveSgpO1xyXG5cclxuXHRcdFx0Ly8gUmV0dXJuIG51bGwgdG8gaW5kaWNhdGUgdGhhdCBubyBjb25kaXRpb24gd2FzIGNyZWF0ZWRcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9LFxyXG5cdFx0ZXh0ZW5kOiBmdW5jdGlvbiBDb25kaXRpb25UeXBlJGV4dGVuZChkYXRhKSB7XHJcblx0XHRcdGZvciAodmFyIHByb3AgaW4gZGF0YSkge1xyXG5cdFx0XHRcdGlmIChwcm9wICE9PSBcInR5cGVcIiAmJiBwcm9wICE9PSBcInJ1bGVcIiAmJiAhdGhpc1tcImdldF9cIiArIHByb3BdKSB7XHJcblx0XHRcdFx0XHR2YXIgZmllbGROYW1lID0gXCJfXCIgKyBwcm9wO1xyXG5cdFx0XHRcdFx0dGhpc1tmaWVsZE5hbWVdID0gZGF0YVtwcm9wXTtcclxuXHRcdFx0XHRcdHRoaXNbXCJnZXRcIiArIGZpZWxkTmFtZV0gPSBmdW5jdGlvbiBDb25kaXRpb25UeXBlJGdldHRlcigpIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIHRoaXNbZmllbGROYW1lXTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHJcblx0XHRhZGRDb25kaXRpb25zQ2hhbmdlZDogZnVuY3Rpb24gQ29uZGl0aW9uVHlwZSRhZGRDb25kaXRpb25zQ2hhbmdlZChoYW5kbGVyKSB7XHJcblxyXG5cdFx0XHQvLyBzdWJzY3JpYmUgdG8gdGhlIGV2ZW50XHJcblx0XHRcdHRoaXMuX2FkZEV2ZW50KFwiY29uZGl0aW9uc0NoYW5nZWRcIiwgaGFuZGxlcik7XHJcblxyXG5cdFx0XHQvLyBSZXR1cm4gdGhlIGNvbmRpdGlvbiB0eXBlIHRvIHN1cHBvcnQgbWV0aG9kIGNoYWluaW5nXHJcblx0XHRcdHJldHVybiB0aGlzO1xyXG5cdFx0fSxcclxuXHJcblx0XHRyZW1vdmVDb25kaXRpb25zQ2hhbmdlZDogZnVuY3Rpb24gQ29uZGl0aW9uVHlwZSRyZW1vdmVDb25kaXRpb25zQ2hhbmdlZChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUV2ZW50KFwiY29uZGl0aW9uc0NoYW5nZWRcIiwgaGFuZGxlcik7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRDb25kaXRpb25UeXBlLm1peGluKEZ1bmN0b3IuZXZlbnRpbmcpO1xyXG5cclxuXHRFeG9XZWIuTW9kZWwuQ29uZGl0aW9uVHlwZSA9IENvbmRpdGlvblR5cGU7XHJcblxyXG5cdChmdW5jdGlvbigpIHtcclxuXHRcdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0XHRmdW5jdGlvbiBFcnJvcihjb2RlLCBtZXNzYWdlLCBzZXRzLCBvcmlnaW4pIHtcclxuXHRcdFx0Q29uZGl0aW9uVHlwZS5jYWxsKHRoaXMsIGNvZGUsIFwiRXJyb3JcIiwgbWVzc2FnZSwgc2V0cywgb3JpZ2luKTtcclxuXHRcdH1cclxuXHJcblx0XHRFcnJvci5wcm90b3R5cGUgPSBuZXcgQ29uZGl0aW9uVHlwZSgpO1xyXG5cclxuXHRcdEV4b1dlYi5Nb2RlbC5Db25kaXRpb25UeXBlLkVycm9yID0gRXJyb3I7XHJcblxyXG5cdFx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHRcdGZ1bmN0aW9uIFdhcm5pbmcoY29kZSwgbWVzc2FnZSwgc2V0cywgb3JpZ2luKSB7XHJcblx0XHRcdENvbmRpdGlvblR5cGUuY2FsbCh0aGlzLCBjb2RlLCBcIldhcm5pbmdcIiwgbWVzc2FnZSwgc2V0cywgb3JpZ2luKTtcclxuXHRcdH1cclxuXHJcblx0XHRXYXJuaW5nLnByb3RvdHlwZSA9IG5ldyBDb25kaXRpb25UeXBlKCk7XHJcblxyXG5cdFx0RXhvV2ViLk1vZGVsLkNvbmRpdGlvblR5cGUuV2FybmluZyA9IFdhcm5pbmc7XHJcblxyXG5cdFx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHRcdGZ1bmN0aW9uIFBlcm1pc3Npb24oY29kZSwgbWVzc2FnZSwgc2V0cywgcGVybWlzc2lvblR5cGUsIGlzQWxsb3dlZCwgb3JpZ2luKSB7XHJcblx0XHRcdENvbmRpdGlvblR5cGUuY2FsbCh0aGlzLCBjb2RlLCBcIlBlcm1pc3Npb25cIiwgbWVzc2FnZSwgc2V0cywgb3JpZ2luKTtcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwicGVybWlzc2lvblR5cGVcIiwgeyB2YWx1ZTogcGVybWlzc2lvblR5cGUgfSk7XHJcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImlzQWxsb3dlZFwiLCB7IHZhbHVlOiBpc0FsbG93ZWQgfSk7XHJcblx0XHR9XHJcblxyXG5cdFx0UGVybWlzc2lvbi5wcm90b3R5cGUgPSBuZXcgQ29uZGl0aW9uVHlwZSgpO1xyXG5cclxuXHRcdEV4b1dlYi5Nb2RlbC5Db25kaXRpb25UeXBlLlBlcm1pc3Npb24gPSBQZXJtaXNzaW9uO1xyXG5cdH0pKCk7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuTW9kZWwuQ29uZGl0aW9uVGFyZ2V0XHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gQ29uZGl0aW9uVGFyZ2V0KGNvbmRpdGlvbiwgdGFyZ2V0LCBwcm9wZXJ0aWVzKSB7XHJcblx0XHQvLy8gPHN1bW1hcnk+UmVwcmVzZW50cyB0aGUgYXNzb2NpYXRpb24gb2YgYSBjb25kaXRpb24gdG8gYSBzcGVjaWZpYyB0YXJnZXQgZW50aXR5Ljwvc3VtbWFyeT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImNvbmRpdGlvblwiIHR5cGU9XCJDb25kaXRpb25cIj5UaGUgY29uZGl0aW9uIHRoZSB0YXJnZXQgaXMgZm9yLjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJ0YXJnZXRcIiB0eXBlPVwiRW50aXR5XCI+VGhlIHRhcmdldCBlbnRpdHkgdGhlIGNvbmRpdGlvbiBpcyBhc3NvY2lhdGVkIHdpdGguPC9wYXJhbT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cInByb3BlcnRpZXNcIiB0eXBlPVwiQXJyYXlcIiBlbGVtZW50VHlwZT1cIlByb3BlcnR5XCI+VGhlIHNldCBvZiBwcm9wZXJ0aWVzIG9uIHRoZSB0YXJnZXQgZW50aXR5IHRoZSBjb25kaXRpb24gaXMgcmVsYXRlZCB0by48L3BhcmFtPlxyXG5cdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJDb25kaXRpb25UYXJnZXRcIj5UaGUgbmV3IGNvbmRpdGlvbiB0YXJnZXQuPC9yZXR1cm5zPlxyXG5cclxuXHQgICAgLy8vIDxmaWVsZCBuYW1lPVwidGFyZ2V0XCIgdHlwZT1cIkVudGl0eVwiPlRoZSB0YXJnZXQgZW50aXR5IHRoZSBjb25kaXRpb24gaXMgYXNzb2NpYXRlZCB3aXRoLjwvZmllbGQ+XHJcblx0ICAgIC8vLyA8ZmllbGQgbmFtZT1cImNvbmRpdGlvblwiIHR5cGU9XCJDb25kaXRpb25cIj5UaGUgY29uZGl0aW9uIHRoZSB0YXJnZXQgaXMgZm9yLjwvZmllbGQ+XHJcblx0ICAgIC8vLyA8ZmllbGQgbmFtZT1cInByb3BlcnRpZXNcIiB0eXBlPVwiQXJyYXlcIiBlbGVtZW50VHlwZT1cIlByb3BlcnR5XCI+VGhlIHNldCBvZiBwcm9wZXJ0aWVzIG9uIHRoZSB0YXJnZXQgZW50aXR5IHRoZSBjb25kaXRpb24gaXMgcmVsYXRlZCB0by48L2ZpZWxkPlxyXG5cclxuXHQgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwidGFyZ2V0XCIsIHsgdmFsdWU6IHRhcmdldCB9KTtcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImNvbmRpdGlvblwiLCB7IHZhbHVlOiBjb25kaXRpb24gfSk7XHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJwcm9wZXJ0aWVzXCIsIHsgdmFsdWU6IHByb3BlcnRpZXMgfSk7XHJcblxyXG5cdFx0Ly8gYXR0YWNoIHRoZSBjb25kaXRpb24gdGFyZ2V0IHRvIHRoZSB0YXJnZXQgZW50aXR5XHJcblx0XHR0YXJnZXQubWV0YS5zZXRDb25kaXRpb24odGhpcyk7XHJcblx0fVxyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLk1vZGVsLkNvbmRpdGlvblxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIENvbmRpdGlvbih0eXBlLCBtZXNzYWdlLCB0YXJnZXQsIHByb3BlcnRpZXMsIG9yaWdpbikge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5PlJlcHJlc2VudHMgYW4gaW5zdGFuY2Ugb2YgYSBjb25kaXRpb24gb2YgYSBzcGVjaWZpYyB0eXBlIGFzc29jaWF0ZWQgd2l0aCBvbmUgb3IgbW9yZSBlbnRpdGllcyBpbiBhIG1vZGVsLjwvc3VtbWFyeT5cclxuXHQgICAgLy8vIDxwYXJhbSBuYW1lPVwidHlwZVwiIHR5cGU9XCJDb25kaXRpb25UeXBlXCI+VGhlIHR5cGUgb2YgY29uZGl0aW9uLCB3aGljaCB1c3VhbGx5IGlzIGFuIGluc3RhbmNlIG9mIGEgc3ViY2xhc3MgbGlrZSBFcnJvciwgV2FybmluZyBvciBQZXJtaXNzaW9uLjwvcGFyYW0+XHJcblx0ICAgIC8vLyA8cGFyYW0gbmFtZT1cIm1lc3NhZ2VcIiB0eXBlPVwiU3RyaW5nXCI+VGhlIG9wdGlvbmFsIG1lc3NhZ2UgdG8gdXNlIGZvciB0aGUgY29uZGl0aW9uLCB3aGljaCB3aWxsIGRlZmF1bHQgdG8gdGhlIGNvbmRpdGlvbiB0eXBlIG1lc3NhZ2UgaWYgbm90IHNwZWNpZmllZC48L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwidGFyZ2V0XCIgdHlwZT1cIkVudGl0eVwiPlRoZSByb290IHRhcmdldCBlbnRpdHkgdGhlIGNvbmRpdGlvbiBpcyBhc3NvY2lhdGVkIHdpdGguPC9wYXJhbT5cclxuXHQgICAgLy8vIDxwYXJhbSBuYW1lPVwicHJvcGVydGllc1wiIHR5cGU9XCJBcnJheVwiIGVsZW1lbnRUeXBlPVwiU3RyaW5nXCI+VGhlIHNldCBvZiBwcm9wZXJ0eSBwYXRocyBzcGVjaWZ5aW5nIHdoaWNoIHByb3BlcnRpZXMgYW5kIGVudGl0aWVzIHRoZSBjb25kaXRpb24gc2hvdWxkIGJlIGF0dGFjaGVkIHRvLjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJvcmlnaW5cIiB0eXBlPVwiU3RyaW5nXCI+VGhlIG9yaWdpbmFsIHNvdXJjZSBvZiB0aGUgY29uZGl0aW9uLCBlaXRoZXIgXCJjbGllbnRcIiBvciBcInNlcnZlclwiLjwvcGFyYW0+XHJcblx0XHQvLy8gPHJldHVybnMgdHlwZT1cIkNvbmRpdGlvblwiPlRoZSBuZXcgY29uZGl0aW9uIGluc3RhbmNlLjwvcmV0dXJucz5cclxuXHJcblx0XHQvLy8gPGZpZWxkIG5hbWU9XCJ0eXBlXCIgdHlwZT1cIkNvbmRpdGlvblR5cGVcIj5UaGUgdHlwZSBvZiBjb25kaXRpb24sIHdoaWNoIHVzdWFsbHkgaXMgYW4gaW5zdGFuY2Ugb2YgYSBzdWJjbGFzcyBsaWtlIEVycm9yLCBXYXJuaW5nIG9yIFBlcm1pc3Npb24uPC9maWVsZD5cclxuXHRcdC8vLyA8ZmllbGQgbmFtZT1cIm1lc3NhZ2VcIiB0eXBlPVwiU3RyaW5nXCI+VGhlIG9wdGlvbmFsIG1lc3NhZ2UgdG8gdXNlIGZvciB0aGUgY29uZGl0aW9uLCB3aGljaCB3aWxsIGRlZmF1bHQgdG8gdGhlIGNvbmRpdGlvbiB0eXBlIG1lc3NhZ2UgaWYgbm90IHNwZWNpZmllZC48L2ZpZWxkPlxyXG5cdFx0Ly8vIDxmaWVsZCBuYW1lPVwib3JpZ2luXCIgdHlwZT1cIlN0cmluZ1wiPlRoZSBvcmlnaW5hbCBzb3VyY2Ugb2YgdGhlIGNvbmRpdGlvbiwgZWl0aGVyIFwiY2xpZW50XCIgb3IgXCJzZXJ2ZXJcIi48L2ZpZWxkPlxyXG5cdFx0Ly8vIDxmaWVsZCBuYW1lPVwidGFyZ2V0c1wiIHR5cGU9XCJBcnJheVwiIGVsZW1lbnRUeXBlPVwiQ29uZGl0aW9uVGFyZ2V0XCI+VGhlIHNldCBvZiBjb25kaXRpb24gdGFyZ2V0cyB0aGF0IGxpbmsgdGhlIGNvbmRpdGlvbiB0byBzcGVjaWZpYyBlbnRpdGllcyBhbmQgcHJvcGVydGllcy48L2ZpZWxkPlxyXG5cclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInR5cGVcIiwgeyB2YWx1ZTogdHlwZSB9KTtcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm1lc3NhZ2VcIiwgeyB2YWx1ZTogbWVzc2FnZSB8fCAodHlwZSA/IHR5cGUubWVzc2FnZSA6IHVuZGVmaW5lZCkgfSk7XHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJvcmlnaW5cIiwgeyB2YWx1ZTogb3JpZ2luIH0pO1xyXG5cclxuXHRcdHZhciB0YXJnZXRzID0gW107XHJcblxyXG5cdFx0Ly8gY3JlYXRlIHRhcmdldHMgaWYgYSByb290IHdhcyBzcGVjaWZpZWRcclxuXHRcdGlmICh0YXJnZXQpIHtcclxuXHJcblx0XHRcdC8vIHNldCB0aGUgcHJvcGVydGllcyB0byBhbiBlbXB0eSBhcnJheSBpZiBub3Qgc3BlY2lmaWVkIGFuZCBub3JtYWxpemUgdGhlIHBhdGhzIHRvIGV4cGFuZCB7fSBzeW50YXggaWYgdXNlZFxyXG5cdFx0XHRwcm9wZXJ0aWVzID0gUGF0aFRva2Vucy5ub3JtYWxpemVQYXRocyhwcm9wZXJ0aWVzIHx8IFtdKTtcclxuXHJcblx0XHRcdC8vIGNyZWF0ZSBhIHNpbmdsZSBjb25kaXRpb24gdGFyZ2V0IGlmIHRoZSBzcGVjaWZpZWQgcHJvcGVydGllcyBhcmUgYWxsIG9uIHRoZSByb290XHJcblx0XHRcdGlmIChwcm9wZXJ0aWVzLmV2ZXJ5KGZ1bmN0aW9uIChwKSB7IHJldHVybiBwLmxlbmd0aCA9PT0gMTsgfSkpXHJcblx0XHRcdFx0dGFyZ2V0cy5wdXNoKG5ldyBDb25kaXRpb25UYXJnZXQodGhpcywgdGFyZ2V0LCBwcm9wZXJ0aWVzKSk7XHJcblxyXG5cdFx0XHQvLyBvdGhlcndpc2UsIHByb2Nlc3MgdGhlIHByb3BlcnR5IHBhdGhzIHRvIGNyZWF0ZSB0aGUgbmVjZXNzYXJ5IHNvdXJjZXNcclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0Ly8gcHJvY2VzcyBlYWNoIHByb3BlcnR5IHBhdGggdG8gYnVpbGQgdXAgdGhlIGNvbmRpdGlvbiBzb3VyY2VzXHJcblx0XHRcdFx0Zm9yICh2YXIgcCA9IHByb3BlcnRpZXMubGVuZ3RoIC0gMTsgcCA+PSAwOyBwLS0pIHtcclxuXHRcdFx0XHRcdHZhciBzdGVwcyA9IHByb3BlcnRpZXNbcF0uc3RlcHM7XHJcblx0XHRcdFx0XHR2YXIgaW5zdGFuY2VzID0gW3RhcmdldF07XHJcblxyXG5cdFx0XHRcdFx0dmFyIGxlYWYgPSBzdGVwcy5sZW5ndGggLSAxO1xyXG5cclxuXHRcdFx0XHRcdC8vIGl0ZXJhdGUgb3ZlciBlYWNoIHN0ZXAgYWxvbmcgdGhlIHBhdGhcclxuXHRcdFx0XHRcdGZvciAodmFyIHMgPSAwOyBzIDwgc3RlcHMubGVuZ3RoOyBzKyspIHtcclxuXHRcdFx0XHRcdFx0dmFyIHN0ZXAgPSBzdGVwc1tzXS5wcm9wZXJ0eTtcclxuXHRcdFx0XHRcdFx0dmFyIGNoaWxkSW5zdGFuY2VzID0gW107XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBjcmVhdGUgY29uZGl0aW9uIHRhcmdldHMgZm9yIGFsbCBpbnN0YW5jZXMgZm9yIHRoZSBjdXJyZW50IHN0ZXAgYWxvbmcgdGhlIHBhdGhcclxuXHRcdFx0XHRcdFx0Zm9yICh2YXIgaSA9IGluc3RhbmNlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG5cdFx0XHRcdFx0XHRcdHZhciBpbnN0YW5jZSA9IGluc3RhbmNlc1tpXTtcclxuXHJcblx0XHRcdFx0XHRcdFx0Ly8gZ2V0IHRoZSBwcm9wZXJ0eSBmb3IgdGhlIGN1cnJlbnQgc3RlcCBhbmQgaW5zdGFuY2UgdHlwZSBhbmQgc2tpcCBpZiB0aGUgcHJvcGVydHkgY2Fubm90IGJlIGZvdW5kXHJcblx0XHRcdFx0XHRcdFx0dmFyIHByb3BlcnR5ID0gaW5zdGFuY2UubWV0YS50eXBlLnByb3BlcnR5KHN0ZXApO1xyXG5cdFx0XHRcdFx0XHRcdGlmICghcHJvcGVydHkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0Ly8gb25seSBjcmVhdGUgY29uZGl0aW9ucyBvbiB0aGUgbGFzdCBzdGVwLCB0aGUgbGVhZiBub2RlXHJcblx0XHRcdFx0XHRcdFx0aWYgKHMgPT09IGxlYWYpIHtcclxuXHRcdFx0XHRcdFx0XHRcdC8vIHNlZSBpZiBhIHRhcmdldCBhbHJlYWR5IGV4aXN0cyBmb3IgdGhlIGN1cnJlbnQgaW5zdGFuY2VcclxuXHRcdFx0XHRcdFx0XHRcdHZhciBjb25kaXRpb25UYXJnZXQgPSBudWxsO1xyXG5cdFx0XHRcdFx0XHRcdFx0Zm9yICh2YXIgdCA9IHRhcmdldHMubGVuZ3RoIC0gMTsgdCA+PSAwOyB0LS0pIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKHRhcmdldHNbdF0udGFyZ2V0ID09PSBpbnN0YW5jZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGNvbmRpdGlvblRhcmdldCA9IHRhcmdldHNbdF07XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0XHQvLyBjcmVhdGUgdGhlIGNvbmRpdGlvbiB0YXJnZXQgaWYgaXQgZG9lcyBub3QgYWxyZWFkeSBleGlzdFxyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKCFjb25kaXRpb25UYXJnZXQpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y29uZGl0aW9uVGFyZ2V0ID0gbmV3IENvbmRpdGlvblRhcmdldCh0aGlzLCBpbnN0YW5jZSwgW3Byb3BlcnR5XSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHRhcmdldHMucHVzaChjb25kaXRpb25UYXJnZXQpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0XHRcdC8vIG90aGVyd2lzZSwganVzdCBlbnN1cmUgaXQgcmVmZXJlbmNlcyB0aGUgY3VycmVudCBzdGVwXHJcblx0XHRcdFx0XHRcdFx0XHRlbHNlIGlmIChjb25kaXRpb25UYXJnZXQucHJvcGVydGllcy5pbmRleE9mKHByb3BlcnR5KSA8IDApXHJcblx0XHRcdFx0XHRcdFx0XHRcdGNvbmRpdGlvblRhcmdldC5wcm9wZXJ0aWVzLnB1c2gocHJvcGVydHkpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0Ly8gZ2V0IHRoZSB2YWx1ZSBvZiB0aGUgY3VycmVudCBzdGVwXHJcblx0XHRcdFx0XHRcdFx0dmFyIGNoaWxkID0gcHJvcGVydHkudmFsdWUoaW5zdGFuY2UpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHQvLyBhZGQgdGhlIGNoaWxkcmVuLCBpZiBhbnksIHRvIHRoZSBzZXQgb2YgY2hpbGQgaW5zdGFuY2VzIHRvIHByb2Nlc3MgZm9yIHRoZSBuZXh0IHN0ZXBcclxuXHRcdFx0XHRcdFx0XHRpZiAoY2hpbGQgaW5zdGFuY2VvZiBFbnRpdHkpXHJcblx0XHRcdFx0XHRcdFx0XHRjaGlsZEluc3RhbmNlcy5wdXNoKGNoaWxkKTtcclxuXHRcdFx0XHRcdFx0XHRlbHNlIGlmIChjaGlsZCBpbnN0YW5jZW9mIEFycmF5ICYmIGNoaWxkLmxlbmd0aCA+IDAgJiYgY2hpbGRbMF0gaW5zdGFuY2VvZiBFbnRpdHkpXHJcblx0XHRcdFx0XHRcdFx0XHRjaGlsZEluc3RhbmNlcyA9IGNoaWxkSW5zdGFuY2VzLmNvbmNhdChjaGlsZCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdC8vIGFzc2lnbiB0aGUgc2V0IG9mIGluc3RhbmNlcyB0byBwcm9jZXNzIGZvciB0aGUgbmV4dCBzdGVwXHJcblx0XHRcdFx0XHRcdGluc3RhbmNlcyA9IGNoaWxkSW5zdGFuY2VzO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdC8vIHN0b3JlIHRoZSBjb25kaXRpb24gdGFyZ2V0c1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwidGFyZ2V0c1wiLCB7IHZhbHVlOiB0YXJnZXRzIH0pO1xyXG5cclxuXHRcdC8vIHJhaXNlIGV2ZW50cyBmb3IgdGhlIG5ldyBjb25kaXRpb25cclxuXHRcdGlmICh0aGlzLnR5cGUgIT0gZm9ybWF0Q29uZGl0aW9uVHlwZSkge1xyXG5cclxuXHRcdFx0Ly8gcmFpc2UgZXZlbnRzIG9uIGNvbmRpdGlvbiB0YXJnZXRzXHJcblx0XHRcdGZvciAodmFyIHQgPSB0YXJnZXRzLmxlbmd0aCAtIDE7IHQgPj0gMDsgdC0tKSB7XHJcblx0XHRcdFx0dmFyIGNvbmRpdGlvblRhcmdldCA9IHRhcmdldHNbdF07XHJcblxyXG5cdFx0XHRcdC8vIGluc3RhbmNlIGV2ZW50c1xyXG5cdFx0XHRcdGNvbmRpdGlvblRhcmdldC50YXJnZXQubWV0YS5fcmFpc2VFdmVudChcImNvbmRpdGlvbnNDaGFuZ2VkXCIsIFtjb25kaXRpb25UYXJnZXQudGFyZ2V0Lm1ldGEsIHsgY29uZGl0aW9uVGFyZ2V0OiBjb25kaXRpb25UYXJnZXQsIGFkZDogdHJ1ZSwgcmVtb3ZlOiBmYWxzZSB9XSk7XHJcblxyXG5cdFx0XHRcdC8vIHR5cGUgZXZlbnRzXHJcblx0XHRcdFx0Zm9yICh2YXIgdHlwZSA9IGNvbmRpdGlvblRhcmdldC50YXJnZXQubWV0YS50eXBlOyB0eXBlOyB0eXBlID0gdHlwZS5iYXNlVHlwZSkge1xyXG5cdFx0XHRcdFx0dHlwZS5fcmFpc2VFdmVudChcImNvbmRpdGlvbnNDaGFuZ2VkXCIsIFtjb25kaXRpb25UYXJnZXQudGFyZ2V0Lm1ldGEsIHsgY29uZGl0aW9uVGFyZ2V0OiBjb25kaXRpb25UYXJnZXQsIGFkZDogdHJ1ZSwgcmVtb3ZlOiBmYWxzZSB9XSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyByYWlzZSBldmVudHMgb24gY29uZGl0aW9uIHR5cGVzXHJcblx0XHRcdHRoaXMudHlwZS5jb25kaXRpb25zLnB1c2godGhpcyk7XHJcblx0XHRcdHRoaXMudHlwZS5fcmFpc2VFdmVudChcImNvbmRpdGlvbnNDaGFuZ2VkXCIsIFt0aGlzLnR5cGUsIHsgY29uZGl0aW9uOiB0aGlzLCBhZGQ6IHRydWUsIHJlbW92ZTogZmFsc2UgfV0pO1xyXG5cclxuXHRcdFx0Ly8gcmFpc2UgZXZlbnRzIG9uIGNvbmRpdGlvbiB0eXBlIHNldHNcclxuXHRcdFx0aWYgKHRoaXMudHlwZS5zZXRzKSB7XHJcblx0XHRcdFx0Zm9yICh2YXIgcyA9IHRoaXMudHlwZS5zZXRzLmxlbmd0aCAtIDE7IHMgPj0gMDsgcy0tKSB7XHJcblx0XHRcdFx0XHR2YXIgc2V0ID0gdGhpcy50eXBlLnNldHNbc107XHJcblx0XHRcdFx0XHRzZXQuY29uZGl0aW9ucy5wdXNoKHRoaXMpO1xyXG5cdFx0XHRcdFx0c2V0Ll9yYWlzZUV2ZW50KFwiY29uZGl0aW9uc0NoYW5nZWRcIiwgW3NldCwgeyBjb25kaXRpb246IHRoaXMsIGFkZDogdHJ1ZSwgcmVtb3ZlOiBmYWxzZSB9XSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvLyBpbXBsZW1lbnRhdGlvblxyXG5cdENvbmRpdGlvbi5taXhpbih7XHJcblx0XHRkZXN0cm95OiBmdW5jdGlvbiBDb25kaXRpb24kZGVzdHJveSgpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5PlJlbW92ZXMgdGhlIGNvbmRpdGlvbiB0YXJnZXRzIGZyb20gYWxsIHRhcmdldCBpbnN0YW5jZXMgYW5kIHJhaXNlcyBjb25kaXRpb24gY2hhbmdlIGV2ZW50cy48L3N1bW1hcnk+XHJcblxyXG5cdFx0XHQvLyByYWlzZSBldmVudHMgb24gY29uZGl0aW9uIHR5cGUgc2V0c1xyXG5cdFx0XHRpZiAodGhpcy50eXBlLnNldHMpIHtcclxuXHRcdFx0XHRmb3IgKHZhciBzID0gdGhpcy50eXBlLnNldHMubGVuZ3RoIC0gMTsgcyA+PSAwOyBzLS0pIHtcclxuXHRcdFx0XHRcdHZhciBzZXQgPSB0aGlzLnR5cGUuc2V0c1tzXTtcclxuXHRcdFx0XHRcdHNldC5jb25kaXRpb25zLnJlbW92ZSh0aGlzKTtcclxuXHRcdFx0XHRcdHNldC5fcmFpc2VFdmVudChcImNvbmRpdGlvbnNDaGFuZ2VkXCIsIFtzZXQsIHsgY29uZGl0aW9uOiB0aGlzLCBhZGQ6IGZhbHNlLCByZW1vdmU6IHRydWUgfV0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gcmFpc2UgZXZlbnRzIG9uIGNvbmRpdGlvbiB0eXBlc1xyXG5cdFx0XHR0aGlzLnR5cGUuY29uZGl0aW9ucy5yZW1vdmUodGhpcyk7XHJcblx0XHRcdHRoaXMudHlwZS5fcmFpc2VFdmVudChcImNvbmRpdGlvbnNDaGFuZ2VkXCIsIFt0aGlzLnR5cGUsIHsgY29uZGl0aW9uOiB0aGlzLCBhZGQ6IGZhbHNlLCByZW1vdmU6IHRydWUgfV0pO1xyXG5cclxuXHRcdFx0Zm9yICh2YXIgdCA9IHRoaXMudGFyZ2V0cy5sZW5ndGggLSAxOyB0ID49IDA7IHQtLSkge1xyXG5cdFx0XHRcdHZhciBjb25kaXRpb25UYXJnZXQgPSB0aGlzLnRhcmdldHNbdF07XHJcblx0XHRcdFx0Y29uZGl0aW9uVGFyZ2V0LnRhcmdldC5tZXRhLmNsZWFyQ29uZGl0aW9uKGNvbmRpdGlvblRhcmdldC5jb25kaXRpb24udHlwZSk7XHJcblxyXG5cdFx0XHRcdC8vIGluc3RhbmNlIGV2ZW50c1xyXG5cdFx0XHRcdGNvbmRpdGlvblRhcmdldC50YXJnZXQubWV0YS5fcmFpc2VFdmVudChcImNvbmRpdGlvbnNDaGFuZ2VkXCIsIFtjb25kaXRpb25UYXJnZXQudGFyZ2V0Lm1ldGEsIHsgY29uZGl0aW9uVGFyZ2V0OiBjb25kaXRpb25UYXJnZXQsIGFkZDogZmFsc2UsIHJlbW92ZTogdHJ1ZSB9XSk7XHJcblxyXG5cdFx0XHRcdC8vIHR5cGUgZXZlbnRzXHJcblx0XHRcdFx0Zm9yICh2YXIgdHlwZSA9IGNvbmRpdGlvblRhcmdldC50YXJnZXQubWV0YS50eXBlOyB0eXBlOyB0eXBlID0gdHlwZS5iYXNlVHlwZSkge1xyXG5cdFx0XHRcdFx0dHlwZS5fcmFpc2VFdmVudChcImNvbmRpdGlvbnNDaGFuZ2VkXCIsIFtjb25kaXRpb25UYXJnZXQudGFyZ2V0Lm1ldGEsIHsgY29uZGl0aW9uVGFyZ2V0OiBjb25kaXRpb25UYXJnZXQsIGFkZDogZmFsc2UsIHJlbW92ZTogdHJ1ZSB9XSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyByZW1vdmUgcmVmZXJlbmNlcyB0byBhbGwgY29uZGl0aW9uIHRhcmdldHNcclxuXHRcdFx0dGhpcy50YXJnZXRzLnNsaWNlKDAsIDApO1xyXG5cdFx0fSxcclxuXHRcdHRvU3RyaW5nOiBmdW5jdGlvbiBDb25kaXRpb24kdG9TdHJpbmcoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLm1lc3NhZ2U7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vIEV4cG9zZSB0aGUgdHlwZSBwdWJsaWNseVxyXG5cdEV4b1dlYi5Nb2RlbC5Db25kaXRpb24gPSBDb25kaXRpb247XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuTW9kZWwuRm9ybWF0RXJyb3JcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHRmdW5jdGlvbiBGb3JtYXRFcnJvcihtZXNzYWdlLCBpbnZhbGlkVmFsdWUpIHtcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm1lc3NhZ2VcIiwgeyB2YWx1ZTogbWVzc2FnZSB9KTtcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImludmFsaWRWYWx1ZVwiLCB7IHZhbHVlOiBpbnZhbGlkVmFsdWUgfSk7XHJcblx0fVxyXG5cclxuXHR2YXIgZm9ybWF0Q29uZGl0aW9uVHlwZSA9IG5ldyBDb25kaXRpb25UeXBlLkVycm9yKFwiRm9ybWF0RXJyb3JcIiwgXCJUaGUgdmFsdWUgaXMgbm90IHByb3Blcmx5IGZvcm1hdHRlZC5cIiwgW10pO1xyXG5cclxuXHRGb3JtYXRFcnJvci5taXhpbih7XHJcblx0XHRjcmVhdGVDb25kaXRpb246IGZ1bmN0aW9uIEZvcm1hdEVycm9yJGNyZWF0ZUNvbmRpdGlvbih0YXJnZXQsIHByb3ApIHtcclxuXHRcdFx0cmV0dXJuIG5ldyBDb25kaXRpb24oZm9ybWF0Q29uZGl0aW9uVHlwZSxcclxuXHRcdFx0XHR0aGlzLm1lc3NhZ2UucmVwbGFjZShcIntwcm9wZXJ0eX1cIiwgcHJvcC5nZXRfbGFiZWwoKSksXHJcblx0XHRcdFx0dGFyZ2V0LFxyXG5cdFx0XHRcdFtwcm9wLmdldF9uYW1lKCldLFxyXG5cdFx0XHRcdFwiY2xpZW50XCIpO1xyXG5cdFx0fSxcclxuXHRcdHRvU3RyaW5nOiBmdW5jdGlvbiBGb3JtYXRlRXJyb3IkdG9TdHJpbmcoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9pbnZhbGlkVmFsdWU7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdEV4b1dlYi5Nb2RlbC5Gb3JtYXRFcnJvciA9IEZvcm1hdEVycm9yO1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLk1vZGVsLkZvcm1hdFByb3ZpZGVyXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0dmFyIGZvcm1hdFByb3ZpZGVyID0gZnVuY3Rpb24gZm9ybWF0UHJvdmlkZXIodHlwZSwgZm9ybWF0KSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJGb3JtYXQgcHJvdmlkZXIgaGFzIG5vdCBiZWVuIGltcGxlbWVudGVkLiAgQ2FsbCBFeG9XZWIuTW9kZWwuc2V0Rm9ybWF0UHJvdmlkZXIoZm4pO1wiKTtcclxuXHR9O1xyXG5cclxuXHRmdW5jdGlvbiBnZXRGb3JtYXQodHlwZSwgZm9ybWF0KSB7XHJcblxyXG5cdFx0Ly8gcmV0dXJuIG51bGwgaWYgYSBmb3JtYXQgc3BlY2lmaWVyIHdhcyBub3QgcHJvdmlkZWRcclxuXHRcdGlmICghZm9ybWF0IHx8IGZvcm1hdCA9PT0gJycpXHJcblx0XHRcdHJldHVybiBudWxsO1xyXG5cclxuXHRcdC8vIGluaXRpYWxpemUgZm9ybWF0IGNhY2hlXHJcblx0XHRpZiAoIXR5cGUuX2Zvcm1hdHMpXHJcblx0XHRcdHR5cGUuX2Zvcm1hdHMgPSB7fTtcclxuXHJcblx0XHQvLyBmaXJzdCBzZWUgaWYgdGhlIHJlcXVlc3RlZCBmb3JtYXQgaXMgY2FjaGVkXHJcblx0XHR2YXIgZiA9IHR5cGUuX2Zvcm1hdHNbZm9ybWF0XTtcclxuXHRcdGlmIChmKVxyXG5cdFx0XHRyZXR1cm4gZjtcclxuXHJcblx0XHQvLyB0aGVuIHNlZSBpZiBpdCBpcyBhbiBlbnRpdHkgdHlwZVxyXG5cdFx0aWYgKHR5cGUubWV0YSAmJiB0eXBlLm1ldGEgaW5zdGFuY2VvZiBUeXBlKVxyXG5cdFx0XHR0eXBlLl9mb3JtYXRzW2Zvcm1hdF0gPSBmID0gRm9ybWF0LmZyb21UZW1wbGF0ZSh0eXBlLCBmb3JtYXQpO1xyXG5cclxuXHRcdC8vIG90aGVyd2lzZSwgY2FsbCB0aGUgZm9ybWF0IHByb3ZpZGVyIHRvIGNyZWF0ZSBhIG5ldyBmb3JtYXRcclxuXHRcdGVsc2VcclxuXHRcdFx0dHlwZS5fZm9ybWF0c1tmb3JtYXRdID0gZiA9IGZvcm1hdFByb3ZpZGVyKHR5cGUsIGZvcm1hdCk7XHJcblxyXG5cdFx0cmV0dXJuIGY7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBzZXRGb3JtYXRQcm92aWRlcihmbikge1xyXG5cdFx0Zm9ybWF0UHJvdmlkZXIgPSBmbjtcclxuXHR9XHJcblxyXG5cdEV4b1dlYi5Nb2RlbC5nZXRGb3JtYXQgPSBnZXRGb3JtYXQ7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuTW9kZWwuTGF6eUxvYWRlclxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdC8qZ2xvYmFsIGlzVHlwZSwgUGF0aFRva2VucywgbG9nV2FybmluZywgcGFyc2VGdW5jdGlvbk5hbWUsIGdldFZhbHVlLCBTaWduYWwgKi9cclxuXHJcblx0ZnVuY3Rpb24gTGF6eUxvYWRlcigpIHtcclxuXHR9XHJcblxyXG5cdExhenlMb2FkZXIuZXZhbCA9IGZ1bmN0aW9uIExhenlMb2FkZXIkZXZhbCh0YXJnZXQsIHBhdGgsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgc2NvcGVDaGFpbiwgdGhpc1B0ci8qLCBjb250aW51ZUZuLCBwZXJmb3JtZWRMb2FkaW5nLCByb290LCBwcm9jZXNzZWQsIGludm9rZUltbWVkaWF0ZWx5SWZQb3NzaWJsZSovKSB7XHJcblx0XHR2YXIgcHJvY2Vzc2VkLCByb290LCBwZXJmb3JtZWRMb2FkaW5nLCBjb250aW51ZUZuLCBzdGVwLCBpLCB2YWx1ZSwgaW52b2tlSW1tZWRpYXRlbHlJZlBvc3NpYmxlO1xyXG5cclxuXHRcdGlmIChwYXRoID09PSB1bmRlZmluZWQgfHwgcGF0aCA9PT0gbnVsbCkge1xyXG5cdFx0XHRwYXRoID0gXCJcIjtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoaXNUeXBlKHBhdGgsIFN0cmluZykpIHtcclxuXHRcdFx0cGF0aCA9IG5ldyBQYXRoVG9rZW5zKHBhdGgpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAoaXNUeXBlKHBhdGgsIEFycmF5KSkge1xyXG5cdFx0XHRsb2dXYXJuaW5nKFwiQ2FsbGluZyBMYXp5TG9hZGVyLmV2YWwgd2l0aCBhIHBhdGggQXJyYXkgaXMgZGVwcmVjYXRlZCwgcGxlYXNlIHVzZSBhIHN0cmluZyBwYXRoIGluc3RlYWQuXCIpO1xyXG5cdFx0XHRwYXRoID0gbmV3IFBhdGhUb2tlbnMocGF0aC5qb2luKFwiLlwiKSk7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmICghaXNUeXBlKHBhdGgsIFBhdGhUb2tlbnMpKSB7XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIlVua25vd24gcGF0aCBcXFwiXCIgKyBwYXRoICsgXCJcXFwiIG9mIHR5cGUgXCIgKyBwYXJzZUZ1bmN0aW9uTmFtZShwYXRoLmNvbnN0cnVjdG9yKSArIFwiLlwiKTtcclxuXHRcdH1cclxuXHJcblx0XHRzY29wZUNoYWluID0gc2NvcGVDaGFpbiB8fCBbd2luZG93XTtcclxuXHJcblx0XHQvLyBJZiBhZGRpdGlvbmFsIGFyZ3VtZW50cyB3ZXJlIHNwZWNpZmllZCAoaW50ZXJuYWwpLCB0aGVuIHVzZSB0aG9zZS5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxMSkge1xyXG5cdFx0XHQvLyBBbGxvdyBhbiBpbnZvY2F0aW9uIHRvIHNwZWNpZnkgY29udGludWluZyBsb2FkaW5nIHByb3BlcnRpZXMgdXNpbmcgYSBnaXZlbiBmdW5jdGlvbiwgYnkgZGVmYXVsdCB0aGlzIGlzIExhenlMb2FkZXIuZXZhbC5cclxuXHRcdFx0Ly8gVGhpcyBpcyB1c2VkIGJ5IGV2YWxBbGwgdG8gZW5zdXJlIHRoYXQgYXJyYXkgcHJvcGVydGllcyBjYW4gYmUgZm9yY2UgbG9hZGVkIGF0IGFueSBwb2ludCBpbiB0aGUgcGF0aC5cclxuXHRcdFx0Y29udGludWVGbiA9IGFyZ3VtZW50c1s2XSBpbnN0YW5jZW9mIEZ1bmN0aW9uID8gYXJndW1lbnRzWzZdIDogY29udGludWVGbjtcclxuXHRcdFx0Ly8gQWxsb3cgcmVjdXJzaXZlIGNhbGxpbmcgZnVuY3Rpb24gKGV2YWwgb3IgZXZhbEFsbCkgdG8gc3BlY2lmeSB0aGF0IGxvYWRpbmcgd2FzIHBlcmZvcm1lZC5cclxuXHRcdFx0cGVyZm9ybWVkTG9hZGluZyA9IGFyZ3VtZW50c1s3XSBpbnN0YW5jZW9mIEJvb2xlYW4gPyBhcmd1bWVudHNbN10gOiBmYWxzZTtcclxuXHRcdFx0Ly8gQWxsb3cgcmVjdXJzaXZlIGNhbGxpbmcgZnVuY3Rpb24gKGV2YWwgb3IgZXZhbEFsbCkgdG8gc3BlY2lmeSB0aGUgcm9vdCBvYmplY3QgYmVpbmcgdXNlZC5cclxuXHRcdFx0cm9vdCA9IGFyZ3VtZW50c1s4XTtcclxuXHRcdFx0Ly8gQWxsb3cgcmVjdXJzaXZlIGNhbGxpbmcgZnVuY3Rpb24gKGV2YWwgb3IgZXZhbEFsbCkgdG8gc3BlY2lmeSB0aGUgcHJvY2Vzc2VkIHN0ZXBzLlxyXG5cdFx0XHRwcm9jZXNzZWQgPSBhcmd1bWVudHNbOV07XHJcblx0XHRcdC8vIEFsbG93IHJlY3Vyc2l2ZSBjYWxsaW5nIGZ1bmN0aW9uIChldmFsIG9yIGV2YWxBbGwpIHRvIHNwZWNpZnkgd2hldGhlciB0byBpbnZva2UgdGhlIGNhbGxiYWNrIGltbW1lZGlhdGVseSBpZiBwb3NzaWJsZSAod2hlbiBubyBsb2FkaW5nIGlzIHJlcXVpcmVkKS5cclxuXHRcdFx0aW52b2tlSW1tZWRpYXRlbHlJZlBvc3NpYmxlID0gYXJndW1lbnRzWzEwXTtcclxuXHRcdH1cclxuXHRcdC8vIEluaXRpYWxpemUgdG8gZGVmYXVsdHMuXHJcblx0XHRlbHNlIHtcclxuXHRcdFx0Y29udGludWVGbiA9IExhenlMb2FkZXIuZXZhbDtcclxuXHRcdFx0cGVyZm9ybWVkTG9hZGluZyA9IGZhbHNlO1xyXG5cdFx0XHRyb290ID0gdGFyZ2V0O1xyXG5cdFx0XHRwcm9jZXNzZWQgPSBbXTtcclxuXHRcdFx0aW52b2tlSW1tZWRpYXRlbHlJZlBvc3NpYmxlID0gbnVsbDtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBJZiB0aGUgdGFyZ2V0IGlzIG51bGwgb3IgdW5kZWZpbmVkIHRoZW4gYXR0ZW1wdCB0byBiYWNrdHJhY2sgdXNpbmcgdGhlIHNjb3BlIGNoYWluXHJcblx0XHRpZiAodGFyZ2V0ID09PSB1bmRlZmluZWQgfHwgdGFyZ2V0ID09PSBudWxsKSB7XHJcblx0XHRcdHRhcmdldCA9IHJvb3QgPSBzY29wZUNoYWluLmRlcXVldWUoKTtcclxuXHRcdH1cclxuXHRcclxuXHRcdHdoaWxlIChwYXRoLnN0ZXBzLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0Ly8gSWYgbnVsbCBvciB1bmRlZmluZWQgd2FzIHBhc3NlZCBpbiB3aXRoIG5vIHNjb3BlIGNoYWluLCBmYWlsXHJcblx0XHRcdGlmICh0YXJnZXQgPT09IHVuZGVmaW5lZCB8fCB0YXJnZXQgPT09IG51bGwpIHtcclxuXHRcdFx0XHRpZiAoZXJyb3JDYWxsYmFjaykge1xyXG5cdFx0XHRcdFx0ZXJyb3JDYWxsYmFjay5hcHBseSh0aGlzUHRyIHx8IHRoaXMsIFtcIlRhcmdldCBpcyBudWxsIG9yIHVuZGVmaW5lZFwiXSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGNvbXBsZXRlIHByb3BlcnR5IGV2YWx1YXRpb24gYmVjYXVzZSB0aGUgdGFyZ2V0IGlzIG51bGwgb3IgdW5kZWZpbmVkXCIpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gSWYgYW4gYXJyYXkgaXMgZW5jb3VudGVyZWQgYW5kIHRoaXMgY2FsbCBvcmlnaW5hdGVkIGZyb20gXCJldmFsQWxsXCIgdGhlbiBkZWxlZ2F0ZSB0byBcImV2YWxBbGxcIiwgb3RoZXJ3aXNlXHJcblx0XHRcdC8vIHRoaXMgd2lsbCBtb3N0IGxpa2VseSBiZSBhbiBlcnJvciBjb25kaXRpb24gdW5sZXNzIHRoZSByZW1haW5kZXIgb2YgdGhlIHBhdGggYXJlIHByb3BlcnRpZXMgb2YgQXJyYXkuXHJcblx0XHRcdGlmIChjb250aW51ZUZuICE9PSBMYXp5TG9hZGVyLmV2YWwgJiYgdGFyZ2V0IGluc3RhbmNlb2YgQXJyYXkpIHtcclxuXHRcdFx0XHRjb250aW51ZUZuKHRhcmdldCwgcGF0aCwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBzY29wZUNoYWluLCB0aGlzUHRyLCBjb250aW51ZUZuLCBwZXJmb3JtZWRMb2FkaW5nLCByb290LCBwcm9jZXNzZWQsIGludm9rZUltbWVkaWF0ZWx5SWZQb3NzaWJsZSk7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBHZXQgdGhlIG5leHQgc3RlcCB0byBldmFsdWF0ZVxyXG5cdFx0XHRzdGVwID0gcGF0aC5zdGVwcy5kZXF1ZXVlKCk7XHJcblxyXG5cdFx0XHQvLyBJZiB0aGUgdGFyZ2V0IGlzIG5vdCBsb2FkZWQgdGhlbiBsb2FkIGl0IGFuZCBjb250aW51ZSB3aGVuIGNvbXBsZXRlXHJcblx0XHRcdGlmIChMYXp5TG9hZGVyLmlzUmVnaXN0ZXJlZCh0YXJnZXQsIG51bGwsIHN0ZXAucHJvcGVydHkpKSB7XHJcblx0XHRcdFx0cGVyZm9ybWVkTG9hZGluZyA9IHRydWU7XHJcblx0XHRcdFx0QXJyYXkuaW5zZXJ0KHBhdGguc3RlcHMsIDAsIHN0ZXApO1xyXG5cdFx0XHRcdExhenlMb2FkZXIubG9hZCh0YXJnZXQsIHN0ZXAucHJvcGVydHksIGZhbHNlLCBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRjb250aW51ZUZuKHRhcmdldCwgcGF0aCwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBzY29wZUNoYWluLCB0aGlzUHRyLCBjb250aW51ZUZuLCBwZXJmb3JtZWRMb2FkaW5nLCByb290LCBwcm9jZXNzZWQsIGludm9rZUltbWVkaWF0ZWx5SWZQb3NzaWJsZSk7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBHZXQgdGhlIHZhbHVlIG9mIHRoZSBjdXJyZW50IHN0ZXBcclxuXHRcdFx0dmFsdWUgPSBnZXRWYWx1ZSh0YXJnZXQsIHN0ZXAucHJvcGVydHkpO1xyXG5cclxuXHRcdFx0Ly8gSWYgdGhlIHZhbHVlIGlzIHVuZGVmaW5lZCB0aGVuIHRoZXJlIGlzIGEgcHJvYmxlbSBzaW5jZSBnZXRWYWx1ZSByZXR1cm5zIG51bGwgaWYgYSBwcm9wZXJ0eSBleGlzdHMgYnV0IHJldHVybnMgbm8gdmFsdWUuXHJcblx0XHRcdGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0Ly8gQXR0ZW1wdCB0byBiYWNrdHJhY2sgdXNpbmcgdGhlIG5leHQgaXRlbSBpbiB0aGUgc2NvcGUgY2hhaW4uXHJcblx0XHRcdFx0aWYgKHNjb3BlQ2hhaW4ubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdFx0dGFyZ2V0ID0gcm9vdCA9IHNjb3BlQ2hhaW4uZGVxdWV1ZSgpO1xyXG5cdFx0XHRcdFx0QXJyYXkuaW5zZXJ0KHBhdGguc3RlcHMsIDAsIHN0ZXApO1xyXG5cdFx0XHRcdFx0Zm9yIChpID0gcHJvY2Vzc2VkLmxlbmd0aCAtIDE7IGkgPj0gMDsgaSAtPSAxKSB7XHJcblx0XHRcdFx0XHRcdEFycmF5Lmluc2VydChwYXRoLnN0ZXBzLCAwLCBwcm9jZXNzZWRbaV0pO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0cHJvY2Vzc2VkLmxlbmd0aCA9IDA7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdC8vIE90aGVyd2lzZSwgZmFpbCBzaW5jZSB0aGUgcGF0aCBjb3VsZCBub3QgYmUgZXZhbHVhdGVkXHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRpZiAoZXJyb3JDYWxsYmFjaykge1xyXG5cdFx0XHRcdFx0XHRlcnJvckNhbGxiYWNrLmFwcGx5KHRoaXNQdHIgfHwgdGhpcywgW1wiUHJvcGVydHkgaXMgdW5kZWZpbmVkOiBcIiArIHN0ZXAucHJvcGVydHldKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgY29tcGxldGUgcHJvcGVydHkgZXZhbHVhdGlvbiBiZWNhdXNlIGEgcHJvcGVydHkgaXMgdW5kZWZpbmVkOiBcIiArIHN0ZXAucHJvcGVydHkpO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0Ly8gVGhlIG5leHQgdGFyZ2V0IGlzIG51bGwgKG5vdGhpbmcgbGVmdCB0byBldmFsdWF0ZSkgb3IgdGhlcmUgaXMgYSBjYXN0IG9mIHRoZSBjdXJyZW50IHByb3BlcnR5IGFuZCB0aGUgdmFsdWUgaXNcclxuXHRcdFx0Ly8gbm90IG9mIHRoZSBjYXN0IHR5cGUgKG5vIG5lZWQgdG8gY29udGludWUgZXZhbHVhdGluZykuXHJcblx0XHRcdGVsc2UgaWYgKHZhbHVlID09PSBudWxsIHx8IChzdGVwLmNhc3QgJiYgIWlzVHlwZSh2YWx1ZSwgc3RlcC5jYXN0KSkpIHtcclxuXHRcdFx0XHRpZiAoc3VjY2Vzc0NhbGxiYWNrKSB7XHJcblx0XHRcdFx0XHRzdWNjZXNzQ2FsbGJhY2suYXBwbHkodGhpc1B0ciB8fCB0aGlzLCBbbnVsbCwgcGVyZm9ybWVkTG9hZGluZywgcm9vdF0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHRcdFx0Ly8gT3RoZXJ3aXNlLCBjb250aW51ZSB0byB0aGUgbmV4dCBwcm9wZXJ0eS5cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0cHJvY2Vzc2VkLnB1c2goc3RlcCk7XHJcblx0XHRcdFx0dGFyZ2V0ID0gdmFsdWU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHQvLyBMb2FkIGZpbmFsIG9iamVjdFxyXG5cdFx0aWYgKHRhcmdldCAhPT0gdW5kZWZpbmVkICYmIHRhcmdldCAhPT0gbnVsbCAmJiBMYXp5TG9hZGVyLmlzUmVnaXN0ZXJlZCh0YXJnZXQpKSB7XHJcblx0XHRcdHBlcmZvcm1lZExvYWRpbmcgPSB0cnVlO1xyXG5cdFx0XHRMYXp5TG9hZGVyLmxvYWQodGFyZ2V0LCBudWxsLCBmYWxzZSwgc3VjY2Vzc0NhbGxiYWNrID8gc3VjY2Vzc0NhbGxiYWNrLnByZXBhcmUodGhpc1B0ciB8fCB0aGlzLCBbdGFyZ2V0LCBwZXJmb3JtZWRMb2FkaW5nLCByb290XSkgOiB1bmRlZmluZWQpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAoc3VjY2Vzc0NhbGxiYWNrKSB7XHJcblx0XHRcdHN1Y2Nlc3NDYWxsYmFjay5hcHBseSh0aGlzUHRyIHx8IHRoaXMsIFt0YXJnZXQsIHBlcmZvcm1lZExvYWRpbmcsIHJvb3RdKTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRMYXp5TG9hZGVyLmV2YWxBbGwgPSBmdW5jdGlvbiBMYXp5TG9hZGVyJGV2YWxBbGwodGFyZ2V0LCBwYXRoLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIHNjb3BlQ2hhaW4sIHRoaXNQdHIvKiwgY29udGludWVGbiwgcGVyZm9ybWVkTG9hZGluZywgcm9vdCwgcHJvY2Vzc2VkLCBpbnZva2VJbW1lZGlhdGVseUlmUG9zc2libGUqLykge1xyXG5cdFx0dmFyIHJvb3QsIHBlcmZvcm1lZExvYWRpbmcsIHByb2Nlc3NlZCwgaW52b2tlSW1tZWRpYXRlbHlJZlBvc3NpYmxlLCBzaWduYWwsIHJlc3VsdHMsIGVycm9ycywgc3VjY2Vzc0NhbGxiYWNrcywgZXJyb3JDYWxsYmFja3MsIGFsbFN1Y2NlZWRlZDtcclxuXHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMTEpIHtcclxuXHRcdFx0cGVyZm9ybWVkTG9hZGluZyA9IGFyZ3VtZW50c1s3XSBpbnN0YW5jZW9mIEJvb2xlYW4gPyBhcmd1bWVudHNbN10gOiBmYWxzZTtcclxuXHRcdFx0cm9vdCA9IGFyZ3VtZW50c1s4XTtcclxuXHRcdFx0cHJvY2Vzc2VkID0gYXJndW1lbnRzWzldO1xyXG5cdFx0XHRpbnZva2VJbW1lZGlhdGVseUlmUG9zc2libGUgPSBhcmd1bWVudHNbMTBdO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHBlcmZvcm1lZExvYWRpbmcgPSBmYWxzZTtcclxuXHRcdFx0cm9vdCA9IHRhcmdldDtcclxuXHRcdFx0cHJvY2Vzc2VkID0gW107XHJcblx0XHRcdGludm9rZUltbWVkaWF0ZWx5SWZQb3NzaWJsZSA9IG51bGw7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gRW5zdXJlIHRoYXQgdGhlIHRhcmdldCBpcyBhbiBhcnJheVxyXG5cdFx0aWYgKCEodGFyZ2V0IGluc3RhbmNlb2YgQXJyYXkpKSB7XHJcblx0XHRcdExhenlMb2FkZXIuZXZhbCh0YXJnZXQsIHBhdGgsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgc2NvcGVDaGFpbiwgdGhpc1B0ciwgTGF6eUxvYWRlci5ldmFsQWxsLCBwZXJmb3JtZWRMb2FkaW5nLCByb290LCBwcm9jZXNzZWQsIGludm9rZUltbWVkaWF0ZWx5SWZQb3NzaWJsZSk7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdFx0Ly8gRW5zdXJlIHRoYXQgdGhlIGFycmF5IGlzIGxvYWRlZCwgdGhlbiBjb250aW51ZVxyXG5cdFx0ZWxzZSBpZiAoTGF6eUxvYWRlci5pc1JlZ2lzdGVyZWQodGFyZ2V0KSkge1xyXG5cdFx0XHRMYXp5TG9hZGVyLmxvYWQodGFyZ2V0LCBudWxsLCBmYWxzZSwgZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdExhenlMb2FkZXIuZXZhbEFsbCh0YXJnZXQsIHBhdGgsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgc2NvcGVDaGFpbiwgdGhpc1B0ciwgTGF6eUxvYWRlci5ldmFsQWxsLCBwZXJmb3JtZWRMb2FkaW5nLCByb290LCBwcm9jZXNzZWQsIGludm9rZUltbWVkaWF0ZWx5SWZQb3NzaWJsZSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0c2lnbmFsID0gbmV3IFNpZ25hbChcImV2YWxBbGwgLSBcIiArIHBhdGgpO1xyXG5cdFx0cmVzdWx0cyA9IFtdO1xyXG5cdFx0ZXJyb3JzID0gW107XHJcblx0XHRzdWNjZXNzQ2FsbGJhY2tzID0gW107XHJcblx0XHRlcnJvckNhbGxiYWNrcyA9IFtdO1xyXG5cdFx0YWxsU3VjY2VlZGVkID0gdHJ1ZTtcclxuXHJcblx0XHR0YXJnZXQuZm9yRWFjaChmdW5jdGlvbiAoc3ViVGFyZ2V0LCBpKSB7XHJcblx0XHRcdHJlc3VsdHMucHVzaChudWxsKTtcclxuXHRcdFx0ZXJyb3JzLnB1c2gobnVsbCk7XHJcblx0XHRcdHN1Y2Nlc3NDYWxsYmFja3MucHVzaChzaWduYWwucGVuZGluZyhmdW5jdGlvbiAocmVzdWx0LCBwZXJmb3JtZWRMb2FkaW5nT25lLCByb290T25lKSB7XHJcblx0XHRcdFx0cGVyZm9ybWVkTG9hZGluZyA9IHBlcmZvcm1lZExvYWRpbmcgfHwgcGVyZm9ybWVkTG9hZGluZ09uZTtcclxuXHRcdFx0XHRyZXN1bHRzW2ldID0gcmVzdWx0O1xyXG5cdFx0XHRcdGlmIChyb290ICE9PSByb290T25lKSB7XHJcblx0XHRcdFx0XHRsb2dXYXJuaW5nKFwiRm91bmQgZGlmZmVyZW50IHJvb3RzIHdoZW4gZXZhbHVhdGluZyBhbGwgcGF0aHMuXCIpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRyb290ID0gcm9vdE9uZTtcclxuXHRcdFx0fSwgbnVsbCwgaW52b2tlSW1tZWRpYXRlbHlJZlBvc3NpYmxlKSk7XHJcblx0XHRcdGVycm9yQ2FsbGJhY2tzLnB1c2goc2lnbmFsLm9yUGVuZGluZyhmdW5jdGlvbiAoZXJyKSB7XHJcblx0XHRcdFx0YWxsU3VjY2VlZGVkID0gZmFsc2U7XHJcblx0XHRcdFx0ZXJyb3JzW2ldID0gZXJyO1xyXG5cdFx0XHR9LCBudWxsLCBpbnZva2VJbW1lZGlhdGVseUlmUG9zc2libGUpKTtcclxuXHRcdH0pO1xyXG5cclxuXHRcdHRhcmdldC5mb3JFYWNoKGZ1bmN0aW9uIChzdWJUYXJnZXQsIGkpIHtcclxuXHRcdFx0Ly8gTWFrZSBhIGNvcHkgb2YgdGhlIG9yaWdpbmFsIHBhdGggdG9rZW5zIGZvciBhcnJheXMgc28gdGhhdCBpdGVtcycgcHJvY2Vzc2luZyBkb24ndCBhZmZlY3Qgb25lIGFub3RoZXIuXHJcblx0XHRcdGlmIChwYXRoIGluc3RhbmNlb2YgUGF0aFRva2Vucykge1xyXG5cdFx0XHRcdHBhdGggPSBwYXRoLmJ1aWxkRXhwcmVzc2lvbigpO1xyXG5cdFx0XHR9XHJcblx0XHRcdExhenlMb2FkZXIuZXZhbChzdWJUYXJnZXQsIHBhdGgsIHN1Y2Nlc3NDYWxsYmFja3NbaV0sIGVycm9yQ2FsbGJhY2tzW2ldLCBzY29wZUNoYWluLCB0aGlzUHRyLCBMYXp5TG9hZGVyLmV2YWxBbGwsIHBlcmZvcm1lZExvYWRpbmcsIHJvb3QsIHByb2Nlc3NlZC5zbGljZSgwKSwgaW52b2tlSW1tZWRpYXRlbHlJZlBvc3NpYmxlKTtcclxuXHRcdH0pO1xyXG5cclxuXHRcdHNpZ25hbC53YWl0Rm9yQWxsKGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0aWYgKGFsbFN1Y2NlZWRlZCkge1xyXG5cdFx0XHRcdC8vIGNhbGwgdGhlIHN1Y2Nlc3MgY2FsbGJhY2sgaWYgb25lIGV4aXN0c1xyXG5cdFx0XHRcdGlmIChzdWNjZXNzQ2FsbGJhY2spIHtcclxuXHRcdFx0XHRcdHN1Y2Nlc3NDYWxsYmFjay5hcHBseSh0aGlzUHRyIHx8IHRoaXMsIFtyZXN1bHRzLCBwZXJmb3JtZWRMb2FkaW5nLCByb290XSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKGVycm9yQ2FsbGJhY2spIHtcclxuXHRcdFx0XHRlcnJvckNhbGxiYWNrLmFwcGx5KHRoaXNQdHIgfHwgdGhpcywgW2Vycm9yc10pO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdGVycm9ycy5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7XHJcblx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJFcnJvciBlbmNvdW50ZXJlZCB3aGlsZSBhdHRlbXB0aW5nIHRvIGV2YWwgcGF0aHMgZm9yIGFsbCBpdGVtcyBpbiB0aGUgdGFyZ2V0IGFycmF5OiBcIiArIGUpO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblx0XHR9LCBudWxsLCBpbnZva2VJbW1lZGlhdGVseUlmUG9zc2libGUpO1xyXG5cdH07XHJcblxyXG5cdExhenlMb2FkZXIuaXNSZWdpc3RlcmVkID0gZnVuY3Rpb24gTGF6eUxvYWRlciRpc1JlZ2lzdGVyZWQob2JqLCB0YXJnZXRMb2FkZXIsIHRhcmdldFByb3BlcnR5KSB7XHJcblx0XHR2YXIgcmVnLCBsb2FkZXIsIHByb3BlcnR5TG9hZGVyLCB0YXJnZXRQcm9wZXJ0eU5hbWU7XHJcblxyXG5cdFx0aWYgKG9iaiA9PT0gbnVsbCB8fCBvYmogPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHR9XHJcblxyXG5cdFx0cmVnID0gb2JqLl9sYXp5TG9hZGVyO1xyXG5cclxuXHRcdGlmICghcmVnKSB7XHJcblx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAodGFyZ2V0UHJvcGVydHkpIHtcclxuXHRcdFx0aWYgKGlzU3RyaW5nKHRhcmdldFByb3BlcnR5KSkge1xyXG5cdFx0XHRcdHRhcmdldFByb3BlcnR5TmFtZSA9IHRhcmdldFByb3BlcnR5O1xyXG5cdFx0XHR9IGVsc2UgaWYgKHRhcmdldFByb3BlcnR5IGluc3RhbmNlb2YgUHJvcGVydHkpIHtcclxuXHRcdFx0XHR0YXJnZXRQcm9wZXJ0eU5hbWUgPSB0YXJnZXRQcm9wZXJ0eS5nZXRfbmFtZSgpO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIlVuZXhwZWN0ZWQgdGFyZ2V0UHJvcGVydHkgYXJndW1lbnQgdmFsdWUgXFxcIlwiICsgdGFyZ2V0UHJvcGVydHkgKyBcIlxcXCIgaW4gTGF6eUxvYWRlci5pc1JlZ2lzdGVyZWQoKS5cIik7XHJcblx0XHRcdH1cclxuXHRcdFx0Ly8gQXR0ZW1wdCB0byByZXRyaWV2ZSBhIHByb3BlcnR5LXNwZWNpZmljIGxvYWRlciBpZiBpdCBleGlzdHMuXHJcblx0XHRcdGlmIChyZWcuYnlQcm9wICYmIHJlZy5ieVByb3AuaGFzT3duUHJvcGVydHkodGFyZ2V0UHJvcGVydHlOYW1lKSkge1xyXG5cdFx0XHRcdHByb3BlcnR5TG9hZGVyID0gcmVnLmJ5UHJvcFt0YXJnZXRQcm9wZXJ0eU5hbWVdO1xyXG5cdFx0XHRcdGlmIChwcm9wZXJ0eUxvYWRlciAhPT0gbnVsbCAmJiBwcm9wZXJ0eUxvYWRlciAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRsb2FkZXIgPSByZWcuYWxsUHJvcHM7XHJcblx0XHRpZiAobG9hZGVyICE9PSBudWxsICYmIGxvYWRlciAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdGlmICh0YXJnZXRMb2FkZXIpIHtcclxuXHRcdFx0XHRyZXR1cm4gbG9hZGVyID09PSB0YXJnZXRMb2FkZXI7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIGZhbHNlO1xyXG5cdH07XHJcblxyXG5cdExhenlMb2FkZXIuaXNMb2FkZWQgPSBmdW5jdGlvbiBMYXp5TG9hZGVyJGlzTG9hZGVkKG9iaiAvKiwgcGF0aHMuLi4qLykge1xyXG5cdFx0dmFyIHJlc3VsdCwgcGF0aHMsIHNpbmdsZVBhdGgsIHNpbmdsZVN0ZXAsIG5leHRTdGVwLCBwcm9wTmFtZSwgZmlsdGVyVHlwZSwgcHJvcGVydHksIHZhbHVlO1xyXG5cclxuXHRcdGlmIChvYmogPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRyZXN1bHQgPSB1bmRlZmluZWQ7XHJcblx0XHR9IGVsc2UgaWYgKG9iaiA9PT0gbnVsbCkge1xyXG5cdFx0XHRyZXN1bHQgPSBudWxsO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcclxuXHRcdFx0XHQvLyBObyBwYXRocyB3ZXJlIHNwZWNpZmllZC4uLlxyXG5cdFx0XHRcdHBhdGhzID0gbnVsbDtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHQvLyBQYXRocyB3ZXJlIHNwZWNpZmllZCBpbiBzb21lIGZvcm0uIFRoZXkgY2FuIGJlIHBhc3NlZCBpbiBhcyBhbiBhcnJheSBvZiAxIG9yXHJcblx0XHRcdFx0Ly8gbW9yZSBhcmd1bWVudHMsIG9yIHBhc3NlZCBpbiBzZXBlcmF0ZWx5IHRvIGJlIHByb2Nlc3NlZCBhcyBcInJlc3RcIiBhcmd1bWVudHMuXHJcblx0XHRcdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHtcclxuXHRcdFx0XHRcdGlmIChpc1R5cGUoYXJndW1lbnRzWzFdLCBBcnJheSkpIHtcclxuXHRcdFx0XHRcdFx0Ly8gMSkgaXNMb2FkZWQob2JqLCBbXCJhcmcxXCIsIFwiYXJnMlwiLCAuLi5dKTtcclxuXHRcdFx0XHRcdFx0cGF0aHMgPSBhcmd1bWVudHNbMV07XHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHQvLyAyKSBpc0xvYWRlZChvYmosIFwiYXJnXCIpO1xyXG5cdFx0XHRcdFx0XHRwYXRocyA9IFthcmd1bWVudHNbMV1dO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHQvLyAzKSBpc0xvYWRlZChvYmosIFwiYXJnMVwiLCBcImFyZzJcIiwgLi4uKTtcclxuXHRcdFx0XHRcdHBhdGhzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICghcGF0aHMgfHwgcGF0aHMubGVuZ3RoID09PSAwKSB7XHJcblx0XHRcdFx0Ly8gTm8gcGF0aHMsIHNvIHRoaXMgaXMgb25seSBhbiBvYmplY3QtbGV2ZWwgY2hlY2sgZm9yIHRoZSBleGlzdGVuY2Ugb2YgYSBsb2FkZXIuXHJcblx0XHRcdFx0cmVzdWx0ID0gIUxhenlMb2FkZXIuaXNSZWdpc3RlcmVkKG9iaik7XHJcblx0XHRcdH0gZWxzZSBpZiAocGF0aHMubGVuZ3RoID09PSAxKSB7XHJcblx0XHRcdFx0Ly8gT25seSBvbmUgcGF0aCwgc28gd2FsayBkb3duIHRoZSBwYXRoIHVudGlsIGEgbm9uLWxvYWRlZCBzdGVwIGlzIGRldGVjdGVkLlxyXG5cdFx0XHRcdHNpbmdsZVBhdGggPSBwYXRoc1swXTtcclxuXHJcblx0XHRcdFx0Ly8gUmVtb3ZlIHVubmVjZXNzYXJ5IFwidGhpcy5cIiBwcmVmaXguXHJcblx0XHRcdFx0aWYgKGlzVHlwZShzaW5nbGVQYXRoLCBTdHJpbmcpICYmIHNpbmdsZVBhdGguc3RhcnRzV2l0aChcInRoaXMuXCIpKSB7XHJcblx0XHRcdFx0XHRzaW5nbGVQYXRoID0gc2luZ2xlUGF0aC5zdWJzdHJpbmcoNSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBBdHRlbXB0IHRvIG9wdGltaXplIGZvciBhIHNpbmdsZSBwcm9wZXJ0eSBuYW1lIG9yIGZpbmFsIHBhdGggc3RlcC5cclxuXHRcdFx0XHRpZiAoaXNUeXBlKHNpbmdsZVBhdGgsIFN0cmluZykgJiYgc2luZ2xlUGF0aC5pbmRleE9mKFwiLlwiKSA8IDApIHtcclxuXHRcdFx0XHRcdGlmIChzaW5nbGVQYXRoLmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJVbmV4cGVjdGVkIGVtcHR5IHN0cmluZyBwYXNzZWQgdG8gTGF6eUxvYWRlci5pc0xvYWRlZCgpLlwiKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHByb3BOYW1lID0gc2luZ2xlUGF0aDtcclxuXHRcdFx0XHR9IGVsc2UgaWYgKGlzVHlwZShzaW5nbGVQYXRoLCBQYXRoVG9rZW5zKSkge1xyXG5cdFx0XHRcdFx0aWYgKHNpbmdsZVBhdGguc3RlcHMubGVuZ3RoID09PSAwKSB7XHJcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIlVuZXhwZWN0ZWQgZW1wdHkgcGF0aCB0b2tlbnMgcGFzc2VkIHRvIExhenlMb2FkZXIuaXNMb2FkZWQoKS5cIik7XHJcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHNpbmdsZVBhdGguc3RlcHMubGVuZ3RoID09PSAxKSB7XHJcblx0XHRcdFx0XHRcdHNpbmdsZVN0ZXAgPSBzaW5nbGVQYXRoLnN0ZXBzLmRlcXVldWUoKTtcclxuXHRcdFx0XHRcdFx0cHJvcE5hbWUgPSBzaW5nbGVTdGVwLnByb3BlcnR5O1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0aWYgKHByb3BOYW1lKSB7XHJcblx0XHRcdFx0XHQvLyBPcHRpbWl6ZSBmb3IgYSBzaW5nbGUgcHJvcGVydHkgbmFtZSBvciBwYXRoIHN0ZXAuXHJcblx0XHRcdFx0XHRpZiAoTGF6eUxvYWRlci5pc1JlZ2lzdGVyZWQob2JqLCBudWxsLCBwcm9wTmFtZSkpIHtcclxuXHRcdFx0XHRcdFx0cmVzdWx0ID0gZmFsc2U7XHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHQvLyBHZXQgdGhlIHZhbHVlIG9mIHRoZSBzaW5nbGUgcHJvcGVydHkgb3IgZmluYWwgcGF0aCBzdGVwLlxyXG5cdFx0XHRcdFx0XHRpZiAob2JqLm1ldGEpIHtcclxuXHRcdFx0XHRcdFx0XHRwcm9wZXJ0eSA9IG9iai5tZXRhLnByb3BlcnR5KHByb3BOYW1lLCB0cnVlKTtcclxuXHRcdFx0XHRcdFx0XHR2YWx1ZSA9IHByb3BlcnR5LnZhbHVlKG9iaik7XHJcblx0XHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSBnZXRWYWx1ZShvYmosIHByb3BOYW1lKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0aWYgKCF2YWx1ZSkge1xyXG5cdFx0XHRcdFx0XHRcdC8vIFRoZXJlIGlzIG5vIHZhbHVlLCBzbyB0aGVyZSBjYW4gYmUgbm8gbGF6eSBsb2FkZXIgcmVnaXN0ZXJlZC5cclxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHQvLyBJZiB0aGUgcHJvcGVydHkgdmFsdWUgZG9lc24ndCBoYXZlIGEgcmVnaXN0ZXJlZCBsYXp5IGxvYWRlciwgdGhlbiBpdCBpcyBjb25zaWRlcmVkIGxvYWRlZC5cclxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gIUxhenlMb2FkZXIuaXNSZWdpc3RlcmVkKHZhbHVlKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRpZiAoaXNUeXBlKHNpbmdsZVBhdGgsIFN0cmluZykpIHtcclxuXHRcdFx0XHRcdFx0aWYgKHNpbmdsZVBhdGgubGVuZ3RoID09PSAwKSB7XHJcblx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiVW5leHBlY3RlZCBlbXB0eSBzdHJpbmcgcGFzc2VkIHRvIExhenlMb2FkZXIuaXNMb2FkZWQoKS5cIik7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0c2luZ2xlUGF0aCA9IG5ldyBQYXRoVG9rZW5zKHNpbmdsZVBhdGgpO1xyXG5cdFx0XHRcdFx0fSBlbHNlIGlmICghaXNUeXBlKHNpbmdsZVBhdGgsIFBhdGhUb2tlbnMpKSB7XHJcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIlVua25vd24gcGF0aCBcXFwiXCIgKyBzaW5nbGVQYXRoICsgXCJcXFwiIG9mIHR5cGUgXCIgKyBwYXJzZUZ1bmN0aW9uTmFtZShzaW5nbGVQYXRoLmNvbnN0cnVjdG9yKSArIFwiLlwiKTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyBHZXQgdGhlIHZhbHVlIG9mIHRoZSBuZXh0IHN0ZXAuXHJcblx0XHRcdFx0XHRuZXh0U3RlcCA9IHNpbmdsZVBhdGguc3RlcHMuZGVxdWV1ZSgpO1xyXG5cdFx0XHRcdFx0aWYgKG9iai5tZXRhKSB7XHJcblx0XHRcdFx0XHRcdHByb3BlcnR5ID0gb2JqLm1ldGEucHJvcGVydHkobmV4dFN0ZXAucHJvcGVydHksIHRydWUpO1xyXG5cdFx0XHRcdFx0XHR2YWx1ZSA9IHByb3BlcnR5LnZhbHVlKG9iaik7XHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHR2YWx1ZSA9IGdldFZhbHVlKG9iaiwgbmV4dFN0ZXAucHJvcGVydHkpO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGlmICghdmFsdWUpIHtcclxuXHRcdFx0XHRcdFx0Ly8gVGhlcmUgaXMgbm8gdmFsdWUsIHNvIHRoZXJlIGNhbiBiZSBubyBsYXp5IGxvYWRlciByZWdpc3RlcmVkLlxyXG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHRcdH0gZWxzZSBpZiAoTGF6eUxvYWRlci5pc1JlZ2lzdGVyZWQodmFsdWUpKSB7XHJcblx0XHRcdFx0XHRcdC8vIFRoZXJlIGlzIGEgbGF6eSBsb2FkZXIsIHNvIHN0b3AgcHJvY2Vzc2luZyBhbmQgcmV0dXJuIGZhbHNlLlxyXG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHQvLyBUaGVyZSBpcyBubyBsYXp5IGxvYWRlciwgc28gY29udGludWUgcHJvY2Vzc2luZyB0aGUgbmV4dCBzdGVwLlxyXG5cdFx0XHRcdFx0XHRpZiAobmV4dFN0ZXAuY2FzdCkge1xyXG5cdFx0XHRcdFx0XHRcdGZpbHRlclR5cGUgPSBNb2RlbC5nZXRKc1R5cGUobmV4dFN0ZXAuY2FzdCwgdHJ1ZSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0aWYgKG5leHRTdGVwLmNhc3QgJiYgIWZpbHRlclR5cGUpIHtcclxuXHRcdFx0XHRcdFx0XHQvLyBTdG9wIHByb2Nlc3Npbmcgc2luY2UgdGhlIGZpbHRlciB0eXBlIGRvZXNuJ3QgeWV0IGV4aXN0LlxyXG5cdFx0XHRcdFx0XHRcdHJlc3VsdCA9IHRydWU7XHJcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoaXNBcnJheSh2YWx1ZSkpIHtcclxuXHRcdFx0XHRcdFx0XHQvLyBNYWtlIGEgY29weSBvZiB0aGUgb3JpZ2luYWwgcGF0aCB0b2tlbnMgZm9yIGFycmF5cyBzbyB0aGF0IGl0ZW1zJyBwcm9jZXNzaW5nIGRvbid0IGFmZmVjdCBvbmUgYW5vdGhlci5cclxuXHRcdFx0XHRcdFx0XHRpZiAoc2luZ2xlUGF0aCBpbnN0YW5jZW9mIFBhdGhUb2tlbnMpIHtcclxuXHRcdFx0XHRcdFx0XHRcdHNpbmdsZVBhdGggPSBzaW5nbGVQYXRoLmJ1aWxkRXhwcmVzc2lvbigpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRyZXN1bHQgPSAhdmFsdWUuc29tZShmdW5jdGlvbiAoaXRlbSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuICghZmlsdGVyVHlwZSB8fCBpdGVtIGluc3RhbmNlb2YgZmlsdGVyVHlwZSkgJiYgIUxhenlMb2FkZXIuaXNMb2FkZWQoaXRlbSwgc2luZ2xlUGF0aCk7XHJcblx0XHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoZmlsdGVyVHlwZSAmJiAhKHZhbHVlIGluc3RhbmNlb2YgZmlsdGVyVHlwZSkpIHtcclxuXHRcdFx0XHRcdFx0XHQvLyBTdG9wIHByb2Nlc3Npbmcgc2luY2UgdGhlIHZhbHVlIGRvZXNuJ3QgcGFzcyB0aGUgZmlsdGVyLlxyXG5cdFx0XHRcdFx0XHRcdHJlc3VsdCA9IHRydWU7XHJcblx0XHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0cmVzdWx0ID0gTGF6eUxvYWRlci5pc0xvYWRlZCh2YWx1ZSwgc2luZ2xlUGF0aCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0Ly8gTXVsdGlwbGUgcGF0aHMsIHNvIGNoZWNrIGVhY2ggb25lIGluZGl2aWR1YWxseS5cclxuXHRcdFx0XHRyZXN1bHQgPSAhcGF0aHMuc29tZShmdW5jdGlvbiAocGF0aCkge1xyXG5cdFx0XHRcdFx0Ly8gVXNlIHNvbWUgYW5kIHRoZSBpbnZlcnNlIG9mIHRoZSByZXN1bHQgaW4gb3JkZXIgdG8gZXhpdFxyXG5cdFx0XHRcdFx0Ly8gaW1tZWRpYXRlbHkgYXMgc29vbiBhcyBhIG5vbi1sb2FkZWQgc3RlcCBpcyBmb3VuZC5cclxuXHRcdFx0XHRcdHJldHVybiAhTGF6eUxvYWRlci5pc0xvYWRlZChvYmosIHBhdGgpO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHJlc3VsdDtcclxuXHR9O1xyXG5cclxuXHRMYXp5TG9hZGVyLmxvYWQgPSBmdW5jdGlvbiBMYXp5TG9hZGVyJGxvYWQob2JqLCBwcm9wTmFtZSwgaW5TY29wZSwgY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdHZhciByZWcgPSBvYmouX2xhenlMb2FkZXI7XHJcblx0XHRpZiAoIXJlZykge1xyXG5cdFx0XHRpZiAoY2FsbGJhY2sgJiYgY2FsbGJhY2sgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG5cdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHZhciBsb2FkZXI7XHJcblx0XHRcdGlmIChwcm9wTmFtZSAmJiByZWcuYnlQcm9wKSB7XHJcblx0XHRcdFx0bG9hZGVyID0gcmVnLmJ5UHJvcFtwcm9wTmFtZV07XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICghbG9hZGVyKSB7XHJcblx0XHRcdFx0bG9hZGVyID0gcmVnLmFsbFByb3BzO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoIWxvYWRlcikge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcigkZm9ybWF0KFwiQXR0ZW1wdGluZyB0byBsb2FkIG9iamVjdCBidXQgbm8gYXBwcm9wcmlhdGUgbG9hZGVyIGlzIHJlZ2lzdGVyZWQuIG9iamVjdDogezB9LCBwcm9wZXJ0eTogezF9XCIsIG9iaiwgcHJvcE5hbWUpKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0bG9hZGVyLmxvYWQob2JqLCBwcm9wTmFtZSwgaW5TY29wZSwgY2FsbGJhY2ssIHRoaXNQdHIpO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdExhenlMb2FkZXIucmVnaXN0ZXIgPSBmdW5jdGlvbiBMYXp5TG9hZGVyJHJlZ2lzdGVyKG9iaiwgbG9hZGVyLCBwcm9wTmFtZSkge1xyXG5cdFx0dmFyIHJlZyA9IG9iai5fbGF6eUxvYWRlcjtcclxuXHJcblx0XHRpZiAoIXJlZykge1xyXG5cdFx0XHRyZWcgPSBvYmouX2xhenlMb2FkZXIgPSB7fTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAocHJvcE5hbWUpIHtcclxuXHRcdFx0aWYgKCFyZWcuYnlQcm9wKSB7XHJcblx0XHRcdFx0cmVnLmJ5UHJvcCA9IHt9O1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZWcuYnlQcm9wW3Byb3BOYW1lXSA9IGxvYWRlcjtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRvYmouX2xhenlMb2FkZXIuYWxsUHJvcHMgPSBsb2FkZXI7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0TGF6eUxvYWRlci51bnJlZ2lzdGVyID0gZnVuY3Rpb24gTGF6eUxvYWRlciR1bnJlZ2lzdGVyKG9iaiwgbG9hZGVyLCBwcm9wTmFtZSkge1xyXG5cdFx0dmFyIHJlZyA9IG9iai5fbGF6eUxvYWRlcjtcclxuXHJcblx0XHRpZiAoIXJlZykge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHByb3BOYW1lKSB7XHJcblx0XHRcdGRlbGV0ZSByZWcuYnlQcm9wW3Byb3BOYW1lXTtcclxuXHRcdH0gZWxzZSBpZiAocmVnLmJ5UHJvcCkge1xyXG5cdFx0XHR2YXIgYWxsRGVsZXRlZCA9IHRydWU7XHJcblx0XHRcdGZvciAodmFyIHAgaW4gcmVnLmJ5UHJvcCkge1xyXG5cdFx0XHRcdGlmIChyZWcuYnlQcm9wW3BdID09PSBsb2FkZXIpIHtcclxuXHRcdFx0XHRcdGRlbGV0ZSByZWcuYnlQcm9wW3BdO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdGFsbERlbGV0ZWQgPSBmYWxzZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChhbGxEZWxldGVkKSB7XHJcblx0XHRcdFx0ZGVsZXRlIHJlZy5ieVByb3A7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRpZiAocmVnLmFsbFByb3BzID09PSBsb2FkZXIpIHtcclxuXHRcdFx0ZGVsZXRlIHJlZy5hbGxQcm9wcztcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoIXJlZy5ieVByb3AgJiYgIXJlZy5hbGxQcm9wcykge1xyXG5cdFx0XHRkZWxldGUgb2JqLl9sYXp5TG9hZGVyO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuTW9kZWwuVXRpbGl0aWVzXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0dmFyIGNvcmVHZXRWYWx1ZSA9IGdldFZhbHVlO1xyXG5cclxuXHQvLyBJZiBhIGdldHRlciBtZXRob2QgbWF0Y2hpbmcgdGhlIGdpdmVuIHByb3BlcnR5IG5hbWUgaXMgZm91bmQgb24gdGhlIHRhcmdldCBpdCBpcyBpbnZva2VkIGFuZCByZXR1cm5zIHRoZSBcclxuXHQvLyB2YWx1ZSwgdW5sZXNzIHRoZSB0aGUgdmFsdWUgaXMgdW5kZWZpbmVkLCBpbiB3aGljaCBjYXNlIG51bGwgaXMgcmV0dXJuZWQgaW5zdGVhZC4gIFRoaXMgaXMgZG9uZSBzbyB0aGF0IFxyXG5cdC8vIGNhbGxpbmcgY29kZSBjYW4gaW50ZXJwcmV0IGEgcmV0dXJuIHZhbHVlIG9mIHVuZGVmaW5lZCB0byBtZWFuIHRoYXQgdGhlIHByb3BlcnR5IGl0IHJlcXVlc3RlZCBkb2VzIG5vdCBleGlzdC5cclxuXHQvLyBUT0RPOiBiZXR0ZXIgbmFtZVxyXG5cdGdldFZhbHVlID0gZnVuY3Rpb24gZ2V0VmFsdWVPdmVycmlkZSh0YXJnZXQsIHByb3BlcnR5KSB7XHJcblxyXG5cdFx0Ly8gZmlyc3Qgc2VlIGlmIHRoZSBwcm9wZXJ0eSBpcyBhIG1vZGVsIHByb3BlcnR5XHJcblx0XHRpZiAodGFyZ2V0IGluc3RhbmNlb2YgRXhvV2ViLk1vZGVsLkVudGl0eSB8fCAodGFyZ2V0Lm1ldGEgJiYgdGFyZ2V0Lm1ldGEgaW5zdGFuY2VvZiBFeG9XZWIuTW9kZWwuVHlwZSkpIHtcclxuXHRcdFx0dmFyIHByb3AgPSB0YXJnZXQubWV0YS50eXBlLnByb3BlcnR5KHByb3BlcnR5KTtcclxuXHRcdFx0aWYgKHByb3ApIHtcclxuXHRcdFx0XHR2YXIgdmFsdWUgPSBwcm9wLnZhbHVlKHRhcmdldCk7XHJcblx0XHRcdFx0aWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRcdHZhbHVlID0gbnVsbDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0cmV0dXJuIHZhbHVlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIGNvcmVHZXRWYWx1ZSh0YXJnZXQsIHByb3BlcnR5KTtcclxuXHR9XHJcblxyXG5cdEV4b1dlYi5nZXRWYWx1ZSA9IGdldFZhbHVlO1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLk1hcHBlci5PYmplY3RQcm92aWRlclxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdC8qZ2xvYmFsIGV4cG9ydHMsIGNvbnRleHQsIEJhdGNoICovXHJcblxyXG5cdHZhciBvYmplY3RQcm92aWRlckZuID0gZnVuY3Rpb24gb2JqZWN0UHJvdmlkZXJGbigpIHtcclxuXHRcdHRocm93IG5ldyBFcnJvcihcIk9iamVjdCBwcm92aWRlciBoYXMgbm90IGJlZW4gaW1wbGVtZW50ZWQuIENhbGwgRXhvV2ViLk1hcHBlci5zZXRPYmplY3RQcm92aWRlcihmbik7XCIpO1xyXG5cdH07XHJcblxyXG5cdGZ1bmN0aW9uIG9iamVjdFByb3ZpZGVyKHR5cGUsIGlkcywgcGF0aHMsIGluU2NvcGUsIGNoYW5nZXMsIG9uU3VjY2Vzcywgb25GYWlsdXJlLCB0aGlzUHRyKSB7XHJcblx0XHR2YXIgc2NvcGVRdWVyaWVzLCBiYXRjaDtcclxuXHJcblx0XHQvLyBlbnN1cmUgY29ycmVjdCB2YWx1ZSBvZiBcInNjb3BlUXVlcmllc1wiIGFyZ3VtZW50XHJcblx0XHRpZiAob25TdWNjZXNzICE9PSB1bmRlZmluZWQgJiYgb25TdWNjZXNzICE9PSBudWxsICYmICEob25TdWNjZXNzIGluc3RhbmNlb2YgRnVuY3Rpb24pKSB7XHJcblx0XHRcdC8vIHNjb3BlUXVlcmllcyBpcyBpbmNsdWRlZCBpbiBjYWxsLCBzbyBzaGlmdCBhcmd1bWVudHNcclxuXHRcdFx0c2NvcGVRdWVyaWVzID0gb25TdWNjZXNzO1xyXG5cdFx0XHRvblN1Y2Nlc3MgPSBvbkZhaWx1cmU7XHJcblx0XHRcdG9uRmFpbHVyZSA9IHRoaXNQdHI7XHJcblx0XHRcdHRoaXNQdHIgPSBhcmd1bWVudHMubGVuZ3RoID4gOCA/IGFyZ3VtZW50c1s4XSA6IG51bGw7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0Ly8gc2NvcGVRdWVyaWVzIGlzIE5PVCBpbmNsdWRlZCBpbiBjYWxsLCBzbyBpbnNlcnQgZGVmYXVsdCB2YWx1ZSBpbnRvIGFyZ3MgYXJyYXlcclxuXHRcdFx0c2NvcGVRdWVyaWVzID0gY29udGV4dC5zZXJ2ZXIuX3Njb3BlUXVlcmllczsgLy9pZ25vcmUganNsaW50XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKG9uRmFpbHVyZSAhPT0gdW5kZWZpbmVkICYmIG9uRmFpbHVyZSAhPT0gbnVsbCAmJiAhKG9uRmFpbHVyZSBpbnN0YW5jZW9mIEZ1bmN0aW9uKSkge1xyXG5cdFx0XHR0aGlzUHRyID0gb25GYWlsdXJlO1xyXG5cdFx0XHRvbkZhaWx1cmUgPSBudWxsO1xyXG5cdFx0fVxyXG5cclxuXHRcdGJhdGNoID0gQmF0Y2guc3VzcGVuZEN1cnJlbnQoXCJvYmplY3RQcm92aWRlclwiKTtcclxuXHJcblx0XHRvYmplY3RQcm92aWRlckZuKHR5cGUsIGlkcywgcGF0aHMsIGluU2NvcGUsIGNoYW5nZXMsIHNjb3BlUXVlcmllcyxcclxuXHRcdFx0ZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdEJhdGNoLnJlc3VtZShiYXRjaCk7XHJcblx0XHRcdFx0aWYgKG9uU3VjY2Vzcykge1xyXG5cdFx0XHRcdFx0b25TdWNjZXNzLmFwcGx5KHRoaXNQdHIgfHwgbnVsbCwgYXJndW1lbnRzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0sXHJcblx0XHRcdGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRCYXRjaC5yZXN1bWUoYmF0Y2gpO1xyXG5cdFx0XHRcdGlmIChvbkZhaWx1cmUpIHtcclxuXHRcdFx0XHRcdG9uRmFpbHVyZS5hcHBseSh0aGlzUHRyIHx8IG51bGwsIGFyZ3VtZW50cyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHR9XHJcblxyXG5cdEV4b1dlYi5NYXBwZXIuc2V0T2JqZWN0UHJvdmlkZXIgPSBmdW5jdGlvbiBzZXRPYmplY3RQcm92aWRlcihmbikge1xyXG5cdFx0b2JqZWN0UHJvdmlkZXJGbiA9IGZuO1xyXG5cdH07XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuTWFwcGVyLlF1ZXJ5UHJvdmlkZXJcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHQvKmdsb2JhbCBleHBvcnRzLCBjb250ZXh0LCBCYXRjaCAqL1xyXG5cclxuXHR2YXIgcXVlcnlQcm92aWRlckZuID0gZnVuY3Rpb24gcXVlcnlQcm92aWRlckZuKCkge1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiUXVlcnkgcHJvdmlkZXIgaGFzIG5vdCBiZWVuIGltcGxlbWVudGVkLiBDYWxsIEV4b1dlYi5NYXBwZXIuc2V0UXVlcnlQcm92aWRlcihmbik7XCIpO1xyXG5cdH07XHJcblxyXG5cdGZ1bmN0aW9uIHF1ZXJ5UHJvdmlkZXIocXVlcmllcywgY2hhbmdlcywgb25TdWNjZXNzLCBvbkZhaWx1cmUsIHRoaXNQdHIpIHtcclxuXHRcdHZhciBzY29wZVF1ZXJpZXMsIGJhdGNoO1xyXG5cclxuXHRcdC8vIGVuc3VyZSBjb3JyZWN0IHZhbHVlIG9mIFwic2NvcGVRdWVyaWVzXCIgYXJndW1lbnRcclxuXHRcdGlmIChvblN1Y2Nlc3MgIT09IHVuZGVmaW5lZCAmJiBvblN1Y2Nlc3MgIT09IG51bGwgJiYgIShvblN1Y2Nlc3MgaW5zdGFuY2VvZiBGdW5jdGlvbikpIHtcclxuXHRcdFx0Ly8gc2NvcGVRdWVyaWVzIGlzIGluY2x1ZGVkIGluIGNhbGwsIHNvIHNoaWZ0IGFyZ3VtZW50c1xyXG5cdFx0XHRzY29wZVF1ZXJpZXMgPSBvblN1Y2Nlc3M7XHJcblx0XHRcdG9uU3VjY2VzcyA9IG9uRmFpbHVyZTtcclxuXHRcdFx0b25GYWlsdXJlID0gdGhpc1B0cjtcclxuXHRcdFx0dGhpc1B0ciA9IGFyZ3VtZW50cy5sZW5ndGggPiA1ID8gYXJndW1lbnRzWzVdIDogbnVsbDtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHQvLyBzY29wZVF1ZXJpZXMgaXMgTk9UIGluY2x1ZGVkIGluIGNhbGwsIHNvIGluc2VydCBkZWZhdWx0IHZhbHVlIGludG8gYXJncyBhcnJheVxyXG5cdFx0XHRzY29wZVF1ZXJpZXMgPSBjb250ZXh0LnNlcnZlci5fc2NvcGVRdWVyaWVzOyAvL2lnbm9yZSBqc2xpbnRcclxuXHRcdH1cclxuXHJcblx0XHRpZiAob25GYWlsdXJlICE9PSB1bmRlZmluZWQgJiYgb25GYWlsdXJlICE9PSBudWxsICYmICEob25GYWlsdXJlIGluc3RhbmNlb2YgRnVuY3Rpb24pKSB7XHJcblx0XHRcdHRoaXNQdHIgPSBvbkZhaWx1cmU7XHJcblx0XHRcdG9uRmFpbHVyZSA9IG51bGw7XHJcblx0XHR9XHJcblxyXG5cdFx0YmF0Y2ggPSBCYXRjaC5zdXNwZW5kQ3VycmVudChcInF1ZXJ5UHJvdmlkZXJcIik7XHJcblxyXG5cdFx0cXVlcnlQcm92aWRlckZuKHF1ZXJpZXMsIGNoYW5nZXMsIHNjb3BlUXVlcmllcyxcclxuXHRcdFx0ZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdEJhdGNoLnJlc3VtZShiYXRjaCk7XHJcblx0XHRcdFx0aWYgKG9uU3VjY2Vzcykge1xyXG5cdFx0XHRcdFx0b25TdWNjZXNzLmFwcGx5KHRoaXNQdHIgfHwgdGhpcywgYXJndW1lbnRzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0sXHJcblx0XHRcdGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRCYXRjaC5yZXN1bWUoYmF0Y2gpO1xyXG5cdFx0XHRcdGlmIChvbkZhaWx1cmUpIHtcclxuXHRcdFx0XHRcdG9uRmFpbHVyZS5hcHBseSh0aGlzUHRyIHx8IHRoaXMsIGFyZ3VtZW50cyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHR9XHJcblxyXG5cdEV4b1dlYi5NYXBwZXIuc2V0UXVlcnlQcm92aWRlciA9IGZ1bmN0aW9uIHNldFF1ZXJ5UHJvdmlkZXIoZm4pIHtcclxuXHRcdHF1ZXJ5UHJvdmlkZXJGbiA9IGZuO1xyXG5cdH07XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuTWFwcGVyLlR5cGVQcm92aWRlclxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdC8qZ2xvYmFsIGV4cG9ydHMsIEJhdGNoLCBjb3B5LCBwdXJnZSwgZWFjaFByb3AgKi9cclxuXHJcblx0dmFyIHR5cGVQcm92aWRlckZuID0gZnVuY3Rpb24gdHlwZVByb3ZpZGVyRm4oKSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJUeXBlIHByb3ZpZGVyIGhhcyBub3QgYmVlbiBpbXBsZW1lbnRlZC4gQ2FsbCBFeG9XZWIuTWFwcGVyLnNldFR5cGVQcm92aWRlcihmbik7XCIpO1xyXG5cdH07XHJcblxyXG5cdGZ1bmN0aW9uIHR5cGVQcm92aWRlckltcGwodHlwZXMsIGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHR2YXIgYmF0Y2ggPSBCYXRjaC5zdXNwZW5kQ3VycmVudChcInR5cGVQcm92aWRlclwiKSxcclxuXHRcdFx0dHlwZXNUb0xvYWQgPSBjb3B5KHR5cGVzKSxcclxuXHRcdFx0Y2FjaGVkVHlwZXMgPSBbXSxcclxuXHRcdFx0dHlwZXNKc29uID0ge307XHJcblxyXG5cdFx0cHVyZ2UodHlwZXNUb0xvYWQsIGZ1bmN0aW9uICh0eXBlKSB7XHJcblx0XHRcdHZhciBjYWNoZWRUeXBlID0gd2luZG93LkV4b1dlYi5jYWNoZSh0eXBlKTtcclxuXHJcblx0XHRcdGlmICghY2FjaGVkVHlwZSkge1xyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh3aW5kb3cuRXhvV2ViLmNhY2hlSGFzaCAmJiBjYWNoZWRUeXBlLmNhY2hlSGFzaCAhPT0gd2luZG93LkV4b1dlYi5jYWNoZUhhc2gpIHtcclxuXHRcdFx0XHQvLyB0aGUgY2FjaGVkIHR5cGUgZGVmaW5pdGlvbiBpcyBvdXQgb2YgZGF0ZSwgc28gcmVtb3ZlIGl0IGFuZCBjb250aW51ZVxyXG5cdFx0XHRcdHdpbmRvdy5FeG9XZWIuY2FjaGUodHlwZSwgbnVsbCk7XHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRjYWNoZWRUeXBlcy5wdXNoKHR5cGUpO1xyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH0pO1xyXG5cclxuXHRcdC8vIElmIHNvbWUgKG9yIGFsbCkgb2YgdGhlIHR5cGVzIGFyZSBjdXJyZW50bHkgY2FjaGVkLCBnbyBhaGVhZCBhbmQgY2FsbCB0aGUgc3VjY2VzcyBmdW5jdGlvbi5cclxuXHRcdGlmIChjYWNoZWRUeXBlcy5sZW5ndGggPiAwKSB7XHJcblx0XHRcdGNhY2hlZFR5cGVzLmZvckVhY2goZnVuY3Rpb24gKHR5cGUpIHtcclxuXHRcdFx0XHR0eXBlc0pzb25bdHlwZV0gPSB3aW5kb3cuRXhvV2ViLmNhY2hlKHR5cGUpLnR5cGVzW3R5cGVdO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAodHlwZXNUb0xvYWQubGVuZ3RoID4gMCkge1xyXG5cdFx0XHR0eXBlUHJvdmlkZXJGbih0eXBlc1RvTG9hZCxcclxuXHRcdFx0XHRmdW5jdGlvbiAocmVzdWx0KSB7XHJcblx0XHRcdFx0XHRCYXRjaC5yZXN1bWUoYmF0Y2gpO1xyXG5cclxuXHRcdFx0XHRcdHZhciByZXN1bHRzSnNvbiA9IHJlc3VsdC50eXBlcztcclxuXHJcblx0XHRcdFx0XHQvLyBBZGQgdGhlIHJlc3VsdGluZyBqc29uIGFuZCBjYWNoZSBlYWNoIHR5cGUuXHJcblx0XHRcdFx0XHRlYWNoUHJvcChyZXN1bHRzSnNvbiwgZnVuY3Rpb24gKHR5cGUpIHtcclxuXHJcblx0XHRcdFx0XHRcdC8vIGNvbnN0cnVjdCBhIGpzb24gb2JqZWN0LCB3aXRoIHRoZSBjYWNoZWhhc2gsIGZvciBjYWNoZWluZ1xyXG5cdFx0XHRcdFx0XHR2YXIganNvbiA9IHsgY2FjaGVIYXNoOiB3aW5kb3cuRXhvV2ViLmNhY2hlSGFzaCwgdHlwZXM6IHt9IH07XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBleHRyYWN0IHRoZSB0eXBlIGRlZmluaXRpb25cclxuXHRcdFx0XHRcdFx0anNvbi50eXBlc1t0eXBlXSA9IHR5cGVzSnNvblt0eXBlXSA9IHJlc3VsdHNKc29uW3R5cGVdO1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gY2FjaGUgdGhlIHR5cGVcclxuXHRcdFx0XHRcdFx0d2luZG93LkV4b1dlYi5jYWNoZSh0eXBlLCBqc29uKTtcclxuXHJcblx0XHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgbnVsbCwgdHJ1ZSwgdHlwZXNKc29uKTtcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdEJhdGNoLnJlc3VtZShiYXRjaCk7XHJcblxyXG5cdFx0XHRcdFx0dmFyIGFyZ3MgPSBjb3B5KGFyZ3VtZW50cyk7XHJcblx0XHRcdFx0XHRhcmdzLnNwbGljZSgwLCAwLCBmYWxzZSk7XHJcblx0XHRcdFx0XHRjYWxsYmFjay5hcHBseSh0aGlzUHRyIHx8IG51bGwsIGFyZ3MpO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdEJhdGNoLnJlc3VtZShiYXRjaCk7XHJcblx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCBudWxsLCB0cnVlLCB0eXBlc0pzb24pO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gZGVsZXRlVHlwZUpzb24ob3JpZ2luYWxBcmdzLCBpbnZvY2F0aW9uQXJncywgY2FsbGJhY2tBcmdzKSB7XHJcblx0XHQvLyBJZiB0eXBlIHJlcXVlc3Qgd2FzIGhhbmRsZWQgYnkgYW5vdGhlciBjYWxsZXIsIHRoZW4gYXNzdW1lIHRoYXQgdHlwZXNGcm9tSnNvbiB3aWxsIGJlIGNhbGxlZFxyXG5cdFx0aWYgKGNhbGxiYWNrQXJnc1swXSkge1xyXG5cdFx0XHRjYWxsYmFja0FyZ3Muc3BsaWNlKDEsIDEsIHt9LCBjYWxsYmFja0FyZ3NbMV0pO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0dmFyIHR5cGVQcm92aWRlciA9IHR5cGVQcm92aWRlckltcGwuZG9udERvdWJsZVVwKHsgY2FsbGJhY2tBcmc6IDEsIHBhcnRpdGlvbmVkQXJnOiAwLCBwYXJ0aXRpb25lZEZpbHRlcjogZGVsZXRlVHlwZUpzb24sIG1lbW9pemU6IHRydWUgfSk7XHJcblxyXG5cdEV4b1dlYi5NYXBwZXIuc2V0VHlwZVByb3ZpZGVyID0gZnVuY3Rpb24gc2V0VHlwZVByb3ZpZGVyKGZuKSB7XHJcblx0XHR0eXBlUHJvdmlkZXJGbiA9IGZuO1xyXG5cdH07XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuTWFwcGVyLkxpc3RQcm92aWRlclxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdC8qZ2xvYmFsIGV4cG9ydHMsIGNvbnRleHQsIEJhdGNoICovXHJcblxyXG5cdHZhciBsaXN0UHJvdmlkZXJGbiA9IGZ1bmN0aW9uIGxpc3RQcm92aWRlcigpIHtcclxuXHRcdHRocm93IG5ldyBFcnJvcihcIkxpc3QgcHJvdmlkZXIgaGFzIG5vdCBiZWVuIGltcGxlbWVudGVkLiBDYWxsIEV4b1dlYi5NYXBwZXIuc2V0TGlzdFByb3ZpZGVyKGZuKTtcIik7XHJcblx0fTtcclxuXHJcblx0ZnVuY3Rpb24gbGlzdFByb3ZpZGVyKG93bmVyVHlwZSwgb3duZXIsIGxpc3RQcm9wLCBwYXRocywgY2hhbmdlcywgb25TdWNjZXNzLCBvbkZhaWx1cmUsIHRoaXNQdHIpIHtcclxuXHRcdHZhciBzY29wZVF1ZXJpZXMsIGJhdGNoLCBsaXN0UGF0aCwgcGF0aHNUb0xvYWQsIG93bmVySWQ7XHJcblxyXG5cdFx0Ly8gZW5zdXJlIGNvcnJlY3QgdmFsdWUgb2YgXCJzY29wZVF1ZXJpZXNcIiBhcmd1bWVudFxyXG5cdFx0aWYgKG9uU3VjY2VzcyAhPT0gdW5kZWZpbmVkICYmIG9uU3VjY2VzcyAhPT0gbnVsbCAmJiAhKG9uU3VjY2VzcyBpbnN0YW5jZW9mIEZ1bmN0aW9uKSkge1xyXG5cdFx0XHQvLyBzY29wZVF1ZXJpZXMgaXMgaW5jbHVkZWQgaW4gY2FsbCwgc28gc2hpZnQgYXJndW1lbnRzXHJcblx0XHRcdHNjb3BlUXVlcmllcyA9IG9uU3VjY2VzcztcclxuXHRcdFx0b25TdWNjZXNzID0gb25GYWlsdXJlO1xyXG5cdFx0XHRvbkZhaWx1cmUgPSB0aGlzUHRyO1xyXG5cdFx0XHR0aGlzUHRyID0gYXJndW1lbnRzLmxlbmd0aCA+IDcgPyBhcmd1bWVudHNbN10gOiBudWxsO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdC8vIHNjb3BlUXVlcmllcyBpcyBOT1QgaW5jbHVkZWQgaW4gY2FsbCwgc28gaW5zZXJ0IGRlZmF1bHQgdmFsdWUgaW50byBhcmdzIGFycmF5XHJcblx0XHRcdHNjb3BlUXVlcmllcyA9IGNvbnRleHQuc2VydmVyLl9zY29wZVF1ZXJpZXM7IC8vaWdub3JlIGpzbGludFxyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChvbkZhaWx1cmUgIT09IHVuZGVmaW5lZCAmJiBvbkZhaWx1cmUgIT09IG51bGwgJiYgIShvbkZhaWx1cmUgaW5zdGFuY2VvZiBGdW5jdGlvbikpIHtcclxuXHRcdFx0dGhpc1B0ciA9IG9uRmFpbHVyZTtcclxuXHRcdFx0b25GYWlsdXJlID0gbnVsbDtcclxuXHRcdH1cclxuXHJcblx0XHRiYXRjaCA9IEJhdGNoLnN1c3BlbmRDdXJyZW50KFwibGlzdFByb3ZpZGVyXCIpO1xyXG5cclxuXHRcdG93bmVySWQgPSBvd25lciA9PT0gXCJzdGF0aWNcIiA/IG51bGwgOiBvd25lcjtcclxuXHRcdGxpc3RQYXRoID0gb3duZXIgPT09IFwic3RhdGljXCIgPyBvd25lclR5cGUgKyBcIi5cIiArIGxpc3RQcm9wIDogbGlzdFByb3A7XHJcblx0XHRwYXRoc1RvTG9hZCA9IFtsaXN0UGF0aF07XHJcblxyXG5cdFx0Ly8gcHJlcGVuZCBsaXN0IHByb3AgdG8gYmVnaW5uaW5nIG9mIGVhY2ggb3RoZXIgcHJvcFxyXG5cdFx0aWYgKHBhdGhzICYmIHBhdGhzLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0QXJyYXkuZm9yRWFjaChwYXRocywgZnVuY3Rpb24gKHApIHtcclxuXHRcdFx0XHRwYXRoc1RvTG9hZC5wdXNoKGxpc3RQYXRoICsgXCIuXCIgKyBwKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblxyXG5cdFx0bGlzdFByb3ZpZGVyRm4ob3duZXJUeXBlLCBvd25lcklkLCBwYXRoc1RvTG9hZCwgY2hhbmdlcywgc2NvcGVRdWVyaWVzLFxyXG5cdFx0XHRmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0QmF0Y2gucmVzdW1lKGJhdGNoKTtcclxuXHRcdFx0XHRpZiAob25TdWNjZXNzKSB7XHJcblx0XHRcdFx0XHRvblN1Y2Nlc3MuYXBwbHkodGhpc1B0ciB8fCBudWxsLCBhcmd1bWVudHMpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSxcclxuXHRcdFx0ZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdEJhdGNoLnJlc3VtZShiYXRjaCk7XHJcblx0XHRcdFx0aWYgKG9uRmFpbHVyZSkge1xyXG5cdFx0XHRcdFx0b25GYWlsdXJlLmFwcGx5KHRoaXNQdHIgfHwgbnVsbCwgYXJndW1lbnRzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdH1cclxuXHJcblx0RXhvV2ViLk1hcHBlci5zZXRMaXN0UHJvdmlkZXIgPSBmdW5jdGlvbiBzZXRMaXN0UHJvdmlkZXIoZm4pIHtcclxuXHRcdGxpc3RQcm92aWRlckZuID0gZm47XHJcblx0fTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5NYXBwZXIuUm91bmR0cmlwUHJvdmlkZXJcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHQvKmdsb2JhbCBleHBvcnRzLCBjb250ZXh0LCBCYXRjaCAqL1xyXG5cclxuXHR2YXIgcm91bmR0cmlwUHJvdmlkZXJGbiA9IGZ1bmN0aW9uIHJvdW5kdHJpcFByb3ZpZGVyRm4oKSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJSb3VuZHRyaXAgcHJvdmlkZXIgaGFzIG5vdCBiZWVuIGltcGxlbWVudGVkLiBDYWxsIEV4b1dlYi5NYXBwZXIuc2V0Um91bmR0cmlwUHJvdmlkZXIoZm4pO1wiKTtcclxuXHR9O1xyXG5cclxuXHRmdW5jdGlvbiByb3VuZHRyaXBQcm92aWRlcihyb290LCBwYXRocywgY2hhbmdlcywgb25TdWNjZXNzLCBvbkZhaWx1cmUsIHRoaXNQdHIpIHtcclxuXHRcdHZhciBzY29wZVF1ZXJpZXMsIGJhdGNoO1xyXG5cdFxyXG5cdFx0Ly8gZW5zdXJlIGNvcnJlY3QgdmFsdWUgb2YgXCJzY29wZVF1ZXJpZXNcIiBhcmd1bWVudFxyXG5cdFx0aWYgKG9uU3VjY2VzcyAhPT0gdW5kZWZpbmVkICYmIG9uU3VjY2VzcyAhPT0gbnVsbCAmJiAhKG9uU3VjY2VzcyBpbnN0YW5jZW9mIEZ1bmN0aW9uKSkge1xyXG5cdFx0XHQvLyBzY29wZVF1ZXJpZXMgaXMgaW5jbHVkZWQgaW4gY2FsbCwgc28gc2hpZnQgYXJndW1lbnRzXHJcblx0XHRcdHNjb3BlUXVlcmllcyA9IG9uU3VjY2VzcztcclxuXHRcdFx0b25TdWNjZXNzID0gb25GYWlsdXJlO1xyXG5cdFx0XHRvbkZhaWx1cmUgPSB0aGlzUHRyO1xyXG5cdFx0XHR0aGlzUHRyID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgPyBhcmd1bWVudHNbNF0gOiBudWxsO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdC8vIHNjb3BlUXVlcmllcyBpcyBOT1QgaW5jbHVkZWQgaW4gY2FsbCwgc28gaW5zZXJ0IGRlZmF1bHQgdmFsdWUgaW50byBhcmdzIGFycmF5XHJcblx0XHRcdHNjb3BlUXVlcmllcyA9IGNvbnRleHQuc2VydmVyLl9zY29wZVF1ZXJpZXM7IC8vaWdub3JlIGpzbGludFxyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChvbkZhaWx1cmUgIT09IHVuZGVmaW5lZCAmJiBvbkZhaWx1cmUgIT09IG51bGwgJiYgIShvbkZhaWx1cmUgaW5zdGFuY2VvZiBGdW5jdGlvbikpIHtcclxuXHRcdFx0dGhpc1B0ciA9IG9uRmFpbHVyZTtcclxuXHRcdFx0b25GYWlsdXJlID0gbnVsbDtcclxuXHRcdH1cclxuXHJcblx0XHRiYXRjaCA9IEJhdGNoLnN1c3BlbmRDdXJyZW50KFwicm91bmR0cmlwUHJvdmlkZXJcIik7XHJcblxyXG5cdFx0cm91bmR0cmlwUHJvdmlkZXJGbihyb290LCBwYXRocywgY2hhbmdlcywgc2NvcGVRdWVyaWVzLFxyXG5cdFx0XHRmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0QmF0Y2gucmVzdW1lKGJhdGNoKTtcclxuXHRcdFx0XHRpZiAob25TdWNjZXNzKSB7XHJcblx0XHRcdFx0XHRvblN1Y2Nlc3MuYXBwbHkodGhpc1B0ciB8fCB0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSxcclxuXHRcdFx0ZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdEJhdGNoLnJlc3VtZShiYXRjaCk7XHJcblx0XHRcdFx0aWYgKG9uRmFpbHVyZSkge1xyXG5cdFx0XHRcdFx0b25GYWlsdXJlLmFwcGx5KHRoaXNQdHIgfHwgdGhpcywgYXJndW1lbnRzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdH1cclxuXHJcblx0RXhvV2ViLk1hcHBlci5zZXRSb3VuZHRyaXBQcm92aWRlciA9IGZ1bmN0aW9uIHNldFJvdW5kdHJpcFByb3ZpZGVyKGZuKSB7XHJcblx0XHRyb3VuZHRyaXBQcm92aWRlckZuID0gZm47XHJcblx0fTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5NYXBwZXIuU2F2ZVByb3ZpZGVyXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0LypnbG9iYWwgZXhwb3J0cywgY29udGV4dCwgQmF0Y2ggKi9cclxuXHJcblx0dmFyIHNhdmVQcm92aWRlckZuID0gZnVuY3Rpb24gc2F2ZVByb3ZpZGVyRm4oKSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJTYXZlIHByb3ZpZGVyIGhhcyBub3QgYmVlbiBpbXBsZW1lbnRlZC4gQ2FsbCBFeG9XZWIuTWFwcGVyLnNldFNhdmVQcm92aWRlcihmbik7XCIpO1xyXG5cdH07XHJcblxyXG5cdGZ1bmN0aW9uIHNhdmVQcm92aWRlcihyb290LCBjaGFuZ2VzLCBvblN1Y2Nlc3MsIG9uRmFpbHVyZSwgdGhpc1B0cikge1xyXG5cdFx0dmFyIHNjb3BlUXVlcmllcywgYmF0Y2g7XHJcblxyXG5cdFx0Ly8gZW5zdXJlIGNvcnJlY3QgdmFsdWUgb2YgXCJzY29wZVF1ZXJpZXNcIiBhcmd1bWVudFxyXG5cdFx0aWYgKG9uU3VjY2VzcyAhPT0gdW5kZWZpbmVkICYmIG9uU3VjY2VzcyAhPT0gbnVsbCAmJiAhKG9uU3VjY2VzcyBpbnN0YW5jZW9mIEZ1bmN0aW9uKSkge1xyXG5cdFx0XHQvLyBzY29wZVF1ZXJpZXMgaXMgaW5jbHVkZWQgaW4gY2FsbCwgc28gc2hpZnQgYXJndW1lbnRzXHJcblx0XHRcdHNjb3BlUXVlcmllcyA9IG9uU3VjY2VzcztcclxuXHRcdFx0b25TdWNjZXNzID0gb25GYWlsdXJlO1xyXG5cdFx0XHRvbkZhaWx1cmUgPSB0aGlzUHRyO1xyXG5cdFx0XHR0aGlzUHRyID0gYXJndW1lbnRzLmxlbmd0aCA+IDUgPyBhcmd1bWVudHNbNV0gOiBudWxsO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdC8vIHNjb3BlUXVlcmllcyBpcyBOT1QgaW5jbHVkZWQgaW4gY2FsbCwgc28gaW5zZXJ0IGRlZmF1bHQgdmFsdWUgaW50byBhcmdzIGFycmF5XHJcblx0XHRcdHNjb3BlUXVlcmllcyA9IGNvbnRleHQuc2VydmVyLl9zY29wZVF1ZXJpZXM7IC8vaWdub3JlIGpzbGludFxyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChvbkZhaWx1cmUgIT09IHVuZGVmaW5lZCAmJiBvbkZhaWx1cmUgIT09IG51bGwgJiYgIShvbkZhaWx1cmUgaW5zdGFuY2VvZiBGdW5jdGlvbikpIHtcclxuXHRcdFx0dGhpc1B0ciA9IG9uRmFpbHVyZTtcclxuXHRcdFx0b25GYWlsdXJlID0gbnVsbDtcclxuXHRcdH1cclxuXHJcblx0XHRiYXRjaCA9IEJhdGNoLnN1c3BlbmRDdXJyZW50KFwic2F2ZVByb3ZpZGVyXCIpO1xyXG5cdFx0c2F2ZVByb3ZpZGVyRm4ocm9vdCwgY2hhbmdlcywgc2NvcGVRdWVyaWVzLFxyXG5cdFx0XHRmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0QmF0Y2gucmVzdW1lKGJhdGNoKTtcclxuXHRcdFx0XHRpZiAob25TdWNjZXNzKSB7XHJcblx0XHRcdFx0XHRvblN1Y2Nlc3MuYXBwbHkodGhpc1B0ciB8fCB0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSxcclxuXHRcdFx0ZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdEJhdGNoLnJlc3VtZShiYXRjaCk7XHJcblx0XHRcdFx0aWYgKG9uRmFpbHVyZSkge1xyXG5cdFx0XHRcdFx0b25GYWlsdXJlLmFwcGx5KHRoaXNQdHIgfHwgdGhpcywgYXJndW1lbnRzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdH1cclxuXHJcblx0RXhvV2ViLk1hcHBlci5zZXRTYXZlUHJvdmlkZXIgPSBmdW5jdGlvbiBzZXRTYXZlUHJvdmlkZXIoZm4pIHtcclxuXHRcdHNhdmVQcm92aWRlckZuID0gZm47XHJcblx0fTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5NYXBwZXIuRXZlbnRQcm92aWRlclxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdC8qZ2xvYmFsIGV4cG9ydHMsIGNvbnRleHQsIEJhdGNoICovXHJcblxyXG5cdHZhciBldmVudFByb3ZpZGVyRm4gPSBmdW5jdGlvbiBldmVudFByb3ZpZGVyRm4oKSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJFdmVudCBwcm92aWRlciBoYXMgbm90IGJlZW4gaW1wbGVtZW50ZWQuIENhbGwgRXhvV2ViLk1hcHBlci5zZXRFdmVudFByb3ZpZGVyKGZuKTtcIik7XHJcblx0fTtcclxuXHJcblx0ZnVuY3Rpb24gZXZlbnRQcm92aWRlcihldmVudFR5cGUsIGV2ZW50SW5zdGFuY2UsIGV2ZW50LCBwYXRocywgY2hhbmdlcywgb25TdWNjZXNzLCBvbkZhaWx1cmUsIHRoaXNQdHIpIHtcclxuXHRcdHZhciBzY29wZVF1ZXJpZXMsIGJhdGNoO1xyXG5cclxuXHRcdC8vIGVuc3VyZSBjb3JyZWN0IHZhbHVlIG9mIFwic2NvcGVRdWVyaWVzXCIgYXJndW1lbnRcclxuXHRcdGlmIChvblN1Y2Nlc3MgIT09IHVuZGVmaW5lZCAmJiBvblN1Y2Nlc3MgIT09IG51bGwgJiYgIShvblN1Y2Nlc3MgaW5zdGFuY2VvZiBGdW5jdGlvbikpIHtcclxuXHRcdFx0Ly8gc2NvcGVRdWVyaWVzIGlzIGluY2x1ZGVkIGluIGNhbGwsIHNvIHNoaWZ0IGFyZ3VtZW50c1xyXG5cdFx0XHRzY29wZVF1ZXJpZXMgPSBvblN1Y2Nlc3M7XHJcblx0XHRcdG9uU3VjY2VzcyA9IG9uRmFpbHVyZTtcclxuXHRcdFx0b25GYWlsdXJlID0gdGhpc1B0cjtcclxuXHRcdFx0dGhpc1B0ciA9IGFyZ3VtZW50cy5sZW5ndGggPiA4ID8gYXJndW1lbnRzWzhdIDogbnVsbDtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHQvLyBzY29wZVF1ZXJpZXMgaXMgTk9UIGluY2x1ZGVkIGluIGNhbGwsIHNvIGluc2VydCBkZWZhdWx0IHZhbHVlIGludG8gYXJncyBhcnJheVxyXG5cdFx0XHRzY29wZVF1ZXJpZXMgPSBjb250ZXh0LnNlcnZlci5fc2NvcGVRdWVyaWVzOyAvL2lnbm9yZSBqc2xpbnRcclxuXHRcdH1cclxuXHJcblx0XHRpZiAob25GYWlsdXJlICE9PSB1bmRlZmluZWQgJiYgb25GYWlsdXJlICE9PSBudWxsICYmICEob25GYWlsdXJlIGluc3RhbmNlb2YgRnVuY3Rpb24pKSB7XHJcblx0XHRcdHRoaXNQdHIgPSBvbkZhaWx1cmU7XHJcblx0XHRcdG9uRmFpbHVyZSA9IG51bGw7XHJcblx0XHR9XHJcblxyXG5cdFx0YmF0Y2ggPSBCYXRjaC5zdXNwZW5kQ3VycmVudChcImV2ZW50UHJvdmlkZXJcIik7XHJcblx0XHRldmVudFByb3ZpZGVyRm4oZXZlbnRUeXBlLCBldmVudEluc3RhbmNlLCBldmVudCwgcGF0aHMsIGNoYW5nZXMsIHNjb3BlUXVlcmllcyxcclxuXHRcdFx0ZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdEJhdGNoLnJlc3VtZShiYXRjaCk7XHJcblx0XHRcdFx0aWYgKG9uU3VjY2Vzcykge1xyXG5cdFx0XHRcdFx0b25TdWNjZXNzLmFwcGx5KHRoaXNQdHIgfHwgbnVsbCwgYXJndW1lbnRzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0sXHJcblx0XHRcdGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRCYXRjaC5yZXN1bWUoYmF0Y2gpO1xyXG5cdFx0XHRcdGlmIChvbkZhaWx1cmUpIHtcclxuXHRcdFx0XHRcdG9uRmFpbHVyZS5hcHBseSh0aGlzUHRyIHx8IG51bGwsIGFyZ3VtZW50cyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHR9XHJcblxyXG5cdEV4b1dlYi5NYXBwZXIuc2V0RXZlbnRQcm92aWRlciA9IGZ1bmN0aW9uIHNldEV2ZW50UHJvdmlkZXIoZm4pIHtcclxuXHRcdGV2ZW50UHJvdmlkZXJGbiA9IGZuO1xyXG5cdH07XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuTWFwcGVyLlJlc3BvbnNlSGFuZGxlclxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIFJlc3BvbnNlSGFuZGxlcihtb2RlbCwgc2VydmVyU3luYywgb3B0aW9ucykge1xyXG5cdFx0aWYgKG9wdGlvbnMgPT09IHVuZGVmaW5lZCB8fCBvcHRpb25zID09PSBudWxsKSB7XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIk9wdGlvbnMgY2Fubm90IGJlIG51bGwgb3IgdW5kZWZpbmVkLlwiKTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLl9tb2RlbCA9IG1vZGVsO1xyXG5cdFx0dGhpcy5fc2VydmVyU3luYyA9IHNlcnZlclN5bmM7XHJcblx0XHR0aGlzLl9vcHRpb25zID0gb3B0aW9ucztcclxuXHR9XHJcblxyXG5cdFJlc3BvbnNlSGFuZGxlci5taXhpbih7XHJcblx0XHRleGVjdXRlOiBFeG9XZWIuRnVuY3Rpb25DaGFpbi5wcmVwYXJlKFxyXG5cdFx0XHRmdW5jdGlvbiBSZXNwb25zZUhhbmRsZXIkc3RhcnRSZXNwb25zZUJhdGNoKGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRcdFx0Ly8vIDxzdW1tYXJ5PlxyXG5cdFx0XHRcdC8vLyBTdGFydCBhIG5ldyByZXNwb25zZSBiYXRjaC5cclxuXHRcdFx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cclxuXHRcdFx0XHR0aGlzLl9iYXRjaCA9IEJhdGNoLnN0YXJ0KFwiUmVzcG9uc2VIYW5kbGVyXCIpO1xyXG5cdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzKTtcclxuXHRcdFx0fSxcclxuXHRcdFx0ZnVuY3Rpb24gUmVzcG9uc2VIYW5kbGVyJHNldFNlcnZlckluZm8oY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdFx0XHQvLy8gPHN1bW1hcnk+XHJcblx0XHRcdFx0Ly8vIFNldCBzZXJ2ZXIgaW5mbyBmcm9tIEpTT05cclxuXHRcdFx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cclxuXHRcdFx0XHRpZiAodGhpcy5fb3B0aW9ucy5zZXJ2ZXJJbmZvKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9zZXJ2ZXJTeW5jLnNldF9TZXJ2ZXJJbmZvKHRoaXMuX29wdGlvbnMuc2VydmVySW5mbyk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcyk7XHJcblx0XHRcdH0sXHJcblxyXG5cdFx0XHRmdW5jdGlvbiBSZXNwb25zZUhhbmRsZXIkbG9hZFR5cGVzKGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRcdFx0Ly8vIDxzdW1tYXJ5PlxyXG5cdFx0XHRcdC8vLyBMb2FkIHR5cGVzIGZyb20gSlNPTlxyXG5cdFx0XHRcdC8vLyA8L3N1bW1hcnk+XHJcblx0XHRcdFx0aWYgKHRoaXMuX29wdGlvbnMudHlwZXMpIHtcclxuXHRcdFx0XHRcdGZvciAodmFyIHR5cGVOYW1lIGluIHRoaXMuX29wdGlvbnMudHlwZXMpIHtcclxuXHRcdFx0XHRcdFx0dmFyIG10eXBlID0gdGhpcy5fbW9kZWwudHlwZSh0eXBlTmFtZSk7XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBJZiB0aGlzIHR5cGUgaGFzIG5vdCBhbHJlYWR5IGJlZW4gbG9hZGVkLCBsYW9kIGZyb20gSlNPTlxyXG5cdFx0XHRcdFx0XHRpZiAoIW10eXBlIHx8IExhenlMb2FkZXIuaXNSZWdpc3RlcmVkKG10eXBlKSkge1xyXG5cdFx0XHRcdFx0XHRcdHZhciB0eXBlc1RvVXNlID0ge307XHJcblx0XHRcdFx0XHRcdFx0dHlwZXNUb1VzZVt0eXBlTmFtZV0gPSB0aGlzLl9vcHRpb25zLnR5cGVzW3R5cGVOYW1lXTtcclxuXHRcdFx0XHRcdFx0XHR0eXBlc0Zyb21Kc29uKHRoaXMuX21vZGVsLCB0eXBlc1RvVXNlKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0bXR5cGUgPSB0aGlzLl9tb2RlbC50eXBlKHR5cGVOYW1lKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0Ly8gUmVtb3ZlIGxhenktbG9hZGVyXHJcblx0XHRcdFx0XHRcdFx0VHlwZUxhenlMb2FkZXIudW5yZWdpc3RlcihtdHlwZSk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdC8vIFJhaXNlICRleHRlbmRzIGhhbmRsZXJzIGZvciB0aGUgdHlwZVxyXG5cdFx0XHRcdFx0XHRcdHJhaXNlRXh0ZW5zaW9ucyhtdHlwZSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzKTtcclxuXHRcdFx0fSxcclxuXHJcblx0XHRcdGZ1bmN0aW9uIFJlc3BvbnNlSGFuZGxlciRzdGFydFF1ZXVlaW5nRXZlbnRzKGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRcdFx0Ly8vIDxzdW1tYXJ5PlxyXG5cdFx0XHRcdC8vLyBTdGFydCBxdWV1ZWluZyBtb2RlbCBldmVudHNcclxuXHRcdFx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cclxuXHRcdFx0XHR0aGlzLl9ldmVudFNjb3BlID0gbmV3IEV2ZW50U2NvcGUoKTtcclxuXHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcyk7XHJcblx0XHRcdH0sXHJcblxyXG5cdFx0XHRmdW5jdGlvbiBSZXNwb25zZUhhbmRsZXIkYXBwbHlDaGFuZ2VzKGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRcdFx0Ly8vIDxzdW1tYXJ5PlxyXG5cdFx0XHRcdC8vLyBBcHBseSBjaGFuZ2VzIGZyb20gSlNPTlxyXG5cdFx0XHRcdC8vLyA8L3N1bW1hcnk+XHJcblxyXG5cdFx0XHRcdGlmICh0aGlzLl9vcHRpb25zLmNoYW5nZXMpIHtcclxuXHRcdFx0XHRcdGlmICh0aGlzLl9vcHRpb25zLmNoYW5nZXMpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5fc2VydmVyU3luYy5hcHBseUNoYW5nZXModGhpcy5fb3B0aW9ucy5jaGVja3BvaW50LCB0aGlzLl9vcHRpb25zLmNoYW5nZXMsIHRoaXMuX29wdGlvbnMuc291cmNlLCBudWxsLCB0aGlzLl9vcHRpb25zLmNoZWNrcG9pbnQsIHRoaXMuX29wdGlvbnMuZGVzY3JpcHRpb24gPyB0aGlzLl9vcHRpb25zLmRlc2NyaXB0aW9uICsgXCI6cmVzcG9uc2VcIiA6IG51bGwsIG51bGwsIHRoaXMuX29wdGlvbnMuYmVmb3JlQXBwbHksIHRoaXMuX29wdGlvbnMuYWZ0ZXJBcHBseSwgY2FsbGJhY2ssIHRoaXNQdHIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdGlmICh0aGlzLl9vcHRpb25zLnNvdXJjZSkge1xyXG5cdFx0XHRcdFx0XHRcdC8vIG5vIGNoYW5nZXMsIHNvIHJlY29yZCBlbXB0eSBzZXRcclxuXHRcdFx0XHRcdFx0XHR0aGlzLl9zZXJ2ZXJTeW5jLl9jaGFuZ2VMb2cuYWRkU2V0KHRoaXMuX29wdGlvbnMuc291cmNlLCB0aGlzLl9vcHRpb25zLmRlc2NyaXB0aW9uICsgXCI6cmVzcG9uc2VcIik7XHJcblx0XHRcdFx0XHRcdFx0dGhpcy5fc2VydmVyU3luYy5fY2hhbmdlTG9nLnN0YXJ0KHsgdXNlcjogdGhpcy5fc2VydmVyU3luYy5nZXRfbG9jYWxVc2VyKCkgfSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0sXHJcblxyXG5cdFx0XHRmdW5jdGlvbiBSZXNwb25zZUhhbmRsZXIkbG9hZEluc3RhbmNlcyhjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0XHRcdC8vLyA8c3VtbWFyeT5cclxuXHRcdFx0XHQvLy8gTG9hZCBpbnN0YW5jZSBkYXRhIGZyb20gSlNPTlxyXG5cdFx0XHRcdC8vLyA8L3N1bW1hcnk+XHJcblxyXG5cdFx0XHRcdGlmICh0aGlzLl9vcHRpb25zLmluc3RhbmNlcykge1xyXG5cdFx0XHRcdFx0b2JqZWN0c0Zyb21Kc29uKHRoaXMuX21vZGVsLCB0aGlzLl9vcHRpb25zLmluc3RhbmNlcywgZnVuY3Rpb24gKGluc3RhbmNlc1BlbmRpbmdJbml0KSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuaW5zdGFuY2VzUGVuZGluZ0luaXQgPSBpbnN0YW5jZXNQZW5kaW5nSW5pdDtcclxuXHRcdFx0XHRcdFx0Y2FsbGJhY2suYXBwbHkodGhpc1B0ciB8fCB0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0XHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSxcclxuXHJcblx0XHRcdGZ1bmN0aW9uIFJlc3BvbnNlSGFuZGxlciRyZWdpc3RlclJ1bGVzKGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRcdFx0Ly8vIDxzdW1tYXJ5PlxyXG5cdFx0XHRcdC8vLyBSZWdpc3RlciBhbGwgcnVsZXMgcGVuZGluZyByZWdpc3RyYXRpb24gd2l0aCB0aGUgbW9kZWxcclxuXHRcdFx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cclxuXHRcdFx0XHR0aGlzLl9tb2RlbC5yZWdpc3RlclJ1bGVzKCk7XHJcblx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdFx0XHR9LFxyXG5cclxuXHRcdFx0ZnVuY3Rpb24gUmVzcG9uc2VIYW5kbGVyJHN0b3BRdWV1ZWluZ0V2ZW50cyhjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0XHRcdC8vLyA8c3VtbWFyeT5cclxuXHRcdFx0XHQvLy8gU3RvcCBxdWV1ZWluZyBtb2RlbCBldmVudHNcclxuXHRcdFx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cclxuXHRcdFx0XHR0aGlzLl9zZXJ2ZXJTeW5jLmJhdGNoQ2hhbmdlcyh0aGlzLl9vcHRpb25zLmRlc2NyaXB0aW9uICsgXCI6cmVzdWx0XCIsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdHRoaXMuX2V2ZW50U2NvcGUuZXhpdCgpO1xyXG5cdFx0XHRcdH0sIHRoaXMpO1xyXG5cclxuXHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcyk7XHJcblx0XHRcdH0sXHJcblxyXG5cdFx0XHRmdW5jdGlvbiBSZXNwb25zZUhhbmRsZXIkaW5pdEluc3RhbmNlcyhjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0XHRcdC8vLyA8c3VtbWFyeT5cclxuXHRcdFx0XHQvLy8gSW5pdGlhbGl6ZSBhbGwgaW5zdGFuY2VzIGxvYWRlZCBieSB0aGUgcmVzcG9uc2VcclxuXHRcdFx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cclxuXHRcdFx0XHQvLyBSYWlzZSBpbml0IGV2ZW50cyBmb3IgZXhpc3RpbmcgaW5zdGFuY2VzIGxvYWRlZCBieSB0aGUgcmVzcG9uc2VcclxuXHRcdFx0XHRpZiAodGhpcy5pbnN0YW5jZXNQZW5kaW5nSW5pdCkge1xyXG5cdFx0XHRcdFx0dmFyIGluc3RhbmNlcyA9IHRoaXMuaW5zdGFuY2VzUGVuZGluZ0luaXQ7XHJcblx0XHRcdFx0XHRjb250ZXh0LnNlcnZlci5fY2hhbmdlTG9nLmJhdGNoQ2hhbmdlcyh0aGlzLl9vcHRpb25zLmRlc2NyaXB0aW9uID8gdGhpcy5fb3B0aW9ucy5kZXNjcmlwdGlvbiArIFwiOmluaXRFeGlzdGluZ1wiIDogXCJyZXNwb25zZUhhbmRsZXJJbml0RXhpc3RpbmdcIiwgY29udGV4dC5zZXJ2ZXIuX2xvY2FsVXNlciwgZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0XHRpbnN0YW5jZXMuZm9yRWFjaChmdW5jdGlvbiAob2JqKSB7XHJcblx0XHRcdFx0XHRcdFx0Zm9yICh2YXIgdCA9IG9iai5tZXRhLnR5cGU7IHQ7IHQgPSB0LmJhc2VUeXBlKSB7XHJcblx0XHRcdFx0XHRcdFx0XHR2YXIgaGFuZGxlciA9IHQuX2dldEV2ZW50SGFuZGxlcihcImluaXRFeGlzdGluZ1wiKTtcclxuXHRcdFx0XHRcdFx0XHRcdGlmIChoYW5kbGVyKVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRoYW5kbGVyKG9iaiwge30pO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHR9LCB0cnVlKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzKTtcclxuXHRcdFx0fSxcclxuXHJcblx0XHRcdGZ1bmN0aW9uIFJlc3BvbnNlSGFuZGxlciRsb2FkQ29uZGl0aW9ucyhjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0XHRcdC8vLyA8c3VtbWFyeT5cclxuXHRcdFx0XHQvLy8gTG9hZCBjb25kaXRpb25zIGZyb20gSlNPTlxyXG5cdFx0XHRcdC8vLyA8L3N1bW1hcnk+XHJcblxyXG5cdFx0XHRcdGlmICh0aGlzLl9vcHRpb25zLmNvbmRpdGlvbnMpIHtcclxuXHRcdFx0XHRcdGNvbmRpdGlvbnNGcm9tSnNvbih0aGlzLl9tb2RlbCwgdGhpcy5fb3B0aW9ucy5jb25kaXRpb25zLCB0aGlzLmluc3RhbmNlc1BlbmRpbmdJbml0LCBjYWxsYmFjaywgdGhpc1B0cik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSxcclxuXHJcblx0XHRcdGZ1bmN0aW9uIFJlc3BvbnNlSGFuZGxlciRlbmRSZXNwb25zZUJhdGNoKGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRcdFx0Ly8vIDxzdW1tYXJ5PlxyXG5cdFx0XHRcdC8vLyBFbmQgdGhlIHJlc3BvbnNlIGJhdGNoLlxyXG5cdFx0XHRcdC8vLyA8L3N1bW1hcnk+XHJcblxyXG5cdFx0XHRcdEJhdGNoLmVuZCh0aGlzLl9iYXRjaCk7XHJcblx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdFx0XHR9XHJcblx0XHQpXHJcblx0fSk7XHJcblxyXG5cdFJlc3BvbnNlSGFuZGxlci5leGVjdXRlID0gZnVuY3Rpb24gKG1vZGVsLCBzZXJ2ZXJTeW5jLCBvcHRpb25zLCBjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0KG5ldyBSZXNwb25zZUhhbmRsZXIobW9kZWwsIHNlcnZlclN5bmMsIG9wdGlvbnMpKS5leGVjdXRlKGNhbGxiYWNrLCB0aGlzUHRyKTtcclxuXHR9O1xyXG5cclxuXHRFeG9XZWIuTWFwcGVyLlJlc3BvbnNlSGFuZGxlciA9IFJlc3BvbnNlSGFuZGxlcjtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5NYXBwZXIuVHJhbnNsYXRpb25cclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHQvLyBHZXRzIG9yIGxvYWRzIHRoZSBlbnRpdHkgd2l0aCB0aGUgc3BlY2lmaWVkIHR5cGVkIHN0cmluZyBpZFxyXG5cdEVudGl0eS5mcm9tSWRTdHJpbmcgPSBmdW5jdGlvbiBFbnRpdHkkZnJvbUlkU3RyaW5nKGlkU3RyaW5nKSB7XHJcblx0XHQvLyBUeXBlZCBpZGVudGlmaWVycyB0YWtlIHRoZSBmb3JtIFwidHlwZXxpZFwiLlxyXG5cdCAgICB2YXIgdHlwZSA9IGlkU3RyaW5nLnN1YnN0cmluZygwLCBpZFN0cmluZy5pbmRleE9mKFwifFwiKSk7XHJcblx0ICAgIHZhciBpZCA9IGlkU3RyaW5nLnN1YnN0cmluZyh0eXBlLmxlbmd0aCArIDEpO1xyXG5cclxuXHRcdC8vIFVzZSB0aGUgbGVmdC1oYW5kIHBvcnRpb24gb2YgdGhlIGlkIHN0cmluZyBhcyB0aGUgb2JqZWN0J3MgdHlwZS5cclxuXHRcdHZhciBqc3R5cGUgPSBFeG9XZWIuTW9kZWwuTW9kZWwuZ2V0SnNUeXBlKHR5cGUpO1xyXG5cclxuXHRcdC8vIEF0dGVtcHQgdG8gcmV0cmlldmUgdGhlIG9iamVjdCB3aXRoIHRoZSBnaXZlbiBpZC5cclxuXHRcdHZhciBvYmogPSBqc3R5cGUubWV0YS5nZXQoXHJcblx0XHRcdC8vIFVzZSB0aGUgcmlnaHQtaGFuZCBwb3J0aW9uIG9mIHRoZSBpZCBzdHJpbmcgYXMgdGhlIG9iamVjdCdzIGlkLlxyXG5cdFx0XHRpZCxcclxuXHJcblx0XHRcdC8vIFR5cGVkIGlkZW50aWZpZXJzIG1heSBvciBtYXkgbm90IGJlIHRoZSBleGFjdCB0eXBlIG9mIHRoZSBpbnN0YW5jZS5cclxuXHRcdFx0Ly8gQW4gaWQgc3RyaW5nIG1heSBiZSBjb25zdHJ1Y3RlZCB3aXRoIG9ubHkga25vd2xlZGdlIG9mIHRoZSBiYXNlIHR5cGUuXHJcblx0XHRcdGZhbHNlXHJcblx0XHQpO1xyXG5cclxuXHRcdC8vIElmIHRoZSBvYmplY3QgZG9lcyBub3QgZXhpc3QsIGFzc3VtZSBpdCBpcyBhbiBleGlzdGluZyBvYmplY3QgdGhhdCBpcyBub3RcclxuXHRcdC8vIHlldCBpbiBtZW1vcnkgY2xpZW50LXNpZGUsIHNvIGNyZWF0ZSBhIGdob3N0ZWQgaW5zdGFuY2UuXHJcblx0XHRpZiAoIW9iaikge1xyXG5cdFx0XHRvYmogPSBuZXcganN0eXBlKGlkKTtcclxuXHRcdFx0aWYgKGpzdHlwZS5tZXRhLmdldF9vcmlnaW4oKSA9PT0gXCJzZXJ2ZXJcIikge1xyXG5cdFx0XHRcdE9iamVjdExhenlMb2FkZXIucmVnaXN0ZXIob2JqKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBvYmo7XHJcblx0fTtcclxuXHJcblx0ZnVuY3Rpb24gdG9FeG9Nb2RlbCh2YWwsIHRyYW5zbGF0b3IpIHtcclxuXHRcdGlmICh2YWwgPT09IHVuZGVmaW5lZCB8fCB2YWwgPT09IG51bGwpXHJcblx0XHRcdHJldHVybjtcclxuXHJcblx0XHQvLyBlbnRpdGllcyBvbmx5OiB0cmFuc2xhdGUgZm9yd2FyZCB0byB0aGUgc2VydmVyJ3MgaWRcclxuXHRcdGlmICh2YWwgaW5zdGFuY2VvZiBFeG9XZWIuTW9kZWwuRW50aXR5KSB7XHJcblx0XHRcdHZhciByZXN1bHQgPSB7XHJcblx0XHRcdFx0aWQ6IHZhbC5tZXRhLmlkLFxyXG5cdFx0XHRcdHR5cGU6IHZhbC5tZXRhLnR5cGUuZ2V0X2Z1bGxOYW1lKClcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdGlmICh2YWwubWV0YS5pc05ldykge1xyXG5cdFx0XHRcdHJlc3VsdC5pc05ldyA9IHRydWU7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJlc3VsdC5pZCA9IHRyYW5zbGF0b3IuZm9yd2FyZChyZXN1bHQudHlwZSwgcmVzdWx0LmlkKSB8fCByZXN1bHQuaWQ7XHJcblx0XHRcdHJldHVybiByZXN1bHQ7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHZhbDtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHRyYW5zbGF0ZUlkKHRyYW5zbGF0b3IsIHR5cGUsIGlkKSB7XHJcblx0XHQvLyBnZXQgdGhlIHNlcnZlciBpZCwgZWl0aGVyIHRyYW5zbGF0ZWQgb3IgYXMgdGhlIHNlcmlhbGl6ZWQgZW50aXR5IGlkIGl0c2VsZlxyXG5cdFx0dmFyIHNlcnZlcklkID0gdHJhbnNsYXRvci5mb3J3YXJkKHR5cGUsIGlkKSB8fCBpZDtcclxuXHRcdC8vIGdldCB0aGUgY2xpZW50IGlkLCBlaXRoZXIgYSByZXZlcnNlIHRyYW5zbGF0aW9uIG9mIHRoZSBzZXJ2ZXIgaWQgb3IgdGhlIHNlcnZlciBpZCBpdHNlbGZcclxuXHRcdHZhciBjbGllbnRJZCA9IHRyYW5zbGF0b3IucmV2ZXJzZSh0eXBlLCBzZXJ2ZXJJZCkgfHwgc2VydmVySWQ7XHJcblxyXG5cdFx0cmV0dXJuIGNsaWVudElkO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gZnJvbUV4b01vZGVsKHZhbCwgdHJhbnNsYXRvciwgY3JlYXRlLCBzdXBwbGVtZW50YWxPYmplY3RzQXJyYXkpIHtcclxuXHRcdGlmICh2YWwgIT09IHVuZGVmaW5lZCAmJiB2YWwgIT09IG51bGwgJiYgdmFsLnR5cGUgJiYgdmFsLmlkICkge1xyXG5cdFx0XHR2YXIgdHlwZSA9IEV4b1dlYi5Nb2RlbC5Nb2RlbC5nZXRKc1R5cGUodmFsLnR5cGUpO1xyXG5cclxuXHRcdFx0Ly8gRW50aXRpZXMgb25seTogdHJhbnNsYXRlIGJhY2sgdG8gdGhlIGNsaWVudCdzIGlkLiAgVGhpcyBpcyBuZWNlc3NhcnkgdG8gaGFuZGxlIHRoZSBmYWN0IHRoYXQgaWRzIGFyZSBjcmVhdGVkIG9uIFxyXG5cdFx0XHQvLyBib3RoIHRoZSBjbGllbnQgYW5kIHNlcnZlci4gIEFsc28sIGluIHNvbWUgY2FzZXMgYSB0cmFuc2FjdGlvbiByZWZlcmVuY2VzIGFuIGVudGl0eSB0aGF0IHdhcyBjcmVhdGVkIG9uIHRoZSBzZXJ2ZXIgXHJcblx0XHRcdC8vIGFuZCB0aGVuIGNvbW1pdHRlZCwgc28gdGhhdCB0aGUgaWQgYWN0dWFsbHkgcmVmZXJlbmNlcyBhbiBvYmplY3QgdGhhdCBhbHJlYWR5IGV4aXN0cyBvbiB0aGUgY2xpZW50IGJ1dCB3aXRoIGEgZGlmZmVyZW50IGlkLlxyXG5cdFx0XHQvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblx0XHRcdGlmICh0eXBlLm1ldGEgJiYgdHlwZS5tZXRhIGluc3RhbmNlb2YgRXhvV2ViLk1vZGVsLlR5cGUgJiYgdHJhbnNsYXRvcikge1xyXG5cdFx0XHRcdC8vIE5PVEU6IGRvbid0IGFsdGVyIHRoZSBvcmlnaW5hbCBvYmplY3RcclxuXHRcdFx0XHR2YXIgaWQgPSB0cmFuc2xhdGVJZCh0cmFuc2xhdG9yLCB2YWwudHlwZSwgdmFsLmlkKTtcclxuXHJcblx0XHRcdFx0dmFyIG9iaiA9IHR5cGUubWV0YS5nZXQoaWQsXHJcblx0XHRcdFx0XHQvLyBTaW5jZSBcImZyb21FeG9Nb2RlbFwiIG9wZXJhdGVzIG9uIHRoZSBFeG9Nb2RlbCBjaGFuZ2Ugb2JqZWN0IGZvcm1hdCxcclxuXHRcdFx0XHRcdC8vIGl0IGNhbiBiZSBhc3N1bWVkIHRoYXQgdGhlIGluc3RhbmNlIHR5cGUgaXMgZXhhY3QuXHJcblx0XHRcdFx0XHR0cnVlXHJcblx0XHRcdFx0KTtcclxuXHJcblx0XHRcdFx0Ly8gSWYgdGhlIG9iamVjdCB3YXMgbm90IGZvdW5kIGFuZCBhIHN1cHBsZW1lbnRhbCBsaXN0IHdhcyBwcm92aWRlZCwgdGhlbiBzZWFyY2ggZm9yIGl0XHJcblx0XHRcdFx0aWYgKCFvYmogJiYgc3VwcGxlbWVudGFsT2JqZWN0c0FycmF5ICYmIHN1cHBsZW1lbnRhbE9iamVjdHNBcnJheS5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0XHR2YXIgbWF0Y2hlcyA9IHN1cHBsZW1lbnRhbE9iamVjdHNBcnJheS5maWx0ZXIoZnVuY3Rpb24obykge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gbyBpbnN0YW5jZW9mIHR5cGUgJiYgby5tZXRhLmlkID09PSBpZDtcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0aWYgKG1hdGNoZXMubGVuZ3RoID4gMSkge1xyXG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJFeHBlY3RlZCBhIHNpbmdsZSBpdGVtLCBidXQgZm91bmQgXCIgKyBtYXRjaGVzLmxlbmd0aCArIFwiLlwiKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdG9iaiA9IG1hdGNoZXNbMF07XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRpZiAoIW9iaiAmJiBjcmVhdGUpIHtcclxuXHRcdFx0XHRcdG9iaiA9IG5ldyB0eXBlKGlkKTtcclxuXHRcdFx0XHRcdGlmICh0eXBlLm1ldGEuZ2V0X29yaWdpbigpID09PSBcInNlcnZlclwiKSB7XHJcblx0XHRcdFx0XHRcdE9iamVjdExhenlMb2FkZXIucmVnaXN0ZXIob2JqKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHJldHVybiBvYmo7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIGlzIHRoaXMgbmVlZGVkPyBDYW4gdGhlIGlmIHN0YXRlbWVudCB0aGF0IGNoZWNrcyB0eXBlLm1ldGEgYmUgcmVtb3ZlZD9cclxuXHRcdFx0cmV0dXJuIHZhbDtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gdmFsO1xyXG5cdH1cclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5NYXBwZXIuRXhvTW9kZWxFdmVudExpc3RlbmVyXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gRXhvTW9kZWxFdmVudExpc3RlbmVyKG1vZGVsLCB0cmFuc2xhdG9yLCBmaWx0ZXJzKSB7XHJcblx0XHR0aGlzLl9tb2RlbCA9IG1vZGVsO1xyXG5cdFx0dGhpcy5fdHJhbnNsYXRvciA9IHRyYW5zbGF0b3I7XHJcblx0XHR0aGlzLl9maWx0ZXJzID0gZmlsdGVycztcclxuXHJcblx0XHQvLyBsaXN0ZW4gZm9yIGV2ZW50c1xyXG5cdFx0bW9kZWwuYWRkTGlzdENoYW5nZWQodGhpcy5vbkxpc3RDaGFuZ2VkLmJpbmQodGhpcykpO1xyXG5cdFx0bW9kZWwuYWRkQWZ0ZXJQcm9wZXJ0eVNldCh0aGlzLm9uUHJvcGVydHlDaGFuZ2VkLmJpbmQodGhpcykpO1xyXG5cdFx0bW9kZWwuYWRkT2JqZWN0UmVnaXN0ZXJlZCh0aGlzLm9uT2JqZWN0UmVnaXN0ZXJlZC5iaW5kKHRoaXMpKTtcclxuXHRcdG1vZGVsLmFkZE9iamVjdFVucmVnaXN0ZXJlZCh0aGlzLm9uT2JqZWN0VW5yZWdpc3RlcmVkLmJpbmQodGhpcykpO1xyXG5cdH1cclxuXHJcblx0RXhvTW9kZWxFdmVudExpc3RlbmVyLm1peGluKEV4b1dlYi5GdW5jdG9yLmV2ZW50aW5nKTtcclxuXHJcblx0RXhvTW9kZWxFdmVudExpc3RlbmVyLm1peGluKHtcclxuXHRcdGFkZENoYW5nZURldGVjdGVkOiBmdW5jdGlvbiBFeG9Nb2RlbEV2ZW50TGlzdGVuZXIkb25FdmVudChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX2FkZEV2ZW50KFwiY2hhbmdlRGV0ZWN0ZWRcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIE1vZGVsIGV2ZW50IGhhbmRsZXJzXHJcblx0XHRvbkxpc3RDaGFuZ2VkOiBmdW5jdGlvbiBFeG9Nb2RlbEV2ZW50TGlzdGVuZXIkb25MaXN0Q2hhbmdlZChvYmosIHByb3BlcnR5LCBsaXN0Q2hhbmdlcykge1xyXG5cdFx0XHRpZiAodGhpcy5fZmlsdGVycyAmJiB0aGlzLl9maWx0ZXJzLmxpc3RDaGFuZ2VkICYmIHRoaXMuX2ZpbHRlcnMubGlzdENoYW5nZWQob2JqLCBwcm9wZXJ0eSwgbGlzdENoYW5nZXMpICE9PSB0cnVlKVxyXG5cdFx0XHRcdHJldHVybjtcclxuXHJcblx0XHRcdC8vIFJlY29yZGluZyBzdGF0aWMgcHJvcGVydHkgY2hhbmdlcyBpcyBub3Qgc3VwcG9ydGVkIGJ5IHRoZSBKU09OIGZvcm1hdCBvciB0aGUgc2VydmVyLXNpZGUgaW1wbGVtZW50YXRpb24uXHJcblx0XHRcdGlmIChwcm9wZXJ0eS5nZXRfaXNTdGF0aWMoKSkge1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Q2hhbmdlcy5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRcdHZhciBsaXN0Q2hhbmdlID0gbGlzdENoYW5nZXNbaV07XHJcblxyXG5cdFx0XHRcdHZhciBjaGFuZ2UgPSB7XHJcblx0XHRcdFx0XHR0eXBlOiBcIkxpc3RDaGFuZ2VcIixcclxuXHRcdFx0XHRcdGluc3RhbmNlOiB0b0V4b01vZGVsKG9iaiwgdGhpcy5fdHJhbnNsYXRvciksXHJcblx0XHRcdFx0XHRwcm9wZXJ0eTogcHJvcGVydHkuZ2V0X25hbWUoKSxcclxuXHRcdFx0XHRcdGFkZGVkOiBbXSxcclxuXHRcdFx0XHRcdHJlbW92ZWQ6IFtdXHJcblx0XHRcdFx0fTtcclxuXHJcblx0XHRcdFx0dmFyIF90aGlzID0gdGhpcztcclxuXHRcdFx0XHRpZiAobGlzdENoYW5nZS5uZXdTdGFydGluZ0luZGV4ID49IDAgfHwgbGlzdENoYW5nZS5uZXdJdGVtcykge1xyXG5cdFx0XHRcdFx0QXJyYXkuZm9yRWFjaChsaXN0Q2hhbmdlLm5ld0l0ZW1zLCBmdW5jdGlvbiBFeG9Nb2RlbEV2ZW50TGlzdGVuZXIkb25MaXN0Q2hhbmdlZCRhZGRlZEl0ZW0ob2JqKSB7XHJcblx0XHRcdFx0XHRcdGNoYW5nZS5hZGRlZC5wdXNoKHRvRXhvTW9kZWwob2JqLCBfdGhpcy5fdHJhbnNsYXRvcikpO1xyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGlmIChsaXN0Q2hhbmdlLm9sZFN0YXJ0aW5nSW5kZXggPj0gMCB8fCBsaXN0Q2hhbmdlLm9sZEl0ZW1zKSB7XHJcblx0XHRcdFx0XHRBcnJheS5mb3JFYWNoKGxpc3RDaGFuZ2Uub2xkSXRlbXMsIGZ1bmN0aW9uIEV4b01vZGVsRXZlbnRMaXN0ZW5lciRvbkxpc3RDaGFuZ2VkJHJlbW92ZWRJdGVtKG9iaikge1xyXG5cdFx0XHRcdFx0XHRjaGFuZ2UucmVtb3ZlZC5wdXNoKHRvRXhvTW9kZWwob2JqLCBfdGhpcy5fdHJhbnNsYXRvcikpO1xyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwiY2hhbmdlRGV0ZWN0ZWRcIiwgW2NoYW5nZV0pO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0b25PYmplY3RSZWdpc3RlcmVkOiBmdW5jdGlvbiBFeG9Nb2RlbEV2ZW50TGlzdGVuZXIkb25PYmplY3RSZWdpc3RlcmVkKG9iaikge1xyXG5cdFx0XHRpZiAodGhpcy5fZmlsdGVycyAmJiB0aGlzLl9maWx0ZXJzLm9iamVjdFJlZ2lzdGVyZWQgJiYgdGhpcy5fZmlsdGVycy5vYmplY3RSZWdpc3RlcmVkKG9iaikgIT09IHRydWUpXHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cclxuXHRcdFx0aWYgKG9iai5tZXRhLmlzTmV3KSB7XHJcblx0XHRcdFx0dmFyIGNoYW5nZSA9IHtcclxuXHRcdFx0XHRcdHR5cGU6IFwiSW5pdE5ld1wiLFxyXG5cdFx0XHRcdFx0aW5zdGFuY2U6IHRvRXhvTW9kZWwob2JqLCB0aGlzLl90cmFuc2xhdG9yKVxyXG5cdFx0XHRcdH07XHJcblxyXG5cdFx0XHRcdHRoaXMuX3JhaXNlRXZlbnQoXCJjaGFuZ2VEZXRlY3RlZFwiLCBbY2hhbmdlXSk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRvbk9iamVjdFVucmVnaXN0ZXJlZDogZnVuY3Rpb24gRXhvTW9kZWxFdmVudExpc3RlbmVyJG9uT2JqZWN0VW5yZWdpc3RlcmVkKG9iaikge1xyXG5cdFx0XHRpZiAodGhpcy5fZmlsdGVycyAmJiB0aGlzLl9maWx0ZXJzLm9iamVjdFVucmVnaXN0ZXJlZCAmJiB0aGlzLl9maWx0ZXJzLm9iamVjdFVucmVnaXN0ZXJlZChvYmopICE9PSB0cnVlKVxyXG5cdFx0XHRcdHJldHVybjtcclxuXHJcblx0XHRcdC8vaWYgKG9iai5tZXRhLnR5cGUuZ2V0X29yaWdpbigpID09PSBcInNlcnZlclwiKSB7XHJcblx0XHRcdC8vXHR0aHJvdyBuZXcgRXJyb3IoJGZvcm1hdChcIlVucmVnaXN0ZXJpbmcgc2VydmVyLXR5cGUgb2JqZWN0cyBpcyBub3QgY3VycmVudGx5IHN1cHBvcnRlZDogezB9fHsxfVwiLCBvYmoubWV0YS50eXBlLmZ1bGxOYW1lLCBvYmoubWV0YS5pZCkpO1xyXG5cdFx0XHQvL31cclxuXHRcdH0sXHJcblx0XHRvblByb3BlcnR5Q2hhbmdlZDogZnVuY3Rpb24gRXhvTW9kZWxFdmVudExpc3RlbmVyJG9uUHJvcGVydHlDaGFuZ2VkKG9iaiwgcHJvcGVydHksIG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG5cdFx0XHRpZiAodGhpcy5fZmlsdGVycyAmJiB0aGlzLl9maWx0ZXJzLnByb3BlcnR5Q2hhbmdlZCAmJiB0aGlzLl9maWx0ZXJzLnByb3BlcnR5Q2hhbmdlZChvYmosIHByb3BlcnR5LCBuZXdWYWx1ZSwgb2xkVmFsdWUpICE9PSB0cnVlKVxyXG5cdFx0XHRcdHJldHVybjtcclxuXHJcblx0XHRcdC8vIFJlY29yZGluZyBzdGF0aWMgcHJvcGVydHkgY2hhbmdlcyBpcyBub3Qgc3VwcG9ydGVkIGJ5IHRoZSBKU09OIGZvcm1hdCBvciB0aGUgc2VydmVyLXNpZGUgaW1wbGVtZW50YXRpb24uXHJcblx0XHRcdGlmIChwcm9wZXJ0eS5nZXRfaXNTdGF0aWMoKSkge1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKHByb3BlcnR5LmdldF9pc1ZhbHVlVHlwZSgpKSB7XHJcblx0XHRcdFx0dmFyIHZhbHVlQ2hhbmdlID0ge1xyXG5cdFx0XHRcdFx0dHlwZTogXCJWYWx1ZUNoYW5nZVwiLFxyXG5cdFx0XHRcdFx0aW5zdGFuY2U6IHRvRXhvTW9kZWwob2JqLCB0aGlzLl90cmFuc2xhdG9yKSxcclxuXHRcdFx0XHRcdHByb3BlcnR5OiBwcm9wZXJ0eS5nZXRfbmFtZSgpLFxyXG5cdFx0XHRcdFx0b2xkVmFsdWU6IG9sZFZhbHVlLFxyXG5cdFx0XHRcdFx0bmV3VmFsdWU6IG5ld1ZhbHVlXHJcblx0XHRcdFx0fTtcclxuXHJcblx0XHRcdFx0dGhpcy5fcmFpc2VFdmVudChcImNoYW5nZURldGVjdGVkXCIsIFt2YWx1ZUNoYW5nZV0pO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHZhciByZWZDaGFuZ2UgPSB7XHJcblx0XHRcdFx0XHR0eXBlOiBcIlJlZmVyZW5jZUNoYW5nZVwiLFxyXG5cdFx0XHRcdFx0aW5zdGFuY2U6IHRvRXhvTW9kZWwob2JqLCB0aGlzLl90cmFuc2xhdG9yKSxcclxuXHRcdFx0XHRcdHByb3BlcnR5OiBwcm9wZXJ0eS5nZXRfbmFtZSgpLFxyXG5cdFx0XHRcdFx0b2xkVmFsdWU6IHRvRXhvTW9kZWwob2xkVmFsdWUsIHRoaXMuX3RyYW5zbGF0b3IpLFxyXG5cdFx0XHRcdFx0bmV3VmFsdWU6IHRvRXhvTW9kZWwobmV3VmFsdWUsIHRoaXMuX3RyYW5zbGF0b3IpXHJcblx0XHRcdFx0fTtcclxuXHJcblx0XHRcdFx0dGhpcy5fcmFpc2VFdmVudChcImNoYW5nZURldGVjdGVkXCIsIFtyZWZDaGFuZ2VdKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHRFeG9XZWIuTWFwcGVyLkV4b01vZGVsRXZlbnRMaXN0ZW5lciA9IEV4b01vZGVsRXZlbnRMaXN0ZW5lcjtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5NYXBwZXIuQ2hhbmdlU2V0XHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0LypnbG9iYWxzIGV4cG9ydHMsIEZ1bmN0b3IsIEFyZ3VtZW50RXJyb3IsIEFyZ3VtZW50TnVsbEVycm9yLCBBcmd1bWVudFR5cGVFcnJvciwgcmFuZG9tVGV4dCAqL1xyXG5cclxuXHRmdW5jdGlvbiBDaGFuZ2VTZXQoc291cmNlLCB0aXRsZSwgdXNlciwgaW5pdGlhbENoYW5nZXMsIGNvZGUpIHtcclxuXHRcdGlmIChzb3VyY2UgPT09IG51bGwgfHwgc291cmNlID09PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0dGhyb3cgbmV3IEFyZ3VtZW50TnVsbEVycm9yKFwic291cmNlXCIpO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHNvdXJjZS5jb25zdHJ1Y3RvciAhPT0gU3RyaW5nKSB7XHJcblx0XHRcdHRocm93IG5ldyBBcmd1bWVudFR5cGVFcnJvcihcInNvdXJjZVwiLCBcInN0cmluZ1wiLCBzb3VyY2UpO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHNvdXJjZSAhPT0gXCJpbml0XCIgJiYgc291cmNlICE9PSBcInNlcnZlclwiICYmIHNvdXJjZSAhPT0gXCJjbGllbnRcIikge1xyXG5cdFx0XHR0aHJvdyBuZXcgQXJndW1lbnRFcnJvcihcInNvdXJjZVwiLCBzb3VyY2UgKyBcIiBtdXN0IGJlIGluIHRoZSBzZXQgWydpbml0JywgJ3NlcnZlcicsICdjbGllbnQnXVwiKTtcclxuXHRcdH1cclxuXHRcdGlmICh1c2VyICE9PSBudWxsICYmIHVzZXIgIT09IHVuZGVmaW5lZCAmJiB1c2VyLmNvbnN0cnVjdG9yICE9PSBTdHJpbmcpIHtcclxuXHRcdFx0dGhyb3cgbmV3IEFyZ3VtZW50VHlwZUVycm9yKFwidXNlclwiLCBcInN0cmluZ1wiLCB1c2VyKTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmNvZGUgPSBjb2RlIHx8IHJhbmRvbVRleHQoOCk7XHJcblx0XHR0aGlzLnNvdXJjZSA9IHNvdXJjZTtcclxuXHRcdHRoaXMudGl0bGUgPSB0aXRsZSB8fCBudWxsO1xyXG5cdFx0dGhpcy51c2VyID0gdXNlciB8fCBudWxsO1xyXG5cdFx0dGhpcy5jaGFuZ2VzID0gKGluaXRpYWxDaGFuZ2VzICYmIGluaXRpYWxDaGFuZ2VzIGluc3RhbmNlb2YgQXJyYXkpID8gW10uY29uY2F0KGluaXRpYWxDaGFuZ2VzKSA6IFtdO1xyXG5cdFx0dGhpcy5vbkNoYW5nZUFkZGVkID0gbmV3IEZ1bmN0b3IoKTtcclxuXHRcdHRoaXMub25DaGFuZ2VVbmRvbmUgPSBuZXcgRnVuY3RvcigpO1xyXG5cdFx0dGhpcy5vblRydW5jYXRlZCA9IG5ldyBGdW5jdG9yKCk7XHJcblx0fVxyXG5cclxuXHRDaGFuZ2VTZXQubWl4aW4oe1xyXG5cdFx0YWRkOiBmdW5jdGlvbiAoY2hhbmdlKSB7XHJcblx0XHRcdHZhciBpZHggPSB0aGlzLmNoYW5nZXMucHVzaChjaGFuZ2UpIC0gMTtcclxuXHRcdFx0dGhpcy5vbkNoYW5nZUFkZGVkKGNoYW5nZSwgaWR4LCB0aGlzKTtcclxuXHRcdFx0cmV0dXJuIGlkeDtcclxuXHRcdH0sXHJcblx0XHRjaGVja3BvaW50OiBmdW5jdGlvbiAodGl0bGUsIGNvZGUpIHtcclxuXHRcdFx0Ly8gR2VuZXJhdGUgYSByYW5kb20gY29kZSBmb3IgdGhlIGNoZWNrcG9pbnQgaWYgb25lIGlzIG5vdCBnaXZlbi5cclxuXHRcdFx0aWYgKCFjb2RlKSB7XHJcblx0XHRcdFx0Y29kZSA9IHJhbmRvbVRleHQoMTApO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBBZGQgdGhlIGNoZWNrcG9pbnQgYW5kIHJldHVybiB0aGUgY29kZS5cclxuXHRcdFx0dGhpcy5hZGQoeyB0eXBlOiBcIkNoZWNrcG9pbnRcIiwgdGl0bGU6IHRpdGxlIHx8IFwidW50aXRsZWRcIiwgY29kZTogY29kZSB9KTtcclxuXHRcdFx0cmV0dXJuIGNvZGU7XHJcblx0XHR9LFxyXG5cdFx0Y291bnQ6IGZ1bmN0aW9uIChmaWx0ZXIsIHRoaXNQdHIpIHtcclxuXHRcdFx0aWYgKCFmaWx0ZXIpIHtcclxuXHRcdFx0XHRyZXR1cm4gdGhpcy5jaGFuZ2VzLmxlbmd0aDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIHRoaXMuY2hhbmdlcy5maWx0ZXIoZmlsdGVyLCB0aGlzUHRyKS5sZW5ndGg7XHJcblx0XHR9LFxyXG5cdFx0bGFzdENoYW5nZTogZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5jaGFuZ2VzLmxlbmd0aCA+IDAgPyB0aGlzLmNoYW5nZXNbdGhpcy5jaGFuZ2VzLmxlbmd0aCAtIDFdIDogbnVsbDtcclxuXHRcdH0sXHJcblx0XHRzZXJpYWxpemU6IGZ1bmN0aW9uIChmb3JTZXJ2ZXIsIGZpbHRlciwgdGhpc1B0cikge1xyXG5cdFx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0XHRcdGZvclNlcnZlciA9IHRydWU7XHJcblx0XHRcdH0gZWxzZSBpZiAoZm9yU2VydmVyIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuXHRcdFx0XHR0aGlzUHRyID0gZmlsdGVyO1xyXG5cdFx0XHRcdGZpbHRlciA9IGZvclNlcnZlcjtcclxuXHRcdFx0XHRmb3JTZXJ2ZXIgPSB0cnVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR2YXIgcmVzdWx0ID0ge1xyXG5cdFx0XHRcdHNvdXJjZTogdGhpcy5zb3VyY2UsXHJcblx0XHRcdFx0Y2hhbmdlczogZmlsdGVyID8gdGhpcy5jaGFuZ2VzLmZpbHRlcihmaWx0ZXIsIHRoaXNQdHIpIDogQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGhpcy5jaGFuZ2VzKVxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0aWYgKCFmb3JTZXJ2ZXIpIHtcclxuXHRcdFx0XHRyZXN1bHQudGl0bGUgPSB0aGlzLnRpdGxlO1xyXG5cdFx0XHRcdHJlc3VsdC5jb2RlID0gdGhpcy5jb2RlO1xyXG5cdFx0XHRcdGlmICh0aGlzLnVzZXIpIHtcclxuXHRcdFx0XHRcdHJlc3VsdC51c2VyID0gdGhpcy51c2VyO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdH0sXHJcblx0XHR0cnVuY2F0ZTogZnVuY3Rpb24gKGNoZWNrcG9pbnQsIGZpbHRlciwgdGhpc1B0cikge1xyXG5cdFx0XHQvLyBBbGxvdyBjYWxsaW5nIGFzIGZ1bmN0aW9uKGZpbHRlciwgdGhpc1B0cilcclxuXHRcdFx0aWYgKGNoZWNrcG9pbnQgJiYgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGNoZWNrcG9pbnQpID09PSBcIltvYmplY3QgRnVuY3Rpb25dXCIpIHtcclxuXHRcdFx0XHR0aGlzUHRyID0gZmlsdGVyO1xyXG5cdFx0XHRcdGZpbHRlciA9IGNoZWNrcG9pbnQ7XHJcblx0XHRcdFx0Y2hlY2twb2ludCA9IG51bGw7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIFdyYXAgY3VzdG9tIGZpbHRlciBpZiBhIGNoZWNrcG9pbnQgaXMgZ2l2ZW4uXHJcblx0XHRcdGlmIChjaGVja3BvaW50KSB7XHJcblx0XHRcdFx0dmFyIGZvdW5kQ2hlY2twb2ludCA9IGZhbHNlO1xyXG5cdFx0XHRcdHZhciBjdXN0b21GaWx0ZXIgPSBmaWx0ZXI7XHJcblx0XHRcdFx0ZmlsdGVyID0gZnVuY3Rpb24oY2hhbmdlKSB7XHJcblx0XHRcdFx0XHQvLyBDaGVjayB0byBzZWUgaWYgdGhpcyBpcyB0aGUgY2hlY2twb2ludCB3ZSdyZSBsb29raW5nIGZvci5cclxuXHRcdFx0XHRcdGlmIChjaGFuZ2UudHlwZSA9PT0gXCJDaGVja3BvaW50XCIgJiYgY2hhbmdlLmNvZGUgPT09IGNoZWNrcG9pbnQpIHtcclxuXHRcdFx0XHRcdFx0Zm91bmRDaGVja3BvaW50ID0gdHJ1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyBTdG9wIHRydW5jYXRpbmcgd2hlbiB0aGUgY2hlY2twb2ludCBpcyBmb3VuZC5cclxuXHRcdFx0XHRcdGlmIChmb3VuZENoZWNrcG9pbnQgPT09IHRydWUpIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdC8vIERlbGVnYXRlIHRvIGN1c3RvbSBmaWx0ZXIgaWYgb25lIGlzIGdpdmVuLlxyXG5cdFx0XHRcdFx0cmV0dXJuIGN1c3RvbUZpbHRlciA/IGN1c3RvbUZpbHRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDogdHJ1ZTtcclxuXHRcdFx0XHR9O1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBEaXNjYXJkIGFsbCBjaGFuZ2VzIHRoYXQgbWF0Y2ggdGhlIGdpdmVuIGZpbHRlclxyXG5cdFx0XHR2YXIgbnVtUmVtb3ZlZDtcclxuXHRcdFx0aWYgKGZpbHRlcikge1xyXG5cdFx0XHRcdHZhciByZW1vdmVkQXQgPSB0aGlzLmNoYW5nZXMucHVyZ2UoZmlsdGVyLCB0aGlzUHRyKTtcclxuXHRcdFx0XHRudW1SZW1vdmVkID0gcmVtb3ZlZEF0ID8gcmVtb3ZlZEF0Lmxlbmd0aCA6IDA7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0bnVtUmVtb3ZlZCA9IHRoaXMuY2hhbmdlcy5sZW5ndGg7XHJcblx0XHRcdFx0dGhpcy5jaGFuZ2VzLmNsZWFyKCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMub25UcnVuY2F0ZWQobnVtUmVtb3ZlZCwgdGhpcyk7XHJcblx0XHRcdHJldHVybiBudW1SZW1vdmVkO1xyXG5cdFx0fSxcclxuXHRcdHVuZG86IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRpZiAodGhpcy5jaGFuZ2VzLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHR2YXIgbGFzdElkeCA9IHRoaXMuY2hhbmdlcy5sZW5ndGggLSAxO1xyXG5cdFx0XHRcdHZhciBjaGFuZ2UgPSB0aGlzLmNoYW5nZXNbbGFzdElkeF07XHJcblx0XHRcdFx0dGhpcy5jaGFuZ2VzLnNwbGljZShsYXN0SWR4LCAxKTtcclxuXHRcdFx0XHR0aGlzLm9uQ2hhbmdlVW5kb25lKGNoYW5nZSwgbGFzdElkeCwgdGhpcyk7XHJcblx0XHRcdFx0cmV0dXJuIGNoYW5nZTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuTWFwcGVyLkNoYW5nZUxvZ1xyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdC8qZ2xvYmFscyBGdW5jdG9yLCBDaGFuZ2VTZXQgKi9cclxuXHJcblx0ZnVuY3Rpb24gQ2hhbmdlTG9nKGRlZmF1bHRVc2VyKSB7XHJcblx0XHR0aGlzLl9kZWZhdWx0VXNlciA9IGRlZmF1bHRVc2VyO1xyXG5cdFx0dGhpcy5hY3RpdmVTZXQgPSBudWxsO1xyXG5cdFx0dGhpcy5zZXRzID0gW107XHJcblx0XHR0aGlzLm9uQ2hhbmdlQWRkZWQgPSBuZXcgRnVuY3RvcigpO1xyXG5cdFx0dGhpcy5vbkNoYW5nZVNldFN0YXJ0ZWQgPSBuZXcgRnVuY3RvcigpO1xyXG5cdFx0dGhpcy5vbkNoYW5nZVVuZG9uZSA9IG5ldyBGdW5jdG9yKCk7XHJcblx0XHR0aGlzLm9uVHJ1bmNhdGVkID0gbmV3IEZ1bmN0b3IoKTtcclxuXHR9XHJcblxyXG5cdENoYW5nZUxvZy5taXhpbih7XHJcblx0XHRhZGQ6IGZ1bmN0aW9uIChjaGFuZ2UpIHtcclxuXHRcdFx0Ly8gQWRkcyBhIG5ldyBjaGFuZ2UgdG8gdGhlIGxvZy5cclxuXHJcblx0XHRcdGlmICh0aGlzLmFjdGl2ZVNldCA9PT0gbnVsbCkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIlRoZSBjaGFuZ2UgbG9nIGlzIG5vdCBjdXJyZW50bHkgYWN0aXZlLlwiKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIGlkeCA9IHRoaXMuYWN0aXZlU2V0LmFkZChjaGFuZ2UpO1xyXG5cclxuXHRcdFx0dGhpcy5vbkNoYW5nZUFkZGVkKGNoYW5nZSwgaWR4LCB0aGlzLmFjdGl2ZVNldCwgdGhpcyk7XHJcblxyXG5cdFx0XHRyZXR1cm4gaWR4O1xyXG5cdFx0fSxcclxuXHRcdGFkZFNldDogZnVuY3Rpb24gKHNvdXJjZSwgdGl0bGUsIHVzZXIsIGNoYW5nZXMsIGNvZGUpIHtcclxuXHRcdFx0dmFyIGNoYW5nZVNldCA9IG5ldyBDaGFuZ2VTZXQoc291cmNlLCB0aXRsZSwgdXNlciwgY2hhbmdlcywgY29kZSk7XHJcblx0XHRcdHRoaXMuc2V0cy5wdXNoKGNoYW5nZVNldCk7XHJcblx0XHRcdHJldHVybiBjaGFuZ2VTZXQ7XHJcblx0XHR9LFxyXG5cdFx0YmF0Y2hDaGFuZ2VzOiBmdW5jdGlvbiAodGl0bGUsIHVzZXIsIGFjdGlvbiwgcmVtb3ZlSWZFbXB0eSkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnk+XHJcblx0XHRcdC8vLyBFbnN1cmVzIHRoYXQgdGhlIHNldCBvZiBjaGFuZ2VzIHRoYXQgcmVzdWx0IGZyb20gaW52b2tpbmdcclxuXHRcdFx0Ly8vIGBhY3Rpb25gIGFyZSBwbGFjZWQgaW4gYSBkZWRpY2F0ZWQgY2hhbmdlIHNldCB3aXRoIHRoZSBnaXZlblxyXG5cdFx0XHQvLy8gYHRpdGxlYCAob3IgZGVzY3JpcHRpb24pIGFuZCBgdXNlcmAgYW5kIG5vIG90aGVyIGNoYW5nZXMuXHJcblx0XHRcdC8vLyA8L3N1bW1hcnk+XHJcblxyXG5cdFx0XHRpZiAoIXRpdGxlIHx8IHRpdGxlLmNvbnN0cnVjdG9yICE9PSBTdHJpbmcgfHwgdGl0bGUubGVuZ3RoID09PSAwKSB7XHJcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiVGhlIGZpcnN0IGFyZ3VtZW50IHRvIGJhdGNoQ2hhbmdlcyBtdXN0IGJlIGEgbm9uLWVtcHR5IHN0cmluZyB3aGljaCBzcGVjaWZpZXMgYSB0aXRsZSBmb3IgdGhlIGNoYW5nZXMuXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh1c2VyICE9PSBudWxsICYmIHVzZXIgIT09IHVuZGVmaW5lZCAmJiAodXNlci5jb25zdHJ1Y3RvciAhPT0gU3RyaW5nIHx8IHVzZXIubGVuZ3RoID09PSAwKSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIlRoZSBzZWNvbmQgYXJndW1lbnQgdG8gYmF0Y2hDaGFuZ2VzIG11c3QgYmUgYSBub24tZW1wdHkgc3RyaW5nIHdoaWNoIHNwZWNpZmllcyB0aGUgdXNlciB3aG8gaXMgaW5pdGlhdGluZyB0aGUgY2hhbmdlcy5cIik7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKCFhY3Rpb24gfHwgIShhY3Rpb24gaW5zdGFuY2VvZiBGdW5jdGlvbikpIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJUaGUgdGhpcmQgYXJndW1lbnQgdG8gYmF0Y2hDaGFuZ2VzIG11c3QgYmUgYSBmdW5jdGlvbiB3aGljaCBwZXJmb3JtcyB0aGUgY2hhbmdlcy5cIik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciBuZXdCYXRjaFNldEluZGV4LFxyXG5cdFx0XHRcdG5ld0JhdGNoU2V0LFxyXG5cdFx0XHRcdGNoYW5nZVNldFN0YXJ0ZWRIYW5kbGVyLFxyXG5cdFx0XHRcdHByZXZpb3VzQWN0aXZlU2V0ID0gdGhpcy5hY3RpdmVTZXQsXHJcblx0XHRcdFx0cHJldmlvdXNBY3RpdmVTZXRJZHggPSBwcmV2aW91c0FjdGl2ZVNldCA/IHRoaXMuc2V0cy5pbmRleE9mKHByZXZpb3VzQWN0aXZlU2V0KSA6IC0xLFxyXG5cdFx0XHRcdHByaW9yU2V0ID0gcHJldmlvdXNBY3RpdmVTZXQsXHJcblx0XHRcdFx0dXNlUHJpb3JTZXQgPSB0cnVlLFxyXG5cdFx0XHRcdG5ld0FjdGl2ZVNldCA9IG51bGw7XHJcblxyXG5cdFx0XHQvLyBTdGFydCBhIG5ldyBzZXQgZm9yIHRoZSBiYXRjaCBpZiB0aGVyZSBpc24ndCBhIGN1cnJlbnQgYWN0aXZlIHNldC4gSWYgdGhlcmUgaXMgYSBjdXJyZW50IGFjdGl2ZSBzZXQgaXQgY2FuIGJlXHJcblx0XHRcdC8vIHJlLXVzZWQgaWYgaXQgaGFzIG5vIHByZS1leGlzdGluZyBjaGFuZ2VzIGFuZCBoYXMgdGhlIHNhbWUgc291cmNlLCB0aXRsZSwgYW5kIHVzZXIuXHJcblx0XHRcdGlmICghcHJldmlvdXNBY3RpdmVTZXQgfHwgKHByZXZpb3VzQWN0aXZlU2V0LmNoYW5nZXMubGVuZ3RoID4gMCB8fCBwcmV2aW91c0FjdGl2ZVNldC5zb3VyY2UgIT09IFwiY2xpZW50XCIgfHwgcHJldmlvdXNBY3RpdmVTZXQudGl0bGUgIT09IHRpdGxlIHx8IHByZXZpb3VzQWN0aXZlU2V0LnVzZXIgIT09IHVzZXIpKSB7XHJcblx0XHRcdFx0bmV3QmF0Y2hTZXQgPSBuZXcgQ2hhbmdlU2V0KFwiY2xpZW50XCIsIHRpdGxlLCB1c2VyIHx8IHRoaXMuX2RlZmF1bHRVc2VyKTtcclxuXHRcdFx0XHR0aGlzLnNldHMucHVzaChuZXdCYXRjaFNldCk7XHJcblx0XHRcdFx0dGhpcy5hY3RpdmVTZXQgPSBuZXdCYXRjaFNldDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gSWYgYSBuZXcgc2V0IGlzIGNyZWF0ZWQgZm9yIHRoZSBiYXRjaCwgYW5kIHRoZXJlIHdhcyBhIHByZXZpb3VzIGFjdGl2ZSBzZXQsIHRoZW4gcmVtb3ZlIGl0IGlmIGl0IGlzbid0IG5lZWRlZC5cclxuXHRcdFx0aWYgKG5ld0JhdGNoU2V0ICYmIHByZXZpb3VzQWN0aXZlU2V0KSB7XHJcblx0XHRcdFx0Ly8gSWYgdGhlcmUgYXJlIG5vIGNoYW5nZXMsIG5vIHRpdGxlLCBhbmQgbm8gdXNlciwgdGhlbiB0aGUgc2V0IGRvZXNuJ3QgcHJvdmlkZSBhbnkgdXNlZnVsIGluZm9ybWF0aW9uLlxyXG5cdFx0XHRcdGlmICghcHJldmlvdXNBY3RpdmVTZXQudGl0bGUgJiYgIXByZXZpb3VzQWN0aXZlU2V0LnVzZXIgJiYgcHJldmlvdXNBY3RpdmVTZXQuY2hhbmdlcy5sZW5ndGggPT09IDApIHtcclxuXHRcdFx0XHRcdC8vIFJlLXVzZSB0aGUgc2V0IHJhdGhlciB0aGFuIGNyZWF0ZSBhIG5ldyBvbmUuIFRoaXMgaXMgbm90IHN0cmljdGx5IG5lY2Vzc2FyeSwgYnV0IHNpbmNlXHJcblx0XHRcdFx0XHQvLyB0aGVyZSBpcyBhIHByZWNlZGVudCBmb3IgYXR0ZW1wdGluZyB0byByZXVzZSBzZXRzLCBpdCBtYWtlcyBzZW5zZSB0byBkbyBzbyBoZXJlIGFzIHdlbGwuXHJcblx0XHRcdFx0XHRuZXdBY3RpdmVTZXQgPSBwcmV2aW91c0FjdGl2ZVNldDtcclxuXHJcblx0XHRcdFx0XHQvLyBSZW1vdmUgdGhlIHNldCBmcm9tIHRoZSBsb2cuXHJcblx0XHRcdFx0XHR0aGlzLnNldHMuc3BsaWNlKHByZXZpb3VzQWN0aXZlU2V0SWR4LCAxKTtcclxuXHRcdFx0XHRcdC8vIE5PVEU6IG5vIG5lZWQgdG8gYWx0ZXIgXCJhY3RpdmVTZXRcIiwgc2luY2UgaXQgd2FzIGFscmVhZHkgY2hhbmdlZCB0byBiZSB0aGUgbmV3IGJhdGNoIHNldC5cclxuXHJcblx0XHRcdFx0XHQvLyBNb3ZlIHRoZSBwcmlvciBzZXQgYmFjayBzaW5jZSB0aGUgcHJldmlvdXMgYWN0aXZlIHNldCBpcyByZW1vdmVkLlxyXG5cdFx0XHRcdFx0cHJpb3JTZXQgPSB0aGlzLnNldHNbcHJldmlvdXNBY3RpdmVTZXRJZHggLSAxXTtcclxuXHJcblx0XHRcdFx0XHQvLyBEb24ndCByZS11c2UgdGhlIHByaW9yIHNldCBzaW5jZSBpdCB3YXMgbm90IGFjdGl2ZSBhbmQgdGhlXHJcblx0XHRcdFx0XHQvLyBwcmV2aW91cyBhY3RpdmUgc2V0IHdhcyByZW1vdmVkIChhcyBpZiBpdCBuZXZlciBleGlzdGVkKS5cclxuXHRcdFx0XHRcdHVzZVByaW9yU2V0ID0gZmFsc2U7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBSYWlzZSBhbiBlcnJvciBpZiBhIGNoYW5nZSBzZXQgaXMgc3RhcnRlZCB3aGlsZSB0aGUgYmF0Y2ggaXMgYmVpbmcgcGVyZm9ybWVkLlxyXG5cdFx0XHRjaGFuZ2VTZXRTdGFydGVkSGFuZGxlciA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJOZXN0ZWQgY2hhbmdlIGJhdGNoZXMgYXJlIG5vdCBjdXJyZW50bHkgc3VwcG9ydGVkLiBCYXRjaCBhbHJlYWR5IGluIHByb2dyZXNzOiBcIiArIHRpdGxlKTtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdC8vIEF0dGFjaCB0aGUgZXZlbnRcclxuXHRcdFx0dGhpcy5vbkNoYW5nZVNldFN0YXJ0ZWQuYWRkKGNoYW5nZVNldFN0YXJ0ZWRIYW5kbGVyKTtcclxuXHJcblx0XHRcdHRyeSB7XHJcblx0XHRcdFx0Ly8gSW52b2tlIHRoZSBhY3Rpb24gY2FsbGJhY2suXHJcblx0XHRcdFx0YWN0aW9uKCk7XHJcblx0XHRcdH0gZmluYWxseSB7XHJcblx0XHRcdFx0Ly8gUmVtb3ZlIHRoZSBldmVudFxyXG5cdFx0XHRcdGlmICghdGhpcy5vbkNoYW5nZVNldFN0YXJ0ZWQucmVtb3ZlKGNoYW5nZVNldFN0YXJ0ZWRIYW5kbGVyKSkge1xyXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiQ291bGQgbm90IHVuc3Vic2NyaWJlIGZyb20gY2hhbmdlIHNldCBzdGFydGVkIGV2ZW50LlwiKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGlmIChuZXdCYXRjaFNldCkge1xyXG5cdFx0XHRcdFx0bmV3QmF0Y2hTZXRJbmRleCA9IHRoaXMuc2V0cy5pbmRleE9mKG5ld0JhdGNoU2V0KTtcclxuXHJcblx0XHRcdFx0XHQvLyBSZW1vdmUgdGhlIG5ldyBiYXRjaCBzZXQgaWYgdGhlIGNhbGxlciBzcGVjaWZpZWQgdGhhdCBpdCBzaG91bGQgYmUgcmVtb3ZlZCBpZiBlbXB0eSBhbmQgdGhlcmUgd2VyZSBubyBjaGFuZ2VzLlxyXG5cdFx0XHRcdFx0aWYgKHJlbW92ZUlmRW1wdHkgJiYgbmV3QmF0Y2hTZXQgPT09IHRoaXMuYWN0aXZlU2V0ICYmIG5ld0JhdGNoU2V0LmNoYW5nZXMubGVuZ3RoID09PSAwKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuc2V0cy5zcGxpY2UobmV3QmF0Y2hTZXRJbmRleCwgMSk7XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBSZXN0b3JlIHRoZSBwcmV2aW91cyBhY3RpdmUgc2V0IHRvIHRoZSBsb2cgaWYgaXQgd2FzIHJlbW92ZWQuXHJcblx0XHRcdFx0XHRcdGlmIChwcmV2aW91c0FjdGl2ZVNldCAmJiBwcmlvclNldCAhPT0gcHJldmlvdXNBY3RpdmVTZXQpIHtcclxuXHRcdFx0XHRcdFx0XHR0aGlzLnNldHMuc3BsaWNlKHByZXZpb3VzQWN0aXZlU2V0SWR4LCAwLCBwcmV2aW91c0FjdGl2ZVNldCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlU2V0ID0gcHJldmlvdXNBY3RpdmVTZXQ7XHJcblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdHRoaXMub25DaGFuZ2VTZXRTdGFydGVkKG5ld0JhdGNoU2V0LCB1c2VQcmlvclNldCA/IHByaW9yU2V0IDogbnVsbCwgbmV3QmF0Y2hTZXRJbmRleCwgdGhpcyk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBJZiB0aGVyZSB3YXMgcHJldmlvdXNseSBhbiBhY3RpdmUgc2V0LCBzdGFydCBhIG5ld1xyXG5cdFx0XHRcdC8vIHNldCBpbiBvcmRlciB0byBjb2xsZWN0IGNoYW5nZXMgdGhhdCBmb2xsb3cgc2VwYXJhdGVseS5cclxuXHRcdFx0XHRpZiAobmV3QWN0aXZlU2V0KSB7XHJcblx0XHRcdFx0XHR2YXIgaWR4ID0gdGhpcy5zZXRzLnB1c2gobmV3QWN0aXZlU2V0KSAtIDE7XHJcblx0XHRcdFx0XHR2YXIgbmV3UHJpb3JTZXQgPSB0aGlzLnNldHNbaWR4IC0gMV07XHJcblx0XHRcdFx0XHR0aGlzLmFjdGl2ZVNldCA9IG5ld0FjdGl2ZVNldDtcclxuXHRcdFx0XHRcdHRoaXMub25DaGFuZ2VTZXRTdGFydGVkKG5ld0FjdGl2ZVNldCwgbmV3UHJpb3JTZXQsIGlkeCwgdGhpcyk7XHJcblx0XHRcdFx0fSBlbHNlIGlmIChwcmV2aW91c0FjdGl2ZVNldCkge1xyXG5cdFx0XHRcdFx0Ly8gVXNlIHRoZSBwcmV2aW91cyB0aXRsZSBhbmQgdXNlciBmb3IgdGhlIG5ldyBzZXQuXHJcblx0XHRcdFx0XHR0aGlzLnN0YXJ0KHsgdGl0bGU6IHByZXZpb3VzQWN0aXZlU2V0LnRpdGxlLCB1c2VyOiBwcmV2aW91c0FjdGl2ZVNldC51c2VyIH0pO1xyXG5cdFx0XHRcdH0gZWxzZSBpZiAodGhpcy5hY3RpdmVTZXQuY2hhbmdlcy5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0XHQvLyBJZiB0aGVyZSB3YXNuJ3QgYW4gYWN0aXZlIHNldCBiZWZvcmUsIHRoZW4gc3RhcnQgYSBuZXcgc2V0XHJcblx0XHRcdFx0XHQvLyB3aXRob3V0IGEgdGl0bGUgb25seSBpZiB0aGVyZSBhcmUgY2hhbmdlcyBpbiB0aGUgYWN0aXZlXHJcblx0XHRcdFx0XHQvLyBzZXQuIFRoaXMgaXMgYSBsYXN0LXJlc29ydCB0byBlbnN1cmUgdGhhdCBmb2xsb3dpbmcgY2hhbmdlc1xyXG5cdFx0XHRcdFx0Ly8gYXJlIG5vdCBpbmNsdWRlZCB3aXRoIHRoZSBjaGFuZ2VzIHRoYXQgd2VyZSBqdXN0IGJhdGNoZWQuXHJcblx0XHRcdFx0XHR0aGlzLnN0YXJ0KFwidW5rbm93blwiKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiBuZXdCYXRjaFNldDtcclxuXHRcdH0sXHJcblx0XHRjaGVja3BvaW50OiBmdW5jdGlvbiAodGl0bGUsIGNvZGUpIHtcclxuXHRcdFx0aWYgKCF0aGlzLmFjdGl2ZVNldCkge1xyXG5cdFx0XHRcdHJldHVybiBudWxsO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZXR1cm4gdGhpcy5hY3RpdmVTZXQuY2hlY2twb2ludCh0aXRsZSwgY29kZSk7XHJcblx0XHR9LFxyXG5cdFx0Y29tcHJlc3M6IGZ1bmN0aW9uICh0YWlsT25seSwgY29uc2lkZXJBZGRpdGlvbmFsSW5mbykge1xyXG5cdFx0XHR2YXIgcmVtb3ZlZCA9IFtdO1xyXG5cclxuXHRcdFx0Zm9yICh2YXIgaSA9IHRoaXMuc2V0cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG5cdFx0XHRcdHZhciBzZXQgPSB0aGlzLnNldHNbaV07XHJcblx0XHRcdFx0aWYgKHNldC5jaGFuZ2VzLmxlbmd0aCA9PT0gMCAmJiAoIWNvbnNpZGVyQWRkaXRpb25hbEluZm8gfHwgKCFzZXQudGl0bGUgJiYgIXNldC51c2VyKSkpIHtcclxuXHRcdFx0XHRcdGlmIChzZXQgPT09IHRoaXMuYWN0aXZlU2V0KSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlU2V0ID0gbnVsbDtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyBSZW1vdmUgdGhlIGl0ZW1cclxuXHRcdFx0XHRcdHZhciBzcGxpY2VkSXRlbXMgPSB0aGlzLnNldHMuc3BsaWNlKGksIDEpO1xyXG5cclxuXHRcdFx0XHRcdC8vIEluc2VydCBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBsaXN0IG9mIHJlbW92ZWQgaXRlbXNcclxuXHRcdFx0XHRcdHZhciBzcGxpY2VBcmdzID0gWzAsIDBdO1xyXG5cdFx0XHRcdFx0QXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkoc3BsaWNlQXJncywgc3BsaWNlZEl0ZW1zKTtcclxuXHRcdFx0XHRcdEFycmF5LnByb3RvdHlwZS5zcGxpY2UuYXBwbHkocmVtb3ZlZCwgc3BsaWNlQXJncyk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRpZiAodGFpbE9ubHkpIHtcclxuXHRcdFx0XHRcdC8vIEV4aXQgZWFybHkgYWZ0ZXIgY2hlY2tpbmcgdGhlIGxhc3RcclxuXHRcdFx0XHRcdC8vIGNoYW5nZSBzZXQgaWYgJ3RhaWxPbmx5JyBpcyBzcGVjaWZpZWQuXHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiByZW1vdmVkO1xyXG5cdFx0fSxcclxuXHRcdGNvdW50OiBmdW5jdGlvbiAoZmlsdGVyLCB0aGlzUHRyKSB7XHJcblx0XHRcdHZhciByZXN1bHQgPSAwO1xyXG5cdFx0XHRmb3JFYWNoKHRoaXMuc2V0cywgZnVuY3Rpb24gKHNldCkge1xyXG5cdFx0XHRcdHJlc3VsdCArPSBzZXQuY291bnQoZmlsdGVyLCB0aGlzUHRyKTtcclxuXHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdHJldHVybiByZXN1bHQ7XHJcblx0XHR9LFxyXG5cdFx0bGFzdENoYW5nZTogZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRmb3IgKHZhciBpID0gdGhpcy5zZXRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcblx0XHRcdFx0dmFyIHNldCA9IHRoaXMuc2V0c1tpXTtcclxuXHRcdFx0XHR2YXIgY2hhbmdlID0gc2V0Lmxhc3RDaGFuZ2UoKTtcclxuXHRcdFx0XHRpZiAoY2hhbmdlICE9PSBudWxsICYmIGNoYW5nZSAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gY2hhbmdlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9LFxyXG5cdFx0c2VyaWFsaXplOiBmdW5jdGlvbiAoZm9yU2VydmVyLCBmaWx0ZXIsIHRoaXNQdHIpIHtcclxuXHRcdFx0Ly8gU2VyaWFsaXplcyB0aGUgbG9nIGFuZCBpdCdzIHNldHMsIGluY2x1ZGluZ1xyXG5cdFx0XHQvLyB0aG9zZSBjaGFuZ2VzIHRoYXQgcGFzcyB0aGUgZ2l2ZW4gZmlsdGVyLlxyXG5cclxuXHRcdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcclxuXHRcdFx0XHRmb3JTZXJ2ZXIgPSB0cnVlO1xyXG5cdFx0XHR9IGVsc2UgaWYgKGZvclNlcnZlciBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcblx0XHRcdFx0dGhpc1B0ciA9IGZpbHRlcjtcclxuXHRcdFx0XHRmaWx0ZXIgPSBmb3JTZXJ2ZXI7XHJcblx0XHRcdFx0Zm9yU2VydmVyID0gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIHRoaXMuc2V0cy5tYXAoZnVuY3Rpb24gKHNldCkge1xyXG5cdFx0XHRcdHJldHVybiBzZXQuc2VyaWFsaXplKGZvclNlcnZlciwgZmlsdGVyLCB0aGlzUHRyKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9LFxyXG5cdFx0c3RhcnQ6IGZ1bmN0aW9uICh0aXRsZU9yT3B0aW9ucywgY29udGludWVMYXN0KSB7XHJcblx0XHRcdC8vIFN0YXJ0cyBhIG5ldyBjaGFuZ2Ugc2V0LCB3aGljaCBtZWFucyB0aGF0IG5ldyBjaGFuZ2VzIHdpbGxcclxuXHRcdFx0Ly8gYmUgYWRkZWQgdG8gdGhlIG5ldyBzZXQgZnJvbSB0aGlzIHBvaW50IGZvcndhcmQuXHJcblx0XHRcdHZhciB0aXRsZSwgdXNlciwgY29kZTtcclxuXHJcblx0XHRcdGlmICh0aXRsZU9yT3B0aW9ucyA9PSBudWxsKSB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXJyb3IoXCJ0aXRsZU9yT3B0aW9uc1wiKTtcclxuXHRcdFx0aWYgKHRpdGxlT3JPcHRpb25zLmNvbnN0cnVjdG9yICE9PSBTdHJpbmcgJiYgISh0aXRsZU9yT3B0aW9ucyBpbnN0YW5jZW9mIE9iamVjdCkpIHRocm93IG5ldyBBcmd1bWVudFR5cGVFcnJvcihcInRpdGxlT3JPcHRpb25zXCIsIFwic3RyaW5nfG9iamVjdFwiLCB0aXRsZU9yT3B0aW9ucyk7XHJcblxyXG5cdFx0XHRpZiAoY29udGludWVMYXN0ICE9IG51bGwgJiYgY29udGludWVMYXN0LmNvbnN0cnVjdG9yICE9PSBCb29sZWFuKSB0aHJvdyBuZXcgQXJndW1lbnRUeXBlRXJyb3IoXCJjb250aW51ZUxhc3RcIiwgXCJib29sZWFuXCIsIGNvbnRpbnVlTGFzdCk7XHJcblxyXG5cdFx0XHRpZiAodGl0bGVPck9wdGlvbnMuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xyXG5cdFx0XHRcdHRpdGxlID0gdGl0bGVPck9wdGlvbnM7XHJcblx0XHRcdFx0dXNlciA9IG51bGw7XHJcblx0XHRcdFx0Y29kZSA9IG51bGw7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0dGl0bGUgPSB0aXRsZU9yT3B0aW9ucy50aXRsZSB8fCBudWxsO1xyXG5cdFx0XHRcdHVzZXIgPSB0aXRsZU9yT3B0aW9ucy51c2VyIHx8IG51bGw7XHJcblx0XHRcdFx0Y29kZSA9IHRpdGxlT3JPcHRpb25zLmNvZGUgfHwgbnVsbDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIHByZXZpb3VzQWN0aXZlU2V0ID0gdGhpcy5hY3RpdmVTZXQ7XHJcblxyXG5cdFx0XHRpZiAoY29udGludWVMYXN0KSB7XHJcblx0XHRcdFx0dmFyIGNhbmRpZGF0ZVNldCA9IHByZXZpb3VzQWN0aXZlU2V0O1xyXG5cdFx0XHRcdGlmICghY2FuZGlkYXRlU2V0ICYmIHRoaXMuc2V0cy5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0XHRjYW5kaWRhdGVTZXQgPSB0aGlzLnNldHNbdGhpcy5zZXRzLmxlbmd0aCAtIDFdO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAoY2FuZGlkYXRlU2V0ICYmIGNhbmRpZGF0ZVNldC5zb3VyY2UgPT09IFwiY2xpZW50XCIgJiYgY2FuZGlkYXRlU2V0LnVzZXIgPT09IHVzZXIgJiYgY2FuZGlkYXRlU2V0LnRpdGxlID09PSB0aXRsZSkge1xyXG5cdFx0XHRcdFx0aWYgKHByZXZpb3VzQWN0aXZlU2V0KSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xyXG5cdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmVTZXQgPSBjYW5kaWRhdGVTZXQ7XHJcblx0XHRcdFx0XHRcdHRoaXMub25DaGFuZ2VTZXRTdGFydGVkKGNhbmRpZGF0ZVNldCwgcHJldmlvdXNBY3RpdmVTZXQsIHRoaXMuc2V0cy5sZW5ndGggLSAxLCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIGNhbmRpZGF0ZVNldDtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciBzZXQgPSBuZXcgQ2hhbmdlU2V0KFwiY2xpZW50XCIsIHRpdGxlLCB1c2VyIHx8IHRoaXMuX2RlZmF1bHRVc2VyLCBudWxsLCBjb2RlKTtcclxuXHRcdFx0dmFyIGlkeCA9IHRoaXMuc2V0cy5wdXNoKHNldCkgLSAxO1xyXG5cdFx0XHR0aGlzLmFjdGl2ZVNldCA9IHNldDtcclxuXHRcdFx0dGhpcy5vbkNoYW5nZVNldFN0YXJ0ZWQoc2V0LCBwcmV2aW91c0FjdGl2ZVNldCwgaWR4LCB0aGlzKTtcclxuXHRcdFx0cmV0dXJuIHNldDtcclxuXHRcdH0sXHJcblx0XHRzdG9wOiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdGlmICghdGhpcy5hY3RpdmVTZXQpIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJUaGUgY2hhbmdlIGxvZyBpcyBub3QgY3VycmVudGx5IGFjdGl2ZS5cIik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMuYWN0aXZlU2V0ID0gbnVsbDtcclxuXHRcdH0sXHJcblx0XHR0cnVuY2F0ZTogZnVuY3Rpb24gKGNoZWNrcG9pbnQsIGZpbHRlciwgdGhpc1B0cikge1xyXG5cdFx0XHQvLyBSZW1vdmVzIGFsbCBjaGFuZ2Ugc2V0cyB3aGVyZSBhbGwgY2hhbmdlcyBtYXRjaCB0aGUgZ2l2ZW5cclxuXHRcdFx0Ly8gZmlsdGVyLiAgSWYgYSBzZXQgY29udGFpbnMgb25lIG9yIG1vcmUgY2hhbmdlcyB0aGF0IGRvIE5PVFxyXG5cdFx0XHQvLyBtYXRjaCwgdGhlIHNldCBpcyBsZWZ0IGludGFjdCB3aXRoIHRob3NlIGNoYW5nZXMuXHJcblxyXG5cdFx0XHQvLyBBbGxvdyBjYWxsaW5nIGFzIGZ1bmN0aW9uKGZpbHRlciwgdGhpc1B0cilcclxuXHRcdFx0aWYgKGNoZWNrcG9pbnQgJiYgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGNoZWNrcG9pbnQpID09PSBcIltvYmplY3QgRnVuY3Rpb25dXCIpIHtcclxuXHRcdFx0XHR0aGlzUHRyID0gZmlsdGVyO1xyXG5cdFx0XHRcdGZpbHRlciA9IGNoZWNrcG9pbnQ7XHJcblx0XHRcdFx0Y2hlY2twb2ludCA9IG51bGw7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciBudW1SZW1vdmVkID0gMDtcclxuXHRcdFx0dmFyIGZvdW5kQ2hlY2twb2ludCA9IGZhbHNlO1xyXG5cclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNldHMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHRpZiAoY2hlY2twb2ludCkge1xyXG5cdFx0XHRcdFx0Zm91bmRDaGVja3BvaW50ID0gdGhpcy5zZXRzW2ldLmNoYW5nZXMuc29tZShmdW5jdGlvbiAoYykge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gYy50eXBlID09PSBcIkNoZWNrcG9pbnRcIiAmJiBjLmNvZGUgPT09IGNoZWNrcG9pbnQ7XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdG51bVJlbW92ZWQgKz0gdGhpcy5zZXRzW2ldLnRydW5jYXRlKGNoZWNrcG9pbnQsIGZpbHRlciwgdGhpc1B0cik7XHJcblxyXG5cdFx0XHRcdC8vIElmIGFsbCBjaGFuZ2VzIGhhdmUgYmVlbiByZW1vdmVkIChvciBhbGwgYnV0IHRoZSBnaXZlbiBjaGVja3BvaW50KSB0aGVuIGRpc2NhcmQgdGhlIHNldFxyXG5cdFx0XHRcdGlmICh0aGlzLnNldHNbaV0uY2hhbmdlcy5sZW5ndGggPT09IDApIHtcclxuXHRcdFx0XHRcdHZhciBjdXJyZW50U2V0ID0gdGhpcy5zZXRzW2ldO1xyXG5cdFx0XHRcdFx0dGhpcy5zZXRzLnNwbGljZShpLS0sIDEpO1xyXG5cdFx0XHRcdFx0aWYgKGN1cnJlbnRTZXQgPT09IHRoaXMuYWN0aXZlU2V0KSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlU2V0ID0gbnVsbDtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGlmIChmb3VuZENoZWNrcG9pbnQpXHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dGhpcy5vblRydW5jYXRlZChudW1SZW1vdmVkLCB0aGlzKTtcclxuXHRcdFx0cmV0dXJuIG51bVJlbW92ZWQ7XHJcblx0XHR9LFxyXG5cdFx0dW5kbzogZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRpZiAoIXRoaXMuYWN0aXZlU2V0KSB7XHJcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiVGhlIGNoYW5nZSBsb2cgaXMgbm90IGN1cnJlbnRseSBhY3RpdmUuXCIpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR2YXIgY3VycmVudFNldCA9IHRoaXMuYWN0aXZlU2V0LFxyXG5cdFx0XHRcdGN1cnJlbnRTZXRJbmRleCA9IHRoaXMuc2V0cy5pbmRleE9mKGN1cnJlbnRTZXQpO1xyXG5cclxuXHRcdFx0d2hpbGUgKGN1cnJlbnRTZXQuY2hhbmdlcy5sZW5ndGggPT09IDApIHtcclxuXHRcdFx0XHQvLyByZW1vdmUgdGhlIHNldCBmcm9tIHRoZSBsb2dcclxuXHRcdFx0XHR0aGlzLnNldHMuc3BsaWNlKGN1cnJlbnRTZXRJbmRleCwgMSk7XHJcblxyXG5cdFx0XHRcdGlmICgtLWN1cnJlbnRTZXRJbmRleCA8IDApIHtcclxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Y3VycmVudFNldCA9IHRoaXMuc2V0c1tjdXJyZW50U2V0SW5kZXhdO1xyXG5cdFx0XHRcdHRoaXMuYWN0aXZlU2V0ID0gY3VycmVudFNldDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIGlkeCA9IGN1cnJlbnRTZXQuY2hhbmdlcy5sZW5ndGggLSAxO1xyXG5cdFx0XHR2YXIgY2hhbmdlID0gY3VycmVudFNldC51bmRvKCk7XHJcblxyXG5cdFx0XHR0aGlzLm9uQ2hhbmdlVW5kb25lKGNoYW5nZSwgaWR4LCBjdXJyZW50U2V0LCB0aGlzKTtcclxuXHJcblx0XHRcdHJldHVybiBjaGFuZ2U7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuTWFwcGVyLlNlcnZlclN5bmNcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHQvKmdsb2JhbHMgd2luZG93LCBzZXRUaW1lb3V0LCBjbGVhclRpbWVvdXQsIGNvbnRleHQgKi9cclxuXHQvKmdsb2JhbHMgRnVuY3RvciwgVHJhbnNsYXRvciwgT2JzZXJ2ZXIsIEFyZ3VtZW50TnVsbEVycm9yLCBBcmd1bWVudFR5cGVFcnJvciAqL1xyXG5cdC8qZ2xvYmFscyBNb2RlbCwgRW50aXR5LCBMYXp5TG9hZGVyLCBPYmplY3RMYXp5TG9hZGVyLCBDaGFuZ2VMb2csIEV4b01vZGVsRXZlbnRMaXN0ZW5lciwgZnJvbUV4b01vZGVsICovXHJcblx0LypnbG9iYWwgc2F2ZVByb3ZpZGVyLCByb3VuZHRyaXBQcm92aWRlciwgZXZlbnRQcm92aWRlciwgb2JqZWN0UHJvdmlkZXIgKi9cclxuXHJcblx0ZnVuY3Rpb24gU2VydmVyU3luYyhtb2RlbCkge1xyXG5cdFx0Ly8gQmFzaWMgYXJndW1lbnQgdmFsaWRhdGlvbi5cclxuXHRcdGlmIChtb2RlbCA9PT0gbnVsbCB8fCBtb2RlbCA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRocm93IG5ldyBBcmd1bWVudE51bGxFcnJvcihcIm1vZGVsXCIpO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHR5cGVvZiAobW9kZWwpICE9PSBcIm9iamVjdFwiIHx8ICEobW9kZWwgaW5zdGFuY2VvZiBNb2RlbCkpIHtcclxuXHRcdFx0dGhyb3cgbmV3IEFyZ3VtZW50VHlwZUVycm9yKFwibW9kZWxcIiwgXCJtb2RlbFwiLCBtb2RlbCk7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gQ3JlYXRlIHRoZSBuZWNlc3NhcnkgbG9jYWwgdmFyaWFibGVzLlxyXG5cdFx0dmFyIGNoYW5nZUxvZyA9IG5ldyBDaGFuZ2VMb2coKSxcclxuXHRcdFx0dHJhbnNsYXRvciA9IG5ldyBUcmFuc2xhdG9yKCksXHJcblx0XHRcdG9iamVjdHNEZWxldGVkID0gW10sXHJcblx0XHRcdGlzT2JqZWN0RGVsZXRlZCA9IGZ1bmN0aW9uIChkZWxldGVkT2JqZWN0c0xpc3QsIG9iaiwgaXNDaGFuZ2UpIHtcclxuXHRcdFx0XHRpZiAoQXJyYXkuY29udGFpbnMoZGVsZXRlZE9iamVjdHNMaXN0LCBvYmopKSB7XHJcblx0XHRcdFx0XHRpZiAoaXNDaGFuZ2UpIHtcclxuXHRcdFx0XHRcdFx0bG9nV2FybmluZygkZm9ybWF0KFwiT2JqZWN0IHswfXx7MX0gd2FzIGNoYW5nZWQgYnV0IGhhcyBiZWVuIGRlbGV0ZWQuXCIsIG9iai5tZXRhLnR5cGUuZ2V0X2Z1bGxOYW1lKCksIG9iai5tZXRhLmlkKSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHR9LFxyXG5cdFx0XHRmaWx0ZXJPYmplY3RFdmVudCA9IGZ1bmN0aW9uIChvYmopIHtcclxuXHRcdFx0XHRyZXR1cm4gIWlzT2JqZWN0RGVsZXRlZChvYmplY3RzRGVsZXRlZCwgb2JqLCBmYWxzZSk7XHJcblx0XHRcdH0sXHJcblx0XHRcdGZpbHRlclByb3BlcnR5RXZlbnQgPSBmdW5jdGlvbiAob2JqKSB7XHJcblx0XHRcdFx0cmV0dXJuICFpc09iamVjdERlbGV0ZWQob2JqZWN0c0RlbGV0ZWQsIG9iaiwgdHJ1ZSk7XHJcblx0XHRcdH0sXHJcblx0XHRcdGxpc3RlbmVyID0gbmV3IEV4b01vZGVsRXZlbnRMaXN0ZW5lcihtb2RlbCwgdHJhbnNsYXRvciwge1xyXG5cdFx0XHRcdGxpc3RDaGFuZ2VkOiBmaWx0ZXJQcm9wZXJ0eUV2ZW50LFxyXG5cdFx0XHRcdHByb3BlcnR5Q2hhbmdlZDogZmlsdGVyUHJvcGVydHlFdmVudCxcclxuXHRcdFx0XHRvYmplY3RSZWdpc3RlcmVkOiBmaWx0ZXJPYmplY3RFdmVudCxcclxuXHRcdFx0XHRvYmplY3RVbnJlZ2lzdGVyZWQ6IGZpbHRlck9iamVjdEV2ZW50XHJcblx0XHRcdH0pLFxyXG5cdFx0XHRhcHBseWluZ0NoYW5nZXMgPSAwLFxyXG5cdFx0XHRpc0NhcHR1cmluZ0NoYW5nZXMgPSBmYWxzZSxcclxuXHRcdFx0c2VsZiA9IHRoaXM7XHJcblxyXG5cdFx0Ly8gV2hlbiB0aGUgZXZlbnQgbGlzdGVuZXIgZGV0ZWN0cyBhIGNoYW5nZSB0aGVuIHBhc3MgaXQgYWxvbmcgdG8gdGhlIGNoYW5nZSBsb2cuXHJcblx0XHRsaXN0ZW5lci5hZGRDaGFuZ2VEZXRlY3RlZChmdW5jdGlvbiAoY2hhbmdlKSB7XHJcblx0XHRcdGlmIChhcHBseWluZ0NoYW5nZXMgPD0gMCAmJiBpc0NhcHR1cmluZ0NoYW5nZXMgPT09IHRydWUpIHtcclxuXHRcdFx0XHRpZiAoY2hhbmdlLnByb3BlcnR5KSB7XHJcblx0XHRcdFx0XHR2YXIgaW5zdGFuY2UgPSBmcm9tRXhvTW9kZWwoY2hhbmdlLmluc3RhbmNlLCB0cmFuc2xhdG9yKTtcclxuXHRcdFx0XHRcdHZhciBwcm9wZXJ0eSA9IGluc3RhbmNlLm1ldGEucHJvcGVydHkoY2hhbmdlLnByb3BlcnR5KTtcclxuXHJcblx0XHRcdFx0XHRpZiAocHJvcGVydHkuZ2V0X2pzdHlwZSgpID09PSBEYXRlICYmIGNoYW5nZS5uZXdWYWx1ZSAmJiBwcm9wZXJ0eS5nZXRfZm9ybWF0KCkgJiYgIWhhc1RpbWVGb3JtYXQudGVzdChwcm9wZXJ0eS5nZXRfZm9ybWF0KCkudG9TdHJpbmcoKSkpIHtcclxuXHRcdFx0XHRcdFx0dmFyIHNlcnZlck9mZnNldCA9IHNlbGYuZ2V0X1NlcnZlclRpbWV6b25lT2Zmc2V0KCk7XHJcblx0XHRcdFx0XHRcdHZhciBsb2NhbE9mZnNldCA9IC0obmV3IERhdGUoKS5nZXRUaW1lem9uZU9mZnNldCgpIC8gNjApO1xyXG5cdFx0XHRcdFx0XHR2YXIgZGlmZmVyZW5jZSA9IGxvY2FsT2Zmc2V0IC0gc2VydmVyT2Zmc2V0O1xyXG5cdFx0XHRcdFx0XHRjaGFuZ2UubmV3VmFsdWUgPSBjaGFuZ2UubmV3VmFsdWUuYWRkSG91cnMoZGlmZmVyZW5jZSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIGlmIChjaGFuZ2UubmV3VmFsdWUgJiYgY2hhbmdlLm5ld1ZhbHVlIGluc3RhbmNlb2YgVGltZVNwYW4pIHtcclxuXHRcdFx0XHRcdFx0Y2hhbmdlLm5ld1ZhbHVlID0gY2hhbmdlLm5ld1ZhbHVlLnRvT2JqZWN0KCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRjaGFuZ2VMb2cuYWRkKGNoYW5nZSk7XHJcblxyXG5cdFx0XHRcdHNlbGYuX3JhaXNlRXZlbnQoXCJjaGFuZ2VzRGV0ZWN0ZWRcIiwgW3NlbGYsIHsgcmVhc29uOiBcImxpc3RlbmVyLmFkZENoYW5nZURldGVjdGVkXCIsIGNoYW5nZXM6IFtjaGFuZ2VdIH1dKTtcclxuXHJcblx0XHRcdFx0Ly8gUmVzdGFydCBhdXRvLXNhdmUgaW50ZXJ2YWwgaWYgbmVjZXNzYXJ5LlxyXG5cdFx0XHRcdGlmIChzZWxmLl9zYXZlSW50ZXJ2YWwgJiYgc2VsZi5jYW5TYXZlKGNoYW5nZSkgJiYgaXNQcm9wZXJ0eUNoYW5nZVBlcnNpc3RlZChjaGFuZ2UpKSB7XHJcblx0XHRcdFx0XHRzZWxmLl9xdWV1ZUF1dG9TYXZlKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHJcblx0XHQvLyBBcHBseWluZyBjaGFuZ2VzIChlLmcuIHZpYSBhIHNlcnZlciByZXNwb25zZSBjaGFuZ2Ugc2V0KS5cclxuXHRcdHRoaXMuaXNBcHBseWluZ0NoYW5nZXMgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHJldHVybiBhcHBseWluZ0NoYW5nZXMgPiAwO1xyXG5cdFx0fTtcclxuXHRcdHRoaXMuYmVnaW5BcHBseWluZ0NoYW5nZXMgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdGFwcGx5aW5nQ2hhbmdlcyArPSAxO1xyXG5cdFx0fTtcclxuXHRcdHRoaXMuZW5kQXBwbHlpbmdDaGFuZ2VzID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRhcHBseWluZ0NoYW5nZXMgLT0gMTtcclxuXHJcblx0XHRcdGlmIChhcHBseWluZ0NoYW5nZXMgPCAwKSB7XHJcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiRXJyb3IgaW4gdHJhbnNhY3Rpb24gbG9nIHByb2Nlc3Npbmc6IHVubWF0Y2hlZCBiZWdpbiBhbmQgZW5kIGFwcGx5aW5nIGNoYW5nZXMuXCIpO1xyXG5cdFx0XHR9XHJcblx0XHR9O1xyXG5cclxuXHRcdC8vIENhcHR1cmluZyBjaGFuZ2VzIChpLmUuIGFmdGVyIGNvbnRleHQgaW5pdGlhbGl6YXRpb24gaGFzIGNvbXBsZXRlZCkuXHJcblx0XHR0aGlzLmlzQ2FwdHVyaW5nQ2hhbmdlcyA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0cmV0dXJuIGlzQ2FwdHVyaW5nQ2hhbmdlcyA9PT0gdHJ1ZTtcclxuXHRcdH07XHJcblx0XHR0aGlzLmJlZ2luQ2FwdHVyaW5nQ2hhbmdlcyA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0aWYgKCFpc0NhcHR1cmluZ0NoYW5nZXMpIHtcclxuXHRcdFx0XHRpc0NhcHR1cmluZ0NoYW5nZXMgPSB0cnVlO1xyXG5cdFx0XHRcdGNoYW5nZUxvZy5zdGFydCh7IHVzZXI6IHRoaXMuX2xvY2FsVXNlciB9KTtcclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHRcdHRoaXMuc3RvcENhcHR1cmluZ0NoYW5nZXMgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdGlmIChpc0NhcHR1cmluZ0NoYW5nZXMpIHtcclxuXHRcdFx0XHRpc0NhcHR1cmluZ0NoYW5nZXMgPSBmYWxzZTtcclxuXHRcdFx0XHRjaGFuZ2VMb2cuc3RvcCgpO1xyXG5cdFx0XHR9XHJcblx0XHR9O1xyXG5cdFx0dGhpcy5pZ25vcmVDaGFuZ2VzID0gZnVuY3Rpb24gKGJlZm9yZSwgY2FsbGJhY2ssIGFmdGVyLCB0aGlzUHRyKSB7XHJcblx0XHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7XHJcblx0XHRcdFx0Y2FsbGJhY2sgPSBhcmd1bWVudHNbMF07XHJcblx0XHRcdFx0YmVmb3JlID0gbnVsbDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHR2YXIgYmVmb3JlQ2FsbGVkID0gZmFsc2U7XHJcblxyXG5cdFx0XHRcdHRyeSB7XHJcblx0XHRcdFx0XHRhcHBseWluZ0NoYW5nZXMgKz0gMTtcclxuXHJcblx0XHRcdFx0XHRpZiAoYmVmb3JlICYmIGJlZm9yZSBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcblx0XHRcdFx0XHRcdGJlZm9yZSgpO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGJlZm9yZUNhbGxlZCA9IHRydWU7XHJcblxyXG5cdFx0XHRcdFx0Y2FsbGJhY2suYXBwbHkodGhpc1B0ciB8fCB0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0XHRcdH0gZmluYWxseSB7XHJcblx0XHRcdFx0XHRhcHBseWluZ0NoYW5nZXMgLT0gMTtcclxuXHJcblx0XHRcdFx0XHRpZiAoYmVmb3JlQ2FsbGVkID09PSB0cnVlICYmIGFmdGVyICYmIGFmdGVyIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuXHRcdFx0XHRcdFx0YWZ0ZXIoKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH07XHJcblx0XHR9O1xyXG5cclxuXHRcdHRoaXMuaXNPYmplY3REZWxldGVkID0gZnVuY3Rpb24gKG9iaiwgaXNDaGFuZ2UpIHtcclxuXHRcdFx0cmV0dXJuIGlzT2JqZWN0RGVsZXRlZChvYmplY3RzRGVsZXRlZCwgb2JqLCBpc0NoYW5nZSk7XHJcblx0XHR9O1xyXG5cclxuXHRcdC8vIElmIGFuIGV4aXN0aW5nIG9iamVjdCBpcyByZWdpc3RlcmVkIHRoZW4gcmVnaXN0ZXIgaXQgZm9yIGxhenkgbG9hZGluZy5cclxuXHRcdG1vZGVsLmFkZE9iamVjdFJlZ2lzdGVyZWQoZnVuY3Rpb24gKG9iaikge1xyXG5cdFx0XHRpZiAoIW9iai5tZXRhLmlzTmV3ICYmIG9iai5tZXRhLnR5cGUuZ2V0X29yaWdpbigpID09PSBcInNlcnZlclwiICYmIGlzQ2FwdHVyaW5nQ2hhbmdlcyA9PT0gdHJ1ZSAmJiAhYXBwbHlpbmdDaGFuZ2VzKSB7XHJcblx0XHRcdFx0T2JqZWN0TGF6eUxvYWRlci5yZWdpc3RlcihvYmopO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHJcblx0XHQvLyBMaW5rIG1vZGVsIGFuZCBzZXJ2ZXIgb2JqZWN0cy5cclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm1vZGVsXCIsIHsgdmFsdWU6IG1vZGVsIH0pO1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG1vZGVsLCBcInNlcnZlclwiLCB7IHZhbHVlOiB0aGlzIH0pO1xyXG5cclxuXHRcdC8vIEFzc2lnbiBiYWNraW5nIGZpZWxkcyBhcyBuZWVkZWRcclxuXHRcdHRoaXMuX2NoYW5nZUxvZyA9IGNoYW5nZUxvZztcclxuXHRcdHRoaXMuX3Njb3BlUXVlcmllcyA9IFtdO1xyXG5cdFx0dGhpcy5fb2JqZWN0c0V4Y2x1ZGVkRnJvbVNhdmUgPSBbXTtcclxuXHRcdHRoaXMuX29iamVjdHNEZWxldGVkID0gb2JqZWN0c0RlbGV0ZWQ7XHJcblx0XHR0aGlzLl90cmFuc2xhdG9yID0gdHJhbnNsYXRvcjtcclxuXHRcdHRoaXMuX3NlcnZlckluZm8gPSBudWxsO1xyXG5cdFx0dGhpcy5fbG9jYWxVc2VyID0gbnVsbDtcclxuXHJcblx0XHRPYnNlcnZlci5tYWtlT2JzZXJ2YWJsZSh0aGlzKTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGlzUHJvcGVydHlDaGFuZ2VQZXJzaXN0ZWQoY2hhbmdlKSB7XHJcblx0XHRpZiAoY2hhbmdlLnByb3BlcnR5KSB7XHJcblx0XHRcdHZhciBqc3R5cGUgPSBNb2RlbC5nZXRKc1R5cGUoY2hhbmdlLmluc3RhbmNlLnR5cGUsIHRydWUpO1xyXG5cdFx0XHRpZiAoanN0eXBlKSB7XHJcblx0XHRcdFx0dmFyIHByb3AgPSBqc3R5cGUubWV0YS5wcm9wZXJ0eShjaGFuZ2UucHJvcGVydHkpO1xyXG5cdFx0XHRcdC8vIENhbid0IHNhdmUgbm9uLXBlcnNpc3RlZCBwcm9wZXJ0aWVzXHJcblx0XHRcdFx0aWYgKCFwcm9wLmdldF9pc1BlcnNpc3RlZCgpKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdHJ1ZTtcclxuXHR9XHJcblxyXG5cdFNlcnZlclN5bmMubWl4aW4oRnVuY3Rvci5ldmVudGluZyk7XHJcblxyXG5cdHZhciBwZW5kaW5nUmVxdWVzdHMgPSAwO1xyXG5cclxuXHRyZWdpc3RlckFjdGl2aXR5KFwiU2VydmVyU3luYzogcmVxdWVzdFwiLCBmdW5jdGlvbigpIHtcclxuXHRcdHJldHVybiBwZW5kaW5nUmVxdWVzdHMgPiAwO1xyXG5cdH0pO1xyXG5cclxuXHRmdW5jdGlvbiBzZXJpYWxpemVDaGFuZ2VzKGluY2x1ZGVBbGxDaGFuZ2VzLCBzaW11bGF0ZUluaXRSb290KSB7XHJcblx0XHR2YXIgY2hhbmdlcyA9IHRoaXMuX2NoYW5nZUxvZy5zZXJpYWxpemUoaW5jbHVkZUFsbENoYW5nZXMgPyB0aGlzLmNhblNlbmQgOiB0aGlzLmNhblNhdmUsIHRoaXMpO1xyXG5cclxuXHRcdC8vIHRlbXBvcmFyeSBIQUNLIChubywgcmVhbGx5KTogc3BsaWNlIEluaXROZXcgY2hhbmdlcyBpbnRvIGluaXQgdHJhbnNhY3Rpb25cclxuXHRcdGlmIChzaW11bGF0ZUluaXRSb290ICYmIHNpbXVsYXRlSW5pdFJvb3QubWV0YS5pc05ldykge1xyXG5cdFx0XHRmdW5jdGlvbiBpc1Jvb3RJbml0Q2hhbmdlKGNoYW5nZSkge1xyXG5cdFx0XHRcdHJldHVybiBjaGFuZ2UudHlwZSA9PT0gXCJJbml0TmV3XCIgJiYgY2hhbmdlLmluc3RhbmNlLnR5cGUgPT09IHNpbXVsYXRlSW5pdFJvb3QubWV0YS50eXBlLmdldF9mdWxsTmFtZSgpICYmXHJcblx0XHRcdFx0XHQoY2hhbmdlLmluc3RhbmNlLmlkID09PSBzaW11bGF0ZUluaXRSb290Lm1ldGEuaWQgfHwgdGhpcy5fdHJhbnNsYXRvci5yZXZlcnNlKGNoYW5nZS5pbnN0YW5jZS50eXBlLCBjaGFuZ2UuaW5zdGFuY2UuaWQpID09PSBzaW11bGF0ZUluaXRSb290Lm1ldGEuaWQpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR2YXIgZm91bmQgPSBmYWxzZTtcclxuXHRcdFx0dmFyIGluaXRTZXQgPSBjaGFuZ2VzLmZpbHRlcihmdW5jdGlvbihzZXQpIHsgcmV0dXJuIHNldC5zb3VyY2UgPT09IFwiaW5pdFwiOyB9KVswXTtcclxuXHRcdFx0aWYgKCFpbml0U2V0IHx8ICFpbml0U2V0LmNoYW5nZXMuc29tZShpc1Jvb3RJbml0Q2hhbmdlLCB0aGlzKSkge1xyXG5cdFx0XHRcdGNoYW5nZXMuZm9yRWFjaChmdW5jdGlvbihzZXQpIHtcclxuXHRcdFx0XHRcdGlmIChmb3VuZCA9PT0gdHJ1ZSkgcmV0dXJuO1xyXG5cdFx0XHRcdFx0c2V0LmNoYW5nZXMuZm9yRWFjaChmdW5jdGlvbihjaGFuZ2UsIGluZGV4KSB7XHJcblx0XHRcdFx0XHRcdGlmIChmb3VuZCA9PT0gdHJ1ZSkgcmV0dXJuO1xyXG5cdFx0XHRcdFx0XHRlbHNlIGlmIChpc1Jvb3RJbml0Q2hhbmdlLmNhbGwodGhpcywgY2hhbmdlKSkge1xyXG5cdFx0XHRcdFx0XHRcdHNldC5jaGFuZ2VzLnNwbGljZShpbmRleCwgMSk7XHJcblx0XHRcdFx0XHRcdFx0aWYgKCFpbml0U2V0KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRpbml0U2V0ID0geyBjaGFuZ2VzOiBbY2hhbmdlXSwgc291cmNlOiBcImluaXRcIiB9O1xyXG5cdFx0XHRcdFx0XHRcdFx0Y2hhbmdlcy5zcGxpY2UoMCwgMCwgaW5pdFNldCk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0aW5pdFNldC5jaGFuZ2VzLnB1c2goY2hhbmdlKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0Zm91bmQgPSB0cnVlO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBjaGFuZ2VzO1xyXG5cdH1cclxuXHJcblx0Ly8gd2hlbiBTZXJ2ZXJTeW5jIGlzIG1hZGUgc2luZ2xldG9uLCB0aGlzIGRhdGEgd2lsbCBiZSByZWZlcmVuY2VkIHZpYSBjbG9zdXJlXHJcblx0ZnVuY3Rpb24gU2VydmVyU3luYyRhZGRTY29wZVF1ZXJ5KHF1ZXJ5KSB7XHJcblx0XHR0aGlzLl9zY29wZVF1ZXJpZXMucHVzaChxdWVyeSk7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBTZXJ2ZXJTeW5jJHN0b3JlSW5pdENoYW5nZXMoY2hhbmdlcykge1xyXG5cdFx0dmFyIGFjdGl2ZVNldCA9IHRoaXMuX2NoYW5nZUxvZy5hY3RpdmVTZXQ7XHJcblxyXG5cdFx0dGhpcy5fY2hhbmdlTG9nLmFkZFNldChcImluaXRcIiwgbnVsbCwgbnVsbCwgY2hhbmdlcyk7XHJcblxyXG5cdFx0aWYgKGFjdGl2ZVNldCkge1xyXG5cdFx0XHR0aGlzLl9jaGFuZ2VMb2cuc3RhcnQoeyB0aXRsZTogYWN0aXZlU2V0LnRpdGxlLCB1c2VyOiBhY3RpdmVTZXQudXNlciB9KTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIFNlcnZlclN5bmMkcmV0cm9hY3RpdmVseUZpeENoYW5nZVdoZXJlSWRDaGFuZ2VkKGNoYW5nZUluc3RhbmNlLCBvYmopIHtcclxuXHRcdC8vIFVwZGF0ZSBjaGFuZ2UgdG8gcmVmbGVjdCB0aGUgb2JqZWN0J3MgbmV3IGlkIGlmIGl0IGlzIHJlZmVyZW5jaW5nIGEgbGVnYWN5IGlkXHJcblx0XHRpZiAoY2hhbmdlSW5zdGFuY2UuaWQgPT09IG9iai5tZXRhLmxlZ2FjeUlkKSB7XHJcblx0XHRcdGNoYW5nZUluc3RhbmNlLmlkID0gb2JqLm1ldGEuaWQ7XHJcblx0XHRcdGNoYW5nZUluc3RhbmNlLmlzTmV3ID0gZmFsc2U7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRTZXJ2ZXJTeW5jLm1peGluKHtcclxuXHRcdC8vIEVuYWJsZS9kaXNhYmxlIHNhdmUgJiByZWxhdGVkIGZ1bmN0aW9uc1xyXG5cdFx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHRcdGVuYWJsZVNhdmU6IGZ1bmN0aW9uIFNlcnZlclN5bmMkZW5hYmxlU2F2ZShvYmopIHtcclxuXHRcdFx0aWYgKCEob2JqIGluc3RhbmNlb2YgRW50aXR5KSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIkNhbiBvbmx5IGVuYWJsZVNhdmUgb24gZW50aXR5IG9iamVjdHMuXCIpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoQXJyYXkuY29udGFpbnModGhpcy5fb2JqZWN0c0V4Y2x1ZGVkRnJvbVNhdmUsIG9iaikpIHtcclxuXHRcdFx0XHR2YXIgb2xkUGVuZGluZ0NoYW5nZXM7XHJcblx0XHRcdFx0aWYgKHRoaXMuX3NhdmVSb290KSB7XHJcblx0XHRcdFx0XHQvLyBJZiBhdXRvc2F2ZSBpcyBlbmFibGVkIHRoZW4gZGV0ZXJtaW5lIGlmIHdlIG5lZWQgdG8gcXVldWUgYSB0aW1lb3V0XHJcblx0XHRcdFx0XHRvbGRQZW5kaW5nQ2hhbmdlcyA9IHRoaXMuY2hhbmdlcyhmYWxzZSwgdGhpcy5fc2F2ZVJvb3QsIHRydWUpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRBcnJheS5yZW1vdmUodGhpcy5fb2JqZWN0c0V4Y2x1ZGVkRnJvbVNhdmUsIG9iaik7XHJcblxyXG5cdFx0XHRcdHRoaXMuX3JhaXNlRXZlbnQoXCJjaGFuZ2VzRGV0ZWN0ZWRcIiwgW3RoaXMsIHsgcmVhc29uOiBcImVuYWJsZVNhdmVcIiB9XSk7XHJcblxyXG5cdFx0XHRcdC8vIERldGVybWluZSBpZiB0aGVyIGFyZSBub3cgcGVuZGluZyBjaGFuZ2VzXHJcblx0XHRcdFx0aWYgKG9sZFBlbmRpbmdDaGFuZ2VzICYmIG9sZFBlbmRpbmdDaGFuZ2VzLmxlbmd0aCA9PT0gMCAmJiB0aGlzLl9zYXZlSW50ZXJ2YWwgJiYgIXRoaXMuX3NhdmVUaW1lb3V0KSB7XHJcblx0XHRcdFx0XHRpZiAodGhpcy5jaGFuZ2VzKGZhbHNlLCB0aGlzLl9zYXZlUm9vdCwgdHJ1ZSkubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLl9xdWV1ZUF1dG9TYXZlKCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0ZGlzYWJsZVNhdmU6IGZ1bmN0aW9uIFNlcnZlclN5bmMkZGlzYWJsZVNhdmUob2JqKSB7XHJcblx0XHRcdGlmICghKG9iaiBpbnN0YW5jZW9mIEVudGl0eSkpIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJDYW4gb25seSBkaXNhYmxlU2F2ZSBvbiBlbnRpdHkgb2JqZWN0cy5cIik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICghQXJyYXkuY29udGFpbnModGhpcy5fb2JqZWN0c0V4Y2x1ZGVkRnJvbVNhdmUsIG9iaikpIHtcclxuXHRcdFx0XHR2YXIgb2xkUGVuZGluZ0NoYW5nZXM7XHJcblx0XHRcdFx0aWYgKHRoaXMuX3NhdmVSb290KSB7XHJcblx0XHRcdFx0XHQvLyBJZiBhdXRvc2F2ZSBpcyBlbmFibGVkIHRoZW4gZGV0ZXJtaW5lIGlmIHdlIG5lZWQgdG8gcXVldWUgYSB0aW1lb3V0XHJcblx0XHRcdFx0XHRvbGRQZW5kaW5nQ2hhbmdlcyA9IHRoaXMuY2hhbmdlcyhmYWxzZSwgdGhpcy5fc2F2ZVJvb3QsIHRydWUpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHR0aGlzLl9vYmplY3RzRXhjbHVkZWRGcm9tU2F2ZS5wdXNoKG9iaik7XHJcblxyXG5cdFx0XHRcdHRoaXMuX3JhaXNlRXZlbnQoXCJjaGFuZ2VzRGV0ZWN0ZWRcIiwgW3RoaXMsIHsgcmVhc29uOiBcImRpc2FibGVTYXZlXCIgfV0pO1xyXG5cclxuXHRcdFx0XHQvLyBEZXRlcm1pbmUgaWYgdGhlciBhcmUgbm8gbG9uZ2VyIHBlbmRpbmcgY2hhbmdlc1xyXG5cdFx0XHRcdGlmIChvbGRQZW5kaW5nQ2hhbmdlcyAmJiBvbGRQZW5kaW5nQ2hhbmdlcy5sZW5ndGggPiAwICYmIHRoaXMuX3NhdmVJbnRlcnZhbCAmJiB0aGlzLl9zYXZlVGltZW91dCkge1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMuY2hhbmdlcyhmYWxzZSwgdGhpcy5fc2F2ZVJvb3QsIHRydWUpLmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0XHRcdFx0XHR3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMuX3NhdmVUaW1lb3V0KTtcclxuXHRcdFx0XHRcdFx0dGhpcy5fc2F2ZVRpbWVvdXQgPSBudWxsO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdG5vdGlmeURlbGV0ZWQ6IGZ1bmN0aW9uIFNlcnZlclN5bmMkbm90aWZ5RGVsZXRlZChvYmopIHtcclxuXHRcdFx0aWYgKCEob2JqIGluc3RhbmNlb2YgRW50aXR5KSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIk5vdGlmaWVkIG9mIGRlbGV0ZWQgb2JqZWN0IHRoYXQgaXMgbm90IGFuIGVudGl0eS5cIik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICghQXJyYXkuY29udGFpbnModGhpcy5fb2JqZWN0c0RlbGV0ZWQsIG9iaikpIHtcclxuXHRcdFx0XHR0aGlzLl9vYmplY3RzRGVsZXRlZC5wdXNoKG9iaik7XHJcblx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdH0sXHJcblx0XHRjYW5TZW5kOiBmdW5jdGlvbiAoY2hhbmdlKSB7XHJcblxyXG5cdFx0XHQvLyBDaGVja3BvaW50IGlzIGEgY2xpZW50LW9ubHkgZXZlbnQgdHlwZS5cclxuXHRcdFx0aWYgKGNoYW5nZS50eXBlID09PSBcIkNoZWNrcG9pbnRcIikge1xyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKGNoYW5nZS5pbnN0YW5jZSkge1xyXG5cdFx0XHRcdHZhciB0eXBlID0gTW9kZWwuZ2V0SnNUeXBlKGNoYW5nZS5pbnN0YW5jZS50eXBlLCB0cnVlKTtcclxuXHRcdFx0XHRpZiAodHlwZSAmJiBMYXp5TG9hZGVyLmlzTG9hZGVkKHR5cGUubWV0YSkpIHtcclxuXHRcdFx0XHRcdGlmICh0eXBlLm1ldGEuZ2V0X29yaWdpbigpICE9PSBcInNlcnZlclwiKSB7XHJcblx0XHRcdFx0XHRcdC8vIERvbid0IHNlbmQgY2hhbmdlIGV2ZW50cyBmb3IgdHlwZXMgdGhhdCBkaWRuJ3Qgb3JpZ2luYXRlIGZyb20gdGhlIHNlcnZlci5cclxuXHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGlmIChjaGFuZ2UucHJvcGVydHkpIHtcclxuXHRcdFx0XHRcdFx0dmFyIHByb3BlcnR5ID0gdHlwZS5tZXRhLnByb3BlcnR5KGNoYW5nZS5wcm9wZXJ0eSk7XHJcblx0XHRcdFx0XHRcdC8vIERvbid0IHNlbmQgcHJvcGVydHkgY2hhbmdlIGV2ZW50cyBmb3IgcHJvcGVydGllcyB0aGF0IGRpZG4ndCBvcmlnaW5hdGUgZnJvbSB0aGUgc2VydmVyLCBvciBzdGF0aWMgcHJvcGVydGllcy5cclxuXHRcdFx0XHRcdFx0aWYgKHByb3BlcnR5LmdldF9vcmlnaW4oKSAhPT0gXCJzZXJ2ZXJcIiB8fCBwcm9wZXJ0eS5nZXRfaXNTdGF0aWMoKSkge1xyXG5cdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdC8vIERvbid0IHNlbmQgY2hhbmdlcyBmb3IgZGVsZXRlZCBvYmplY3RzLlxyXG5cdFx0XHRcdFx0dmFyIG9iaiA9IGZyb21FeG9Nb2RlbChjaGFuZ2UuaW5zdGFuY2UsIHRoaXMuX3RyYW5zbGF0b3IsIGZhbHNlLCB0aGlzLl9vYmplY3RzRGVsZXRlZCk7XHJcblx0XHRcdFx0XHRpZiAob2JqICYmIHRoaXMuaXNPYmplY3REZWxldGVkKG9iaiwgZmFsc2UpKSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIEV2ZW50IGlzIG9rIHRvIHNlbmQuXHJcblx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0fSxcclxuXHRcdGNhblNhdmVPYmplY3Q6IGZ1bmN0aW9uIFNlcnZlclN5bmMkY2FuU2F2ZU9iamVjdChvYmpPck1ldGEpIHtcclxuXHRcdFx0dmFyIG9iajtcclxuXHRcdFx0dmFyIGVycm9yRm10ID0gXCJVbmFibGUgdG8gdGVzdCB3aGV0aGVyIG9iamVjdCBjYW4gYmUgc2F2ZWQ6ICB7MH0uXCI7XHJcblxyXG5cdFx0XHRpZiAob2JqT3JNZXRhID09IG51bGwpIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgQXJndW1lbnROdWxsRXJyb3IoXCJvYmpPck1ldGFcIik7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAob2JqT3JNZXRhIGluc3RhbmNlb2YgRXhvV2ViLk1vZGVsLk9iamVjdE1ldGEpIHtcclxuXHRcdFx0XHRvYmogPSBvYmpPck1ldGEuX29iajtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmIChvYmpPck1ldGEgaW5zdGFuY2VvZiBFbnRpdHkpIHtcclxuXHRcdFx0XHRvYmogPSBvYmpPck1ldGE7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhyb3cgbmV3IEFyZ3VtZW50VHlwZUVycm9yKFwib2JqT3JNZXRhXCIsIFwiT2JqZWN0TWV0YXxFbnRpdHlcIiwgb2JqT3JNZXRhKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuICFBcnJheS5jb250YWlucyh0aGlzLl9vYmplY3RzRXhjbHVkZWRGcm9tU2F2ZSwgb2JqKSAmJiAhQXJyYXkuY29udGFpbnModGhpcy5fb2JqZWN0c0RlbGV0ZWQsIG9iaik7XHJcblx0XHR9LFxyXG5cdFx0Y2FuU2F2ZTogZnVuY3Rpb24gU2VydmVyU3luYyRjYW5TYXZlKGNoYW5nZSkge1xyXG5cclxuXHRcdFx0Ly8gQ2FuJ3Qgc2F2ZSBjaGFuZ2VzIHRoYXQgY2FuJ3QgYmUgc2VudCB0byB0aGUgc2VydmVyIGF0IGFsbC5cclxuXHRcdFx0aWYgKCF0aGlzLmNhblNlbmQoY2hhbmdlKSkgcmV0dXJuIGZhbHNlO1xyXG5cclxuXHRcdFx0Ly8gRm9yIGxpc3QgY2hhbmdlcyBhZGRpdGlvbmFsbHkgY2hlY2sgYWRkZWQgYW5kIHJlbW92ZWQgb2JqZWN0cy5cclxuXHRcdFx0aWYgKGNoYW5nZS50eXBlID09PSBcIkxpc3RDaGFuZ2VcIikge1xyXG5cdFx0XHRcdGlmIChjaGFuZ2UuYWRkZWQubGVuZ3RoID4gMCB8fCBjaGFuZ2UucmVtb3ZlZC5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0XHR2YXIgaWdub3JlID0gdHJ1ZTtcclxuXHJcblx0XHRcdFx0XHQvLyBTZWFyY2ggYWRkZWQgYW5kIHJlbW92ZWQgZm9yIGFuIG9iamVjdCB0aGF0IGNhbiBiZSBzYXZlZC5cclxuXHRcdFx0XHRcdEFycmF5LmZvckVhY2goY2hhbmdlLmFkZGVkLCBmdW5jdGlvbiAoaXRlbSkge1xyXG5cdFx0XHRcdFx0XHQvLyBpZiB0aGUgdHlwZSBkb2Vzbid0IGV4aXN0IHRoZW4gb2J2aW91c2x5IHRoZSBpbnN0YW5jZSBkb2Vzbid0IGVpdGhlclxyXG5cdFx0XHRcdFx0XHRpZiAoIWl0ZW0udHlwZSB8fCAhRXhvV2ViLk1vZGVsLk1vZGVsLmdldEpzVHlwZShpdGVtLnR5cGUsIHRydWUpKSB7XHJcblx0XHRcdFx0XHRcdFx0aWdub3JlID0gZmFsc2U7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0dmFyIG9iaiA9IGZyb21FeG9Nb2RlbChpdGVtLCB0aGlzLl90cmFuc2xhdG9yLCBmYWxzZSwgdGhpcy5fb2JqZWN0c0RlbGV0ZWQpO1xyXG5cdFx0XHRcdFx0XHRcdC8vIE9ubHkgb2JqZWN0cyB0aGF0IGV4aXN0IGNhbiBiZSBkaXNhYmxlZFxyXG5cdFx0XHRcdFx0XHRcdGlmICghb2JqIHx8IHRoaXMuY2FuU2F2ZU9iamVjdChvYmopKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRpZ25vcmUgPSBmYWxzZTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHRcdFx0QXJyYXkuZm9yRWFjaChjaGFuZ2UucmVtb3ZlZCwgZnVuY3Rpb24gKGl0ZW0pIHtcclxuXHRcdFx0XHRcdFx0Ly8gaWYgdGhlIHR5cGUgZG9lc24ndCBleGlzdCB0aGVuIG9idmlvdXNseSB0aGUgaW5zdGFuY2UgZG9lc24ndCBlaXRoZXJcclxuXHRcdFx0XHRcdFx0aWYgKCFpdGVtLnR5cGUgfHwgIUV4b1dlYi5Nb2RlbC5Nb2RlbC5nZXRKc1R5cGUoaXRlbS50eXBlLCB0cnVlKSkge1xyXG5cdFx0XHRcdFx0XHRcdGlnbm9yZSA9IGZhbHNlO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdHZhciBvYmogPSBmcm9tRXhvTW9kZWwoaXRlbSwgdGhpcy5fdHJhbnNsYXRvciwgZmFsc2UsIHRoaXMuX29iamVjdHNEZWxldGVkKTtcclxuXHRcdFx0XHRcdFx0XHRpZiAoIW9iaiB8fCB0aGlzLmNhblNhdmVPYmplY3Qob2JqKSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0aWdub3JlID0gZmFsc2U7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHJcblx0XHRcdFx0XHQvLyBJZiBubyBcInNhdmFibGVcIiBvYmplY3Qgd2FzIGZvdW5kIGluIGFkZGVkIG9yIFxyXG5cdFx0XHRcdFx0Ly8gcmVtb3ZlZCB0aGVuIHRoaXMgY2hhbmdlIGNhbm5vdCBiZSBzYXZlZC5cclxuXHRcdFx0XHRcdGlmIChpZ25vcmUpIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHQvLyBGb3IgcmVmZXJlbmNlIGNoYW5nZXMgYWRkaXRpb25hbGx5IGNoZWNrIG9sZFZhbHVlL25ld1ZhbHVlXHJcblx0XHRcdGVsc2UgaWYgKGNoYW5nZS50eXBlID09PSBcIlJlZmVyZW5jZUNoYW5nZVwiKSB7XHJcblx0XHRcdFx0dmFyIG9sZEpzVHlwZSA9IGNoYW5nZS5vbGRWYWx1ZSAmJiBFeG9XZWIuTW9kZWwuTW9kZWwuZ2V0SnNUeXBlKGNoYW5nZS5vbGRWYWx1ZS50eXBlLCB0cnVlKTtcclxuXHRcdFx0XHRpZiAob2xkSnNUeXBlKSB7XHJcblx0XHRcdFx0XHR2YXIgb2xkVmFsdWUgPSBmcm9tRXhvTW9kZWwoY2hhbmdlLm9sZFZhbHVlLCB0aGlzLl90cmFuc2xhdG9yLCBmYWxzZSwgdGhpcy5fb2JqZWN0c0RlbGV0ZWQpO1xyXG5cdFx0XHRcdFx0aWYgKG9sZFZhbHVlICYmICF0aGlzLmNhblNhdmVPYmplY3Qob2xkVmFsdWUpKSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHZhciBuZXdKc1R5cGUgPSBjaGFuZ2UubmV3VmFsdWUgJiYgRXhvV2ViLk1vZGVsLk1vZGVsLmdldEpzVHlwZShjaGFuZ2UubmV3VmFsdWUudHlwZSwgdHJ1ZSk7XHJcblx0XHRcdFx0aWYgKG5ld0pzVHlwZSkge1xyXG5cdFx0XHRcdFx0dmFyIG5ld1ZhbHVlID0gZnJvbUV4b01vZGVsKGNoYW5nZS5uZXdWYWx1ZSwgdGhpcy5fdHJhbnNsYXRvciwgZmFsc2UsIHRoaXMuX29iamVjdHNEZWxldGVkKTtcclxuXHRcdFx0XHRcdGlmIChuZXdWYWx1ZSAmJiAhdGhpcy5jYW5TYXZlT2JqZWN0KG5ld1ZhbHVlKSkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBpZiB0aGUgdHlwZSBkb2Vzbid0IGV4aXN0IHRoZW4gb2J2aW91c2x5IHRoZSBpbnN0YW5jZSBkb2Vzbid0IGVpdGhlclxyXG5cdFx0XHR2YXIganN0eXBlID0gRXhvV2ViLk1vZGVsLk1vZGVsLmdldEpzVHlwZShjaGFuZ2UuaW5zdGFuY2UudHlwZSwgdHJ1ZSk7XHJcblx0XHRcdGlmICghanN0eXBlKSB7XHJcblx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIEVuc3VyZSB0aGF0IHRoZSBpbnN0YW5jZSB0aGF0IHRoZSBjaGFuZ2UgcGVydGFpbnMgdG8gY2FuIGJlIHNhdmVkLlxyXG5cdFx0XHR2YXIgaW5zdGFuY2VPYmogPSBmcm9tRXhvTW9kZWwoY2hhbmdlLmluc3RhbmNlLCB0aGlzLl90cmFuc2xhdG9yLCBmYWxzZSwgdGhpcy5fb2JqZWN0c0RlbGV0ZWQpO1xyXG5cdFx0XHRyZXR1cm4gIWluc3RhbmNlT2JqIHx8IHRoaXMuY2FuU2F2ZU9iamVjdChpbnN0YW5jZU9iaik7XHJcblx0XHR9LFxyXG5cclxuXHRcdF9oYW5kbGVSZXN1bHQ6IGZ1bmN0aW9uIFNlcnZlclN5bmMkX2hhbmRsZVJlc3VsdChyZXN1bHQsIGRlc2NyaXB0aW9uLCBjaGVja3BvaW50LCBjYWxsYmFja09yT3B0aW9ucykge1xyXG5cdFx0XHR2YXIgY2FsbGJhY2ssIGJlZm9yZUFwcGx5ID0gbnVsbCwgYWZ0ZXJBcHBseSA9IG51bGw7XHJcblxyXG5cdFx0XHRpZiAoY2FsbGJhY2tPck9wdGlvbnMgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG5cdFx0XHRcdGNhbGxiYWNrID0gY2FsbGJhY2tPck9wdGlvbnM7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0Y2FsbGJhY2sgPSBjYWxsYmFja09yT3B0aW9ucy5jYWxsYmFjaztcclxuXHRcdFx0XHRiZWZvcmVBcHBseSA9IGNhbGxiYWNrT3JPcHRpb25zLmJlZm9yZUFwcGx5O1xyXG5cdFx0XHRcdGFmdGVyQXBwbHkgPSBjYWxsYmFja09yT3B0aW9ucy5hZnRlckFwcGx5O1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRSZXNwb25zZUhhbmRsZXIuZXhlY3V0ZSh0aGlzLm1vZGVsLCB0aGlzLCB7XHJcblx0XHRcdFx0aW5zdGFuY2VzOiByZXN1bHQuaW5zdGFuY2VzLFxyXG5cdFx0XHRcdGNvbmRpdGlvbnM6IHJlc3VsdC5jb25kaXRpb25zLFxyXG5cdFx0XHRcdHR5cGVzOiByZXN1bHQudHlwZXMgJiYgcmVzdWx0LnR5cGVzIGluc3RhbmNlb2YgQXJyYXkgPyBudWxsIDogcmVzdWx0LnR5cGVzLFxyXG5cdFx0XHRcdGNoYW5nZXM6IHJlc3VsdC5jaGFuZ2VzLFxyXG5cdFx0XHRcdHNvdXJjZTogXCJzZXJ2ZXJcIixcclxuXHRcdFx0XHRkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24sXHJcblx0XHRcdFx0Y2hlY2twb2ludDogY2hlY2twb2ludCxcclxuXHRcdFx0XHRzZXJ2ZXJJbmZvOiByZXN1bHQuc2VydmVySW5mbyxcclxuXHRcdFx0XHRiZWZvcmVBcHBseTogYmVmb3JlQXBwbHksXHJcblx0XHRcdFx0YWZ0ZXJBcHBseTogYWZ0ZXJBcHBseVxyXG5cdFx0XHR9LCBjYWxsYmFjaywgdGhpcyk7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIEdlbmVyYWwgZXZlbnRzIG1ldGhvZHNcclxuXHRcdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0XHRhZGRSZXF1ZXN0QmVnaW46IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX2FkZEV2ZW50KFwicmVxdWVzdEJlZ2luXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHRcdHJlbW92ZVJlcXVlc3RCZWdpbjogZnVuY3Rpb24gKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fcmVtb3ZlRXZlbnQoXCJyZXF1ZXN0QmVnaW5cIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0YWRkUmVxdWVzdEVuZDogZnVuY3Rpb24gKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fYWRkRXZlbnQoXCJyZXF1ZXN0RW5kXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHRcdHJlbW92ZVJlcXVlc3RFbmQ6IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUV2ZW50KFwicmVxdWVzdEVuZFwiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRhZGRSZXF1ZXN0U3VjY2VzczogZnVuY3Rpb24gKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fYWRkRXZlbnQoXCJyZXF1ZXN0U3VjY2Vzc1wiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRyZW1vdmVSZXF1ZXN0U3VjY2VzczogZnVuY3Rpb24gKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fcmVtb3ZlRXZlbnQoXCJyZXF1ZXN0U3VjY2Vzc1wiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRhZGRSZXF1ZXN0RmFpbGVkOiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9hZGRFdmVudChcInJlcXVlc3RGYWlsZWRcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0cmVtb3ZlUmVxdWVzdEZhaWxlZDogZnVuY3Rpb24gKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fcmVtb3ZlRXZlbnQoXCJyZXF1ZXN0RmFpbGVkXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHJcblx0XHQvLyBSYWlzZSBTZXJ2ZXIgRXZlbnRcclxuXHRcdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0XHRyYWlzZVNlcnZlckV2ZW50OiBmdW5jdGlvbiBTZXJ2ZXJTeW5jJHJhaXNlU2VydmVyRXZlbnQobmFtZSwgdGFyZ2V0LCBldmVudCwgaW5jbHVkZUFsbENoYW5nZXMsIHN1Y2Nlc3MsIGZhaWxlZCwgcGF0aHMpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI0V4b1dlYi5NYXBwZXIuU2VydmVyU3luYy5zYXZlXCI+XHJcblx0XHRcdC8vLyBSYWlzZSBhIHNlcnZlciBldmVudCBvbiB0aGUgZ2l2ZW4gdGFyZ2V0LiBUaGUgZ2l2ZW4gc3VjY2VzcyBvciBmYWlsdXJlIGNhbGxiYWNrIGlzIGludm9rZWRcclxuXHRcdFx0Ly8vIHdoZW4gdGhlIHJlcXVlc3QgaXMgY29tcGxldGUuXHJcblx0XHRcdC8vLyA8L3N1bW1hcnk+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cIm5hbWVcIiBvcHRpb25hbD1cImZhbHNlXCIgbWF5QmVOdWxsPVwiZmFsc2VcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwidGFyZ2V0XCIgb3B0aW9uYWw9XCJmYWxzZVwiIG1heUJlTnVsbD1cImZhbHNlXCIgdHlwZT1cIkV4b1dlYi5Nb2RlbC5FbnRpdHlcIj48L3BhcmFtPlxyXG5cdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJldmVudFwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cIm51bGxcIiB0eXBlPVwiT2JqZWN0XCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwic3VjY2Vzc1wiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIiB0eXBlPVwiRnVuY3Rpb25cIj48L3BhcmFtPlxyXG5cdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJmYWlsZWRcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCIgdHlwZT1cIkZ1bmN0aW9uXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwicGF0aHNcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCIgaXNBcnJheT1cInRydWVcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHJcblx0XHRcdHZhciBhcmdzLCBjaGVja3BvaW50LCBzZXJpYWxpemVkRXZlbnQsIHNlcmlhbGl6ZWRFdmVudFRhcmdldCwgZXZlbnRQcm9wTmFtZTtcclxuXHJcblx0XHRcdHBlbmRpbmdSZXF1ZXN0cysrO1xyXG5cclxuXHRcdFx0Ly8gQ2hlY2twb2ludCB0aGUgbG9nIHRvIGVuc3VyZSB0aGF0IHdlIG9ubHkgdHJ1bmNhdGUgY2hhbmdlcyB0aGF0IHdlcmUgc2F2ZWQuXHJcblx0XHRcdGNoZWNrcG9pbnQgPSB0aGlzLl9jaGFuZ2VMb2cuY2hlY2twb2ludChcInJhaXNlU2VydmVyRXZlbnQoXCIgKyBuYW1lICsgXCIpLVwiICsgKyhuZXcgRGF0ZSgpKSk7XHJcblxyXG5cdFx0XHRhcmdzID0ge1xyXG5cdFx0XHRcdHR5cGU6IFwicmFpc2VTZXJ2ZXJFdmVudFwiLFxyXG5cdFx0XHRcdHRhcmdldDogdGFyZ2V0LFxyXG5cdFx0XHRcdGNoZWNrcG9pbnQ6IGNoZWNrcG9pbnQsXHJcblx0XHRcdFx0aW5jbHVkZUFsbENoYW5nZXM6IGluY2x1ZGVBbGxDaGFuZ2VzXHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHRhcmdzLmV2ZW50TmFtZSA9IG5hbWU7XHJcblx0XHRcdGFyZ3MuZXZlbnRPYmplY3QgPSBldmVudDtcclxuXHJcblx0XHRcdHRoaXMuX3JhaXNlRXZlbnQoXCJyYWlzZVNlcnZlckV2ZW50QmVnaW5cIiwgW3RoaXMsIGFyZ3NdKTtcclxuXHJcblx0XHRcdHNlcmlhbGl6ZWRFdmVudCA9IHt9O1xyXG5cclxuXHRcdFx0Ly8gSWYgYW4gZXZlbnQgb2JqZWN0IGlzIHByb3ZpZGVkIHRoZW4gY29udmVydCBpdHMgZW50aXR5IHByb3BlcnRpZXMgaW50byB0aGVpciBzZXJpYWxpemVkIGZvcm0uXHJcblx0XHRcdGlmIChldmVudCAhPT0gdW5kZWZpbmVkICYmIGV2ZW50ICE9PSBudWxsKSB7XHJcblx0XHRcdFx0Zm9yIChldmVudFByb3BOYW1lIGluIGV2ZW50KSB7XHJcblx0XHRcdFx0XHR2YXIgYXJnID0gZXZlbnRbZXZlbnRQcm9wTmFtZV07XHJcblxyXG5cdFx0XHRcdFx0aWYgKGFyZyBpbnN0YW5jZW9mIEFycmF5KSB7XHJcblx0XHRcdFx0XHRcdHNlcmlhbGl6ZWRFdmVudFtldmVudFByb3BOYW1lXSA9IGFyZy5tYXAoZnVuY3Rpb24gKGEpIHsgcmV0dXJuIHRvRXhvTW9kZWwoYSwgdGhpcy5fdHJhbnNsYXRvcik7IH0sIHRoaXMpO1xyXG5cdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0c2VyaWFsaXplZEV2ZW50W2V2ZW50UHJvcE5hbWVdID0gdG9FeG9Nb2RlbChhcmcsIHRoaXMuX3RyYW5zbGF0b3IpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0c2VyaWFsaXplZEV2ZW50VGFyZ2V0ID0gdG9FeG9Nb2RlbCh0YXJnZXQsIHRoaXMuX3RyYW5zbGF0b3IpO1xyXG5cclxuXHRcdFx0YXJncy5yb290ID0gc2VyaWFsaXplZEV2ZW50VGFyZ2V0O1xyXG5cdFx0XHRhcmdzLmV2ZW50RGF0YSA9IHNlcmlhbGl6ZWRFdmVudDtcclxuXHJcblx0XHRcdHRoaXMuX3JhaXNlRXZlbnQoXCJyZXF1ZXN0QmVnaW5cIiwgW3RoaXMsIGFyZ3NdKTtcclxuXHJcblx0XHRcdGV2ZW50UHJvdmlkZXIoXHJcblx0XHRcdFx0bmFtZSxcclxuXHRcdFx0XHRzZXJpYWxpemVkRXZlbnRUYXJnZXQsXHJcblx0XHRcdFx0c2VyaWFsaXplZEV2ZW50LFxyXG5cdFx0XHRcdHBhdGhzLFxyXG5cdFx0XHRcdHNlcmlhbGl6ZUNoYW5nZXMuY2FsbCh0aGlzLCBpbmNsdWRlQWxsQ2hhbmdlcywgdGFyZ2V0KSxcclxuXHRcdFx0XHR0aGlzLl9vblJhaXNlU2VydmVyRXZlbnRTdWNjZXNzLmJpbmQodGhpcykuYXBwZW5kQXJndW1lbnRzKGFyZ3MsIGNoZWNrcG9pbnQsIHN1Y2Nlc3MpLFxyXG5cdFx0XHRcdHRoaXMuX29uUmFpc2VTZXJ2ZXJFdmVudEZhaWxlZC5iaW5kKHRoaXMpLmFwcGVuZEFyZ3VtZW50cyhhcmdzLCBmYWlsZWQgfHwgc3VjY2VzcylcclxuXHRcdFx0KTtcclxuXHRcdH0sXHJcblx0XHRfb25SYWlzZVNlcnZlckV2ZW50U3VjY2VzczogZnVuY3Rpb24gU2VydmVyU3luYyRfb25SYWlzZVNlcnZlckV2ZW50U3VjY2VzcyhyZXN1bHQsIGFyZ3MsIGNoZWNrcG9pbnQsIGNhbGxiYWNrKSB7XHJcblx0XHRcdGFyZ3MucmVzcG9uc2VPYmplY3QgPSByZXN1bHQ7XHJcblx0XHRcdGFyZ3MucmVxdWVzdFN1Y2NlZWRlZCA9IHRydWU7XHJcblxyXG5cdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwicmVxdWVzdEVuZFwiLCBbdGhpcywgYXJnc10pO1xyXG5cclxuXHRcdFx0dGhpcy5faGFuZGxlUmVzdWx0KHJlc3VsdCwgXCJyYWlzZVNlcnZlckV2ZW50KFwiICsgYXJncy5ldmVudE5hbWUgKyBcIilcIiwgY2hlY2twb2ludCwgZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdHRoaXMuX3JhaXNlRXZlbnQoXCJyZXF1ZXN0U3VjY2Vzc1wiLCBbdGhpcywgYXJnc10pO1xyXG5cclxuXHRcdFx0XHR2YXIgZXZlbnQgPSByZXN1bHQuZXZlbnRzWzBdO1xyXG5cdFx0XHRcdGlmIChldmVudCBpbnN0YW5jZW9mIEFycmF5KSB7XHJcblx0XHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50Lmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdFx0XHRcdGV2ZW50W2ldID0gZnJvbUV4b01vZGVsKGV2ZW50W2ldLCB0aGlzLl90cmFuc2xhdG9yLCB0cnVlKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRldmVudCA9IGZyb21FeG9Nb2RlbChldmVudCwgdGhpcy5fdHJhbnNsYXRvciwgdHJ1ZSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRyZXN0b3JlRGF0ZXMoZXZlbnQpO1xyXG5cclxuXHRcdFx0XHRyZXN1bHQuZXZlbnQgPSBldmVudDtcclxuXHJcblx0XHRcdFx0YXJncy5ldmVudFJlc3VsdCA9IGV2ZW50O1xyXG5cclxuXHRcdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwicmFpc2VTZXJ2ZXJFdmVudEVuZFwiLCBbdGhpcywgYXJnc10pO1xyXG5cdFx0XHRcdHRoaXMuX3JhaXNlRXZlbnQoXCJyYWlzZVNlcnZlckV2ZW50U3VjY2Vzc1wiLCBbdGhpcywgYXJnc10pO1xyXG5cclxuXHRcdFx0XHRpZiAoY2FsbGJhY2sgJiYgY2FsbGJhY2sgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG5cdFx0XHRcdFx0Y2FsbGJhY2socmVzdWx0KTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHBlbmRpbmdSZXF1ZXN0cy0tO1xyXG5cdFx0XHR9KTtcclxuXHRcdH0sXHJcblx0XHRfb25SYWlzZVNlcnZlckV2ZW50RmFpbGVkOiBmdW5jdGlvbiBTZXJ2ZXJTeW5jJF9vblJhaXNlU2VydmVyRXZlbnRGYWlsZWQoZXJyb3IsIGFyZ3MsIGNhbGxiYWNrKSB7XHJcblx0XHRcdGFyZ3MucmVzcG9uc2VPYmplY3QgPSBlcnJvcjtcclxuXHRcdFx0YXJncy5yZXF1ZXN0U3VjY2VlZGVkID0gZmFsc2U7XHJcblxyXG5cdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwicmVxdWVzdEVuZFwiLCBbdGhpcywgYXJnc10pO1xyXG5cdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwicmVxdWVzdEZhaWxlZFwiLCBbdGhpcywgYXJnc10pO1xyXG5cclxuXHRcdFx0dGhpcy5fcmFpc2VFdmVudChcInJhaXNlU2VydmVyRXZlbnRFbmRcIiwgW3RoaXMsIGFyZ3NdKTtcclxuXHRcdFx0dGhpcy5fcmFpc2VFdmVudChcInJhaXNlU2VydmVyRXZlbnRGYWlsZWRcIiwgW3RoaXMsIGFyZ3NdKTtcclxuXHJcblx0XHRcdGlmIChjYWxsYmFjayAmJiBjYWxsYmFjayBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRwZW5kaW5nUmVxdWVzdHMtLTtcclxuXHRcdH0sXHJcblx0XHRhZGRSYWlzZVNlcnZlckV2ZW50QmVnaW46IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX2FkZEV2ZW50KFwicmFpc2VTZXJ2ZXJFdmVudEJlZ2luXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHRcdHJlbW92ZVJhaXNlU2VydmVyRXZlbnRCZWdpbjogZnVuY3Rpb24gKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fcmVtb3ZlRXZlbnQoXCJyYWlzZVNlcnZlckV2ZW50QmVnaW5cIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0YWRkUmFpc2VTZXJ2ZXJFdmVudEVuZDogZnVuY3Rpb24gKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fYWRkRXZlbnQoXCJyYWlzZVNlcnZlckV2ZW50RW5kXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHRcdHJlbW92ZVJhaXNlU2VydmVyRXZlbnRFbmQ6IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUV2ZW50KFwicmFpc2VTZXJ2ZXJFdmVudEVuZFwiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRhZGRSYWlzZVNlcnZlckV2ZW50U3VjY2VzczogZnVuY3Rpb24gKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fYWRkRXZlbnQoXCJyYWlzZVNlcnZlckV2ZW50U3VjY2Vzc1wiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRyZW1vdmVSYWlzZVNlcnZlckV2ZW50U3VjY2VzczogZnVuY3Rpb24gKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fcmVtb3ZlRXZlbnQoXCJyYWlzZVNlcnZlckV2ZW50U3VjY2Vzc1wiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRhZGRSYWlzZVNlcnZlckV2ZW50RmFpbGVkOiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9hZGRFdmVudChcInJhaXNlU2VydmVyRXZlbnRGYWlsZWRcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0cmVtb3ZlUmFpc2VTZXJ2ZXJFdmVudEZhaWxlZDogZnVuY3Rpb24gKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fcmVtb3ZlRXZlbnQoXCJyYWlzZVNlcnZlckV2ZW50RmFpbGVkXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHJcblx0XHQvLyBSb3VuZHRyaXBcclxuXHRcdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0XHRyb3VuZHRyaXA6IGZ1bmN0aW9uIFNlcnZlclN5bmMkcm91bmR0cmlwKHRhcmdldCwgcGF0aHMsIHN1Y2Nlc3MsIGZhaWxlZCkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojRXhvV2ViLk1hcHBlci5TZXJ2ZXJTeW5jLnNhdmVcIj5cclxuXHRcdFx0Ly8vIFJvdW5kdHJpcHMgdGhlIGN1cnJlbnQgY2hhbmdlcyB0byB0aGUgc2VydmVyLiBUaGUgZ2l2ZW4gc3VjY2VzcyBvciBmYWlsdXJlIGNhbGxiYWNrIGlzXHJcblx0XHRcdC8vLyBpbnZva2VkIHdoZW4gdGhlIHJlcXVlc3QgaXMgY29tcGxldGUuXHJcblx0XHRcdC8vLyA8L3N1bW1hcnk+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cInRhcmdldFwiIG9wdGlvbmFsPVwiZmFsc2VcIiBtYXlCZU51bGw9XCJmYWxzZVwiIHR5cGU9XCJFeG9XZWIuTW9kZWwuRW50aXR5XCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwicGF0aHNcIiBvcHRpb25hbD1cImZhbHNlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiIGlzQXJyYXk9XCJ0cnVlXCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cInN1Y2Nlc3NcIiBvcHRpb25hbD1cImZhbHNlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiIHR5cGU9XCJGdW5jdGlvblwiPjwvcGFyYW0+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cImZhaWxlZFwiIG9wdGlvbmFsPVwiZmFsc2VcIiBtYXlCZU51bGw9XCJ0cnVlXCIgdHlwZT1cIkZ1bmN0aW9uXCI+PC9wYXJhbT5cclxuXHJcblx0XHRcdHZhciBhcmdzLCBjaGVja3BvaW50LCBzZXJpYWxpemVkVGFyZ2V0LCBpbmNsdWRlQWxsQ2hhbmdlcztcclxuXHJcblx0XHRcdHBlbmRpbmdSZXF1ZXN0cysrO1xyXG5cclxuXHRcdFx0aWYgKHRhcmdldCAmJiB0YXJnZXQgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG5cdFx0XHRcdHN1Y2Nlc3MgPSB0YXJnZXQ7XHJcblx0XHRcdFx0ZmFpbGVkID0gcGF0aHM7XHJcblx0XHRcdFx0dGFyZ2V0ID0gbnVsbDtcclxuXHRcdFx0XHRwYXRocyA9IG51bGw7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGNoZWNrcG9pbnQgPSB0aGlzLl9jaGFuZ2VMb2cuY2hlY2twb2ludChcInJvdW5kdHJpcC1cIiArICsobmV3IERhdGUoKSkpO1xyXG5cclxuXHRcdFx0aWYgKHRhcmdldCkge1xyXG5cdFx0XHRcdGluY2x1ZGVBbGxDaGFuZ2VzID0gdHJ1ZTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRpbmNsdWRlQWxsQ2hhbmdlcyA9IGZhbHNlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRhcmdzID0ge1xyXG5cdFx0XHRcdHR5cGU6IFwicm91bmR0cmlwXCIsXHJcblx0XHRcdFx0dGFyZ2V0OiB0YXJnZXQgfHwgbnVsbCxcclxuXHRcdFx0XHRjaGVja3BvaW50OiBjaGVja3BvaW50LFxyXG5cdFx0XHRcdGluY2x1ZGVBbGxDaGFuZ2VzOiBpbmNsdWRlQWxsQ2hhbmdlc1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0dGhpcy5fcmFpc2VFdmVudChcInJvdW5kdHJpcEJlZ2luXCIsIFt0aGlzLCBhcmdzXSk7XHJcblxyXG5cdFx0XHRpZiAodGFyZ2V0KSB7XHJcblx0XHRcdFx0c2VyaWFsaXplZFRhcmdldCA9IHRvRXhvTW9kZWwodGFyZ2V0LCB0aGlzLl90cmFuc2xhdG9yKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRzZXJpYWxpemVkVGFyZ2V0ID0gbnVsbDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0YXJncy5yb290ID0gc2VyaWFsaXplZFRhcmdldDtcclxuXHJcblx0XHRcdHRoaXMuX3JhaXNlRXZlbnQoXCJyZXF1ZXN0QmVnaW5cIiwgW3RoaXMsIGFyZ3NdKTtcclxuXHJcblx0XHRcdHJvdW5kdHJpcFByb3ZpZGVyKFxyXG5cdFx0XHRcdHNlcmlhbGl6ZWRUYXJnZXQsXHJcblx0XHRcdFx0cGF0aHMsXHJcblx0XHRcdFx0c2VyaWFsaXplQ2hhbmdlcy5jYWxsKHRoaXMsIGluY2x1ZGVBbGxDaGFuZ2VzLCB0YXJnZXQpLFxyXG5cdFx0XHRcdHRoaXMuX29uUm91bmR0cmlwU3VjY2Vzcy5iaW5kKHRoaXMpLmFwcGVuZEFyZ3VtZW50cyhhcmdzLCBjaGVja3BvaW50LCBzdWNjZXNzKSxcclxuXHRcdFx0XHR0aGlzLl9vblJvdW5kdHJpcEZhaWxlZC5iaW5kKHRoaXMpLmFwcGVuZEFyZ3VtZW50cyhhcmdzLCBmYWlsZWQgfHwgc3VjY2VzcylcclxuXHRcdFx0KTtcclxuXHRcdH0sXHJcblx0XHRfb25Sb3VuZHRyaXBTdWNjZXNzOiBmdW5jdGlvbiBTZXJ2ZXJTeW5jJF9vblJvdW5kdHJpcFN1Y2Nlc3MocmVzdWx0LCBhcmdzLCBjaGVja3BvaW50LCBjYWxsYmFjaykge1xyXG5cdFx0XHRhcmdzLnJlc3BvbnNlT2JqZWN0ID0gcmVzdWx0O1xyXG5cdFx0XHRhcmdzLnJlcXVlc3RTdWNjZWVkZWQgPSB0cnVlO1xyXG5cclxuXHRcdFx0dGhpcy5fcmFpc2VFdmVudChcInJlcXVlc3RFbmRcIiwgW3RoaXMsIGFyZ3NdKTtcclxuXHJcblx0XHRcdHRoaXMuX2hhbmRsZVJlc3VsdChyZXN1bHQsIFwicm91bmR0cmlwXCIsIGNoZWNrcG9pbnQsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwicmVxdWVzdFN1Y2Nlc3NcIiwgW3RoaXMsIGFyZ3NdKTtcclxuXHRcdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwicm91bmR0cmlwRW5kXCIsIFt0aGlzLCBhcmdzXSk7XHJcblx0XHRcdFx0dGhpcy5fcmFpc2VFdmVudChcInJvdW5kdHJpcFN1Y2Nlc3NcIiwgW3RoaXMsIGFyZ3NdKTtcclxuXHJcblx0XHRcdFx0aWYgKGNhbGxiYWNrICYmIGNhbGxiYWNrIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuXHRcdFx0XHRcdGNhbGxiYWNrKHJlc3VsdCk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRwZW5kaW5nUmVxdWVzdHMtLTtcclxuXHRcdFx0fSk7XHJcblx0XHR9LFxyXG5cdFx0X29uUm91bmR0cmlwRmFpbGVkOiBmdW5jdGlvbiBTZXJ2ZXJTeW5jJF9vblJvdW5kdHJpcEZhaWxlZChlcnJvciwgYXJncywgY2FsbGJhY2spIHtcclxuXHRcdFx0YXJncy5yZXNwb25zZU9iamVjdCA9IGVycm9yO1xyXG5cdFx0XHRhcmdzLnJlcXVlc3RTdWNjZWVkZWQgPSBmYWxzZTtcclxuXHJcblx0XHRcdHRoaXMuX3JhaXNlRXZlbnQoXCJyZXF1ZXN0RW5kXCIsIFt0aGlzLCBhcmdzXSk7XHJcblx0XHRcdHRoaXMuX3JhaXNlRXZlbnQoXCJyZXF1ZXN0RmFpbGVkXCIsIFt0aGlzLCBhcmdzXSk7XHJcblxyXG5cdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwicm91bmR0cmlwRW5kXCIsIFt0aGlzLCBhcmdzXSk7XHJcblx0XHRcdHRoaXMuX3JhaXNlRXZlbnQoXCJyb3VuZHRyaXBGYWlsZWRcIiwgW3RoaXMsIGFyZ3NdKTtcclxuXHJcblx0XHRcdGlmIChjYWxsYmFjayAmJiBjYWxsYmFjayBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRwZW5kaW5nUmVxdWVzdHMtLTtcclxuXHRcdH0sXHJcblx0XHRzdGFydEF1dG9Sb3VuZHRyaXA6IGZ1bmN0aW9uIChpbnRlcnZhbCkge1xyXG5cdFx0XHRpZiAoIWludGVydmFsIHx8IHR5cGVvZihpbnRlcnZhbCkgIT09IFwibnVtYmVyXCIgfHwgaW50ZXJ2YWwgPD0gMCkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIkFuIGludGVydmFsIG11c3QgYmUgc3BlY2lmaWVkIGZvciBhdXRvLXNhdmUuXCIpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBjYW5jZWwgYW55IHBlbmRpbmcgcm91bmR0cmlwIHNjaGVkdWxlXHJcblx0XHRcdHRoaXMuc3RvcEF1dG9Sb3VuZHRyaXAoKTtcclxuXHJcblx0XHRcdGZ1bmN0aW9uIGRvUm91bmR0cmlwKCkge1xyXG5cdFx0XHRcdHRoaXMucm91bmR0cmlwKGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdHRoaXMuX3JvdW5kdHJpcFRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dChkb1JvdW5kdHJpcC5iaW5kKHRoaXMpLCBpbnRlcnZhbCk7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMuX3JvdW5kdHJpcFRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dChkb1JvdW5kdHJpcC5iaW5kKHRoaXMpLCBpbnRlcnZhbCk7XHJcblx0XHR9LFxyXG5cdFx0c3RvcEF1dG9Sb3VuZHRyaXA6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0aWYgKHRoaXMuX3JvdW5kdHJpcFRpbWVvdXQpIHtcclxuXHRcdFx0XHR3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMuX3JvdW5kdHJpcFRpbWVvdXQpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0YWRkUm91bmR0cmlwQmVnaW46IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX2FkZEV2ZW50KFwicm91bmR0cmlwQmVnaW5cIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0cmVtb3ZlUm91bmR0cmlwQmVnaW46IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUV2ZW50KFwicm91bmR0cmlwQmVnaW5cIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0YWRkUm91bmR0cmlwRW5kOiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9hZGRFdmVudChcInJvdW5kdHJpcEVuZFwiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRyZW1vdmVSb3VuZHRyaXBFbmQ6IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUV2ZW50KFwicm91bmR0cmlwRW5kXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHRcdGFkZFJvdW5kdHJpcFN1Y2Nlc3M6IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX2FkZEV2ZW50KFwicm91bmR0cmlwU3VjY2Vzc1wiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRyZW1vdmVSb3VuZHRyaXBTdWNjZXNzOiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9yZW1vdmVFdmVudChcInJvdW5kdHJpcFN1Y2Nlc3NcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0YWRkUm91bmR0cmlwRmFpbGVkOiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9hZGRFdmVudChcInJvdW5kdHJpcEZhaWxlZFwiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRyZW1vdmVSb3VuZHRyaXBGYWlsZWQ6IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUV2ZW50KFwicm91bmR0cmlwRmFpbGVkXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHJcblx0XHQvLyBTYXZlXHJcblx0XHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cdFx0c2F2ZTogZnVuY3Rpb24gKHRhcmdldCwgc3VjY2VzcywgZmFpbGVkKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNFeG9XZWIuTWFwcGVyLlNlcnZlclN5bmMuc2F2ZVwiPlxyXG5cdFx0XHQvLy8gU2F2ZXMgY2hhbmdlcyB0byB0aGUgZ2l2ZW4gdGFyZ2V0IGFuZCByZWxhdGVkIGVudGl0aWVzLiBUaGUgZ2l2ZW4gc3VjY2VzcyBvciBmYWlsdXJlXHJcblx0XHRcdC8vLyBjYWxsYmFjayBpcyBpbnZva2VkIHdoZW4gdGhlIHJlcXVlc3QgaXMgY29tcGxldGUuXHJcblx0XHRcdC8vLyA8L3N1bW1hcnk+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cInRhcmdldFwiIG9wdGlvbmFsPVwiZmFsc2VcIiBtYXlCZU51bGw9XCJmYWxzZVwiIHR5cGU9XCJFeG9XZWIuTW9kZWwuRW50aXR5XCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwic3VjY2Vzc1wiIG9wdGlvbmFsPVwiZmFsc2VcIiBtYXlCZU51bGw9XCJ0cnVlXCIgdHlwZT1cIkZ1bmN0aW9uXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwiZmFpbGVkXCIgb3B0aW9uYWw9XCJmYWxzZVwiIG1heUJlTnVsbD1cInRydWVcIiB0eXBlPVwiRnVuY3Rpb25cIj48L3BhcmFtPlxyXG5cclxuXHRcdFx0dmFyIGFyZ3MsIGNoZWNrcG9pbnQsIHNlcmlhbGl6ZWRUYXJnZXQ7XHJcblxyXG5cdFx0XHRwZW5kaW5nUmVxdWVzdHMrKztcclxuXHJcblx0XHRcdC8vIENoZWNrcG9pbnQgdGhlIGxvZyB0byBlbnN1cmUgdGhhdCB3ZSBvbmx5IHRydW5jYXRlIGNoYW5nZXMgdGhhdCB3ZXJlIHNhdmVkLlxyXG5cdFx0XHRjaGVja3BvaW50ID0gdGhpcy5fY2hhbmdlTG9nLmNoZWNrcG9pbnQoXCJzYXZlLVwiICsgKyhuZXcgRGF0ZSgpKSk7XHJcblxyXG5cdFx0XHRhcmdzID0ge1xyXG5cdFx0XHRcdHR5cGU6IFwic2F2ZVwiLFxyXG5cdFx0XHRcdHRhcmdldDogdGFyZ2V0LFxyXG5cdFx0XHRcdGNoZWNrcG9pbnQ6IGNoZWNrcG9pbnQsXHJcblx0XHRcdFx0aW5jbHVkZUFsbENoYW5nZXM6IGZhbHNlXHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwic2F2ZUJlZ2luXCIsIFt0aGlzLCBhcmdzXSk7XHJcblxyXG5cdFx0XHRzZXJpYWxpemVkVGFyZ2V0ID0gdG9FeG9Nb2RlbCh0YXJnZXQsIHRoaXMuX3RyYW5zbGF0b3IpO1xyXG5cclxuXHRcdFx0YXJncy5yb290ID0gc2VyaWFsaXplZFRhcmdldDtcclxuXHJcblx0XHRcdHRoaXMuX3JhaXNlRXZlbnQoXCJyZXF1ZXN0QmVnaW5cIiwgW3RoaXMsIGFyZ3NdKTtcclxuXHJcblx0XHRcdHNhdmVQcm92aWRlcihcclxuXHRcdFx0XHRzZXJpYWxpemVkVGFyZ2V0LFxyXG5cdFx0XHRcdHNlcmlhbGl6ZUNoYW5nZXMuY2FsbCh0aGlzLCBmYWxzZSwgdGFyZ2V0KSxcclxuXHRcdFx0XHR0aGlzLl9vblNhdmVTdWNjZXNzLmJpbmQodGhpcykuYXBwZW5kQXJndW1lbnRzKGFyZ3MsIGNoZWNrcG9pbnQsIHN1Y2Nlc3MpLFxyXG5cdFx0XHRcdHRoaXMuX29uU2F2ZUZhaWxlZC5iaW5kKHRoaXMpLmFwcGVuZEFyZ3VtZW50cyhhcmdzLCBmYWlsZWQgfHwgc3VjY2VzcylcclxuXHRcdFx0KTtcclxuXHRcdH0sXHJcblx0XHRfb25TYXZlU3VjY2VzczogZnVuY3Rpb24gU2VydmVyU3luYyRfb25TYXZlU3VjY2VzcyhyZXN1bHQsIGFyZ3MsIGNoZWNrcG9pbnQsIGNhbGxiYWNrKSB7XHJcblx0XHRcdGFyZ3MucmVzcG9uc2VPYmplY3QgPSByZXN1bHQ7XHJcblx0XHRcdGFyZ3MucmVxdWVzdFN1Y2NlZWRlZCA9IHRydWU7XHJcblxyXG5cdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwicmVxdWVzdEVuZFwiLCBbdGhpcywgYXJnc10pO1xyXG5cclxuXHRcdFx0dGhpcy5faGFuZGxlUmVzdWx0KHJlc3VsdCwgXCJzYXZlXCIsIGNoZWNrcG9pbnQsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwicmVxdWVzdFN1Y2Nlc3NcIiwgW3RoaXMsIGFyZ3NdKTtcclxuXHRcdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwic2F2ZUVuZFwiLCBbdGhpcywgYXJnc10pO1xyXG5cdFx0XHRcdHRoaXMuX3JhaXNlRXZlbnQoXCJzYXZlU3VjY2Vzc1wiLCBbdGhpcywgYXJnc10pO1xyXG5cclxuXHRcdFx0XHRpZiAoY2FsbGJhY2sgJiYgY2FsbGJhY2sgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG5cdFx0XHRcdFx0Y2FsbGJhY2socmVzdWx0KTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHBlbmRpbmdSZXF1ZXN0cy0tO1xyXG5cdFx0XHR9KTtcclxuXHRcdH0sXHJcblx0XHRfb25TYXZlRmFpbGVkOiBmdW5jdGlvbiAoZXJyb3IsIGFyZ3MsIGNhbGxiYWNrKSB7XHJcblx0XHRcdGFyZ3MucmVzcG9uc2VPYmplY3QgPSBlcnJvcjtcclxuXHRcdFx0YXJncy5yZXF1ZXN0U3VjY2VlZGVkID0gZmFsc2U7XHJcblxyXG5cdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwicmVxdWVzdEVuZFwiLCBbdGhpcywgYXJnc10pO1xyXG5cdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwicmVxdWVzdEZhaWxlZFwiLCBbdGhpcywgYXJnc10pO1xyXG5cclxuXHRcdFx0dGhpcy5fcmFpc2VFdmVudChcInNhdmVFbmRcIiwgW3RoaXMsIGFyZ3NdKTtcclxuXHRcdFx0dGhpcy5fcmFpc2VFdmVudChcInNhdmVGYWlsZWRcIiwgW3RoaXMsIGFyZ3NdKTtcclxuXHJcblx0XHRcdGlmIChjYWxsYmFjayAmJiBjYWxsYmFjayBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRwZW5kaW5nUmVxdWVzdHMtLTtcclxuXHRcdH0sXHJcblx0XHRzdGFydEF1dG9TYXZlOiBmdW5jdGlvbiBTZXJ2ZXJTeW5jJHN0YXJ0QXV0b1NhdmUocm9vdCwgaW50ZXJ2YWwsIG1heEF0dGVtcHRzKSB7XHJcblx0XHRcdGlmICghcm9vdCB8fCAhKHJvb3QgaW5zdGFuY2VvZiBFbnRpdHkpKSB7XHJcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiQSByb290IG9iamVjdCBtdXN0IGJlIHNwZWNpZmllZCBmb3IgYXV0by1zYXZlLlwiKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKCFpbnRlcnZhbCB8fCB0eXBlb2YoaW50ZXJ2YWwpICE9PSBcIm51bWJlclwiIHx8IGludGVydmFsIDw9IDApIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJBbiBpbnRlcnZhbCBtdXN0IGJlIHNwZWNpZmllZCBmb3IgYXV0by1zYXZlLlwiKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKG1heEF0dGVtcHRzICYmICh0eXBlb2YgKG1heEF0dGVtcHRzKSAhPT0gXCJudW1iZXJcIiB8fCBtYXhBdHRlbXB0cyA8PSAwKSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIk1heCBudW1iZXIgb2YgYXV0by1zYXZlIGF0dGVtcHRzIG11c3QgYmUgYSBwb3NpdGl2ZSBudW1iZXIuXCIpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBjYW5jZWwgYW55IHBlbmRpbmcgc2F2ZSBzY2hlZHVsZVxyXG5cdFx0XHR0aGlzLnN0b3BBdXRvU2F2ZSgpO1xyXG5cclxuXHRcdFx0dGhpcy5fc2F2ZUludGVydmFsID0gaW50ZXJ2YWw7XHJcblx0XHRcdHRoaXMuX3NhdmVSb290ID0gcm9vdDtcclxuXHJcblx0XHRcdC8vIEF0dGVtcHQgdG8gcHJvdmlkZSBhIHNvbWV3aGF0IHJlYXNvbmFibGUgZGVmYXVsdC5cclxuXHRcdFx0dGhpcy5fbWF4QXV0b1NhdmVBdHRlbXB0cyA9IG1heEF0dGVtcHRzIHx8IDM7XHJcblx0XHR9LFxyXG5cdFx0c3RvcEF1dG9TYXZlOiBmdW5jdGlvbiBTZXJ2ZXJTeW5jJHN0b3BBdXRvU2F2ZSgpIHtcclxuXHRcdFx0aWYgKHRoaXMuX3NhdmVUaW1lb3V0KSB7XHJcblx0XHRcdFx0d2luZG93LmNsZWFyVGltZW91dCh0aGlzLl9zYXZlVGltZW91dCk7XHJcblx0XHRcdFx0dGhpcy5fc2F2ZVRpbWVvdXQgPSBudWxsO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0aGlzLl9zYXZlSW50ZXJ2YWwgPSBudWxsO1xyXG5cdFx0XHR0aGlzLl9zYXZlUm9vdCA9IG51bGw7XHJcblx0XHRcdHRoaXMuX21heEF1dG9TYXZlQXR0ZW1wdHMgPSBudWxsO1xyXG5cdFx0fSxcclxuXHRcdF9hdXRvU2F2ZVN1Y2Nlc3M6IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHR0aGlzLl9mYWlsZWRBdXRvU2F2ZUF0dGVtcHRzID0gMDtcclxuXHJcblx0XHRcdC8vIFdhaXQgZm9yIHRoZSBuZXh0IGNoYW5nZSBiZWZvcmUgbmV4dCBhdXRvIHNhdmVcclxuXHRcdFx0dGhpcy5fc2F2ZVRpbWVvdXQgPSBudWxsO1xyXG5cclxuXHRcdFx0Ly8gLi4udW5sZXNzIHRoZXJlIHdlcmUgbmV3IHBlbmRpbmcgY2hhbmdlcyBlbmNvdW50ZXJlZCBzaW5jZSB0aGUgbGFzdCBhdXRvLXNhdmUuXHJcblx0XHRcdGlmICh0aGlzLmNoYW5nZXMoZmFsc2UsIHRoaXMuX3NhdmVSb290LCB0cnVlKS5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0dGhpcy5fcXVldWVBdXRvU2F2ZSgpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0X2F1dG9TYXZlRmFpbHVyZTogZnVuY3Rpb24oKSB7XHJcblx0XHRcdGlmICgrK3RoaXMuX2ZhaWxlZEF1dG9TYXZlQXR0ZW1wdHMgPCB0aGlzLl9tYXhBdXRvU2F2ZUF0dGVtcHRzKSB7XHJcblx0XHRcdFx0dGhpcy5fcXVldWVBdXRvU2F2ZSgpO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGxvZ1dhcm5pbmcoJGZvcm1hdChcIkF1dG8tc2F2ZSBmYWlsZWQgezB9IGNvbnNlY3V0aXZlIHRpbWVzIGFuZCB3aWxsIG5vdCByZS10cnkgYWdhaW4gdW50aWwgYWRkaXRpb25hbCBjaGFuZ2VzIGFyZSBkZXRlY3RlZC5cIiwgdGhpcy5fZmFpbGVkQXV0b1NhdmVBdHRlbXB0cykpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0X2RvQXV0b1NhdmU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHR0aGlzLnNhdmUodGhpcy5fc2F2ZVJvb3QsIHRoaXMuX2F1dG9TYXZlU3VjY2Vzcy5iaW5kKHRoaXMpLCB0aGlzLl9hdXRvU2F2ZUZhaWx1cmUuYmluZCh0aGlzKSk7XHJcblx0XHR9LFxyXG5cdFx0X3F1ZXVlQXV0b1NhdmU6IGZ1bmN0aW9uIFNlcnZlclN5bmMkX3F1ZXVlQXV0b1NhdmUoKSB7XHJcblx0XHRcdGlmICh0aGlzLl9zYXZlVGltZW91dCkge1xyXG5cdFx0XHRcdC8vIEFscmVhZHkgcXVldWVkLi4uXHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoIXRoaXMuX3NhdmVJbnRlcnZhbCB8fCAhdGhpcy5fc2F2ZVJvb3QgfHwgIXRoaXMuX21heEF1dG9TYXZlQXR0ZW1wdHMpIHtcclxuXHRcdFx0XHQvLyBBdXRvLXNhdmUgaXMgbm90IGNvbmZpZ3VyZWQuLi5cclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMuX3NhdmVUaW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQodGhpcy5fZG9BdXRvU2F2ZS5iaW5kKHRoaXMpLCB0aGlzLl9zYXZlSW50ZXJ2YWwpO1xyXG5cdFx0fSxcclxuXHRcdGFkZFNhdmVCZWdpbjogZnVuY3Rpb24gKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fYWRkRXZlbnQoXCJzYXZlQmVnaW5cIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0cmVtb3ZlU2F2ZUJlZ2luOiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9yZW1vdmVFdmVudChcInNhdmVCZWdpblwiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRhZGRTYXZlRW5kOiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9hZGRFdmVudChcInNhdmVFbmRcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0cmVtb3ZlU2F2ZUVuZDogZnVuY3Rpb24gKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fcmVtb3ZlRXZlbnQoXCJzYXZlRW5kXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHRcdGFkZFNhdmVTdWNjZXNzOiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9hZGRFdmVudChcInNhdmVTdWNjZXNzXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHRcdHJlbW92ZVNhdmVTdWNjZXNzOiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9yZW1vdmVFdmVudChcInNhdmVTdWNjZXNzXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHRcdGFkZFNhdmVGYWlsZWQ6IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX2FkZEV2ZW50KFwic2F2ZUZhaWxlZFwiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRyZW1vdmVTYXZlRmFpbGVkOiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9yZW1vdmVFdmVudChcInNhdmVGYWlsZWRcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIEVuc3VyZUxvYWRlZFxyXG5cdFx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHRcdGVuc3VyZUxvYWRlZDogZnVuY3Rpb24gKHRhcmdldCwgcGF0aHMsIGluY2x1ZGVQYXRoc0Zyb21RdWVyaWVzLCBzdWNjZXNzLCBmYWlsZWQpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI0V4b1dlYi5NYXBwZXIuU2VydmVyU3luYy5lbnN1cmVMb2FkZWRcIj5cclxuXHRcdFx0Ly8vIExvYWRzIHRoZSBnaXZlbiBlbnRpdHkgKGFuZCBvcHRpb25hbGx5IGEgc2V0IG9mIHJlbGF0aXZlIHBhdGhzKSBpZiBuZWNlc3NhcnkuIFRoZSBnaXZlbiBzdWNjZXNzIG9yIGZhaWx1cmVcclxuXHRcdFx0Ly8vIGNhbGxiYWNrIGlzIGludm9rZWQgd2hlbiB0aGUgcmVxdWVzdCBpcyBjb21wbGV0ZSBpZiBsb2FkaW5nIHdhcyByZXF1aXJlZC4gSWYgbm8gbG9hZGluZyB3YXMgcmVxdWlyZWQsIHRoZVxyXG5cdFx0XHQvLy8gc3VjY2VzcyBjYWxsYmFjayBpcyBpbnZva2VkIGFmdGVyIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUuIFRoaXMgYXJ0aWZpY2FsIGFzeW5jaHJvbmljaXR5IGlzIGludHJvZHVjZWRcclxuXHRcdFx0Ly8vIHByaW1hcmlseSB0byBsaW1pdCBjYWxsIHN0YWNrIHNpemUsIGFuZCBpbiB0aGUgY2FzZSBvZiBsb2FkaW5nIGEgY29uc2lzdGVudCBhc3luY2hyb25vdXMgZXhwZXJpZW5jZSBpc1xyXG5cdFx0XHQvLy8gYWNjZXB0YWJsZSBhbmQgcGVyaGFwcyBldmVuIGV4cGVjdGVkIHRvIHNvbWUgZXh0ZW50LlxyXG5cdFx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJ0YXJnZXRcIiBvcHRpb25hbD1cImZhbHNlXCIgbWF5QmVOdWxsPVwiZmFsc2VcIiB0eXBlPVwiRXhvV2ViLk1vZGVsLkVudGl0eXxFeG9XZWIuTW9kZWwuVHlwZVwiPjwvcGFyYW0+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cInBhdGhzXCIgb3B0aW9uYWw9XCJmYWxzZVwiIG1heUJlTnVsbD1cInRydWVcIiBpc0FycmF5PVwidHJ1ZVwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJpbmNsdWRlUGF0aHNGcm9tUXVlcmllc1wiIG1heUJlTnVsbD1cInRydWVcIiB0eXBlPVwiQm9vbGVhblwiIG9wdGlvbmFsPVwiZmFsc2VcIj48L3BhcmFtPlxyXG5cdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJzdWNjZXNzXCIgb3B0aW9uYWw9XCJmYWxzZVwiIG1heUJlTnVsbD1cInRydWVcIiB0eXBlPVwiRnVuY3Rpb25cIj48L3BhcmFtPlxyXG5cdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJmYWlsZWRcIiBvcHRpb25hbD1cImZhbHNlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiIHR5cGU9XCJGdW5jdGlvblwiPjwvcGFyYW0+XHJcblxyXG5cdFx0XHR2YXIgYXJncywgY2hlY2twb2ludCwgc2VyaWFsaXplZFRhcmdldCwgcXVlcnlQYXRocywgcGF0aHNUb0xvYWQsIHN0YXRpY1BhdGgsIHN0YXRpY1Byb3BlcnR5O1xyXG5cclxuXHRcdFx0cGVuZGluZ1JlcXVlc3RzKys7XHJcblxyXG5cdFx0XHRpZiAodGFyZ2V0ID09PSBudWxsIHx8IHRhcmdldCA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiTWV0aG9kIGVuc3VyZUxvYWRlZCByZXF1aXJlcyBhIHRhcmdldCBhcmd1bWVudC5cIik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICh0YXJnZXQgaW5zdGFuY2VvZiBFbnRpdHkpIHtcclxuXHRcdFx0XHRpZiAoaW5jbHVkZVBhdGhzRnJvbVF1ZXJpZXMpIHtcclxuXHRcdFx0XHRcdC8vIEdldCB0aGUgcGF0aHMgZnJvbSB0aGUgb3JpZ2luYWwgcXVlcnkoaWVzKSB0aGF0IGFwcGx5IHRvIHRoZSB0YXJnZXQgb2JqZWN0IChiYXNlZCBvbiB0eXBlKS5cclxuXHRcdFx0XHRcdHF1ZXJ5UGF0aHMgPSBPYmplY3RMYXp5TG9hZGVyLmdldFJlbGF0aXZlUGF0aHModGFyZ2V0KTtcclxuXHRcdFx0XHRcdGlmIChwYXRocykge1xyXG5cdFx0XHRcdFx0XHRwYXRoc1RvTG9hZCA9IHBhdGhzLmNvbmNhdChxdWVyeVBhdGhzKTtcclxuXHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdHBhdGhzVG9Mb2FkID0gcXVlcnlQYXRocztcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0cGF0aHNUb0xvYWQgPSBwYXRocyB8fCBbXTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0Ly8gRm9yIHN0YXRpYyBsb2FkaW5nIGEgc2luZ2xlIGFycmF5IG9yIG9iamVjdCB3aWxsIGJlIGxvYWRlZCB3aXRoIG5vIGFkZGl0aW9uYWwgcGF0aHMuXHJcblx0XHRcdFx0cGF0aHNUb0xvYWQgPSBbXTtcclxuXHJcblx0XHRcdFx0Ly8gVXNlIHRoZSBtZXRhIHR5cGUgaWYgYSB0eXBlIGNvbnN0cnVjdG9yIHdhcyB1c2VkIGFzIHRoZSB0YXJnZXQuXHJcblx0XHRcdFx0aWYgKHRhcmdldCBpbnN0YW5jZW9mIEZ1bmN0aW9uICYmIHRhcmdldC5tZXRhICYmIHRhcmdldC5tZXRhICYmIHRhcmdldC5tZXRhIGluc3RhbmNlb2YgVHlwZSkge1xyXG5cdFx0XHRcdFx0dGFyZ2V0ID0gdGFyZ2V0Lm1ldGE7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRpZiAoISh0YXJnZXQgaW5zdGFuY2VvZiBUeXBlKSkge1xyXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCRmb3JtYXQoXCJNZXRob2QgZW5zdXJlTG9hZGVkIGV4cGVjdHMgdGFyZ2V0IG9mIHR5cGUgRW50aXR5IG9yIFR5cGUsIGJ1dCBmb3VuZCB0eXBlIFxcXCJ7MH1cXFwiLlwiLCBwYXJzZUZ1bmN0aW9uTmFtZSh0YXJnZXQuY29uc3RydWN0b3IpKSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRpZiAocGF0aHMgPT09IG51bGwgfHwgcGF0aHMgPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiTWV0aG9kIGVuc3VyZUxvYWRlZCByZXF1aXJlcyBhIHBhdGhzIGFyZ3VtZW50IGZvciBzdGF0aWMgcHJvcGVydHkgbG9hZGluZy5cIik7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHBhdGhzKSA9PT0gXCJbb2JqZWN0IFN0cmluZ11cIikge1xyXG5cdFx0XHRcdFx0c3RhdGljUGF0aCA9IHBhdGhzO1xyXG5cdFx0XHRcdH0gZWxzZSBpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHBhdGhzKSA9PT0gXCJbb2JqZWN0IEFycmF5XVwiKSB7XHJcblx0XHRcdFx0XHRpZiAocGF0aHMubGVuZ3RoID09PSAxKSB7XHJcblx0XHRcdFx0XHRcdHN0YXRpY1BhdGggPSBwYXRoc1swXTtcclxuXHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcigkZm9ybWF0KFwiTXVsdGlwbGUgcGF0aHMgY2Fubm90IGJlIHNwZWNpZmllZCB3aGVuIGVuc3VyaW5nIHRoYXQgc3RhdGljIHByb3BlcnR5IGluZm9ybWF0aW9uIGlzIGxvYWRlZDogXFxcInswfS5bezF9XVxcXCIuXCIsIHRhcmdldC5nZXRfZnVsbE5hbWUoKSwgcGF0aHMuam9pbihcIixcIikpKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCRmb3JtYXQoXCJBcmd1bWVudCBcXFwicGF0aHNcXFwiIHdhcyBleHBlY3RlZCB0byBiZSBhIHN0cmluZyBvciBhcnJheSBvZiBzdHJpbmdzLCBidXQgZm91bmQgdHlwZSBcXFwiezB9XFxcIiBpbnN0ZWFkLlwiLCBwYXJzZUZ1bmN0aW9uTmFtZSh0YXJnZXQuY29uc3RydWN0b3IpKSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBTdGF0aWMgcHJvcGVydHkgcGF0aCBjYW4gb25seSBiZSBhIHNpbmdsZSBwcm9wZXJ0eSBuYW1lLCBub3QgYSBtdWx0aS1zdGVwIHBhdGguXHJcblx0XHRcdFx0aWYgKHN0YXRpY1BhdGguaW5kZXhPZihcIi5cIikgPj0gMCkge1xyXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCRmb3JtYXQoXCJNdWx0aXBsZSBwYXRoIHN0ZXBzIGNhbm5vdCBiZSBzcGVjaWZpZWQgd2hlbiBlbnN1cmluZyB0aGF0IHN0YXRpYyBwcm9wZXJ0eSBpbmZvcm1hdGlvbiBpcyBsb2FkZWQ6IFxcXCJ7MH0uezF9XFxcIi5cIiwgdGFyZ2V0LmdldF9mdWxsTmFtZSgpLCBzdGF0aWNQYXRoKSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBHZXQgdGhlIG1ldGEgcHJvcGVydHkgZm9yIHRoZSBnaXZlbiBzaW5nbGUgcGF0aC5cclxuXHRcdFx0XHRzdGF0aWNQcm9wZXJ0eSA9IHRhcmdldC5wcm9wZXJ0eShzdGF0aWNQYXRoKTtcclxuXHJcblx0XHRcdFx0Ly8gUHJlcGVuZCB0aGUgdGFyZ2V0IHR5cGUgbmFtZSB0byB0aGUgc3RhdGljIHBhdGggZm9yIGxhdGVyIHVzZSBpbiBsb2dnaW5nIGFuZCBlcnJvcnMsIGV0Yy5cclxuXHRcdFx0XHRzdGF0aWNQYXRoID0gdGFyZ2V0LmdldF9mdWxsTmFtZSgpICsgXCIuXCIgKyBzdGF0aWNQYXRoO1xyXG5cclxuXHRcdFx0XHQvLyBHZXQgdGhlIHN0YXRpYyBwYXRoIHZhbHVlIGFuZCB2ZXJpZnkgdGhhdCB0aGVyZSBpcyBhIHZhbHVlIGluIG9yZGVyIHRvIGVuc3VyZSBsb2FkaW5nLlxyXG5cdFx0XHRcdHRhcmdldCA9IHN0YXRpY1Byb3BlcnR5LnZhbHVlKHRhcmdldCk7XHJcblx0XHRcdFx0aWYgKHRhcmdldCA9PT0gbnVsbCB8fCB0YXJnZXQgPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCRmb3JtYXQoXCJVbmFibGUgdG8gZW5zdXJlIHRoYXQgc3RhdGljIHBhdGggXFxcInswfVxcXCIgaXMgbG9hZGVkIGJlY2F1c2UgaXQgZXZhbHVhdGVzIHRvIGEgbnVsbCBvciB1bmRlZmluZWQgdmFsdWUuXCIsIHN0YXRpY1BhdGgpKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIENoZWNrcG9pbnQgdGhlIGxvZyB0byBlbnN1cmUgdGhhdCB3ZSBvbmx5IHRydW5jYXRlIGNoYW5nZXMgdGhhdCB3ZXJlIHNhdmVkLlxyXG5cdFx0XHRjaGVja3BvaW50ID0gdGhpcy5fY2hhbmdlTG9nLmNoZWNrcG9pbnQoXCJlbnN1cmVMb2FkZWRcIiArICsobmV3IERhdGUoKSkpO1xyXG5cclxuXHRcdFx0YXJncyA9IHtcclxuXHRcdFx0XHR0eXBlOiBcImVuc3VyZUxvYWRlZFwiLFxyXG5cdFx0XHRcdHRhcmdldDogdGFyZ2V0IGluc3RhbmNlb2YgRW50aXR5ID8gdGFyZ2V0IDogbnVsbCxcclxuXHRcdFx0XHRjaGVja3BvaW50OiBjaGVja3BvaW50LFxyXG5cdFx0XHRcdGluY2x1ZGVBbGxDaGFuZ2VzOiB0cnVlXHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwiZW5zdXJlTG9hZGVkQmVnaW5cIiwgW3RoaXMsIGFyZ3NdKTtcclxuXHJcblx0XHRcdC8vIENoZWNrIGlmIHRoZSBvYmplY3Qgb3IgYW55IG9mIHRoZSBwYXRocyByZXF1aXJlIGxvYWRpbmcuIEFwcGx5IHRoZSBhcnJheSBvZiBwYXRocyB0byB0aGVcclxuXHRcdFx0Ly8gaXNMb2FkZWQgY2FsbCwgc2luY2UgdGhlIHBhdGhzIHdpbGwgYmUgb2J0YWluZWQgYXMgXCJyZXN0XCIgcGFyYW1ldGVycy5cclxuXHRcdFx0aWYgKCFMYXp5TG9hZGVyLmlzTG9hZGVkLmFwcGx5KG51bGwsIFt0YXJnZXRdLmNvbmNhdChwYXRoc1RvTG9hZCkpKSB7XHJcblx0XHRcdFx0c2VyaWFsaXplZFRhcmdldCA9IHRhcmdldCBpbnN0YW5jZW9mIEVudGl0eSA/IHRvRXhvTW9kZWwodGFyZ2V0LCB0aGlzLl90cmFuc2xhdG9yKSA6IG51bGw7XHJcblxyXG5cdFx0XHRcdGFyZ3Mucm9vdCA9IHNlcmlhbGl6ZWRUYXJnZXQ7XHJcblxyXG5cdFx0XHRcdHRoaXMuX3JhaXNlRXZlbnQoXCJyZXF1ZXN0QmVnaW5cIiwgW3RoaXMsIGFyZ3NdKTtcclxuXHJcblx0XHRcdFx0Ly8gVE9ETzogcmVmZXJlbmNlIHRvIHNlcnZlciB3aWxsIGJlIGEgc2luZ2xldG9uLCBub3QgY29udGV4dFxyXG5cdFx0XHRcdG9iamVjdFByb3ZpZGVyKFxyXG5cdFx0XHRcdFx0dGFyZ2V0IGluc3RhbmNlb2YgRW50aXR5ID8gdGFyZ2V0Lm1ldGEudHlwZS5nZXRfZnVsbE5hbWUoKSA6IHRhcmdldC5nZXRfZnVsbE5hbWUoKSxcclxuXHRcdFx0XHRcdHRhcmdldCBpbnN0YW5jZW9mIEVudGl0eSA/IFt0YXJnZXQubWV0YS5pZF0gOiBbXSxcclxuXHRcdFx0XHRcdHBhdGhzVG9Mb2FkLFxyXG5cdFx0XHRcdFx0ZmFsc2UsIC8vIGluIHNjb3BlP1xyXG5cdFx0XHRcdFx0c2VyaWFsaXplQ2hhbmdlcy5jYWxsKHRoaXMsIHRydWUpLFxyXG5cdFx0XHRcdFx0dGhpcy5fb25FbnN1cmVMb2FkZWRTdWNjZXNzLmJpbmQodGhpcykuYXBwZW5kQXJndW1lbnRzKGFyZ3MsIGNoZWNrcG9pbnQsIHN1Y2Nlc3MpLFxyXG5cdFx0XHRcdFx0dGhpcy5fb25FbnN1cmVMb2FkZWRGYWlsZWQuYmluZCh0aGlzKS5hcHBlbmRBcmd1bWVudHMoYXJncywgZmFpbGVkIHx8IHN1Y2Nlc3MpKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHR2YXIgc2VsZiA9IHRoaXM7XHJcblx0XHRcdFx0d2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0YXJncy5yZXF1aXJlZExvYWRpbmcgPSBmYWxzZTtcclxuXHJcblx0XHRcdFx0XHRzZWxmLl9yYWlzZUV2ZW50KFwiZW5zdXJlTG9hZGVkRW5kXCIsIFtzZWxmLCBhcmdzXSk7XHJcblx0XHRcdFx0XHRzZWxmLl9yYWlzZUV2ZW50KFwiZW5zdXJlTG9hZGVkU3VjY2Vzc1wiLCBbc2VsZiwgYXJnc10pO1xyXG5cclxuXHRcdFx0XHRcdGlmIChzdWNjZXNzICYmIHN1Y2Nlc3MgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG5cdFx0XHRcdFx0XHRzdWNjZXNzKCk7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0cGVuZGluZ1JlcXVlc3RzLS07XHJcblx0XHRcdFx0fSwgMSk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRfb25FbnN1cmVMb2FkZWRTdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0LCBhcmdzLCBjaGVja3BvaW50LCBjYWxsYmFjaykge1xyXG5cdFx0XHRhcmdzLnJlc3BvbnNlT2JqZWN0ID0gcmVzdWx0O1xyXG5cdFx0XHRhcmdzLnJlcXVlc3RTdWNjZWVkZWQgPSB0cnVlO1xyXG5cclxuXHRcdFx0dGhpcy5fcmFpc2VFdmVudChcInJlcXVlc3RFbmRcIiwgW3RoaXMsIGFyZ3NdKTtcclxuXHJcblx0XHRcdHRoaXMuX2hhbmRsZVJlc3VsdChyZXN1bHQsIFwiZW5zdXJlTG9hZGVkXCIsIGNoZWNrcG9pbnQsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwicmVxdWVzdFN1Y2Nlc3NcIiwgW3RoaXMsIGFyZ3NdKTtcclxuXHJcblx0XHRcdFx0YXJncy5yZXF1aXJlZExvYWRpbmcgPSB0cnVlO1xyXG5cclxuXHRcdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwiZW5zdXJlTG9hZGVkRW5kXCIsIFt0aGlzLCBhcmdzXSk7XHJcblx0XHRcdFx0dGhpcy5fcmFpc2VFdmVudChcImVuc3VyZUxvYWRlZFN1Y2Nlc3NcIiwgW3RoaXMsIGFyZ3NdKTtcclxuXHJcblx0XHRcdFx0aWYgKGNhbGxiYWNrICYmIGNhbGxiYWNrIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuXHRcdFx0XHRcdGNhbGxiYWNrKHJlc3VsdCk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRwZW5kaW5nUmVxdWVzdHMtLTtcclxuXHRcdFx0fSk7XHJcblx0XHR9LFxyXG5cdFx0X29uRW5zdXJlTG9hZGVkRmFpbGVkOiBmdW5jdGlvbiAoZXJyb3IsIGFyZ3MsIGNhbGxiYWNrKSB7XHJcblx0XHRcdGFyZ3MucmVzcG9uc2VPYmplY3QgPSBlcnJvcjtcclxuXHRcdFx0YXJncy5yZXF1ZXN0U3VjY2VlZGVkID0gZmFsc2U7XHJcblxyXG5cdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwicmVxdWVzdEVuZFwiLCBbdGhpcywgYXJnc10pO1xyXG5cdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwicmVxdWVzdEZhaWxlZFwiLCBbdGhpcywgYXJnc10pO1xyXG5cclxuXHRcdFx0YXJncy5yZXF1aXJlZExvYWRpbmcgPSB0cnVlO1xyXG5cclxuXHRcdFx0dGhpcy5fcmFpc2VFdmVudChcImVuc3VyZUxvYWRlZEVuZFwiLCBbdGhpcywgYXJnc10pO1xyXG5cdFx0XHR0aGlzLl9yYWlzZUV2ZW50KFwiZW5zdXJlTG9hZGVkRmFpbGVkXCIsIFt0aGlzLCBhcmdzXSk7XHJcblxyXG5cdFx0XHRpZiAoY2FsbGJhY2sgJiYgY2FsbGJhY2sgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cGVuZGluZ1JlcXVlc3RzLS07XHJcblx0XHR9LFxyXG5cdFx0YWRkRW5zdXJlTG9hZGVkQmVnaW46IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX2FkZEV2ZW50KFwiZW5zdXJlTG9hZGVkQmVnaW5cIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0cmVtb3ZlRW5zdXJlTG9hZGVkQmVnaW46IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUV2ZW50KFwiZW5zdXJlTG9hZGVkQmVnaW5cIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0YWRkRW5zdXJlTG9hZGVkRW5kOiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9hZGRFdmVudChcImVuc3VyZUxvYWRlZEVuZFwiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRyZW1vdmVFbnN1cmVMb2FkZWRFbmQ6IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUV2ZW50KFwiZW5zdXJlTG9hZGVkRW5kXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHRcdGFkZEVuc3VyZUxvYWRlZFN1Y2Nlc3M6IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX2FkZEV2ZW50KFwiZW5zdXJlTG9hZGVkU3VjY2Vzc1wiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRyZW1vdmVFbnN1cmVMb2FkZWRTdWNjZXNzOiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9yZW1vdmVFdmVudChcImVuc3VyZUxvYWRlZFN1Y2Nlc3NcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0YWRkRW5zdXJlTG9hZGVkRmFpbGVkOiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9hZGRFdmVudChcImVuc3VyZUxvYWRlZEZhaWxlZFwiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRyZW1vdmVFbnN1cmVMb2FkZWRGYWlsZWQ6IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUV2ZW50KFwiZW5zdXJlTG9hZGVkRmFpbGVkXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHJcblx0XHQvLyBBcHBseSBDaGFuZ2VzXHJcblx0XHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cdFx0YXBwbHlDaGFuZ2VzOiBmdW5jdGlvbiAoY2hlY2twb2ludCwgY2hhbmdlcywgc291cmNlLCB1c2VyLCBzZXRJZCwgZGVzY3JpcHRpb24sIGZpbHRlciwgYmVmb3JlQXBwbHksIGFmdGVyQXBwbHksIGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRcdGlmICghY2hhbmdlcyB8fCAhKGNoYW5nZXMgaW5zdGFuY2VvZiBBcnJheSkpIHtcclxuXHRcdFx0XHRpZiAoY2FsbGJhY2spIHtcclxuXHRcdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoc291cmNlID09IG51bGwpIHRocm93IG5ldyBBcmd1bWVudE51bGxFcnJvcihcInNvdXJjZVwiKTtcclxuXHJcblx0XHRcdHZhciBuZXdDaGFuZ2VzID0gW107XHJcblxyXG5cdFx0XHR2YXIgc2lnbmFsID0gbmV3IFNpZ25hbChcImFwcGx5Q2hhbmdlc1wiKTtcclxuXHRcdFx0dmFyIHdhaXRGb3JBbGxSZWdpc3RlcmVkID0gZmFsc2U7XHJcblx0XHRcdHZhciBiYXRjaFN0YXJ0ZWQgPSBmYWxzZTtcclxuXHRcdFx0dmFyIGNoYW5nZXNBcHBseWluZyA9IGZhbHNlO1xyXG5cdFx0XHR2YXIgY2FsbGJhY2tJbnZva2VkID0gZmFsc2U7XHJcblx0XHRcdHZhciBtZXRob2RFeGl0ZWQgPSBmYWxzZTtcclxuXHJcblx0XHRcdHRyeSB7XHJcblx0XHRcdFx0dmFyIGJhdGNoID0gRXhvV2ViLkJhdGNoLnN0YXJ0KFwiYXBwbHkgY2hhbmdlc1wiKTtcclxuXHRcdFx0XHRiYXRjaFN0YXJ0ZWQgPSB0cnVlO1xyXG5cclxuXHRcdFx0XHR0aGlzLmJlZ2luQXBwbHlpbmdDaGFuZ2VzKCk7XHJcblx0XHRcdFx0Y2hhbmdlc0FwcGx5aW5nID0gdHJ1ZTtcclxuXHJcblx0XHRcdFx0dmFyIHByZXZpb3VzQWN0aXZlU2V0ID0gbnVsbDtcclxuXHJcblx0XHRcdFx0aWYgKHRoaXMuX2NoYW5nZUxvZy5hY3RpdmVTZXQpIHtcclxuXHRcdFx0XHRcdHByZXZpb3VzQWN0aXZlU2V0ID0gdGhpcy5fY2hhbmdlTG9nLmFjdGl2ZVNldDtcclxuXHJcblx0XHRcdFx0XHQvLyBTdG9wIHRoZSBhY3RpdmUgc2V0XHJcblx0XHRcdFx0XHR0aGlzLl9jaGFuZ2VMb2cuc3RvcCgpO1xyXG5cclxuXHRcdFx0XHRcdGlmICh0aGlzLl9jaGFuZ2VMb2cuY29tcHJlc3ModHJ1ZSwgdHJ1ZSkuaW5kZXhPZihwcmV2aW91c0FjdGl2ZVNldCkgPiAwKSB7XHJcblx0XHRcdFx0XHRcdC8vIElmIHRoZSBwcmV2aW91cyBhY3RpdmUgc2V0IHdhcyByZW1vdmVkLCB0aGVuIGRvbid0IHVzZSBpdCBsYXRlciBvbi5cclxuXHRcdFx0XHRcdFx0cHJldmlvdXNBY3RpdmVTZXQgPSBudWxsO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0dmFyIGNoYW5nZVNldCA9IHRoaXMuX2NoYW5nZUxvZy5hZGRTZXQoc291cmNlLCBkZXNjcmlwdGlvbiwgdXNlciwgbnVsbCwgc2V0SWQpO1xyXG5cclxuXHRcdFx0XHR0aGlzLl9jaGFuZ2VMb2cub25DaGFuZ2VTZXRTdGFydGVkKGNoYW5nZVNldCwgcHJldmlvdXNBY3RpdmVTZXQsIHByZXZpb3VzQWN0aXZlU2V0ID8gdGhpcy5fY2hhbmdlTG9nLnNldHMuaW5kZXhPZihwcmV2aW91c0FjdGl2ZVNldCkgOiAtMSwgdGhpcy5fY2hhbmdlTG9nKTtcclxuXHJcblx0XHRcdFx0Ly8gRGV0ZXJtaW5lIHRoYXQgdGhlIHRhcmdldCBvZiBhIGNoYW5nZSBpcyBhIG5ldyBpbnN0YW5jZVxyXG5cdFx0XHRcdHZhciBpbnN0YW5jZUlzTmV3ID0gZnVuY3Rpb24gKGNoYW5nZSkge1xyXG5cdFx0XHRcdFx0aWYgKEV4b1dlYi5Nb2RlbC5Nb2RlbC5nZXRKc1R5cGUoY2hhbmdlLmluc3RhbmNlLnR5cGUsIHRydWUpKSB7XHJcblx0XHRcdFx0XHRcdHZhciBvYmogPSBmcm9tRXhvTW9kZWwoY2hhbmdlLmluc3RhbmNlLCB0aGlzLl90cmFuc2xhdG9yKTtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIG9iaiAmJiBvYmoubWV0YS5pc05ldztcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0XHR9O1xyXG5cclxuXHRcdFx0XHQvLyB0cnVuY2F0ZSBjaGFuZ2UgbG9nIHVwLWZyb250IGlmIHNhdmUgb2NjdXJyZWRcclxuXHRcdFx0XHR2YXIgc2hvdWxkRGlzY2FyZENoYW5nZTtcclxuXHRcdFx0XHR2YXIgc2F2ZUNoYW5nZXMgPSBjaGFuZ2VzLmZpbHRlcihmdW5jdGlvbiAoYywgaSkgeyByZXR1cm4gYy50eXBlID09PSBcIlNhdmVcIjsgfSk7XHJcblx0XHRcdFx0dmFyIG51bVNhdmVDaGFuZ2VzID0gc2F2ZUNoYW5nZXMubGVuZ3RoO1xyXG5cdFx0XHRcdGlmIChudW1TYXZlQ2hhbmdlcyA+IDApIHtcclxuXHRcdFx0XHRcdC8vIENvbGxlY3QgYWxsIG9mIHRoZSBpZCBjaGFuZ2VzIGluIHRoZSByZXNwb25zZS4gTXVsdGlwbGUgc2F2ZXMgY291bGQgb2NjdXIuXHJcblx0XHRcdFx0XHR2YXIgaWRDaGFuZ2VzID0gc2F2ZUNoYW5nZXMubWFwVG9BcnJheShmdW5jdGlvbiAoY2hhbmdlKSB7IHJldHVybiBjaGFuZ2UuYWRkZWQgfHwgW107IH0pO1xyXG5cclxuXHRcdFx0XHRcdC8vIENyZWF0ZSBhIGxpc3Qgb2YgbmV3IGluc3RhbmNlcyB0aGF0IHdlcmUgc2F2ZWQuIFVzZSBhIHR5cGVkIGlkZW50aWZpZXIgZm9ybSBzaW5jZSB0aGUgaWQgc3RvcmVkXHJcblx0XHRcdFx0XHQvLyBpbiBjaGFuZ2VzIGluIHRoZSBjaGFuZ2UgbG9nIHdpbGwgYmUgYSBzZXJ2ZXIgaWQgcmF0aGVyIHRoYW4gY2xpZW50IGlkIChpZiB0aGVyZSBpcyBhIGRpc3RpbmN0aW9uKVxyXG5cdFx0XHRcdFx0Ly8gYW5kIHVzaW5nIHRoZSB0eXBlZCBpZGVudGlmaWVyIGFwcHJvYWNoIGFsbG93cyBmb3IgYSBzdHJhaWdodGZvcndhcmQgc2VhcmNoIG9mIHRoZSBhcnJheS5cclxuXHRcdFx0XHRcdHZhciBuZXdJbnN0YW5jZXNTYXZlZCA9IGlkQ2hhbmdlcy5tYXAoZnVuY3Rpb24gKGlkQ2hhbmdlKSB7IHJldHVybiBpZENoYW5nZS50eXBlICsgXCJ8XCIgKyBpZENoYW5nZS5vbGRJZDsgfSk7XHJcblxyXG5cdFx0XHRcdFx0Ly8gVHJ1bmNhdGUgY2hhbmdlcyB0aGF0IHdlIGJlbGlldmUgd2VyZSBhY3R1YWxseSBzYXZlZCBiYXNlZCBvbiB0aGUgcmVzcG9uc2VcclxuXHRcdFx0XHRcdHNob3VsZERpc2NhcmRDaGFuZ2UgPSBmdW5jdGlvbiAoY2hhbmdlKSB7XHJcblx0XHRcdFx0XHRcdHZhciBjb3VsZEhhdmVCZWVuU2F2ZWQsIGlzTmV3T2JqZWN0Tm90WWV0U2F2ZWQ7XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBEZXRlcm1pbmUgaWYgdGhlIGNoYW5nZSBjb3VsZCBoYXZlIGJlZW4gc2F2ZWQgaW4gdGhlIGZpcnN0IHBsYWNlXHJcblx0XHRcdFx0XHRcdGNvdWxkSGF2ZUJlZW5TYXZlZCA9IHRoaXMuY2FuU2F2ZShjaGFuZ2UpO1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gRGV0ZXJtaW5lIGlmIHRoZSBjaGFuZ2UgdGFyZ2V0cyBhIG5ldyBvYmplY3QgdGhhdCBoYXMgbm90IGJlZW4gc2F2ZWRcclxuXHRcdFx0XHRcdFx0aXNOZXdPYmplY3ROb3RZZXRTYXZlZCA9IGNoYW5nZS5pbnN0YW5jZSAmJiAoY2hhbmdlLmluc3RhbmNlLmlzTmV3IHx8IGluc3RhbmNlSXNOZXcuY2FsbCh0aGlzLCBjaGFuZ2UpKSAmJiAhbmV3SW5zdGFuY2VzU2F2ZWQuY29udGFpbnMoY2hhbmdlLmluc3RhbmNlLnR5cGUgKyBcInxcIiArIGNoYW5nZS5pbnN0YW5jZS5pZCk7XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBSZXR1cm4gYSB2YWx1ZSBpbmRpY2F0aW5nIHdoZXRoZXIgb3Igbm90IHRoZSBjaGFuZ2Ugc2hvdWxkIGJlIHJlbW92ZWRcclxuXHRcdFx0XHRcdFx0cmV0dXJuIGNvdWxkSGF2ZUJlZW5TYXZlZCAmJiAhaXNOZXdPYmplY3ROb3RZZXRTYXZlZDtcclxuXHRcdFx0XHRcdH07XHJcblxyXG5cdFx0XHRcdFx0Ly8gVHJ1bmNhdGUgY2hhbmdlcyB0aGF0IHdlIGJlbGlldmUgd2VyZSBhY3R1YWxseSBzYXZlZCBiYXNlZCBvbiB0aGUgcmVzcG9uc2VcclxuXHRcdFx0XHRcdHRoaXMuX2NoYW5nZUxvZy50cnVuY2F0ZShjaGVja3BvaW50LCBzaG91bGREaXNjYXJkQ2hhbmdlLmJpbmQodGhpcykpO1xyXG5cdFx0XHRcdFx0dGhpcy5fY2hhbmdlTG9nLnN0YXJ0KHsgdXNlcjogdGhpcy5fbG9jYWxVc2VyIH0pO1xyXG5cclxuXHRcdFx0XHRcdC8vIFVwZGF0ZSBhZmZlY3RlZCBzY29wZSBxdWVyaWVzXHJcblx0XHRcdFx0XHRpZENoYW5nZXMuZm9yRWFjaChmdW5jdGlvbiAoaWRDaGFuZ2UpIHtcclxuXHRcdFx0XHRcdFx0dmFyIGpzdHlwZSA9IEV4b1dlYi5Nb2RlbC5Nb2RlbC5nZXRKc1R5cGUoaWRDaGFuZ2UudHlwZSwgdHJ1ZSk7XHJcblx0XHRcdFx0XHRcdGlmIChqc3R5cGUgJiYgTGF6eUxvYWRlci5pc0xvYWRlZChqc3R5cGUubWV0YSkpIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgc2VydmVyT2xkSWQgPSBpZENoYW5nZS5vbGRJZDtcclxuXHRcdFx0XHRcdFx0XHR2YXIgY2xpZW50T2xkSWQgPSAhKGlkQ2hhbmdlLm9sZElkIGluIGpzdHlwZS5tZXRhLl9wb29sKSA/XHJcblx0XHRcdFx0XHRcdFx0XHR0aGlzLl90cmFuc2xhdG9yLnJldmVyc2UoaWRDaGFuZ2UudHlwZSwgc2VydmVyT2xkSWQpIDpcclxuXHRcdFx0XHRcdFx0XHRcdGlkQ2hhbmdlLm9sZElkO1xyXG5cdFx0XHRcdFx0XHRcdHRoaXMuX3Njb3BlUXVlcmllcy5mb3JFYWNoKGZ1bmN0aW9uIChxdWVyeSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0cXVlcnkuaWRzID0gcXVlcnkuaWRzLm1hcChmdW5jdGlvbiAoaWQpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIChpZCA9PT0gY2xpZW50T2xkSWQpID8gaWRDaGFuZ2UubmV3SWQgOiBpZDtcclxuXHRcdFx0XHRcdFx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHRcdFx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHZhciBudW1QZW5kaW5nU2F2ZUNoYW5nZXMgPSBudW1TYXZlQ2hhbmdlcztcclxuXHJcblx0XHRcdFx0Y2hhbmdlcy5mb3JFYWNoKGZ1bmN0aW9uIChjaGFuZ2UpIHtcclxuXHRcdFx0XHRcdGlmIChjaGFuZ2UudHlwZSA9PT0gXCJJbml0TmV3XCIpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5hcHBseUluaXRDaGFuZ2UoY2hhbmdlLCBiZWZvcmVBcHBseSwgYWZ0ZXJBcHBseSwgc2lnbmFsLnBlbmRpbmcoKSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIGlmIChjaGFuZ2UudHlwZSA9PT0gXCJSZWZlcmVuY2VDaGFuZ2VcIikge1xyXG5cdFx0XHRcdFx0XHR0aGlzLmFwcGx5UmVmQ2hhbmdlKGNoYW5nZSwgYmVmb3JlQXBwbHksIGFmdGVyQXBwbHksIHNpZ25hbC5wZW5kaW5nKCkpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAoY2hhbmdlLnR5cGUgPT09IFwiVmFsdWVDaGFuZ2VcIikge1xyXG5cdFx0XHRcdFx0XHR0aGlzLmFwcGx5VmFsQ2hhbmdlKGNoYW5nZSwgYmVmb3JlQXBwbHksIGFmdGVyQXBwbHksIHNpZ25hbC5wZW5kaW5nKCkpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAoY2hhbmdlLnR5cGUgPT09IFwiTGlzdENoYW5nZVwiKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuYXBwbHlMaXN0Q2hhbmdlKGNoYW5nZSwgYmVmb3JlQXBwbHksIGFmdGVyQXBwbHksIHNpZ25hbC5wZW5kaW5nKCkpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAoY2hhbmdlLnR5cGUgPT09IFwiU2F2ZVwiKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuYXBwbHlTYXZlQ2hhbmdlKGNoYW5nZSwgYmVmb3JlQXBwbHksIGFmdGVyQXBwbHksIHNpZ25hbC5wZW5kaW5nKCkpO1xyXG5cdFx0XHRcdFx0XHRudW1QZW5kaW5nU2F2ZUNoYW5nZXMtLTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRpZiAoY2hhbmdlLnR5cGUgIT09IFwiU2F2ZVwiKSB7XHJcblx0XHRcdFx0XHRcdHZhciBub09iamVjdHNXZXJlU2F2ZWQgPSBudW1TYXZlQ2hhbmdlcyA9PT0gMDtcclxuXHRcdFx0XHRcdFx0dmFyIGhhc1BlbmRpbmdTYXZlQ2hhbmdlcyA9IG51bVBlbmRpbmdTYXZlQ2hhbmdlcyA+IDA7XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBPbmx5IHJlY29yZCBhIGNoYW5nZSBpZiB0aGVyZSBpcyBub3QgYSBwZW5kaW5nIHNhdmUgY2hhbmdlLCBhbHNvIHRha2UgaW50byBhY2NvdW50IG5ldyBpbnN0YW5jZXMgdGhhdCBhcmUgbm90IHNhdmVkXHJcblx0XHRcdFx0XHRcdGlmIChub09iamVjdHNXZXJlU2F2ZWQgfHwgIWhhc1BlbmRpbmdTYXZlQ2hhbmdlcyB8fCAhc2hvdWxkRGlzY2FyZENoYW5nZS5jYWxsKHRoaXMsIGNoYW5nZSkpIHtcclxuXHRcdFx0XHRcdFx0XHQvLyBBcHBseSBhZGRpdGlvbmFsIGZpbHRlclxyXG5cdFx0XHRcdFx0XHRcdGlmICghZmlsdGVyIHx8IGZpbHRlcihjaGFuZ2UpID09PSB0cnVlKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRuZXdDaGFuZ2VzLnB1c2goY2hhbmdlKTtcclxuXHRcdFx0XHRcdFx0XHRcdGNoYW5nZVNldC5hZGQoY2hhbmdlKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9LCB0aGlzKTtcclxuXHJcblx0XHRcdFx0Ly8gU3RhcnQgYSBuZXcgY2hhbmdlIHNldCB0byBjYXB0dXJlIGZ1dHVyZSBjaGFuZ2VzLlxyXG5cdFx0XHRcdGlmICh0aGlzLmlzQ2FwdHVyaW5nQ2hhbmdlcygpKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9jaGFuZ2VMb2cuc3RhcnQoeyB1c2VyOiB0aGlzLl9sb2NhbFVzZXIgfSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHR3YWl0Rm9yQWxsUmVnaXN0ZXJlZCA9IHRydWU7XHJcblx0XHRcdFx0c2lnbmFsLndhaXRGb3JBbGwoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0Ly8gVGhlIG1ldGhvZCBoYXMgbm90IHlldCBleGl0ZWQsIHdoaWNoIG1lYW5zIHRoYXQgdGVhcmRvd24gaXMgaGFwcGVuaW5nXHJcblx0XHRcdFx0XHQvLyBzeW5jaHJvbm91c2x5LCBzbyBlbmQgYXBwbHlpbmcgY2hhbmdlcyBiZWZvcmUgaW52b2tpbmcgdGhlIGNhbGxiYWNrLlxyXG5cdFx0XHRcdFx0aWYgKCFtZXRob2RFeGl0ZWQpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5lbmRBcHBseWluZ0NoYW5nZXMoKTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRFeG9XZWIuQmF0Y2guZW5kKGJhdGNoKTtcclxuXHJcblx0XHRcdFx0XHRpZiAoY2FsbGJhY2spIHtcclxuXHRcdFx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGNhbGxiYWNrSW52b2tlZCA9IHRydWU7XHJcblx0XHRcdFx0fSwgdGhpcywgdHJ1ZSk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZmluYWxseSB7XHJcblx0XHRcdFx0Ly8gVGhlICd0ZWFyZG93bicgY2FsbGJhY2sgd2FzIG5vdCBpbnZva2VkLCBlaXRoZXIgYmVjYXVzZSBvZiBhbiBlcnJvciBvciBiZWNhdXNlXHJcblx0XHRcdFx0Ly8gb2YgZGVsYXllZCBleGVjdXRpb24gb2YgdGhlIHRlYXJkb3duIHJvdXRpbmUsIHNvIGVuZCBhcHBseWluZyBjaGFuZ2VzIGltbWVkaWF0ZWx5LlxyXG5cdFx0XHRcdGlmIChjaGFuZ2VzQXBwbHlpbmcgJiYgIWNhbGxiYWNrSW52b2tlZCkge1xyXG5cdFx0XHRcdFx0dGhpcy5lbmRBcHBseWluZ0NoYW5nZXMoKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIEFuIGVycm9yIG9jY3VycmVkIGFmdGVyIHRoZSBiYXRjaCB3YXMgc3RhcnRlZCBidXQgYmVmb3JlIHRoZSAndGVhcmRvd24nIGNhbGxiYWNrXHJcblx0XHRcdFx0Ly8gd2FzIHJlZ2lzdGVyZWQgKHdoaWNoIHdvdWxkIG5vcm1hbGx5IGVuZCB0aGUgYmF0Y2gpIHNvIGVuZCBpdCBpbW1lZGlhdGVseS5cclxuXHRcdFx0XHRpZiAoYmF0Y2hTdGFydGVkICYmICF3YWl0Rm9yQWxsUmVnaXN0ZXJlZCkge1xyXG5cdFx0XHRcdFx0RXhvV2ViLkJhdGNoLmVuZChiYXRjaCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAobmV3Q2hhbmdlcy5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0dGhpcy5fcmFpc2VFdmVudChcImNoYW5nZXNEZXRlY3RlZFwiLCBbdGhpcywgeyByZWFzb246IFwiYXBwbHlDaGFuZ2VzXCIsIGNoYW5nZXM6IG5ld0NoYW5nZXMgfV0pO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBBbGxvdyBwb3RlbnRpYWxseSBhc3luY2hyb25vdXMgY2FsbGJhY2tzIHRvIGRldGVjdCB0aGF0IHRoZVxyXG5cdFx0XHQvLyBtZXRob2QgaGFzIGFscmVhZHkgZXhpdGVkIHZpYSBhIGNsb3N1cmUgb24gdGhpcyB2YXJpYWJsZS5cclxuXHRcdFx0bWV0aG9kRXhpdGVkID0gdHJ1ZTtcclxuXHRcdH0sXHJcblx0XHRhcHBseVNhdmVDaGFuZ2U6IGZ1bmN0aW9uIChjaGFuZ2UsIGJlZm9yZSwgYWZ0ZXIsIGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRcdGlmICghKGNoYW5nZS5hZGRlZCB8fCBjaGFuZ2UuZGVsZXRlZCkpIHtcclxuXHRcdFx0XHRpZiAoY2FsbGJhY2spIHtcclxuXHRcdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRjaGFuZ2UuZGVsZXRlZC5mb3JFYWNoKGZ1bmN0aW9uIChpbnN0YW5jZSkge1xyXG5cdFx0XHRcdHRyeUdldEpzVHlwZSh0aGlzLm1vZGVsLCBpbnN0YW5jZS50eXBlLCBudWxsLCBmYWxzZSwgZnVuY3Rpb24gKHR5cGUpIHtcclxuXHRcdFx0XHRcdHRyeUdldEVudGl0eSh0aGlzLm1vZGVsLCB0aGlzLl90cmFuc2xhdG9yLCB0eXBlLCBpbnN0YW5jZS5pZCwgbnVsbCwgTGF6eUxvYWRFbnVtLk5vbmUsIHRoaXMuaWdub3JlQ2hhbmdlcyhiZWZvcmUsIGZ1bmN0aW9uIChvYmopIHtcclxuXHRcdFx0XHRcdFx0Ly8gTm90aWZ5IHNlcnZlciBvYmplY3QgdGhhdCB0aGUgaW5zdGFuY2UgaXMgZGVsZXRlZFxyXG5cdFx0XHRcdFx0XHR0aGlzLm5vdGlmeURlbGV0ZWQob2JqKTtcclxuXHRcdFx0XHRcdFx0Ly8gU2ltcGx5IGEgbWFya2VyIGZsYWcgZm9yIGRlYnVnZ2luZyBwdXJwb3Nlc1xyXG5cdFx0XHRcdFx0XHRvYmoubWV0YS5pc0RlbGV0ZWQgPSB0cnVlO1xyXG5cdFx0XHRcdFx0XHQvLyBVbnJlZ2lzdGVyIHRoZSBvYmplY3Qgc28gdGhhdCBpdCBjYW4ndCBiZSByZXRyaWV2ZWQgdmlhIGdldCwga25vd24sIG9yIGhhdmUgcnVsZXMgZXhlY3V0ZSBhZ2FpbnN0IGl0XHJcblx0XHRcdFx0XHRcdHR5cGUubWV0YS51bnJlZ2lzdGVyKG9iaik7XHJcblx0XHRcdFx0XHRcdC8vIFJlbW92ZSBhZmZlY3RlZCBzY29wZSBxdWVyaWVzXHJcblx0XHRcdFx0XHRcdHRoaXMuX3Njb3BlUXVlcmllcy5wdXJnZShmdW5jdGlvbiAocXVlcnkpIHtcclxuXHRcdFx0XHRcdFx0XHQvLyBSZW1vdmUgdGhlIGRlbGV0ZWQgb2JqZWN0J3MgaWQgZnJvbSB0aGUgc2NvcGUgcXVlcnlcclxuXHRcdFx0XHRcdFx0XHRxdWVyeS5pZHMucHVyZ2UoZnVuY3Rpb24gKGlkKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gKGlkID09PSBvYmoubWV0YS5pZCk7XHJcblx0XHRcdFx0XHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdFx0XHRcdFx0Ly8gUmVtb3ZlIHRoZSBzY29wZSBxdWVyeSBpZiBpdCBpcyBlbXB0eVxyXG5cdFx0XHRcdFx0XHRcdHJldHVybiBxdWVyeS5pZHMubGVuZ3RoID09PSAwO1xyXG5cdFx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0XHRcdH0sIGFmdGVyKSwgdGhpcyk7XHJcblx0XHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdH0sIHRoaXMpO1xyXG5cclxuXHRcdFx0Y2hhbmdlLmFkZGVkLmZvckVhY2goZnVuY3Rpb24gKGlkQ2hhbmdlLCBpZENoYW5nZUluZGV4KSB7XHJcblx0XHRcdFx0ZW5zdXJlSnNUeXBlKHRoaXMubW9kZWwsIGlkQ2hhbmdlLnR5cGUsIHRoaXMuaWdub3JlQ2hhbmdlcyhiZWZvcmUsIGZ1bmN0aW9uIChqc3R5cGUpIHtcclxuXHRcdFx0XHRcdHZhciBzZXJ2ZXJPbGRJZCA9IGlkQ2hhbmdlLm9sZElkO1xyXG5cdFx0XHRcdFx0dmFyIGNsaWVudE9sZElkID0gIShpZENoYW5nZS5vbGRJZCBpbiBqc3R5cGUubWV0YS5fcG9vbCkgP1xyXG5cdFx0XHRcdFx0XHRcdHRoaXMuX3RyYW5zbGF0b3IucmV2ZXJzZShpZENoYW5nZS50eXBlLCBzZXJ2ZXJPbGRJZCkgOlxyXG5cdFx0XHRcdFx0XHRcdGlkQ2hhbmdlLm9sZElkO1xyXG5cclxuXHRcdFx0XHRcdC8vIElmIHRoZSBjbGllbnQgcmVjb2duaXplcyB0aGUgb2xkIGlkIHRoZW4gdGhpcyBpcyBhbiBvYmplY3Qgd2UgaGF2ZSBzZWVuIGJlZm9yZVxyXG5cdFx0XHRcdFx0aWYgKGNsaWVudE9sZElkKSB7XHJcblx0XHRcdFx0XHRcdHZhciB0eXBlID0gdGhpcy5tb2RlbC50eXBlKGlkQ2hhbmdlLnR5cGUpO1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gQXR0ZW1wdCB0byBsb2FkIHRoZSBvYmplY3Qgd2hvcyBpZCBpcyBjaGFuZ2luZy5cclxuXHRcdFx0XHRcdFx0dmFyIG9iaiA9IHR5cGUuZ2V0KFxyXG5cdFx0XHRcdFx0XHRcdC8vIExvYWQgdGhlIG9iamVjdCB1c2luZyB0aGUgb2JqZWN0J3MgaWQgcHJpb3IgdG8gc2F2aW5nLlxyXG5cdFx0XHRcdFx0XHRcdGNsaWVudE9sZElkLFxyXG5cclxuXHRcdFx0XHRcdFx0XHQvLyBXaGVuIHByb2Nlc3Npbmcgc2VydmVyLXNpZGUgY2hhbmdlcyB3ZSBjYW4gZXhwZWN0IHRoYXQgdGhlIHR5cGUgb2YgdGhlIGluc3RhbmNlXHJcblx0XHRcdFx0XHRcdFx0Ly8gaXMgZXhhY3RseSB0aGUgdHlwZSBzcGVjaWZpZWQgaW4gdGhlIGNoYW5nZSBvYmplY3QsIG5vdCBhIGJhc2UgdHlwZS4gXHJcblx0XHRcdFx0XHRcdFx0dHJ1ZVxyXG5cdFx0XHRcdFx0XHQpO1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gRW5zdXJlIHRoYXQgdGhlIG9iamVjdCBleGlzdHMuXHJcblx0XHRcdFx0XHRcdGlmICghb2JqKSB7XHJcblx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCRmb3JtYXQoXHJcblx0XHRcdFx0XHRcdFx0XHRcIlVuYWJsZSB0byBjaGFuZ2UgaWQgZm9yIG9iamVjdCBvZiB0eXBlIFxcXCJ7MH1cXFwiIGZyb20gXFxcInsxfVxcXCIgdG8gXFxcInsyfVxcXCIgc2luY2UgdGhlIG9iamVjdCBjb3VsZCBub3QgYmUgZm91bmQuXCIsXHJcblx0XHRcdFx0XHRcdFx0XHRqc3R5cGUubWV0YS5nZXRfZnVsbE5hbWUoKSwgaWRDaGFuZ2Uub2xkSWQsIGlkQ2hhbmdlLm5ld0lkKSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdC8vIENoYW5nZSB0aGUgaWQgYW5kIG1ha2Ugbm9uLW5ldy5cclxuXHRcdFx0XHRcdFx0dHlwZS5jaGFuZ2VPYmplY3RJZChjbGllbnRPbGRJZCwgaWRDaGFuZ2UubmV3SWQpO1xyXG5cdFx0XHRcdFx0XHRPYnNlcnZlci5zZXRWYWx1ZShvYmoubWV0YSwgXCJpc05ld1wiLCBmYWxzZSk7XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBVcGRhdGUgYWZmZWN0ZWQgc2NvcGUgcXVlcmllc1xyXG5cdFx0XHRcdFx0XHR0aGlzLl9zY29wZVF1ZXJpZXMuZm9yRWFjaChmdW5jdGlvbiAocXVlcnkpIHtcclxuXHRcdFx0XHRcdFx0XHRxdWVyeS5pZHMgPSBxdWVyeS5pZHMubWFwKGZ1bmN0aW9uIChpZCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIChpZCA9PT0gY2xpZW50T2xkSWQpID8gaWRDaGFuZ2UubmV3SWQgOiBpZDtcclxuXHRcdFx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0fSwgdGhpcyk7XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBVcGRhdGUgcG9zdC1zYXZlIGNoYW5nZXMgd2l0aCBuZXcgaWRcclxuXHRcdFx0XHRcdFx0ZnVuY3Rpb24gZml4Q2hhbmdlSW5zdGFuY2VEdWVUb0lkQ2hhbmdlKGluc3QpIHtcclxuXHRcdFx0XHRcdFx0XHRpZiAoaW5zdCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0dmFyIGpzdHlwZSA9IE1vZGVsLmdldEpzVHlwZShpbnN0LnR5cGUsIHRydWUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKGpzdHlwZSAmJiBvYmogPT09IGZyb21FeG9Nb2RlbChpbnN0LCB0aGlzLl90cmFuc2xhdG9yKSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRpbnN0LmlkID0gaWRDaGFuZ2UubmV3SWQ7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGluc3QuaXNOZXcgPSBmYWxzZTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdHRoaXMuX2NoYW5nZUxvZy5zZXRzLmZvckVhY2goZnVuY3Rpb24gKHNldCkge1xyXG5cdFx0XHRcdFx0XHRcdHNldC5jaGFuZ2VzLmZvckVhY2goZnVuY3Rpb24gKGNoYW5nZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gT25seSBwcm9jZXNzIGNoYW5nZXMgdG8gbW9kZWwgaW5zdGFuY2VzXHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoIWNoYW5nZS5pbnN0YW5jZSkgcmV0dXJuO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdGZpeENoYW5nZUluc3RhbmNlRHVlVG9JZENoYW5nZS5jYWxsKHRoaXMsIGNoYW5nZS5pbnN0YW5jZSk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gRm9yIGxpc3QgY2hhbmdlcyBhZGRpdGlvbmFsbHkgY2hlY2sgYWRkZWQgYW5kIHJlbW92ZWQgb2JqZWN0cy5cclxuXHRcdFx0XHRcdFx0XHRcdGlmIChjaGFuZ2UudHlwZSA9PT0gXCJMaXN0Q2hhbmdlXCIpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gZ2V0IHRoZSBqc1R5cGUgb2YgdGhlIG9iamVjdCB0aGF0IGNvbnRhaW5zIHRoZSBsaXN0XHJcblx0XHRcdFx0XHRcdFx0XHRcdHZhciBqc1R5cGUgPSBNb2RlbC5nZXRKc1R5cGUoY2hhbmdlLmluc3RhbmNlLnR5cGUsIHRydWUpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKGpzVHlwZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChqc1R5cGUubWV0YS5wcm9wZXJ0eShjaGFuZ2UucHJvcGVydHkpLmdldF9pc0VudGl0eUxpc3RUeXBlKCkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChjaGFuZ2UuYWRkZWQubGVuZ3RoID4gMClcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Y2hhbmdlLmFkZGVkLmZvckVhY2goZml4Q2hhbmdlSW5zdGFuY2VEdWVUb0lkQ2hhbmdlLCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChjaGFuZ2UucmVtb3ZlZC5sZW5ndGggPiAwKVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRjaGFuZ2UucmVtb3ZlZC5mb3JFYWNoKGZpeENoYW5nZUluc3RhbmNlRHVlVG9JZENoYW5nZSwgdGhpcyk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHQvLyBGb3IgcmVmZXJlbmNlIGNoYW5nZXMgYWRkaXRpb25hbGx5IGNoZWNrIG9sZFZhbHVlL25ld1ZhbHVlXHJcblx0XHRcdFx0XHRcdFx0XHRlbHNlIGlmIChjaGFuZ2UudHlwZSA9PT0gXCJSZWZlcmVuY2VDaGFuZ2VcIikge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRmaXhDaGFuZ2VJbnN0YW5jZUR1ZVRvSWRDaGFuZ2UuY2FsbCh0aGlzLCBjaGFuZ2Uub2xkVmFsdWUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRmaXhDaGFuZ2VJbnN0YW5jZUR1ZVRvSWRDaGFuZ2UuY2FsbCh0aGlzLCBjaGFuZ2UubmV3VmFsdWUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdC8vIE90aGVyd2lzZSwgbG9nIGFuIGVycm9yLlxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdGxvZ1dhcm5pbmcoJGZvcm1hdChcIkNhbm5vdCBhcHBseSBpZCBjaGFuZ2Ugb24gdHlwZSBcXFwiezB9XFxcIiBzaW5jZSBvbGQgaWQgXFxcInsxfVxcXCIgd2FzIG5vdCBmb3VuZC5cIiwgaWRDaGFuZ2UudHlwZSwgaWRDaGFuZ2Uub2xkSWQpKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9LCBhZnRlciksIHRoaXMpO1xyXG5cdFx0XHR9LCB0aGlzKTtcclxuXHJcblx0XHRcdC8vIENhbGxiYWNrIGltbWVkaWF0ZWx5IHNpbmNlIG5vdGhpbmcgd2lsbCBiZSBmb3JjZSBsb2FkZWRcclxuXHRcdFx0aWYgKGNhbGxiYWNrKSB7XHJcblx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0YXBwbHlJbml0Q2hhbmdlOiBmdW5jdGlvbiAoY2hhbmdlLCBiZWZvcmUsIGFmdGVyLCBjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0XHR0cnlHZXRKc1R5cGUodGhpcy5tb2RlbCwgY2hhbmdlLmluc3RhbmNlLnR5cGUsIG51bGwsIGZhbHNlLCB0aGlzLmlnbm9yZUNoYW5nZXMoYmVmb3JlLCBmdW5jdGlvbiAoanN0eXBlKSB7XHJcblxyXG5cdFx0XHRcdC8vIEF0dGVtcHQgdG8gZmV0Y2ggdGhlIG9iamVjdCBpbiBjYXNlIGl0IGhhcyBhbHJlYWR5IGJlZW4gY3JlYXRlZC5cclxuXHRcdFx0XHR2YXIgbmV3T2JqID0ganN0eXBlLm1ldGEuZ2V0KFxyXG5cdFx0XHRcdFx0Ly8gU2luY2UgdGhlIG9iamVjdCBpcyBiZWluZyBuZXdseSBjcmVhdGVkLCB3ZSBjYW4gdXNlIHRoZSBzZXJ2ZXItZ2VuZXJhdGVkIGlkLlxyXG5cdFx0XHRcdFx0Y2hhbmdlLmluc3RhbmNlLmlkLFxyXG5cclxuXHRcdFx0XHRcdC8vIFdoZW4gcHJvY2Vzc2luZyBzZXJ2ZXItc2lkZSBjaGFuZ2VzIHdlIGNhbiBleHBlY3QgdGhhdCB0aGUgdHlwZSBvZiB0aGUgaW5zdGFuY2VcclxuXHRcdFx0XHRcdC8vIGlzIGV4YWN0bHkgdGhlIHR5cGUgc3BlY2lmaWVkIGluIHRoZSBjaGFuZ2Ugb2JqZWN0LCBub3QgYSBiYXNlIHR5cGUuIFxyXG5cdFx0XHRcdFx0dHJ1ZVxyXG5cdFx0XHRcdCk7XHJcblxyXG5cdFx0XHRcdGlmICghbmV3T2JqKSB7XHJcblx0XHRcdFx0XHQvLyBDaGVjayBmb3IgYSB0cmFuc2xhdGlvbiBiZXR3ZWVuIHRoZSBvbGQgaWQgdGhhdCB3YXMgcmVwb3J0ZWQgYW5kIGFuIGFjdHVhbCBvbGQgaWQuICBUaGlzIGlzXHJcblx0XHRcdFx0XHQvLyBuZWVkZWQgc2luY2UgbmV3IG9iamVjdHMgdGhhdCBhcmUgY3JlYXRlZCBvbiB0aGUgc2VydmVyIGFuZCB0aGVuIGNvbW1pdHRlZCB3aWxsIHJlc3VsdCBpbiBhbiBhY2N1cmF0ZVxyXG5cdFx0XHRcdFx0Ly8gaWQgY2hhbmdlIHJlY29yZCwgYnV0IFwiaW5zdGFuY2UuaWRcIiBmb3IgdGhpcyBjaGFuZ2Ugd2lsbCBhY3R1YWxseSBiZSB0aGUgcGVyc2lzdGVkIGlkLlxyXG5cdFx0XHRcdFx0dmFyIHNlcnZlck9sZElkID0gdGhpcy5fdHJhbnNsYXRvci5mb3J3YXJkKGNoYW5nZS5pbnN0YW5jZS50eXBlLCBjaGFuZ2UuaW5zdGFuY2UuaWQpIHx8IGNoYW5nZS5pbnN0YW5jZS5pZDtcclxuXHJcblx0XHRcdFx0XHRsYXp5Q3JlYXRlRW50aXR5KGNoYW5nZS5pbnN0YW5jZS50eXBlLCBzZXJ2ZXJPbGRJZCwgdGhpcy5pZ25vcmVDaGFuZ2VzKGJlZm9yZSwgZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0XHQvLyBDcmVhdGUgdGhlIG5ldyBvYmplY3QgKHN1cHJlc3MgZXZlbnRzKVxyXG5cdFx0XHRcdFx0XHRuZXdPYmogPSBuZXcganN0eXBlKG51bGwsIG51bGwsIHRydWUpO1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gUmVtZW1iZXIgdGhlIG9iamVjdCdzIGNsaWVudC1nZW5lcmF0ZWQgbmV3IGlkIGFuZCB0aGUgY29ycmVzcG9uZGluZyBzZXJ2ZXItZ2VuZXJhdGVkIG5ldyBpZFxyXG5cdFx0XHRcdFx0XHR0aGlzLl90cmFuc2xhdG9yLmFkZChjaGFuZ2UuaW5zdGFuY2UudHlwZSwgbmV3T2JqLm1ldGEuaWQsIHNlcnZlck9sZElkKTtcclxuXHJcblx0XHRcdFx0XHRcdC8vIFJhaXNlIGV2ZW50IGFmdGVyIHJlY29yZGluZyBpZCBtYXBwaW5nIHNvIHRoYXQgbGlzdGVuZXJzIGNhbiBsZXZlcmFnZSBpdFxyXG5cdFx0XHRcdFx0XHR0aGlzLm1vZGVsLm5vdGlmeU9iamVjdFJlZ2lzdGVyZWQobmV3T2JqKTtcclxuXHJcblx0XHRcdFx0XHRcdHJldHVybiBuZXdPYmo7XHJcblx0XHRcdFx0XHR9LCBhZnRlciksIHRoaXMpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSwgYWZ0ZXIpLCB0aGlzKTtcclxuXHJcblx0XHRcdC8vIENhbGxiYWNrIGltbWVkaWF0ZWx5IHNpbmNlIG5vdGhpbmcgd2lsbCBiZSBmb3JjZSBsb2FkZWRcclxuXHRcdFx0aWYgKGNhbGxiYWNrKSB7XHJcblx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0YXBwbHlSZWZDaGFuZ2U6IGZ1bmN0aW9uIChjaGFuZ2UsIGJlZm9yZSwgYWZ0ZXIsIGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRcdHZhciBoYXNFeGl0ZWQgPSBmYWxzZTtcclxuXHRcdFx0dmFyIGNhbGxCZWZvcmVFeGl0aW5nID0gdHJ1ZTtcclxuXHJcblx0XHRcdHRyeUdldEpzVHlwZSh0aGlzLm1vZGVsLCBjaGFuZ2UuaW5zdGFuY2UudHlwZSwgY2hhbmdlLnByb3BlcnR5LCBmYWxzZSwgZnVuY3Rpb24gKHNyY1R5cGUpIHtcclxuXHRcdFx0XHR0cnlHZXRFbnRpdHkodGhpcy5tb2RlbCwgdGhpcy5fdHJhbnNsYXRvciwgc3JjVHlwZSwgY2hhbmdlLmluc3RhbmNlLmlkLCBudWxsLCBMYXp5TG9hZEVudW0uTm9uZSwgdGhpcy5pZ25vcmVDaGFuZ2VzKGJlZm9yZSwgZnVuY3Rpb24gKHNyY09iaikge1xyXG5cdFx0XHRcdFx0Ly8gVXBkYXRlIGNoYW5nZSB0byByZWZsZWN0IHRoZSBvYmplY3QncyBuZXcgaWRcclxuXHRcdFx0XHRcdFNlcnZlclN5bmMkcmV0cm9hY3RpdmVseUZpeENoYW5nZVdoZXJlSWRDaGFuZ2VkKGNoYW5nZS5pbnN0YW5jZSwgc3JjT2JqKTtcclxuXHJcblx0XHRcdFx0XHQvLyBDYWNoZSB0aGUgcHJvcGVydHkgc2luY2UgaXQgaXMgbm90IGEgc2ltcGxlIHByb3BlcnR5IGFjY2Vzcy5cclxuXHRcdFx0XHRcdHZhciBwcm9wZXJ0eSA9IHNyY09iai5tZXRhLnByb3BlcnR5KGNoYW5nZS5wcm9wZXJ0eSk7XHJcblx0XHRcdFx0XHRpZiAoIXByb3BlcnR5KSB7XHJcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIlByb3BlcnR5IFxcXCJcIiArIGNoYW5nZS5wcm9wZXJ0eSArIFwiXFxcIiBjb3VsZCBub3QgYmUgZm91bmQgb24gdHlwZSBcXFwiXCIgKyBzcmNUeXBlLm1ldGEuZ2V0X2Z1bGxOYW1lKCkgKyBcIlxcXCIuXCIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdC8vIEFwcGx5IGNoYW5nZVxyXG5cdFx0XHRcdFx0aWYgKGNoYW5nZS5uZXdWYWx1ZSkge1xyXG5cdFx0XHRcdFx0XHQvLyBEb24ndCBjYWxsIGltbWVkaWF0ZWx5IHNpbmNlIHdlIG1heSBuZWVkIHRvIGxhenkgbG9hZCB0aGUgdHlwZVxyXG5cdFx0XHRcdFx0XHRpZiAoIWhhc0V4aXRlZCkge1xyXG5cdFx0XHRcdFx0XHRcdGNhbGxCZWZvcmVFeGl0aW5nID0gZmFsc2U7XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdHRyeUdldEpzVHlwZSh0aGlzLm1vZGVsLCBjaGFuZ2UubmV3VmFsdWUudHlwZSwgbnVsbCwgdHJ1ZSwgdGhpcy5pZ25vcmVDaGFuZ2VzKGJlZm9yZSwgZnVuY3Rpb24gKHJlZlR5cGUpIHtcclxuXHRcdFx0XHRcdFx0XHR0cnlHZXRFbnRpdHkodGhpcy5tb2RlbCwgdGhpcy5fdHJhbnNsYXRvciwgcmVmVHlwZSwgY2hhbmdlLm5ld1ZhbHVlLmlkLCBudWxsLCBMYXp5TG9hZEVudW0uTGF6eSwgdGhpcy5pZ25vcmVDaGFuZ2VzKGJlZm9yZSwgZnVuY3Rpb24gKHJlZk9iaikge1xyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gVXBkYXRlIGNoYW5nZSB0byByZWZsZWN0IHRoZSBvYmplY3QncyBuZXcgaWRcclxuXHRcdFx0XHRcdFx0XHRcdFNlcnZlclN5bmMkcmV0cm9hY3RpdmVseUZpeENoYW5nZVdoZXJlSWRDaGFuZ2VkKGNoYW5nZS5uZXdWYWx1ZSwgcmVmT2JqKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHQvLyBVcGRhdGUgY2hhbmdlIHRvIHJlZmxlY3QgdGhlIG9iamVjdCdzIG5ldyBpZFxyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKGNoYW5nZS5uZXdWYWx1ZS5pZCA9PT0gcmVmT2JqLm1ldGEubGVnYWN5SWQpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y2hhbmdlLm5ld1ZhbHVlLmlkID0gcmVmT2JqLm1ldGEuaWQ7XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gTWFudWFsbHkgZW5zdXJlIGEgcHJvcGVydHkgdmFsdWUsIGlmIGl0IGRvZXNuJ3QgaGF2ZSBvbmUgdGhlbiBpdCB3aWxsIGJlIG1hcmtlZCBhcyBwZW5kaW5nSW5pdFxyXG5cdFx0XHRcdFx0XHRcdFx0UHJvcGVydHkkX2Vuc3VyZUluaXRlZC5jYWxsKHByb3BlcnR5LCBzcmNPYmopO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdC8vIE1hcmsgdGhlIHByb3BlcnR5IGFzIG5vIGxvbmdlciBwZW5kaW5nIGluaXQgc2luY2UgaXRzIHZhbHVlIGlzIGJlaW5nIGVzdGFibGlzaGVkXHJcblx0XHRcdFx0XHRcdFx0XHRzcmNPYmoubWV0YS5wZW5kaW5nSW5pdChwcm9wZXJ0eSwgZmFsc2UpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdC8vIFNldCB0aGUgcHJvcGVydHkgdmFsdWVcclxuXHRcdFx0XHRcdFx0XHRcdE9ic2VydmVyLnNldFZhbHVlKHNyY09iaiwgY2hhbmdlLnByb3BlcnR5LCByZWZPYmopO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdC8vIENhbGxiYWNrIG9uY2UgdGhlIHR5cGUgaGFzIGJlZW4gbG9hZGVkXHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoIWNhbGxCZWZvcmVFeGl0aW5nICYmIGNhbGxiYWNrKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9LCBhZnRlciksIHRoaXMpO1xyXG5cdFx0XHRcdFx0XHR9LCBhZnRlciksIHRoaXMpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdC8vIE1hbnVhbGx5IGVuc3VyZSBhIHByb3BlcnR5IHZhbHVlLCBpZiBpdCBkb2Vzbid0IGhhdmUgb25lIHRoZW4gaXQgd2lsbCBiZSBtYXJrZWQgYXMgcGVuZGluZ0luaXRcclxuXHRcdFx0XHRcdFx0UHJvcGVydHkkX2Vuc3VyZUluaXRlZC5jYWxsKHByb3BlcnR5LCBzcmNPYmopO1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gTWFyayB0aGUgcHJvcGVydHkgYXMgbm8gbG9uZ2VyIHBlbmRpbmcgaW5pdCBzaW5jZSBpdHMgdmFsdWUgaXMgYmVpbmcgZXN0YWJsaXNoZWRcclxuXHRcdFx0XHRcdFx0c3JjT2JqLm1ldGEucGVuZGluZ0luaXQocHJvcGVydHksIGZhbHNlKTtcclxuXHJcblx0XHRcdFx0XHRcdC8vIFNldCB0aGUgcHJvcGVydHkgdmFsdWVcclxuXHRcdFx0XHRcdFx0T2JzZXJ2ZXIuc2V0VmFsdWUoc3JjT2JqLCBjaGFuZ2UucHJvcGVydHksIG51bGwpO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdC8vIFVwZGF0ZSBvbGRWYWx1ZSdzIGlkIGluIGNoYW5nZSBvYmplY3RcclxuXHRcdFx0XHRcdGlmIChjaGFuZ2Uub2xkVmFsdWUpIHtcclxuXHRcdFx0XHRcdFx0dHJ5R2V0SnNUeXBlKHRoaXMubW9kZWwsIGNoYW5nZS5vbGRWYWx1ZS50eXBlLCBudWxsLCB0cnVlLCB0aGlzLmlnbm9yZUNoYW5nZXMoYmVmb3JlLCBmdW5jdGlvbiAocmVmVHlwZSkge1xyXG5cdFx0XHRcdFx0XHRcdC8vIFVwZGF0ZSBjaGFuZ2UgdG8gcmVmbGVjdCB0aGUgb2JqZWN0J3MgbmV3IGlkXHJcblx0XHRcdFx0XHRcdFx0dmFyIHJlZk9iaiA9IGZyb21FeG9Nb2RlbChjaGFuZ2Uub2xkVmFsdWUsIHRoaXMuX3RyYW5zbGF0b3IsIHRydWUpO1xyXG5cdFx0XHRcdFx0XHRcdFNlcnZlclN5bmMkcmV0cm9hY3RpdmVseUZpeENoYW5nZVdoZXJlSWRDaGFuZ2VkKGNoYW5nZS5vbGRWYWx1ZSwgcmVmT2JqKTtcclxuXHRcdFx0XHRcdFx0fSwgYWZ0ZXIpLCB0aGlzKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9LCBhZnRlciksIHRoaXMpO1xyXG5cdFx0XHR9LCB0aGlzKTtcclxuXHJcblx0XHRcdC8vIENhbGxiYWNrIGltbWVkaWF0ZWx5IHNpbmNlIG5vdGhpbmcgd2lsbCBiZSBmb3JjZSBsb2FkZWQuLi55ZXRcclxuXHRcdFx0aWYgKGNhbGxCZWZvcmVFeGl0aW5nICYmIGNhbGxiYWNrKSB7XHJcblx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRoYXNFeGl0ZWQgPSB0cnVlO1xyXG5cdFx0fSxcclxuXHRcdGFwcGx5VmFsQ2hhbmdlOiBmdW5jdGlvbiAoY2hhbmdlLCBiZWZvcmUsIGFmdGVyLCBjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0XHR0cnlHZXRKc1R5cGUodGhpcy5tb2RlbCwgY2hhbmdlLmluc3RhbmNlLnR5cGUsIGNoYW5nZS5wcm9wZXJ0eSwgZmFsc2UsIGZ1bmN0aW9uIChzcmNUeXBlKSB7XHJcblx0XHRcdFx0dHJ5R2V0RW50aXR5KHRoaXMubW9kZWwsIHRoaXMuX3RyYW5zbGF0b3IsIHNyY1R5cGUsIGNoYW5nZS5pbnN0YW5jZS5pZCwgbnVsbCwgTGF6eUxvYWRFbnVtLk5vbmUsIHRoaXMuaWdub3JlQ2hhbmdlcyhiZWZvcmUsIGZ1bmN0aW9uIChzcmNPYmopIHtcclxuXHRcdFx0XHRcdC8vIFVwZGF0ZSBjaGFuZ2UgdG8gcmVmbGVjdCB0aGUgb2JqZWN0J3MgbmV3IGlkXHJcblx0XHRcdFx0XHRTZXJ2ZXJTeW5jJHJldHJvYWN0aXZlbHlGaXhDaGFuZ2VXaGVyZUlkQ2hhbmdlZChjaGFuZ2UuaW5zdGFuY2UsIHNyY09iaik7XHJcblxyXG5cdFx0XHRcdFx0Ly8gQ2FjaGUgdGhlIG5ldyB2YWx1ZSwgYmVjdWFzZSB3ZSBhY2Nlc3MgaXQgbWFueSB0aW1lcyBhbmQgYWxzbyBpdCBtYXkgYmUgbW9kaWZpZWQgYmVsb3dcclxuXHRcdFx0XHRcdC8vIHRvIGFjY291bnQgZm9yIHRpbWV6b25lIGRpZmZlcmVuY2VzLCBidXQgd2UgZG9uJ3Qgd2FudCB0byBtb2RpZnkgdGhlIGFjdHVhbCBjaGFuZ2Ugb2JqZWN0LlxyXG5cdFx0XHRcdFx0dmFyIG5ld1ZhbHVlID0gY2hhbmdlLm5ld1ZhbHVlO1xyXG5cclxuXHRcdFx0XHRcdC8vIENhY2hlIHRoZSBwcm9wZXJ0eSBzaW5jZSBpdCBpcyBub3QgYSBzaW1wbGUgcHJvcGVydHkgYWNjZXNzLlxyXG5cdFx0XHRcdFx0dmFyIHByb3BlcnR5ID0gc3JjT2JqLm1ldGEucHJvcGVydHkoY2hhbmdlLnByb3BlcnR5KTtcclxuXHRcdFx0XHRcdGlmICghcHJvcGVydHkpIHtcclxuXHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiUHJvcGVydHkgXFxcIlwiICsgY2hhbmdlLnByb3BlcnR5ICsgXCJcXFwiIGNvdWxkIG5vdCBiZSBmb3VuZCBvbiB0eXBlIFxcXCJcIiArIHNyY1R5cGUubWV0YS5nZXRfZnVsbE5hbWUoKSArIFwiXFxcIi5cIik7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0aWYgKHByb3BlcnR5LmdldF9qc3R5cGUoKSA9PT0gRGF0ZSAmJiBuZXdWYWx1ZSAmJiBuZXdWYWx1ZS5jb25zdHJ1Y3RvciA9PSBTdHJpbmcgJiYgbmV3VmFsdWUubGVuZ3RoID4gMCkge1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gQ29udmVydCBmcm9tIHN0cmluZyAoZS5nLjogXCIyMDExLTA3LTI4VDA2OjAwOjAwLjAwMFpcIikgdG8gZGF0ZS5cclxuXHRcdFx0XHRcdFx0ZGF0ZVJlZ2V4Lmxhc3RJbmRleCA9IDA7XHJcblx0XHRcdFx0XHRcdG5ld1ZhbHVlID0gbmV3IERhdGUobmV3VmFsdWUucmVwbGFjZShkYXRlUmVnZXgsIGRhdGVSZWdleFJlcGxhY2UpKTtcclxuXHJcblx0XHRcdFx0XHRcdC8vbm93IHRoYXQgd2UgaGF2ZSB0aGUgdmFsdWUgc2V0IGZvciB0aGUgZGF0ZS5cclxuXHRcdFx0XHRcdFx0Ly9pZiB0aGUgdW5kZXJseWluZyBwcm9wZXJ0eSBkYXRhdHlwZSBpcyBhY3R1YWxseSBhIGRhdGUgYW5kIG5vdCBhIGRhdGV0aW1lXHJcblx0XHRcdFx0XHRcdC8vdGhlbiB3ZSBuZWVkIHRvIGFkZCB0aGUgbG9jYWwgdGltZXpvbmUgb2Zmc2V0IHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBkYXRlIGlzIGRpc3BsYXllZCBhY3VyYXRlbHkuXHJcblx0XHRcdFx0XHRcdGlmIChwcm9wZXJ0eS5nZXRfZm9ybWF0KCkgJiYgIWhhc1RpbWVGb3JtYXQudGVzdChwcm9wZXJ0eS5nZXRfZm9ybWF0KCkudG9TdHJpbmcoKSkpIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgc2VydmVyT2Zmc2V0ID0gdGhpcy5nZXRfU2VydmVyVGltZXpvbmVPZmZzZXQoKTtcclxuXHRcdFx0XHRcdFx0XHR2YXIgbG9jYWxPZmZzZXQgPSAtKG5ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKSAvIDYwKTtcclxuXHRcdFx0XHRcdFx0XHRuZXdWYWx1ZSA9IG5ld1ZhbHVlLmFkZEhvdXJzKHNlcnZlck9mZnNldCAtIGxvY2FsT2Zmc2V0KTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAobmV3VmFsdWUgJiYgbmV3VmFsdWUgaW5zdGFuY2VvZiBUaW1lU3Bhbikge1xyXG5cdFx0XHRcdFx0XHRuZXdWYWx1ZSA9IG5ld1ZhbHVlLnRvT2JqZWN0KCk7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0Ly8gTWFudWFsbHkgZW5zdXJlIGEgcHJvcGVydHkgdmFsdWUsIGlmIGl0IGRvZXNuJ3QgaGF2ZSBvbmUgdGhlbiBpdCB3aWxsIGJlIG1hcmtlZCBhcyBwZW5kaW5nSW5pdFxyXG5cdFx0XHRcdFx0UHJvcGVydHkkX2Vuc3VyZUluaXRlZC5jYWxsKHByb3BlcnR5LCBzcmNPYmopO1xyXG5cclxuXHRcdFx0XHRcdC8vIE1hcmsgdGhlIHByb3BlcnR5IGFzIG5vIGxvbmdlciBwZW5kaW5nIGluaXQgc2luY2UgaXRzIHZhbHVlIGlzIGJlaW5nIGVzdGFibGlzaGVkXHJcblx0XHRcdFx0XHRzcmNPYmoubWV0YS5wZW5kaW5nSW5pdChwcm9wZXJ0eSwgZmFsc2UpO1xyXG5cclxuXHRcdFx0XHRcdC8vIFNldCB0aGUgcHJvcGVydHkgdmFsdWVcclxuXHRcdFx0XHRcdE9ic2VydmVyLnNldFZhbHVlKHNyY09iaiwgY2hhbmdlLnByb3BlcnR5LCBuZXdWYWx1ZSk7XHJcblx0XHRcdFx0fSwgYWZ0ZXIpLCB0aGlzKTtcclxuXHRcdFx0fSwgdGhpcyk7XHJcblxyXG5cdFx0XHQvLyBDYWxsYmFjayBpbW1lZGlhdGVseSBzaW5jZSBub3RoaW5nIHdpbGwgYmUgZm9yY2UgbG9hZGVkXHJcblx0XHRcdGlmIChjYWxsYmFjaykge1xyXG5cdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdGFwcGx5TGlzdENoYW5nZTogZnVuY3Rpb24gKGNoYW5nZSwgYmVmb3JlLCBhZnRlciwgY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdFx0dmFyIGhhc0V4aXRlZCA9IGZhbHNlO1xyXG5cdFx0XHR2YXIgY2FsbEJlZm9yZUV4aXRpbmcgPSB0cnVlO1xyXG5cclxuXHRcdFx0dHJ5R2V0SnNUeXBlKHRoaXMubW9kZWwsIGNoYW5nZS5pbnN0YW5jZS50eXBlLCBjaGFuZ2UucHJvcGVydHksIGZhbHNlLCBmdW5jdGlvbiAoc3JjVHlwZSkge1xyXG5cdFx0XHRcdHRyeUdldEVudGl0eSh0aGlzLm1vZGVsLCB0aGlzLl90cmFuc2xhdG9yLCBzcmNUeXBlLCBjaGFuZ2UuaW5zdGFuY2UuaWQsIGNoYW5nZS5wcm9wZXJ0eSwgTGF6eUxvYWRFbnVtLk5vbmUsIHRoaXMuaWdub3JlQ2hhbmdlcyhiZWZvcmUsIGZ1bmN0aW9uIChzcmNPYmopIHtcclxuXHRcdFx0XHRcdC8vIFVwZGF0ZSBjaGFuZ2UgdG8gcmVmbGVjdCB0aGUgb2JqZWN0J3MgbmV3IGlkXHJcblx0XHRcdFx0XHRTZXJ2ZXJTeW5jJHJldHJvYWN0aXZlbHlGaXhDaGFuZ2VXaGVyZUlkQ2hhbmdlZChjaGFuZ2UuaW5zdGFuY2UsIHNyY09iaik7XHJcblxyXG5cdFx0XHRcdFx0dmFyIHByb3BlcnR5ID0gc3JjT2JqLm1ldGEucHJvcGVydHkoY2hhbmdlLnByb3BlcnR5KTtcclxuXHRcdFx0XHRcdGlmICghcHJvcGVydHkpIHtcclxuXHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiUHJvcGVydHkgXFxcIlwiICsgY2hhbmdlLnByb3BlcnR5ICsgXCJcXFwiIGNvdWxkIG5vdCBiZSBmb3VuZCBvbiB0eXBlIFxcXCJcIiArIHNyY1R5cGUubWV0YS5nZXRfZnVsbE5hbWUoKSArIFwiXFxcIi5cIik7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0dmFyIGlzRW50aXR5TGlzdCA9IHByb3BlcnR5LmdldF9pc0VudGl0eUxpc3RUeXBlKCk7XHJcblx0XHRcdFx0XHR2YXIgbGlzdCA9IHByb3BlcnR5LnZhbHVlKHNyY09iaik7XHJcblxyXG5cdFx0XHRcdFx0bGlzdC5iZWdpblVwZGF0ZSgpO1xyXG5cclxuXHRcdFx0XHRcdHZhciBsaXN0U2lnbmFsID0gbmV3IEV4b1dlYi5TaWduYWwoXCJhcHBseUxpc3RDaGFuZ2UtaXRlbXNcIik7XHJcblxyXG5cdFx0XHRcdFx0Ly8gYXBwbHkgYWRkZWQgaXRlbXNcclxuXHRcdFx0XHRcdGlmIChjaGFuZ2UuYWRkZWQubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdFx0XHQvLyBEb24ndCBjYWxsIGltbWVkaWF0ZWx5IHNpbmNlIHdlIG1heSBuZWVkIHRvIGxhenkgbG9hZCB0aGUgdHlwZVxyXG5cdFx0XHRcdFx0XHRpZiAoIWhhc0V4aXRlZCkge1xyXG5cdFx0XHRcdFx0XHRcdGNhbGxCZWZvcmVFeGl0aW5nID0gZmFsc2U7XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdC8vIEFkZCBlYWNoIGl0ZW0gdG8gdGhlIGxpc3QgYWZ0ZXIgZW5zdXJpbmcgdGhhdCB0aGUgdHlwZSBpcyBsb2FkZWRcclxuXHRcdFx0XHRcdFx0Y2hhbmdlLmFkZGVkLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcclxuXHRcdFx0XHRcdFx0XHRpZiAoaXNFbnRpdHlMaXN0KSB7XHJcblx0XHRcdFx0XHRcdFx0XHR0cnlHZXRKc1R5cGUodGhpcy5tb2RlbCwgaXRlbS50eXBlLCBudWxsLCB0cnVlLCBsaXN0U2lnbmFsLnBlbmRpbmcodGhpcy5pZ25vcmVDaGFuZ2VzKGJlZm9yZSwgZnVuY3Rpb24gKGl0ZW1UeXBlKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHRyeUdldEVudGl0eSh0aGlzLm1vZGVsLCB0aGlzLl90cmFuc2xhdG9yLCBpdGVtVHlwZSwgaXRlbS5pZCwgbnVsbCwgTGF6eUxvYWRFbnVtLkxhenksIHRoaXMuaWdub3JlQ2hhbmdlcyhiZWZvcmUsIGZ1bmN0aW9uIChpdGVtT2JqKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Ly8gVXBkYXRlIGNoYW5nZSB0byByZWZsZWN0IHRoZSBvYmplY3QncyBuZXcgaWRcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRTZXJ2ZXJTeW5jJHJldHJvYWN0aXZlbHlGaXhDaGFuZ2VXaGVyZUlkQ2hhbmdlZChpdGVtLCBpdGVtT2JqKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKCFsaXN0LmNvbnRhaW5zKGl0ZW1PYmopKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRMaXN0TGF6eUxvYWRlci5hbGxvd01vZGlmaWNhdGlvbihsaXN0LCBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGxpc3QuYWRkKGl0ZW1PYmopO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHR9LCBhZnRlciksIHRoaXMpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fSwgYWZ0ZXIpKSwgdGhpcywgdHJ1ZSk7XHJcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdExpc3RMYXp5TG9hZGVyLmFsbG93TW9kaWZpY2F0aW9uKGxpc3QsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0bGlzdC5hZGQoaXRlbSk7XHJcblx0XHRcdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdC8vIGFwcGx5IHJlbW92ZWQgaXRlbXNcclxuXHRcdFx0XHRcdGNoYW5nZS5yZW1vdmVkLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcclxuXHRcdFx0XHRcdFx0aWYgKGlzRW50aXR5TGlzdCkge1xyXG5cdFx0XHRcdFx0XHRcdC8vIG5vIG5lZWQgdG8gbG9hZCBpbnN0YW5jZSBvbmx5IHRvIHJlbW92ZSBpdCBmcm9tIGEgbGlzdCB3aGVuIGl0IGNhbid0IHBvc3NpYmx5IGV4aXN0XHJcblx0XHRcdFx0XHRcdFx0dHJ5R2V0SnNUeXBlKHRoaXMubW9kZWwsIGl0ZW0udHlwZSwgbnVsbCwgZmFsc2UsIHRoaXMuaWdub3JlQ2hhbmdlcyhiZWZvcmUsIGZ1bmN0aW9uIChpdGVtVHlwZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0dHJ5R2V0RW50aXR5KHRoaXMubW9kZWwsIHRoaXMuX3RyYW5zbGF0b3IsIGl0ZW1UeXBlLCBpdGVtLmlkLCBudWxsLCBMYXp5TG9hZEVudW0uTGF6eSwgdGhpcy5pZ25vcmVDaGFuZ2VzKGJlZm9yZSwgZnVuY3Rpb24gKGl0ZW1PYmopIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gVXBkYXRlIGNoYW5nZSB0byByZWZsZWN0IHRoZSBvYmplY3QncyBuZXcgaWRcclxuXHRcdFx0XHRcdFx0XHRcdFx0U2VydmVyU3luYyRyZXRyb2FjdGl2ZWx5Rml4Q2hhbmdlV2hlcmVJZENoYW5nZWQoaXRlbSwgaXRlbU9iaik7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHRMaXN0TGF6eUxvYWRlci5hbGxvd01vZGlmaWNhdGlvbihsaXN0LCBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0bGlzdC5yZW1vdmUoaXRlbU9iaik7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0fSwgYWZ0ZXIpLCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0XHR9LCBhZnRlciksIHRoaXMsIHRydWUpO1xyXG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdExpc3RMYXp5TG9hZGVyLmFsbG93TW9kaWZpY2F0aW9uKGxpc3QsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGxpc3QucmVtb3ZlKGl0ZW0pO1xyXG5cdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHJcblx0XHRcdFx0XHQvLyBkb24ndCBlbmQgdXBkYXRlIHVudGlsIHRoZSBpdGVtcyBoYXZlIGJlZW4gbG9hZGVkXHJcblx0XHRcdFx0XHRsaXN0U2lnbmFsLndhaXRGb3JBbGwodGhpcy5pZ25vcmVDaGFuZ2VzKGJlZm9yZSwgZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0XHR0cnkge1xyXG5cdFx0XHRcdFx0XHRcdHZhciBsaXN0VXBkYXRlRW5kZWQgPSBmYWxzZTtcclxuXHRcdFx0XHRcdFx0XHRpZiAoaGFzRXhpdGVkKSB7XHJcblx0XHRcdFx0XHRcdFx0XHR0aGlzLmJlZ2luQXBwbHlpbmdDaGFuZ2VzKCk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdHRyeSB7XHJcblx0XHRcdFx0XHRcdFx0XHRMaXN0TGF6eUxvYWRlci5hbGxvd01vZGlmaWNhdGlvbihsaXN0LCBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdC8vIFVwZGF0ZSB2YXJpYWJsZSBmaXJzdCB0byBpbmRpY2F0ZSB0aGF0IGVuZFVwZGF0ZSB3YXMgYXQgbGVhc3QgYXR0ZW1wdGVkLlxyXG5cdFx0XHRcdFx0XHRcdFx0XHQvLyBJZiB0aGUgY2FsbCB0byBlbmRVcGRhdGUgZ2VuZXJhdGVzIGFuIGVycm9yIHdlIHdvdWxkIG5vdCB3YW50IHRvIGF0dGVtcHRcclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gYWdhaW4gYW5kIHBvdGVudGlhbGx5IGdlbmVyYXRlIGEgZGlmZmVyZW50IGVycm9yIGJlY2F1c2Ugb2Ygc2lkZS1lZmZlY3RzLlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRsaXN0VXBkYXRlRW5kZWQgPSB0cnVlO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0bGlzdC5lbmRVcGRhdGUoKTtcclxuXHRcdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHRcdH0gZmluYWxseSB7XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoIWxpc3RVcGRhdGVFbmRlZCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRsaXN0LmVuZFVwZGF0ZSgpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fSBmaW5hbGx5IHtcclxuXHRcdFx0XHRcdFx0XHRpZiAoaGFzRXhpdGVkKSB7XHJcblx0XHRcdFx0XHRcdFx0XHR0aGlzLmVuZEFwcGx5aW5nQ2hhbmdlcygpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0Ly8gQ2FsbGJhY2sgb25jZSBhbGwgaW5zdGFuY2VzIGhhdmUgYmVlbiBhZGRlZFxyXG5cdFx0XHRcdFx0XHRpZiAoIWNhbGxCZWZvcmVFeGl0aW5nICYmIGNhbGxiYWNrKSB7XHJcblx0XHRcdFx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9LCBhZnRlciksIHRoaXMsIHRydWUpO1xyXG5cdFx0XHRcdH0sIGFmdGVyKSwgdGhpcyk7XHJcblx0XHRcdH0sIHRoaXMpO1xyXG5cclxuXHRcdFx0Ly8gQ2FsbGJhY2sgaW1tZWRpYXRlbHkgc2luY2Ugbm90aGluZyB3aWxsIGJlIGZvcmNlIGxvYWRlZC4uLnlldFxyXG5cdFx0XHRpZiAoY2FsbEJlZm9yZUV4aXRpbmcgJiYgY2FsbGJhY2spIHtcclxuXHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcyk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGhhc0V4aXRlZCA9IHRydWU7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIENoZWNrcG9pbnRcclxuXHRcdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0XHRjaGVja3BvaW50OiBmdW5jdGlvbiBTZXJ2ZXJTeW5jJGNoZWNrcG9pbnQoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9jaGFuZ2VMb2cuY2hlY2twb2ludCgpO1xyXG5cdFx0fSxcclxuXHJcblx0XHQvLyBSb2xsYmFja1xyXG5cdFx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHRcdHJvbGxiYWNrOiBmdW5jdGlvbiBTZXJ2ZXJTeW5jJHJvbGxiYWNrKGNoZWNrcG9pbnQsIGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRcdHZhciBzaWduYWwgPSBuZXcgU2lnbmFsKFwicm9sbGJhY2tcIik7XHJcblx0XHRcdHZhciB3YWl0Rm9yQWxsUmVnaXN0ZXJlZCA9IGZhbHNlO1xyXG5cclxuXHRcdFx0dHJ5IHtcclxuXHRcdFx0XHR2YXIgYmF0Y2ggPSBFeG9XZWIuQmF0Y2guc3RhcnQoXCJyb2xsYmFjayBjaGFuZ2VzXCIpO1xyXG5cclxuXHRcdFx0XHR0aGlzLmJlZ2luQXBwbHlpbmdDaGFuZ2VzKCk7XHJcblxyXG5cdFx0XHRcdHZhciBjaGFuZ2UgPSB0aGlzLl9jaGFuZ2VMb2cudW5kbygpO1xyXG5cdFx0XHRcdHdoaWxlIChjaGFuZ2UgJiYgIShjaGFuZ2UudHlwZSA9PT0gXCJDaGVja3BvaW50XCIgJiYgY2hhbmdlLmNvZGUgPT09IGNoZWNrcG9pbnQpKSB7XHJcblx0XHRcdFx0XHRpZiAoY2hhbmdlLnR5cGUgPT0gXCJJbml0TmV3XCIpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5yb2xsYmFja0luaXRDaGFuZ2UoY2hhbmdlLCBzaWduYWwucGVuZGluZygpKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2UgaWYgKGNoYW5nZS50eXBlID09IFwiUmVmZXJlbmNlQ2hhbmdlXCIpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5yb2xsYmFja1JlZkNoYW5nZShjaGFuZ2UsIHNpZ25hbC5wZW5kaW5nKCkpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAoY2hhbmdlLnR5cGUgPT0gXCJWYWx1ZUNoYW5nZVwiKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMucm9sbGJhY2tWYWxDaGFuZ2UoY2hhbmdlLCBzaWduYWwucGVuZGluZygpKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2UgaWYgKGNoYW5nZS50eXBlID09IFwiTGlzdENoYW5nZVwiKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMucm9sbGJhY2tMaXN0Q2hhbmdlKGNoYW5nZSwgc2lnbmFsLnBlbmRpbmcoKSk7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0Y2hhbmdlID0gdGhpcy5fY2hhbmdlTG9nLnVuZG8oKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHdhaXRGb3JBbGxSZWdpc3RlcmVkID0gdHJ1ZTtcclxuXHRcdFx0XHRzaWduYWwud2FpdEZvckFsbChmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHR0aGlzLmVuZEFwcGx5aW5nQ2hhbmdlcygpO1xyXG5cdFx0XHRcdFx0RXhvV2ViLkJhdGNoLmVuZChiYXRjaCk7XHJcblx0XHRcdFx0XHRpZiAoY2FsbGJhY2spIHtcclxuXHRcdFx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0dGhpcy5fcmFpc2VFdmVudChcImNoYW5nZXNEZXRlY3RlZFwiLCBbdGhpcywgeyByZWFzb246IFwicm9sbGJhY2tcIiB9XSk7XHJcblx0XHRcdFx0fSwgdGhpcywgdHJ1ZSk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZmluYWxseSB7XHJcblx0XHRcdFx0Ly8gdGhlIHNpZ25hbCB3YXMgbm90IHJlZ2lzdGVyZWQsIHRoZXJlZm9yZSB3ZSBuZWVkIHRvIGhhbmRsZSBlbmRBcHBseWluZ0NoYW5nZXMgY2FsbCBoZXJlXHJcblx0XHRcdFx0aWYgKCF3YWl0Rm9yQWxsUmVnaXN0ZXJlZCkge1xyXG5cdFx0XHRcdFx0dGhpcy5lbmRBcHBseWluZ0NoYW5nZXMoKTtcclxuXHRcdFx0XHRcdEV4b1dlYi5CYXRjaC5lbmQoYmF0Y2gpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdHJvbGxiYWNrVmFsQ2hhbmdlOiBmdW5jdGlvbiBTZXJ2ZXJTeW5jJHJvbGxiYWNrVmFsQ2hhbmdlKGNoYW5nZSwgY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdFx0dHJ5R2V0SnNUeXBlKHRoaXMubW9kZWwsIGNoYW5nZS5pbnN0YW5jZS50eXBlLCBjaGFuZ2UucHJvcGVydHksIGZhbHNlLCBmdW5jdGlvbiAoc3JjVHlwZSkge1xyXG5cdFx0XHRcdHRyeUdldEVudGl0eSh0aGlzLm1vZGVsLCB0aGlzLl90cmFuc2xhdG9yLCBzcmNUeXBlLCBjaGFuZ2UuaW5zdGFuY2UuaWQsIG51bGwsIExhenlMb2FkRW51bS5Ob25lLCBmdW5jdGlvbiAoc3JjT2JqKSB7XHJcblxyXG5cdFx0XHRcdFx0Ly8gQ2FjaGUgdGhlIG5ldyB2YWx1ZSwgYmVjdWFzZSB3ZSBhY2Nlc3MgaXQgbWFueSB0aW1lcyBhbmQgYWxzbyBpdCBtYXkgYmUgbW9kaWZpZWQgYmVsb3dcclxuXHRcdFx0XHRcdC8vIHRvIGFjY291bnQgZm9yIHRpbWV6b25lIGRpZmZlcmVuY2VzLCBidXQgd2UgZG9uJ3Qgd2FudCB0byBtb2RpZnkgdGhlIGFjdHVhbCBjaGFuZ2Ugb2JqZWN0LlxyXG5cdFx0XHRcdFx0dmFyIG9sZFZhbHVlID0gY2hhbmdlLm9sZFZhbHVlO1xyXG5cclxuXHRcdFx0XHRcdC8vIENhY2hlIHRoZSBwcm9wZXJ0eSBzaW5jZSBpdCBpcyBub3QgYSBzaW1wbGUgcHJvcGVydHkgYWNjZXNzLlxyXG5cdFx0XHRcdFx0dmFyIHByb3BlcnR5ID0gc3JjT2JqLm1ldGEucHJvcGVydHkoY2hhbmdlLnByb3BlcnR5KTtcclxuXHRcdFx0XHRcdGlmICghcHJvcGVydHkpIHtcclxuXHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiUHJvcGVydHkgXFxcIlwiICsgY2hhbmdlLnByb3BlcnR5ICsgXCJcXFwiIGNvdWxkIG5vdCBiZSBmb3VuZCBvbiB0eXBlIFxcXCJcIiArIHNyY1R5cGUubWV0YS5nZXRfZnVsbE5hbWUoKSArIFwiXFxcIi5cIik7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0aWYgKHByb3BlcnR5LmdldF9qc3R5cGUoKSA9PT0gRGF0ZSAmJiBvbGRWYWx1ZSAmJiBvbGRWYWx1ZS5jb25zdHJ1Y3RvciA9PSBTdHJpbmcgJiYgb2xkVmFsdWUubGVuZ3RoID4gMCkge1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gQ29udmVydCBmcm9tIHN0cmluZyAoZS5nLjogXCIyMDExLTA3LTI4VDA2OjAwOjAwLjAwMFpcIikgdG8gZGF0ZS5cclxuXHRcdFx0XHRcdFx0ZGF0ZVJlZ2V4Lmxhc3RJbmRleCA9IDA7XHJcblx0XHRcdFx0XHRcdG9sZFZhbHVlID0gbmV3IERhdGUob2xkVmFsdWUucmVwbGFjZShkYXRlUmVnZXgsIGRhdGVSZWdleFJlcGxhY2UpKTtcclxuXHJcblx0XHRcdFx0XHRcdC8vbm93IHRoYXQgd2UgaGF2ZSB0aGUgdmFsdWUgc2V0IGZvciB0aGUgZGF0ZS5cclxuXHRcdFx0XHRcdFx0Ly9pZiB0aGUgdW5kZXJseWluZyBwcm9wZXJ0eSBkYXRhdHlwZSBpcyBhY3R1YWxseSBhIGRhdGUgYW5kIG5vdCBhIGRhdGV0aW1lXHJcblx0XHRcdFx0XHRcdC8vdGhlbiB3ZSBuZWVkIHRvIGFkZCB0aGUgbG9jYWwgdGltZXpvbmUgb2Zmc2V0IHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBkYXRlIGlzIGRpc3BsYXllZCBhY3VyYXRlbHkuXHJcblx0XHRcdFx0XHRcdGlmIChwcm9wZXJ0eS5nZXRfZm9ybWF0KCkgJiYgIWhhc1RpbWVGb3JtYXQudGVzdChwcm9wZXJ0eS5nZXRfZm9ybWF0KCkudG9TdHJpbmcoKSkpIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgc2VydmVyT2Zmc2V0ID0gdGhpcy5nZXRfU2VydmVyVGltZXpvbmVPZmZzZXQoKTtcclxuXHRcdFx0XHRcdFx0XHR2YXIgbG9jYWxPZmZzZXQgPSAtKG5ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKSAvIDYwKTtcclxuXHRcdFx0XHRcdFx0XHRvbGRWYWx1ZSA9IG9sZFZhbHVlLmFkZEhvdXJzKHNlcnZlck9mZnNldCAtIGxvY2FsT2Zmc2V0KTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAob2xkVmFsdWUgJiYgb2xkVmFsdWUgaW5zdGFuY2VvZiBUaW1lU3Bhbikge1xyXG5cdFx0XHRcdFx0XHRvbGRWYWx1ZSA9IG9sZFZhbHVlLnRvT2JqZWN0KCk7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0Ly8gU2V0IHRoZSBwcm9wZXJ0eSB2YWx1ZVxyXG5cdFx0XHRcdFx0T2JzZXJ2ZXIuc2V0VmFsdWUoc3JjT2JqLCBjaGFuZ2UucHJvcGVydHksIG9sZFZhbHVlKTtcclxuXHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0fSwgdGhpcyk7XHJcblxyXG5cdFx0XHQvLyBDYWxsYmFjayBpbW1lZGlhdGVseSBzaW5jZSBub3RoaW5nIHdpbGwgYmUgZm9yY2UgbG9hZGVkXHJcblx0XHRcdGlmIChjYWxsYmFjaykge1xyXG5cdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdHJvbGxiYWNrUmVmQ2hhbmdlOiBmdW5jdGlvbiBTZXJ2ZXJTeW5jJHJvbGxiYWNrUmVmQ2hhbmdlKGNoYW5nZSwgY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdFx0dmFyIGhhc0V4aXRlZCA9IGZhbHNlO1xyXG5cdFx0XHR2YXIgY2FsbEJlZm9yZUV4aXRpbmcgPSB0cnVlO1xyXG5cclxuXHRcdFx0dHJ5R2V0SnNUeXBlKHRoaXMubW9kZWwsIGNoYW5nZS5pbnN0YW5jZS50eXBlLCBjaGFuZ2UucHJvcGVydHksIGZhbHNlLCBmdW5jdGlvbiAoc3JjVHlwZSkge1xyXG5cdFx0XHRcdHRyeUdldEVudGl0eSh0aGlzLm1vZGVsLCB0aGlzLl90cmFuc2xhdG9yLCBzcmNUeXBlLCBjaGFuZ2UuaW5zdGFuY2UuaWQsIG51bGwsIExhenlMb2FkRW51bS5Ob25lLCBmdW5jdGlvbiAoc3JjT2JqKSB7XHJcblx0XHRcdFx0XHRpZiAoY2hhbmdlLm9sZFZhbHVlKSB7XHJcblx0XHRcdFx0XHRcdC8vIERvbid0IGNhbGwgaW1tZWRpYXRlbHkgc2luY2Ugd2UgbWF5IG5lZWQgdG8gbGF6eSBsb2FkIHRoZSB0eXBlXHJcblx0XHRcdFx0XHRcdGlmICghaGFzRXhpdGVkKSB7XHJcblx0XHRcdFx0XHRcdFx0Y2FsbEJlZm9yZUV4aXRpbmcgPSBmYWxzZTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0dHJ5R2V0SnNUeXBlKHRoaXMubW9kZWwsIGNoYW5nZS5vbGRWYWx1ZS50eXBlLCBudWxsLCB0cnVlLCBmdW5jdGlvbiAocmVmVHlwZSkge1xyXG5cdFx0XHRcdFx0XHRcdHRyeUdldEVudGl0eSh0aGlzLm1vZGVsLCB0aGlzLl90cmFuc2xhdG9yLCByZWZUeXBlLCBjaGFuZ2Uub2xkVmFsdWUuaWQsIG51bGwsIExhenlMb2FkRW51bS5Ob25lLCBmdW5jdGlvbiAocmVmT2JqKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRPYnNlcnZlci5zZXRWYWx1ZShzcmNPYmosIGNoYW5nZS5wcm9wZXJ0eSwgcmVmT2JqKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHQvLyBDYWxsYmFjayBvbmNlIHRoZSB0eXBlIGhhcyBiZWVuIGxvYWRlZFxyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKCFjYWxsQmVmb3JlRXhpdGluZyAmJiBjYWxsYmFjaykge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcyk7XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdFx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdE9ic2VydmVyLnNldFZhbHVlKHNyY09iaiwgY2hhbmdlLnByb3BlcnR5LCBudWxsKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0fSwgdGhpcyk7XHJcblxyXG5cdFx0XHQvLyBDYWxsYmFjayBpbW1lZGlhdGVseSBzaW5jZSBub3RoaW5nIHdpbGwgYmUgZm9yY2UgbG9hZGVkLi4ueWV0XHJcblx0XHRcdGlmIChjYWxsQmVmb3JlRXhpdGluZyAmJiBjYWxsYmFjaykge1xyXG5cdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aGFzRXhpdGVkID0gdHJ1ZTtcclxuXHRcdH0sXHJcblx0XHRyb2xsYmFja0luaXRDaGFuZ2U6IGZ1bmN0aW9uIFNlcnZlclN5bmMkcm9sbGJhY2tJbml0Q2hhbmdlKGNoYW5nZSwgY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdFx0Ly9UT0RPOiBuZWVkIHRvIHJlbW92ZSBmcm9tIHRoZSB0cmFuc2xhdG9yXHJcblx0XHRcdGlmIChjYWxsYmFjaykge1xyXG5cdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdHJvbGxiYWNrTGlzdENoYW5nZTogZnVuY3Rpb24gU2VydmVyU3luYyRyb2xsYmFja0xpc3RDaGFuZ2UoY2hhbmdlLCBjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0XHR2YXIgaGFzRXhpdGVkID0gZmFsc2U7XHJcblx0XHRcdHZhciBjYWxsQmVmb3JlRXhpdGluZyA9IHRydWU7XHJcblxyXG5cdFx0XHR0cnlHZXRKc1R5cGUodGhpcy5tb2RlbCwgY2hhbmdlLmluc3RhbmNlLnR5cGUsIGNoYW5nZS5wcm9wZXJ0eSwgZmFsc2UsIGZ1bmN0aW9uIChzcmNUeXBlKSB7XHJcblx0XHRcdFx0dHJ5R2V0RW50aXR5KHRoaXMubW9kZWwsIHRoaXMuX3RyYW5zbGF0b3IsIHNyY1R5cGUsIGNoYW5nZS5pbnN0YW5jZS5pZCwgY2hhbmdlLnByb3BlcnR5LCBMYXp5TG9hZEVudW0uTm9uZSwgZnVuY3Rpb24gKHNyY09iaikge1xyXG5cdFx0XHRcdFx0dmFyIHByb3BlcnR5ID0gc3JjT2JqLm1ldGEucHJvcGVydHkoY2hhbmdlLnByb3BlcnR5KTtcclxuXHRcdFx0XHRcdGlmICghcHJvcGVydHkpIHtcclxuXHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiUHJvcGVydHkgXFxcIlwiICsgY2hhbmdlLnByb3BlcnR5ICsgXCJcXFwiIGNvdWxkIG5vdCBiZSBmb3VuZCBvbiB0eXBlIFxcXCJcIiArIHNyY1R5cGUubWV0YS5nZXRfZnVsbE5hbWUoKSArIFwiXFxcIi5cIik7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0dmFyIGlzRW50aXR5TGlzdCA9IHByb3BlcnR5LmdldF9pc0VudGl0eUxpc3RUeXBlKCk7XHJcblx0XHRcdFx0XHR2YXIgbGlzdCA9IHByb3BlcnR5LnZhbHVlKHNyY09iaik7XHJcblx0XHRcdFx0XHR2YXIgdHJhbnNsYXRvciA9IHRoaXMuX3RyYW5zbGF0b3I7XHJcblxyXG5cdFx0XHRcdFx0bGlzdC5iZWdpblVwZGF0ZSgpO1xyXG5cclxuXHRcdFx0XHRcdHZhciBsaXN0U2lnbmFsID0gbmV3IEV4b1dlYi5TaWduYWwoXCJyb2xsYmFja0xpc3RDaGFuZ2UtaXRlbXNcIik7XHJcblxyXG5cdFx0XHRcdFx0Ly8gUm9sbGJhY2sgYWRkZWQgaXRlbXNcclxuXHRcdFx0XHRcdGNoYW5nZS5hZGRlZC5mb3JFYWNoKGZ1bmN0aW9uIHJvbGxiYWNrTGlzdENoYW5nZXMkYWRkZWQoaXRlbSkge1xyXG5cdFx0XHRcdFx0XHRpZiAoaXNFbnRpdHlMaXN0KSB7XHJcblx0XHRcdFx0XHRcdFx0dHJ5R2V0SnNUeXBlKHRoaXMubW9kZWwsIGl0ZW0udHlwZSwgbnVsbCwgZmFsc2UsIGZ1bmN0aW9uIChpdGVtVHlwZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0dmFyIGNoaWxkT2JqID0gZnJvbUV4b01vZGVsKGl0ZW0sIHRyYW5zbGF0b3IpO1xyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKGNoaWxkT2JqKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGxpc3QucmVtb3ZlKGNoaWxkT2JqKTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRsaXN0LnJlbW92ZShpdGVtKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fSwgdGhpcyk7XHJcblxyXG5cdFx0XHRcdFx0Ly8gUm9sbGJhY2sgcmVtb3ZlZCBpdGVtc1xyXG5cdFx0XHRcdFx0aWYgKGNoYW5nZS5yZW1vdmVkLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHRcdFx0Ly8gRG9uJ3QgY2FsbCBpbW1lZGlhdGVseSBzaW5jZSB3ZSBtYXkgbmVlZCB0byBsYXp5IGxvYWQgdGhlIHR5cGVcclxuXHRcdFx0XHRcdFx0aWYgKCFoYXNFeGl0ZWQpIHtcclxuXHRcdFx0XHRcdFx0XHRjYWxsQmVmb3JlRXhpdGluZyA9IGZhbHNlO1xyXG5cdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRjaGFuZ2UucmVtb3ZlZC5mb3JFYWNoKGZ1bmN0aW9uIHJvbGxiYWNrTGlzdENoYW5nZXMkYWRkZWQoaXRlbSkge1xyXG5cdFx0XHRcdFx0XHRcdGlmIChpc0VudGl0eUxpc3QpIHtcclxuXHRcdFx0XHRcdFx0XHRcdHRyeUdldEpzVHlwZSh0aGlzLm1vZGVsLCBpdGVtLnR5cGUsIG51bGwsIHRydWUsIGxpc3RTaWduYWwucGVuZGluZyhmdW5jdGlvbiAoaXRlbVR5cGUpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIGNoaWxkT2JqID0gZnJvbUV4b01vZGVsKGl0ZW0sIHRyYW5zbGF0b3IsIHRydWUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRsaXN0LmFkZChjaGlsZE9iaik7XHJcblx0XHRcdFx0XHRcdFx0XHR9LCB0aGlzLCB0cnVlKSwgdGhpcyk7XHJcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdGxpc3QuYWRkKGl0ZW0pO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0Ly8gZG9uJ3QgZW5kIHVwZGF0ZSB1bnRpbCB0aGUgaXRlbXMgaGF2ZSBiZWVuIGxvYWRlZFxyXG5cdFx0XHRcdFx0bGlzdFNpZ25hbC53YWl0Rm9yQWxsKGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0aWYgKGhhc0V4aXRlZCkge1xyXG5cdFx0XHRcdFx0XHRcdHRoaXMuYmVnaW5BcHBseWluZ0NoYW5nZXMoKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRMaXN0TGF6eUxvYWRlci5hbGxvd01vZGlmaWNhdGlvbihsaXN0LCBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdFx0bGlzdC5lbmRVcGRhdGUoKTtcclxuXHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRcdGlmIChoYXNFeGl0ZWQpIHtcclxuXHRcdFx0XHRcdFx0XHR0aGlzLmVuZEFwcGx5aW5nQ2hhbmdlcygpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdC8vIENhbGxiYWNrIG9uY2UgYWxsIGluc3RhbmNlcyBoYXZlIGJlZW4gYWRkZWRcclxuXHRcdFx0XHRcdFx0aWYgKCFjYWxsQmVmb3JlRXhpdGluZyAmJiBjYWxsYmFjaykge1xyXG5cdFx0XHRcdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdH0sIHRoaXMpO1xyXG5cclxuXHRcdFx0Ly8gQ2FsbGJhY2sgaW1tZWRpYXRlbHkgc2luY2Ugbm90aGluZyB3aWxsIGJlIGZvcmNlIGxvYWRlZC4uLnlldFxyXG5cdFx0XHRpZiAoY2FsbEJlZm9yZUV4aXRpbmcgJiYgY2FsbGJhY2spIHtcclxuXHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcyk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGhhc0V4aXRlZCA9IHRydWU7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIFZhcmlvdXNcclxuXHRcdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0XHRhZGRDaGFuZ2VzRGV0ZWN0ZWQ6IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX2FkZEV2ZW50KFwiY2hhbmdlc0RldGVjdGVkXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHRcdGJhdGNoQ2hhbmdlczogZnVuY3Rpb24gKGRlc2NyaXB0aW9uLCBjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0XHQvLyBSZW1vdmUgZW1wdHkgYmF0Y2hlcyBpZiBhIGRlc2NyaXB0aXZlIHRpdGxlIG9yIHVzZXIgaXMgbm90IHNwZWNpZmllZC5cclxuXHRcdFx0Ly8gSWYgYSB0aXRsZSBvciB1c2VyIGlzIHNwZWNpZmllZCB0aGVuIGl0IG1heSBiZSBkZXNpcmVhYmxlIHRvIGtlZXAgaXQgZm9yIGRpYWdub3N0aWMgcHVycG9zZXMuXHJcblx0XHRcdHZhciByZW1vdmVJZkVtcHR5ID0gIWRlc2NyaXB0aW9uICYmICF0aGlzLl9sb2NhbFVzZXI7XHJcblxyXG5cdFx0XHR0aGlzLl9jaGFuZ2VMb2cuYmF0Y2hDaGFuZ2VzKGRlc2NyaXB0aW9uLCB0aGlzLl9sb2NhbFVzZXIsIHRoaXNQdHIgPyBjYWxsYmFjay5iaW5kKHRoaXNQdHIpIDogY2FsbGJhY2ssIHJlbW92ZUlmRW1wdHkpO1xyXG5cdFx0fSxcclxuXHRcdGNoYW5nZXM6IGZ1bmN0aW9uIFNlcnZlclN5bmMkY2hhbmdlcyhpbmNsdWRlQWxsQ2hhbmdlcywgc2ltdWxhdGVJbml0Um9vdCwgZXhjbHVkZU5vblBlcnNpc3RlZCkge1xyXG5cdFx0XHR2YXIgbGlzdCA9IFtdO1xyXG5cdFx0XHR2YXIgc2V0cyA9IHNlcmlhbGl6ZUNoYW5nZXMuY2FsbCh0aGlzLCBpbmNsdWRlQWxsQ2hhbmdlcywgc2ltdWxhdGVJbml0Um9vdCk7XHJcblx0XHRcdHNldHMuZm9yRWFjaChmdW5jdGlvbiAoc2V0KSB7XHJcblx0XHRcdFx0aWYgKGV4Y2x1ZGVOb25QZXJzaXN0ZWQpIHtcclxuXHRcdFx0XHRcdGxpc3QuYWRkUmFuZ2Uoc2V0LmNoYW5nZXMuZmlsdGVyKGlzUHJvcGVydHlDaGFuZ2VQZXJzaXN0ZWQpKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRsaXN0LmFkZFJhbmdlKHNldC5jaGFuZ2VzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0XHRyZXR1cm4gbGlzdDtcclxuXHRcdH0sXHJcblx0XHRnZXRfU2VydmVyVGltZXpvbmVPZmZzZXQ6IGZ1bmN0aW9uIFNlcnZlclN5bmMkZ2V0X1NlcnZlclRpbWV6b25lT2Zmc2V0KCkge1xyXG5cdFx0XHQvL2lmIHdlIGhhdmUgbm90IHNldCB0aGUgc2VydmVyIHRpbWV6b25lIG9mZnNldCB5ZXQsIHJldHJpZXZlIGl0IGZyb20gdGhlIHNlcnZlclxyXG5cdFx0XHR2YXIgdGltZXpvbmVPZmZzZXQgPSAwO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMuX3NlcnZlckluZm8gIT09IG51bGwpIHtcclxuXHRcdFx0XHR0aW1lem9uZU9mZnNldCA9IHRoaXMuX3NlcnZlckluZm8uVGltZVpvbmVPZmZzZXQ7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiB0aW1lem9uZU9mZnNldDtcclxuXHRcdH0sXHJcblx0XHRzZXRfU2VydmVySW5mbzogZnVuY3Rpb24gU2VydmVyU3luYyRzZXRfU2VydmVyVGltZXpvbmVPZmZzZXQobmV3SW5mbykge1xyXG5cdFx0XHQvL2pvaW4gdGhlIG5ldyBzZXJ2ZXIgaW5mbyB3aXRoIHRoZSBpbmZvcm1hdGlvbiB0aGF0IHlvdSBhcmUgYWRkaW5nLlxyXG5cdFx0XHR0aGlzLl9zZXJ2ZXJJbmZvID0gdGhpcy5fc2VydmVySW5mbyA/IGpRdWVyeS5leHRlbmQodGhpcy5fc2VydmVySW5mbywgbmV3SW5mbykgOiBuZXdJbmZvO1xyXG5cdFx0fSxcclxuXHRcdGdldF9sb2NhbFVzZXI6IGZ1bmN0aW9uIFNlcnZlclN5bmMkZ2V0X2xvY2FsVXNlcih1c2VyKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9sb2NhbFVzZXI7XHJcblx0XHR9LFxyXG5cdFx0c2V0X2xvY2FsVXNlcjogZnVuY3Rpb24gU2VydmVyU3luYyRzZXRfbG9jYWxVc2VyKHVzZXIpIHtcclxuXHRcdFx0dGhpcy5fbG9jYWxVc2VyID0gdXNlcjtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0UHJvcGVydHkucHJvdG90eXBlLnRyaWdnZXJzUm91bmR0cmlwID0gZnVuY3Rpb24gKHBhdGhzKSB7XHJcblx0XHR0aGlzLmFkZENoYW5nZWQoZnVuY3Rpb24gKHNlbmRlcikge1xyXG5cdFx0XHRpZiAoIWNvbnRleHQuc2VydmVyLmlzQXBwbHlpbmdDaGFuZ2VzKCkpIHtcclxuXHRcdFx0XHRFdmVudFNjb3BlJG9uRXhpdChmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0XHRzZW5kZXIubWV0YS50eXBlLm1vZGVsLnNlcnZlci5yb3VuZHRyaXAoc2VuZGVyLCBwYXRocyk7XHJcblx0XHRcdFx0XHR9LCAxMDApO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHR9O1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLk1hcHBlci5JbnRlcm5hbHNcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHR2YXIgU1RBVElDX0lEID0gXCJzdGF0aWNcIjtcclxuXHR2YXIgZGF0ZVJlZ2V4ID0gL14oXFxkezR9KS0oXFxkezJ9KS0oXFxkezJ9KVQoXFxkezJ9KVxcOihcXGR7Mn0pXFw6KFxcZHsyfSkoXFwuXFxkezN9KT9aJC9nO1xyXG5cdHZhciBkYXRlUmVnZXhSZXBsYWNlID0gXCIkMi8kMy8kMSAkNDokNTokNiBHTVRcIjtcclxuXHR2YXIgaGFzVGltZUZvcm1hdCA9IC9baEhtdHNdLztcclxuXHJcblx0ZnVuY3Rpb24gZW5zdXJlSnNUeXBlKG1vZGVsLCB0eXBlTmFtZSwgY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdHZhciBtdHlwZSA9IG1vZGVsLnR5cGUodHlwZU5hbWUpO1xyXG5cclxuXHRcdGlmICghbXR5cGUpIHtcclxuXHRcdFx0ZmV0Y2hUeXBlcyhtb2RlbCwgW3R5cGVOYW1lXSwgZnVuY3Rpb24oanN0eXBlKSB7XHJcblx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMsIGpzdHlwZSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAoTGF6eUxvYWRlci5pc1JlZ2lzdGVyZWQobXR5cGUpKSB7XHJcblx0XHRcdExhenlMb2FkZXIubG9hZChtdHlwZSwgbnVsbCwgZmFsc2UsIGZ1bmN0aW9uKGpzdHlwZSkge1xyXG5cdFx0XHRcdGNhbGxiYWNrLmFwcGx5KHRoaXNQdHIgfHwgdGhpcywgW2pzdHlwZV0pO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRjYWxsYmFjay5hcHBseSh0aGlzUHRyIHx8IHRoaXMsIFttdHlwZS5nZXRfanN0eXBlKCldKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGNvbmRpdGlvbnNGcm9tSnNvbihtb2RlbCwgY29uZGl0aW9uc0pzb24sIGZvckluc3RhbmNlcywgY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHJcblx0XHRmb3IgKHZhciBjb25kaXRpb25Db2RlIGluIGNvbmRpdGlvbnNKc29uKSB7XHJcblx0XHRcdGNvbmRpdGlvbkZyb21Kc29uKG1vZGVsLCBmb3JJbnN0YW5jZXMsIGNvbmRpdGlvbkNvZGUsIGNvbmRpdGlvbnNKc29uW2NvbmRpdGlvbkNvZGVdKTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoY2FsbGJhY2sgJiYgY2FsbGJhY2sgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG5cdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcyk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBjb25kaXRpb25Gcm9tSnNvbihtb2RlbCwgZm9ySW5zdGFuY2VzLCBjb25kaXRpb25Db2RlLCBjb25kaXRpb25zSnNvbikge1xyXG5cdFx0dmFyIGNvbmRpdGlvblR5cGUgPSBFeG9XZWIuTW9kZWwuQ29uZGl0aW9uVHlwZS5nZXQoY29uZGl0aW9uQ29kZSk7XHJcblxyXG5cdFx0aWYgKCFjb25kaXRpb25UeXBlKSB7XHJcblx0XHRcdGxvZ1dhcm5pbmcoXCJBIGNvbmRpdGlvbiB0eXBlIHdpdGggY29kZSBcXFwiXCIgKyBjb25kaXRpb25Db2RlICsgXCJcXFwiIGNvdWxkIG5vdCBiZSBmb3VuZC5cIik7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgc2VydmVyU3luYyA9IG1vZGVsLnNlcnZlcjtcclxuXHJcblx0XHQvLyBwcm9jZXNzIGVhY2ggY29uZGl0aW9uXHJcblx0XHRpZiAoZm9ySW5zdGFuY2VzKSB7XHJcblx0XHRcdGNvbmRpdGlvbnNKc29uLmZvckVhY2goZnVuY3Rpb24gKGNvbmRpdGlvbkpzb24pIHtcclxuXHRcdFx0XHR2YXIgcm9vdFRhcmdldCA9IGNvbmRpdGlvbkpzb24udGFyZ2V0c1swXTtcclxuXHRcdFx0XHRpZiAocm9vdFRhcmdldCkge1xyXG5cdFx0XHRcdFx0dHJ5R2V0SnNUeXBlKHNlcnZlclN5bmMubW9kZWwsIHJvb3RUYXJnZXQuaW5zdGFuY2UudHlwZSwgbnVsbCwgZmFsc2UsIGZ1bmN0aW9uIChqc3R5cGUpIHtcclxuXHRcdFx0XHRcdFx0dHJ5R2V0RW50aXR5KHNlcnZlclN5bmMubW9kZWwsIHNlcnZlclN5bmMuX3RyYW5zbGF0b3IsIGpzdHlwZSwgcm9vdFRhcmdldC5pbnN0YW5jZS5pZCwgbnVsbCwgTGF6eUxvYWRFbnVtLk5vbmUsIGZ1bmN0aW9uIChyb290VGFyZ2V0SW5zdGFuY2UpIHtcclxuXHRcdFx0XHRcdFx0XHRpZiAoZm9ySW5zdGFuY2VzLmluZGV4T2Yocm9vdFRhcmdldEluc3RhbmNlKSA+PSAwKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRjb25kaXRpb25UYXJnZXRzRnJvbUpzb24obW9kZWwsIGNvbmRpdGlvblR5cGUsIGNvbmRpdGlvbkpzb24ubWVzc2FnZSwgY29uZGl0aW9uSnNvbi50YXJnZXRzKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRjb25kaXRpb25zSnNvbi5mb3JFYWNoKGZ1bmN0aW9uIChjb25kaXRpb25Kc29uKSB7XHJcblx0XHRcdFx0Y29uZGl0aW9uVGFyZ2V0c0Zyb21Kc29uKG1vZGVsLCBjb25kaXRpb25UeXBlLCBjb25kaXRpb25Kc29uLm1lc3NhZ2UsIGNvbmRpdGlvbkpzb24udGFyZ2V0cyk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gY29uZGl0aW9uVGFyZ2V0c0Zyb21Kc29uKG1vZGVsLCBjb25kaXRpb25UeXBlLCBtZXNzYWdlLCB0YXJnZXRzSnNvbikge1xyXG5cdFx0dmFyIGNvbmRpdGlvbiA9IG5ldyBDb25kaXRpb24oY29uZGl0aW9uVHlwZSwgbWVzc2FnZSwgbnVsbCwgbnVsbCwgXCJzZXJ2ZXJcIik7XHJcblxyXG5cdFx0dmFyIHNlcnZlclN5bmMgPSBtb2RlbC5zZXJ2ZXI7XHJcblxyXG5cdFx0Ly8gcHJvY2VzcyBlYWNoIGNvbmRpdGlvbiB0YXJnZXRcclxuXHRcdHRhcmdldHNKc29uLmZvckVhY2goZnVuY3Rpb24gKHRhcmdldCkge1xyXG5cdFx0XHR0cnlHZXRKc1R5cGUoc2VydmVyU3luYy5tb2RlbCwgdGFyZ2V0Lmluc3RhbmNlLnR5cGUsIG51bGwsIGZhbHNlLCBmdW5jdGlvbiAoanN0eXBlKSB7XHJcblx0XHRcdFx0dHJ5R2V0RW50aXR5KHNlcnZlclN5bmMubW9kZWwsIHNlcnZlclN5bmMuX3RyYW5zbGF0b3IsIGpzdHlwZSwgdGFyZ2V0Lmluc3RhbmNlLmlkLCBudWxsLCBMYXp5TG9hZEVudW0uTm9uZSwgZnVuY3Rpb24gKGluc3RhbmNlKSB7XHJcblx0XHRcdFx0XHRjb25kaXRpb24udGFyZ2V0cy5wdXNoKG5ldyBDb25kaXRpb25UYXJnZXQoY29uZGl0aW9uLCBpbnN0YW5jZSwgdGFyZ2V0LnByb3BlcnRpZXMubWFwKGZ1bmN0aW9uIChwKSB7IHJldHVybiBqc3R5cGUubWV0YS5wcm9wZXJ0eShwKTsgfSkpKTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fSk7XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIG9iamVjdHNGcm9tSnNvbihtb2RlbCwganNvbiwgY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdHZhciBzaWduYWwgPSBuZXcgRXhvV2ViLlNpZ25hbChcIm9iamVjdHNGcm9tSnNvblwiKTtcclxuXHRcdHZhciBvYmplY3RzTG9hZGVkID0gW107XHJcblx0XHRmb3IgKHZhciB0eXBlTmFtZSBpbiBqc29uKSB7XHJcblx0XHRcdHZhciBwb29sSnNvbiA9IGpzb25bdHlwZU5hbWVdO1xyXG5cdFx0XHRmb3IgKHZhciBpZCBpbiBwb29sSnNvbikge1xyXG5cdFx0XHRcdC8vIGxvY2F0ZSB0aGUgb2JqZWN0J3Mgc3RhdGUgaW4gdGhlIGpzb25cclxuXHRcdFx0XHRvYmplY3RGcm9tSnNvbihtb2RlbCwgdHlwZU5hbWUsIGlkLCBwb29sSnNvbltpZF0sIHNpZ25hbC5wZW5kaW5nKGZ1bmN0aW9uIChvYmopIHtcclxuXHRcdFx0XHRcdGlmIChvYmopIHtcclxuXHRcdFx0XHRcdFx0b2JqZWN0c0xvYWRlZC5wdXNoKG9iaik7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSksIHRoaXNQdHIpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0c2lnbmFsLndhaXRGb3JBbGwoZnVuY3Rpb24oKSB7XHJcblx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzLCBvYmplY3RzTG9hZGVkKTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gb2JqZWN0RnJvbUpzb24obW9kZWwsIHR5cGVOYW1lLCBpZCwganNvbiwgY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdC8vIGdldCB0aGUgb2JqZWN0IHRvIGxvYWRcclxuXHRcdHZhciBvYmo7XHJcblxyXG5cdFx0Ly8gZmFtaWx5LXF1YWxpZmllZCB0eXBlIG5hbWUgaXMgbm90IGF2YWlsYWJsZSBzbyBjYW4ndCB1c2UgZ2V0VHlwZSgpXHJcblx0XHR2YXIgbXR5cGUgPSBtb2RlbC50eXBlKHR5cGVOYW1lKTtcclxuXHJcblx0XHQvLyBpZiB0aGlzIHR5cGUgaGFzIG5ldmVyIGJlZW4gc2VlbiwgZ28gYW5kIGZldGNoIGl0IGFuZCByZXN1bWUgbGF0ZXJcclxuXHRcdGlmICghbXR5cGUpIHtcclxuXHRcdFx0ZmV0Y2hUeXBlcyhtb2RlbCwgW3R5cGVOYW1lXSwgZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdG9iamVjdEZyb21Kc29uKG1vZGVsLCB0eXBlTmFtZSwgaWQsIGpzb24sIGNhbGxiYWNrKTtcclxuXHRcdFx0fSk7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBMb2FkIG9iamVjdCdzIHR5cGUgaWYgbmVlZGVkXHJcblx0XHRpZiAoTGF6eUxvYWRlci5pc1JlZ2lzdGVyZWQobXR5cGUpKSB7XHJcblx0XHRcdExhenlMb2FkZXIubG9hZChtdHlwZSwgbnVsbCwgZmFsc2UsIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdG9iamVjdEZyb21Kc29uKG1vZGVsLCB0eXBlTmFtZSwgaWQsIGpzb24sIGNhbGxiYWNrLCB0aGlzUHRyKTtcclxuXHRcdFx0fSk7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBnZXQgdGFyZ2V0IG9iamVjdCB0byBsb2FkXHJcblx0XHRpZiAoaWQgPT09IFNUQVRJQ19JRCkge1xyXG5cdFx0XHRvYmogPSBudWxsO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdG9iaiA9IGdldE9iamVjdChtb2RlbCwgdHlwZU5hbWUsIGlkLCBudWxsLCB0cnVlKTtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgbG9hZGVkT2JqO1xyXG5cclxuXHRcdHZhciBpbml0T2JqID0gZmFsc2U7XHJcblx0XHRpZiAoaWQgPT09IFNUQVRJQ19JRCkge1xyXG5cdFx0XHRpbml0T2JqID0gdHJ1ZTtcclxuXHRcdH0gZWxzZSBpZiAob2JqKSB7XHJcblx0XHRcdGlmIChMYXp5TG9hZGVyLmlzUmVnaXN0ZXJlZChvYmopKSB7XHJcblx0XHRcdFx0aW5pdE9iaiA9IHRydWU7XHJcblx0XHRcdFx0Ly8gdHJhY2sgdGhlIG5ld2x5IGxvYWRlZCBpbnN0YW5jZSB0byBwYXNzIHRvIHRoZSBjYWxsZXIgd2hlbiBjb21wbGV0ZVxyXG5cdFx0XHRcdGxvYWRlZE9iaiA9IG9iajtcclxuXHRcdFx0XHQvLyB1bnJlZ2lzdGVyIHRoZSBpbnN0YW5jZSBmcm9tIGxvYWRpbmdcclxuXHRcdFx0XHRPYmplY3RMYXp5TG9hZGVyLnVucmVnaXN0ZXIob2JqKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAob2JqLndhc0dob3N0ZWQpIHtcclxuXHRcdFx0XHRpbml0T2JqID0gdHJ1ZTtcclxuXHRcdFx0XHQvLyB0cmFjayB0aGUgbmV3bHkgbG9hZGVkIGluc3RhbmNlIHRvIHBhc3MgdG8gdGhlIGNhbGxlciB3aGVuIGNvbXBsZXRlXHJcblx0XHRcdFx0bG9hZGVkT2JqID0gb2JqO1xyXG5cdFx0XHRcdGRlbGV0ZSBvYmoud2FzR2hvc3RlZDtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdC8vIENvbnRpbnVlIGlmIHRoZSBvYmplY3QgbmVlZHMgdG8gYmUgaW5pdGlhbGl6ZWQgKGdob3N0ZWQgb3IgbGF6eSBsb2FkZWQpLFxyXG5cdFx0Ly8gb3IgdGhlcmUgaXMgbm8gb2JqZWN0IChsb2FkIHN0YXRpYyBsaXN0cyksIG9yIHRoZSBvYmplY3QgaXMgbm90IG5ldyAobG9hZFxyXG5cdFx0Ly8gbm9uLWxvYWRlZCBsaXN0IHByb3BlcnRpZXMgZm9yIGFuIG9iamVjdCB0aGF0IHdhcyBwcmV2aW91c2x5IGxvYWRlZCkuXHJcblx0XHRpZiAoaW5pdE9iaiB8fCAhb2JqIHx8ICFvYmoubWV0YS5pc05ldykge1xyXG5cdFx0XHR2YXIgbG9hZGVkUHJvcGVydGllcyA9IFtdO1xyXG5cclxuXHRcdFx0Ly8gTG9hZCBvYmplY3QncyBwcm9wZXJ0aWVzXHJcblx0XHRcdGZvciAodmFyIHQgPSBtdHlwZTsgdCAhPT0gbnVsbDsgdCA9IG9iaiA/IHQuYmFzZVR5cGUgOiBudWxsKSB7XHJcblx0XHRcdFx0dmFyIHByb3BzID0gb2JqID8gdC5nZXRfaW5zdGFuY2VQcm9wZXJ0aWVzKCkgOiB0LmdldF9zdGF0aWNQcm9wZXJ0aWVzKCk7XHJcblxyXG5cdFx0XHRcdGZvciAodmFyIHByb3BOYW1lIGluIHByb3BzKSB7XHJcblx0XHRcdFx0XHRpZiAobG9hZGVkUHJvcGVydGllcy5pbmRleE9mKHByb3BOYW1lKSA+PSAwKSB7XHJcblx0XHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGxvYWRlZFByb3BlcnRpZXMucHVzaChwcm9wTmFtZSk7XHJcblxyXG5cdFx0XHRcdFx0dmFyIHByb3AgPSBwcm9wc1twcm9wTmFtZV07XHJcblxyXG5cdFx0XHRcdFx0aWYgKCFwcm9wKSB7XHJcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcigkZm9ybWF0KFwiQ2Fubm90IGxvYWQgb2JqZWN0IHswfXx7Mn0gYmVjYXVzZSBpdCBoYXMgYW4gdW5leHBlY3RlZCBwcm9wZXJ0eSAnezF9J1wiLCB0eXBlTmFtZSwgcHJvcE5hbWUsIGlkKSk7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0aWYgKHByb3AuZ2V0X29yaWdpbigpICE9PSBcInNlcnZlclwiKSB7XHJcblx0XHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGlmICghaW5pdE9iaiAmJiAhcHJvcC5nZXRfaXNMaXN0KCkpIHtcclxuXHRcdFx0XHRcdFx0Ly8gSWYgdGhlIHJvb3Qgb2JqZWN0IGlzIGFscmVhZHkgaW5pdGlhbGl6ZWQsIHRoZW4gc2tpcCBvdmVyIG5vbi1saXN0IHByb3BlcnRpZXMuXHJcblx0XHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdHZhciBwcm9wRGF0YTtcclxuXHJcblx0XHRcdFx0XHQvLyBpbnN0YW5jZSBmaWVsZHMgaGF2ZSBpbmRleGVzLCBzdGF0aWMgZmllbGRzIHVzZSBuYW1lc1xyXG5cdFx0XHRcdFx0aWYgKG9iaikge1xyXG5cdFx0XHRcdFx0XHRwcm9wRGF0YSA9IGpzb25bcHJvcC5nZXRfaW5kZXgoKV07XHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRwcm9wRGF0YSA9IGpzb25bcHJvcE5hbWVdO1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gbm90IGFsbCBzdGF0aWMgZmllbGRzIG1heSBiZSBwcmVzZW50XHJcblx0XHRcdFx0XHRcdGlmIChwcm9wRGF0YSA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHRcdFx0Y29udGludWU7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRpZiAocHJvcERhdGEgIT09IG51bGwpIHtcclxuXHRcdFx0XHRcdFx0dmFyIHByb3BUeXBlID0gcHJvcC5nZXRfanN0eXBlKCk7XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBBbHdheXMgcHJvY2VzcyBsaXN0IHByb3BlcnRpZXMgc2luY2UgdGhleSBjYW4gYmUgbG9hZGVkIGFmdGVyIHRoZSBwYXJlbnQgb2JqZWN0LlxyXG5cdFx0XHRcdFx0XHRpZiAocHJvcC5nZXRfaXNMaXN0KCkpIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgbGlzdCA9IHByb3AuZ2V0X2lzU3RhdGljKCkgPyBwcm9wLnZhbHVlKCkgOiBvYmpbcHJvcC5fZmllbGROYW1lXTtcclxuXHJcblx0XHRcdFx0XHRcdFx0aWYgKHByb3BEYXRhID09IFwiP1wiKSB7XHJcblx0XHRcdFx0XHRcdFx0XHQvLyBkb24ndCBvdmVyd3JpdGUgbGlzdCBpZiBpdHMgYWxyZWFkeSBhIGdob3N0XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoIWxpc3QpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0bGlzdCA9IExpc3RMYXp5TG9hZGVyLnJlZ2lzdGVyKG9iaiwgcHJvcCk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFByb3BlcnR5JF9pbml0LmNhbGwocHJvcCwgb2JqLCBsaXN0LCBmYWxzZSk7XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdGlmICghbGlzdCB8fCBMYXp5TG9hZGVyLmlzUmVnaXN0ZXJlZChsaXN0KSkge1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIGRvaW5nT2JqZWN0SW5pdCA9IHVuZGVmaW5lZDtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly92YXIgbmV3SXRlbXMgPSBbXTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdC8vIGpzb24gaGFzIGxpc3QgbWVtYmVyc1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAobGlzdCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdExpc3RMYXp5TG9hZGVyLnVucmVnaXN0ZXIobGlzdCk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0ZG9pbmdPYmplY3RJbml0ID0gZmFsc2U7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0bGlzdCA9IFtdO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGRvaW5nT2JqZWN0SW5pdCA9IHRydWU7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcERhdGEubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgcmVmID0gcHJvcERhdGFbaV07XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIGMgPSBnZXRPYmplY3QobW9kZWwsIHByb3BUeXBlLCAocmVmICYmIHJlZi5pZCB8fCByZWYpLCAocmVmICYmIHJlZi50eXBlIHx8IHByb3BUeXBlKSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKGxpc3QuY29udGFpbnMoYykpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGxvZ1dhcm5pbmcoJGZvcm1hdChcIkluaXRpYWxpemluZyBsaXN0IHswfXx7MX0uezJ9IGFscmVhZHkgY29udGFpbnMgb2JqZWN0IHszfS5cIiwgdHlwZU5hbWUsIGlkLCBwcm9wLl9uYW1lLCBFbnRpdHkudG9JZFN0cmluZyhjKSkpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHQvL25ld0l0ZW1zLnB1c2goYyk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0bGlzdC5wdXNoKGMpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoZG9pbmdPYmplY3RJbml0KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0UHJvcGVydHkkX2luaXQuY2FsbChwcm9wLCBvYmosIGxpc3QpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8vIENvbGxlY3Rpb24gY2hhbmdlIGRyaXZlbiBieSB1c2VyIGFjdGlvbiBvciBvdGhlciBiZWhhdmlvciB3b3VsZCByZXN1bHQgaW4gdGhlIFwiY2hhbmdlXCIgZXZlbnRcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBiZWluZyByYWlzZWQgZm9yIHRoZSBsaXN0IHByb3BlcnR5LiAgU2luY2Ugd2UgZG9uJ3Qgd2FudCB0byByZWNvcmQgdGhpcyBhcyBhIHRydWUgb2JzZXJ2YWJsZVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8vIGNoYW5nZSwgcmFpc2UgdGhlIGV2ZW50IG1hbnVhbGx5IHNvIHRoYXQgcnVsZXMgd2lsbCBzdGlsbCBydW4gYXMgbmVlZGVkLlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8vaWYgKG9iaikge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHByb3AuX3JhaXNlRXZlbnQoXCJjaGFuZ2VkXCIsIFtvYmosIHsgcHJvcGVydHk6IHByb3AsIG5ld1ZhbHVlOiBsaXN0LCBvbGRWYWx1ZTogdW5kZWZpbmVkLCBjb2xsZWN0aW9uQ2hhbmdlZDogdHJ1ZSB9XSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Ly99XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8vIEV4YW1wbGUgb2YgZXhwbGljaXRseSByYWlzaW5nIHRoZSBjb2xsZWN0aW9uIGNoYW5nZSBldmVudCBpZiBuZWVkZWQuXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Ly8gTk9URTogVGhpcyBpcyBwcm9iYWJseSBub3QgbmVjZXNzYXJ5IGJlY2F1c2UgaXQgaXMgZGlmZmljdWx0IHRvIGdldCBhIHJlZmVyZW5jZSB0byBhXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Ly8gbm9uLWxvYWRlZCBsaXN0IGFuZCBzbyBub3RoaW5nIHdvdWxkIGJlIHdhdGNoaW5nIGZvciBjaGFuZ2VzIHByaW9yIHRvIGxvYWRpbmcgY29tcGxldGlvbi5cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBUaGUgX2luaXRpYWxpemluZyBmbGFnIHdvdWxkIGJlIG5lY2Vzc2FyeSB0byBzaWduYWwgdG8gdGhlIHByb3BlcnR5J3MgY29sbGVjdGlvbiBjaGFuZ2VcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBoYW5kbGVyIHRoYXQgaXQgc2hvdWxkIG5vdCByYWlzZSB0aGUgdmFyaW91cyBldmVudHMgaW4gcmVzcG9uc2UgdG8gdGhlIGNvbGxlY3Rpb24gY2hhbmdlLlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8vbGlzdC5faW5pdGlhbGl6aW5nID0gdHJ1ZTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHQvL1N5cy5PYnNlcnZlci5yYWlzZUNvbGxlY3Rpb25DaGFuZ2VkKGxpc3QsIFtuZXcgU3lzLkNvbGxlY3Rpb25DaGFuZ2UoU3lzLk5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkQWN0aW9uLmFkZCwgbmV3SXRlbXMsIDApXSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Ly9kZWxldGUgbGlzdC5faW5pdGlhbGl6aW5nO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKGluaXRPYmopIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgY3RvciA9IHByb3AuZ2V0X2pzdHlwZSh0cnVlKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0Ly8gYXNzdW1lIGlmIGN0b3IgaXMgbm90IGZvdW5kIGl0cyBhIG1vZGVsIHR5cGUgbm90IGFuIGludHJpbnNpY1xyXG5cdFx0XHRcdFx0XHRcdGlmICghY3RvciB8fCBjdG9yLm1ldGEpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFByb3BlcnR5JF9pbml0LmNhbGwocHJvcCwgb2JqLCBnZXRPYmplY3QobW9kZWwsIHByb3BUeXBlLCAocHJvcERhdGEgJiYgcHJvcERhdGEuaWQgfHwgcHJvcERhdGEpLCAocHJvcERhdGEgJiYgcHJvcERhdGEudHlwZSB8fCBwcm9wVHlwZSkpKTtcclxuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gQ29lcmNlIHN0cmluZ3MgaW50byBkYXRlc1xyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKGN0b3IgPT0gRGF0ZSAmJiBwcm9wRGF0YSAmJiBwcm9wRGF0YS5jb25zdHJ1Y3RvciA9PSBTdHJpbmcgJiYgcHJvcERhdGEubGVuZ3RoID4gMCkge1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gQ29udmVydCBmcm9tIHN0cmluZyAoZS5nLjogXCIyMDExLTA3LTI4VDA2OjAwOjAwLjAwMFpcIikgdG8gZGF0ZS5cclxuXHRcdFx0XHRcdFx0XHRcdFx0ZGF0ZVJlZ2V4Lmxhc3RJbmRleCA9IDA7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHByb3BEYXRhID0gbmV3IERhdGUocHJvcERhdGEucmVwbGFjZShkYXRlUmVnZXgsIGRhdGVSZWdleFJlcGxhY2UpKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdC8vbm93IHRoYXQgd2UgaGF2ZSB0aGUgdmFsdWUgc2V0IGZvciB0aGUgZGF0ZS5cclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly9pZiB0aGUgdW5kZXJseWluZyBwcm9wZXJ0eSBkYXRhdHlwZSBpcyBhY3R1YWxseSBhIGRhdGUgYW5kIG5vdCBhIGRhdGV0aW1lXHJcblx0XHRcdFx0XHRcdFx0XHRcdC8vdGhlbiB3ZSBuZWVkIHRvIGFkZCB0aGUgbG9jYWwgdGltZXpvbmUgb2Zmc2V0IHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBkYXRlIGlzIGRpc3BsYXllZCBhY3VyYXRlbHkuXHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmIChwcm9wLmdldF9mb3JtYXQoKSAmJiAhaGFzVGltZUZvcm1hdC50ZXN0KHByb3AuZ2V0X2Zvcm1hdCgpLnRvU3RyaW5nKCkpKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIHNlcnZlck9mZnNldCA9IG1vZGVsLnNlcnZlci5nZXRfU2VydmVyVGltZXpvbmVPZmZzZXQoKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgbG9jYWxPZmZzZXQgPSAtKG5ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKSAvIDYwKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRwcm9wRGF0YSA9IHByb3BEYXRhLmFkZEhvdXJzKHNlcnZlck9mZnNldCAtIGxvY2FsT2Zmc2V0KTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmIChjdG9yID09PSBUaW1lU3Bhbikge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRwcm9wRGF0YSA9IG5ldyBUaW1lU3Bhbihwcm9wRGF0YS5Ub3RhbE1pbGxpc2Vjb25kcyk7XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRQcm9wZXJ0eSRfaW5pdC5jYWxsKHByb3AsIG9iaiwgcHJvcERhdGEpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fSBlbHNlIGlmIChpbml0T2JqKSB7XHJcblx0XHRcdFx0XHRcdFByb3BlcnR5JF9pbml0LmNhbGwocHJvcCwgb2JqLCBudWxsKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRpZiAoY2FsbGJhY2sgJiYgY2FsbGJhY2sgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG5cdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcywgbG9hZGVkT2JqKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHR5cGVzRnJvbUpzb24obW9kZWwsIGpzb24sIG9uVHlwZUxvYWRTdWNjZXNzLCBvblR5cGVMb2FkRmFpbHVyZSkge1xyXG5cdFx0Zm9yICh2YXIgdHlwZU5hbWUgaW4ganNvbikge1xyXG5cdFx0XHR2YXIgdHlwZUpzb24gPSBqc29uW3R5cGVOYW1lXTtcclxuXHRcdFx0aWYgKHR5cGVKc29uID09PSBudWxsKSB7XHJcblx0XHRcdFx0aWYgKG9uVHlwZUxvYWRGYWlsdXJlKSB7XHJcblx0XHRcdFx0XHRvblR5cGVMb2FkRmFpbHVyZSh0eXBlTmFtZSwgbnVsbCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdHR5cGVGcm9tSnNvbihtb2RlbCwgdHlwZU5hbWUsIHR5cGVKc29uKTtcclxuXHRcdFx0XHRpZiAob25UeXBlTG9hZFN1Y2Nlc3MpIHtcclxuXHRcdFx0XHRcdG9uVHlwZUxvYWRTdWNjZXNzKHR5cGVOYW1lLCB0eXBlSnNvbik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiB0eXBlRnJvbUpzb24obW9kZWwsIHR5cGVOYW1lLCBqc29uKSB7XHJcblx0XHQvLyBnZXQgbW9kZWwgdHlwZS4gaXQgbWF5IGhhdmUgYWxyZWFkeSBiZWVuIGNyZWF0ZWQgZm9yIGxhenkgbG9hZGluZ1xyXG5cdFx0dmFyIG10eXBlID0gZ2V0VHlwZShtb2RlbCwgdHlwZU5hbWUsIGpzb24uYmFzZVR5cGUpO1xyXG5cclxuXHRcdC8vIHNldCB0aGUgZGVmYXVsdCB0eXBlIGZvcm1hdFxyXG5cdFx0aWYgKGpzb24uZm9ybWF0KSB7XHJcblx0XHRcdG10eXBlLnNldF9mb3JtYXQoZ2V0Rm9ybWF0KG10eXBlLmdldF9qc3R5cGUoKSwganNvbi5mb3JtYXQpKTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAobXR5cGUuZ2V0X29yaWdpbkZvck5ld1Byb3BlcnRpZXMoKSA9PT0gXCJjbGllbnRcIikge1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJUeXBlIFxcXCJcIiArIG10eXBlLl9mdWxsTmFtZSArIFwiXFxcIiBoYXMgYWxyZWFkeSBiZWVuIGxvYWRlZFwiKTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBzdG9yZSBleHBvcnRzXHJcblx0XHRpZiAoanNvbi5leHBvcnRzKSB7XHJcblx0XHRcdG10eXBlLnNldF9leHBvcnRzKGpzb24uZXhwb3J0cyk7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gZGVmaW5lIHByb3BlcnRpZXNcclxuXHRcdGZvciAodmFyIHByb3BOYW1lIGluIGpzb24ucHJvcGVydGllcykge1xyXG5cdFx0XHR2YXIgcHJvcEpzb24gPSBqc29uLnByb3BlcnRpZXNbcHJvcE5hbWVdO1xyXG5cclxuXHRcdFx0Ly8gVHlwZVxyXG5cdFx0XHR2YXIgcHJvcFR5cGUgPSBwcm9wSnNvbi50eXBlO1xyXG5cdFx0XHRpZiAocHJvcEpzb24udHlwZS5lbmRzV2l0aChcIltdXCIpKSB7XHJcblx0XHRcdFx0cHJvcFR5cGUgPSBwcm9wVHlwZS50b1N0cmluZygpLnN1YnN0cmluZygwLCBwcm9wVHlwZS5sZW5ndGggLSAyKTtcclxuXHRcdFx0XHRwcm9wSnNvbi5pc0xpc3QgPSB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHRcdHByb3BUeXBlID0gZ2V0SnNUeXBlKG1vZGVsLCBwcm9wVHlwZSk7XHJcblxyXG5cdFx0XHQvLyBGb3JtYXRcclxuXHRcdFx0dmFyIGZvcm1hdCA9IGdldEZvcm1hdChwcm9wVHlwZSwgcHJvcEpzb24uZm9ybWF0KTtcclxuXHJcblx0XHRcdC8vIEFkZCB0aGUgcHJvcGVydHlcclxuXHRcdFx0dmFyIHByb3AgPSBtdHlwZS5hZGRQcm9wZXJ0eSh7XHJcblx0XHRcdFx0bmFtZTogcHJvcE5hbWUsXHJcblx0XHRcdFx0dHlwZTogcHJvcFR5cGUsXHJcblx0XHRcdFx0bGFiZWw6IHByb3BKc29uLmxhYmVsLFxyXG5cdFx0XHRcdGhlbHB0ZXh0OiBwcm9wSnNvbi5oZWxwdGV4dCxcclxuXHRcdFx0XHRmb3JtYXQ6IGZvcm1hdCxcclxuXHRcdFx0XHRpc0xpc3Q6IHByb3BKc29uLmlzTGlzdCA9PT0gdHJ1ZSxcclxuXHRcdFx0XHRpc1N0YXRpYzogcHJvcEpzb24uaXNTdGF0aWMgPT09IHRydWUsXHJcblx0XHRcdFx0aXNQZXJzaXN0ZWQ6IHByb3BKc29uLmlzUGVyc2lzdGVkICE9PSBmYWxzZSxcclxuXHRcdFx0XHRpc0NhbGN1bGF0ZWQ6IHByb3BKc29uLmlzQ2FsY3VsYXRlZCA9PT0gdHJ1ZSxcclxuXHRcdFx0XHRpbmRleDogcHJvcEpzb24uaW5kZXgsXHJcblx0XHRcdFx0ZGVmYXVsdFZhbHVlOiBwcm9wSnNvbi5kZWZhdWx0VmFsdWUgPyBtdHlwZS5jb21waWxlRXhwcmVzc2lvbihwcm9wSnNvbi5kZWZhdWx0VmFsdWUpIDogdW5kZWZpbmVkLFxyXG5cdFx0XHRcdGNvbnN0YW50OiBwcm9wSnNvbi5jb25zdGFudFxyXG5cdFx0XHR9KTtcclxuXHRcdFxyXG5cdFx0XHQvLyBzZXR1cCBzdGF0aWMgcHJvcGVydGllcyBmb3IgbGF6eSBsb2FkaW5nXHJcblx0XHRcdGlmIChwcm9wSnNvbi5pc1N0YXRpYyAmJiBwcm9wSnNvbi5pc0xpc3QpIHtcclxuXHRcdFx0XHRQcm9wZXJ0eSRfaW5pdC5jYWxsKHByb3AsIG51bGwsIExpc3RMYXp5TG9hZGVyLnJlZ2lzdGVyKG51bGwsIHByb3ApKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gcHJvY2VzcyBwcm9wZXJ0eSBzcGVjaWZpYyBydWxlcywgd2hpY2ggaGF2ZSBhIHNwZWNpYWxpemVkIGpzb24gc3ludGF4IHRvIGltcHJvdmUgcmVhZGFiaWxpdHkgYW5kIG1pbmltaXplIHR5cGUganNvbiBzaXplXHJcblx0XHRcdGlmIChwcm9wSnNvbi5ydWxlcykge1xyXG5cdFx0XHRcdGZvciAodmFyIHJ1bGUgaW4gcHJvcEpzb24ucnVsZXMpIHtcclxuXHRcdFx0XHRcdHZhciBvcHRpb25zID0gcHJvcEpzb24ucnVsZXNbcnVsZV07XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0XHQvLyBkZWZhdWx0IHRoZSB0eXBlIHRvIHRoZSBydWxlIG5hbWUgaWYgbm90IHNwZWNpZmllZFxyXG5cdFx0XHRcdFx0aWYgKCFvcHRpb25zLnR5cGUpIHtcclxuXHRcdFx0XHRcdFx0b3B0aW9ucy50eXBlID0gcnVsZTtcclxuXHJcblx0XHRcdFx0XHRcdC8vIGNhbGN1bGF0ZSB0aGUgbmFtZSBvZiB0aGUgcnVsZSBpZiBub3Qgc3BlY2lmaWVkIGluIHRoZSBqc29uLCBhc3N1bWluZyBpdCB3aWxsIGJlIHVuaXF1ZVxyXG5cdFx0XHRcdFx0XHRpZiAoIW9wdGlvbnMubmFtZSkge1xyXG5cdFx0XHRcdFx0XHRcdG9wdGlvbnMubmFtZSA9IG10eXBlLmdldF9mdWxsTmFtZSgpICsgXCIuXCIgKyBwcm9wLmdldF9uYW1lKCkgKyBcIi5cIiArIHJ1bGUuc3Vic3RyKDAsIDEpLnRvVXBwZXJDYXNlKCkgKyBydWxlLnN1YnN0cigxKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdC8vIGluaXRpYWxpemUgdGhlIG5hbWUgb2YgdGhlIHJ1bGUgaWYgbm90IHNwZWNpZmllZCBpbiB0aGUganNvblxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAoIW9wdGlvbnMubmFtZSkge1xyXG5cdFx0XHRcdFx0XHRvcHRpb25zLm5hbWUgPSBydWxlO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdG9wdGlvbnMucHJvcGVydHkgPSBwcm9wO1xyXG5cdFx0XHRcdFx0cnVsZUZyb21Kc29uKG10eXBlLCBvcHRpb25zKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHQvLyBlbnN1cmUgYWxsIHByb3BlcnRpZXMgYWRkZWQgZnJvbSBub3cgb24gYXJlIGNvbnNpZGVyZWQgY2xpZW50IHByb3BlcnRpZXNcclxuXHRcdG10eXBlLnNldF9vcmlnaW5Gb3JOZXdQcm9wZXJ0aWVzKFwiY2xpZW50XCIpO1xyXG5cclxuXHRcdC8vIGRlZmluZSBtZXRob2RzXHJcblx0XHRmb3IgKHZhciBtZXRob2ROYW1lIGluIGpzb24ubWV0aG9kcykge1xyXG5cdFx0XHR2YXIgbWV0aG9kSnNvbiA9IGpzb24ubWV0aG9kc1ttZXRob2ROYW1lXTtcclxuXHRcdFx0bXR5cGUuYWRkTWV0aG9kKHsgbmFtZTogbWV0aG9kTmFtZSwgcGFyYW1ldGVyczogbWV0aG9kSnNvbi5wYXJhbWV0ZXJzLCBpc1N0YXRpYzogbWV0aG9kSnNvbi5pc1N0YXRpYyB9KTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBkZWZpbmUgY29uZGl0aW9uIHR5cGVzXHJcblx0XHRpZiAoanNvbi5jb25kaXRpb25UeXBlcylcclxuXHRcdFx0Y29uZGl0aW9uVHlwZXNGcm9tSnNvbihtb2RlbCwgbXR5cGUsIGpzb24uY29uZGl0aW9uVHlwZXMpO1xyXG5cclxuXHRcdC8vIGRlZmluZSBydWxlcyBcclxuXHRcdGlmIChqc29uLnJ1bGVzKSB7XHJcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwganNvbi5ydWxlcy5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRcdHJ1bGVGcm9tSnNvbihtdHlwZSwganNvbi5ydWxlc1tpXSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBjb25kaXRpb25UeXBlc0Zyb21Kc29uKG1vZGVsLCBtdHlwZSwganNvbikge1xyXG5cdFx0anNvbi5mb3JFYWNoKGZ1bmN0aW9uIChjdHlwZSkge1xyXG5cdFx0XHRjb25kaXRpb25UeXBlRnJvbUpzb24obXR5cGUsIGN0eXBlKTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gY29uZGl0aW9uVHlwZUZyb21Kc29uKG10eXBlLCBqc29uKSB7XHJcblxyXG5cdFx0Ly8gZm9yIHJ1bGVzIHRoYXQgYXNzZXJ0IGEgc2luZ2xlIGNvbmRpdGlvbiwgdGhlIGNvZGUgd2lsbCBiZSB0aGUgdW5pcXVlIG5hbWUgb2YgdGhlIHJ1bGVcclxuXHRcdGpzb24uY29kZSA9IGpzb24uY29kZSB8fCBqc29uLm5hbWU7XHJcblxyXG5cdFx0Ly8gYXR0ZW1wdCB0byByZXRyaWV2ZSB0aGUgY29uZGl0aW9uIHR5cGUgYnkgY29kZS5cclxuXHRcdHZhciBjb25kaXRpb25UeXBlID0gRXhvV2ViLk1vZGVsLkNvbmRpdGlvblR5cGUuZ2V0KGpzb24uY29kZSk7XHJcblxyXG5cdFx0Ly8gY3JlYXRlIHRoZSBjb25kaXRpb24gdHlwZSBpZiBpdCBkb2VzIG5vdCBhbHJlYWR5IGV4aXN0LlxyXG5cdFx0aWYgKCFjb25kaXRpb25UeXBlKSB7XHJcblxyXG5cdFx0XHQvLyBnZXQgYSBsaXN0IG9mIGNvbmRpdGlvbiB0eXBlIHNldHMgZm9yIHRoaXMgdHlwZS5cclxuXHRcdFx0dmFyIHNldHMgPSAhanNvbi5zZXRzID8gW10gOiBqc29uLnNldHMubWFwKGZ1bmN0aW9uKG5hbWUpIHtcclxuXHRcdFx0XHR2YXIgc2V0ID0gRXhvV2ViLk1vZGVsLkNvbmRpdGlvblR5cGVTZXQuZ2V0KG5hbWUpO1xyXG5cdFx0XHRcdGlmICghc2V0KSB7XHJcblx0XHRcdFx0XHRzZXQgPSBuZXcgRXhvV2ViLk1vZGVsLkNvbmRpdGlvblR5cGVTZXQobmFtZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHJldHVybiBzZXQ7XHJcblx0XHRcdH0pO1xyXG5cclxuXHRcdFx0Ly8gY3JlYXRlIHRoZSBhcHByb3ByaWF0ZSBjb25kaXRpb24gdHlwZSBiYXNlZCBvbiB0aGUgY2F0ZWdvcnkuXHJcblx0XHRcdGlmICghanNvbi5jYXRlZ29yeSB8fCBqc29uLmNhdGVnb3J5ID09IFwiRXJyb3JcIikge1xyXG5cdFx0XHRcdGNvbmRpdGlvblR5cGUgPSBuZXcgRXhvV2ViLk1vZGVsLkNvbmRpdGlvblR5cGUuRXJyb3IoanNvbi5jb2RlLCBqc29uLm1lc3NhZ2UsIHNldHMsIFwic2VydmVyXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKGpzb24uY2F0ZWdvcnkgPT0gXCJXYXJuaW5nXCIpIHtcclxuXHRcdFx0XHRjb25kaXRpb25UeXBlID0gbmV3IEV4b1dlYi5Nb2RlbC5Db25kaXRpb25UeXBlLldhcm5pbmcoanNvbi5jb2RlLCBqc29uLm1lc3NhZ2UsIHNldHMsIFwic2VydmVyXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKGpzb24uY2F0ZWdvcnkgPT0gXCJQZXJtaXNzaW9uXCIpIHtcclxuXHRcdFx0XHRjb25kaXRpb25UeXBlID0gbmV3IEV4b1dlYi5Nb2RlbC5Db25kaXRpb25UeXBlLlBlcm1pc3Npb24oanNvbi5jb2RlLCBqc29uLm1lc3NhZ2UsIHNldHMsIGpzb24ucGVybWlzc2lvblR5cGUsIGpzb24uaXNBbGxvd2VkLCBcInNlcnZlclwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRjb25kaXRpb25UeXBlID0gbmV3IEV4b1dlYi5Nb2RlbC5Db25kaXRpb25UeXBlKGpzb24uY29kZSwganNvbi5jYXRlZ29yeSwganNvbi5tZXNzYWdlLCBzZXRzLCBcInNlcnZlclwiKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gYWNjb3VudCBmb3IgdGhlIHBvdGVudGlhbCBmb3Igc3ViY2xhc3NlcyB0byBiZSBzZXJpYWxpemVkIHdpdGggYWRkaXRpb25hbCBwcm9wZXJ0aWVzLlxyXG5cdFx0XHRjb25kaXRpb25UeXBlLmV4dGVuZChqc29uKTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoanNvbi5ydWxlICYmIGpzb24ucnVsZS5oYXNPd25Qcm9wZXJ0eShcInR5cGVcIikpIHtcclxuXHRcdFx0Y29uZGl0aW9uVHlwZS5ydWxlcy5wdXNoKHJ1bGVGcm9tSnNvbihtdHlwZSwganNvbi5ydWxlLCBjb25kaXRpb25UeXBlKSk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIGNvbmRpdGlvblR5cGU7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBydWxlRnJvbUpzb24obXR5cGUsIG9wdGlvbnMpIHtcclxuXHRcdHZhciBydWxlVHlwZSA9IEV4b1dlYi5Nb2RlbC5SdWxlW29wdGlvbnMudHlwZV07XHJcblx0XHRpZiAob3B0aW9ucy5jb25kaXRpb25UeXBlKSB7XHJcblx0XHRcdG9wdGlvbnMuY29uZGl0aW9uVHlwZSA9IGNvbmRpdGlvblR5cGVGcm9tSnNvbihtdHlwZSwgb3B0aW9ucy5jb25kaXRpb25UeXBlKTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKHJ1bGVUeXBlLnByb3RvdHlwZSBpbnN0YW5jZW9mIENvbmRpdGlvblJ1bGUpIHtcclxuXHRcdFx0b3B0aW9ucy5jb25kaXRpb25UeXBlID0gY29uZGl0aW9uVHlwZUZyb21Kc29uKG10eXBlLCBvcHRpb25zKTtcclxuXHRcdH1cclxuXHRcdHJldHVybiBuZXcgcnVsZVR5cGUobXR5cGUsIG9wdGlvbnMpO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gZ2V0SnNUeXBlKG1vZGVsLCB0eXBlTmFtZSwgZm9yTG9hZGluZykge1xyXG5cdFx0Ly8gR2V0IGFuIGFycmF5IHJlcHJlc2VudGluZyB0aGUgdHlwZSBmYW1pbHkuXHJcblx0XHR2YXIgZmFtaWx5ID0gdHlwZU5hbWUuc3BsaXQoXCI+XCIpO1xyXG5cclxuXHRcdC8vIFRyeSB0byBnZXQgdGhlIGpzIHR5cGUgZnJvbSB0aGUgd2luZG93IG9iamVjdC5cclxuXHRcdHZhciBqc3R5cGUgPSBFeG9XZWIuTW9kZWwuTW9kZWwuZ2V0SnNUeXBlKGZhbWlseVswXSwgdHJ1ZSk7XHJcblxyXG5cdFx0Ly8gSWYgaXRzIG5vdCBkZWZpbmVkLCBhc3N1bWUgdGhlIHR5cGUgaXMgYSBtb2RlbCB0eXBlXHJcblx0XHQvLyB0aGF0IG1heSBldmVudHVhbGx5IGJlIGZldGNoZWQuXHJcblx0XHRpZiAoanN0eXBlID09PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0anN0eXBlID0gZ2V0VHlwZShtb2RlbCwgbnVsbCwgZmFtaWx5KS5nZXRfanN0eXBlKCk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIGpzdHlwZTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGZsYXR0ZW5UeXBlcyh0eXBlcywgZmxhdHRlbmVkKSB7XHJcblx0XHRmdW5jdGlvbiBhZGQoaXRlbSkge1xyXG5cdFx0XHRpZiAoZmxhdHRlbmVkLmluZGV4T2YoaXRlbSkgPCAwKSB7XHJcblx0XHRcdFx0ZmxhdHRlbmVkLnB1c2goaXRlbSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRpZiAodHlwZXMgaW5zdGFuY2VvZiBBcnJheSkge1xyXG5cdFx0XHRBcnJheS5mb3JFYWNoKHR5cGVzLCBhZGQpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAodHlwZW9mICh0eXBlcykgPT09IFwic3RyaW5nXCIpIHtcclxuXHRcdFx0QXJyYXkuZm9yRWFjaCh0eXBlcy5zcGxpdChcIj5cIiksIGFkZCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmICh0eXBlcykge1xyXG5cdFx0XHRhZGQodHlwZXMpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Ly8gR2V0cyBhIHJlZmVyZW5jZSB0byBhIHR5cGUuICBJTVBPUlRBTlQ6IHR5cGVOYW1lIG11c3QgYmUgdGhlXHJcblx0Ly8gZmFtaWx5LXF1YWxpZmllZCB0eXBlIG5hbWUgKGV4OiBFbXBsb3llZT5QZXJzb24pLlxyXG5cdGZ1bmN0aW9uIGdldFR5cGUobW9kZWwsIGZpbmFsVHlwZSwgcHJvcFR5cGUpIHtcclxuXHRcdC8vIGVuc3VyZSB0aGUgZW50aXJlIHR5cGUgZmFtaWx5IGlzIGF0IGxlYXN0IGdob3N0ZWRcclxuXHRcdC8vIHNvIHRoYXQgamF2YXNjcmlwdCBPTyBtZWNoYW5pc21zIHdvcmsgcHJvcGVybHlcclxuXHRcdHZhciBmYW1pbHkgPSBbXTtcclxuXHJcblx0XHRmbGF0dGVuVHlwZXMoZmluYWxUeXBlLCBmYW1pbHkpO1xyXG5cdFx0ZmxhdHRlblR5cGVzKHByb3BUeXBlLCBmYW1pbHkpO1xyXG5cclxuXHRcdHZhciBtdHlwZTtcclxuXHRcdHZhciBiYXNlVHlwZTtcclxuXHJcblx0XHR3aGlsZSAoZmFtaWx5Lmxlbmd0aCA+IDApIHtcclxuXHRcdFx0YmFzZVR5cGUgPSBtdHlwZTtcclxuXHJcblx0XHRcdHZhciB0eXBlID0gZmFtaWx5LnBvcCgpO1xyXG5cclxuXHRcdFx0aWYgKHR5cGUgaW5zdGFuY2VvZiBFeG9XZWIuTW9kZWwuVHlwZSkge1xyXG5cdFx0XHRcdG10eXBlID0gdHlwZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh0eXBlLm1ldGEpIHtcclxuXHRcdFx0XHRtdHlwZSA9IHR5cGUubWV0YTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHQvLyB0eXBlIGlzIGEgc3RyaW5nXHJcblx0XHRcdFx0bXR5cGUgPSBtb2RlbC50eXBlKHR5cGUpO1xyXG5cclxuXHRcdFx0XHQvLyBpZiB0eXBlIGRvZXNuJ3QgZXhpc3QsIHNldHVwIGEgZ2hvc3QgdHlwZVxyXG5cdFx0XHRcdGlmICghbXR5cGUpIHtcclxuXHRcdFx0XHRcdG10eXBlID0gbW9kZWwuYWRkVHlwZSh0eXBlLCBiYXNlVHlwZSwgXCJzZXJ2ZXJcIik7XHJcblx0XHRcdFx0XHRUeXBlTGF6eUxvYWRlci5yZWdpc3RlcihtdHlwZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIG10eXBlO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gZ2V0T2JqZWN0KG1vZGVsLCBwcm9wVHlwZSwgaWQsIGZpbmFsVHlwZSwgZm9yTG9hZGluZykge1xyXG5cdFx0aWYgKGlkID09PSBTVEFUSUNfSUQpIHtcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiRnVuY3Rpb24gJ2dldE9iamVjdCcgY2FuIG9ubHkgYmUgY2FsbGVkIGZvciBpbnN0YW5jZXMgKGlkPSdcIiArIGlkICsgXCInKVwiKTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBnZXQgbW9kZWwgdHlwZVxyXG5cdFx0dmFyIG10eXBlID0gZ2V0VHlwZShtb2RlbCwgZmluYWxUeXBlLCBwcm9wVHlwZSk7XHJcblxyXG5cdFx0Ly8gVHJ5IHRvIGxvY2F0ZSB0aGUgaW5zdGFuY2UgYnkgaWQuXHJcblx0XHR2YXIgb2JqID0gbXR5cGUuZ2V0KGlkLFxyXG5cdFx0XHQvLyBJZiBhbiBleGFjdCB0eXBlIGV4aXN0cyB0aGVuIGl0IHNob3VsZCBiZSBzcGVjaWZpZWQgaW4gdGhlIGNhbGwgdG8gZ2V0T2JqZWN0LlxyXG5cdFx0XHR0cnVlKTtcclxuXHJcblx0XHQvLyBJZiBpdCBkb2Vzbid0IGV4aXN0LCBjcmVhdGUgYSBnaG9zdGVkIGluc3RhbmNlLlxyXG5cdFx0aWYgKCFvYmopIHtcclxuXHRcdFx0b2JqID0gbmV3IChtdHlwZS5nZXRfanN0eXBlKCkpKGlkKTtcclxuXHRcdFx0b2JqLndhc0dob3N0ZWQgPSB0cnVlO1xyXG5cdFx0XHRpZiAoIWZvckxvYWRpbmcpIHtcclxuXHRcdFx0XHQvLyBJZiB0aGUgaW5zdGFuY2UgaXMgbm90IGJlaW5nIGxvYWRlZCwgdGhlbiBhdHRhY2ggYSBsYXp5IGxvYWRlci5cclxuXHRcdFx0XHRPYmplY3RMYXp5TG9hZGVyLnJlZ2lzdGVyKG9iaik7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gb2JqO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gb25UeXBlTG9hZGVkKG1vZGVsLCB0eXBlTmFtZSkge1xyXG5cdFx0dmFyIG10eXBlID0gbW9kZWwudHlwZSh0eXBlTmFtZSk7XHJcblx0XHRtdHlwZS5lYWNoQmFzZVR5cGUoZnVuY3Rpb24obXR5cGUpIHtcclxuXHRcdFx0aWYgKCFMYXp5TG9hZGVyLmlzTG9hZGVkKG10eXBlKSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIkJhc2UgdHlwZSBcIiArIG10eXBlLl9mdWxsTmFtZSArIFwiIGlzIG5vdCBsb2FkZWQuXCIpO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHRcdFR5cGVMYXp5TG9hZGVyLnVucmVnaXN0ZXIobXR5cGUpO1xyXG5cdFx0cmFpc2VFeHRlbnNpb25zKG10eXBlKTtcclxuXHRcdHJldHVybiBtdHlwZTtcclxuXHR9XHJcblxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHRmdW5jdGlvbiBmZXRjaFR5cGVzSW1wbChtb2RlbCwgdHlwZU5hbWVzLCBjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0dmFyIHNpZ25hbCA9IG5ldyBFeG9XZWIuU2lnbmFsKFwiZmV0Y2hUeXBlcyhcIiArIHR5cGVOYW1lcy5qb2luKFwiLFwiKSArIFwiKVwiKTtcclxuXHRcdHNpZ25hbC5wZW5kaW5nKCk7XHJcblxyXG5cdFx0dmFyIHR5cGVzUGVuZGluZyA9IHR5cGVOYW1lcy5jb3B5KCksIHR5cGVzTG9hZGVkID0gW107XHJcblxyXG5cdFx0ZnVuY3Rpb24gdHlwZXNGZXRjaGVkKHN1Y2Nlc3MsIHR5cGVzLCBvdGhlclR5cGVzKSB7XHJcblx0XHRcdHZhciBiYXNlVHlwZXNUb0ZldGNoID0gW10sIGxvYWRlZFR5cGVzID0gW10sIGJhc2VUeXBlRGVwZW5kZW5jaWVzID0ge30sIGxvYWRhYmxlVHlwZXMgPSBbXTtcclxuXHJcblx0XHRcdGlmIChzdWNjZXNzKSB7XHJcblx0XHRcdFx0dHlwZXNGcm9tSnNvbihtb2RlbCwgdHlwZXMsIG51bGwsIGZ1bmN0aW9uICh0eXBlTmFtZSkge1xyXG5cdFx0XHRcdFx0Ly8gUmVtb3ZlIHR5cGVzIHRoYXQgZmFpbGVkIHRvIGxvYWRcclxuXHRcdFx0XHRcdHR5cGVzUGVuZGluZy5yZW1vdmUodHlwZU5hbWUpO1xyXG5cdFx0XHRcdH0pO1xyXG5cclxuXHRcdFx0XHQvLyBVcGRhdGUgdHlwZXMgdGhhdCBoYXZlIGJlZW4gbG9hZGVkLiAgVGhpcyBuZWVkcyB0byBiZSBwZXJzaXN0ZWQgc2luY2VcclxuXHRcdFx0XHQvLyB0aGlzIGZ1bmN0aW9uIGNhbiByZWN1cnNlIGFuZCBhcmd1bWVudHMgYXJlIG5vdCBwZXJzaXN0ZWQuXHJcblx0XHRcdFx0ZWFjaFByb3AodHlwZXMsIGZ1bmN0aW9uKHByb3ApIHsgdHlwZXNMb2FkZWQucHVzaChwcm9wKTsgfSk7XHJcblx0XHRcdFx0aWYgKG90aGVyVHlwZXMpIHtcclxuXHRcdFx0XHRcdGVhY2hQcm9wKG90aGVyVHlwZXMsIGZ1bmN0aW9uKHByb3ApIHsgdHlwZXNMb2FkZWQucHVzaChwcm9wKTsgfSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBFeHRyYWN0IHRoZSB0eXBlcyB0aGF0IGNhbiBiZSBsb2FkZWQgc2luY2UgdGhleSBoYXZlIG5vIHBlbmRpbmcgYmFzZSB0eXBlc1xyXG5cdFx0XHRcdHB1cmdlKHR5cGVzUGVuZGluZywgZnVuY3Rpb24odHlwZU5hbWUpIHtcclxuXHRcdFx0XHRcdHZhciBtdHlwZSwgcGVuZGluZ0Jhc2VUeXBlID0gZmFsc2U7XHJcblxyXG5cdFx0XHRcdFx0Ly8gSW4gdGhlIGFic2Vuc2Ugb2YgcmVjdXJzaW9uIHRoaXMgd2lsbCBiZSBlcXVpdmFsZW50IHRvIGVudW1lcmF0aW5nXHJcblx0XHRcdFx0XHQvLyB0aGUgcHJvcGVydGllcyBvZiB0aGUgXCJ0eXBlc1wiIGFuZCBcIm90aGVyVHlwZXNcIiBhcmd1bWVudHMuXHJcblx0XHRcdFx0XHRpZiAodHlwZXNMb2FkZWQuY29udGFpbnModHlwZU5hbWUpKSB7XHJcblx0XHRcdFx0XHRcdG10eXBlID0gbW9kZWwudHlwZSh0eXBlTmFtZSk7XHJcblx0XHRcdFx0XHRcdGlmIChtdHlwZSkge1xyXG5cdFx0XHRcdFx0XHRcdGlmIChMYXp5TG9hZGVyLmlzTG9hZGVkKG10eXBlKSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0bG9hZGVkVHlwZXMucHVzaChtdHlwZS5fZnVsbE5hbWUpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdC8vIGZpbmQgYmFzZSB0eXBlcyB0aGF0IGFyZSBub3QgbG9hZGVkXHJcblx0XHRcdFx0XHRcdFx0XHRtdHlwZS5lYWNoQmFzZVR5cGUoZnVuY3Rpb24oYmFzZVR5cGUpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gRG9uJ3QgcmFpc2UgdGhlIGxvYWRlZCBldmVudCB1bnRpbCB0aGUgYmFzZSB0eXBlcyBhcmUgbWFya2VkIGFzIGxvYWRlZCAob3IgYWJvdXQgdG8gYmUgbWFya2VkIGFzIGxvYWRlZCBpbiB0aGlzIHBhc3MpXHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmICghTGF6eUxvYWRlci5pc0xvYWRlZChiYXNlVHlwZSkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBCYXNlIHR5cGUgd2lsbCBiZSBsb2FkZWQgaW4gdGhpcyBwYXNzXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVzTG9hZGVkLmNvbnRhaW5zKGJhc2VUeXBlLl9mdWxsTmFtZSkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChiYXNlVHlwZURlcGVuZGVuY2llcy5oYXNPd25Qcm9wZXJ0eSh0eXBlTmFtZSkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0YmFzZVR5cGVEZXBlbmRlbmNpZXNbdHlwZU5hbWVdLnNwbGljZSgwLCAwLCBiYXNlVHlwZS5fZnVsbE5hbWUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGJhc2VUeXBlRGVwZW5kZW5jaWVzW3R5cGVOYW1lXSA9IFtiYXNlVHlwZS5fZnVsbE5hbWVdO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHBlbmRpbmdCYXNlVHlwZSA9IHRydWU7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoIWJhc2VUeXBlc1RvRmV0Y2guY29udGFpbnMoYmFzZVR5cGUuX2Z1bGxOYW1lKSAmJiAhdHlwZXNQZW5kaW5nLmNvbnRhaW5zKGJhc2VUeXBlLl9mdWxsTmFtZSkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0YmFzZVR5cGVzVG9GZXRjaC5wdXNoKGJhc2VUeXBlLl9mdWxsTmFtZSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoIXBlbmRpbmdCYXNlVHlwZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRsb2FkYWJsZVR5cGVzLnB1c2godHlwZU5hbWUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdFx0Ly8gUmVtb3ZlIHR5cGVzIHRoYXQgaGF2ZSBhbHJlYWR5IGJlZW4gbWFya2VkIGFzIGxvYWRlZFxyXG5cdFx0XHRcdGxvYWRlZFR5cGVzLmZvckVhY2goZnVuY3Rpb24odHlwZU5hbWUpIHtcclxuXHRcdFx0XHRcdHR5cGVzUGVuZGluZy5yZW1vdmUodHlwZU5hbWUpO1xyXG5cdFx0XHRcdH0pO1xyXG5cclxuXHRcdFx0XHQvLyBSYWlzZSBsb2FkZWQgZXZlbnQgb24gdHlwZXMgdGhhdCBjYW4gYmUgbWFya2VkIGFzIGxvYWRlZFxyXG5cdFx0XHRcdHdoaWxlKGxvYWRhYmxlVHlwZXMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdFx0dmFyIHR5cGVOYW1lID0gbG9hZGFibGVUeXBlcy5kZXF1ZXVlKCk7XHJcblx0XHRcdFx0XHRpZiAoYmFzZVR5cGVEZXBlbmRlbmNpZXMuaGFzT3duUHJvcGVydHkodHlwZU5hbWUpKSB7XHJcblx0XHRcdFx0XHRcdC8vIFJlbW92ZSBkZXBlbmRlbmNpZXMgZnJvbSBhcnJheSBhbmQgbWFwXHJcblx0XHRcdFx0XHRcdHZhciBkZXBzID0gYmFzZVR5cGVEZXBlbmRlbmNpZXNbdHlwZU5hbWVdO1xyXG5cdFx0XHRcdFx0XHRkZWxldGUgYmFzZVR5cGVEZXBlbmRlbmNpZXNbdHlwZU5hbWVdO1xyXG5cdFx0XHRcdFx0XHRkZXBzLmZvckVhY2goZnVuY3Rpb24odCkge1xyXG5cdFx0XHRcdFx0XHRcdGxvYWRhYmxlVHlwZXMucmVtb3ZlKHQpO1xyXG5cdFx0XHRcdFx0XHRcdGRlbGV0ZSBiYXNlVHlwZURlcGVuZGVuY2llc1t0XTtcclxuXHRcdFx0XHRcdFx0fSk7XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBTcGxpY2UgdGhlIHR5cGVzIGJhY2sgaW50byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBhcnJheSBpbiB0aGUgY29ycmVjdCBvcmRlci5cclxuXHRcdFx0XHRcdFx0dmFyIHNwbGljZUFyZ3MgPSBkZXBzO1xyXG5cdFx0XHRcdFx0XHRzcGxpY2VBcmdzLnB1c2godHlwZU5hbWUpO1xyXG5cdFx0XHRcdFx0XHRzcGxpY2VBcmdzLnNwbGljZSgwLCAwLCAwLCAwKTtcclxuXHRcdFx0XHRcdFx0QXJyYXkucHJvdG90eXBlLnNwbGljZS5hcHBseShsb2FkYWJsZVR5cGVzLCBzcGxpY2VBcmdzKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHR0eXBlc1BlbmRpbmcucmVtb3ZlKHR5cGVOYW1lKTtcclxuXHRcdFx0XHRcdFx0b25UeXBlTG9hZGVkKG1vZGVsLCB0eXBlTmFtZSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBGZXRjaCBhbnkgcGVuZGluZyBiYXNlIHR5cGVzXHJcblx0XHRcdFx0aWYgKGJhc2VUeXBlc1RvRmV0Y2gubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdFx0Ly8gVE9ETzogbmVlZCB0byBub3RpZnkgZG9udERvdWJsZVVwIHRoYXQgdGhlc2UgdHlwZXMgYXJlXHJcblx0XHRcdFx0XHQvLyBub3cgcGFydCBvZiB0aGUgcGFydGl0aW9uZWQgYXJndW1lbnQgZm9yIHRoZSBjYWxsLlxyXG5cdFx0XHRcdFx0dHlwZXNQZW5kaW5nLmFkZFJhbmdlKGJhc2VUeXBlc1RvRmV0Y2gpO1xyXG5cclxuXHRcdFx0XHRcdC8vIE1ha2UgYSByZWN1cnNpdmUgcmVxdWVzdCBmb3IgYmFzZSB0eXBlcy5cclxuXHRcdFx0XHRcdHR5cGVQcm92aWRlcihiYXNlVHlwZXNUb0ZldGNoLCB0eXBlc0ZldGNoZWQpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmICh0eXBlc1BlbmRpbmcubGVuZ3RoID09PSAwICYmIHNpZ25hbC5pc0FjdGl2ZSgpKSB7XHJcblx0XHRcdFx0XHQvLyBDT01QTEVURSEhIVxyXG5cdFx0XHRcdFx0c2lnbmFsLm9uZURvbmUoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0Ly8gSGFuZGxlIGFuIGVycm9yIHJlc3BvbnNlLiAgTG9hZGluZyBzaG91bGRcclxuXHRcdFx0Ly8gKk5PVCogY29udGludWUgYXMgaWYgdGhlIHR5cGUgaXMgYXZhaWxhYmxlLlxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJGZvcm1hdChcIkZhaWxlZCB0byBsb2FkIHswfSAoSFRUUDogezF9LCBUaW1lb3V0OiB7Mn0pXCIsIHR5cGVOYW1lcy5qb2luKFwiLFwiKSwgdHlwZXMuX3N0YXR1c0NvZGUsIHR5cGVzLl90aW1lZE91dCkpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gcmVxdWVzdCB0aGUgdHlwZXNcclxuXHRcdHR5cGVQcm92aWRlcih0eXBlTmFtZXMsIHR5cGVzRmV0Y2hlZCk7XHJcblxyXG5cdFx0c2lnbmFsLndhaXRGb3JBbGwoZnVuY3Rpb24oKSB7XHJcblx0XHRcdGlmIChjYWxsYmFjayAmJiBjYWxsYmFjayBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcblx0XHRcdFx0dmFyIGpzdHlwZXMgPSB0eXBlTmFtZXMubWFwKGZ1bmN0aW9uICh0eXBlTmFtZSkge1xyXG5cdFx0XHRcdFx0dmFyIG10eXBlID0gbW9kZWwudHlwZSh0eXBlTmFtZSk7XHJcblx0XHRcdFx0XHRyZXR1cm4gbXR5cGUgPyBtdHlwZS5nZXRfanN0eXBlKCkgOiBudWxsO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHRcdGNhbGxiYWNrLmFwcGx5KHRoaXNQdHIgfHwgdGhpcywganN0eXBlcyk7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gbW92ZVR5cGVSZXN1bHRzKG9yaWdpbmFsQXJncywgaW52b2NhdGlvbkFyZ3MsIGNhbGxiYWNrQXJncykge1xyXG5cdFx0Ly8gUmVwbGFjZSBhbGwgZWxlbWVudHMgb2YgdGhlIGNhbGxiYWNrIGFyZ3MgYXJyYXkgd2l0aCB0aGUgdHlwZXMgdGhhdCB3ZXJlIHJlcXVlc3RlZFxyXG5cdFx0dmFyIHNwbGljZUFyZ3MgPSBbMCwgY2FsbGJhY2tBcmdzLmxlbmd0aF07XHJcblx0XHRBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShzcGxpY2VBcmdzLCBpbnZvY2F0aW9uQXJnc1sxXS5tYXAoZnVuY3Rpb24odHlwZU5hbWUpIHtcclxuXHRcdFx0dmFyIG10eXBlID0gaW52b2NhdGlvbkFyZ3NbMF0udHlwZSh0eXBlTmFtZSk7XHJcblx0XHRcdHJldHVybiBtdHlwZSA/IG10eXBlLmdldF9qc3R5cGUoKSA6IG51bGw7XHJcblx0XHR9KSk7XHJcblx0XHRBcnJheS5wcm90b3R5cGUuc3BsaWNlLmFwcGx5KGNhbGxiYWNrQXJncywgc3BsaWNlQXJncyk7XHJcblx0fVxyXG5cclxuXHR2YXIgZmV0Y2hUeXBlcyA9IGZldGNoVHlwZXNJbXBsLmRvbnREb3VibGVVcCh7IGNhbGxiYWNrQXJnOiAyLCB0aGlzUHRyQXJnOiAzLCBwYXJ0aXRpb25lZEFyZzogMSwgcGFydGl0aW9uZWRGaWx0ZXI6IG1vdmVUeXBlUmVzdWx0cyB9KTtcclxuXHJcblx0Ly8gZmV0Y2hlcyBtb2RlbCBwYXRocyBhbmQgY2FsbHMgc3VjY2VzcyBvciBmYWlsIGJhc2VkIG9uIHRoZSBvdXRjb21lXHJcblx0ZnVuY3Rpb24gZmV0Y2hQYXRoVHlwZXMobW9kZWwsIGpzdHlwZSwgcGF0aCwgc3VjY2VzcywgZmFpbCkge1xyXG5cdFx0dmFyIHN0ZXAgPSBwYXRoLnN0ZXBzLmRlcXVldWUoKTtcclxuXHRcdHZhciByZW1vdmVkU3RlcHMgPSBbc3RlcF07XHJcblx0XHR3aGlsZSAoc3RlcCkge1xyXG5cdFx0XHQvLyBsb2NhdGUgcHJvcGVydHkgZGVmaW5pdGlvbiBpbiBtb2RlbFxyXG5cdFx0XHR2YXIgcHJvcCA9IGpzdHlwZS5tZXRhLnByb3BlcnR5KHN0ZXAucHJvcGVydHkpO1xyXG5cclxuXHRcdFx0aWYgKCFwcm9wKSB7XHJcblx0XHRcdFx0dmFyIGFyZ3MgPSBbMCwgMF07XHJcblx0XHRcdFx0QXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkoYXJncywgcmVtb3ZlZFN0ZXBzKTtcclxuXHRcdFx0XHRBcnJheS5wcm90b3R5cGUuc3BsaWNlLmFwcGx5KHBhdGguc3RlcHMsIGFyZ3MpO1xyXG5cdFx0XHRcdGZhaWwoXCJDb3VsZCBub3QgZmluZCBwcm9wZXJ0eSBcXFwiXCIgKyBzdGVwLnByb3BlcnR5ICsgXCJcXFwiIG9uIHR5cGUgXFxcIlwiICsganN0eXBlLm1ldGEuZ2V0X2Z1bGxOYW1lKCkgKyBcIlxcXCIuXCIpO1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gZG9uJ3QgbmVlZCB0byBmZXRjaCB0eXBlIGluZm9ybWF0aW9uIGZvciB2YWx1ZSB0eXBlc1xyXG5cdFx0XHRpZiAocHJvcC5nZXRfaXNWYWx1ZVR5cGUoKSkge1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBMb2FkIHRoZSB0eXBlIG9mIHRoZSBwcm9wZXJ0eSBpZiBpdHMgbm90IHlldCBsb2FkZWRcclxuXHRcdFx0dmFyIG10eXBlO1xyXG5cdFx0XHRpZiAoc3RlcC5jYXN0KSB7XHJcblx0XHRcdFx0bXR5cGUgPSBtb2RlbC50eXBlKHN0ZXAuY2FzdCk7XHJcblxyXG5cdFx0XHRcdC8vIGlmIHRoaXMgdHlwZSBoYXMgbmV2ZXIgYmVlbiBzZWVuLCBnbyBhbmQgZmV0Y2ggaXQgYW5kIHJlc3VtZSBsYXRlclxyXG5cdFx0XHRcdGlmICghbXR5cGUpIHtcclxuXHRcdFx0XHRcdEFycmF5Lmluc2VydChwYXRoLnN0ZXBzLCAwLCBzdGVwKTtcclxuXHRcdFx0XHRcdGZldGNoVHlwZXMobW9kZWwsIFtzdGVwLmNhc3RdLCBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdGZldGNoUGF0aFR5cGVzKG1vZGVsLCBqc3R5cGUsIHBhdGgsIHN1Y2Nlc3MsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgYXJncyA9IFswLCAwXTtcclxuXHRcdFx0XHRcdFx0XHRBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShhcmdzLCByZW1vdmVkU3RlcHMpO1xyXG5cdFx0XHRcdFx0XHRcdEFycmF5LnByb3RvdHlwZS5zcGxpY2UuYXBwbHkocGF0aC5zdGVwcywgYXJncyk7XHJcblx0XHRcdFx0XHRcdFx0ZmFpbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRtdHlwZSA9IHByb3AuZ2V0X2pzdHlwZSgpLm1ldGE7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIGlmIHByb3BlcnR5J3MgdHlwZSBpc24ndCBsb2FkIGl0LCB0aGVuIGZldGNoIGl0XHJcblx0XHRcdGlmICghTGF6eUxvYWRlci5pc0xvYWRlZChtdHlwZSkpIHtcclxuXHRcdFx0XHRmZXRjaFR5cGVzKG1vZGVsLCBbbXR5cGUuZ2V0X2Z1bGxOYW1lKCldLCBmdW5jdGlvbiAodCkge1xyXG5cdFx0XHRcdFx0ZmV0Y2hQYXRoVHlwZXMobW9kZWwsIHQsIHBhdGgsIHN1Y2Nlc3MsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0dmFyIGFyZ3MgPSBbMCwgMF07XHJcblx0XHRcdFx0XHRcdEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGFyZ3MsIHJlbW92ZWRTdGVwcyk7XHJcblx0XHRcdFx0XHRcdEFycmF5LnByb3RvdHlwZS5zcGxpY2UuYXBwbHkocGF0aC5zdGVwcywgYXJncyk7XHJcblx0XHRcdFx0XHRcdGZhaWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdH0pO1xyXG5cclxuXHRcdFx0XHQvLyBwYXRoIHdhbGtpbmcgd2lsbCByZXN1bWUgd2l0aCBjYWxsYmFja1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8ga2VlcCB3YWxraW5nIHRoZSBwYXRoXHJcblx0XHRcdGpzdHlwZSA9IG10eXBlLmdldF9qc3R5cGUoKTtcclxuXHJcblx0XHRcdHN0ZXAgPSBwYXRoLnN0ZXBzLmRlcXVldWUoKTtcclxuXHRcdFx0cmVtb3ZlZFN0ZXBzLnB1c2goc3RlcCk7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gSW5mb3JtIHRoZSBjYWxsZXIgdGhhdCB0aGUgcGF0aCBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgZmV0Y2hlZFxyXG5cdFx0c3VjY2VzcygpO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gZmV0Y2hRdWVyeVR5cGVzKG1vZGVsLCB0eXBlTmFtZSwgcGF0aHMsIGNhbGxiYWNrKSB7XHJcblx0XHR2YXIgc2lnbmFsID0gbmV3IEV4b1dlYi5TaWduYWwoXCJmZXRjaFR5cGVzXCIpO1xyXG5cclxuXHRcdGZ1bmN0aW9uIHJvb3RUeXBlTG9hZGVkKGpzdHlwZSkge1xyXG5cdFx0XHJcblx0XHRcdC8vIHByb2Nlc3MgYWxsIHBhdGhzXHJcblx0XHRcdGlmIChwYXRocykge1xyXG5cdFx0XHRcdEFycmF5LmZvckVhY2gocGF0aHMsIGZ1bmN0aW9uIChwYXRoKSB7XHJcblxyXG5cdFx0XHRcdFx0Ly8gYXR0ZW1wdCB0byBmZXRjaCB0aGUgcGF0aFxyXG5cdFx0XHRcdFx0ZmV0Y2hQYXRoVHlwZXMobW9kZWwsIGpzdHlwZSwgcGF0aCwgc2lnbmFsLnBlbmRpbmcoKSwgZnVuY3Rpb24gKGVycikge1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gZGV0ZXJtaW5lIGlmIHRoZSBwYXRoIHJlcHJlc2VudHMgYSBzdGF0aWMgcHJvcGVydHkgaWYgdGhlIHBhdGggd2FzIG5vdCB2YWxpZFxyXG5cdFx0XHRcdFx0XHR2YXIgc3RlcCA9IG51bGwsIHR5cGVOYW1lID0gXCJcIjtcclxuXHRcdFx0XHRcdFx0d2hpbGUgKHBhdGguc3RlcHMubGVuZ3RoID4gMSkge1xyXG5cdFx0XHRcdFx0XHRcdHN0ZXAgPSBwYXRoLnN0ZXBzLmRlcXVldWUoKTtcclxuXHRcdFx0XHRcdFx0XHR0eXBlTmFtZSArPSAodHlwZU5hbWUubGVuZ3RoID4gMCA/IFwiLlwiIDogXCJcIikgKyBzdGVwLnByb3BlcnR5O1xyXG5cdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHR2YXIgbXR5cGUgPSBtb2RlbC50eXBlKHR5cGVOYW1lKTtcclxuXHJcblx0XHRcdFx0XHRcdHZhciBmZXRjaFN0YXRpY1BhdGhUeXBlcyA9IGZ1bmN0aW9uIGZldGNoU3RhdGljUGF0aFR5cGVzKCkge1xyXG5cdFx0XHRcdFx0XHRcdGZldGNoUGF0aFR5cGVzKG1vZGVsLCAobXR5cGUgfHwgbW9kZWwudHlwZSh0eXBlTmFtZSkpLmdldF9qc3R5cGUoKSwgcGF0aCwgc2lnbmFsLnBlbmRpbmcoKSwgZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBxdWVyeSBwYXRoIFxcXCJcIiArIHBhdGggKyBcIlxcXCIgLSBcIiArIGVycik7XHJcblx0XHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRcdH07XHJcblxyXG5cdFx0XHRcdFx0XHRpZiAoIW10eXBlKSB7XHJcblx0XHRcdFx0XHRcdFx0Ly8gZmlyc3QgdGltZSB0eXBlIGhhcyBiZWVuIHNlZW4sIGZldGNoIGl0XHJcblx0XHRcdFx0XHRcdFx0ZmV0Y2hUeXBlcyhtb2RlbCwgW3R5cGVOYW1lXSwgc2lnbmFsLnBlbmRpbmcoZnVuY3Rpb24gKHQpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGlmICghdCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoZXJyKTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdGZldGNoU3RhdGljUGF0aFR5cGVzKHQpO1xyXG5cdFx0XHRcdFx0XHRcdH0pKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRlbHNlIGlmIChMYXp5TG9hZGVyLmlzUmVnaXN0ZXJlZChtdHlwZSkpIHtcclxuXHRcdFx0XHRcdFx0XHQvLyBsYXp5IGxvYWQgdHlwZSBhbmQgY29udGludWUgd2Fsa2luZyB0aGUgcGF0aFxyXG5cdFx0XHRcdFx0XHRcdExhenlMb2FkZXIubG9hZChtdHlwZSwgbnVsbCwgZmFsc2UsIHNpZ25hbC5wZW5kaW5nKGZldGNoU3RhdGljUGF0aFR5cGVzKSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0ZmV0Y2hTdGF0aWNQYXRoVHlwZXMoKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gbG9hZCByb290IHR5cGUsIHRoZW4gbG9hZCB0eXBlcyByZWZlcmVuY2VkIGluIHBhdGhzXHJcblx0XHR2YXIgcm9vdFR5cGUgPSBtb2RlbC50eXBlKHR5cGVOYW1lKTtcclxuXHRcdGlmICghcm9vdFR5cGUpIHtcclxuXHRcdFx0ZmV0Y2hUeXBlcyhtb2RlbCwgW3R5cGVOYW1lXSwgc2lnbmFsLnBlbmRpbmcoZnVuY3Rpb24odCkge1xyXG5cdFx0XHRcdHJvb3RUeXBlTG9hZGVkKHQpO1xyXG5cdFx0XHR9KSk7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChMYXp5TG9hZGVyLmlzUmVnaXN0ZXJlZChyb290VHlwZSkpIHtcclxuXHRcdFx0TGF6eUxvYWRlci5sb2FkKHJvb3RUeXBlLCBudWxsLCBmYWxzZSwgc2lnbmFsLnBlbmRpbmcocm9vdFR5cGVMb2FkZWQpKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRyb290VHlwZUxvYWRlZChyb290VHlwZS5nZXRfanN0eXBlKCkpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHNpZ25hbC53YWl0Rm9yQWxsKGNhbGxiYWNrKTtcclxuXHR9XHJcblxyXG5cdC8vIFJlY3Vyc2l2ZWx5IHNlYXJjaGVzIHRocm91Z2h0IHRoZSBzcGVjaWZpZWQgb2JqZWN0IGFuZCByZXN0b3JlcyBkYXRlcyBzZXJpYWxpemVkIGFzIHN0cmluZ3NcclxuXHRmdW5jdGlvbiByZXN0b3JlRGF0ZXModmFsdWUpIHtcclxuXHRcdGZ1bmN0aW9uIHRyeVJlc3RvcmVEYXRlKG9iaiwga2V5KSB7XHJcblx0XHRcdHZhciB2YWwgPSBvYmpba2V5XTtcclxuXHRcdFx0aWYgKHZhbCAmJiB2YWwuY29uc3RydWN0b3IgPT09IFN0cmluZyAmJiBkYXRlUmVnZXgudGVzdCh2YWwpKSB7XHJcblx0XHRcdFx0ZGF0ZVJlZ2V4Lmxhc3RJbmRleCA9IDA7XHJcblx0XHRcdFx0b2JqW2tleV0gPSBuZXcgRGF0ZSh2YWwucmVwbGFjZShkYXRlUmVnZXgsIGRhdGVSZWdleFJlcGxhY2UpKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5KSB7XHJcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWUubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHR0cnlSZXN0b3JlRGF0ZSh2YWx1ZSwgaSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgT2JqZWN0KSB7XHJcblx0XHRcdGZvciAodmFyIGZpZWxkIGluIHZhbHVlKSB7XHJcblx0XHRcdFx0aWYgKHZhbHVlLmhhc093blByb3BlcnR5KGZpZWxkKSkge1xyXG5cdFx0XHRcdFx0dHJ5UmVzdG9yZURhdGUodmFsdWUsIGZpZWxkKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHRyeUdldEpzVHlwZShtb2RlbCwgbmFtZSwgcHJvcGVydHksIGZvcmNlTG9hZCwgY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdHZhciBqc3R5cGUgPSBFeG9XZWIuTW9kZWwuTW9kZWwuZ2V0SnNUeXBlKG5hbWUsIHRydWUpO1xyXG5cclxuXHRcdGlmIChqc3R5cGUgJiYgTGF6eUxvYWRlci5pc0xvYWRlZChqc3R5cGUubWV0YSkpIHtcclxuXHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMsIGpzdHlwZSk7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChqc3R5cGUgJiYgZm9yY2VMb2FkKSB7XHJcblx0XHRcdExhenlMb2FkZXIubG9hZChqc3R5cGUubWV0YSwgcHJvcGVydHksIGZhbHNlLCBjYWxsYmFjaywgdGhpc1B0cik7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmICghanN0eXBlICYmIGZvcmNlTG9hZCkge1xyXG5cdFx0XHRlbnN1cmVKc1R5cGUobW9kZWwsIG5hbWUsIGNhbGxiYWNrLCB0aGlzUHRyKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHQkZXh0ZW5kKG5hbWUsIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdGNhbGxiYWNrLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcblx0XHRcdH0sIHRoaXNQdHIpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0dmFyIHBlbmRpbmdFbnRpdGllcyA9IHt9O1xyXG5cclxuXHRmdW5jdGlvbiBsYXp5Q3JlYXRlRW50aXR5KHR5cGUsIGlkLCBjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0dmFyIHBlbmRpbmdGb3JUeXBlID0gcGVuZGluZ0VudGl0aWVzW3R5cGVdO1xyXG5cdFx0aWYgKCFwZW5kaW5nRm9yVHlwZSkge1xyXG5cdFx0XHRwZW5kaW5nRW50aXRpZXNbdHlwZV0gPSBwZW5kaW5nRm9yVHlwZSA9IHt9O1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmICghcGVuZGluZ0ZvclR5cGVbaWRdKSB7XHJcblx0XHRcdHBlbmRpbmdGb3JUeXBlW2lkXSA9IHsgY2FsbGJhY2s6IGNhbGxiYWNrLCB0aGlzUHRyOiB0aGlzUHRyIH07XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHR2YXIgTGF6eUxvYWRFbnVtID0ge1xyXG5cdFx0Ly8gSWYgdGhlIG9iamVjdCBkb2Vzbid0IGV4aXN0LCB0aGVuIHRoZSBjYWxsYmFjayB3aWxsIGJlIGludm9rZWQgb25jZSB0aGUgb2JqZWN0IGhhcyBiZWVuIGxvYWRlZCBmb3Igc29tZSBvdGhlciByZWFzb24uXHJcblx0XHROb25lOiAwLFxyXG5cdFx0Ly8gSWYgdGhlIG9iamVjdCBkb2Vzbid0IGV4aXN0LCB0aGVuIGZvcmNlIGNyZWF0aW9uIGFuZCBsb2FkaW5nIG9mIHRoZSBvYmplY3QgYW5kIGludm9rZSB0aGUgY2FsbGJhY2sgaW1tZWRpYXRlbHkuXHJcblx0XHRGb3JjZTogMSxcclxuXHRcdC8vIElmIHRoZSBvYmplY3QgZG9lc24ndCBleGlzdCwgdGhlbiBmb3JjZSBjcmVhdGlvbiBhbmQgbG9hZGluZyBvZiB0aGUgb2JqZWN0IGFuZCBpbnZva2UgdGhlIGNhbGxiYWNrIHdoZW4gbG9hZGluZyBpcyBjb21wbGV0ZS5cclxuXHRcdEZvcmNlQW5kV2FpdDogMixcclxuXHRcdC8vIElmIHRoZSBvYmplY3QgZG9lc24ndCBleGlzdCwgdGhlbiBjcmVhdGUgdGhlIG9iamVjdCBhbmQgaW52b2tlIHRoZSBjYWxsYmFjay5cclxuXHRcdExhenk6IDNcclxuXHR9O1xyXG5cclxuXHR2YXIgbWV0YUdldCA9IFR5cGUucHJvdG90eXBlLmdldDtcclxuXHJcblx0VHlwZS5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGlkLCBleGFjdFR5cGVPbmx5LCBzdXBwcmVzc0xhenlJbml0KSB7XHJcblx0XHR2YXIgb2JqID0gbWV0YUdldC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cclxuXHRcdGlmICghb2JqICYmICFzdXBwcmVzc0xhenlJbml0KSB7XHJcblx0XHRcdC8vIElmIHRoZSBvYmplY3QgZG9lc24ndCBleGlzdCBhbmQgaXMgcGVuZGluZywgY3JlYXRlIGl0LlxyXG5cdFx0XHR2YXIgcGVuZGluZ0ZvclR5cGUgPSBwZW5kaW5nRW50aXRpZXNbdGhpcy5nZXRfZnVsbE5hbWUoKV07XHJcblx0XHRcdGlmIChwZW5kaW5nRm9yVHlwZSkge1xyXG5cdFx0XHRcdHZhciBwZW5kaW5nRm9ySWQgPSBwZW5kaW5nRm9yVHlwZVtpZF07XHJcblx0XHRcdFx0aWYgKHBlbmRpbmdGb3JJZCkge1xyXG5cdFx0XHRcdFx0b2JqID0gcGVuZGluZ0ZvcklkLmNhbGxiYWNrLmNhbGwocGVuZGluZ0ZvcklkLnRoaXNQdHIpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBvYmo7XHJcblx0fTtcclxuXHJcblx0ZnVuY3Rpb24gdHJ5R2V0RW50aXR5KG1vZGVsLCB0cmFuc2xhdG9yLCB0eXBlLCBpZCwgcHJvcGVydHksIGxhenlMb2FkLCBjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0Ly8gRmlyc3QsIGF0dGVtcHQgdG8gcmV0cmlldmUgYW4gZXhpc3Rpbmcgb2JqZWN0LlxyXG5cdFx0dmFyIG9iaiA9IHR5cGUubWV0YS5nZXQoXHJcblx0XHRcdC8vIFRyYW5zbGF0ZSB0byB0aGUgY2xpZW50LXNpZGUgaWQuXHJcblx0XHRcdHRyYW5zbGF0ZUlkKHRyYW5zbGF0b3IsIHR5cGUubWV0YS5nZXRfZnVsbE5hbWUoKSwgaWQpLFxyXG5cclxuXHRcdFx0Ly8gV2Uga25vdyB0aGF0IHRyeUdldEVudGl0eSBpcyBvbmx5IGNhbGxlZCBpbnRlcm5hbGx5IGFuZCB0aGUgc291cmNlIG9mIHRoZSBlbnRpdHlcclxuXHRcdFx0Ly8gaW5mb3JtYXRpb24gaXMgYWx3YXlzIHNlZW4gYXMgc2VydmVyLW9yaWdpbiBhbmQgc28gc2hvdWxkIHNwZWNpZnkgYW4gZXhhY3QgdHlwZS5cclxuXHRcdFx0dHJ1ZSxcclxuXHJcblx0XHRcdC8vIERvbnQnIGxhemlseSBjcmVhdGUgdGhlIG5ldyBvYmplY3QgaWYgbm8gbGF6eSBiZWhhdmlvciBpcyBzcGVjaWZpZWQsIGkuZS4gdGhlIGNhbGxlciBkb2Vzbid0IHdhbnQgdG8gZm9yY2UgdGhlIG9iamVjdCB0byBleGlzdC5cclxuXHRcdFx0bGF6eUxvYWQgIT09IExhenlMb2FkRW51bS5Gb3JjZSAmJiBsYXp5TG9hZCAhPT0gTGF6eUxvYWRFbnVtLkZvcmNlQW5kV2FpdCAmJiBsYXp5TG9hZCAhPT0gTGF6eUxvYWRFbnVtLkxhenlcclxuXHRcdCk7XHJcblxyXG5cdFx0aWYgKG9iaiAmJiBvYmoubWV0YS5pc0xvYWRlZChwcm9wZXJ0eSkpIHtcclxuXHRcdFx0Ly8gSWYgdGhlIG9iamVjdCBleGlzdHMgYW5kIGlzIGxvYWRlZCwgdGhlbiBpbnZva2UgdGhlIGNhbGxiYWNrIGltbWVkaWF0ZWx5LlxyXG5cdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcywgb2JqKTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKGxhenlMb2FkID09IExhenlMb2FkRW51bS5MYXp5KSB7XHJcblx0XHRcdGlmICghb2JqKSB7XHJcblx0XHRcdFx0b2JqID0gZnJvbUV4b01vZGVsKHsgdHlwZTogdHlwZS5tZXRhLmdldF9mdWxsTmFtZSgpLCBpZDogaWQgfSwgdHJhbnNsYXRvciwgdHJ1ZSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIEluIGxhenkgbW9kZSwgc2ltcGx5IGludm9rZSB0aGUgY2FsbGJhY2sgaWYgdGhlIG9iamVjdCBleGlzdHMsIHNpbmNlIHRoZSBjYWxsZXIgZG9lc24ndCBjYXJlIHdoZXRoZXIgaXQgaXMgbG9hZGVkLlxyXG5cdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcywgb2JqKTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKGxhenlMb2FkID09IExhenlMb2FkRW51bS5Gb3JjZSkge1xyXG5cdFx0XHQvLyBUaGUgY2FsbGVyIHdhbnRzIHRoZSBpbnN0YW5jZSBmb3JjZSBsb2FkZWQgYnV0IGRvZXNuJ3Qgd2FudCB0byB3YWl0IGZvciBpdCB0byBjb21wbGV0ZS5cclxuXHJcblx0XHRcdC8vIElmIHRoZSBpbnN0YW5jZSBkb2Vzbid0IGV4aXN0IHRoZW4gZW5zdXJlIHRoYXQgYSBnaG9zdGVkIGluc3RhbmNlIGlzIGNyZWF0ZWQuXHJcblx0XHRcdGlmICghb2JqKSB7XHJcblx0XHRcdFx0b2JqID0gZnJvbUV4b01vZGVsKHsgdHlwZTogdHlwZS5tZXRhLmdldF9mdWxsTmFtZSgpLCBpZDogaWQgfSwgdHJhbnNsYXRvciwgdHJ1ZSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIEludm9rZSB0aGUgY2FsbGJhY2sgaW1tZWRpYXRlbHkuXHJcblx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzLCBvYmopO1xyXG5cclxuXHRcdFx0Ly8gQWZ0ZXIgdGhlIGNhbGxiYWNrIGhhcyBiZWVuIGludm9rZWQsIGZvcmNlIGxvYWRpbmcgdG8gb2NjdXIuXHJcblx0XHRcdExhenlMb2FkZXIubG9hZChvYmosIHByb3BlcnR5LCBmYWxzZSk7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChsYXp5TG9hZCA9PSBMYXp5TG9hZEVudW0uRm9yY2VBbmRXYWl0KSB7XHJcblx0XHRcdC8vIFRoZSBjYWxsZXIgd2FudHMgdGhlIGluc3RhbmNlIGZvcmNlIGxvYWRlZCBhbmQgd2lsbCB3YWl0IGZvciBpdCB0byBjb21wbGV0ZS5cclxuXHJcblx0XHRcdC8vIElmIHRoZSBpbnN0YW5jZSBkb2Vzbid0IGV4aXN0IHRoZW4gZW5zdXJlIHRoYXQgYSBnaG9zdGVkIGluc3RhbmNlIGlzIGNyZWF0ZWQuXHJcblx0XHRcdGlmICghb2JqKSB7XHJcblx0XHRcdFx0b2JqID0gZnJvbUV4b01vZGVsKHsgdHlwZTogdHlwZS5tZXRhLmdldF9mdWxsTmFtZSgpLCBpZDogaWQgfSwgdHJhbnNsYXRvciwgdHJ1ZSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIEZvcmNlIGxvYWRpbmcgdG8gb2NjdXIsIHBhc3NpbmcgdGhyb3VnaCB0aGUgY2FsbGJhY2suXHJcblx0XHRcdExhenlMb2FkZXIubG9hZChvYmosIHByb3BlcnR5LCBmYWxzZSwgdGhpc1B0ciA/IGNhbGxiYWNrLmJpbmQodGhpc1B0cikgOiBjYWxsYmFjayk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0Ly8gVGhlIGNhbGxlciBkb2VzIG5vdCB3YW50IHRvIGZvcmNlIGxvYWRpbmcsIHNvIHdhaXQgZm9yIHRoZSBpbnN0YW5jZSB0byBjb21lIGludG8gZXhpc3RhbmNlIGFuZCBpbnZva2UgdGhlIGNhbGxiYWNrIHdoZW4gaXQgZG9lcy5cclxuXHJcblx0XHRcdGZ1bmN0aW9uIGludm9rZUNhbGxiYWNrKCkge1xyXG5cdFx0XHRcdGlmIChmaWx0ZXIob2JqKSAhPT0gdHJ1ZSlcclxuXHRcdFx0XHRcdHJldHVybjtcclxuXHJcblx0XHRcdFx0Ly8gb25seSBpbnZva2UgdGhlIGNhbGxiYWNrIG9uY2VcclxuXHRcdFx0XHRwcm9wZXJ0eUZpbHRlciA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZhbHNlOyB9O1xyXG5cdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzLCBvYmopO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR2YXIgb2JqU2lnbmFsID0gbmV3IFNpZ25hbChcIndhaXQgZm9yIG9iamVjdCB0byBleGlzdFwiKTtcclxuXHJcblx0XHRcdGZ1bmN0aW9uIGVuc3VyZUxpc3RMb2FkZWQoKSB7XHJcblx0XHRcdFx0Ly8gSWYgdGhlcmUgaXMgYSBwcm9wZXJ0eSBzcGVjaWZpZWQgdGhhdCBpcyBhIGxpc3QsIHRoZW4gZG9uJ3QgaW52b2tlIHRoZSBjYWxsYmFjayB1bnRpbCBpdCBpcyBsb2FkZWQuXHJcblx0XHRcdFx0aWYgKHByb3BlcnR5KSB7XHJcblx0XHRcdFx0XHR2YXIgcHJvcGVydHlPYmogPSB0eXBlLm1ldGEucHJvcGVydHkocHJvcGVydHkpO1xyXG5cdFx0XHRcdFx0Ly8gT25seSBlbnRpdHkgbGlzdHMgY2FuIGJlIGxhenkgbG9hZGVkIGluIGFkZGl0aW9uIHRvIHRoZSBwYXJlbnQgb2JqZWN0LlxyXG5cdFx0XHRcdFx0aWYgKHByb3BlcnR5T2JqLmdldF9pc0VudGl0eUxpc3RUeXBlKCkpIHtcclxuXHRcdFx0XHRcdFx0aWYgKCFvYmoubWV0YS5pc0xvYWRlZChwcm9wZXJ0eSkpIHtcclxuXHRcdFx0XHRcdFx0XHQvLyBMaXN0IGxhenkgbG9hZGVyIHdpbGwgaW52b2tlIHByb3BlcnR5IGNoYW5nZSBldmVudFxyXG5cdFx0XHRcdFx0XHRcdHByb3BlcnR5T2JqLmFkZENoYW5nZWQob2JqU2lnbmFsLnBlbmRpbmcobnVsbCwgbnVsbCwgdHJ1ZSksIG9iaiwgdHJ1ZSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGZ1bmN0aW9uIHdhaXRGb3JPYmplY3RMb2FkZWQoKSB7XHJcblx0XHRcdFx0Ly8gU2luY2UgdGhlIG9iamVjdCBpcyBub3QgbG9hZGVkLCBkb24ndCBpbnZva2UgdGhlIGNhbGxiYWNrIHVudGlsIGl0IGlzIGxvYWRlZC5cclxuXHRcdFx0XHRvYmoubWV0YS50eXBlLmFkZEluaXRFeGlzdGluZyhvYmpTaWduYWwucGVuZGluZyhmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRlbnN1cmVMaXN0TG9hZGVkKCk7XHJcblx0XHRcdFx0fSwgbnVsbCwgdHJ1ZSksIG9iaiwgdHJ1ZSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGZ1bmN0aW9uIHdhaXRGb3JPYmplY3RFeGlzdHMoKSB7XHJcblx0XHRcdFx0Ly8gVGhlIG9iamVjdCBkb2Vzbid0IGV4aXN0LCBzbyBkb24ndCBpbnZva2UgdGhlIGNhbGxiYWNrIHVudGlsIHNvbWV0aGluZyBjYXVzZXMgaXQgdG8gYmUgY3JlYXRlZC5cclxuXHRcdFx0XHRtb2RlbC5hZGRPYmplY3RSZWdpc3RlcmVkKG9ialNpZ25hbC5wZW5kaW5nKG51bGwsIG51bGwsIHRydWUpLCBmdW5jdGlvbiAobmV3T2JqKSB7XHJcblx0XHRcdFx0XHRpZiAobmV3T2JqLm1ldGEudHlwZSA9PT0gdHlwZS5tZXRhICYmIG5ld09iai5tZXRhLmlkID09PSB0cmFuc2xhdGVJZCh0cmFuc2xhdG9yLCB0eXBlLm1ldGEuZ2V0X2Z1bGxOYW1lKCksIGlkKSkge1xyXG5cdFx0XHRcdFx0XHRvYmogPSBuZXdPYmo7XHJcblx0XHRcdFx0XHRcdGlmICghb2JqLm1ldGEuaXNMb2FkZWQoKSkge1xyXG5cdFx0XHRcdFx0XHRcdHdhaXRGb3JPYmplY3RMb2FkZWQoKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9LCB0cnVlKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKCFvYmopIHtcclxuXHRcdFx0XHR3YWl0Rm9yT2JqZWN0RXhpc3RzKCk7XHJcblx0XHRcdH0gZWxzZSBpZiAoIW9iai5tZXRhLmlzTG9hZGVkKCkpIHtcclxuXHRcdFx0XHR3YWl0Rm9yT2JqZWN0TG9hZGVkKCk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0ZW5zdXJlTGlzdExvYWRlZCgpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRvYmpTaWduYWwud2FpdEZvckFsbChmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMsIG9iaik7XHJcblx0XHRcdH0sIG51bGwsIHRydWUpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5NYXBwZXIuVHlwZUxhenlMb2FkZXJcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHRmdW5jdGlvbiBUeXBlTGF6eUxvYWRlcigpIHtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHR5cGVMb2FkKG10eXBlLCBwcm9wTmFtZSwgaW5TY29wZSwgY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdGlmICghRXhvV2ViLmNvbmZpZy5hbGxvd1R5cGVMYXp5TG9hZGluZykge1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJUeXBlIGxhenkgbG9hZGluZyBoYXMgYmVlbiBkaXNhYmxlZDogXCIgKyBtdHlwZS5nZXRfZnVsbE5hbWUoKSk7XHJcblx0XHR9XHJcblxyXG5cdFx0ZmV0Y2hUeXBlcyhtdHlwZS5tb2RlbCwgW210eXBlLmdldF9mdWxsTmFtZSgpXSwgZnVuY3Rpb24oanN0eXBlKSB7XHJcblx0XHRcdGlmIChjYWxsYmFjayAmJiBjYWxsYmFjayBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcblx0XHRcdFx0Y2FsbGJhY2soanN0eXBlKTtcclxuXHRcdFx0fVxyXG5cdFx0fSwgdGhpc1B0cik7XHJcblx0fVxyXG5cclxuXHRUeXBlTGF6eUxvYWRlci5taXhpbih7XHJcblx0XHRsb2FkOiB0eXBlTG9hZC5kb250RG91YmxlVXAoeyBjYWxsYmFja0FyZzogMywgdGhpc1B0ckFyZzogNCwgZ3JvdXBCeTogMCB9KVxyXG5cdH0pO1xyXG5cclxuXHQoZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgaW5zdGFuY2UgPSBuZXcgVHlwZUxhenlMb2FkZXIoKTtcclxuXHJcblx0XHRUeXBlTGF6eUxvYWRlci5yZWdpc3RlciA9IGZ1bmN0aW9uKG9iaikge1xyXG5cdFx0XHRMYXp5TG9hZGVyLnJlZ2lzdGVyKG9iaiwgaW5zdGFuY2UpO1xyXG5cdFx0fTtcclxuXHJcblx0XHRUeXBlTGF6eUxvYWRlci51bnJlZ2lzdGVyID0gZnVuY3Rpb24ob2JqKSB7XHJcblx0XHRcdExhenlMb2FkZXIudW5yZWdpc3RlcihvYmosIGluc3RhbmNlKTtcclxuXHRcdH07XHJcblx0fSkoKTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5NYXBwZXIuT2JqZWN0TGF6eUxvYWRlclxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdC8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL2NvcmUvQ29uZmlnLmpzXCIgLz5cclxuXHJcblx0ZnVuY3Rpb24gT2JqZWN0TGF6eUxvYWRlcigpIHtcclxuXHRcdHRoaXMuX3JlcXVlc3RzID0ge307XHJcblx0XHR0aGlzLl90eXBlUGF0aHMgPSB7fTtcclxuXHR9XHJcblxyXG5cdHZhciBwZW5kaW5nT2JqZWN0cyA9IDA7XHJcblxyXG5cdHJlZ2lzdGVyQWN0aXZpdHkoXCJPYmplY3RMYXp5TG9hZGVyXCIsIGZ1bmN0aW9uKCkge1xyXG5cdFx0cmV0dXJuIHBlbmRpbmdPYmplY3RzID4gMDtcclxuXHR9KTtcclxuXHJcblx0ZnVuY3Rpb24gb2JqTG9hZChvYmosIHByb3BOYW1lLCBpblNjb3BlLCBjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0aWYgKCFFeG9XZWIuY29uZmlnLmFsbG93T2JqZWN0TGF6eUxvYWRpbmcpIHtcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCRmb3JtYXQoXCJPYmplY3QgbGF6eSBsb2FkaW5nIGhhcyBiZWVuIGRpc2FibGVkOiB7MH18ezF9XCIsIG9iai5tZXRhLnR5cGUuZ2V0X2Z1bGxOYW1lKCksIG9iai5tZXRhLmlkKSk7XHJcblx0XHR9XHJcblxyXG5cdFx0cGVuZGluZ09iamVjdHMrKztcclxuXHJcblx0XHR2YXIgc2lnbmFsID0gbmV3IEV4b1dlYi5TaWduYWwoXCJvYmplY3QgbGF6eSBsb2FkZXJcIik7XHJcblxyXG5cdFx0dmFyIGlkID0gb2JqLm1ldGEuaWQgfHwgU1RBVElDX0lEO1xyXG5cdFx0dmFyIG10eXBlID0gb2JqLm1ldGEudHlwZSB8fCBvYmoubWV0YTtcclxuXHJcblx0XHQvLyBHZXQgdGhlIHBhdGhzIGZyb20gdGhlIG9yaWdpbmFsIHF1ZXJ5KGllcykgdGhhdCBhcHBseSB0byB0aGlzIG9iamVjdCAoYmFzZWQgb24gdHlwZSkuXHJcblx0XHR2YXIgcGF0aHMgPSBPYmplY3RMYXp5TG9hZGVyLmdldFJlbGF0aXZlUGF0aHMob2JqKTtcclxuXHJcblx0XHQvLyBBZGQgdGhlIHByb3BlcnR5IHRvIGxvYWQgaWYgc3BlY2lmaWVkLiAgQXNzdW1lcyBhbiBpbnN0YW5jZSBwcm9wZXJ0eS5cclxuXHRcdGlmIChwcm9wTmFtZSAmJiBwYXRocy5pbmRleE9mKHByb3BOYW1lKSA8IDApIHtcclxuXHRcdFx0cGF0aHMucHVzaChwcm9wTmFtZSk7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gZmV0Y2ggb2JqZWN0IGpzb25cclxuXHRcdGxvZ1dhcm5pbmcoJGZvcm1hdChcIkxhenkgbG9hZCBvYmplY3Q6IHswfXx7MX1cIiwgbXR5cGUuZ2V0X2Z1bGxOYW1lKCksIGlkKSk7XHJcblxyXG5cdFx0Ly8gVE9ETzogcmVmZXJlbmNlIHRvIHNlcnZlciB3aWxsIGJlIGEgc2luZ2xldG9uLCBub3QgY29udGV4dFxyXG5cdFx0b2JqZWN0UHJvdmlkZXIobXR5cGUuZ2V0X2Z1bGxOYW1lKCksIFtpZF0sIHBhdGhzLCBpblNjb3BlLFxyXG5cdFx0XHRzZXJpYWxpemVDaGFuZ2VzLmNhbGwoY29udGV4dC5zZXJ2ZXIsIHRydWUpLFxyXG5cdFx0XHRmdW5jdGlvbihyZXN1bHQpIHtcclxuXHRcdFx0XHRtdHlwZS5tb2RlbC5zZXJ2ZXIuX2hhbmRsZVJlc3VsdChyZXN1bHQsICRmb3JtYXQoXCJMYXp5IGxvYWQ6IHswfXx7MX1cIiwgbXR5cGUuZ2V0X2Z1bGxOYW1lKCksIGlkKSwgbnVsbCwgZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHRMYXp5TG9hZGVyLnVucmVnaXN0ZXIob2JqLCB0aGlzKTtcclxuXHRcdFx0XHRcdHBlbmRpbmdPYmplY3RzLS07XHJcblxyXG5cdFx0XHRcdFx0Ly8gUmFpc2UgaW5pdCBldmVudHMgaWYgcmVnaXN0ZXJlZC5cclxuXHRcdFx0XHRcdGZvciAodmFyIHQgPSBtdHlwZTsgdDsgdCA9IHQuYmFzZVR5cGUpIHtcclxuXHRcdFx0XHRcdFx0dmFyIGhhbmRsZXIgPSB0Ll9nZXRFdmVudEhhbmRsZXIoXCJpbml0RXhpc3RpbmdcIik7XHJcblx0XHRcdFx0XHRcdGlmIChoYW5kbGVyKVxyXG5cdFx0XHRcdFx0XHRcdGhhbmRsZXIob2JqLCB7fSk7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMsIG9iaik7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH0sXHJcblx0XHRcdGZ1bmN0aW9uKGUpIHtcclxuXHRcdFx0XHRwZW5kaW5nT2JqZWN0cy0tO1xyXG5cdFx0XHRcdHZhciBtZXNzYWdlID0gJGZvcm1hdChcIkZhaWxlZCB0byBsb2FkIHswfXx7MX06IFwiLCBbbXR5cGUuZ2V0X2Z1bGxOYW1lKCksIGlkXSk7XHJcblx0XHRcdFx0aWYgKGUgIT09IHVuZGVmaW5lZCAmJiBlICE9PSBudWxsICYmXHJcblx0XHRcdFx0XHRlLmdldF9tZXNzYWdlICE9PSB1bmRlZmluZWQgJiYgZS5nZXRfbWVzc2FnZSAhPT0gbnVsbCAmJlxyXG5cdFx0XHRcdFx0ZS5nZXRfbWVzc2FnZSBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcblxyXG5cdFx0XHRcdFx0bWVzc2FnZSArPSBlLmdldF9tZXNzYWdlKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0bWVzc2FnZSArPSBcInVua25vd24gZXJyb3JcIjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpO1xyXG5cdFx0XHR9KTtcclxuXHJcblx0XHQvLyBkb2VzIHRoZSBvYmplY3QncyB0eXBlIG5lZWQgdG8gYmUgbG9hZGVkIHRvbz9cclxuXHRcdGlmIChMYXp5TG9hZGVyLmlzUmVnaXN0ZXJlZChtdHlwZSkpIHtcclxuXHRcdFx0TGF6eUxvYWRlci5sb2FkKG10eXBlLCBudWxsLCBmYWxzZSwgc2lnbmFsLnBlbmRpbmcoKSk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRPYmplY3RMYXp5TG9hZGVyLm1peGluKHtcclxuXHRcdGxvYWQ6IG9iakxvYWQuZG9udERvdWJsZVVwKHsgY2FsbGJhY2tBcmc6IDMsIHRoaXNQdHJBcmc6IDQsIGdyb3VwQnk6IDAgfSlcclxuXHR9KTtcclxuXHJcblx0KGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIGluc3RhbmNlID0gbmV3IE9iamVjdExhenlMb2FkZXIoKTtcclxuXHJcblx0XHRPYmplY3RMYXp5TG9hZGVyLmFkZFBhdGhzID0gZnVuY3Rpb24gT2JqZWN0TGF6eUxvYWRlciRhZGRQYXRocyhyb290VHlwZSwgcGF0aHMpIHtcclxuXHRcdFx0dmFyIHR5cGVQYXRocyA9IGluc3RhbmNlLl90eXBlUGF0aHNbcm9vdFR5cGVdO1xyXG5cdFx0XHRpZiAoIXR5cGVQYXRocykge1xyXG5cdFx0XHRcdHR5cGVQYXRocyA9IGluc3RhbmNlLl90eXBlUGF0aHNbcm9vdFR5cGVdID0gW107XHJcblx0XHRcdH1cclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBwYXRocy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdHZhciBwYXRoID0gcGF0aHNbaV07XHJcblx0XHRcdFx0aWYgKHR5cGVQYXRocy5pbmRleE9mKHBhdGgpIDwgMCkge1xyXG5cdFx0XHRcdFx0dHlwZVBhdGhzLnB1c2gocGF0aCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9O1xyXG5cclxuXHRcdE9iamVjdExhenlMb2FkZXIuZ2V0UmVsYXRpdmVQYXRocyA9IGZ1bmN0aW9uIGdldFJlbGF0aXZlUGF0aHMob2JqKSB7XHJcblx0XHRcdHJldHVybiBPYmplY3RMYXp5TG9hZGVyLmdldFJlbGF0aXZlUGF0aHNGb3JUeXBlKG9iai5tZXRhLnR5cGUpO1xyXG5cdFx0fTtcclxuXHJcblx0XHRPYmplY3RMYXp5TG9hZGVyLmdldFJlbGF0aXZlUGF0aHNGb3JUeXBlID0gZnVuY3Rpb24gZ2V0UmVsYXRpdmVQYXRoc0ZvclR5cGUodHlwZSkge1xyXG5cdFx0XHR2YXIgcmVsUGF0aHMgPSBbXTtcclxuXHJcblx0XHRcdGZvciAodmFyIHR5cGVOYW1lIGluIGluc3RhbmNlLl90eXBlUGF0aHMpIHtcclxuXHRcdFx0XHR2YXIganN0eXBlID0gTW9kZWwuZ2V0SnNUeXBlKHR5cGVOYW1lKTtcclxuXHJcblx0XHRcdFx0aWYgKGpzdHlwZSAmJiBqc3R5cGUubWV0YSkge1xyXG5cdFx0XHRcdFx0dmFyIHBhdGhzID0gaW5zdGFuY2UuX3R5cGVQYXRoc1t0eXBlTmFtZV07XHJcblx0XHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHBhdGhzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0XHRcdHZhciBwYXRoID0gcGF0aHNbaV0uZXhwcmVzc2lvbjtcclxuXHRcdFx0XHRcdFx0dmFyIGNoYWluID0gTW9kZWwucHJvcGVydHkocGF0aCwganN0eXBlLm1ldGEpO1xyXG5cdFx0XHRcdFx0XHQvLyBObyBuZWVkIHRvIGluY2x1ZGUgc3RhdGljIHBhdGhzIHNpbmNlIGlmIHRoZXkgd2VyZSBcclxuXHRcdFx0XHRcdFx0Ly8gY2FjaGVkIHRoZW4gdGhleSB3ZXJlIGxvYWRlZCBwcmV2aW91c2x5LlxyXG5cdFx0XHRcdFx0XHRpZiAoIWNoYWluLmdldF9pc1N0YXRpYygpKSB7XHJcblx0XHRcdFx0XHRcdFx0dmFyIHJvb3RlZFBhdGggPSBjaGFpbi5yb290ZWRQYXRoKHR5cGUpO1xyXG5cdFx0XHRcdFx0XHRcdGlmIChyb290ZWRQYXRoKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRyZWxQYXRocy5wdXNoKHJvb3RlZFBhdGgpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIHJlbFBhdGhzLmRpc3RpbmN0KCk7XHJcblx0XHR9O1xyXG5cclxuXHRcdE9iamVjdExhenlMb2FkZXIuaXNSZWdpc3RlcmVkID0gZnVuY3Rpb24gKG9iaikge1xyXG5cdFx0XHRyZXR1cm4gTGF6eUxvYWRlci5pc1JlZ2lzdGVyZWQob2JqLCBpbnN0YW5jZSk7XHJcblx0XHR9O1xyXG5cclxuXHRcdE9iamVjdExhenlMb2FkZXIucmVnaXN0ZXIgPSBmdW5jdGlvbihvYmopIHtcclxuXHRcdFx0aWYgKCFPYmplY3RMYXp5TG9hZGVyLmlzUmVnaXN0ZXJlZChvYmopKSB7XHJcblx0XHRcdFx0aWYgKG9iai5tZXRhLnR5cGUuZ2V0X29yaWdpbigpICE9PSBcInNlcnZlclwiKSB7XHJcblx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJGZvcm1hdChcIkNhbm5vdCBsYXp5IGxvYWQgaW5zdGFuY2Ugb2Ygbm9uLXNlcnZlci1vcmlnaW4gdHlwZTogezB9fHsxfVwiLCBvYmoubWV0YS50eXBlLmdldF9mdWxsTmFtZSgpLCBvYmoubWV0YS5pZCkpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRMYXp5TG9hZGVyLnJlZ2lzdGVyKG9iaiwgaW5zdGFuY2UpO1xyXG5cdFx0XHR9XHJcblx0XHR9O1xyXG5cclxuXHRcdE9iamVjdExhenlMb2FkZXIudW5yZWdpc3RlciA9IGZ1bmN0aW9uKG9iaikge1xyXG5cdFx0XHRMYXp5TG9hZGVyLnVucmVnaXN0ZXIob2JqLCBpbnN0YW5jZSk7XHJcblx0XHR9O1xyXG5cdH0pKCk7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuTWFwcGVyLkxpc3RMYXp5TG9hZGVyXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gTGlzdExhenlMb2FkZXIoKSB7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBsaXN0TG9hZChsaXN0LCBwcm9wTmFtZSwgaW5TY29wZSwgY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdHZhciBzaWduYWwgPSBuZXcgRXhvV2ViLlNpZ25hbChcImxpc3QgbGF6eSBsb2FkZXJcIik7XHJcblxyXG5cdFx0dmFyIG1vZGVsID0gbGlzdC5fb3duZXJQcm9wZXJ0eS5nZXRfY29udGFpbmluZ1R5cGUoKS5tb2RlbDtcclxuXHRcdHZhciBvd25lcklkID0gbGlzdC5fb3duZXJJZDtcclxuXHRcdHZhciBjb250YWluaW5nVHlwZSA9IGxpc3QuX293bmVyUHJvcGVydHkuZ2V0X2NvbnRhaW5pbmdUeXBlKCk7XHJcblxyXG5cdFx0Ly8gRGV0ZXJtaW5lIHRoZSBpbnN0YW5jZSBvciB0eXBlIHRoYXQgb3ducyB0aGUgbGlzdC5cclxuXHRcdHZhciBvd25lciA9IG93bmVySWQgPT09IFNUQVRJQ19JRCA/XHJcblxyXG5cdFx0XHQvLyBGb3Igc3RhdGljIGxpc3RzIHRoZSBvd25lciBpcyBhIHR5cGUuXHJcblx0XHRcdGNvbnRhaW5pbmdUeXBlLmdldF9qc3R5cGUoKSA6XHJcblxyXG5cdFx0XHQvLyBGb3Igbm9uLXN0YXRpYyBsaXN0cywgcmV0cmlldmUgdGhlIG93bmVyIGJ5IHR5cGUgYW5kIGlkLlxyXG5cdFx0XHRjb250YWluaW5nVHlwZS5nZXQoXHJcblx0XHRcdFx0Ly8gRmV0Y2ggdGhlIG93bmVyIHVzaW5nIHRoZSBpZCBzcGVjaWZpZWQgaW4gdGhlIGxhenkgbG9hZGVyIG1ldGFkYXRhLlxyXG5cdFx0XHRcdG93bmVySWQsXHJcblxyXG5cdFx0XHRcdC8vIFdoZW4gbG9hZGluZyBhIGxpc3QgdGhlIHR5cGUgb2YgdGhlIG93bmVyIGNvbWVzIGZyb20gdGhlIGNvbnRhaW5pbmdcclxuXHRcdFx0XHQvLyB0eXBlIG9mIHRoZSBwcm9wZXJ0eSwgc28gaXQgbWF5IG5vdCBiZSB0aGUgZXhhY3QgdHlwZSBvZiB0aGUgaW5zdGFuY2UuXHJcblx0XHRcdFx0ZmFsc2VcclxuXHRcdFx0KTtcclxuXHJcblx0XHR2YXIgb3duZXJUeXBlID0gb3duZXJJZCA9PT0gU1RBVElDX0lEID8gb3duZXIubWV0YS5nZXRfZnVsbE5hbWUoKSA6IG93bmVyLm1ldGEudHlwZS5nZXRfZnVsbE5hbWUoKTtcclxuXHRcdHZhciBwcm9wID0gbGlzdC5fb3duZXJQcm9wZXJ0eTtcclxuXHRcdHZhciBwcm9wSW5kZXggPSBsaXN0Ll9vd25lclByb3BlcnR5LmdldF9pbmRleCgpO1xyXG5cdFx0dmFyIHByb3BOYW1lID0gbGlzdC5fb3duZXJQcm9wZXJ0eS5nZXRfbmFtZSgpO1xyXG5cdFx0dmFyIHByb3BUeXBlID0gbGlzdC5fb3duZXJQcm9wZXJ0eS5nZXRfanN0eXBlKCkubWV0YTtcclxuXHJcblx0XHRpZiAoIUV4b1dlYi5jb25maWcuYWxsb3dMaXN0TGF6eUxvYWRpbmcpIHtcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCRmb3JtYXQoXCJMaXN0IGxhenkgbG9hZGluZyBoYXMgYmVlbiBkaXNhYmxlZDogezB9fHsxfS57Mn1cIiwgb3duZXJUeXBlLCBvd25lcklkLCBwcm9wTmFtZSkpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGxvYWQgdGhlIG9iamVjdHMgaW4gdGhlIGxpc3RcclxuXHRcdGxvZ1dhcm5pbmcoJGZvcm1hdChcIkxhenkgbG9hZCBsaXN0OiB7MH18ezF9LnsyfVwiLCBvd25lclR5cGUsIG93bmVySWQsIHByb3BOYW1lKSk7XHJcblxyXG5cdFx0dmFyIG9iamVjdEpzb24sIGNvbmRpdGlvbnNKc29uO1xyXG5cclxuXHRcdC8vIFRPRE86IHJlZmVyZW5jZSB0byBzZXJ2ZXIgd2lsbCBiZSBhIHNpbmdsZXRvbiwgbm90IGNvbnRleHRcclxuXHRcdGxpc3RQcm92aWRlcihvd25lclR5cGUsIG93bmVySWQsIHByb3BOYW1lLCBvd25lcklkID09PSBTVEFUSUNfSUQgPyBbXSA6IE9iamVjdExhenlMb2FkZXIuZ2V0UmVsYXRpdmVQYXRoc0ZvclR5cGUocHJvcFR5cGUpLFxyXG5cdFx0XHRzZXJpYWxpemVDaGFuZ2VzLmNhbGwoY29udGV4dC5zZXJ2ZXIsIHRydWUpLFxyXG5cdFx0XHRzaWduYWwucGVuZGluZyhmdW5jdGlvbihyZXN1bHQpIHtcclxuXHRcdFx0XHRvYmplY3RKc29uID0gcmVzdWx0Lmluc3RhbmNlcztcclxuXHRcdFx0XHRjb25kaXRpb25zSnNvbiA9IHJlc3VsdC5jb25kaXRpb25zO1xyXG5cdFx0XHR9KSxcclxuXHRcdFx0c2lnbmFsLm9yUGVuZGluZyhmdW5jdGlvbihlKSB7XHJcblx0XHRcdFx0dmFyIGVycm9yTWVzc2FnZTtcclxuXHRcdFx0XHRpZiAoZSAhPT0gdW5kZWZpbmVkICYmIGUgIT09IG51bGwgJiZcclxuXHRcdFx0XHRcdFx0ZS5nZXRfbWVzc2FnZSAhPT0gdW5kZWZpbmVkICYmIGUuZ2V0X21lc3NhZ2UgIT09IG51bGwgJiZcclxuXHRcdFx0XHRcdFx0ZS5nZXRfbWVzc2FnZSBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcblxyXG5cdFx0XHRcdFx0ZXJyb3JNZXNzYWdlID0gZS5nZXRfbWVzc2FnZSgpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmIChlLm1lc3NhZ2UpIHtcclxuXHRcdFx0XHRcdGVycm9yTWVzc2FnZSA9IGUubWVzc2FnZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRlcnJvck1lc3NhZ2UgPSBcInVua25vd24gZXJyb3JcIjtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcigkZm9ybWF0KFwiRmFpbGVkIHRvIGxvYWQgezB9fHsxfS57Mn06IHszfVwiLCBvd25lclR5cGUsIG93bmVySWQsIHByb3BOYW1lLCBlcnJvck1lc3NhZ2UpKTtcclxuXHRcdFx0fSlcclxuXHRcdCk7XHJcblxyXG5cdFx0Ly8gZW5zdXJlIHRoYXQgdGhlIHByb3BlcnR5IHR5cGUgaXMgbG9hZGVkIGFzIHdlbGwuXHJcblx0XHQvLyBpZiB0aGUgbGlzdCBoYXMgb2JqZWN0cyB0aGF0IGFyZSBzdWJ0eXBlcywgdGhvc2Ugd2lsbCBiZSBsb2FkZWQgbGF0ZXJcclxuXHRcdC8vIHdoZW4gdGhlIGluc3RhbmNlcyBhcmUgYmVpbmcgbG9hZGVkXHJcblx0XHRpZiAoTGF6eUxvYWRlci5pc1JlZ2lzdGVyZWQocHJvcFR5cGUpKSB7XHJcblx0XHRcdExhenlMb2FkZXIubG9hZChwcm9wVHlwZSwgbnVsbCwgZmFsc2UsIHNpZ25hbC5wZW5kaW5nKCkpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHNpZ25hbC53YWl0Rm9yQWxsKGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRpZiAoIW9iamVjdEpzb24pIHtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIFRoZSBhY3R1YWwgdHlwZSBuYW1lIGFuZCBpZCBhcyBmb3VuZCBpbiB0aGUgcmVzdWx0aW5nIGpzb24uXHJcblx0XHRcdHZhciBqc29uSWQgPSBvd25lcklkO1xyXG5cdFx0XHR2YXIganNvblR5cGUgPSBvd25lclR5cGU7XHJcblxyXG5cdFx0XHQvLyBGaW5kIHRoZSBnaXZlbiB0eXBlIGFuZCBpZCBpbiB0aGUgb2JqZWN0IGpzb24uICBUaGUgdHlwZSBrZXkgbWF5IGJlIGEgZGVydmllZCB0eXBlLlxyXG5cdFx0XHRmdW5jdGlvbiBzZWFyY2hKc29uKG10eXBlLCBpZCkge1xyXG5cdFx0XHRcdC8vIFRoZSBnaXZlbiB0eXBlIGlzIGEga2V5IHRoYXQgaXMgcHJlc2VudCBpbiB0aGUgcmVzdWx0IGpzb24uXHJcblx0XHRcdFx0aWYgKG9iamVjdEpzb25bbXR5cGUuZ2V0X2Z1bGxOYW1lKCldKSB7XHJcblxyXG5cdFx0XHRcdFx0Ly8gVGhlIGlkIGlzIGFsc28gYSBrZXkuXHJcblx0XHRcdFx0XHRpZiAob2JqZWN0SnNvblttdHlwZS5nZXRfZnVsbE5hbWUoKV1baWRdKSB7XHJcblx0XHRcdFx0XHRcdGpzb25UeXBlID0gbXR5cGUuZ2V0X2Z1bGxOYW1lKCk7XHJcblx0XHRcdFx0XHRcdGpzb25JZCA9IGlkO1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyBJZHMgcmV0dXJuZWQgZnJvbSB0aGUgc2VydmVyIGFyZSBub3QgYWx3YXlzIGluIHRoZSBzYW1lIGNhc2UgYXMgaWRzIG9uIHRoZSBjbGllbnQsIHNvIGNoZWNrIG9uZS1ieS1vbmUuXHJcblx0XHRcdFx0XHRmb3IgKHZhciB2YXJJZCBpbiBvYmplY3RKc29uW210eXBlLmdldF9mdWxsTmFtZSgpXSkge1xyXG5cdFx0XHRcdFx0XHRpZiAodmFySWQudG9Mb3dlckNhc2UoKSA9PSBpZC50b0xvd2VyQ2FzZSgpKSB7XHJcblx0XHRcdFx0XHRcdFx0anNvblR5cGUgPSBtdHlwZS5nZXRfZnVsbE5hbWUoKTtcclxuXHRcdFx0XHRcdFx0XHRqc29uSWQgPSB2YXJJZDtcclxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gQ2hlY2sgZGVyaXZlZCB0eXBlcyByZWN1cnNpdmVseS5cclxuXHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IG10eXBlLmRlcml2ZWRUeXBlcy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdFx0aWYgKHNlYXJjaEpzb24obXR5cGUuZGVyaXZlZFR5cGVzW2ldLCBpZCkpIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoIXNlYXJjaEpzb24oRXhvV2ViLk1vZGVsLk1vZGVsLmdldEpzVHlwZShvd25lclR5cGUpLm1ldGEsIG93bmVySWQpKSB7XHJcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCRmb3JtYXQoXCJEYXRhIGNvdWxkIG5vdCBiZSBmb3VuZCBmb3IgezB9OnsxfS5cIiwgb3duZXJUeXBlLCBvd25lcklkKSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciBsaXN0SnNvbiA9IHByb3AuZ2V0X2lzU3RhdGljKCkgP1xyXG5cdFx0XHRcdG9iamVjdEpzb25banNvblR5cGVdW2pzb25JZF1bcHJvcE5hbWVdIDpcclxuXHRcdFx0XHRvYmplY3RKc29uW2pzb25UeXBlXVtqc29uSWRdW3Byb3BJbmRleF07XHJcblxyXG5cdFx0XHRpZiAoIShsaXN0SnNvbiBpbnN0YW5jZW9mIEFycmF5KSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcigkZm9ybWF0KFwiQXR0ZW1wdGluZyB0byBsb2FkIGxpc3QgezB9IG9mIGluc3RhbmNlIHsxfTp7Mn0sIGJ1dCB0aGUgcmVzcG9uc2UgSlNPTiBpcyBub3QgYW4gYXJyYXk6IHszfS5cIiwgcHJvcE5hbWUsIG93bmVyVHlwZSwgb3duZXJJZCwgbGlzdEpzb24pKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIHBvcHVsYXRlTGlzdCA9IGZhbHNlO1xyXG5cdFx0XHQvL3ZhciBuZXdJdGVtcyA9IFtdO1xyXG5cclxuXHRcdFx0aWYgKExhenlMb2FkZXIuaXNSZWdpc3RlcmVkKGxpc3QpKSB7XHJcblx0XHRcdFx0Ly8gSWYgdGhlIGxhenkgbG9hZGVyIGlzIG5vIGxvbmdlciByZWdpc3RlcmVkLFxyXG5cdFx0XHRcdC8vIHRoZW4gZG9uJ3QgcG9wdWxhdGUgdGhlIGxpc3QuXHJcblx0XHRcdFx0cG9wdWxhdGVMaXN0ID0gdHJ1ZTtcclxuXHRcdFx0XHRMaXN0TGF6eUxvYWRlci51bnJlZ2lzdGVyKGxpc3QsIHRoaXMpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBwb3B1bGF0ZSB0aGUgbGlzdCB3aXRoIG9iamVjdHNcclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0SnNvbi5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdHZhciByZWYgPSBsaXN0SnNvbltpXTtcclxuXHRcdFx0XHR2YXIgaXRlbSA9IGdldE9iamVjdChtb2RlbCwgcHJvcFR5cGUsIChyZWYgJiYgcmVmLmlkIHx8IHJlZiksIChyZWYgJiYgcmVmLnR5cGUgfHwgcHJvcFR5cGUpKTtcclxuXHJcblx0XHRcdFx0Ly9uZXdJdGVtcy5wdXNoKGl0ZW0pO1xyXG5cclxuXHRcdFx0XHRpZiAocG9wdWxhdGVMaXN0KSB7XHJcblx0XHRcdFx0XHRpZiAobGlzdC5jb250YWlucyhpdGVtKSkge1xyXG5cdFx0XHRcdFx0XHRsb2dXYXJuaW5nKCRmb3JtYXQoXCJMYXp5IGxvYWRpbmcgbGlzdCB7MH18ezF9LnsyfSBhbHJlYWR5IGNvbnRhaW5zIG9iamVjdCB7M30uXCIsIG93bmVyVHlwZSwgb3duZXJJZCwgcHJvcE5hbWUsIEVudGl0eS50b0lkU3RyaW5nKGl0ZW0pKSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRsaXN0LnB1c2goaXRlbSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBpZiB0aGUgbGlzdCBpdGVtIGlzIGFscmVhZHkgbG9hZGVkIGVuc3VyZSBpdHMgZGF0YSBpcyBub3QgaW4gdGhlIHJlc3BvbnNlXHJcblx0XHRcdFx0Ly8gc28gdGhhdCBpdCB3b24ndCBiZSByZWxvYWRlZFxyXG5cdFx0XHRcdGlmIChMYXp5TG9hZGVyLmlzTG9hZGVkKGl0ZW0pKSB7XHJcblx0XHRcdFx0XHRkZWxldGUgb2JqZWN0SnNvbltqc29uVHlwZV1bcmVmLmlkXTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIHJlbW92ZSBsaXN0IGZyb20ganNvbiBhbmQgcHJvY2VzcyB0aGUganNvbi4gIHRoZXJlIG1heSBiZVxyXG5cdFx0XHQvLyBpbnN0YW5jZSBkYXRhIHJldHVybmVkIGZvciB0aGUgb2JqZWN0cyBpbiB0aGUgbGlzdFxyXG5cdFx0XHRpZiAoTGF6eUxvYWRlci5pc0xvYWRlZChvd25lcikpIHtcclxuXHRcdFx0XHRkZWxldGUgb2JqZWN0SnNvbltqc29uVHlwZV1banNvbklkXTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0TGlzdExhenlMb2FkZXIudW5yZWdpc3RlcihsaXN0LCB0aGlzKTtcclxuXHJcblx0XHRcdHZhciBiYXRjaCA9IEV4b1dlYi5CYXRjaC5zdGFydCgkZm9ybWF0KFwiezB9fHsxfS57Mn1cIiwgW293bmVyVHlwZSwgb3duZXJJZCwgcHJvcE5hbWVdKSk7XHJcblxyXG5cdFx0XHR2YXIgZG9uZSA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdC8vIENvbGxlY3Rpb24gY2hhbmdlIGRyaXZlbiBieSB1c2VyIGFjdGlvbiBvciBvdGhlciBiZWhhdmlvciB3b3VsZCByZXN1bHQgaW4gdGhlIFwiY2hhbmdlXCIgZXZlbnRcclxuXHRcdFx0XHQvL1x0YmVpbmcgcmFpc2VkIGZvciB0aGUgbGlzdCBwcm9wZXJ0eS4gIFNpbmNlIHdlIGRvbid0IHdhbnQgdG8gcmVjb3JkIHRoaXMgYXMgYSB0cnVlIG9ic2VydmFibGVcclxuXHRcdFx0XHQvL1x0Y2hhbmdlLCByYWlzZSB0aGUgZXZlbnQgbWFudWFsbHkgc28gdGhhdCBydWxlcyB3aWxsIHN0aWxsIHJ1biBhcyBuZWVkZWQuXHJcblx0XHRcdFx0Ly8gVGhpcyBvY2N1cnMgYmVmb3JlIGJhdGNoIGVuZCBzbyB0aGF0IGl0IGZ1bmN0aW9ucyBsaWtlIG5vcm1hbCBvYmplY3QgbG9hZGluZy5cclxuXHRcdFx0XHQvL2lmIChvd25lcklkICE9PSBTVEFUSUNfSUQpIHtcclxuXHRcdFx0XHRwcm9wLl9yYWlzZUV2ZW50KFwiY2hhbmdlZFwiLCBbb3duZXIsIHsgcHJvcGVydHk6IHByb3AsIG5ld1ZhbHVlOiBsaXN0LCBvbGRWYWx1ZTogdW5kZWZpbmVkLCBjb2xsZWN0aW9uQ2hhbmdlZDogdHJ1ZSB9XSk7XHJcblx0XHRcdFx0Ly99XHJcblxyXG5cdFx0XHRcdC8vIEV4YW1wbGUgb2YgZXhwbGljaXRseSByYWlzaW5nIHRoZSBjb2xsZWN0aW9uIGNoYW5nZSBldmVudCBpZiBuZWVkZWQuXHJcblx0XHRcdFx0Ly8gTk9URTogVGhpcyBpcyBwcm9iYWJseSBub3QgbmVjZXNzYXJ5IGJlY2F1c2UgaXQgaXMgZGlmZmljdWx0IHRvIGdldCBhIHJlZmVyZW5jZSB0byBhXHJcblx0XHRcdFx0Ly8gbm9uLWxvYWRlZCBsaXN0IGFuZCBzbyBub3RoaW5nIHdvdWxkIGJlIHdhdGNoaW5nIGZvciBjaGFuZ2VzIHByaW9yIHRvIGxvYWRpbmcgY29tcGxldGlvbi5cclxuXHRcdFx0XHQvLyBUaGUgX2luaXRpYWxpemluZyBmbGFnIHdvdWxkIGJlIG5lY2Vzc2FyeSB0byBzaWduYWwgdG8gdGhlIHByb3BlcnR5J3MgY29sbGVjdGlvbiBjaGFuZ2VcclxuXHRcdFx0XHQvLyBoYW5kbGVyIHRoYXQgaXQgc2hvdWxkIG5vdCByYWlzZSB0aGUgdmFyaW91cyBldmVudHMgaW4gcmVzcG9uc2UgdG8gdGhlIGNvbGxlY3Rpb24gY2hhbmdlLlxyXG5cdFx0XHRcdC8vbGlzdC5faW5pdGlhbGl6aW5nID0gdHJ1ZTtcclxuXHRcdFx0XHQvL1N5cy5PYnNlcnZlci5yYWlzZUNvbGxlY3Rpb25DaGFuZ2VkKGxpc3QsIFtuZXcgU3lzLkNvbGxlY3Rpb25DaGFuZ2UoU3lzLk5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkQWN0aW9uLmFkZCwgbmV3SXRlbXMsIDApXSk7XHJcblx0XHRcdFx0Ly9kZWxldGUgbGlzdC5faW5pdGlhbGl6aW5nO1xyXG5cclxuXHRcdFx0XHRFeG9XZWIuQmF0Y2guZW5kKGJhdGNoKTtcclxuXHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcywgbGlzdCk7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHRvYmplY3RzRnJvbUpzb24obW9kZWwsIG9iamVjdEpzb24sIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdGlmIChjb25kaXRpb25zSnNvbikge1xyXG5cdFx0XHRcdFx0Y29uZGl0aW9uc0Zyb21Kc29uKG1vZGVsLCBjb25kaXRpb25zSnNvbiwgbGlzdC5zbGljZSgwKSwgZG9uZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0ZG9uZSgpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdExpc3RMYXp5TG9hZGVyLm1peGluKHtcclxuXHRcdGxvYWQ6IGxpc3RMb2FkLmRvbnREb3VibGVVcCh7IGNhbGxiYWNrQXJnOiAzLCB0aGlzUHRyQXJnOiA0LCBncm91cEJ5OiAwIH0pXHJcblx0fSk7XHJcblxyXG5cdChmdW5jdGlvbigpIHtcclxuXHRcdHZhciBpbnN0YW5jZSA9IG5ldyBMaXN0TGF6eUxvYWRlcigpO1xyXG5cclxuXHRcdHZhciBtb2RpZmlhYmxlTGlzdHMgPSBbXTtcclxuXHJcblx0XHRmdW5jdGlvbiBsYXp5TGlzdE1vZGlmaWVkKHNlbmRlciwgYXJncykge1xyXG5cdFx0XHQvLyBDaGVjayB0aGF0IG1vZGlmaWNhdGlvbnMgaGF2ZSBub3QgYmVlbiBhbGxvd2VkLlxyXG5cdFx0XHRpZiAobW9kaWZpYWJsZUxpc3RzLmluZGV4T2Yoc2VuZGVyKSA8IDApIHtcclxuXHRcdFx0XHQvLyBDaGVjayB0aGF0IGF0IGxlYXN0IG9uZSBjaGFuZ2UgaW52b2x2ZXMgYWRkaW5nIG9yIHJlbW92aW5nIGEgbm9uLW5ldyBpbnN0YW5jZS5cclxuXHRcdFx0XHRpZiAoYXJncy5nZXRfY2hhbmdlcygpLm1hcFRvQXJyYXkoZnVuY3Rpb24oYykgeyByZXR1cm4gYy5uZXdJdGVtcyB8fCBbXTsgfSkuY29uY2F0KGFyZ3MuZ2V0X2NoYW5nZXMoKS5tYXBUb0FycmF5KGZ1bmN0aW9uKGMpIHsgcmV0dXJuIGMub2xkSXRlbXMgfHwgW107IH0pKS5zb21lKGZ1bmN0aW9uKGkpIHsgcmV0dXJuICFpLm1ldGEuaXNOZXc7IH0pKSB7XHJcblx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJGZvcm1hdChcInswfSBsaXN0IHsxfS57Mn0gd2FzIG1vZGlmaWVkIGJ1dCBpdCBoYXMgbm90IGJlZW4gbG9hZGVkLlwiLFxyXG5cdFx0XHRcdFx0XHR0aGlzLl9pc1N0YXRpYyA/IFwiU3RhdGljXCIgOiBcIk5vbi1zdGF0aWNcIixcclxuXHRcdFx0XHRcdFx0dGhpcy5faXNTdGF0aWMgPyB0aGlzLl9jb250YWluaW5nVHlwZS5nZXRfZnVsbE5hbWUoKSA6IFwidGhpczxcIiArIHRoaXMuX2NvbnRhaW5pbmdUeXBlLmdldF9mdWxsTmFtZSgpICsgXCI+XCIsXHJcblx0XHRcdFx0XHRcdHRoaXMuX25hbWVcclxuXHRcdFx0XHRcdCkpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdExpc3RMYXp5TG9hZGVyLnJlZ2lzdGVyID0gZnVuY3Rpb24ob2JqLCBwcm9wKSB7XHJcblx0XHRcdHZhciBsaXN0ID0gW107XHJcblxyXG5cdFx0XHQvLyBUaHJvdyBhbiBlcnJvciBpZiBhIG5vbi1sb2FkZWQgbGlzdCBpcyBtb2RpZmllZFxyXG5cdFx0XHR2YXIgY29sbGVjdGlvbkNoYW5nZUhhbmRsZXIgPSBsYXp5TGlzdE1vZGlmaWVkLmJpbmQocHJvcCk7XHJcblx0XHRcdGxpc3QuX2NvbGxlY3Rpb25DaGFuZ2VIYW5kbGVyID0gY29sbGVjdGlvbkNoYW5nZUhhbmRsZXI7XHJcblx0XHRcdE9ic2VydmVyLmFkZENvbGxlY3Rpb25DaGFuZ2VkKGxpc3QsIGNvbGxlY3Rpb25DaGFuZ2VIYW5kbGVyKTtcclxuXHJcblx0XHRcdGxpc3QuX293bmVySWQgPSBwcm9wLmdldF9pc1N0YXRpYygpID8gU1RBVElDX0lEIDogb2JqLm1ldGEuaWQ7XHJcblx0XHRcdGxpc3QuX293bmVyUHJvcGVydHkgPSBwcm9wO1xyXG5cclxuXHRcdFx0TGF6eUxvYWRlci5yZWdpc3RlcihsaXN0LCBpbnN0YW5jZSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gbGlzdDtcclxuXHRcdH07XHJcblxyXG5cdFx0TGlzdExhenlMb2FkZXIudW5yZWdpc3RlciA9IGZ1bmN0aW9uKGxpc3QpIHtcclxuXHRcdFx0T2JzZXJ2ZXIucmVtb3ZlQ29sbGVjdGlvbkNoYW5nZWQobGlzdCwgbGlzdC5fY29sbGVjdGlvbkNoYW5nZUhhbmRsZXIpO1xyXG5cdFx0XHRMYXp5TG9hZGVyLnVucmVnaXN0ZXIobGlzdCwgaW5zdGFuY2UpO1xyXG5cclxuXHRcdFx0ZGVsZXRlIGxpc3QuX293bmVySWQ7XHJcblx0XHRcdGRlbGV0ZSBsaXN0Ll9vd25lclByb3BlcnR5O1xyXG5cdFx0XHRkZWxldGUgbGlzdC5fY29sbGVjdGlvbkNoYW5nZUhhbmRsZXI7XHJcblx0XHR9O1xyXG5cclxuXHRcdExpc3RMYXp5TG9hZGVyLmFsbG93TW9kaWZpY2F0aW9uID0gZnVuY3Rpb24obGlzdCwgY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdFx0bW9kaWZpYWJsZUxpc3RzLnB1c2gobGlzdCk7XHJcblx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzKTtcclxuXHRcdFx0bW9kaWZpYWJsZUxpc3RzLnJlbW92ZShsaXN0KTtcclxuXHRcdH07XHJcblx0fSkoKTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5NYXBwZXIuQ29udGV4dFxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdC8vIFNpZ25hbCB0byBrZWVwIHRyYWNrIG9mIGFueSBvbmdvaW5nIGNvbnRleHQgaW5pdGlhbGl6YXRpb25cclxuXHR2YXIgYWxsU2lnbmFscyA9IG5ldyBFeG9XZWIuU2lnbmFsKFwiQ29udGV4dCA6IGFsbFNpZ25hbHNcIik7XHJcblxyXG5cdEV4b1dlYi5yZWdpc3RlckFjdGl2aXR5KFwiQ29udGV4dDogYWxsU2lnbmFsc1wiLCBmdW5jdGlvbigpIHtcclxuXHRcdHJldHVybiBhbGxTaWduYWxzLmlzQWN0aXZlKCk7XHJcblx0fSk7XHJcblxyXG5cdGZ1bmN0aW9uIENvbnRleHQoKSB7XHJcblx0XHR3aW5kb3cuY29udGV4dCA9IHRoaXM7XHJcblxyXG5cdFx0dGhpcy5tb2RlbCA9IHsgbWV0YTogbmV3IEV4b1dlYi5Nb2RlbC5Nb2RlbCgpIH07XHJcblx0XHR0aGlzLnNlcnZlciA9IG5ldyBTZXJ2ZXJTeW5jKHRoaXMubW9kZWwubWV0YSk7XHJcblx0fVxyXG5cclxuXHRDb250ZXh0Lm1peGluKEV4b1dlYi5GdW5jdG9yLmV2ZW50aW5nKTtcclxuXHJcblx0dmFyIG51bWJlck9mUGVuZGluZ1F1ZXJpZXM7XHJcblxyXG5cdENvbnRleHQubWl4aW4oe1xyXG5cdFx0YWRkUmVhZHk6IGZ1bmN0aW9uIENvbnRleHQkYWRkUmVhZHkoY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdFx0dmFyIHF1ZXJpZXNBcmVDb21wbGV0ZSA9IG51bWJlck9mUGVuZGluZ1F1ZXJpZXMgPT09IDA7XHJcblxyXG5cdFx0XHR0aGlzLl9hZGRFdmVudChcInJlYWR5XCIsIHRoaXNQdHIgPyBjYWxsYmFjay5iaW5kKHRoaXNQdHIpIDogY2FsbGJhY2ssIG51bGwsIHRydWUpO1xyXG5cclxuXHRcdFx0Ly8gU2ltdWxhdGUgdGhlIGV2ZW50IGJlaW5nIHJhaXNlZCBpbW1lZGlhdGVseSBpZiBhIHF1ZXJ5IG9yIHF1ZXJpZXMgaGF2ZSBhbHJlYWR5IGNvbXBsZXRlZFxyXG5cdFx0XHRpZiAocXVlcmllc0FyZUNvbXBsZXRlKSB7XHJcblx0XHRcdFx0Ly8gU3Vic2NyaWJlcnMgd2lsbCBub3QgYWN0dWFsbHkgYmUgY2FsbGVkIHVudGlsIHNpZ25hbHMgaGF2ZSBzdWJzaWRlZFxyXG5cdFx0XHRcdGFsbFNpZ25hbHMud2FpdEZvckFsbChmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdHRoaXMuX3JhaXNlRXZlbnQoXCJyZWFkeVwiKTtcclxuXHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdGlzUGVuZGluZzogZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRyZXR1cm4gbnVtYmVyT2ZQZW5kaW5nUXVlcmllcyA+IDA7XHJcblx0XHR9LFxyXG5cdFx0YmVnaW5Db250ZXh0UmVhZHk6IEV4b1dlYi5GdW5jdG9yKCksXHJcblx0XHRlbmRDb250ZXh0UmVhZHk6IEV4b1dlYi5GdW5jdG9yKClcclxuXHR9KTtcclxuXHJcblx0ZnVuY3Rpb24gZW5zdXJlQ29udGV4dCgpIHtcclxuXHRcdGlmICghd2luZG93LmNvbnRleHQpIHtcclxuXHRcdFx0d2luZG93LmNvbnRleHQgPSBuZXcgQ29udGV4dCgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmICghKHdpbmRvdy5jb250ZXh0IGluc3RhbmNlb2YgQ29udGV4dCkpIHtcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiVGhlIHdpbmRvdyBvYmplY3QgaGFzIGEgY29udGV4dCBwcm9wZXJ0eSB0aGF0IGlzIG5vdCBhIHZhbGlkIGNvbnRleHQuXCIpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Q29udGV4dC5yZWFkeSA9IGZ1bmN0aW9uIENvbnRleHQkcmVhZHkoY29udGV4dCkge1xyXG5cdFx0bnVtYmVyT2ZQZW5kaW5nUXVlcmllcy0tO1xyXG5cclxuXHRcdHZhciBxdWVyaWVzQXJlQ29tcGxldGUgPSBudW1iZXJPZlBlbmRpbmdRdWVyaWVzID09PSAwO1xyXG5cclxuXHRcdGlmIChxdWVyaWVzQXJlQ29tcGxldGUpIHtcclxuXHRcdFx0Ly8gSW5kaWNhdGUgdGhhdCBvbmUgb3IgbW9yZSBtb2RlbCBxdWVyaWVzIGFyZSByZWFkeSBmb3IgY29uc3VtcHRpb25cclxuXHRcdFx0YWxsU2lnbmFscy53YWl0Rm9yQWxsKGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdGNvbnRleHQuX3JhaXNlRXZlbnQoXCJyZWFkeVwiKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0Q29udGV4dC5xdWVyeSA9IGZ1bmN0aW9uIENvbnRleHQkcXVlcnkoY29udGV4dCwgb3B0aW9ucykge1xyXG5cdFx0dmFyIHF1ZXJpZXNIYXZlQmVndW5PckNvbXBsZXRlZCA9IG51bWJlck9mUGVuZGluZ1F1ZXJpZXMgIT09IHVuZGVmaW5lZDtcclxuXHRcdGlmICghcXVlcmllc0hhdmVCZWd1bk9yQ29tcGxldGVkKSB7XHJcblx0XHRcdG51bWJlck9mUGVuZGluZ1F1ZXJpZXMgPSAwO1xyXG5cdFx0fVxyXG5cdFx0bnVtYmVyT2ZQZW5kaW5nUXVlcmllcysrO1xyXG5cclxuXHRcdC8vIEV4ZWN1dGUgdGhlIHF1ZXJ5IGFuZCBmaXJlIHRoZSByZWFkeSBldmVudCB3aGVuIGNvbXBsZXRlXHJcblx0XHQobmV3IENvbnRleHRRdWVyeShjb250ZXh0LCBvcHRpb25zKSkuZXhlY3V0ZShmdW5jdGlvbigpIHtcclxuXHRcdFx0Q29udGV4dC5yZWFkeShjb250ZXh0KTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5NYXBwZXIuQ29udGV4dFF1ZXJ5XHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gQ29udGV4dFF1ZXJ5KGNvbnRleHQsIG9wdGlvbnMpIHtcclxuXHRcdHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XHJcblx0XHR0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xyXG5cdFx0dGhpcy5iYXRjaCA9IG51bGw7XHJcblx0XHR0aGlzLnN0YXRlID0ge307XHJcblx0fVxyXG5cclxuXHRDb250ZXh0UXVlcnkubWl4aW4oe1xyXG5cdFx0ZXhlY3V0ZTogRXhvV2ViLkZ1bmN0aW9uQ2hhaW4ucHJlcGFyZShcclxuXHJcblx0XHQvLyBTdGFydHMgYSBiYXRjaCBzbyB0aGF0IG90aGVycyB3aWxsIG5vdCByZXNwb25kIHRvIGNoYW5nZXMgdGhhdCBhcmVcclxuXHRcdC8vIGJyb2FkY2FzdCBkdXJpbmcgcXVlcnlpbmcsIGkuZS4gaW5zdGFuY2UgbG9hZGluZy5cclxuXHRcdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHRcdFx0ZnVuY3Rpb24gQ29udGV4dFF1ZXJ5JHNldHVwKGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRcdFx0Ly8gc3RhcnQgYSBiYXRjaCB0byByZXByZXNlbnQgYWxsIG9mIHRoZSBwZW5kaW5nIHdvcmtcclxuXHRcdFx0XHR0aGlzLmJhdGNoID0gRXhvV2ViLkJhdGNoLnN0YXJ0KFwiY29udGV4dCBxdWVyeVwiKTtcclxuXHJcblx0XHRcdFx0Ly8gc3RvcmUgaW5pdCBjaGFuZ2VzIGFzIGVhcmx5IGFzIHBvc3NpYmxlXHJcblx0XHRcdFx0aWYgKHRoaXMub3B0aW9ucy5jaGFuZ2VzKVxyXG5cdFx0XHRcdFx0U2VydmVyU3luYyRzdG9yZUluaXRDaGFuZ2VzLmNhbGwodGhpcy5jb250ZXh0LnNlcnZlciwgdGhpcy5vcHRpb25zLmNoYW5nZXMpO1xyXG5cclxuXHRcdFx0XHQvLyBJZiB0aGUgYWxsU2lnbmFscyBzaWduYWwgaXMgbm90IGFjdGl2ZSwgdGhlbiBzZXQgdXAgYSBmYWtlIHBlbmRpbmcgY2FsbGJhY2sgaW5cclxuXHRcdFx0XHQvLyBvcmRlciB0byBlbnN1cmUgdGhhdCB0aGUgY29udGV4dCBpcyBub3QgXCJsb2FkZWRcIiBwcmlvciB0byBtb2RlbHMgYmVpbmcgaW5pdGlsaXplZC5cclxuXHRcdFx0XHRpZiAoIWFsbFNpZ25hbHMuaXNBY3RpdmUoKSkge1xyXG5cdFx0XHRcdFx0dGhpcy5fcHJlZGljdGl2ZU1vZGVsUGVuZGluZyA9IGFsbFNpZ25hbHMucGVuZGluZyhudWxsLCB0aGlzLCB0cnVlKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIFNldHVwIGxhenkgbG9hZGluZyBvbiB0aGUgY29udGV4dCBvYmplY3QgdG8gY29udHJvbCBsYXp5IGV2YWx1YXRpb24uXHJcblx0XHRcdFx0Ly8gTG9hZGluZyBpcyBjb25zaWRlcmVkIGNvbXBsZXRlIGF0IHRoZSBzYW1lIHBvaW50IG1vZGVsLnJlYWR5KCkgZmlyZXMuIFxyXG5cdFx0XHRcdExhenlMb2FkZXIucmVnaXN0ZXIodGhpcy5jb250ZXh0LCB7XHJcblx0XHRcdFx0XHRsb2FkOiBmdW5jdGlvbiBjb250ZXh0JGxvYWQob2JqLCBwcm9wTmFtZSwgaW5TY29wZSwgY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdFx0XHRcdFx0Ly8gb2JqZWN0cyBhcmUgYWxyZWFkeSBsb2FkaW5nIHNvIGp1c3QgcXVldWUgdXAgdGhlIGNhbGxzXHJcblx0XHRcdFx0XHRcdGFsbFNpZ25hbHMud2FpdEZvckFsbChmdW5jdGlvbiBjb250ZXh0JGxvYWQkY2FsbGJhY2soKSB7XHJcblx0XHRcdFx0XHRcdFx0TGF6eUxvYWRlci51bnJlZ2lzdGVyKG9iaiwgdGhpcyk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdGlmIChjYWxsYmFjayAmJiBjYWxsYmFjayBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcyk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9LCB0aGlzLCB0cnVlKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdFx0XHR9LFxyXG5cclxuXHRcdC8vIFBlcmZvcm0gcHJlLXByb2Nlc3Npbmcgb2YgbW9kZWwgcXVlcmllcyBhbmQgdGhlaXIgcGF0aHMuXHJcblx0XHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0XHRcdGZ1bmN0aW9uIENvbnRleHRRdWVyeSRpbml0TW9kZWxzKGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRcdFx0aWYgKHRoaXMub3B0aW9ucy5tb2RlbCkge1xyXG5cdFx0XHRcdFx0Ly8gU3RhcnQgY2FwdHVyaW5nIGNoYW5nZXMgcHJpb3IgdG8gcHJvY2Vzc2luZyBhbnkgbW9kZWwgcXVlcnlcclxuXHRcdFx0XHRcdHRoaXMuY29udGV4dC5zZXJ2ZXIuYmVnaW5DYXB0dXJpbmdDaGFuZ2VzKCk7XHJcblx0XHRcdFx0XHRFeG9XZWIuZWFjaFByb3AodGhpcy5vcHRpb25zLm1vZGVsLCBmdW5jdGlvbiAodmFyTmFtZSwgcXVlcnkpIHtcclxuXHRcdFx0XHRcdFx0Ly8gQXNzZXJ0IHRoYXQgdGhlIG5lY2Vzc2FyeSBwcm9wZXJ0aWVzIGFyZSBwcm92aWRlZFxyXG5cdFx0XHRcdFx0XHRpZiAoIXF1ZXJ5Lmhhc093blByb3BlcnR5KFwiZnJvbVwiKSB8fCAoIXF1ZXJ5Lmhhc093blByb3BlcnR5KFwiaWRcIikgJiYgIXF1ZXJ5Lmhhc093blByb3BlcnR5KFwiaWRzXCIpKSlcclxuXHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJUaGUgbW9kZWwgcXVlcnkgXFxcIlwiICsgdmFyTmFtZSArIFwiXFxcIiByZXF1aXJlcyBhIGZyb20gYW5kIGlkIG9yIGlkcyBjbGF1c2UuXCIpO1xyXG5cdFx0XHRcdFx0XHRpZiAocXVlcnkuaGFzT3duUHJvcGVydHkoXCJpZFwiKSAmJiBxdWVyeS5oYXNPd25Qcm9wZXJ0eShcImlkc1wiKSlcclxuXHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJUaGUgbW9kZWwgcXVlcnkgXFxcIlwiICsgdmFyTmFtZSArIFwiXFxcIiBtdXN0IHNwZWNpZnkgZWl0aGVyIGlkIG9yIGlkcywgbm90IGJvdGguXCIpO1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gY29tbW9uIGluaXRpYWwgc2V0dXAgb2Ygc3RhdGUgZm9yIGFsbCBtb2RlbCBxdWVyaWVzXHJcblx0XHRcdFx0XHRcdHRoaXMuc3RhdGVbdmFyTmFtZV0gPSB7IHNpZ25hbDogbmV3IEV4b1dlYi5TaWduYWwoXCJjcmVhdGVDb250ZXh0LlwiICsgdmFyTmFtZSksIGlzQXJyYXk6IGZhbHNlIH07XHJcblxyXG5cdFx0XHRcdFx0XHRpZiAodGhpcy5fcHJlZGljdGl2ZU1vZGVsUGVuZGluZykge1xyXG5cdFx0XHRcdFx0XHRcdGRlbGV0ZSB0aGlzLl9wcmVkaWN0aXZlTW9kZWxQZW5kaW5nO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdGFsbFNpZ25hbHMucGVuZGluZyhudWxsLCB0aGlzLCB0cnVlKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0Ly8gbm9ybWFsaXplIGlkKHMpIHByb3BlcnR5IGFuZCBkZXRlcm1pbmUgd2hldGhlciB0aGUgcmVzdWx0IHNob3VsZCBiZSBhbiBhcnJheVxyXG5cdFx0XHRcdFx0XHRpZiAocXVlcnkuaGFzT3duUHJvcGVydHkoXCJpZHNcIikgJiYgIShxdWVyeS5pZHMgaW5zdGFuY2VvZiBBcnJheSkpIHtcclxuXHRcdFx0XHRcdFx0XHRxdWVyeS5pZHMgPSBbcXVlcnkuaWRzXTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRlbHNlIGlmIChxdWVyeS5oYXNPd25Qcm9wZXJ0eShcImlkXCIpICYmICEocXVlcnkuaWQgaW5zdGFuY2VvZiBBcnJheSkpIHtcclxuXHRcdFx0XHRcdFx0XHRxdWVyeS5pZHMgPSBbcXVlcnkuaWRdO1xyXG5cdFx0XHRcdFx0XHRcdGRlbGV0ZSBxdWVyeS5pZDtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHQvLyB3ZSBrbm93IHRoYXQgZWl0aGVyIGlkIG9yIGlkcyBpcyBzcGVjaWZpZWQsIHNvIGlmIG5laXRoZXJcclxuXHRcdFx0XHRcdFx0XHQvLyBvbmUgaXMgTk9UIGFuIGFycmF5LCB0aGVuIHRoZSBxdWVyeSBtdXN0IGJlIGFuIGFycmF5XHJcblx0XHRcdFx0XHRcdFx0dGhpcy5zdGF0ZVt2YXJOYW1lXS5pc0FycmF5ID0gdHJ1ZTtcclxuXHJcblx0XHRcdFx0XHRcdFx0Ly8gcHJlLWluaXRpYWxpemUgYXJyYXkgcXVlcmllc1xyXG5cdFx0XHRcdFx0XHRcdHZhciBhcnIgPSBbXTtcclxuXHRcdFx0XHRcdFx0XHRPYnNlcnZlci5tYWtlT2JzZXJ2YWJsZShhcnIpO1xyXG5cdFx0XHRcdFx0XHRcdHRoaXMuY29udGV4dC5tb2RlbFt2YXJOYW1lXSA9IGFycjtcclxuXHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0Ly8gZ2V0IHJpZCBvZiBqdW5rIChudWxsL3VuZGVmaW5lZC9lbXB0eSkgaWRzXHJcblx0XHRcdFx0XHRcdHF1ZXJ5LmlkcyA9IGZpbHRlcihxdWVyeS5pZHMsIG5vdChpc051bGxPckVtcHR5KSk7XHJcblxyXG5cdFx0XHRcdFx0XHQvLyByZW1vdmUgbmV3IGlkcyBmb3IgbGF0ZXIgcHJvY2Vzc2luZ1xyXG5cdFx0XHRcdFx0XHRxdWVyeS5uZXdJZHMgPSBwdXJnZShxdWVyeS5pZHMsIGVxdWFscygkbmV3SWQoKSkpO1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gU3RvcmUgdGhlIHBhdGhzIGZvciBsYXRlciB1c2UgaW4gbGF6eSBsb2FkaW5nXHJcblx0XHRcdFx0XHRcdHF1ZXJ5Lm5vcm1hbGl6ZWQgPSBFeG9XZWIuTW9kZWwuUGF0aFRva2Vucy5ub3JtYWxpemVQYXRocyhxdWVyeS5pbmNsdWRlKTtcclxuXHRcdFx0XHRcdFx0T2JqZWN0TGF6eUxvYWRlci5hZGRQYXRocyhxdWVyeS5mcm9tLCBxdWVyeS5ub3JtYWxpemVkKTtcclxuXHJcblx0XHRcdFx0XHRcdC8vIHVzZSB0ZW1wb3JhcnkgY29uZmlnIHNldHRpbmcgdG8gZW5hYmxlL2Rpc2FibGUgc2NvcGUtb2Ytd29yayBmdW5jdGlvbmFsaXR5XHJcblx0XHRcdFx0XHRcdGlmIChxdWVyeS5pblNjb3BlICE9PSBmYWxzZSkge1xyXG5cdFx0XHRcdFx0XHRcdGlmIChxdWVyeS5pZHMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0dGhpcy5zdGF0ZVt2YXJOYW1lXS5zY29wZVF1ZXJ5ID0ge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRmcm9tOiBxdWVyeS5mcm9tLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRpZHM6IHF1ZXJ5LmlkcyxcclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gVE9ETzogdGhpcyB3aWxsIGJlIHN1YnNldCBvZiBwYXRocyBpbnRlcnByZXRlZCBhcyBzY29wZS1vZi13b3JrXHJcblx0XHRcdFx0XHRcdFx0XHRcdGluY2x1ZGU6IHF1ZXJ5LmluY2x1ZGUgPyBxdWVyeS5pbmNsdWRlIDogW10sXHJcblx0XHRcdFx0XHRcdFx0XHRcdGluU2NvcGU6IHRydWUsXHJcblx0XHRcdFx0XHRcdFx0XHRcdGZvckxvYWQ6IGZhbHNlXHJcblx0XHRcdFx0XHRcdFx0XHR9O1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBVbmRvIHByZWRpY3RpdmUgcGVuZGluZyBcImNhbGxiYWNrXCIgc2V0IHVwIGJlZm9yZSBtb2RlbHMgd2VyZSBwcm9jZXNzZWQuXHJcblx0XHRcdFx0aWYgKHRoaXMuX3ByZWRpY3RpdmVNb2RlbFBlbmRpbmcpIHtcclxuXHRcdFx0XHRcdGRlbGV0ZSB0aGlzLl9wcmVkaWN0aXZlTW9kZWxQZW5kaW5nO1xyXG5cdFx0XHRcdFx0YWxsU2lnbmFscy5vbmVEb25lKCk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcyk7XHJcblx0XHRcdH0sXHJcblxyXG5cdFx0Ly8gT25seSBmZXRjaCB0aGUgdHlwZXMgaWYgdGhleSBhcmUgbm90IGVtYmVkZGVkLiBJZiB0aGUgdHlwZXMgYXJlXHJcblx0XHQvLyBlbWJlZGRlZCB0aGVuIGZldGNoaW5nIHRoZSB0eXBlcyBmcm9tIHNlcnZlciB3aWxsIGNhdXNlIGEgc2lnbmFsIHRvXHJcblx0XHQvLyBiZSBjcmVhdGVkIHRoYXQgd2lsbCBuZXZlciBiZSBwcm9jZXNzZWQuXHJcblx0XHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0XHRcdGZ1bmN0aW9uIENvbnRleHRRdWVyeSRmZXRjaFR5cGVzKGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRcdFx0dmFyIHR5cGVzVG9Mb2FkID0gW10sIG1vZGVsID0gdGhpcy5jb250ZXh0Lm1vZGVsLm1ldGEsIGluc3RhbmNlcyA9IHRoaXMub3B0aW9ucy5pbnN0YW5jZXMsIHNpZ25hbCA9IG5ldyBFeG9XZWIuU2lnbmFsKFwiQ29udGV4dFF1ZXJ5JGZldGNoVHlwZXNcIik7XHJcblxyXG5cdFx0XHRcdC8vIEluY2x1ZGUgdHlwZXMgZm9yIGFsbCBpbnN0YW5jZXMgaW4gaW5zdGFuY2UgcGF5bG9hZFxyXG5cdFx0XHRcdGlmIChpbnN0YW5jZXMgJiYgKCF0aGlzLm9wdGlvbnMudHlwZXMgfHwgdGhpcy5vcHRpb25zLnR5cGVzIGluc3RhbmNlb2YgQXJyYXkpKSB7XHJcblx0XHRcdFx0XHRlYWNoUHJvcCh0aGlzLm9wdGlvbnMuaW5zdGFuY2VzLCBmdW5jdGlvbih0KSB7XHJcblx0XHRcdFx0XHRcdC8vIEFkZCB0aGUgdHlwZSBvZiB0aGUgaW5zdGFuY2VzLlxyXG5cdFx0XHRcdFx0XHR2YXIgbXR5cGUgPSBtb2RlbC50eXBlKHQpO1xyXG5cdFx0XHRcdFx0XHRpZiAoIW10eXBlIHx8IExhenlMb2FkZXIuaXNSZWdpc3RlcmVkKG10eXBlKSkge1xyXG5cdFx0XHRcdFx0XHRcdHR5cGVzVG9Mb2FkLnB1c2godCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gTG9hZCBhbGwgdHlwZXMgc3BlY2lmaWVkIGluIHR5cGVzIHBvcnRpb24gb2YgcXVlcnlcclxuXHRcdFx0XHRpZiAodGhpcy5vcHRpb25zLnR5cGVzICYmIHRoaXMub3B0aW9ucy50eXBlcyBpbnN0YW5jZW9mIEFycmF5KSB7XHJcblx0XHRcdFx0XHR0aGlzLm9wdGlvbnMudHlwZXNcclxuXHRcdFx0XHRcdFx0Lm1hcChmdW5jdGlvbih0KSB7XHJcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHQuZnJvbSB8fCB0O1xyXG5cdFx0XHRcdFx0XHR9KS5maWx0ZXIoZnVuY3Rpb24odCkge1xyXG5cdFx0XHRcdFx0XHRcdC8vIEV4Y2x1ZGUgdHlwZXMgdGhhdCBhcmUgYWxyZWFkeSBsb2FkZWRcclxuXHRcdFx0XHRcdFx0XHR2YXIgbXR5cGUgPSBtb2RlbC50eXBlKHQpO1xyXG5cdFx0XHRcdFx0XHRcdHJldHVybiAhbXR5cGUgfHwgTGF6eUxvYWRlci5pc1JlZ2lzdGVyZWQobXR5cGUpO1xyXG5cdFx0XHRcdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKHQpIHtcclxuXHRcdFx0XHRcdFx0XHRpZiAoIXR5cGVzVG9Mb2FkLmNvbnRhaW5zKHQpKSB7XHJcblx0XHRcdFx0XHRcdFx0XHR0eXBlc1RvTG9hZC5wdXNoKHQpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBGZXRjaCB0eXBlcyBpbiBhIHNpbmdsZSBiYXRjaCByZXF1ZXN0XHJcblx0XHRcdFx0aWYgKHR5cGVzVG9Mb2FkLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHRcdGZldGNoVHlwZXMobW9kZWwsIHR5cGVzVG9Mb2FkLCBzaWduYWwucGVuZGluZygpLCB0aGlzKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIEZldGNoIGFkZGl0aW9uYWwgdHlwZXMgYmFzZWQgb24gbW9kZWwgcXVlcmllcyBhbmQgcGF0aHNcclxuXHRcdFx0XHRpZiAodGhpcy5vcHRpb25zLm1vZGVsICYmICghdGhpcy5vcHRpb25zLnR5cGVzIHx8IHRoaXMub3B0aW9ucy50eXBlcyBpbnN0YW5jZW9mIEFycmF5KSkge1xyXG5cdFx0XHRcdFx0RXhvV2ViLmVhY2hQcm9wKHRoaXMub3B0aW9ucy5tb2RlbCwgZnVuY3Rpb24gKHZhck5hbWUsIHF1ZXJ5KSB7XHJcblx0XHRcdFx0XHRcdGZldGNoUXVlcnlUeXBlcyh0aGlzLmNvbnRleHQubW9kZWwubWV0YSwgcXVlcnkuZnJvbSwgcXVlcnkubm9ybWFsaXplZCwgc2lnbmFsLnBlbmRpbmcoKSk7XHJcblx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHNpZ25hbC53YWl0Rm9yQWxsKGNhbGxiYWNrLCB0aGlzUHRyKTtcclxuXHRcdFx0fSxcclxuXHJcblx0XHQvLyBQcm9jZXNzIGVtYmVkZGVkIGRhdGEgYXMgaWYgaXQgaGFkIGJlZW4gcmVjaWV2ZWQgZnJvbSB0aGUgc2VydmVyIGluXHJcblx0XHQvLyB0aGUgZm9ybSBvZiBhIHdlYiBzZXJ2aWNlIHJlc3BvbnNlLiBUaGlzIHNob3VsZCBlbmFibGUgZmxpY2tlci1mcmVlXHJcblx0XHQvLyBwYWdlIGxvYWRzIGJ5IGVtYmVkZGVkIGRhdGEsIGNoYW5nZXMsIGV0Yy5cclxuXHRcdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHRcdFx0ZnVuY3Rpb24gQ29udGV4dFF1ZXJ5JHByb2Nlc3NFbWJlZGRlZChjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0XHRcdGlmICh0aGlzLm9wdGlvbnMuaW5zdGFuY2VzIHx8IHRoaXMub3B0aW9ucy5jb25kaXRpb25zIHx8ICh0aGlzLm9wdGlvbnMudHlwZXMgJiYgISh0aGlzLm9wdGlvbnMudHlwZXMgaW5zdGFuY2VvZiBBcnJheSkpKSB7XHJcblx0XHRcdFx0XHR2YXIgaGFuZGxlciA9IG5ldyBSZXNwb25zZUhhbmRsZXIodGhpcy5jb250ZXh0Lm1vZGVsLm1ldGEsIHRoaXMuY29udGV4dC5zZXJ2ZXIsIHtcclxuXHRcdFx0XHRcdFx0aW5zdGFuY2VzOiB0aGlzLm9wdGlvbnMuaW5zdGFuY2VzLFxyXG5cdFx0XHRcdFx0XHRjb25kaXRpb25zOiB0aGlzLm9wdGlvbnMuY29uZGl0aW9ucyxcclxuXHRcdFx0XHRcdFx0dHlwZXM6IHRoaXMub3B0aW9ucy50eXBlcyAmJiB0aGlzLm9wdGlvbnMudHlwZXMgaW5zdGFuY2VvZiBBcnJheSA/IG51bGwgOiB0aGlzLm9wdGlvbnMudHlwZXMsXHJcblx0XHRcdFx0XHRcdHNlcnZlckluZm86IHRoaXMub3B0aW9ucy5zZXJ2ZXJJbmZvXHJcblx0XHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdFx0XHRoYW5kbGVyLmV4ZWN1dGUoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0XHQvLyBVcGRhdGUgJ2lzTmV3JyBmb3Igb2JqZWN0cyB0aGF0IHNob3cgdXAgaW4gSW5pdE5ldyBjaGFuZ2VzLlxyXG5cdFx0XHRcdFx0XHRpZiAodGhpcy5vcHRpb25zLmNoYW5nZXMpIHtcclxuXHRcdFx0XHRcdFx0XHR0aGlzLm9wdGlvbnMuY2hhbmdlcy5mb3JFYWNoKGZ1bmN0aW9uIChjaGFuZ2UpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGlmIChjaGFuZ2UudHlwZSA9PT0gXCJJbml0TmV3XCIpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dHJ5R2V0SnNUeXBlKHRoaXMuY29udGV4dC5zZXJ2ZXIubW9kZWwsIGNoYW5nZS5pbnN0YW5jZS50eXBlLCBudWxsLCBmYWxzZSwgZnVuY3Rpb24gKGpzdHlwZSkge1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBBdHRlbXB0IHRvIGZpbmQgdGhlIEluaXROZXcgaW5zdGFuY2UgaWYgaXQgd2FzIHByZXNlbnQgaW4gdGhlIGluc3RhbmNlcyBKU09OLlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBvYmogPSBqc3R5cGUubWV0YS5nZXQoXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBPayB0byBmZXRjaCB0aGUgaW5zdGFuY2UgYnkgdGhlIHNlcnZlci1nZW5lcmF0ZWQgaWQ/XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRjaGFuZ2UuaW5zdGFuY2UuaWQsXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBXaGVuIHByb2Nlc3NpbmcgZW1iZWRkZWQgY2hhbmdlcyB3ZSBjYW4gZXhwZWN0IHRoYXQgdGhlIHR5cGUgb2YgdGhlIGluc3RhbmNlXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBpcyBleGFjdGx5IHRoZSB0eXBlIHNwZWNpZmllZCBpbiB0aGUgY2hhbmdlIG9iamVjdCwgbm90IGEgYmFzZSB0eXBlLlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dHJ1ZVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdCk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8vIElmIGl0IGV4aXN0cywgdGhlbiBpdCB3b3VsZCBoYXZlIGJlZW4gY3JlYXRlZCBhcyBhbiBleGlzdGluZyBvYmplY3QsIHNvIG1hcmsgaXQgYXMgbmV3LlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChvYmopIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdG9iai5tZXRhLmlzTmV3ID0gdHJ1ZTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdFx0XHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSxcclxuXHJcblx0XHQvLyBEZXRlY3QgYmF0Y2ggcXVlcnkgY2FuZGlkYXRlcyBhbmQgc2VuZCBiYXRjaCByZXF1ZXN0LCBpZiBiYXRjaGluZyBpc1xyXG5cdFx0Ly8gZW5hYmxlZCAodHJ1ZSBieSBkZWZhdWx0KS5cclxuXHRcdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHRcdFx0ZnVuY3Rpb24gQ29udGV4dFF1ZXJ5JGRvQmF0Y2hSZXF1ZXN0KGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRcdFx0aWYgKHRoaXMub3B0aW9ucy5tb2RlbCAmJiBFeG9XZWIuY29uZmlnLmluZGl2aWR1YWxRdWVyeUxvYWRpbmcgIT09IHRydWUpIHtcclxuXHRcdFx0XHRcdHZhciBwZW5kaW5nUXVlcmllcyA9IFtdO1xyXG5cdFx0XHRcdFx0dmFyIGJhdGNoUXVlcnlTaWduYWw7XHJcblxyXG5cdFx0XHRcdFx0RXhvV2ViLmVhY2hQcm9wKHRoaXMub3B0aW9ucy5tb2RlbCwgZnVuY3Rpb24gKHZhck5hbWUsIHF1ZXJ5KSB7XHJcblx0XHRcdFx0XHRcdGlmICghcXVlcnkubG9hZCAmJiBxdWVyeS5pZHMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdFx0XHRcdHZhciBqc3R5cGUgPSBFeG9XZWIuTW9kZWwuTW9kZWwuZ2V0SnNUeXBlKHF1ZXJ5LmZyb20sIHRydWUpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHQvLyBnZXQgYSBsaXN0IG9mIGlkcyB0aGF0IHNob3VsZCBiZSBiYXRjaC1yZXF1ZXN0ZWRcclxuXHRcdFx0XHRcdFx0XHR2YXIgYmF0Y2hJZHMgPSBmaWx0ZXIocXVlcnkuaWRzLCBmdW5jdGlvbiAoaWQsIGluZGV4KSB7XHJcblx0XHRcdFx0XHRcdFx0XHQvLyBpZiB0aGUgdHlwZSBkb2Vzbid0IGV4aXN0LCBpbmNsdWRlIHRoZSBpZCBpbiB0aGUgYmF0Y2ggcXVlcnlcclxuXHRcdFx0XHRcdFx0XHRcdGlmICghanN0eXBlKSByZXR1cm4gdHJ1ZTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHQvLyBDaGVjayB0byBzZWUgaWYgdGhlIG9iamVjdCBhbHJlYWR5IGV4aXN0cywgaS5lLiBiZWNhdXNlIG9mIGVtYmVkZGluZy5cclxuXHRcdFx0XHRcdFx0XHRcdHZhciBvYmogPSBqc3R5cGUubWV0YS5nZXQoXHJcblx0XHRcdFx0XHRcdFx0XHRcdC8vIFRyYW5zbGF0ZSB0aGUgc3BlY2lmaWVkIElELCB3aGljaCBtYXkgYmUgYSBzZXJ2ZXItZ2VuZXJhdGVkIG5ldyBpZCxcclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gaW50byB0aGUgYXBwcm9wcmlhdGUgY2xpZW50LWdlbmVyYXRlZCBpZC5cclxuXHRcdFx0XHRcdFx0XHRcdFx0dHJhbnNsYXRlSWQodGhpcy5jb250ZXh0LnNlcnZlci5fdHJhbnNsYXRvciwgcXVlcnkuZnJvbSwgaWQpLFxyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gVGhlIHR5cGUgc3BlY2lmaWVkIGluIGEgcXVlcnkgbWF5IGJlIGEgc3ViLWNsYXNzIG9mIHRoZSBhY3R1YWwgdHlwZSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gc2luY2UgaXQgbWF5IGJlIHdyaXR0ZW4gYnkgaGFuZCBhbmQgbm90IGtub3duIGFoZWFkIG9mIHRpbWUuXHJcblx0XHRcdFx0XHRcdFx0XHRcdGZhbHNlXHJcblx0XHRcdFx0XHRcdFx0XHQpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdC8vIElmIGl0IGRvZXNuJ3QgZXhpc3QsIGluY2x1ZGUgdGhlIGlkIGluIHRoZSBiYXRjaCBxdWVyeS5cclxuXHRcdFx0XHRcdFx0XHRcdGlmIChvYmogPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0XHQvLyBvdGhlcndpc2UsIGluY2x1ZGUgaXQgaW4gdGhlIG1vZGVsXHJcblx0XHRcdFx0XHRcdFx0XHRpZiAodGhpcy5zdGF0ZVt2YXJOYW1lXS5pc0FycmF5KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHRoaXMuY29udGV4dC5tb2RlbFt2YXJOYW1lXVtpbmRleF0gPSBvYmo7XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dGhpcy5jb250ZXh0Lm1vZGVsW3Zhck5hbWVdID0gb2JqO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH0sIHRoaXMpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRpZiAoYmF0Y2hJZHMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKGJhdGNoUXVlcnlTaWduYWwgPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRiYXRjaFF1ZXJ5U2lnbmFsID0gbmV3IEV4b1dlYi5TaWduYWwoXCJiYXRjaCBxdWVyeVwiKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0YmF0Y2hRdWVyeVNpZ25hbC5wZW5kaW5nKG51bGwsIHRoaXMsIHRydWUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0XHRcdC8vIGNvbXBsZXRlIHRoZSBpbmRpdmlkdWFsIHF1ZXJ5IHNpZ25hbCBhZnRlciB0aGUgYmF0Y2ggaXMgY29tcGxldGVcclxuXHRcdFx0XHRcdFx0XHRcdGJhdGNoUXVlcnlTaWduYWwud2FpdEZvckFsbCh0aGlzLnN0YXRlW3Zhck5hbWVdLnNpZ25hbC5wZW5kaW5nKG51bGwsIHRoaXMsIHRydWUpLCB0aGlzLCB0cnVlKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRwZW5kaW5nUXVlcmllcy5wdXNoKHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0ZnJvbTogcXVlcnkuZnJvbSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0aWRzOiBiYXRjaElkcyxcclxuXHRcdFx0XHRcdFx0XHRcdFx0aW5jbHVkZTogcXVlcnkuaW5jbHVkZSB8fCBbXSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0aW5TY29wZTogdHJ1ZSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0Zm9yTG9hZDogdHJ1ZVxyXG5cdFx0XHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHJcblx0XHRcdFx0XHRpZiAocGVuZGluZ1F1ZXJpZXMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdFx0XHQvLyBwZXJmb3JtIGJhdGNoIHF1ZXJ5XHJcblx0XHRcdFx0XHRcdHF1ZXJ5UHJvdmlkZXIocGVuZGluZ1F1ZXJpZXMsIG51bGwsXHJcblx0XHRcdFx0XHRcdFx0ZnVuY3Rpb24gY29udGV4dCRvYmplY3RzJGNhbGxiYWNrKHJlc3VsdCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0b2JqZWN0c0Zyb21Kc29uKHRoaXMuY29udGV4dC5tb2RlbC5tZXRhLCByZXN1bHQuaW5zdGFuY2VzLCBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmIChyZXN1bHQuY29uZGl0aW9ucykge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGNvbmRpdGlvbnNGcm9tSnNvbih0aGlzLmNvbnRleHQubW9kZWwubWV0YSwgcmVzdWx0LmNvbmRpdGlvbnMsIG51bGwsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGJhdGNoUXVlcnlTaWduYWwub25lRG9uZSgpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGJhdGNoUXVlcnlTaWduYWwub25lRG9uZSgpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0XHR9LFxyXG5cdFx0XHRcdFx0XHRcdGZ1bmN0aW9uIGNvbnRleHQkb2JqZWN0cyRjYWxsYmFjayhlcnJvcikge1xyXG5cdFx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCRmb3JtYXQoXCJGYWlsZWQgdG8gbG9hZCBiYXRjaCBxdWVyeSAoSFRUUDogezB9LCBUaW1lb3V0OiB7MX0pXCIsIGVycm9yLl9zdGF0dXNDb2RlLCBlcnJvci5fdGltZWRPdXQpKTtcclxuXHRcdFx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzKTtcclxuXHRcdFx0fSxcclxuXHJcblx0XHQvLyBTZW5kIGluZGl2aWR1YWwgcmVxdWVzdHMgYW5kIHNpbXVsYXRlIGZvciBcImxvYWRcIiBvcHRpb24uXHJcblx0XHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0XHRcdGZ1bmN0aW9uIENvbnRleHRRdWVyeSRkb0luZGl2aWR1YWxSZXF1ZXN0cyhjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0XHRcdGlmICh0aGlzLm9wdGlvbnMubW9kZWwpIHtcclxuXHRcdFx0XHRcdC8vIDIpIFN0YXJ0IGxvYWRpbmcgaW5zdGFuY2VzIGluZGl2aWR1YWxseVxyXG5cdFx0XHRcdFx0RXhvV2ViLmVhY2hQcm9wKHRoaXMub3B0aW9ucy5tb2RlbCwgZnVuY3Rpb24gKHZhck5hbWUsIHF1ZXJ5KSB7XHJcblx0XHRcdFx0XHRcdGlmIChxdWVyeS5sb2FkKSB7XHJcblx0XHRcdFx0XHRcdFx0Ly8gYnlwYXNzIGFsbCBzZXJ2ZXIgY2FsbGJhY2tzIGlmIGRhdGEgaXMgZW1iZWRkZWRcclxuXHRcdFx0XHRcdFx0XHR0aGlzLnN0YXRlW3Zhck5hbWVdLm9iamVjdEpzb24gPSBxdWVyeS5sb2FkLmluc3RhbmNlcztcclxuXHRcdFx0XHRcdFx0XHR0aGlzLnN0YXRlW3Zhck5hbWVdLmNvbmRpdGlvbnNKc29uID0gcXVlcnkubG9hZC5jb25kaXRpb25zO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdC8vIG5lZWQgdG8gbG9hZCBkYXRhIGZyb20gc2VydmVyXHJcblx0XHRcdFx0XHRcdC8vIGZldGNoIG9iamVjdCBzdGF0ZSBpZiBhbiBpZCBvZiBhIHBlcnNpc3RlZCBvYmplY3Qgd2FzIHNwZWNpZmllZFxyXG5cdFx0XHRcdFx0XHRlbHNlIGlmIChFeG9XZWIuY29uZmlnLmluZGl2aWR1YWxRdWVyeUxvYWRpbmcgPT09IHRydWUpIHtcclxuXHRcdFx0XHRcdFx0XHR0cnlHZXRKc1R5cGUodGhpcy5jb250ZXh0Lm1vZGVsLm1ldGEsIHF1ZXJ5LmZyb20sIG51bGwsIHRydWUsIGZ1bmN0aW9uICh0eXBlKSB7XHJcblx0XHRcdFx0XHRcdFx0XHQvLyBUT0RPOiBlbGltaW5hdGUgZHVwbGljYXRpb24hISFcclxuXHRcdFx0XHRcdFx0XHRcdC8vIGdldCB0aGUgbGlzdCBvZiBpZHMgdGhhdCBzaG91bGQgYmUgaW5kaXZpZHVhbGx5IGxvYWRlZFxyXG5cdFx0XHRcdFx0XHRcdFx0dmFyIGluZGl2aWR1YWxJZHMgPSBmaWx0ZXIocXVlcnkuaWRzLCBmdW5jdGlvbiAoaWQsIGluZGV4KSB7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHQvLyBDaGVjayB0byBzZWUgaWYgdGhlIG9iamVjdCBhbHJlYWR5IGV4aXN0cywgaS5lLiBiZWNhdXNlIG9mIGVtYmVkZGluZy5cclxuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIG9iaiA9IHR5cGUubWV0YS5nZXQoXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Ly8gVHJhbnNsYXRlIHRoZSBzcGVjaWZpZWQgSUQsIHdoaWNoIG1heSBiZSBhIHNlcnZlci1nZW5lcmF0ZWQgbmV3IGlkLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8vIGludG8gdGhlIGFwcHJvcHJpYXRlIGNsaWVudC1nZW5lcmF0ZWQgaWQuXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0dHJhbnNsYXRlSWQodGhpcy5jb250ZXh0LnNlcnZlci5fdHJhbnNsYXRvciwgcXVlcnkuZnJvbSwgaWQpLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBUaGUgdHlwZSBzcGVjaWZpZWQgaW4gYSBxdWVyeSBtYXkgYmUgYSBzdWItY2xhc3Mgb2YgdGhlIGFjdHVhbCB0eXBlLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8vIHNpbmNlIGl0IG1heSBiZSB3cml0dGVuIGJ5IGhhbmQgYW5kIG5vdCBrbm93biBhaGVhZCBvZiB0aW1lLlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGZhbHNlXHJcblx0XHRcdFx0XHRcdFx0XHRcdCk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHQvLyBJZiBpdCBkb2Vzbid0IGV4aXN0LCBpbmNsdWRlIHRoZSBpZCBpbiB0aGUgYmF0Y2ggcXVlcnkuXHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmIChvYmogPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHQvLyBvdGhlcndpc2UsIGluY2x1ZGUgaXQgaW4gdGhlIG1vZGVsXHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmICh0aGlzLnN0YXRlW3Zhck5hbWVdLmlzQXJyYXkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR0aGlzLmNvbnRleHQubW9kZWxbdmFyTmFtZV1baW5kZXhdID0gb2JqO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHRoaXMuY29udGV4dC5tb2RlbFt2YXJOYW1lXSA9IG9iajtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0fSwgdGhpcyk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKGluZGl2aWR1YWxJZHMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHQvLyBmb3IgaW5kaXZpZHVhbCBxdWVyaWVzLCBpbmNsdWRlIHNjb3BlIHF1ZXJpZXMgZm9yIGFsbCAqQlVUKiB0aGUgcXVlcnkgd2UgYXJlIHNlbmRpbmdcclxuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIHNjb3BlUXVlcmllcyA9IFtdO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR2YXIgY3VycmVudFZhck5hbWUgPSB2YXJOYW1lO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRFeG9XZWIuZWFjaFByb3AodGhpcy5vcHRpb25zLm1vZGVsLCBmdW5jdGlvbiAodmFyTmFtZSwgcXVlcnkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAodmFyTmFtZSAhPT0gY3VycmVudFZhck5hbWUgJiYgdGhpcy5zdGF0ZVt2YXJOYW1lXS5zY29wZVF1ZXJ5KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzY29wZVF1ZXJpZXMucHVzaCh0aGlzLnN0YXRlW3Zhck5hbWVdLnNjb3BlUXVlcnkpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0fSwgdGhpcyk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHRvYmplY3RQcm92aWRlcihxdWVyeS5mcm9tLCBpbmRpdmlkdWFsSWRzLCBxdWVyeS5pbmNsdWRlIHx8IFtdLCB0cnVlLCBudWxsLCBzY29wZVF1ZXJpZXMsXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0dGhpcy5zdGF0ZVt2YXJOYW1lXS5zaWduYWwucGVuZGluZyhmdW5jdGlvbiBjb250ZXh0JG9iamVjdHMkY2FsbGJhY2socmVzdWx0KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR0aGlzLnN0YXRlW3Zhck5hbWVdLm9iamVjdEpzb24gPSByZXN1bHQuaW5zdGFuY2VzO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dGhpcy5zdGF0ZVt2YXJOYW1lXS5jb25kaXRpb25zSnNvbiA9IHJlc3VsdC5jb25kaXRpb25zO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0sIHRoaXMsIHRydWUpLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHRoaXMuc3RhdGVbdmFyTmFtZV0uc2lnbmFsLm9yUGVuZGluZyhmdW5jdGlvbiBjb250ZXh0JG9iamVjdHMkY2FsbGJhY2soZXJyb3IpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcigkZm9ybWF0KFwiRmFpbGVkIHRvIGxvYWQgezB9fHsxfSAoSFRUUDogezN9LCBUaW1lb3V0OiB7NH0pXCIsXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHF1ZXJ5LmZyb20sIHF1ZXJ5LmlkcywgZXJyb3IuX3N0YXR1c0NvZGUsIGVycm9yLl90aW1lZE91dCkpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0sIHRoaXMsIHRydWUpLCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcyk7XHJcblx0XHRcdH0sXHJcblxyXG5cdFx0Ly8gTG9hZCBzdGF0aWMgcGF0aHMgZm9yIHF1ZXJpZXMgdGhhdCBkb24ndCBvdGhlcndpc2UgcmVxdWlyZSBsb2FkaW5nLlxyXG5cdFx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cdFx0XHRmdW5jdGlvbiBDb250ZXh0UXVlcnkkZG9TdGF0aWNSZXF1ZXN0cyhjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0XHRcdGlmICh0aGlzLm9wdGlvbnMubW9kZWwpIHtcclxuXHRcdFx0XHRcdEV4b1dlYi5lYWNoUHJvcCh0aGlzLm9wdGlvbnMubW9kZWwsIGZ1bmN0aW9uICh2YXJOYW1lLCBxdWVyeSkge1xyXG5cdFx0XHRcdFx0XHRpZiAoIXF1ZXJ5LmxvYWQgJiYgcXVlcnkuaWRzLmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0XHRcdFx0XHRcdC8vIFJlbW92ZSBpbnN0YW5jZSBwYXRocyB3aGVuIGFuIGlkIGlzIG5vdCBzcGVjaWZpZWRcclxuXHRcdFx0XHRcdFx0XHR2YXIgc3RhdGljUGF0aHMgPSBxdWVyeS5pbmNsdWRlID8gcXVlcnkuaW5jbHVkZS5maWx0ZXIoZnVuY3Rpb24gKHApIHsgcmV0dXJuICFwLnN0YXJ0c1dpdGgoXCJ0aGlzLlwiKSAmJiAhcC5zdGFydHNXaXRoKFwidGhpc3tcIik7IH0pIDogbnVsbDtcclxuXHJcblx0XHRcdFx0XHRcdFx0Ly8gT25seSBjYWxsIHRoZSBzZXJ2ZXIgaWYgcGF0aHMgd2VyZSBzcGVjaWZpZWRcclxuXHRcdFx0XHRcdFx0XHRpZiAoc3RhdGljUGF0aHMgJiYgc3RhdGljUGF0aHMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0b2JqZWN0UHJvdmlkZXIobnVsbCwgbnVsbCwgc3RhdGljUGF0aHMsIGZhbHNlLCBudWxsLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRhbGxTaWduYWxzLnBlbmRpbmcoZnVuY3Rpb24gY29udGV4dCRvYmplY3RzJGNhbGxiYWNrKHJlc3VsdCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8vIGxvYWQgdGhlIGpzb24uIHRoaXMgbWF5IGhhcHBlbiBhc3luY2hyb25vdXNseSB0byBpbmNyZW1lbnQgdGhlIHNpZ25hbCBqdXN0IGluIGNhc2VcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRvYmplY3RzRnJvbUpzb24odGhpcy5jb250ZXh0Lm1vZGVsLm1ldGEsIHJlc3VsdC5pbnN0YW5jZXMsIGFsbFNpZ25hbHMucGVuZGluZyhmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAocmVzdWx0LmNvbmRpdGlvbnMpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Y29uZGl0aW9uc0Zyb21Kc29uKHRoaXMuY29udGV4dC5tb2RlbC5tZXRhLCByZXN1bHQuY29uZGl0aW9ucywgbnVsbCwgYWxsU2lnbmFscy5wZW5kaW5nKCkpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pLCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fSwgdGhpcywgdHJ1ZSksXHJcblx0XHRcdFx0XHRcdFx0XHRcdGFsbFNpZ25hbHMub3JQZW5kaW5nKGZ1bmN0aW9uIGNvbnRleHQkb2JqZWN0cyRjYWxsYmFjayhlcnJvcikge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcigkZm9ybWF0KFwiRmFpbGVkIHRvIGxvYWQgezB9fHsxfSAoSFRUUDogezJ9LCBUaW1lb3V0OiB7M30pXCIsXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRxdWVyeS5mcm9tLCBxdWVyeS5pZHMsIGVycm9yLl9zdGF0dXNDb2RlLCBlcnJvci5fdGltZWRPdXQpKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fSwgdGhpcywgdHJ1ZSlcclxuXHRcdFx0XHRcdFx0XHRcdCk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzKTtcclxuXHRcdFx0fSxcclxuXHJcblx0XHQvLyBQcm9jZXNzIGluc3RhbmNlcyBkYXRhIGZvciBxdWVyaWVzIGFzIHRoZXkgZmluaXNoIGxvYWRpbmcuXHJcblx0XHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0XHRcdGZ1bmN0aW9uIENvbnRleHRRdWVyeSRwcm9jZXNzUmVzdWx0cyhjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0XHRcdGlmICh0aGlzLm9wdGlvbnMubW9kZWwpIHtcclxuXHRcdFx0XHRcdEV4b1dlYi5lYWNoUHJvcCh0aGlzLm9wdGlvbnMubW9kZWwsIGZ1bmN0aW9uICh2YXJOYW1lLCBxdWVyeSkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLnN0YXRlW3Zhck5hbWVdLnNpZ25hbC53YWl0Rm9yQWxsKGZ1bmN0aW9uIGNvbnRleHQkbW9kZWwoKSB7XHJcblx0XHRcdFx0XHRcdFx0Ly8gbWFrZSBzdXJlIGV2ZXJ5dGhpbmcgaXNuJ3QgY29uc2lkZXJlZCBjb21wbGV0ZSB1bnRpbCBuZXcgb2JqZWN0cyBhcmUgYWxzbyBjcmVhdGVkXHJcblx0XHRcdFx0XHRcdFx0aWYgKHF1ZXJ5Lm5ld0lkcykgYWxsU2lnbmFscy5wZW5kaW5nKCk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdC8vIGNoZWNrIHRvIHNlZSBpZiB0aGUgcm9vdChzKSBoYXZlIGFscmVhZHkgYmVlbiBlc3RhYmxpc2hlZFxyXG5cdFx0XHRcdFx0XHRcdGlmICgoIXRoaXMuc3RhdGVbdmFyTmFtZV0uaXNBcnJheSAmJiB0aGlzLmNvbnRleHQubW9kZWxbdmFyTmFtZV0pIHx8XHJcblx0XHRcdFx0XHRcdFx0XHQodGhpcy5zdGF0ZVt2YXJOYW1lXS5pc0FycmF5ICYmICFxdWVyeS5pZHMuc29tZShmdW5jdGlvbiAoaWQsIGluZGV4KSB7IHJldHVybiAhdGhpcy5jb250ZXh0Lm1vZGVsW3Zhck5hbWVdW2luZGV4XTsgfSkpKSB7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0YWxsU2lnbmFscy5vbmVEb25lKCk7XHJcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdC8vIG90aGVyd2lzZSwgbG9hZGluZyBpcyByZXF1aXJlZCB0byBlc3RhYmxpc2ggcm9vdHMgaWYgdGhlcmUgYXJlIGFueSBzZXJ2ZXIgaWRzXHJcblx0XHRcdFx0XHRcdFx0ZWxzZSBpZiAocXVlcnkuaWRzLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHRcdFx0XHRcdHZhciBwcm9jZXNzUmVzcG9uc2UgPSBuZXcgU2lnbmFsKFwicHJvY2Vzc2luZyByZXNwb25zZVwiKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRpZiAodGhpcy5zdGF0ZVt2YXJOYW1lXS5vYmplY3RKc29uKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdC8vIGxvYWQgdGhlIGpzb24uIHRoaXMgbWF5IGhhcHBlbiBhc3luY2hyb25vdXNseSBzbyBpbmNyZW1lbnQgdGhlIHNpZ25hbCBqdXN0IGluIGNhc2VcclxuXHRcdFx0XHRcdFx0XHRcdFx0b2JqZWN0c0Zyb21Kc29uKHRoaXMuY29udGV4dC5tb2RlbC5tZXRhLCB0aGlzLnN0YXRlW3Zhck5hbWVdLm9iamVjdEpzb24sIHByb2Nlc3NSZXNwb25zZS5wZW5kaW5nKG51bGwsIHRoaXMpLCB0aGlzLCB0cnVlKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdC8vIGluZGljYXRlIHRoYXQgaW5zdGFuY2UgZGF0YSBpcyBhbHJlYWR5IGJlaW5nIGxvYWRlZFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRkZWxldGUgdGhpcy5zdGF0ZVt2YXJOYW1lXS5vYmplY3RKc29uO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0XHRcdHByb2Nlc3NSZXNwb25zZS53YWl0Rm9yQWxsKHRoaXMuc3RhdGVbdmFyTmFtZV0uc2lnbmFsLnBlbmRpbmcoZnVuY3Rpb24gY29udGV4dCRtb2RlbCRjYWxsYmFjaygpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIG10eXBlID0gdGhpcy5jb250ZXh0Lm1vZGVsLm1ldGEudHlwZShxdWVyeS5mcm9tKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmICghbXR5cGUpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJGZvcm1hdChcIkNvdWxkIG5vdCBnZXQgdHlwZSB7MH0gcmVxdWlyZWQgdG8gcHJvY2VzcyBxdWVyeSByZXN1bHRzLlwiLCBxdWVyeS5mcm9tKSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdC8vIGVzdGFibGlzaCByb290cyBmb3IgZWFjaCBpZFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRmb3JFYWNoKHF1ZXJ5LmlkcywgZnVuY3Rpb24gKGlkLCBpbmRleCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8vIFRPRE86IHJlc29sdmUgdHJhbnNsYXRvciBhY2Nlc3NcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgY2xpZW50SWQgPSB0cmFuc2xhdGVJZCh0aGlzLmNvbnRleHQuc2VydmVyLl90cmFuc2xhdG9yLCBxdWVyeS5mcm9tLCBpZCk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8vIFJldHJpZXZlIHRoZSBleGlzdGluZyBpbnN0YW5jZSBieSBpZC5cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgb2JqID0gbXR5cGUuZ2V0KFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Ly8gVHJhbnNsYXRlIHRoZSBzcGVjaWZpZWQgSUQsIHdoaWNoIG1heSBiZSBhIHNlcnZlci1nZW5lcmF0ZWQgbmV3IGlkLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Ly8gaW50byB0aGUgYXBwcm9wcmlhdGUgY2xpZW50LWdlbmVyYXRlZCBpZC5cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGNsaWVudElkLFxyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8vIFRoZSB0eXBlIHNwZWNpZmllZCBpbiBhIHF1ZXJ5IG1heSBiZSBhIHN1Yi1jbGFzcyBvZiB0aGUgYWN0dWFsIHR5cGUsXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBzaW5jZSBpdCBtYXkgYmUgd3JpdHRlbiBieSBoYW5kIGFuZCBub3Qga25vd24gYWhlYWQgb2YgdGltZS5cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGZhbHNlXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0KTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Ly8gSWYgaXQgZG9lc24ndCBleGlzdCwgcmFpc2UgYW4gZXJyb3IuXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKG9iaiA9PSBudWxsKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3QgZ2V0IFwiICsgcXVlcnkuZnJvbSArIFwiIHdpdGggaWQgPSBcIiArIGNsaWVudElkICsgKGlkICE9PSBjbGllbnRJZCA/IFwiKFwiICsgaWQgKyBcIilcIiA6IFwiXCIpICsgXCIuXCIpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Ly8gT3RoZXJ3aXNlLCBpbmNsdWRlIGl0IGluIHRoZSBtb2RlbC5cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoIXRoaXMuc3RhdGVbdmFyTmFtZV0uaXNBcnJheSAmJiAhdGhpcy5jb250ZXh0Lm1vZGVsW3Zhck5hbWVdKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR0aGlzLmNvbnRleHQubW9kZWxbdmFyTmFtZV0gPSBvYmo7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGVsc2UgaWYgKHRoaXMuc3RhdGVbdmFyTmFtZV0uaXNBcnJheSAmJiAhdGhpcy5jb250ZXh0Lm1vZGVsW3Zhck5hbWVdW2luZGV4XSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dGhpcy5jb250ZXh0Lm1vZGVsW3Zhck5hbWVdW2luZGV4XSA9IG9iajtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRcdH0sIHRoaXMpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKHRoaXMuc3RhdGVbdmFyTmFtZV0uY29uZGl0aW9uc0pzb24pIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRjb25kaXRpb25zRnJvbUpzb24odGhpcy5jb250ZXh0Lm1vZGVsLm1ldGEsIHRoaXMuc3RhdGVbdmFyTmFtZV0uY29uZGl0aW9uc0pzb24sIG51bGwsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8vIG1vZGVsIG9iamVjdCBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgbG9hZGVkIVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0YWxsU2lnbmFscy5vbmVEb25lKCk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Ly8gbW9kZWwgb2JqZWN0IGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBsb2FkZWQhXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0YWxsU2lnbmFscy5vbmVEb25lKCk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdH0sIHRoaXMpLCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0XHQvLyBtb2RlbCBvYmplY3QgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGxvYWRlZCFcclxuXHRcdFx0XHRcdFx0XHRcdGFsbFNpZ25hbHMub25lRG9uZSgpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0aWYgKHRoaXMuc3RhdGVbdmFyTmFtZV0ub2JqZWN0SnNvbikge1xyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gZW5zdXJlIHRoYXQgaW5zdGFuY2UgZGF0YSBpcyBsb2FkZWQgKGV2ZW4gaWYgbm90IG5lZWRlZCB0byBlc3RhYmxpc2ggcm9vdHMpIGp1c3QgaW4gY2FzZVxyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gcm9vdCBvYmplY3Qgd2FzIHNhdGlzZmllZCBiZWNhdXNlIGl0IGhhcHBlbmVkIHRvIGJlIGEgcGFydCBvZiB0aGUgbW9kZWwgb2YgYW5vdGhlciByb290IG9iamVjdFxyXG5cdFx0XHRcdFx0XHRcdFx0b2JqZWN0c0Zyb21Kc29uKHRoaXMuY29udGV4dC5tb2RlbC5tZXRhLCB0aGlzLnN0YXRlW3Zhck5hbWVdLm9iamVjdEpzb24sIGFsbFNpZ25hbHMucGVuZGluZygpKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRcdC8vIGNvbnN0cnVjdCBhIG5ldyBvYmplY3QocykgaWYgYSBuZXcgaWQocykgd2FzIHNwZWNpZmllZFxyXG5cdFx0XHRcdFx0XHRcdGlmIChxdWVyeS5uZXdJZHMpIHtcclxuXHRcdFx0XHRcdFx0XHRcdC8vIGlmIGpzb24gbXVzdCBiZSBwcm9jZXNzZWQsIHNpZ25hbCB3aWxsIGhhdmUgYmVlbiBpbmNyZW1lbnRlZCBhZ2FpblxyXG5cdFx0XHRcdFx0XHRcdFx0dGhpcy5zdGF0ZVt2YXJOYW1lXS5zaWduYWwud2FpdEZvckFsbChmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmICh0aGlzLnN0YXRlW3Zhck5hbWVdLmlzQXJyYXkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRmb3JlYWNoKHF1ZXJ5Lm5ld0lkcywgZnVuY3Rpb24gKGluZGV4KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR0aGlzLmNvbnRleHQubW9kZWxbdmFyTmFtZV1baW5kZXhdID0gbmV3ICh0aGlzLmNvbnRleHQubW9kZWwubWV0YS50eXBlKHF1ZXJ5LmZyb20pLmdldF9qc3R5cGUoKSkoKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR0aGlzLmNvbnRleHQubW9kZWxbdmFyTmFtZV0gPSBuZXcgKHRoaXMuY29udGV4dC5tb2RlbC5tZXRhLnR5cGUocXVlcnkuZnJvbSkuZ2V0X2pzdHlwZSgpKSgpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHQvLyBtb2RlbCBvYmplY3QgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGxvYWRlZCFcclxuXHRcdFx0XHRcdFx0XHRcdGFsbFNpZ25hbHMub25lRG9uZSgpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdFx0XHR9LCB0aGlzLCB0cnVlKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGNhbGxiYWNrLmNhbGwodGhpc1B0ciB8fCB0aGlzKTtcclxuXHRcdFx0fSxcclxuXHJcblx0XHQvLyBQZXJmb3JtIHByZS1wcm9jZXNzaW5nIG9mIG1vZGVsIHF1ZXJpZXMgYW5kIHRoZWlyIHBhdGhzLlxyXG5cdFx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cdFx0XHRmdW5jdGlvbiBDb250ZXh0UXVlcnkkcG9zdFF1ZXJpZXMoY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdFx0XHRpZiAodGhpcy5vcHRpb25zLm1vZGVsKSB7XHJcblx0XHRcdFx0XHRFeG9XZWIuZWFjaFByb3AodGhpcy5vcHRpb25zLm1vZGVsLCBmdW5jdGlvbiAodmFyTmFtZSwgcXVlcnkpIHtcclxuXHRcdFx0XHRcdFx0aWYgKHRoaXMuc3RhdGVbdmFyTmFtZV0uc2NvcGVRdWVyeSkge1xyXG5cdFx0XHRcdFx0XHRcdFNlcnZlclN5bmMkYWRkU2NvcGVRdWVyeS5jYWxsKHRoaXMuY29udGV4dC5zZXJ2ZXIsIHRoaXMuc3RhdGVbdmFyTmFtZV0uc2NvcGVRdWVyeSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdFx0XHR9LFxyXG5cclxuXHRcdC8vIEZpbmFsIGNsZWFudXAgc3RlcC4gQWxsb3cgcnVsZXMgdG8gcnVuIGluaXRpYWxseSwgZW5kIHRoZSBiYXRjaCxcclxuXHRcdC8vIGFuZCBhbGxvdyB0aGUgc2VydmVyIHN5bmMgdG8gc3RhcnQgY2FwdHVyaW5nIGV4aXN0aW5nIG9iamVjdHMgaW5cclxuXHRcdC8vIG9yZGVyIHRvIGF0dGFjaCBhIGxhenkgbG9hZGVyLlxyXG5cdFx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cdFx0XHRmdW5jdGlvbiBDb250ZXh0UXVlcnkkY2xlYW51cChjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0XHRcdGFsbFNpZ25hbHMud2FpdEZvckFsbChmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHQvLyBhbGxvd3MgcHJldmlvdXNseSBkZWZlcmVkIHJ1bGVzIHRvIHJ1blxyXG5cdFx0XHRcdFx0dGhpcy5jb250ZXh0Lm1vZGVsLm1ldGEubm90aWZ5QmVmb3JlQ29udGV4dFJlYWR5KCk7XHJcblxyXG5cdFx0XHRcdFx0RXhvV2ViLkJhdGNoLmVuZCh0aGlzLmJhdGNoKTtcclxuXHRcdFx0XHR9LCB0aGlzLCB0cnVlKTtcclxuXHJcblx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMpO1xyXG5cdFx0XHR9XHJcblx0XHQpXHJcblx0fSk7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuTWFwcGVyLkV4b1dlYlxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdC8vIERvbid0IGFjdGl2YXRlIHRoZSBET00gYXV0b21hdGljYWxseSwgaW5zdGVhZCBkZWxheSB1bnRpbCBhZnRlciBjb250ZXh0IGluaXRpYWxpemF0aW9uXHJcblx0U3lzLmFjdGl2YXRlRG9tID0gZmFsc2U7XHJcblxyXG5cdC8vIE9iamVjdCBjb25zdGFudCB0byBzaWduYWwgdG8gbWFwcGVyIHRvIGNyZWF0ZSBhIG5ldyBpbnN0YW5jZSByYXRoZXIgdGhhbiBsb2FkIG9uZVxyXG5cdHZhciAkbmV3SWQgPSBmdW5jdGlvbiAkbmV3SWQoKSB7XHJcblx0XHRyZXR1cm4gXCIkbmV3SWRcIjtcclxuXHR9O1xyXG5cclxuXHR3aW5kb3cuJG5ld0lkID0gJG5ld0lkO1xyXG5cclxuXHQvLyBJbmRpY2F0ZXMgd2hldGhlciBvciBub3QgdGhlIERPTSBoYXMgYmVlbiBhY3RpdmF0ZWRcclxuXHR2YXIgYWN0aXZhdGVkID0gZmFsc2U7XHJcblxyXG5cdHZhciBzZXJ2ZXJJbmZvO1xyXG5cclxuXHR2YXIgcGVuZGluZ1R5cGVRdWVyaWVzID0gW107XHJcblxyXG5cdC8vIENhbGxiYWNrKHMpIHRvIGV4ZWN1dGUgYXMgc29vbiBhcyBhIGNvbnRleHQgcXVlcnkgYmVnaW5zLlxyXG5cdHZhciBpbml0Rm5zID0gbmV3IEV4b1dlYi5GdW5jdG9yKCk7XHJcblxyXG5cdC8vIFNpZ25hbCB0byBnYXRlIGNvbnRleHQgY29tcGxldGlvbiB2aWEgZXh0ZW5kQ29udGV4dCBvcHRpb25zLlxyXG5cdHZhciBnbG9iYWxSZWFkeVNpZ25hbCA9IG5ldyBTaWduYWwoKTtcclxuXHJcblx0dmFyIGV4dGVuZENvbnRleHRGbiA9IG51bGw7XHJcblxyXG5cdHZhciBjb250ZXh0UmVhZHlGbnMgPSBuZXcgRXhvV2ViLkZ1bmN0b3IoKTtcclxuXHJcblx0dmFyIGRvbVJlYWR5Rm5zID0gbmV3IEV4b1dlYi5GdW5jdG9yKCk7XHJcblxyXG5cdGZ1bmN0aW9uIG1vZGVsUmVhZHlIYW5kbGVyKCkge1xyXG5cdFx0aWYgKGV4dGVuZENvbnRleHRGbikge1xyXG5cdFx0XHRleHRlbmRDb250ZXh0Rm4od2luZG93LmNvbnRleHQsIGdsb2JhbFJlYWR5U2lnbmFsLnBlbmRpbmcoKSk7XHJcblx0XHRcdGV4dGVuZENvbnRleHRGbiA9IG51bGw7XHJcblx0XHR9XHJcblxyXG5cdFx0Z2xvYmFsUmVhZHlTaWduYWwud2FpdEZvckFsbChmdW5jdGlvbiAoKSB7XHJcblx0XHRcdGlmICghY29udGV4dFJlYWR5Rm5zLmlzRW1wdHkoKSkge1xyXG5cdFx0XHRcdHdpbmRvdy5jb250ZXh0LmJlZ2luQ29udGV4dFJlYWR5KCk7XHJcblx0XHRcdFx0Y29udGV4dFJlYWR5Rm5zKHdpbmRvdy5jb250ZXh0KTtcclxuXHRcdFx0XHR3aW5kb3cuY29udGV4dC5lbmRDb250ZXh0UmVhZHkoKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0alF1ZXJ5KGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHQvLyBBY3RpdmF0ZSB0aGUgZG9jdW1lbnQgaWYgdGhpcyBpcyB0aGUgZmlyc3QgY29udGV4dCB0byBsb2FkXHJcblx0XHRcdFx0aWYgKCFhY3RpdmF0ZWQgJiYgRXhvV2ViLmNvbmZpZy5hdXRvQWN0aXZhdGlvbikge1xyXG5cdFx0XHRcdFx0YWN0aXZhdGVkID0gdHJ1ZTtcclxuXHRcdFx0XHRcdFN5cy5BcHBsaWNhdGlvbi5hY3RpdmF0ZUVsZW1lbnQoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIEludm9rZSBkb20gcmVhZHkgbm90aWZpY2F0aW9uc1xyXG5cdFx0XHRcdGlmICghZG9tUmVhZHlGbnMuaXNFbXB0eSgpKSB7XHJcblx0XHRcdFx0XHRpZiAoRXhvV2ViLmNvbmZpZy5kZWJ1Zykge1xyXG5cdFx0XHRcdFx0XHRkb21SZWFkeUZucyh3aW5kb3cuY29udGV4dCk7XHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHR0cnkge1xyXG5cdFx0XHRcdFx0XHRcdGRvbVJlYWR5Rm5zKHdpbmRvdy5jb250ZXh0KTtcclxuXHRcdFx0XHRcdFx0fSBjYXRjaCAoZSkge1xyXG5cdFx0XHRcdFx0XHRcdEV4b1dlYi5sb2dFcnJvcihlLCB0cnVlKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdC8vIEdsb2JhbCBtZXRob2QgZm9yIGluaXRpYWxpemluZyBFeG9XZWIgb24gYSBwYWdlXHJcblxyXG5cdGZ1bmN0aW9uICRleG93ZWIob3B0aW9ucykge1xyXG5cclxuXHRcdC8vIFN1cHBvcnQgaW5pdGlhbGl6YXRpb24gZnVuY3Rpb24gYXJndW1lbnRcclxuXHRcdGlmIChvcHRpb25zIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuXHRcdFx0b3B0aW9ucyA9IHsgaW5pdDogb3B0aW9ucyB9O1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChvcHRpb25zLmluaXQpIHtcclxuXHRcdFx0Ly8gUmVnaXN0ZXIgdGhlIGluaXQgZnVuY3Rpb24gT05DRS5cclxuXHRcdFx0aW5pdEZucy5hZGQob3B0aW9ucy5pbml0LCBudWxsLCB0cnVlKTtcclxuXHRcdFx0ZGVsZXRlIG9wdGlvbnMuaW5pdDtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAob3B0aW9ucy5leHRlbmRDb250ZXh0KSB7XHJcblx0XHRcdC8vIE1lcmdlIHRoZSBleHRlbmRDb250ZXh0IGZ1bmN0aW9uIHNvIHRoYXQgdGhlIGNhbGxiYWNrIGFyZ3VtZW50IGlzIGludm9rZWQgYWZ0ZXIgQUxMIGhhdmUgaW52b2tlZCB0aGUgY2FsbGJhY2suXHJcblx0XHRcdGV4dGVuZENvbnRleHRGbiA9IG1lcmdlRnVuY3Rpb25zKGV4dGVuZENvbnRleHRGbiwgb3B0aW9ucy5leHRlbmRDb250ZXh0LCB7IGFzeW5jOiB0cnVlLCBjYWxsYmFja0luZGV4OiAxIH0pO1xyXG5cdFx0XHRkZWxldGUgb3B0aW9ucy5leHRlbmRDb250ZXh0O1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChvcHRpb25zLmNvbnRleHRSZWFkeSkge1xyXG5cdFx0XHQvLyBSZWdpc3RlciB0aGUgY29udGV4dFJlYWR5IGZ1bmN0aW9uIE9OQ0UuXHJcblx0XHRcdGNvbnRleHRSZWFkeUZucy5hZGQob3B0aW9ucy5jb250ZXh0UmVhZHksIG51bGwsIHRydWUpO1xyXG5cdFx0XHRkZWxldGUgb3B0aW9ucy5jb250ZXh0UmVhZHk7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKG9wdGlvbnMuZG9tUmVhZHkpIHtcclxuXHRcdFx0Ly8gUmVnaXN0ZXIgdGhlIGRvbVJlYWR5IGZ1bmN0aW9uIE9OQ0UuXHJcblx0XHRcdGRvbVJlYWR5Rm5zLmFkZChvcHRpb25zLmRvbVJlYWR5LCBudWxsLCB0cnVlKTtcclxuXHRcdFx0ZGVsZXRlIG9wdGlvbnMuZG9tUmVhZHk7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gVGhlIHNlcnZlciBpbmZvIG9iamVjdCB3aWxsIGJlIG1haW50YWluZWQgaGVyZSBhbmQgY29uc3RhbnRseSBzZXQgZWFjaCB0aW1lIGFcclxuXHRcdC8vIGNvbnRleHQgcXVlcnkgaXMgY3JlYXRlZC4gSXQgc2hvdWxkbid0IGJlIHB1YmxpY2x5IHNldCBmb3IgYW55IG90aGVyIHJlYXNvbi5cclxuXHRcdGlmIChvcHRpb25zLnNlcnZlckluZm8pIHtcclxuXHRcdFx0Ly8gTWVyZ2UgYW55IGFkZGl0aW9uYWwgc2VydmVySW5mbyBvcHRpb25zLlxyXG5cdFx0XHRzZXJ2ZXJJbmZvID0galF1ZXJ5LmV4dGVuZChzZXJ2ZXJJbmZvLCBvcHRpb25zLnNlcnZlckluZm8pO1xyXG5cdFx0XHRkZWxldGUgb3B0aW9ucy5zZXJ2ZXJJbmZvO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChvcHRpb25zLnR5cGVzICYmIG9wdGlvbnMudHlwZXMgaW5zdGFuY2VvZiBBcnJheSkge1xyXG5cdFx0XHQvLyBTdG9yZSB0eXBlIHF1ZXJpZXMgZm9yIGxhdGVyIHVzZSwgc2luY2Ugb25seSBlbWJlZGRlZCBkYXRhIG9yIGEgbW9kZWwgcXVlcnkgdHJpZ2dlcnMgaW1tZWRpYXRlIHF1ZXJ5aW5nLlxyXG5cdFx0XHRwZW5kaW5nVHlwZVF1ZXJpZXMgPSBwZW5kaW5nVHlwZVF1ZXJpZXMuY29uY2F0KG9wdGlvbnMudHlwZXMpO1xyXG5cdFx0XHRkZWxldGUgb3B0aW9ucy50eXBlcztcclxuXHRcdH1cclxuXHJcblx0XHQvLyBBIG1vZGVsIHF1ZXJ5IG9yIGVtYmVkZGVkIGRhdGEgd2lsbCB0cmlnZ2VyIGEgY29udGV4dCBxdWVyeSBpbW1lZGlhdGVseS5cclxuXHRcdHZhciB0cmlnZ2VyUXVlcnkgPSBmYWxzZTtcclxuXHRcdHZhciBxdWVyeU9iamVjdCA9IHt9O1xyXG5cclxuXHRcdGlmIChvcHRpb25zLm1vZGVsKSB7XHJcblx0XHRcdHRyaWdnZXJRdWVyeSA9IHRydWU7XHJcblx0XHRcdHF1ZXJ5T2JqZWN0Lm1vZGVsID0gb3B0aW9ucy5tb2RlbDtcclxuXHRcdFx0ZGVsZXRlIG9wdGlvbnMubW9kZWw7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKG9wdGlvbnMudHlwZXMpIHtcclxuXHRcdFx0dHJpZ2dlclF1ZXJ5ID0gdHJ1ZTtcclxuXHRcdFx0cXVlcnlPYmplY3QudHlwZXMgPSBvcHRpb25zLnR5cGVzO1xyXG5cdFx0XHRkZWxldGUgb3B0aW9ucy50eXBlcztcclxuXHRcdH1cclxuXHJcblx0XHRpZiAob3B0aW9ucy5pbnN0YW5jZXMpIHtcclxuXHRcdFx0dHJpZ2dlclF1ZXJ5ID0gdHJ1ZTtcclxuXHRcdFx0cXVlcnlPYmplY3QuaW5zdGFuY2VzID0gb3B0aW9ucy5pbnN0YW5jZXM7XHJcblx0XHRcdGRlbGV0ZSBvcHRpb25zLmluc3RhbmNlcztcclxuXHRcdH1cclxuXHJcblx0XHRpZiAob3B0aW9ucy5jb25kaXRpb25zKSB7XHJcblx0XHRcdHRyaWdnZXJRdWVyeSA9IHRydWU7XHJcblx0XHRcdHF1ZXJ5T2JqZWN0LmNvbmRpdGlvbnMgPSBvcHRpb25zLmNvbmRpdGlvbnM7XHJcblx0XHRcdGRlbGV0ZSBvcHRpb25zLmNvbmRpdGlvbnM7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKG9wdGlvbnMuY2hhbmdlcykge1xyXG5cdFx0XHR0cmlnZ2VyUXVlcnkgPSB0cnVlO1xyXG5cdFx0XHRxdWVyeU9iamVjdC5jaGFuZ2VzID0gb3B0aW9ucy5jaGFuZ2VzO1xyXG5cdFx0XHRkZWxldGUgb3B0aW9ucy5jaGFuZ2VzO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmICh0cmlnZ2VyUXVlcnkpIHtcclxuXHJcblx0XHRcdC8vIEVuc3VyZSB0aGF0IGEgY29udGV4dCBpcyBjcmVhdGVkIGlmIGl0IGhhc24ndCBiZWVuIGFscmVhZHkuXHJcblx0XHRcdGVuc3VyZUNvbnRleHQoKTtcclxuXHJcblx0XHRcdC8vIFBlcmZvcm0gaW5pdGlhbGl6YXRpb24gaW1tZWRpYXRlbHlcclxuXHRcdFx0aW5pdEZucyh3aW5kb3cuY29udGV4dCk7XHJcblxyXG5cdFx0XHQvLyBJbmNsdWRlIHNlcnZlciBpbmZvIGlmIHByZXNlbnQuXHJcblx0XHRcdGlmIChzZXJ2ZXJJbmZvKSB7XHJcblx0XHRcdFx0Ly8gVGhlIHNlcnZlciBpbmZvIG9iamVjdCB3aWxsIGJlIG1haW50YWluZWQgaGVyZSBhbmQgY29uc3RhbnRseSBzZXQgZWFjaCB0aW1lIGFcclxuXHRcdFx0XHQvLyBjb250ZXh0IHF1ZXJ5IGlzIGNyZWF0ZWQuIEl0IHNob3VsZG4ndCBiZSBwdWJsaWNseSBzZXQgZm9yIGFueSBvdGhlciByZWFzb24uXHJcblx0XHRcdFx0cXVlcnlPYmplY3Quc2VydmVySW5mbyA9IHNlcnZlckluZm87XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIFNlbmQgcGVuZGluZyB0eXBlIHF1ZXJpZXMgd2l0aCB0aGUgcXVlcnkgaWYgdHlwZXMgd2VyZSBub3QgZW1iZWRkZWQuXHJcblx0XHRcdGlmIChwZW5kaW5nVHlwZVF1ZXJpZXMubGVuZ3RoID4gMCAmJiAhcXVlcnlPYmplY3QudHlwZXMpIHtcclxuXHRcdFx0XHRxdWVyeU9iamVjdC50eXBlcyA9IHBlbmRpbmdUeXBlUXVlcmllcztcclxuXHRcdFx0XHRwZW5kaW5nVHlwZVF1ZXJpZXMgPSBbXTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gU3RhcnQgdGhlIG5ldyBxdWVyeVxyXG5cdFx0XHRDb250ZXh0LnF1ZXJ5KHdpbmRvdy5jb250ZXh0LCBxdWVyeU9iamVjdCk7XHJcblxyXG5cdFx0XHRpZiAocGVuZGluZ1R5cGVRdWVyaWVzLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHQvLyBTZW5kIGEgc2VwZXJhdGUgcXVlcnkgZm9yIHR5cGUgcXVlcmllcyBpZiB0aGV5IGNvdWxkbid0IGJlIHNlbmQgd2l0aCB0aGUgcHJpbWFyeSBxdWVyeS5cclxuXHRcdFx0XHRDb250ZXh0LnF1ZXJ5KHdpbmRvdy5jb250ZXh0LCB7IHR5cGVzOiBwZW5kaW5nVHlwZVF1ZXJpZXMgfSk7XHJcblx0XHRcdFx0cGVuZGluZ1R5cGVRdWVyaWVzID0gW107XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIFBlcmZvcm0gY29udGV4dCBpbml0aWFsaXphdGlvbiB3aGVuIHRoZSBtb2RlbCBpcyByZWFkeVxyXG5cdFx0XHR3aW5kb3cuY29udGV4dC5hZGRSZWFkeShtb2RlbFJlYWR5SGFuZGxlcik7XHJcblxyXG5cdFx0fSBlbHNlIGlmICh3aW5kb3cuY29udGV4dCkge1xyXG5cclxuXHRcdFx0Ly8gRW5zdXJlIHRoYXQgdGhlIGNvbnRleHQgdmFyaWFibGUgaGFzIG5vdCBiZWVuIHVzZWQgZm9yIHNvbWUgb3RoZXIgcHVycG9zZS5cclxuXHRcdFx0aWYgKCEod2luZG93LmNvbnRleHQgaW5zdGFuY2VvZiBDb250ZXh0KSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIlRoZSB3aW5kb3cgb2JqZWN0IGhhcyBhIGNvbnRleHQgcHJvcGVydHkgdGhhdCBpcyBub3QgYSB2YWxpZCBjb250ZXh0LlwiKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gQ29udGV4dCBoYXMgYWxyZWFkeSBiZWVuIGNyZWF0ZWQsIHNvIHBlcmZvcm0gaW5pdGlhbGl6YXRpb24gaW1tZWRpYXRlbHlcclxuXHRcdFx0aW5pdEZucyh3aW5kb3cuY29udGV4dCk7XHJcblxyXG5cdFx0XHQvLyBJZiB0aGUgY29udGV4dCBoYXMgYWxyZWFkeSBjb21wbGV0ZWQsIHRoZW4gZmlyZSB0aGUgcmVhZHkgaGFuZGxlci4gSXQgaXMgc2FmZSB0byBmaXJlIG1vcmUgdGhhbiBvbmNlLlxyXG5cdFx0XHRpZiAoIXdpbmRvdy5jb250ZXh0LmlzUGVuZGluZygpKSB7XHJcblx0XHRcdFx0YWxsU2lnbmFscy53YWl0Rm9yQWxsKG1vZGVsUmVhZHlIYW5kbGVyKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHR9XHJcblxyXG5cdHdpbmRvdy4kZXhvd2ViID0gJGV4b3dlYjtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5NYXBwZXIuRXh0ZW5kXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0dmFyIHBlbmRpbmdUeXBlRXh0ZW5zaW9ucyA9IHt9O1xyXG5cdHZhciBwZW5kaW5nU3VidHlwZUV4dGVuc2lvbnMgPSB7fTtcclxuXHJcblx0ZnVuY3Rpb24gcmFpc2VFeHRlbnNpb25zKG10eXBlKSB7XHJcblx0XHQvL0V4b1dlYi5CYXRjaC53aGVuRG9uZShmdW5jdGlvbigpIHsgXHJcblx0XHRcdC8vIGFwcGx5IGFwcC1zcGVjaWZpYyBjb25maWd1cmF0aW9uXHJcblx0XHRcdC8vIGRlZmVyIHVudGlsIGxvYWRpbmcgaXMgY29tcGxldGVkIHRvIHJlZHVjZSBpbml0IGV2ZW50c1xyXG5cdFx0XHR2YXIgZXh0cyA9IHBlbmRpbmdUeXBlRXh0ZW5zaW9uc1ttdHlwZS5nZXRfZnVsbE5hbWUoKV07XHJcblx0XHRcdGlmIChleHRzKSB7XHJcblx0XHRcdFx0ZGVsZXRlIHBlbmRpbmdUeXBlRXh0ZW5zaW9uc1ttdHlwZS5nZXRfZnVsbE5hbWUoKV07XHJcblx0XHRcdFx0ZXh0cyhtdHlwZS5nZXRfanN0eXBlKCkpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRtdHlwZS5lYWNoQmFzZVR5cGUoZnVuY3Rpb24oYmFzZVR5cGUpIHtcclxuXHRcdFx0XHR2YXIgc3ViRXh0cyA9IHBlbmRpbmdTdWJ0eXBlRXh0ZW5zaW9uc1tiYXNlVHlwZS5nZXRfZnVsbE5hbWUoKV07XHJcblx0XHRcdFx0aWYgKHN1YkV4dHMpIHtcclxuXHRcdFx0XHRcdC8vIGRvbid0IGRlbGV0ZSBzdWJ0eXBlIGV4dGVuc2lvbnMgc2luY2UgbW9yZSBzdWJ0eXBlcyBtYXkgYmUgY3JlYXRlZFxyXG5cdFx0XHRcdFx0c3ViRXh0cyhtdHlwZS5nZXRfanN0eXBlKCkpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHQvL30pO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gZXh0ZW5kT25lKHR5cGVOYW1lLCBjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0dmFyIGpzdHlwZSA9IEV4b1dlYi5Nb2RlbC5Nb2RlbC5nZXRKc1R5cGUodHlwZU5hbWUsIHRydWUpO1xyXG5cclxuXHRcdGlmIChqc3R5cGUgJiYgTGF6eUxvYWRlci5pc0xvYWRlZChqc3R5cGUubWV0YSkpIHtcclxuXHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzUHRyIHx8IHRoaXMsIGpzdHlwZSk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dmFyIHBlbmRpbmcgPSBwZW5kaW5nVHlwZUV4dGVuc2lvbnNbdHlwZU5hbWVdO1xyXG5cclxuXHRcdFx0aWYgKCFwZW5kaW5nKSB7XHJcblx0XHRcdFx0cGVuZGluZyA9IHBlbmRpbmdUeXBlRXh0ZW5zaW9uc1t0eXBlTmFtZV0gPSBFeG9XZWIuRnVuY3RvcigpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRwZW5kaW5nLmFkZCh0aGlzUHRyID8gY2FsbGJhY2suYmluZCh0aGlzUHRyKSA6IGNhbGxiYWNrKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHdpbmRvdy4kZXh0ZW5kID0gZnVuY3Rpb24odHlwZUluZm8sIGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRpZiAodHlwZUluZm8gPT0gbnVsbCkgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEVycm9yKFwidHlwZUluZm9cIik7XHJcblxyXG5cdFx0Ly8gSWYgdHlwZUluZm8gaXMgYW4gYXJyeSBvZiB0eXBlIG5hbWVzLCB0aGVuIHVzZSBhIHNpZ25hbCB0byB3YWl0IHVudGlsIGFsbCB0eXBlcyBhcmUgbG9hZGVkLlxyXG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0eXBlSW5mbykgPT09IFwiW29iamVjdCBBcnJheV1cIikge1xyXG5cdFx0XHR2YXIgc2lnbmFsID0gbmV3IEV4b1dlYi5TaWduYWwoXCJleHRlbmRcIik7XHJcblxyXG5cdFx0XHR2YXIgdHlwZXMgPSBbXTtcclxuXHRcdFx0dHlwZUluZm8uZm9yRWFjaChmdW5jdGlvbihpdGVtLCBpbmRleCkge1xyXG5cdFx0XHRcdGlmIChpdGVtLmNvbnN0cnVjdG9yICE9PSBTdHJpbmcpIHtcclxuXHRcdFx0XHRcdHRocm93IG5ldyBBcmd1bWVudFR5cGVFcnJvcihcInR5cGVJbmZvXCIsIFwic3RyaW5nXCIsIGl0ZW0pO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0ZXh0ZW5kT25lKGl0ZW0sIHNpZ25hbC5wZW5kaW5nKGZ1bmN0aW9uKHR5cGUpIHtcclxuXHRcdFx0XHRcdHR5cGVzW2luZGV4XSA9IHR5cGU7XHJcblx0XHRcdFx0fSksIHRoaXNQdHIpO1xyXG5cdFx0XHR9KTtcclxuXHJcblx0XHRcdHNpZ25hbC53YWl0Rm9yQWxsKGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdC8vIFdoZW4gYWxsIHR5cGVzIGFyZSBhdmFpbGFibGUsIGNhbGwgdGhlIG9yaWdpbmFsIGNhbGxiYWNrLlxyXG5cdFx0XHRcdGNhbGxiYWNrLmFwcGx5KHRoaXNQdHIgfHwgdGhpcywgdHlwZXMpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHRcdC8vIEF2b2lkIHRoZSBvdmVyaGVhZCBvZiBzaWduYWwgYW5kIGp1c3QgY2FsbCBleHRlbmRPbmUgZGlyZWN0bHkuXHJcblx0XHRlbHNlIGlmICh0eXBlSW5mby5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XHJcblx0XHRcdGV4dGVuZE9uZSh0eXBlSW5mbywgY2FsbGJhY2ssIHRoaXNQdHIpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRocm93IG5ldyBBcmd1bWVudFR5cGVFcnJvcihcInR5cGVJbmZvXCIsIFwic3RyaW5nfGFycmF5XCIsIHR5cGVJbmZvKTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHR3aW5kb3cuJGV4dGVuZFN1YnR5cGVzID0gZnVuY3Rpb24odHlwZU5hbWUsIGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRpZiAodHlwZU5hbWUgPT0gbnVsbCkgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEVycm9yKFwidHlwZU5hbWVcIik7XHJcblx0XHRpZiAodHlwZU5hbWUuY29uc3RydWN0b3IgIT09IFN0cmluZykgdGhyb3cgbmV3IEFyZ3VtZW50VHlwZUVycm9yKFwidHlwZU5hbWVcIiwgXCJzdHJpbmdcIiwgdHlwZU5hbWUpO1xyXG5cclxuXHRcdHZhciBqc3R5cGUgPSBFeG9XZWIuTW9kZWwuTW9kZWwuZ2V0SnNUeXBlKHR5cGVOYW1lLCB0cnVlKTtcclxuXHJcblx0XHRpZiAoanN0eXBlKSB7XHJcblx0XHRcdC8vIENhbGwgZm9yIGV4aXN0aW5nLCBsb2FkZWQgc3VidHlwZXNcclxuXHRcdFx0QXJyYXkuZm9yRWFjaChqc3R5cGUubWV0YS5kZXJpdmVkVHlwZXMgfHwgW10sIGZ1bmN0aW9uKG10eXBlKSB7XHJcblx0XHRcdFx0aWYgKG10eXBlICYmIExhenlMb2FkZXIuaXNMb2FkZWQobXR5cGUpKSB7XHJcblx0XHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcywgbXR5cGUuZ2V0X2pzdHlwZSgpKTtcclxuXHRcdFx0XHRcdEFycmF5LmZvckVhY2gobXR5cGUuZGVyaXZlZFR5cGVzIHx8IFtdLCBhcmd1bWVudHMuY2FsbGVlLnNwbGljZUFyZ3VtZW50cygxLCAyKSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHRcclxuXHRcdHZhciBwZW5kaW5nID0gcGVuZGluZ1N1YnR5cGVFeHRlbnNpb25zW3R5cGVOYW1lXTtcclxuXHJcblx0XHRpZiAoIXBlbmRpbmcpIHtcclxuXHRcdFx0cGVuZGluZyA9IHBlbmRpbmdTdWJ0eXBlRXh0ZW5zaW9uc1t0eXBlTmFtZV0gPSBFeG9XZWIuRnVuY3RvcigpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHBlbmRpbmcuYWRkKHRoaXNQdHIgPyBjYWxsYmFjay5iaW5kKHRoaXNQdHIpIDogY2FsbGJhY2spO1xyXG5cdH07XHJcblxyXG5cdHdpbmRvdy4kZXh0ZW5kUHJvcGVydGllcyA9IGZ1bmN0aW9uICh0eXBlTmFtZSwgaW5jbHVkZUJ1aWx0SW4sIGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRpZiAodHlwZU5hbWUgPT0gbnVsbCkgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEVycm9yKFwidHlwZU5hbWVcIik7XHJcblx0XHRpZiAodHlwZU5hbWUuY29uc3RydWN0b3IgIT09IFN0cmluZykgdGhyb3cgbmV3IEFyZ3VtZW50VHlwZUVycm9yKFwidHlwZU5hbWVcIiwgXCJzdHJpbmdcIiwgdHlwZU5hbWUpO1xyXG5cclxuXHRcdGlmIChpbmNsdWRlQnVpbHRJbiAmJiBpbmNsdWRlQnVpbHRJbiBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcblx0XHRcdHRoaXNQdHIgPSBjYWxsYmFjaztcclxuXHRcdFx0Y2FsbGJhY2sgPSBpbmNsdWRlQnVpbHRJbjtcclxuXHRcdFx0aW5jbHVkZUJ1aWx0SW4gPSBmYWxzZTtcclxuXHRcdH1cclxuXHJcblx0XHRleHRlbmRPbmUodHlwZU5hbWUsIGZ1bmN0aW9uIChqc3R5cGUpIHtcclxuXHRcdFx0Ly8gUmFpc2UgaGFuZGxlciBmb3IgZXhpc3RpbmcgcHJvcGVydGllc1xyXG5cdFx0XHRqc3R5cGUubWV0YS5nZXRfcHJvcGVydGllcygpLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcclxuXHRcdFx0XHRpZiAoaW5jbHVkZUJ1aWx0SW4gPT09IHRydWUgfHwgcHJvcC5nZXRfb3JpZ2luKCkgIT09IFwic2VydmVyXCIpXHJcblx0XHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcywgcHJvcCwgdHJ1ZSk7XHJcblx0XHRcdH0pO1xyXG5cclxuXHRcdFx0Ly8gUmFpc2UgaGFuZGxlciB3aGVuIG5ldyBwcm9wZXJ0aWVzIGFyZSBhZGRlZFxyXG5cdFx0XHRqc3R5cGUubWV0YS5hZGRQcm9wZXJ0eUFkZGVkKGZ1bmN0aW9uIChzZW5kZXIsIGFyZ3MpIHtcclxuXHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXNQdHIgfHwgdGhpcywgYXJncy5wcm9wZXJ0eSwgZmFsc2UpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5VSS5Ub2dnbGVcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHRmdW5jdGlvbiBUb2dnbGUoZWxlbWVudCkge1xyXG5cclxuXHRcdC8vIERlZmF1bHQgYWN0aW9uIGlzIHNob3dcclxuXHRcdHRoaXMuX2FjdGlvbiA9IFwic2hvd1wiO1xyXG5cclxuXHRcdFRvZ2dsZS5pbml0aWFsaXplQmFzZSh0aGlzLCBbZWxlbWVudF0pO1xyXG5cdH1cclxuXHJcblx0dmFyIFRvZ2dsZV9hbGxvd2VkQWN0aW9ucyA9IFtcInNob3dcIiwgXCJoaWRlXCIsIFwiZW5hYmxlXCIsIFwiZGlzYWJsZVwiLCBcInJlbmRlclwiLCBcImRpc3Bvc2VcIiwgXCJhZGRDbGFzc1wiLCBcInJlbW92ZUNsYXNzXCJdO1xyXG5cclxuXHQvLyBBY3Rpb25zXHJcblx0VG9nZ2xlLm1peGluKHtcclxuXHRcdC8vIFNob3cvSGlkZVxyXG5cdFx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cdFx0bGlua19zaG93OiBmdW5jdGlvbiBUb2dnbGUkbGlua19zaG93KCkge1xyXG5cdFx0XHRpZiAoKHRoaXMuX2FjdGlvbiA9PT0gXCJzaG93XCIgJiYgalF1ZXJ5KHRoaXMuX2VsZW1lbnQpLmlzKFwiLnRvZ2dsZS1vblwiKSkgfHwgKHRoaXMuX2FjdGlvbiA9PT0gXCJoaWRlXCIgJiYgalF1ZXJ5KHRoaXMuX2VsZW1lbnQpLmlzKFwiLnRvZ2dsZS1vZmZcIikpKSB7XHJcblx0XHRcdFx0dGhpcy5zZXRfc3RhdGUoXCJvblwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aGlzLnNldF9zdGF0ZShcIm9mZlwiKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdGFkZF9zaG93aW5nOiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJFOkojU3lzLlVJLkRhdGFWaWV3LnNob3dpbmdcIiAvPlxyXG5cdFx0XHR0aGlzLl9hZGRIYW5kbGVyKFwic2hvd2luZ1wiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRyZW1vdmVfc2hvd2luZzogZnVuY3Rpb24gKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fcmVtb3ZlSGFuZGxlcihcInNob3dpbmdcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0YWRkX2hpZGluZzogZnVuY3Rpb24gKGhhbmRsZXIpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiRTpKI1N5cy5VSS5EYXRhVmlldy5oaWRpbmdcIiAvPlxyXG5cdFx0XHR0aGlzLl9hZGRIYW5kbGVyKFwiaGlkaW5nXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHRcdHJlbW92ZV9oaWRpbmc6IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUhhbmRsZXIoXCJoaWRpbmdcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0ZG9fc2hvdzogZnVuY3Rpb24gVG9nZ2xlJGRvX3Nob3coKSB7XHJcblxyXG5cdFx0XHQvLyB2aXNpYmlsaXR5IGhhcyBjaGFuZ2VkIHNvIHJhaXNlIGV2ZW50XHJcblx0XHRcdGlmICh0aGlzLl92aXNpYmxlID09PSB1bmRlZmluZWQgfHwgdGhpcy5fdmlzaWJsZSA9PT0gZmFsc2UpIHtcclxuXHRcdFx0XHR2YXIgc2hvd2luZ0FyZ3MgPSBuZXcgQWN0aW9uRXZlbnRBcmdzKCk7XHJcblxyXG5cdFx0XHRcdHRoaXMuX3BlbmRpbmdFdmVudEFyZ3MgPSBzaG93aW5nQXJncztcclxuXHJcblx0XHRcdFx0aWYgKHRoaXMuX3Zpc2libGUgPT09IGZhbHNlKSB7XHJcblx0XHRcdFx0XHRTeXMuT2JzZXJ2ZXIucmFpc2VFdmVudCh0aGlzLCBcInNob3dpbmdcIiwgc2hvd2luZ0FyZ3MpO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0c2hvd2luZ0FyZ3Mud2FpdEZvckFsbChmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9wZW5kaW5nRXZlbnRBcmdzID0gbnVsbDtcclxuXHJcblx0XHRcdFx0XHRpZiAodGhpcy5fZWZmZWN0ID09IFwic2xpZGVcIiAmJiB0aGlzLl92aXNpYmxlID09PSBmYWxzZSlcclxuXHRcdFx0XHRcdFx0alF1ZXJ5KHRoaXMuX2VsZW1lbnQpLnNsaWRlRG93bigpO1xyXG5cdFx0XHRcdFx0ZWxzZSBpZiAodGhpcy5fZWZmZWN0ID09IFwiZmFkZVwiICYmIHRoaXMuX3Zpc2libGUgPT09IGZhbHNlKVxyXG5cdFx0XHRcdFx0XHRqUXVlcnkodGhpcy5fZWxlbWVudCkuZmFkZUluKCk7XHJcblx0XHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0XHRcdGpRdWVyeSh0aGlzLl9lbGVtZW50KS5zaG93KCk7XHJcblxyXG5cdFx0XHRcdFx0dGhpcy5zZXRfc3RhdGUoXCJvblwiKTtcclxuXHJcblx0XHRcdFx0XHQvLyB2aXNpYmlsaXR5IGhhcyBjaGFuZ2VkIHNvIHJhaXNlIGV2ZW50XHJcblx0XHRcdFx0XHRTeXMuT2JzZXJ2ZXIucmFpc2VFdmVudCh0aGlzLCBcInNob3duXCIpO1xyXG5cclxuXHRcdFx0XHRcdHRoaXMuX3Zpc2libGUgPSB0cnVlO1xyXG5cclxuXHRcdFx0XHRcdHRoaXMuX3BlbmRpbmdBY3Rpb25zKCk7XHJcblx0XHRcdFx0fSwgdGhpcywgdHJ1ZSk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRkb19oaWRlOiBmdW5jdGlvbiBUb2dnbGUkZG9faGlkZSgpIHtcclxuXHJcblx0XHRcdC8vIHZpc2liaWxpdHkgaGFzIGNoYW5nZWQgc28gcmFpc2UgZXZlbnRcclxuXHRcdFx0aWYgKHRoaXMuX3Zpc2libGUgPT09IHVuZGVmaW5lZCB8fCB0aGlzLl92aXNpYmxlID09PSB0cnVlKSB7XHJcblx0XHRcdFx0dmFyIGhpZGluZ0FyZ3MgPSBuZXcgQWN0aW9uRXZlbnRBcmdzKCk7XHJcblxyXG5cdFx0XHRcdHRoaXMuX3BlbmRpbmdFdmVudEFyZ3MgPSBoaWRpbmdBcmdzO1xyXG5cclxuXHRcdFx0XHRpZiAodGhpcy5fdmlzaWJsZSA9PT0gdHJ1ZSkge1xyXG5cdFx0XHRcdFx0U3lzLk9ic2VydmVyLnJhaXNlRXZlbnQodGhpcywgXCJoaWRpbmdcIiwgaGlkaW5nQXJncyk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRoaWRpbmdBcmdzLndhaXRGb3JBbGwoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0dGhpcy5fcGVuZGluZ0V2ZW50QXJncyA9IG51bGw7XHJcblxyXG5cdFx0XHRcdFx0aWYgKHRoaXMuX2VmZmVjdCA9PSBcInNsaWRlXCIgJiYgdGhpcy5fdmlzaWJsZSA9PT0gdHJ1ZSlcclxuXHRcdFx0XHRcdFx0alF1ZXJ5KHRoaXMuX2VsZW1lbnQpLnNsaWRlVXAoKTtcclxuXHRcdFx0XHRcdGVsc2UgaWYgKHRoaXMuX2VmZmVjdCA9PSBcImZhZGVcIiAmJiB0aGlzLl92aXNpYmxlID09PSB0cnVlKVxyXG5cdFx0XHRcdFx0XHRqUXVlcnkodGhpcy5fZWxlbWVudCkuZmFkZU91dCgpO1xyXG5cdFx0XHRcdFx0ZWxzZVxyXG5cdFx0XHRcdFx0XHRqUXVlcnkodGhpcy5fZWxlbWVudCkuaGlkZSgpO1xyXG5cclxuXHRcdFx0XHRcdHRoaXMuc2V0X3N0YXRlKFwib2ZmXCIpO1xyXG5cclxuXHRcdFx0XHRcdC8vIHZpc2liaWxpdHkgaGFzIGNoYW5nZWQgc28gcmFpc2UgZXZlbnRcclxuXHRcdFx0XHRcdFN5cy5PYnNlcnZlci5yYWlzZUV2ZW50KHRoaXMsIFwiaGlkZGVuXCIpO1xyXG5cclxuXHRcdFx0XHRcdHRoaXMuX3Zpc2libGUgPSBmYWxzZTtcclxuXHJcblx0XHRcdFx0XHR0aGlzLl9wZW5kaW5nQWN0aW9ucygpO1xyXG5cdFx0XHRcdH0sIHRoaXMsIHRydWUpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0YWRkX29uOiBmdW5jdGlvbiBUb2dnbGUkYWRkX29uKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fYWRkSGFuZGxlcihcIm9uXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHRcdHJlbW92ZV9vbjogZnVuY3Rpb24gVG9nZ2xlJHJlbW92ZV9vbihoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUhhbmRsZXIoXCJvblwiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRhZGRfb2ZmOiBmdW5jdGlvbiBUb2dnbGUkYWRkX29mZihoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX2FkZEhhbmRsZXIoXCJvZmZcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0cmVtb3ZlX29mZjogZnVuY3Rpb24gVG9nZ2xlJHJlbW92ZV9vZmYoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9yZW1vdmVIYW5kbGVyKFwib2ZmXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHRcdGFkZF9zaG93bjogZnVuY3Rpb24gVG9nZ2xlJGFkZF9zaG93bihoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX2FkZEhhbmRsZXIoXCJzaG93blwiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRyZW1vdmVfc2hvd246IGZ1bmN0aW9uIFRvZ2dsZSRyZW1vdmVfc2hvd24oaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9yZW1vdmVIYW5kbGVyKFwic2hvd25cIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0YWRkX2hpZGRlbjogZnVuY3Rpb24gVG9nZ2xlJGFkZF9oaWRkZW4oaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9hZGRIYW5kbGVyKFwiaGlkZGVuXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHRcdHJlbW92ZV9oaWRkZW46IGZ1bmN0aW9uIFRvZ2dsZSRyZW1vdmVfaGlkZGVuKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fcmVtb3ZlSGFuZGxlcihcImhpZGRlblwiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRnZXRfdmlzaWJsZTogZnVuY3Rpb24gVG9nZ2xlJGdldF92aXNpYmxlKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fdmlzaWJsZTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gRW5hYmxlL0Rpc2FibGVcclxuXHRcdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHRcdGxpbmtfZGlzYWJsZTogZnVuY3Rpb24gVG9nZ2xlJGxpbmtfZGlzYWJsZSgpIHtcclxuXHRcdFx0aWYgKCh0aGlzLl9hY3Rpb24gPT09IFwiZGlzYWJsZVwiICYmIGpRdWVyeSh0aGlzLl9lbGVtZW50KS5pcyhcIi50b2dnbGUtb25cIikpIHx8ICh0aGlzLl9hY3Rpb24gPT09IFwiZW5hYmxlXCIgJiYgalF1ZXJ5KHRoaXMuX2VsZW1lbnQpLmlzKFwiLnRvZ2dsZS1vZmZcIikpKSB7XHJcblx0XHRcdFx0alF1ZXJ5KFwic2VsZWN0LGlucHV0LHRleHRhcmVhLGEsYnV0dG9uLG9wdGdyb3VwLG9wdGlvblwiLCB0aGlzLl9lbGVtZW50KS5hbmRTZWxmKCkuYXR0cihcImRpc2FibGVkXCIsIFwiZGlzYWJsZWRcIik7XHJcblx0XHRcdFx0dGhpcy5zZXRfc3RhdGUoXCJvZmZcIik7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5zZXRfc3RhdGUoXCJvblwiKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdGRvX2VuYWJsZTogZnVuY3Rpb24gVG9nZ2xlJGRvX2VuYWJsZSgpIHtcclxuXHRcdFx0alF1ZXJ5KFwic2VsZWN0LGlucHV0LHRleHRhcmVhLGEsYnV0dG9uLG9wdGdyb3VwLG9wdGlvblwiLCB0aGlzLl9lbGVtZW50KS5hbmRTZWxmKCkucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xyXG5cdFx0XHR0aGlzLnNldF9zdGF0ZShcIm9uXCIpO1xyXG5cdFx0fSxcclxuXHRcdGRvX2Rpc2FibGU6IGZ1bmN0aW9uIFRvZ2dsZSRkb19kaXNhYmxlKCkge1xyXG5cdFx0XHRqUXVlcnkoXCJzZWxlY3QsaW5wdXQsdGV4dGFyZWEsYSxidXR0b24sb3B0Z3JvdXAsb3B0aW9uXCIsIHRoaXMuX2VsZW1lbnQpLmFuZFNlbGYoKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcclxuXHRcdFx0dGhpcy5zZXRfc3RhdGUoXCJvZmZcIik7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIFJlbmRlci9EZXN0cm95XHJcblx0XHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0XHRsaW5rX3JlbmRlcjogZnVuY3Rpb24gVG9nZ2xlJGxpbmtfcmVuZGVyKCkge1xyXG5cdFx0XHR0aGlzLl9jb250ZXh0ID0gbnVsbDtcclxuXHJcblx0XHRcdGlmICgodGhpcy5fYWN0aW9uID09PSBcInJlbmRlclwiICYmIGpRdWVyeSh0aGlzLl9lbGVtZW50KS5pcyhcIi50b2dnbGUtb25cIikpIHx8ICh0aGlzLl9hY3Rpb24gPT09IFwiZGlzcG9zZVwiICYmIGpRdWVyeSh0aGlzLl9lbGVtZW50KS5pcyhcIi50b2dnbGUtb2ZmXCIpKSkge1xyXG5cdFx0XHRcdHZhciBwY3R4ID0gdGhpcy5nZXRfdGVtcGxhdGVDb250ZXh0KCk7XHJcblxyXG5cdFx0XHRcdGlmICghdGhpcy5fY3R4SWR4ICYmIHRoaXMuX2VsZW1lbnQuY2hpbGROb2Rlcy5sZW5ndGggPiAwKVxyXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiQSB0b2dnbGUgY29udHJvbCBpcyBhdHRhY2hlZCB0byB0aGUgbm9kZSwgd2hpY2ggZXhwZWN0cyBhIHRlbXBsYXRlIGNvbnRleHQgaWQsIGJ1dCBubyBpZCB3YXMgc3BlY2lmaWVkLlwiKTtcclxuXHJcblx0XHRcdFx0dmFyIG5ld0NvbnRleHQgPSBuZXcgU3lzLlVJLlRlbXBsYXRlQ29udGV4dCh0aGlzLl9jdHhJZHgpO1xyXG5cdFx0XHRcdG5ld0NvbnRleHQuZGF0YSA9IHBjdHguZGF0YUl0ZW07XHJcblx0XHRcdFx0bmV3Q29udGV4dC5jb21wb25lbnRzID0gW107XHJcblx0XHRcdFx0bmV3Q29udGV4dC5ub2RlcyA9IFtdO1xyXG5cdFx0XHRcdG5ld0NvbnRleHQuZGF0YUl0ZW0gPSBwY3R4LmRhdGFJdGVtO1xyXG5cdFx0XHRcdG5ld0NvbnRleHQuaW5kZXggPSAwO1xyXG5cdFx0XHRcdG5ld0NvbnRleHQucGFyZW50Q29udGV4dCA9IHBjdHg7XHJcblx0XHRcdFx0bmV3Q29udGV4dC5jb250YWluZXJFbGVtZW50ID0gdGhpcy5fZWxlbWVudDtcclxuXHRcdFx0XHRuZXdDb250ZXh0LnRlbXBsYXRlID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcclxuXHRcdFx0XHRuZXdDb250ZXh0LnRlbXBsYXRlLl9lbnN1cmVDb21waWxlZCgpO1xyXG5cdFx0XHRcdHRoaXMuX2NvbnRleHQgPSBuZXdDb250ZXh0O1xyXG5cclxuXHRcdFx0XHRTeXMuQXBwbGljYXRpb24uX2xpbmtDb250ZXh0cyhwY3R4LCB0aGlzLCBwY3R4LmRhdGFJdGVtLCB0aGlzLl9lbGVtZW50LCBuZXdDb250ZXh0LCB0aGlzLl9jb250ZW50VGVtcGxhdGUpO1xyXG5cclxuXHRcdFx0XHRuZXdDb250ZXh0LmluaXRpYWxpemVDb21wb25lbnRzKCk7XHJcblx0XHRcdFx0bmV3Q29udGV4dC5fb25JbnN0YW50aWF0ZWQobnVsbCwgdHJ1ZSk7XHJcblx0XHRcdFx0dGhpcy5zZXRfc3RhdGUoXCJvblwiKTtcclxuXHRcdFx0XHRqUXVlcnkodGhpcy5fZWxlbWVudCkuc2hvdygpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMuc2V0X3N0YXRlKFwib2ZmXCIpO1xyXG5cdFx0XHRcdGpRdWVyeSh0aGlzLl9lbGVtZW50KS5oaWRlKCk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRpbml0X3JlbmRlcjogZnVuY3Rpb24gVG9nZ2xlJGluaXRfcmVuZGVyKCkge1xyXG5cdFx0XHRpZiAoIXRoaXMuX3RlbXBsYXRlICYmICFqUXVlcnkodGhpcy5fZWxlbWVudCkuaXMoXCIuc3lzLXRlbXBsYXRlXCIpKSB7XHJcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiV2hlbiB1c2luZyB0b2dnbGUgaW4gcmVuZGVyL2Rpc3Bvc2UgbW9kZSwgdGhlIGVsZW1lbnQgc2hvdWxkIGJlIG1hcmtlZCB3aXRoIHRoZSBcXFwic3lzLXRlbXBsYXRlXFxcIiBjbGFzcy5cIik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMuX3RlbXBsYXRlID0gbmV3IFN5cy5VSS5UZW1wbGF0ZSh0aGlzLl9lbGVtZW50KTtcclxuXHRcdFx0dGhpcy5fdGVtcGxhdGUuX2Vuc3VyZUNvbXBpbGVkKCk7XHJcblx0XHRcdGpRdWVyeSh0aGlzLl9lbGVtZW50KS5lbXB0eSgpO1xyXG5cdFx0XHRqUXVlcnkodGhpcy5fZWxlbWVudCkucmVtb3ZlQ2xhc3MoXCJzeXMtdGVtcGxhdGVcIik7XHJcblx0XHR9LFxyXG5cdFx0ZG9fcmVuZGVyOiBmdW5jdGlvbiBUb2dnbGUkZG9fcmVuZGVyKCkge1xyXG5cdFx0XHRpZiAoIXRoaXMuZ2V0X3JlbmRlck9ubHkoKSlcclxuXHRcdFx0XHRqUXVlcnkodGhpcy5fZWxlbWVudCkuc2hvdygpO1xyXG5cclxuXHRcdFx0aWYgKCF0aGlzLl9jb250ZXh0KSB7XHJcblx0XHRcdFx0dmFyIHBjdHggPSB0aGlzLmdldF90ZW1wbGF0ZUNvbnRleHQoKTtcclxuXHJcblx0XHRcdFx0dmFyIHJlbmRlckFyZ3MgPSBuZXcgU3lzLkRhdGEuRGF0YUV2ZW50QXJncyhwY3R4LmRhdGFJdGVtKTtcclxuXHRcdFx0XHRTeXMuT2JzZXJ2ZXIucmFpc2VFdmVudCh0aGlzLCBcInJlbmRlcmluZ1wiLCByZW5kZXJBcmdzKTtcclxuXHJcblx0XHRcdFx0alF1ZXJ5KHRoaXMuX2VsZW1lbnQpLmVtcHR5KCk7XHJcblxyXG5cdFx0XHRcdHZhciBjb250ZXh0ID0gdGhpcy5fY29udGV4dCA9IHRoaXMuX3RlbXBsYXRlLmluc3RhbnRpYXRlSW4odGhpcy5fZWxlbWVudCwgcGN0eC5kYXRhSXRlbSwgcGN0eC5kYXRhSXRlbSwgMCwgbnVsbCwgcGN0eCwgdGhpcy5fY29udGVudFRlbXBsYXRlKTtcclxuXHRcdFx0XHRjb250ZXh0LmluaXRpYWxpemVDb21wb25lbnRzKCk7XHJcblxyXG5cdFx0XHRcdFN5cy5PYnNlcnZlci5yYWlzZUV2ZW50KHRoaXMsIFwicmVuZGVyZWRcIiwgcmVuZGVyQXJncyk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMuc2V0X3N0YXRlKFwib25cIik7XHJcblx0XHR9LFxyXG5cdFx0ZG9fZGlzcG9zZTogZnVuY3Rpb24gVG9nZ2xlJGRvX2Rpc3Bvc2UoKSB7XHJcblx0XHRcdGlmICghdGhpcy5nZXRfcmVuZGVyT25seSgpKVxyXG5cdFx0XHRcdGpRdWVyeSh0aGlzLl9lbGVtZW50KS5oaWRlKCk7XHJcblxyXG5cdFx0XHRpZiAodGhpcy5fY29udGV4dCkge1xyXG5cdFx0XHRcdHZhciByZW5kZXJBcmdzID0gbmV3IFN5cy5EYXRhLkRhdGFFdmVudEFyZ3MoKTtcclxuXHRcdFx0XHRTeXMuT2JzZXJ2ZXIucmFpc2VFdmVudCh0aGlzLCBcInJlbmRlcmluZ1wiLCByZW5kZXJBcmdzKTtcclxuXHJcblx0XHRcdFx0dGhpcy5fY29udGV4dC5kaXNwb3NlKCk7XHJcblx0XHRcdFx0dGhpcy5fY29udGV4dCA9IG51bGw7XHJcblxyXG5cdFx0XHRcdGpRdWVyeSh0aGlzLl9lbGVtZW50KS5lbXB0eSgpO1xyXG5cclxuXHRcdFx0XHRTeXMuT2JzZXJ2ZXIucmFpc2VFdmVudCh0aGlzLCBcInJlbmRlcmVkXCIsIHJlbmRlckFyZ3MpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0aGlzLnNldF9zdGF0ZShcIm9mZlwiKTtcclxuXHRcdH0sXHJcblx0XHRhZGRfcmVuZGVyaW5nOiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9hZGRIYW5kbGVyKFwicmVuZGVyaW5nXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHRcdHJlbW92ZV9yZW5kZXJpbmc6IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUhhbmRsZXIoXCJyZW5kZXJpbmdcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0YWRkX3JlbmRlcmVkOiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9hZGRIYW5kbGVyKFwicmVuZGVyZWRcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0cmVtb3ZlX3JlbmRlcmVkOiBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9yZW1vdmVIYW5kbGVyKFwicmVuZGVyZWRcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIGFkZENsYXNzIC8gcmVtb3ZlQ2xhc3NcclxuXHRcdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHRcdGRvX2FkZENsYXNzOiBmdW5jdGlvbiBUb2dnbGUkZG9fYWRkQ2xhc3MoKSB7XHJcblx0XHRcdHZhciAkZWwgPSBqUXVlcnkodGhpcy5fZWxlbWVudCk7XHJcblxyXG5cdFx0XHRpZiAoISRlbC5pcyhcIi5cIiArIHRoaXMuX2NsYXNzTmFtZSkpIHtcclxuXHRcdFx0XHQkZWwuYWRkQ2xhc3ModGhpcy5fY2xhc3NOYW1lKTtcclxuXHRcdFx0XHR0aGlzLnNldF9zdGF0ZShcIm9uXCIpO1xyXG5cdFx0XHRcdFN5cy5PYnNlcnZlci5yYWlzZUV2ZW50KHRoaXMsIFwiY2xhc3NBZGRlZFwiKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdGRvX3JlbW92ZUNsYXNzOiBmdW5jdGlvbiBUb2dnbGUkZG9fcmVtb3ZlQ2xhc3MoKSB7XHJcblx0XHRcdHZhciAkZWwgPSBqUXVlcnkodGhpcy5fZWxlbWVudCk7XHJcblxyXG5cdFx0XHRpZiAoJGVsLmlzKFwiLlwiICsgdGhpcy5fY2xhc3NOYW1lKSkge1xyXG5cdFx0XHRcdCRlbC5yZW1vdmVDbGFzcyh0aGlzLl9jbGFzc05hbWUpO1xyXG5cdFx0XHRcdHRoaXMuc2V0X3N0YXRlKFwib2ZmXCIpO1xyXG5cdFx0XHRcdFN5cy5PYnNlcnZlci5yYWlzZUV2ZW50KHRoaXMsIFwiY2xhc3NSZW1vdmVkXCIpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0YWRkX2NsYXNzQWRkZWQ6IGZ1bmN0aW9uIFRvZ2dsZSRhZGRfY2xhc3NBZGRlZChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX2FkZEhhbmRsZXIoXCJjbGFzc0FkZGVkXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHRcdHJlbW92ZV9jbGFzc0FkZGVkOiBmdW5jdGlvbiBUb2dnbGUkcmVtb3ZlX2NsYXNzQWRkZWQoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9yZW1vdmVIYW5kbGVyKFwiY2xhc3NBZGRlZFwiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRhZGRfY2xhc3NSZW1vdmVkOiBmdW5jdGlvbiBUb2dnbGUkYWRkX2NsYXNzUmVtb3ZlZChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX2FkZEhhbmRsZXIoXCJjbGFzc1JlbW92ZWRcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0cmVtb3ZlX2NsYXNzUmVtb3ZlZDogZnVuY3Rpb24gVG9nZ2xlJHJlbW92ZV9jbGFzc1JlbW92ZWQoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9yZW1vdmVIYW5kbGVyKFwiY2xhc3NSZW1vdmVkXCIsIGhhbmRsZXIpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHQvLyBJbnZlcnNlIEFjdGlvbnNcclxuXHRUb2dnbGUubWl4aW4oe1xyXG5cdFx0Ly8gSGlkZS9TaG93XHJcblx0XHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0XHRsaW5rX2hpZGU6IFRvZ2dsZS5wcm90b3R5cGUubGlua19zaG93LFxyXG5cdFx0aW5pdF9oaWRlOiBUb2dnbGUucHJvdG90eXBlLmluaXRfc2hvdyxcclxuXHRcdHVuZG9faGlkZTogVG9nZ2xlLnByb3RvdHlwZS5kb19zaG93LFxyXG5cdFx0dW5kb19zaG93OiBUb2dnbGUucHJvdG90eXBlLmRvX2hpZGUsXHJcblxyXG5cdFx0Ly8gRW5hYmxlL0Rpc2FibGVcclxuXHRcdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHRcdGxpbmtfZW5hYmxlZDogVG9nZ2xlLnByb3RvdHlwZS5saW5rX2Rpc2FibGUsXHJcblx0XHRpbml0X2Rpc2FibGU6IFRvZ2dsZS5wcm90b3R5cGUuaW5pdF9lbmFibGUsXHJcblx0XHR1bmRvX2Rpc2FibGU6IFRvZ2dsZS5wcm90b3R5cGUuZG9fZW5hYmxlLFxyXG5cdFx0dW5kb19lbmFibGU6IFRvZ2dsZS5wcm90b3R5cGUuZG9fZGlzYWJsZSxcclxuXHJcblx0XHQvLyBSZW5kZXIvRGlzcG9zZVxyXG5cdFx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cdFx0bGlua19kaXNwb3NlOiBUb2dnbGUucHJvdG90eXBlLmxpbmtfcmVuZGVyLFxyXG5cdFx0aW5pdF9kaXNwb3NlOiBUb2dnbGUucHJvdG90eXBlLmluaXRfcmVuZGVyLFxyXG5cdFx0dW5kb19yZW5kZXI6IFRvZ2dsZS5wcm90b3R5cGUuZG9fZGlzcG9zZSxcclxuXHRcdHVuZG9fZGlzcG9zZTogVG9nZ2xlLnByb3RvdHlwZS5kb19yZW5kZXIsXHJcblxyXG5cdFx0Ly8gYWRkQ2xhc3MvcmVtb3ZlQ2xhc3NcclxuXHRcdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHRcdHVuZG9fYWRkQ2xhc3M6IFRvZ2dsZS5wcm90b3R5cGUuZG9fcmVtb3ZlQ2xhc3MsXHJcblx0XHR1bmRvX3JlbW92ZUNsYXNzOiBUb2dnbGUucHJvdG90eXBlLmRvX2FkZENsYXNzXHJcblx0fSk7XHJcblxyXG5cdFRvZ2dsZS5taXhpbih7XHJcblx0XHRfZ2VuZXJhdGVzQ29udGV4dDogZnVuY3Rpb24gVG9nZ2xlJF9nZW5lcmF0ZXNDb250ZXh0KCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uID09PSBcInJlbmRlclwiIHx8IHRoaXMuX2FjdGlvbiA9PT0gXCJkaXNwb3NlXCI7XHJcblx0XHR9LFxyXG5cdFx0X2dldFRlbXBsYXRlOiBmdW5jdGlvbiBUb2dnbGUkX2dldFRlbXBsYXRlKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fdGVtcGxhdGU7XHJcblx0XHR9LFxyXG5cdFx0X3NldFRlbXBsYXRlOiBmdW5jdGlvbiBUb2dnbGUkX3NldFRlbXBsYXRlKHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX3RlbXBsYXRlID0gdmFsdWU7XHJcblx0XHR9LFxyXG5cdFx0X3NldFRlbXBsYXRlQ3R4SWQ6IGZ1bmN0aW9uIFRvZ2dsZSRfc2V0VGVtcGxhdGVDdHhJZChpZHgpIHtcclxuXHRcdFx0dGhpcy5fY3R4SWR4ID0gaWR4O1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfdGVtcGxhdGVDb250ZXh0OiBmdW5jdGlvbiBUb2dnbGUkZ2V0X3RlbXBsYXRlQ29udGV4dCgpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSBtYXlCZU51bGw9XCJmYWxzZVwiIHR5cGU9XCJTeXMuVUkuVGVtcGxhdGVDb250ZXh0XCIgbG9jaWQ9XCJQOkojRXhvV2ViLlVJLlRvZ2dsZS50ZW1wbGF0ZUNvbnRleHRcIj48L3ZhbHVlPlxyXG5cdFx0XHRpZiAoIXRoaXMuX3BhcmVudENvbnRleHQpIHtcclxuXHRcdFx0XHR0aGlzLl9wYXJlbnRDb250ZXh0ID0gU3lzLlVJLlRlbXBsYXRlLmZpbmRDb250ZXh0KHRoaXMuX2VsZW1lbnQpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiB0aGlzLl9wYXJlbnRDb250ZXh0O1xyXG5cdFx0fSxcclxuXHRcdHNldF90ZW1wbGF0ZUNvbnRleHQ6IGZ1bmN0aW9uIFRvZ2dsZSRzZXRfdGVtcGxhdGVDb250ZXh0KHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX3BhcmVudENvbnRleHQgPSB2YWx1ZTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0X2FjdGlvbjogZnVuY3Rpb24gVG9nZ2xlJGdldF9hY3Rpb24oKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeT5cclxuXHRcdFx0Ly8vIFRoZSB2YWx1ZSB0aGF0IGRldGVybWluZXMgd2hhdCB0aGUgY29udHJvbCBzaG91bGRcclxuXHRcdFx0Ly8vIGRvIHdoZW4gaXRzIHN0YXRlIGNoYW5nZXMuIElnbm9yZWQgaWYgdGhlIGNsYXNzIHByb3BlcnR5IGlzIHNldFxyXG5cdFx0XHQvLy8gT3B0aW9uczogIHNob3csIGhpZGUsIGVuYWJsZSwgZGlzYWJsZSwgcmVuZGVyLCBkaXNwb3NlLCBhZGRDbGFzcywgcmVtb3ZlQ2xhc3NcclxuXHRcdFx0Ly8vIDwvc3VtbWFyeT5cclxuXHJcblx0XHRcdHJldHVybiB0aGlzLl9hY3Rpb247XHJcblx0XHR9LFxyXG5cdFx0c2V0X2FjdGlvbjogZnVuY3Rpb24gVG9nZ2xlJHNldF9hY3Rpb24odmFsdWUpIHtcclxuXHRcdFx0aWYgKCFBcnJheS5jb250YWlucyhUb2dnbGVfYWxsb3dlZEFjdGlvbnMsIHZhbHVlKSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcigkZm9ybWF0KFwiSW52YWxpZCB0b2dnbGUgYWN0aW9uIFxcXCJ7MH1cXFwiLiAgUG9zc2libGUgdmFsdWVzIGFyZSBcXFwiezF9XFxcIi5cIiwgdmFsdWUsIFRvZ2dsZV9hbGxvd2VkQWN0aW9ucy5qb2luKFwiLCBcIikpKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dGhpcy5fYWN0aW9uID0gdmFsdWU7XHJcblx0XHRcdHRoaXMuZXhlY3V0ZSgpO1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfcmVuZGVyT25seTogZnVuY3Rpb24gVG9nZ2xlJGdldF9yZW5kZXJPbmx5KCkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnk+XHJcblx0XHRcdC8vLyBJZiB0cnVlLCByZW5kZXIvZGlzcG9zZSB3aWxsIG5vdCBoaWRlL3Nob3cgdGhlIGVsZW1lbnRcclxuXHRcdFx0Ly8vIDwvc3VtbWFyeT5cclxuXHJcblx0XHRcdHJldHVybiB0aGlzLl9yZW5kZXJPbmx5O1xyXG5cdFx0fSxcclxuXHRcdHNldF9yZW5kZXJPbmx5OiBmdW5jdGlvbiBUb2dnbGUkc2V0X3JlbmRlck9ubHkodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fcmVuZGVyT25seSA9IHZhbHVlO1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfY2xhc3NOYW1lOiBmdW5jdGlvbiBUb2dnbGUkZ2V0X2NsYXNzTmFtZSgpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5PlxyXG5cdFx0XHQvLy8gQ2xhc3MgdG8gYWRkIG9yIHJlbW92ZVxyXG5cdFx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX2NsYXNzTmFtZTtcclxuXHRcdH0sXHJcblx0XHRzZXRfY2xhc3NOYW1lOiBmdW5jdGlvbiBUb2dnbGUkc2V0X2NsYXNzTmFtZSh2YWx1ZSkge1xyXG5cdFx0XHR0aGlzLl9jbGFzc05hbWUgPSB2YWx1ZTtcclxuXHRcdFx0aWYgKCF0aGlzLl9hY3Rpb24pXHJcblx0XHRcdFx0dGhpcy5fYWN0aW9uID0gXCJhZGRDbGFzc1wiO1xyXG5cdFx0XHR0aGlzLmV4ZWN1dGUoKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gTk9URTogS2VlcCB0aGVzZSBwcm9wZXJ0aWVzIGFyb3VuZCBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuXHJcblx0XHRnZXRfY2xhc3M6IGZ1bmN0aW9uIFRvZ2dsZSRnZXRfY2xhc3MoKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeT5cclxuXHRcdFx0Ly8vIENsYXNzIHRvIGFkZCBvciByZW1vdmVcclxuXHRcdFx0Ly8vIDwvc3VtbWFyeT5cclxuXHJcblx0XHRcdGxvZ1dhcm5pbmcoXCJUaGUgdG9nZ2xlOmNsYXNzIHByb3BlcnR5IGlzIGRlcHJlY2F0ZWQgKHNlZSBpc3N1ZSAjMSkuIENvbnNpZGVyIHVzaW5nIHRvZ2dsZTpjbGFzc25hbWUgaW5zdGVhZC5cIik7XHJcblxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fY2xhc3NOYW1lO1xyXG5cdFx0fSxcclxuXHRcdHNldF9jbGFzczogZnVuY3Rpb24gVG9nZ2xlJHNldF9jbGFzcyh2YWx1ZSkge1xyXG5cdFx0XHRsb2dXYXJuaW5nKFwiVGhlIHRvZ2dsZTpjbGFzcyBwcm9wZXJ0eSBpcyBkZXByZWNhdGVkIChzZWUgaXNzdWUgIzEpLiBDb25zaWRlciB1c2luZyB0b2dnbGU6Y2xhc3NuYW1lIGluc3RlYWQuXCIpO1xyXG5cclxuXHRcdFx0dGhpcy5fY2xhc3NOYW1lID0gdmFsdWU7XHJcblx0XHRcdGlmICghdGhpcy5fYWN0aW9uKVxyXG5cdFx0XHRcdHRoaXMuX2FjdGlvbiA9IFwiYWRkQ2xhc3NcIjtcclxuXHRcdFx0dGhpcy5leGVjdXRlKCk7XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldF9vbjogZnVuY3Rpb24gVG9nZ2xlJGdldF9vbigpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5PlxyXG5cdFx0XHQvLy8gVGhlIHZhbHVlIHRoYXQgdGhlIGNvbnRyb2wgd2lsbCB3YXRjaCB0byBkZXRlcm1pbmVcclxuXHRcdFx0Ly8vIHdoZW4gaXRzIHN0YXRlIHNob3VsZCBjaGFuZ2UuXHJcblx0XHRcdC8vLyA8L3N1bW1hcnk+XHJcblxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fb247XHJcblx0XHR9LFxyXG5cdFx0c2V0X29uOiBmdW5jdGlvbiBUb2dnbGUkc2V0X29uKHZhbHVlKSB7XHJcblx0XHRcdHZhciBjaGFuZ2VkID0gdmFsdWUgIT09IHRoaXMuX29uO1xyXG5cclxuXHRcdFx0aWYgKGNoYW5nZWQpIHtcclxuXHRcdFx0XHRpZiAodGhpcy5fb24gJiYgdGhpcy5fb24gaW5zdGFuY2VvZiBBcnJheSkge1xyXG5cdFx0XHRcdFx0T2JzZXJ2ZXIucmVtb3ZlQ29sbGVjdGlvbkNoYW5nZWQodGhpcy5fb24sIHRoaXMuX2NvbGxlY3Rpb25DaGFuZ2VkSGFuZGxlcik7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHR0aGlzLl9vbiA9IHZhbHVlO1xyXG5cclxuXHRcdFx0XHRpZiAodGhpcy5fb24gJiYgdGhpcy5fb24gaW5zdGFuY2VvZiBBcnJheSkge1xyXG5cdFx0XHRcdFx0dGhpcy5fY29sbGVjdGlvbkNoYW5nZWRIYW5kbGVyID0gdGhpcy5leGVjdXRlLmJpbmQodGhpcyk7XHJcblx0XHRcdFx0XHRPYnNlcnZlci5hZGRDb2xsZWN0aW9uQ2hhbmdlZCh0aGlzLl9vbiwgdGhpcy5fY29sbGVjdGlvbkNoYW5nZWRIYW5kbGVyKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHRoaXMuZXhlY3V0ZSgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKHRoaXMuX3doZW4gJiYgdGhpcy5fd2hlbiBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcblx0XHRcdFx0dGhpcy5fb24gPSB2YWx1ZTtcclxuXHRcdFx0XHR0aGlzLmV4ZWN1dGUoKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfd2hlbjogZnVuY3Rpb24gVG9nZ2xlJGdldF93aGVuKCkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnk+XHJcblx0XHRcdC8vLyBUaGUgdmFsdWUgdG8gY29tcGFyZSBcIm9uXCIgdG8sIHRoaXMgd2lsbCBtb3N0IGxpa2VseSBcclxuXHRcdFx0Ly8vIGJlIGEgc3RhdGljIHZhbHVlLCBsaWtlIHRydWUgb3IgZmFsc2UuXHJcblx0XHRcdC8vLyA8L3N1bW1hcnk+XHJcblxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fd2hlbjtcclxuXHRcdH0sXHJcblx0XHRzZXRfd2hlbjogZnVuY3Rpb24gVG9nZ2xlJHNldF93aGVuKHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX3doZW4gPSB2YWx1ZTtcclxuXHRcdFx0dGhpcy5leGVjdXRlKCk7XHJcblx0XHR9LFxyXG5cclxuXHRcdHNldF9zdHJpY3RNb2RlOiBmdW5jdGlvbiBUb2dnbGUkc2V0X3N0cmljdE1vZGUodmFsdWUpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5PlxyXG5cdFx0XHQvLy8gSWYgdHJ1ZSwgdGhlIFwib25cIiB2YWx1ZSB3aWxsIGJlIHN0cmljdGx5IGNvbXBhcmVkXHJcblx0XHRcdC8vLyB0byB0aGUgXCJ3aGVuXCIgdmFsdWUuICBPdGhlcndpc2UsIGlmIFwid2hlblwiIGlzIHVuZGVmaW5lZFxyXG5cdFx0XHQvLy8gdGhlIFwib25cIiB2YWx1ZSB3aWxsIGJlIGNoZWNrZWQgZm9yIHRydXRoaW5lc3MuXHJcblx0XHRcdC8vLyA8L3N1bW1hcnk+XHJcblxyXG5cdFx0XHR0aGlzLl9zdHJpY3RNb2RlID0gdmFsdWU7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X3N0cmljdE1vZGU6IGZ1bmN0aW9uIFRvZ2dsZSRnZXRfc3RyaWN0TW9kZSgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX3N0cmljdE1vZGU7XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldF9ncm91cE5hbWU6IGZ1bmN0aW9uIFRvZ2dsZSRnZXRfZ3JvdXBOYW1lKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fZ3JvdXBOYW1lO1xyXG5cdFx0fSxcclxuXHRcdHNldF9ncm91cE5hbWU6IGZ1bmN0aW9uIFRvZ2dsZSRzZXRfZ3JvdXBOYW1lKHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX2dyb3VwTmFtZSA9IHZhbHVlO1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfZWZmZWN0OiBmdW5jdGlvbiBUb2dnbGUkZ2V0X2VmZmVjdCgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2VmZmVjdDtcclxuXHRcdH0sXHJcblx0XHRzZXRfZWZmZWN0OiBmdW5jdGlvbiBUb2dnbGUkc2V0X2VmZmVjdCh2YWx1ZSkge1xyXG5cdFx0XHR0aGlzLl9lZmZlY3QgPSB2YWx1ZTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0X3N0YXRlOiBmdW5jdGlvbiBUb2dnbGUkZ2V0X3N0YXRlKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fc3RhdGU7XHJcblx0XHR9LFxyXG5cdFx0c2V0X3N0YXRlOiBmdW5jdGlvbiBUb2dnbGUkc2V0X3N0YXRlKHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX3N0YXRlID0gdmFsdWU7XHJcblx0XHRcdHRoaXMuX3N0YXRlQ2xhc3ModmFsdWUpO1xyXG5cdFx0XHRTeXMuT2JzZXJ2ZXIucmFpc2VFdmVudCh0aGlzLCB2YWx1ZSk7XHJcblx0XHR9LFxyXG5cclxuXHRcdGVxdWFsczogZnVuY3Rpb24gVG9nZ2xlJGVxdWFscygpIHtcclxuXHRcdFx0aWYgKHRoaXMuX3doZW4gPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdC8vIFdoZW4gaXMgbm90IGRlZmluZWQsIHNvIGNvbmRpdGlvbiBkZXBlbmRzIGVudGlyZWx5IG9uIFwib25cIiBwcm9wZXJ0eVxyXG5cdFx0XHRcdHZhciBvblR5cGUgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodGhpcy5fb24pO1xyXG5cclxuXHRcdFx0XHRpZiAodGhpcy5fc3RyaWN0TW9kZSA9PT0gdHJ1ZSkge1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMuX29uLmNvbnN0cnVjdG9yICE9PSBCb29sZWFuKVxyXG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJXaXRoIHN0cmljdCBtb2RlIGVuYWJsZWQsIHRvZ2dsZTpvbiBzaG91bGQgYmUgYSB2YWx1ZSBvZiB0eXBlIEJvb2xlYW4uXCIpO1xyXG5cclxuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9vbjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSBpZiAob25UeXBlID09PSBcIltvYmplY3QgQXJyYXldXCIpIHtcclxuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9vbi5sZW5ndGggPiAwO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdC8vIERlZmF1bHQgY2FzZSB3aGVuIG5vdCBpbiBzdHJpY3QgbW9kZSBpcyB0cnV0aGluZXNzLlxyXG5cdFx0XHRcdFx0cmV0dXJuICEhdGhpcy5fb247XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKHRoaXMuX3doZW4gaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG5cdFx0XHRcdHZhciByZXN1bHQgPSB0aGlzLl93aGVuKHRoaXMuX29uKTtcclxuXHRcdFx0XHRpZiAodGhpcy5fc3RyaWN0TW9kZSA9PT0gdHJ1ZSkge1xyXG5cdFx0XHRcdFx0aWYgKHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHVuZGVmaW5lZCB8fCByZXN1bHQuY29uc3RydWN0b3IgIT09IEJvb2xlYW4pXHJcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIldpdGggc3RyaWN0IG1vZGUgZW5hYmxlZCwgdG9nZ2xlOndoZW4gZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhIHZhbHVlIG9mIHR5cGUgQm9vbGVhbi5cIik7XHJcblx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHJldHVybiAhIXJlc3VsdDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0cmV0dXJuIHRoaXMuX29uID09PSB0aGlzLl93aGVuO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cclxuXHRcdGNhbkV4ZWN1dGU6IGZ1bmN0aW9uIFRvZ2dsZSRjYW5FeGVjdXRlKCkge1xyXG5cdFx0XHQvLyBFbnN1cmUgdGhhdCB0aGUgY29udHJvbCBpcyBpbml0aWFsaXplZCwgaGFzIGFuIGVsZW1lbnQsIGFuZCB0aGUgXCJvblwiIHByb3BlcnR5IGhhcyBiZWVuIHNldC5cclxuXHRcdFx0Ly8gU2NlbmFyaW8gMTogIFRoZSBzZXRfb24gb3Igc2V0X3doZW4gbWV0aG9kcyBtYXkgYmUgY2FsbGVkIGJlZm9yZSB0aGUgY29udHJvbCBoYXMgYmVlbiBpbml0aWFsaXplZC5cclxuXHRcdFx0Ly8gU2NlbmFyaW8gMjogIElmIGEgbGF6eSBtYXJrdXAgZXh0ZW5zaW9uIGlzIHVzZWQgdG8gc2V0IHRoZSBcIm9uXCIgb3IgXCJ3aGVuXCIgcHJvcGVydGllcyB0aGVuIGEgY2FsbGJhY2sgY291bGQgc2V0IHRoZSBcclxuXHRcdFx0Ly9cdFx0XHRcdHByb3BlcnR5IHZhbHVlIHdoZW4gdGhlIGVsZW1lbnQgaXMgdW5kZWZpbmVkLCBwb3NzaWJseSBiZWNhdXNlIG9mIHRlbXBsYXRlIHJlLXJlbmRlcmluZy5cclxuXHRcdFx0Ly8gU2NlbmFyaW8gMzogIElmIGEgbGF6eSBtYXJrdXAgZXh0ZW5zaW9uIGlzIHVzZWQgdG8gc2V0IHRoZSBcIm9uXCIgcHJvcGVydHkgdGhlbiBpdCBtYXkgbm90IGhhdmUgYSB2YWx1ZSB3aGVuIGluaXRpYWxpemVkLlxyXG5cdFx0XHRyZXR1cm4gdGhpcy5nZXRfaXNJbml0aWFsaXplZCgpICYmIHRoaXMuX2VsZW1lbnQgIT09IHVuZGVmaW5lZCAmJiB0aGlzLl9lbGVtZW50ICE9PSBudWxsICYmIHRoaXMuaGFzT3duUHJvcGVydHkoXCJfb25cIik7XHJcblx0XHR9LFxyXG5cdFx0ZXhlY3V0ZTogZnVuY3Rpb24gVG9nZ2xlJGV4ZWN1dGUoKSB7XHJcblx0XHRcdGlmICh0aGlzLmNhbkV4ZWN1dGUoKSkge1xyXG5cdFx0XHRcdHZhciBhY3Rpb24gPSB0aGlzWyh0aGlzLmVxdWFscygpID09PSB0cnVlID8gXCJkb19cIiA6IFwidW5kb19cIikgKyB0aGlzLl9hY3Rpb25dLmJpbmQodGhpcyk7XHJcblx0XHRcdFx0aWYgKHRoaXMuX3BlbmRpbmdFdmVudEFyZ3MpIHtcclxuXHRcdFx0XHRcdHRoaXMuX3BlbmRpbmdBY3Rpb25zLmFkZChhY3Rpb24sIChmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiAhdGhpcy5fcGVuZGluZ0V2ZW50QXJncztcclxuXHRcdFx0XHRcdH0pLmJpbmQodGhpcyksIHRydWUpO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRhY3Rpb24oKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRhZGRDb250ZW50VGVtcGxhdGU6IGZ1bmN0aW9uIFRvZ2dsZSRhZGRDb250ZW50VGVtcGxhdGUodG1wbCkge1xyXG5cdFx0XHRpZiAodGhpcy5fYWN0aW9uICE9PSBcInJlbmRlclwiICYmIHRoaXMuX2FjdGlvbiAhPT0gXCJkaXNwb3NlXCIgJiYgdGhpcy5nZXRfdGVtcGxhdGVDb250ZXh0KCkgPT09IFN5cy5BcHBsaWNhdGlvbi5fY29udGV4dCkge1xyXG5cdFx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oXCJpbnZhbGlkU3lzQ29udGVudFRlbXBsYXRlXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdFN5cy5VSS5JQ29udGVudFRlbXBsYXRlQ29uc3VtZXIucHJvdG90eXBlLmFkZENvbnRlbnRUZW1wbGF0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0fSxcclxuXHRcdGRpc3Bvc2U6IGZ1bmN0aW9uIEV4b1dlYiRVSSRUb2dnbGUkZGlzcG9zZSgpIHtcclxuXHRcdFx0aWYgKHRoaXMuX3RlbXBsYXRlKSB7XHJcblx0XHRcdFx0dGhpcy5fdGVtcGxhdGUuZGlzcG9zZSgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh0aGlzLl9jb250ZXh0KSB7XHJcblx0XHRcdFx0dGhpcy5fY29udGV4dC5kaXNwb3NlKCk7XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5fYWN0aW9uID0gdGhpcy5fY2xhc3NOYW1lID0gdGhpcy5fY29sbGVjdGlvbkNoYW5nZWRIYW5kbGVyID0gdGhpcy5fY29udGVudFRlbXBsYXRlID1cclxuXHRcdFx0XHR0aGlzLl9jb250ZXh0ID0gdGhpcy5fY3R4SWR4ID0gdGhpcy5fZ3JvdXBOYW1lID0gdGhpcy5fb24gPSB0aGlzLl9wYXJlbnRDb250ZXh0ID1cclxuXHRcdFx0XHR0aGlzLl9zdGF0ZSA9IHRoaXMuX3N0cmljdE1vZGUgPSB0aGlzLl90ZW1wbGF0ZSA9IHRoaXMuX3Zpc2libGUgPSB0aGlzLl93aGVuID0gbnVsbDtcclxuXHRcdFx0RXhvV2ViLlVJLlRvZ2dsZS5jYWxsQmFzZU1ldGhvZCh0aGlzLCBcImRpc3Bvc2VcIik7XHJcblx0XHR9LFxyXG5cdFx0bGluazogZnVuY3Rpb24gVG9nZ2xlJGxpbmsoKSB7XHJcblx0XHRcdC8vIFBlcmZvcm0gY3VzdG9tIGxpbmsgbG9naWMgZm9yIHRoZSBhY3Rpb25cclxuXHRcdFx0dmFyIGFjdGlvbkxpbmsgPSB0aGlzW1wibGlua19cIiArIHRoaXMuX2FjdGlvbl07XHJcblx0XHRcdGlmIChhY3Rpb25MaW5rKSB7XHJcblx0XHRcdFx0YWN0aW9uTGluay5jYWxsKHRoaXMpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRFeG9XZWIuVUkuVG9nZ2xlLmNhbGxCYXNlTWV0aG9kKHRoaXMsIFwibGlua1wiKTtcclxuXHRcdH0sXHJcblx0XHRpbml0aWFsaXplOiBmdW5jdGlvbiBUb2dnbGUkaW5pdGlhbGl6ZSgpIHtcclxuXHRcdFx0VG9nZ2xlLmNhbGxCYXNlTWV0aG9kKHRoaXMsIFwiaW5pdGlhbGl6ZVwiKTtcclxuXHJcblx0XHRcdHRoaXMuX3BlbmRpbmdBY3Rpb25zID0gbmV3IEV4b1dlYi5GdW5jdG9yKCk7XHJcblxyXG5cdFx0XHRpZiAodGhpcy5nZXRfaXNMaW5rUGVuZGluZygpKSB7XHJcblx0XHRcdFx0dGhpcy5saW5rKCk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0Ly8gUGVyZm9ybSBjdXN0b20gaW5pdCBsb2dpYyBmb3IgdGhlIGFjdGlvblxyXG5cdFx0XHRcdHZhciBhY3Rpb25Jbml0ID0gdGhpc1tcImluaXRfXCIgKyB0aGlzLl9hY3Rpb25dO1xyXG5cdFx0XHRcdGlmIChhY3Rpb25Jbml0KSB7XHJcblx0XHRcdFx0XHRhY3Rpb25Jbml0LmNhbGwodGhpcyk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHR0aGlzLmV4ZWN1dGUoKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdF9zdGF0ZUNsYXNzOiBmdW5jdGlvbiAoc3RhdGUpIHtcclxuXHRcdFx0aWYgKHN0YXRlID09IFwib25cIilcclxuXHRcdFx0XHRqUXVlcnkodGhpcy5fZWxlbWVudCkuYWRkQ2xhc3MoXCJ0b2dnbGUtb25cIikucmVtb3ZlQ2xhc3MoXCJ0b2dnbGUtb2ZmXCIpO1xyXG5cdFx0XHRlbHNlXHJcblx0XHRcdFx0alF1ZXJ5KHRoaXMuX2VsZW1lbnQpLnJlbW92ZUNsYXNzKFwidG9nZ2xlLW9uXCIpLmFkZENsYXNzKFwidG9nZ2xlLW9mZlwiKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0RXhvV2ViLlVJLlRvZ2dsZSA9IFRvZ2dsZTtcclxuXHRUb2dnbGUucmVnaXN0ZXJDbGFzcyhcIkV4b1dlYi5VSS5Ub2dnbGVcIiwgU3lzLlVJLkNvbnRyb2wsIFN5cy5VSS5JVGVtcGxhdGVDb250ZXh0Q29uc3VtZXIsIFN5cy5VSS5JQ29udGVudFRlbXBsYXRlQ29uc3VtZXIpO1xyXG5cclxuXHRmdW5jdGlvbiBBY3Rpb25FdmVudEFyZ3MoKSB7XHJcblx0XHR0aGlzLl9zaWduYWwgPSBuZXcgRXhvV2ViLlNpZ25hbCgpO1xyXG5cdFx0QWN0aW9uRXZlbnRBcmdzLmluaXRpYWxpemVCYXNlKHRoaXMpO1xyXG5cdH1cclxuXHJcblx0QWN0aW9uRXZlbnRBcmdzLnByb3RvdHlwZS5wZW5kaW5nID0gZnVuY3Rpb24gKGNhbGxiYWNrLCB0aGlzUHRyLCBleGVjdXRlSW1tZWRpYXRlbHkpIHtcclxuXHRcdHJldHVybiB0aGlzLl9zaWduYWwucGVuZGluZy5hcHBseSh0aGlzLl9zaWduYWwsIGFyZ3VtZW50cyk7XHJcblx0fVxyXG5cclxuXHRBY3Rpb25FdmVudEFyZ3MucHJvdG90eXBlLndhaXRGb3JBbGwgPSBmdW5jdGlvbiAoY2FsbGJhY2ssIHRoaXNQdHIsIGV4ZWN1dGVJbW1lZGlhdGVseSkge1xyXG5cdFx0dGhpcy5fc2lnbmFsLndhaXRGb3JBbGwuYXBwbHkodGhpcy5fc2lnbmFsLCBhcmd1bWVudHMpO1xyXG5cdH1cclxuXHJcblx0RXhvV2ViLlVJLkFjdGlvbkV2ZW50QXJncyA9IEFjdGlvbkV2ZW50QXJncztcclxuXHRBY3Rpb25FdmVudEFyZ3MucmVnaXN0ZXJDbGFzcyhcIkV4b1dlYi5VSS5BY3Rpb25FdmVudEFyZ3NcIiwgU3lzLkV2ZW50QXJncyk7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuVUkuVG9nZ2xlR3JvdXBcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHRmdW5jdGlvbiBUb2dnbGVHcm91cChlbGVtZW50KSB7XHJcblx0XHRUb2dnbGVHcm91cC5pbml0aWFsaXplQmFzZSh0aGlzLCBbZWxlbWVudF0pO1xyXG5cdH1cclxuXHJcblx0VG9nZ2xlR3JvdXAubWl4aW4oe1xyXG5cdFx0X2V4ZWN1dGU6IGZ1bmN0aW9uIFRvZ2dsZUdyb3VwJF9leGVjdXRlKCkge1xyXG5cdFx0XHRpZiAodGhpcy5fdmlzaWJsZS5sZW5ndGggPT09IDAgJiYgdGhpcy5fY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdGpRdWVyeSh0aGlzLl9lbGVtZW50KS5oaWRlKCk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0alF1ZXJ5KHRoaXMuX2VsZW1lbnQpLnNob3coKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdF90b2dnbGVBZGRlZDogZnVuY3Rpb24gVG9nZ2xlR3JvdXAkX3RvZ2dsZUFkZGVkKGlkeCwgZWxlbSkge1xyXG5cdFx0XHRpZiAoZWxlbS5jb250cm9sLmdldF9ncm91cE5hbWUoKSA9PT0gdGhpcy5fbmFtZSAmJiAhQXJyYXkuY29udGFpbnModGhpcy5fY2hpbGRyZW4sIGVsZW0pKSB7XHJcblx0XHRcdFx0dGhpcy5fY2hpbGRyZW4ucHVzaChlbGVtKTtcclxuXHJcblx0XHRcdFx0aWYgKGVsZW0uY29udHJvbC5nZXRfc3RhdGUoKSA9PT0gXCJvblwiKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9hZGQoZWxlbSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRlbGVtLmNvbnRyb2wuYWRkX29uKHRoaXMuX29uSGFuZGxlcik7XHJcblx0XHRcdFx0ZWxlbS5jb250cm9sLmFkZF9vZmYodGhpcy5fb2ZmSGFuZGxlcik7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRfdG9nZ2xlUmVtb3ZlZDogZnVuY3Rpb24gVG9nZ2xlR3JvdXAkX3RvZ2dsZVJlbW92ZWQoaWR4LCBlbGVtKSB7XHJcblx0XHRcdGlmIChBcnJheS5jb250YWlucyh0aGlzLl9jaGlsZHJlbiwgZWxlbSkpIHtcclxuXHRcdFx0XHRlbGVtLmNvbnRyb2wucmVtb3ZlX29uKHRoaXMuX29uSGFuZGxlcik7XHJcblx0XHRcdFx0ZWxlbS5jb250cm9sLnJlbW92ZV9vZmYodGhpcy5fb2ZmSGFuZGxlcik7XHJcblxyXG5cdFx0XHRcdHRoaXMuX3JlbW92ZShlbGVtKTtcclxuXHRcdFx0XHR0aGlzLl9jaGlsZHJlbi5yZW1vdmUoZWxlbSk7XHJcblx0XHRcdFx0dGhpcy5fZXhlY3V0ZSgpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0X3RvZ2dsZU9uOiBmdW5jdGlvbiBUb2dnbGVHcm91cCRfdG9nZ2xlT24oc2VuZGVyKSB7XHJcblx0XHRcdHRoaXMuX2FkZChzZW5kZXIuZ2V0X2VsZW1lbnQoKSk7XHJcblx0XHRcdHRoaXMuX2V4ZWN1dGUoKTtcclxuXHRcdH0sXHJcblx0XHRfdG9nZ2xlT2ZmOiBmdW5jdGlvbiBUb2dnbGVHcm91cCRfdG9nZ2xlT2ZmKHNlbmRlcikge1xyXG5cdFx0XHR0aGlzLl9yZW1vdmUoc2VuZGVyLmdldF9lbGVtZW50KCkpO1xyXG5cdFx0XHR0aGlzLl9leGVjdXRlKCk7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X25hbWU6IGZ1bmN0aW9uIFRvZ2dsZUdyb3VwJGdldF9uYW1lKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcclxuXHRcdH0sXHJcblx0XHRzZXRfbmFtZTogZnVuY3Rpb24gVG9nZ2xlR3JvdXAkc2V0X25hbWUodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fbmFtZSA9IHZhbHVlO1xyXG5cdFx0fSxcclxuXHRcdF9hZGQ6IGZ1bmN0aW9uIChlbGVtKSB7XHJcblx0XHRcdGlmICh0aGlzLl92aXNpYmxlLmluZGV4T2YoZWxlbSkgPCAwKVxyXG5cdFx0XHRcdHRoaXMuX3Zpc2libGUucHVzaChlbGVtKTtcclxuXHRcdH0sXHJcblx0XHRfcmVtb3ZlOiBmdW5jdGlvbiAoZWxlbSkge1xyXG5cdFx0XHR0aGlzLl92aXNpYmxlLnJlbW92ZShlbGVtKTtcclxuXHRcdH0sXHJcblx0XHRpbml0aWFsaXplOiBmdW5jdGlvbiBUb2dnbGVHcm91cCRpbml0aWFsaXplKCkge1xyXG5cdFx0XHRUb2dnbGVHcm91cC5jYWxsQmFzZU1ldGhvZCh0aGlzLCBcImluaXRpYWxpemVcIik7XHJcblxyXG5cdFx0XHR0aGlzLl9jaGlsZHJlbiA9IFtdO1xyXG5cdFx0XHR0aGlzLl92aXNpYmxlID0gW107XHJcblxyXG5cdFx0XHR0aGlzLl9vbkhhbmRsZXIgPSB0aGlzLl90b2dnbGVPbi5iaW5kKHRoaXMpO1xyXG5cdFx0XHR0aGlzLl9vZmZIYW5kbGVyID0gdGhpcy5fdG9nZ2xlT2ZmLmJpbmQodGhpcyk7XHJcblxyXG5cdFx0XHRqUXVlcnkoXCI6dG9nZ2xlXCIsIHRoaXMuX2VsZW1lbnQpLmV2ZXIodGhpcy5fdG9nZ2xlQWRkZWQuYmluZCh0aGlzKSwgdGhpcy5fdG9nZ2xlUmVtb3ZlZC5iaW5kKHRoaXMpKTtcclxuXHJcblx0XHRcdHRoaXMuX2V4ZWN1dGUoKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0RXhvV2ViLlVJLlRvZ2dsZUdyb3VwID0gVG9nZ2xlR3JvdXA7XHJcblx0VG9nZ2xlR3JvdXAucmVnaXN0ZXJDbGFzcyhcIkV4b1dlYi5VSS5Ub2dnbGVHcm91cFwiLCBTeXMuVUkuQ29udHJvbCk7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuVUkuVnVlQ29tcG9uZW50XHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gVnVlQ29tcG9uZW50KGVsZW1lbnQpIHtcclxuXHRcdFZ1ZUNvbXBvbmVudC5pbml0aWFsaXplQmFzZSh0aGlzLCBbZWxlbWVudF0pO1xyXG5cdFx0dGhpcy5fdm0gPSBudWxsO1xyXG5cdFx0dGhpcy5fZXZlbnRIYW5kbGVycyA9IFtdO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gdG9LZWJhYkNhc2Uoc3RyKSB7XHJcblx0XHRyZXR1cm4gc3RyLnJlcGxhY2UoL1tBLVpdL2csIGZ1bmN0aW9uICh4KSB7XHJcblx0XHRcdHJldHVybiBcIi1cIiArIHgudG9Mb3dlckNhc2UoKTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0VnVlQ29tcG9uZW50LnByb3RvdHlwZSA9IHtcclxuXHJcblx0XHRnZXRfdGVtcGxhdGVDb250ZXh0OiBmdW5jdGlvbiBWdWVDb21wb25lbnQkZ2V0X3RlbXBsYXRlQ29udGV4dCgpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSBtYXlCZU51bGw9XCJmYWxzZVwiIHR5cGU9XCJTeXMuVUkuVGVtcGxhdGVDb250ZXh0XCIgbG9jaWQ9XCJQOkojRXhvV2ViLlVJLlZ1ZUNvbXBvbmVudC50ZW1wbGF0ZUNvbnRleHRcIj48L3ZhbHVlPlxyXG5cdFx0XHRpZiAoIXRoaXMuX3BhcmVudENvbnRleHQpIHtcclxuXHRcdFx0XHR0aGlzLl9wYXJlbnRDb250ZXh0ID0gU3lzLlVJLlRlbXBsYXRlLmZpbmRDb250ZXh0KHRoaXMuX2VsZW1lbnQpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiB0aGlzLl9wYXJlbnRDb250ZXh0O1xyXG5cdFx0fSxcclxuXHRcdHNldF90ZW1wbGF0ZUNvbnRleHQ6IGZ1bmN0aW9uIFZ1ZUNvbXBvbmVudCRzZXRfdGVtcGxhdGVDb250ZXh0KHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX3BhcmVudENvbnRleHQgPSB2YWx1ZTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0X2NvbXBvbmVudDogZnVuY3Rpb24oKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9jb21wb25lbnROYW1lO1xyXG5cdFx0fSxcclxuXHRcdHNldF9jb21wb25lbnQ6IGZ1bmN0aW9uKHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX2NvbXBvbmVudE5hbWUgPSB2YWx1ZTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0X3BhcmVudDogZnVuY3Rpb24oKSB7XHJcblx0XHRcdGlmICghdGhpcy5fcGFyZW50KSB7XHJcblx0XHRcdFx0dmFyIHBhcmVudFZtID0gbnVsbDtcclxuXHRcdFx0XHRmb3IgKHZhciB0YyA9IHRoaXMuZ2V0X3RlbXBsYXRlQ29udGV4dCgpOyB0YzsgdGMgPSB0Yy5wYXJlbnRDb250ZXh0KSB7XHJcblx0XHRcdFx0XHRpZiAodGMudm0pIHtcclxuXHRcdFx0XHRcdFx0cGFyZW50Vm0gPSB0Yy52bTtcclxuXHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHRoaXMuX3BhcmVudCA9IHBhcmVudFZtO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiB0aGlzLl9wYXJlbnQ7XHJcblx0XHR9LFxyXG5cdFx0c2V0X3BhcmVudDogZnVuY3Rpb24odmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fcGFyZW50ID0gdmFsdWU7XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldF9tb2RlbDogZnVuY3Rpb24oKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9tb2RlbDtcclxuXHRcdH0sXHJcblx0XHRzZXRfbW9kZWw6IGZ1bmN0aW9uKHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX21vZGVsID0gdmFsdWU7XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldF9wcm9wczogZnVuY3Rpb24oKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9wcm9wcyB8fCB7fTtcclxuXHRcdH0sXHJcblx0XHRzZXRfcHJvcHM6IGZ1bmN0aW9uKHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX3Byb3BzID0gdmFsdWU7XHJcblx0XHRcdGlmICh0aGlzLl92bSlcclxuXHRcdFx0XHR0aGlzLl9iaW5kUHJvcHMoKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0X3NldHVwOiBmdW5jdGlvbigpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX3NldHVwO1xyXG5cdFx0fSxcclxuXHRcdHNldF9zZXR1cDogZnVuY3Rpb24odmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fc2V0dXAgPSB2YWx1ZTtcclxuXHRcdH0sXHJcblxyXG5cdFx0X2JpbmRQcm9wczogZnVuY3Rpb24gKCkge1xyXG5cdFx0XHQvLyBzZXR1cCBhZCBob2MgcHJvcCBiaW5kaW5nc1xyXG5cdFx0XHQvLyBFeGFtcGxlOiB2dWVjb21wb25lbnQ6eHl6PVwie2JpbmRpbmcgU29tZVByb3BlcnR5fVwiXHJcblx0XHRcdC8vIEVzdGFibGlzaGVzIGEgb25lIHdheSBiaW5kaW5nIG9mIFNvbWVQcm9wZXJ0eSAtPiBjb21wb25lbnQncyB4eXogcHJvcFxyXG5cdFx0XHRmb3IgKHZhciBwcm9wIGluIHRoaXMuX3ZtLiRvcHRpb25zLnByb3BzKSB7XHJcblx0XHRcdFx0aWYgKE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKS5oYXNPd25Qcm9wZXJ0eShcImdldF9cIiArIHByb3ApKVxyXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiUHJvcCAnXCIgKyBwcm9wICsgXCInIHdpbGwgbm90IGJlIGJvdW5kIHRvIFwiICsgdGhpcy5nZXRfY29tcG9uZW50KCkgKyBcIiBjb21wb25lbnQgYmVjYXVzZSBpdCBpcyBhIHJlc2VydmVkIHByb3BlcnR5IG9mIHRoZSBWdWVDb21wb25lbnQgY29udHJvbC5cIik7XHJcblx0XHRcdFx0ZWxzZVxyXG5cdFx0XHRcdFx0dGhpcy5fYmluZFByb3AocHJvcCwgdGhpcy5fZ2V0VmFsdWUocHJvcCkpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cclxuXHRcdF9zZXRQcm9wOiBmdW5jdGlvbiAocHJvcE5hbWUsIHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX3ZtW3Byb3BOYW1lXSA9IHZhbHVlO1xyXG5cdFx0fSxcclxuXHJcblx0XHRfcHJldmVudFZ1ZU9ic2VydmFiaWxpdHk6IGZ1bmN0aW9uKHZhbHVlKSB7XHJcblx0XHRcdGlmICh2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XHJcblx0XHRcdFx0aWYgKHZhbHVlLmxlbmd0aCAmJiBBcnJheS5pc0FycmF5KHZhbHVlKSkge1xyXG5cdFx0XHRcdFx0dmFyIF90aGlzID0gdGhpcztcclxuXHRcdFx0XHRcdHZhciBoYXNFeG9XZWJFbnRpdGllcyA9IGZhbHNlO1xyXG5cdFx0XHRcdFx0dmFsdWUuZm9yRWFjaChmdW5jdGlvbiAobykge1xyXG5cdFx0XHRcdFx0XHRpZiAoX3RoaXMuX3ByZXZlbnRWdWVPYnNlcnZhYmlsaXR5KG8pKVxyXG5cdFx0XHRcdFx0XHRcdGhhc0V4b1dlYkVudGl0aWVzID0gdHJ1ZTtcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0cmV0dXJuIGhhc0V4b1dlYkVudGl0aWVzO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEV4b1dlYi5Nb2RlbC5FbnRpdHkpIHtcclxuXHRcdFx0XHRcdHByZXZlbnRWdWVPYnNlcnZhYmlsaXR5KHZhbHVlKTtcclxuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEV4b1dlYi5WaWV3LkFkYXB0ZXIpIHtcclxuXHRcdFx0XHRcdHZhciBoYXNFeG9XZWJFbnRpdGllcyA9IHRoaXMuX3ByZXZlbnRWdWVPYnNlcnZhYmlsaXR5KHZhbHVlLmdldF9yYXdWYWx1ZSgpKTtcclxuXHRcdFx0XHRcdHJldHVybiBoYXNFeG9XZWJFbnRpdGllcyB8fCB2YWx1ZS5nZXRfaXNFbnRpdHkoKSB8fCB2YWx1ZS5nZXRfaXNFbnRpdHlMaXN0KCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cclxuXHRcdF9nZXRWYWx1ZTogZnVuY3Rpb24odnVlUHJvcCkge1xyXG5cdFx0XHR2YXIgdmFsdWUgPSB0aGlzW3RvS2ViYWJDYXNlKHZ1ZVByb3ApXTtcclxuXHRcdFx0aWYgKHRoaXMuX3ByZXZlbnRWdWVPYnNlcnZhYmlsaXR5KHZhbHVlKSkge1xyXG5cdFx0XHRcdGlmIChFeG9XZWIuY29uZmlnLmRlYnVnKVxyXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRG9uJ3QgcGFzcyBFeG9XZWIgb2JqZWN0cyB0byBWdWUgY29tcG9uZW50cywgY29tcG9uZW50ID0gXCIgKyB0aGlzLmdldF9jb21wb25lbnQoKSArIFwiLCBwcm9wPVwiICsgdnVlUHJvcCArIFwiLlwiLCB2YWx1ZSk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHZhbHVlO1xyXG5cdFx0fSxcclxuXHJcblx0XHRfYmluZFByb3A6IGZ1bmN0aW9uKHByb3BOYW1lLCB2YWx1ZSkge1xyXG5cdFx0XHRpZiAodmFsdWUgaW5zdGFuY2VvZiBFeG9XZWIuVmlldy5BZGFwdGVyKSB7XHJcblx0XHRcdFx0dGhpcy5fc2V0UHJvcChwcm9wTmFtZSwgdmFsdWUuZ2V0X3Jhd1ZhbHVlKCkpO1xyXG5cdFx0XHRcdHZhbHVlLmFkZF9wcm9wZXJ0eUNoYW5nZWQoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0dmFyIHJhd1ZhbHVlID0gdmFsdWUuZ2V0X3Jhd1ZhbHVlKCk7XHJcblx0XHRcdFx0XHR0aGlzLl9wcmV2ZW50VnVlT2JzZXJ2YWJpbGl0eShyYXdWYWx1ZSk7XHJcblx0XHRcdFx0XHR0aGlzLl9zZXRQcm9wKHByb3BOYW1lLCByYXdWYWx1ZSk7XHJcblx0XHRcdFx0fS5iaW5kKHRoaXMpKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRpZiAodmFsdWUgIT09IHVuZGVmaW5lZClcclxuXHRcdFx0XHRcdHRoaXMuX3NldFByb3AocHJvcE5hbWUsIHZhbHVlKTtcclxuXHJcblx0XHRcdFx0RXhvV2ViLk9ic2VydmVyLmFkZFByb3BlcnR5Q2hhbmdlZCh0aGlzLCB0b0tlYmFiQ2FzZShwcm9wTmFtZSksIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdHRoaXMuX3NldFByb3AocHJvcE5hbWUsIHRoaXMuX2dldFZhbHVlKHByb3BOYW1lKSk7XHJcblx0XHRcdFx0fS5iaW5kKHRoaXMpKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHRfYmluZE1vZGVsOiBmdW5jdGlvbigpIHtcclxuXHRcdFx0Ly8gc2V0dXAgdi1tb2RlbCBiaW5kaW5nXHJcblx0XHRcdC8vIHZ1ZWNvbXBvbmVudDptb2RlbD1cIntAIFByb3BlcnR5fVwiIGVzdGFibGlzaGVzIGEgdHdvIHdheSBiaW5kaW5nIGJldHdlZW4gUHJvcGVydHkgYW5kIHRoZSBjb21wb25lbnQnc1xyXG5cdFx0XHQvLyBtb2RlbCBwcm9wLiBQcm9wZXJ0eSB3aWxsIGJlIHVwZGF0ZWQgd2l0aCB0aGUgdmFsdWUgZW1pdHRlZCBvbiB0aGUgY29tcG9uZW50J3MgbW9kZWwgZXZlbnQuXHJcblx0XHRcdC8vIGh0dHBzOi8vdnVlanMub3JnL3YyL2d1aWRlL2NvbXBvbmVudHMtY3VzdG9tLWV2ZW50cy5odG1sI0N1c3RvbWl6aW5nLUNvbXBvbmVudC12LW1vZGVsXHJcblx0XHRcdHZhciBtb2RlbCA9IHRoaXMuZ2V0X21vZGVsKCk7XHJcblx0XHRcdGlmIChtb2RlbCBpbnN0YW5jZW9mIEV4b1dlYi5WaWV3LkFkYXB0ZXIpIHtcclxuXHRcdFx0XHR2YXIgbW9kZWxPcHRpb25zID0gdGhpcy5fdm0uJG9wdGlvbnMubW9kZWwgfHwgeyBwcm9wOiBcInZhbHVlXCIsIGV2ZW50OiBcImlucHV0XCIgfTtcclxuXHRcdFx0XHR0aGlzLl9iaW5kUHJvcChtb2RlbE9wdGlvbnMucHJvcCwgbW9kZWwpO1xyXG5cdFx0XHRcdHRoaXMuX3ZtLiRvbihtb2RlbE9wdGlvbnMuZXZlbnQsIGZ1bmN0aW9uICh2YWwpIHtcclxuXHRcdFx0XHRcdG1vZGVsLnNldF9yYXdWYWx1ZSh2YWwpO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cclxuXHRcdF9iaW5kRXZlbnRIYW5kbGVyOiBmdW5jdGlvbihwcm9wTmFtZSkge1xyXG5cdFx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblx0XHRcdHRoaXMuX3ZtLiRvbihwcm9wTmFtZS5zdWJzdHJpbmcoMSksIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdHRoYXQuX2dldFZhbHVlKHByb3BOYW1lKS5hcHBseShudWxsLCBhcmd1bWVudHMpO1xyXG5cdFx0XHR9KTtcclxuXHJcblx0XHR9LFxyXG5cclxuXHRcdF9iaW5kRXZlbnRIYW5kbGVyczogZnVuY3Rpb24oKSB7XHJcblx0XHRcdGZvciAodmFyIHByb3AgaW4gdGhpcykge1xyXG5cdFx0XHRcdGlmIChwcm9wLmluZGV4T2YoXCJAXCIpID09PSAwICYmIHR5cGVvZiB0aGlzW3Byb3BdID09PSBcImZ1bmN0aW9uXCIpIHtcclxuXHRcdFx0XHRcdHRoaXMuX2JpbmRFdmVudEhhbmRsZXIocHJvcCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cclxuXHRcdGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRWdWVDb21wb25lbnQuY2FsbEJhc2VNZXRob2QodGhpcywgXCJpbml0aWFsaXplXCIpO1xyXG5cclxuXHRcdFx0dmFyIGVsZW1lbnQgPSB0aGlzLmdldF9lbGVtZW50KCk7XHJcblx0XHRcdHZhciBtb3VudFBvaW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChlbGVtZW50LnRhZ05hbWUpO1xyXG5cdFx0XHRlbGVtZW50LmFwcGVuZENoaWxkKG1vdW50UG9pbnQpO1xyXG5cclxuXHRcdFx0aWYgKCF3aW5kb3cuVnVlQ29tcG9uZW50cylcclxuXHRcdFx0XHRjb25zb2xlLmVycm9yKFwiVnVlQ29tcG9uZW50cyBnbG9iYWwgd2FzIG5vdCBmb3VuZC4gUGxlYXNlIG1ha2Ugc3VyZSB0aGUgY29tcG9uZW50IGxpYnJhcnkgaXMgbG9hZGVkIGNvcnJlY3RseSBiZWZvcmUgdHJ5aW5nIHRvIHVzZSB0aGlzIGNvbnRyb2wuXCIpO1xyXG5cdFx0XHRlbHNlIGlmICghVnVlQ29tcG9uZW50c1t0aGlzLmdldF9jb21wb25lbnQoKV0pXHJcblx0XHRcdFx0Y29uc29sZS5lcnJvcihcIk5vIGNvbXBvbmVudCBuYW1lZCAnXCIgKyB0aGlzLmdldF9jb21wb25lbnQoKSArIFwiJyB3YXMgZm91bmQgaW4gdGhlIGNvbXBvbmVudCBsaWJyYXJ5LlwiKTtcclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0VnVlQ29tcG9uZW50c1t0aGlzLmdldF9jb21wb25lbnQoKV0ubG9hZCgpLnRoZW4oZnVuY3Rpb24gKENvbXBvbmVudCkge1xyXG5cdFx0XHRcdFx0dmFyIHByb3BzRGF0YSA9IHt9O1xyXG5cdFx0XHRcdFx0Ly8gZW5zdXJlIHByb3BzIGFyZSBwcm92aWRlZCB0byBjb21wb25lbnQgY29uc3RydWN0b3JcclxuXHRcdFx0XHRcdGZvciAodmFyIHByb3AgaW4gQ29tcG9uZW50Lm9wdGlvbnMucHJvcHMpIHtcclxuXHRcdFx0XHRcdFx0dmFyIHZhbHVlID0gdGhpcy5fZ2V0VmFsdWUocHJvcCk7XHJcblx0XHRcdFx0XHRcdGlmICh2YWx1ZSBpbnN0YW5jZW9mIEV4b1dlYi5WaWV3LkFkYXB0ZXIpXHJcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSB2YWx1ZS5nZXRfcmF3VmFsdWUoKTtcclxuXHRcdFx0XHRcdFx0cHJvcHNEYXRhW3Byb3BdID0gdmFsdWU7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0aWYgKENvbXBvbmVudC5vcHRpb25zLmZ1bmN0aW9uYWwpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5fdm0gPSBuZXcgVnVlKHtcclxuXHRcdFx0XHRcdFx0XHR0ZW1wbGF0ZTogJzxjLWNvbXBvbmVudC13cmFwcGVyIHJlZj1cImNvbXBvbmVudFwiIHYtYmluZD1cIiRwcm9wc1wiIC8+JyxcclxuXHRcdFx0XHRcdFx0XHRjb21wb25lbnRzOiB7ICdjLWNvbXBvbmVudC13cmFwcGVyJzogQ29tcG9uZW50IH0sXHJcblx0XHRcdFx0XHRcdFx0cHJvcHM6IE9iamVjdC5rZXlzKHByb3BzRGF0YSksXHJcblx0XHRcdFx0XHRcdFx0cHJvcHNEYXRhOiBwcm9wc0RhdGFcclxuXHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5fdm0gPSBuZXcgQ29tcG9uZW50KHtcclxuXHRcdFx0XHRcdFx0XHRwcm9wc0RhdGE6IHByb3BzRGF0YVxyXG5cdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyByZXRyb2FjdGl2ZWx5IGNvbm5lY3QgcGFyZW50LWNoaWxkIHJlbGF0aW9uc2hpcCB0byBhaWQgdnVlIGRldnRvb2xzXHJcblx0XHRcdFx0XHQvLyBwYXNzaW5nIHBhcmVudCBkdXJpbmcgY29uc3RydWN0aW9uIGJyZWFrcyByZWFjdGl2aXR5IGZvciBvYmplY3QgYW5kIGFycmF5XHJcblx0XHRcdFx0XHQvLyB0eXBlIHByb3BzXHJcblx0XHRcdFx0XHR2YXIgcGFyZW50ID0gdGhpcy5fdm0uJHBhcmVudCA9IHRoaXMuZ2V0X3BhcmVudCgpO1xyXG5cdFx0XHRcdFx0aWYgKHBhcmVudClcclxuXHRcdFx0XHRcdFx0cGFyZW50LiRjaGlsZHJlbi5wdXNoKHRoaXMuX3ZtKTtcclxuXHJcblx0XHRcdFx0XHR0aGlzLl9iaW5kTW9kZWwoKTtcclxuXHRcdFx0XHRcdHRoaXMuX2JpbmRQcm9wcygpO1xyXG5cdFx0XHRcdFx0dGhpcy5fYmluZEV2ZW50SGFuZGxlcnMoKTtcclxuXHJcblx0XHRcdFx0XHRpZiAodHlwZW9mIHRoaXMuX3NldHVwID09PSBcImZ1bmN0aW9uXCIpXHJcblx0XHRcdFx0XHRcdHRoaXMuX3NldHVwKHRoaXMuX3ZtLCB0aGlzLl9tb2RlbCk7XHJcblx0XHRcdFx0XHR0aGlzLl92bS4kbW91bnQobW91bnRQb2ludCk7XHJcblx0XHRcdFx0fS5iaW5kKHRoaXMpKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHRkaXNwb3NlOiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdGlmICh0aGlzLl92bSkge1xyXG5cdFx0XHRcdHRyeSB7XHJcblx0XHRcdFx0XHR0aGlzLl92bS4kZGVzdHJveSgpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRjYXRjaCAoZSkge1xyXG5cdFx0XHRcdFx0Ly8gSWdub3JlIGVycm9yIGRlc3Ryb3lpbmcgY29tcG9uZW50XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0LyoqXHJcblx0ICogUHJldmVudCBWdWUgZnJvbSBtYWtpbmcgYW4gb2JqZWN0IG9ic2VydmFibGUuXHJcblx0ICogQWRhcHRlZCBmcm9tIFZ1ZU1vZGVsIC0gIGh0dHBzOi8vZ2l0aHViLmNvbS9jb2duaXRvZm9ybXMvVnVlTW9kZWwvYmxvYi9tYXN0ZXIvc3JjL3Z1ZS1tb2RlbC1vYnNlcnZhYmlsaXR5LnRzXHJcblx0ICovXHJcblx0ZnVuY3Rpb24gcHJldmVudFZ1ZU9ic2VydmFiaWxpdHkob2JqKSB7XHJcblx0XHRpZiAob2JqICYmICFvYmouaGFzT3duUHJvcGVydHkoXCJfX29iX19cIikpIHtcclxuXHRcdFx0Ly8gTWFyayB0aGUgb2JqZWN0IGFzIFwicmF3XCIgc28gdGhhdCBWdWUgd29uJ3QgdHJ5IHRvIG1ha2UgaXQgb2JzZXJ2YWJsZVxyXG5cdFx0XHRWdWUubWFya1JhdyhvYmopO1xyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdEV4b1dlYi5VSS5WdWVDb21wb25lbnQgPSBWdWVDb21wb25lbnQ7XHJcblx0VnVlQ29tcG9uZW50LnJlZ2lzdGVyQ2xhc3MoXCJFeG9XZWIuVUkuVnVlQ29tcG9uZW50XCIsIFN5cy5VSS5Db250cm9sLCBTeXMuVUkuSVRlbXBsYXRlQ29udGV4dENvbnN1bWVyKTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5VSS5UZW1wbGF0ZVxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIFRlbXBsYXRlKGVsZW1lbnQpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNFeG9XZWIuVUkuVGVtcGxhdGUuI2N0b3JcIj5cclxuXHRcdC8vLyBJbiBhZGRpdGlvbiB0byBkZWZpbmluZyB0ZW1wbGF0ZSBtYXJrdXAsIGFsc28gZGVmaW5lcyBydWxlcyB0aGF0IGFyZSB1c2VkXHJcblx0XHQvLy8gdG8gZGV0ZXJtaW5lIGlmIGl0IHNob3VsZCBiZSBjaG9zZW4gYXMgdGhlIHRlbXBsYXRlIGZvciBhIGdpdmVuIGVsZW1lbnRcclxuXHRcdC8vLyBiYXNlZCBvbiBhIENTUyBzZWxlY3RvciBhcyB3ZWxsIGFzIGEgamF2YXNjcmlwdCBmaWx0ZXIgdGhhdCBpcyBldmFsdWF0ZWQgXHJcblx0XHQvLy8gYWdhaW5zdCB0aGUgZWxlbWVudCBpbiBxdWVzdGlvbi5cclxuXHRcdC8vLyA8L3N1bW1hcnk+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJlbGVtZW50XCI+PC9wYXJhbT5cclxuXHRcdFRlbXBsYXRlLmluaXRpYWxpemVCYXNlKHRoaXMsIFtlbGVtZW50XSk7XHJcblx0fVxyXG5cclxuXHR2YXIgYWxsVGVtcGxhdGVzID0ge307XHJcblxyXG5cdFRlbXBsYXRlLnByb3RvdHlwZSA9IHtcclxuXHJcblx0XHRnZXRfbmFtZTogZnVuY3Rpb24gVGVtcGxhdGUkZ2V0X25hbWUoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgbWF5QmVOdWxsPVwidHJ1ZVwiIHR5cGU9XCJTdHJpbmdcIiBsb2NpZD1cIlA6SiNFeG9XZWIuVUkuVGVtcGxhdGUubmFtZVwiPjwvdmFsdWU+XHJcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xyXG5cdFx0fSxcclxuXHRcdHNldF9uYW1lOiBmdW5jdGlvbiBUZW1wbGF0ZSRzZXRfbmFtZSh2YWx1ZSkge1xyXG5cdFx0XHR0aGlzLl9uYW1lID0gdmFsdWU7XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldF9uYW1lQXJyYXk6IGZ1bmN0aW9uIFRlbXBsYXRlJGdldF9uYW1lQXJyYXkoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgbWF5QmVOdWxsPVwidHJ1ZVwiIHR5cGU9XCJTdHJpbmdcIiBsb2NpZD1cIlA6SiNFeG9XZWIuVUkuVGVtcGxhdGUubmFtZUFycmF5XCI+PC92YWx1ZT5cclxuXHRcdFx0aWYgKHRoaXMuX25hbWUgJiYgIXRoaXMuX25hbWVBcnJheSkge1xyXG5cdFx0XHRcdHRoaXMuX25hbWVBcnJheSA9IHRoaXMuX25hbWUudHJpbSgpLnNwbGl0KC9cXHMrLyk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWVBcnJheTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0X2tpbmQ6IGZ1bmN0aW9uIFRlbXBsYXRlJGdldF9raW5kKCkge1xyXG5cdFx0XHQvLy8gPHZhbHVlIG1heUJlTnVsbD1cInRydWVcIiB0eXBlPVwiU3RyaW5nXCIgbG9jaWQ9XCJQOkojRXhvV2ViLlVJLlRlbXBsYXRlLmtpbmRcIj48L3ZhbHVlPlxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fa2luZDtcclxuXHRcdH0sXHJcblx0XHRzZXRfa2luZDogZnVuY3Rpb24gVGVtcGxhdGUkc2V0X2tpbmQodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fa2luZCA9IHZhbHVlO1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfZGF0YVR5cGU6IGZ1bmN0aW9uIFRlbXBsYXRlJGdldF9kYXRhVHlwZSgpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSBtYXlCZU51bGw9XCJ0cnVlXCIgdHlwZT1cIlN0cmluZ1wiIGxvY2lkPVwiUDpKI0V4b1dlYi5VSS5UZW1wbGF0ZS5kYXRhVHlwZVwiPjwvdmFsdWU+XHJcblx0XHRcdHJldHVybiB0aGlzLl9kYXRhVHlwZTtcclxuXHRcdH0sXHJcblx0XHRzZXRfZGF0YVR5cGU6IGZ1bmN0aW9uIFRlbXBsYXRlJHNldF9kYXRhVHlwZSh2YWx1ZSkge1xyXG5cdFx0XHRpZiAoRXhvV2ViLmlzVHlwZSh2YWx1ZSwgRnVuY3Rpb24pKSB7XHJcblx0XHRcdFx0dGhpcy5fZGF0YVR5cGUgPSBwYXJzZUZ1bmN0aW9uTmFtZSh2YWx1ZSk7XHJcblx0XHRcdFx0dGhpcy5fZGF0YVR5cGVDdG9yID0gdmFsdWU7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoRXhvV2ViLmlzVHlwZSh2YWx1ZSwgU3RyaW5nKSkge1xyXG5cdFx0XHRcdHRoaXMuX2RhdGFUeXBlID0gdmFsdWU7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0X2RhdGFUeXBlQ3RvcjogZnVuY3Rpb24gVGVtcGxhdGUkZ2V0X2RhdGFUeXBlQ3RvcigpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSBtYXlCZU51bGw9XCJ0cnVlXCIgdHlwZT1cIlN0cmluZ1wiIGxvY2lkPVwiUDpKI0V4b1dlYi5VSS5UZW1wbGF0ZS5kYXRhVHlwZUN0b3JcIj48L3ZhbHVlPlxyXG5cdFx0XHRpZiAoIXRoaXMuX2RhdGFUeXBlQ3RvciAmJiBFeG9XZWIuaXNUeXBlKHRoaXMuX2RhdGFUeXBlLCBTdHJpbmcpKSB7XHJcblx0XHRcdFx0Ly8gbGF6eSBldmFsdWF0ZSB0aGUgYWN0dWFsIGNvbnN0cnVjdG9yXHJcblx0XHRcdFx0dGhpcy5fZGF0YVR5cGVDdG9yID0gRXhvV2ViLmdldEN0b3IodGhpcy5fZGF0YVR5cGUpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiB0aGlzLl9kYXRhVHlwZUN0b3I7XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldF9pc1JlZmVyZW5jZTogZnVuY3Rpb24gVGVtcGxhdGUkZ2V0X2lzUmVmZXJlbmNlKCkge1xyXG5cdFx0XHQvLy8gPHZhbHVlIG1heUJlTnVsbD1cInRydWVcIiB0eXBlPVwiQm9vbGVhblwiIGxvY2lkPVwiUDpKI0V4b1dlYi5VSS5UZW1wbGF0ZS5pc1JlZmVyZW5jZVwiPjwvdmFsdWU+XHJcblx0XHRcdHJldHVybiB0aGlzLl9pc1JlZmVyZW5jZTtcclxuXHRcdH0sXHJcblx0XHRzZXRfaXNSZWZlcmVuY2U6IGZ1bmN0aW9uIFRlbXBsYXRlJHNldF9pc1JlZmVyZW5jZSh2YWx1ZSkge1xyXG5cdFx0XHRpZiAodmFsdWUgJiYgdmFsdWUuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xyXG5cdFx0XHRcdHZhciBzdHIgPSB2YWx1ZS50b0xvd2VyQ2FzZSgpLnRyaW0oKTtcclxuXHRcdFx0XHRpZiAoc3RyID09PSBcInRydWVcIikge1xyXG5cdFx0XHRcdFx0dmFsdWUgPSB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmIChzdHIgPT09IFwiZmFsc2VcIikge1xyXG5cdFx0XHRcdFx0dmFsdWUgPSBmYWxzZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHR0aGlzLl9pc1JlZmVyZW5jZVRleHQgPSB2YWx1ZTtcclxuXHRcdFx0XHRcdHZhbHVlID0gbnVsbDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5faXNSZWZlcmVuY2UgPSB2YWx1ZTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0X2lzTGlzdDogZnVuY3Rpb24gVGVtcGxhdGUkZ2V0X2lzTGlzdCgpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSBtYXlCZU51bGw9XCJ0cnVlXCIgdHlwZT1cIkJvb2xlYW5cIiBsb2NpZD1cIlA6SiNFeG9XZWIuVUkuVGVtcGxhdGUuaXNMaXN0XCI+PC92YWx1ZT5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX2lzTGlzdDtcclxuXHRcdH0sXHJcblx0XHRzZXRfaXNMaXN0OiBmdW5jdGlvbiBUZW1wbGF0ZSRzZXRfaXNMaXN0KHZhbHVlKSB7XHJcblx0XHRcdGlmICh2YWx1ZSAmJiB2YWx1ZS5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XHJcblx0XHRcdFx0dmFyIHN0ciA9IHZhbHVlLnRvTG93ZXJDYXNlKCkudHJpbSgpO1xyXG5cdFx0XHRcdGlmIChzdHIgPT09IFwidHJ1ZVwiKSB7XHJcblx0XHRcdFx0XHR2YWx1ZSA9IHRydWU7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2UgaWYgKHN0ciA9PT0gXCJmYWxzZVwiKSB7XHJcblx0XHRcdFx0XHR2YWx1ZSA9IGZhbHNlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHRoaXMuX2lzTGlzdFRleHQgPSB2YWx1ZTtcclxuXHRcdFx0XHRcdHZhbHVlID0gbnVsbDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5faXNMaXN0ID0gdmFsdWU7XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldF9hc3BlY3RzOiBmdW5jdGlvbiBUZW1wbGF0ZSRnZXRfYXNwZWN0cygpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSBtYXlCZU51bGw9XCJ0cnVlXCIgdHlwZT1cIkJvb2xlYW5cIiBsb2NpZD1cIlA6SiNFeG9XZWIuVUkuVGVtcGxhdGUuYXNwZWN0c1wiPjwvdmFsdWU+XHJcblx0XHRcdGlmICghdGhpcy5fYXNwZWN0cykge1xyXG5cdFx0XHRcdHZhciBhc3BlY3RzID0gdGhpcy5fYXNwZWN0cyA9IHt9O1xyXG5cdFx0XHRcdGlmICh0aGlzLl9pc0xpc3QgIT09IG51bGwgJiYgdGhpcy5faXNMaXN0ICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRcdGFzcGVjdHMuaXNMaXN0ID0gdGhpcy5faXNMaXN0O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAodGhpcy5faXNSZWZlcmVuY2UgIT09IG51bGwgJiYgdGhpcy5faXNSZWZlcmVuY2UgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0YXNwZWN0cy5pc1JlZmVyZW5jZSA9IHRoaXMuX2lzUmVmZXJlbmNlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAodGhpcy5nZXRfZGF0YVR5cGUoKSAhPT0gbnVsbCAmJiB0aGlzLmdldF9kYXRhVHlwZSgpICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRcdGFzcGVjdHMuZGF0YVR5cGUgPSB0aGlzLmdldF9kYXRhVHlwZUN0b3IoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHRoaXMuX2FzcGVjdHM7XHJcblx0XHR9LFxyXG5cclxuXHRcdGlzQ29ycmVjdEtpbmQ6IGZ1bmN0aW9uIFRlbXBsYXRlJGlzQ29ycmVjdEtpbmQob2JqKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNFeG9XZWIuVUkuVGVtcGxhdGUuaXNDb3JyZWN0S2luZFwiPlxyXG5cdFx0XHQvLy8gRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBnaXZlbiBvYmplY3QgaXMgb2YgdGhlIGNvcnJlY3Qga2luZFxyXG5cdFx0XHQvLy8gZm9yIHRoZSB0ZW1wbGF0ZSwgaWYgYSBraW5kIGlzIHNwZWNpZmllZC5cclxuXHRcdFx0Ly8vIDwvc3VtbWFyeT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwib2JqXCIgb3B0aW9uYWw9XCJmYWxzZVwiIG1heUJlTnVsbD1cImZhbHNlXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJCb29sZWFuXCI+PC9yZXR1cm5zPlxyXG5cdFx0XHRpZiAob2JqIGluc3RhbmNlb2YgRXhvV2ViLlZpZXcuQWRhcHRlcikge1xyXG5cdFx0XHRcdHJldHVybiB0aGlzLl9raW5kID09PSBcIkBcIjtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRyZXR1cm4gdGhpcy5fa2luZCA9PT0gdW5kZWZpbmVkO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cclxuXHRcdF9uYW1lc1NhdGlzZmllZEJ5OiBmdW5jdGlvbiBUZW1wbGF0ZSRfbmFtZXNTYXRpc2ZpZWRCeShuYW1lcykge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojRXhvV2ViLlVJLlRlbXBsYXRlLl9uYW1lc1NhdGlzZmllZEJ5XCI+XHJcblx0XHRcdC8vLyBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIGdpdmVuIG5hbWVzIGNvbGxlY3Rpb24gc2F0aXNpZmVzIGFsbFxyXG5cdFx0XHQvLy8gcmVxdWlyZWQgdGVtcGxhdGUgbmFtZXMuXHJcblx0XHRcdC8vLyA8L3N1bW1hcnk+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cIm5hbWVzXCIgdHlwZT1cIkFycmF5XCIgb3B0aW9uYWw9XCJmYWxzZVwiIG1heUJlTnVsbD1cImZhbHNlXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJCb29sZWFuXCI+PC9yZXR1cm5zPlxyXG5cdFx0XHRyZXR1cm4gIXRoaXMuZ2V0X25hbWVBcnJheSgpIHx8ICF0aGlzLmdldF9uYW1lQXJyYXkoKS5zb21lKGZ1bmN0aW9uKG4pIHsgcmV0dXJuICFuYW1lcy5jb250YWlucyhuKTsgfSk7XHJcblx0XHR9LFxyXG5cclxuXHRcdF9hc3BlY3RzU2F0aXNmaWVkQnk6IGZ1bmN0aW9uIFRlbXBsYXRlJF9hc3BlY3RzU2F0aXNmaWVkQnkoYXNwZWN0cykge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojRXhvV2ViLlVJLlRlbXBsYXRlLl9hc3BlY3RzU2F0aXNmaWVkQnlcIj5cclxuXHRcdFx0Ly8vIERldGVybWluZXMgd2hldGhlciB0aGUgZ2l2ZW4gZGF0YSBzYXRpc2ZpZXMgc3BlY2lhbCBhc3BlY3RzXHJcblx0XHRcdC8vLyByZXF1aXJlZCBieSB0aGUgdGVtcGxhdGUuXHJcblx0XHRcdC8vLyA8L3N1bW1hcnk+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cImFzcGVjdHNcIiB0eXBlPVwiQXJyYXlcIiBvcHRpb25hbD1cImZhbHNlXCIgbWF5QmVOdWxsPVwiZmFsc2VcIj48L3BhcmFtPlxyXG5cdFx0XHQvLy8gPHJldHVybnMgdHlwZT1cIkJvb2xlYW5cIj48L3JldHVybnM+XHJcblx0XHRcdHZhciBzYXRpc2ZpZWQgPSB0cnVlO1xyXG5cdFx0XHRlYWNoUHJvcCh0aGlzLmdldF9hc3BlY3RzKCksIGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XHJcblx0XHRcdFx0aWYgKCFhc3BlY3RzLmhhc093blByb3BlcnR5KG5hbWUpIHx8ICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSB8fCAobmFtZSAhPT0gXCJkYXRhVHlwZVwiICYmIGFzcGVjdHNbbmFtZV0gIT09IHZhbHVlKSB8fCAobmFtZSA9PT0gXCJkYXRhVHlwZVwiICYmIGFzcGVjdHNbbmFtZV0gIT09IHZhbHVlICYmICEoYXNwZWN0c1tuYW1lXSAmJiBhc3BlY3RzW25hbWVdLm1ldGEgJiYgYXNwZWN0c1tuYW1lXS5tZXRhLmlzU3ViY2xhc3NPZih2YWx1ZS5tZXRhKSkpKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gKHNhdGlzZmllZCA9IGZhbHNlKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0XHRyZXR1cm4gc2F0aXNmaWVkO1xyXG5cdFx0fSxcclxuXHJcblx0XHRtYXRjaGVzOiBmdW5jdGlvbiBUZW1wbGF0ZSRtYXRjaGVzKGRhdGEsIG5hbWVzKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNFeG9XZWIuVUkuVGVtcGxhdGUubWF0Y2hlc1wiPlxyXG5cdFx0XHQvLy8gRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBnaXZlbiBkYXRhIGFuZCBuYW1lIGFycmF5IG1hdGNoIHRoZSB0ZW1wbGF0ZS5cclxuXHRcdFx0Ly8vIDwvc3VtbWFyeT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwiZGF0YVwiIG9wdGlvbmFsPVwiZmFsc2VcIiBtYXlCZU51bGw9XCJmYWxzZVwiPjwvcGFyYW0+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cIm5hbWVzXCIgdHlwZT1cIkFycmF5XCIgb3B0aW9uYWw9XCJmYWxzZVwiIG1heUJlTnVsbD1cImZhbHNlXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJCb29sZWFuXCI+PC9yZXR1cm5zPlxyXG5cdFx0XHRpZiAodGhpcy5fbmFtZXNTYXRpc2ZpZWRCeShuYW1lcykpIHtcclxuXHRcdFx0XHR2YXIgYXNwZWN0cztcclxuXHRcdFx0XHRpZiAoZGF0YSAmJiBkYXRhLmFzcGVjdHMgJiYgZGF0YS5hc3BlY3RzIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuXHRcdFx0XHRcdGFzcGVjdHMgPSBkYXRhLmFzcGVjdHMoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRhc3BlY3RzID0ge1xyXG5cdFx0XHRcdFx0XHRpc0xpc3Q6IChkYXRhICYmIGRhdGEgaW5zdGFuY2VvZiBBcnJheSksXHJcblx0XHRcdFx0XHRcdGlzUmVmZXJlbmNlOiAoZGF0YSAmJiBkYXRhIGluc3RhbmNlb2YgRXhvV2ViLk1vZGVsLkVudGl0eSlcclxuXHRcdFx0XHRcdH07XHJcblx0XHRcdFx0XHRpZiAoZGF0YSA9PT0gbnVsbCB8fCBkYXRhID09PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRcdFx0YXNwZWN0cy5kYXRhVHlwZSA9IG51bGw7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIGlmIChkYXRhIGluc3RhbmNlb2YgRXhvV2ViLk1vZGVsLkVudGl0eSkge1xyXG5cdFx0XHRcdFx0XHRhc3BlY3RzLmRhdGFUeXBlID0gZGF0YS5tZXRhLnR5cGUuZ2V0X2pzdHlwZSgpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAoZGF0YSBpbnN0YW5jZW9mIEFycmF5KSB7XHJcblx0XHRcdFx0XHRcdGFzcGVjdHMuZGF0YVR5cGUgPSBBcnJheTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2UgaWYgKGRhdGEgaW5zdGFuY2VvZiBPYmplY3QpIHtcclxuXHRcdFx0XHRcdFx0YXNwZWN0cy5kYXRhVHlwZSA9IE9iamVjdDtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRhc3BlY3RzLmRhdGFUeXBlID0gZGF0YS5jb25zdHJ1Y3RvcjtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2FzcGVjdHNTYXRpc2ZpZWRCeShhc3BlY3RzKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHR0b1N0cmluZzogZnVuY3Rpb24oKSB7XHJcblx0XHRcdHJldHVybiAkZm9ybWF0KFwiPHswfSBuYW1lPVxcXCJ7MX1cXFwiIGtpbmQ9XFxcInsyfVxcXCIgZGF0YXR5cGU9XFxcInszfVxcXCIgaXNyZWZlcmVuY2U9XFxcIns0fVxcXCIgaXNsaXN0PVxcXCJ7NX1cXFwiIC8+XCIsXHJcblx0XHRcdFx0dGhpcy5fZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCksXHJcblx0XHRcdFx0dGhpcy5fbmFtZSB8fCBcIlwiLFxyXG5cdFx0XHRcdHRoaXMuX2tpbmQgfHwgXCJcIixcclxuXHRcdFx0XHR0aGlzLl9kYXRhVHlwZSB8fCBcIlwiLFxyXG5cdFx0XHRcdGlzTnVsbE9yVW5kZWZpbmVkKHRoaXMuX2lzUmVmZXJlbmNlKSA/IFwiXCIgOiB0aGlzLl9pc1JlZmVyZW5jZSxcclxuXHRcdFx0XHRpc051bGxPclVuZGVmaW5lZCh0aGlzLl9pc0xpc3QpID8gXCJcIiA6IHRoaXMuX2lzTGlzdFxyXG5cdFx0XHQpO1xyXG5cdFx0fSxcclxuXHJcblx0XHRkaXNwb3NlOiBmdW5jdGlvbiBUZW1wbGF0ZSRkaXNwb3NlKCkge1xyXG5cdFx0XHR0aGlzLl9hc3BlY3RzID0gdGhpcy5fY29udGVudFRlbXBsYXRlID0gdGhpcy5fZGF0YVR5cGUgPSB0aGlzLl9kYXRhVHlwZUN0b3IgPSB0aGlzLl9pc0xpc3QgPSB0aGlzLl9pc0xpc3RUZXh0ID1cclxuXHRcdFx0XHR0aGlzLl9pc1JlZmVyZW5jZSA9IHRoaXMuX2lzUmVmZXJlbmNlVGV4dCA9IHRoaXMuX2tpbmQgPSB0aGlzLl9uYW1lID0gdGhpcy5fbmFtZUFycmF5ID0gbnVsbDtcclxuXHRcdFx0RXhvV2ViLlVJLlRlbXBsYXRlLmNhbGxCYXNlTWV0aG9kKHRoaXMsIFwiZGlzcG9zZVwiKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0aW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNFeG9XZWIuVUkuVGVtcGxhdGUuaW5pdGlhbGl6ZVwiIC8+XHJcblx0XHRcdFRlbXBsYXRlLmNhbGxCYXNlTWV0aG9kKHRoaXMsIFwiaW5pdGlhbGl6ZVwiKTtcclxuXHJcblx0XHRcdC8vIGFkZCBhIGNsYXNzIHRoYXQgY2FuIGJlIHVzZWQgdG8gc2VhcmNoIGZvciB0ZW1wbGF0ZXMgXHJcblx0XHRcdC8vIGFuZCBtYWtlIHN1cmUgdGhhdCB0aGUgdGVtcGxhdGUgZWxlbWVudCBpcyBoaWRkZW5cclxuXHRcdFx0alF1ZXJ5KHRoaXMuX2VsZW1lbnQpLmFkZENsYXNzKFwiZXhvd2ViLXRlbXBsYXRlXCIpLmhpZGUoKTtcclxuXHJcblx0XHRcdGlmICh0aGlzLl9lbGVtZW50LmNvbnRyb2wuY29uc3RydWN0b3IgIT09IFN0cmluZykge1xyXG5cdFx0XHRcdHZhciBlbCA9IHRoaXMuX2VsZW1lbnQ7XHJcblx0XHRcdFx0dmFyIHRhZ05hbWUgPSBlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XHJcblx0XHRcdFx0dmFyIGNhY2hlID0gYWxsVGVtcGxhdGVzW3RhZ05hbWVdO1xyXG5cdFx0XHRcdGlmICghY2FjaGUpIHtcclxuXHRcdFx0XHRcdGNhY2hlID0gYWxsVGVtcGxhdGVzW3RhZ05hbWVdID0gW107XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGNhY2hlLnB1c2goZWwpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdH07XHJcblxyXG5cdGZ1bmN0aW9uIGZpbmRUZW1wbGF0ZSh0YWdOYW1lLCBkYXRhLCBuYW1lcykge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI0V4b1dlYi5VSS5UZW1wbGF0ZS5maW5kXCI+XHJcblx0XHQvLy8gRmluZHMgdGhlIGZpcnN0IGZpZWxkIHRlbXBsYXRlIHRoYXQgbWF0Y2ggdGhlIGdpdmVuIGRhdGEgYW5kIG5hbWVzIGFuZCByZXR1cm5zIHRoZSB0ZW1wbGF0ZS5cclxuXHRcdC8vLyA8L3N1bW1hcnk+XHJcblxyXG5cdFx0aWYgKGRhdGEgPT09IHVuZGVmaW5lZCB8fCBkYXRhID09PSBudWxsKSB7XHJcblx0XHRcdGxvZ1dhcm5pbmcoXCJBdHRlbXB0aW5nIHRvIGZpbmQgdGVtcGxhdGUgZm9yIFwiICsgKGRhdGEgPT09IHVuZGVmaW5lZCA/IFwidW5kZWZpbmVkXCIgOiBcIm51bGxcIikgKyBcIiBkYXRhLlwiKTtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgY2FjaGU7XHJcblx0XHRpZiAoY2FjaGUgPSBhbGxUZW1wbGF0ZXNbdGFnTmFtZV0pIHtcclxuXHRcdFx0Zm9yICh2YXIgdCA9IGNhY2hlLmxlbmd0aCAtIDE7IHQgPj0gMDsgdC0tKSB7XHJcblx0XHRcdFx0dmFyIHRtcGxFbCA9IGNhY2hlW3RdO1xyXG5cdFx0XHRcdHZhciB0bXBsID0gdG1wbEVsLmNvbnRyb2w7XHJcblx0XHJcblx0XHRcdFx0aWYgKHRtcGwgaW5zdGFuY2VvZiBUZW1wbGF0ZSkge1xyXG5cdFx0XHRcdFx0dmFyIGlzQ29ycmVjdEtpbmQgPSB0bXBsLmlzQ29ycmVjdEtpbmQoZGF0YSk7XHJcblx0XHRcdFx0XHRpZiAoKGlzQ29ycmVjdEtpbmQgPT09IHVuZGVmaW5lZCB8fCBpc0NvcnJlY3RLaW5kID09PSB0cnVlKSAmJiB0bXBsLm1hdGNoZXMoZGF0YSwgbmFtZXMpKSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiB0bXBsRWw7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIG51bGw7XHJcblx0fVxyXG5cclxuXHQvLyBib29ra2VlcGluZyBmb3IgVGVtcGxhdGUubG9hZFxyXG5cdC8vIFRPRE86IGNvbnNpZGVyIHdyYXBwZXIgb2JqZWN0IHRvIGNsZWFuIHVwIGFmdGVyIHRlbXBsYXRlcyBhcmUgbG9hZGVkP1xyXG5cdHZhciB0ZW1wbGF0ZUNvdW50ID0gMDtcclxuXHR2YXIgZXh0ZXJuYWxUZW1wbGF0ZXNTaWduYWwgPSBuZXcgRXhvV2ViLlNpZ25hbChcImV4dGVybmFsIHRlbXBsYXRlc1wiKTtcclxuXHR2YXIgbGFzdFRlbXBsYXRlUmVxdWVzdFNpZ25hbDtcclxuXHJcblx0VGVtcGxhdGUubG9hZCA9IGZ1bmN0aW9uIFRlbXBsYXRlJGxvYWQocGF0aCwgb3B0aW9ucykge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI0V4b1dlYi5VSS5UZW1wbGF0ZS5sb2FkXCI+XHJcblx0XHQvLy8gTG9hZHMgZXh0ZXJuYWwgdGVtcGxhdGVzIGludG8gdGhlIHBhZ2UuXHJcblx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cclxuXHRcdHZhciBpZCA9IFwiZXhvd2ViLXRlbXBsYXRlcy1cIiArICh0ZW1wbGF0ZUNvdW50KyspO1xyXG5cclxuXHRcdHZhciBsYXN0UmVxID0gbGFzdFRlbXBsYXRlUmVxdWVzdFNpZ25hbDtcclxuXHJcblx0XHQvLyBzZXQgdGhlIGxhc3QgcmVxdWVzdCBzaWduYWwgdG8gdGhlIG5ldyBzaWduYWwgYW5kIGluY3JlbWVudFxyXG5cdFx0dmFyIHNpZ25hbCA9IGxhc3RUZW1wbGF0ZVJlcXVlc3RTaWduYWwgPSBuZXcgRXhvV2ViLlNpZ25hbChpZCk7XHJcblx0XHR2YXIgY2FsbGJhY2sgPSBleHRlcm5hbFRlbXBsYXRlc1NpZ25hbC5wZW5kaW5nKHNpZ25hbC5wZW5kaW5nKGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0Ly8gQWN0aXZhdGUgdGVtcGxhdGUgY29udHJvbHMgd2l0aGluIHRoZSByZXNwb25zZS5cclxuXHRcdFx0U3lzLkFwcGxpY2F0aW9uLmFjdGl2YXRlRWxlbWVudCh0aGlzKTtcclxuXHRcdH0pKTtcclxuXHJcblx0XHRqUXVlcnkoZnVuY3Rpb24gKCQpIHtcclxuXHRcdFx0dmFyIHRtcGwgPSBqUXVlcnkoXCI8ZGl2IGlkPSdcIiArIGlkICsgXCInLz5cIilcclxuXHRcdFx0XHRcdC5oaWRlKClcclxuXHRcdFx0XHRcdC5hcHBlbmRUbyhcImJvZHlcIik7XHJcblxyXG5cdFx0XHQvL2lmIHRoZSB0ZW1wbGF0ZSBpcyBzdG9yZWQgbG9jYWxseSBsb29rIGZvciB0aGUgcGF0aCBhcyBhIGRpdiBvbiB0aGUgcGFnZSByYXRoZXIgdGhhbiB0aGUgY2FjaGVcclxuXHRcdFx0aWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5pc0xvY2FsID09PSB0cnVlKSB7XHJcblx0XHRcdFx0dmFyIGxvY2FsVGVtcGxhdGUgPSBqUXVlcnkoJyMnICsgcGF0aCk7XHJcblx0XHRcdFx0Y2FsbGJhY2suY2FsbChsb2NhbFRlbXBsYXRlLmdldCgwKSk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dmFyIGh0bWwgPSBFeG9XZWIuY2FjaGUocGF0aCk7XHJcblxyXG5cdFx0XHRcdGlmIChodG1sKSB7XHJcblx0XHRcdFx0XHR0bXBsLmFwcGVuZChodG1sKTtcclxuXHRcdFx0XHRcdGNhbGxiYWNrLmNhbGwodG1wbC5nZXQoMCkpO1xyXG5cdFx0XHRcdH0gXHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHR0bXBsLmxvYWQocGF0aCwgZnVuY3Rpb24ocmVzcG9uc2VUZXh0LCB0ZXh0U3RhdHVzLCBqcVhIUikge1xyXG5cdFx0XHRcdFx0XHQvLyBFbnN1cmUgdGhhdCBqcVhIUiBpcyBsb2FkZWQuICAnc3RhdGUnIGNoZWNrIGZvciBqcXVlcnkgMS43KywgJ2lzUmVzb2x2ZWQnIGNoZWNrIGZvciBqUXVlcnkgMS41IC0gMS43XHJcblx0XHRcdFx0XHRcdGlmICgoanFYSFIuc3RhdGUgJiYganFYSFIuc3RhdGUoKSA9PT0gXCJyZXNvbHZlZFwiKSB8fCAoanFYSFIuaXNSZXNvbHZlZCAmJiBqcVhIUi5pc1Jlc29sdmVkKCkpKSB7XHJcblx0XHRcdFx0XHRcdFx0Ly8gQ2FjaGUgdGhlIHRlbXBsYXRlXHJcblx0XHRcdFx0XHRcdFx0RXhvV2ViLmNhY2hlKHBhdGgsIHJlc3BvbnNlVGV4dCk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdC8vIGlmIHRoZXJlIGlzIGEgcGVuZGluZyByZXF1ZXN0IHRoZW4gd2FpdCBmb3IgaXQgdG8gY29tcGxldGVcclxuXHRcdFx0XHRcdFx0XHRpZiAobGFzdFJlcSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0bGFzdFJlcS53YWl0Rm9yQWxsKGNhbGxiYWNrLCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXMpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHR9O1xyXG5cclxuXHRFeG9XZWIuVUkuVGVtcGxhdGUgPSBUZW1wbGF0ZTtcclxuXHRUZW1wbGF0ZS5yZWdpc3RlckNsYXNzKFwiRXhvV2ViLlVJLlRlbXBsYXRlXCIsIFN5cy5VSS5Db250cm9sLCBTeXMuVUkuSUNvbnRlbnRUZW1wbGF0ZUNvbnN1bWVyKTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5VSS5Db250ZW50XHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gQ29udGVudChlbGVtZW50KSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojRXhvV2ViLlVJLkNvbnRlbnQuI2N0b3JcIj5cclxuXHRcdC8vLyBGaW5kcyBpdHMgbWF0Y2hpbmcgdGVtcGxhdGUgYW5kIHJlbmRlcnMgdXNpbmcgdGhlIHByb3ZpZGVkIGRhdGEgYXMgdGhlIFxyXG5cdFx0Ly8vIGJpbmRpbmcgY29udGV4dC4gIEl0IGNhbiBiZSB1c2VkIGFzIGEgXCJmaWVsZCBjb250cm9sXCIsIHVzaW5nIHBhcnQgb2YgdGhlIFxyXG5cdFx0Ly8vIGNvbnRleHQgZGF0YSB0byBzZWxlY3QgdGhlIGFwcHJvcHJpYXRlIGNvbnRyb2wgdGVtcGxhdGUuICBBbm90aGVyIGNvbW1vbiBcclxuXHRcdC8vLyB1c2FnZSB3b3VsZCBiZSB0byBzZWxlY3QgdGhlIGFwcHJvcHJpYXRlIHRlbXBsYXRlIGZvciBhIHBvcnRpb24gb2YgdGhlIFVJLFxyXG5cdFx0Ly8vIGFzIGluIHRoZSBleGFtcGxlIHdoZXJlIGFuIG9iamVjdHMgbWV0YSB0eXBlIGRldGVybWluZXMgaG93IGl0IGlzIFxyXG5cdFx0Ly8vIGRpc3BsYXllZCBpbiB0aGUgVUkuXHJcblx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiZWxlbWVudFwiPjwvcGFyYW0+XHJcblx0XHRDb250ZW50LmluaXRpYWxpemVCYXNlKHRoaXMsIFtlbGVtZW50XSk7XHJcblx0fVxyXG5cclxuXHR2YXIgY29udGVudENvbnRyb2xzUmVuZGVyaW5nID0gMDtcclxuXHJcblx0cmVnaXN0ZXJBY3Rpdml0eShcIkNvbnRlbnQgcmVuZGVyaW5nXCIsIGZ1bmN0aW9uKCkge1xyXG5cdFx0aWYgKGNvbnRlbnRDb250cm9sc1JlbmRlcmluZyA8IDApIHtcclxuXHRcdFx0bG9nV2FybmluZyhcIk51bWJlciBvZiBjb250ZW50IGNvbnRyb2xzIHJlbmRlcmluZyBzaG91bGQgbmV2ZXIgZGlwIGJlbG93IHplcm8uXCIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBjb250ZW50Q29udHJvbHNSZW5kZXJpbmcgPiAwO1xyXG5cdH0pO1xyXG5cclxuXHRDb250ZW50LnByb3RvdHlwZSA9IHtcclxuXHJcblx0XHRnZXRfdGVtcGxhdGU6IGZ1bmN0aW9uIENvbnRlbnQkZ2V0X3RlbXBsYXRlKCkge1xyXG5cdFx0XHQvLy8gPHZhbHVlIG1heUJlTnVsbD1cInRydWVcIiB0eXBlPVwiU3RyaW5nXCIgbG9jaWQ9XCJQOkojRXhvV2ViLlVJLkNvbnRlbnQudGVtcGxhdGVcIj48L3ZhbHVlPlxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fdGVtcGxhdGU7XHJcblx0XHR9LFxyXG5cdFx0c2V0X3RlbXBsYXRlOiBmdW5jdGlvbiAodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fdGVtcGxhdGUgPSB2YWx1ZTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0X2RhdGE6IGZ1bmN0aW9uIENvbnRlbnQkZ2V0X2RhdGEoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgbWF5QmVOdWxsPVwiZmFsc2VcIiBsb2NpZD1cIlA6SiNFeG9XZWIuVUkuQ29udGVudC5kYXRhXCI+PC92YWx1ZT5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGE7XHJcblx0XHR9LFxyXG5cdFx0c2V0X2RhdGE6IGZ1bmN0aW9uIENvbnRlbnQkc2V0X2RhdGEodmFsdWUpIHtcclxuXHRcdFx0dmFyIHJlbW92ZWREYXRhID0gKCh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsKSAmJiAodGhpcy5fZGF0YSAhPT0gdW5kZWZpbmVkICYmIHRoaXMuX2RhdGEgIT09IG51bGwpKTtcclxuXHJcblx0XHRcdGlmICh0aGlzLl9jaGFuZ2VkSGFuZGxlcikge1xyXG5cdFx0XHRcdC8vIFJlbW92ZSBvbGQgY2hhbmdlIGhhbmRsZXIgaWYgYXBwbGljYWJsZS5cclxuXHRcdFx0XHRPYnNlcnZlci5yZW1vdmVDb2xsZWN0aW9uQ2hhbmdlZCh0aGlzLl9kYXRhLCB0aGlzLl9jaGFuZ2VkSGFuZGxlcik7XHJcblx0XHRcdFx0ZGVsZXRlIHRoaXMuX2NoYW5nZWRIYW5kbGVyO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0aGlzLl9kYXRhID0gdmFsdWU7XHJcblxyXG5cdFx0XHRpZiAodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkge1xyXG5cdFx0XHRcdC8vIFdhdGNoIGZvciBjaGFuZ2VzIHRvIGFuIGFycmF5LlxyXG5cdFx0XHRcdHRoaXMuX2NoYW5nZWRIYW5kbGVyID0gdGhpcy5fY29sbGVjdGlvbkNoYW5nZWQuYmluZCh0aGlzKTtcclxuXHRcdFx0XHRPYnNlcnZlci5hZGRDb2xsZWN0aW9uQ2hhbmdlZCh2YWx1ZSwgdGhpcy5fY2hhbmdlZEhhbmRsZXIpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBGb3JjZSByZW5kZXJpbmcgdG8gb2NjdXIgaWYgd2UgcHJldmlvdXNseSBoYWQgYSB2YWx1ZSBhbmQgbm93IGRvIG5vdC5cclxuXHRcdFx0dGhpcy51cGRhdGUocmVtb3ZlZERhdGEpO1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfZGlzYWJsZWQ6IGZ1bmN0aW9uIENvbnRlbnQkZ2V0X2Rpc2FibGVkKCkge1xyXG5cdFx0XHQvLy8gPHZhbHVlIG1heUJlTnVsbD1cImZhbHNlXCIgdHlwZT1cIkJvb2xlYW5cIiBsb2NpZD1cIlA6SiNFeG9XZWIuVUkuQ29udGVudC5kaXNhYmxlZFwiPjwvdmFsdWU+XHJcblx0XHRcdHJldHVybiB0aGlzLl9kaXNhYmxlZCA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiAhIXRoaXMuX2Rpc2FibGVkO1xyXG5cdFx0fSxcclxuXHRcdHNldF9kaXNhYmxlZDogZnVuY3Rpb24gQ29udGVudCRzZXRfZGlzYWJsZWQodmFsdWUpIHtcclxuXHRcdFx0dmFyIG5ld1ZhbHVlO1xyXG5cclxuXHRcdFx0aWYgKHZhbHVlLmNvbnN0cnVjdG9yID09PSBCb29sZWFuKSB7XHJcblx0XHRcdFx0bmV3VmFsdWUgPSB2YWx1ZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh2YWx1ZS5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XHJcblx0XHRcdFx0bmV3VmFsdWUgPSB2YWx1ZS50b0xvd2VyQ2FzZSgpID09IFwidHJ1ZVwiID8gdHJ1ZSA6ICh2YWx1ZS50b0xvd2VyQ2FzZSgpID09IFwiZmFsc2VcIiA/IGZhbHNlIDogdW5kZWZpbmVkKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHZhbHVlIGZvciBwcm9wZXJ0eSBcXFwiZGlzYWJsZWRcXFwiOiBcIiArIHZhbHVlKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIG9sZFZhbHVlID0gdGhpcy5fZGlzYWJsZWQ7XHJcblx0XHRcdHRoaXMuX2Rpc2FibGVkID0gbmV3VmFsdWU7XHJcblxyXG5cdFx0XHRpZiAob2xkVmFsdWUgPT09IHRydWUgJiYgbmV3VmFsdWUgPT09IGZhbHNlKSB7XHJcblx0XHRcdFx0dGhpcy51cGRhdGUoKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfY29udGV4dHM6IGZ1bmN0aW9uIENvbnRlbnQkZ2V0X2NvbnRleHRzKCkge1xyXG5cdFx0XHQvLy8gPHZhbHVlIG1heUJlTnVsbD1cImZhbHNlXCIgdHlwZT1cIlx1MDAxYkFycmF5XCIgbG9jaWQ9XCJQOkojRXhvV2ViLlVJLkNvbnRlbnQuY29udGV4dHNcIj48L3ZhbHVlPlxyXG5cdFx0XHRyZXR1cm4gW3RoaXMuX2NvbnRleHRdO1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXRfdGVtcGxhdGVDb250ZXh0OiBmdW5jdGlvbiBDb250ZW50JGdldF90ZW1wbGF0ZUNvbnRleHQoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgbWF5QmVOdWxsPVwiZmFsc2VcIiB0eXBlPVwiXHUwMDFiU3lzLlVJLlRlbXBsYXRlQ29udGV4dFwiIGxvY2lkPVwiUDpKI0V4b1dlYi5VSS5Db250ZW50LnRlbXBsYXRlQ29udGV4dFwiPjwvdmFsdWU+XHJcblx0XHRcdGlmICghdGhpcy5fcGFyZW50Q29udGV4dCkge1xyXG5cdFx0XHRcdHRoaXMuX3BhcmVudENvbnRleHQgPSBTeXMuVUkuVGVtcGxhdGUuZmluZENvbnRleHQodGhpcy5fZWxlbWVudCk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudENvbnRleHQ7XHJcblx0XHR9LFxyXG5cdFx0c2V0X3RlbXBsYXRlQ29udGV4dDogZnVuY3Rpb24gQ29udGV4dCRzZXRfdGVtcGxhdGVDb250ZXh0KHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX3BhcmVudENvbnRleHQgPSB2YWx1ZTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0X2lzUmVuZGVyZWQ6IGZ1bmN0aW9uIENvbnRleHQkZ2V0X2lzUmVuZGVyZWQoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgbWF5QmVOdWxsPVwiZmFsc2VcIiB0eXBlPVwiXHUwMDFiQm9vbGVhblwiIGxvY2lkPVwiUDpKI0V4b1dlYi5VSS5Db250ZW50LmlzUmVuZGVyZWRcIj48L3ZhbHVlPlxyXG5cdFx0XHRyZXR1cm4gdGhpcy5faXNSZW5kZXJlZDtcclxuXHRcdH0sXHJcblxyXG5cdFx0YWRkX3JlbmRlcmluZzogZnVuY3Rpb24gQ29udGVudCRhZGRfcmVuZGVyaW5nKGhhbmRsZXIpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiRTpKI0V4b1dlYi5VSS5Db250ZW50LnJlbmRlcmluZ1wiIC8+XHJcblx0XHRcdHRoaXMuX2FkZEhhbmRsZXIoXCJyZW5kZXJpbmdcIiwgaGFuZGxlcik7XHJcblx0XHR9LFxyXG5cdFx0cmVtb3ZlX3JlbmRlcmluZzogZnVuY3Rpb24gQ29udGVudCRyZW1vdmVfcmVuZGVyaW5nKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fcmVtb3ZlSGFuZGxlcihcInJlbmRlcmluZ1wiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0YWRkX3JlbmRlcmVkOiBmdW5jdGlvbiBDb250ZW50JGFkZF9yZW5kZXJlZChoYW5kbGVyKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIkU6SiNFeG9XZWIuVUkuQ29udGVudC5yZW5kZXJlZFwiIC8+XHJcblx0XHRcdHRoaXMuX2FkZEhhbmRsZXIoXCJyZW5kZXJlZFwiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRyZW1vdmVfcmVuZGVyZWQ6IGZ1bmN0aW9uIENvbnRlbnQkcmVtb3ZlX3JlbmRlcmVkKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fcmVtb3ZlSGFuZGxlcihcInJlbmRlcmVkXCIsIGhhbmRsZXIpO1xyXG5cdFx0fSxcclxuXHJcblx0XHRhZGRfZXJyb3I6IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIkU6SiNFeG9XZWIuVUkuQ29udGVudC5lcnJvclwiIC8+XHJcblx0XHRcdHRoaXMuX2FkZEhhbmRsZXIoXCJlcnJvclwiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblx0XHRyZW1vdmVfZXJyb3I6IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUhhbmRsZXIoXCJlcnJvclwiLCBoYW5kbGVyKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0X2NvbGxlY3Rpb25DaGFuZ2VkOiBmdW5jdGlvbiAoc2VuZGVyLCBhcmdzKSB7XHJcblx0XHRcdHRoaXMudXBkYXRlKHRydWUpO1xyXG5cdFx0fSxcclxuXHJcblx0XHRfaW5pdGlhbGl6ZVJlc3VsdHM6IGZ1bmN0aW9uIENvbnRlbnQkX2luaXRpYWxpemVSZXN1bHRzKCkge1xyXG5cdFx0XHRpZiAodGhpcy5fY29udGV4dCkge1xyXG5cdFx0XHRcdHRoaXMuX2NvbnRleHQuaW5pdGlhbGl6ZUNvbXBvbmVudHMoKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHRfZ2VuZXJhdGVzQ29udGV4dDogZnVuY3Rpb24gQ29udGVudCRfZ2VuZXJhdGVzQ29udGV4dCgpIHtcclxuXHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHR9LFxyXG5cdFx0X3NldFRlbXBsYXRlQ3R4SWQ6IGZ1bmN0aW9uIENvbnRlbnQkX3NldFRlbXBsYXRlQ3R4SWQoaWR4KSB7XHJcblx0XHRcdHRoaXMuX2N0eElkeCA9IGlkeDtcclxuXHRcdH0sXHJcblxyXG5cdFx0X2ZpbmRUZW1wbGF0ZTogZnVuY3Rpb24gQ29udGVudCRfZmluZFRlbXBsYXRlKCkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojRXhvV2ViLlVJLkNvbnRlbnQuX2ZpbmRUZW1wbGF0ZVwiPlxyXG5cdFx0XHQvLy8gRmluZCB0aGUgZmlyc3QgbWF0Y2hpbmcgdGVtcGxhdGUgZm9yIHRoZSBjb250ZW50IGNvbnRyb2wuXHJcblx0XHRcdC8vLyA8L3N1bW1hcnk+XHJcblx0XHRcdHZhciB0bXBsTmFtZXM7XHJcblx0XHRcdGlmICh0aGlzLl9jb250ZW50VGVtcGxhdGUpIHtcclxuXHRcdFx0XHR0bXBsTmFtZXMgPSB0aGlzLl9jb250ZW50VGVtcGxhdGU7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHRoaXMuX3RlbXBsYXRlKSB7XHJcblx0XHRcdFx0aWYgKHRtcGxOYW1lcykge1xyXG5cdFx0XHRcdFx0dG1wbE5hbWVzICs9IFwiIFwiO1xyXG5cdFx0XHRcdFx0dG1wbE5hbWVzICs9IHRoaXMuX3RlbXBsYXRlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHRtcGxOYW1lcyA9IHRoaXMuX3RlbXBsYXRlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIHRtcGxFbCA9IGZpbmRUZW1wbGF0ZSh0aGlzLl9lbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKSwgdGhpcy5fZGF0YSwgdG1wbE5hbWVzID8gdG1wbE5hbWVzLnRyaW0oKS5zcGxpdCgvXFxzKy8pIDogW10pO1xyXG5cclxuXHRcdFx0aWYgKCF0bXBsRWwpIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJGZvcm1hdChcIlRoaXMgY29udGVudCByZWdpb24gZG9lcyBub3QgbWF0Y2ggYW55IGF2YWlsYWJsZSB0ZW1wbGF0ZXMuIFRhZz17MH0sIERhdGE9ezF9LCBUZW1wbGF0ZT17Mn1cIiwgdGhpcy5fZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCksIHRoaXMuX2RhdGEsIHRtcGxOYW1lcyB8fCBcIlwiKSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiB0bXBsRWw7XHJcblx0XHR9LFxyXG5cclxuXHRcdF9jYW5SZW5kZXI6IGZ1bmN0aW9uIENvbnRlbnQkX2NhblJlbmRlcihmb3JjZSkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojRXhvV2ViLlVJLkNvbnRlbnQuX2NhblJlbmRlclwiPlxyXG5cdFx0XHQvLy8gRW5zdXJlIHRoYXQgdGhlIGNvbnRyb2wgaXMgaW5pdGlhbGl6ZWQsIGhhcyBhbiBlbGVtZW50LCBhbmQgdGhlIFwiZGF0YVwiIHByb3BlcnR5IGhhcyBiZWVuIHNldC5cclxuXHRcdFx0Ly8vIDEpIFRoZSBzZXRfZGF0YSBtZXRob2QgbWF5IGJlIGNhbGxlZCBiZWZvcmUgdGhlIGNvbnRyb2wgaGFzIGJlZW4gaW5pdGlhbGl6ZWQuXHJcblx0XHRcdC8vLyAyKSBJZiBhIGxhenkgbWFya3VwIGV4dGVuc2lvbiBpcyB1c2VkIHRvIHNldCB0aGUgXCJkYXRhXCIgcHJvcGVydHkgdGhlbiBhIGNhbGxiYWNrIGNvdWxkIHNldCB0aGUgXHJcblx0XHRcdC8vLyBwcm9wZXJ0eSB2YWx1ZSB3aGVuIHRoZSBlbGVtZW50IGlzIHVuZGVmaW5lZCwgcG9zc2libHkgYmVjYXVzZSBvZiB0ZW1wbGF0ZSByZS1yZW5kZXJpbmcuXHJcblx0XHRcdC8vLyAzKSBJZiBhIGxhenkgbWFya3VwIGV4dGVuc2lvbiBpcyB1c2VkIHRvIHNldCB0aGUgXCJkYXRhXCIgcHJvcGVydHkgdGhlbiBpdCBtYXkgbm90IGhhdmUgYSB2YWx1ZSB3aGVuIGluaXRpYWxpemVkLlxyXG5cdFx0XHQvLy8gQWxzbyBjaGVjayB0aGF0IHRoZSBjb250cm9sIGhhcyBub3QgYmVlbiBkaXNhYmxlZC5cclxuXHRcdFx0Ly8vIDwvc3VtbWFyeT5cclxuXHJcblx0XHRcdHJldHVybiAoKHRoaXMuX2RhdGEgIT09IHVuZGVmaW5lZCAmJiB0aGlzLl9kYXRhICE9PSBudWxsKSB8fCBmb3JjZSA9PT0gdHJ1ZSkgJiZcclxuXHRcdFx0XHR0aGlzLmdldF9pc0luaXRpYWxpemVkKCkgJiYgdGhpcy5fZWxlbWVudCAhPT0gdW5kZWZpbmVkICYmIHRoaXMuX2VsZW1lbnQgIT09IG51bGwgJiYgIXRoaXMuZ2V0X2Rpc2FibGVkKCk7XHJcblx0XHR9LFxyXG5cclxuXHRcdF9nZXRSZXN1bHRpbmdUZW1wbGF0ZU5hbWVzOiBmdW5jdGlvbiBDb250ZW50JF9nZXRSZXN1bHRpbmdUZW1wbGF0ZU5hbWVzKHRtcGxFbCkge1xyXG5cdFx0XHQvLyB1c2Ugc3lzOmNvbnRlbnQtdGVtcGxhdGUgKG9uIGNvbnRlbnQgY29udHJvbCkgYW5kIGNvbnRlbnQ6dGVtcGxhdGVcclxuXHRcdFx0dmFyIGNvbnRlbnRUZW1wbGF0ZU5hbWVzO1xyXG5cdFx0XHRpZiAodGhpcy5fY29udGVudFRlbXBsYXRlKSB7XHJcblx0XHRcdFx0Y29udGVudFRlbXBsYXRlTmFtZXMgPSB0aGlzLl9jb250ZW50VGVtcGxhdGU7XHJcblx0XHRcdFx0aWYgKHRoaXMuX3RlbXBsYXRlKSB7XHJcblx0XHRcdFx0XHRjb250ZW50VGVtcGxhdGVOYW1lcyArPSBcIiBcIiArIHRoaXMuX3RlbXBsYXRlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh0aGlzLl90ZW1wbGF0ZSkge1xyXG5cdFx0XHRcdGNvbnRlbnRUZW1wbGF0ZU5hbWVzID0gdGhpcy5fdGVtcGxhdGU7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0Y29udGVudFRlbXBsYXRlTmFtZXMgPSBcIlwiO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR2YXIgY29udGVudFRlbXBsYXRlID0gY29udGVudFRlbXBsYXRlTmFtZXMudHJpbSgpLnNwbGl0KC9cXHMrLykuZGlzdGluY3QoKTtcclxuXHJcblx0XHRcdC8vIFJlbW92ZSBuYW1lcyBtYXRjaGVkIGJ5IHRoZSB0ZW1wbGF0ZVxyXG5cdFx0XHRpZiAoY29udGVudFRlbXBsYXRlLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHR2YXIgdG1wbE5hbWVzID0gdG1wbEVsLmNvbnRyb2wuZ2V0X25hbWVBcnJheSgpO1xyXG5cdFx0XHRcdGlmICh0bXBsTmFtZXMpIHtcclxuXHRcdFx0XHRcdHB1cmdlKGNvbnRlbnRUZW1wbGF0ZSwgZnVuY3Rpb24obmFtZSkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gdG1wbE5hbWVzLmluZGV4T2YobmFtZSkgPj0gMDtcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gQWRkIHN5czpjb250ZW50LXRlbXBsYXRlIGRlZmluZWQgb24gdGhlIHRlbXBsYXRlIGVsZW1lbnRcclxuXHRcdFx0aWYgKHRtcGxFbC5jb250cm9sLl9jb250ZW50VGVtcGxhdGUpIHtcclxuXHRcdFx0XHRjb250ZW50VGVtcGxhdGUuYWRkUmFuZ2UodG1wbEVsLmNvbnRyb2wuX2NvbnRlbnRUZW1wbGF0ZS50cmltKCkuc3BsaXQoL1xccysvKSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiBjb250ZW50VGVtcGxhdGU7XHJcblx0XHR9LFxyXG5cclxuXHRcdF9yZW5kZXI6IGZ1bmN0aW9uIENvbnRlbnQkX3JlbmRlcigpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI0V4b1dlYi5VSS5Db250ZW50Ll9yZW5kZXJcIj5cclxuXHRcdFx0Ly8vIFJlbmRlciB0aGUgY29udGVudCB0ZW1wbGF0ZSBpbnRvIHRoZSBjb250YWluZXIgZWxlbWVudC5cclxuXHRcdFx0Ly8vIDwvc3VtbWFyeT5cclxuXHJcblx0XHRcdC8vIEZhaWxpbmcgdG8gZW1wdHkgY29udGVudCBiZWZvcmUgcmVuZGVyaW5nIGNhbiByZXN1bHQgaW4gaW52YWxpZCBjb250ZW50IHNpbmNlIHJlbmRlcmluZyBcclxuXHRcdFx0Ly8gY29udGVudCBpcyBub3QgbmVjZXNzYXJpbHkgaW4gb3JkZXIgYmVjYXVzZSBvZiB3YWl0aW5nIG9uIGV4dGVybmFsIHRlbXBsYXRlcy5cclxuXHRcdFx0dmFyIGNvbnRhaW5lciA9IHRoaXMuX2VsZW1lbnQ7XHJcblxyXG5cdFx0XHRqUXVlcnkoY29udGFpbmVyKS5lbXB0eSgpO1xyXG5cclxuXHRcdFx0dmFyIHBhcmVudENvbnRleHQgPSB0aGlzLmdldF90ZW1wbGF0ZUNvbnRleHQoKTtcclxuXHRcdFx0dGhpcy5fY29udGV4dCA9IG51bGw7XHJcblxyXG5cdFx0XHR2YXIgZGF0YSA9IHRoaXMuX2RhdGE7XHJcblx0XHRcdGlmIChkYXRhICE9PSBudWxsICYmIGRhdGEgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdHZhciB0bXBsRWwgPSB0aGlzLl9maW5kVGVtcGxhdGUoKTtcclxuXHRcdFx0XHR2YXIgdGVtcGxhdGUgPSBuZXcgU3lzLlVJLlRlbXBsYXRlKHRtcGxFbCk7XHJcblxyXG5cdFx0XHRcdC8vIGdldCBjdXN0b20gY2xhc3NlcyBmcm9tIHRlbXBsYXRlXHJcblx0XHRcdFx0dmFyIGNsYXNzZXMgPSBqUXVlcnkodG1wbEVsKS5hdHRyKFwiY2xhc3NcIik7XHJcblx0XHRcdFx0aWYgKGNsYXNzZXMpIHtcclxuXHRcdFx0XHRcdGNsYXNzZXMgPSBqUXVlcnkudHJpbShjbGFzc2VzLnJlcGxhY2UoXCJleG93ZWItdGVtcGxhdGVcIiwgXCJcIikucmVwbGFjZShcInN5cy10ZW1wbGF0ZVwiLCBcIlwiKSk7XHJcblx0XHRcdFx0XHRqUXVlcnkoY29udGFpbmVyKS5hZGRDbGFzcyhjbGFzc2VzKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIEdldCB0aGUgbGlzdCBvZiB0ZW1wbGF0ZSBuYW1lcyBhcHBsaWNhYmxlIHRvIHRoZSBjb250cm9sJ3MgY2hpbGRyZW5cclxuXHRcdFx0XHR2YXIgY29udGVudFRlbXBsYXRlID0gdGhpcy5fZ2V0UmVzdWx0aW5nVGVtcGxhdGVOYW1lcyh0bXBsRWwpO1xyXG5cclxuXHRcdFx0XHR0aGlzLl9jb250ZXh0ID0gdGVtcGxhdGUuaW5zdGFudGlhdGVJbihjb250YWluZXIsIHRoaXMuX2RhdGEsIHRoaXMuX2RhdGEsIDAsIG51bGwsIHBhcmVudENvbnRleHQsIGNvbnRlbnRUZW1wbGF0ZS5qb2luKFwiIFwiKSk7XHJcblxyXG5cdFx0XHRcdHRoaXMuX2luaXRpYWxpemVSZXN1bHRzKCk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblxyXG5cdFx0X3JlbmRlclN0YXJ0OiBmdW5jdGlvbiBDb250ZW50JF9yZW5kZXJTdGFydChmb3JjZSkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojRXhvV2ViLlVJLkNvbnRlbnQuX3JlbmRlclN0YXJ0XCI+XHJcblx0XHRcdC8vLyBTdGFydCB0aGUgcmVuZGVyaW5nIHByb2Nlc3MuIFRoZXJlIG1heSBiZSBhIGRlbGF5IGlmIGV4dGVybmFsIHRlbXBsYXRlc1xyXG5cdFx0XHQvLy8gaGF2ZSBub3QgeWV0IGZpbmlzaGVkIGxvYWRpbmcuXHJcblx0XHRcdC8vLyA8L3N1bW1hcnk+XHJcblx0XHRcdGlmICh0aGlzLl9jYW5SZW5kZXIoZm9yY2UpKSB7XHJcblx0XHRcdFx0Y29udGVudENvbnRyb2xzUmVuZGVyaW5nKys7XHJcblxyXG5cdFx0XHRcdGV4dGVybmFsVGVtcGxhdGVzU2lnbmFsLndhaXRGb3JBbGwoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMuX2VsZW1lbnQgPT09IHVuZGVmaW5lZCB8fCB0aGlzLl9lbGVtZW50ID09PSBudWxsKSB7XHJcblx0XHRcdFx0XHRcdGNvbnRlbnRDb250cm9sc1JlbmRlcmluZy0tO1xyXG5cdFx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0dmFyIHJlbmRlckFyZ3MgPSBuZXcgU3lzLkRhdGEuRGF0YUV2ZW50QXJncyh0aGlzLl9kYXRhKTtcclxuXHRcdFx0XHRcdFN5cy5PYnNlcnZlci5yYWlzZUV2ZW50KHRoaXMsIFwicmVuZGVyaW5nXCIsIHJlbmRlckFyZ3MpO1xyXG5cclxuXHRcdFx0XHRcdHRoaXMuX2lzUmVuZGVyZWQgPSBmYWxzZTtcclxuXHJcblx0XHRcdFx0XHR0cnkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLl9yZW5kZXIoKTtcclxuXHRcdFx0XHRcdFx0dGhpcy5faXNSZW5kZXJlZCA9IHRydWU7XHJcblx0XHRcdFx0XHRcdFN5cy5PYnNlcnZlci5yYWlzZUV2ZW50KHRoaXMsIFwicmVuZGVyZWRcIiwgcmVuZGVyQXJncyk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRmaW5hbGx5IHtcclxuXHRcdFx0XHRcdFx0Y29udGVudENvbnRyb2xzUmVuZGVyaW5nLS07XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblxyXG5cdFx0X2xpbms6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0aWYgKCF0aGlzLl9jdHhJZHggJiYgdGhpcy5fZWxlbWVudCAmJiB0aGlzLl9lbGVtZW50LmNoaWxkTm9kZXMubGVuZ3RoID4gMClcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJBIGNvbnRlbnQgY29udHJvbCBpcyBhdHRhY2hlZCB0byB0aGUgbm9kZSwgd2hpY2ggZXhwZWN0cyBhIHRlbXBsYXRlIGNvbnRleHQgaWQsIGJ1dCBubyBpZCB3YXMgc3BlY2lmaWVkLlwiKTtcclxuXHJcblx0XHRcdGlmICgodGhpcy5fZGF0YSAhPT0gbnVsbCAmJiB0aGlzLl9kYXRhICE9PSB1bmRlZmluZWQpIHx8ICh0aGlzLl9lbGVtZW50ICYmIHRoaXMuX2VsZW1lbnQuY2hpbGROb2Rlcy5sZW5ndGggPiAwKSkge1xyXG5cdFx0XHRcdHZhciBwY3R4ID0gdGhpcy5nZXRfdGVtcGxhdGVDb250ZXh0KCk7XHJcblx0XHRcdFx0dmFyIHRtcGxFbCA9IHRoaXMuX2ZpbmRUZW1wbGF0ZSgpO1xyXG5cclxuXHRcdFx0XHR2YXIgbmV3Q29udGV4dCA9IG5ldyBTeXMuVUkuVGVtcGxhdGVDb250ZXh0KHRoaXMuX2N0eElkeCk7XHJcblx0XHRcdFx0bmV3Q29udGV4dC5kYXRhID0gdGhpcy5fZGF0YTtcclxuXHRcdFx0XHRuZXdDb250ZXh0LmNvbXBvbmVudHMgPSBbXTtcclxuXHRcdFx0XHRuZXdDb250ZXh0Lm5vZGVzID0gW107XHJcblx0XHRcdFx0bmV3Q29udGV4dC5kYXRhSXRlbSA9IHRoaXMuX2RhdGE7XHJcblx0XHRcdFx0bmV3Q29udGV4dC5pbmRleCA9IDA7XHJcblx0XHRcdFx0bmV3Q29udGV4dC5wYXJlbnRDb250ZXh0ID0gcGN0eDtcclxuXHRcdFx0XHRuZXdDb250ZXh0LmNvbnRhaW5lckVsZW1lbnQgPSB0aGlzLl9lbGVtZW50O1xyXG5cdFx0XHRcdG5ld0NvbnRleHQudGVtcGxhdGUgPSBuZXcgU3lzLlVJLlRlbXBsYXRlKHRtcGxFbCk7XHJcblx0XHRcdFx0bmV3Q29udGV4dC50ZW1wbGF0ZS5fZW5zdXJlQ29tcGlsZWQoKTtcclxuXHJcblx0XHRcdFx0dGhpcy5fY29udGV4dCA9IG5ld0NvbnRleHQ7XHJcblxyXG5cdFx0XHRcdC8vIEdldCB0aGUgbGlzdCBvZiB0ZW1wbGF0ZSBuYW1lcyBhcHBsaWNhYmxlIHRvIHRoZSBjb250cm9sJ3MgY2hpbGRyZW5cclxuXHRcdFx0XHR2YXIgY29udGVudFRlbXBsYXRlID0gdGhpcy5fZ2V0UmVzdWx0aW5nVGVtcGxhdGVOYW1lcyh0bXBsRWwpO1xyXG5cclxuXHRcdFx0XHR2YXIgZWxlbWVudCA9IHRoaXMuX2VsZW1lbnQ7XHJcblx0XHRcdFx0U3lzLkFwcGxpY2F0aW9uLl9saW5rQ29udGV4dHMocGN0eCwgdGhpcywgdGhpcy5fZGF0YSwgZWxlbWVudCwgbmV3Q29udGV4dCwgY29udGVudFRlbXBsYXRlLmpvaW4oXCIgXCIpKTtcclxuXHJcblx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50LmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHRcdG5ld0NvbnRleHQubm9kZXMucHVzaChlbGVtZW50LmNoaWxkTm9kZXNbaV0pO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0bmV3Q29udGV4dC5fb25JbnN0YW50aWF0ZWQobnVsbCwgdHJ1ZSk7XHJcblx0XHRcdFx0dGhpcy5faW5pdGlhbGl6ZVJlc3VsdHMoKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHRsaW5rOiBmdW5jdGlvbiBDb250ZW50JGxpbmsoKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNFeG9XZWIuVUkuQ29udGVudC5saW5rXCIgLz5cclxuXHRcdFx0aWYgKCF0aGlzLl9saW5rSW5Qcm9ncmVzcykge1xyXG5cdFx0XHRcdHRoaXMuX2xpbmtJblByb2dyZXNzID0gdHJ1ZTtcclxuXHRcdFx0XHRjb250ZW50Q29udHJvbHNSZW5kZXJpbmcrKztcclxuXHRcdFx0XHRleHRlcm5hbFRlbXBsYXRlc1NpZ25hbC53YWl0Rm9yQWxsKGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdC8vIENvbnRyb2wgaGFzIGRpc3Bvc2VkLlxyXG5cdFx0XHRcdFx0aWYgKHRoaXMuX2VsZW1lbnQgPT09IHVuZGVmaW5lZCB8fCB0aGlzLl9lbGVtZW50ID09PSBudWxsKSB7XHJcblx0XHRcdFx0XHRcdEV4b1dlYi5VSS5Db250ZW50LmNhbGxCYXNlTWV0aG9kKHRoaXMsICdsaW5rJyk7XHJcblx0XHRcdFx0XHRcdGNvbnRlbnRDb250cm9sc1JlbmRlcmluZy0tO1xyXG5cdFx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0dHJ5IHtcclxuXHRcdFx0XHRcdFx0ZGVsZXRlIHRoaXMuX2xpbmtJblByb2dyZXNzO1xyXG5cdFx0XHRcdFx0XHR0aGlzLl9pc1JlbmRlcmVkID0gdHJ1ZTtcclxuXHRcdFx0XHRcdFx0dGhpcy5fY29udGV4dCA9IG51bGw7XHJcblx0XHRcdFx0XHRcdHRoaXMuX2xpbmsoKTtcclxuXHRcdFx0XHRcdFx0RXhvV2ViLlVJLkNvbnRlbnQuY2FsbEJhc2VNZXRob2QodGhpcywgJ2xpbmsnKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGZpbmFsbHkge1xyXG5cdFx0XHRcdFx0XHRjb250ZW50Q29udHJvbHNSZW5kZXJpbmctLTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHR1cGRhdGU6IGZ1bmN0aW9uIENvbnRlbnQkdXBkYXRlKGZvcmNlKSB7XHJcblx0XHRcdGlmICh0aGlzLmdldF9pc0xpbmtQZW5kaW5nKCkpIHtcclxuXHRcdFx0XHRpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShcIl9kYXRhXCIpKSB7XHJcblx0XHRcdFx0XHR0aGlzLmxpbmsoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAodGhpcy5fY2FuUmVuZGVyKGZvcmNlKSkge1xyXG5cdFx0XHRcdHRoaXMuX3JlbmRlclN0YXJ0KGZvcmNlKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHRkaXNwb3NlOiBmdW5jdGlvbiBFeG9XZWIkVUkkQ29udGVudCRkaXNwb3NlKCkge1xyXG5cdFx0XHRpZiAodGhpcy5fY29udGV4dCkge1xyXG5cdFx0XHRcdHRoaXMuX2NvbnRleHQuZGlzcG9zZSgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh0aGlzLl9jaGFuZ2VkSGFuZGxlcikge1xyXG5cdFx0XHRcdE9ic2VydmVyLnJlbW92ZUNvbGxlY3Rpb25DaGFuZ2VkKHRoaXMuX2RhdGEsIHRoaXMuX2NoYW5nZWRIYW5kbGVyKTtcclxuXHRcdFx0XHR0aGlzLl9jaGFuZ2VkSGFuZGxlciA9IG51bGw7XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5fY29udGVudFRlbXBsYXRlID0gdGhpcy5fY29udGV4dCA9IHRoaXMuX2N0eElkeCA9XHJcblx0XHRcdFx0dGhpcy5fZGF0YSA9IHRoaXMuX2Rpc2FibGVkID0gdGhpcy5faXNSZW5kZXJlZCA9IHRoaXMuX3BhcmVudENvbnRleHQgPSB0aGlzLl90ZW1wbGF0ZSA9IG51bGw7XHJcblx0XHRcdEV4b1dlYi5VSS5Db250ZW50LmNhbGxCYXNlTWV0aG9kKHRoaXMsIFwiZGlzcG9zZVwiKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0aW5pdGlhbGl6ZTogZnVuY3Rpb24gQ29udGVudCRpbml0aWFsaXplKCkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojRXhvV2ViLlVJLkNvbnRlbnQuaW5pdGlhbGl6ZVwiIC8+XHJcblx0XHRcdENvbnRlbnQuY2FsbEJhc2VNZXRob2QodGhpcywgXCJpbml0aWFsaXplXCIpO1xyXG5cclxuXHRcdFx0aWYgKGpRdWVyeSh0aGlzLl9lbGVtZW50KS5pcyhcIi5zeXMtdGVtcGxhdGVcIikpIHtcclxuXHRcdFx0XHRpZiAoalF1ZXJ5KHRoaXMuX2VsZW1lbnQpLmNoaWxkcmVuKCkubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdFx0bG9nV2FybmluZyhcIkNvbnRlbnQgY29udHJvbCBpcyBtYXJrZWQgd2l0aCB0aGUgXFxcInN5cy10ZW1wbGF0ZVxcXCIgY2xhc3MsIHdoaWNoIG1lYW5zIHRoYXQgaXRzIGNoaWxkcmVuIHdpbGwgYmUgaWdub3JlZCBhbmQgZGlzY2FyZGVkLlwiKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRsb2dXYXJuaW5nKFwiTm8gbmVlZCB0byBtYXJrIGEgY29udGVudCBjb250cm9sIHdpdGggdGhlIFxcXCJzeXMtdGVtcGxhdGVcXFwiIGNsYXNzLlwiKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy51cGRhdGUoKTtcclxuXHRcdH1cclxuXHJcblx0fTtcclxuXHJcblx0RXhvV2ViLlVJLkNvbnRlbnQgPSBDb250ZW50O1xyXG5cdENvbnRlbnQucmVnaXN0ZXJDbGFzcyhcIkV4b1dlYi5VSS5Db250ZW50XCIsIFN5cy5VSS5Db250cm9sLCBTeXMuVUkuSVRlbXBsYXRlQ29udGV4dENvbnN1bWVyLCBTeXMuVUkuSUNvbnRlbnRUZW1wbGF0ZUNvbnN1bWVyKTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5VSS5EYXRhVmlld1xyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdHZhciBkYXRhVmlld3NSZW5kZXJpbmcgPSAwO1xyXG5cclxuXHRyZWdpc3RlckFjdGl2aXR5KFwiRGF0YVZpZXcgcmVuZGVyaW5nXCIsIGZ1bmN0aW9uKCkge1xyXG5cdFx0aWYgKGRhdGFWaWV3c1JlbmRlcmluZyA8IDApIHtcclxuXHRcdFx0bG9nV2FybmluZyhcIk51bWJlciBvZiBkYXRhdmlldyBjb250cm9scyByZW5kZXJpbmcgc2hvdWxkIG5ldmVyIGRpcCBiZWxvdyB6ZXJvLlwiKTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gZGF0YVZpZXdzUmVuZGVyaW5nID4gMDtcclxuXHR9KTtcclxuXHJcblx0dmFyIGRhdGFWaWV3UmVmcmVzaCA9IFN5cy5VSS5EYXRhVmlldy5wcm90b3R5cGUucmVmcmVzaDtcclxuXHRTeXMuVUkuRGF0YVZpZXcucHJvdG90eXBlLnJlZnJlc2ggPSBmdW5jdGlvbiByZWZyZXNoKCkge1xyXG5cdFx0ZGF0YVZpZXdzUmVuZGVyaW5nKys7XHJcblxyXG5cdFx0aWYgKHRoaXMuZ2V0X2VsZW1lbnQoKSkge1xyXG5cdFx0XHRkYXRhVmlld1JlZnJlc2guYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRsb2dXYXJuaW5nKFwiQXR0ZW1wdGluZyB0byByZWZyZXNoLCBidXQgRGF0YVZpZXcgd2FzIGJlaW5nIGRpc3Bvc2VkLlwiKTtcclxuXHRcdH1cclxuXHJcblx0XHRkYXRhVmlld3NSZW5kZXJpbmctLTtcclxuXHR9O1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLlVJLkh0bWxcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHRmdW5jdGlvbiBIdG1sKGVsZW1lbnQpIHtcclxuXHRcdC8vLyA8c3VtbWFyeT5cclxuXHRcdC8vLyA8L3N1bW1hcnk+XHJcblx0XHQvLy8gPGV4YW1wbGU+XHJcblx0XHQvLy9cdFx0PGRpdiBzeXM6YXR0YWNoPVwiaHRtbFwiIGh0bWw6dXJsPVwiaHR0cDovL3d3dy5nb29nbGUuY29tXCI+PC9kaXY+XHJcblx0XHQvLy8gPC9leGFtcGxlPlxyXG5cclxuXHRcdEh0bWwuaW5pdGlhbGl6ZUJhc2UodGhpcywgW2VsZW1lbnRdKTtcclxuXHR9XHJcblxyXG5cdEh0bWwucHJvdG90eXBlID0ge1xyXG5cdFx0Z2V0X3NvdXJjZTogZnVuY3Rpb24gSHRtbCRnZXRfc291cmNlKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fc291cmNlO1xyXG5cdFx0fSxcclxuXHRcdHNldF9zb3VyY2U6IGZ1bmN0aW9uIEh0bWwkc2V0X3NvdXJjZSh2YWx1ZSkge1xyXG5cdFx0XHR0aGlzLl9zb3VyY2UgPSB2YWx1ZTtcclxuXHRcdH0sXHJcblx0XHRnZXRfbG9hZGluZ0NsYXNzOiBmdW5jdGlvbiBIdG1sJGdldF9sb2FkaW5nQ2xhc3MoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9sb2FkaW5nQ2xhc3M7XHJcblx0XHR9LFxyXG5cdFx0c2V0X2xvYWRpbmdDbGFzczogZnVuY3Rpb24gSHRtbCRzZXRfbG9hZGluZ0NsYXNzKHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX2xvYWRpbmdDbGFzcyA9IHZhbHVlO1xyXG5cdFx0fSxcclxuXHRcdGdldF91cmw6IGZ1bmN0aW9uIEh0bWwkZ2V0X3VybCgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX3VybDtcclxuXHRcdH0sXHJcblx0XHRzZXRfdXJsOiBmdW5jdGlvbiBIdG1sJHNldF91cmwodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fdXJsID0gdmFsdWU7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X3BhdGg6IGZ1bmN0aW9uIEh0bWwkZ2V0X3BhdGgoKSB7XHJcblx0XHRcdHZhciBzb3VyY2UgPSB0aGlzLmdldF9zb3VyY2UoKTtcclxuXHRcdFx0dmFyIHVybCA9IHRoaXMuZ2V0X3VybCgpO1xyXG5cdFx0XHRpZiAoc291cmNlIGluc3RhbmNlb2YgRXhvV2ViLk1vZGVsLkVudGl0eSkge1xyXG5cdFx0XHRcdHVybCA9IHNvdXJjZS50b1N0cmluZyh1cmwpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiAkZm9ybWF0KHVybCwgc291cmNlKTtcclxuXHRcdH0sXHJcblx0XHRpbml0aWFsaXplOiBmdW5jdGlvbiBIdG1sJGluaXRpYWxpemUoKSB7XHJcblx0XHRcdEh0bWwuY2FsbEJhc2VNZXRob2QodGhpcywgXCJpbml0aWFsaXplXCIpO1xyXG5cclxuXHRcdFx0dmFyIHBhdGggPSB0aGlzLmdldF9wYXRoKCk7XHJcblx0XHRcdHZhciBlbGVtZW50ID0gdGhpcy5nZXRfZWxlbWVudCgpO1xyXG5cdFx0XHR2YXIgbG9hZGluZ0NsYXNzID0gdGhpcy5nZXRfbG9hZGluZ0NsYXNzKCk7XHJcblxyXG5cdFx0XHRqUXVlcnkoZWxlbWVudCkuYWRkQ2xhc3MobG9hZGluZ0NsYXNzKTtcclxuXHJcblx0XHRcdGpRdWVyeShlbGVtZW50KS5sb2FkKHBhdGgsIGZ1bmN0aW9uKHJlc3BvbnNlVGV4dCwgc3RhdHVzLCByZXNwb25zZSkge1xyXG5cdFx0XHRcdGpRdWVyeShlbGVtZW50KS5yZW1vdmVDbGFzcyhsb2FkaW5nQ2xhc3MpO1xyXG5cclxuXHRcdFx0XHRpZiAoc3RhdHVzICE9IFwic3VjY2Vzc1wiICYmIHN0YXR1cyAhPSBcIm5vdG1vZGlmaWVkXCIpIHtcclxuXHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBsb2FkIGh0bWw6IHN0YXR1cyA9IFwiICsgc3RhdHVzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdEV4b1dlYi5VSS5IdG1sID0gSHRtbDtcclxuXHRIdG1sLnJlZ2lzdGVyQ2xhc3MoXCJFeG9XZWIuVUkuSHRtbFwiLCBTeXMuVUkuQ29udHJvbCk7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuVUkuQmVoYXZpb3JcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHRmdW5jdGlvbiBCZWhhdmlvcihlbGVtZW50KSB7XHJcblx0XHQvLy8gPHN1bW1hcnk+XHJcblx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cdFx0Ly8vIDxleGFtcGxlPlxyXG5cdFx0Ly8vXHRcdDxkaXYgc3lzOmF0dGFjaD1cImJlaGF2aW9yXCIgYmVoYXZpb3I6c2NyaXB0PVwiU3lzLnNjcmlwdHMuRm9vXCIgYmVoYXZpb3I6dHlwZW5hbWU9XCJNeS5DbGFzc1wiIGJlaGF2aW9yOnByb3AtZm9vPVwiYmFyXCI+PC9kaXY+XHJcblx0XHQvLy8gPC9leGFtcGxlPlxyXG5cclxuXHRcdEJlaGF2aW9yLmluaXRpYWxpemVCYXNlKHRoaXMsIFtlbGVtZW50XSk7XHJcblx0fVxyXG5cclxuXHRCZWhhdmlvci5wcm90b3R5cGUgPSB7XHJcblx0XHRnZXRfc2NyaXB0OiBmdW5jdGlvbiBCZWhhdmlvciRnZXRfc2NyaXB0KCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fc2NyaXB0O1xyXG5cdFx0fSxcclxuXHRcdHNldF9zY3JpcHQ6IGZ1bmN0aW9uIEJlaGF2aW9yJHNldF9zY3JpcHQodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fc2NyaXB0ID0gdmFsdWU7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X3NjcmlwdE9iamVjdDogZnVuY3Rpb24gQmVoYXZpb3IkZ2V0X3NjcmlwdCgpIHtcclxuXHRcdFx0aWYgKCF0aGlzLl9zY3JpcHRPYmplY3QpIHtcclxuXHRcdFx0XHR2YXIgcGF0aCA9IHRoaXMuX3NjcmlwdC5zdGFydHNXaXRoKFwid2luZG93XCIpID9cclxuXHRcdFx0XHRcdHRoaXMuX3NjcmlwdC5zdWJzdHJpbmcoNykgOlxyXG5cdFx0XHRcdFx0dGhpcy5fc2NyaXB0O1xyXG5cclxuXHRcdFx0XHR0aGlzLl9zY3JpcHRPYmplY3QgPSBFeG9XZWIuZXZhbFBhdGgod2luZG93LCBwYXRoKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX3NjcmlwdE9iamVjdDtcclxuXHRcdH0sXHJcblx0XHRnZXRfdHlwZU5hbWU6IGZ1bmN0aW9uIEJlaGF2aW9yJGdldF90eXBlTmFtZSgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX3R5cGVOYW1lO1xyXG5cdFx0fSxcclxuXHRcdHNldF90eXBlTmFtZTogZnVuY3Rpb24gQmVoYXZpb3Ikc2V0X3R5cGVOYW1lKHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX3R5cGVOYW1lID0gdmFsdWU7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIE5PVEU6IEtlZXAgdGhlc2UgcHJvcGVydGllcyBhcm91bmQgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LlxyXG5cdFx0Z2V0X2NsYXNzOiBmdW5jdGlvbiBCZWhhdmlvciRnZXRfY2xhc3MoKSB7XHJcblx0XHRcdGxvZ1dhcm5pbmcoXCJUaGUgYmVoYXZpb3I6Y2xhc3MgcHJvcGVydHkgaXMgZGVwcmVjYXRlZCAoc2VlIGlzc3VlICMxKS4gQ29uc2lkZXIgdXNpbmcgYmVoYXZpb3I6dHlwZW5hbWUgaW5zdGVhZC5cIik7XHJcblxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fdHlwZU5hbWU7XHJcblx0XHR9LFxyXG5cdFx0c2V0X2NsYXNzOiBmdW5jdGlvbiBCZWhhdmlvciRzZXRfY2xhc3ModmFsdWUpIHtcclxuXHRcdFx0bG9nV2FybmluZyhcIlRoZSBiZWhhdmlvcjpjbGFzcyBwcm9wZXJ0eSBpcyBkZXByZWNhdGVkIChzZWUgaXNzdWUgIzEpLiBDb25zaWRlciB1c2luZyBiZWhhdmlvcjp0eXBlbmFtZSBpbnN0ZWFkLlwiKTtcclxuXHJcblx0XHRcdHRoaXMuX3R5cGVOYW1lID0gdmFsdWU7XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldF9kb250Rm9yY2VMb2FkOiBmdW5jdGlvbiBCZWhhdmlvciRnZXRfZG9udEZvcmNlTG9hZCgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2RvbnRGb3JjZUxvYWQ7XHJcblx0XHR9LFxyXG5cdFx0c2V0X2RvbnRGb3JjZUxvYWQ6IGZ1bmN0aW9uIEJlaGF2aW9yJHNldF9kb250Rm9yY2VMb2FkKHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX2RvbnRGb3JjZUxvYWQgPSB2YWx1ZTtcclxuXHRcdH0sXHJcblx0XHRnZXRfY3RvckZ1bmN0aW9uOiBmdW5jdGlvbiBCZWhhdmlvciRnZXRfY3RvckZ1bmN0aW9uKCkge1xyXG5cdFx0XHRpZiAoIXRoaXMuX2N0b3JGdW5jdGlvbikge1xyXG5cdFx0XHRcdHRoaXMuX2N0b3JGdW5jdGlvbiA9IEV4b1dlYi5nZXRDdG9yKHRoaXMuX3R5cGVOYW1lKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX2N0b3JGdW5jdGlvbjtcclxuXHRcdH0sXHJcblx0XHRnZXRfcHJvcGVydGllczogZnVuY3Rpb24gQmVoYXZpb3IkZ2V0X3Byb3BlcnRpZXMoKSB7XHJcblx0XHRcdGlmICghdGhpcy5fcHJvcGVydGllcykge1xyXG5cdFx0XHRcdHRoaXMuX3Byb3BlcnRpZXMgPSB7fTtcclxuXHRcdFx0XHRmb3IgKHZhciBwcm9wIGluIHRoaXMpIHtcclxuXHRcdFx0XHRcdGlmIChwcm9wLnN0YXJ0c1dpdGgoXCJwcm9wX1wiKSAmJiAhcHJvcC5zdGFydHNXaXRoKFwicHJvcF9hZGRfXCIpKSB7XHJcblx0XHRcdFx0XHRcdHZhciBjdG9yID0gdGhpcy5nZXRfY3RvckZ1bmN0aW9uKCk7XHJcblx0XHRcdFx0XHRcdGlmICghY3Rvcikge1xyXG5cdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcigkZm9ybWF0KFwiQ291bGQgbm90IGV2YXVsYXRlIHR5cGUgJ3swfScuXCIsIHRoaXMuX3R5cGVOYW1lKSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdHZhciBuYW1lID0gU3lzLkFwcGxpY2F0aW9uLl9tYXBUb1Byb3RvdHlwZShwcm9wLnN1YnN0cmluZyg1KSwgY3Rvcik7XHJcblxyXG5cdFx0XHRcdFx0XHRpZiAoIW5hbWUpIHtcclxuXHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJGZvcm1hdChcIlByb3BlcnR5ICd7MH0nIGNvdWxkIG5vdCBiZSBmb3VuZCBvbiB0eXBlICd7MX0nLlwiLCBwcm9wLnN1YnN0cmluZyg1KSwgdGhpcy5fdHlwZU5hbWUpKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0dGhpcy5fcHJvcGVydGllc1tuYW1lXSA9IHRoaXNbcHJvcF07XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fcHJvcGVydGllcztcclxuXHRcdH0sXHJcblx0XHRnZXRfZXZlbnRzOiBmdW5jdGlvbiBCZWhhdmlvciRnZXRfZXZlbnRzKCkge1xyXG5cdFx0XHRpZiAoIXRoaXMuX2V2ZW50cykge1xyXG5cdFx0XHRcdHRoaXMuX2V2ZW50cyA9IHt9O1xyXG5cdFx0XHRcdGZvciAodmFyIHByb3AgaW4gdGhpcykge1xyXG5cdFx0XHRcdFx0aWYgKHByb3Auc3RhcnRzV2l0aChcInByb3BfYWRkX1wiKSkge1xyXG5cdFx0XHRcdFx0XHR2YXIgY3RvciA9IHRoaXMuZ2V0X2N0b3JGdW5jdGlvbigpO1xyXG5cdFx0XHRcdFx0XHRpZiAoIWN0b3IpIHtcclxuXHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJGZvcm1hdChcIkNvdWxkIG5vdCBldmF1bGF0ZSB0eXBlICd7MH0nLlwiLCB0aGlzLl90eXBlTmFtZSkpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHR2YXIgbmFtZSA9IFN5cy5BcHBsaWNhdGlvbi5fbWFwVG9Qcm90b3R5cGUocHJvcC5zdWJzdHJpbmcoOSksIGN0b3IpO1xyXG5cclxuXHRcdFx0XHRcdFx0aWYgKCFuYW1lKSB7XHJcblx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCRmb3JtYXQoXCJFdmVudCAnezB9JyBjb3VsZCBub3QgYmUgZm91bmQgb24gdHlwZSAnezF9Jy5cIiwgcHJvcC5zdWJzdHJpbmcoOSksIHRoaXMuX3R5cGVOYW1lKSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdHRoaXMuX2V2ZW50c1tuYW1lXSA9IHRoaXNbcHJvcF07XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fZXZlbnRzO1xyXG5cdFx0fSxcclxuXHRcdF9jcmVhdGU6IGZ1bmN0aW9uIEJlaGF2aW9yJGNyZWF0ZSgpIHtcclxuXHRcdFx0Ly8gaWYgdGhlIGVsZW1lbnQgaXMgbm90IHdpdGhpbiB0aGUgZG9jdW1lbnQgYm9keSBpdCBcclxuXHRcdFx0Ly8gcHJvYmFibHkgbWVhbnMgdGhhdCBpdCBpcyBiZWluZyByZW1vdmVkIC0gVE9ETzogdmVyaWZ5XHJcblx0XHRcdGlmICghalF1ZXJ5LmNvbnRhaW5zKGRvY3VtZW50LmJvZHksIHRoaXMuX2VsZW1lbnQpKSB7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0aGlzLl9iZWhhdmlvciA9ICRjcmVhdGUodGhpcy5nZXRfY3RvckZ1bmN0aW9uKCksIHRoaXMuZ2V0X3Byb3BlcnRpZXMoKSwgdGhpcy5nZXRfZXZlbnRzKCksIG51bGwsIHRoaXMuX2VsZW1lbnQpO1xyXG5cdFx0fSxcclxuXHRcdGluaXRpYWxpemU6IGZ1bmN0aW9uIEJlaGF2aW9yJGluaXRpYWxpemUoKSB7XHJcblx0XHRcdEJlaGF2aW9yLmNhbGxCYXNlTWV0aG9kKHRoaXMsIFwiaW5pdGlhbGl6ZVwiKTtcclxuXHJcblx0XHRcdGlmICghdGhpcy5fZG9udEZvcmNlTG9hZCkge1xyXG5cdFx0XHRcdFN5cy5yZXF1aXJlKFt0aGlzLmdldF9zY3JpcHRPYmplY3QoKV0sIHRoaXMuX2NyZWF0ZS5iaW5kKHRoaXMpKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aGlzLl9jcmVhdGUoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdEV4b1dlYi5VSS5CZWhhdmlvciA9IEJlaGF2aW9yO1xyXG5cdEJlaGF2aW9yLnJlZ2lzdGVyQ2xhc3MoXCJFeG9XZWIuVUkuQmVoYXZpb3JcIiwgU3lzLlVJLkNvbnRyb2wpO1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLlVJLlV0aWxpdGllc1xyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIGdldFRlbXBsYXRlU3ViQ29udGFpbmVyKGNoaWxkRWxlbWVudCkge1xyXG5cdFx0dmFyIGVsZW1lbnQgPSBjaGlsZEVsZW1lbnQ7XHJcblxyXG5cdFx0ZnVuY3Rpb24gaXNEYXRhVmlld09yQ29udGVudChlbCkge1xyXG5cdFx0XHRyZXR1cm4gKGVsLmNvbnRyb2wgJiYgZWwuY29udHJvbCBpbnN0YW5jZW9mIFN5cy5VSS5EYXRhVmlldykgfHxcclxuXHRcdFx0XHQoZWwuY29udHJvbCAmJiBlbC5jb250cm9sIGluc3RhbmNlb2YgRXhvV2ViLlVJLkNvbnRlbnQpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGZpbmQgdGhlIGZpcnN0IHBhcmVudCB0aGF0IGhhcyBhbiBhdHRhY2hlZCBBU1AuTkVUIEFqYXggZGF0YXZpZXcgb3IgRXhvV2ViIGNvbnRlbnQgY29udHJvbCAoaWdub3JlIHRvZ2dsZSlcclxuXHRcdHdoaWxlIChlbGVtZW50LnBhcmVudE5vZGUgJiYgIWlzRGF0YVZpZXdPckNvbnRlbnQoZWxlbWVudC5wYXJlbnROb2RlKSkge1xyXG5cdFx0XHRlbGVtZW50ID0gZWxlbWVudC5wYXJlbnROb2RlO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGNvbnRhaW5pbmcgdGVtcGxhdGUgd2FzIG5vdCBmb3VuZFxyXG5cdFx0aWYgKGVsZW1lbnQucGFyZW50Tm9kZSAmJiBpc0RhdGFWaWV3T3JDb250ZW50KGVsZW1lbnQucGFyZW50Tm9kZSkpIHtcclxuXHRcdFx0cmV0dXJuIGVsZW1lbnQ7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBnZXREYXRhRm9yQ29udGFpbmVyKGNvbnRhaW5lciwgc3ViY29udGFpbmVyLCBpbmRleCkge1xyXG5cdFx0dmFyIGRhdGEgPSBudWxsO1xyXG5cclxuXHRcdGlmIChjb250YWluZXIpIHtcclxuXHRcdFx0aWYgKGNvbnRhaW5lci5jb250cm9sIGluc3RhbmNlb2YgU3lzLlVJLkRhdGFWaWV3IHx8IGNvbnRhaW5lci5jb250cm9sIGluc3RhbmNlb2YgRXhvV2ViLlVJLkNvbnRlbnQpIHtcclxuXHRcdFx0XHR2YXIgY29udGFpbmVyQ29udGV4dHMgPSBjb250YWluZXIuY29udHJvbC5nZXRfY29udGV4dHMoKTtcclxuXHRcdFx0XHR2YXIgY29udGFpbmVyRGF0YSA9IGNvbnRhaW5lci5jb250cm9sLmdldF9kYXRhKCk7XHJcblxyXG5cdFx0XHRcdC8vIGVuc3VyZSBhbiBhcnJheSBmb3IgY29uZm9ybWl0eVxyXG5cdFx0XHRcdGlmICghKGNvbnRhaW5lckRhdGEgaW5zdGFuY2VvZiBBcnJheSkpIHtcclxuXHRcdFx0XHRcdGNvbnRhaW5lckRhdGEgPSBbY29udGFpbmVyRGF0YV07XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRpZiAoY29udGFpbmVyQ29udGV4dHMpIHtcclxuXHRcdFx0XHRcdC8vIGlmIHRoZXJlIGlzIG9ubHkgb25lIGNvbnRleHQgaW4gdGhlIGFycmF5IHRoZW4gdGhlIGluZGV4IG11c3QgYmUgemVyb1xyXG5cdFx0XHRcdFx0aWYgKGNvbnRhaW5lckNvbnRleHRzLmxlbmd0aCA9PSAxKSB7XHJcblx0XHRcdFx0XHRcdGluZGV4ID0gMDtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRpZiAoaW5kZXggIT09IHVuZGVmaW5lZCAmJiBpbmRleCAhPT0gbnVsbCAmJiBpbmRleC5jb25zdHJ1Y3RvciA9PT0gTnVtYmVyKSB7XHJcblx0XHRcdFx0XHRcdGlmIChpbmRleCA8IGNvbnRhaW5lckNvbnRleHRzLmxlbmd0aCkge1xyXG5cdFx0XHRcdFx0XHRcdHZhciBpbmRleGVkQ29udGV4dCA9IGNvbnRhaW5lckNvbnRleHRzW2luZGV4XTtcclxuXHRcdFx0XHRcdFx0XHR2YXIgaW5kZXhlZERhdGEgPSBjb250YWluZXJEYXRhW2luZGV4XTtcclxuXHRcdFx0XHRcdFx0XHRkYXRhID0gKGluZGV4ZWRDb250ZXh0KSA/IGluZGV4ZWRDb250ZXh0LmRhdGFJdGVtIDogaW5kZXhlZERhdGE7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHQvLyB0cnkgdG8gZmluZCB0aGUgcmlnaHQgY29udGV4dCBiYXNlZCBvbiB0aGUgZWxlbWVudCdzIHBvc2l0aW9uIGluIHRoZSBkb21cclxuXHRcdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDAsIGwgPSBjb250YWluZXJDb250ZXh0cy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgY2hpbGRDb250ZXh0ID0gY29udGFpbmVyQ29udGV4dHNbaV07XHJcblx0XHRcdFx0XHRcdFx0aWYgKCFjaGlsZENvbnRleHQpIHtcclxuXHRcdFx0XHRcdFx0XHRcdHZhciBjb250ZXh0c0Zyb21Eb20gPSBtYXAoY29udGFpbmVyLmNoaWxkcmVuLCBmdW5jdGlvbihlKSB7IHJldHVybiBTeXMuVUkuVGVtcGxhdGUuZmluZENvbnRleHQoZS5maXJzdENoaWxkKTsgfSkuZGlzdGluY3QoKTtcclxuXHRcdFx0XHRcdFx0XHRcdHZhciBtYXRjaGluZ0NvbnRleHQgPSBjb250ZXh0c0Zyb21Eb20uc2luZ2xlKGZ1bmN0aW9uKHRjKSB7IHJldHVybiBTeXMuX2luZGV4T2YodGMubm9kZXMsIHN1YmNvbnRhaW5lcikgPj0gMDsgfSk7XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAobWF0Y2hpbmdDb250ZXh0KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGRhdGEgPSBtYXRjaGluZ0NvbnRleHQuZGF0YUl0ZW07XHJcblx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRlbHNlIGlmIChjaGlsZENvbnRleHQuY29udGFpbmVyRWxlbWVudCA9PT0gY29udGFpbmVyICYmIFN5cy5faW5kZXhPZihjaGlsZENvbnRleHQubm9kZXMsIHN1YmNvbnRhaW5lcikgPiAtMSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0ZGF0YSA9IGNoaWxkQ29udGV4dC5kYXRhSXRlbTtcclxuXHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gZGF0YTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGdldFBhcmVudENvbnRleHQob3B0aW9ucy8qeyB0YXJnZXQsIHN1YmNvbnRhaW5lciwgaW5kZXgsIGxldmVsLCBkYXRhVHlwZSwgaWZGbiB9Ki8pIHtcclxuXHRcdC8vLyA8c3VtbWFyeT5cclxuXHRcdC8vLyBcdEZpbmRzIHRoZSB0ZW1wbGF0ZSBjb250ZXh0IGRhdGEgYmFzZWQgb24gdGhlIGdpdmVuIG9wdGlvbnMuXHJcblx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwib3B0aW9uc1wiIHR5cGU9XCJPYmplY3RcIj5cclxuXHRcdC8vLyBcdFRoZSBvYmplY3Qgd2hpY2ggY29udGFpbnMgdGhlIG9wdGlvbnMgdG8gdXNlLlxyXG5cdFx0Ly8vIFx0dGFyZ2V0OiAgVGhlIHRhcmdldCBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZy4gIFRoaXMgY2FuIGJlIGFuIEhUTUxcclxuXHRcdC8vLyBcdFx0XHRcdFx0ZWxlbWVudCwgYSBjb250cm9sLCBvciBhIHRlbXBsYXRlIGNvbnRleHQuXHJcblx0XHQvLy8gXHRcdGluZGV4IChvcHRpb25hbCk6ICBUaGUgaW5kZXggb2YgdGhlIGRlc2lyZWQgY29udGV4dC4gIElmIHRoZSBkZXNpcmVkIGNvbnRleHRcclxuXHRcdC8vLyBcdFx0XHRcdFx0aXMgb25lIGxldmVsIHVwIGFuZCBpcyBwYXJ0IG9mIGEgbGlzdCwgdGhpcyBhcmd1bWVudCBjYW4gYmUgdXNlZFxyXG5cdFx0Ly8vIFx0XHRcdFx0XHR0byBzcGVjaWZ5IHdoaWNoIHRlbXBsYXRlIGNvbnRleHQgdG8gcmV0dXJuLlxyXG5cdFx0Ly8vIFx0XHRsZXZlbCAob3B0aW9uYWwpOiAgVGhlIG51bWJlciBvZiBsZXZlbHMgdG8gdHJhdmVsLiAgQnkgZGVmYXVsdCB0aGlzIGlzIFwiMVwiLFxyXG5cdFx0Ly8vIFx0XHRcdFx0XHR3aGljaCBtZWFucyB0aGF0IHRoZSBpbW1lZGlhdGUgcGFyZW50IGNvbnRleHQgZGF0YSB3aWxsIGJlIHJldHVybmVkLlxyXG5cdFx0Ly8vIFx0XHRkYXRhVHlwZSAob3B0aW9uYWwpOiAgSWYgc3BlY2lmaWVkLCB0aGlzIHR5cGUgaXMgdXNlZCBhcyB0aGUgdHlwZSBvZiBkYXRhIHRvIHNlYXJjaFxyXG5cdFx0Ly8vIFx0XHRcdFx0XHRmb3IuICBXaGVuIGNvbnRleHQgZGF0YSBvZiB0aGlzIHR5cGUgaXMgZW5jb3VudGVyZWQgaXQgaXMgcmV0dXJuZWQuXHJcblx0XHQvLy8gXHRcdFx0XHRcdE5vdGUgdGhhdCBhcnJheXMgYXJlIG5vdCBzdXBwb3J0ZWQuICBJZiB0aGUgZGF0YSBpcyBhbiBhcnJheSBhbmQgdGhlXHJcblx0XHQvLy8gXHRcdFx0XHRcdHR5cGUgb2YgaXRlbXMgbXVzdCBiZSBjaGVja2VkLCB1c2UgdGhlIFwiaWZGblwiIGFyZ3VtZW50LlxyXG5cdFx0Ly8vIFx0XHRpZkZuIChvcHRpb25hbCk6ICBBIGZ1bmN0aW9uIHRoYXQgZGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBjb3JyZWN0IGRhdGEgaGFzIGJlZW5cclxuXHRcdC8vLyBcdFx0XHRcdFx0Zm91bmQuICBUaGUgY29udGV4dCBkYXRhIGlzIHJldHVybmVkIGFzIHNvb24gYXMgdGhlIHJlc3VsdCBvZiBjYWxsaW5nIFxyXG5cdFx0Ly8vIFx0XHRcdFx0XHR0aGlzIGZ1bmN0aW9uIHdpdGggdGhlIGN1cnJlbnQgZGF0YSBhbmQgY29udGFpbmVyIGlzIHRydWUuXHJcblx0XHQvLy8gPC9wYXJhbT5cclxuXHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiT2JqZWN0XCIgLz5cclxuXHJcblx0XHR2YXIgdGFyZ2V0ID0gb3B0aW9ucy50YXJnZXQsIGVmZmVjdGl2ZUxldmVsID0gb3B0aW9ucy5sZXZlbCB8fCAxLCBjb250YWluZXIsIHN1YmNvbnRhaW5lciA9IG9wdGlvbnMuc3ViY29udGFpbmVyLCBpID0gMCwgc2VhcmNoaW5nID0gdHJ1ZSwgY29udGV4dCwgZGF0YTtcclxuXHJcblx0XHRpZiAodGFyZ2V0LmNvbnRyb2wgJiYgKHRhcmdldC5jb250cm9sIGluc3RhbmNlb2YgU3lzLlVJLkRhdGFWaWV3IHx8IHRhcmdldC5jb250cm9sIGluc3RhbmNlb2YgRXhvV2ViLlVJLkNvbnRlbnQpKSB7XHJcblx0XHRcdHRhcmdldCA9IHRhcmdldC5jb250cm9sO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAodGFyZ2V0IGluc3RhbmNlb2YgU3lzLlVJLlRlbXBsYXRlKSB7XHJcblx0XHRcdHRhcmdldCA9IHRhcmdldC5nZXRfZWxlbWVudCgpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAodGFyZ2V0IGluc3RhbmNlb2YgU3lzLlVJLlRlbXBsYXRlQ29udGV4dCkge1xyXG5cdFx0XHR0YXJnZXQgPSB0YXJnZXQuY29udGFpbmVyRWxlbWVudDtcclxuXHRcdH1cclxuXHJcblx0XHR3aGlsZSAoc2VhcmNoaW5nID09PSB0cnVlKSB7XHJcblx0XHRcdC8vIGlmIHdlIGFyZSBzdGFydGluZyBvdXQgd2l0aCBhIGRhdGF2aWV3IHRoZW4gbG9vayBhdCB0aGUgcGFyZW50IGNvbnRleHQgcmF0aGVyIHRoYW4gd2Fsa2luZyBcclxuXHRcdFx0Ly8gdXAgdGhlIGRvbSAoc2luY2UgdGhlIGVsZW1lbnQgd2lsbCBwcm9iYWJseSBub3QgYmUgcHJlc2VudCBpbiB0aGUgZG9tKVxyXG5cdFx0XHRpZiAoIWNvbnRhaW5lciAmJiAodGFyZ2V0IGluc3RhbmNlb2YgU3lzLlVJLkRhdGFWaWV3IHx8IHRhcmdldCBpbnN0YW5jZW9mIEV4b1dlYi5VSS5Db250ZW50KSkge1xyXG5cdFx0XHRcdGNvbnRleHQgPSB0YXJnZXQuZ2V0X3RlbXBsYXRlQ29udGV4dCgpO1xyXG5cclxuXHRcdFx0XHQvLyBJZiB0aGUgY29udHJvbCdzIGNvbnRleHQgaXMgdGhlIGdsb2JhbCBjb250ZXh0LCB0aGVuIGV4aXQgaGVyZSB3aXRoIGEgY3VzdG9tIHJlc3VsdFxyXG5cdFx0XHRcdGlmIChjb250ZXh0Ll9nbG9iYWwgPT09IHRydWUpIHtcclxuXHRcdFx0XHRcdHJldHVybiB7IGRhdGE6IG51bGwsIGdsb2JhbDogdHJ1ZSwgY29udGFpbmVyOiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIHN1YmNvbnRhaW5lcjogdGFyZ2V0LmdldF9lbGVtZW50KCkgfTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGNvbnRhaW5lciA9IGNvbnRleHQuY29udGFpbmVyRWxlbWVudDtcclxuXHJcblx0XHRcdFx0aWYgKGNvbnRhaW5lci5jb250cm9sIGluc3RhbmNlb2YgVG9nZ2xlKVxyXG5cdFx0XHRcdFx0Y29udGFpbmVyID0gU3lzLlVJLlRlbXBsYXRlLmZpbmRDb250ZXh0KGNvbnRhaW5lcikuY29udGFpbmVyRWxlbWVudDtcclxuXHRcdFx0XHJcblx0XHRcdFx0aWYgKG9wdGlvbnMudGFyZ2V0ICYmIG9wdGlvbnMudGFyZ2V0LnRhZ05hbWUpIHtcclxuXHRcdFx0XHRcdHN1YmNvbnRhaW5lciA9IGdldFRlbXBsYXRlU3ViQ29udGFpbmVyKG9wdGlvbnMudGFyZ2V0KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dmFyIG9iaiA9IGNvbnRhaW5lciB8fCB0YXJnZXQ7XHJcblx0XHRcdFx0c3ViY29udGFpbmVyID0gZ2V0VGVtcGxhdGVTdWJDb250YWluZXIob2JqKTtcclxuXHJcblx0XHRcdFx0aWYgKCFzdWJjb250YWluZXIpIHtcclxuXHRcdFx0XHRcdC8vIEJhY2sgdXAgYW5kIGF0dGVtcHQgdG8gZ28gdGhyb3VnaCB0aGUgY29udHJvbC5cclxuXHRcdFx0XHRcdGlmIChvYmouY29udHJvbCAmJiAob2JqLmNvbnRyb2wgaW5zdGFuY2VvZiBTeXMuVUkuRGF0YVZpZXcgfHwgY29udGFpbmVyLmNvbnRyb2wgaW5zdGFuY2VvZiBFeG9XZWIuVUkuQ29udGVudCkpIHtcclxuXHRcdFx0XHRcdFx0Y29udGFpbmVyID0gbnVsbDtcclxuXHRcdFx0XHRcdFx0dGFyZ2V0ID0gb2JqLmNvbnRyb2w7XHJcblx0XHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oXCJOb3Qgd2l0aGluIGEgY29udGFpbmVyIHRlbXBsYXRlLlwiKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGNvbnRhaW5lciA9IHN1YmNvbnRhaW5lci5wYXJlbnROb2RlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBJbmNyZW1lbnQgdGhlIGNvdW50ZXIgdG8gY2hlY2sgYWdhaW5zdCB0aGUgbGV2ZWwgcGFyYW1ldGVyLlxyXG5cdFx0XHRpKys7XHJcblxyXG5cdFx0XHQvLyBHZXQgdGhlIGNvbnRleHQgZGF0YSBmb3IgdGhlIGN1cnJlbnQgbGV2ZWwuXHJcblx0XHRcdGRhdGEgPSBnZXREYXRhRm9yQ29udGFpbmVyKGNvbnRhaW5lciwgc3ViY29udGFpbmVyLCBvcHRpb25zLmluZGV4KTtcclxuXHJcblx0XHRcdGlmIChvcHRpb25zLmRhdGFUeXBlKSB7XHJcblx0XHRcdFx0Ly8gVmVyaWZ5IHRoYXQgdGhlIGN1cnJlbnQgZGF0YSBpcyBub3QgdGhlIGRhdGEgdHlwZSB0aGF0IHdlIGFyZSBsb29raW5nIGZvci5cclxuXHRcdFx0XHRzZWFyY2hpbmcgPSAhZGF0YSB8fCAhKGRhdGEgaW5zdGFuY2VvZiBvcHRpb25zLmRhdGFUeXBlIHx8IGRhdGEuY29uc3RydWN0b3IgPT09IG9wdGlvbnMuZGF0YVR5cGUpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKG9wdGlvbnMuaWZGbikge1xyXG5cdFx0XHRcdC8vIFZlcmlmeSB0aGF0IHRoZSBzdG9wIGZ1bmN0aW9uIGNvbmRpdGlvbnMgYXJlIG5vdCBtZXQuXHJcblx0XHRcdFx0c2VhcmNoaW5nID0gIShvcHRpb25zLmlmRm4uY2FsbCh0aGlzLCBkYXRhLCBjb250YWluZXIpKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHQvLyBGaW5hbGx5LCBjaGVjayB0aGUgbGV2ZWwuICBJZiBubyBsZXZlbCB3YXMgc3BlY2lmaWVkIHRoZW4gd2Ugd2lsbCBvbmx5IGdvIHVwIG9uZSBsZXZlbC5cclxuXHRcdFx0XHRzZWFyY2hpbmcgPSBpIDwgZWZmZWN0aXZlTGV2ZWw7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4geyBkYXRhOiBkYXRhLCBjb250YWluZXI6IGNvbnRhaW5lciwgc3ViY29udGFpbmVyOiBzdWJjb250YWluZXIgfTtcclxuXHR9XHJcblxyXG5cdEV4b1dlYi5VSS5nZXRQYXJlbnRDb250ZXh0ID0gZ2V0UGFyZW50Q29udGV4dDtcclxuXHJcblx0RXhvV2ViLlVJLmdldFBhcmVudENvbnRleHREYXRhID0gZnVuY3Rpb24oKSB7XHJcblx0XHRyZXR1cm4gZ2V0UGFyZW50Q29udGV4dC5hcHBseSh0aGlzLCBhcmd1bWVudHMpLmRhdGE7XHJcblx0fTtcclxuXHJcblx0d2luZG93LiRwYXJlbnRDb250ZXh0RGF0YSA9IGZ1bmN0aW9uICRwYXJlbnRDb250ZXh0RGF0YSh0YXJnZXQsIGluZGV4LCBsZXZlbCwgZGF0YVR5cGUsIGlmRm4pIHtcclxuXHRcdC8vLyA8c3VtbWFyeT5cclxuXHRcdC8vLyBcdEZpbmRzIHRoZSB0ZW1wbGF0ZSBjb250ZXh0IGRhdGEgYmFzZWQgb24gdGhlIGdpdmVuIG9wdGlvbnMuXHJcblx0XHQvLy8gPC9zdW1tYXJ5PlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwidGFyZ2V0XCIgdHlwZT1cIk9iamVjdFwiPlxyXG5cdFx0Ly8vIFx0VGhlIHRhcmdldCBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZy4gIFRoaXMgY2FuIGJlIGFuIEhUTUwgZWxlbWVudCwgYSBcclxuXHRcdC8vLyBcdGNvbnRyb2wsIG9yIGEgdGVtcGxhdGUgY29udGV4dC5cclxuXHRcdC8vLyA8L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiaW5kZXhcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIiBvcHRpb25hbD1cInRydWVcIj5cclxuXHRcdC8vLyBcdFRoZSBpbmRleCBvZiB0aGUgZGVzaXJlZCBjb250ZXh0LiAgSWYgdGhlIGRlc2lyZWQgY29udGV4dCBpcyBvbmUgbGV2ZWxcclxuXHRcdC8vLyBcdHVwIGFuZCBpcyBwYXJ0IG9mIGEgbGlzdCwgdGhpcyBhcmd1bWVudCBjYW4gYmUgdXNlZCB0byBzcGVjaWZ5IHdoaWNoXHJcblx0XHQvLy8gXHR0ZW1wbGF0ZSBjb250ZXh0IHRvIHJldHVybi5cclxuXHRcdC8vLyA8L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwibGV2ZWxcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIiBvcHRpb25hbD1cInRydWVcIj5cclxuXHRcdC8vLyBcdFRoZSBudW1iZXIgb2YgbGV2ZWxzIHRvIHRyYXZlbC4gIEJ5IGRlZmF1bHQgdGhpcyBpcyBcIjFcIiwgd2hpY2ggbWVhbnMgdGhhdFxyXG5cdFx0Ly8vIFx0dGhlIGltbWVkaWF0ZSBwYXJlbnQgY29udGV4dCBkYXRhIHdpbGwgYmUgcmV0dXJuZWQuXHJcblx0XHQvLy8gPC9wYXJhbT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImRhdGFUeXBlXCIgdHlwZT1cIkZ1bmN0aW9uXCIgb3B0aW9uYWw9XCJ0cnVlXCI+XHJcblx0XHQvLy8gXHRJZiBzcGVjaWZpZWQsIHRoaXMgdHlwZSBpcyB1c2VkIGFzIHRoZSB0eXBlIG9mIGRhdGEgdG8gc2VhcmNoIGZvci4gIFdoZW4gY29udGV4dFxyXG5cdFx0Ly8vIFx0ZGF0YSBvZiB0aGlzIHR5cGUgaXMgZW5jb3VudGVyZWQgaXQgaXMgcmV0dXJuZWQuICBOb3RlIHRoYXQgYXJyYXlzIGFyZSBub3Qgc3VwcG9ydGVkLlxyXG5cdFx0Ly8vIFx0SWYgdGhlIGRhdGEgaXMgYW4gYXJyYXkgYW5kIHRoZSB0eXBlIG9mIGl0ZW1zIG11c3QgYmUgY2hlY2tlZCwgdXNlIHRoZSBcImlmRm5cIiBhcmd1bWVudC5cclxuXHRcdC8vLyA8L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiaWZGblwiIHR5cGU9XCJGdW5jdGlvblwiIG9wdGlvbmFsPVwidHJ1ZVwiPlxyXG5cdFx0Ly8vIFx0QSBmdW5jdGlvbiB0aGF0IGRldGVybWluZXMgd2hldGhlciB0aGUgY29ycmVjdCBkYXRhIGhhcyBiZWVuIGZvdW5kLiAgVGhlIGNvbnRleHQgZGF0YVxyXG5cdFx0Ly8vIFx0aXMgcmV0dXJuZWQgYXMgc29vbiBhcyB0aGUgcmVzdWx0IG9mIGNhbGxpbmcgdGhpcyBmdW5jdGlvbiB3aXRoIHRoZSBjdXJyZW50IGRhdGEgYW5kIFxyXG5cdFx0Ly8vIFx0Y29udGFpbmVyIGlzIHRydWUuXHJcblx0XHQvLy8gPC9wYXJhbT5cclxuXHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiT2JqZWN0XCIgLz5cclxuXHJcblx0XHRyZXR1cm4gZ2V0UGFyZW50Q29udGV4dCh7XHJcblx0XHRcdFwidGFyZ2V0XCI6IHRhcmdldCxcclxuXHRcdFx0XCJpbmRleFwiOiBpbmRleCxcclxuXHRcdFx0XCJsZXZlbFwiOiBsZXZlbCxcclxuXHRcdFx0XCJkYXRhVHlwZVwiOiBkYXRhVHlwZSxcclxuXHRcdFx0XCJpZkZuXCI6IGlmRm5cclxuXHRcdH0pLmRhdGE7XHJcblx0fTtcclxuXHJcblx0ZnVuY3Rpb24gZ2V0SXNMYXN0KHRlbXBsYXRlLCBpbmRleCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5PlxyXG5cdFx0Ly8vIFx0UmV0dXJucyB3aGV0aGVyIHRoZSBkYXRhIGJlaW5nIHJlbmRlcmVkIGluIHRoZSBnaXZlbiB0ZW1wbGF0ZSBhdCB0aGUgZ2l2ZW4gaW5kZXggaXMgXHJcblx0XHQvLy8gXHR0aGUgbGFzdCBvYmplY3QgaW4gdGhlIGxpc3QuXHJcblx0XHQvLy9cclxuXHRcdC8vL1x0XHRFeGFtcGxlOlxyXG5cdFx0Ly8vXHJcblx0XHQvLy9cdFx0Jmx0OyBzcGFuIHN5czppZj1cInt7ICRpc0xhc3QodGhpcywgJGluZGV4KSB9fVwiICZndDtcclxuXHRcdC8vL1xyXG5cdFx0Ly8vIDwvc3VtbWFyeT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cInRlbXBsYXRlXCIgdHlwZT1cIlN5cy5VSS5UZW1wbGF0ZVwiPlRoZSB0ZW1wbGF0ZSB0aGF0IGlzIGJlaW5nIHJlbmRlcmVkLjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJpbmRleFwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiPlRoZSBpbmRleCBvZiB0aGUgY3VycmVudCBkYXRhIGl0ZW0uPC9wYXJhbT5cclxuXHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiQm9vbGVhblwiIC8+XHJcblxyXG5cdFx0dmFyIGxlbiA9IHRlbXBsYXRlLmdldF9lbGVtZW50KCkuY29udHJvbC5nZXRfY29udGV4dHMoKS5sZW5ndGg7XHJcblx0XHRyZXR1cm4gaW5kZXggPT0gbGVuIC0gMTtcclxuXHR9XHJcblxyXG5cdHdpbmRvdy4kaXNMYXN0ID0gZ2V0SXNMYXN0O1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLlZpZXcuQWRhcHRlck1hcmt1cEV4dGVuc2lvblxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdFN5cy5fQXBwbGljYXRpb24ubWl4aW4oRnVuY3Rvci5ldmVudGluZyk7XHJcblxyXG5cdFN5cy5fQXBwbGljYXRpb24ucHJvdG90eXBlLmFkZEJlZm9yZUNyZWF0ZUFkYXB0ZXIgPSBmdW5jdGlvbiBBcHBsaWNhdGlvbiRhZGRCZWZvcmVDcmVhdGVBZGFwdGVyKGhhbmRsZXIpIHtcclxuXHQgICAgdGhpcy5fYWRkRXZlbnQoXCJiZWZvcmVDcmVhdGVBZGFwdGVyXCIsIGhhbmRsZXIpO1xyXG5cdH07XHJcblxyXG5cdFN5cy5fQXBwbGljYXRpb24ucHJvdG90eXBlLnJlbW92ZUJlZm9yZUNyZWF0ZUFkYXB0ZXIgPSBmdW5jdGlvbiBBcHBsaWNhdGlvbiRyZW1vdmVCZWZvcmVDcmVhdGVBZGFwdGVyKGhhbmRsZXIpIHtcclxuXHQgICAgdGhpcy5fcmVtb3ZlRXZlbnQoXCJiZWZvcmVDcmVhdGVBZGFwdGVyXCIsIGhhbmRsZXIpO1xyXG5cdH07XHJcblxyXG5cdFN5cy5BcHBsaWNhdGlvbi5yZWdpc3Rlck1hcmt1cEV4dGVuc2lvbihcclxuXHRcdFwiQFwiLFxyXG5cdFx0ZnVuY3Rpb24gQWRhcHRlck1hcmt1cEV4dGVudGlvbihjb21wb25lbnQsIHRhcmdldFByb3BlcnR5LCB0ZW1wbGF0ZUNvbnRleHQsIHByb3BlcnRpZXMpIHtcclxuXHRcdFx0aWYgKHByb3BlcnRpZXMucmVxdWlyZWQpIHtcclxuXHRcdFx0XHRsb2dXYXJuaW5nKFwiQWRhcHRlciBtYXJrdXAgZXh0ZW5zaW9uIGRvZXMgbm90IHN1cHBvcnQgdGhlIFxcXCJyZXF1aXJlZFxcXCIgcHJvcGVydHkuXCIpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR2YXIgcGF0aCA9IHByb3BlcnRpZXMucGF0aCB8fCBwcm9wZXJ0aWVzLiRkZWZhdWx0O1xyXG5cdFx0XHRkZWxldGUgcHJvcGVydGllcy4kZGVmYXVsdDtcclxuXHJcblx0XHRcdHZhciBzb3VyY2U7XHJcblx0XHRcdGlmIChwcm9wZXJ0aWVzLnNvdXJjZSkge1xyXG5cdFx0XHRcdHNvdXJjZSA9IHByb3BlcnRpZXMuc291cmNlO1xyXG5cdFx0XHRcdGRlbGV0ZSBwcm9wZXJ0aWVzLnNvdXJjZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRzb3VyY2UgPSB0ZW1wbGF0ZUNvbnRleHQuZGF0YUl0ZW07XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciBhZGFwdGVyO1xyXG5cdFx0XHRpZiAoIXBhdGgpIHtcclxuXHRcdFx0XHRpZiAoIShzb3VyY2UgaW5zdGFuY2VvZiBBZGFwdGVyKSkge1xyXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiTm8gcGF0aCB3YXMgc3BlY2lmaWVkIGZvciB0aGUgXFxcIkBcXFwiIG1hcmt1cCBleHRlbnNpb24sIGFuZCB0aGUgc291cmNlIGlzIG5vdCBhbiBhZGFwdGVyLlwiKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Zm9yICh2YXIgcHJvcCBpbiBwcm9wZXJ0aWVzKSB7XHJcblx0XHRcdFx0XHRpZiAocHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShwcm9wKSAmJiBwcm9wICE9PSBcImlzTGlua1BlbmRpbmdcIikge1xyXG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJBZGRpdGlvbmFsIGFkYXB0ZXIgcHJvcGVydGllcyBjYW5ub3QgYmUgc3BlY2lmaWVkIHdoZW4gZGVmZXJyaW5nIHRvIGFub3RoZXIgYWRhcHRlciAobm8gcGF0aCBzcGVjaWZpZWQpLiBGb3VuZCBwcm9wZXJ0eSBcXFwiXCIgKyBwcm9wICsgXCJcXFwiLlwiKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0YWRhcHRlciA9IHNvdXJjZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0ICAgIFN5cy5BcHBsaWNhdGlvbi5fcmFpc2VFdmVudChcImJlZm9yZUNyZWF0ZUFkYXB0ZXJcIiwgW1N5cy5BcHBsaWNhdGlvbiwgeyBzb3VyY2U6IHNvdXJjZSwgcGF0aDogcGF0aCwgcHJvcGVydGllczogcHJvcGVydGllcyB9XSk7XHJcblx0XHRcdFx0YWRhcHRlciA9IG5ldyBBZGFwdGVyKHNvdXJjZSwgcGF0aCwgcHJvcGVydGllcy5mb3JtYXQsIHByb3BlcnRpZXMpO1xyXG5cdFx0XHRcdHRlbXBsYXRlQ29udGV4dC5jb21wb25lbnRzLnB1c2goYWRhcHRlcik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGFkYXB0ZXIucmVhZHkoZnVuY3Rpb24gQWRhcHRlclJlYWR5KCkge1xyXG5cdFx0XHRcdE9ic2VydmVyLnNldFZhbHVlKGNvbXBvbmVudCwgdGFyZ2V0UHJvcGVydHksIGFkYXB0ZXIpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH0sXHJcblx0XHRmYWxzZVxyXG5cdCk7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuVmlldy5NZXRhTWFya3VwRXh0ZW5zaW9uXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0dmFyIGJpbmRpbmdTZXR0ZXJzID0gW107XHJcblx0dmFyIHNldHRlckV4cHIgPSAvXnNldF8oLiopJC87XHJcblx0RXhvV2ViLmVhY2hQcm9wKFN5cy5CaW5kaW5nLnByb3RvdHlwZSwgZnVuY3Rpb24ocHJvcCkge1xyXG5cdFx0dmFyIG5hbWUgPSBzZXR0ZXJFeHByLmV4ZWMocHJvcCk7XHJcblx0XHRpZiAobmFtZSkge1xyXG5cdFx0XHRiaW5kaW5nU2V0dGVycy5wdXNoKG5hbWVbMV0pO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHRTeXMuQXBwbGljYXRpb24ucmVnaXN0ZXJNYXJrdXBFeHRlbnNpb24oXHJcblx0XHRcIiNcIixcclxuXHRcdGZ1bmN0aW9uIE1ldGFNYXJrdXBFeHRlbnNpb24oY29tcG9uZW50LCB0YXJnZXRQcm9wZXJ0eSwgdGVtcGxhdGVDb250ZXh0LCBwcm9wZXJ0aWVzKSB7XHJcblx0XHRcdGlmIChwcm9wZXJ0aWVzLnJlcXVpcmVkKSB7XHJcblx0XHRcdFx0bG9nV2FybmluZyhcIk1ldGEgbWFya3VwIGV4dGVuc2lvbiBkb2VzIG5vdCBzdXBwb3J0IHRoZSBcXFwicmVxdWlyZWRcXFwiIHByb3BlcnR5LlwiKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIG9wdGlvbnMsIGVsZW1lbnQ7XHJcblxyXG5cdFx0XHRpZiAoU3lzLkNvbXBvbmVudC5pc0luc3RhbmNlT2ZUeXBlKGNvbXBvbmVudCkpIHtcclxuXHRcdFx0XHRlbGVtZW50ID0gY29tcG9uZW50LmdldF9lbGVtZW50KCk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoU3lzLlVJLkRvbUVsZW1lbnQuaXNEb21FbGVtZW50KGNvbXBvbmVudCkpIHtcclxuXHRcdFx0XHRlbGVtZW50ID0gY29tcG9uZW50O1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRvcHRpb25zID0gU3lzLl9tZXJnZSh7XHJcblx0XHRcdFx0c291cmNlOiB0ZW1wbGF0ZUNvbnRleHQuZGF0YUl0ZW0sXHJcblx0XHRcdFx0dGVtcGxhdGVDb250ZXh0OiB0ZW1wbGF0ZUNvbnRleHQsXHJcblx0XHRcdFx0dGFyZ2V0OiBjb21wb25lbnQsXHJcblx0XHRcdFx0dGFyZ2V0UHJvcGVydHk6IHRhcmdldFByb3BlcnR5LFxyXG5cdFx0XHRcdHByb3BlcnR5OiBlbGVtZW50Lm5vZGVOYW1lID09PSBcIlNFTEVDVFwiID8gXCJzeXN0ZW1WYWx1ZVwiIDogXCJkaXNwbGF5VmFsdWVcIlxyXG5cdFx0XHR9LCBwcm9wZXJ0aWVzKTtcclxuXHJcblx0XHRcdGRlbGV0ZSBwcm9wZXJ0aWVzLiRkZWZhdWx0O1xyXG5cclxuXHRcdFx0Ly8gcmVtb3ZlIHByb3BlcnRpZXMgdGhhdCBhcHBseSB0byB0aGUgYmluZGluZ1xyXG5cdFx0XHRmb3IgKHZhciBwIGluIHByb3BlcnRpZXMpIHtcclxuXHRcdFx0XHRpZiAocHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShwKSkge1xyXG5cdFx0XHRcdFx0aWYgKGJpbmRpbmdTZXR0ZXJzLmluZGV4T2YocCkgPj0gMCkge1xyXG5cdFx0XHRcdFx0XHRkZWxldGUgcHJvcGVydGllc1twXTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdG9wdGlvbnMucGF0aCA9IG9wdGlvbnMucGF0aCB8fCBvcHRpb25zLiRkZWZhdWx0O1xyXG5cdFx0XHRkZWxldGUgb3B0aW9ucy4kZGVmYXVsdDtcclxuXHJcblx0XHRcdHZhciBhZGFwdGVyID0gb3B0aW9ucy5zb3VyY2UgPSBuZXcgQWRhcHRlcihvcHRpb25zLnNvdXJjZSB8fCB0ZW1wbGF0ZUNvbnRleHQuZGF0YUl0ZW0sIG9wdGlvbnMucGF0aCwgb3B0aW9ucy5mb3JtYXQsIHByb3BlcnRpZXMpO1xyXG5cclxuXHRcdFx0b3B0aW9ucy5wYXRoID0gb3B0aW9ucy5wcm9wZXJ0eTtcclxuXHRcdFx0ZGVsZXRlIG9wdGlvbnMucHJvcGVydHk7XHJcblx0XHRcclxuXHRcdFx0dGVtcGxhdGVDb250ZXh0LmNvbXBvbmVudHMucHVzaChhZGFwdGVyKTtcclxuXHRcdFx0dGVtcGxhdGVDb250ZXh0LmNvbXBvbmVudHMucHVzaChTeXMuQmluZGluZy5iaW5kKG9wdGlvbnMpKTtcclxuXHRcdH0sXHJcblx0XHRmYWxzZVxyXG5cdCk7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuVmlldy5Db25kaXRpb25NYXJrdXBFeHRlbnNpb25cclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHRTeXMuQXBwbGljYXRpb24ucmVnaXN0ZXJNYXJrdXBFeHRlbnNpb24oXCI/XCIsXHJcblx0XHRmdW5jdGlvbiAoY29tcG9uZW50LCB0YXJnZXRQcm9wZXJ0eSwgdGVtcGxhdGVDb250ZXh0LCBwcm9wZXJ0aWVzKSB7XHJcblx0XHRcdHZhciBvcHRpb25zID0gU3lzLl9tZXJnZSh7XHJcblx0XHRcdFx0c291cmNlOiB0ZW1wbGF0ZUNvbnRleHQuZGF0YUl0ZW0sXHJcblx0XHRcdFx0dGVtcGxhdGVDb250ZXh0OiB0ZW1wbGF0ZUNvbnRleHQsXHJcblx0XHRcdFx0dGFyZ2V0UHJvcGVydHk6IHRhcmdldFByb3BlcnR5XHJcblx0XHRcdH0sIHByb3BlcnRpZXMpO1xyXG5cclxuXHRcdFx0dmFyIG1ldGEgPSBvcHRpb25zLnNvdXJjZS5tZXRhO1xyXG5cclxuXHRcdFx0b3B0aW9ucy50eXBlID0gb3B0aW9ucy50eXBlIHx8IG9wdGlvbnMuJGRlZmF1bHQ7XHJcblx0XHRcdGRlbGV0ZSBvcHRpb25zLiRkZWZhdWx0O1xyXG5cclxuXHRcdFx0b3B0aW9ucy5zaW5nbGUgPSBvcHRpb25zLnNpbmdsZSAmJiAob3B0aW9ucy5zaW5nbGUgPT09IHRydWUgfHwgb3B0aW9ucy5zaW5nbGUudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpID09PSBcInRydWVcIik7XHJcblxyXG5cdFx0XHR2YXIgdHlwZXMgPSBvcHRpb25zLnR5cGUgPyBvcHRpb25zLnR5cGUuc3BsaXQoXCIsXCIpIDogbnVsbDtcclxuXHJcblx0XHRcdHZhciBzZXRzID0gb3B0aW9ucy5zZXQgPyBvcHRpb25zLnNldC5zcGxpdChcIixcIikgOiBudWxsO1xyXG5cclxuXHRcdFx0dmFyIHRhcmdldCA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRpZiAob3B0aW9ucy50YXJnZXQgJiYgb3B0aW9ucy50YXJnZXQuY29uc3RydWN0b3IgPT09IFN0cmluZylcclxuXHRcdFx0XHRcdHJldHVybiBldmFsUGF0aChvcHRpb25zLnNvdXJjZSwgb3B0aW9ucy50YXJnZXQpO1xyXG5cdFx0XHRcdHJldHVybiBvcHRpb25zLnRhcmdldDtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdGZ1bmN0aW9uIHVwZGF0ZUNvbmRpdGlvbnMoKSB7XHJcblx0XHRcdFx0dmFyIGN1cnJlbnRUYXJnZXQgPSB0YXJnZXQoKTtcclxuXHRcdFx0XHR2YXIgY29uZGl0aW9ucyA9IG1ldGEuY29uZGl0aW9ucygpLmZpbHRlcihmdW5jdGlvbiAoYykge1xyXG5cdFx0XHRcdFx0cmV0dXJuICghdHlwZXMgfHwgdHlwZXMuaW5kZXhPZihjLnR5cGUuY29kZSkgPj0gMCkgJiYgLy8gY2hlY2sgZm9yIHR5cGUgY29kZSBtYXRjaCAoaWYgc3BlY2lmaWVkKVxyXG5cdFx0XHRcdFx0XHQoIXNldHMgfHwgaW50ZXJzZWN0KHNldHMsIGMudHlwZS5zZXRzLm1hcChmdW5jdGlvbiAocykgeyByZXR1cm4gcy5uYW1lOyB9KSkubGVuZ3RoID4gMCkgJiYgLy8gY2hlY2sgZm9yIHNldCBjb2RlIG1hdGNoIChpZiBzcGVjaWZpZWQpXHJcblx0XHRcdFx0XHRcdCghdGFyZ2V0IHx8IGMudGFyZ2V0cy5zb21lKGZ1bmN0aW9uICh0KSB7IHJldHVybiB0LnRhcmdldCA9PT0gY3VycmVudFRhcmdldDsgfSkpOyAvLyBjaGVjayBmb3IgdGFyZ2V0IChpZiBzcGVjaWZpZWQpXHJcblx0XHRcdFx0fSk7XHJcblxyXG5cdFx0XHRcdGlmIChvcHRpb25zLnNpbmdsZSA9PT0gdHJ1ZSkge1xyXG5cdFx0XHRcdFx0aWYgKGNvbmRpdGlvbnMubGVuZ3RoID4gMSkge1xyXG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJGZvcm1hdChcIk11bHRpcGxlIGNvbmRpdGlvbnMgd2VyZSBmb3VuZCBmb3IgdHlwZSBcXFwiezB9XFxcIi5cIiwgb3B0aW9ucy50eXBlKSk7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0Y29uZGl0aW9ucyA9IGNvbmRpdGlvbnMubGVuZ3RoID09PSAwID8gbnVsbCA6IGNvbmRpdGlvbnNbMF07XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRPYnNlcnZlci5zZXRWYWx1ZShjb21wb25lbnQsIHByb3BlcnRpZXMudGFyZ2V0UHJvcGVydHkgfHwgdGFyZ2V0UHJvcGVydHksIGNvbmRpdGlvbnMpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR1cGRhdGVDb25kaXRpb25zKCk7XHJcblx0XHRcdG1ldGEuYWRkQ29uZGl0aW9uc0NoYW5nZWQodXBkYXRlQ29uZGl0aW9ucywgbWV0YSk7XHJcblx0XHR9LFxyXG5cdFx0ZmFsc2UpO1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLlZpZXcuQmluZGluZ1xyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIEJpbmRpbmcodGVtcGxhdGVDb250ZXh0LCBzb3VyY2UsIHNvdXJjZVBhdGgsIHRhcmdldCwgdGFyZ2V0UGF0aCwgb3B0aW9ucywgc2NvcGVDaGFpbikge1xyXG5cdFx0QmluZGluZy5pbml0aWFsaXplQmFzZSh0aGlzKTtcclxuXHJcblx0XHR0aGlzLl90ZW1wbGF0ZUNvbnRleHQgPSB0ZW1wbGF0ZUNvbnRleHQ7XHJcblx0XHR0aGlzLl9zb3VyY2UgPSBzb3VyY2U7XHJcblx0XHR0aGlzLl9zb3VyY2VQYXRoID0gc291cmNlUGF0aDtcclxuXHRcdHRoaXMuX3RhcmdldCA9IHRhcmdldDtcclxuXHJcblx0XHR2YXIgcGF0aExvd2VyID0gdGFyZ2V0UGF0aCA/IHRhcmdldFBhdGgudG9Mb3dlckNhc2UoKSA6IHRhcmdldFBhdGg7XHJcblx0XHRpZiAocGF0aExvd2VyID09PSBcImlubmVydGV4dFwiKSB7XHJcblx0XHRcdHRoaXMuX3RhcmdldFBhdGggPSBcImlubmVyVGV4dFwiO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAocGF0aExvd2VyID09PSBcImlubmVyaHRtbFwiKSB7XHJcblx0XHRcdHRoaXMuX3RhcmdldFBhdGggPSBcImlubmVySFRNTFwiO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMuX3RhcmdldFBhdGggPSB0YXJnZXRQYXRoO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuX29wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xyXG5cclxuXHRcdHRoaXMuX2lzVGFyZ2V0RWxlbWVudCA9IFN5cy5VSS5Eb21FbGVtZW50LmlzRG9tRWxlbWVudCh0YXJnZXQpO1xyXG5cclxuXHRcdHRoaXMuX3VwZGF0ZUltbWVkaWF0ZWx5ID0gdHJ1ZTtcclxuXHJcblx0XHRpZiAodGhpcy5fc291cmNlUGF0aCkge1xyXG5cdFx0XHQvLyBTdGFydCB0aGUgaW5pdGlhbCBmZXRjaCBvZiB0aGUgc291cmNlIHZhbHVlLlxyXG5cdFx0XHR0aGlzLl9ldmFsU3VjY2Vzc0hhbmRsZXIgPSB0aGlzLl9ldmFsU3VjY2Vzcy5iaW5kKHRoaXMpO1xyXG5cdFx0XHR0aGlzLl9ldmFsRmFpbHVyZUhhbmRsZXIgPSB0aGlzLl9ldmFsRmFpbHVyZS5iaW5kKHRoaXMpO1xyXG5cdFx0XHRMYXp5TG9hZGVyLmV2YWwodGhpcy5fc291cmNlLCB0aGlzLl9zb3VyY2VQYXRoLCB0aGlzLl9ldmFsU3VjY2Vzc0hhbmRsZXIsIHRoaXMuX2V2YWxGYWlsdXJlSGFuZGxlciwgc2NvcGVDaGFpbik7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpcy5fZXZhbFN1Y2Nlc3ModGhpcy5fc291cmNlKTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLl91cGRhdGVJbW1lZGlhdGVseSA9IGZhbHNlO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gZW5zdXJlQXJyYXkodmFsdWUpIHtcclxuXHRcdHJldHVybiBpc0FycmF5KHZhbHVlKSA/IHZhbHVlIDogKGlzTnVsbE9yVW5kZWZpbmVkKHZhbHVlKSA/IFtdIDogW3ZhbHVlXSk7XHJcblx0fVxyXG5cclxuXHRCaW5kaW5nLm1peGluKHtcclxuXHJcblx0XHQvLyBGdW5jdGlvbnMgY29uY2VybmVkIHdpdGggc2V0dGluZyB0aGUgdmFsdWUgb2YgdGhlIHRhcmdldCBhZnRlclxyXG5cdFx0Ly8gdGhlIHNvdXJjZSB2YWx1ZSBoYXMgYmVlbiByZXRyaWV2ZWQgYW5kIG1hbmlwdWxhdGVkIGJhc2VkIG9uIG9wdGlvbnMuXHJcblx0XHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHRcdF9zZXRUYXJnZXQ6IGZ1bmN0aW9uKHZhbHVlKSB7XHJcblx0XHRcdGlmICh0aGlzLl9pc1RhcmdldEVsZW1lbnQgJiYgKHRoaXMuX3RhcmdldFBhdGggPT09IFwiaW5uZXJUZXh0XCIgfHwgdGhpcy5fdGFyZ2V0UGF0aCA9PT0gXCJpbm5lckhUTUxcIikpIHtcclxuXHRcdFx0XHRpZiAodmFsdWUgJiYgIWlzU3RyaW5nKHZhbHVlKSlcclxuXHRcdFx0XHRcdHZhbHVlID0gdmFsdWUudG9TdHJpbmcoKTtcclxuXHJcblx0XHRcdFx0Ly8gdGFrZW4gZnJvbSBTeXMkQmluZGluZyRfc291cmNlQ2hhbmdlZFxyXG5cdFx0XHRcdFN5cy5BcHBsaWNhdGlvbi5fY2xlYXJDb250ZW50KHRoaXMuX3RhcmdldCk7XHJcblx0XHRcdFx0aWYgKHRoaXMuX3RhcmdldFBhdGggPT09IFwiaW5uZXJIVE1MXCIpXHJcblx0XHRcdFx0XHR0aGlzLl90YXJnZXQuaW5uZXJIVE1MID0gdmFsdWU7XHJcblx0XHRcdFx0ZWxzZVxyXG5cdFx0XHRcdFx0dGhpcy5fdGFyZ2V0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHZhbHVlKSk7XHJcblx0XHRcdFx0T2JzZXJ2ZXIucmFpc2VQcm9wZXJ0eUNoYW5nZWQodGhpcy5fdGFyZ2V0LCB0aGlzLl90YXJnZXRQYXRoKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh0aGlzLl9pc1RhcmdldEVsZW1lbnQgJiYgdmFsdWUgPT09IG51bGwpIHtcclxuXHRcdFx0XHQvLyBJRSB3b3VsZCBzZXQgdGhlIHZhbHVlIHRvIFwibnVsbFwiXHJcblx0XHRcdFx0T2JzZXJ2ZXIuc2V0VmFsdWUodGhpcy5fdGFyZ2V0LCB0aGlzLl90YXJnZXRQYXRoLCBcIlwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRPYnNlcnZlci5zZXRWYWx1ZSh0aGlzLl90YXJnZXQsIHRoaXMuX3RhcmdldFBhdGgsIHZhbHVlKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHRfcXVldWU6IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG5cdFx0XHRpZiAodGhpcy5fcGVuZGluZ1ZhbHVlKSB7XHJcblx0XHRcdFx0dGhpcy5fcGVuZGluZ1ZhbHVlID0gdmFsdWU7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0aGlzLl9wZW5kaW5nVmFsdWUgPSB2YWx1ZTtcclxuXHJcblx0XHRcdEJhdGNoLndoZW5Eb25lKGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdHZhciB0YXJnZXRWYWx1ZSA9IHRoaXMuX3BlbmRpbmdWYWx1ZTtcclxuXHRcdFx0XHRkZWxldGUgdGhpcy5fcGVuZGluZ1ZhbHVlO1xyXG5cclxuXHRcdFx0XHRpZiAodGhpcy5fZGlzcG9zZWQgPT09IHRydWUpIHtcclxuXHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHRoaXMuX3NldFRhcmdldCh0YXJnZXRWYWx1ZSk7XHJcblx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0fSxcclxuXHJcblx0XHQvLyBGdW5jdGlvbnMgdGhhdCBmaWx0ZXIgb3IgdHJhbnNmb3JtIHRoZSB2YWx1ZSBvZiB0aGUgc291cmNlIGJlZm9yZVxyXG5cdFx0Ly8gc2V0dGluZyB0aGUgdGFyZ2V0LiAgVGhlc2UgbWV0aG9kcyBhcmUgTk9UIGFzeW5jaHJvbm91cy5cclxuXHRcdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdFx0X2dldFZhbHVlOiBmdW5jdGlvbih2YWx1ZSkge1xyXG5cdFx0XHQvLyBVc2UgYSBkZWZhdWx0IHZhbHVlIGlmIHRoZSBzb3VyY2UgdmFsdWUgaXMgbnVsbC4gTk9URTogQmVjYXVzZSBvZiB0aGUgd2F5IExhenlMb2FkZXIuZXZhbCBhbmQgZXZhbFBhdGggYXJlIHVzZWQsXHJcblx0XHRcdC8vIHRoZSByZXN1bHQgc2hvdWxkIG5ldmVyIGJlIHVuZGVmaW5lZC4gVW5kZWZpbmVkIHdvdWxkIGluZGljYXRlIHRoYXQgYSBwcm9wZXJ0eSBkaWQgbm90IGV4aXN0LCB3aGljaCB3b3VsZCBiZSBhblxyXG5cdFx0XHQvLyBlcnJvci4gVGhpcyBhbHNvIGhhcyB0aGUgc2lkZS1lZmZlY3Qgb2YgYmVpbmcgbW9yZSBjb21wYXRpYmxlIHdpdGggc2VydmVyLXNpZGUgcmVuZGVyaW5nLlxyXG5cdFx0XHRpZiAodmFsdWUgPT09IG51bGwpIHtcclxuXHRcdFx0XHRpZiAodGhpcy5fb3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShcIm51bGxWYWx1ZVwiKSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX29wdGlvbnMubnVsbFZhbHVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHQvLyBBdHRlbXB0IHRvIGZvcm1hdCB0aGUgc291cmNlIHZhbHVlIHVzaW5nIGEgZm9ybWF0IHNwZWNpZmllclxyXG5cdFx0XHRcdGlmICh0aGlzLl9vcHRpb25zLmZvcm1hdCkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIGdldEZvcm1hdCh2YWx1ZS5jb25zdHJ1Y3RvciwgdGhpcy5fb3B0aW9ucy5mb3JtYXQpLmNvbnZlcnQodmFsdWUpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmICh0aGlzLl9vcHRpb25zLnRyYW5zZm9ybSkge1xyXG5cdFx0XHRcdFx0Ly8gR2VuZXJhdGUgdGhlIHRyYW5zZm9ybSBmdW5jdGlvblxyXG5cdFx0XHRcdFx0aWYgKCF0aGlzLl90cmFuc2Zvcm1Gbikge1xyXG5cdFx0XHRcdFx0XHR0aGlzLl90cmFuc2Zvcm1GbiA9IG5ldyBGdW5jdGlvbihcImxpc3RcIiwgXCIkaW5kZXhcIiwgXCIkZGF0YUl0ZW1cIiwgXCJyZXR1cm4gJHRyYW5zZm9ybShsaXN0LCB0cnVlKS5cIiArIHRoaXMuX29wdGlvbnMudHJhbnNmb3JtICsgXCI7XCIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0Ly8gVHJhbnNmb3JtIHRoZSBvcmlnaW5hbCBsaXN0IHVzaW5nIHRoZSBnaXZlbiBvcHRpb25zXHJcblx0XHRcdFx0XHR2YXIgdHJhbnNmb3JtUmVzdWx0ID0gdGhpcy5fdHJhbnNmb3JtRm4odmFsdWUsIHRoaXMuX3RlbXBsYXRlQ29udGV4dC5pbmRleCwgdGhpcy5fdGVtcGxhdGVDb250ZXh0LmRhdGFJdGVtKTtcclxuXHRcdFx0XHRcdGlmICh0cmFuc2Zvcm1SZXN1bHQubGl2ZSAhPT0gVHJhbnNmb3JtLnByb3RvdHlwZS5saXZlKSB7XHJcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgdHJhbnNmb3JtIHJlc3VsdDogbWF5IG9ubHkgY29udGFpbiBcXFwid2hlcmVcXFwiLCBcXFwib3JkZXJCeVxcXCIsIFxcXCJzZWxlY3RcXFwiLCBcXFwic2VsZWN0TWFueVxcXCIsIGFuZCBcXFwiZ3JvdXBCeVxcXCIuXCIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0cmV0dXJuIHRyYW5zZm9ybVJlc3VsdC5saXZlKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiB2YWx1ZTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gRnVuY3Rpb25zIHRoYXQgZGVhbCB3aXRoIHJlc3BvbmRpbmcgdG8gY2hhbmdlcywgYXN5bmNocm9ub3VzIGxvYWRpbmcsXHJcblx0XHQvLyBhbmQgZ2VuZXJhbCBib29ra2VlcGluZy5cclxuXHRcdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdFx0X3JlcXVpcmU6IGZ1bmN0aW9uICh2YWx1ZSwgY2FsbGJhY2spIHtcclxuXHRcdFx0dmFyIHZhbHVlUmV2aXNpb24gPSB0aGlzLl92YWx1ZVJldmlzaW9uID0gRXhvV2ViLnJhbmRvbVRleHQoOCwgdHJ1ZSksXHJcblx0XHRcdFx0dXBkYXRlSW1tZWRpYXRlbHkgPSB0cnVlO1xyXG5cclxuXHRcdFx0TGF6eUxvYWRlci5ldmFsQWxsKHZhbHVlLCB0aGlzLl9vcHRpb25zLnJlcXVpcmVkLCBmdW5jdGlvbiAoKSB7XHJcblxyXG5cdFx0XHRcdC8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBkYXRhIGJlaW5nIGV2YWx1YXRlZCBpcyBub3Qgc3RhbGUuXHJcblx0XHRcdFx0aWYgKCF0aGlzLl92YWx1ZSB8fCB0aGlzLl92YWx1ZSAhPT0gdmFsdWUgfHwgdGhpcy5fdmFsdWVSZXZpc2lvbiAhPT0gdmFsdWVSZXZpc2lvbikge1xyXG5cdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0aWYgKHVwZGF0ZUltbWVkaWF0ZWx5KSB7XHJcblx0XHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXMpO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHR3aW5kb3cuc2V0VGltZW91dChjYWxsYmFjay5iaW5kKHRoaXMpLCAxKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0sIG51bGwsIG51bGwsIHRoaXMsIExhenlMb2FkZXIuZXZhbEFsbCwgZmFsc2UsIHZhbHVlLCBbXSwgdHJ1ZSk7XHJcblxyXG5cdFx0XHR1cGRhdGVJbW1lZGlhdGVseSA9IGZhbHNlO1xyXG5cdFx0fSxcclxuXHJcblx0XHRfdXBkYXRlOiBmdW5jdGlvbiAodmFsdWUsIG9sZEl0ZW1zLCBuZXdJdGVtcykge1xyXG5cdFx0XHRpZiAodGhpcy5fZGlzcG9zZWQgPT09IHRydWUpIHtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIGlmIG5lY2Vzc2FyeSwgcmVtb3ZlIGFuIGV4aXN0aW5nIGNvbGxlY3Rpb24gY2hhbmdlIGhhbmRsZXJcclxuXHRcdFx0aWYgKHRoaXMuX2NvbGxlY3Rpb25DaGFuZ2VkSGFuZGxlcikge1xyXG5cdFx0XHRcdE9ic2VydmVyLnJlbW92ZUNvbGxlY3Rpb25DaGFuZ2VkKHRoaXMuX3ZhbHVlLCB0aGlzLl9jb2xsZWN0aW9uQ2hhbmdlZEhhbmRsZXIpO1xyXG5cdFx0XHRcdGRlbGV0ZSB0aGlzLl92YWx1ZTtcclxuXHRcdFx0XHRkZWxldGUgdGhpcy5fY29sbGVjdGlvbkNoYW5nZWRIYW5kbGVyO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0aGlzLl92YWx1ZSA9IHZhbHVlO1xyXG5cclxuXHRcdFx0Ly8gaWYgdGhlIHZhbHVlIGlzIGFuIGFycmF5IGFuZCB3ZSB3aWxsIHRyYW5zZm9ybSB0aGUgdmFsdWUgb3IgcmVxdWlyZSBwYXRocywgdGhlbiB3YXRjaCBmb3IgY29sbGVjdGlvbiBjaGFuZ2UgZXZlbnRzXHJcblx0XHRcdGlmICh2YWx1ZSAmJiB2YWx1ZSBpbnN0YW5jZW9mIEFycmF5ICYmIHRoaXMuX29wdGlvbnMucmVxdWlyZWQpIHtcclxuXHRcdFx0XHR0aGlzLl9jb2xsZWN0aW9uQ2hhbmdlZEhhbmRsZXIgPSB0aGlzLl9jb2xsZWN0aW9uQ2hhbmdlZC5iaW5kKHRoaXMpO1xyXG5cdFx0XHRcdE9ic2VydmVyLm1ha2VPYnNlcnZhYmxlKHZhbHVlKTtcclxuXHRcdFx0XHRPYnNlcnZlci5hZGRDb2xsZWN0aW9uQ2hhbmdlZCh2YWx1ZSwgdGhpcy5fY29sbGVjdGlvbkNoYW5nZWRIYW5kbGVyKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gSWYgYWRkaXRpb25hbCBwYXRocyBhcmUgcmVxdWlyZWQgdGhlbiBsb2FkIHRoZW0gYmVmb3JlIGludm9raW5nIHRoZSBjYWxsYmFjay5cclxuXHRcdFx0aWYgKHRoaXMuX29wdGlvbnMucmVxdWlyZWQpIHtcclxuXHRcdFx0XHR0aGlzLl91cGRhdGVXYXRjaGVkSXRlbXModmFsdWUsIG9sZEl0ZW1zLCBuZXdJdGVtcywgZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9xdWV1ZSh0aGlzLl9nZXRWYWx1ZSh2YWx1ZSkpO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMuX3F1ZXVlKHRoaXMuX2dldFZhbHVlKHZhbHVlKSk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHJcblx0XHRfdXBkYXRlV2F0Y2hlZEl0ZW1zOiBmdW5jdGlvbih2YWx1ZSwgb2xkSXRlbXMsIG5ld0l0ZW1zLCBjYWxsYmFjaykge1xyXG5cdFx0XHQvLyBVbndhdGNoIHJlcXVpcmUgcGF0aCBmb3IgaXRlbXMgdGhhdCBhcmUgbm8gbG9uZ2VyIHJlbGV2YW50LlxyXG5cdFx0XHRpZiAob2xkSXRlbXMgJiYgb2xkSXRlbXMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdG9sZEl0ZW1zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xyXG5cdFx0XHRcdFx0T2JzZXJ2ZXIucmVtb3ZlUGF0aENoYW5nZWQoaXRlbSwgdGhpcy5fb3B0aW9ucy5yZXF1aXJlZCwgdGhpcy5fd2F0Y2hlZEl0ZW1QYXRoQ2hhbmdlZEhhbmRsZXIpO1xyXG5cdFx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHRcdGRlbGV0ZSB0aGlzLl93YXRjaGVkSXRlbVBhdGhDaGFuZ2VkSGFuZGxlcjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKHZhbHVlKSB7XHJcblx0XHRcdFx0Ly8gTG9hZCByZXF1aXJlZCBwYXRocywgdGhlbiBtYW5pcHVsYXRlIHRoZSBzb3VyY2UgdmFsdWUgYW5kIHVwZGF0ZSB0aGUgdGFyZ2V0LlxyXG5cdFx0XHRcdHRoaXMuX3JlcXVpcmUodmFsdWUsIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMuX2Rpc3Bvc2VkID09PSB0cnVlKSB7XHJcblx0XHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRpZiAobmV3SXRlbXMgJiYgbmV3SXRlbXMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdFx0XHQvLyBXYXRjaCByZXF1aXJlIHBhdGggZm9yIG5ldyBpdGVtcy5cclxuXHRcdFx0XHRcdFx0dGhpcy5fd2F0Y2hlZEl0ZW1QYXRoQ2hhbmdlZEhhbmRsZXIgPSB0aGlzLl93YXRjaGVkSXRlbVBhdGhDaGFuZ2VkLmJpbmQodGhpcyk7XHJcblx0XHRcdFx0XHRcdGZvckVhY2gobmV3SXRlbXMsIGZ1bmN0aW9uKGl0ZW0pIHtcclxuXHRcdFx0XHRcdFx0XHRPYnNlcnZlci5hZGRQYXRoQ2hhbmdlZChpdGVtLCB0aGlzLl9vcHRpb25zLnJlcXVpcmVkLCB0aGlzLl93YXRjaGVkSXRlbVBhdGhDaGFuZ2VkSGFuZGxlciwgdHJ1ZSk7XHJcblx0XHRcdFx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGlmIChjYWxsYmFjaykge1xyXG5cdFx0XHRcdFx0XHRjYWxsYmFjay5jYWxsKHRoaXMpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKGNhbGxiYWNrKSB7XHJcblx0XHRcdFx0Y2FsbGJhY2suY2FsbCh0aGlzKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHRfY29sbGVjdGlvbkNoYW5nZWQ6IGZ1bmN0aW9uKGl0ZW1zLCBldnQpIHtcclxuXHRcdFx0Ly8gSW4gdGhlIGNhc2Ugb2YgYW4gYXJyYXktdmFsdWVkIHNvdXJjZSwgcmVzcG9uZCB0byBhIGNvbGxlY3Rpb24gY2hhbmdlIHRoYXQgaXMgcmFpc2VkIGZvciB0aGUgc291cmNlIHZhbHVlLlxyXG5cdFx0XHRpZiAodGhpcy5fb3B0aW9ucy5yZXF1aXJlZCkge1xyXG5cdFx0XHRcdHZhciBvbGRJdGVtcyA9IGV2dC5nZXRfY2hhbmdlcygpLm1hcFRvQXJyYXkoZnVuY3Rpb24oY2hhbmdlKSB7IHJldHVybiBjaGFuZ2Uub2xkSXRlbXMgfHwgW107IH0pO1xyXG5cdFx0XHRcdHZhciBuZXdJdGVtcyA9IGV2dC5nZXRfY2hhbmdlcygpLm1hcFRvQXJyYXkoZnVuY3Rpb24oY2hhbmdlKSB7IHJldHVybiBjaGFuZ2UubmV3SXRlbXMgfHwgW107IH0pO1xyXG5cdFx0XHRcdHRoaXMuX3VwZGF0ZVdhdGNoZWRJdGVtcyhpdGVtcywgb2xkSXRlbXMsIG5ld0l0ZW1zKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHRfd2F0Y2hlZEl0ZW1QYXRoQ2hhbmdlZDogZnVuY3Rpb24oc2VuZGVyLCBhcmdzKSB7XHJcblx0XHRcdHRoaXMuX3VwZGF0ZSh0aGlzLl9zb3VyY2VQYXRoUmVzdWx0KTtcclxuXHRcdH0sXHJcblxyXG5cdFx0X3NvdXJjZVBhdGhDaGFuZ2VkOiBmdW5jdGlvbigpIHtcclxuXHRcdFx0Ly8gU2F2ZSB0aGUgcHJldmlvdXMgcmVzdWx0IGFuZCBldmFsdWF0ZSBhbmQgc3RvcmUgdGhlIG5ldyBvbmUuXHJcblx0XHRcdHZhciBwcmV2U291cmNlUGF0aFJlc3VsdCA9IHRoaXMuX3NvdXJjZVBhdGhSZXN1bHQ7XHJcblx0XHRcdHRoaXMuX3NvdXJjZVBhdGhSZXN1bHQgPSBldmFsUGF0aCh0aGlzLl9zb3VyY2UsIHRoaXMuX3NvdXJjZVBhdGgpO1xyXG5cclxuXHRcdFx0Ly8gaWYgdGhlIHZhbHVlIGlzIHRoZSBzYW1lICh3aGljaCB3aWxsIGNvbW1vbmx5IGhhcHBlbiB3aGVuIHRoZSBzb3VyY2UgaXMgYW4gYXJyYXkpIHRoZW4gdGhlcmUgaXMgbm8gbmVlZCB0byB1cGRhdGVcclxuXHRcdFx0aWYgKHByZXZTb3VyY2VQYXRoUmVzdWx0ICE9PSB0aGlzLl9zb3VyY2VQYXRoUmVzdWx0KSB7XHJcblx0XHRcdFx0Ly8gUmVzcG9uZCB0byBhIGNoYW5nZSB0aGF0IG9jY3VycyBhdCBhbnkgcG9pbnQgYWxvbmcgdGhlIHNvdXJjZSBwYXRoLlxyXG5cdFx0XHRcdHRoaXMuX3VwZGF0ZSh0aGlzLl9zb3VyY2VQYXRoUmVzdWx0LCBlbnN1cmVBcnJheShwcmV2U291cmNlUGF0aFJlc3VsdCksIGVuc3VyZUFycmF5KHRoaXMuX3NvdXJjZVBhdGhSZXN1bHQpKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHRfZXZhbFN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3VsdCwgcGVyZm9ybWVkTG9hZGluZywgc291cmNlKSB7XHJcblx0XHRcdHRoaXMuX3NvdXJjZSA9IHNvdXJjZTtcclxuXHJcblx0XHRcdGlmICh0aGlzLl9kaXNwb3NlZCkge1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0ZGVsZXRlIHRoaXMuX2V2YWxTdWNjZXNzSGFuZGxlcjtcclxuXHJcblx0XHRcdGlmICh0aGlzLl9zb3VyY2VQYXRoKSB7XHJcblx0XHRcdFx0dGhpcy5fc291cmNlUGF0aENoYW5nZWRIYW5kbGVyID0gdGhpcy5fc291cmNlUGF0aENoYW5nZWQuYmluZCh0aGlzKTtcclxuXHRcdFx0XHRPYnNlcnZlci5hZGRQYXRoQ2hhbmdlZCh0aGlzLl9zb3VyY2UsIHRoaXMuX3NvdXJjZVBhdGgsIHRoaXMuX3NvdXJjZVBhdGhDaGFuZ2VkSGFuZGxlciwgdHJ1ZSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMuX3NvdXJjZVBhdGhSZXN1bHQgPSByZXN1bHQ7XHJcblxyXG5cdFx0XHRpZiAodGhpcy5fdXBkYXRlSW1tZWRpYXRlbHkpIHtcclxuXHRcdFx0XHR0aGlzLl91cGRhdGUocmVzdWx0LCBudWxsLCBlbnN1cmVBcnJheShyZXN1bHQpKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHR2YXIgc2VsZiA9IHRoaXM7XHJcblx0XHRcdFx0d2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0c2VsZi5fdXBkYXRlKHJlc3VsdCwgbnVsbCwgZW5zdXJlQXJyYXkocmVzdWx0KSk7XHJcblx0XHRcdFx0fSwgMSk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblxyXG5cdFx0X2V2YWxGYWlsdXJlOiBmdW5jdGlvbihlcnIpIHtcclxuXHRcdFx0aWYgKHRoaXMuX2Rpc3Bvc2VkKSB7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRkZWxldGUgdGhpcy5fZXZhbEZhaWx1cmVIYW5kbGVyO1xyXG5cclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCRmb3JtYXQoXCJDb3VsZG4ndCBldmFsdWF0ZSBwYXRoICd7MH0nLCB7MX1cIiwgdGhpcy5fc291cmNlUGF0aCwgZXJyKSk7XHJcblx0XHR9LFxyXG5cclxuXHRcdGRpc3Bvc2U6IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRpZiAoIXRoaXMuX2Rpc3Bvc2VkKSB7XHJcblx0XHRcdFx0dGhpcy5fZGlzcG9zZWQgPSB0cnVlO1xyXG5cdFx0XHRcdGlmICh0aGlzLl9jb2xsZWN0aW9uQ2hhbmdlZEhhbmRsZXIpIHtcclxuXHRcdFx0XHRcdE9ic2VydmVyLnJlbW92ZUNvbGxlY3Rpb25DaGFuZ2VkKHRoaXMuX3ZhbHVlLCB0aGlzLl9jb2xsZWN0aW9uQ2hhbmdlZEhhbmRsZXIpO1xyXG5cdFx0XHRcdFx0dGhpcy5fY29sbGVjdGlvbkNoYW5nZWRIYW5kbGVyID0gbnVsbDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKHRoaXMuX3NvdXJjZVBhdGhDaGFuZ2VkSGFuZGxlcikge1xyXG5cdFx0XHRcdFx0T2JzZXJ2ZXIucmVtb3ZlUGF0aENoYW5nZWQodGhpcy5fc291cmNlLCB0aGlzLl9zb3VyY2VQYXRoLCB0aGlzLl9zb3VyY2VQYXRoQ2hhbmdlZEhhbmRsZXIpO1xyXG5cdFx0XHRcdFx0dGhpcy5fc291cmNlUGF0aENoYW5nZWRIYW5kbGVyID0gbnVsbDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKHRoaXMuX3dhdGNoZWRJdGVtUGF0aENoYW5nZWRIYW5kbGVyKSB7XHJcblx0XHRcdFx0XHRlbnN1cmVBcnJheSh0aGlzLl9zb3VyY2VQYXRoUmVzdWx0KS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcclxuXHRcdFx0XHRcdFx0T2JzZXJ2ZXIucmVtb3ZlUGF0aENoYW5nZWQoaXRlbSwgdGhpcy5fb3B0aW9ucy5yZXF1aXJlZCwgdGhpcy5fd2F0Y2hlZEl0ZW1QYXRoQ2hhbmdlZEhhbmRsZXIpO1xyXG5cdFx0XHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdFx0XHR0aGlzLl93YXRjaGVkSXRlbVBhdGhDaGFuZ2VkSGFuZGxlciA9IG51bGw7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGlmICh0aGlzLl9ldmFsU3VjY2Vzc0hhbmRsZXIpIHtcclxuXHRcdFx0XHRcdHRoaXMuX2V2YWxTdWNjZXNzSGFuZGxlciA9IG51bGw7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGlmICh0aGlzLl9ldmFsRmFpbHVyZUhhbmRsZXIpIHtcclxuXHRcdFx0XHRcdHRoaXMuX2V2YWxGYWlsdXJlSGFuZGxlciA9IG51bGw7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHRoaXMuX2lzVGFyZ2V0RWxlbWVudCA9IHRoaXMuX29wdGlvbnMgPSB0aGlzLl9wZW5kaW5nVmFsdWUgPSB0aGlzLl9zb3VyY2UgPVxyXG5cdFx0XHRcdFx0dGhpcy5fc291cmNlUGF0aCA9IHRoaXMuX3NvdXJjZVBhdGhSZXN1bHQgPSB0aGlzLl90YXJnZXQgPSB0aGlzLl90YXJnZXRQYXRoID1cclxuXHRcdFx0XHRcdHRoaXMuX3RlbXBsYXRlQ29udGV4dCA9IHRoaXMuX3RyYW5zZm9ybUZuID0gdGhpcy5fdmFsdWUgPSB0aGlzLl92YWx1ZVJldmlzaW9uID0gbnVsbDtcclxuXHRcdFx0fVxyXG5cdFx0XHRCaW5kaW5nLmNhbGxCYXNlTWV0aG9kKHRoaXMsIFwiZGlzcG9zZVwiKTtcclxuXHRcdH1cclxuXHJcblx0fSk7XHJcblxyXG5cdEV4b1dlYi5WaWV3LkJpbmRpbmcgPSBCaW5kaW5nO1xyXG5cdEJpbmRpbmcucmVnaXN0ZXJDbGFzcyhcIkV4b1dlYi5WaWV3LkJpbmRpbmdcIiwgU3lzLkNvbXBvbmVudCwgU3lzLlVJLklUZW1wbGF0ZUNvbnRleHRDb25zdW1lcik7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuVmlldy5MYXp5TWFya3VwRXh0ZW5zaW9uXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0U3lzLkFwcGxpY2F0aW9uLnJlZ2lzdGVyTWFya3VwRXh0ZW5zaW9uKFxyXG5cdFx0XCJ+XCIsXHJcblx0XHRmdW5jdGlvbiBMYXp5TWFya3VwRXh0ZW5zaW9uKGNvbXBvbmVudCwgdGFyZ2V0UHJvcGVydHksIHRlbXBsYXRlQ29udGV4dCwgcHJvcGVydGllcykge1xyXG5cdFx0XHR2YXIgc291cmNlO1xyXG5cdFx0XHR2YXIgc2NvcGVDaGFpbjtcclxuXHRcdFx0dmFyIHBhdGggPSBwcm9wZXJ0aWVzLnBhdGggfHwgcHJvcGVydGllcy4kZGVmYXVsdCB8fCBudWxsO1xyXG5cclxuXHRcdFx0Ly8gaWYgYSBzb3VyY2UgaXMgc3BlY2lmaWVkIGFuZCBpdCBpcyBhIHN0cmluZywgdGhlbiBleGVjdXRlIHRoZSBzb3VyY2UgYXMgYSBKYXZhU2NyaXB0IGV4cHJlc3Npb25cclxuXHRcdFx0aWYgKHByb3BlcnRpZXMuc291cmNlKSB7XHJcblx0XHRcdFx0aWYgKHByb3BlcnRpZXMuc291cmNlLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHtcclxuXHRcdFx0XHRcdC8vIGNyZWF0ZSBhIGZ1bmN0aW9uIHRvIGV2YWx1YXRlIHRoZSBiaW5kaW5nIHNvdXJjZSBmcm9tIHRoZSBnaXZlbiBzdHJpbmdcclxuXHRcdFx0XHRcdHZhciBldmFsU291cmNlID0gbmV3IEZ1bmN0aW9uKFwiJGVsZW1lbnRcIiwgXCIkaW5kZXhcIiwgXCIkZGF0YUl0ZW1cIiwgXCIkY29udGV4dFwiLCBcInJldHVybiBcIiArIHByb3BlcnRpZXMuc291cmNlICsgXCI7XCIpO1xyXG5cclxuXHRcdFx0XHRcdC8vIGdldCB0aGUgcmVsZXZhbnQgaHRtbCBlbGVtZW50IGVpdGhlciBhcyB0aGUgY29tcG9uZW50IG9yIHRoZSBjb21wb25lbnQncyB0YXJnZXQgZWxlbWVudFxyXG5cdFx0XHRcdFx0dmFyIGVsZW1lbnQgPSBudWxsO1xyXG5cdFx0XHRcdFx0aWYgKFN5cy5Db21wb25lbnQuaXNJbnN0YW5jZU9mVHlwZShjb21wb25lbnQpKSB7XHJcblx0XHRcdFx0XHRcdGVsZW1lbnQgPSBjb21wb25lbnQuZ2V0X2VsZW1lbnQoKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2UgaWYgKFN5cy5VSS5Eb21FbGVtZW50LmlzRG9tRWxlbWVudChjb21wb25lbnQpKSB7XHJcblx0XHRcdFx0XHRcdGVsZW1lbnQgPSBjb21wb25lbnQ7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0Ly8gZXZhbHVhdGUgdGhlIHZhbHVlIG9mIHRoZSBleHByZXNzaW9uXHJcblx0XHRcdFx0XHRzb3VyY2UgPSBldmFsU291cmNlKGVsZW1lbnQsIHRlbXBsYXRlQ29udGV4dC5pbmRleCwgdGVtcGxhdGVDb250ZXh0LmRhdGFJdGVtLCB0ZW1wbGF0ZUNvbnRleHQpO1xyXG5cclxuXHRcdFx0XHRcdC8vIGRvbid0IHRyeSB0byBldmFsIHRoZSBwYXRoIGFnYWluc3Qgd2luZG93XHJcblx0XHRcdFx0XHRzY29wZUNoYWluID0gW107XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0c291cmNlID0gcHJvcGVydGllcy5zb3VyY2U7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKHRlbXBsYXRlQ29udGV4dC5kYXRhSXRlbSkge1xyXG5cdFx0XHRcdHNvdXJjZSA9IHRlbXBsYXRlQ29udGV4dC5kYXRhSXRlbTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHQvLyBObyBjb250ZXh0IGRhdGEsIHNvIHBhdGggbXVzdCBiZSBnbG9iYWxcclxuXHRcdFx0XHRzb3VyY2UgPSB3aW5kb3c7XHJcblx0XHRcdFx0c2NvcGVDaGFpbiA9IFtdO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBCdWlsZCBhbiBvcHRpb25zIG9iamVjdCB0aGF0IHJlcHJlc2VudHMgb25seSB0aGUgb3B0aW9ucyB0aGF0IHRoZSBiaW5kaW5nXHJcblx0XHRcdC8vIGV4cGVjdHMsIGFuZCBvbmx5IGlmIHRoZXkgd2VyZSBzcGVjaWZpZWQgaW4gdGhlIG1hcmt1cCBleHRlbnNpb25cclxuXHRcdFx0dmFyIG9wdGlvbnMgPSB7fTtcclxuXHRcdFx0aWYgKHByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkoXCJyZXF1aXJlZFwiKSkge1xyXG5cdFx0XHRcdG9wdGlvbnMucmVxdWlyZWQgPSBwcm9wZXJ0aWVzLnJlcXVpcmVkO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChwcm9wZXJ0aWVzLmhhc093blByb3BlcnR5KFwidHJhbnNmb3JtXCIpKSB7XHJcblx0XHRcdFx0b3B0aW9ucy50cmFuc2Zvcm0gPSBwcm9wZXJ0aWVzLnRyYW5zZm9ybTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAocHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShcImZvcm1hdFwiKSkge1xyXG5cdFx0XHRcdG9wdGlvbnMuZm9ybWF0ID0gcHJvcGVydGllcy5mb3JtYXQ7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkoXCJudWxsVmFsdWVcIikpIHtcclxuXHRcdFx0XHRvcHRpb25zLm51bGxWYWx1ZSA9IHByb3BlcnRpZXMubnVsbFZhbHVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBDb25zdHJ1Y3QgdGhlIG5ldyBiaW5kaW5nIGNsYXNzXHJcblx0XHRcdHZhciBiaW5kaW5nID0gbmV3IEJpbmRpbmcodGVtcGxhdGVDb250ZXh0LCBzb3VyY2UsIHBhdGgsIGNvbXBvbmVudCwgcHJvcGVydGllcy50YXJnZXRQcm9wZXJ0eSB8fCB0YXJnZXRQcm9wZXJ0eSwgb3B0aW9ucywgc2NvcGVDaGFpbik7XHJcblxyXG5cdFx0XHQvLyByZWdpc3RlciB3aXRoIHRoZSB0ZW1wbGF0ZSBjb250ZXh0IGFzIGEgY2hpbGQgY29tcG9uZW50XHJcblx0XHRcdHRlbXBsYXRlQ29udGV4dC5jb21wb25lbnRzLnB1c2goYmluZGluZyk7XHJcblx0XHR9LFxyXG5cdFx0ZmFsc2VcclxuXHQpO1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLlZpZXcuQWRhcHRlclxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIEFkYXB0ZXIodGFyZ2V0LCBwcm9wZXJ0eVBhdGgsIGZvcm1hdCwgb3B0aW9ucykge1xyXG5cdFx0QWRhcHRlci5pbml0aWFsaXplQmFzZSh0aGlzKTtcclxuXHJcblx0XHR0aGlzLl90YXJnZXQgPSB0YXJnZXQgaW5zdGFuY2VvZiBPcHRpb25BZGFwdGVyID8gdGFyZ2V0LmdldF9yYXdWYWx1ZSgpIDogdGFyZ2V0O1xyXG5cdFx0dGhpcy5fcHJvcGVydHlQYXRoID0gcHJvcGVydHlQYXRoO1xyXG5cdFx0dGhpcy5fc2V0dGluZ1Jhd1ZhbHVlID0gZmFsc2U7XHJcblx0XHR0aGlzLl9yZWFkeVNpZ25hbCA9IG5ldyBFeG9XZWIuU2lnbmFsKFwiQWRhcHRlciBSZWFkeVwiKTtcclxuXHJcblx0XHRpZiAob3B0aW9ucy5hbGxvd2VkVmFsdWVzVHJhbnNmb3JtKSB7XHJcblx0XHRcdHRoaXMuX2FsbG93ZWRWYWx1ZXNUcmFuc2Zvcm0gPSBvcHRpb25zLmFsbG93ZWRWYWx1ZXNUcmFuc2Zvcm07XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKG9wdGlvbnMub3B0aW9uc1RyYW5zZm9ybSkge1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoJGZvcm1hdChcIk9wdGlvbiBcXFwib3B0aW9uc1RyYW5zZm9ybVxcXCIgaXMgb2Jzb2xldGUsIHVzZSBcXFwiYWxsb3dlZFZhbHVlc1RyYW5zZm9ybVxcXCIgaW5zdGVhZC4gUGF0aCA9IFxcXCJ7MH1cXFwiLlwiLCBwcm9wZXJ0eVBhdGgpKTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAob3B0aW9ucy5hbGxvd2VkVmFsdWVzTWF5QmVOdWxsKSB7XHJcblx0XHRcdHRoaXMuX2FsbG93ZWRWYWx1ZXNNYXlCZU51bGwgPSBvcHRpb25zLmFsbG93ZWRWYWx1ZXNNYXlCZU51bGw7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gSW5pdGlhbGl6ZSB0aGUgcHJvcGVydHkgY2hhaW4uXHJcblx0XHR0aGlzLl9pbml0UHJvcGVydHlDaGFpbigpO1xyXG5cclxuXHRcdC8vIERldGVybWluZSB0aGUgZGlzcGxheSBmb3JtYXQgdG8gdXNlXHJcblx0XHR0aGlzLl9mb3JtYXQgPSBmb3JtYXQgPyBnZXRGb3JtYXQodGhpcy5fcHJvcGVydHlDaGFpbi5nZXRfanN0eXBlKCksIGZvcm1hdCkgOiB0aGlzLl9wcm9wZXJ0eUNoYWluLmdldF9mb3JtYXQoKTtcclxuXHJcblx0XHQvLyBMb2FkIHRoZSBvYmplY3QgdGhpcyBhZGFwdGVyIGlzIGJvdW5kIHRvIGFuZCB0aGVuIGxvYWQgYWxsb3dlZCB2YWx1ZXMuXHJcblx0XHRMYXp5TG9hZGVyLmV2YWwodGhpcy5fdGFyZ2V0LCB0aGlzLl9wcm9wZXJ0eUNoYWluLmdldF9wYXRoKCksXHJcblx0XHRcdHRoaXMuX3JlYWR5U2lnbmFsLnBlbmRpbmcobnVsbCwgbnVsbCwgdHJ1ZSksXHJcblx0XHRcdHRoaXMuX3JlYWR5U2lnbmFsLm9yUGVuZGluZyhmdW5jdGlvbihlcnIpIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJGZvcm1hdChcIkNvdWxkbid0IGV2YWx1YXRlIHBhdGggJ3swfScsIHsxfVwiLCBwcm9wZXJ0eVBhdGgsIGVycikpO1xyXG5cdFx0XHR9LCBudWxsLCB0cnVlKVxyXG5cdFx0KTtcclxuXHJcblx0XHQvLyBBZGQgYXJiaXRyYXJ5IG9wdGlvbnMgc28gdGhhdCB0aGV5IGFyZSBtYWRlIGF2YWlsYWJsZSBpbiB0ZW1wbGF0ZXMuXHJcblx0XHR0aGlzLl9leHRlbmRQcm9wZXJ0aWVzKG9wdGlvbnMpO1xyXG5cdH1cclxuXHJcblx0QWRhcHRlci5taXhpbih7XHJcblx0XHQvLyBJbnRlcm5hbCBib29rLWtlZXBpbmcgYW5kIHNldHVwIG1ldGhvZHNcclxuXHRcdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0XHRfZXh0ZW5kUHJvcGVydGllczogZnVuY3Rpb24gQWRhcHRlciRfZXh0ZW5kUHJvcGVydGllcyhvcHRpb25zKSB7XHJcblx0XHRcdGlmIChvcHRpb25zKSB7XHJcblx0XHRcdFx0dmFyIGFsbG93ZWRPdmVycmlkZXMgPSBbXCJsYWJlbFwiLCBcImhlbHB0ZXh0XCJdO1xyXG5cclxuXHRcdFx0XHQvLyBUaGUgXCJudWxsT3B0aW9uXCIgdmFsdWUgY2FuIGJlIHNwZWNpZmllZCBmb3IgYm9vbGVhbnMgc2luY2Ugb3B0aW9uc1xyXG5cdFx0XHRcdC8vIGFyZSBleHBvc2VkIGFuZCB0aGV5IGFyZSBub3QgdHJlYXRlZCBhcyBudWxsYWJsZSBieSBkZWZhdWx0LlxyXG5cdFx0XHRcdGlmICh0aGlzLmlzVHlwZShCb29sZWFuKSkge1xyXG5cdFx0XHRcdFx0YWxsb3dlZE92ZXJyaWRlcy5wdXNoKFwibnVsbE9wdGlvblwiKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHRoaXMuX2V4dGVuZGVkUHJvcGVydGllcyA9IFtdO1xyXG5cdFx0XHRcdGZvciAodmFyIG9wdGlvbk5hbWUgaW4gb3B0aW9ucykge1xyXG5cdFx0XHRcdFx0Ly8gY2hlY2sgZm9yIGV4aXN0aW5nIGdldHRlciBhbmQgc2V0dGVyIG1ldGhvZHNcclxuXHRcdFx0XHRcdHZhciBnZXR0ZXIgPSB0aGlzW1wiZ2V0X1wiICsgb3B0aW9uTmFtZV07XHJcblx0XHRcdFx0XHR2YXIgc2V0dGVyID0gdGhpc1tcInNldF9cIiArIG9wdGlvbk5hbWVdO1xyXG5cclxuXHRcdFx0XHRcdC8vIGlmIHRoZSBvcHRpb24gaXMgYWxyZWFkeSBkZWZpbmVkIGRvbid0IG92ZXJ3cml0ZSBjcml0aWNhbCBwcm9wZXJ0aWVzIChlLmcuOiB2YWx1ZSlcclxuXHRcdFx0XHRcdGlmIChnZXR0ZXIgJiYgIUFycmF5LmNvbnRhaW5zKGFsbG93ZWRPdmVycmlkZXMsIG9wdGlvbk5hbWUpKSB7XHJcblx0XHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdHRoaXMuX2V4dGVuZGVkUHJvcGVydGllcy5wdXNoKG9wdGlvbk5hbWUpO1xyXG5cclxuXHRcdFx0XHRcdC8vIGNyZWF0ZSBhIGdldHRlciBhbmQgc2V0dGVyIGlmIHRoZXkgZG9uJ3QgZXhpc3RcclxuXHRcdFx0XHRcdGlmICghZ2V0dGVyIHx8ICEoZ2V0dGVyIGluc3RhbmNlb2YgRnVuY3Rpb24pKSB7XHJcblx0XHRcdFx0XHRcdGdldHRlciA9IHRoaXNbXCJnZXRfXCIgKyBvcHRpb25OYW1lXSA9XHJcblx0XHRcdFx0XHRcdFx0KGZ1bmN0aW9uIG1ha2VHZXR0ZXIoYWRhcHRlciwgb3B0aW9uTmFtZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGZ1bmN0aW9uIEFkYXB0ZXIkY3VzdG9tR2V0dGVyKCkgeyByZXR1cm4gYWRhcHRlcltcIl9cIiArIG9wdGlvbk5hbWVdOyB9O1xyXG5cdFx0XHRcdFx0XHRcdH0pKHRoaXMsIG9wdGlvbk5hbWUpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0aWYgKCFzZXR0ZXIgfHwgIShzZXR0ZXIgaW5zdGFuY2VvZiBGdW5jdGlvbikpIHtcclxuXHRcdFx0XHRcdFx0c2V0dGVyID0gdGhpc1tcInNldF9cIiArIG9wdGlvbk5hbWVdID1cclxuXHRcdFx0XHRcdFx0XHQoZnVuY3Rpb24gbWFrZVNldHRlcihhZGFwdGVyLCBvcHRpb25OYW1lKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZnVuY3Rpb24gQWRhcHRlciRjdXN0b21TZXR0ZXIodmFsdWUpIHsgYWRhcHRlcltcIl9cIiArIG9wdGlvbk5hbWVdID0gdmFsdWU7IH07XHJcblx0XHRcdFx0XHRcdFx0fSkodGhpcywgb3B0aW9uTmFtZSk7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0Ly8gc2V0IHRoZSBvcHRpb24gdmFsdWVcclxuXHRcdFx0XHRcdHNldHRlci5jYWxsKHRoaXMsIG9wdGlvbnNbb3B0aW9uTmFtZV0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdF9pbml0UHJvcGVydHlDaGFpbjogZnVuY3Rpb24gQWRhcHRlciRfaW5pdFByb3BlcnR5Q2hhaW4oKSB7XHJcblx0XHRcdHZhciBzb3VyY2VUeXBlO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMuX3RhcmdldCBpbnN0YW5jZW9mIEFkYXB0ZXIpIHtcclxuXHRcdFx0XHRpZiAoIXRoaXMuX3RhcmdldC5nZXRfaXNFbnRpdHkoKSkge1xyXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiQWRhcHRlciBzb3VyY2UgaXMgbm90IGFuIGVudGl0eS5cIik7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRzb3VyY2VUeXBlID0gdGhpcy5fdGFyZ2V0Ll9wcm9wZXJ0eUNoYWluLmdldF9qc3R5cGUoKS5tZXRhO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHZhciBzb3VyY2VPYmplY3QgPSB0aGlzLl90YXJnZXQ7XHJcblxyXG5cdFx0XHRcdGlmICghKHNvdXJjZU9iamVjdCBpbnN0YW5jZW9mIEVudGl0eSkpIHtcclxuXHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIkFkYXB0ZXIgc291cmNlIGlzIG5vdCBhbiBlbnRpdHksIGZvdW5kIFwiICsgKHNvdXJjZU9iamVjdCAhPSBudWxsID8gdHlwZW9mIChzb3VyY2VPYmplY3QpIDogXCJudWxsXCIpKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHNvdXJjZVR5cGUgPSBzb3VyY2VPYmplY3QubWV0YS50eXBlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBnZXQgdGhlIHByb3BlcnR5IGNoYWluIGZvciB0aGlzIGFkYXB0ZXIgc3RhcnRpbmcgYXQgdGhlIHNvdXJjZSBvYmplY3RcclxuXHRcdFx0dGhpcy5fcHJvcGVydHlDaGFpbiA9IE1vZGVsLnByb3BlcnR5KHRoaXMuX3Byb3BlcnR5UGF0aCwgc291cmNlVHlwZSk7XHJcblx0XHRcdGlmICghdGhpcy5fcHJvcGVydHlDaGFpbikge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcigkZm9ybWF0KFwiUHJvcGVydHkgXFxcInswfVxcXCIgY291bGQgbm90IGJlIGZvdW5kLlwiLCB0aGlzLl9wcm9wZXJ0eVBhdGgpKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gSWYgdGhlIHRhcmdldCBpcyBhbiBhZGFwdGVyLCBwcmVwZW5kIGl0cyBwcm9wZXJ0eSBjaGFpbi4gIENhbm5vdCBzaW1wbHkgY29uY2F0ZW5hdGUgcGF0aHNcclxuXHRcdFx0Ly8gc2luY2UgdGhlIGNoaWxkIHBhdGggY291bGQgYmUgaW5zdGFuY2UtZGVwZW5kZW50IChpLmUuIHRoZSBwYXJlbnRzIHZhbHVlIGlzIGEgc3VidHlwZSkuXHJcblx0XHRcdGlmICh0aGlzLl90YXJnZXQgaW5zdGFuY2VvZiBBZGFwdGVyKSB7XHJcblx0XHRcdFx0aWYgKHRoaXMuX3Byb3BlcnR5Q2hhaW4gaW5zdGFuY2VvZiBQcm9wZXJ0eSkge1xyXG5cdFx0XHRcdFx0dGhpcy5fcHJvcGVydHlDaGFpbiA9IG5ldyBQcm9wZXJ0eUNoYWluKHRoaXMuX3Byb3BlcnR5Q2hhaW4uZ2V0X2NvbnRhaW5pbmdUeXBlKCksIFt0aGlzLl9wcm9wZXJ0eUNoYWluXSwgW10pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHR0aGlzLl9wcm9wZXJ0eUNoYWluLnByZXBlbmQodGhpcy5fdGFyZ2V0LmdldF9wcm9wZXJ0eUNoYWluKCkpO1xyXG5cdFx0XHRcdHRoaXMuX3BhcmVudEFkYXB0ZXIgPSB0aGlzLl90YXJnZXQ7XHJcblx0XHRcdFx0dGhpcy5fdGFyZ2V0ID0gdGhpcy5fdGFyZ2V0LmdldF90YXJnZXQoKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdF9sb2FkRm9yRm9ybWF0QW5kUmFpc2VDaGFuZ2U6IGZ1bmN0aW9uIEFkYXB0ZXIkX2xvYWRGb3JGb3JtYXRBbmRSYWlzZUNoYW5nZSh2YWwpIHtcclxuXHRcdFx0RXZlbnRTY29wZSRvbkV4aXQoZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0dmFyIHNpZ25hbCA9IG5ldyBFeG9XZWIuU2lnbmFsKFwiQWRhcHRlci5kaXNwbGF5VmFsdWVcIik7XHJcblx0XHRcdFx0dGhpcy5fZG9Gb3JGb3JtYXRQYXRocyh2YWwsIGZ1bmN0aW9uKHBhdGgpIHtcclxuXHRcdFx0XHRcdEV2ZW50U2NvcGUkcGVyZm9ybShmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdFx0TGF6eUxvYWRlci5ldmFsQWxsKHZhbCwgcGF0aCwgc2lnbmFsLnBlbmRpbmcoKSwgc2lnbmFsLm9yUGVuZGluZygpLCBudWxsLCBudWxsLCBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdFx0XHRFdmVudFNjb3BlJHBlcmZvcm0oTGF6eUxvYWRlci5ldmFsQWxsLmJpbmQodGhpcywgYXJndW1lbnRzKSk7XHJcblx0XHRcdFx0XHRcdH0sIGZhbHNlLCB2YWwsIFtdKTtcclxuXHRcdFx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHRcdHNpZ25hbC53YWl0Rm9yQWxsKGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdFx0T2JzZXJ2ZXIucmFpc2VQcm9wZXJ0eUNoYW5nZWQodGhpcywgXCJkaXNwbGF5VmFsdWVcIik7XHJcblx0XHRcdFx0XHRPYnNlcnZlci5yYWlzZVByb3BlcnR5Q2hhbmdlZCh0aGlzLCBcInN5c3RlbVZhbHVlXCIpO1xyXG5cdFx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHR9LCB0aGlzKTtcclxuXHRcdH0sXHJcblx0XHRfZG9Gb3JGb3JtYXRQYXRoczogZnVuY3Rpb24gQWRhcHRlciRfZG9Gb3JGb3JtYXRQYXRocyh2YWwsIGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHRcdGlmICh2YWwgPT09IHVuZGVmaW5lZCB8fCB2YWwgPT09IG51bGwgfHwgIXRoaXMuX2Zvcm1hdCkge1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dGhpcy5fZm9ybWF0LmdldFBhdGhzKCkuZm9yRWFjaChjYWxsYmFjaywgdGhpc1B0ciB8fCB0aGlzKTtcclxuXHRcdH0sXHJcblx0XHRfdW5zdWJzY3JpYmVGcm9tRm9ybWF0Q2hhbmdlczogZnVuY3Rpb24gQWRhcHRlciRfdW5zdWJzY3JpYmVGcm9tRm9ybWF0Q2hhbmdlcyh2YWwpIHtcclxuXHRcdFx0dGhpcy5fZG9Gb3JGb3JtYXRQYXRocyh2YWwsIGZ1bmN0aW9uIChwYXRoKSB7XHJcblx0XHRcdFx0dmFyIHN1YnNjcmlwdGlvbiA9IHRoaXMuX2Zvcm1hdFN1YnNjcmliZXJzW3BhdGhdO1xyXG5cdFx0XHRcdGlmIChzdWJzY3JpcHRpb24gJiYgc3Vic2NyaXB0aW9uLmNoYWluKSB7XHJcblx0XHRcdFx0XHRzdWJzY3JpcHRpb24uY2hhaW4ucmVtb3ZlQ2hhbmdlZChzdWJzY3JpcHRpb24uaGFuZGxlcik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdH0sXHJcblx0XHRfc3Vic2NyaWJlVG9Gb3JtYXRDaGFuZ2VzOiBmdW5jdGlvbiBBZGFwdGVyJF9zdWJzY3JpYmVUb0Zvcm1hdENoYW5nZXModmFsKSB7XHJcblx0XHRcdHRoaXMuX2RvRm9yRm9ybWF0UGF0aHModmFsLCBmdW5jdGlvbiAocGF0aCkge1xyXG5cdFx0XHRcdE1vZGVsLnByb3BlcnR5KHBhdGgsIHRoaXMuX3Byb3BlcnR5Q2hhaW4ubGFzdFByb3BlcnR5KCkuZ2V0X2pzdHlwZSgpLm1ldGEsIHRydWUsIGZ1bmN0aW9uIChjaGFpbikge1xyXG5cdFx0XHRcdFx0dmFyIHN1YnNjcmlwdGlvbiA9IHRoaXMuX2Zvcm1hdFN1YnNjcmliZXJzW3BhdGhdID0geyBjaGFpbjogY2hhaW4sIGhhbmRsZXI6IHRoaXMuX2xvYWRGb3JGb3JtYXRBbmRSYWlzZUNoYW5nZS5iaW5kKHRoaXMpLnByZXBlbmRBcmd1bWVudHModmFsKSB9O1xyXG5cdFx0XHRcdFx0dmFyIGVudGl0aWVzID0gdmFsIGluc3RhbmNlb2YgQXJyYXkgPyB2YWwgOiBbdmFsXTtcclxuXHRcdFx0XHRcdGVudGl0aWVzLmZvckVhY2goZnVuY3Rpb24gKGVudGl0eSkge1xyXG5cdFx0XHRcdFx0XHRjaGFpbi5hZGRDaGFuZ2VkKHN1YnNjcmlwdGlvbi5oYW5kbGVyLCBlbnRpdHksIGZhbHNlLCB0cnVlKTtcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH0sXHJcblx0XHRfZW5zdXJlT2JzZXJ2YWJsZTogZnVuY3Rpb24gQWRhcHRlciRfZW5zdXJlT2JzZXJ2YWJsZSgpIHtcclxuXHRcdFx0dmFyIF90aGlzID0gdGhpcztcclxuXHJcblx0XHRcdGlmICghdGhpcy5fb2JzZXJ2YWJsZSkge1xyXG5cdFx0XHRcdE9ic2VydmVyLm1ha2VPYnNlcnZhYmxlKHRoaXMpO1xyXG5cclxuXHRcdFx0XHQvLyBzdWJzY3JpYmUgdG8gcHJvcGVydHkgY2hhbmdlcyBhdCBhbGwgcG9pbnRzIGluIHRoZSBwYXRoXHJcblx0XHRcdFx0dGhpcy5fdGFyZ2V0Q2hhbmdlZEhhbmRsZXIgPSB0aGlzLl9vblRhcmdldENoYW5nZWQuYmluZCh0aGlzKTtcclxuXHRcdFx0XHR0aGlzLl9wcm9wZXJ0eUNoYWluLmFkZENoYW5nZWQodGhpcy5fdGFyZ2V0Q2hhbmdlZEhhbmRsZXIsIHRoaXMuX3RhcmdldCwgZmFsc2UsIHRydWUpO1xyXG5cclxuXHRcdFx0XHR0aGlzLl9mb3JtYXRTdWJzY3JpYmVycyA9IHt9O1xyXG5cclxuXHRcdFx0XHQvLyBzZXQgdXAgaW5pdGlhbCB3YXRjaGluZyBvZiBmb3JtYXQgcGF0aHNcclxuXHRcdFx0XHRpZiAodGhpcy5fcHJvcGVydHlDaGFpbi5sYXN0VGFyZ2V0KHRoaXMuX3RhcmdldCkpIHtcclxuXHRcdFx0XHRcdHZhciByYXdWYWx1ZSA9IHRoaXMuX3Byb3BlcnR5Q2hhaW4udmFsdWUodGhpcy5fdGFyZ2V0KTtcclxuXHRcdFx0XHRcdHRoaXMuX3N1YnNjcmliZVRvRm9ybWF0Q2hhbmdlcyhyYXdWYWx1ZSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyB3aGVuIHRoZSB2YWx1ZSBjaGFuZ2VzIHJlc3Vic2NyaWJlXHJcblx0XHRcdFx0dGhpcy5fcHJvcGVydHlDaGFpbi5hZGRDaGFuZ2VkKGZ1bmN0aW9uIChzZW5kZXIsIGFyZ3MpIHtcclxuXHRcdFx0XHRcdF90aGlzLl91bnN1YnNjcmliZUZyb21Gb3JtYXRDaGFuZ2VzKGFyZ3Mub2xkVmFsdWUpO1xyXG5cdFx0XHRcdFx0X3RoaXMuX3N1YnNjcmliZVRvRm9ybWF0Q2hhbmdlcyhhcmdzLm5ld1ZhbHVlKTtcclxuXHRcdFx0XHR9LCB0aGlzLl90YXJnZXQsIGZhbHNlLCB0cnVlKTtcclxuXHJcblx0XHRcdFx0dGhpcy5fb2JzZXJ2YWJsZSA9IHRydWU7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRfb25UYXJnZXRDaGFuZ2VkOiBmdW5jdGlvbiBBZGFwdGVyJF9vblRhcmdldENoYW5nZWQoc2VuZGVyLCBhcmdzKSB7XHJcblx0XHRcdHZhciBfdGhpcyA9IHRoaXM7XHJcblx0XHRcdHZhciByYXdWYWx1ZSA9IHRoaXMuZ2V0X3Jhd1ZhbHVlKCk7XHJcblxyXG5cdFx0XHRpZiAoIXRoaXMuX3NldHRpbmdSYXdWYWx1ZSkge1xyXG5cdFx0XHRcdC8vIHJhaXNlIHJhdyB2YWx1ZSBjaGFuZ2VkIGV2ZW50XHJcblx0XHRcdFx0TGF6eUxvYWRlci5ldmFsKHJhd1ZhbHVlLCBudWxsLCBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRPYnNlcnZlci5yYWlzZVByb3BlcnR5Q2hhbmdlZChfdGhpcywgXCJyYXdWYWx1ZVwiKTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gcmFpc2UgdmFsdWUgY2hhbmdlZCBldmVudFxyXG5cdFx0XHR0aGlzLl9sb2FkRm9yRm9ybWF0QW5kUmFpc2VDaGFuZ2UocmF3VmFsdWUpO1xyXG5cclxuXHRcdFx0Ly8gUmUtYXR0YWNoIHZhbGlkYXRpb24gaGFuZGxlcnMgaWYgbmVlZGVkXHJcblx0XHRcdHZhciBwcm9wZXJ0aWVzID0gdGhpcy5fcHJvcGVydHlDaGFpbi5wcm9wZXJ0aWVzKCk7XHJcblx0XHRcdHZhciBudW1Qcm9wcyA9IHByb3BlcnRpZXMubGVuZ3RoO1xyXG5cclxuXHRcdFx0Ly8gVGhlIGxhc3QgdGFyZ2V0IGRvZXMgbm90IGNoYW5nZSBpZiB0aGlzIGlzIGEgc2luZ2xlLXByb3BlcnR5IGNoYWluLFxyXG5cdFx0XHQvLyBzbyBubyBuZWVkIHRvIHVwZGF0ZSB2YWxpZGF0aW9uIGV2ZW50c1xyXG5cdFx0XHRpZiAobnVtUHJvcHMgPiAxICYmIGFyZ3MudHJpZ2dlcmVkQnkgIT09IHRoaXMuX3Byb3BlcnR5Q2hhaW4ubGFzdFByb3BlcnR5KCkpIHtcclxuXHRcdFx0XHQvLyBSZW1vdmUgZXZlbnQgaGFuZGxlcnMgZm9yIHByZXZpb3VzIGxhc3QgdGFyZ2V0IFxyXG5cdFx0XHRcdGlmIChhcmdzLm9sZFZhbHVlKSB7XHJcblx0XHRcdFx0XHQvLyBEZXRlcm1pbmUgdGhlIG9sZCBsYXN0IHRhcmdldFxyXG5cdFx0XHRcdFx0dmFyIHByb3BlcnR5LFxyXG5cdFx0XHRcdFx0XHRwcm9wSW5kZXggPSBwcm9wZXJ0aWVzLmluZGV4T2YoYXJncy50cmlnZ2VyZWRCeSkgKyAxLFxyXG5cdFx0XHRcdFx0XHRuZXdMYXN0VGFyZ2V0ID0gdGhpcy5fcHJvcGVydHlDaGFpbi5sYXN0VGFyZ2V0KHRoaXMuX3RhcmdldCksXHJcblx0XHRcdFx0XHRcdG9sZExhc3RUYXJnZXQgPSBhcmdzLm9sZFZhbHVlO1xyXG5cdFx0XHRcdFx0d2hpbGUgKG9sZExhc3RUYXJnZXQgJiYgcHJvcEluZGV4IDwgbnVtUHJvcHMgLSAxKSB7XHJcblx0XHRcdFx0XHRcdHByb3BlcnR5ID0gcHJvcGVydGllc1twcm9wSW5kZXgrK10sXHJcblx0XHRcdFx0XHRcdG9sZExhc3RUYXJnZXQgPSBwcm9wZXJ0eS52YWx1ZShvbGRMYXN0VGFyZ2V0KTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyBSZW1vdmUgYW5kIHJlLWFkZCB2YWxpZGF0aW9uIGhhbmRsZXJzIGlmIHRoZSBsYXN0IHRhcmdldCBoYXMgY2hhbmdlZFxyXG5cdFx0XHRcdFx0aWYgKG9sZExhc3RUYXJnZXQgJiYgb2xkTGFzdFRhcmdldCAhPT0gbmV3TGFzdFRhcmdldCkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLmdldF9jb25kaXRpb25zKCkuY2xlYXIoKTtcclxuXHRcdFx0XHRcdFx0aWYgKHRoaXMuX2NvbmRpdGlvbnNDaGFuZ2VkSGFuZGxlcikge1xyXG5cdFx0XHRcdFx0XHRcdG9sZExhc3RUYXJnZXQubWV0YS5yZW1vdmVDb25kaXRpb25zQ2hhbmdlZCh0aGlzLl9jb25kaXRpb25zQ2hhbmdlZEhhbmRsZXIpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBBZGQgdGhlIGNvbmRpdGlvbnMgZm9yIHRoZSBuZXcgdGFyZ2V0IGFuZCBzdWJzY3JpYmUgdG8gY2hhbmdlc1xyXG5cdFx0XHRcdGlmICh0aGlzLmdldF9jb25kaXRpb25zKCkgJiYgbmV3TGFzdFRhcmdldCkge1xyXG5cdFx0XHRcdFx0dGhpcy5nZXRfY29uZGl0aW9ucygpLmFkZFJhbmdlKG5ld0xhc3RUYXJnZXQubWV0YS5jb25kaXRpb25zKHRoaXMuZ2V0X3Byb3BlcnR5Q2hhaW4oKS5sYXN0UHJvcGVydHkoKSkpO1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMuX2NvbmRpdGlvbnNDaGFuZ2VkSGFuZGxlcikge1xyXG5cdFx0XHRcdFx0XHRuZXdMYXN0VGFyZ2V0Lm1ldGEuYWRkQ29uZGl0aW9uc0NoYW5nZWQodGhpcy5fY29uZGl0aW9uc0NoYW5nZWRIYW5kbGVyLCB0aGlzLmdldF9wcm9wZXJ0eUNoYWluKCkpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKCF0aGlzLl9zZXR0aW5nUmF3VmFsdWUpIHtcclxuXHRcdFx0XHQvLyBSYWlzZSBjaGFuZ2Ugb24gb3B0aW9ucyByZXByZXNlbnRpbmcgdGhlIG9sZCBhbmQgbmV3IHZhbHVlIGluIHRoZSBldmVudCB0aGF0IHRoZSBwcm9wZXJ0eSBcclxuXHRcdFx0XHQvLyBoYXMgYmUgY2hhbmdlZCBieSBub24tVUkgY29kZSBvciBhbm90aGVyIFVJIGNvbXBvbmVudC4gIFRoaXMgd2lsbCByZXN1bHQgaW4gZG91YmxlIHJhaXNpbmcgXHJcblx0XHRcdFx0Ly8gZXZlbnRzIGlmIHRoZSB2YWx1ZSB3YXMgc2V0IGJ5IGNoYW5naW5nIHNlbGVjdGVkIG9uIG9uZSBvZiB0aGUgT3B0aW9uQWRhcHRlciBvYmplY3RzLlxyXG5cdFx0XHRcdGlmICh0aGlzLl9vcHRpb25zKSB7XHJcblx0XHRcdFx0XHRBcnJheS5mb3JFYWNoKHRoaXMuX29wdGlvbnMsIGZ1bmN0aW9uIChvKSB7XHJcblx0XHRcdFx0XHRcdC8vIEFsd2F5cyByZWxvYWQgc2VsZWN0ZWQgZm9yIG9wdGlvbnMgaW4gYW4gYXJyYXkgc2luY2Ugd2UgZG9uJ3Qga25vdyB3aGF0IHRoZSBvbGQgdmFsdWVzIGluIHRoZSBsaXN0IHdlcmVcclxuXHRcdFx0XHRcdFx0aWYgKGFyZ3MubmV3VmFsdWUgaW5zdGFuY2VvZiBBcnJheSB8fCBvLmdldF9yYXdWYWx1ZSgpID09IGFyZ3MubmV3VmFsdWUgfHwgby5nZXRfcmF3VmFsdWUoKSA9PSBhcmdzLm9sZFZhbHVlKSB7XHJcblx0XHRcdFx0XHRcdFx0T2JzZXJ2ZXIucmFpc2VQcm9wZXJ0eUNoYW5nZWQobywgXCJzZWxlY3RlZFwiKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBEaXNwb3NlIG9mIGV4aXN0aW5nIGV2ZW50IGhhbmRsZXJzIHJlbGF0ZWQgdG8gYWxsb3dlZCB2YWx1ZSBsb2FkaW5nXHJcblx0XHRcdFx0ZGlzcG9zZU9wdGlvbnMuY2FsbCh0aGlzKTtcclxuXHRcdFx0XHRzaWduYWxPcHRpb25zUmVhZHkuY2FsbCh0aGlzKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdF9zZXRWYWx1ZTogZnVuY3Rpb24gQWRhcHRlciRfc2V0VmFsdWUodmFsdWUpIHtcclxuXHRcdFx0dmFyIHByb3AgPSB0aGlzLl9wcm9wZXJ0eUNoYWluO1xyXG5cclxuXHRcdFx0Ly8gQ2xlYXIgZXhpc3RpbmcgZm9ybWF0IGVycm9ycyBiZWZvcmUgYWRkaW5nIGEgbmV3IG9uZS5cclxuXHRcdFx0aWYgKHRoaXMuX2Zvcm1hdEVycm9yKSB7XHJcblx0XHRcdFx0dGhpcy5nZXRfY29uZGl0aW9ucygpLnJlbW92ZSh0aGlzLl9mb3JtYXRFcnJvcik7XHJcblx0XHRcdFx0dGhpcy5fZm9ybWF0RXJyb3IgPSB1bmRlZmluZWQ7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICh2YWx1ZSBpbnN0YW5jZW9mIEV4b1dlYi5Nb2RlbC5Gb3JtYXRFcnJvcikge1xyXG5cdFx0XHRcdC8vIEluc2VydCBuZXcgZm9ybWF0IGVycm9ycyBpZiB0aGUgdmFsdWUgaXMgbm90IHZhbGlkLlxyXG5cdFx0XHRcdHRoaXMuX2Zvcm1hdEVycm9yID0gdmFsdWUuY3JlYXRlQ29uZGl0aW9uKHByb3AubGFzdFRhcmdldCh0aGlzLl90YXJnZXQpLCBwcm9wLmxhc3RQcm9wZXJ0eSgpKTtcclxuXHRcdFx0XHR0aGlzLmdldF9jb25kaXRpb25zKCkuaW5zZXJ0KDAsIHRoaXMuX2Zvcm1hdEVycm9yKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHQvLyBPdGhlcndpc2UsIHVwZGF0ZSB0aGUgcHJvcGVydHkgdmFsdWUuXHJcblx0XHRcdFx0dmFyIGNoYW5nZWQgPSBwcm9wLnZhbHVlKHRoaXMuX3RhcmdldCkgIT09IHZhbHVlO1xyXG5cdFx0XHRcdHRoaXMuc2V0X3Jhd1ZhbHVlKHZhbHVlLCBjaGFuZ2VkKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHQvLyBWYXJpb3VzIG1ldGhvZHMuXHJcblx0XHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cdFx0cmVhZHk6IGZ1bmN0aW9uIEFkYXB0ZXIkcmVhZHkoY2FsbGJhY2ssIHRoaXNQdHIpIHtcclxuXHRcdFx0dGhpcy5fcmVhZHlTaWduYWwud2FpdEZvckFsbChjYWxsYmFjaywgdGhpc1B0ciwgdHJ1ZSk7XHJcblx0XHR9LFxyXG5cdFx0dG9TdHJpbmc6IGZ1bmN0aW9uIEFkYXB0ZXIkdG9TdHJpbmcoKSB7XHJcblx0XHRcdHZhciB0YXJnZXRUeXBlO1xyXG5cdFx0XHRpZiAodGhpcy5fdGFyZ2V0ID09PSBudWxsKSB7XHJcblx0XHRcdFx0dGFyZ2V0VHlwZSA9IFwibnVsbFwiO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKHRoaXMuX3RhcmdldCA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0dGFyZ2V0VHlwZSA9IFwidW5kZWZpbmVkXCI7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGFyZ2V0VHlwZSA9IHBhcnNlRnVuY3Rpb25OYW1lKHRoaXMuX3RhcmdldC5jb25zdHJ1Y3Rvcik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciB2YWx1ZTtcclxuXHRcdFx0dHJ5IHtcclxuXHRcdFx0XHR2YWx1ZSA9IHRoaXMuZ2V0X3Jhd1ZhbHVlKCk7XHJcblxyXG5cdFx0XHRcdGlmICh2YWx1ZSA9PT0gbnVsbCkge1xyXG5cdFx0XHRcdFx0dmFsdWUgPSBcIm51bGxcIjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0dmFsdWUgPSBcInVuZGVmaW5lZFwiO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmICh2YWx1ZS5jb25zdHJ1Y3RvciAhPT0gU3RyaW5nKSB7XHJcblx0XHRcdFx0XHR2YWx1ZSA9IHZhbHVlLnRvU3RyaW5nKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGNhdGNoIChlKSB7XHJcblx0XHRcdFx0dmFsdWUgPSBcIltlcnJvcl1cIjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuICRmb3JtYXQoXCI8ezB9Pi57MX06ICB7Mn1cIiwgW3RhcmdldFR5cGUsIHRoaXMuX3Byb3BlcnR5UGF0aCwgdmFsdWVdKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gUHJvcGVydGllcyB0aGF0IGFyZSBpbnRlbmRlZCB0byBiZSB1c2VkIGJ5IHRlbXBsYXRlcy5cclxuXHRcdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0XHRpc1R5cGU6IGZ1bmN0aW9uIEFkYXB0ZXIkaXNUeXBlKGpzdHlwZSkge1xyXG5cdFx0XHRpZiAodGhpcy5fanN0eXBlICYmIHRoaXMuX2pzdHlwZSBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2pzdHlwZSA9PT0ganN0eXBlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRmb3IgKHZhciBwcm9wVHlwZSA9IHRoaXMuX3Byb3BlcnR5Q2hhaW4uZ2V0X2pzdHlwZSgpOyBwcm9wVHlwZSAhPT0gbnVsbDsgcHJvcFR5cGUgPSBwcm9wVHlwZS5nZXRCYXNlVHlwZSgpKSB7XHJcblx0XHRcdFx0aWYgKHByb3BUeXBlID09PSBqc3R5cGUpIHtcclxuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0fSxcclxuXHRcdGFzcGVjdHM6IGZ1bmN0aW9uIEFkYXB0ZXIkYXNwZWN0cygpIHtcclxuXHRcdFx0aWYgKCF0aGlzLl9hc3BlY3RzKSB7XHJcblx0XHRcdFx0dGhpcy5fYXNwZWN0cyA9IHtcclxuXHRcdFx0XHRcdFwiaXNMaXN0XCI6IHRoaXMuZ2V0X2lzTGlzdCgpLFxyXG5cdFx0XHRcdFx0XCJpc1JlZmVyZW5jZVwiOiB0aGlzLmdldF9pc0VudGl0eSgpIHx8IHRoaXMuZ2V0X2lzRW50aXR5TGlzdCgpLFxyXG5cdFx0XHRcdFx0XCJkYXRhVHlwZVwiOiB0aGlzLmdldF9kYXRhVHlwZSgpXHJcblx0XHRcdFx0fTtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fYXNwZWN0cztcclxuXHRcdH0sXHJcblx0XHRnZXRfaXNMaXN0OiBmdW5jdGlvbiBBZGFwdGVyJGdldF9pc0xpc3QoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9wcm9wZXJ0eUNoYWluLmdldF9pc0xpc3QoKTtcclxuXHRcdH0sXHJcblx0XHRnZXRfaXNFbnRpdHk6IGZ1bmN0aW9uIEFkYXB0ZXIkZ2V0X2lzRW50aXR5KCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fcHJvcGVydHlDaGFpbi5nZXRfaXNFbnRpdHlUeXBlKCk7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X2lzRW50aXR5TGlzdDogZnVuY3Rpb24gQWRhcHRlciRnZXRfaXNFbnRpdHlMaXN0KCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fcHJvcGVydHlDaGFpbi5nZXRfaXNFbnRpdHlMaXN0VHlwZSgpO1xyXG5cdFx0fSxcclxuXHRcdGdldF9pc1N0YXRpYzogZnVuY3Rpb24gQWRhcHRlciRnZXRfaXNTdGF0aWMoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9wcm9wZXJ0eUNoYWluLmdldF9pc1N0YXRpYygpO1xyXG5cdFx0fSxcclxuXHRcdGdldF90YXJnZXQ6IGZ1bmN0aW9uIEFkYXB0ZXIkZ2V0X3RhcmdldCgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX3RhcmdldDtcclxuXHRcdH0sXHJcblx0XHRnZXRfcHJvcGVydHlQYXRoOiBmdW5jdGlvbiBBZGFwdGVyJGdldF9wcm9wZXJ0eVBhdGgoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9wcm9wZXJ0eVBhdGg7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X3Byb3BlcnR5Q2hhaW46IGZ1bmN0aW9uIEFkYXB0ZXIkZ2V0X3Byb3BlcnR5Q2hhaW4oKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9wcm9wZXJ0eUNoYWluO1xyXG5cdFx0fSxcclxuXHRcdGdldF9mb3JtYXQ6IGZ1bmN0aW9uIEFkYXB0ZXIkZ2V0X2Zvcm1hdCgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zvcm1hdDtcclxuXHRcdH0sXHJcblx0XHRnZXRfZGF0YVR5cGU6IGZ1bmN0aW9uIEFkYXB0ZXIkZ2V0X2RhdGFUeXBlKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fcHJvcGVydHlDaGFpbi5nZXRfanN0eXBlKCk7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X2xhYmVsOiBmdW5jdGlvbiBBZGFwdGVyJGdldF9sYWJlbCgpIHtcclxuXHRcdFx0Ly8gaWYgbm8gbGFiZWwgaXMgc3BlY2lmaWVkIHRoZW4gdXNlIHRoZSBwcm9wZXJ0eSBsYWJlbFxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fbGFiZWwgfHwgdGhpcy5fcHJvcGVydHlDaGFpbi5nZXRfbGFiZWwoKTtcclxuXHRcdH0sXHJcblx0XHRnZXRfaGVscHRleHQ6IGZ1bmN0aW9uIEFkYXB0ZXIkZ2V0X2hlbHB0ZXh0KCkge1xyXG5cdFx0XHQvLyBoZWxwIHRleHQgbWF5IGFsc28gYmUgaW5jbHVkZWQgaW4gdGhlIG1vZGVsP1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5faGVscHRleHQgfHwgdGhpcy5fcHJvcGVydHlDaGFpbi5nZXRfaGVscHRleHQoKSB8fCBcIlwiO1xyXG5cdFx0fSxcclxuXHRcdGdldF9udWxsT3B0aW9uOiBmdW5jdGlvbiBBZGFwdGVyJGdldF9udWxsT3B0aW9uKCkge1xyXG5cdFx0XHRpZiAodGhpcy5pc1R5cGUoQm9vbGVhbikpIHtcclxuXHRcdFx0XHRpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShcIl9udWxsT3B0aW9uXCIpKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fbnVsbE9wdGlvbjtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIEJvb2xlYW5zIGFyZSBub3QgbnVsbGFibGUgYnkgZGVmYXVsdC5cclxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0fSxcclxuXHRcdGdldF92YWx1ZXM6IGZ1bmN0aW9uIEFkYXB0ZXIkZ2V0X3ZhbHVlcygpIHtcclxuXHRcdFx0dGhpcy5fZW5zdXJlT2JzZXJ2YWJsZSgpO1xyXG5cdFx0XHRpZiAodGhpcy5nZXRfaXNMaXN0KCkpIHtcclxuXHRcdFx0XHR2YXIgX3RoaXMgPSB0aGlzO1xyXG5cdFx0XHRcdHZhciB2YWx1ZXMgPSB0aGlzLl9wcm9wZXJ0eUNoYWluLnZhbHVlKHRoaXMuX3RhcmdldCk7XHJcblx0XHRcdFx0cmV0dXJuIHZhbHVlcy5tYXAoZnVuY3Rpb24gKHYsIGkpIHsgcmV0dXJuIG5ldyBMaXN0VmFsdWVBZGFwdGVyKF90aGlzLCBpKSB9KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJBZGFwdGVyIHZhbHVlcyBhcmUgb25seSBhdmFpbGFibGUgZm9yIGxpc3QgcHJvcGVydGllcy5cIik7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRnZXRfcmF3VmFsdWU6IGZ1bmN0aW9uIEFkYXB0ZXIkZ2V0X3Jhd1ZhbHVlKCkge1xyXG5cdFx0XHR0aGlzLl9lbnN1cmVPYnNlcnZhYmxlKCk7XHJcblx0XHRcdHJldHVybiB0aGlzLl9wcm9wZXJ0eUNoYWluLnZhbHVlKHRoaXMuX3RhcmdldCk7XHJcblx0XHR9LFxyXG5cdFx0c2V0X3Jhd1ZhbHVlOiBmdW5jdGlvbiBBZGFwdGVyJHNldF9yYXdWYWx1ZSh2YWx1ZSwgY2hhbmdlZCkge1xyXG5cdFx0XHR2YXIgcHJvcCA9IHRoaXMuX3Byb3BlcnR5Q2hhaW4sIHRhcmdldCwgdGFyZ2V0VHlwZTtcclxuXHJcblx0XHRcdGlmIChjaGFuZ2VkID09PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRjaGFuZ2VkID0gcHJvcC52YWx1ZSh0aGlzLl90YXJnZXQpICE9PSB2YWx1ZTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKGNoYW5nZWQpIHtcclxuXHRcdFx0XHR0aGlzLl9zZXR0aW5nUmF3VmFsdWUgPSB0cnVlO1xyXG5cclxuXHRcdFx0XHR0cnkge1xyXG5cdFx0XHRcdFx0dGFyZ2V0ID0gdGhpcy5fdGFyZ2V0O1xyXG5cdFx0XHRcdFx0aWYgKHRhcmdldCA9PT0gbnVsbCkge1xyXG5cdFx0XHRcdFx0XHR0YXJnZXRUeXBlID0gXCJudWxsXCI7XHJcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHRhcmdldCA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHRcdHRhcmdldFR5cGUgPSBcInVuZGVmaW5lZFwiO1xyXG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBFeG9XZWIuTW9kZWwuRW50aXR5KSB7XHJcblx0XHRcdFx0XHRcdHRhcmdldFR5cGUgPSB0YXJnZXQubWV0YS50eXBlLmdldF9mdWxsTmFtZSgpO1xyXG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBFeG9XZWIuVmlldy5BZGFwdGVyKSB7XHJcblx0XHRcdFx0XHRcdHRhcmdldFR5cGUgPSBcIkFkYXB0ZXJcIjtcclxuXHRcdFx0XHRcdH0gZWxzZSBpZiAodGFyZ2V0IGluc3RhbmNlb2YgRXhvV2ViLlZpZXcuT3B0aW9uQWRhcHRlcikge1xyXG5cdFx0XHRcdFx0XHR0YXJnZXRUeXBlID0gXCJPcHRpb25BZGFwdGVyXCI7XHJcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHRhcmdldCBpbnN0YW5jZW9mIEV4b1dlYi5WaWV3Lk9wdGlvbkdyb3VwQWRhcHRlcikge1xyXG5cdFx0XHRcdFx0XHR0YXJnZXRUeXBlID0gXCJPcHRpb25Hcm91cEFkYXB0ZXJcIjtcclxuXHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdHRhcmdldFR5cGUgPSBwYXJzZUZ1bmN0aW9uTmFtZSh0YXJnZXQuY29uc3RydWN0b3IpO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGlmIChFeG9XZWIuY29uZmlnLmVuYWJsZUJhdGNoQ2hhbmdlcykge1xyXG5cdFx0XHRcdFx0XHRjb250ZXh0LnNlcnZlci5iYXRjaENoYW5nZXMoJGZvcm1hdChcImFkYXB0ZXI6IHswfS57MX1cIiwgdGFyZ2V0VHlwZSwgdGhpcy5fcHJvcGVydHlQYXRoKSwgZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0XHRcdHByb3AudmFsdWUodGFyZ2V0LCB2YWx1ZSk7XHJcblx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdHByb3AudmFsdWUodGFyZ2V0LCB2YWx1ZSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGZpbmFsbHkge1xyXG5cdFx0XHRcdFx0dGhpcy5fc2V0dGluZ1Jhd1ZhbHVlID0gZmFsc2U7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0Z2V0X3N5c3RlbVZhbHVlOiBmdW5jdGlvbiBBZGFwdGVyJGdldF9zeXN0ZW1WYWx1ZSgpIHtcclxuXHRcdFx0dmFyIHJhd1ZhbHVlID0gdGhpcy5nZXRfcmF3VmFsdWUoKTtcclxuXHRcdFx0aWYgKHRoaXMuZ2V0X2lzRW50aXR5KCkpIHtcclxuXHRcdFx0XHRyZXR1cm4gcmF3VmFsdWUgPyBFbnRpdHkudG9JZFN0cmluZyhyYXdWYWx1ZSkgOiBcIlwiO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKHRoaXMuaXNUeXBlKEJvb2xlYW4pKSB7XHJcblx0XHRcdFx0aWYgKHJhd1ZhbHVlID09PSB0cnVlKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gXCJ0cnVlXCI7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2UgaWYgKHJhd1ZhbHVlID09PSBmYWxzZSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIFwiZmFsc2VcIjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gXCJcIjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAodGhpcy5pc1R5cGUoU3RyaW5nKSkge1xyXG5cdFx0XHRcdHJldHVybiByYXdWYWx1ZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRsb2dXYXJuaW5nKFwiUG9zc2libGUgaW5jb3JyZWN0IHVzYWdlIG9mIHN5c3RlbVZhbHVlIGZvciBhIHR5cGUgdGhhdCBpcyBub3Qgc3VwcG9ydGVkXCIpO1xyXG5cdFx0XHRcdHJldHVybiByYXdWYWx1ZSA/IHJhd1ZhbHVlLnRvU3RyaW5nKCkgOiBcIlwiO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0c2V0X3N5c3RlbVZhbHVlOiBmdW5jdGlvbiBBZGFwdGVyJHNldF9zeXN0ZW1WYWx1ZSh2YWx1ZSkge1xyXG5cdFx0XHRpZiAodGhpcy5nZXRfaXNFbnRpdHkoKSkge1xyXG5cclxuXHRcdFx0XHQvLyBzZXQgdG8gbnVsbFxyXG5cdFx0XHRcdGlmICghdmFsdWUpIHtcclxuXHRcdFx0XHRcdHRoaXMuX3NldFZhbHVlKG51bGwpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHZhciBlbnRpdHkgPSBFbnRpdHkuZnJvbUlkU3RyaW5nKHZhbHVlKTtcclxuXHJcblx0XHRcdFx0XHQvLyBsYXp5IGxvYWQgaWYgbmVjZXNzYXJ5XHJcblx0XHRcdFx0XHRpZiAoTGF6eUxvYWRlci5pc1JlZ2lzdGVyZWQoZW50aXR5KSkge1xyXG5cdFx0XHRcdFx0XHQvLyBMb2FkIHRoZSBlbnRpdHkgKGluIHNjb3BlKSBiZWZvcmUgc2V0dGluZyB0aGUgdmFsdWUuXHJcblx0XHRcdFx0XHRcdExhenlMb2FkZXIubG9hZChlbnRpdHksIG51bGwsIHRydWUsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0XHR0aGlzLl9zZXRWYWx1ZShlbnRpdHkpO1xyXG5cdFx0XHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdC8vIHNldCBpbW1lZGlhdGVseSBpZiBsb2FkZWRcclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHR0aGlzLl9zZXRWYWx1ZShlbnRpdHkpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh0aGlzLmlzVHlwZShCb29sZWFuKSkge1xyXG5cdFx0XHRcdGlmICh2YWx1ZSA9PT0gXCJ0cnVlXCIpIHtcclxuXHRcdFx0XHRcdHRoaXMuX3NldFZhbHVlKHRydWUpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmICh2YWx1ZSA9PT0gXCJmYWxzZVwiKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9zZXRWYWx1ZShmYWxzZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0dGhpcy5fc2V0VmFsdWUobnVsbCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKHRoaXMuaXNUeXBlKFN0cmluZykpIHtcclxuXHRcdFx0XHRpZiAoIXZhbHVlKSBcclxuXHRcdFx0XHRcdHRoaXMuX3NldFZhbHVlKG51bGwpO1xyXG5cdFx0XHRcdGVsc2VcclxuXHRcdFx0XHRcdHRoaXMuX3NldFZhbHVlKHZhbHVlKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2V0IHN5c3RlbVZhbHVlIHByb3BlcnR5IG9mIEFkYXB0ZXJzIGZvciBub24tZW50aXR5IHR5cGVzLlwiKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdGdldF9kaXNwbGF5VmFsdWU6IGZ1bmN0aW9uIEFkYXB0ZXIkZ2V0X2Rpc3BsYXlWYWx1ZSgpIHtcclxuXHRcdFx0dmFyIGRpc3BsYXlWYWx1ZTtcclxuXHRcdFx0dmFyIHJhd1ZhbHVlID0gdGhpcy5nZXRfcmF3VmFsdWUoKTtcclxuXHJcblx0XHRcdGlmICh0aGlzLl9mb3JtYXQpIHtcclxuXHRcdFx0XHQvLyBVc2UgYSBtYXJrdXAgb3IgcHJvcGVydHkgZm9ybWF0IGlmIGF2YWlsYWJsZVxyXG5cdFx0XHRcdGlmIChyYXdWYWx1ZSBpbnN0YW5jZW9mIEFycmF5KSB7XHJcblx0XHRcdFx0XHRkaXNwbGF5VmFsdWUgPSByYXdWYWx1ZS5tYXAoZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB0aGlzLl9mb3JtYXQuY29udmVydCh2YWx1ZSk7IH0sIHRoaXMpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdGRpc3BsYXlWYWx1ZSA9IHRoaXMuX2Zvcm1hdC5jb252ZXJ0KHJhd1ZhbHVlKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAocmF3VmFsdWUgaW5zdGFuY2VvZiBBcnJheSkge1xyXG5cdFx0XHRcdC8vIElmIG5vIGZvcm1hdCBleGlzdHMsIHRoZW4gZmFsbCBiYWNrIHRvIHRvU3RyaW5nXHJcblx0XHRcdFx0ZGlzcGxheVZhbHVlID0gcmF3VmFsdWUubWFwKGZ1bmN0aW9uICh2YWx1ZSkge1xyXG5cdFx0XHRcdFx0aWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIFwiXCI7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlLnRvU3RyaW5nKCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAocmF3VmFsdWUgPT09IG51bGwgfHwgcmF3VmFsdWUgPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdGRpc3BsYXlWYWx1ZSA9IFwiXCI7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0ZGlzcGxheVZhbHVlID0gcmF3VmFsdWUudG9TdHJpbmcoKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIGRpc3BsYXlWYWx1ZSBpbnN0YW5jZW9mIEFycmF5ID8gZGlzcGxheVZhbHVlLmpvaW4oXCIsIFwiKSA6IGRpc3BsYXlWYWx1ZTtcclxuXHRcdH0sXHJcblx0XHRzZXRfZGlzcGxheVZhbHVlOiBmdW5jdGlvbiBBZGFwdGVyJHNldF9kaXNwbGF5VmFsdWUodmFsdWUpIHtcclxuXHRcdFx0aWYgKHRoaXMuZ2V0X2lzRW50aXR5KCkpIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2V0IGRpc3BsYXlWYWx1ZSBwcm9wZXJ0eSBvZiBBZGFwdGVycyBmb3IgZW50aXR5IHR5cGVzLlwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh0aGlzLmdldF9pc0xpc3QoKSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBzZXQgZGlzcGxheVZhbHVlIHByb3BlcnR5IG9mIEFkYXB0ZXJzIGZvciBsaXN0IHR5cGVzLlwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR2YXIgaW5pdGlhbFZhbHVlID0gdmFsdWU7XHJcblx0XHRcdFx0dmFsdWUgPSB0aGlzLl9mb3JtYXQgPyB0aGlzLl9mb3JtYXQuY29udmVydEJhY2sodmFsdWUpIDogdmFsdWU7XHJcblx0XHRcdFx0dGhpcy5fc2V0VmFsdWUodmFsdWUpO1xyXG5cdFx0XHRcdGlmIChFeG9XZWIuY29uZmlnLmF1dG9SZWZvcm1hdCAmJiAhKHZhbHVlIGluc3RhbmNlb2YgRXhvV2ViLk1vZGVsLkZvcm1hdEVycm9yKSkge1xyXG5cdFx0XHRcdFx0dmFyIG5ld1ZhbHVlID0gdGhpcy5nZXRfZGlzcGxheVZhbHVlKCk7XHJcblx0XHRcdFx0XHRpZiAoaW5pdGlhbFZhbHVlICE9IG5ld1ZhbHVlKSB7XHJcblx0XHRcdFx0XHRcdHZhciBhZGFwdGVyID0gdGhpcztcclxuXHRcdFx0XHRcdFx0d2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBPYnNlcnZlci5yYWlzZVByb3BlcnR5Q2hhbmdlZChhZGFwdGVyLCBcImRpc3BsYXlWYWx1ZVwiKTsgfSwgMSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cclxuXHRcdGRpc3Bvc2U6IGZ1bmN0aW9uIEFkYXB0ZXIkZGlzcG9zZSgpIHtcclxuXHRcdFx0dmFyIGRpc3Bvc2VkID0gdGhpcy5fZGlzcG9zZWQsIG9wdGlvbnMgPSBudWxsO1xyXG5cclxuXHRcdFx0aWYgKCFkaXNwb3NlZCkge1xyXG5cdFx0XHRcdHRoaXMuX2Rpc3Bvc2VkID0gdHJ1ZTtcclxuXHRcdFx0XHRkaXNwb3NlT3B0aW9ucy5jYWxsKHRoaXMpO1xyXG5cdFx0XHRcdG9wdGlvbnMgPSB0aGlzLl9vcHRpb25zO1xyXG5cdFx0XHRcdGlmICh0aGlzLl9leHRlbmRlZFByb3BlcnRpZXMpIHtcclxuXHRcdFx0XHRcdHZhciBleHQgPSB0aGlzLl9leHRlbmRlZFByb3BlcnRpZXM7XHJcblx0XHRcdFx0XHRmb3IgKHZhciBpID0gMCwgbCA9IGV4dC5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuXHRcdFx0XHRcdFx0dGhpc1tcIl9cIiArIGV4dFtpXV0gPSBudWxsO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0dGhpcy5fZXh0ZW5kZWRQcm9wZXJ0aWVzID0gbnVsbDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKHRoaXMuX3RhcmdldENoYW5nZWRIYW5kbGVyKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9wcm9wZXJ0eUNoYWluLnJlbW92ZUNoYW5nZWQodGhpcy5fdGFyZ2V0Q2hhbmdlZEhhbmRsZXIpO1xyXG5cdFx0XHRcdFx0dGhpcy5fdGFyZ2V0Q2hhbmdlZEhhbmRsZXIgPSBudWxsO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHR0aGlzLl91bnN1YnNjcmliZUZyb21Gb3JtYXRDaGFuZ2VzKHRoaXMuZ2V0X3Jhd1ZhbHVlKCkpO1xyXG5cdFx0XHRcdC8vIENsZWFuIHVwIHZhbGlkYXRpb24gZXZlbnQgaGFuZGxlcnNcclxuXHRcdFx0XHR2YXIgbGFzdFRhcmdldCA9IHRoaXMuX3Byb3BlcnR5Q2hhaW4ubGFzdFRhcmdldCh0aGlzLl90YXJnZXQpO1xyXG5cdFx0XHRcdGlmIChsYXN0VGFyZ2V0KSB7XHJcblx0XHRcdFx0XHRpZiAodGhpcy5fY29uZGl0aW9uc0NoYW5nZWRIYW5kbGVyKSB7XHJcblx0XHRcdFx0XHRcdGxhc3RUYXJnZXQubWV0YS5yZW1vdmVDb25kaXRpb25zQ2hhbmdlZCh0aGlzLl9jb25kaXRpb25zQ2hhbmdlZEhhbmRsZXIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHR0aGlzLl9hbGxvd2VkVmFsdWVzID0gdGhpcy5fYWxsb3dlZFZhbHVlc01heUJlTnVsbCA9IHRoaXMuX2FzcGVjdHMgPVxyXG5cdFx0XHRcdFx0dGhpcy5fZm9ybWF0ID0gdGhpcy5fZm9ybWF0U3Vic2NyaWJlcnMgPSB0aGlzLl9oZWxwdGV4dCA9IHRoaXMuX2pzdHlwZSA9IHRoaXMuX3NldHRpbmdSYXdWYWx1ZSA9IHRoaXMuX2xhYmVsID1cclxuXHRcdFx0XHRcdHRoaXMuX29ic2VydmFibGUgPSB0aGlzLl9vcHRpb25zID0gdGhpcy5fYWxsb3dlZFZhbHVlc1RyYW5zZm9ybSA9IHRoaXMuX3BhcmVudEFkYXB0ZXIgPSB0aGlzLl9wcm9wZXJ0eUNoYWluID1cclxuXHRcdFx0XHRcdHRoaXMuX3Byb3BlcnR5UGF0aCA9IHRoaXMuX3JlYWR5U2lnbmFsID0gdGhpcy5fdGFyZ2V0ID0gbnVsbDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0QWRhcHRlci5jYWxsQmFzZU1ldGhvZCh0aGlzLCBcImRpc3Bvc2VcIik7XHJcblxyXG5cdFx0XHRpZiAoIWRpc3Bvc2VkKSB7XHJcblx0XHRcdFx0T2JzZXJ2ZXIuZGlzcG9zZU9ic2VydmFibGUodGhpcyk7XHJcblx0XHRcdFx0aWYgKG9wdGlvbnMpIHtcclxuXHRcdFx0XHRcdG9wdGlvbnMuZm9yRWFjaChPYnNlcnZlci5kaXNwb3NlT2JzZXJ2YWJsZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vICNyZWdpb24gQ29uZGl0aW9uc1xyXG5cclxuXHRmdW5jdGlvbiBjb25kaXRpb25zQ2hhbmdlZEhhbmRsZXIoY29uZGl0aW9ucywgc2VuZGVyLCBhcmdzKSB7XHJcblx0XHRpZiAoYXJncy5hZGQpIHtcclxuXHRcdFx0Y29uZGl0aW9ucy5hZGQoYXJncy5jb25kaXRpb25UYXJnZXQuY29uZGl0aW9uKTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKGFyZ3MucmVtb3ZlKSB7XHJcblx0XHRcdGNvbmRpdGlvbnMucmVtb3ZlKGFyZ3MuY29uZGl0aW9uVGFyZ2V0LmNvbmRpdGlvbik7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBnZXRGaXJzdEVycm9yKGNvbmRpdGlvbnMsIGluY2x1ZGVXYXJuaW5ncykge1xyXG5cdFx0dmFyIGZpcnN0RXJyb3IgPSBudWxsO1xyXG5cdFx0Zm9yICh2YXIgYyA9IDA7IGMgPCBjb25kaXRpb25zLmxlbmd0aDsgYysrKSB7XHJcblx0XHRcdHZhciBjb25kaXRpb24gPSBjb25kaXRpb25zW2NdO1xyXG5cdFx0XHRpZiAoY29uZGl0aW9uLnR5cGUgaW5zdGFuY2VvZiBDb25kaXRpb25UeXBlLkVycm9yIHx8IChpbmNsdWRlV2FybmluZ3MgPT09IHRydWUgJiYgY29uZGl0aW9uLnR5cGUgaW5zdGFuY2VvZiBDb25kaXRpb25UeXBlLldhcm5pbmcpKSB7XHJcblx0XHRcdFx0aWYgKGZpcnN0RXJyb3IgPT09IG51bGwgfHwgL0Zvcm1hdEVycm9yL2kudGVzdChjb25kaXRpb24udHlwZS5jb2RlKSkge1xyXG5cdFx0XHRcdFx0Zmlyc3RFcnJvciA9IGNvbmRpdGlvbjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Ly8gRW5zdXJlcyBhIGZvcm1hdCBlcnJvciB0YWtlcyBwcmVjZWRlbmNlIG92ZXIgYSByZXF1aXJlZCBmaWVsZCBlcnJvclxyXG5cdFx0XHRcdGVsc2UgaWYgKCEvRm9ybWF0RXJyb3IvaS50ZXN0KGZpcnN0RXJyb3IudHlwZS5jb2RlKSAmJiAvUmVxdWlyZWQvaS50ZXN0KGNvbmRpdGlvbi50eXBlLmNvZGUpKVxyXG5cdFx0XHRcdHtcclxuXHRcdFx0XHRcdGZpcnN0RXJyb3IgPSBjb25kaXRpb247XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gZmlyc3RFcnJvcjtcclxuXHR9XHJcblxyXG5cdEFkYXB0ZXIubWl4aW4oe1xyXG5cdFx0Z2V0X2NvbmRpdGlvbnM6IGZ1bmN0aW9uIEFkYXB0ZXIkZ2V0X2NvbmRpdGlvbnMoKSB7XHJcblxyXG5cdFx0XHQvLyBpbml0aWFsaXplIHRoZSBjb25kaXRpb25zIGlmIG5lY2Vzc2FyeVxyXG5cdFx0XHRpZiAoIXRoaXMuX2NvbmRpdGlvbnMpIHtcclxuXHJcblx0XHRcdFx0Ly8gZ2V0IHRoZSBjdXJyZW50IHRhcmdldFxyXG5cdFx0XHRcdHZhciB0YXJnZXQgPSB0aGlzLmdldF9wcm9wZXJ0eUNoYWluKCkubGFzdFRhcmdldCh0aGlzLl90YXJnZXQpO1xyXG5cclxuXHRcdFx0XHQvLyBnZXQgdGhlIGN1cnJlbnQgc2V0IG9mIGNvbmRpdGlvbnNcclxuXHRcdFx0XHR2YXIgY29uZGl0aW9ucyA9IHRoaXMuX2NvbmRpdGlvbnMgPSB0YXJnZXQgPyB0YXJnZXQubWV0YS5jb25kaXRpb25zKHRoaXMuZ2V0X3Byb3BlcnR5Q2hhaW4oKS5sYXN0UHJvcGVydHkoKSkgOiBbXTtcclxuXHJcblx0XHRcdFx0Ly8gbWFrZSB0aGUgY29uZGl0aW9ucyBvYnNlcnZhYmxlXHJcblx0XHRcdFx0T2JzZXJ2ZXIubWFrZU9ic2VydmFibGUodGhpcy5fY29uZGl0aW9ucyk7XHJcblxyXG5cdFx0XHRcdC8vIHN1YnNjcmliZSB0byBjb25kaXRpb24gY2hhbmdlcyBvbiB0aGUgY3VycmVudCB0YXJnZXRcclxuXHRcdFx0XHRpZiAodGFyZ2V0KSB7XHJcblx0XHRcdFx0XHR2YXIgaGFuZGxlciA9IHRoaXMuX2NvbmRpdGlvbnNDaGFuZ2VkSGFuZGxlciA9IGNvbmRpdGlvbnNDaGFuZ2VkSGFuZGxlci5wcmVwZW5kQXJndW1lbnRzKGNvbmRpdGlvbnMpO1xyXG5cdFx0XHRcdFx0dGFyZ2V0Lm1ldGEuYWRkQ29uZGl0aW9uc0NoYW5nZWQoaGFuZGxlciwgdGhpcy5nZXRfcHJvcGVydHlDaGFpbigpKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHRoaXMuX2NvbmRpdGlvbnM7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X2ZpcnN0RXJyb3JPcldhcm5pbmc6IGZ1bmN0aW9uIEFkYXB0ZXIkZ2V0X2ZpcnN0RXJyb3JPcldhcm5pbmcoKSB7XHJcblx0XHRcdC8vIGdldHMgdGhlIGZpcnN0IGVycm9yIG9yIHdhcm5pbmcgaW4gYSBzZXQgb2YgY29uZGl0aW9ucywgYWx3YXlzIHJldHVybmluZyBmb3JtYXQgZXJyb3JzIGZpcnN0IGZvbGxvd2VkIGJ5IHJlcXVpcmVkIGZpZWxkIGVycm9ycywgYW5kIG51bGwgaWYgbm8gZXJyb3JzIGV4aXN0XHJcblx0XHRcdC8vIGluaXRpYWxpemUgb24gZmlyc3QgYWNjZXNzXHJcblx0XHRcdGlmICghdGhpcy5oYXNPd25Qcm9wZXJ0eShcIl9maXJzdEVycm9yT3JXYXJuaW5nXCIpKSB7XHJcblxyXG5cdFx0XHRcdHZhciBjb25kaXRpb25zID0gdGhpcy5nZXRfY29uZGl0aW9ucygpO1xyXG5cdFx0XHRcdHRoaXMuX2ZpcnN0RXJyb3JPcldhcm5pbmcgPSBnZXRGaXJzdEVycm9yKGNvbmRpdGlvbnMsIHRydWUpO1xyXG5cclxuXHRcdFx0XHQvLyBhdXRvbWF0aWNhbGx5IHVwZGF0ZSB3aGVuIGNvbmRpdGlvbiBjaGFuZ2VzIG9jY3VyXHJcblx0XHRcdFx0dmFyIGFkYXB0ZXIgPSB0aGlzO1xyXG5cdFx0XHRcdGNvbmRpdGlvbnMuYWRkX2NvbGxlY3Rpb25DaGFuZ2VkKGZ1bmN0aW9uIChzZW5kZXIsIGFyZ3MpIHtcclxuXHJcblx0XHRcdFx0XHR2YXIgZXJyID0gZ2V0Rmlyc3RFcnJvcihjb25kaXRpb25zLCB0cnVlKTtcclxuXHJcblx0XHRcdFx0XHQvLyBzdG9yZSB0aGUgZmlyc3QgZXJyb3IgYW5kIHJhaXNlIHByb3BlcnR5IGNoYW5nZSBpZiBpdCBkaWZmZXJzIGZyb20gdGhlIHByZXZpb3VzIGZpcnN0IGVycm9yXHJcblx0XHRcdFx0XHRpZiAoYWRhcHRlci5fZmlyc3RFcnJvck9yV2FybmluZyAhPT0gZXJyKSB7XHJcblx0XHRcdFx0XHRcdGFkYXB0ZXIuX2ZpcnN0RXJyb3JPcldhcm5pbmcgPSBlcnI7XHJcblx0XHRcdFx0XHRcdE9ic2VydmVyLnJhaXNlUHJvcGVydHlDaGFuZ2VkKGFkYXB0ZXIsIFwiZmlyc3RFcnJvck9yV2FybmluZ1wiKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gcmV0dXJuIHRoZSBmaXJzdCBlcnJvclxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fZmlyc3RFcnJvck9yV2FybmluZztcclxuXHRcdH0sXHJcblx0XHRnZXRfZmlyc3RFcnJvcjogZnVuY3Rpb24gQWRhcHRlciRnZXRfZmlyc3RFcnJvcigpIHtcclxuXHRcdFx0Ly8gZ2V0cyB0aGUgZmlyc3QgZXJyb3IgaW4gYSBzZXQgb2YgY29uZGl0aW9ucywgYWx3YXlzIHJldHVybmluZyBmb3JtYXQgZXJyb3JzIGZpcnN0IGZvbGxvd2VkIGJ5IHJlcXVpcmVkIGZpZWxkIGVycm9ycywgYW5kIG51bGwgaWYgbm8gZXJyb3JzIGV4aXN0XHJcblx0XHRcdC8vIGluaXRpYWxpemUgb24gZmlyc3QgYWNjZXNzXHJcblx0XHRcdGlmICghdGhpcy5oYXNPd25Qcm9wZXJ0eShcIl9maXJzdEVycm9yXCIpKSB7XHJcblxyXG5cdFx0XHRcdHZhciBjb25kaXRpb25zID0gdGhpcy5nZXRfY29uZGl0aW9ucygpO1xyXG5cdFx0XHRcdHRoaXMuX2ZpcnN0RXJyb3IgPSBnZXRGaXJzdEVycm9yKGNvbmRpdGlvbnMpO1xyXG5cclxuXHRcdFx0XHQvLyBhdXRvbWF0aWNhbGx5IHVwZGF0ZSB3aGVuIGNvbmRpdGlvbiBjaGFuZ2VzIG9jY3VyXHJcblx0XHRcdFx0dmFyIGFkYXB0ZXIgPSB0aGlzO1xyXG5cdFx0XHRcdGNvbmRpdGlvbnMuYWRkX2NvbGxlY3Rpb25DaGFuZ2VkKGZ1bmN0aW9uIChzZW5kZXIsIGFyZ3MpIHtcclxuXHJcblx0XHRcdFx0XHR2YXIgZXJyID0gZ2V0Rmlyc3RFcnJvcihjb25kaXRpb25zKTtcclxuXHJcblx0XHRcdFx0XHQvLyBzdG9yZSB0aGUgZmlyc3QgZXJyb3IgYW5kIHJhaXNlIHByb3BlcnR5IGNoYW5nZSBpZiBpdCBkaWZmZXJzIGZyb20gdGhlIHByZXZpb3VzIGZpcnN0IGVycm9yXHJcblx0XHRcdFx0XHRpZiAoYWRhcHRlci5fZmlyc3RFcnJvciAhPT0gZXJyKSB7XHJcblx0XHRcdFx0XHRcdGFkYXB0ZXIuX2ZpcnN0RXJyb3IgPSBlcnI7XHJcblx0XHRcdFx0XHRcdE9ic2VydmVyLnJhaXNlUHJvcGVydHlDaGFuZ2VkKGFkYXB0ZXIsIFwiZmlyc3RFcnJvclwiKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gcmV0dXJuIHRoZSBmaXJzdCBlcnJvclxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fZmlyc3RFcnJvcjtcclxuXHRcdH0sXHJcblx0XHRnZXRfaGFzRXJyb3I6IGZ1bmN0aW9uIEFkYXB0ZXIkZ2V0X2hhc0Vycm9yKCkge1xyXG5cdFx0XHQvLyBpbml0aWFsaXplIG9uIGZpcnN0IGFjY2Vzc1xyXG5cdFx0XHRpZiAoIXRoaXMuaGFzT3duUHJvcGVydHkoXCJfaGFzRXJyb3JcIikpIHtcclxuXHJcblx0XHRcdFx0dmFyIGNvbmRpdGlvbnMgPSB0aGlzLmdldF9jb25kaXRpb25zKCk7XHJcblx0XHRcdFx0dGhpcy5faGFzRXJyb3IgPSAhIXRoaXMuZ2V0X2ZpcnN0RXJyb3IoKTtcclxuXHJcblx0XHRcdFx0Ly8gYXV0b21hdGljYWxseSB1cGRhdGUgd2hlbiBjb25kaXRpb24gY2hhbmdlcyBvY2N1clxyXG5cdFx0XHRcdHZhciBhZGFwdGVyID0gdGhpcztcclxuXHRcdFx0XHRjb25kaXRpb25zLmFkZF9jb2xsZWN0aW9uQ2hhbmdlZChmdW5jdGlvbiAoc2VuZGVyLCBhcmdzKSB7XHJcblxyXG5cdFx0XHRcdFx0dmFyIHZhbCA9ICEhYWRhcHRlci5nZXRfZmlyc3RFcnJvcigpO1xyXG5cclxuXHRcdFx0XHRcdC8vIHN0b3JlIHRoZSBmaXJzdCBlcnJvciBhbmQgcmFpc2UgcHJvcGVydHkgY2hhbmdlIGlmIGl0IGRpZmZlcnMgZnJvbSB0aGUgcHJldmlvdXMgZmlyc3QgZXJyb3JcclxuXHRcdFx0XHRcdGlmIChhZGFwdGVyLl9oYXNFcnJvciAhPT0gdmFsKSB7XHJcblx0XHRcdFx0XHRcdGFkYXB0ZXIuX2hhc0Vycm9yID0gdmFsO1xyXG5cdFx0XHRcdFx0XHRPYnNlcnZlci5yYWlzZVByb3BlcnR5Q2hhbmdlZChhZGFwdGVyLCBcImhhc0Vycm9yXCIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZXR1cm4gdGhpcy5faGFzRXJyb3I7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBPcHRpb25zXHJcblxyXG5cdGZ1bmN0aW9uIGRpc3Bvc2VPcHRpb25zKCkge1xyXG5cdFx0dmFyIGxhc3RQcm9wZXJ0eSA9IHRoaXMuX3Byb3BlcnR5Q2hhaW4ubGFzdFByb3BlcnR5KCk7XHJcblx0XHR2YXIgYWxsb3dlZFZhbHVlc1J1bGUgPSBsYXN0UHJvcGVydHkucnVsZShFeG9XZWIuTW9kZWwuUnVsZS5hbGxvd2VkVmFsdWVzKTtcclxuXHRcdGlmICh0aGlzLl9hbGxvd2VkVmFsdWVzQ2hhbmdlZEhhbmRsZXIpIHtcclxuXHRcdFx0YWxsb3dlZFZhbHVlc1J1bGUucmVtb3ZlQ2hhbmdlZCh0aGlzLl9hbGxvd2VkVmFsdWVzQ2hhbmdlZEhhbmRsZXIpO1xyXG5cdFx0XHR0aGlzLl9hbGxvd2VkVmFsdWVzQ2hhbmdlZEhhbmRsZXIgPSBudWxsO1xyXG5cdFx0fVxyXG5cdFx0aWYgKCB0aGlzLl9hbGxvd2VkVmFsdWVzUnVsZUV4aXN0c0hhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fcHJvcGVydHlDaGFpbi5sYXN0UHJvcGVydHkoKS5yZW1vdmVSdWxlUmVnaXN0ZXJlZCh0aGlzLl9hbGxvd2VkVmFsdWVzUnVsZUV4aXN0c0hhbmRsZXIpO1xyXG5cdFx0XHR0aGlzLl9hbGxvd2VkVmFsdWVzUnVsZUV4aXN0c0hhbmRsZXIgPSBudWxsO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHRoaXMuX2FsbG93ZWRWYWx1ZXNFeGlzdEhhbmRsZXIpIHtcclxuXHRcdFx0YWxsb3dlZFZhbHVlc1J1bGUucmVtb3ZlQ2hhbmdlZCh0aGlzLl9hbGxvd2VkVmFsdWVzRXhpc3RIYW5kbGVyKTtcclxuXHRcdFx0dGhpcy5fYWxsb3dlZFZhbHVlc0V4aXN0SGFuZGxlciA9IG51bGw7XHJcblx0XHR9XHJcblx0XHR0aGlzLl9vcHRpb25zID0gbnVsbDtcclxuXHR9XHJcblxyXG5cdC8vIENyZWF0ZSBhbiBvcHRpb24gYWRhcHRlciBmcm9tIHRoZSBnaXZlbiBvYmplY3RcclxuXHRmdW5jdGlvbiBjcmVhdGVPcHRpb25BZGFwdGVyKGl0ZW0pIHtcclxuXHRcdC8vIElmIGl0IGlzIGEgdHJhbnNmb3JtIGdyb3VwIHRoZW4gY3JlYXRlIGFuIG9wdGlvbiBncm91cFxyXG5cdFx0aWYgKGl0ZW0gaW5zdGFuY2VvZiBUcmFuc2Zvcm1Hcm91cCkge1xyXG5cdFx0XHRyZXR1cm4gbmV3IE9wdGlvbkdyb3VwQWRhcHRlcih0aGlzLCBpdGVtLmdyb3VwLCBpdGVtLml0ZW1zKTtcclxuXHRcdH1cclxuXHRcdC8vIE90aGVyd2lzZSxjcmVhdGUgYSBzaW5nbGUgb3B0aW9uXHJcblx0XHRlbHNlIHtcclxuXHRcdFx0cmV0dXJuIG5ldyBPcHRpb25BZGFwdGVyKHRoaXMsIGl0ZW0pO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Ly8gTm90aWZ5IHN1YnNjcmliZXJzIHRoYXQgb3B0aW9ucyBhcmUgYXZhaWxhYmxlXHJcblx0ZnVuY3Rpb24gc2lnbmFsT3B0aW9uc1JlYWR5KCkge1xyXG5cdFx0aWYgKHRoaXMuX2Rpc3Bvc2VkKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBEZWxldGUgYmFja2luZyBmaWVsZHMgc28gdGhhdCBvcHRpb25zIGNhbiBiZSByZWNhbGN1bGF0ZWQgKGFuZCBsb2FkZWQpXHJcblx0XHRkZWxldGUgdGhpcy5fb3B0aW9ucztcclxuXHJcblx0XHQvLyBSYWlzZSBldmVudHMgaW4gb3JkZXIgdG8gY2F1c2Ugc3Vic2NyaWJlcnMgdG8gZmV0Y2ggdGhlIG5ldyB2YWx1ZVxyXG5cdFx0RXhvV2ViLk9ic2VydmVyLnJhaXNlUHJvcGVydHlDaGFuZ2VkKHRoaXMsIFwib3B0aW9uc1wiKTtcclxuXHR9XHJcblxyXG5cdC8vIElmIHRoZSBnaXZlbiBydWxlIGlzIGFsbG93ZWQgdmFsdWVzLCBzaWduYWwgb3B0aW9ucyByZWFkeVxyXG5cdGZ1bmN0aW9uIGNoZWNrQWxsb3dlZFZhbHVlc1J1bGVFeGlzdHMocnVsZSkge1xyXG5cdFx0aWYgKHJ1bGUgaW5zdGFuY2VvZiBSdWxlLmFsbG93ZWRWYWx1ZXMpIHtcclxuXHRcdFx0dGhpcy5fcHJvcGVydHlDaGFpbi5sYXN0UHJvcGVydHkoKS5yZW1vdmVSdWxlUmVnaXN0ZXJlZCh0aGlzLl9hbGxvd2VkVmFsdWVzUnVsZUV4aXN0c0hhbmRsZXIpO1xyXG5cdFx0XHRzaWduYWxPcHRpb25zUmVhZHkuY2FsbCh0aGlzKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGNoZWNrQWxsb3dlZFZhbHVlc0V4aXN0KCkge1xyXG5cdFx0dmFyIGxhc3RQcm9wZXJ0eSA9IHRoaXMuX3Byb3BlcnR5Q2hhaW4ubGFzdFByb3BlcnR5KCk7XHJcblx0XHR2YXIgYWxsb3dlZFZhbHVlc1J1bGUgPSBsYXN0UHJvcGVydHkucnVsZShFeG9XZWIuTW9kZWwuUnVsZS5hbGxvd2VkVmFsdWVzKTtcclxuXHRcdHZhciB0YXJnZXRPYmogPSB0aGlzLl9wcm9wZXJ0eUNoYWluLmxhc3RUYXJnZXQodGhpcy5fdGFyZ2V0KTtcclxuXHRcdHZhciBhbGxvd2VkVmFsdWVzID0gYWxsb3dlZFZhbHVlc1J1bGUudmFsdWVzKHRhcmdldE9iaiwgISF0aGlzLl9hbGxvd2VkVmFsdWVzTWF5QmVOdWxsKTtcclxuXHJcblx0XHRpZiAoYWxsb3dlZFZhbHVlcyBpbnN0YW5jZW9mIEFycmF5KSB7XHJcblx0XHRcdGFsbG93ZWRWYWx1ZXNSdWxlLnJlbW92ZUNoYW5nZWQodGhpcy5fYWxsb3dlZFZhbHVlc0V4aXN0SGFuZGxlcik7XHJcblx0XHRcdGRlbGV0ZSB0aGlzLl9hbGxvd2VkVmFsdWVzRXhpc3RIYW5kbGVyO1xyXG5cdFx0XHRzaWduYWxPcHRpb25zUmVhZHkuY2FsbCh0aGlzKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8vIFVwZGF0ZSB0aGUgZ2l2ZW4gb3B0aW9ucyBzb3VyY2UgYXJyYXkgdG8gbWF0Y2ggdGhlIGN1cnJlbnQgYWxsb3dlZCB2YWx1ZXNcclxuXHRmdW5jdGlvbiByZWZyZXNoT3B0aW9uc0Zyb21BbGxvd2VkVmFsdWVzKG9wdGlvbnNTb3VyY2VBcnJheSkge1xyXG5cdFx0dmFyIGxhc3RQcm9wZXJ0eSA9IHRoaXMuX3Byb3BlcnR5Q2hhaW4ubGFzdFByb3BlcnR5KCk7XHJcblx0XHR2YXIgYWxsb3dlZFZhbHVlc1J1bGUgPSBsYXN0UHJvcGVydHkucnVsZShFeG9XZWIuTW9kZWwuUnVsZS5hbGxvd2VkVmFsdWVzKTtcclxuXHRcdHZhciB0YXJnZXRPYmogPSB0aGlzLl9wcm9wZXJ0eUNoYWluLmxhc3RUYXJnZXQodGhpcy5fdGFyZ2V0KTtcclxuXHRcdHZhciBhbGxvd2VkVmFsdWVzID0gYWxsb3dlZFZhbHVlc1J1bGUudmFsdWVzKHRhcmdldE9iaiwgISF0aGlzLl9hbGxvd2VkVmFsdWVzTWF5QmVOdWxsKTtcclxuXHRcdGlmIChhbGxvd2VkVmFsdWVzKSB7XHJcblx0XHRcdG9wdGlvbnNTb3VyY2VBcnJheS5iZWdpblVwZGF0ZSgpO1xyXG5cdFx0XHR1cGRhdGUob3B0aW9uc1NvdXJjZUFycmF5LCBhbGxvd2VkVmFsdWVzKTtcclxuXHRcdFx0b3B0aW9uc1NvdXJjZUFycmF5LmVuZFVwZGF0ZSgpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHNpZ25hbE9wdGlvbnNSZWFkeS5jYWxsKHRoaXMpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Ly8gUGVyZm9ybSBhbnkgcmVxdWlyZWQgbG9hZGluZyBvZiBhbGxvd2VkIHZhbHVlcyBpdGVtc1xyXG5cdGZ1bmN0aW9uIGVuc3VyZUFsbG93ZWRWYWx1ZXNMb2FkZWQobmV3SXRlbXMsIGNhbGxiYWNrLCB0aGlzUHRyKSB7XHJcblx0XHQvLyBXYWl0IHVudGlsIHRoZSBcImJhdGNoXCIgb2Ygd29yayBpcyBjb21wbGV0ZSBiZWZvcmUgbGF6eSBsb2FkaW5nIG9wdGlvbnMuIE90aGVyd2lzZSxcclxuXHRcdC8vIHRoZSBsYXp5IGxvYWRpbmcgY291bGQgb2NjdXIgZHVyaW5nIHByb2Nlc3Npbmcgb2YgYSByZXNwb25zZSB3aGljaCBhbHJlYWR5IGNvbnRhaW5zXHJcblx0XHQvLyB0aGUgZGF0YSwgd2hpY2ggY291bGQgY2F1c2UgcGVyZm9ybWFuY2UgZGVncmVkYXRpb24gZHVlIHRvIHJlZHVuZGFudCBkYXRhIGxvYWRpbmcuXHJcblx0XHRCYXRjaC53aGVuRG9uZShmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHZhciBzaWduYWwgPSBuZXcgU2lnbmFsKFwiZW5zdXJlQWxsb3dlZFZhbHVlc0xvYWRlZFwiKTtcclxuXHRcdFx0bmV3SXRlbXMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XHJcblx0XHRcdFx0aWYgKExhenlMb2FkZXIuaXNSZWdpc3RlcmVkKGl0ZW0pKSB7XHJcblx0XHRcdFx0XHRMYXp5TG9hZGVyLmxvYWQoaXRlbSwgbnVsbCwgdHJ1ZSwgc2lnbmFsLnBlbmRpbmcoKSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdFx0c2lnbmFsLndhaXRGb3JBbGwoY2FsbGJhY2ssIHRoaXNQdHIpO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBjbGVhckludmFsaWRPcHRpb25zKGFsbG93ZWRWYWx1ZXMpIHtcclxuXHRcdHZhciByYXdWYWx1ZSA9IHRoaXMuZ2V0X3Jhd1ZhbHVlKCk7XHJcblx0XHR2YXIgaXNEYXRlUHJvcCA9IHRoaXMuaXNUeXBlKERhdGUpO1xyXG5cclxuXHRcdGZ1bmN0aW9uIGlzQWxsb3dlZFZhbHVlKHZhbHVlKSB7XHJcblx0XHRcdGlmIChpc0RhdGVQcm9wKSB7XHJcblx0XHRcdFx0cmV0dXJuIGFsbG93ZWRWYWx1ZXMuc29tZShmdW5jdGlvbiAodikge1xyXG5cdFx0XHRcdFx0cmV0dXJuIHYgaW5zdGFuY2VvZiBEYXRlICYmIHZhbHVlLnZhbHVlT2YoKSA9PT0gdi52YWx1ZU9mKCk7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiBhbGxvd2VkVmFsdWVzLmluZGV4T2YodmFsdWUpICE9PSAtMTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAocmF3VmFsdWUgIT09IG51bGwgJiYgYWxsb3dlZFZhbHVlcykge1xyXG5cdFx0XHQvLyBSZW1vdmUgb3B0aW9uIHZhbHVlcyB0aGF0IGFyZSBubyBsb25nZXIgdmFsaWRcclxuXHRcdFx0aWYgKHJhd1ZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuXHRcdFx0XHRwdXJnZShyYXdWYWx1ZSwgZnVuY3Rpb24gKGl0ZW0pIHtcclxuXHRcdFx0XHRcdHJldHVybiAhaXNBbGxvd2VkVmFsdWUoaXRlbSk7XHJcblx0XHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdH0gZWxzZSBpZiAoIWlzQWxsb3dlZFZhbHVlKHJhd1ZhbHVlKSAmJiB0aGlzLl9wcm9wZXJ0eUNoYWluLnZhbHVlKHRoaXMuX3RhcmdldCkgIT09IG51bGwpIHtcclxuXHRcdFx0XHR0aGlzLl9wcm9wZXJ0eUNoYWluLnZhbHVlKHRoaXMuX3RhcmdldCwgbnVsbCk7XHJcblx0XHRcdH1cclxuXHRcdH0gZWxzZSBpZiAocmF3VmFsdWUgaW5zdGFuY2VvZiBBcnJheSkge1xyXG5cdFx0XHRyYXdWYWx1ZS5jbGVhcigpO1xyXG5cdFx0fSBlbHNlIGlmICh0aGlzLl9wcm9wZXJ0eUNoYWluLnZhbHVlKHRoaXMuX3RhcmdldCkgIT09IG51bGwpIHtcclxuXHRcdFx0dGhpcy5fcHJvcGVydHlDaGFpbi52YWx1ZSh0aGlzLl90YXJnZXQsIG51bGwpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gYWxsb3dlZFZhbHVlc0NoYW5nZWQob3B0aW9uc1NvdXJjZUFycmF5LCBzZW5kZXIsIGFyZ3MpIHtcclxuXHRcdHZhciBsYXN0UHJvcGVydHkgPSB0aGlzLl9wcm9wZXJ0eUNoYWluLmxhc3RQcm9wZXJ0eSgpO1xyXG5cdFx0dmFyIGFsbG93ZWRWYWx1ZXNSdWxlID0gbGFzdFByb3BlcnR5LnJ1bGUoRXhvV2ViLk1vZGVsLlJ1bGUuYWxsb3dlZFZhbHVlcyk7XHJcblx0XHR2YXIgYWxsb3dlZFZhbHVlcyA9IGFsbG93ZWRWYWx1ZXNSdWxlLnZhbHVlcyh0aGlzLl9wcm9wZXJ0eUNoYWluLmxhc3RUYXJnZXQodGhpcy5fdGFyZ2V0KSwgISF0aGlzLl9hbGxvd2VkVmFsdWVzTWF5QmVOdWxsKTtcclxuXHJcblx0ICAgIC8vIENsZWFyIG91dCBpbnZhbGlkIHNlbGVjdGlvbnNcclxuXHRcdGlmICghYWxsb3dlZFZhbHVlc1J1bGUuaWdub3JlVmFsaWRhdGlvbikge1xyXG5cdFx0ICAgIGNsZWFySW52YWxpZE9wdGlvbnMuY2FsbCh0aGlzLCBhbGxvd2VkVmFsdWVzKTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBMb2FkIGFsbG93ZWQgdmFsdWUgaXRlbXMgdGhhdCB3ZXJlIGFkZGVkXHJcblx0XHRpZiAoYXJncy5jaGFuZ2VzKSB7XHJcblx0XHRcdC8vIENvbGxlY3QgYWxsIGl0ZW1zIHRoYXQgd2VyZSBhZGRlZFxyXG5cdFx0XHR2YXIgbmV3SXRlbXMgPSBbXTtcclxuXHRcdFx0YXJncy5jaGFuZ2VzLmZvckVhY2goZnVuY3Rpb24oY2hhbmdlKSB7XHJcblx0XHRcdFx0aWYgKGNoYW5nZS5uZXdJdGVtcykge1xyXG5cdFx0XHRcdFx0bmV3SXRlbXMuYWRkUmFuZ2UoY2hhbmdlLm5ld0l0ZW1zKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0XHRpZiAobmV3SXRlbXMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdGVuc3VyZUFsbG93ZWRWYWx1ZXNMb2FkZWQobmV3SXRlbXMsIHJlZnJlc2hPcHRpb25zRnJvbUFsbG93ZWRWYWx1ZXMucHJlcGVuZEFyZ3VtZW50cyhvcHRpb25zU291cmNlQXJyYXkpLCB0aGlzKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRyZWZyZXNoT3B0aW9uc0Zyb21BbGxvd2VkVmFsdWVzLmNhbGwodGhpcywgb3B0aW9uc1NvdXJjZUFycmF5KTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAoIWFyZ3Mub2xkVmFsdWUgJiYgYXJncy5uZXdWYWx1ZSkge1xyXG5cdFx0XHQvLyBJZiB0aGVyZSB3YXMgcHJldmlvdXNseSBub3QgYSB2YWx1ZSBvZiB0aGUgcGF0aCBhbmQgbm93IHRoZXJlIGlzLCB0aGVuIGFsbCBpdGVtcyBhcmUgbmV3XHJcblx0XHRcdGVuc3VyZUFsbG93ZWRWYWx1ZXNMb2FkZWQoYWxsb3dlZFZhbHVlcywgcmVmcmVzaE9wdGlvbnNGcm9tQWxsb3dlZFZhbHVlcy5wcmVwZW5kQXJndW1lbnRzKG9wdGlvbnNTb3VyY2VBcnJheSksIHRoaXMpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHJlZnJlc2hPcHRpb25zRnJvbUFsbG93ZWRWYWx1ZXMuY2FsbCh0aGlzLCBvcHRpb25zU291cmNlQXJyYXkpO1xyXG5cdFx0fVxyXG5cclxuXHR9XHJcblxyXG5cdEFkYXB0ZXIubWl4aW4oe1xyXG5cdFx0Z2V0X29wdGlvbnM6IGZ1bmN0aW9uIEFkYXB0ZXIkZ2V0X29wdGlvbnMoKSB7XHJcblx0XHRcdGlmICghdGhpcy5oYXNPd25Qcm9wZXJ0eShcIl9vcHRpb25zXCIpKSB7XHJcblx0XHRcdFx0aWYgKHRoaXMuaXNUeXBlKEJvb2xlYW4pKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9vcHRpb25zID0gW2NyZWF0ZU9wdGlvbkFkYXB0ZXIuY2FsbCh0aGlzLCB0cnVlKSwgY3JlYXRlT3B0aW9uQWRhcHRlci5jYWxsKHRoaXMsIGZhbHNlKV07XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0dmFyIGxhc3RQcm9wZXJ0eSA9IHRoaXMuX3Byb3BlcnR5Q2hhaW4ubGFzdFByb3BlcnR5KCk7XHJcblx0XHRcdFx0XHR2YXIgYWxsb3dlZFZhbHVlc1J1bGUgPSBsYXN0UHJvcGVydHkucnVsZShFeG9XZWIuTW9kZWwuUnVsZS5hbGxvd2VkVmFsdWVzKTtcclxuXHJcblx0XHRcdFx0XHQvLyBXYXRjaCBmb3IgdGhlIHJlZ2lzdHJhdGlvbiBvZiBhbiBhbGxvd2VkIHZhbHVlcyBydWxlIGlmIGl0IGRvZXNuJ3QgZXhpc3RcclxuXHRcdFx0XHRcdGlmICghYWxsb3dlZFZhbHVlc1J1bGUpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5fYWxsb3dlZFZhbHVlc1J1bGVFeGlzdHNIYW5kbGVyID0gY2hlY2tBbGxvd2VkVmFsdWVzUnVsZUV4aXN0cy5iaW5kKHRoaXMpO1xyXG5cdFx0XHRcdFx0XHRsYXN0UHJvcGVydHkuYWRkUnVsZVJlZ2lzdGVyZWQodGhpcy5fYWxsb3dlZFZhbHVlc1J1bGVFeGlzdHNIYW5kbGVyKTtcclxuXHRcdFx0XHRcdFx0dGhpcy5fb3B0aW9ucyA9IG51bGw7XHJcblx0XHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyBDYWNoZSB0aGUgbGFzdCB0YXJnZXRcclxuXHRcdFx0XHRcdHZhciB0YXJnZXRPYmogPSB0aGlzLl9wcm9wZXJ0eUNoYWluLmxhc3RUYXJnZXQodGhpcy5fdGFyZ2V0KTtcclxuXHJcblx0XHRcdFx0XHQvLyBSZXRyaWV2ZSB0aGUgdmFsdWUgb2YgYWxsb3dlZCB2YWx1ZXMgcHJvcGVydHlcclxuXHRcdFx0XHRcdHZhciBhbGxvd2VkVmFsdWVzID0gYWxsb3dlZFZhbHVlc1J1bGUudmFsdWVzKHRhcmdldE9iaiwgISF0aGlzLl9hbGxvd2VkVmFsdWVzTWF5QmVOdWxsKTtcclxuXHJcblx0XHRcdFx0XHQvLyBMb2FkIGFsbG93ZWQgdmFsdWVzIGlmIHRoZSBwYXRoIGlzIG5vdCBpbml0ZWRcclxuXHRcdFx0XHRcdGlmIChhbGxvd2VkVmFsdWVzID09PSB1bmRlZmluZWQgJiYgKGFsbG93ZWRWYWx1ZXNSdWxlLnNvdXJjZSBpbnN0YW5jZW9mIFByb3BlcnR5IHx8IGFsbG93ZWRWYWx1ZXNSdWxlLnNvdXJjZSBpbnN0YW5jZW9mIFByb3BlcnR5Q2hhaW4pKSB7XHJcblx0XHRcdFx0XHRcdGxvZ1dhcm5pbmcoXCJBZGFwdGVyIGZvcmNlZCBldmFsIG9mIGFsbG93ZWQgdmFsdWVzLiBSdWxlOiBcIiArIGFsbG93ZWRWYWx1ZXNSdWxlKTtcclxuXHRcdFx0XHRcdFx0TGF6eUxvYWRlci5ldmFsKGFsbG93ZWRWYWx1ZXNSdWxlLnNvdXJjZS5nZXRfaXNTdGF0aWMoKSA/IG51bGwgOiB0YXJnZXRPYmosXHJcblx0XHRcdFx0XHRcdFx0YWxsb3dlZFZhbHVlc1J1bGUuc291cmNlLmdldF9wYXRoKCksXHJcblx0XHRcdFx0XHRcdFx0c2lnbmFsT3B0aW9uc1JlYWR5LmJpbmQodGhpcykpO1xyXG5cdFx0XHRcdFx0XHR0aGlzLl9vcHRpb25zID0gbnVsbDtcclxuXHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdC8vIFdhdGNoIGZvciBjaGFuZ2VzIHVudGlsIHRoZSBhbGxvd2VkIHZhbHVlcyBwYXRoIGhhcyBhIHZhbHVlXHJcblx0XHRcdFx0XHRpZiAoIWFsbG93ZWRWYWx1ZXMpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5fYWxsb3dlZFZhbHVlc0V4aXN0SGFuZGxlciA9IGNoZWNrQWxsb3dlZFZhbHVlc0V4aXN0LmJpbmQodGhpcyk7XHJcblx0XHRcdFx0XHRcdGFsbG93ZWRWYWx1ZXNSdWxlLmFkZENoYW5nZWQodGhpcy5fYWxsb3dlZFZhbHVlc0V4aXN0SGFuZGxlciwgdGFyZ2V0T2JqKTtcclxuXHRcdFx0XHRcdFx0aWYgKCFhbGxvd2VkVmFsdWVzUnVsZS5pZ25vcmVWYWxpZGF0aW9uKSB7XHJcblx0XHRcdFx0XHRcdCAgICBjbGVhckludmFsaWRPcHRpb25zLmNhbGwodGhpcyk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0dGhpcy5fb3B0aW9ucyA9IG51bGw7XHJcblx0XHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyBMb2FkIHRoZSBhbGxvd2VkIHZhbHVlcyBsaXN0IGlmIGl0IGlzIG5vdCBhbHJlYWR5IGxvYWRlZFxyXG5cdFx0XHRcdFx0aWYgKExhenlMb2FkZXIuaXNSZWdpc3RlcmVkKGFsbG93ZWRWYWx1ZXMpKSB7XHJcblx0XHRcdFx0XHRcdGxvZ1dhcm5pbmcoXCJBZGFwdGVyIGZvcmNlZCBsb2FkaW5nIG9mIGFsbG93ZWQgdmFsdWVzIGxpc3QuIFJ1bGU6IFwiICsgYWxsb3dlZFZhbHVlc1J1bGUpO1xyXG5cdFx0XHRcdFx0XHRMYXp5TG9hZGVyLmxvYWQoYWxsb3dlZFZhbHVlcywgbnVsbCwgdHJ1ZSwgc2lnbmFsT3B0aW9uc1JlYWR5LmJpbmQodGhpcyksIHRoaXMpO1xyXG5cdFx0XHRcdFx0XHR0aGlzLl9vcHRpb25zID0gbnVsbDtcclxuXHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGlmICghYWxsb3dlZFZhbHVlc1J1bGUuaWdub3JlVmFsaWRhdGlvbikge1xyXG5cdFx0XHRcdFx0ICAgIGNsZWFySW52YWxpZE9wdGlvbnMuY2FsbCh0aGlzLCBhbGxvd2VkVmFsdWVzKTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyBDcmVhdGUgYW4gb2JzZXJ2YWJsZSBjb3B5IG9mIHRoZSBhbGxvd2VkIHZhbHVlcyB0aGF0IHdlIGNhbiBrZWVwIHVwIHRvIGRhdGUgaW4gb3VyIG93biB0aW1lXHJcblx0XHRcdFx0XHR2YXIgb2JzZXJ2YWJsZUFsbG93ZWRWYWx1ZXMgPSBhbGxvd2VkVmFsdWVzLnNsaWNlKCk7XHJcblx0XHRcdFx0XHRFeG9XZWIuT2JzZXJ2ZXIubWFrZU9ic2VydmFibGUob2JzZXJ2YWJsZUFsbG93ZWRWYWx1ZXMpO1xyXG5cclxuXHRcdFx0XHRcdC8vIFJlc3BvbmQgdG8gY2hhbmdlcyB0byBhbGxvd2VkIHZhbHVlc1xyXG5cdFx0XHRcdFx0dGhpcy5fYWxsb3dlZFZhbHVlc0NoYW5nZWRIYW5kbGVyID0gYWxsb3dlZFZhbHVlc0NoYW5nZWQuYmluZCh0aGlzKS5wcmVwZW5kQXJndW1lbnRzKG9ic2VydmFibGVBbGxvd2VkVmFsdWVzKTtcclxuXHRcdFx0XHRcdGFsbG93ZWRWYWx1ZXNSdWxlLmFkZENoYW5nZWQodGhpcy5fYWxsb3dlZFZhbHVlc0NoYW5nZWRIYW5kbGVyLCB0YXJnZXRPYmosIGZhbHNlLCB0cnVlKTtcclxuXHJcblx0XHRcdFx0XHQvLyBDcmVhdGUgYSB0cmFuc2Zvcm0gdGhhdCB3YXRjaGVzIHRoZSBvYnNlcnZhYmxlIGNvcHkgYW5kIHVzZXMgdGhlIHVzZXItc3VwcGxpZWQgX2FsbG93ZWRWYWx1ZXNUcmFuc2Zvcm0gaWYgZ2l2ZW5cclxuXHRcdFx0XHRcdGlmICh0aGlzLl9hbGxvd2VkVmFsdWVzVHJhbnNmb3JtKSB7XHJcblx0XHRcdFx0XHRcdHRyYW5zZm9ybWVkQWxsb3dlZFZhbHVlcyA9IChuZXcgRnVuY3Rpb24oXCIkYXJyYXlcIiwgXCJ7IHJldHVybiAkdHJhbnNmb3JtKCRhcnJheSwgdHJ1ZSkuXCIgKyB0aGlzLl9hbGxvd2VkVmFsdWVzVHJhbnNmb3JtICsgXCI7IH1cIikpKG9ic2VydmFibGVBbGxvd2VkVmFsdWVzKTtcclxuXHRcdFx0XHRcdFx0aWYgKHRyYW5zZm9ybWVkQWxsb3dlZFZhbHVlcy5saXZlICE9PSBUcmFuc2Zvcm0ucHJvdG90eXBlLmxpdmUpIHtcclxuXHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIG9wdGlvbnMgdHJhbnNmb3JtIHJlc3VsdDogbWF5IG9ubHkgY29udGFpbiBcXFwid2hlcmVcXFwiLCBcXFwib3JkZXJCeVxcXCIsIFxcXCJzZWxlY3RcXFwiLCBcXFwic2VsZWN0TWFueVxcXCIsIGFuZCBcXFwiZ3JvdXBCeVxcXCIuXCIpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0dHJhbnNmb3JtZWRBbGxvd2VkVmFsdWVzID0gJHRyYW5zZm9ybShvYnNlcnZhYmxlQWxsb3dlZFZhbHVlcywgdHJ1ZSk7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0Ly8gTWFwIHRoZSBhbGxvd2VkIHZhbHVlcyB0byBvcHRpb24gYWRhcHRlcnNcclxuXHRcdFx0XHRcdHRoaXMuX29wdGlvbnMgPSB0cmFuc2Zvcm1lZEFsbG93ZWRWYWx1ZXMuc2VsZWN0KGNyZWF0ZU9wdGlvbkFkYXB0ZXIuYmluZCh0aGlzKSkubGl2ZSgpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX29wdGlvbnM7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0RXhvV2ViLlZpZXcuQWRhcHRlciA9IEFkYXB0ZXI7XHJcblx0QWRhcHRlci5yZWdpc3RlckNsYXNzKFwiRXhvV2ViLlZpZXcuQWRhcHRlclwiLCBTeXMuQ29tcG9uZW50LCBTeXMuVUkuSVRlbXBsYXRlQ29udGV4dENvbnN1bWVyKTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5WaWV3Lk9wdGlvbkFkYXB0ZXJcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHRmdW5jdGlvbiBPcHRpb25BZGFwdGVyKHBhcmVudCwgb2JqKSB7XHJcblx0XHR0aGlzLl9wYXJlbnQgPSBwYXJlbnQ7XHJcblx0XHR0aGlzLl9vYmogPSBvYmo7XHJcblxyXG5cdFx0Ly8gd2F0Y2ggZm9yIGNoYW5nZXMgdG8gcHJvcGVydGllcyBvZiB0aGUgc291cmNlIG9iamVjdCBhbmQgdXBkYXRlIHRoZSBsYWJlbFxyXG5cdFx0dGhpcy5fZW5zdXJlT2JzZXJ2YWJsZSgpO1xyXG5cdH1cclxuXHJcblx0T3B0aW9uQWRhcHRlci5wcm90b3R5cGUgPSB7XHJcblx0XHQvLyBJbnRlcm5hbCBib29rLWtlZXBpbmcgYW5kIHNldHVwIG1ldGhvZHNcclxuXHRcdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0XHRfbG9hZEZvckZvcm1hdEFuZFJhaXNlQ2hhbmdlOiBmdW5jdGlvbiBPcHRpb25BZGFwdGVyJF9sb2FkRm9yRm9ybWF0QW5kUmFpc2VDaGFuZ2UodmFsKSB7XHJcblx0XHRcdGlmICh2YWwgPT09IHVuZGVmaW5lZCB8fCB2YWwgPT09IG51bGwpIHtcclxuXHRcdFx0XHRPYnNlcnZlci5yYWlzZVByb3BlcnR5Q2hhbmdlZCh0aGlzLCBcImRpc3BsYXlWYWx1ZVwiKTtcclxuXHRcdFx0XHRPYnNlcnZlci5yYWlzZVByb3BlcnR5Q2hhbmdlZCh0aGlzLCBcInN5c3RlbVZhbHVlXCIpO1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIHNpZ25hbCA9IG5ldyBFeG9XZWIuU2lnbmFsKFwiT3B0aW9uQWRhcHRlci5kaXNwbGF5VmFsdWVcIik7XHJcblx0XHRcdHRoaXMuX3BhcmVudC5fZG9Gb3JGb3JtYXRQYXRocyh2YWwsIGZ1bmN0aW9uIChwYXRoKSB7XHJcblx0XHRcdFx0TGF6eUxvYWRlci5ldmFsQWxsKHZhbCwgcGF0aCwgc2lnbmFsLnBlbmRpbmcoKSk7XHJcblx0XHRcdH0sIHRoaXMpO1xyXG5cdFx0XHRzaWduYWwud2FpdEZvckFsbChmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0T2JzZXJ2ZXIucmFpc2VQcm9wZXJ0eUNoYW5nZWQodGhpcywgXCJkaXNwbGF5VmFsdWVcIik7XHJcblx0XHRcdFx0T2JzZXJ2ZXIucmFpc2VQcm9wZXJ0eUNoYW5nZWQodGhpcywgXCJzeXN0ZW1WYWx1ZVwiKTtcclxuXHRcdFx0fSwgdGhpcyk7XHJcblx0XHR9LFxyXG5cdFx0X3N1YnNjcmliZVRvRm9ybWF0Q2hhbmdlczogZnVuY3Rpb24gT3B0aW9uQWRhcHRlciRfc3Vic2NyaWJlVG9Gb3JtYXRDaGFuZ2VzKHZhbCkge1xyXG5cdFx0XHR0aGlzLl9wYXJlbnQuX2RvRm9yRm9ybWF0UGF0aHModmFsLCBmdW5jdGlvbiAocGF0aCkge1xyXG5cdFx0XHRcdE1vZGVsLnByb3BlcnR5KHBhdGgsIHZhbC5tZXRhLnR5cGUsIHRydWUsIGZ1bmN0aW9uIChjaGFpbikge1xyXG5cdFx0XHRcdFx0dmFyIHN1YnNjcmlwdGlvbiA9IHRoaXMuX2Zvcm1hdFN1YnNjcmliZXJzW3BhdGhdID0geyBjaGFpbjogY2hhaW4sIGhhbmRsZXI6IHRoaXMuX2xvYWRGb3JGb3JtYXRBbmRSYWlzZUNoYW5nZS5iaW5kKHRoaXMpLnByZXBlbmRBcmd1bWVudHModmFsKSB9O1xyXG5cdFx0XHRcdFx0Y2hhaW4uYWRkQ2hhbmdlZChzdWJzY3JpcHRpb24uaGFuZGxlciwgdmFsKTtcclxuXHRcdFx0XHR9LCB0aGlzKTtcclxuXHRcdFx0fSwgdGhpcyk7XHJcblx0XHR9LFxyXG5cdFx0X2Vuc3VyZU9ic2VydmFibGU6IGZ1bmN0aW9uIE9wdGlvbkFkYXB0ZXIkX2Vuc3VyZU9ic2VydmFibGUoKSB7XHJcblx0XHRcdGlmICghdGhpcy5fb2JzZXJ2YWJsZSkge1xyXG5cdFx0XHRcdE9ic2VydmVyLm1ha2VPYnNlcnZhYmxlKHRoaXMpO1xyXG5cclxuXHRcdFx0XHR0aGlzLl9mb3JtYXRTdWJzY3JpYmVycyA9IHt9O1xyXG5cclxuXHRcdFx0XHQvLyBzZXQgdXAgaW5pdGlhbCB3YXRjaGluZyBvZiBmb3JtYXQgcGF0aHNcclxuXHRcdFx0XHR0aGlzLl9zdWJzY3JpYmVUb0Zvcm1hdENoYW5nZXModGhpcy5fb2JqKTtcclxuXHJcblx0XHRcdFx0dGhpcy5fb2JzZXJ2YWJsZSA9IHRydWU7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gUHJvcGVydGllcyBjb25zdW1lZCBieSBVSVxyXG5cdFx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0XHRnZXRfcGFyZW50OiBmdW5jdGlvbiBPcHRpb25BZGFwdGVyJGdldF9wYXJlbnQoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9wYXJlbnQ7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X3Jhd1ZhbHVlOiBmdW5jdGlvbiBPcHRpb25BZGFwdGVyJGdldF9yYXdWYWx1ZSgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX29iajtcclxuXHRcdH0sXHJcblx0XHRnZXRfZGlzcGxheVZhbHVlOiBmdW5jdGlvbiBPcHRpb25BZGFwdGVyJGdldF9kaXNwbGF5VmFsdWUoKSB7XHJcblx0XHRcdHZhciBmb3JtYXQgPSB0aGlzLl9wYXJlbnQuZ2V0X2Zvcm1hdCgpO1xyXG5cdFx0XHRyZXR1cm4gZm9ybWF0ID8gZm9ybWF0LmNvbnZlcnQodGhpcy5fb2JqKSA6IHRoaXMuX29iajtcclxuXHRcdH0sXHJcblx0XHRzZXRfZGlzcGxheVZhbHVlOiBmdW5jdGlvbiBPcHRpb25BZGFwdGVyJHNldF9kaXNwbGF5VmFsdWUodmFsdWUpIHtcclxuXHRcdFx0aWYgKHRoaXMuX3BhcmVudC5nZXRfaXNFbnRpdHkoKSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBzZXQgZGlzcGxheVZhbHVlIHByb3BlcnR5IG9mIE9wdGlvbkFkYXB0ZXJzIGZvciBlbnRpdHkgdHlwZXMuXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHZhciBzZWxlY3RlZCA9IHRoaXMuZ2V0X3NlbGVjdGVkKCk7XHJcblx0XHRcdFx0Ly8gUmVtb3ZlIG9sZCB2YWx1ZSBmcm9tIHRoZSBsaXN0IGlmIHNlbGVjdGVkXHJcblx0XHRcdFx0aWYgKHNlbGVjdGVkKSB0aGlzLnNldF9zZWxlY3RlZChmYWxzZSk7XHJcblxyXG5cdFx0XHRcdC8vIFNldCB0aGUgaW50ZXJuYWwgb3B0aW9uIHZhbHVlIGFmdGVyIG9wdGlvbmFsIGFwcGx5aW5nIGEgY29udmVyc2lvblxyXG5cdFx0XHRcdHZhbHVlID0gdGhpcy5fZm9ybWF0ID8gdGhpcy5fZm9ybWF0LmNvbnZlcnRCYWNrKHZhbHVlKSA6IHZhbHVlO1xyXG5cdFx0XHRcdHRoaXMuX29iaiA9IHZhbHVlO1xyXG5cclxuXHRcdFx0XHQvLyBBZGQgbmV3IHZhbHVlIHRvIHRoZSBsaXN0IGlmIHByZXZpb3VzbHkgc2VsZWN0ZWRcclxuXHRcdFx0XHRpZiAoc2VsZWN0ZWQpIHRoaXMuc2V0X3NlbGVjdGVkKHRydWUpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0Z2V0X3N5c3RlbVZhbHVlOiBmdW5jdGlvbiBPcHRpb25BZGFwdGVyJGdldF9zeXN0ZW1WYWx1ZSgpIHtcclxuXHRcdFx0aWYgKHRoaXMuX29iaiA9PT0gbnVsbCB8fCB0aGlzLl9vYmogPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdHJldHVybiBcIlwiO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHJldHVybiB0aGlzLl9wYXJlbnQuZ2V0X2lzRW50aXR5KCkgPyBFbnRpdHkudG9JZFN0cmluZyh0aGlzLl9vYmopIDogdGhpcy5fb2JqLnRvU3RyaW5nKCk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRnZXRfc2VsZWN0ZWQ6IGZ1bmN0aW9uIE9wdGlvbkFkYXB0ZXIkZ2V0X3NlbGVjdGVkKCkge1xyXG5cdFx0XHR2YXIgcmF3VmFsdWUgPSB0aGlzLl9wYXJlbnQuZ2V0X3Jhd1ZhbHVlKCk7XHJcblxyXG5cdFx0XHRpZiAocmF3VmFsdWUgaW5zdGFuY2VvZiBBcnJheSkge1xyXG5cdFx0XHRcdHJldHVybiBBcnJheS5jb250YWlucyhyYXdWYWx1ZSwgdGhpcy5fb2JqKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRyZXR1cm4gcmF3VmFsdWUgPT09IHRoaXMuX29iajtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdHNldF9zZWxlY3RlZDogZnVuY3Rpb24gT3B0aW9uQWRhcHRlciRzZXRfc2VsZWN0ZWQodmFsdWUpIHtcclxuXHRcdFx0dmFyIHJhd1ZhbHVlID0gdGhpcy5fcGFyZW50LmdldF9yYXdWYWx1ZSgpO1xyXG5cclxuXHRcdFx0aWYgKHJhd1ZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuXHRcdFx0XHR0aGlzLl9wYXJlbnQuX3NldHRpbmdSYXdWYWx1ZSA9IHRydWU7XHJcblxyXG5cdFx0XHRcdHRyeSB7XHJcblx0XHRcdFx0XHRpZiAodmFsdWUgJiYgIUFycmF5LmNvbnRhaW5zKHJhd1ZhbHVlLCB0aGlzLl9vYmopKSB7XHJcblx0XHRcdFx0XHRcdHJhd1ZhbHVlLmFkZCh0aGlzLl9vYmopO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAoIXZhbHVlICYmIEFycmF5LmNvbnRhaW5zKHJhd1ZhbHVlLCB0aGlzLl9vYmopKSB7XHJcblx0XHRcdFx0XHRcdHJhd1ZhbHVlLnJlbW92ZSh0aGlzLl9vYmopO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHR9IGZpbmFsbHkge1xyXG5cdFx0XHRcdFx0dGhpcy5fcGFyZW50Ll9zZXR0aW5nUmF3VmFsdWUgPSBmYWxzZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0aWYgKHZhbHVlKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9wYXJlbnQuc2V0X3Jhd1ZhbHVlKHRoaXMuX29iaik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0dGhpcy5fcGFyZW50LnNldF9yYXdWYWx1ZShudWxsKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRnZXRfY29uZGl0aW9uczogZnVuY3Rpb24gT3B0aW9uQWRhcHRlciRnZXRfY29uZGl0aW9ucygpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudC5nZXRfY29uZGl0aW9ucygpO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdEV4b1dlYi5WaWV3Lk9wdGlvbkFkYXB0ZXIgPSBPcHRpb25BZGFwdGVyO1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLlZpZXcuTGlzdFZhbHVlQWRhcHRlclxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdGZ1bmN0aW9uIExpc3RWYWx1ZUFkYXB0ZXIocGFyZW50LCBpbmRleCkge1xyXG5cdFx0dGhpcy5fcGFyZW50ID0gcGFyZW50O1xyXG5cdFx0dGhpcy5faW5kZXggPSBpbmRleDtcclxuXHJcblx0XHQvLyB3YXRjaCBmb3IgY2hhbmdlcyB0byBwcm9wZXJ0aWVzIG9mIHRoZSBzb3VyY2Ugb2JqZWN0IGFuZCB1cGRhdGUgdGhlIGxhYmVsXHJcblx0XHR0aGlzLl9lbnN1cmVPYnNlcnZhYmxlKCk7XHJcblx0fVxyXG5cclxuXHRMaXN0VmFsdWVBZGFwdGVyLnByb3RvdHlwZSA9IHtcclxuXHRcdC8vIEludGVybmFsIGJvb2sta2VlcGluZyBhbmQgc2V0dXAgbWV0aG9kc1xyXG5cdFx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHRcdF9sb2FkRm9yRm9ybWF0QW5kUmFpc2VDaGFuZ2U6IGZ1bmN0aW9uIExpc3RWYWx1ZUFkYXB0ZXIkX2xvYWRGb3JGb3JtYXRBbmRSYWlzZUNoYW5nZSh2YWwpIHtcclxuXHRcdFx0aWYgKHZhbCA9PT0gdW5kZWZpbmVkIHx8IHZhbCA9PT0gbnVsbCkge1xyXG5cdFx0XHRcdE9ic2VydmVyLnJhaXNlUHJvcGVydHlDaGFuZ2VkKHRoaXMsIFwiZGlzcGxheVZhbHVlXCIpO1xyXG5cdFx0XHRcdE9ic2VydmVyLnJhaXNlUHJvcGVydHlDaGFuZ2VkKHRoaXMsIFwic3lzdGVtVmFsdWVcIik7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR2YXIgc2lnbmFsID0gbmV3IEV4b1dlYi5TaWduYWwoXCJMaXN0VmFsdWVBZGFwdGVyLmRpc3BsYXlWYWx1ZVwiKTtcclxuXHRcdFx0dGhpcy5fcGFyZW50Ll9kb0ZvckZvcm1hdFBhdGhzKHZhbCwgZnVuY3Rpb24gKHBhdGgpIHtcclxuXHRcdFx0XHRMYXp5TG9hZGVyLmV2YWxBbGwodmFsLCBwYXRoLCBzaWduYWwucGVuZGluZygpKTtcclxuXHRcdFx0fSwgdGhpcyk7XHJcblx0XHRcdHNpZ25hbC53YWl0Rm9yQWxsKGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRPYnNlcnZlci5yYWlzZVByb3BlcnR5Q2hhbmdlZCh0aGlzLCBcImRpc3BsYXlWYWx1ZVwiKTtcclxuXHRcdFx0XHRPYnNlcnZlci5yYWlzZVByb3BlcnR5Q2hhbmdlZCh0aGlzLCBcInN5c3RlbVZhbHVlXCIpO1xyXG5cdFx0XHR9LCB0aGlzKTtcclxuXHRcdH0sXHJcblx0XHQvL19zdWJzY3JpYmVUb0Zvcm1hdENoYW5nZXM6IGZ1bmN0aW9uIExpc3RWYWx1ZUFkYXB0ZXIkX3N1YnNjcmliZVRvRm9ybWF0Q2hhbmdlcyh2YWwpIHtcclxuXHRcdC8vXHR0aGlzLl9wYXJlbnQuX2RvRm9yRm9ybWF0UGF0aHModmFsLCBmdW5jdGlvbiAocGF0aCkge1xyXG5cdFx0Ly9cdFx0TW9kZWwucHJvcGVydHkocGF0aCwgdmFsLm1ldGEudHlwZSwgdHJ1ZSwgZnVuY3Rpb24gKGNoYWluKSB7XHJcblx0XHQvL1x0XHRcdHZhciBzdWJzY3JpcHRpb24gPSB0aGlzLl9mb3JtYXRTdWJzY3JpYmVyc1twYXRoXSA9IHsgY2hhaW46IGNoYWluLCBoYW5kbGVyOiB0aGlzLl9sb2FkRm9yRm9ybWF0QW5kUmFpc2VDaGFuZ2UuYmluZCh0aGlzKS5wcmVwZW5kQXJndW1lbnRzKHZhbCkgfTtcclxuXHRcdC8vXHRcdFx0Y2hhaW4uYWRkQ2hhbmdlZChzdWJzY3JpcHRpb24uaGFuZGxlciwgdmFsKTtcclxuXHRcdC8vXHRcdH0sIHRoaXMpO1xyXG5cdFx0Ly9cdH0sIHRoaXMpO1xyXG5cdFx0Ly99LFxyXG5cdFx0X2Vuc3VyZU9ic2VydmFibGU6IGZ1bmN0aW9uIExpc3RWYWx1ZUFkYXB0ZXIkX2Vuc3VyZU9ic2VydmFibGUoKSB7XHJcblx0XHRcdGlmICghdGhpcy5fb2JzZXJ2YWJsZSkge1xyXG5cdFx0XHRcdE9ic2VydmVyLm1ha2VPYnNlcnZhYmxlKHRoaXMpO1xyXG5cclxuXHRcdFx0XHR0aGlzLl9mb3JtYXRTdWJzY3JpYmVycyA9IHt9O1xyXG5cclxuXHRcdFx0XHQvLyBzZXQgdXAgaW5pdGlhbCB3YXRjaGluZyBvZiBmb3JtYXQgcGF0aHNcclxuXHRcdFx0XHQvL3RoaXMuX3N1YnNjcmliZVRvRm9ybWF0Q2hhbmdlcyh0aGlzLl9vYmopO1xyXG5cclxuXHRcdFx0XHR0aGlzLl9vYnNlcnZhYmxlID0gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHQvLyBQcm9wZXJ0aWVzIGNvbnN1bWVkIGJ5IFVJXHJcblx0XHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHRcdGdldF9wYXJlbnQ6IGZ1bmN0aW9uIExpc3RWYWx1ZUFkYXB0ZXIkZ2V0X3BhcmVudCgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudDtcclxuXHRcdH0sXHJcblx0XHRnZXRfaXNFbnRpdHk6IGZ1bmN0aW9uIExpc3RWYWx1ZUFkYXB0ZXIkZ2V0X2lzRW50aXR5KCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fcGFyZW50LmdldF9pc0VudGl0eSgpO1xyXG5cdFx0fSxcclxuXHRcdGdldF9vcHRpb25zOiBmdW5jdGlvbiBMaXN0VmFsdWVBZGFwdGVyJGdldF9vcHRpb25zKCkge1xyXG5cdFx0XHR2YXIgX3RoaXMgPSB0aGlzO1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fcGFyZW50LmdldF9vcHRpb25zKCkubWFwKGZ1bmN0aW9uIChvKSB7IHJldHVybiBuZXcgT3B0aW9uQWRhcHRlcihfdGhpcywgby5fb2JqKTsgfSk7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X3Jhd1ZhbHVlOiBmdW5jdGlvbiBMaXN0VmFsdWVBZGFwdGVyJGdldF9yYXdWYWx1ZSgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudC5nZXRfcmF3VmFsdWUoKVt0aGlzLl9pbmRleF07XHJcblx0XHR9LFxyXG5cdFx0Z2V0X2Rpc3BsYXlWYWx1ZTogZnVuY3Rpb24gTGlzdFZhbHVlQWRhcHRlciRnZXRfZGlzcGxheVZhbHVlKCkge1xyXG5cdFx0XHR2YXIgZm9ybWF0ID0gdGhpcy5fcGFyZW50Ll9mb3JtYXQ7XHJcblx0XHRcdHZhciBvYmogPSB0aGlzLl9wYXJlbnQuZ2V0X3Jhd1ZhbHVlKClbdGhpcy5faW5kZXhdO1xyXG5cdFx0XHRyZXR1cm4gZm9ybWF0ID8gZm9ybWF0LmNvbnZlcnQob2JqKSA6IG9iajtcclxuXHRcdH0sXHJcblx0XHRzZXRfZGlzcGxheVZhbHVlOiBmdW5jdGlvbiBMaXN0VmFsdWVBZGFwdGVyJHNldF9kaXNwbGF5VmFsdWUodmFsdWUpIHtcclxuXHRcdFx0aWYgKHRoaXMuX3BhcmVudC5nZXRfaXNFbnRpdHkoKSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBzZXQgZGlzcGxheVZhbHVlIHByb3BlcnR5IG9mIE9wdGlvbkFkYXB0ZXJzIGZvciBlbnRpdHkgdHlwZXMuXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdC8vIFNldCB0aGUgaW50ZXJuYWwgb3B0aW9uIHZhbHVlIGFmdGVyIG9wdGlvbmFsIGFwcGx5aW5nIGEgY29udmVyc2lvblxyXG5cdFx0XHRcdHZhbHVlID0gdGhpcy5fZm9ybWF0ID8gdGhpcy5fcGFyZW50Ll9mb3JtYXQuY29udmVydEJhY2sodmFsdWUpIDogdmFsdWU7XHJcblxyXG5cdFx0XHRcdHZhciBsaXN0ID0gdGhpcy5fcGFyZW50LmdldF9yYXdWYWx1ZSgpO1xyXG5cdFx0XHRcdGxpc3QuYmVnaW5VcGRhdGUoKTtcclxuXHRcdFx0XHRsaXN0LnJlbW92ZUF0KHRoaXMuX2luZGV4KTtcclxuXHRcdFx0XHRsaXN0Lmluc2VydCh0aGlzLl9pbmRleCwgdmFsdWUpO1xyXG5cdFx0XHRcdGxpc3QuZW5kVXBkYXRlKCk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRnZXRfc3lzdGVtVmFsdWU6IGZ1bmN0aW9uIExpc3RWYWx1ZUFkYXB0ZXIkZ2V0X3N5c3RlbVZhbHVlKCkge1xyXG5cdFx0XHRpZiAodGhpcy5fb2JqID09PSBudWxsIHx8IHRoaXMuX29iaiA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0cmV0dXJuIFwiXCI7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudC5nZXRfaXNFbnRpdHkoKSA/IEVudGl0eS50b0lkU3RyaW5nKHRoaXMuX29iaikgOiB0aGlzLl9vYmoudG9TdHJpbmcoKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdGdldF9jb25kaXRpb25zOiBmdW5jdGlvbiBMaXN0VmFsdWVBZGFwdGVyJGdldF9jb25kaXRpb25zKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fcGFyZW50LmdldF9jb25kaXRpb25zKCk7XHJcblx0XHR9LFxyXG5cdFx0X2RvRm9yRm9ybWF0UGF0aHM6IGZ1bmN0aW9uIExpc3RWYWx1ZUFkYXB0ZXIkX2RvRm9yRm9ybWF0UGF0aHModmFsLCBjYWxsYmFjaywgdGhpc1B0cikge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fcGFyZW50Ll9kb0ZvckZvcm1hdFBhdGhzKHZhbCwgY2FsbGJhY2ssIHRoaXNQdHIpO1xyXG5cdFx0fSxcclxuXHRcdGdldF9mb3JtYXQ6IGZ1bmN0aW9uIExpc3RWYWx1ZUFkYXB0ZXIkZ2V0X2Zvcm1hdCgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudC5fZm9ybWF0O1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdEV4b1dlYi5WaWV3Lkxpc3RWYWx1ZUFkYXB0ZXIgPSBMaXN0VmFsdWVBZGFwdGVyO1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXhvV2ViLlZpZXcuT3B0aW9uR3JvdXBBZGFwdGVyXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0ZnVuY3Rpb24gT3B0aW9uR3JvdXBBZGFwdGVyKHBhcmVudCwgb2JqLCBpdGVtcykge1xyXG5cdFx0dGhpcy5fcGFyZW50ID0gcGFyZW50O1xyXG5cdFx0dGhpcy5fb2JqID0gb2JqO1xyXG5cdFx0dGhpcy5fb3B0aW9ucyA9ICR0cmFuc2Zvcm0oaXRlbXMpLnNlbGVjdChwYXJlbnQuX2NyZWF0ZU9wdGlvbi5iaW5kKHBhcmVudCkpLmxpdmUoKTtcclxuXHJcblx0XHQvLyB3YXRjaCBmb3IgY2hhbmdlcyB0byBwcm9wZXJ0aWVzIG9mIHRoZSBzb3VyY2Ugb2JqZWN0IGFuZCB1cGRhdGUgdGhlIGxhYmVsXHJcblx0XHR0aGlzLl9lbnN1cmVPYnNlcnZhYmxlKCk7XHJcblx0fVxyXG5cclxuXHRPcHRpb25Hcm91cEFkYXB0ZXIucHJvdG90eXBlID0ge1xyXG5cdFx0Ly8gUHJvcGVydGllcyBjb25zdW1lZCBieSBVSVxyXG5cdFx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0XHRnZXRfcGFyZW50OiBmdW5jdGlvbiBPcHRpb25Hcm91cEFkYXB0ZXIkZ2V0X3BhcmVudCgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudDtcclxuXHRcdH0sXHJcblx0XHRnZXRfcmF3VmFsdWU6IGZ1bmN0aW9uIE9wdGlvbkdyb3VwQWRhcHRlciRnZXRfcmF3VmFsdWUoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9vYmo7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X2Rpc3BsYXlWYWx1ZTogZnVuY3Rpb24gT3B0aW9uR3JvdXBBZGFwdGVyJGdldF9kaXNwbGF5VmFsdWUoKSB7XHJcblx0XHRcdHZhciByZXN1bHQgPSB0aGlzLl9vYmo7XHJcblx0XHRcdGlmIChyZXN1bHQgIT09IG51bGwgJiYgcmVzdWx0ICE9PSB1bmRlZmluZWQgJiYgcmVzdWx0LmZvcm1hdHMgJiYgcmVzdWx0LmZvcm1hdHMuJGRpc3BsYXkpIHtcclxuXHRcdFx0XHRyZXN1bHQgPSByZXN1bHQuZm9ybWF0cy4kZGlzcGxheS5jb252ZXJ0KHJlc3VsdCk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdH0sXHJcblx0XHRnZXRfc3lzdGVtVmFsdWU6IGZ1bmN0aW9uIE9wdGlvbkdyb3VwQWRhcHRlciRnZXRfc3lzdGVtVmFsdWUoKSB7XHJcblx0XHRcdHZhciByZXN1bHQgPSB0aGlzLl9vYmo7XHJcblx0XHRcdGlmIChyZXN1bHQgIT09IG51bGwgJiYgcmVzdWx0ICE9PSB1bmRlZmluZWQgJiYgcmVzdWx0LmZvcm1hdHMgJiYgcmVzdWx0LmZvcm1hdHMuJHN5c3RlbSkge1xyXG5cdFx0XHRcdHJlc3VsdCA9IHJlc3VsdC5mb3JtYXRzLiRzeXN0ZW0uY29udmVydChyZXN1bHQpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiByZXN1bHQ7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X29wdGlvbnM6IGZ1bmN0aW9uIE9wdGlvbkdyb3VwQWRhcHRlciRnZXRfb3B0aW9ucygpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX29wdGlvbnM7XHJcblx0XHR9LFxyXG5cdFx0Z2V0X2NvbmRpdGlvbnM6IGZ1bmN0aW9uIE9wdGlvbkdyb3VwQWRhcHRlciRnZXRfY29uZGl0aW9ucygpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudC5nZXRfY29uZGl0aW9ucygpO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdEV4b1dlYi5WaWV3Lk9wdGlvbkdyb3VwQWRhcHRlciA9IE9wdGlvbkdyb3VwQWRhcHRlcjtcclxuXHRPcHRpb25Hcm91cEFkYXB0ZXIucmVnaXN0ZXJDbGFzcyhcIkV4b1dlYi5WaWV3Lk9wdGlvbkdyb3VwQWRhcHRlclwiKTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIEV4b1dlYi5WaWV3Lk1zQWpheFxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdC8qZ2xvYmFscyBTeXMsIGpRdWVyeSAqL1xyXG5cclxuXHQoZnVuY3Rpb24gKCkge1xyXG5cdFx0ZnVuY3Rpb24gdXBkYXRlTGFzdFRhcmdldEFuZFNvdXJjZUZvck90aGVyUmFkaW9zKHRhcmdldCkge1xyXG5cdFx0XHQvLyBTZXQgX2xhc3RUYXJnZXQ9ZmFsc2Ugb24gb3RoZXIgcmFkaW8gYnV0dG9ucyBpbiB0aGUgZ3JvdXAsIHNpbmNlIHRoZXkgb25seSBcclxuXHRcdFx0Ly8gcmVtZW1iZXIgdGhlIGxhc3QgdGFyZ2V0IHRoYXQgd2FzIHJlY2lldmVkIHdoZW4gYW4gZXZlbnQgZmlyZXMgYW5kIHJhZGlvIGJ1dHRvblxyXG5cdFx0XHQvLyB0YXJnZXQgY2hhbmdlIGV2ZW50cyBmaXJlIG9uIGNsaWNrICh3aGljaCBkb2VzIG5vdCBhY2NvdW50IGZvciBkZS1zZWxlY3Rpb24pLiAgXHJcblx0XHRcdC8vIE90aGVyd2lzZSwgdGhlIHNvdXJjZSB2YWx1ZSBpcyBvbmx5IHNldCB0aGUgZmlyc3QgdGltZSB0aGUgcmFkaW8gYnV0dG9uIGlzIHNlbGVjdGVkLlxyXG5cdFx0XHRpZiAoU3lzLlVJLkRvbUVsZW1lbnQuaXNEb21FbGVtZW50KHRhcmdldCkgJiYgalF1ZXJ5KHRhcmdldCkuaXMoXCJpbnB1dFt0eXBlPXJhZGlvXTpjaGVja2VkXCIpKSB7XHJcblx0XHRcdFx0alF1ZXJ5KFwiaW5wdXRbdHlwZT1yYWRpb11bbmFtZT0nXCIgKyB0YXJnZXQubmFtZSArIFwiJ11cIikuZWFjaChmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRpZiAodGhpcyAhPT0gdGFyZ2V0ICYmIHRoaXMuX19tc2FqYXhiaW5kaW5ncyAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHRcdHZhciBiaW5kaW5ncyA9IHRoaXMuX19tc2FqYXhiaW5kaW5ncztcclxuXHRcdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBiaW5kaW5ncy5sZW5ndGg7IGkrKylcclxuXHRcdFx0XHRcdFx0XHRiaW5kaW5nc1tpXS5fbGFzdFRhcmdldCA9IGJpbmRpbmdzW2ldLl9sYXN0U291cmNlID0gZmFsc2U7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHR2YXIgdGFyZ2V0Q2hhbmdlZEltcGwgPSBTeXMuQmluZGluZy5wcm90b3R5cGUuX3RhcmdldENoYW5nZWQ7XHJcblx0XHRTeXMuQmluZGluZy5wcm90b3R5cGUuX3RhcmdldENoYW5nZWQgPSBmdW5jdGlvbiAoZm9yY2UpIHtcclxuXHRcdFx0Ly8gQmF0Y2ggY2hhbmdlcyB0aGF0IG1heSBvY2N1ciBkdWUgdG8gdGhlIHRhcmdldCBlbGVtZW50IGNoYW5naW5nLlxyXG5cdFx0XHR2YXIgc291cmNlID0gdGhpcy5nZXRfc291cmNlKCksXHJcblx0XHRcdFx0c291cmNlVHlwZSxcclxuXHRcdFx0XHRiYXRjaENoYW5nZXMgPSBFeG9XZWIuY29uZmlnLmVuYWJsZUJhdGNoQ2hhbmdlcztcclxuXHJcblx0XHRcdGlmIChzb3VyY2UgPT09IG51bGwpIHtcclxuXHRcdFx0XHRzb3VyY2VUeXBlID0gXCJudWxsXCI7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoc291cmNlID09PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRzb3VyY2VUeXBlID0gXCJ1bmRlZmluZWRcIjtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmIChzb3VyY2UgaW5zdGFuY2VvZiBFeG9XZWIuTW9kZWwuRW50aXR5KSB7XHJcblx0XHRcdFx0c291cmNlVHlwZSA9IHNvdXJjZS5tZXRhLnR5cGUuZ2V0X2Z1bGxOYW1lKCk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoc291cmNlIGluc3RhbmNlb2YgRXhvV2ViLlZpZXcuQWRhcHRlcikge1xyXG5cdFx0XHRcdHNvdXJjZVR5cGUgPSBcIkFkYXB0ZXJcIjtcclxuXHJcblx0XHRcdFx0Ly8gQWRhcHRlcnMgaGFuZGxlIHRoZWlyIG93biBiYXRjaGluZy5cclxuXHRcdFx0XHRiYXRjaENoYW5nZXMgPSBmYWxzZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmIChzb3VyY2UgaW5zdGFuY2VvZiBFeG9XZWIuVmlldy5PcHRpb25BZGFwdGVyKSB7XHJcblx0XHRcdFx0c291cmNlVHlwZSA9IFwiT3B0aW9uQWRhcHRlclwiO1xyXG5cclxuXHRcdFx0XHQvLyBJZiB0aGUgb3B0aW9uIGFkYXB0ZXIgaXMgbm90IGEgbGlzdCwgdGhlbiBpdCB3aWxsIHNldCB0aGVcclxuXHRcdFx0XHQvLyBhZGFwdGVyJ3MgcmF3VmFsdWUsIHdoaWNoIHdpbGwgaGFuZGxlIGJhdGNoaW5nIGl0c2VsZi5cclxuXHRcdFx0XHRpZiAoIXNvdXJjZS5nZXRfcGFyZW50KCkuZ2V0X2lzTGlzdCgpKSB7XHJcblx0XHRcdFx0XHRiYXRjaENoYW5nZXMgPSBmYWxzZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoc291cmNlIGluc3RhbmNlb2YgRXhvV2ViLlZpZXcuT3B0aW9uR3JvdXBBZGFwdGVyKSB7XHJcblx0XHRcdFx0c291cmNlVHlwZSA9IFwiT3B0aW9uR3JvdXBBZGFwdGVyXCI7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0c291cmNlVHlwZSA9IHBhcnNlRnVuY3Rpb25OYW1lKHNvdXJjZS5jb25zdHJ1Y3Rvcik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChiYXRjaENoYW5nZXMpIHtcclxuXHRcdFx0XHRjb250ZXh0LnNlcnZlci5fY2hhbmdlTG9nLmJhdGNoQ2hhbmdlcyhcclxuXHRcdFx0XHRcdCRmb3JtYXQoXCJiaW5kaW5nOiB7MH0uezF9XCIsIHNvdXJjZVR5cGUsIHRoaXMuZ2V0X3BhdGgoKSksXHJcblx0XHRcdFx0XHRjb250ZXh0LnNlcnZlci5fbG9jYWxVc2VyLFxyXG5cdFx0XHRcdFx0dGFyZ2V0Q2hhbmdlZEltcGwuYmluZCh0aGlzLCBhcmd1bWVudHMpLFxyXG5cdFx0XHRcdFx0dHJ1ZVxyXG5cdFx0XHRcdCk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0dGFyZ2V0Q2hhbmdlZEltcGwuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gSWYgdGhlIGJpbmRpbmcgaXMgbm90IGRpc3Bvc2luZywgdGhlbiBmaXggYmFja2luZ1xyXG5cdFx0XHQvLyBmaWVsZHMgZm9yIG90aGVyIHJhZGlvIGJ1dHRvbnMgaW4gdGhlIHNhbWUgZ3JvdXAuXHJcblx0XHRcdGlmICghdGhpcy5fZGlzcG9zZWQpIHtcclxuXHRcdFx0XHR1cGRhdGVMYXN0VGFyZ2V0QW5kU291cmNlRm9yT3RoZXJSYWRpb3ModGhpcy5fdGFyZ2V0KTtcclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHJcblx0XHRmdW5jdGlvbiByZW1vdmVDaGVja2VkQXR0cmlidXRlVG9NYXRjaFNvdXJjZVZhbHVlKHRhcmdldCwgc291cmNlVmFsdWUpIHtcclxuXHRcdFx0Ly8gUmVtb3ZlIGNoZWNrZWQgYXR0cmlidXRlIGZyb20gYSByYWRpbyBidXR0b24gaWYgdGhlIHNvdXJjZSB2YWx1ZSBoYXMgYmVlbiBzZXQgdG8gZmFsc2UuXHJcblx0XHRcdGlmIChTeXMuVUkuRG9tRWxlbWVudC5pc0RvbUVsZW1lbnQodGFyZ2V0KSAmJiBqUXVlcnkodGFyZ2V0KS5pcyhcImlucHV0W3R5cGU9cmFkaW9dOmNoZWNrZWRcIikgJiYgIXNvdXJjZVZhbHVlKSB7XHJcblx0XHRcdFx0alF1ZXJ5KHRhcmdldCkucmVtb3ZlQXR0cihcImNoZWNrZWRcIik7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHR2YXIgc291cmNlQ2hhbmdlZEltcGwgPSBTeXMuQmluZGluZy5wcm90b3R5cGUuX3NvdXJjZUNoYW5nZWQ7XHJcblx0XHRTeXMuQmluZGluZy5wcm90b3R5cGUuX3NvdXJjZUNoYW5nZWQgPSBmdW5jdGlvbiAoZm9yY2UpIHtcclxuXHRcdFx0dmFyIGxpbmsgPSBmb3JjZSA9PT0gZmFsc2U7XHJcblxyXG5cdFx0XHQvLyBJbnZva2UgdGhlIHN0YW5kYXJkIG1ldGhvZCBpbXBsZW1lbnRhdGlvbi5cclxuXHRcdFx0c291cmNlQ2hhbmdlZEltcGwuYXBwbHkodGhpcywgW2ZvcmNlXSk7XHJcblxyXG5cdFx0XHRpZiAoIXRoaXMuX2Rpc3Bvc2VkICYmICFsaW5rKSB7XHJcblx0XHRcdFx0cmVtb3ZlQ2hlY2tlZEF0dHJpYnV0ZVRvTWF0Y2hTb3VyY2VWYWx1ZSh0aGlzLl90YXJnZXQsIHRoaXMuX2xhc3RTb3VyY2UpO1xyXG5cdFx0XHR9XHJcblx0XHR9O1xyXG5cclxuXHRcdFN5cy5VSS5EYXRhVmlldy5wcm90b3R5cGUuX2xvYWREYXRhID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX3N3YXBEYXRhKHRoaXMuX2RhdGEsIHZhbHVlKTtcclxuXHRcdFx0dmFyIG9sZFZhbHVlID0gdGhpcy5fZGF0YTtcclxuXHRcdFx0dGhpcy5fZGF0YSA9IHZhbHVlO1xyXG5cdFx0XHR0aGlzLl9zZXREYXRhID0gdHJ1ZTtcclxuXHRcdFx0dGhpcy5fc3RhbGUgPSBmYWxzZTtcclxuXHRcdFx0Ly8gQXJyYXkgZGF0YSBzaG91bGQgbm90IHR5cGljYWxseSBiZSBzZXQgdW5sZXNzIHNvbWUgaW50ZXJtZWRpYXRlXHJcblx0XHRcdC8vIHByb2Nlc3MgKGxpa2UgdHJhbnNmb3JtKSBpcyBjcmVhdGluZyBhIG5ldyBhcnJheSBmcm9tIHRoZSBzYW1lIG9yaWdpbmFsLlxyXG5cdFx0XHRpZiAoKHZhbHVlICYmIHZhbHVlIGluc3RhbmNlb2YgQXJyYXkpICYmIChvbGRWYWx1ZSAmJiBvbGRWYWx1ZSBpbnN0YW5jZW9mIEFycmF5KSkge1xyXG5cdFx0XHRcdC8vIGNvcHkgdGhlIG9yaWdpbmFsIGFycmF5XHJcblx0XHRcdFx0dmFyIGFyciA9IG9sZFZhbHVlLnNsaWNlKCk7XHJcblx0XHRcdFx0dmFyIGNoYW5nZXMgPSB1cGRhdGUoYXJyLCB2YWx1ZSwgdHJ1ZSk7XHJcblx0XHRcdFx0dGhpcy5fY29sbGVjdGlvbkNoYW5nZWQodmFsdWUsIG5ldyBTeXMuTm90aWZ5Q29sbGVjdGlvbkNoYW5nZWRFdmVudEFyZ3MoY2hhbmdlcykpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMuX2RpcnR5ID0gdHJ1ZTtcclxuXHRcdFx0XHRpZiAodGhpcy5faXNBY3RpdmUoKSkge1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMuZ2V0X2lzTGlua1BlbmRpbmcoKSkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLmxpbmsoKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHR0aGlzLnJlZnJlc2goKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHRoaXMucmFpc2VQcm9wZXJ0eUNoYW5nZWQoXCJkYXRhXCIpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHRoaXMuX2NoYW5nZWQgPSB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHR9KSgpO1xyXG5cclxuXHQvLyBHZXQncyB0aGUgbGFzdCBvYmplY3QgaW4gdGhlIHNvdXJjZSBwYXRoLiAgRXg6IEN1c3RvbWVyLkFkZHJlc3MuU3RyZWV0IHJldHVybnMgdGhlIEFkZHJlc3Mgb2JqZWN0LlxyXG5cdGZ1bmN0aW9uIGdldEZpbmFsU3JjT2JqZWN0KGJpbmRpbmcpIHtcclxuXHRcdHZhciBzcmMgPSBiaW5kaW5nLmdldF9zb3VyY2UoKTtcclxuXHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGJpbmRpbmcuX3BhdGhBcnJheS5sZW5ndGggLSAxOyArK2kpIHtcclxuXHRcdFx0c3JjID0gc3JjW2JpbmRpbmcuX3BhdGhBcnJheVtpXV0gfHwgc3JjW1wiZ2V0X1wiICsgYmluZGluZy5fcGF0aEFycmF5W2ldXSgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBzcmM7XHJcblx0fVxyXG5cclxuXHRFeG9XZWIuVmlldy5nZXRGaW5hbFNyY09iamVjdCA9IGdldEZpbmFsU3JjT2JqZWN0O1xyXG5cclxuXHRmdW5jdGlvbiBnZXRGaW5hbFBhdGhTdGVwKGJpbmRpbmcpIHtcclxuXHRcdHJldHVybiBiaW5kaW5nLl9wYXRoQXJyYXlbYmluZGluZy5fcGF0aEFycmF5Lmxlbmd0aCAtIDFdO1xyXG5cdH1cclxuXHJcblx0RXhvV2ViLlZpZXcuZ2V0RmluYWxQYXRoU3RlcCA9IGdldEZpbmFsUGF0aFN0ZXA7XHJcblxyXG5cdGZ1bmN0aW9uIGdldEJpbmRpbmdJbmZvKGJpbmRpbmcpIHtcclxuXHRcdHZhciBzcmNPYmogPSBnZXRGaW5hbFNyY09iamVjdChiaW5kaW5nKTtcclxuXHJcblx0XHR2YXIgdGFyZ2V0O1xyXG5cdFx0dmFyIHByb3BlcnR5O1xyXG5cclxuXHRcdC8vIE9wdGlvbiBhZGFwdGVyIGRlZmVycyB0byBwYXJlbnQgYWRhcHRlclxyXG5cdFx0aWYgKHNyY09iaiBpbnN0YW5jZW9mIEV4b1dlYi5WaWV3Lk9wdGlvbkFkYXB0ZXIpIHtcclxuXHRcdFx0c3JjT2JqID0gc3JjT2JqLmdldF9wYXJlbnQoKTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoc3JjT2JqIGluc3RhbmNlb2YgRXhvV2ViLlZpZXcuQWRhcHRlcikge1xyXG5cdFx0XHR2YXIgY2hhaW4gPSBzcmNPYmouZ2V0X3Byb3BlcnR5Q2hhaW4oKTtcclxuXHRcdFx0cHJvcGVydHkgPSBjaGFpbi5sYXN0UHJvcGVydHkoKTtcclxuXHRcdFx0dGFyZ2V0ID0gY2hhaW4ubGFzdFRhcmdldChzcmNPYmouZ2V0X3RhcmdldCgpKTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKHNyY09iaiBpbnN0YW5jZW9mIEV4b1dlYi5Nb2RlbC5FbnRpdHkpIHtcclxuXHRcdFx0dmFyIHByb3BOYW1lID0gZ2V0RmluYWxQYXRoU3RlcChiaW5kaW5nKTtcclxuXHRcdFx0cHJvcGVydHkgPSBzcmNPYmoubWV0YS5wcm9wZXJ0eShwcm9wTmFtZSk7XHJcblx0XHRcdHRhcmdldCA9IHNyY09iajtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHR0YXJnZXQ6IHRhcmdldCxcclxuXHRcdFx0cHJvcGVydHk6IHByb3BlcnR5XHJcblx0XHR9O1xyXG5cdH1cclxuXHJcblx0RXhvV2ViLlZpZXcuZ2V0QmluZGluZ0luZm8gPSBnZXRCaW5kaW5nSW5mbztcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIFZhbGlkYXRpb25cclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHR2YXIgaXNFcnJvciA9IGZ1bmN0aW9uIChjb25kaXRpb24pIHtcclxuXHRcdHJldHVybiBjb25kaXRpb24udHlwZSBpbnN0YW5jZW9mIEV4b1dlYi5Nb2RlbC5Db25kaXRpb25UeXBlLkVycm9yO1xyXG5cdH07XHJcblxyXG5cdHZhciBpc1ZhbGlkYXRpb25Db25kaXRpb24gPSBmdW5jdGlvbiAoY29uZGl0aW9uKSB7XHJcblx0XHRyZXR1cm4gY29uZGl0aW9uLnR5cGUgaW5zdGFuY2VvZiBFeG9XZWIuTW9kZWwuQ29uZGl0aW9uVHlwZS5FcnJvciB8fCBjb25kaXRpb24udHlwZSBpbnN0YW5jZW9mIEV4b1dlYi5Nb2RlbC5Db25kaXRpb25UeXBlLldhcm5pbmc7XHJcblx0fTtcclxuXHJcblx0dmFyIG9uTWV0YUNvbmRpdGlvbnNDaGFuZ2VkID0gZnVuY3Rpb24gKHNlbmRlciwgYXJncywgcHJvcGVydHkpIHtcclxuXHRcdGlmIChpc1ZhbGlkYXRpb25Db25kaXRpb24oYXJncy5jb25kaXRpb25UYXJnZXQuY29uZGl0aW9uKSkge1xyXG5cdFx0XHQkKHRoaXMpLnRyaWdnZXIoXCJ2YWxpZGF0ZWRcIiwgW3NlbmRlci5jb25kaXRpb25zKHByb3BlcnR5KV0pO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdHZhciBvbkNvbmRpdGlvbnNDb2xsZWN0aW9uQ2hhbmdlZCA9IGZ1bmN0aW9uIChzZW5kZXIsIGFyZ3MpIHtcclxuXHRcdCQodGhpcykudHJpZ2dlcihcInZhbGlkYXRlZFwiLCBbc2VuZGVyLmZpbHRlcihpc1ZhbGlkYXRpb25Db25kaXRpb24pXSk7XHJcblx0fTtcclxuXHJcblx0dmFyIGVuc3VyZUluaXRlZCA9IGZ1bmN0aW9uIChlbGVtZW50LCB0cmFja0RhdGEpIHtcclxuXHRcdGlmICghd2luZG93LkV4b1dlYikge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyICRlbCA9IGpRdWVyeShlbGVtZW50KTtcclxuXHJcblx0XHRpZiAoJGVsLmF0dHIoXCJfX3ZhbGlkYXRpbmdcIikgPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHQvLyByZWdpc3RlciBmb3IgbW9kZWwgdmFsaWRhdGlvbiBldmVudHNcclxuXHRcdFx0dmFyIGJpbmRpbmdzID0gJGVsLmxpdmVCaW5kaW5ncygpO1xyXG5cclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBiaW5kaW5ncy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdHZhciBiaW5kaW5nID0gYmluZGluZ3NbaV07XHJcblx0XHRcdFx0dmFyIHNyY09iaiA9IEV4b1dlYi5WaWV3LmdldEZpbmFsU3JjT2JqZWN0KGJpbmRpbmcpO1xyXG5cdFx0XHRcdHZhciBwcm9wTmFtZSA9IEV4b1dlYi5WaWV3LmdldEZpbmFsUGF0aFN0ZXAoYmluZGluZyk7XHJcblxyXG5cdFx0XHRcdHZhciBtZXRhID0gc3JjT2JqLm1ldGEgfHwgc3JjT2JqO1xyXG5cclxuXHRcdFx0XHR2YXIgdmFsaWRhdGlvbkRhdGEgPSBudWxsO1xyXG5cclxuXHRcdFx0XHRpZiAobWV0YSBpbnN0YW5jZW9mIEV4b1dlYi5Nb2RlbC5PYmplY3RNZXRhKSB7XHJcblx0XHRcdFx0XHR2YXIgcHJvcGVydHkgPSBtZXRhLnR5cGUucHJvcGVydHkocHJvcE5hbWUpO1xyXG5cclxuXHRcdFx0XHRcdHZhciBtZXRhSGFuZGxlciA9IG9uTWV0YUNvbmRpdGlvbnNDaGFuZ2VkLmJpbmQoZWxlbWVudCkuc3BsaWNlQXJndW1lbnRzKDIsIDAsIHByb3BlcnR5KTtcclxuXHJcblx0XHRcdFx0XHRpZiAodHJhY2tEYXRhKSB7XHJcblx0XHRcdFx0XHRcdHZhbGlkYXRpb25EYXRhID0geyBpbnN0YW5jZTogeyB0eXBlOiBtZXRhLnR5cGUuZ2V0X2Z1bGxOYW1lKCksIGlkOiBtZXRhLmlkIH0sIGhhbmRsZXI6IG1ldGFIYW5kbGVyIH07XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0bWV0YS5hZGRDb25kaXRpb25zQ2hhbmdlZChtZXRhSGFuZGxlciwgcHJvcGVydHkpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmIChtZXRhICYmIG1ldGEuZ2V0X2NvbmRpdGlvbnMpIHtcclxuXHRcdFx0XHRcdHZhciBjb25kaXRpb25zID0gbWV0YS5nZXRfY29uZGl0aW9ucygpO1xyXG5cclxuXHRcdFx0XHRcdHZhciBjb2xsZWN0aW9uSGFuZGxlciA9IG9uQ29uZGl0aW9uc0NvbGxlY3Rpb25DaGFuZ2VkLmJpbmQoZWxlbWVudCk7XHJcblxyXG5cdFx0XHRcdFx0aWYgKHRyYWNrRGF0YSkge1xyXG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uRGF0YSA9IHsgY29sbGVjdGlvbjogY29uZGl0aW9ucywgaGFuZGxlcjogY29sbGVjdGlvbkhhbmRsZXIgfTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRFeG9XZWIuT2JzZXJ2ZXIuYWRkQ29sbGVjdGlvbkNoYW5nZWQoY29uZGl0aW9ucywgY29sbGVjdGlvbkhhbmRsZXIpO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0aWYgKHRyYWNrRGF0YSkge1xyXG5cdFx0XHRcdFx0JGVsLmRhdGEoXCJ2YWxpZGF0ZWRcIiwgdmFsaWRhdGlvbkRhdGEpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gZG9uJ3QgZG91YmxlIHJlZ2lzdGVyIGZvciBldmVudHNcclxuXHRcdFx0JGVsLmF0dHIoXCJfX3ZhbGlkYXRpbmdcIiwgdHJ1ZSk7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0alF1ZXJ5LmZuLnZhbGlkYXRlZCA9IGZ1bmN0aW9uIChmLCB0cmFja0RhdGEpIHtcclxuXHRcdHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XHJcblx0XHRcdGpRdWVyeSh0aGlzKS5iaW5kKCd2YWxpZGF0ZWQnLCBmKTtcclxuXHRcdFx0ZW5zdXJlSW5pdGVkKHRoaXMsIHRyYWNrRGF0YSk7XHJcblx0XHR9KTtcclxuXHJcblx0XHRyZXR1cm4gdGhpcztcclxuXHR9O1xyXG5cclxuXHQvLyBHZXRzIGFsbCBtb2RlbCBydWxlcyBhc3NvY2lhdGVkIHdpdGggdGhlIHByb3BlcnR5IGFuIGVsZW1lbnQgaXMgYm91bmQgdG9cclxuXHRqUXVlcnkuZm4ucnVsZXMgPSBmdW5jdGlvbiAocnVsZVR5cGUpIHtcclxuXHRcdGlmICghd2luZG93LlN5cyB8fCAhd2luZG93LkV4b1dlYiB8fCAhRXhvV2ViLk1vZGVsKSByZXR1cm4gW107XHJcblxyXG5cdFx0cmV0dXJuIGpRdWVyeSh0aGlzKS5saXZlQmluZGluZ3MoKVxyXG5cdFx0XHQubWFwKGZ1bmN0aW9uKGJpbmRpbmcpIHtcclxuXHRcdFx0XHRyZXR1cm4gRXhvV2ViLlZpZXcuZ2V0QmluZGluZ0luZm8oYmluZGluZyk7XHJcblx0XHRcdH0pLmZpbHRlcihmdW5jdGlvbihpbmZvKSB7XHJcblx0XHRcdFx0cmV0dXJuICEhaW5mby5wcm9wZXJ0eTtcclxuXHRcdFx0fSkubWFwKGZ1bmN0aW9uKGluZm8pIHtcclxuXHRcdFx0XHRyZXR1cm4gaW5mby5wcm9wZXJ0eS5ydWxlKHJ1bGVUeXBlKTtcclxuXHRcdFx0fSk7XHJcblx0fTtcclxuXHJcblx0alF1ZXJ5LmZuLmVycm9ycyA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdGlmICghd2luZG93LlN5cyB8fCAhd2luZG93LkV4b1dlYiB8fCAhRXhvV2ViLk1vZGVsKSByZXR1cm4gW107XHJcblxyXG5cdFx0cmV0dXJuIGpRdWVyeSh0aGlzKS5saXZlQmluZGluZ3MoKS5tYXBUb0FycmF5KGZ1bmN0aW9uIChiaW5kaW5nKSB7XHJcblxyXG5cdFx0XHR2YXIgc291cmNlID0gYmluZGluZy5nZXRfc291cmNlKCk7XHJcblx0XHRcdGlmIChzb3VyY2UgaW5zdGFuY2VvZiBFeG9XZWIuVmlldy5BZGFwdGVyKSB7XHJcblx0XHRcdFx0cmV0dXJuIHNvdXJjZS5nZXRfY29uZGl0aW9ucygpLmZpbHRlcihpc0Vycm9yKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR2YXIgaW5mbyA9IEV4b1dlYi5WaWV3LmdldEJpbmRpbmdJbmZvKGJpbmRpbmcpO1xyXG5cclxuXHRcdFx0XHQvLyBHdWFyZCBhZ2FpbnN0IG51bGwvdW5kZWZpbmVkIHRhcmdldC4gIFRoaXMgY291bGQgaGFwcGVuIGlmIHRoZSB0YXJnZXQgaXMgXHJcblx0XHRcdFx0Ly8gdW5kZWZpbmVkLCBvciBpZiB0aGUgcGF0aCBpcyBtdWx0aS1ob3AsIGFuZCB0aGUgZnVsbCBwYXRoIGlzIG5vdCBkZWZpbmVkLlxyXG5cdFx0XHRcdGlmICghaW5mby50YXJnZXQgfHwgIWluZm8ucHJvcGVydHkpIHJldHVybiBbXTtcclxuXHJcblx0XHRcdFx0cmV0dXJuIGluZm8udGFyZ2V0Lm1ldGEuY29uZGl0aW9ucyhpbmZvLnByb3BlcnR5KS5maWx0ZXIoaXNFcnJvcik7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH07XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBTZWxlY3RvcnNcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHR2YXIgZXhvV2ViQW5kTW9kZWwgPSBmYWxzZTtcclxuXHJcblx0alF1ZXJ5LmV4cHJbXCI6XCJdLnJ1bGUgPSBmdW5jdGlvbiAob2JqLCBpbmRleCwgbWV0YSwgc3RhY2spIHtcclxuXHRcdGlmIChleG9XZWJBbmRNb2RlbCA9PT0gZmFsc2UpIHtcclxuXHRcdFx0aWYgKCEod2luZG93LkV4b1dlYiAmJiBFeG9XZWIuTW9kZWwpKVxyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0ZXhvV2ViQW5kTW9kZWwgPSB0cnVlO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBydWxlTmFtZSA9IG1ldGFbM107XHJcblx0XHR2YXIgcnVsZVR5cGUgPSBFeG9XZWIuTW9kZWwuUnVsZVtydWxlTmFtZV07XHJcblxyXG5cdFx0aWYgKCFydWxlVHlwZSkge1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJVbmtub3duIHJ1bGUgaW4gc2VsZWN0b3I6IFwiICsgcnVsZU5hbWUpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBqUXVlcnkob2JqKS5ydWxlcyhydWxlVHlwZSkubGVuZ3RoID4gMDtcclxuXHR9O1xyXG5cclxuXHRqUXVlcnkuZXhwcltcIjpcIl0uYm91bmQgPSBmdW5jdGlvbiAob2JqLCBpbmRleCwgbWV0YSwgc3RhY2spIHtcclxuXHRcdGlmIChleG9XZWJBbmRNb2RlbCA9PT0gZmFsc2UpIHtcclxuXHRcdFx0aWYgKCEod2luZG93LkV4b1dlYiAmJiBFeG9XZWIuTW9kZWwpKVxyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0ZXhvV2ViQW5kTW9kZWwgPSB0cnVlO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBqUXVlcnkob2JqKS5saXZlQmluZGluZ3MoKS5sZW5ndGggPiAwO1xyXG5cdH07XHJcblxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0Ly8gaGVscGVycyBmb3Igd29ya2luZyB3aXRoIGNvbnRyb2xzXHJcblx0dmFyIGRhdGF2aWV3UHJlcmVxcyA9IGZhbHNlO1xyXG5cdGpRdWVyeS5leHByW1wiOlwiXS5kYXRhdmlldyA9IGZ1bmN0aW9uIChvYmosIGluZGV4LCBtZXRhLCBzdGFjaykge1xyXG5cdFx0aWYgKGRhdGF2aWV3UHJlcmVxcyA9PT0gZmFsc2UpIHtcclxuXHRcdFx0aWYgKCEod2luZG93LlN5cyAhPT0gdW5kZWZpbmVkICYmIFN5cy5VSSAhPT0gdW5kZWZpbmVkICYmIG9iai5jb250cm9sICE9PSB1bmRlZmluZWQgJiYgU3lzLlVJLkRhdGFWaWV3ICE9PSB1bmRlZmluZWQpKVxyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0ZGF0YXZpZXdQcmVyZXFzID0gdHJ1ZTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gb2JqLmNvbnRyb2wgaW5zdGFuY2VvZiBTeXMuVUkuRGF0YVZpZXc7XHJcblx0fTtcclxuXHJcblx0dmFyIGNvbnRlbnRQcmVyZXFzID0gZmFsc2U7XHJcblx0alF1ZXJ5LmV4cHJbXCI6XCJdLmNvbnRlbnQgPSBmdW5jdGlvbiAob2JqLCBpbmRleCwgbWV0YSwgc3RhY2spIHtcclxuXHRcdGlmIChjb250ZW50UHJlcmVxcyA9PT0gZmFsc2UpIHtcclxuXHRcdFx0aWYgKCEod2luZG93LkV4b1dlYiAhPT0gdW5kZWZpbmVkICYmIEV4b1dlYi5VSSAhPT0gdW5kZWZpbmVkICYmIG9iai5jb250cm9sICE9PSB1bmRlZmluZWQgJiYgRXhvV2ViLlVJLkNvbnRlbnQgIT09IHVuZGVmaW5lZCAmJiBvYmouY29udHJvbCkpXHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cclxuXHRcdFx0Y29udGVudFByZXJlcXMgPSB0cnVlO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBvYmouY29udHJvbCBpbnN0YW5jZW9mIEV4b1dlYi5VSS5Db250ZW50O1xyXG5cdH07XHJcblxyXG5cdHZhciB0b2dnbGVQcmVyZXFzID0gZmFsc2U7XHJcblx0alF1ZXJ5LmV4cHJbXCI6XCJdLnRvZ2dsZSA9IGZ1bmN0aW9uIChvYmosIGluZGV4LCBtZXRhLCBzdGFjaykge1xyXG5cdFx0aWYgKHRvZ2dsZVByZXJlcXMgPT09IGZhbHNlKSB7XHJcblx0XHRcdGlmICghKHdpbmRvdy5FeG9XZWIgIT09IHVuZGVmaW5lZCAmJiBFeG9XZWIuVUkgIT09IHVuZGVmaW5lZCAmJiBvYmouY29udHJvbCAhPT0gdW5kZWZpbmVkICYmIEV4b1dlYi5VSS5Ub2dnbGUgIT09IHVuZGVmaW5lZCAmJiBvYmouY29udHJvbCkpXHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cclxuXHRcdFx0dG9nZ2xlUHJlcmVxcyA9IHRydWU7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIG9iai5jb250cm9sIGluc3RhbmNlb2YgRXhvV2ViLlVJLlRvZ2dsZTtcclxuXHR9O1xyXG5cclxuXHRqUXVlcnkuZXhwcltcIjpcIl0uY29udHJvbCA9IGZ1bmN0aW9uIChvYmosIGluZGV4LCBtZXRhLCBzdGFjaykge1xyXG5cdFx0dmFyIHR5cGVOYW1lID0gbWV0YVszXTtcclxuXHRcdHZhciBqc3R5cGUgPSBuZXcgRnVuY3Rpb24oXCJ7cmV0dXJuIFwiICsgdHlwZU5hbWUgKyBcIjt9XCIpO1xyXG5cclxuXHRcdHJldHVybiBvYmouY29udHJvbCBpbnN0YW5jZW9mIGpzdHlwZSgpO1xyXG5cdH07XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBIZWxwZXJzXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0alF1ZXJ5LmZuLmNvbnRyb2wgPSBmdW5jdGlvbiBqUXVlcnkkY29udHJvbChwcm9wTmFtZSwgcHJvcFZhbHVlKSB7XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5nZXQoMCkuY29udHJvbDtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMSkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5nZXQoMCkuY29udHJvbFtcImdldF9cIiArIHByb3BOYW1lXSgpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMuZWFjaChmdW5jdGlvbiBqUXVlcnkkY29udHJvbCRvbmUoaW5kZXgsIGVsZW1lbnQpIHtcclxuXHRcdFx0XHR0aGlzLmNvbnRyb2xbXCJzZXRfXCIgKyBwcm9wTmFtZV0ocHJvcFZhbHVlKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0alF1ZXJ5LmZuLmNvbW1hbmRzID0gZnVuY3Rpb24galF1ZXJ5JGNvbW1hbmRzKGNvbW1hbmRzKSB7XHJcblx0XHR2YXIgY29udHJvbCA9IHRoaXMuY29udHJvbCgpO1xyXG5cdFx0Y29udHJvbC5hZGRfY29tbWFuZChmdW5jdGlvbiBqUXVlcnkkY29tbWFuZHMkY29tbWFuZChzZW5kZXIsIGFyZ3MpIHtcclxuXHRcdFx0dmFyIGhhbmRsZXIgPSBjb21tYW5kc1thcmdzLmdldF9jb21tYW5kTmFtZSgpXTtcclxuXHRcdFx0aWYgKGhhbmRsZXIpIHtcclxuXHRcdFx0XHRoYW5kbGVyKHNlbmRlciwgYXJncyk7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH07XHJcblxyXG5cdC8vIEdldHMgYWxsIFN5cy5CaW5kaW5ncyBmb3IgYW4gZWxlbWVudFxyXG5cdGpRdWVyeS5mbi5saXZlQmluZGluZ3MgPSBmdW5jdGlvbiBqUXVlcnkkbGl2ZUJpbmRpbmdzKCkge1xyXG5cdFx0dmFyIGJpbmRpbmdzID0gW107XHJcblx0XHR0aGlzLmVhY2goZnVuY3Rpb24galF1ZXJ5JGxpdmVCaW5kaW5ncyRvbmUoKSB7XHJcblx0XHRcdGlmICh0aGlzLl9fbXNhamF4YmluZGluZ3MpXHJcblx0XHRcdFx0QXJyYXkuYWRkUmFuZ2UoYmluZGluZ3MsIHRoaXMuX19tc2FqYXhiaW5kaW5ncyk7XHJcblx0XHR9KTtcclxuXHRcdHJldHVybiBiaW5kaW5ncztcclxuXHR9O1xyXG5cclxuXHQvLyAjZW5kcmVnaW9uXHJcblxyXG5cdC8vICNyZWdpb24gRXZlclxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdC8vIENhY2hlIGxpc3RzIG9mIGV2ZXIgaGFuZGxlcnMgYnkgdHlwZVxyXG5cdHZhciBldmVySGFuZGxlcnMgPSB7IGFkZGVkOiBbXSwgZGVsZXRlZDogW10sIGJvdW5kOiBbXSwgdW5ib3VuZDogW10gfTtcclxuXHJcblx0dmFyIHByb2Nlc3NFbGVtZW50cyA9IGZ1bmN0aW9uIHByb2Nlc3NFbGVtZW50cyhjb250YWluZXIsIGVscywgYWN0aW9uLCBzb3VyY2UpIHtcclxuXHRcdC8vIERldGVybWluZSBpZiB0aGUgaW5wdXQgaXMgYW4gYXJyYXlcclxuXHRcdHZhciBpc0FyciA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChlbHMpID09PSBcIltvYmplY3QgQXJyYXldXCIsXHJcblxyXG5cdFx0XHQvLyBUaGUgbnVtYmVyIG9mIGVsZW1lbnRzIHRvIHByb2Nlc3NcclxuXHRcdFx0bnVtRWxzID0gaXNBcnIgPyBlbHMubGVuZ3RoIDogMSxcclxuXHJcblx0XHRcdC8vIENhY2hlIG9mIGhhbmRsZXJzIGZvciB0aGUgYWN0aW9uIGluIHF1ZXN0aW9uXHJcblx0XHRcdGFjdGlvbkhhbmRsZXJzLFxyXG5cclxuXHRcdFx0Ly8gVGhlIG51bWJlciBvZiB1bmZpbHRlcmVkIGhhbmRsZXJzXHJcblx0XHRcdG51bUFjdGlvbkhhbmRsZXJzLFxyXG5cclxuXHRcdFx0Ly8gSGFuZGxlcnMgdGhhdCBhcmUgYXBwbGljYWJsZSB0byB0aGlzIGNhbGxcclxuXHRcdFx0aGFuZGxlcnMsXHJcblxyXG5cdFx0XHQvLyBUaGUgbnVtYmVyIG9mIGNhY2hlZCBoYW5kbGVyc1xyXG5cdFx0XHRudW1IYW5kbGVycyxcclxuXHJcblx0XHRcdC8vIERldGVybWluZXMgd2hldGhlciB0byBzZWFyY2ggY2hpbGRyZW4gZm9yIG1hdGNoZXNcclxuXHRcdFx0ZG9TZWFyY2gsXHJcblxyXG5cdFx0XHQvLyBFbGVtZW50IGl0ZXJhdGlvbiBpbmRleCB2YXJpYWJsZVxyXG5cdFx0XHRpID0gMCxcclxuXHJcblx0XHRcdC8vIEVsZW1lbnQgaXRlcmF0aW9uIGl0ZW0gdmFyaWFibGVcclxuXHRcdFx0ZWwsXHJcblxyXG5cdFx0XHQvLyBPcHRpbWl6YXRpb246IGNhY2hlIHRoZSBqUXVlcnkgb2JqZWN0IGZvciB0aGUgZWxlbWVudFxyXG5cdFx0XHQkZWwsXHJcblxyXG5cdFx0XHQvLyBIYW5kbGVyIGl0ZXJhdGlvbiBpbmRleCB2YXJpYWJsZVxyXG5cdFx0XHRqLFxyXG5cclxuXHRcdFx0Ly8gSGFuZGxlciBpdGVyYXRpb24gaXRlbSB2YXJpYWJsZVxyXG5cdFx0XHRoYW5kbGVyO1xyXG5cclxuXHRcdGlmIChudW1FbHMgPT09IDApIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdGFjdGlvbkhhbmRsZXJzID0gZXZlckhhbmRsZXJzW2FjdGlvbl07XHJcblxyXG5cdFx0Ly8gRmlsdGVyIGJhc2VkIG9uIHNvdXJjZSBhbmQgY29udGV4dFxyXG5cdFx0aSA9IC0xO1xyXG5cdFx0bnVtQWN0aW9uSGFuZGxlcnMgPSBhY3Rpb25IYW5kbGVycy5sZW5ndGg7XHJcblx0XHRoYW5kbGVycyA9IFtdO1xyXG5cdFx0d2hpbGUgKCsraSA8IG51bUFjdGlvbkhhbmRsZXJzKSB7XHJcblx0XHRcdGhhbmRsZXIgPSBhY3Rpb25IYW5kbGVyc1tpXTtcclxuXHJcblx0XHRcdC8vIElmIGEgaGFuZGxlciBzb3VyY2UgaXMgc3BlY2lmaWVkIHRoZW4gZmlsdGVyIGJ5IHRoZSBzb3VyY2VcclxuXHRcdFx0aWYgKGhhbmRsZXIuc291cmNlICYmIGhhbmRsZXIuc291cmNlICE9PSBzb3VyY2UpIHtcclxuXHRcdFx0XHRjb250aW51ZTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gSWYgYSBoYW5kbGVyIGNvbnRleHQgaXMgc3BlY2lmaWVkIHRoZW4gc2VlIGlmIGl0IGNvbnRhaW5zIHRoZSBnaXZlbiBjb250YWluZXIsIG9yIGVxdWFscyBpZiBjaGlsZHJlbiB3ZXJlIHBhc3NlZCBpblxyXG5cdFx0XHRpZiAoaGFuZGxlci5jb250ZXh0ICYmICEoKGlzQXJyICYmIGhhbmRsZXIuY29udGV4dCA9PT0gY29udGFpbmVyKSB8fCBqUXVlcnkuY29udGFpbnMoaGFuZGxlci5jb250ZXh0LCBjb250YWluZXIpKSkge1xyXG5cdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRoYW5kbGVycy5wdXNoKGhhbmRsZXIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdG51bUhhbmRsZXJzID0gaGFuZGxlcnMubGVuZ3RoO1xyXG5cclxuXHRcdGlmIChudW1IYW5kbGVycyA9PT0gMCkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gT25seSBwZXJmb3JtIGRlc2NlbmRlbnQgc2VhcmNoIGZvciBhZGRlZC9kZWxldGVkIGFjdGlvbnMsIHNpbmNlIHRoaXNcclxuXHRcdC8vIGRvZXNuJ3QgbWFrZSBzZW5zZSBmb3IgYm91bmQvdW5ib3VuZCwgd2hpY2ggYXJlIHNwZWNpZmljIHRvIGFuIGVsZW1lbnQuXHJcblx0XHRkb1NlYXJjaCA9IGFjdGlvbiA9PT0gXCJhZGRlZFwiIHx8IGFjdGlvbiA9PT0gXCJkZWxldGVkXCI7XHJcblxyXG5cdFx0aSA9IC0xO1xyXG5cdFx0d2hpbGUgKCsraSA8IG51bUVscykge1xyXG5cdFx0XHRlbCA9IGlzQXJyID8gZWxzW2ldIDogZWxzO1xyXG5cclxuXHRcdFx0Ly8gT25seSBwcm9jZXNzIGVsZW1lbnRzXHJcblx0XHRcdGlmIChlbC5ub2RlVHlwZSA9PT0gMSkge1xyXG5cdFx0XHRcdGogPSAwO1xyXG5cdFx0XHRcdCRlbCA9IGpRdWVyeShlbCk7XHJcblxyXG5cdFx0XHRcdHdoaWxlIChqIDwgbnVtSGFuZGxlcnMpIHtcclxuXHRcdFx0XHRcdGhhbmRsZXIgPSBoYW5kbGVyc1tqKytdO1xyXG5cclxuXHRcdFx0XHRcdC8vIFRlc3Qgcm9vdFxyXG5cdFx0XHRcdFx0aWYgKCRlbC5pcyhoYW5kbGVyLnNlbGVjdG9yKSkge1xyXG5cdFx0XHRcdFx0XHRoYW5kbGVyLmFjdGlvbi5hcHBseShlbCwgWzAsIGVsXSk7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0aWYgKGRvU2VhcmNoICYmIGVsLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHRcdFx0Ly8gVGVzdCBjaGlsZHJlblxyXG5cdFx0XHRcdFx0XHQkZWwuZmluZChoYW5kbGVyLnNlbGVjdG9yKS5lYWNoKGhhbmRsZXIuYWN0aW9uKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHR2YXIgaW50ZXJjZXB0aW5nQm91bmQgPSBmYWxzZTtcclxuXHR2YXIgaW50ZXJjZXB0aW5nVGVtcGxhdGVzID0gZmFsc2U7XHJcblx0dmFyIGludGVyY2VwdGluZ1dlYkZvcm1zID0gZmFsc2U7XHJcblx0dmFyIGludGVyY2VwdGluZ1RvZ2dsZSA9IGZhbHNlO1xyXG5cdHZhciBpbnRlcmNlcHRpbmdDb250ZW50ID0gZmFsc2U7XHJcblx0dmFyIHBhcnRpYWxQYWdlTG9hZE9jY3VycmVkID0gZmFsc2U7XHJcblxyXG5cdGZ1bmN0aW9uIGVuc3VyZUludGVyY2VwdGluZygpIHtcclxuXHRcdGlmICghaW50ZXJjZXB0aW5nQm91bmQgJiYgd2luZG93LlN5cyAmJiBTeXMuQmluZGluZyAmJiBTeXMuVUkgJiYgU3lzLlVJLlRlbXBsYXRlQ29udGV4dCkge1xyXG5cdFx0XHR2YXIgYWRkQmluZGluZyA9IFN5cy5CaW5kaW5nLnByb3RvdHlwZS5fYWRkQmluZGluZztcclxuXHRcdFx0aWYgKCFhZGRCaW5kaW5nKSB7XHJcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiQ291bGQgbm90IGZpbmQgQmluZGluZy5fYWRkQmluZGluZyBtZXRob2QgdG8gb3ZlcnJpZGUuXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdFN5cy5CaW5kaW5nLnByb3RvdHlwZS5fYWRkQmluZGluZyA9IGZ1bmN0aW9uIGFkZEJpbmRpbmckd3JhcChlbGVtZW50KSB7XHJcblx0XHRcdFx0YWRkQmluZGluZy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0XHRcdHZhciBjdHggPSB0aGlzLl90ZW1wbGF0ZUNvbnRleHQ7XHJcblx0XHRcdFx0aWYgKGN0eC5fY29tcGxldGVkICYmIGN0eC5fY29tcGxldGVkLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHRcdGN0eC5hZGRfaW5zdGFudGlhdGVkKGZ1bmN0aW9uIGFkZEJpbmRpbmckY29udGV4dEluc3RhbnRpYXRlZCgpIHtcclxuXHRcdFx0XHRcdFx0cHJvY2Vzc0VsZW1lbnRzKGVsZW1lbnQsIGVsZW1lbnQsIFwiYm91bmRcIik7XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRwcm9jZXNzRWxlbWVudHMoZWxlbWVudCwgZWxlbWVudCwgXCJib3VuZFwiKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH07XHJcblx0XHRcdHZhciBkaXNwb3NlQmluZGluZ3MgPSBTeXMuQmluZGluZy5fZGlzcG9zZUJpbmRpbmdzO1xyXG5cdFx0XHRpZiAoIWRpc3Bvc2VCaW5kaW5ncykge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBmaW5kIEJpbmRpbmcuX2Rpc3Bvc2VCaW5kaW5ncyBtZXRob2QgdG8gb3ZlcnJpZGUuXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdFN5cy5CaW5kaW5nLl9kaXNwb3NlQmluZGluZ3MgPSBmdW5jdGlvbiBkaXNwb3NlQmluZGluZ3Mkd3JhcCgpIHtcclxuXHRcdFx0XHRkaXNwb3NlQmluZGluZ3MuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuXHRcdFx0XHRwcm9jZXNzRWxlbWVudHModGhpcywgdGhpcywgXCJ1bmJvdW5kXCIpO1xyXG5cdFx0XHR9O1xyXG5cdFx0XHRpbnRlcmNlcHRpbmdCb3VuZCA9IHRydWU7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKCFpbnRlcmNlcHRpbmdUZW1wbGF0ZXMgJiYgd2luZG93LlN5cyAmJiBTeXMuVUkgJiYgU3lzLlVJLlRlbXBsYXRlKSB7XHJcblx0XHRcdHZhciBpbnN0YW50aWF0ZUluQmFzZSA9IFN5cy5VSS5UZW1wbGF0ZS5wcm90b3R5cGUuaW5zdGFudGlhdGVJbjtcclxuXHRcdFx0aWYgKCFpbnN0YW50aWF0ZUluQmFzZSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBmaW5kIFRlbXBsYXRlLmluc3RhbnRpYXRlSW4gbWV0aG9kIHRvIG92ZXJyaWRlLlwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRTeXMuVUkuVGVtcGxhdGUucHJvdG90eXBlLmluc3RhbnRpYXRlSW4gPSBmdW5jdGlvbiBpbnN0YW50aWF0ZUluJHdyYXAoKSB7XHJcblx0XHRcdFx0dmFyIGNvbnRleHQgPSBpbnN0YW50aWF0ZUluQmFzZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0XHRcdGlmIChjb250ZXh0Lm5vZGVzLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHRcdHByb2Nlc3NFbGVtZW50cyhjb250ZXh0LmNvbnRhaW5lckVsZW1lbnQsIGNvbnRleHQubm9kZXMsIFwiYWRkZWRcIiwgXCJ0ZW1wbGF0ZVwiKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0cmV0dXJuIGNvbnRleHQ7XHJcblx0XHRcdH07XHJcblx0XHRcdC8vIGludGVyY2VwdCBTeXMuVUkuRGF0YVZpZXcuX2NsZWFyQ29udGFpbmVycyBjYWxsZWQgY29uZGl0aW9uYWxseSBkdXJpbmcgZGlzcG9zZSgpIGFuZCByZWZyZXNoKCkuXHJcblx0XHRcdC8vIGRpc3Bvc2UgaXMgdG9vIGxhdGUgYmVjYXVzZSB0aGUgbm9kZXMgd2lsbCBoYXZlIGJlZW4gY2xlYXJlZCBvdXQuXHJcblx0XHRcdFN5cy5VSS5EYXRhVmlldy5wcm90b3R5cGUuX2NsZWFyQ29udGFpbmVycyA9IGZ1bmN0aW9uIF9jbGVhckNvbnRhaW5lcnMkb3ZlcnJpZGUocGxhY2Vob2xkZXJzLCBzdGFydCwgY291bnQpIHtcclxuXHRcdFx0XHR2YXIgaSwgbGVuLCBub2Rlcywgc3RhcnROb2RlLCBlbmROb2RlLCBjb250ZXh0O1xyXG5cdFx0XHRcdGZvciAoaSA9IHN0YXJ0IHx8IDAsIGxlbiA9IGNvdW50ID8gKHN0YXJ0ICsgY291bnQpIDogdGhpcy5fY29udGV4dHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0XHRcdGNvbnRleHQgPSB0aGlzLl9jb250ZXh0c1tpXTtcclxuXHRcdFx0XHRcdG5vZGVzID0gY29udGV4dC5ub2RlcztcclxuXHRcdFx0XHRcdGlmIChub2Rlcy5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0XHRcdHByb2Nlc3NFbGVtZW50cyhjb250ZXh0LmNvbnRhaW5lckVsZW1lbnQsIG5vZGVzLCBcImRlbGV0ZWRcIiwgXCJ0ZW1wbGF0ZVwiKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGlmIChjb3VudCkge1xyXG5cdFx0XHRcdFx0XHRpZiAoIXN0YXJ0Tm9kZSkge1xyXG5cdFx0XHRcdFx0XHRcdHN0YXJ0Tm9kZSA9IG5vZGVzWzBdO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGlmIChub2Rlcy5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0XHRcdFx0ZW5kTm9kZSA9IG5vZGVzW25vZGVzLmxlbmd0aCAtIDFdO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGZvciAoaSA9IDAsIGxlbiA9IHBsYWNlaG9sZGVycy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG5cdFx0XHRcdFx0dmFyIHBoID0gcGxhY2Vob2xkZXJzW2ldLFxyXG5cdFx0XHRcdFx0XHRjb250YWluZXIgPSBwaCA/IHBoLnBhcmVudE5vZGUgOiB0aGlzLmdldF9lbGVtZW50KCk7XHJcblx0XHRcdFx0XHRpZiAoIWNvdW50IHx8IChzdGFydE5vZGUgJiYgZW5kTm9kZSkpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5fY2xlYXJDb250YWluZXIoY29udGFpbmVyLCBwaCwgc3RhcnROb2RlLCBlbmROb2RlLCB0cnVlKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Zm9yIChpID0gc3RhcnQgfHwgMCwgbGVuID0gY291bnQgPyAoc3RhcnQgKyBjb3VudCkgOiB0aGlzLl9jb250ZXh0cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG5cdFx0XHRcdFx0dmFyIGN0eCA9IHRoaXMuX2NvbnRleHRzW2ldO1xyXG5cdFx0XHRcdFx0Y3R4Lm5vZGVzID0gbnVsbDtcclxuXHRcdFx0XHRcdGN0eC5kaXNwb3NlKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9O1xyXG5cdFx0XHRTeXMuVUkuRGF0YVZpZXcucHJvdG90eXBlLl9jbGVhckNvbnRhaW5lciA9IGZ1bmN0aW9uIF9jbGVhckNvbnRhaW5lciRvdmVycmlkZShjb250YWluZXIsIHBsYWNlaG9sZGVyLCBzdGFydE5vZGUsIGVuZE5vZGUsIHN1cHByZXNzRXZlbnQpIHtcclxuXHRcdFx0XHR2YXIgY291bnQgPSBwbGFjZWhvbGRlciA/IHBsYWNlaG9sZGVyLl9fbXNhamF4cGhjb3VudCA6IC0xO1xyXG5cdFx0XHRcdGlmICgoY291bnQgPiAtMSkgJiYgcGxhY2Vob2xkZXIpIHBsYWNlaG9sZGVyLl9fbXNhamF4cGhjb3VudCA9IDA7XHJcblx0XHRcdFx0aWYgKGNvdW50IDwgMCkge1xyXG5cdFx0XHRcdFx0aWYgKHBsYWNlaG9sZGVyKSB7XHJcblx0XHRcdFx0XHRcdGNvbnRhaW5lci5yZW1vdmVDaGlsZChwbGFjZWhvbGRlcik7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRpZiAoIXN1cHByZXNzRXZlbnQpIHtcclxuXHRcdFx0XHRcdFx0aWYgKGNvbnRhaW5lci5jaGlsZE5vZGVzLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHRcdFx0XHRwcm9jZXNzRWxlbWVudHMoY29udGFpbmVyLCBjb250YWluZXIuY2hpbGROb2RlcywgXCJkZWxldGVkXCIsIFwidGVtcGxhdGVcIik7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGlmICghc3RhcnROb2RlKSB7XHJcblx0XHRcdFx0XHRcdFN5cy5BcHBsaWNhdGlvbi5kaXNwb3NlRWxlbWVudChjb250YWluZXIsIHRydWUpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0dmFyIGNsZWFyZWQgPSBmYWxzZTtcclxuXHRcdFx0XHRcdGlmICghc3RhcnROb2RlKSB7XHJcblx0XHRcdFx0XHRcdHRyeSB7XHJcblx0XHRcdFx0XHRcdFx0Y29udGFpbmVyLmlubmVySFRNTCA9IFwiXCI7XHJcblx0XHRcdFx0XHRcdFx0Y2xlYXJlZCA9IHRydWU7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0Y2F0Y2ggKGVycikgeyB9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRpZiAoIWNsZWFyZWQpIHtcclxuXHRcdFx0XHRcdFx0dmFyIGNoaWxkID0gc3RhcnROb2RlIHx8IGNvbnRhaW5lci5maXJzdENoaWxkLCBuZXh0Q2hpbGQ7XHJcblx0XHRcdFx0XHRcdHdoaWxlIChjaGlsZCkge1xyXG5cdFx0XHRcdFx0XHRcdG5leHRDaGlsZCA9IGNoaWxkID09PSBlbmROb2RlID8gbnVsbCA6IGNoaWxkLm5leHRTaWJsaW5nO1xyXG5cdFx0XHRcdFx0XHRcdFN5cy5BcHBsaWNhdGlvbi5kaXNwb3NlRWxlbWVudChjaGlsZCwgZmFsc2UpO1xyXG5cdFx0XHRcdFx0XHRcdGNvbnRhaW5lci5yZW1vdmVDaGlsZChjaGlsZCk7XHJcblx0XHRcdFx0XHRcdFx0Y2hpbGQgPSBuZXh0Q2hpbGQ7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGlmIChwbGFjZWhvbGRlcikge1xyXG5cdFx0XHRcdFx0XHRjb250YWluZXIuYXBwZW5kQ2hpbGQocGxhY2Vob2xkZXIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmIChjb3VudCA+IDApIHtcclxuXHRcdFx0XHRcdHZhciBpLCBsLCBzdGFydCwgY2hpbGRyZW4gPSBjb250YWluZXIuY2hpbGROb2RlcztcclxuXHRcdFx0XHRcdGZvciAoaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuXHRcdFx0XHRcdFx0aWYgKGNoaWxkcmVuW2ldID09PSBwbGFjZWhvbGRlcikge1xyXG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRzdGFydCA9IGkgLSBjb3VudDtcclxuXHRcdFx0XHRcdGZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XHJcblx0XHRcdFx0XHRcdHZhciBlbGVtZW50ID0gY2hpbGRyZW5bc3RhcnRdO1xyXG5cdFx0XHRcdFx0XHRwcm9jZXNzRWxlbWVudHMoZWxlbWVudCwgZWxlbWVudCwgXCJkZWxldGVkXCIsIFwidGVtcGxhdGVcIik7XHJcblx0XHRcdFx0XHRcdFN5cy5BcHBsaWNhdGlvbi5kaXNwb3NlRWxlbWVudChlbGVtZW50LCBmYWxzZSk7XHJcblx0XHRcdFx0XHRcdGNvbnRhaW5lci5yZW1vdmVDaGlsZChlbGVtZW50KTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH07XHJcblx0XHRcdGludGVyY2VwdGluZ1RlbXBsYXRlcyA9IHRydWU7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKCFpbnRlcmNlcHRpbmdXZWJGb3JtcyAmJiB3aW5kb3cuU3lzICYmIFN5cy5XZWJGb3JtcyAmJiBTeXMuV2ViRm9ybXMuUGFnZVJlcXVlc3RNYW5hZ2VyKSB7XHJcblx0XHRcdFN5cy5XZWJGb3Jtcy5QYWdlUmVxdWVzdE1hbmFnZXIuZ2V0SW5zdGFuY2UoKS5hZGRfcGFnZUxvYWRpbmcoZnVuY3Rpb24gUGFnZVJlcXVlc3RNYW5hZ2VyJGV2ZXJfZGVsZXRlZChzZW5kZXIsIGV2dCkge1xyXG5cdFx0XHRcdHBhcnRpYWxQYWdlTG9hZE9jY3VycmVkID0gdHJ1ZTtcclxuXHRcdFx0XHR2YXIgdXBkYXRpbmcgPSBldnQuZ2V0X3BhbmVsc1VwZGF0aW5nKCk7XHJcblx0XHRcdFx0aWYgKHVwZGF0aW5nLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHRcdHByb2Nlc3NFbGVtZW50cyhudWxsLCB1cGRhdGluZywgXCJkZWxldGVkXCIsIFwidXBkYXRlUGFuZWxcIik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdFx0U3lzLldlYkZvcm1zLlBhZ2VSZXF1ZXN0TWFuYWdlci5nZXRJbnN0YW5jZSgpLmFkZF9wYWdlTG9hZGVkKGZ1bmN0aW9uIFBhZ2VSZXF1ZXN0TWFuYWdlciRldmVyX2FkZGVkKHNlbmRlciwgZXZ0KSB7XHJcblx0XHRcdFx0Ly8gT25seSBwcm9jZXNzIGVsZW1lbnRzIGZvciB1cGRhdGUgcGFuZWxzIHRoYXQgd2VyZSBhZGRlZCBpZiB3ZSBoYXZlIGFjdHVhbGx5IGRvbmUgYSBwYXJ0aWFsIHVwZGF0ZS5cclxuXHRcdFx0XHQvLyBUaGlzIGlzIG5lZWRlZCBzbyB0aGF0IHRoZSBcImV2ZXJcIiBoYW5kbGVyIGlzIG5vdCBjYWxsZWQgdHdpY2Ugd2hlbiBhIHBhbmVsIGlzIGFkZGVkIHRvIHRoZSBwYWdlIG9uIGZpcnN0IHBhZ2UgbG9hZC5cclxuXHRcdFx0XHRpZiAocGFydGlhbFBhZ2VMb2FkT2NjdXJyZWQpIHtcclxuXHRcdFx0XHRcdHZhciBjcmVhdGVkID0gZXZ0LmdldF9wYW5lbHNDcmVhdGVkKCk7XHJcblx0XHRcdFx0XHRpZiAoY3JlYXRlZC5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0XHRcdHByb2Nlc3NFbGVtZW50cyhudWxsLCBjcmVhdGVkLCBcImFkZGVkXCIsIFwidXBkYXRlUGFuZWxcIik7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHR2YXIgdXBkYXRlZCA9IGV2dC5nZXRfcGFuZWxzVXBkYXRlZCgpO1xyXG5cdFx0XHRcdGlmICh1cGRhdGVkLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHRcdHByb2Nlc3NFbGVtZW50cyhudWxsLCB1cGRhdGVkLCBcImFkZGVkXCIsIFwidXBkYXRlUGFuZWxcIik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdFx0aW50ZXJjZXB0aW5nV2ViRm9ybXMgPSB0cnVlO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmICghaW50ZXJjZXB0aW5nVG9nZ2xlICYmIHdpbmRvdy5FeG9XZWIgJiYgRXhvV2ViLlVJICYmIEV4b1dlYi5VSS5Ub2dnbGUpIHtcclxuXHRcdFx0dmFyIHVuZG9SZW5kZXIgPSBFeG9XZWIuVUkuVG9nZ2xlLnByb3RvdHlwZS51bmRvX3JlbmRlcjtcclxuXHRcdFx0aWYgKCF1bmRvUmVuZGVyKSB7XHJcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiQ291bGQgbm90IGZpbmQgVG9nZ2xlLnVuZG9fcmVuZGVyIG1ldGhvZCB0byBvdmVycmlkZS5cIik7XHJcblx0XHRcdH1cclxuXHRcdFx0RXhvV2ViLlVJLlRvZ2dsZS5wcm90b3R5cGUudW5kb19yZW5kZXIgPSBmdW5jdGlvbiBUb2dnbGUkdW5kb19yZW5kZXIkd3JhcCgpIHtcclxuXHRcdFx0XHR2YXIgY2hpbGRyZW4gPSB0aGlzLl9lbGVtZW50LmNoaWxkcmVuO1xyXG5cdFx0XHRcdGlmIChjaGlsZHJlbi5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0XHRwcm9jZXNzRWxlbWVudHModGhpcy5fZWxlbWVudCwgY2hpbGRyZW4sIFwiZGVsZXRlZFwiLCBcInRlbXBsYXRlXCIpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHR1bmRvUmVuZGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcblx0XHRcdH07XHJcblx0XHRcdHZhciB0b2dnbGVEaXNwb3NlID0gRXhvV2ViLlVJLlRvZ2dsZS5wcm90b3R5cGUuZG9fZGlzcG9zZTtcclxuXHRcdFx0aWYgKCF0b2dnbGVEaXNwb3NlKSB7XHJcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiQ291bGQgbm90IGZpbmQgVG9nZ2xlLmRvX2Rpc3Bvc2UgbWV0aG9kIHRvIG92ZXJyaWRlLlwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRFeG9XZWIuVUkuVG9nZ2xlLnByb3RvdHlwZS5kb19kaXNwb3NlID0gZnVuY3Rpb24gVG9nZ2xlJGRvX2Rpc3Bvc2Ukd3JhcCgpIHtcclxuXHRcdFx0XHR2YXIgY2hpbGRyZW4gPSB0aGlzLl9lbGVtZW50LmNoaWxkcmVuO1xyXG5cdFx0XHRcdGlmIChjaGlsZHJlbi5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0XHRwcm9jZXNzRWxlbWVudHModGhpcy5fZWxlbWVudCwgY2hpbGRyZW4sIFwiZGVsZXRlZFwiLCBcInRlbXBsYXRlXCIpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHR0b2dnbGVEaXNwb3NlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcblx0XHRcdH07XHJcblx0XHRcdGludGVyY2VwdGluZ1RvZ2dsZSA9IHRydWU7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKCFpbnRlcmNlcHRpbmdDb250ZW50ICYmIHdpbmRvdy5FeG9XZWIgJiYgRXhvV2ViLlVJICYmIEV4b1dlYi5VSS5Db250ZW50KSB7XHJcblx0XHRcdHZhciBfcmVuZGVyID0gRXhvV2ViLlVJLkNvbnRlbnQucHJvdG90eXBlLl9yZW5kZXI7XHJcblx0XHRcdGlmICghX3JlbmRlcikge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBmaW5kIENvbnRlbnQuX3JlbmRlciBtZXRob2QgdG8gb3ZlcnJpZGUuXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdEV4b1dlYi5VSS5Db250ZW50LnByb3RvdHlwZS5fcmVuZGVyID0gZnVuY3Rpb24gQ29udGVudCRfcmVuZGVyJHdyYXAoKSB7XHJcblx0XHRcdFx0aWYgKHRoaXMuX2VsZW1lbnQpIHtcclxuXHRcdFx0XHRcdHZhciBjaGlsZHJlbiA9IHRoaXMuX2VsZW1lbnQuY2hpbGRyZW47XHJcblx0XHRcdFx0XHRpZiAoY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdFx0XHRwcm9jZXNzRWxlbWVudHModGhpcy5fZWxlbWVudCwgY2hpbGRyZW4sIFwiZGVsZXRlZFwiLCBcInRlbXBsYXRlXCIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRfcmVuZGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcblx0XHRcdH07XHJcblx0XHRcdGludGVyY2VwdGluZ0NvbnRlbnQgPSB0cnVlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0dmFyIHJvb3RDb250ZXh0ID0galF1ZXJ5KFwiYm9keVwiKS5jb250ZXh0O1xyXG5cclxuXHR2YXIgYWRkRXZlckhhbmRsZXIgPSBmdW5jdGlvbiBhZGRFdmVySGFuZGxlcihjb250ZXh0LCBzZWxlY3RvciwgdHlwZSwgc291cmNlLCBhY3Rpb24pIHtcclxuXHRcdHZhciBoYW5kbGVycywgaSwgbGVuLCBoYW5kbGVyLCBleGlzdGluZ0hhbmRsZXIsIGV4aXN0aW5nRm47XHJcblx0XHRpID0gMDtcclxuXHRcdGhhbmRsZXJzID0gZXZlckhhbmRsZXJzW3R5cGVdO1xyXG5cdFx0bGVuID0gaGFuZGxlcnMubGVuZ3RoO1xyXG5cdFx0d2hpbGUgKGkgPCBsZW4pIHtcclxuXHRcdFx0ZXhpc3RpbmdIYW5kbGVyID0gaGFuZGxlcnNbaSsrXTtcclxuXHRcdFx0aWYgKGV4aXN0aW5nSGFuZGxlci5jb250ZXh0ID09PSBjb250ZXh0ICYmIGV4aXN0aW5nSGFuZGxlci5zb3VyY2UgPT09IHNvdXJjZSAmJiBleGlzdGluZ0hhbmRsZXIuc2VsZWN0b3IgPT09IHNlbGVjdG9yKSB7XHJcblx0XHRcdFx0aGFuZGxlciA9IGV4aXN0aW5nSGFuZGxlcjtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0aWYgKCFoYW5kbGVyKSB7XHJcblx0XHRcdGhhbmRsZXIgPSB7IHNlbGVjdG9yOiBzZWxlY3RvciwgYWN0aW9uOiBhY3Rpb24gfTtcclxuXHRcdFx0aWYgKGNvbnRleHQpIHtcclxuXHRcdFx0XHRoYW5kbGVyLmNvbnRleHQgPSBjb250ZXh0O1xyXG5cdFx0XHR9XHJcblx0XHRcdGhhbmRsZXJzLnB1c2goaGFuZGxlcik7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChoYW5kbGVyLmFjdGlvbi5hZGQpIHtcclxuXHRcdFx0aGFuZGxlci5hY3Rpb24uYWRkKGFjdGlvbik7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0ZXhpc3RpbmdGbiA9IGhhbmRsZXIuYWN0aW9uO1xyXG5cdFx0XHRpZiAod2luZG93LkV4b1dlYikge1xyXG5cdFx0XHRcdGhhbmRsZXIuYWN0aW9uID0gRXhvV2ViLkZ1bmN0b3IoKTtcclxuXHRcdFx0XHRoYW5kbGVyLmFjdGlvbi5hZGQoZXhpc3RpbmdGbik7XHJcblx0XHRcdFx0aGFuZGxlci5hY3Rpb24uYWRkKGFjdGlvbik7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0aGFuZGxlci5hY3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRleGlzdGluZ0ZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcblx0XHRcdFx0XHRhY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuXHRcdFx0XHR9O1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0Ly8gTWF0Y2hlcyBlbGVtZW50cyBhcyB0aGV5IGFyZSBkeW5hbWljYWxseSBhZGRlZCB0byB0aGUgRE9NXHJcblx0alF1ZXJ5LmZuLmV2ZXIgPSBmdW5jdGlvbiBqUXVlcnkkZXZlcihvcHRzKSB7XHJcblxyXG5cdFx0Ly8gVGhlIG5vbi1zZWxlY3RvciBjb250ZXh0IHRoYXQgd2FzIHBhc3NlZCBpbnRvIHRoaXMgalF1ZXJ5IG9iamVjdFxyXG5cdFx0dmFyIHF1ZXJ5Q29udGV4dCxcclxuXHJcblx0XHRcdC8vIFRoZSBzZWxlY3RvciB0aGF0IHdhcyBzcGVjaWZpZWQgb24gdGhlIHF1ZXJ5XHJcblx0XHRcdHF1ZXJ5U2VsZWN0b3IgPSB0aGlzLnNlbGVjdG9yLFxyXG5cclxuXHRcdFx0Ly8gVGhlIGpRdWVyeSBvYmplY3RzIHRoYXQgdGhlIGFjdGlvbiBtYXkgYmUgaW1tZWRpYXRlbHkgcGVyZm9ybWVkIGZvclxyXG5cdFx0XHRib3VuZEltbWVkaWF0ZSxcclxuXHRcdFx0YWRkZWRJbW1lZGlhdGUsXHJcblxyXG5cdFx0XHQvLyBUaGUgb3B0aW9ucyB0aGUgd2lsbCBiZSB1c2VkIHRvIGFkZCBoYW5kbGVyc1xyXG5cdFx0XHRvcHRpb25zO1xyXG5cclxuXHRcdC8vIE9wdGltaXphdGlvbjogb25seSBtYWtlIGEgcmVjb3JkIG9mIHRoZSBjb250ZXh0IGlmIGl0J3Mgbm90IHRoZSByb290IGNvbnRleHRcclxuXHRcdGlmICh0aGlzLmNvbnRleHQgIT09IHJvb3RDb250ZXh0KSB7XHJcblx0XHRcdHF1ZXJ5Q29udGV4dCA9IHRoaXMuY29udGV4dDtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBIYW5kbGUgbGVnYWN5IGZvcm1cclxuXHRcdGlmICh0eXBlb2YgKG9wdHMpID09PSBcImZ1bmN0aW9uXCIpIHtcclxuXHRcdFx0YWRkZWRJbW1lZGlhdGUgPSB0aGlzO1xyXG5cdFx0XHRvcHRpb25zID0ge1xyXG5cdFx0XHRcdGNvbnRleHQ6IHF1ZXJ5Q29udGV4dCxcclxuXHRcdFx0XHRzZWxlY3RvcjogcXVlcnlTZWxlY3RvcixcclxuXHRcdFx0XHRhZGRlZDogb3B0cyxcclxuXHRcdFx0XHRkZWxldGVkOiBhcmd1bWVudHNbMV1cclxuXHRcdFx0fTtcclxuXHRcdH1cclxuXHRcdFx0Ly8gVXNlIG9wdGlvbnMgYXJndW1lbnQgZGlyZWN0bHlcclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRvcHRpb25zID0gb3B0cztcclxuXHRcdFx0Ly8gRGV0ZWN0IG5vbi1zdXBwb3J0ZWQgb3B0aW9uc1xyXG5cdFx0XHRpZiAod2luZG93LkV4b1dlYikge1xyXG5cdFx0XHRcdGZvciAodmFyIG9wdCBpbiBvcHRpb25zKSB7XHJcblx0XHRcdFx0XHRpZiAob3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShvcHQpICYmICEvXihzZWxlY3Rvcnxzb3VyY2V8YWRkZWR8ZGVsZXRlZHxib3VuZHx1bmJvdW5kKSQvLnRlc3Qob3B0KSkge1xyXG5cdFx0XHRcdFx0XHRsb2dXYXJuaW5nKFwiVW5leHBlY3RlZCBvcHRpb24gXFxcIlwiICsgb3B0ICsgXCJcXFwiXCIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHQvLyBTZXQgdGhlIGNvbnRleHQgaWYgaXQgd2FzIHNwZWNpZmllZFxyXG5cdFx0XHRpZiAocXVlcnlDb250ZXh0KSB7XHJcblx0XHRcdFx0b3B0aW9ucy5jb250ZXh0ID0gcXVlcnlDb250ZXh0O1xyXG5cdFx0XHR9XHJcblx0XHRcdC8vIEZpbHRlciB0aGUgaW1tZWRpYXRlIG9iamVjdCBpZiBpdCB3aWxsIGJlIHVzZWQgdG8gaW52b2tlIGltbWVkaWF0ZWx5IChhZGRlZC9ib3VuZClcclxuXHRcdFx0aWYgKG9wdGlvbnMuYWRkZWQpIHtcclxuXHRcdFx0XHRhZGRlZEltbWVkaWF0ZSA9IHRoaXM7XHJcblx0XHRcdFx0aWYgKG9wdGlvbnMuc2VsZWN0b3IpIHtcclxuXHRcdFx0XHRcdGFkZGVkSW1tZWRpYXRlID0gYWRkZWRJbW1lZGlhdGUuZmluZChvcHRpb25zLnNlbGVjdG9yKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKG9wdGlvbnMuYm91bmQpIHtcclxuXHRcdFx0XHRib3VuZEltbWVkaWF0ZSA9IHRoaXM7XHJcblx0XHRcdFx0aWYgKG9wdGlvbnMuc2VsZWN0b3IpIHtcclxuXHRcdFx0XHRcdGJvdW5kSW1tZWRpYXRlID0gYm91bmRJbW1lZGlhdGUuZmluZChvcHRpb25zLnNlbGVjdG9yKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Ym91bmRJbW1lZGlhdGUgPSBib3VuZEltbWVkaWF0ZS5maWx0ZXIoXCI6Ym91bmRcIik7XHJcblx0XHRcdH1cclxuXHRcdFx0Ly8gTWVyZ2UgdGhlIHF1ZXJ5IHNlbGVjdG9yIHdpdGggdGhlIG9wdGlvbnMgc2VsZWN0b3JcclxuXHRcdFx0aWYgKHF1ZXJ5U2VsZWN0b3IpIHtcclxuXHRcdFx0XHRpZiAob3B0aW9ucy5zZWxlY3Rvcikge1xyXG5cdFx0XHRcdFx0b3B0aW9ucy5zZWxlY3RvciA9IHF1ZXJ5U2VsZWN0b3IucmVwbGFjZSgvLC9nLCBcIiBcIiArIG9wdGlvbnMuc2VsZWN0b3IgKyBcIixcIikgKyBcIiBcIiArIG9wdGlvbnMuc2VsZWN0b3I7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0b3B0aW9ucy5zZWxlY3RvciA9IHF1ZXJ5U2VsZWN0b3I7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKCFvcHRpb25zLnNlbGVjdG9yKSB7XHJcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiRXZlciByZXF1aXJlcyBhIHNlbGVjdG9yXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh3aW5kb3cuRXhvV2ViICYmIG9wdGlvbnMuc291cmNlKSB7XHJcblx0XHRcdFx0aWYgKCEob3B0aW9ucy5hZGRlZCB8fCBvcHRpb25zLmRlbGV0ZWQpKSB7XHJcblx0XHRcdFx0XHRsb2dXYXJuaW5nKFwiVGhlIHNvdXJjZSBvcHRpb24gb25seSBhcHBsaWVzIHRvIGFkZGVkIGFuZCBkZWxldGVkIGhhbmRsZXJzXCIpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAob3B0aW9ucy5zb3VyY2UgIT09IFwidGVtcGxhdGVcIiAmJiBvcHRpb25zLnNvdXJjZSAhPT0gXCJ1cGRhdGVQYW5lbFwiKSB7XHJcblx0XHRcdFx0XHRsb2dXYXJuaW5nKFwiVW5leHBlY3RlZCBzb3VyY2UgXFxcIlwiICsgb3B0aW9ucy5zb3VyY2UgKyBcIlxcXCJcIik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gQWRkIGV2ZXIgaGFuZGxlcnNcclxuXHRcdGlmIChvcHRpb25zLmFkZGVkKSB7XHJcblx0XHRcdGlmIChhZGRlZEltbWVkaWF0ZS5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0YWRkZWRJbW1lZGlhdGUuZWFjaChvcHRpb25zLmFkZGVkKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRhZGRFdmVySGFuZGxlcihvcHRpb25zLmNvbnRleHQsIG9wdGlvbnMuc2VsZWN0b3IsIFwiYWRkZWRcIiwgb3B0aW9ucy5zb3VyY2UsIG9wdGlvbnMuYWRkZWQpO1xyXG5cdFx0fVxyXG5cdFx0aWYgKG9wdGlvbnMuZGVsZXRlZCkge1xyXG5cdFx0XHRhZGRFdmVySGFuZGxlcihvcHRpb25zLmNvbnRleHQsIG9wdGlvbnMuc2VsZWN0b3IsIFwiZGVsZXRlZFwiLCBvcHRpb25zLnNvdXJjZSwgb3B0aW9ucy5kZWxldGVkKTtcclxuXHRcdH1cclxuXHRcdGlmIChvcHRpb25zLmJvdW5kKSB7XHJcblx0XHRcdGlmIChib3VuZEltbWVkaWF0ZS5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0Ym91bmRJbW1lZGlhdGUuZWFjaChvcHRpb25zLmJvdW5kKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRhZGRFdmVySGFuZGxlcihvcHRpb25zLmNvbnRleHQsIG9wdGlvbnMuc2VsZWN0b3IsIFwiYm91bmRcIiwgb3B0aW9ucy5zb3VyY2UsIG9wdGlvbnMuYm91bmQpO1xyXG5cdFx0fVxyXG5cdFx0aWYgKG9wdGlvbnMudW5ib3VuZCkge1xyXG5cdFx0XHRhZGRFdmVySGFuZGxlcihvcHRpb25zLmNvbnRleHQsIG9wdGlvbnMuc2VsZWN0b3IsIFwidW5ib3VuZFwiLCBvcHRpb25zLnNvdXJjZSwgb3B0aW9ucy51bmJvdW5kKTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBFbnN1cmUgdGhhdCBjb2RlIGlzIGJlaW5nIG92ZXJyaWRlbiB0byBjYWxsIGV2ZXIgaGFuZGxlcnMgd2hlcmUgYXBwcm9wcmlhdGVcclxuXHRcdGVuc3VyZUludGVyY2VwdGluZygpO1xyXG5cclxuXHRcdC8vIFJlYWxseSBzaG91bGRuJ3QgY2hhaW4gY2FsbHMgYi9jIG9ubHkgZWxlbWVudHMgY3VycmVudGx5IGluIHRoZSBET00gd291bGQgYmUgYWZmZWN0ZWRcclxuXHRcdHJldHVybiBudWxsO1xyXG5cdH07XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBFeG9XZWIuRG90TmV0LldlYlNlcnZpY2VcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHR2YXIgd2ViU2VydmljZUNvbmZpZyA9IHtcclxuXHRcdC8qXHJcblx0XHQgKiBTcGVjaWZ5IHRoZSBhcHBsaWNhdGlvbidzIHJvb3QgVVJMLiBPdGhlcndpc2UgaXQgaXMgYXNzdW1lZCB0aGF0XHJcblx0XHQgKiB0aGUgcm9vdCBpcyB0aGUgVVJMIHVwIHRvIHRoZSBmaXJzdCBmb3J3YXJkIHNsYXNoICcvJy5cclxuXHRcdCAqL1xyXG5cdFx0YXBwUm9vdDogbnVsbCxcclxuXHJcblx0XHQvKlxyXG5cdFx0ICogSWYgc2V0IHRvIHRydWUsIHdoZW4gcmVxdWVzdHMgYXJlIHNlbnQgdGhleSB3aWxsIHVzZSB0aGUgdGV4dCBcIlNhdmVcIiwgXCJSb3VuZHRyaXBcIiwgb3IgdGhlXHJcblx0XHQgKiBzcGVjaWZpYyBtZXRob2QgbmFtZSBhcyBhbiBhbGlhcyBmb3IgXCJSZXF1ZXN0XCIuICBJZiB0aGUgbWV0aG9kIG5hbWUgd291bGQgY29sbGlkZSB3aXRoXHJcblx0XHQgKiBhbm90aGVyIHByb2NlZHVyZSAoXCJHZXRUeXBlXCIgb3IgXCJMb2dFcnJvclwiKSwgdGhlbiBcIlJlcXVlc3RcIiB3aWxsIGJlIHVzZWQgaW5zdGVhZC5cclxuXHRcdCAqL1xyXG5cdFx0YWxpYXNSZXF1ZXN0czogZmFsc2VcclxuXHR9O1xyXG5cclxuXHRFeG9XZWIuRG90TmV0LmNvbmZpZyA9IHdlYlNlcnZpY2VDb25maWc7XHJcblxyXG5cdHZhciBwYXRoID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lO1xyXG5cdHZhciBpZHggPSBwYXRoLmxhc3RJbmRleE9mKFwiL1wiKTtcclxuXHJcblx0aWYgKGlkeCA+IDAgJiYgaWR4IDwgcGF0aC5sZW5ndGggLSAxKSB7XHJcblx0XHRwYXRoID0gcGF0aC5zdWJzdHJpbmcoMCwgaWR4ICsgMSk7XHJcblx0fVxyXG5cdGVsc2UgaWYgKGlkeCA9PT0gMCAmJiBwYXRoLmxlbmd0aCA+IDEpIHtcclxuXHRcdHBhdGggKz0gXCIvXCI7XHJcblx0fVxyXG5cclxuXHR2YXIgZm10ID0gd2luZG93LmxvY2F0aW9uLnBvcnQgPyBcInswfS8vezF9OnsyfVwiIDogXCJ7MH0vL3sxfVwiO1xyXG5cdHZhciBob3N0ID0gJGZvcm1hdChmbXQsIHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCwgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lLCB3aW5kb3cubG9jYXRpb24ucG9ydCk7XHJcblxyXG5cdGZ1bmN0aW9uIGdldFBhdGgoKSB7XHJcblx0XHRyZXR1cm4gaG9zdCArICh3ZWJTZXJ2aWNlQ29uZmlnLmFwcFJvb3QgfHwgcGF0aCkgKyBcIkV4b1dlYi5heGRcIjtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHNlbmRSZXF1ZXN0KG9wdGlvbnMpIHtcclxuXHRcdC8vIEluY2x1ZGUgY29uZmlnIGRhdGEgaW4gcmVxdWVzdFxyXG5cdFx0b3B0aW9ucy5kYXRhLmNvbmZpZyA9IHdlYlNlcnZpY2VDb25maWc7XHJcblxyXG5cdFx0alF1ZXJ5LmFqYXgoe1xyXG5cdFx0XHR1cmw6IGdldFBhdGgoKSArIFwiL1wiICsgb3B0aW9ucy5wYXRoLFxyXG5cdFx0XHR0eXBlOiBvcHRpb25zLnR5cGUsXHJcblx0XHRcdGRhdGE6IEpTT04uc3RyaW5naWZ5KG9wdGlvbnMuZGF0YSksXHJcblx0XHRcdHByb2Nlc3NEYXRhOiBmYWxzZSxcclxuXHRcdFx0ZGF0YVR5cGU6IFwidGV4dFwiLFxyXG5cdFx0XHRjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcblx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3VsdCkge1xyXG5cdFx0XHRcdG9wdGlvbnMub25TdWNjZXNzKEpTT04ucGFyc2UocmVzdWx0KSk7XHJcblx0XHRcdH0sXHJcblx0XHRcdGVycm9yOiBmdW5jdGlvbihyZXN1bHQpIHtcclxuXHRcdFx0XHR2YXIgZXJyb3IgPSB7IG1lc3NhZ2U6IHJlc3VsdC5zdGF0dXNUZXh0IH07XHJcblx0XHRcdFx0dHJ5XHJcblx0XHRcdFx0e1xyXG5cdFx0XHRcdFx0ZXJyb3IgPSBKU09OLnBhcnNlKHJlc3VsdC5yZXNwb25zZVRleHQpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRjYXRjaChlKSB7fVxyXG5cdFx0XHRcdG9wdGlvbnMub25GYWlsdXJlKGVycm9yKTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHRFeG9XZWIuTWFwcGVyLnNldEV2ZW50UHJvdmlkZXIoZnVuY3Rpb24gKGV2ZW50VHlwZSwgZXZlbnRJbnN0YW5jZSwgZXZlbnQsIHBhdGhzLCBjaGFuZ2VzLCBzY29wZVF1ZXJpZXMsIG9uU3VjY2Vzcywgb25GYWlsdXJlKSB7XHJcblx0XHRzZW5kUmVxdWVzdCh7XHJcblx0XHRcdHR5cGU6IFwiUG9zdFwiLFxyXG5cdFx0XHRwYXRoOiB3ZWJTZXJ2aWNlQ29uZmlnLmFsaWFzUmVxdWVzdHMgJiYgZXZlbnRUeXBlICE9PSBcIkdldFR5cGVcIiAmJiBldmVudFR5cGUgIT09IFwiTG9nRXJyb3JcIiA/IGV2ZW50VHlwZSA6IFwiUmVxdWVzdFwiLFxyXG5cdFx0XHRkYXRhOiB7XHJcblx0XHRcdFx0ZXZlbnRzOiBbeyB0eXBlOiBldmVudFR5cGUsIGluY2x1ZGU6IHBhdGhzLCBpbnN0YW5jZTogZXZlbnRJbnN0YW5jZSwgZXZlbnQ6IGV2ZW50IH1dLFxyXG5cdFx0XHRcdHF1ZXJpZXM6IHNjb3BlUXVlcmllcyxcclxuXHRcdFx0XHRjaGFuZ2VzOiBjaGFuZ2VzXHJcblx0XHRcdH0sXHJcblx0XHRcdG9uU3VjY2Vzczogb25TdWNjZXNzLFxyXG5cdFx0XHRvbkZhaWx1cmU6IG9uRmFpbHVyZVxyXG5cdFx0fSk7XHJcblx0fSk7XHJcblxyXG5cdEV4b1dlYi5NYXBwZXIuc2V0Um91bmR0cmlwUHJvdmlkZXIoZnVuY3Rpb24gKHJvb3QsIHBhdGhzLCBjaGFuZ2VzLCBzY29wZVF1ZXJpZXMsIG9uU3VjY2Vzcywgb25GYWlsdXJlKSB7XHJcblx0XHR2YXIgcXVlcmllcyA9IFtdO1xyXG5cclxuXHRcdGlmIChyb290KSB7XHJcblx0XHRcdHF1ZXJpZXMucHVzaCh7XHJcblx0XHRcdFx0ZnJvbTogcm9vdC50eXBlLFxyXG5cdFx0XHRcdGlkczogW3Jvb3QuaWRdLFxyXG5cdFx0XHRcdGluY2x1ZGU6IHBhdGhzLFxyXG5cdFx0XHRcdGluU2NvcGU6IHRydWUsXHJcblx0XHRcdFx0Zm9yTG9hZDogdHJ1ZVxyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHJcblx0XHRxdWVyaWVzLmFkZFJhbmdlKHNjb3BlUXVlcmllcyk7XHJcblxyXG5cdFx0c2VuZFJlcXVlc3Qoe1xyXG5cdFx0XHR0eXBlOiBcIlBvc3RcIixcclxuXHRcdFx0cGF0aDogd2ViU2VydmljZUNvbmZpZy5hbGlhc1JlcXVlc3RzID8gXCJSb3VuZHRyaXBcIiA6IFwiUmVxdWVzdFwiLFxyXG5cdFx0XHRkYXRhOiB7XHJcblx0XHRcdFx0Y2hhbmdlczogY2hhbmdlcyxcclxuXHRcdFx0XHRxdWVyaWVzOiBxdWVyaWVzXHJcblx0XHRcdH0sXHJcblx0XHRcdG9uU3VjY2Vzczogb25TdWNjZXNzLFxyXG5cdFx0XHRvbkZhaWx1cmU6IG9uRmFpbHVyZVxyXG5cdFx0fSk7XHJcblx0fSk7XHJcblxyXG5cdEV4b1dlYi5NYXBwZXIuc2V0T2JqZWN0UHJvdmlkZXIoZnVuY3Rpb24gKHR5cGUsIGlkcywgcGF0aHMsIGluU2NvcGUsIGNoYW5nZXMsIHNjb3BlUXVlcmllcywgb25TdWNjZXNzLCBvbkZhaWx1cmUpIHtcclxuXHRcdHNlbmRSZXF1ZXN0KHtcclxuXHRcdFx0dHlwZTogXCJQb3N0XCIsXHJcblx0XHRcdHBhdGg6IHdlYlNlcnZpY2VDb25maWcuYWxpYXNSZXF1ZXN0cyA/IFwiTG9hZE9iamVjdFwiIDogXCJSZXF1ZXN0XCIsXHJcblx0XHRcdGRhdGE6IHtcclxuXHRcdFx0XHRxdWVyaWVzOlt7XHJcblx0XHRcdFx0XHRmcm9tOiB0eXBlLFxyXG5cdFx0XHRcdFx0aWRzOiBpZHMsXHJcblx0XHRcdFx0XHRpbmNsdWRlOiBwYXRocyxcclxuXHRcdFx0XHRcdGluU2NvcGU6IGluU2NvcGUsXHJcblx0XHRcdFx0XHRmb3JMb2FkOiB0cnVlXHJcblx0XHRcdFx0fV0uY29uY2F0KHNjb3BlUXVlcmllcyksXHJcblx0XHRcdFx0Y2hhbmdlczpjaGFuZ2VzXHJcblx0XHRcdH0sXHJcblx0XHRcdG9uU3VjY2Vzczogb25TdWNjZXNzLFxyXG5cdFx0XHRvbkZhaWx1cmU6IG9uRmFpbHVyZVxyXG5cdFx0fSk7XHJcblx0fSk7XHJcblxyXG5cdEV4b1dlYi5NYXBwZXIuc2V0UXVlcnlQcm92aWRlcihmdW5jdGlvbiAocXVlcmllcywgY2hhbmdlcywgc2NvcGVRdWVyaWVzLCBvblN1Y2Nlc3MsIG9uRmFpbHVyZSkge1xyXG5cdFx0c2VuZFJlcXVlc3Qoe1xyXG5cdFx0XHR0eXBlOiBcIlBvc3RcIixcclxuXHRcdFx0cGF0aDogd2ViU2VydmljZUNvbmZpZy5hbGlhc1JlcXVlc3RzID8gXCJRdWVyeVwiIDogXCJSZXF1ZXN0XCIsXHJcblx0XHRcdGRhdGE6IHtcclxuXHRcdFx0XHRjaGFuZ2VzOiBjaGFuZ2VzLFxyXG5cdFx0XHRcdHF1ZXJpZXM6IHF1ZXJpZXMuY29uY2F0KHNjb3BlUXVlcmllcylcclxuXHRcdFx0fSxcclxuXHRcdFx0b25TdWNjZXNzOiBvblN1Y2Nlc3MsXHJcblx0XHRcdG9uRmFpbHVyZTogb25GYWlsdXJlXHJcblx0XHR9KTtcclxuXHR9KTtcclxuXHJcblx0RXhvV2ViLk1hcHBlci5zZXRTYXZlUHJvdmlkZXIoZnVuY3Rpb24gKHJvb3QsIGNoYW5nZXMsIHNjb3BlUXVlcmllcywgb25TdWNjZXNzLCBvbkZhaWx1cmUpIHtcclxuXHRcdHNlbmRSZXF1ZXN0KHtcclxuXHRcdFx0dHlwZTogXCJQb3N0XCIsXHJcblx0XHRcdHBhdGg6IHdlYlNlcnZpY2VDb25maWcuYWxpYXNSZXF1ZXN0cyA/IFwiU2F2ZVwiIDogXCJSZXF1ZXN0XCIsXHJcblx0XHRcdGRhdGE6IHtcclxuXHRcdFx0XHRldmVudHM6W3t0eXBlOiBcIlNhdmVcIiwgaW5zdGFuY2U6IHJvb3R9XSxcclxuXHRcdFx0XHRxdWVyaWVzOiBzY29wZVF1ZXJpZXMsXHJcblx0XHRcdFx0Y2hhbmdlczpjaGFuZ2VzXHJcblx0XHRcdH0sXHJcblx0XHRcdG9uU3VjY2Vzczogb25TdWNjZXNzLFxyXG5cdFx0XHRvbkZhaWx1cmU6IG9uRmFpbHVyZVxyXG5cdFx0fSk7XHJcblx0fSk7XHJcblxyXG5cdEV4b1dlYi5NYXBwZXIuc2V0TGlzdFByb3ZpZGVyKGZ1bmN0aW9uIChvd25lclR5cGUsIG93bmVySWQsIHBhdGhzLCBjaGFuZ2VzLCBzY29wZVF1ZXJpZXMsIG9uU3VjY2Vzcywgb25GYWlsdXJlKSB7XHJcblx0XHRzZW5kUmVxdWVzdCh7XHJcblx0XHRcdHR5cGU6IFwiUG9zdFwiLFxyXG5cdFx0XHRwYXRoOiB3ZWJTZXJ2aWNlQ29uZmlnLmFsaWFzUmVxdWVzdHMgPyBcIkxvYWRMaXN0XCIgOiBcIlJlcXVlc3RcIixcclxuXHRcdFx0ZGF0YToge1xyXG5cdFx0XHRcdHF1ZXJpZXM6IFt7XHJcblx0XHRcdFx0XHRmcm9tOiBvd25lclR5cGUsXHJcblx0XHRcdFx0XHRpZHM6IG93bmVySWQgPT09IG51bGwgPyBbXSA6IFtvd25lcklkXSxcclxuXHRcdFx0XHRcdGluY2x1ZGU6IHBhdGhzLFxyXG5cdFx0XHRcdFx0aW5TY29wZTogZmFsc2UsXHJcblx0XHRcdFx0XHRmb3JMb2FkOiB0cnVlXHJcblx0XHRcdFx0fV0uY29uY2F0KHNjb3BlUXVlcmllcyksXHJcblx0XHRcdFx0Y2hhbmdlczogY2hhbmdlc1xyXG5cdFx0XHR9LFxyXG5cdFx0XHRvblN1Y2Nlc3M6IG9uU3VjY2VzcyxcclxuXHRcdFx0b25GYWlsdXJlOiBvbkZhaWx1cmVcclxuXHRcdH0pO1xyXG5cdH0pO1xyXG5cclxuXHRFeG9XZWIuTWFwcGVyLnNldFR5cGVQcm92aWRlcihmdW5jdGlvbiAodHlwZXMsIG9uU3VjY2Vzcywgb25GYWlsdXJlKSB7XHJcblx0XHRpZiAodHlwZXMubGVuZ3RoID09PSAxKSB7XHJcblx0XHRcdHZhciBkYXRhID0geyB0eXBlOiB0eXBlc1swXSwgY29uZmlnOiB3ZWJTZXJ2aWNlQ29uZmlnfTtcclxuXHJcblx0XHRcdGlmIChFeG9XZWIuY2FjaGVIYXNoKSB7XHJcblx0XHRcdFx0ZGF0YS5jYWNoZWhhc2ggPSBFeG9XZWIuY2FjaGVIYXNoO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRTeXMuTmV0LldlYlNlcnZpY2VQcm94eS5pbnZva2UoZ2V0UGF0aCgpLCBcIkdldFR5cGVcIiwgdHJ1ZSwgZGF0YSwgb25TdWNjZXNzLCBvbkZhaWx1cmUsIG51bGwsIDEwMDAwMDAsIGZhbHNlLCBudWxsKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRzZW5kUmVxdWVzdCh7XHJcblx0XHRcdFx0dHlwZTogXCJQb3N0XCIsXHJcblx0XHRcdFx0cGF0aDogd2ViU2VydmljZUNvbmZpZy5hbGlhc1JlcXVlc3RzID8gXCJHZXRUeXBlc1wiIDogXCJSZXF1ZXN0XCIsXHJcblx0XHRcdFx0ZGF0YTogeyB0eXBlczogdHlwZXMgfSxcclxuXHRcdFx0XHRvblN1Y2Nlc3M6IG9uU3VjY2VzcyxcclxuXHRcdFx0XHRvbkZhaWx1cmU6IG9uRmFpbHVyZVxyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0dmFyIGxvZ2dpbmdFcnJvciA9IGZhbHNlO1xyXG5cdEV4b1dlYi5zZXRMb2dFcnJvclByb3ZpZGVyKGZ1bmN0aW9uIChlcnJvckRhdGEsIG9uU3VjY2Vzcywgb25GYWlsdXJlKSB7XHJcblx0XHRpZiAobG9nZ2luZ0Vycm9yID09PSBmYWxzZSkge1xyXG5cdFx0XHR0cnkge1xyXG5cdFx0XHRcdGxvZ2dpbmdFcnJvciA9IHRydWU7XHJcblx0XHRcdFx0U3lzLk5ldC5XZWJTZXJ2aWNlUHJveHkuaW52b2tlKFxyXG5cdFx0XHRcdFx0Z2V0UGF0aCgpLFxyXG5cdFx0XHRcdFx0XCJMb2dFcnJvclwiLFxyXG5cdFx0XHRcdFx0ZmFsc2UsXHJcblx0XHRcdFx0XHRlcnJvckRhdGEsXHJcblx0XHRcdFx0XHRmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdGlmIChvblN1Y2Nlc3MpIHtcclxuXHRcdFx0XHRcdFx0XHRvblN1Y2Nlc3MuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fSxcclxuXHRcdFx0XHRcdGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0Ly8gRG9uJ3QgbG9nIGVycm9ycyB0aGF0IG9jY3VyIHdoZW4gdHJ5aW5nIHRvIGxvZyBhbiBlcnJvci5cclxuXHRcdFx0XHRcdFx0aWYgKG9uRmFpbHVyZSkge1xyXG5cdFx0XHRcdFx0XHRcdG9uRmFpbHVyZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9LFxyXG5cdFx0XHRcdFx0bnVsbCxcclxuXHRcdFx0XHRcdDEwMDAwMDAsXHJcblx0XHRcdFx0XHRmYWxzZSxcclxuXHRcdFx0XHRcdG51bGxcclxuXHRcdFx0XHQpO1xyXG5cdFx0XHR9IGZpbmFsbHkge1xyXG5cdFx0XHRcdGxvZ2dpbmdFcnJvciA9IGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vICNlbmRyZWdpb25cclxuXHJcblx0Ly8gI3JlZ2lvbiBGb3JtYXRQcm92aWRlclxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cdHNldEZvcm1hdFByb3ZpZGVyKGZ1bmN0aW9uIEZvcm1hdFByb3ZpZGVyKHR5cGUsIGZvcm1hdCkge1xyXG5cclxuXHRcdC8vIERhdGVcclxuXHRcdGlmICh0eXBlID09PSBEYXRlKSB7XHJcblx0XHRcdC8vIEFkZCBzdXBwb3J0IGZvciBnIGFuZCBHIHRoYXQgYXJlIG5vdCBuYXRpdmVseSBzdXBwb3J0ZWQgYnkgdGhlIE1TQUpBWCBmcmFtZXdvcmtcclxuXHRcdFx0aWYgKGZvcm1hdCA9PT0gXCJnXCIpXHJcblx0XHRcdFx0Zm9ybWF0ID0gRGF0ZS5fZXhwYW5kRm9ybWF0KFN5cy5DdWx0dXJlSW5mby5DdXJyZW50Q3VsdHVyZS5kYXRlVGltZUZvcm1hdCwgXCJkXCIpICsgXCIgXCIgKyBEYXRlLl9leHBhbmRGb3JtYXQoU3lzLkN1bHR1cmVJbmZvLkN1cnJlbnRDdWx0dXJlLmRhdGVUaW1lRm9ybWF0LCBcInRcIik7XHJcblx0XHRcdGVsc2UgaWYgKGZvcm1hdCA9PT0gXCJHXCIpXHJcblx0XHRcdFx0Zm9ybWF0ID0gRGF0ZS5fZXhwYW5kRm9ybWF0KFN5cy5DdWx0dXJlSW5mby5DdXJyZW50Q3VsdHVyZS5kYXRlVGltZUZvcm1hdCwgXCJkXCIpICsgXCIgXCIgKyBEYXRlLl9leHBhbmRGb3JtYXQoU3lzLkN1bHR1cmVJbmZvLkN1cnJlbnRDdWx0dXJlLmRhdGVUaW1lRm9ybWF0LCBcIlRcIik7XHJcblxyXG5cdFx0XHRyZXR1cm4gbmV3IEZvcm1hdCh7XHJcblx0XHRcdFx0ZGVzY3JpcHRpb246IFwiXCIsXHJcblx0XHRcdFx0c3BlY2lmaWVyOiBmb3JtYXQsXHJcblx0XHRcdFx0Y29udmVydDogZnVuY3Rpb24gKHZhbCkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIHZhbC5sb2NhbGVGb3JtYXQoZm9ybWF0KTtcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGNvbnZlcnRCYWNrOiBmdW5jdGlvbiAoc3RyKSB7XHJcblx0XHRcdFx0XHR2YXIgZGF0ZTtcclxuXHRcdFx0XHRcdC8vIFRpbWUgdmFsdWUsIHNldCBkZWZhdWx0IGRhdGUgdG8gMS8xLzE5NzAgdG8gZWFzaWx5IGNvbXBhcmUgdGltZSB2YWx1ZXNcclxuXHRcdFx0XHRcdGlmIChmb3JtYXQgPT09IFwidFwiKSB7XHJcblx0XHRcdFx0XHRcdHZhciB0aW1lRm9ybWF0ID0gRGF0ZS5fZXhwYW5kRm9ybWF0KFN5cy5DdWx0dXJlSW5mby5DdXJyZW50Q3VsdHVyZS5kYXRlVGltZUZvcm1hdCwgXCJkXCIpICsgXCIgXCIgKyBEYXRlLl9leHBhbmRGb3JtYXQoU3lzLkN1bHR1cmVJbmZvLkN1cnJlbnRDdWx0dXJlLmRhdGVUaW1lRm9ybWF0LCBcInRcIik7XHJcblx0XHRcdFx0XHRcdHZhciBzdGFydERhdGUgPSBuZXcgRGF0ZSgxOTcwLCAwLCAxKS5sb2NhbGVGb3JtYXQoXCJkXCIpO1xyXG5cdFx0XHRcdFx0XHRkYXRlID0gRGF0ZS5wYXJzZUxvY2FsZShzdGFydERhdGUgKyBcIiBcIiArIHN0ciwgdGltZUZvcm1hdCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0XHRcdGRhdGUgPSBEYXRlLnBhcnNlTG9jYWxlKHN0ciwgZm9ybWF0KTtcclxuXHJcblx0XHRcdFx0XHRpZiAoZGF0ZSA9PT0gbnVsbClcclxuXHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBkYXRlIGZvcm1hdFwiKTtcclxuXHRcdFx0XHRcdHJldHVybiBkYXRlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gTnVtYmVyXHJcblx0XHRpZiAodHlwZSA9PT0gTnVtYmVyKSB7XHJcblx0XHRcdHZhciBpc0N1cnJlbmN5Rm9ybWF0ID0gZm9ybWF0Lm1hdGNoKC9bJGNdKy9pKTtcclxuXHRcdFx0dmFyIGlzUGVyY2VudGFnZUZvcm1hdCA9IGZvcm1hdC5tYXRjaCgvWyVwXSsvaSk7XHJcblx0XHRcdHZhciBpc0ludGVnZXJGb3JtYXQgPSBmb3JtYXQubWF0Y2goL1tkbmZnXTAvaSk7XHJcblx0XHRcdHZhciBjdXJyZW5jeURlY2ltYWxEaWdpdHMgPSBTeXMuQ3VsdHVyZUluZm8uQ3VycmVudEN1bHR1cmUubnVtYmVyRm9ybWF0LkN1cnJlbmN5RGVjaW1hbERpZ2l0cztcclxuXHJcblx0XHRcdHJldHVybiBuZXcgRm9ybWF0KHtcclxuXHRcdFx0XHRkZXNjcmlwdGlvbjogaXNDdXJyZW5jeUZvcm1hdCA/IFJlc291cmNlW1wiZm9ybWF0LWN1cnJlbmN5XCJdIDogaXNQZXJjZW50YWdlRm9ybWF0ID8gUmVzb3VyY2VbXCJmb3JtYXQtcGVyY2VudGFnZVwiXSA6IGlzSW50ZWdlckZvcm1hdCA/IFJlc291cmNlW1wiZm9ybWF0LWludGVnZXJcIl0gOiBSZXNvdXJjZVtcImZvcm1hdC1kZWNpbWFsXCJdLFxyXG5cdFx0XHRcdHNwZWNpZmllcjogZm9ybWF0LFxyXG5cdFx0XHRcdGNvbnZlcnQ6IGZ1bmN0aW9uICh2YWwpIHtcclxuXHRcdFx0XHRcdC8vIERlZmF1bHQgdG8gYnJvd3NlciBmb3JtYXR0aW5nIGZvciBnZW5lcmFsIGZvcm1hdFxyXG5cdFx0XHRcdFx0aWYgKGZvcm1hdC50b0xvd2VyQ2FzZSgpID09PSBcImdcIilcclxuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbC50b1N0cmluZygpO1xyXG5cclxuXHRcdFx0XHRcdC8vIE90aGVyd2lzZSwgdXNlIHRoZSBsb2NhbGl6ZWQgZm9ybWF0XHJcblx0XHRcdFx0XHRyZXR1cm4gdmFsLmxvY2FsZUZvcm1hdChmb3JtYXQpO1xyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0Y29udmVydEJhY2s6IGZ1bmN0aW9uIChzdHIpIHtcclxuXHRcdFx0XHRcdC8vIEhhbmRsZSB1c2Ugb2YgKCkgdG8gZGVub3RlIG5lZ2F0aXZlIG51bWJlcnNcclxuXHRcdFx0XHRcdHZhciBzaWduID0gMTtcclxuXHRcdFx0XHRcdGlmIChzdHIubWF0Y2goL15cXCguKlxcKSQvKSkge1xyXG5cdFx0XHRcdFx0XHRzdHIgPSBzdHIuc3Vic3RyaW5nKDEsIHN0ci5sZW5ndGggLSAxKTtcclxuXHRcdFx0XHRcdFx0c2lnbiA9IC0xO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0dmFyIHJlc3VsdDtcclxuXHJcblx0XHRcdFx0XHQvLyBSZW1vdmUgY3VycmVuY3kgc3ltYm9scyBiZWZvcmUgcGFyc2luZ1xyXG5cdFx0XHRcdFx0aWYgKGlzQ3VycmVuY3lGb3JtYXQpIHtcclxuXHRcdFx0XHRcdFx0cmVzdWx0ID0gTnVtYmVyLnBhcnNlTG9jYWxlKHN0ci5yZXBsYWNlKFN5cy5DdWx0dXJlSW5mby5DdXJyZW50Q3VsdHVyZS5udW1iZXJGb3JtYXQuQ3VycmVuY3lTeW1ib2wsIFwiXCIpKSAqIHNpZ247XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBpZiB0aGVyZSBpcyBhIGRlY2ltYWwgcGxhY2UsIGNoZWNrIHRoZSBwcmVjaXNpb24gaXNudCBncmVhdGVyIHRoYW4gYWxsb3dlZCBmb3IgY3VycmVuY3kuIFxyXG5cdFx0XHRcdFx0XHQvLyBGbG9hdGluZyBwb2ludHMgaW4ganMgY2FuIGJlIHNrZXdlZCB1bmRlciBjZXJ0YWluIGNpcmN1bXN0YW5jZXMsIHdlIGFyZSBqdXN0IGNoZWNraW5nIHRoZSBkZWNpbWFscyBpbnN0ZWFkIG9mIG11bHRpcGx5aW5nIHJlc3VsdHMuXHJcblx0XHRcdFx0XHRcdHZhciByZXN1bHRTdHIgPSByZXN1bHQudG9TdHJpbmcoKTtcclxuXHRcdFx0XHRcdFx0aWYgKHJlc3VsdFN0ci5pbmRleE9mKCcuJykgPiAtMSAmJiAocmVzdWx0U3RyLmxlbmd0aCAtIChyZXN1bHRTdHIuaW5kZXhPZignLicpICsgMSkpID4gY3VycmVuY3lEZWNpbWFsRGlnaXRzKSB7XHJcblx0XHRcdFx0XHRcdFx0cmVzdWx0ID0gTmFOO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdC8vIFJlbW92ZSBwZXJjZW50YWdlIHN5bWJvbHMgYmVmb3JlIHBhcnNpbmcgYW5kIGRpdmlkZSBieSAxMDBcclxuXHRcdFx0XHRcdGVsc2UgaWYgKGlzUGVyY2VudGFnZUZvcm1hdClcclxuXHRcdFx0XHRcdFx0cmVzdWx0ID0gTnVtYmVyLnBhcnNlTG9jYWxlKHN0ci5yZXBsYWNlKFN5cy5DdWx0dXJlSW5mby5DdXJyZW50Q3VsdHVyZS5udW1iZXJGb3JtYXQuUGVyY2VudFN5bWJvbCwgXCJcIikpIC8gMTAwICogc2lnbjtcclxuXHJcblx0XHRcdFx0XHRcdC8vIEVuc3VyZSBpbnRlZ2VycyBhcmUgYWN0dWFsIHdob2xlIG51bWJlcnNcclxuXHRcdFx0XHRcdGVsc2UgaWYgKGlzSW50ZWdlckZvcm1hdCAmJiAhaXNJbnRlZ2VyKE51bWJlci5wYXJzZUxvY2FsZShzdHIpKSlcclxuXHRcdFx0XHRcdFx0cmVzdWx0ID0gTmFOO1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gSnVzdCBwYXJzZSBhIHNpbXBsZSBudW1iZXJcclxuXHRcdFx0XHRcdGVsc2VcclxuXHRcdFx0XHRcdFx0cmVzdWx0ID0gTnVtYmVyLnBhcnNlTG9jYWxlKHN0cikgKiBzaWduO1xyXG5cclxuXHRcdFx0XHRcdGlmIChpc05hTihyZXN1bHQpKVxyXG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGZvcm1hdFwiKTtcclxuXHJcblx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gQm9vbGVhblxyXG5cdFx0aWYgKHR5cGUgPT09IEJvb2xlYW4pIHtcclxuXHRcdFx0Ly8gRm9ybWF0IHN0cmluZ3MgdXNlZCBmb3IgdHJ1ZSwgZmFsc2UsIGFuZCBudWxsIChvciB1bmRlZmluZWQpIHZhbHVlc1xyXG5cdFx0XHR2YXIgdHJ1ZUZvcm1hdCwgZmFsc2VGb3JtYXQsIG51bGxGb3JtYXQ7XHJcblxyXG5cdFx0XHRpZiAoZm9ybWF0ICYmIGZvcm1hdC50b0xvd2VyQ2FzZSgpID09PSBcImdcIikge1xyXG5cdFx0XHRcdHRydWVGb3JtYXQgPSBcIlRydWVcIjtcclxuXHRcdFx0XHRmYWxzZUZvcm1hdCA9IFwiRmFsc2VcIjtcclxuXHRcdFx0XHRudWxsRm9ybWF0ID0gXCJcIlxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHZhciBmb3JtYXRzID0gZm9ybWF0LnNwbGl0KCc7Jyk7XHJcblx0XHRcdFx0dHJ1ZUZvcm1hdCA9IGZvcm1hdHMubGVuZ3RoID4gMCA/IGZvcm1hdHNbMF0gOiBcIlwiO1xyXG5cdFx0XHRcdGZhbHNlRm9ybWF0ID0gZm9ybWF0cy5sZW5ndGggPiAxID8gZm9ybWF0c1sxXSA6IFwiXCI7XHJcblx0XHRcdFx0bnVsbEZvcm1hdCA9IGZvcm1hdHMubGVuZ3RoID4gMiA/IGZvcm1hdHNbMl0gOiBcIlwiO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZXR1cm4gbmV3IEZvcm1hdCh7XHJcblx0XHRcdFx0ZGVzY3JpcHRpb246IFwiXCIsXHJcblx0XHRcdFx0c3BlY2lmaWVyOiBmb3JtYXQsXHJcblx0XHRcdFx0Y29udmVydDogZnVuY3Rpb24gKHZhbCkge1xyXG5cdFx0XHRcdFx0aWYgKHZhbCA9PT0gdHJ1ZSlcclxuXHRcdFx0XHRcdFx0cmV0dXJuIHRydWVGb3JtYXQ7XHJcblx0XHRcdFx0XHRlbHNlIGlmICh2YWwgPT09IGZhbHNlKVxyXG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2VGb3JtYXQ7XHJcblx0XHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0XHRcdHJldHVybiBudWxsRm9ybWF0O1xyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0Y29udmVydEJhY2s6IGZ1bmN0aW9uIChzdHIpIHtcclxuXHRcdFx0XHRcdGlmIChzdHIudG9Mb3dlckNhc2UoKSA9PT0gdHJ1ZUZvcm1hdC50b0xvd2VyQ2FzZSgpKVxyXG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHRcdGVsc2UgaWYgKHN0ci50b0xvd2VyQ2FzZSgpID09PSBmYWxzZUZvcm1hdC50b0xvd2VyQ2FzZSgpKVxyXG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gRGVmYXVsdFxyXG5cdFx0cmV0dXJuIG5ldyBGb3JtYXQoe1xyXG5cdFx0XHRkZXNjcmlwdGlvbjogXCJcIixcclxuXHRcdFx0c3BlY2lmaWVyOiBcIlwiLFxyXG5cdFx0XHRjb252ZXJ0OiBmdW5jdGlvbiAodmFsKSB7XHJcblx0XHRcdFx0cmV0dXJuIHZhbC50b1N0cmluZygpO1xyXG5cdFx0XHR9LFxyXG5cdFx0XHRjb252ZXJ0QmFjazogZnVuY3Rpb24gKHN0cikge1xyXG5cdFx0XHRcdHJldHVybiBzdHI7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cclxuXHR9KTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG5cclxuXHQvLyAjcmVnaW9uIE9ic2VydmVyUHJvdmlkZXJcclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHRmdW5jdGlvbiByYWlzZVNwZWNpZmljUHJvcGVydHlDaGFuZ2VkKHRhcmdldCwgYXJncykge1xyXG5cdFx0dmFyIGZ1bmMgPSB0YXJnZXQuX19wcm9wZXJ0eUNoYW5nZUhhbmRsZXJzW2FyZ3MuZ2V0X3Byb3BlcnR5TmFtZSgpXTtcclxuXHRcdGlmIChmdW5jICYmIGZ1bmMgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG5cdFx0XHRmdW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRzZXRPYnNlcnZlclByb3ZpZGVyKHtcclxuXHJcblx0XHRtYWtlT2JzZXJ2YWJsZTogU3lzLk9ic2VydmVyLm1ha2VPYnNlcnZhYmxlLFxyXG5cclxuXHRcdGRpc3Bvc2VPYnNlcnZhYmxlOiBTeXMuT2JzZXJ2ZXIuZGlzcG9zZU9ic2VydmFibGUsXHJcblxyXG5cdFx0YWRkQ29sbGVjdGlvbkNoYW5nZWQ6IFN5cy5PYnNlcnZlci5hZGRDb2xsZWN0aW9uQ2hhbmdlZCxcclxuXHJcblx0XHRyZW1vdmVDb2xsZWN0aW9uQ2hhbmdlZDogU3lzLk9ic2VydmVyLnJlbW92ZUNvbGxlY3Rpb25DaGFuZ2VkLFxyXG5cclxuXHRcdGFkZFByb3BlcnR5Q2hhbmdlZDogZnVuY3Rpb24gU3lzJE9ic2VydmVyJGFkZFByb3BlcnR5Q2hhbmdlZCh0YXJnZXQsIHByb3BlcnR5LCBoYW5kbGVyKSB7XHJcblx0XHRcdGlmICghdGFyZ2V0Ll9fcHJvcGVydHlDaGFuZ2VIYW5kbGVycykge1xyXG5cdFx0XHRcdHRhcmdldC5fX3Byb3BlcnR5Q2hhbmdlSGFuZGxlcnMgPSB7fTtcclxuXHRcdFx0XHRTeXMuT2JzZXJ2ZXIuYWRkUHJvcGVydHlDaGFuZ2VkKHRhcmdldCwgcmFpc2VTcGVjaWZpY1Byb3BlcnR5Q2hhbmdlZCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciBmdW5jID0gdGFyZ2V0Ll9fcHJvcGVydHlDaGFuZ2VIYW5kbGVyc1twcm9wZXJ0eV07XHJcblxyXG5cdFx0XHRpZiAoIWZ1bmMpIHtcclxuXHRcdFx0XHR0YXJnZXQuX19wcm9wZXJ0eUNoYW5nZUhhbmRsZXJzW3Byb3BlcnR5XSA9IGZ1bmMgPSBFeG9XZWIuRnVuY3RvcigpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRmdW5jLmFkZChoYW5kbGVyKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0cmVtb3ZlUHJvcGVydHlDaGFuZ2VkOiBmdW5jdGlvbiBTeXMkT2JzZXJ2ZXIkcmVtb3ZlUHJvcGVydHlDaGFuZ2VkKHRhcmdldCwgcHJvcGVydHksIGhhbmRsZXIpIHtcclxuXHRcdFx0dmFyIGZ1bmMgPSB0YXJnZXQuX19wcm9wZXJ0eUNoYW5nZUhhbmRsZXJzID8gdGFyZ2V0Ll9fcHJvcGVydHlDaGFuZ2VIYW5kbGVyc1twcm9wZXJ0eV0gOiBudWxsO1xyXG5cclxuXHRcdFx0aWYgKGZ1bmMpIHtcclxuXHRcdFx0XHRmdW5jLnJlbW92ZShoYW5kbGVyKTtcclxuXHJcblx0XHRcdFx0Ly8gaWYgdGhlIGZ1bmN0b3IgaXMgZW1wdHkgdGhlbiByZW1vdmUgdGhlIGNhbGxiYWNrIGFzIGFuIG9wdGltaXphdGlvblxyXG5cdFx0XHRcdGlmIChmdW5jLmlzRW1wdHkoKSkge1xyXG5cdFx0XHRcdFx0ZGVsZXRlIHRhcmdldC5fX3Byb3BlcnR5Q2hhbmdlSGFuZGxlcnNbcHJvcGVydHldO1xyXG5cclxuXHRcdFx0XHRcdHZhciBoYXNIYW5kbGVycyA9IGZhbHNlO1xyXG5cdFx0XHRcdFx0Zm9yICh2YXIgcmVtYWluaW5nSGFuZGxlciBpbiB0YXJnZXQuX19wcm9wZXJ0eUNoYW5nZUhhbmRsZXJzKSB7XHJcblx0XHRcdFx0XHRcdGlmICh0YXJnZXQuX19wcm9wZXJ0eUNoYW5nZUhhbmRsZXJzLmhhc093blByb3BlcnR5KHJlbWFpbmluZ0hhbmRsZXIpKSB7XHJcblx0XHRcdFx0XHRcdFx0aGFzSGFuZGxlcnMgPSB0cnVlO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0aWYgKCFoYXNIYW5kbGVycykge1xyXG5cdFx0XHRcdFx0XHR0YXJnZXQuX19wcm9wZXJ0eUNoYW5nZUhhbmRsZXJzID0gbnVsbDtcclxuXHRcdFx0XHRcdFx0U3lzLk9ic2VydmVyLnJlbW92ZVByb3BlcnR5Q2hhbmdlZCh0YXJnZXQsIHJhaXNlU3BlY2lmaWNQcm9wZXJ0eUNoYW5nZWQpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHRyYWlzZVByb3BlcnR5Q2hhbmdlZDogU3lzLk9ic2VydmVyLnJhaXNlUHJvcGVydHlDaGFuZ2VkLFxyXG5cclxuXHRcdHNldFZhbHVlOiBTeXMuT2JzZXJ2ZXIuc2V0VmFsdWVcclxuXHR9KTtcclxuXHJcblx0RXhvV2ViLnVwZGF0ZUFycmF5ID0gZnVuY3Rpb24gdXBkYXRlQXJyYXkoYXJyYXksIGl0ZW1zKSB7XHJcblx0XHRpZiAoYXJyYXkuYmVnaW5VcGRhdGUgJiYgYXJyYXkuZW5kVXBkYXRlKSB7XHJcblx0XHRcdGFycmF5LmJlZ2luVXBkYXRlKCk7XHJcblx0XHR9XHJcblx0XHR1cGRhdGUoYXJyYXksIGl0ZW1zKTtcclxuXHRcdGlmIChhcnJheS5iZWdpblVwZGF0ZSAmJiBhcnJheS5lbmRVcGRhdGUpIHtcclxuXHRcdFx0YXJyYXkuZW5kVXBkYXRlKCk7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0Ly8gI2VuZHJlZ2lvblxyXG59KSh3aW5kb3cuRXhvSlF1ZXJ5IHx8IGpRdWVyeSk7XHJcbiIsIu+7vy8vIE5hbWU6ICAgICAgICBNaWNyb3NvZnRBamF4LmRlYnVnLmpzXHJcbi8vIEFzc2VtYmx5OiAgICBTeXN0ZW0uV2ViLkFqYXhcclxuLy8gVmVyc2lvbjogICAgIDMuMC4zMTEwNi4xXHJcbi8vIEZpbGVWZXJzaW9uOiAzLjAuMzExMDYuMVxyXG5cclxuXHJcbihmdW5jdGlvbih3aW5kb3csIFN5cykge1xyXG5cclxudmFyIG1lcmdlID0gZnVuY3Rpb24gX21lcmdlKHRhcmdldCkge1xyXG5cdHRhcmdldCA9IHRhcmdldCB8fCB7fTtcclxuXHRmb3JlYWNoKGFyZ3VtZW50cywgZnVuY3Rpb24obykge1xyXG5cdFx0aWYgKG8pIHtcclxuXHRcdFx0Zm9ySW4obywgZnVuY3Rpb24odiwgbikge1xyXG5cdFx0XHRcdHRhcmdldFtuXSA9IHY7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH0sIDEpO1xyXG5cdHJldHVybiB0YXJnZXQ7XHJcbn1cclxudmFyIGZvckluID0gZnVuY3Rpb24gX2ZvckluKG9iaiwgY2FsbGJhY2spIHtcclxuXHRmb3IgKHZhciB4IGluIG9iaikge1xyXG5cdFx0Y2FsbGJhY2sob2JqW3hdLCB4KTtcclxuXHR9XHJcbn1cclxudmFyIGZvcmVhY2ggPSBmdW5jdGlvbiBfZm9yZWFjaChhcnIsIGNhbGxiYWNrLCBzdGFydCkge1xyXG5cdHZhciBjYW5jZWxsZWQ7XHJcblx0aWYgKGFycikge1xyXG5cdFx0Ly8gamF2YXNjcmlwdCBhcnJheVxyXG5cdFx0YXJyID0gYXJyICE9PSB3aW5kb3cgJiYgdHlwZW9mIChhcnIubm9kZVR5cGUpID09PSBcInVuZGVmaW5lZFwiICYmXHJcblx0XHRcdChhcnIgaW5zdGFuY2VvZiBBcnJheSB8fFxyXG5cdFx0Ly8gYXJndW1lbnRzIGFycmF5LCBvciBub2RlbGlzdCAoaGFzIC5pdGVtIGFuZCBpcyBub3QgYSBkb20gZWxlbWVudCBvciB3aW5kb3cpXHJcblx0XHRcdCh0eXBlb2YgKGFyci5sZW5ndGgpID09PSAnbnVtYmVyJyAmJiAodHlwZW9mIChhcnIuY2FsbGVlKSA9PT0gXCJmdW5jdGlvblwiIHx8IChhcnIuaXRlbSAmJiB0eXBlb2YgKGFyci5ub2RlVHlwZSkgPT09IFwidW5kZWZpbmVkXCIpICYmICFhcnIuYWRkRXZlbnRMaXN0ZW5lciAmJiAhYXJyLmF0dGFjaEV2ZW50KSkpXHJcblx0XHRcdD8gYXJyIDogW2Fycl07XHJcblx0XHRmb3IgKHZhciBpID0gc3RhcnR8fDAsIGwgPSBhcnIubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XHJcblx0XHRcdGlmIChjYWxsYmFjayhhcnJbaV0sIGkpKSB7XHJcblx0XHRcdFx0Y2FuY2VsbGVkID0gdHJ1ZTtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gIWNhbmNlbGxlZDtcclxufVxyXG52YXIgY2FsbElmID0gZnVuY3Rpb24gX2NhbGxJZihvYmosIG5hbWUsIGFyZ3MpIHtcclxuXHR2YXIgZm4gPSBvYmpbbmFtZV0sXHJcblx0XHRleGlzdHMgPSB0eXBlb2YoZm4pID09PSBcImZ1bmN0aW9uXCI7XHJcblx0aWYgKGV4aXN0cykgZm4uY2FsbChvYmosIGFyZ3MpO1xyXG5cdHJldHVybiBleGlzdHM7XHJcbn1cclxuXHJcbmlmICghU3lzIHx8ICFTeXMubG9hZGVyKSB7XHJcblx0ZnVuY3Rpb24gYXBwZW5kKHRhcmdldCkge1xyXG5cdFx0dGFyZ2V0ID0gdGFyZ2V0IHx8IHt9O1xyXG5cdFx0Zm9yZWFjaChhcmd1bWVudHMsIGZ1bmN0aW9uKG8pIHtcclxuXHRcdFx0aWYgKG8pIHtcclxuXHRcdFx0XHRmb3JJbihvLCBmdW5jdGlvbih2LCBuKSB7XHJcblx0XHRcdFx0XHRpZiAodHlwZW9mKHRhcmdldFtuXSkgPT09IFwidW5kZWZpbmVkXCIpIHRhcmdldFtuXSA9IHY7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHRcdH0sIDEpO1xyXG5cdFx0cmV0dXJuIHRhcmdldDtcclxuXHR9XHJcblxyXG5cdHZhciBub3RMb2FkaW5nID0gMCxcclxuXHRcdGxvYWRpbmcgPSAxLFxyXG5cdFx0bG9hZGluZ0NvID0gMixcclxuXHRcdGxvYWRlZCA9IDMsXHJcblx0XHRhdHRhY2hFdmVudCA9ICEhZG9jdW1lbnQuYXR0YWNoRXZlbnQ7XHJcblx0ZnVuY3Rpb24gZ2V0QW5kRGVsZXRlKG9iaiwgZmllbGQpIHtcclxuXHRcdHZhciByID0gb2JqW2ZpZWxkXTtcclxuXHRcdGRlbGV0ZSBvYmpbZmllbGRdO1xyXG5cdFx0cmV0dXJuIHI7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIGZvcmVhY2hDYWxsKG9iaiwgZmllbGQsIGFyZ3MpIHtcclxuXHRcdGZvcmVhY2goZ2V0QW5kRGVsZXRlKG9iaiwgZmllbGQpLCBmdW5jdGlvbihjYWxsYmFjaykge1xyXG5cdFx0XHRjYWxsYmFjay5hcHBseShudWxsLCBhcmdzfHxbXSk7XHJcblx0XHR9KTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gbGF6eWdldChvYmosIG5hbWUsIHZhbHVlKSB7XHJcblx0XHRyZXR1cm4gb2JqID8gKG9ialtuYW1lXSA9IG9ialtuYW1lXSB8fCB2YWx1ZSkgOiB2YWx1ZTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gbGF6eXB1c2gob2JqLCBuYW1lLCB2YWx1ZSkge1xyXG5cdFx0bGF6eWdldChvYmosIG5hbWUsIFtdKS5wdXNoKHZhbHVlKTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gbGF6eXNldChvYmosIG5hbWUsIGtleSwgdmFsdWUpIHtcclxuXHRcdGxhenlnZXQob2JqLCBuYW1lLCB7fSlba2V5XSA9IHZhbHVlO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBhbGwodGFnLCBlbGVtZW50KSB7XHJcblx0XHRyZXR1cm4gKGVsZW1lbnR8fGRvY3VtZW50KS5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YWcpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBjcmVhdGVFbGVtZW50KHRhZykge1xyXG5cdFx0cmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gbGlzdGVuT25jZSh0YXJnZXQsIG5hbWUsIGllTmFtZSwgY2FsbGJhY2ssIGlzUmVhZHlTdGF0ZSwgaXNTY3JpcHQpIHtcclxuXHRcdGZ1bmN0aW9uIG9uRXZlbnQoKSB7XHJcblx0XHRcdGlmICghYXR0YWNoRXZlbnQgfHwgIWlzUmVhZHlTdGF0ZSB8fCAvbG9hZGVkfGNvbXBsZXRlLy50ZXN0KHRhcmdldC5yZWFkeVN0YXRlKSkge1xyXG5cdFx0XHRcdGlmIChhdHRhY2hFdmVudCkge1xyXG5cdFx0XHRcdFx0dGFyZ2V0LmRldGFjaEV2ZW50KGllTmFtZSB8fCAoXCJvblwiICsgbmFtZSksIG9uRXZlbnQpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKG5hbWUsIG9uRXZlbnQsIGZhbHNlKTtcclxuXHRcdFx0XHRcdGlmIChpc1NjcmlwdCkge1xyXG5cdFx0XHRcdFx0XHR0YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsIG9uRXZlbnQsIGZhbHNlKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Y2FsbGJhY2suYXBwbHkodGFyZ2V0KTtcclxuXHRcdFx0XHR0YXJnZXQgPSBudWxsO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRpZiAoYXR0YWNoRXZlbnQpIHtcclxuXHRcdFx0dGFyZ2V0LmF0dGFjaEV2ZW50KGllTmFtZSB8fCAoXCJvblwiICsgbmFtZSksIG9uRXZlbnQpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRhcmdldC5hZGRFdmVudExpc3RlbmVyKG5hbWUsIG9uRXZlbnQsIGZhbHNlKTtcclxuXHRcdFx0aWYgKGlzU2NyaXB0KSB7XHJcblx0XHRcdFx0dGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoXCJlcnJvclwiLCBvbkV2ZW50LCBmYWxzZSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0ZnVuY3Rpb24gcmFpc2VEb21SZWFkeSgpIHtcclxuXHRcdGlmIChTeXMuX2RvbVJlYWR5KSB7XHJcblx0XHRcdFN5cy5fMlBhc3MoZ2V0QW5kRGVsZXRlKFN5cywgXCJfZG9tUmVhZHlRdWV1ZVwiKSk7XHJcblx0XHR9XHJcblx0fVxyXG5cdGZ1bmN0aW9uIHJhaXNlT25SZWFkeSgpIHtcclxuXHRcdHZhciByZWFkeSA9IFN5cy5fcmVhZHk7XHJcblx0XHRpZiAoIXJlYWR5ICYmIFN5cy5fZG9tUmVhZHkgJiYgIShTeXMubG9hZGVyICYmIFN5cy5sb2FkZXIuX2xvYWRpbmcpKSB7XHJcblx0XHRcdFN5cy5fcmVhZHkgPSByZWFkeSA9IHRydWU7XHJcblx0XHR9XHJcblx0XHRpZiAocmVhZHkpIHtcclxuXHRcdFx0U3lzLl8yUGFzcyhnZXRBbmREZWxldGUoU3lzLCBcIl9yZWFkeVF1ZXVlXCIpKTtcclxuXHRcdH1cclxuXHR9XHJcblx0d2luZG93LlN5cyA9IFN5cyA9IGFwcGVuZChTeXMsIHtcclxuXHRcdHZlcnNpb246IFszLCAwLCAzMTEwNiwgMV0sXHJcblx0XHRfX2NsYXNzOiB0cnVlLFxyXG5cdFx0ZGVidWc6IHRydWUsXHJcblx0XHRzY3JpcHRzOiB7fSxcclxuXHRcdGFjdGl2YXRlRG9tOiB0cnVlLFxyXG5cdFx0Y29tcG9zaXRlczoge30sXHJcblx0XHRjb21wb25lbnRzOiB7fSxcclxuXHRcdHBsdWdpbnM6IHt9LFxyXG5cdFx0Y3JlYXRlOiB7fSxcclxuXHRcdGNvbnZlcnRlcnM6IHt9LFxyXG5cdFx0X2RvbUxvYWRlZDogZnVuY3Rpb24gX2RvbUxvYWRlZCgpIHtcclxuXHRcdFx0ZnVuY3Rpb24gZG9tUmVhZHkoKSB7XHJcblx0XHRcdFx0aWYgKCFTeXMuX2RvbVJlYWR5KSB7XHJcblx0XHRcdFx0XHRTeXMuX2RvbVJlYWR5ID0gdHJ1ZTtcclxuXHRcdFx0XHRcdHJhaXNlRG9tUmVhZHkoKTtcclxuXHRcdFx0XHRcdHJhaXNlT25SZWFkeSgpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRsaXN0ZW5PbmNlKHdpbmRvdywgXCJsb2FkXCIsIG51bGwsIGRvbVJlYWR5KTtcclxuXHJcblx0XHRcdHZhciBjaGVjaztcclxuXHRcdFx0aWYgKGF0dGFjaEV2ZW50KSB7XHJcblx0XHRcdFx0aWYgKCh3aW5kb3cgPT0gd2luZG93LnRvcCkgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsKSB7XHJcblx0XHRcdFx0XHR2YXIgdGltZW91dCwgZXIsIGVsID0gY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuXHRcdFx0XHRcdGNoZWNrID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHRcdHRyeSB7XHJcblx0XHRcdFx0XHRcdFx0ZWwuZG9TY3JvbGwoXCJsZWZ0XCIpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGNhdGNoIChlcikge1xyXG5cdFx0XHRcdFx0XHRcdHRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dChjaGVjaywgMCk7XHJcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGVsID0gbnVsbDtcclxuXHRcdFx0XHRcdFx0ZG9tUmVhZHkoKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGNoZWNrKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0bGlzdGVuT25jZShkb2N1bWVudCwgbnVsbCwgXCJvbnJlYWR5c3RhdGVjaGFuZ2VcIiwgZG9tUmVhZHksIHRydWUpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7XHJcblx0XHRcdFx0bGlzdGVuT25jZShkb2N1bWVudCwgXCJET01Db250ZW50TG9hZGVkXCIsIG51bGwsIGRvbVJlYWR5KTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdF9nZXRCeUlkOiBmdW5jdGlvbiBfZ2V0QnlJZChmb3VuZCwgaWQsIHNpbmdsZSwgaW5jbHVkZVNlbGYsIGVsZW1lbnQpIHtcclxuXHRcdFx0aWYgKGVsZW1lbnQpIHtcclxuXHRcdFx0XHRpZiAoaW5jbHVkZVNlbGYgJiYgKGVsZW1lbnQuaWQgPT09IGlkKSkge1xyXG5cdFx0XHRcdFx0Zm91bmRbMF0gPSBlbGVtZW50O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdGZvcmVhY2goYWxsKFwiKlwiLCBlbGVtZW50KSwgZnVuY3Rpb24oZWxlbWVudCkge1xyXG5cdFx0XHRcdFx0XHRpZiAoZWxlbWVudC5pZCA9PT0gaWQpIHtcclxuXHRcdFx0XHRcdFx0XHRmb3VuZFswXSA9IGVsZW1lbnQ7XHJcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR2YXIgZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcclxuXHRcdFx0XHRpZiAoZSkgZm91bmRbMF0gPSBlO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiBmb3VuZC5sZW5ndGg7XHJcblx0XHR9LFxyXG5cdFx0X2dldEJ5Q2xhc3M6IGZ1bmN0aW9uIF9nZXRCeUNsYXNzKGZvdW5kLCB0YXJnZXRDbGFzcywgc2luZ2xlLCBpbmNsdWRlU2VsZiwgZWxlbWVudCkge1xyXG5cdFx0XHRmdW5jdGlvbiBwdXNoSWZNYXRjaChlbGVtZW50KSB7XHJcblx0XHRcdFx0dmFyIHJldCwgY2xhc3NOYW1lID0gZWxlbWVudC5jbGFzc05hbWU7XHJcblx0XHRcdFx0aWYgKGNsYXNzTmFtZSAmJiAoKGNsYXNzTmFtZSA9PT0gdGFyZ2V0Q2xhc3MpIHx8IChjbGFzc05hbWUuaW5kZXhPZignICcgKyB0YXJnZXRDbGFzcykgPj0gMCkgfHwgKGNsYXNzTmFtZS5pbmRleE9mKHRhcmdldENsYXNzICsgJyAnKSA+PSAwKSkpIHtcclxuXHRcdFx0XHRcdGZvdW5kLnB1c2goZWxlbWVudCk7XHJcblx0XHRcdFx0XHRyZXQgPSB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRyZXR1cm4gcmV0O1xyXG5cdFx0XHR9XHJcblx0XHRcdHZhciBpLCBsLCBub2RlcztcclxuXHRcdFx0aWYgKGluY2x1ZGVTZWxmICYmIHB1c2hJZk1hdGNoKGVsZW1lbnQpICYmIHNpbmdsZSkge1xyXG5cdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsZW1lbnQgPSBlbGVtZW50IHx8IGRvY3VtZW50O1xyXG5cdFx0XHR2YXIgZmluZGVyID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsIHx8IGVsZW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZTtcclxuXHRcdFx0aWYgKGZpbmRlcikge1xyXG5cdFx0XHRcdGlmIChlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwpIHRhcmdldENsYXNzID0gXCIuXCIgKyB0YXJnZXRDbGFzcztcclxuXHRcdFx0XHRub2RlcyA9IGZpbmRlci5jYWxsKGVsZW1lbnQsIHRhcmdldENsYXNzKTtcclxuXHRcdFx0XHRmb3IgKGkgPSAwLCBsID0gbm9kZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XHJcblx0XHRcdFx0XHRmb3VuZC5wdXNoKG5vZGVzW2ldKTtcclxuXHRcdFx0XHRcdGlmIChzaW5nbGUpIHJldHVybiB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRub2RlcyA9IGFsbChcIipcIiwgZWxlbWVudCk7XHJcblx0XHRcdFx0Zm9yIChpID0gMCwgbCA9IG5vZGVzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG5cdFx0XHRcdFx0aWYgKHB1c2hJZk1hdGNoKG5vZGVzW2ldKSAmJiBzaW5nbGUpIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0cXVlcnk6IGZ1bmN0aW9uIHF1ZXJ5KHNlbGVjdG9yLCBjb250ZXh0KSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNxdWVyeVwiIC8+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cInNlbGVjdG9yXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwiY29udGV4dFwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdFx0XHQvLy8gPHJldHVybnMgdHlwZT1cIkFycmF5XCI+PC9yZXR1cm5zPlxyXG5cdFx0XHRyZXR1cm4gKGNvbnRleHQgJiYgdHlwZW9mKGNvbnRleHQucXVlcnkpID09PSBcImZ1bmN0aW9uXCIpID9cclxuXHRcdFx0XHRjb250ZXh0LnF1ZXJ5KHNlbGVjdG9yKSA6XHJcblx0XHRcdFx0dGhpcy5fZmluZChzZWxlY3RvciwgY29udGV4dCk7XHJcblx0XHR9LFxyXG5cdFx0Z2V0OiBmdW5jdGlvbiBnZXQoc2VsZWN0b3IsIGNvbnRleHQpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI2dldFwiIC8+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cInNlbGVjdG9yXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwiY29udGV4dFwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdFx0XHQvLy8gPHJldHVybnM+PC9yZXR1cm5zPlxyXG5cdFx0XHRyZXR1cm4gKGNvbnRleHQgJiYgdHlwZW9mKGNvbnRleHQuZ2V0KSA9PT0gXCJmdW5jdGlvblwiKSA/XHJcblx0XHRcdFx0Y29udGV4dC5nZXQoc2VsZWN0b3IpIDpcclxuXHRcdFx0XHR0aGlzLl9maW5kKHNlbGVjdG9yLCBjb250ZXh0LCB0cnVlKTtcclxuXHRcdH0sXHJcblx0XHRfZmluZDogZnVuY3Rpb24gX2ZpbmQoc2VsZWN0b3IsIGNvbnRleHQsIHNpbmdsZSkge1xyXG5cdFx0XHR2YXIgZm91bmQgPSBbXTtcclxuXHRcdFx0aWYgKHR5cGVvZihzZWxlY3RvcikgIT09IFwic3RyaW5nXCIpIHtcclxuXHRcdFx0XHRmb3VuZC5wdXNoKHNlbGVjdG9yKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR2YXIgaW5jbHVkZVNlbGYgPSBjb250ZXh0IGluc3RhbmNlb2YgQXJyYXksXHJcblx0XHRcdFx0XHRtYXRjaCA9IC9eKFtcXCQjXFwuXSkoKFxcd3xbJDpcXC5cXC1dKSspJC8uZXhlYyhzZWxlY3Rvcik7XHJcblx0XHRcdFx0aWYgKG1hdGNoICYmIG1hdGNoLmxlbmd0aCA9PT0gNCkge1xyXG5cdFx0XHRcdFx0c2VsZWN0b3IgPSBtYXRjaFsyXTtcclxuXHRcdFx0XHRcdHZhciB0eXBlID0gbWF0Y2hbMV07XHJcblx0XHRcdFx0XHRpZiAodHlwZSA9PT0gXCIkXCIpIHtcclxuXHRcdFx0XHRcdFx0U3lzLl9nZXRDb21wb25lbnQoZm91bmQsIHNlbGVjdG9yLCBjb250ZXh0KTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHR2YXIgZmluZGVyID0gdHlwZSA9PT0gXCIjXCIgPyBTeXMuX2dldEJ5SWQgOiBTeXMuX2dldEJ5Q2xhc3M7XHJcblx0XHRcdFx0XHRcdGlmIChjb250ZXh0KSB7XHJcblx0XHRcdFx0XHRcdFx0Zm9yZWFjaChjb250ZXh0LCBmdW5jdGlvbihub2RlKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAobm9kZS5ub2RlVHlwZSA9PT0gMSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZmluZGVyKGZvdW5kLCBzZWxlY3Rvciwgc2luZ2xlLCBpbmNsdWRlU2VsZiwgbm9kZSk7XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0ZmluZGVyKGZvdW5kLCBzZWxlY3Rvciwgc2luZ2xlKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmICgvXlxcdyskLy50ZXN0KHNlbGVjdG9yKSkge1xyXG5cdFx0XHRcdFx0aWYgKGluY2x1ZGVTZWxmKSB7XHJcblx0XHRcdFx0XHRcdGZvcmVhY2goY29udGV4dCwgZnVuY3Rpb24obm9kZSkge1xyXG5cdFx0XHRcdFx0XHRcdGlmIChub2RlLm5vZGVUeXBlID09PSAxKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAobm9kZS50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IHNlbGVjdG9yKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGZvdW5kLnB1c2gobm9kZSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmIChzaW5nbGUpIHJldHVybiB0cnVlO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0aWYoIWZvcmVhY2goYWxsKHNlbGVjdG9yLCBub2RlKSwgZnVuY3Rpb24obm9kZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRmb3VuZC5wdXNoKG5vZGUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoc2luZ2xlKSByZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHRcdFx0XHRcdH0pKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0dmFyIG5vZGVzID0gYWxsKHNlbGVjdG9yLCBjb250ZXh0KTtcclxuXHRcdFx0XHRcdFx0aWYgKHNpbmdsZSkge1xyXG5cdFx0XHRcdFx0XHRcdHJldHVybiAobm9kZXNbMF0gfHwgbnVsbCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0Zm9yZWFjaChub2RlcywgZnVuY3Rpb24obm9kZSkge1xyXG5cdFx0XHRcdFx0XHRcdGZvdW5kLnB1c2gobm9kZSk7XHJcblx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmICh3aW5kb3cualF1ZXJ5KSB7XHJcblx0XHRcdFx0XHRmb3VuZCA9IGpRdWVyeShzZWxlY3RvcikuZ2V0KCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiBmb3VuZC5sZW5ndGggPyAoc2luZ2xlID8gZm91bmRbMF0gOiBmb3VuZCkgOiBudWxsO1xyXG5cdFx0fSxcclxuXHRcdG9uRG9tUmVhZHk6IGZ1bmN0aW9uIG9uRG9tUmVhZHkoY2FsbGJhY2spIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI29uRG9tUmVhZHlcIiAvPlxyXG5cdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJjYWxsYmFja1wiIHR5cGU9XCJGdW5jdGlvblwiPjwvcGFyYW0+XHJcblx0XHRcdGxhenlwdXNoKHRoaXMsIFwiX2RvbVJlYWR5UXVldWVcIiwgY2FsbGJhY2spO1xyXG5cdFx0XHRyYWlzZURvbVJlYWR5KCk7XHJcblx0XHR9LFxyXG5cdFx0b25SZWFkeTogZnVuY3Rpb24gb25SZWFkeShjYWxsYmFjaykge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojb25SZWFkeVwiIC8+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cImNhbGxiYWNrXCIgdHlwZT1cIkZ1bmN0aW9uXCI+PC9wYXJhbT5cclxuXHRcdFx0bGF6eXB1c2godGhpcywgXCJfcmVhZHlRdWV1ZVwiLCBjYWxsYmFjayk7XHJcblx0XHRcdHJhaXNlT25SZWFkeSgpO1xyXG5cdFx0fVxyXG5cdFx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNyZWdpc3RlclNjcmlwdFwiIC8+XHJcblx0XHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwibmFtZVwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cdFx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cImV4ZWN1dGlvbkRlcGVuZGVuY2llc1wiIG1heUJlTnVsbD1cInRydWVcIiB0eXBlPVwiQXJyYXlcIiBlbGVtZW50VHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0XHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwiZXhlY3V0aW9uQ2FsbGJhY2tcIiB0eXBlPVwiRnVuY3Rpb25cIj48L3BhcmFtPlxyXG5cdH0pO1xyXG5cdFN5cy5fZ2V0Q29tcG9uZW50ID0gU3lzLl9nZXRDb21wb25lbnQgfHwgZnVuY3Rpb24oKSB7IH1cclxuXHRTeXMuXzJQYXNzID0gU3lzLl8yUGFzcyB8fCBmdW5jdGlvbiBfMlBhc3MoY2FsbGJhY2spIHtcclxuXHQgICBmb3JlYWNoKGNhbGxiYWNrLCBmdW5jdGlvbihjKSB7IGMoKTsgfSk7XHJcblx0fVxyXG5cclxuU3lzLl9kb21Mb2FkZWQoKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZXhlY3V0ZSgpIHtcclxuXHJcblN5cy5fZm9yZWFjaCA9IGZvcmVhY2g7XHJcblN5cy5fZm9ySW4gPSBmb3JJbjtcclxuU3lzLl9tZXJnZSA9IG1lcmdlO1xyXG5TeXMuX2NhbGxJZiA9IGNhbGxJZjtcclxuXHJcbkZ1bmN0aW9uLl9fdHlwZU5hbWUgPSAnRnVuY3Rpb24nO1xyXG5GdW5jdGlvbi5fX2NsYXNzID0gdHJ1ZTtcclxuXHJcbkZ1bmN0aW9uLmNyZWF0ZUNhbGxiYWNrID0gZnVuY3Rpb24gRnVuY3Rpb24kY3JlYXRlQ2FsbGJhY2sobWV0aG9kLCBjb250ZXh0KSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI0Z1bmN0aW9uLmNyZWF0ZUNhbGxiYWNrXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJtZXRob2RcIiB0eXBlPVwiRnVuY3Rpb25cIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImNvbnRleHRcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIkZ1bmN0aW9uXCI+PC9yZXR1cm5zPlxyXG5cclxuXHJcblxyXG5cdHJldHVybiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBsID0gYXJndW1lbnRzLmxlbmd0aDtcclxuXHRcdGlmIChsID4gMCkge1xyXG5cdFx0XHR2YXIgYXJncyA9IFtdO1xyXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGw7IGkrKykge1xyXG5cdFx0XHRcdGFyZ3NbaV0gPSBhcmd1bWVudHNbaV07XHJcblx0XHRcdH1cclxuXHRcdFx0YXJnc1tsXSA9IGNvbnRleHQ7XHJcblx0XHRcdHJldHVybiBtZXRob2QuYXBwbHkodGhpcywgYXJncyk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gbWV0aG9kLmNhbGwodGhpcywgY29udGV4dCk7XHJcblx0fVxyXG59XHJcblxyXG5GdW5jdGlvbi5jcmVhdGVEZWxlZ2F0ZSA9IGZ1bmN0aW9uIEZ1bmN0aW9uJGNyZWF0ZURlbGVnYXRlKGluc3RhbmNlLCBtZXRob2QpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojRnVuY3Rpb24uY3JlYXRlRGVsZWdhdGVcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImluc3RhbmNlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwibWV0aG9kXCIgdHlwZT1cIkZ1bmN0aW9uXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIkZ1bmN0aW9uXCI+PC9yZXR1cm5zPlxyXG5cclxuXHJcblxyXG5cdHJldHVybiBmdW5jdGlvbigpIHtcclxuXHRcdHJldHVybiBtZXRob2QuYXBwbHkoaW5zdGFuY2UsIGFyZ3VtZW50cyk7XHJcblx0fVxyXG59XHJcblxyXG5GdW5jdGlvbi5lbXB0eUZ1bmN0aW9uID0gRnVuY3Rpb24uZW1wdHlNZXRob2QgPSBmdW5jdGlvbiBGdW5jdGlvbiRlbXB0eU1ldGhvZCgpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojRnVuY3Rpb24uZW1wdHlNZXRob2RcIiAvPlxyXG59XHJcblxyXG5GdW5jdGlvbi52YWxpZGF0ZVBhcmFtZXRlcnMgPSBmdW5jdGlvbiBGdW5jdGlvbiR2YWxpZGF0ZVBhcmFtZXRlcnMocGFyYW1ldGVycywgZXhwZWN0ZWRQYXJhbWV0ZXJzLCB2YWxpZGF0ZVBhcmFtZXRlckNvdW50KSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI0Z1bmN0aW9uLnZhbGlkYXRlUGFyYW1ldGVyc1wiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwicGFyYW1ldGVyc1wiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZXhwZWN0ZWRQYXJhbWV0ZXJzXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ2YWxpZGF0ZVBhcmFtZXRlckNvdW50XCIgdHlwZT1cIkJvb2xlYW5cIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIkVycm9yXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcmV0dXJucz5cclxuXHJcblx0cmV0dXJuIEZ1bmN0aW9uLl92YWxpZGF0ZVBhcmFtcyhwYXJhbWV0ZXJzLCBleHBlY3RlZFBhcmFtZXRlcnMsIHZhbGlkYXRlUGFyYW1ldGVyQ291bnQpO1xyXG59XHJcblxyXG5GdW5jdGlvbi5fdmFsaWRhdGVQYXJhbXMgPSBmdW5jdGlvbiBGdW5jdGlvbiRfdmFsaWRhdGVQYXJhbXMocGFyYW1zLCBleHBlY3RlZFBhcmFtcywgdmFsaWRhdGVQYXJhbWV0ZXJDb3VudCkge1xyXG5cdHZhciBlLCBleHBlY3RlZExlbmd0aCA9IGV4cGVjdGVkUGFyYW1zLmxlbmd0aDtcclxuXHR2YWxpZGF0ZVBhcmFtZXRlckNvdW50ID0gdmFsaWRhdGVQYXJhbWV0ZXJDb3VudCAhPT0gZmFsc2U7XHJcblx0ZSA9IEZ1bmN0aW9uLl92YWxpZGF0ZVBhcmFtZXRlckNvdW50KHBhcmFtcywgZXhwZWN0ZWRQYXJhbXMsIHZhbGlkYXRlUGFyYW1ldGVyQ291bnQpO1xyXG5cdGlmIChlKSB7XHJcblx0XHRlLnBvcFN0YWNrRnJhbWUoKTtcclxuXHRcdHJldHVybiBlO1xyXG5cdH1cclxuXHRmb3IgKHZhciBpID0gMCwgbCA9IHBhcmFtcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuXHRcdHZhciBleHBlY3RlZFBhcmFtID0gZXhwZWN0ZWRQYXJhbXNbTWF0aC5taW4oaSwgZXhwZWN0ZWRMZW5ndGggLSAxKV0sXHJcblx0XHRcdHBhcmFtTmFtZSA9IGV4cGVjdGVkUGFyYW0ubmFtZTtcclxuXHRcdGlmIChleHBlY3RlZFBhcmFtLnBhcmFtZXRlckFycmF5KSB7XHJcblx0XHRcdHBhcmFtTmFtZSArPSBcIltcIiArIChpIC0gZXhwZWN0ZWRMZW5ndGggKyAxKSArIFwiXVwiO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAoIXZhbGlkYXRlUGFyYW1ldGVyQ291bnQgJiYgKGkgPj0gZXhwZWN0ZWRMZW5ndGgpKSB7XHJcblx0XHRcdGJyZWFrO1xyXG5cdFx0fVxyXG5cdFx0ZSA9IEZ1bmN0aW9uLl92YWxpZGF0ZVBhcmFtZXRlcihwYXJhbXNbaV0sIGV4cGVjdGVkUGFyYW0sIHBhcmFtTmFtZSk7XHJcblx0XHRpZiAoZSkge1xyXG5cdFx0XHRlLnBvcFN0YWNrRnJhbWUoKTtcclxuXHRcdFx0cmV0dXJuIGU7XHJcblx0XHR9XHJcblx0fVxyXG5cdHJldHVybiBudWxsO1xyXG59XHJcblxyXG5GdW5jdGlvbi5fdmFsaWRhdGVQYXJhbWV0ZXJDb3VudCA9IGZ1bmN0aW9uIEZ1bmN0aW9uJF92YWxpZGF0ZVBhcmFtZXRlckNvdW50KHBhcmFtcywgZXhwZWN0ZWRQYXJhbXMsIHZhbGlkYXRlUGFyYW1ldGVyQ291bnQpIHtcclxuXHR2YXIgaSwgZXJyb3IsXHJcblx0XHRleHBlY3RlZExlbiA9IGV4cGVjdGVkUGFyYW1zLmxlbmd0aCxcclxuXHRcdGFjdHVhbExlbiA9IHBhcmFtcy5sZW5ndGg7XHJcblx0aWYgKGFjdHVhbExlbiA8IGV4cGVjdGVkTGVuKSB7XHJcblx0XHR2YXIgbWluUGFyYW1zID0gZXhwZWN0ZWRMZW47XHJcblx0XHRmb3IgKGkgPSAwOyBpIDwgZXhwZWN0ZWRMZW47IGkrKykge1xyXG5cdFx0XHR2YXIgcGFyYW0gPSBleHBlY3RlZFBhcmFtc1tpXTtcclxuXHRcdFx0aWYgKHBhcmFtLm9wdGlvbmFsIHx8IHBhcmFtLnBhcmFtZXRlckFycmF5KSB7XHJcblx0XHRcdFx0bWluUGFyYW1zLS07XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGlmIChhY3R1YWxMZW4gPCBtaW5QYXJhbXMpIHtcclxuXHRcdFx0ZXJyb3IgPSB0cnVlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRlbHNlIGlmICh2YWxpZGF0ZVBhcmFtZXRlckNvdW50ICYmIChhY3R1YWxMZW4gPiBleHBlY3RlZExlbikpIHtcclxuXHRcdGVycm9yID0gdHJ1ZTtcclxuXHRcdGZvciAoaSA9IDA7IGkgPCBleHBlY3RlZExlbjsgaSsrKSB7XHJcblx0XHRcdGlmIChleHBlY3RlZFBhcmFtc1tpXS5wYXJhbWV0ZXJBcnJheSkge1xyXG5cdFx0XHRcdGVycm9yID0gZmFsc2U7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGlmIChlcnJvcikge1xyXG5cdFx0dmFyIGUgPSBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0ZS5wb3BTdGFja0ZyYW1lKCk7XHJcblx0XHRyZXR1cm4gZTtcclxuXHR9XHJcblxyXG5cdHJldHVybiBudWxsO1xyXG59XHJcblxyXG5GdW5jdGlvbi5fdmFsaWRhdGVQYXJhbWV0ZXIgPSBmdW5jdGlvbiBGdW5jdGlvbiRfdmFsaWRhdGVQYXJhbWV0ZXIocGFyYW0sIGV4cGVjdGVkUGFyYW0sIHBhcmFtTmFtZSkge1xyXG5cdHZhciBlLFxyXG5cdFx0ZXhwZWN0ZWRUeXBlID0gZXhwZWN0ZWRQYXJhbS50eXBlLFxyXG5cdFx0ZXhwZWN0ZWRJbnRlZ2VyID0gISFleHBlY3RlZFBhcmFtLmludGVnZXIsXHJcblx0XHRleHBlY3RlZERvbUVsZW1lbnQgPSAhIWV4cGVjdGVkUGFyYW0uZG9tRWxlbWVudCxcclxuXHRcdG1heUJlTnVsbCA9ICEhZXhwZWN0ZWRQYXJhbS5tYXlCZU51bGw7XHJcblxyXG5cdGUgPSBGdW5jdGlvbi5fdmFsaWRhdGVQYXJhbWV0ZXJUeXBlKHBhcmFtLCBleHBlY3RlZFR5cGUsIGV4cGVjdGVkSW50ZWdlciwgZXhwZWN0ZWREb21FbGVtZW50LCBtYXlCZU51bGwsIHBhcmFtTmFtZSk7XHJcblx0aWYgKGUpIHtcclxuXHRcdGUucG9wU3RhY2tGcmFtZSgpO1xyXG5cdFx0cmV0dXJuIGU7XHJcblx0fVxyXG5cclxuXHR2YXIgZXhwZWN0ZWRFbGVtZW50VHlwZSA9IGV4cGVjdGVkUGFyYW0uZWxlbWVudFR5cGUsXHJcblx0XHRlbGVtZW50TWF5QmVOdWxsID0gISFleHBlY3RlZFBhcmFtLmVsZW1lbnRNYXlCZU51bGw7XHJcblx0aWYgKGV4cGVjdGVkVHlwZSA9PT0gQXJyYXkgJiYgdHlwZW9mKHBhcmFtKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBwYXJhbSAhPT0gbnVsbCAmJlxyXG5cdFx0KGV4cGVjdGVkRWxlbWVudFR5cGUgfHwgIWVsZW1lbnRNYXlCZU51bGwpKSB7XHJcblx0XHR2YXIgZXhwZWN0ZWRFbGVtZW50SW50ZWdlciA9ICEhZXhwZWN0ZWRQYXJhbS5lbGVtZW50SW50ZWdlcixcclxuXHRcdFx0ZXhwZWN0ZWRFbGVtZW50RG9tRWxlbWVudCA9ICEhZXhwZWN0ZWRQYXJhbS5lbGVtZW50RG9tRWxlbWVudDtcclxuXHRcdGZvciAodmFyIGk9MDsgaSA8IHBhcmFtLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHZhciBlbGVtID0gcGFyYW1baV07XHJcblx0XHRcdGUgPSBGdW5jdGlvbi5fdmFsaWRhdGVQYXJhbWV0ZXJUeXBlKGVsZW0sIGV4cGVjdGVkRWxlbWVudFR5cGUsXHJcblx0XHRcdFx0ZXhwZWN0ZWRFbGVtZW50SW50ZWdlciwgZXhwZWN0ZWRFbGVtZW50RG9tRWxlbWVudCwgZWxlbWVudE1heUJlTnVsbCxcclxuXHRcdFx0XHRwYXJhbU5hbWUgKyBcIltcIiArIGkgKyBcIl1cIik7XHJcblx0XHRcdGlmIChlKSB7XHJcblx0XHRcdFx0ZS5wb3BTdGFja0ZyYW1lKCk7XHJcblx0XHRcdFx0cmV0dXJuIGU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHJldHVybiBudWxsO1xyXG59XHJcblxyXG5GdW5jdGlvbi5fdmFsaWRhdGVQYXJhbWV0ZXJUeXBlID0gZnVuY3Rpb24gRnVuY3Rpb24kX3ZhbGlkYXRlUGFyYW1ldGVyVHlwZShwYXJhbSwgZXhwZWN0ZWRUeXBlLCBleHBlY3RlZEludGVnZXIsIGV4cGVjdGVkRG9tRWxlbWVudCwgbWF5QmVOdWxsLCBwYXJhbU5hbWUpIHtcclxuXHR2YXIgZSwgaTtcclxuXHJcblx0aWYgKHR5cGVvZihwYXJhbSkgPT09IFwidW5kZWZpbmVkXCIpIHtcclxuXHRcdGlmIChtYXlCZU51bGwpIHtcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0ZSA9IEVycm9yLmFyZ3VtZW50VW5kZWZpbmVkKHBhcmFtTmFtZSk7XHJcblx0XHRcdGUucG9wU3RhY2tGcmFtZSgpO1xyXG5cdFx0XHRyZXR1cm4gZTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGlmIChwYXJhbSA9PT0gbnVsbCkge1xyXG5cdFx0aWYgKG1heUJlTnVsbCkge1xyXG5cdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRlID0gRXJyb3IuYXJndW1lbnROdWxsKHBhcmFtTmFtZSk7XHJcblx0XHRcdGUucG9wU3RhY2tGcmFtZSgpO1xyXG5cdFx0XHRyZXR1cm4gZTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGlmIChleHBlY3RlZFR5cGUgJiYgZXhwZWN0ZWRUeXBlLl9fZW51bSkge1xyXG5cdFx0aWYgKHR5cGVvZihwYXJhbSkgIT09ICdudW1iZXInKSB7XHJcblx0XHRcdGUgPSBFcnJvci5hcmd1bWVudFR5cGUocGFyYW1OYW1lLCBPYmplY3QuZ2V0VHlwZShwYXJhbSksIGV4cGVjdGVkVHlwZSk7XHJcblx0XHRcdGUucG9wU3RhY2tGcmFtZSgpO1xyXG5cdFx0XHRyZXR1cm4gZTtcclxuXHRcdH1cclxuXHRcdGlmICgocGFyYW0gJSAxKSA9PT0gMCkge1xyXG5cdFx0XHR2YXIgdmFsdWVzID0gZXhwZWN0ZWRUeXBlLnByb3RvdHlwZTtcclxuXHRcdFx0aWYgKCFleHBlY3RlZFR5cGUuX19mbGFncyB8fCAocGFyYW0gPT09IDApKSB7XHJcblx0XHRcdFx0Zm9yIChpIGluIHZhbHVlcykge1xyXG5cdFx0XHRcdFx0aWYgKHZhbHVlc1tpXSA9PT0gcGFyYW0pIHJldHVybiBudWxsO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR2YXIgdiA9IHBhcmFtO1xyXG5cdFx0XHRcdGZvciAoaSBpbiB2YWx1ZXMpIHtcclxuXHRcdFx0XHRcdHZhciB2YWxpID0gdmFsdWVzW2ldO1xyXG5cdFx0XHRcdFx0aWYgKHZhbGkgPT09IDApIGNvbnRpbnVlO1xyXG5cdFx0XHRcdFx0aWYgKCh2YWxpICYgcGFyYW0pID09PSB2YWxpKSB7XHJcblx0XHRcdFx0XHRcdHYgLT0gdmFsaTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGlmICh2ID09PSAwKSByZXR1cm4gbnVsbDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGUgPSBFcnJvci5hcmd1bWVudE91dE9mUmFuZ2UocGFyYW1OYW1lLCBwYXJhbSwgU3RyaW5nLmZvcm1hdChTeXMuUmVzLmVudW1JbnZhbGlkVmFsdWUsIHBhcmFtLCBleHBlY3RlZFR5cGUuZ2V0TmFtZSgpKSk7XHJcblx0XHRlLnBvcFN0YWNrRnJhbWUoKTtcclxuXHRcdHJldHVybiBlO1xyXG5cdH1cclxuXHJcblx0aWYgKGV4cGVjdGVkRG9tRWxlbWVudCAmJiAoIVN5cy5faXNEb21FbGVtZW50KHBhcmFtKSB8fCAocGFyYW0ubm9kZVR5cGUgPT09IDMpKSkge1xyXG5cdFx0ZSA9IEVycm9yLmFyZ3VtZW50KHBhcmFtTmFtZSwgU3lzLlJlcy5hcmd1bWVudERvbUVsZW1lbnQpO1xyXG5cdFx0ZS5wb3BTdGFja0ZyYW1lKCk7XHJcblx0XHRyZXR1cm4gZTtcclxuXHR9XHJcblxyXG5cdGlmIChleHBlY3RlZFR5cGUgJiYgIVN5cy5faXNJbnN0YW5jZU9mVHlwZShleHBlY3RlZFR5cGUsIHBhcmFtKSkge1xyXG5cdFx0ZSA9IEVycm9yLmFyZ3VtZW50VHlwZShwYXJhbU5hbWUsIE9iamVjdC5nZXRUeXBlKHBhcmFtKSwgZXhwZWN0ZWRUeXBlKTtcclxuXHRcdGUucG9wU3RhY2tGcmFtZSgpO1xyXG5cdFx0cmV0dXJuIGU7XHJcblx0fVxyXG5cclxuXHRpZiAoZXhwZWN0ZWRUeXBlID09PSBOdW1iZXIgJiYgZXhwZWN0ZWRJbnRlZ2VyKSB7XHJcblx0XHRpZiAoKHBhcmFtICUgMSkgIT09IDApIHtcclxuXHRcdFx0ZSA9IEVycm9yLmFyZ3VtZW50T3V0T2ZSYW5nZShwYXJhbU5hbWUsIHBhcmFtLCBTeXMuUmVzLmFyZ3VtZW50SW50ZWdlcik7XHJcblx0XHRcdGUucG9wU3RhY2tGcmFtZSgpO1xyXG5cdFx0XHRyZXR1cm4gZTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHJldHVybiBudWxsO1xyXG59XHJcbkVycm9yLl9fdHlwZU5hbWUgPSAnRXJyb3InO1xyXG5FcnJvci5fX2NsYXNzID0gdHJ1ZTtcclxuXHJcbkVycm9yLmNyZWF0ZSA9IGZ1bmN0aW9uIEVycm9yJGNyZWF0ZShtZXNzYWdlLCBlcnJvckluZm8pIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojRXJyb3IuY3JlYXRlXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJtZXNzYWdlXCIgdHlwZT1cIlN0cmluZ1wiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImVycm9ySW5mb1wiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiRXJyb3JcIj48L3JldHVybnM+XHJcblxyXG5cclxuXHR2YXIgZXJyID0gbmV3IEVycm9yKG1lc3NhZ2UpO1xyXG5cdGVyci5tZXNzYWdlID0gbWVzc2FnZTtcclxuXHJcblx0aWYgKGVycm9ySW5mbykge1xyXG5cdFx0Zm9yICh2YXIgdiBpbiBlcnJvckluZm8pIHtcclxuXHRcdFx0ZXJyW3ZdID0gZXJyb3JJbmZvW3ZdO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0ZXJyLnBvcFN0YWNrRnJhbWUoKTtcclxuXHRyZXR1cm4gZXJyO1xyXG59XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5FcnJvci5hcmd1bWVudCA9IGZ1bmN0aW9uIEVycm9yJGFyZ3VtZW50KHBhcmFtTmFtZSwgbWVzc2FnZSkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNFcnJvci5hcmd1bWVudFwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwicGFyYW1OYW1lXCIgdHlwZT1cIlN0cmluZ1wiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cIm1lc3NhZ2VcIiB0eXBlPVwiU3RyaW5nXCIgb3B0aW9uYWw9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxyZXR1cm5zPjwvcmV0dXJucz5cclxuXHJcblxyXG5cdHZhciBkaXNwbGF5TWVzc2FnZSA9IFwiU3lzLkFyZ3VtZW50RXhjZXB0aW9uOiBcIiArIChtZXNzYWdlID8gbWVzc2FnZSA6IFN5cy5SZXMuYXJndW1lbnQpO1xyXG5cdGlmIChwYXJhbU5hbWUpIHtcclxuXHRcdGRpc3BsYXlNZXNzYWdlICs9IFwiXFxuXCIgKyBTdHJpbmcuZm9ybWF0KFN5cy5SZXMucGFyYW1OYW1lLCBwYXJhbU5hbWUpO1xyXG5cdH1cclxuXHJcblx0dmFyIGVyciA9IEVycm9yLmNyZWF0ZShkaXNwbGF5TWVzc2FnZSwgeyBuYW1lOiBcIlN5cy5Bcmd1bWVudEV4Y2VwdGlvblwiLCBwYXJhbU5hbWU6IHBhcmFtTmFtZSB9KTtcclxuXHRlcnIucG9wU3RhY2tGcmFtZSgpO1xyXG5cdHJldHVybiBlcnI7XHJcbn1cclxuXHJcbkVycm9yLmFyZ3VtZW50TnVsbCA9IGZ1bmN0aW9uIEVycm9yJGFyZ3VtZW50TnVsbChwYXJhbU5hbWUsIG1lc3NhZ2UpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojRXJyb3IuYXJndW1lbnROdWxsXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJwYXJhbU5hbWVcIiB0eXBlPVwiU3RyaW5nXCIgb3B0aW9uYWw9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwibWVzc2FnZVwiIHR5cGU9XCJTdHJpbmdcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnM+PC9yZXR1cm5zPlxyXG5cclxuXHJcblx0dmFyIGRpc3BsYXlNZXNzYWdlID0gXCJTeXMuQXJndW1lbnROdWxsRXhjZXB0aW9uOiBcIiArIChtZXNzYWdlID8gbWVzc2FnZSA6IFN5cy5SZXMuYXJndW1lbnROdWxsKTtcclxuXHRpZiAocGFyYW1OYW1lKSB7XHJcblx0XHRkaXNwbGF5TWVzc2FnZSArPSBcIlxcblwiICsgU3RyaW5nLmZvcm1hdChTeXMuUmVzLnBhcmFtTmFtZSwgcGFyYW1OYW1lKTtcclxuXHR9XHJcblxyXG5cdHZhciBlcnIgPSBFcnJvci5jcmVhdGUoZGlzcGxheU1lc3NhZ2UsIHsgbmFtZTogXCJTeXMuQXJndW1lbnROdWxsRXhjZXB0aW9uXCIsIHBhcmFtTmFtZTogcGFyYW1OYW1lIH0pO1xyXG5cdGVyci5wb3BTdGFja0ZyYW1lKCk7XHJcblx0cmV0dXJuIGVycjtcclxufVxyXG5cclxuRXJyb3IuYXJndW1lbnRPdXRPZlJhbmdlID0gZnVuY3Rpb24gRXJyb3IkYXJndW1lbnRPdXRPZlJhbmdlKHBhcmFtTmFtZSwgYWN0dWFsVmFsdWUsIG1lc3NhZ2UpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojRXJyb3IuYXJndW1lbnRPdXRPZlJhbmdlXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJwYXJhbU5hbWVcIiB0eXBlPVwiU3RyaW5nXCIgb3B0aW9uYWw9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiYWN0dWFsVmFsdWVcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJtZXNzYWdlXCIgdHlwZT1cIlN0cmluZ1wiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucz48L3JldHVybnM+XHJcblxyXG5cclxuXHR2YXIgZGlzcGxheU1lc3NhZ2UgPSBcIlN5cy5Bcmd1bWVudE91dE9mUmFuZ2VFeGNlcHRpb246IFwiICsgKG1lc3NhZ2UgPyBtZXNzYWdlIDogU3lzLlJlcy5hcmd1bWVudE91dE9mUmFuZ2UpO1xyXG5cdGlmIChwYXJhbU5hbWUpIHtcclxuXHRcdGRpc3BsYXlNZXNzYWdlICs9IFwiXFxuXCIgKyBTdHJpbmcuZm9ybWF0KFN5cy5SZXMucGFyYW1OYW1lLCBwYXJhbU5hbWUpO1xyXG5cdH1cclxuXHJcblx0aWYgKHR5cGVvZihhY3R1YWxWYWx1ZSkgIT09IFwidW5kZWZpbmVkXCIgJiYgYWN0dWFsVmFsdWUgIT09IG51bGwpIHtcclxuXHRcdGRpc3BsYXlNZXNzYWdlICs9IFwiXFxuXCIgKyBTdHJpbmcuZm9ybWF0KFN5cy5SZXMuYWN0dWFsVmFsdWUsIGFjdHVhbFZhbHVlKTtcclxuXHR9XHJcblxyXG5cdHZhciBlcnIgPSBFcnJvci5jcmVhdGUoZGlzcGxheU1lc3NhZ2UsIHtcclxuXHRcdG5hbWU6IFwiU3lzLkFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvblwiLFxyXG5cdFx0cGFyYW1OYW1lOiBwYXJhbU5hbWUsXHJcblx0XHRhY3R1YWxWYWx1ZTogYWN0dWFsVmFsdWVcclxuXHR9KTtcclxuXHRlcnIucG9wU3RhY2tGcmFtZSgpO1xyXG5cdHJldHVybiBlcnI7XHJcbn1cclxuXHJcbkVycm9yLmFyZ3VtZW50VHlwZSA9IGZ1bmN0aW9uIEVycm9yJGFyZ3VtZW50VHlwZShwYXJhbU5hbWUsIGFjdHVhbFR5cGUsIGV4cGVjdGVkVHlwZSwgbWVzc2FnZSkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNFcnJvci5hcmd1bWVudFR5cGVcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInBhcmFtTmFtZVwiIHR5cGU9XCJTdHJpbmdcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJhY3R1YWxUeXBlXCIgdHlwZT1cIlR5cGVcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJleHBlY3RlZFR5cGVcIiB0eXBlPVwiVHlwZVwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cIm1lc3NhZ2VcIiB0eXBlPVwiU3RyaW5nXCIgb3B0aW9uYWw9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxyZXR1cm5zPjwvcmV0dXJucz5cclxuXHJcblxyXG5cdHZhciBkaXNwbGF5TWVzc2FnZSA9IFwiU3lzLkFyZ3VtZW50VHlwZUV4Y2VwdGlvbjogXCI7XHJcblx0aWYgKG1lc3NhZ2UpIHtcclxuXHRcdGRpc3BsYXlNZXNzYWdlICs9IG1lc3NhZ2U7XHJcblx0fVxyXG5cdGVsc2UgaWYgKGFjdHVhbFR5cGUgJiYgZXhwZWN0ZWRUeXBlKSB7XHJcblx0XHRkaXNwbGF5TWVzc2FnZSArPVxyXG5cdFx0XHRTdHJpbmcuZm9ybWF0KFN5cy5SZXMuYXJndW1lbnRUeXBlV2l0aFR5cGVzLCBhY3R1YWxUeXBlLmdldE5hbWUoKSwgZXhwZWN0ZWRUeXBlLmdldE5hbWUoKSk7XHJcblx0fVxyXG5cdGVsc2Uge1xyXG5cdFx0ZGlzcGxheU1lc3NhZ2UgKz0gU3lzLlJlcy5hcmd1bWVudFR5cGU7XHJcblx0fVxyXG5cclxuXHRpZiAocGFyYW1OYW1lKSB7XHJcblx0XHRkaXNwbGF5TWVzc2FnZSArPSBcIlxcblwiICsgU3RyaW5nLmZvcm1hdChTeXMuUmVzLnBhcmFtTmFtZSwgcGFyYW1OYW1lKTtcclxuXHR9XHJcblxyXG5cdHZhciBlcnIgPSBFcnJvci5jcmVhdGUoZGlzcGxheU1lc3NhZ2UsIHtcclxuXHRcdG5hbWU6IFwiU3lzLkFyZ3VtZW50VHlwZUV4Y2VwdGlvblwiLFxyXG5cdFx0cGFyYW1OYW1lOiBwYXJhbU5hbWUsXHJcblx0XHRhY3R1YWxUeXBlOiBhY3R1YWxUeXBlLFxyXG5cdFx0ZXhwZWN0ZWRUeXBlOiBleHBlY3RlZFR5cGVcclxuXHR9KTtcclxuXHRlcnIucG9wU3RhY2tGcmFtZSgpO1xyXG5cdHJldHVybiBlcnI7XHJcbn1cclxuXHJcbkVycm9yLmFyZ3VtZW50VW5kZWZpbmVkID0gZnVuY3Rpb24gRXJyb3IkYXJndW1lbnRVbmRlZmluZWQocGFyYW1OYW1lLCBtZXNzYWdlKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI0Vycm9yLmFyZ3VtZW50VW5kZWZpbmVkXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJwYXJhbU5hbWVcIiB0eXBlPVwiU3RyaW5nXCIgb3B0aW9uYWw9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwibWVzc2FnZVwiIHR5cGU9XCJTdHJpbmdcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnM+PC9yZXR1cm5zPlxyXG5cclxuXHJcblx0dmFyIGRpc3BsYXlNZXNzYWdlID0gXCJTeXMuQXJndW1lbnRVbmRlZmluZWRFeGNlcHRpb246IFwiICsgKG1lc3NhZ2UgPyBtZXNzYWdlIDogU3lzLlJlcy5hcmd1bWVudFVuZGVmaW5lZCk7XHJcblx0aWYgKHBhcmFtTmFtZSkge1xyXG5cdFx0ZGlzcGxheU1lc3NhZ2UgKz0gXCJcXG5cIiArIFN0cmluZy5mb3JtYXQoU3lzLlJlcy5wYXJhbU5hbWUsIHBhcmFtTmFtZSk7XHJcblx0fVxyXG5cclxuXHR2YXIgZXJyID0gRXJyb3IuY3JlYXRlKGRpc3BsYXlNZXNzYWdlLCB7IG5hbWU6IFwiU3lzLkFyZ3VtZW50VW5kZWZpbmVkRXhjZXB0aW9uXCIsIHBhcmFtTmFtZTogcGFyYW1OYW1lIH0pO1xyXG5cdGVyci5wb3BTdGFja0ZyYW1lKCk7XHJcblx0cmV0dXJuIGVycjtcclxufVxyXG5cclxuRXJyb3IuZm9ybWF0ID0gZnVuY3Rpb24gRXJyb3IkZm9ybWF0KG1lc3NhZ2UpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojRXJyb3IuZm9ybWF0XCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJtZXNzYWdlXCIgdHlwZT1cIlN0cmluZ1wiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucz48L3JldHVybnM+XHJcblxyXG5cdHZhciBkaXNwbGF5TWVzc2FnZSA9IFwiU3lzLkZvcm1hdEV4Y2VwdGlvbjogXCIgKyAobWVzc2FnZSA/IG1lc3NhZ2UgOiBTeXMuUmVzLmZvcm1hdCk7XHJcblx0dmFyIGVyciA9IEVycm9yLmNyZWF0ZShkaXNwbGF5TWVzc2FnZSwge25hbWU6ICdTeXMuRm9ybWF0RXhjZXB0aW9uJ30pO1xyXG5cdGVyci5wb3BTdGFja0ZyYW1lKCk7XHJcblx0cmV0dXJuIGVycjtcclxufVxyXG5cclxuRXJyb3IuaW52YWxpZE9wZXJhdGlvbiA9IGZ1bmN0aW9uIEVycm9yJGludmFsaWRPcGVyYXRpb24obWVzc2FnZSkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNFcnJvci5pbnZhbGlkT3BlcmF0aW9uXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJtZXNzYWdlXCIgdHlwZT1cIlN0cmluZ1wiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucz48L3JldHVybnM+XHJcblxyXG5cdHZhciBkaXNwbGF5TWVzc2FnZSA9IFwiU3lzLkludmFsaWRPcGVyYXRpb25FeGNlcHRpb246IFwiICsgKG1lc3NhZ2UgPyBtZXNzYWdlIDogU3lzLlJlcy5pbnZhbGlkT3BlcmF0aW9uKTtcclxuXHJcblx0dmFyIGVyciA9IEVycm9yLmNyZWF0ZShkaXNwbGF5TWVzc2FnZSwge25hbWU6ICdTeXMuSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbid9KTtcclxuXHRlcnIucG9wU3RhY2tGcmFtZSgpO1xyXG5cdHJldHVybiBlcnI7XHJcbn1cclxuXHJcbkVycm9yLm5vdEltcGxlbWVudGVkID0gZnVuY3Rpb24gRXJyb3Ikbm90SW1wbGVtZW50ZWQobWVzc2FnZSkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNFcnJvci5ub3RJbXBsZW1lbnRlZFwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwibWVzc2FnZVwiIHR5cGU9XCJTdHJpbmdcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnM+PC9yZXR1cm5zPlxyXG5cclxuXHR2YXIgZGlzcGxheU1lc3NhZ2UgPSBcIlN5cy5Ob3RJbXBsZW1lbnRlZEV4Y2VwdGlvbjogXCIgKyAobWVzc2FnZSA/IG1lc3NhZ2UgOiBTeXMuUmVzLm5vdEltcGxlbWVudGVkKTtcclxuXHJcblx0dmFyIGVyciA9IEVycm9yLmNyZWF0ZShkaXNwbGF5TWVzc2FnZSwge25hbWU6ICdTeXMuTm90SW1wbGVtZW50ZWRFeGNlcHRpb24nfSk7XHJcblx0ZXJyLnBvcFN0YWNrRnJhbWUoKTtcclxuXHRyZXR1cm4gZXJyO1xyXG59XHJcblxyXG5FcnJvci5wYXJhbWV0ZXJDb3VudCA9IGZ1bmN0aW9uIEVycm9yJHBhcmFtZXRlckNvdW50KG1lc3NhZ2UpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojRXJyb3IucGFyYW1ldGVyQ291bnRcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cIm1lc3NhZ2VcIiB0eXBlPVwiU3RyaW5nXCIgb3B0aW9uYWw9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxyZXR1cm5zPjwvcmV0dXJucz5cclxuXHJcblxyXG5cdHZhciBkaXNwbGF5TWVzc2FnZSA9IFwiU3lzLlBhcmFtZXRlckNvdW50RXhjZXB0aW9uOiBcIiArIChtZXNzYWdlID8gbWVzc2FnZSA6IFN5cy5SZXMucGFyYW1ldGVyQ291bnQpO1xyXG5cdHZhciBlcnIgPSBFcnJvci5jcmVhdGUoZGlzcGxheU1lc3NhZ2UsIHtuYW1lOiAnU3lzLlBhcmFtZXRlckNvdW50RXhjZXB0aW9uJ30pO1xyXG5cdGVyci5wb3BTdGFja0ZyYW1lKCk7XHJcblx0cmV0dXJuIGVycjtcclxufVxyXG5cclxuRXJyb3IucHJvdG90eXBlLnBvcFN0YWNrRnJhbWUgPSBmdW5jdGlvbiBFcnJvciRwb3BTdGFja0ZyYW1lKCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNjaGVja1BhcmFtXCIgLz5cclxuXHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHJcblxyXG5cdGlmICh0eXBlb2YodGhpcy5zdGFjaykgPT09IFwidW5kZWZpbmVkXCIgfHwgdGhpcy5zdGFjayA9PT0gbnVsbCB8fFxyXG5cdFx0dHlwZW9mKHRoaXMuZmlsZU5hbWUpID09PSBcInVuZGVmaW5lZFwiIHx8IHRoaXMuZmlsZU5hbWUgPT09IG51bGwgfHxcclxuXHRcdHR5cGVvZih0aGlzLmxpbmVOdW1iZXIpID09PSBcInVuZGVmaW5lZFwiIHx8IHRoaXMubGluZU51bWJlciA9PT0gbnVsbCkge1xyXG5cdFx0cmV0dXJuO1xyXG5cdH1cclxuXHJcblx0dmFyIHN0YWNrRnJhbWVzID0gdGhpcy5zdGFjay5zcGxpdChcIlxcblwiKTtcclxuXHJcblx0dmFyIGN1cnJlbnRGcmFtZSA9IHN0YWNrRnJhbWVzWzBdO1xyXG5cdHZhciBwYXR0ZXJuID0gdGhpcy5maWxlTmFtZSArIFwiOlwiICsgdGhpcy5saW5lTnVtYmVyO1xyXG5cdHdoaWxlKHR5cGVvZihjdXJyZW50RnJhbWUpICE9PSBcInVuZGVmaW5lZFwiICYmXHJcblx0XHQgIGN1cnJlbnRGcmFtZSAhPT0gbnVsbCAmJlxyXG5cdFx0ICBjdXJyZW50RnJhbWUuaW5kZXhPZihwYXR0ZXJuKSA9PT0gLTEpIHtcclxuXHRcdHN0YWNrRnJhbWVzLnNoaWZ0KCk7XHJcblx0XHRjdXJyZW50RnJhbWUgPSBzdGFja0ZyYW1lc1swXTtcclxuXHR9XHJcblxyXG5cdHZhciBuZXh0RnJhbWUgPSBzdGFja0ZyYW1lc1sxXTtcclxuXHJcblx0aWYgKHR5cGVvZihuZXh0RnJhbWUpID09PSBcInVuZGVmaW5lZFwiIHx8IG5leHRGcmFtZSA9PT0gbnVsbCkge1xyXG5cdFx0cmV0dXJuO1xyXG5cdH1cclxuXHJcblx0dmFyIG5leHRGcmFtZVBhcnRzID0gbmV4dEZyYW1lLm1hdGNoKC9AKC4qKTooXFxkKykkLyk7XHJcblx0aWYgKHR5cGVvZihuZXh0RnJhbWVQYXJ0cykgPT09IFwidW5kZWZpbmVkXCIgfHwgbmV4dEZyYW1lUGFydHMgPT09IG51bGwpIHtcclxuXHRcdHJldHVybjtcclxuXHR9XHJcblxyXG5cdHRoaXMuZmlsZU5hbWUgPSBuZXh0RnJhbWVQYXJ0c1sxXTtcclxuXHJcblx0dGhpcy5saW5lTnVtYmVyID0gcGFyc2VJbnQobmV4dEZyYW1lUGFydHNbMl0pO1xyXG5cclxuXHRzdGFja0ZyYW1lcy5zaGlmdCgpO1xyXG5cdHRoaXMuc3RhY2sgPSBzdGFja0ZyYW1lcy5qb2luKFwiXFxuXCIpO1xyXG59XHJcbk9iamVjdC5fX3R5cGVOYW1lID0gJ09iamVjdCc7XHJcbk9iamVjdC5fX2NsYXNzID0gdHJ1ZTtcclxuXHJcbk9iamVjdC5nZXRUeXBlID0gZnVuY3Rpb24gT2JqZWN0JGdldFR5cGUoaW5zdGFuY2UpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojT2JqZWN0LmdldFR5cGVcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImluc3RhbmNlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIlR5cGVcIj48L3JldHVybnM+XHJcblxyXG5cdHZhciBjdG9yID0gaW5zdGFuY2UuY29uc3RydWN0b3I7XHJcblx0aWYgKCFjdG9yIHx8ICh0eXBlb2YoY3RvcikgIT09IFwiZnVuY3Rpb25cIikgfHwgIWN0b3IuX190eXBlTmFtZSB8fCAoY3Rvci5fX3R5cGVOYW1lID09PSAnT2JqZWN0JykpIHtcclxuXHRcdHJldHVybiBPYmplY3Q7XHJcblx0fVxyXG5cdHJldHVybiBjdG9yO1xyXG59XHJcblxyXG5PYmplY3QuZ2V0VHlwZU5hbWUgPSBmdW5jdGlvbiBPYmplY3QkZ2V0VHlwZU5hbWUoaW5zdGFuY2UpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojT2JqZWN0LmdldFR5cGVOYW1lXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJpbnN0YW5jZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJTdHJpbmdcIj48L3JldHVybnM+XHJcblxyXG5cdHJldHVybiBPYmplY3QuZ2V0VHlwZShpbnN0YW5jZSkuZ2V0TmFtZSgpO1xyXG59XHJcblN0cmluZy5fX3R5cGVOYW1lID0gJ1N0cmluZyc7XHJcblN0cmluZy5fX2NsYXNzID0gdHJ1ZTtcclxuXHJcblN0cmluZy5wcm90b3R5cGUuZW5kc1dpdGggPSBmdW5jdGlvbiBTdHJpbmckZW5kc1dpdGgoc2VhcmNoU3RyLCBwb3NpdGlvbikge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTdHJpbmcuZW5kc1dpdGhcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInNlYXJjaFN0clwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInBvc2l0aW9uXCIgdHlwZT1cIk51bWJlclwiPjwvcGFyYW0+XHJcblx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJCb29sZWFuXCI+PC9yZXR1cm5zPlxyXG5cclxuXHQvLyBCYXNlZCBvbiBodHRwczovL3ZhbmlsbGFqc3Rvb2xraXQuY29tL3BvbHlmaWxscy9zdHJpbmdlbmRzd2l0aC9cclxuXHQvLyBUaGlzIHdvcmtzIG11Y2ggYmV0dGVyIHRoYW4gPj0gYmVjYXVzZVxyXG5cdC8vIGl0IGNvbXBlbnNhdGVzIGZvciBOYU46XHJcblx0aWYgKCEocG9zaXRpb24gPCB0aGlzLmxlbmd0aCkpIHtcclxuXHRcdHBvc2l0aW9uID0gdGhpcy5sZW5ndGg7XHJcblx0fSBlbHNlIHtcclxuXHRcdHBvc2l0aW9uIHw9IDA7IC8vIHJvdW5kIHBvc2l0aW9uXHJcblx0fVxyXG5cdHJldHVybiB0aGlzLnN1YnN0cihwb3NpdGlvbiAtIHNlYXJjaFN0ci5sZW5ndGgsIHNlYXJjaFN0ci5sZW5ndGgpID09PSBzZWFyY2hTdHI7XHJcbn1cclxuXHJcblN0cmluZy5wcm90b3R5cGUuc3RhcnRzV2l0aCA9IGZ1bmN0aW9uIFN0cmluZyRzdGFydHNXaXRoKHByZWZpeCwgcG9zaXRpb24pIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3RyaW5nLnN0YXJ0c1dpdGhcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInByZWZpeFwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInBvc2l0aW9uXCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJCb29sZWFuXCI+PC9yZXR1cm5zPlxyXG5cclxuXHQvLyBCYXNlZCBvbiBodHRwczovL3ZhbmlsbGFqc3Rvb2xraXQuY29tL3BvbHlmaWxscy9zdHJpbmdzdGFydHN3aXRoL1xyXG5cdHJldHVybiAodGhpcy5zdWJzdHIocG9zaXRpb24gfHwgMCwgcHJlZml4Lmxlbmd0aCkgPT09IHByZWZpeCk7XHJcbn1cclxuXHJcblN0cmluZy5wcm90b3R5cGUudHJpbSA9IGZ1bmN0aW9uIFN0cmluZyR0cmltKCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTdHJpbmcudHJpbVwiIC8+XHJcblx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJTdHJpbmdcIj48L3JldHVybnM+XHJcblx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0cmV0dXJuIHRoaXMucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgJycpO1xyXG59XHJcblxyXG5TdHJpbmcucHJvdG90eXBlLnRyaW1FbmQgPSBmdW5jdGlvbiBTdHJpbmckdHJpbUVuZCgpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3RyaW5nLnRyaW1FbmRcIiAvPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiU3RyaW5nXCI+PC9yZXR1cm5zPlxyXG5cdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdHJldHVybiB0aGlzLnJlcGxhY2UoL1xccyskLywgJycpO1xyXG59XHJcblxyXG5TdHJpbmcucHJvdG90eXBlLnRyaW1TdGFydCA9IGZ1bmN0aW9uIFN0cmluZyR0cmltU3RhcnQoKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N0cmluZy50cmltU3RhcnRcIiAvPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiU3RyaW5nXCI+PC9yZXR1cm5zPlxyXG5cdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdHJldHVybiB0aGlzLnJlcGxhY2UoL15cXHMrLywgJycpO1xyXG59XHJcblxyXG5TdHJpbmcuZm9ybWF0ID0gZnVuY3Rpb24gU3RyaW5nJGZvcm1hdChmb3JtYXQsIGFyZ3MpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3RyaW5nLmZvcm1hdFwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZm9ybWF0XCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiYXJnc1wiIHBhcmFtZXRlckFycmF5PVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiU3RyaW5nXCI+PC9yZXR1cm5zPlxyXG5cclxuXHRyZXR1cm4gU3RyaW5nLl90b0Zvcm1hdHRlZFN0cmluZyhmYWxzZSwgYXJndW1lbnRzKTtcclxufVxyXG5cclxuU3RyaW5nLl90b0Zvcm1hdHRlZFN0cmluZyA9IGZ1bmN0aW9uIFN0cmluZyRfdG9Gb3JtYXR0ZWRTdHJpbmcodXNlTG9jYWxlLCBhcmdzKSB7XHJcblx0dmFyIHJlc3VsdCA9ICcnO1xyXG5cdHZhciBmb3JtYXQgPSBhcmdzWzBdO1xyXG5cclxuXHRmb3IgKHZhciBpPTA7Oykge1xyXG5cdFx0dmFyIG9wZW4gPSBmb3JtYXQuaW5kZXhPZigneycsIGkpO1xyXG5cdFx0dmFyIGNsb3NlID0gZm9ybWF0LmluZGV4T2YoJ30nLCBpKTtcclxuXHRcdGlmICgob3BlbiA8IDApICYmIChjbG9zZSA8IDApKSB7XHJcblx0XHRcdHJlc3VsdCArPSBmb3JtYXQuc2xpY2UoaSk7XHJcblx0XHRcdGJyZWFrO1xyXG5cdFx0fVxyXG5cdFx0aWYgKChjbG9zZSA+IDApICYmICgoY2xvc2UgPCBvcGVuKSB8fCAob3BlbiA8IDApKSkge1xyXG5cdFx0XHRpZiAoZm9ybWF0LmNoYXJBdChjbG9zZSArIDEpICE9PSAnfScpIHtcclxuXHRcdFx0XHR0aHJvdyBFcnJvci5hcmd1bWVudCgnZm9ybWF0JywgU3lzLlJlcy5zdHJpbmdGb3JtYXRCcmFjZU1pc21hdGNoKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXN1bHQgKz0gZm9ybWF0LnNsaWNlKGksIGNsb3NlICsgMSk7XHJcblx0XHRcdGkgPSBjbG9zZSArIDI7XHJcblx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJlc3VsdCArPSBmb3JtYXQuc2xpY2UoaSwgb3Blbik7XHJcblx0XHRpID0gb3BlbiArIDE7XHJcblxyXG5cdFx0aWYgKGZvcm1hdC5jaGFyQXQoaSkgPT09ICd7Jykge1xyXG5cdFx0XHRyZXN1bHQgKz0gJ3snO1xyXG5cdFx0XHRpKys7XHJcblx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChjbG9zZSA8IDApIHRocm93IEVycm9yLmFyZ3VtZW50KCdmb3JtYXQnLCBTeXMuUmVzLnN0cmluZ0Zvcm1hdEJyYWNlTWlzbWF0Y2gpO1xyXG5cclxuXHJcblx0XHR2YXIgYnJhY2UgPSBmb3JtYXQuc3Vic3RyaW5nKGksIGNsb3NlKTtcclxuXHRcdHZhciBjb2xvbkluZGV4ID0gYnJhY2UuaW5kZXhPZignOicpO1xyXG5cdFx0dmFyIGFyZ051bWJlciA9IHBhcnNlSW50KChjb2xvbkluZGV4IDwgMCk/IGJyYWNlIDogYnJhY2Uuc3Vic3RyaW5nKDAsIGNvbG9uSW5kZXgpLCAxMCkgKyAxO1xyXG5cdFx0aWYgKGlzTmFOKGFyZ051bWJlcikpIHRocm93IEVycm9yLmFyZ3VtZW50KCdmb3JtYXQnLCBTeXMuUmVzLnN0cmluZ0Zvcm1hdEludmFsaWQpO1xyXG5cdFx0dmFyIGFyZ0Zvcm1hdCA9IChjb2xvbkluZGV4IDwgMCk/ICcnIDogYnJhY2Uuc3Vic3RyaW5nKGNvbG9uSW5kZXggKyAxKTtcclxuXHJcblx0XHR2YXIgYXJnID0gYXJnc1thcmdOdW1iZXJdO1xyXG5cdFx0aWYgKHR5cGVvZihhcmcpID09PSBcInVuZGVmaW5lZFwiIHx8IGFyZyA9PT0gbnVsbCkge1xyXG5cdFx0XHRhcmcgPSAnJztcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoYXJnLnRvRm9ybWF0dGVkU3RyaW5nKSB7XHJcblx0XHRcdHJlc3VsdCArPSBhcmcudG9Gb3JtYXR0ZWRTdHJpbmcoYXJnRm9ybWF0KTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKHVzZUxvY2FsZSAmJiBhcmcubG9jYWxlRm9ybWF0KSB7XHJcblx0XHRcdHJlc3VsdCArPSBhcmcubG9jYWxlRm9ybWF0KGFyZ0Zvcm1hdCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChhcmcuZm9ybWF0KSB7XHJcblx0XHRcdHJlc3VsdCArPSBhcmcuZm9ybWF0KGFyZ0Zvcm1hdCk7XHJcblx0XHR9XHJcblx0XHRlbHNlXHJcblx0XHRcdHJlc3VsdCArPSBhcmcudG9TdHJpbmcoKTtcclxuXHJcblx0XHRpID0gY2xvc2UgKyAxO1xyXG5cdH1cclxuXHJcblx0cmV0dXJuIHJlc3VsdDtcclxufVxyXG5Cb29sZWFuLl9fdHlwZU5hbWUgPSAnQm9vbGVhbic7XHJcbkJvb2xlYW4uX19jbGFzcyA9IHRydWU7XHJcblxyXG5Cb29sZWFuLnBhcnNlID0gZnVuY3Rpb24gQm9vbGVhbiRwYXJzZSh2YWx1ZSkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNCb29sZWFuLnBhcnNlXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ2YWx1ZVwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiQm9vbGVhblwiPjwvcmV0dXJucz5cclxuXHJcblx0dmFyIHYgPSB2YWx1ZS50cmltKCkudG9Mb3dlckNhc2UoKTtcclxuXHRpZiAodiA9PT0gJ2ZhbHNlJykgcmV0dXJuIGZhbHNlO1xyXG5cdGlmICh2ID09PSAndHJ1ZScpIHJldHVybiB0cnVlO1xyXG5cdHRocm93IEVycm9yLmFyZ3VtZW50T3V0T2ZSYW5nZSgndmFsdWUnLCB2YWx1ZSwgU3lzLlJlcy5ib29sVHJ1ZU9yRmFsc2UpO1xyXG59XHJcbkRhdGUuX190eXBlTmFtZSA9ICdEYXRlJztcclxuRGF0ZS5fX2NsYXNzID0gdHJ1ZTtcclxuTnVtYmVyLl9fdHlwZU5hbWUgPSAnTnVtYmVyJztcclxuTnVtYmVyLl9fY2xhc3MgPSB0cnVlO1xyXG5SZWdFeHAuX190eXBlTmFtZSA9ICdSZWdFeHAnO1xyXG5SZWdFeHAuX19jbGFzcyA9IHRydWU7XHJcblxyXG4vL2lmICghd2luZG93KSB0aGlzLndpbmRvdyA9IHRoaXM7XHJcblxyXG5cclxud2luZG93LlR5cGUgPSBGdW5jdGlvbjtcclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5UeXBlLl9fZnVsbHlRdWFsaWZpZWRJZGVudGlmaWVyUmVnRXhwID0gbmV3IFJlZ0V4cChcIl5bXi4wLTkgXFxcXHN8LDs6Jio9K1xcXFwtKClcXFxcW1xcXFxde31eJSNAIX5cXFxcblxcXFxyXFxcXHRcXFxcZlxcXFxcXFxcXShbXiBcXFxcc3wsOzomKj0rXFxcXC0oKVxcXFxbXFxcXF17fV4lI0AhflxcXFxuXFxcXHJcXFxcdFxcXFxmXFxcXFxcXFxdKlteLiBcXFxcc3wsOzomKj0rXFxcXC0oKVxcXFxbXFxcXF17fV4lI0AhflxcXFxuXFxcXHJcXFxcdFxcXFxmXFxcXFxcXFxdKT8kXCIsIFwiaVwiKTtcclxuVHlwZS5fX2lkZW50aWZpZXJSZWdFeHAgPSBuZXcgUmVnRXhwKFwiXlteLjAtOSBcXFxcc3wsOzomKj0rXFxcXC0oKVxcXFxbXFxcXF17fV4lI0AhflxcXFxuXFxcXHJcXFxcdFxcXFxmXFxcXFxcXFxdW14uIFxcXFxzfCw7OiYqPStcXFxcLSgpXFxcXFtcXFxcXXt9XiUjQCF+XFxcXG5cXFxcclxcXFx0XFxcXGZcXFxcXFxcXF0qJFwiLCBcImlcIik7XHJcblxyXG5UeXBlLnByb3RvdHlwZS5jYWxsQmFzZU1ldGhvZCA9IGZ1bmN0aW9uIFR5cGUkY2FsbEJhc2VNZXRob2QoaW5zdGFuY2UsIG5hbWUsIGJhc2VBcmd1bWVudHMpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojVHlwZS5jYWxsQmFzZU1ldGhvZFwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiaW5zdGFuY2VcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cIm5hbWVcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJiYXNlQXJndW1lbnRzXCIgdHlwZT1cIkFycmF5XCIgb3B0aW9uYWw9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiIGVsZW1lbnRNYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnM+PC9yZXR1cm5zPlxyXG5cclxuXHR2YXIgYmFzZU1ldGhvZCA9IFN5cy5fZ2V0QmFzZU1ldGhvZCh0aGlzLCBpbnN0YW5jZSwgbmFtZSk7XHJcblx0aWYgKCFiYXNlTWV0aG9kKSB0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN0cmluZy5mb3JtYXQoU3lzLlJlcy5tZXRob2ROb3RGb3VuZCwgbmFtZSkpO1xyXG5cdGlmICghYmFzZUFyZ3VtZW50cykge1xyXG5cdFx0cmV0dXJuIGJhc2VNZXRob2QuYXBwbHkoaW5zdGFuY2UpO1xyXG5cdH1cclxuXHRlbHNlIHtcclxuXHRcdHJldHVybiBiYXNlTWV0aG9kLmFwcGx5KGluc3RhbmNlLCBiYXNlQXJndW1lbnRzKTtcclxuXHR9XHJcbn1cclxuXHJcblR5cGUucHJvdG90eXBlLmdldEJhc2VNZXRob2QgPSBmdW5jdGlvbiBUeXBlJGdldEJhc2VNZXRob2QoaW5zdGFuY2UsIG5hbWUpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojVHlwZS5nZXRCYXNlTWV0aG9kXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJpbnN0YW5jZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwibmFtZVwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiRnVuY3Rpb25cIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9yZXR1cm5zPlxyXG5cclxuXHRyZXR1cm4gU3lzLl9nZXRCYXNlTWV0aG9kKHRoaXMsIGluc3RhbmNlLCBuYW1lKTtcclxufVxyXG5cclxuVHlwZS5wcm90b3R5cGUuZ2V0QmFzZVR5cGUgPSBmdW5jdGlvbiBUeXBlJGdldEJhc2VUeXBlKCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNUeXBlLmdldEJhc2VUeXBlXCIgLz5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIlR5cGVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9yZXR1cm5zPlxyXG5cdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdHJldHVybiAodHlwZW9mKHRoaXMuX19iYXNlVHlwZSkgPT09IFwidW5kZWZpbmVkXCIpID8gbnVsbCA6IHRoaXMuX19iYXNlVHlwZTtcclxufVxyXG5cclxuVHlwZS5wcm90b3R5cGUuZ2V0SW50ZXJmYWNlcyA9IGZ1bmN0aW9uIFR5cGUkZ2V0SW50ZXJmYWNlcygpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojVHlwZS5nZXRJbnRlcmZhY2VzXCIgLz5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIkFycmF5XCIgZWxlbWVudFR5cGU9XCJUeXBlXCIgbWF5QmVOdWxsPVwiZmFsc2VcIiBlbGVtZW50TWF5QmVOdWxsPVwiZmFsc2VcIj48L3JldHVybnM+XHJcblx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0dmFyIHJlc3VsdCA9IFtdO1xyXG5cdHZhciB0eXBlID0gdGhpcztcclxuXHR3aGlsZSh0eXBlKSB7XHJcblx0XHR2YXIgaW50ZXJmYWNlcyA9IHR5cGUuX19pbnRlcmZhY2VzO1xyXG5cdFx0aWYgKGludGVyZmFjZXMpIHtcclxuXHRcdFx0Zm9yICh2YXIgaSA9IDAsIGwgPSBpbnRlcmZhY2VzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG5cdFx0XHRcdHZhciBpbnRlcmZhY2VUeXBlID0gaW50ZXJmYWNlc1tpXTtcclxuXHRcdFx0XHRpZiAoIUFycmF5LmNvbnRhaW5zKHJlc3VsdCwgaW50ZXJmYWNlVHlwZSkpIHtcclxuXHRcdFx0XHRcdHJlc3VsdFtyZXN1bHQubGVuZ3RoXSA9IGludGVyZmFjZVR5cGU7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHR0eXBlID0gdHlwZS5fX2Jhc2VUeXBlO1xyXG5cdH1cclxuXHRyZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5UeXBlLnByb3RvdHlwZS5nZXROYW1lID0gZnVuY3Rpb24gVHlwZSRnZXROYW1lKCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNUeXBlLmdldE5hbWVcIiAvPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiU3RyaW5nXCI+PC9yZXR1cm5zPlxyXG5cdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdHJldHVybiAodHlwZW9mKHRoaXMuX190eXBlTmFtZSkgPT09IFwidW5kZWZpbmVkXCIpID8gXCJcIiA6IHRoaXMuX190eXBlTmFtZTtcclxufVxyXG5cclxuVHlwZS5wcm90b3R5cGUuaW1wbGVtZW50c0ludGVyZmFjZSA9IGZ1bmN0aW9uIFR5cGUkaW1wbGVtZW50c0ludGVyZmFjZShpbnRlcmZhY2VUeXBlKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1R5cGUuaW1wbGVtZW50c0ludGVyZmFjZVwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiaW50ZXJmYWNlVHlwZVwiIHR5cGU9XCJUeXBlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIkJvb2xlYW5cIj48L3JldHVybnM+XHJcblxyXG5cdHRoaXMucmVzb2x2ZUluaGVyaXRhbmNlKCk7XHJcblxyXG5cdHZhciBpbnRlcmZhY2VOYW1lID0gaW50ZXJmYWNlVHlwZS5nZXROYW1lKCk7XHJcblx0dmFyIGNhY2hlID0gdGhpcy5fX2ludGVyZmFjZUNhY2hlO1xyXG5cdGlmIChjYWNoZSkge1xyXG5cdFx0dmFyIGNhY2hlRW50cnkgPSBjYWNoZVtpbnRlcmZhY2VOYW1lXTtcclxuXHRcdGlmICh0eXBlb2YoY2FjaGVFbnRyeSkgIT09ICd1bmRlZmluZWQnKSByZXR1cm4gY2FjaGVFbnRyeTtcclxuXHR9XHJcblx0ZWxzZSB7XHJcblx0XHRjYWNoZSA9IHRoaXMuX19pbnRlcmZhY2VDYWNoZSA9IHt9O1xyXG5cdH1cclxuXHJcblx0dmFyIGJhc2VUeXBlID0gdGhpcztcclxuXHR3aGlsZSAoYmFzZVR5cGUpIHtcclxuXHRcdHZhciBpbnRlcmZhY2VzID0gYmFzZVR5cGUuX19pbnRlcmZhY2VzO1xyXG5cdFx0aWYgKGludGVyZmFjZXMpIHtcclxuXHRcdFx0aWYgKEFycmF5LmluZGV4T2YoaW50ZXJmYWNlcywgaW50ZXJmYWNlVHlwZSkgIT09IC0xKSB7XHJcblx0XHRcdFx0cmV0dXJuIGNhY2hlW2ludGVyZmFjZU5hbWVdID0gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGJhc2VUeXBlID0gYmFzZVR5cGUuX19iYXNlVHlwZTtcclxuXHR9XHJcblxyXG5cdHJldHVybiBjYWNoZVtpbnRlcmZhY2VOYW1lXSA9IGZhbHNlO1xyXG59XHJcblxyXG5UeXBlLnByb3RvdHlwZS5pbmhlcml0c0Zyb20gPSBmdW5jdGlvbiBUeXBlJGluaGVyaXRzRnJvbShwYXJlbnRUeXBlKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1R5cGUuaW5oZXJpdHNGcm9tXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJwYXJlbnRUeXBlXCIgdHlwZT1cIlR5cGVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiQm9vbGVhblwiPjwvcmV0dXJucz5cclxuXHJcblx0dGhpcy5yZXNvbHZlSW5oZXJpdGFuY2UoKTtcclxuXHRyZXR1cm4gU3lzLl9pbmhlcml0c0Zyb20odGhpcywgcGFyZW50VHlwZSk7XHJcbn1cclxuXHJcblN5cy5faW5oZXJpdHNGcm9tID0gZnVuY3Rpb24gU3lzJF9pbmhlcml0c0Zyb20odHlwZSwgcGFyZW50VHlwZSkge1xyXG5cdHZhciByZXQ7XHJcblx0aWYgKHBhcmVudFR5cGUpIHtcclxuXHRcdHZhciBiYXNlVHlwZSA9IHR5cGUuX19iYXNlVHlwZTtcclxuXHRcdHdoaWxlIChiYXNlVHlwZSkge1xyXG5cdFx0XHRpZiAoYmFzZVR5cGUgPT09IHBhcmVudFR5cGUpIHtcclxuXHRcdFx0XHRyZXQgPSB0cnVlO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHR9XHJcblx0XHRcdGJhc2VUeXBlID0gYmFzZVR5cGUuX19iYXNlVHlwZTtcclxuXHRcdH1cclxuXHR9XHJcblx0cmV0dXJuICEhcmV0O1xyXG59XHJcblxyXG5UeXBlLnByb3RvdHlwZS5pbml0aWFsaXplQmFzZSA9IGZ1bmN0aW9uIFR5cGUkaW5pdGlhbGl6ZUJhc2UoaW5zdGFuY2UsIGJhc2VBcmd1bWVudHMpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojVHlwZS5pbml0aWFsaXplQmFzZVwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiaW5zdGFuY2VcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImJhc2VBcmd1bWVudHNcIiB0eXBlPVwiQXJyYXlcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCIgZWxlbWVudE1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucz48L3JldHVybnM+XHJcblxyXG5cdGlmICghU3lzLl9pc0luc3RhbmNlT2ZUeXBlKHRoaXMsIGluc3RhbmNlKSkgdGhyb3cgRXJyb3IuYXJndW1lbnRUeXBlKCdpbnN0YW5jZScsIE9iamVjdC5nZXRUeXBlKGluc3RhbmNlKSwgdGhpcyk7XHJcblxyXG5cdHRoaXMucmVzb2x2ZUluaGVyaXRhbmNlKCk7XHJcblx0aWYgKHRoaXMuX19iYXNlVHlwZSkge1xyXG5cdFx0aWYgKCFiYXNlQXJndW1lbnRzKSB7XHJcblx0XHRcdHRoaXMuX19iYXNlVHlwZS5hcHBseShpbnN0YW5jZSk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpcy5fX2Jhc2VUeXBlLmFwcGx5KGluc3RhbmNlLCBiYXNlQXJndW1lbnRzKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHJldHVybiBpbnN0YW5jZTtcclxufVxyXG5cclxuVHlwZS5wcm90b3R5cGUuaXNJbXBsZW1lbnRlZEJ5ID0gZnVuY3Rpb24gVHlwZSRpc0ltcGxlbWVudGVkQnkoaW5zdGFuY2UpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojVHlwZS5pc0ltcGxlbWVudGVkQnlcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImluc3RhbmNlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJCb29sZWFuXCI+PC9yZXR1cm5zPlxyXG5cclxuXHRpZiAodHlwZW9mKGluc3RhbmNlKSA9PT0gXCJ1bmRlZmluZWRcIiB8fCBpbnN0YW5jZSA9PT0gbnVsbCkgcmV0dXJuIGZhbHNlO1xyXG5cclxuXHR2YXIgaW5zdGFuY2VUeXBlID0gT2JqZWN0LmdldFR5cGUoaW5zdGFuY2UpO1xyXG5cdHJldHVybiAhIShpbnN0YW5jZVR5cGUuaW1wbGVtZW50c0ludGVyZmFjZSAmJiBpbnN0YW5jZVR5cGUuaW1wbGVtZW50c0ludGVyZmFjZSh0aGlzKSk7XHJcbn1cclxuXHJcblR5cGUucHJvdG90eXBlLmlzSW5zdGFuY2VPZlR5cGUgPSBmdW5jdGlvbiBUeXBlJGlzSW5zdGFuY2VPZlR5cGUoaW5zdGFuY2UpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojVHlwZS5pc0luc3RhbmNlT2ZUeXBlXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJpbnN0YW5jZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiQm9vbGVhblwiPjwvcmV0dXJucz5cclxuXHJcblx0cmV0dXJuIFN5cy5faXNJbnN0YW5jZU9mVHlwZSh0aGlzLCBpbnN0YW5jZSk7XHJcbn1cclxuXHJcblR5cGUucHJvdG90eXBlLnJlZ2lzdGVyQ2xhc3MgPSBmdW5jdGlvbiBUeXBlJHJlZ2lzdGVyQ2xhc3ModHlwZU5hbWUsIGJhc2VUeXBlLCBpbnRlcmZhY2VUeXBlcykge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNUeXBlLnJlZ2lzdGVyQ2xhc3NcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInR5cGVOYW1lXCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiYmFzZVR5cGVcIiB0eXBlPVwiVHlwZVwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImludGVyZmFjZVR5cGVzXCIgcGFyYW1ldGVyQXJyYXk9XCJ0cnVlXCIgdHlwZT1cIlR5cGVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiVHlwZVwiPjwvcmV0dXJucz5cclxuXHJcblx0aWYgKCFUeXBlLl9fZnVsbHlRdWFsaWZpZWRJZGVudGlmaWVyUmVnRXhwLnRlc3QodHlwZU5hbWUpKSB0aHJvdyBFcnJvci5hcmd1bWVudCgndHlwZU5hbWUnLCBTeXMuUmVzLm5vdEFUeXBlTmFtZSk7XHJcblx0dmFyIHBhcnNlZE5hbWU7XHJcblx0dHJ5IHtcclxuXHRcdHBhcnNlZE5hbWUgPSB3aW5kb3cuZXZhbCh0eXBlTmFtZSk7XHJcblx0fVxyXG5cdGNhdGNoKGUpIHtcclxuXHRcdHRocm93IEVycm9yLmFyZ3VtZW50KCd0eXBlTmFtZScsIFN5cy5SZXMuYXJndW1lbnRUeXBlTmFtZSk7XHJcblx0fVxyXG5cdGlmIChwYXJzZWROYW1lICE9PSB0aGlzKSB0aHJvdyBFcnJvci5hcmd1bWVudCgndHlwZU5hbWUnLCBTeXMuUmVzLmJhZFR5cGVOYW1lKTtcclxuXHRpZiAoU3lzLl9fcmVnaXN0ZXJlZFR5cGVzW3R5cGVOYW1lXSkgdGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTdHJpbmcuZm9ybWF0KFN5cy5SZXMudHlwZVJlZ2lzdGVyZWRUd2ljZSwgdHlwZU5hbWUpKTtcclxuXHJcblx0aWYgKChhcmd1bWVudHMubGVuZ3RoID4gMSkgJiYgKHR5cGVvZihiYXNlVHlwZSkgPT09ICd1bmRlZmluZWQnKSkgdGhyb3cgRXJyb3IuYXJndW1lbnRVbmRlZmluZWQoJ2Jhc2VUeXBlJyk7XHJcblxyXG5cdHRoaXMucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gdGhpcztcclxuXHR0aGlzLl9fdHlwZU5hbWUgPSB0eXBlTmFtZTtcclxuXHR0aGlzLl9fY2xhc3MgPSB0cnVlO1xyXG5cdGlmIChiYXNlVHlwZSkge1xyXG5cdFx0dGhpcy5fX2Jhc2VUeXBlID0gYmFzZVR5cGU7XHJcblx0XHR0aGlzLl9fYmFzZVByb3RvdHlwZVBlbmRpbmcgPSB0cnVlO1xyXG5cdH1cclxuXHRTeXMuX191cHBlckNhc2VUeXBlc1t0eXBlTmFtZS50b1VwcGVyQ2FzZSgpXSA9IHRoaXM7XHJcblxyXG5cdGlmIChpbnRlcmZhY2VUeXBlcykge1xyXG5cdFx0dGhpcy5fX2ludGVyZmFjZXMgPSBbXTtcclxuXHRcdHRoaXMucmVzb2x2ZUluaGVyaXRhbmNlKCk7XHJcblx0XHRmb3IgKHZhciBpID0gMiwgbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuXHRcdFx0dmFyIGludGVyZmFjZVR5cGUgPSBhcmd1bWVudHNbaV07XHJcblx0XHRcdGlmICghaW50ZXJmYWNlVHlwZS5fX2ludGVyZmFjZSkgdGhyb3cgRXJyb3IuYXJndW1lbnQoJ2ludGVyZmFjZVR5cGVzWycgKyAoaSAtIDIpICsgJ10nLCBTeXMuUmVzLm5vdEFuSW50ZXJmYWNlKTtcclxuXHRcdFx0Zm9yICh2YXIgbWV0aG9kTmFtZSBpbiBpbnRlcmZhY2VUeXBlLnByb3RvdHlwZSkge1xyXG5cdFx0XHRcdHZhciBtZXRob2QgPSBpbnRlcmZhY2VUeXBlLnByb3RvdHlwZVttZXRob2ROYW1lXTtcclxuXHRcdFx0XHRpZiAoIXRoaXMucHJvdG90eXBlW21ldGhvZE5hbWVdKSB7XHJcblx0XHRcdFx0XHR0aGlzLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IG1ldGhvZDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5fX2ludGVyZmFjZXMucHVzaChpbnRlcmZhY2VUeXBlKTtcclxuXHRcdH1cclxuXHR9XHJcblx0U3lzLl9fcmVnaXN0ZXJlZFR5cGVzW3R5cGVOYW1lXSA9IHRydWU7XHJcblx0cmV0dXJuIHRoaXM7XHJcbn1cclxuXHJcblN5cy5yZWdpc3RlckNvbXBvbmVudCA9IGZ1bmN0aW9uIFN5cyRyZWdpc3RlckNvbXBvbmVudCh0eXBlLCBvcHRpb25zKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5yZWdpc3RlckNvbXBvbmVudFwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwidHlwZVwiIHR5cGU9XCJGdW5jdGlvblwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwib3B0aW9uc1wiIHR5cGU9XCJPYmplY3RcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHJcblx0dmFyIHR5cGVOYW1lID0gdHlwZS5nZXROYW1lKCk7XHJcblx0dmFyIGlzQ29udHJvbE9yQmVoYXZpb3IgPSBTeXMuVUkgJiYgKFN5cy5faW5oZXJpdHNGcm9tKHR5cGUsIFN5cy5VSS5Db250cm9sKSB8fCBTeXMuX2luaGVyaXRzRnJvbSh0eXBlLCBTeXMuVUkuQmVoYXZpb3IpKTtcclxuXHR2YXIgbmFtZSA9IChvcHRpb25zICYmIG9wdGlvbnMubmFtZSk7XHJcblx0aWYgKCFuYW1lKSB7XHJcblx0XHRuYW1lID0gdHlwZU5hbWU7XHJcblx0XHR2YXIgaSA9IG5hbWUubGFzdEluZGV4T2YoJy4nKTtcclxuXHRcdGlmIChpID49IDApIHtcclxuXHRcdFx0bmFtZSA9IG5hbWUuc3Vic3RyKGkrMSk7XHJcblx0XHRcdGlmIChuYW1lICYmIG5hbWUuY2hhckF0KDApID09PSBcIl9cIikgcmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0bmFtZSA9IG5hbWUuc3Vic3RyKDAsIDEpLnRvTG93ZXJDYXNlKCkgKyBuYW1lLnN1YnN0cigxKTtcclxuXHR9XHJcblx0aWYgKCFvcHRpb25zKSB7XHJcblx0XHRvcHRpb25zID0ge307XHJcblx0fVxyXG5cdG9wdGlvbnMubmFtZSA9IG5hbWU7XHJcblx0b3B0aW9ucy50eXBlID0gdHlwZTtcclxuXHRvcHRpb25zLnR5cGVOYW1lID0gdHlwZU5hbWU7XHJcblx0b3B0aW9ucy5faXNCZWhhdmlvciA9IGlzQ29udHJvbE9yQmVoYXZpb3I7XHJcblx0U3lzLmNvbXBvbmVudHNbbmFtZV0gPSBtZXJnZShTeXMuY29tcG9uZW50c1tuYW1lXSwgb3B0aW9ucyk7XHJcblx0dmFyIGZuID0gU3lzLmNyZWF0ZVtuYW1lXSxcclxuXHRcdGRlZmF1bHRzID0gZm4gJiYgZm4uZGVmYXVsdHM7XHJcblx0U3lzLmNyZWF0ZVtuYW1lXSA9IGZuID0gU3lzLl9nZXRDcmVhdGUodHlwZSwgaXNDb250cm9sT3JCZWhhdmlvciwgb3B0aW9ucyk7XHJcblx0Zm4uZGVmYXVsdHMgPSBkZWZhdWx0cyB8fCBudWxsO1xyXG5cdGZuLl9jb21wb25lbnQgPSBvcHRpb25zO1xyXG5cdGlmICh3aW5kb3cualF1ZXJ5KSB7XHJcblx0XHR2YXIgalRhcmdldCA9IGlzQ29udHJvbE9yQmVoYXZpb3IgPyBqUXVlcnkuZm4gOiBqUXVlcnk7XHJcblx0XHRpZiAoIWpUYXJnZXQuaGFzT3duUHJvcGVydHkobmFtZSkpIHtcclxuXHRcdFx0Zm4gPSBqVGFyZ2V0W25hbWVdO1xyXG5cdFx0XHRkZWZhdWx0cyA9IGZuICYmIGZuLmRlZmF1bHRzO1xyXG5cdFx0XHRqVGFyZ2V0W25hbWVdID0gZm4gPSBTeXMuX2dldENyZWF0ZSh0eXBlLCBpc0NvbnRyb2xPckJlaGF2aW9yLCBvcHRpb25zLCB0cnVlKTtcclxuXHRcdFx0Zm4uZGVmYXVsdHMgPSBkZWZhdWx0cyB8fCBudWxsO1xyXG5cdFx0XHRmbi5fY29tcG9uZW50ID0gb3B0aW9ucztcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcblN5cy5fZ2V0Q3JlYXRlID0gZnVuY3Rpb24gX2dldENyZWF0ZSh0eXBlLCBpc0NvbnRyb2xPckJlaGF2aW9yLCBvcHRpb25zLCBpc2pRdWVyeSkge1xyXG5cdHZhciB0eXBlTmFtZSA9IHR5cGUuZ2V0TmFtZSgpLFxyXG5cdFx0Ym9keSA9IFtdLFxyXG5cdFx0YXJnbGlzdCA9IFtdLFxyXG5cdFx0ZGVzY3JpcHRpb24gPSAob3B0aW9ucyAmJiBvcHRpb25zLmRlc2NyaXB0aW9uKSB8fCBcIkNyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgdGhlIHR5cGUgJ1wiICsgdHlwZU5hbWUgICsgXCInIGFuZCBzZXRzIHRoZSBnaXZlbiBwcm9wZXJ0aWVzLlwiO1xyXG5cdGJvZHkucHVzaChcIi8vLyA8c3VtbWFyeT5cIiwgZGVzY3JpcHRpb24sIFwiPC9zdW1tYXJ5PlxcblwiKTtcclxuXHRpZiAoaXNDb250cm9sT3JCZWhhdmlvciAmJiAhaXNqUXVlcnkpIHtcclxuXHRcdGFyZ2xpc3QucHVzaChcInRhcmdldFwiKTtcclxuXHRcdGJvZHkucHVzaCgnLy8vIDxwYXJhbSBuYW1lPVwidGFyZ2V0XCI+VGhlIERPTSBlbGVtZW50IHRvIGF0dGFjaCB0bywgYXMgYSBET00gZWxlbWVudCBvciBzZWxlY3Rvci48L3BhcmFtPlxcbicpO1xyXG5cdH1cclxuXHRmb3JlYWNoKG9wdGlvbnMgJiYgb3B0aW9ucy5wYXJhbWV0ZXJzLCBmdW5jdGlvbihwYXJhbWV0ZXIpIHtcclxuXHRcdHZhciBuYW1lID0gcGFyYW1ldGVyLCB0eXBlID0gJycsIGRlc2MgPSAnJztcclxuXHRcdGlmICh0eXBlb2YocGFyYW1ldGVyKSAhPT0gXCJzdHJpbmdcIikge1xyXG5cdFx0XHRuYW1lID0gcGFyYW1ldGVyLm5hbWU7XHJcblx0XHRcdHR5cGUgPSBwYXJhbWV0ZXIudHlwZXx8Jyc7XHJcblx0XHRcdGRlc2MgPSBwYXJhbWV0ZXIuZGVzY3JpcHRpb258fCcnO1xyXG5cdFx0fVxyXG5cdFx0YXJnbGlzdC5wdXNoKG5hbWUpO1xyXG5cdFx0Ym9keS5wdXNoKCcvLy8gPHBhcmFtIG5hbWU9XCInLCBuYW1lLCAnXCIgdHlwZT1cIicsIHR5cGUsICdcIj4nLCBkZXNjLCAnPC9wYXJhbT5cXG4nKTtcclxuXHR9KTtcclxuXHRhcmdsaXN0LnB1c2goXCJwcm9wZXJ0aWVzXCIpO1xyXG5cdGJvZHkucHVzaCgnLy8vIDxwYXJhbSBuYW1lPVwicHJvcGVydGllc1wiIHR5cGU9XCJPYmplY3RcIiBtYXlCZU51bGw9XCJ0cnVlXCIgb3B0aW9uYWw9XCJ0cnVlXCI+QWRkaXRpb25hbCBwcm9wZXJ0aWVzIHRvIHNldCBvbiB0aGUgY29tcG9uZW50LjwvcGFyYW0+XFxuJyk7XHJcblx0aWYgKCFpc2pRdWVyeSkge1xyXG5cdFx0Ym9keS5wdXNoKCcvLy8gPHJldHVybnMgdHlwZT1cIicsIHR5cGVOYW1lLCAnXCI+PC9yZXR1cm5zPlxcbicsXHJcblx0XHRcdFx0ICAncmV0dXJuIFN5cy5fY3JlYXRlQ29tcChhcmd1bWVudHMuY2FsbGVlLl9jb21wb25lbnQsIGFyZ3VtZW50cy5jYWxsZWUuZGVmYXVsdHMsIGFyZ3VtZW50cyk7Jyk7XHJcblx0fVxyXG5cdGVsc2Uge1xyXG5cdFx0Ym9keS5wdXNoKFwidmFyIGNhbGxlZSA9IGFyZ3VtZW50cy5jYWxsZWUsIGNvbXBvbmVudCA9IGNhbGxlZS5fY29tcG9uZW50LCBkZWZhdWx0cyA9IGNhbGxlZS5kZWZhdWx0cywgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7XFxuYXJncy5zcGxpY2UoMCwgMCwgbnVsbCk7XFxucmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcXG5cIixcclxuXHRcdFx0XHQgIFwiICAgIGFyZ3NbMF0gPSB0aGlzO1xcbiAgICBTeXMuX2NyZWF0ZUNvbXAoY29tcG9uZW50LCBkZWZhdWx0cywgYXJncylcXG5cIixcclxuXHRcdFx0XHQgIFwifSk7XCIpO1xyXG5cdH1cclxuXHRhcmdsaXN0LnB1c2goYm9keS5qb2luKCcnKSk7XHJcblx0cmV0dXJuIEZ1bmN0aW9uLmFwcGx5KG51bGwsIGFyZ2xpc3QpO1xyXG59XHJcblxyXG5TeXMucmVnaXN0ZXJQbHVnaW4gPSBmdW5jdGlvbiBTeXMkcmVnaXN0ZXJQbHVnaW4ocGx1Z2luSW5mbykge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMucmVnaXN0ZXJQbHVnaW5cIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInBsdWdpbkluZm9cIiB0eXBlPVwiT2JqZWN0XCI+PC9wYXJhbT5cclxuXHJcblx0dmFyIG5hbWUgPSBwbHVnaW5JbmZvLm5hbWU7XHJcblx0U3lzLnBsdWdpbnNbbmFtZV0gPSBtZXJnZShTeXMucGx1Z2luc1tuYW1lXSwgcGx1Z2luSW5mbyk7XHJcblx0U3lzW25hbWVdID0gcGx1Z2luSW5mby5wbHVnaW47XHJcblx0aWYgKHdpbmRvdy5qUXVlcnkpIHtcclxuXHRcdGpRdWVyeVtuYW1lXSA9IFN5c1tuYW1lXTtcclxuXHR9XHJcbn1cclxuXHJcblN5cy5fY3JlYXRlQ29tcCA9IGZ1bmN0aW9uIF9jcmVhdGVDb21wKGNvbXBvbmVudCwgZGVmYXVsdHMsIGFyZ3MpIHtcclxuXHR2YXIgcGFyYW1ldGVycyA9IGNvbXBvbmVudC5wYXJhbWV0ZXJzIHx8IFtdLFxyXG5cdFx0aXNCZWhhdmlvciA9IGNvbXBvbmVudC5faXNCZWhhdmlvcixcclxuXHRcdHRhcmdldCA9IGlzQmVoYXZpb3IgPyBhcmdzWzBdIDogbnVsbDtcclxuXHR2YXIgb2Zmc2V0RnJvbVRhcmdldEFyZ3VtZW50ID0gaXNCZWhhdmlvciA/IDEgOiAwO1xyXG5cdHZhciBwcm9wcyA9IGFyZ3NbcGFyYW1ldGVycy5sZW5ndGggKyBvZmZzZXRGcm9tVGFyZ2V0QXJndW1lbnRdIHx8IHt9O1xyXG5cdHByb3BzID0gbWVyZ2Uoe30sIGRlZmF1bHRzLCBwcm9wcyk7XHJcblx0Zm9yZWFjaChwYXJhbWV0ZXJzLCBmdW5jdGlvbihwYXJhbWV0ZXIsIGkpIHtcclxuXHRcdHZhciBuYW1lID0gdHlwZW9mKHBhcmFtZXRlcikgPT09IFwic3RyaW5nXCIgPyBwYXJhbWV0ZXIgOiBwYXJhbWV0ZXIubmFtZSxcclxuXHRcdFx0dmFsdWUgPSBhcmdzW2kgKyBvZmZzZXRGcm9tVGFyZ2V0QXJndW1lbnRdO1xyXG5cdFx0aWYgKHR5cGVvZih2YWx1ZSkgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHByb3BzW25hbWVdKSA9PT0gXCJ1bmRlZmluZWRcIikge1xyXG5cdFx0XHRwcm9wc1tuYW1lXSA9IHZhbHVlO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cdHJldHVybiBpc0JlaGF2aW9yID9cclxuXHRcdFN5cy5fY3JlYXRlKGNvbXBvbmVudC50eXBlLCBwcm9wcywgdGFyZ2V0KSA6XHJcblx0XHRTeXMuX2NyZWF0ZShjb21wb25lbnQudHlwZSwgcHJvcHMpO1xyXG59XHJcblxyXG5TeXMuX2NyZWF0ZSA9IGZ1bmN0aW9uIF9jcmVhdGUodHlwZSwgcHJvcGVydGllcywgdGFyZ2V0KSB7XHJcblx0dmFyIHRhcmdldFR5cGUgPSB0eXBlb2YodGFyZ2V0KTtcclxuXHRpZiAodGFyZ2V0VHlwZSA9PT0gXCJzdHJpbmdcIikge1xyXG5cdFx0dGFyZ2V0ID0gU3lzLmdldCh0YXJnZXQpO1xyXG5cdH1cclxuXHR2YXIgaW5zdGFuY2U7XHJcblx0U3lzLl8yUGFzcyhmdW5jdGlvbigpIHtcclxuXHRcdGluc3RhbmNlID0gdGFyZ2V0VHlwZSA9PT0gXCJ1bmRlZmluZWRcIiA/IG5ldyB0eXBlKCkgOiBuZXcgdHlwZSh0YXJnZXQpO1xyXG5cdFx0Y2FsbElmKGluc3RhbmNlLCBcImJlZ2luVXBkYXRlXCIpO1xyXG5cdFx0U3lzLl9zZXRQcm9wcyhpbnN0YW5jZSwgcHJvcGVydGllcyk7XHJcblx0XHR2YXIgY29tcG9uZW50VHlwZSA9IFN5cy5Db21wb25lbnQ7XHJcblx0XHRpZiAoIWNvbXBvbmVudFR5cGUgfHwgIWNvbXBvbmVudFR5cGUuX3JlZ2lzdGVyKGluc3RhbmNlKSkge1xyXG5cdFx0XHRjYWxsSWYoaW5zdGFuY2UsIFwiZW5kVXBkYXRlXCIpIHx8IGNhbGxJZihpbnN0YW5jZSwgXCJpbml0aWFsaXplXCIpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cdHJldHVybiBpbnN0YW5jZTtcclxufVxyXG5cclxuU3lzLl9zZXRQcm9wcyA9IGZ1bmN0aW9uIF9zZXRQcm9wcyhpbnN0YW5jZSwgcHJvcGVydGllcykge1xyXG5cdGZvckluKHByb3BlcnRpZXMsIGZ1bmN0aW9uKHZhbHVlLCBmaWVsZCkge1xyXG5cdFx0Y2FsbElmKGluc3RhbmNlLCBcImFkZF9cIiArIGZpZWxkLCB2YWx1ZSkgfHxcclxuXHRcdGNhbGxJZihpbnN0YW5jZSwgXCJzZXRfXCIgKyBmaWVsZCwgdmFsdWUpIHx8XHJcblx0XHQoaW5zdGFuY2VbZmllbGRdID0gdmFsdWUpO1xyXG5cdH0pO1xyXG59XHJcblxyXG5UeXBlLnByb3RvdHlwZS5yZWdpc3RlckludGVyZmFjZSA9IGZ1bmN0aW9uIFR5cGUkcmVnaXN0ZXJJbnRlcmZhY2UodHlwZU5hbWUpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojVHlwZS5yZWdpc3RlckludGVyZmFjZVwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwidHlwZU5hbWVcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIlR5cGVcIj48L3JldHVybnM+XHJcblxyXG5cdGlmICghVHlwZS5fX2Z1bGx5UXVhbGlmaWVkSWRlbnRpZmllclJlZ0V4cC50ZXN0KHR5cGVOYW1lKSkgdGhyb3cgRXJyb3IuYXJndW1lbnQoJ3R5cGVOYW1lJywgU3lzLlJlcy5ub3RBVHlwZU5hbWUpO1xyXG5cdHZhciBwYXJzZWROYW1lO1xyXG5cdHRyeSB7XHJcblx0XHRwYXJzZWROYW1lID0gd2luZG93LmV2YWwodHlwZU5hbWUpO1xyXG5cdH1cclxuXHRjYXRjaChlKSB7XHJcblx0XHR0aHJvdyBFcnJvci5hcmd1bWVudCgndHlwZU5hbWUnLCBTeXMuUmVzLmFyZ3VtZW50VHlwZU5hbWUpO1xyXG5cdH1cclxuXHRpZiAocGFyc2VkTmFtZSAhPT0gdGhpcykgdGhyb3cgRXJyb3IuYXJndW1lbnQoJ3R5cGVOYW1lJywgU3lzLlJlcy5iYWRUeXBlTmFtZSk7XHJcblx0aWYgKFN5cy5fX3JlZ2lzdGVyZWRUeXBlc1t0eXBlTmFtZV0pIHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuUmVzLnR5cGVSZWdpc3RlcmVkVHdpY2UsIHR5cGVOYW1lKSk7XHJcblx0U3lzLl9fdXBwZXJDYXNlVHlwZXNbdHlwZU5hbWUudG9VcHBlckNhc2UoKV0gPSB0aGlzO1xyXG5cclxuXHR0aGlzLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IHRoaXM7XHJcblx0dGhpcy5fX3R5cGVOYW1lID0gdHlwZU5hbWU7XHJcblx0dGhpcy5fX2ludGVyZmFjZSA9IHRydWU7XHJcblx0U3lzLl9fcmVnaXN0ZXJlZFR5cGVzW3R5cGVOYW1lXSA9IHRydWU7XHJcblxyXG5cdHJldHVybiB0aGlzO1xyXG59XHJcblxyXG5UeXBlLnByb3RvdHlwZS5yZXNvbHZlSW5oZXJpdGFuY2UgPSBmdW5jdGlvbiBUeXBlJHJlc29sdmVJbmhlcml0YW5jZSgpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojVHlwZS5yZXNvbHZlSW5oZXJpdGFuY2VcIiAvPlxyXG5cdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cclxuXHRpZiAodGhpcy5fX2Jhc2VQcm90b3R5cGVQZW5kaW5nKSB7XHJcblx0XHR2YXIgYmFzZVR5cGUgPSB0aGlzLl9fYmFzZVR5cGU7XHJcblxyXG5cdFx0YmFzZVR5cGUucmVzb2x2ZUluaGVyaXRhbmNlKCk7XHJcblxyXG5cdFx0Zm9yICh2YXIgbWVtYmVyTmFtZSBpbiBiYXNlVHlwZS5wcm90b3R5cGUpIHtcclxuXHRcdFx0dmFyIG1lbWJlclZhbHVlID0gYmFzZVR5cGUucHJvdG90eXBlW21lbWJlck5hbWVdO1xyXG5cdFx0XHRpZiAoIXRoaXMucHJvdG90eXBlW21lbWJlck5hbWVdKSB7XHJcblx0XHRcdFx0dGhpcy5wcm90b3R5cGVbbWVtYmVyTmFtZV0gPSBtZW1iZXJWYWx1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZGVsZXRlIHRoaXMuX19iYXNlUHJvdG90eXBlUGVuZGluZztcclxuXHR9XHJcbn1cclxuXHJcblR5cGUuZ2V0Um9vdE5hbWVzcGFjZXMgPSBmdW5jdGlvbiBUeXBlJGdldFJvb3ROYW1lc3BhY2VzKCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNUeXBlLmdldFJvb3ROYW1lc3BhY2VzXCIgLz5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIkFycmF5XCI+PC9yZXR1cm5zPlxyXG5cdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdHJldHVybiBBcnJheS5jbG9uZShTeXMuX19yb290TmFtZXNwYWNlcyk7XHJcbn1cclxuXHJcblR5cGUuaXNDbGFzcyA9IGZ1bmN0aW9uIFR5cGUkaXNDbGFzcyh0eXBlKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1R5cGUuaXNDbGFzc1wiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwidHlwZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiQm9vbGVhblwiPjwvcmV0dXJucz5cclxuXHJcblx0aWYgKCh0eXBlb2YodHlwZSkgPT09ICd1bmRlZmluZWQnKSB8fCAodHlwZSA9PT0gbnVsbCkpIHJldHVybiBmYWxzZTtcclxuXHRyZXR1cm4gISF0eXBlLl9fY2xhc3M7XHJcbn1cclxuXHJcblR5cGUuaXNJbnRlcmZhY2UgPSBmdW5jdGlvbiBUeXBlJGlzSW50ZXJmYWNlKHR5cGUpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojVHlwZS5pc0ludGVyZmFjZVwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwidHlwZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiQm9vbGVhblwiPjwvcmV0dXJucz5cclxuXHJcblx0aWYgKCh0eXBlb2YodHlwZSkgPT09ICd1bmRlZmluZWQnKSB8fCAodHlwZSA9PT0gbnVsbCkpIHJldHVybiBmYWxzZTtcclxuXHRyZXR1cm4gISF0eXBlLl9faW50ZXJmYWNlO1xyXG59XHJcblxyXG5UeXBlLmlzTmFtZXNwYWNlID0gZnVuY3Rpb24gVHlwZSRpc05hbWVzcGFjZShvYmplY3QpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojVHlwZS5pc05hbWVzcGFjZVwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwib2JqZWN0XCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJCb29sZWFuXCI+PC9yZXR1cm5zPlxyXG5cclxuXHRpZiAoKHR5cGVvZihvYmplY3QpID09PSAndW5kZWZpbmVkJykgfHwgKG9iamVjdCA9PT0gbnVsbCkpIHJldHVybiBmYWxzZTtcclxuXHRyZXR1cm4gISFvYmplY3QuX19uYW1lc3BhY2U7XHJcbn1cclxuXHJcblR5cGUucGFyc2UgPSBmdW5jdGlvbiBUeXBlJHBhcnNlKHR5cGVOYW1lLCBucykge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNUeXBlLnBhcnNlXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ0eXBlTmFtZVwiIHR5cGU9XCJTdHJpbmdcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJuc1wiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiVHlwZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3JldHVybnM+XHJcblxyXG5cdHZhciBmbjtcclxuXHRpZiAobnMpIHtcclxuXHRcdGZuID0gU3lzLl9fdXBwZXJDYXNlVHlwZXNbbnMuZ2V0TmFtZSgpLnRvVXBwZXJDYXNlKCkgKyAnLicgKyB0eXBlTmFtZS50b1VwcGVyQ2FzZSgpXTtcclxuXHRcdHJldHVybiBmbiB8fCBudWxsO1xyXG5cdH1cclxuXHRpZiAoIXR5cGVOYW1lKSByZXR1cm4gbnVsbDtcclxuXHRpZiAoIVR5cGUuX19odENsYXNzZXMpIHtcclxuXHRcdFR5cGUuX19odENsYXNzZXMgPSB7fTtcclxuXHR9XHJcblx0Zm4gPSBUeXBlLl9faHRDbGFzc2VzW3R5cGVOYW1lXTtcclxuXHRpZiAoIWZuKSB7XHJcblx0XHRmbiA9IHdpbmRvdy5ldmFsKHR5cGVOYW1lKTtcclxuXHRcdGlmICh0eXBlb2YoZm4pICE9PSAnZnVuY3Rpb24nKSB0aHJvdyBFcnJvci5hcmd1bWVudCgndHlwZU5hbWUnLCBTeXMuUmVzLm5vdEFUeXBlTmFtZSk7XHJcblx0XHRUeXBlLl9faHRDbGFzc2VzW3R5cGVOYW1lXSA9IGZuO1xyXG5cdH1cclxuXHRyZXR1cm4gZm47XHJcbn1cclxuXHJcblR5cGUucmVnaXN0ZXJOYW1lc3BhY2UgPSBmdW5jdGlvbiBUeXBlJHJlZ2lzdGVyTmFtZXNwYWNlKG5hbWVzcGFjZVBhdGgpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojVHlwZS5yZWdpc3Rlck5hbWVzcGFjZVwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwibmFtZXNwYWNlUGF0aFwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cclxuXHRUeXBlLl9yZWdpc3Rlck5hbWVzcGFjZShuYW1lc3BhY2VQYXRoKTtcclxufVxyXG5UeXBlLl9yZWdpc3Rlck5hbWVzcGFjZSA9IGZ1bmN0aW9uIFR5cGUkX3JlZ2lzdGVyTmFtZXNwYWNlKG5hbWVzcGFjZVBhdGgpIHtcclxuXHRpZiAoIVR5cGUuX19mdWxseVF1YWxpZmllZElkZW50aWZpZXJSZWdFeHAudGVzdChuYW1lc3BhY2VQYXRoKSkgdGhyb3cgRXJyb3IuYXJndW1lbnQoJ25hbWVzcGFjZVBhdGgnLCBTeXMuUmVzLmludmFsaWROYW1lU3BhY2UpO1xyXG5cdHZhciByb290T2JqZWN0ID0gd2luZG93O1xyXG5cdHZhciBuYW1lc3BhY2VQYXJ0cyA9IG5hbWVzcGFjZVBhdGguc3BsaXQoJy4nKTtcclxuXHJcblx0Zm9yICh2YXIgaSA9IDAsIGwgPSBuYW1lc3BhY2VQYXJ0cy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuXHRcdHZhciBjdXJyZW50UGFydCA9IG5hbWVzcGFjZVBhcnRzW2ldO1xyXG5cdFx0dmFyIG5zID0gcm9vdE9iamVjdFtjdXJyZW50UGFydF07XHJcblx0XHR2YXIgbnNUeXBlID0gdHlwZW9mKG5zKTtcclxuXHRcdGlmICgobnNUeXBlICE9PSBcInVuZGVmaW5lZFwiKSAmJiAobnMgIT09IG51bGwpKSB7XHJcblx0XHRcdGlmIChuc1R5cGUgPT09IFwiZnVuY3Rpb25cIikge1xyXG5cdFx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuUmVzLm5hbWVzcGFjZUNvbnRhaW5zQ2xhc3MsIG5hbWVzcGFjZVBhcnRzLnNwbGljZSgwLCBpICsgMSkuam9pbignLicpKSk7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKCh0eXBlb2YobnMpICE9PSBcIm9iamVjdFwiKSB8fCAobnMgaW5zdGFuY2VvZiBBcnJheSkpIHtcclxuXHRcdFx0XHR0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN0cmluZy5mb3JtYXQoU3lzLlJlcy5uYW1lc3BhY2VDb250YWluc05vbk9iamVjdCwgbmFtZXNwYWNlUGFydHMuc3BsaWNlKDAsIGkgKyAxKS5qb2luKCcuJykpKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0aWYgKCFucykge1xyXG5cdFx0XHRucyA9IHJvb3RPYmplY3RbY3VycmVudFBhcnRdID0ge307XHJcblx0XHR9XHJcblx0XHRpZiAoIW5zLl9fbmFtZXNwYWNlKSB7XHJcblx0XHRcdGlmICghaSAmJiAobmFtZXNwYWNlUGF0aCAhPT0gXCJTeXNcIikpIHtcclxuXHRcdFx0XHRTeXMuX19yb290TmFtZXNwYWNlcy5wdXNoKG5zKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRucy5fX25hbWVzcGFjZSA9IHRydWU7XHJcblx0XHRcdG5zLl9fdHlwZU5hbWUgPSBuYW1lc3BhY2VQYXJ0cy5zbGljZSgwLCBpICsgMSkuam9pbignLicpO1xyXG5cdFx0XHR2YXIgcGFyc2VkTmFtZTtcclxuXHRcdFx0dHJ5IHtcclxuXHRcdFx0XHRwYXJzZWROYW1lID0gd2luZG93LmV2YWwobnMuX190eXBlTmFtZSk7XHJcblx0XHRcdH1cclxuXHRcdFx0Y2F0Y2goZSkge1xyXG5cdFx0XHRcdHBhcnNlZE5hbWUgPSBudWxsO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChwYXJzZWROYW1lICE9PSBucykge1xyXG5cdFx0XHRcdGRlbGV0ZSByb290T2JqZWN0W2N1cnJlbnRQYXJ0XTtcclxuXHRcdFx0XHR0aHJvdyBFcnJvci5hcmd1bWVudCgnbmFtZXNwYWNlUGF0aCcsIFN5cy5SZXMuaW52YWxpZE5hbWVTcGFjZSk7XHJcblx0XHRcdH1cclxuXHRcdFx0bnMuZ2V0TmFtZSA9IGZ1bmN0aW9uIG5zJGdldE5hbWUoKSB7cmV0dXJuIHRoaXMuX190eXBlTmFtZTt9XHJcblx0XHR9XHJcblx0XHRyb290T2JqZWN0ID0gbnM7XHJcblx0fVxyXG59XHJcblxyXG5UeXBlLl9jaGVja0RlcGVuZGVuY3kgPSBmdW5jdGlvbiBUeXBlJF9jaGVja0RlcGVuZGVuY3koZGVwZW5kZW5jeSwgZmVhdHVyZU5hbWUpIHtcclxuXHR2YXIgc2NyaXB0cyA9IFR5cGUuX3JlZ2lzdGVyU2NyaXB0Ll9zY3JpcHRzLCBpc0RlcGVuZGVudCA9IChzY3JpcHRzID8gKCEhc2NyaXB0c1tkZXBlbmRlbmN5XSkgOiBmYWxzZSk7XHJcblx0aWYgKCh0eXBlb2YoZmVhdHVyZU5hbWUpICE9PSAndW5kZWZpbmVkJykgJiYgIWlzRGVwZW5kZW50KSB7XHJcblx0XHR0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN0cmluZy5mb3JtYXQoU3lzLlJlcy5yZXF1aXJlZFNjcmlwdFJlZmVyZW5jZU5vdEluY2x1ZGVkLFxyXG5cdFx0ZmVhdHVyZU5hbWUsIGRlcGVuZGVuY3kpKTtcclxuXHR9XHJcblx0cmV0dXJuIGlzRGVwZW5kZW50O1xyXG59XHJcblxyXG5UeXBlLl9yZWdpc3RlclNjcmlwdCA9IGZ1bmN0aW9uIFR5cGUkX3JlZ2lzdGVyU2NyaXB0KHNjcmlwdE5hbWUsIGRlcGVuZGVuY2llcykge1xyXG5cdHZhciBzY3JpcHRzID0gVHlwZS5fcmVnaXN0ZXJTY3JpcHQuX3NjcmlwdHM7XHJcblx0aWYgKCFzY3JpcHRzKSB7XHJcblx0XHRUeXBlLl9yZWdpc3RlclNjcmlwdC5fc2NyaXB0cyA9IHNjcmlwdHMgPSB7fTtcclxuXHR9XHJcblx0aWYgKHNjcmlwdHNbc2NyaXB0TmFtZV0pIHtcclxuXHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuUmVzLnNjcmlwdEFscmVhZHlMb2FkZWQsIHNjcmlwdE5hbWUpKTtcclxuXHR9XHJcblx0c2NyaXB0c1tzY3JpcHROYW1lXSA9IHRydWU7XHJcblx0aWYgKGRlcGVuZGVuY2llcykge1xyXG5cdFx0Zm9yICh2YXIgaSA9IDAsIGwgPSBkZXBlbmRlbmNpZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XHJcblx0XHRcdHZhciBkZXBlbmRlbmN5ID0gZGVwZW5kZW5jaWVzW2ldO1xyXG5cdFx0XHRpZiAoIVR5cGUuX2NoZWNrRGVwZW5kZW5jeShkZXBlbmRlbmN5KSkge1xyXG5cdFx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuUmVzLnNjcmlwdERlcGVuZGVuY3lOb3RGb3VuZCwgc2NyaXB0TmFtZSwgZGVwZW5kZW5jeSkpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5UeXBlLl9yZWdpc3Rlck5hbWVzcGFjZShcIlN5c1wiKTtcclxuU3lzLl9fdXBwZXJDYXNlVHlwZXMgPSB7fTtcclxuU3lzLl9fcm9vdE5hbWVzcGFjZXMgPSBbU3lzXTtcclxuU3lzLl9fcmVnaXN0ZXJlZFR5cGVzID0ge307XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblN5cy5faXNJbnN0YW5jZU9mVHlwZSA9IGZ1bmN0aW9uIFN5cyRfaXNJbnN0YW5jZU9mVHlwZSh0eXBlLCBpbnN0YW5jZSkge1xyXG5cdGlmICh0eXBlb2YoaW5zdGFuY2UpID09PSBcInVuZGVmaW5lZFwiIHx8IGluc3RhbmNlID09PSBudWxsKSByZXR1cm4gZmFsc2U7XHJcblx0aWYgKGluc3RhbmNlIGluc3RhbmNlb2YgdHlwZSkgcmV0dXJuIHRydWU7XHJcblx0dmFyIGluc3RhbmNlVHlwZSA9IE9iamVjdC5nZXRUeXBlKGluc3RhbmNlKTtcclxuXHRyZXR1cm4gISEoaW5zdGFuY2VUeXBlID09PSB0eXBlKSB8fFxyXG5cdFx0ICAgKGluc3RhbmNlVHlwZS5pbmhlcml0c0Zyb20gJiYgaW5zdGFuY2VUeXBlLmluaGVyaXRzRnJvbSh0eXBlKSkgfHxcclxuXHRcdCAgIChpbnN0YW5jZVR5cGUuaW1wbGVtZW50c0ludGVyZmFjZSAmJiBpbnN0YW5jZVR5cGUuaW1wbGVtZW50c0ludGVyZmFjZSh0eXBlKSk7XHJcbn1cclxuXHJcblxyXG5cclxuU3lzLl9nZXRCYXNlTWV0aG9kID0gZnVuY3Rpb24gU3lzJF9nZXRCYXNlTWV0aG9kKHR5cGUsIGluc3RhbmNlLCBuYW1lKSB7XHJcblx0aWYgKCFTeXMuX2lzSW5zdGFuY2VPZlR5cGUodHlwZSwgaW5zdGFuY2UpKSB0aHJvdyBFcnJvci5hcmd1bWVudFR5cGUoJ2luc3RhbmNlJywgT2JqZWN0LmdldFR5cGUoaW5zdGFuY2UpLCB0eXBlKTtcclxuXHR2YXIgYmFzZVR5cGUgPSB0eXBlLmdldEJhc2VUeXBlKCk7XHJcblx0aWYgKGJhc2VUeXBlKSB7XHJcblx0XHR2YXIgYmFzZU1ldGhvZCA9IGJhc2VUeXBlLnByb3RvdHlwZVtuYW1lXTtcclxuXHRcdHJldHVybiAoYmFzZU1ldGhvZCBpbnN0YW5jZW9mIEZ1bmN0aW9uKSA/IGJhc2VNZXRob2QgOiBudWxsO1xyXG5cdH1cclxuXHRyZXR1cm4gbnVsbDtcclxufVxyXG5cclxuU3lzLl9pc0RvbUVsZW1lbnQgPSBmdW5jdGlvbiBTeXMkX2lzRG9tRWxlbWVudChvYmopIHtcclxuXHR2YXIgdmFsID0gZmFsc2U7XHJcblx0aWYgKHR5cGVvZiAob2JqLm5vZGVUeXBlKSAhPT0gJ251bWJlcicpIHtcclxuXHRcdHZhciBkb2MgPSBvYmoub3duZXJEb2N1bWVudCB8fCBvYmouZG9jdW1lbnQgfHwgb2JqO1xyXG5cdFx0aWYgKGRvYyAhPSBvYmopIHtcclxuXHRcdFx0dmFyIHcgPSBkb2MuZGVmYXVsdFZpZXcgfHwgZG9jLnBhcmVudFdpbmRvdztcclxuXHRcdFx0dmFsID0gKHcgIT0gb2JqKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHR2YWwgPSAhZG9jLmJvZHkgfHwgIVN5cy5faXNEb21FbGVtZW50KGRvYy5ib2R5KTtcclxuXHRcdH1cclxuXHR9XHJcblx0cmV0dXJuICF2YWw7XHJcbn1cclxuXHJcbnZhciBpc0Jyb3dzZXIgPSBTeXMuX2lzQnJvd3NlciA9IGZ1bmN0aW9uIFN5cyRfaXNCcm93c2VyKG5hbWUpIHtcclxuXHRpZiAobmFtZSA9PT0gJ0ludGVybmV0RXhwbG9yZXInKSByZXR1cm4gU3lzLkJyb3dzZXIuYWdlbnQgPT09IFN5cy5Ccm93c2VyW25hbWVdO1xyXG5cclxuXHRyZXR1cm4gU3lzLkJyb3dzZXIuYWdlbnQgPT09IFN5cy5Ccm93c2VyW25hbWVdO1xyXG59XHJcblxyXG5cclxuXHJcbmZvcmVhY2goU3lzLl9ucywgVHlwZS5fcmVnaXN0ZXJOYW1lc3BhY2UpO1xyXG5kZWxldGUgU3lzLl9ucztcclxuQXJyYXkuX190eXBlTmFtZSA9ICdBcnJheSc7XHJcbkFycmF5Ll9fY2xhc3MgPSB0cnVlO1xyXG5cclxuQXJyYXkuYWRkID0gQXJyYXkuZW5xdWV1ZSA9IGZ1bmN0aW9uIEFycmF5JGVucXVldWUoYXJyYXksIGl0ZW0pIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojQXJyYXkuZW5xdWV1ZVwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiYXJyYXlcIiB0eXBlPVwiQXJyYXlcIiBlbGVtZW50TWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiaXRlbVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cclxuXHJcblx0YXJyYXlbYXJyYXkubGVuZ3RoXSA9IGl0ZW07XHJcbn1cclxuXHJcbkFycmF5LmFkZFJhbmdlID0gZnVuY3Rpb24gQXJyYXkkYWRkUmFuZ2UoYXJyYXksIGl0ZW1zKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI0FycmF5LmFkZFJhbmdlXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJhcnJheVwiIHR5cGU9XCJBcnJheVwiIGVsZW1lbnRNYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJpdGVtc1wiIHR5cGU9XCJBcnJheVwiIGVsZW1lbnRNYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHJcblxyXG5cdGFycmF5LnB1c2guYXBwbHkoYXJyYXksIGl0ZW1zKTtcclxufVxyXG5cclxuQXJyYXkuY2xlYXIgPSBmdW5jdGlvbiBBcnJheSRjbGVhcihhcnJheSkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNBcnJheS5jbGVhclwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiYXJyYXlcIiB0eXBlPVwiQXJyYXlcIiBlbGVtZW50TWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblxyXG5cdGFycmF5Lmxlbmd0aCA9IDA7XHJcbn1cclxuXHJcbkFycmF5LmNsb25lID0gZnVuY3Rpb24gQXJyYXkkY2xvbmUoYXJyYXkpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojQXJyYXkuY2xvbmVcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImFycmF5XCIgdHlwZT1cIkFycmF5XCIgZWxlbWVudE1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiQXJyYXlcIiBlbGVtZW50TWF5QmVOdWxsPVwidHJ1ZVwiPjwvcmV0dXJucz5cclxuXHJcblx0aWYgKGFycmF5Lmxlbmd0aCA9PT0gMSkge1xyXG5cdFx0cmV0dXJuIFthcnJheVswXV07XHJcblx0fVxyXG5cdGVsc2Uge1xyXG5cdFx0cmV0dXJuIEFycmF5LmFwcGx5KG51bGwsIGFycmF5KTtcclxuXHR9XHJcbn1cclxuXHJcbkFycmF5LmNvbnRhaW5zID0gZnVuY3Rpb24gQXJyYXkkY29udGFpbnMoYXJyYXksIGl0ZW0pIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojQXJyYXkuY29udGFpbnNcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImFycmF5XCIgdHlwZT1cIkFycmF5XCIgZWxlbWVudE1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cIml0ZW1cIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIkJvb2xlYW5cIj48L3JldHVybnM+XHJcblxyXG5cdHJldHVybiAoaW5kZXhPZihhcnJheSwgaXRlbSkgPj0gMCk7XHJcbn1cclxuXHJcbkFycmF5LmRlcXVldWUgPSBmdW5jdGlvbiBBcnJheSRkZXF1ZXVlKGFycmF5KSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI0FycmF5LmRlcXVldWVcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImFycmF5XCIgdHlwZT1cIkFycmF5XCIgZWxlbWVudE1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyBtYXlCZU51bGw9XCJ0cnVlXCI+PC9yZXR1cm5zPlxyXG5cclxuXHRyZXR1cm4gYXJyYXkuc2hpZnQoKTtcclxufVxyXG5cclxuQXJyYXkuZm9yRWFjaCA9IGZ1bmN0aW9uIEFycmF5JGZvckVhY2goYXJyYXksIG1ldGhvZCwgaW5zdGFuY2UpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojQXJyYXkuZm9yRWFjaFwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiYXJyYXlcIiB0eXBlPVwiQXJyYXlcIiBlbGVtZW50TWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwibWV0aG9kXCIgdHlwZT1cIkZ1bmN0aW9uXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJpbnN0YW5jZVwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cclxuXHRmb3IgKHZhciBpID0gMCwgbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG5cdFx0dmFyIGVsdCA9IGFycmF5W2ldO1xyXG5cdFx0aWYgKHR5cGVvZihlbHQpICE9PSAndW5kZWZpbmVkJykgbWV0aG9kLmNhbGwoaW5zdGFuY2UsIGVsdCwgaSwgYXJyYXkpO1xyXG5cdH1cclxufVxyXG5cclxuQXJyYXkuaW5kZXhPZiA9IGZ1bmN0aW9uIEFycmF5JGluZGV4T2YoYXJyYXksIGl0ZW0sIHN0YXJ0KSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI0FycmF5LmluZGV4T2ZcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImFycmF5XCIgdHlwZT1cIkFycmF5XCIgZWxlbWVudE1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cIml0ZW1cIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJzdGFydFwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiTnVtYmVyXCI+PC9yZXR1cm5zPlxyXG5cclxuXHRyZXR1cm4gaW5kZXhPZihhcnJheSwgaXRlbSwgc3RhcnQpO1xyXG59XHJcblxyXG5BcnJheS5pbnNlcnQgPSBmdW5jdGlvbiBBcnJheSRpbnNlcnQoYXJyYXksIGluZGV4LCBpdGVtKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI0FycmF5Lmluc2VydFwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiYXJyYXlcIiB0eXBlPVwiQXJyYXlcIiBlbGVtZW50TWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiaW5kZXhcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJpdGVtXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblxyXG5cdGFycmF5LnNwbGljZShpbmRleCwgMCwgaXRlbSk7XHJcbn1cclxuXHJcbkFycmF5LnBhcnNlID0gZnVuY3Rpb24gQXJyYXkkcGFyc2UodmFsdWUpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojQXJyYXkucGFyc2VcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInZhbHVlXCIgdHlwZT1cIlN0cmluZ1wiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiQXJyYXlcIiBlbGVtZW50TWF5QmVOdWxsPVwidHJ1ZVwiPjwvcmV0dXJucz5cclxuXHJcblx0aWYgKCF2YWx1ZSkgcmV0dXJuIFtdO1xyXG5cdHZhciB2ID0gd2luZG93LmV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcclxuXHRpZiAoIUFycmF5LmlzSW5zdGFuY2VPZlR5cGUodikpIHRocm93IEVycm9yLmFyZ3VtZW50KCd2YWx1ZScsIFN5cy5SZXMuYXJyYXlQYXJzZUJhZEZvcm1hdCk7XHJcblx0cmV0dXJuIHY7XHJcbn1cclxuXHJcbkFycmF5LnJlbW92ZSA9IGZ1bmN0aW9uIEFycmF5JHJlbW92ZShhcnJheSwgaXRlbSkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNBcnJheS5yZW1vdmVcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImFycmF5XCIgdHlwZT1cIkFycmF5XCIgZWxlbWVudE1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cIml0ZW1cIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIkJvb2xlYW5cIj48L3JldHVybnM+XHJcblxyXG5cdHZhciBpbmRleCA9IGluZGV4T2YoYXJyYXksIGl0ZW0pO1xyXG5cdGlmIChpbmRleCA+PSAwKSB7XHJcblx0XHRhcnJheS5zcGxpY2UoaW5kZXgsIDEpO1xyXG5cdH1cclxuXHRyZXR1cm4gKGluZGV4ID49IDApO1xyXG59XHJcblxyXG5BcnJheS5yZW1vdmVBdCA9IGZ1bmN0aW9uIEFycmF5JHJlbW92ZUF0KGFycmF5LCBpbmRleCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNBcnJheS5yZW1vdmVBdFwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiYXJyYXlcIiB0eXBlPVwiQXJyYXlcIiBlbGVtZW50TWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiaW5kZXhcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHJcblx0YXJyYXkuc3BsaWNlKGluZGV4LCAxKTtcclxufVxyXG5cclxuXHJcblxyXG5cclxuXHJcbnZhciBpbmRleE9mID0gU3lzLl9pbmRleE9mID0gZnVuY3Rpb24gU3lzJF9pbmRleE9mKGFycmF5LCBpdGVtLCBzdGFydCkge1xyXG5cdGlmICh0eXBlb2YoaXRlbSkgPT09IFwidW5kZWZpbmVkXCIpIHJldHVybiAtMTtcclxuXHR2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xyXG5cdGlmIChsZW5ndGggIT09IDApIHtcclxuXHRcdHN0YXJ0ID0gc3RhcnQgLSAwO1xyXG5cdFx0aWYgKGlzTmFOKHN0YXJ0KSkge1xyXG5cdFx0XHRzdGFydCA9IDA7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0aWYgKGlzRmluaXRlKHN0YXJ0KSkge1xyXG5cdFx0XHRcdHN0YXJ0ID0gc3RhcnQgLSAoc3RhcnQgJSAxKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAoc3RhcnQgPCAwKSB7XHJcblx0XHRcdFx0c3RhcnQgPSBNYXRoLm1heCgwLCBsZW5ndGggKyBzdGFydCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRmb3IgKHZhciBpID0gc3RhcnQ7IGkgPCBsZW5ndGg7IGkrKykge1xyXG5cdFx0XHRpZiAoKHR5cGVvZihhcnJheVtpXSkgIT09IFwidW5kZWZpbmVkXCIpICYmIChhcnJheVtpXSA9PT0gaXRlbSkpIHtcclxuXHRcdFx0XHRyZXR1cm4gaTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gLTE7XHJcbn1cclxuXHJcblR5cGUuX3JlZ2lzdGVyU2NyaXB0Ll9zY3JpcHRzID0ge1xyXG5cdFwiTWljcm9zb2Z0QWpheENvcmUuanNcIjogdHJ1ZSxcclxuXHRcIk1pY3Jvc29mdEFqYXhHbG9iYWxpemF0aW9uLmpzXCI6IHRydWUsXHJcblx0XCJNaWNyb3NvZnRBamF4U2VyaWFsaXphdGlvbi5qc1wiOiB0cnVlLFxyXG5cdFwiTWljcm9zb2Z0QWpheENvbXBvbmVudE1vZGVsLmpzXCI6IHRydWUsXHJcblx0XCJNaWNyb3NvZnRBamF4SGlzdG9yeS5qc1wiOiB0cnVlLFxyXG5cdFwiTWljcm9zb2Z0QWpheE5ldHdvcmsuanNcIiA6IHRydWUsXHJcblx0XCJNaWNyb3NvZnRBamF4V2ViU2VydmljZXMuanNcIjogdHJ1ZSB9O1xyXG5cclxuU3lzLklEaXNwb3NhYmxlID0gZnVuY3Rpb24gU3lzJElEaXNwb3NhYmxlKCkge1xyXG5cdHRocm93IEVycm9yLm5vdEltcGxlbWVudGVkKCk7XHJcbn1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJElEaXNwb3NhYmxlJGRpc3Bvc2UoKSB7XHJcblx0XHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG5cdH1cclxuU3lzLklEaXNwb3NhYmxlLnByb3RvdHlwZSA9IHtcclxuXHRkaXNwb3NlOiBTeXMkSURpc3Bvc2FibGUkZGlzcG9zZVxyXG59XHJcblN5cy5JRGlzcG9zYWJsZS5yZWdpc3RlckludGVyZmFjZSgnU3lzLklEaXNwb3NhYmxlJyk7XHJcblN5cy5TdHJpbmdCdWlsZGVyID0gZnVuY3Rpb24gU3lzJFN0cmluZ0J1aWxkZXIoaW5pdGlhbFRleHQpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlN0cmluZ0J1aWxkZXIuI2N0b3JcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImluaXRpYWxUZXh0XCIgb3B0aW9uYWw9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblxyXG5cdHRoaXMuX3BhcnRzID0gKHR5cGVvZihpbml0aWFsVGV4dCkgIT09ICd1bmRlZmluZWQnICYmIGluaXRpYWxUZXh0ICE9PSBudWxsICYmIGluaXRpYWxUZXh0ICE9PSAnJykgP1xyXG5cdFx0W2luaXRpYWxUZXh0LnRvU3RyaW5nKCldIDogW107XHJcblx0dGhpcy5fdmFsdWUgPSB7fTtcclxuXHR0aGlzLl9sZW4gPSAwO1xyXG59XHJcblxyXG5cclxuXHRmdW5jdGlvbiBTeXMkU3RyaW5nQnVpbGRlciRhcHBlbmQodGV4dCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5TdHJpbmdCdWlsZGVyLmFwcGVuZFwiIC8+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJ0ZXh0XCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0XHQvLy8gPHJldHVybnMgdHlwZT1cIlN5cy5TdHJpbmdCdWlsZGVyXCI+PC9yZXR1cm5zPlxyXG5cclxuXHRcdHRoaXMuX3BhcnRzLnB1c2godGV4dCk7XHJcblx0XHRyZXR1cm4gdGhpcztcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIFN5cyRTdHJpbmdCdWlsZGVyJGFwcGVuZExpbmUodGV4dCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5TdHJpbmdCdWlsZGVyLmFwcGVuZExpbmVcIiAvPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwidGV4dFwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJTeXMuU3RyaW5nQnVpbGRlclwiPjwvcmV0dXJucz5cclxuXHJcblx0XHR0aGlzLl9wYXJ0cy5wdXNoKFxyXG5cdFx0XHQoKHR5cGVvZih0ZXh0KSA9PT0gJ3VuZGVmaW5lZCcpIHx8ICh0ZXh0ID09PSBudWxsKSB8fCAodGV4dCA9PT0gJycpKSA/XHJcblx0XHRcdCdcXHJcXG4nIDogKHRleHQgKyAnXFxyXFxuJykpO1xyXG5cdFx0cmV0dXJuIHRoaXM7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBTeXMkU3RyaW5nQnVpbGRlciRjbGVhcigpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuU3RyaW5nQnVpbGRlci5jbGVhclwiIC8+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHRoaXMuX3BhcnRzID0gW107XHJcblx0XHR0aGlzLl92YWx1ZSA9IHt9O1xyXG5cdFx0dGhpcy5fbGVuID0gMDtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIFN5cyRTdHJpbmdCdWlsZGVyJGlzRW1wdHkoKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlN0cmluZ0J1aWxkZXIuaXNFbXB0eVwiIC8+XHJcblx0XHQvLy8gPHJldHVybnMgdHlwZT1cIkJvb2xlYW5cIj48L3JldHVybnM+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdGlmICh0aGlzLl9wYXJ0cy5sZW5ndGggPT09IDApIHJldHVybiB0cnVlO1xyXG5cdFx0cmV0dXJuIHRoaXMudG9TdHJpbmcoKSA9PT0gJyc7XHJcblx0fVxyXG5cclxuXHJcblxyXG5cdGZ1bmN0aW9uIFN5cyRTdHJpbmdCdWlsZGVyJHRvU3RyaW5nKHNlcGFyYXRvcikge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5TdHJpbmdCdWlsZGVyLnRvU3RyaW5nXCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cInNlcGFyYXRvclwiIHR5cGU9XCJTdHJpbmdcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiU3RyaW5nXCI+PC9yZXR1cm5zPlxyXG5cclxuXHRcdHNlcGFyYXRvciA9IHNlcGFyYXRvciB8fCAnJztcclxuXHRcdHZhciBwYXJ0cyA9IHRoaXMuX3BhcnRzO1xyXG5cdFx0aWYgKHRoaXMuX2xlbiAhPT0gcGFydHMubGVuZ3RoKSB7XHJcblx0XHRcdHRoaXMuX3ZhbHVlID0ge307XHJcblx0XHRcdHRoaXMuX2xlbiA9IHBhcnRzLmxlbmd0aDtcclxuXHRcdH1cclxuXHRcdHZhciB2YWwgPSB0aGlzLl92YWx1ZTtcclxuXHRcdGlmICh0eXBlb2YodmFsW3NlcGFyYXRvcl0pID09PSAndW5kZWZpbmVkJykge1xyXG5cdFx0XHRpZiAoc2VwYXJhdG9yICE9PSAnJykge1xyXG5cdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOykge1xyXG5cdFx0XHRcdFx0aWYgKCh0eXBlb2YocGFydHNbaV0pID09PSAndW5kZWZpbmVkJykgfHwgKHBhcnRzW2ldID09PSAnJykgfHwgKHBhcnRzW2ldID09PSBudWxsKSkge1xyXG5cdFx0XHRcdFx0XHRwYXJ0cy5zcGxpY2UoaSwgMSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0aSsrO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHR2YWxbc2VwYXJhdG9yXSA9IHRoaXMuX3BhcnRzLmpvaW4oc2VwYXJhdG9yKTtcclxuXHRcdH1cclxuXHRcdHJldHVybiB2YWxbc2VwYXJhdG9yXTtcclxuXHR9XHJcblN5cy5TdHJpbmdCdWlsZGVyLnByb3RvdHlwZSA9IHtcclxuXHRhcHBlbmQ6IFN5cyRTdHJpbmdCdWlsZGVyJGFwcGVuZCxcclxuXHRhcHBlbmRMaW5lOiBTeXMkU3RyaW5nQnVpbGRlciRhcHBlbmRMaW5lLFxyXG5cdGNsZWFyOiBTeXMkU3RyaW5nQnVpbGRlciRjbGVhcixcclxuXHRpc0VtcHR5OiBTeXMkU3RyaW5nQnVpbGRlciRpc0VtcHR5LFxyXG5cdHRvU3RyaW5nOiBTeXMkU3RyaW5nQnVpbGRlciR0b1N0cmluZ1xyXG59XHJcblN5cy5TdHJpbmdCdWlsZGVyLnJlZ2lzdGVyQ2xhc3MoJ1N5cy5TdHJpbmdCdWlsZGVyJyk7XHJcblxyXG5cclxudmFyIGFnZW50ID0gbmF2aWdhdG9yLnVzZXJBZ2VudCxcclxuXHRicm93c2VyID0gU3lzLkJyb3dzZXIgPSB7XHJcblx0XHRJbnRlcm5ldEV4cGxvcmVyOiB7fSxcclxuXHRcdEZpcmVmb3g6IHt9LFxyXG5cdFx0U2FmYXJpOiB7fSxcclxuXHRcdE9wZXJhOiB7fSxcclxuXHRcdGFnZW50OiBudWxsLFxyXG5cdFx0aGFzRGVidWdnZXJTdGF0ZW1lbnQ6IGZhbHNlLFxyXG5cdFx0bmFtZTogbmF2aWdhdG9yLmFwcE5hbWUsXHJcblx0XHR2ZXJzaW9uOiBwYXJzZUZsb2F0KG5hdmlnYXRvci5hcHBWZXJzaW9uKSxcclxuXHRcdGRvY3VtZW50TW9kZTogMCB9O1xyXG5cclxuaWYgKGFnZW50LmluZGV4T2YoJyBNU0lFICcpID4gLTEpIHtcclxuXHRicm93c2VyLmFnZW50ID0gYnJvd3Nlci5JbnRlcm5ldEV4cGxvcmVyO1xyXG5cdGJyb3dzZXIudmVyc2lvbiA9IHBhcnNlRmxvYXQoYWdlbnQubWF0Y2goL01TSUUgKFxcZCtcXC5cXGQrKS8pWzFdKTtcclxuXHRpZiAoKGJyb3dzZXIudmVyc2lvbiA+IDcpICYmIChkb2N1bWVudC5kb2N1bWVudE1vZGUgPiA2KSkge1xyXG5cdFx0YnJvd3Nlci5kb2N1bWVudE1vZGUgPSBkb2N1bWVudC5kb2N1bWVudE1vZGU7XHJcblx0fVxyXG5cdGJyb3dzZXIuaGFzRGVidWdnZXJTdGF0ZW1lbnQgPSB0cnVlO1xyXG5cdGJyb3dzZXIubmFtZSA9ICdJbnRlcm5ldEV4cGxvcmVyJztcclxufVxyXG5lbHNlIGlmIChhZ2VudC5pbmRleE9mKCcgRWRnZS8nKSA+IC0xKSB7XHJcblx0YnJvd3Nlci5hZ2VudCA9IGJyb3dzZXIuSW50ZXJuZXRFeHBsb3JlcjtcclxuXHRicm93c2VyLnZlcnNpb24gPSBwYXJzZUZsb2F0KGFnZW50Lm1hdGNoKC8gRWRnZVxcLyhcXGQrXFwuXFxkKykvKVsxXSk7XHJcblx0YnJvd3Nlci5oYXNEZWJ1Z2dlclN0YXRlbWVudCA9IHRydWU7XHJcbn1cclxuZWxzZSBpZiAoYWdlbnQuaW5kZXhPZignIEZpcmVmb3gvJykgPiAtMSkge1xyXG5cdGJyb3dzZXIuYWdlbnQgPSBicm93c2VyLkZpcmVmb3g7XHJcblx0YnJvd3Nlci52ZXJzaW9uID0gcGFyc2VGbG9hdChhZ2VudC5tYXRjaCgvIEZpcmVmb3hcXC8oXFxkK1xcLlxcZCspLylbMV0pO1xyXG5cdGJyb3dzZXIubmFtZSA9ICdGaXJlZm94JztcclxuXHRicm93c2VyLmhhc0RlYnVnZ2VyU3RhdGVtZW50ID0gdHJ1ZTtcclxufVxyXG5lbHNlIGlmIChhZ2VudC5pbmRleE9mKCcgQXBwbGVXZWJLaXQvJykgPiAtMSkge1xyXG5cdGJyb3dzZXIuYWdlbnQgPSBicm93c2VyLlNhZmFyaTtcclxuXHRicm93c2VyLnZlcnNpb24gPSBwYXJzZUZsb2F0KGFnZW50Lm1hdGNoKC8gQXBwbGVXZWJLaXRcXC8oXFxkKyhcXC5cXGQrKT8pLylbMV0pO1xyXG5cdGJyb3dzZXIubmFtZSA9ICdTYWZhcmknO1xyXG59XHJcbmVsc2UgaWYgKGFnZW50LmluZGV4T2YoJ09wZXJhLycpID4gLTEpIHtcclxuXHRicm93c2VyLmFnZW50ID0gYnJvd3Nlci5PcGVyYTtcclxufVxyXG5lbHNlIGlmIChhZ2VudC5pbmRleE9mKCdUcmlkZW50JykgPiAtMSkge1xyXG5cdGJyb3dzZXIuYWdlbnQgPSBicm93c2VyLkludGVybmV0RXhwbG9yZXI7XHJcblx0YnJvd3Nlci52ZXJzaW9uID0gcGFyc2VGbG9hdChhZ2VudC5tYXRjaCgvcnZcXDooXFxkK1xcLlxcZCspLylbMV0pO1xyXG5cdGJyb3dzZXIuZG9jdW1lbnRNb2RlID0gZG9jdW1lbnQuZG9jdW1lbnRNb2RlO1xyXG5cdGJyb3dzZXIuaGFzRGVidWdnZXJTdGF0ZW1lbnQgPSB0cnVlO1xyXG5cdGJyb3dzZXIubmFtZSA9ICdJbnRlcm5ldEV4cGxvcmVyJztcclxufVxyXG5cclxuXHJcblN5cy5FdmVudEFyZ3MgPSBmdW5jdGlvbiBTeXMkRXZlbnRBcmdzKCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuRXZlbnRBcmdzLiNjdG9yXCIgLz5cclxuXHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxufVxyXG5TeXMuRXZlbnRBcmdzLnJlZ2lzdGVyQ2xhc3MoJ1N5cy5FdmVudEFyZ3MnKTtcclxuXHJcblN5cy5FdmVudEFyZ3MuRW1wdHkgPSBuZXcgU3lzLkV2ZW50QXJncygpO1xyXG5TeXMuQ2FuY2VsRXZlbnRBcmdzID0gZnVuY3Rpb24gU3lzJENhbmNlbEV2ZW50QXJncygpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLkNhbmNlbEV2ZW50QXJncy4jY3RvclwiIC8+XHJcblx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0U3lzLkNhbmNlbEV2ZW50QXJncy5pbml0aWFsaXplQmFzZSh0aGlzKTtcclxuXHJcblx0dGhpcy5fY2FuY2VsID0gZmFsc2U7XHJcbn1cclxuXHJcblxyXG5cdGZ1bmN0aW9uIFN5cyRDYW5jZWxFdmVudEFyZ3MkZ2V0X2NhbmNlbCgpIHtcclxuXHRcdC8vLyA8dmFsdWUgdHlwZT1cIkJvb2xlYW5cIiBsb2NpZD1cIlA6SiNTeXMuQ2FuY2VsRXZlbnRBcmdzLmNhbmNlbFwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiB0aGlzLl9jYW5jZWw7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRDYW5jZWxFdmVudEFyZ3Mkc2V0X2NhbmNlbCh2YWx1ZSkge1xyXG5cclxuXHRcdHRoaXMuX2NhbmNlbCA9IHZhbHVlO1xyXG5cdH1cclxuU3lzLkNhbmNlbEV2ZW50QXJncy5wcm90b3R5cGUgPSB7XHJcblx0Z2V0X2NhbmNlbDogU3lzJENhbmNlbEV2ZW50QXJncyRnZXRfY2FuY2VsLFxyXG5cdHNldF9jYW5jZWw6IFN5cyRDYW5jZWxFdmVudEFyZ3Mkc2V0X2NhbmNlbFxyXG59XHJcblxyXG5TeXMuQ2FuY2VsRXZlbnRBcmdzLnJlZ2lzdGVyQ2xhc3MoJ1N5cy5DYW5jZWxFdmVudEFyZ3MnLCBTeXMuRXZlbnRBcmdzKTtcclxuXHJcblxyXG5cclxuVHlwZS5yZWdpc3Rlck5hbWVzcGFjZSgnU3lzLlVJJyk7XHJcblxyXG5TeXMuX0RlYnVnID0gZnVuY3Rpb24gU3lzJF9EZWJ1ZygpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLkRlYnVnLiNjdG9yXCIgLz5cclxuXHQvLy8gPGZpZWxkIG5hbWU9XCJpc0RlYnVnXCIgdHlwZT1cIkJvb2xlYW5cIiBsb2NpZD1cIkY6SiNTeXMuRGVidWcuaXNEZWJ1Z1wiPjwvZmllbGQ+XHJcblx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcbn1cclxuXHJcblxyXG5cdGZ1bmN0aW9uIFN5cyRfRGVidWckX2FwcGVuZENvbnNvbGUodGV4dCkge1xyXG5cdFx0aWYgKCh0eXBlb2YoRGVidWcpICE9PSAndW5kZWZpbmVkJykgJiYgRGVidWcud3JpdGVsbikge1xyXG5cdFx0XHREZWJ1Zy53cml0ZWxuKHRleHQpO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHdpbmRvdy5jb25zb2xlICYmIHdpbmRvdy5jb25zb2xlLmxvZykge1xyXG5cdFx0XHR3aW5kb3cuY29uc29sZS5sb2codGV4dCk7XHJcblx0XHR9XHJcblx0XHRpZiAod2luZG93Lm9wZXJhKSB7XHJcblx0XHRcdHdpbmRvdy5vcGVyYS5wb3N0RXJyb3IodGV4dCk7XHJcblx0XHR9XHJcblx0XHRpZiAod2luZG93LmRlYnVnU2VydmljZSkge1xyXG5cdFx0XHR3aW5kb3cuZGVidWdTZXJ2aWNlLnRyYWNlKHRleHQpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJF9EZWJ1ZyRfYXBwZW5kVHJhY2UodGV4dCkge1xyXG5cdFx0dmFyIHRyYWNlRWxlbWVudCA9IFN5cy5nZXQoJyNUcmFjZUNvbnNvbGUnKTtcclxuXHRcdGlmICh0cmFjZUVsZW1lbnQgJiYgKHRyYWNlRWxlbWVudC50YWdOYW1lLnRvVXBwZXJDYXNlKCkgPT09ICdURVhUQVJFQScpKSB7XHJcblx0XHRcdHRyYWNlRWxlbWVudC52YWx1ZSArPSB0ZXh0ICsgJ1xcbic7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBTeXMkX0RlYnVnJGFzc2VydChjb25kaXRpb24sIG1lc3NhZ2UsIGRpc3BsYXlDYWxsZXIpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuRGVidWcuYXNzZXJ0XCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImNvbmRpdGlvblwiIHR5cGU9XCJCb29sZWFuXCI+PC9wYXJhbT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cIm1lc3NhZ2VcIiB0eXBlPVwiU3RyaW5nXCIgb3B0aW9uYWw9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJkaXNwbGF5Q2FsbGVyXCIgdHlwZT1cIkJvb2xlYW5cIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHJcblx0XHRpZiAoIWNvbmRpdGlvbikge1xyXG5cdFx0XHRtZXNzYWdlID0gKGRpc3BsYXlDYWxsZXIgJiYgdGhpcy5hc3NlcnQuY2FsbGVyKSA/XHJcblx0XHRcdFx0U3RyaW5nLmZvcm1hdChTeXMuUmVzLmFzc2VydEZhaWxlZENhbGxlciwgbWVzc2FnZSwgdGhpcy5hc3NlcnQuY2FsbGVyKSA6XHJcblx0XHRcdFx0U3RyaW5nLmZvcm1hdChTeXMuUmVzLmFzc2VydEZhaWxlZCwgbWVzc2FnZSk7XHJcblxyXG5cdFx0XHRpZiAoY29uZmlybShTdHJpbmcuZm9ybWF0KFN5cy5SZXMuYnJlYWtJbnRvRGVidWdnZXIsIG1lc3NhZ2UpKSkge1xyXG5cdFx0XHRcdHRoaXMuZmFpbChtZXNzYWdlKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJF9EZWJ1ZyRjbGVhclRyYWNlKCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5EZWJ1Zy5jbGVhclRyYWNlXCIgLz5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0dmFyIHRyYWNlRWxlbWVudCA9IFN5cy5nZXQoJyNUcmFjZUNvbnNvbGUnKTtcclxuXHRcdGlmICh0cmFjZUVsZW1lbnQgJiYgKHRyYWNlRWxlbWVudC50YWdOYW1lLnRvVXBwZXJDYXNlKCkgPT09ICdURVhUQVJFQScpKSB7XHJcblx0XHRcdHRyYWNlRWxlbWVudC52YWx1ZSA9ICcnO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJF9EZWJ1ZyRmYWlsKG1lc3NhZ2UpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuRGVidWcuZmFpbFwiIC8+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJtZXNzYWdlXCIgdHlwZT1cIlN0cmluZ1wiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cclxuXHRcdHRoaXMuX2FwcGVuZENvbnNvbGUobWVzc2FnZSk7XHJcblxyXG5cdFx0aWYgKFN5cy5Ccm93c2VyLmhhc0RlYnVnZ2VyU3RhdGVtZW50KSB7XHJcblx0XHRcdHdpbmRvdy5ldmFsKCdkZWJ1Z2dlcicpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJF9EZWJ1ZyR0cmFjZSh0ZXh0KSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLkRlYnVnLnRyYWNlXCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cInRleHRcIj48L3BhcmFtPlxyXG5cclxuXHRcdHRoaXMuX2FwcGVuZENvbnNvbGUodGV4dCk7XHJcblx0XHR0aGlzLl9hcHBlbmRUcmFjZSh0ZXh0KTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIFN5cyRfRGVidWckdHJhY2VEdW1wKG9iamVjdCwgbmFtZSkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5EZWJ1Zy50cmFjZUR1bXBcIiAvPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwib2JqZWN0XCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJuYW1lXCIgdHlwZT1cIlN0cmluZ1wiIG1heUJlTnVsbD1cInRydWVcIiBvcHRpb25hbD1cInRydWVcIj48L3BhcmFtPlxyXG5cclxuXHRcdHZhciB0ZXh0ID0gdGhpcy5fdHJhY2VEdW1wKG9iamVjdCwgbmFtZSwgdHJ1ZSk7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBTeXMkX0RlYnVnJF90cmFjZUR1bXAob2JqZWN0LCBuYW1lLCByZWN1cnNpdmUsIGluZGVudGF0aW9uUGFkZGluZywgbG9vcEFycmF5KSB7XHJcblx0XHRuYW1lID0gbmFtZT8gbmFtZSA6ICd0cmFjZUR1bXAnO1xyXG5cdFx0aW5kZW50YXRpb25QYWRkaW5nID0gaW5kZW50YXRpb25QYWRkaW5nPyBpbmRlbnRhdGlvblBhZGRpbmcgOiAnJztcclxuXHRcdGlmIChvYmplY3QgPT09IG51bGwpIHtcclxuXHRcdFx0dGhpcy50cmFjZShpbmRlbnRhdGlvblBhZGRpbmcgKyBuYW1lICsgJzogbnVsbCcpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRzd2l0Y2godHlwZW9mKG9iamVjdCkpIHtcclxuXHRcdFx0Y2FzZSAndW5kZWZpbmVkJzpcclxuXHRcdFx0XHR0aGlzLnRyYWNlKGluZGVudGF0aW9uUGFkZGluZyArIG5hbWUgKyAnOiBVbmRlZmluZWQnKTtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdFx0Y2FzZSAnbnVtYmVyJzogY2FzZSAnc3RyaW5nJzogY2FzZSAnYm9vbGVhbic6XHJcblx0XHRcdFx0dGhpcy50cmFjZShpbmRlbnRhdGlvblBhZGRpbmcgKyBuYW1lICsgJzogJyArIG9iamVjdCk7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdGRlZmF1bHQ6XHJcblx0XHRcdFx0aWYgKERhdGUuaXNJbnN0YW5jZU9mVHlwZShvYmplY3QpIHx8IFJlZ0V4cC5pc0luc3RhbmNlT2ZUeXBlKG9iamVjdCkpIHtcclxuXHRcdFx0XHRcdHRoaXMudHJhY2UoaW5kZW50YXRpb25QYWRkaW5nICsgbmFtZSArICc6ICcgKyBvYmplY3QudG9TdHJpbmcoKSk7XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKCFsb29wQXJyYXkpIHtcclxuXHRcdFx0XHRcdGxvb3BBcnJheSA9IFtdO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmIChBcnJheS5jb250YWlucyhsb29wQXJyYXksIG9iamVjdCkpIHtcclxuXHRcdFx0XHRcdHRoaXMudHJhY2UoaW5kZW50YXRpb25QYWRkaW5nICsgbmFtZSArICc6IC4uLicpO1xyXG5cdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRBcnJheS5hZGQobG9vcEFycmF5LCBvYmplY3QpO1xyXG5cclxuXHRcdFx0XHRpZiAoKG9iamVjdCA9PSB3aW5kb3cpIHx8IChvYmplY3QgPT09IGRvY3VtZW50KSB8fFxyXG5cdFx0XHRcdFx0KHdpbmRvdy5IVE1MRWxlbWVudCAmJiAob2JqZWN0IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpKSB8fFxyXG5cdFx0XHRcdFx0KHR5cGVvZihvYmplY3Qubm9kZU5hbWUpID09PSAnc3RyaW5nJykpIHtcclxuXHRcdFx0XHRcdHZhciB0YWcgPSBvYmplY3QudGFnTmFtZT8gb2JqZWN0LnRhZ05hbWUgOiAnRG9tRWxlbWVudCc7XHJcblx0XHRcdFx0XHRpZiAob2JqZWN0LmlkKSB7XHJcblx0XHRcdFx0XHRcdHRhZyArPSAnIC0gJyArIG9iamVjdC5pZDtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHRoaXMudHJhY2UoaW5kZW50YXRpb25QYWRkaW5nICsgbmFtZSArICcgeycgKyAgdGFnICsgJ30nKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHR2YXIgdHlwZU5hbWUgPSBPYmplY3QuZ2V0VHlwZU5hbWUob2JqZWN0KTtcclxuXHRcdFx0XHRcdHRoaXMudHJhY2UoaW5kZW50YXRpb25QYWRkaW5nICsgbmFtZSArICh0eXBlb2YodHlwZU5hbWUpID09PSAnc3RyaW5nJyA/ICcgeycgKyB0eXBlTmFtZSArICd9JyA6ICcnKSk7XHJcblx0XHRcdFx0XHRpZiAoKGluZGVudGF0aW9uUGFkZGluZyA9PT0gJycpIHx8IHJlY3Vyc2l2ZSkge1xyXG5cdFx0XHRcdFx0XHRpbmRlbnRhdGlvblBhZGRpbmcgKz0gXCIgICAgXCI7XHJcblx0XHRcdFx0XHRcdHZhciBpLCBsZW5ndGgsIHByb3BlcnRpZXMsIHAsIHY7XHJcblx0XHRcdFx0XHRcdGlmIChBcnJheS5pc0luc3RhbmNlT2ZUeXBlKG9iamVjdCkpIHtcclxuXHRcdFx0XHRcdFx0XHRsZW5ndGggPSBvYmplY3QubGVuZ3RoO1xyXG5cdFx0XHRcdFx0XHRcdGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdFx0XHRcdFx0dGhpcy5fdHJhY2VEdW1wKG9iamVjdFtpXSwgJ1snICsgaSArICddJywgcmVjdXJzaXZlLCBpbmRlbnRhdGlvblBhZGRpbmcsIGxvb3BBcnJheSk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdGZvciAocCBpbiBvYmplY3QpIHtcclxuXHRcdFx0XHRcdFx0XHRcdHYgPSBvYmplY3RbcF07XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoIUZ1bmN0aW9uLmlzSW5zdGFuY2VPZlR5cGUodikpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dGhpcy5fdHJhY2VEdW1wKHYsIHAsIHJlY3Vyc2l2ZSwgaW5kZW50YXRpb25QYWRkaW5nLCBsb29wQXJyYXkpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRBcnJheS5yZW1vdmUobG9vcEFycmF5LCBvYmplY3QpO1xyXG5cdFx0fVxyXG5cdH1cclxuU3lzLl9EZWJ1Zy5wcm90b3R5cGUgPSB7XHJcblx0X2FwcGVuZENvbnNvbGU6IFN5cyRfRGVidWckX2FwcGVuZENvbnNvbGUsXHJcblx0X2FwcGVuZFRyYWNlOiBTeXMkX0RlYnVnJF9hcHBlbmRUcmFjZSxcclxuXHRhc3NlcnQ6IFN5cyRfRGVidWckYXNzZXJ0LFxyXG5cdGNsZWFyVHJhY2U6IFN5cyRfRGVidWckY2xlYXJUcmFjZSxcclxuXHRmYWlsOiBTeXMkX0RlYnVnJGZhaWwsXHJcblx0dHJhY2U6IFN5cyRfRGVidWckdHJhY2UsXHJcblx0dHJhY2VEdW1wOiBTeXMkX0RlYnVnJHRyYWNlRHVtcCxcclxuXHRfdHJhY2VEdW1wOiBTeXMkX0RlYnVnJF90cmFjZUR1bXBcclxufVxyXG5TeXMuX0RlYnVnLnJlZ2lzdGVyQ2xhc3MoJ1N5cy5fRGVidWcnKTtcclxuXHJcblN5cy5EZWJ1ZyA9IG5ldyBTeXMuX0RlYnVnKCk7XHJcblx0U3lzLkRlYnVnLmlzRGVidWcgPSB0cnVlO1xyXG5mdW5jdGlvbiBTeXMkRW51bSRwYXJzZSh2YWx1ZSwgaWdub3JlQ2FzZSkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuRW51bS5wYXJzZVwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwidmFsdWVcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJpZ25vcmVDYXNlXCIgdHlwZT1cIkJvb2xlYW5cIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnM+PC9yZXR1cm5zPlxyXG5cclxuXHR2YXIgdmFsdWVzLCBwYXJzZWQsIHZhbDtcclxuXHRpZiAoaWdub3JlQ2FzZSkge1xyXG5cdFx0dmFsdWVzID0gdGhpcy5fX2xvd2VyQ2FzZVZhbHVlcztcclxuXHRcdGlmICghdmFsdWVzKSB7XHJcblx0XHRcdHRoaXMuX19sb3dlckNhc2VWYWx1ZXMgPSB2YWx1ZXMgPSB7fTtcclxuXHRcdFx0dmFyIHByb3RvdHlwZSA9IHRoaXMucHJvdG90eXBlO1xyXG5cdFx0XHRmb3IgKHZhciBuYW1lIGluIHByb3RvdHlwZSkge1xyXG5cdFx0XHRcdHZhbHVlc1tuYW1lLnRvTG93ZXJDYXNlKCldID0gcHJvdG90eXBlW25hbWVdO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdGVsc2Uge1xyXG5cdFx0dmFsdWVzID0gdGhpcy5wcm90b3R5cGU7XHJcblx0fVxyXG5cdGlmICghdGhpcy5fX2ZsYWdzKSB7XHJcblx0XHR2YWwgPSAoaWdub3JlQ2FzZSA/IHZhbHVlLnRvTG93ZXJDYXNlKCkgOiB2YWx1ZSk7XHJcblx0XHRwYXJzZWQgPSB2YWx1ZXNbdmFsLnRyaW0oKV07XHJcblx0XHRpZiAodHlwZW9mKHBhcnNlZCkgIT09ICdudW1iZXInKSB0aHJvdyBFcnJvci5hcmd1bWVudCgndmFsdWUnLCBTdHJpbmcuZm9ybWF0KFN5cy5SZXMuZW51bUludmFsaWRWYWx1ZSwgdmFsdWUsIHRoaXMuX190eXBlTmFtZSkpO1xyXG5cdFx0cmV0dXJuIHBhcnNlZDtcclxuXHR9XHJcblx0ZWxzZSB7XHJcblx0XHR2YXIgcGFydHMgPSAoaWdub3JlQ2FzZSA/IHZhbHVlLnRvTG93ZXJDYXNlKCkgOiB2YWx1ZSkuc3BsaXQoJywnKTtcclxuXHRcdHZhciB2ID0gMDtcclxuXHJcblx0XHRmb3IgKHZhciBpID0gcGFydHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcclxuXHRcdFx0dmFyIHBhcnQgPSBwYXJ0c1tpXS50cmltKCk7XHJcblx0XHRcdHBhcnNlZCA9IHZhbHVlc1twYXJ0XTtcclxuXHRcdFx0aWYgKHR5cGVvZihwYXJzZWQpICE9PSAnbnVtYmVyJykgdGhyb3cgRXJyb3IuYXJndW1lbnQoJ3ZhbHVlJywgU3RyaW5nLmZvcm1hdChTeXMuUmVzLmVudW1JbnZhbGlkVmFsdWUsIHZhbHVlLnNwbGl0KCcsJylbaV0udHJpbSgpLCB0aGlzLl9fdHlwZU5hbWUpKTtcclxuXHRcdFx0diB8PSBwYXJzZWQ7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdjtcclxuXHR9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIFN5cyRFbnVtJHRvU3RyaW5nKHZhbHVlKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5FbnVtLnRvU3RyaW5nXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ2YWx1ZVwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiU3RyaW5nXCI+PC9yZXR1cm5zPlxyXG5cclxuXHRpZiAoKHR5cGVvZih2YWx1ZSkgPT09ICd1bmRlZmluZWQnKSB8fCAodmFsdWUgPT09IG51bGwpKSByZXR1cm4gdGhpcy5fX3N0cmluZztcclxuXHRpZiAoKHR5cGVvZih2YWx1ZSkgIT0gJ251bWJlcicpIHx8ICgodmFsdWUgJSAxKSAhPT0gMCkpIHRocm93IEVycm9yLmFyZ3VtZW50VHlwZSgndmFsdWUnLCBPYmplY3QuZ2V0VHlwZSh2YWx1ZSksIHRoaXMpO1xyXG5cdHZhciB2YWx1ZXMgPSB0aGlzLnByb3RvdHlwZTtcclxuXHR2YXIgaTtcclxuXHRpZiAoIXRoaXMuX19mbGFncyB8fCAodmFsdWUgPT09IDApKSB7XHJcblx0XHRmb3IgKGkgaW4gdmFsdWVzKSB7XHJcblx0XHRcdGlmICh2YWx1ZXNbaV0gPT09IHZhbHVlKSB7XHJcblx0XHRcdFx0cmV0dXJuIGk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0ZWxzZSB7XHJcblx0XHR2YXIgc29ydGVkID0gdGhpcy5fX3NvcnRlZFZhbHVlcztcclxuXHRcdGlmICghc29ydGVkKSB7XHJcblx0XHRcdHNvcnRlZCA9IFtdO1xyXG5cdFx0XHRmb3IgKGkgaW4gdmFsdWVzKSB7XHJcblx0XHRcdFx0c29ydGVkW3NvcnRlZC5sZW5ndGhdID0ge2tleTogaSwgdmFsdWU6IHZhbHVlc1tpXX07XHJcblx0XHRcdH1cclxuXHRcdFx0c29ydGVkLnNvcnQoZnVuY3Rpb24oYSwgYikge1xyXG5cdFx0XHRcdHJldHVybiBhLnZhbHVlIC0gYi52YWx1ZTtcclxuXHRcdFx0fSk7XHJcblx0XHRcdHRoaXMuX19zb3J0ZWRWYWx1ZXMgPSBzb3J0ZWQ7XHJcblx0XHR9XHJcblx0XHR2YXIgcGFydHMgPSBbXTtcclxuXHRcdHZhciB2ID0gdmFsdWU7XHJcblx0XHRmb3IgKGkgPSBzb3J0ZWQubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcclxuXHRcdFx0dmFyIGt2cCA9IHNvcnRlZFtpXTtcclxuXHRcdFx0dmFyIHZhbGkgPSBrdnAudmFsdWU7XHJcblx0XHRcdGlmICh2YWxpID09PSAwKSBjb250aW51ZTtcclxuXHRcdFx0aWYgKCh2YWxpICYgdmFsdWUpID09PSB2YWxpKSB7XHJcblx0XHRcdFx0cGFydHNbcGFydHMubGVuZ3RoXSA9IGt2cC5rZXk7XHJcblx0XHRcdFx0diAtPSB2YWxpO1xyXG5cdFx0XHRcdGlmICh2ID09PSAwKSBicmVhaztcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0aWYgKHBhcnRzLmxlbmd0aCAmJiB2ID09PSAwKSByZXR1cm4gcGFydHMucmV2ZXJzZSgpLmpvaW4oJywgJyk7XHJcblx0fVxyXG5cdHRocm93IEVycm9yLmFyZ3VtZW50T3V0T2ZSYW5nZSgndmFsdWUnLCB2YWx1ZSwgU3RyaW5nLmZvcm1hdChTeXMuUmVzLmVudW1JbnZhbGlkVmFsdWUsIHZhbHVlLCB0aGlzLl9fdHlwZU5hbWUpKTtcclxufVxyXG5cclxuVHlwZS5wcm90b3R5cGUucmVnaXN0ZXJFbnVtID0gZnVuY3Rpb24gVHlwZSRyZWdpc3RlckVudW0obmFtZSwgZmxhZ3MpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLkxpbmVUeXBlLiNjdG9yXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJuYW1lXCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZmxhZ3NcIiB0eXBlPVwiQm9vbGVhblwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cclxuXHRpZiAoIVR5cGUuX19mdWxseVF1YWxpZmllZElkZW50aWZpZXJSZWdFeHAudGVzdChuYW1lKSkgdGhyb3cgRXJyb3IuYXJndW1lbnQoJ25hbWUnLCBTeXMuUmVzLm5vdEFUeXBlTmFtZSk7XHJcblx0dmFyIHBhcnNlZE5hbWU7XHJcblx0dHJ5IHtcclxuXHRcdHBhcnNlZE5hbWUgPSB3aW5kb3cuZXZhbChuYW1lKTtcclxuXHR9XHJcblx0Y2F0Y2goZSkge1xyXG5cdFx0dGhyb3cgRXJyb3IuYXJndW1lbnQoJ25hbWUnLCBTeXMuUmVzLmFyZ3VtZW50VHlwZU5hbWUpO1xyXG5cdH1cclxuXHRpZiAocGFyc2VkTmFtZSAhPT0gdGhpcykgdGhyb3cgRXJyb3IuYXJndW1lbnQoJ25hbWUnLCBTeXMuUmVzLmJhZFR5cGVOYW1lKTtcclxuXHRpZiAoU3lzLl9fcmVnaXN0ZXJlZFR5cGVzW25hbWVdKSB0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN0cmluZy5mb3JtYXQoU3lzLlJlcy50eXBlUmVnaXN0ZXJlZFR3aWNlLCBuYW1lKSk7XHJcblx0Zm9yICh2YXIgaiBpbiB0aGlzLnByb3RvdHlwZSkge1xyXG5cdFx0dmFyIHZhbCA9IHRoaXMucHJvdG90eXBlW2pdO1xyXG5cdFx0aWYgKCFUeXBlLl9faWRlbnRpZmllclJlZ0V4cC50ZXN0KGopKSB0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN0cmluZy5mb3JtYXQoU3lzLlJlcy5lbnVtSW52YWxpZFZhbHVlTmFtZSwgaikpO1xyXG5cdFx0aWYgKHR5cGVvZih2YWwpICE9PSAnbnVtYmVyJyB8fCAodmFsICUgMSkgIT09IDApIHRocm93IG5ldyBFcnJvcihqKTsvLyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN5cy5SZXMuZW51bVZhbHVlTm90SW50ZWdlcik7XHJcblx0XHRpZiAodHlwZW9mKHRoaXNbal0pICE9PSAndW5kZWZpbmVkJykgdGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTdHJpbmcuZm9ybWF0KFN5cy5SZXMuZW51bVJlc2VydmVkTmFtZSwgaikpO1xyXG5cdH1cclxuXHRTeXMuX191cHBlckNhc2VUeXBlc1tuYW1lLnRvVXBwZXJDYXNlKCldID0gdGhpcztcclxuXHJcblx0Zm9yICh2YXIgaSBpbiB0aGlzLnByb3RvdHlwZSkge1xyXG5cdFx0dGhpc1tpXSA9IHRoaXMucHJvdG90eXBlW2ldO1xyXG5cdH1cclxuXHR0aGlzLl9fdHlwZU5hbWUgPSBuYW1lO1xyXG5cdHRoaXMucGFyc2UgPSBTeXMkRW51bSRwYXJzZTtcclxuXHR0aGlzLl9fc3RyaW5nID0gdGhpcy50b1N0cmluZygpO1xyXG5cdHRoaXMudG9TdHJpbmcgPSBTeXMkRW51bSR0b1N0cmluZztcclxuXHR0aGlzLl9fZmxhZ3MgPSBmbGFncztcclxuXHR0aGlzLl9fZW51bSA9IHRydWU7XHJcblx0U3lzLl9fcmVnaXN0ZXJlZFR5cGVzW25hbWVdID0gdHJ1ZTtcclxufVxyXG5cclxuVHlwZS5pc0VudW0gPSBmdW5jdGlvbiBUeXBlJGlzRW51bSh0eXBlKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1R5cGUuaXNFbnVtXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ0eXBlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJCb29sZWFuXCI+PC9yZXR1cm5zPlxyXG5cclxuXHRpZiAoKHR5cGVvZih0eXBlKSA9PT0gJ3VuZGVmaW5lZCcpIHx8ICh0eXBlID09PSBudWxsKSkgcmV0dXJuIGZhbHNlO1xyXG5cdHJldHVybiAhIXR5cGUuX19lbnVtO1xyXG59XHJcblxyXG5UeXBlLmlzRmxhZ3MgPSBmdW5jdGlvbiBUeXBlJGlzRmxhZ3ModHlwZSkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNUeXBlLmlzRmxhZ3NcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInR5cGVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIkJvb2xlYW5cIj48L3JldHVybnM+XHJcblxyXG5cdGlmICgodHlwZW9mKHR5cGUpID09PSAndW5kZWZpbmVkJykgfHwgKHR5cGUgPT09IG51bGwpKSByZXR1cm4gZmFsc2U7XHJcblx0cmV0dXJuICEhdHlwZS5fX2ZsYWdzO1xyXG59XHJcblxyXG5TeXMuQ29sbGVjdGlvbkNoYW5nZSA9IGZ1bmN0aW9uIFN5cyRDb2xsZWN0aW9uQ2hhbmdlKGFjdGlvbiwgbmV3SXRlbXMsIG5ld1N0YXJ0aW5nSW5kZXgsIG9sZEl0ZW1zLCBvbGRTdGFydGluZ0luZGV4KSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5Db2xsZWN0aW9uQ2hhbmdlLiNjdG9yXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJhY3Rpb25cIiB0eXBlPVwiU3lzLk5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkQWN0aW9uXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJuZXdJdGVtc1wiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cIm5ld1N0YXJ0aW5nSW5kZXhcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJvbGRJdGVtc1wiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cIm9sZFN0YXJ0aW5nSW5kZXhcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPGZpZWxkIG5hbWU9XCJhY3Rpb25cIiB0eXBlPVwiU3lzLk5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkQWN0aW9uXCIgbG9jaWQ9XCJGOkojU3lzLkNvbGxlY3Rpb25DaGFuZ2UuYWN0aW9uXCI+PC9maWVsZD5cclxuXHQvLy8gPGZpZWxkIG5hbWU9XCJuZXdJdGVtc1wiIHR5cGU9XCJBcnJheVwiIG1heUJlTnVsbD1cInRydWVcIiBlbGVtZW50TWF5QmVOdWxsPVwidHJ1ZVwiIGxvY2lkPVwiRjpKI1N5cy5Db2xsZWN0aW9uQ2hhbmdlLm5ld0l0ZW1zXCI+PC9maWVsZD5cclxuXHQvLy8gPGZpZWxkIG5hbWU9XCJuZXdTdGFydGluZ0luZGV4XCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCIgbG9jaWQ9XCJGOkojU3lzLkNvbGxlY3Rpb25DaGFuZ2UubmV3U3RhcnRpbmdJbmRleFwiPjwvZmllbGQ+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwib2xkSXRlbXNcIiB0eXBlPVwiQXJyYXlcIiBtYXlCZU51bGw9XCJ0cnVlXCIgZWxlbWVudE1heUJlTnVsbD1cInRydWVcIiBsb2NpZD1cIkY6SiNTeXMuQ29sbGVjdGlvbkNoYW5nZS5vbGRJdGVtc1wiPjwvZmllbGQ+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwib2xkU3RhcnRpbmdJbmRleFwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiIGxvY2lkPVwiRjpKI1N5cy5Db2xsZWN0aW9uQ2hhbmdlLm9sZFN0YXJ0aW5nSW5kZXhcIj48L2ZpZWxkPlxyXG5cclxuXHR0aGlzLmFjdGlvbiA9IGFjdGlvbjtcclxuXHRpZiAobmV3SXRlbXMpIHtcclxuXHRcdGlmICghKG5ld0l0ZW1zIGluc3RhbmNlb2YgQXJyYXkpKSB7XHJcblx0XHRcdG5ld0l0ZW1zID0gW25ld0l0ZW1zXTtcclxuXHRcdH1cclxuXHR9XHJcblx0dGhpcy5uZXdJdGVtcyA9IG5ld0l0ZW1zIHx8IG51bGw7XHJcblx0aWYgKHR5cGVvZiBuZXdTdGFydGluZ0luZGV4ICE9PSBcIm51bWJlclwiKSB7XHJcblx0XHRuZXdTdGFydGluZ0luZGV4ID0gLTE7XHJcblx0fVxyXG5cdHRoaXMubmV3U3RhcnRpbmdJbmRleCA9IG5ld1N0YXJ0aW5nSW5kZXg7XHJcblx0aWYgKG9sZEl0ZW1zKSB7XHJcblx0XHRpZiAoIShvbGRJdGVtcyBpbnN0YW5jZW9mIEFycmF5KSkge1xyXG5cdFx0XHRvbGRJdGVtcyA9IFtvbGRJdGVtc107XHJcblx0XHR9XHJcblx0fVxyXG5cdHRoaXMub2xkSXRlbXMgPSBvbGRJdGVtcyB8fCBudWxsO1xyXG5cdGlmICh0eXBlb2Ygb2xkU3RhcnRpbmdJbmRleCAhPT0gXCJudW1iZXJcIikge1xyXG5cdFx0b2xkU3RhcnRpbmdJbmRleCA9IC0xO1xyXG5cdH1cclxuXHR0aGlzLm9sZFN0YXJ0aW5nSW5kZXggPSBvbGRTdGFydGluZ0luZGV4O1xyXG59XHJcblN5cy5Db2xsZWN0aW9uQ2hhbmdlLnJlZ2lzdGVyQ2xhc3MoXCJTeXMuQ29sbGVjdGlvbkNoYW5nZVwiKTtcclxuU3lzLk5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkQWN0aW9uID0gZnVuY3Rpb24gU3lzJE5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkQWN0aW9uKCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuTm90aWZ5Q29sbGVjdGlvbkNoYW5nZWRBY3Rpb24uI2N0b3JcIiAvPlxyXG5cdC8vLyA8ZmllbGQgbmFtZT1cImFkZFwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiIHN0YXRpYz1cInRydWVcIiBsb2NpZD1cIkY6SiNTeXMuTm90aWZ5Q29sbGVjdGlvbkNoYW5nZWRBY3Rpb24uYWRkXCI+PC9maWVsZD5cclxuXHQvLy8gPGZpZWxkIG5hbWU9XCJyZW1vdmVcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIiBzdGF0aWM9XCJ0cnVlXCIgbG9jaWQ9XCJGOkojU3lzLk5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkQWN0aW9uLnJlbW92ZVwiPjwvZmllbGQ+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwicmVzZXRcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIiBzdGF0aWM9XCJ0cnVlXCIgbG9jaWQ9XCJGOkojU3lzLk5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkQWN0aW9uLnJlc2V0XCI+PC9maWVsZD5cclxuXHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG59XHJcblxyXG5cclxuXHJcblxyXG5TeXMuTm90aWZ5Q29sbGVjdGlvbkNoYW5nZWRBY3Rpb24ucHJvdG90eXBlID0ge1xyXG5cdGFkZDogMCxcclxuXHRyZW1vdmU6IDEsXHJcblx0cmVzZXQ6IDJcclxufVxyXG5TeXMuTm90aWZ5Q29sbGVjdGlvbkNoYW5nZWRBY3Rpb24ucmVnaXN0ZXJFbnVtKCdTeXMuTm90aWZ5Q29sbGVjdGlvbkNoYW5nZWRBY3Rpb24nKTtcclxuU3lzLk5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkRXZlbnRBcmdzID0gZnVuY3Rpb24gU3lzJE5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkRXZlbnRBcmdzKGNoYW5nZXMpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkRXZlbnRBcmdzLiNjdG9yXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJjaGFuZ2VzXCIgdHlwZT1cIkFycmF5XCIgZWxlbWVudFR5cGU9XCJTeXMuQ29sbGVjdGlvbkNoYW5nZVwiPjwvcGFyYW0+XHJcblxyXG5cdHRoaXMuX2NoYW5nZXMgPSBjaGFuZ2VzO1xyXG5cdFN5cy5Ob3RpZnlDb2xsZWN0aW9uQ2hhbmdlZEV2ZW50QXJncy5pbml0aWFsaXplQmFzZSh0aGlzKTtcclxufVxyXG5cclxuXHRmdW5jdGlvbiBTeXMkTm90aWZ5Q29sbGVjdGlvbkNoYW5nZWRFdmVudEFyZ3MkZ2V0X2NoYW5nZXMoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJBcnJheVwiIGVsZW1lbnRUeXBlPVwiU3lzLkNvbGxlY3Rpb25DaGFuZ2VcIiBsb2NpZD1cIlA6SiNTeXMuTm90aWZ5Q29sbGVjdGlvbkNoYW5nZWRFdmVudEFyZ3MuY2hhbmdlc1wiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiB0aGlzLl9jaGFuZ2VzIHx8IFtdO1xyXG5cdH1cclxuU3lzLk5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkRXZlbnRBcmdzLnByb3RvdHlwZSA9IHtcclxuXHRnZXRfY2hhbmdlczogU3lzJE5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkRXZlbnRBcmdzJGdldF9jaGFuZ2VzXHJcbn1cclxuU3lzLk5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkRXZlbnRBcmdzLnJlZ2lzdGVyQ2xhc3MoXCJTeXMuTm90aWZ5Q29sbGVjdGlvbkNoYW5nZWRFdmVudEFyZ3NcIiwgU3lzLkV2ZW50QXJncyk7XHJcblxyXG5TeXMuT2JzZXJ2ZXIgPSBmdW5jdGlvbiBTeXMkT2JzZXJ2ZXIoKSB7XHJcblx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbigpO1xyXG59XHJcblN5cy5PYnNlcnZlci5yZWdpc3RlckNsYXNzKFwiU3lzLk9ic2VydmVyXCIpO1xyXG5cclxuU3lzLk9ic2VydmVyLm1ha2VPYnNlcnZhYmxlID0gZnVuY3Rpb24gU3lzJE9ic2VydmVyJG1ha2VPYnNlcnZhYmxlKHRhcmdldCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuT2JzZXJ2ZXIubWFrZU9ic2VydmFibGVcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInRhcmdldFwiIG1heUJlTnVsbD1cImZhbHNlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnM+PC9yZXR1cm5zPlxyXG5cclxuXHR2YXIgaXNBcnJheSA9IHRhcmdldCBpbnN0YW5jZW9mIEFycmF5LFxyXG5cdFx0byA9IFN5cy5PYnNlcnZlcjtcclxuXHRTeXMuT2JzZXJ2ZXIuX2Vuc3VyZU9ic2VydmFibGUodGFyZ2V0KTtcclxuXHRpZiAodGFyZ2V0LnNldFZhbHVlID09PSBvLl9vYnNlcnZlTWV0aG9kcy5zZXRWYWx1ZSkgcmV0dXJuIHRhcmdldDtcclxuXHRvLl9hZGRNZXRob2RzKHRhcmdldCwgby5fb2JzZXJ2ZU1ldGhvZHMpO1xyXG5cdGlmIChpc0FycmF5KSB7XHJcblx0XHRvLl9hZGRNZXRob2RzKHRhcmdldCwgby5fYXJyYXlNZXRob2RzKTtcclxuXHR9XHJcblx0cmV0dXJuIHRhcmdldDtcclxufVxyXG5TeXMuT2JzZXJ2ZXIuZGlzcG9zZU9ic2VydmFibGUgPSBmdW5jdGlvbiBTeXMkT2JzZXJ2ZXIkZGlzcG9zZU9ic2VydmFibGUodGFyZ2V0KSB7XHJcblx0dmFyIGlzQXJyYXkgPSB0YXJnZXQgaW5zdGFuY2VvZiBBcnJheSxcclxuXHRcdG8gPSBTeXMuT2JzZXJ2ZXI7XHJcblx0aWYgKHRhcmdldC5zZXRWYWx1ZSA9PT0gby5fb2JzZXJ2ZU1ldGhvZHMuc2V0VmFsdWUpIHtcclxuXHRcdG8uX3JlbW92ZU1ldGhvZHModGFyZ2V0LCBvLl9vYnNlcnZlTWV0aG9kcyk7XHJcblx0XHRpZiAoaXNBcnJheSkge1xyXG5cdFx0XHRvLl9yZW1vdmVNZXRob2RzKHRhcmdldCwgby5fYXJyYXlNZXRob2RzKTtcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuU3lzLk9ic2VydmVyLl9lbnN1cmVPYnNlcnZhYmxlID0gZnVuY3Rpb24gU3lzJE9ic2VydmVyJF9lbnN1cmVPYnNlcnZhYmxlKHRhcmdldCkge1xyXG5cdHZhciB0eXBlID0gdHlwZW9mIHRhcmdldDtcclxuXHRpZiAoKHR5cGUgPT09IFwic3RyaW5nXCIpIHx8ICh0eXBlID09PSBcIm51bWJlclwiKSB8fCAodHlwZSA9PT0gXCJib29sZWFuXCIpIHx8ICh0eXBlID09PSBcImRhdGVcIikpIHtcclxuXHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuUmVzLm5vdE9ic2VydmFibGUsIHR5cGUpKTtcclxuXHR9XHJcbn1cclxuU3lzLk9ic2VydmVyLl9hZGRNZXRob2RzID0gZnVuY3Rpb24gU3lzJE9ic2VydmVyJF9hZGRNZXRob2RzKHRhcmdldCwgbWV0aG9kcykge1xyXG5cdGZvciAodmFyIG0gaW4gbWV0aG9kcykge1xyXG5cdFx0Ly9BbGxvdyBvYnNlcnZhYmxlIHRvIG92ZXJ3cml0ZSB0YXJnZXQgbWV0aG9kcy5cclxuXHRcdC8vaWYgKHRhcmdldFttXSAmJiAodGFyZ2V0W21dICE9PSBtZXRob2RzW21dKSkge1xyXG5cdFx0Ly8gICAgdGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTdHJpbmcuZm9ybWF0KFN5cy5SZXMub2JzZXJ2YWJsZUNvbmZsaWN0LCBtKSk7XHJcblx0XHQvL31cclxuXHRcdHRhcmdldFttXSA9IG1ldGhvZHNbbV07XHJcblx0fVxyXG59XHJcblN5cy5PYnNlcnZlci5fcmVtb3ZlTWV0aG9kcyA9IGZ1bmN0aW9uIFN5cyRPYnNlcnZlciRfcmVtb3ZlTWV0aG9kcyh0YXJnZXQsIG1ldGhvZHMpIHtcclxuXHRmb3IgKHZhciBtIGluIG1ldGhvZHMpIHtcclxuXHRcdHRhcmdldFttXSA9IG51bGw7XHJcblx0fVxyXG59XHJcblxyXG5cclxuU3lzLk9ic2VydmVyLl9hZGRFdmVudEhhbmRsZXIgPSBmdW5jdGlvbiBTeXMkT2JzZXJ2ZXIkX2FkZEV2ZW50SGFuZGxlcih0YXJnZXQsIGV2ZW50TmFtZSwgaGFuZGxlcikge1xyXG5cdFN5cy5PYnNlcnZlci5fZ2V0Q29udGV4dCh0YXJnZXQsIHRydWUpLmV2ZW50cy5fYWRkSGFuZGxlcihldmVudE5hbWUsIGhhbmRsZXIpO1xyXG59XHJcblN5cy5PYnNlcnZlci5hZGRFdmVudEhhbmRsZXIgPSBmdW5jdGlvbiBTeXMkT2JzZXJ2ZXIkYWRkRXZlbnRIYW5kbGVyKHRhcmdldCwgZXZlbnROYW1lLCBoYW5kbGVyKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5hZGRFdmVudEhhbmRsZXJcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInRhcmdldFwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZXZlbnROYW1lXCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiaGFuZGxlclwiIHR5cGU9XCJGdW5jdGlvblwiPjwvcGFyYW0+XHJcblxyXG5cdFN5cy5PYnNlcnZlci5fZW5zdXJlT2JzZXJ2YWJsZSh0YXJnZXQpO1xyXG5cdFN5cy5PYnNlcnZlci5fYWRkRXZlbnRIYW5kbGVyKHRhcmdldCwgZXZlbnROYW1lLCBoYW5kbGVyKTtcclxufVxyXG5cclxuXHJcblN5cy5PYnNlcnZlci5fcmVtb3ZlRXZlbnRIYW5kbGVyID0gZnVuY3Rpb24gU3lzJE9ic2VydmVyJF9yZW1vdmVFdmVudEhhbmRsZXIodGFyZ2V0LCBldmVudE5hbWUsIGhhbmRsZXIpIHtcclxuXHRTeXMuT2JzZXJ2ZXIuX2dldENvbnRleHQodGFyZ2V0LCB0cnVlKS5ldmVudHMuX3JlbW92ZUhhbmRsZXIoZXZlbnROYW1lLCBoYW5kbGVyKTtcclxufVxyXG5TeXMuT2JzZXJ2ZXIucmVtb3ZlRXZlbnRIYW5kbGVyID0gZnVuY3Rpb24gU3lzJE9ic2VydmVyJHJlbW92ZUV2ZW50SGFuZGxlcih0YXJnZXQsIGV2ZW50TmFtZSwgaGFuZGxlcikge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuT2JzZXJ2ZXIucmVtb3ZlRXZlbnRIYW5kbGVyXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ0YXJnZXRcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImV2ZW50TmFtZVwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImhhbmRsZXJcIiB0eXBlPVwiRnVuY3Rpb25cIj48L3BhcmFtPlxyXG5cclxuXHRTeXMuT2JzZXJ2ZXIuX2Vuc3VyZU9ic2VydmFibGUodGFyZ2V0KTtcclxuXHRTeXMuT2JzZXJ2ZXIuX3JlbW92ZUV2ZW50SGFuZGxlcih0YXJnZXQsIGV2ZW50TmFtZSwgaGFuZGxlcik7XHJcbn1cclxuU3lzLk9ic2VydmVyLmNsZWFyRXZlbnRIYW5kbGVycyA9IGZ1bmN0aW9uIFN5cyRPYnNlcnZlciRjbGVhckV2ZW50SGFuZGxlcnModGFyZ2V0LCBldmVudE5hbWUpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk9ic2VydmVyLmNsZWFyRXZlbnRIYW5kbGVyc1wiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwidGFyZ2V0XCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJldmVudE5hbWVcIiB0eXBlPVwiU3RyaW5nXCIgbWF5QmVOdWxsPVwidHJ1ZVwiIG9wdGlvbmFsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblxyXG5cdFN5cy5PYnNlcnZlci5fZW5zdXJlT2JzZXJ2YWJsZSh0YXJnZXQpO1xyXG5cdFN5cy5PYnNlcnZlci5fZ2V0Q29udGV4dCh0YXJnZXQsIHRydWUpLmV2ZW50cy5fcmVtb3ZlSGFuZGxlcnMoZXZlbnROYW1lKTtcclxufVxyXG5TeXMuT2JzZXJ2ZXIucmFpc2VFdmVudCA9IGZ1bmN0aW9uIFN5cyRPYnNlcnZlciRyYWlzZUV2ZW50KHRhcmdldCwgZXZlbnROYW1lLCBldmVudEFyZ3MpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk9ic2VydmVyLnJhaXNlRXZlbnRcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInRhcmdldFwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZXZlbnROYW1lXCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZXZlbnRBcmdzXCIgb3B0aW9uYWw9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblxyXG5cdFN5cy5PYnNlcnZlci5fZW5zdXJlT2JzZXJ2YWJsZSh0YXJnZXQpO1xyXG5cdHZhciBjdHggPSBTeXMuT2JzZXJ2ZXIuX2dldENvbnRleHQodGFyZ2V0KTtcclxuXHRpZiAoIWN0eCkgcmV0dXJuO1xyXG5cdHZhciBoYW5kbGVyID0gY3R4LmV2ZW50cy5nZXRIYW5kbGVyKGV2ZW50TmFtZSk7XHJcblx0aWYgKGhhbmRsZXIpIHtcclxuXHRcdGhhbmRsZXIodGFyZ2V0LCBldmVudEFyZ3MgfHwgU3lzLkV2ZW50QXJncy5FbXB0eSk7XHJcblx0fVxyXG59XHJcblN5cy5PYnNlcnZlci5hZGRQcm9wZXJ0eUNoYW5nZWQgPSBmdW5jdGlvbiBTeXMkT2JzZXJ2ZXIkYWRkUHJvcGVydHlDaGFuZ2VkKHRhcmdldCwgaGFuZGxlcikge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuT2JzZXJ2ZXIuYWRkUHJvcGVydHlDaGFuZ2VkXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ0YXJnZXRcIiBtYXlCZU51bGw9XCJmYWxzZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiaGFuZGxlclwiIHR5cGU9XCJGdW5jdGlvblwiPjwvcGFyYW0+XHJcblxyXG5cdFN5cy5PYnNlcnZlci5fZW5zdXJlT2JzZXJ2YWJsZSh0YXJnZXQpO1xyXG5cdFN5cy5PYnNlcnZlci5fYWRkRXZlbnRIYW5kbGVyKHRhcmdldCwgXCJwcm9wZXJ0eUNoYW5nZWRcIiwgaGFuZGxlcik7XHJcbn1cclxuU3lzLk9ic2VydmVyLnJlbW92ZVByb3BlcnR5Q2hhbmdlZCA9IGZ1bmN0aW9uIFN5cyRPYnNlcnZlciRyZW1vdmVQcm9wZXJ0eUNoYW5nZWQodGFyZ2V0LCBoYW5kbGVyKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5yZW1vdmVQcm9wZXJ0eUNoYW5nZWRcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInRhcmdldFwiIG1heUJlTnVsbD1cImZhbHNlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJoYW5kbGVyXCIgdHlwZT1cIkZ1bmN0aW9uXCI+PC9wYXJhbT5cclxuXHJcblx0U3lzLk9ic2VydmVyLl9lbnN1cmVPYnNlcnZhYmxlKHRhcmdldCk7XHJcblx0U3lzLk9ic2VydmVyLl9yZW1vdmVFdmVudEhhbmRsZXIodGFyZ2V0LCBcInByb3BlcnR5Q2hhbmdlZFwiLCBoYW5kbGVyKTtcclxufVxyXG5TeXMuT2JzZXJ2ZXIuYmVnaW5VcGRhdGUgPSBmdW5jdGlvbiBTeXMkT2JzZXJ2ZXIkYmVnaW5VcGRhdGUodGFyZ2V0KSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5iZWdpblVwZGF0ZVwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwidGFyZ2V0XCIgbWF5QmVOdWxsPVwiZmFsc2VcIj48L3BhcmFtPlxyXG5cclxuXHRTeXMuT2JzZXJ2ZXIuX2Vuc3VyZU9ic2VydmFibGUodGFyZ2V0KTtcclxuXHRTeXMuT2JzZXJ2ZXIuX2dldENvbnRleHQodGFyZ2V0LCB0cnVlKS51cGRhdGluZyA9IHRydWU7XHJcbn1cclxuU3lzLk9ic2VydmVyLmVuZFVwZGF0ZSA9IGZ1bmN0aW9uIFN5cyRPYnNlcnZlciRlbmRVcGRhdGUodGFyZ2V0KSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5lbmRVcGRhdGVcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInRhcmdldFwiIG1heUJlTnVsbD1cImZhbHNlXCI+PC9wYXJhbT5cclxuXHJcblx0U3lzLk9ic2VydmVyLl9lbnN1cmVPYnNlcnZhYmxlKHRhcmdldCk7XHJcblx0dmFyIGN0eCA9IFN5cy5PYnNlcnZlci5fZ2V0Q29udGV4dCh0YXJnZXQpO1xyXG5cdGlmICghY3R4IHx8ICFjdHgudXBkYXRpbmcpIHJldHVybjtcclxuXHRjdHgudXBkYXRpbmcgPSBmYWxzZTtcclxuXHR2YXIgZGlydHkgPSBjdHguZGlydHk7XHJcblx0Y3R4LmRpcnR5ID0gZmFsc2U7XHJcblx0aWYgKGRpcnR5KSB7XHJcblx0XHRpZiAodGFyZ2V0IGluc3RhbmNlb2YgQXJyYXkpIHtcclxuXHRcdFx0dmFyIGNoYW5nZXMgPSBjdHguY2hhbmdlcztcclxuXHRcdFx0Y3R4LmNoYW5nZXMgPSBudWxsO1xyXG5cdFx0XHRTeXMuT2JzZXJ2ZXIucmFpc2VDb2xsZWN0aW9uQ2hhbmdlZCh0YXJnZXQsIGNoYW5nZXMpO1xyXG5cdFx0fVxyXG5cdFx0U3lzLk9ic2VydmVyLnJhaXNlUHJvcGVydHlDaGFuZ2VkKHRhcmdldCwgXCJcIik7XHJcblx0fVxyXG59XHJcblN5cy5PYnNlcnZlci5pc1VwZGF0aW5nID0gZnVuY3Rpb24gU3lzJE9ic2VydmVyJGlzVXBkYXRpbmcodGFyZ2V0KSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5pc1VwZGF0aW5nXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ0YXJnZXRcIiBtYXlCZU51bGw9XCJmYWxzZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJCb29sZWFuXCI+PC9yZXR1cm5zPlxyXG5cclxuXHRTeXMuT2JzZXJ2ZXIuX2Vuc3VyZU9ic2VydmFibGUodGFyZ2V0KTtcclxuXHR2YXIgY3R4ID0gU3lzLk9ic2VydmVyLl9nZXRDb250ZXh0KHRhcmdldCk7XHJcblx0cmV0dXJuIGN0eCA/IGN0eC51cGRhdGluZyA6IGZhbHNlO1xyXG59XHJcblxyXG5cclxuU3lzLk9ic2VydmVyLl9zZXRWYWx1ZSA9IGZ1bmN0aW9uIFN5cyRPYnNlcnZlciRfc2V0VmFsdWUodGFyZ2V0LCBwcm9wZXJ0eU5hbWUsIHZhbHVlKSB7XHJcblx0dmFyIGdldHRlciwgc2V0dGVyLCBtYWluVGFyZ2V0ID0gdGFyZ2V0LCBwYXRoID0gcHJvcGVydHlOYW1lLnNwbGl0KCcuJyk7XHJcblx0Zm9yICh2YXIgaSA9IDAsIGwgPSAocGF0aC5sZW5ndGggLSAxKTsgaSA8IGw7IGkrKykge1xyXG5cdFx0dmFyIG5hbWUgPSBwYXRoW2ldO1xyXG5cdFx0Z2V0dGVyID0gdGFyZ2V0W1wiZ2V0X1wiICsgbmFtZV07XHJcblx0XHRpZiAodHlwZW9mIChnZXR0ZXIpID09PSBcImZ1bmN0aW9uXCIpIHtcclxuXHRcdFx0dGFyZ2V0ID0gZ2V0dGVyLmNhbGwodGFyZ2V0KTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHR0YXJnZXQgPSB0YXJnZXRbbmFtZV07XHJcblx0XHR9XHJcblx0XHR2YXIgdHlwZSA9IHR5cGVvZiAodGFyZ2V0KTtcclxuXHRcdGlmICgodGFyZ2V0ID09PSBudWxsKSB8fCAodHlwZSA9PT0gXCJ1bmRlZmluZWRcIikpIHtcclxuXHRcdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTdHJpbmcuZm9ybWF0KFN5cy5SZXMubnVsbFJlZmVyZW5jZUluUGF0aCwgcHJvcGVydHlOYW1lKSk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHR2YXIgbm90aWZ5ID0gdHJ1ZTsgLy8gYWRkZWRcclxuXHR2YXIgY3VycmVudFZhbHVlLCBsYXN0UGF0aCA9IHBhdGhbbF07XHJcblx0Z2V0dGVyID0gdGFyZ2V0W1wiZ2V0X1wiICsgbGFzdFBhdGhdO1xyXG5cdHNldHRlciA9IHRhcmdldFtcInNldF9cIiArIGxhc3RQYXRoXTtcclxuXHRpZiAodHlwZW9mIChnZXR0ZXIpID09PSAnZnVuY3Rpb24nKSB7XHJcblx0XHRjdXJyZW50VmFsdWUgPSBnZXR0ZXIuY2FsbCh0YXJnZXQpO1xyXG5cdH1cclxuXHRlbHNlIHtcclxuXHRcdGN1cnJlbnRWYWx1ZSA9IHRhcmdldFtsYXN0UGF0aF07XHJcblx0fVxyXG5cdGlmICh0eXBlb2YgKHNldHRlcikgPT09ICdmdW5jdGlvbicpIHtcclxuXHRcdG5vdGlmeSA9ICFzZXR0ZXIuX19ub3RpZmllczsgLy8gYWRkZWRcclxuXHRcdHNldHRlci5jYWxsKHRhcmdldCwgdmFsdWUpO1xyXG5cdH1cclxuXHRlbHNlIHtcclxuXHRcdHRhcmdldFtsYXN0UGF0aF0gPSB2YWx1ZTtcclxuXHR9XHJcblx0aWYgKGN1cnJlbnRWYWx1ZSAhPT0gdmFsdWUpIHtcclxuXHRcdHZhciBjdHggPSBTeXMuT2JzZXJ2ZXIuX2dldENvbnRleHQobWFpblRhcmdldCk7XHJcblx0XHRpZiAoY3R4ICYmIGN0eC51cGRhdGluZykge1xyXG5cdFx0XHRjdHguZGlydHkgPSB0cnVlO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRpZiAobm90aWZ5KSB7XHJcblx0XHRcdFN5cy5PYnNlcnZlci5yYWlzZVByb3BlcnR5Q2hhbmdlZChtYWluVGFyZ2V0LCBwYXRoWzBdKTtcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuU3lzLk9ic2VydmVyLnNldFZhbHVlID0gZnVuY3Rpb24gU3lzJE9ic2VydmVyJHNldFZhbHVlKHRhcmdldCwgcHJvcGVydHlOYW1lLCB2YWx1ZSkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuT2JzZXJ2ZXIuc2V0VmFsdWVcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInRhcmdldFwiIG1heUJlTnVsbD1cImZhbHNlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJwcm9wZXJ0eU5hbWVcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ2YWx1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cclxuXHRTeXMuT2JzZXJ2ZXIuX2Vuc3VyZU9ic2VydmFibGUodGFyZ2V0KTtcclxuXHRTeXMuT2JzZXJ2ZXIuX3NldFZhbHVlKHRhcmdldCwgcHJvcGVydHlOYW1lLCB2YWx1ZSk7XHJcbn1cclxuU3lzLk9ic2VydmVyLnJhaXNlUHJvcGVydHlDaGFuZ2VkID0gZnVuY3Rpb24gU3lzJE9ic2VydmVyJHJhaXNlUHJvcGVydHlDaGFuZ2VkKHRhcmdldCwgcHJvcGVydHlOYW1lKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5yYWlzZVByb3BlcnR5Q2hhbmdlZFwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwidGFyZ2V0XCIgbWF5QmVOdWxsPVwiZmFsc2VcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInByb3BlcnR5TmFtZVwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cdFN5cy5PYnNlcnZlci5yYWlzZUV2ZW50KHRhcmdldCwgXCJwcm9wZXJ0eUNoYW5nZWRcIiwgbmV3IFN5cy5Qcm9wZXJ0eUNoYW5nZWRFdmVudEFyZ3MocHJvcGVydHlOYW1lKSk7XHJcbn1cclxuXHJcblN5cy5PYnNlcnZlci5hZGRDb2xsZWN0aW9uQ2hhbmdlZCA9IGZ1bmN0aW9uIFN5cyRPYnNlcnZlciRhZGRDb2xsZWN0aW9uQ2hhbmdlZCh0YXJnZXQsIGhhbmRsZXIpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk9ic2VydmVyLmFkZENvbGxlY3Rpb25DaGFuZ2VkXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ0YXJnZXRcIiB0eXBlPVwiQXJyYXlcIiBlbGVtZW50TWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiaGFuZGxlclwiIHR5cGU9XCJGdW5jdGlvblwiPjwvcGFyYW0+XHJcblxyXG5cdFN5cy5PYnNlcnZlci5fYWRkRXZlbnRIYW5kbGVyKHRhcmdldCwgXCJjb2xsZWN0aW9uQ2hhbmdlZFwiLCBoYW5kbGVyKTtcclxufVxyXG5TeXMuT2JzZXJ2ZXIucmVtb3ZlQ29sbGVjdGlvbkNoYW5nZWQgPSBmdW5jdGlvbiBTeXMkT2JzZXJ2ZXIkcmVtb3ZlQ29sbGVjdGlvbkNoYW5nZWQodGFyZ2V0LCBoYW5kbGVyKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5yZW1vdmVDb2xsZWN0aW9uQ2hhbmdlZFwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwidGFyZ2V0XCIgdHlwZT1cIkFycmF5XCIgZWxlbWVudE1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImhhbmRsZXJcIiB0eXBlPVwiRnVuY3Rpb25cIj48L3BhcmFtPlxyXG5cclxuXHRTeXMuT2JzZXJ2ZXIuX3JlbW92ZUV2ZW50SGFuZGxlcih0YXJnZXQsIFwiY29sbGVjdGlvbkNoYW5nZWRcIiwgaGFuZGxlcik7XHJcbn1cclxuU3lzLk9ic2VydmVyLl9jb2xsZWN0aW9uQ2hhbmdlID0gZnVuY3Rpb24gU3lzJE9ic2VydmVyJF9jb2xsZWN0aW9uQ2hhbmdlKHRhcmdldCwgY2hhbmdlKSB7XHJcblx0dmFyIGN0eCA9IFN5cy5PYnNlcnZlci5fZ2V0Q29udGV4dCh0YXJnZXQpO1xyXG5cdGlmIChjdHggJiYgY3R4LnVwZGF0aW5nKSB7XHJcblx0XHRjdHguZGlydHkgPSB0cnVlO1xyXG5cdFx0dmFyIGNoYW5nZXMgPSBjdHguY2hhbmdlcztcclxuXHRcdGlmICghY2hhbmdlcykge1xyXG5cdFx0XHRjdHguY2hhbmdlcyA9IGNoYW5nZXMgPSBbY2hhbmdlXTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRjaGFuZ2VzLnB1c2goY2hhbmdlKTtcclxuXHRcdH1cclxuXHR9XHJcblx0ZWxzZSB7XHJcblx0XHRTeXMuT2JzZXJ2ZXIucmFpc2VDb2xsZWN0aW9uQ2hhbmdlZCh0YXJnZXQsIFtjaGFuZ2VdKTtcclxuXHRcdFN5cy5PYnNlcnZlci5yYWlzZVByb3BlcnR5Q2hhbmdlZCh0YXJnZXQsICdsZW5ndGgnKTtcclxuXHR9XHJcbn1cclxuU3lzLk9ic2VydmVyLmFkZCA9IGZ1bmN0aW9uIFN5cyRPYnNlcnZlciRhZGQodGFyZ2V0LCBpdGVtKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5hZGRcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInRhcmdldFwiIHR5cGU9XCJBcnJheVwiIGVsZW1lbnRNYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJpdGVtXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblxyXG5cdHZhciBjaGFuZ2UgPSBuZXcgU3lzLkNvbGxlY3Rpb25DaGFuZ2UoU3lzLk5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkQWN0aW9uLmFkZCwgW2l0ZW1dLCB0YXJnZXQubGVuZ3RoKTtcclxuXHRBcnJheS5hZGQodGFyZ2V0LCBpdGVtKTtcclxuXHRTeXMuT2JzZXJ2ZXIuX2NvbGxlY3Rpb25DaGFuZ2UodGFyZ2V0LCBjaGFuZ2UpO1xyXG59XHJcblN5cy5PYnNlcnZlci5hZGRSYW5nZSA9IGZ1bmN0aW9uIFN5cyRPYnNlcnZlciRhZGRSYW5nZSh0YXJnZXQsIGl0ZW1zKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5hZGRSYW5nZVwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwidGFyZ2V0XCIgdHlwZT1cIkFycmF5XCIgZWxlbWVudE1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cIml0ZW1zXCIgdHlwZT1cIkFycmF5XCIgZWxlbWVudE1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cclxuXHR2YXIgY2hhbmdlID0gbmV3IFN5cy5Db2xsZWN0aW9uQ2hhbmdlKFN5cy5Ob3RpZnlDb2xsZWN0aW9uQ2hhbmdlZEFjdGlvbi5hZGQsIGl0ZW1zLCB0YXJnZXQubGVuZ3RoKTtcclxuXHRBcnJheS5hZGRSYW5nZSh0YXJnZXQsIGl0ZW1zKTtcclxuXHRTeXMuT2JzZXJ2ZXIuX2NvbGxlY3Rpb25DaGFuZ2UodGFyZ2V0LCBjaGFuZ2UpO1xyXG59XHJcblN5cy5PYnNlcnZlci5pbnNlcnRSYW5nZSA9IGZ1bmN0aW9uIFN5cyRPYnNlcnZlciRpbnNlcnRSYW5nZSh0YXJnZXQsIGluZGV4LCBpdGVtcykge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuT2JzZXJ2ZXIuaW5zZXJ0UmFuZ2VcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInRhcmdldFwiIHR5cGU9XCJBcnJheVwiIGVsZW1lbnRNYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJpbmRleFwiIHR5cGU9XCJBcnJheVwiIGVsZW1lbnRNYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJpdGVtc1wiIHR5cGU9XCJBcnJheVwiIGVsZW1lbnRNYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHJcblx0dmFyIGNoYW5nZSA9IG5ldyBTeXMuQ29sbGVjdGlvbkNoYW5nZShTeXMuTm90aWZ5Q29sbGVjdGlvbkNoYW5nZWRBY3Rpb24uYWRkLCBpdGVtcywgaW5kZXgpO1xyXG5cdHZhciBzcGxpY2VBcmdzID0gaXRlbXMuc2xpY2UoKTtcclxuXHRzcGxpY2VBcmdzLnNwbGljZSgwLCAwLCBpbmRleCwgMCk7XHJcblx0dGFyZ2V0LnNwbGljZS5hcHBseSh0YXJnZXQsIHNwbGljZUFyZ3MpO1xyXG5cdFN5cy5PYnNlcnZlci5fY29sbGVjdGlvbkNoYW5nZSh0YXJnZXQsIGNoYW5nZSk7XHJcbn1cclxuU3lzLk9ic2VydmVyLnJlbW92ZVJhbmdlID0gZnVuY3Rpb24gU3lzJE9ic2VydmVyJHJlbW92ZVJhbmdlKHRhcmdldCwgc3RhcnQsIGNvdW50KSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5yZW1vdmVSYW5nZVwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwidGFyZ2V0XCIgdHlwZT1cIkFycmF5XCIgZWxlbWVudE1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInN0YXJ0XCIgdHlwZT1cIkFycmF5XCIgZWxlbWVudE1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImNvdW50XCIgdHlwZT1cIkFycmF5XCIgZWxlbWVudE1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cclxuXHR2YXIgaXRlbXMgPSB0YXJnZXQuc3BsaWNlKHN0YXJ0LCBjb3VudCk7XHJcblx0dmFyIGNoYW5nZSA9IG5ldyBTeXMuQ29sbGVjdGlvbkNoYW5nZShTeXMuTm90aWZ5Q29sbGVjdGlvbkNoYW5nZWRBY3Rpb24ucmVtb3ZlLCBudWxsLCAtMSwgaXRlbXMsIHN0YXJ0KTtcclxuXHRTeXMuT2JzZXJ2ZXIuX2NvbGxlY3Rpb25DaGFuZ2UodGFyZ2V0LCBjaGFuZ2UpO1xyXG5cdHJldHVybiBpdGVtcztcclxufVxyXG5TeXMuT2JzZXJ2ZXIuY2xlYXIgPSBmdW5jdGlvbiBTeXMkT2JzZXJ2ZXIkY2xlYXIodGFyZ2V0KSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5jbGVhclwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwidGFyZ2V0XCIgdHlwZT1cIkFycmF5XCIgZWxlbWVudE1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cclxuXHR2YXIgb2xkSXRlbXMgPSBBcnJheS5jbG9uZSh0YXJnZXQpO1xyXG5cdEFycmF5LmNsZWFyKHRhcmdldCk7XHJcblx0U3lzLk9ic2VydmVyLl9jb2xsZWN0aW9uQ2hhbmdlKHRhcmdldCwgbmV3IFN5cy5Db2xsZWN0aW9uQ2hhbmdlKFN5cy5Ob3RpZnlDb2xsZWN0aW9uQ2hhbmdlZEFjdGlvbi5yZXNldCwgbnVsbCwgLTEsIG9sZEl0ZW1zLCAwKSk7XHJcbn1cclxuU3lzLk9ic2VydmVyLmluc2VydCA9IGZ1bmN0aW9uIFN5cyRPYnNlcnZlciRpbnNlcnQodGFyZ2V0LCBpbmRleCwgaXRlbSkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuT2JzZXJ2ZXIuaW5zZXJ0XCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ0YXJnZXRcIiB0eXBlPVwiQXJyYXlcIiBlbGVtZW50TWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiaW5kZXhcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cIml0ZW1cIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHJcblx0QXJyYXkuaW5zZXJ0KHRhcmdldCwgaW5kZXgsIGl0ZW0pO1xyXG5cdFN5cy5PYnNlcnZlci5fY29sbGVjdGlvbkNoYW5nZSh0YXJnZXQsIG5ldyBTeXMuQ29sbGVjdGlvbkNoYW5nZShTeXMuTm90aWZ5Q29sbGVjdGlvbkNoYW5nZWRBY3Rpb24uYWRkLCBbaXRlbV0sIGluZGV4KSk7XHJcbn1cclxuU3lzLk9ic2VydmVyLnJlbW92ZSA9IGZ1bmN0aW9uIFN5cyRPYnNlcnZlciRyZW1vdmUodGFyZ2V0LCBpdGVtKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5yZW1vdmVcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInRhcmdldFwiIHR5cGU9XCJBcnJheVwiIGVsZW1lbnRNYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJpdGVtXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJCb29sZWFuXCI+PC9yZXR1cm5zPlxyXG5cclxuXHR2YXIgaW5kZXggPSBBcnJheS5pbmRleE9mKHRhcmdldCwgaXRlbSk7XHJcblx0aWYgKGluZGV4ICE9PSAtMSkge1xyXG5cdFx0QXJyYXkucmVtb3ZlKHRhcmdldCwgaXRlbSk7XHJcblx0XHRTeXMuT2JzZXJ2ZXIuX2NvbGxlY3Rpb25DaGFuZ2UodGFyZ2V0LCBuZXcgU3lzLkNvbGxlY3Rpb25DaGFuZ2UoU3lzLk5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkQWN0aW9uLnJlbW92ZSwgbnVsbCwgLTEsIFtpdGVtXSwgaW5kZXgpKTtcclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH1cclxuXHRyZXR1cm4gZmFsc2U7XHJcbn1cclxuU3lzLk9ic2VydmVyLnJlbW92ZUF0ID0gZnVuY3Rpb24gU3lzJE9ic2VydmVyJHJlbW92ZUF0KHRhcmdldCwgaW5kZXgpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk9ic2VydmVyLnJlbW92ZUF0XCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ0YXJnZXRcIiB0eXBlPVwiQXJyYXlcIiBlbGVtZW50TWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiaW5kZXhcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIj48L3BhcmFtPlxyXG5cclxuXHRpZiAoKGluZGV4ID4gLTEpICYmIChpbmRleCA8IHRhcmdldC5sZW5ndGgpKSB7XHJcblx0XHR2YXIgaXRlbSA9IHRhcmdldFtpbmRleF07XHJcblx0XHRBcnJheS5yZW1vdmVBdCh0YXJnZXQsIGluZGV4KTtcclxuXHRcdFN5cy5PYnNlcnZlci5fY29sbGVjdGlvbkNoYW5nZSh0YXJnZXQsIG5ldyBTeXMuQ29sbGVjdGlvbkNoYW5nZShTeXMuTm90aWZ5Q29sbGVjdGlvbkNoYW5nZWRBY3Rpb24ucmVtb3ZlLCBudWxsLCAtMSwgW2l0ZW1dLCBpbmRleCkpO1xyXG5cdFx0cmV0dXJuIGl0ZW07XHJcblx0fVxyXG59XHJcblN5cy5PYnNlcnZlci5yYWlzZUNvbGxlY3Rpb25DaGFuZ2VkID0gZnVuY3Rpb24gU3lzJE9ic2VydmVyJHJhaXNlQ29sbGVjdGlvbkNoYW5nZWQodGFyZ2V0LCBjaGFuZ2VzKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5yYWlzZUNvbGxlY3Rpb25DaGFuZ2VkXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ0YXJnZXRcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImNoYW5nZXNcIiB0eXBlPVwiQXJyYXlcIiBlbGVtZW50VHlwZT1cIlN5cy5Db2xsZWN0aW9uQ2hhbmdlXCI+PC9wYXJhbT5cclxuXHRTeXMuT2JzZXJ2ZXIucmFpc2VFdmVudCh0YXJnZXQsIFwiY29sbGVjdGlvbkNoYW5nZWRcIiwgbmV3IFN5cy5Ob3RpZnlDb2xsZWN0aW9uQ2hhbmdlZEV2ZW50QXJncyhjaGFuZ2VzKSk7XHJcbn1cclxuXHJcblxyXG5TeXMuT2JzZXJ2ZXIuX29ic2VydmVNZXRob2RzID0ge1xyXG5cdGFkZF9wcm9wZXJ0eUNoYW5nZWQ6IGZ1bmN0aW9uKGhhbmRsZXIpIHtcclxuXHRcdFN5cy5PYnNlcnZlci5fYWRkRXZlbnRIYW5kbGVyKHRoaXMsIFwicHJvcGVydHlDaGFuZ2VkXCIsIGhhbmRsZXIpO1xyXG5cdH0sXHJcblx0cmVtb3ZlX3Byb3BlcnR5Q2hhbmdlZDogZnVuY3Rpb24oaGFuZGxlcikge1xyXG5cdFx0U3lzLk9ic2VydmVyLl9yZW1vdmVFdmVudEhhbmRsZXIodGhpcywgXCJwcm9wZXJ0eUNoYW5nZWRcIiwgaGFuZGxlcik7XHJcblx0fSxcclxuXHRhZGRFdmVudEhhbmRsZXI6IGZ1bmN0aW9uKGV2ZW50TmFtZSwgaGFuZGxlcikge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5yYWlzZUNvbGxlY3Rpb25DaGFuZ2VkXCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImV2ZW50TmFtZVwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiaGFuZGxlclwiIHR5cGU9XCJGdW5jdGlvblwiPjwvcGFyYW0+XHJcblxyXG5cdFx0U3lzLk9ic2VydmVyLl9hZGRFdmVudEhhbmRsZXIodGhpcywgZXZlbnROYW1lLCBoYW5kbGVyKTtcclxuXHR9LFxyXG5cdHJlbW92ZUV2ZW50SGFuZGxlcjogZnVuY3Rpb24oZXZlbnROYW1lLCBoYW5kbGVyKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk9ic2VydmVyLnJhaXNlQ29sbGVjdGlvbkNoYW5nZWRcIiAvPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiZXZlbnROYW1lXCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJoYW5kbGVyXCIgdHlwZT1cIkZ1bmN0aW9uXCI+PC9wYXJhbT5cclxuXHJcblx0XHRTeXMuT2JzZXJ2ZXIuX3JlbW92ZUV2ZW50SGFuZGxlcih0aGlzLCBldmVudE5hbWUsIGhhbmRsZXIpO1xyXG5cdH0sXHJcblx0Y2xlYXJFdmVudEhhbmRsZXJzOiBmdW5jdGlvbihldmVudE5hbWUpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuT2JzZXJ2ZXIucmFpc2VDb2xsZWN0aW9uQ2hhbmdlZFwiIC8+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJ0YXJnZXRcIj48L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiZXZlbnROYW1lXCIgdHlwZT1cIlN0cmluZ1wiIG1heUJlTnVsbD1cInRydWVcIiBvcHRpb25hbD1cInRydWVcIj48L3BhcmFtPlxyXG5cclxuXHRcdFN5cy5PYnNlcnZlci5fZ2V0Q29udGV4dCh0aGlzLCB0cnVlKS5ldmVudHMuX3JlbW92ZUhhbmRsZXJzKGV2ZW50TmFtZSk7XHJcblx0fSxcclxuXHRnZXRfaXNVcGRhdGluZzogZnVuY3Rpb24oKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk9ic2VydmVyLnJhaXNlQ29sbGVjdGlvbkNoYW5nZWRcIiAvPlxyXG5cdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJCb29sZWFuXCI+PC9yZXR1cm5zPlxyXG5cdFx0cmV0dXJuIFN5cy5PYnNlcnZlci5pc1VwZGF0aW5nKHRoaXMpO1xyXG5cdH0sXHJcblx0YmVnaW5VcGRhdGU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5yYWlzZUNvbGxlY3Rpb25DaGFuZ2VkXCIgLz5cclxuXHRcdFN5cy5PYnNlcnZlci5iZWdpblVwZGF0ZSh0aGlzKTtcclxuXHR9LFxyXG5cdGVuZFVwZGF0ZTogZnVuY3Rpb24oKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk9ic2VydmVyLnJhaXNlQ29sbGVjdGlvbkNoYW5nZWRcIiAvPlxyXG5cdFx0U3lzLk9ic2VydmVyLmVuZFVwZGF0ZSh0aGlzKTtcclxuXHR9LFxyXG5cdHNldFZhbHVlOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5yYWlzZUNvbGxlY3Rpb25DaGFuZ2VkXCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cIm5hbWVcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cInZhbHVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblxyXG5cdFx0U3lzLk9ic2VydmVyLl9zZXRWYWx1ZSh0aGlzLCBuYW1lLCB2YWx1ZSk7XHJcblx0fSxcclxuXHRyYWlzZUV2ZW50OiBmdW5jdGlvbihldmVudE5hbWUsIGV2ZW50QXJncykge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5yYWlzZUNvbGxlY3Rpb25DaGFuZ2VkXCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImV2ZW50TmFtZVwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiZXZlbnRBcmdzXCIgb3B0aW9uYWw9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0XHRTeXMuT2JzZXJ2ZXIucmFpc2VFdmVudCh0aGlzLCBldmVudE5hbWUsIGV2ZW50QXJnc3x8bnVsbCk7XHJcblx0fSxcclxuXHRyYWlzZVByb3BlcnR5Q2hhbmdlZDogZnVuY3Rpb24obmFtZSkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5yYWlzZUNvbGxlY3Rpb25DaGFuZ2VkXCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cIm5hbWVcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHRcdFN5cy5PYnNlcnZlci5yYWlzZUV2ZW50KHRoaXMsIFwicHJvcGVydHlDaGFuZ2VkXCIsIG5ldyBTeXMuUHJvcGVydHlDaGFuZ2VkRXZlbnRBcmdzKG5hbWUpKTtcclxuXHR9XHJcbn1cclxuU3lzLk9ic2VydmVyLl9hcnJheU1ldGhvZHMgPSB7XHJcblx0YWRkX2NvbGxlY3Rpb25DaGFuZ2VkOiBmdW5jdGlvbihoYW5kbGVyKSB7XHJcblx0XHRTeXMuT2JzZXJ2ZXIuX2FkZEV2ZW50SGFuZGxlcih0aGlzLCBcImNvbGxlY3Rpb25DaGFuZ2VkXCIsIGhhbmRsZXIpO1xyXG5cdH0sXHJcblx0cmVtb3ZlX2NvbGxlY3Rpb25DaGFuZ2VkOiBmdW5jdGlvbihoYW5kbGVyKSB7XHJcblx0XHRTeXMuT2JzZXJ2ZXIuX3JlbW92ZUV2ZW50SGFuZGxlcih0aGlzLCBcImNvbGxlY3Rpb25DaGFuZ2VkXCIsIGhhbmRsZXIpO1xyXG5cdH0sXHJcblx0YWRkOiBmdW5jdGlvbihpdGVtKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk9ic2VydmVyLnJhaXNlQ29sbGVjdGlvbkNoYW5nZWRcIiAvPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiaXRlbVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdFx0U3lzLk9ic2VydmVyLmFkZCh0aGlzLCBpdGVtKTtcclxuXHR9LFxyXG5cdGFkZFJhbmdlOiBmdW5jdGlvbihpdGVtcykge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5yYWlzZUNvbGxlY3Rpb25DaGFuZ2VkXCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cIml0ZW1zXCIgdHlwZT1cIkFycmF5XCIgZWxlbWVudE1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdFx0U3lzLk9ic2VydmVyLmFkZFJhbmdlKHRoaXMsIGl0ZW1zKTtcclxuXHR9LFxyXG5cdGNsZWFyOiBmdW5jdGlvbigpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuT2JzZXJ2ZXIucmFpc2VDb2xsZWN0aW9uQ2hhbmdlZFwiIC8+XHJcblx0XHRTeXMuT2JzZXJ2ZXIuY2xlYXIodGhpcyk7XHJcblx0fSxcclxuXHRpbnNlcnQ6IGZ1bmN0aW9uKGluZGV4LCBpdGVtKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk9ic2VydmVyLnJhaXNlQ29sbGVjdGlvbkNoYW5nZWRcIiAvPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiaW5kZXhcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIj48L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiaXRlbVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdFx0U3lzLk9ic2VydmVyLmluc2VydCh0aGlzLCBpbmRleCwgaXRlbSk7XHJcblx0fSxcclxuXHRpbnNlcnRSYW5nZTogZnVuY3Rpb24oaW5kZXgsIGl0ZW1zKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk9ic2VydmVyLmluc2VydFJhbmdlXCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cInRhcmdldFwiIHR5cGU9XCJBcnJheVwiIGVsZW1lbnRNYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImluZGV4XCIgdHlwZT1cIkFycmF5XCIgZWxlbWVudE1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiaXRlbXNcIiB0eXBlPVwiQXJyYXlcIiBlbGVtZW50TWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0XHRTeXMuT2JzZXJ2ZXIuaW5zZXJ0UmFuZ2UodGhpcywgaW5kZXgsIGl0ZW1zKTtcclxuXHR9LFxyXG5cdHJlbW92ZTogZnVuY3Rpb24oaXRlbSkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5PYnNlcnZlci5yYWlzZUNvbGxlY3Rpb25DaGFuZ2VkXCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cIml0ZW1cIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiQm9vbGVhblwiPjwvcmV0dXJucz5cclxuXHRcdHJldHVybiBTeXMuT2JzZXJ2ZXIucmVtb3ZlKHRoaXMsIGl0ZW0pO1xyXG5cdH0sXHJcblx0cmVtb3ZlQXQ6IGZ1bmN0aW9uKGluZGV4KSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk9ic2VydmVyLnJhaXNlQ29sbGVjdGlvbkNoYW5nZWRcIiAvPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiaW5kZXhcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIj48L3BhcmFtPlxyXG5cdFx0cmV0dXJuIFN5cy5PYnNlcnZlci5yZW1vdmVBdCh0aGlzLCBpbmRleCk7XHJcblx0fSxcclxuXHRyZW1vdmVSYW5nZTogZnVuY3Rpb24oc3RhcnQsIGNvdW50KSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk9ic2VydmVyLnJlbW92ZVJhbmdlXCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cInRhcmdldFwiIHR5cGU9XCJBcnJheVwiIGVsZW1lbnRNYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cInN0YXJ0XCIgdHlwZT1cIkFycmF5XCIgZWxlbWVudE1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiY291bnRcIiB0eXBlPVwiQXJyYXlcIiBlbGVtZW50TWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0XHRyZXR1cm4gU3lzLk9ic2VydmVyLnJlbW92ZVJhbmdlKHRoaXMsIHN0YXJ0LCBjb3VudCk7XHJcblx0fSxcclxuXHRyYWlzZUNvbGxlY3Rpb25DaGFuZ2VkOiBmdW5jdGlvbihjaGFuZ2VzKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk9ic2VydmVyLnJhaXNlQ29sbGVjdGlvbkNoYW5nZWRcIiAvPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiY2hhbmdlc1wiIHR5cGU9XCJBcnJheVwiIGVsZW1lbnRUeXBlPVwiU3lzLkNvbGxlY3Rpb25DaGFuZ2VcIj48L3BhcmFtPlxyXG5cdFx0U3lzLk9ic2VydmVyLnJhaXNlRXZlbnQodGhpcywgXCJjb2xsZWN0aW9uQ2hhbmdlZFwiLCBuZXcgU3lzLk5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkRXZlbnRBcmdzKGNoYW5nZXMpKTtcclxuXHR9XHJcbn1cclxuU3lzLk9ic2VydmVyLl9nZXRDb250ZXh0ID0gZnVuY3Rpb24gU3lzJE9ic2VydmVyJF9nZXRDb250ZXh0KG9iaiwgY3JlYXRlKSB7XHJcblx0dmFyIGN0eCA9IG9iai5fb2JzZXJ2ZXJDb250ZXh0O1xyXG5cdGlmIChjdHgpIHJldHVybiBjdHgoKTtcclxuXHRpZiAoY3JlYXRlKSB7XHJcblx0XHRyZXR1cm4gKG9iai5fb2JzZXJ2ZXJDb250ZXh0ID0gU3lzLk9ic2VydmVyLl9jcmVhdGVDb250ZXh0KCkpKCk7XHJcblx0fVxyXG5cdHJldHVybiBudWxsO1xyXG59XHJcblN5cy5PYnNlcnZlci5fY3JlYXRlQ29udGV4dCA9IGZ1bmN0aW9uIFN5cyRPYnNlcnZlciRfY3JlYXRlQ29udGV4dCgpIHtcclxuXHR2YXIgY3R4ID0ge1xyXG5cdFx0ZXZlbnRzOiBuZXcgU3lzLkV2ZW50SGFuZGxlckxpc3QoKVxyXG5cdH07XHJcblx0cmV0dXJuIGZ1bmN0aW9uKCkge1xyXG5cdFx0cmV0dXJuIGN0eDtcclxuXHR9XHJcbn1cclxuXHJcblxyXG5cclxuXHJcblxyXG5EYXRlLl9hcHBlbmRQcmVPclBvc3RNYXRjaCA9IGZ1bmN0aW9uIERhdGUkX2FwcGVuZFByZU9yUG9zdE1hdGNoKHByZU1hdGNoLCBzdHJCdWlsZGVyKSB7XHJcblx0dmFyIHF1b3RlQ291bnQgPSAwO1xyXG5cdHZhciBlc2NhcGVkID0gZmFsc2U7XHJcblx0Zm9yICh2YXIgaSA9IDAsIGlsID0gcHJlTWF0Y2gubGVuZ3RoOyBpIDwgaWw7IGkrKykge1xyXG5cdFx0dmFyIGMgPSBwcmVNYXRjaC5jaGFyQXQoaSk7XHJcblx0XHRzd2l0Y2ggKGMpIHtcclxuXHRcdGNhc2UgJ1xcJyc6XHJcblx0XHRcdGlmIChlc2NhcGVkKSBzdHJCdWlsZGVyLmFwcGVuZChcIidcIik7XHJcblx0XHRcdGVsc2UgcXVvdGVDb3VudCsrO1xyXG5cdFx0XHRlc2NhcGVkID0gZmFsc2U7XHJcblx0XHRcdGJyZWFrO1xyXG5cdFx0Y2FzZSAnXFxcXCc6XHJcblx0XHRcdGlmIChlc2NhcGVkKSBzdHJCdWlsZGVyLmFwcGVuZChcIlxcXFxcIik7XHJcblx0XHRcdGVzY2FwZWQgPSAhZXNjYXBlZDtcclxuXHRcdFx0YnJlYWs7XHJcblx0XHRkZWZhdWx0OlxyXG5cdFx0XHRzdHJCdWlsZGVyLmFwcGVuZChjKTtcclxuXHRcdFx0ZXNjYXBlZCA9IGZhbHNlO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdH1cclxuXHR9XHJcblx0cmV0dXJuIHF1b3RlQ291bnQ7XHJcbn1cclxuXHJcbiAgIERhdGUuX2V4cGFuZEZvcm1hdCA9IGZ1bmN0aW9uIERhdGUkX2V4cGFuZEZvcm1hdChkdGYsIGZvcm1hdCkge1xyXG5cdGlmICghZm9ybWF0KSB7XHJcblx0XHRmb3JtYXQgPSBcIkZcIjtcclxuXHR9XHJcblx0dmFyIGxlbiA9IGZvcm1hdC5sZW5ndGg7XHJcblx0aWYgKGxlbiA9PT0gMSkge1xyXG5cdFx0c3dpdGNoIChmb3JtYXQpIHtcclxuXHRcdGNhc2UgXCJkXCI6XHJcblx0XHRcdHJldHVybiBkdGZbXCJTaG9ydERhdGVQYXR0ZXJuXCJdO1xyXG5cdFx0Y2FzZSBcIkRcIjpcclxuXHRcdFx0cmV0dXJuIGR0ZltcIkxvbmdEYXRlUGF0dGVyblwiXTtcclxuXHRcdGNhc2UgXCJ0XCI6XHJcblx0XHRcdHJldHVybiBkdGZbXCJTaG9ydFRpbWVQYXR0ZXJuXCJdO1xyXG5cdFx0Y2FzZSBcIlRcIjpcclxuXHRcdFx0cmV0dXJuIGR0ZltcIkxvbmdUaW1lUGF0dGVyblwiXTtcclxuXHRcdGNhc2UgXCJmXCI6XHJcblx0XHRcdHJldHVybiBkdGZbXCJMb25nRGF0ZVBhdHRlcm5cIl0gKyBcIiBcIiArIGR0ZltcIlNob3J0VGltZVBhdHRlcm5cIl07XHJcblx0XHRjYXNlIFwiRlwiOlxyXG5cdFx0XHRyZXR1cm4gZHRmW1wiRnVsbERhdGVQYXR0ZXJuXCJdO1xyXG5cdFx0Y2FzZSBcImdcIjpcclxuXHRcdFx0cmV0dXJuIGR0ZltcIlNob3J0RGF0ZVBhdHRlcm5cIl0gKyBcIiBcIiArIGR0ZltcIlNob3J0VGltZVBhdHRlcm5cIl07XHJcblx0XHRjYXNlIFwiR1wiOlxyXG5cdFx0XHRyZXR1cm4gZHRmW1wiU2hvcnREYXRlUGF0dGVyblwiXSArIFwiIFwiICsgZHRmW1wiTG9uZ1RpbWVQYXR0ZXJuXCJdO1xyXG5cdFx0Y2FzZSBcIk1cIjogY2FzZSBcIm1cIjpcclxuXHRcdFx0cmV0dXJuIGR0ZltcIk1vbnRoRGF5UGF0dGVyblwiXTtcclxuXHRcdGNhc2UgXCJzXCI6XHJcblx0XHRcdHJldHVybiBkdGZbXCJTb3J0YWJsZURhdGVUaW1lUGF0dGVyblwiXTtcclxuXHRcdFxyXG5cdFx0Y2FzZSBcIllcIjogY2FzZSBcInlcIjpcclxuXHRcdFx0cmV0dXJuIGR0ZltcIlllYXJNb250aFBhdHRlcm5cIl07XHJcblx0XHRkZWZhdWx0OlxyXG5cdFx0XHR0aHJvdyBFcnJvci5mb3JtYXQoU3lzLlJlcy5mb3JtYXRJbnZhbGlkU3RyaW5nKTtcclxuXHRcdH1cclxuXHR9XHJcblx0ZWxzZSBpZiAoKGxlbiA9PT0gMikgJiYgKGZvcm1hdC5jaGFyQXQoMCkgPT09IFwiJVwiKSkge1xyXG5cdFx0Zm9ybWF0ID0gZm9ybWF0LmNoYXJBdCgxKTtcclxuXHR9XHJcblx0cmV0dXJuIGZvcm1hdDtcclxufVxyXG5cclxuRGF0ZS5fZXhwYW5kWWVhciA9IGZ1bmN0aW9uIERhdGUkX2V4cGFuZFllYXIoZHRmLCB5ZWFyKSB7XHJcblx0dmFyIG5vdyA9IG5ldyBEYXRlKCksXHJcblx0XHRlcmEgPSBEYXRlLl9nZXRFcmEobm93KTtcclxuXHRpZiAoeWVhciA8IDEwMCkge1xyXG5cdFx0dmFyIGN1cnIgPSBEYXRlLl9nZXRFcmFZZWFyKG5vdywgZHRmLCBlcmEpO1xyXG5cdFx0eWVhciArPSBjdXJyIC0gKGN1cnIgJSAxMDApO1xyXG5cdFx0aWYgKHllYXIgPiBkdGYuQ2FsZW5kYXIuVHdvRGlnaXRZZWFyTWF4KSB7XHJcblx0XHRcdHllYXIgLT0gMTAwO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4geWVhcjtcclxufVxyXG5cclxuRGF0ZS5fZ2V0RXJhID0gZnVuY3Rpb24gRGF0ZSRfZ2V0RXJhKGRhdGUsIGVyYXMpIHtcclxuXHRpZiAoIWVyYXMpIHJldHVybiAwO1xyXG5cdHZhciBzdGFydCwgdGlja3MgPSBkYXRlLmdldFRpbWUoKTtcclxuXHRmb3IgKHZhciBpID0gMCwgbCA9IGVyYXMubGVuZ3RoOyBpIDwgbDsgaSArPSA0KSB7XHJcblx0XHRzdGFydCA9IGVyYXNbaSsyXTtcclxuXHRcdGlmICgoc3RhcnQgPT09IG51bGwpIHx8ICh0aWNrcyA+PSBzdGFydCkpIHtcclxuXHRcdFx0cmV0dXJuIGk7XHJcblx0XHR9XHJcblx0fVxyXG5cdHJldHVybiAwO1xyXG59XHJcbkRhdGUuX2dldEVyYVllYXIgPSBmdW5jdGlvbiBEYXRlJF9nZXRFcmFZZWFyKGRhdGUsIGR0ZiwgZXJhLCBzb3J0YWJsZSkge1xyXG5cdHZhciB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpO1xyXG5cdGlmICghc29ydGFibGUgJiYgZHRmLmVyYXMpIHtcclxuXHRcdHllYXIgLT0gZHRmLmVyYXNbZXJhICsgM107XHJcblx0fVxyXG5cdHJldHVybiB5ZWFyO1xyXG59XHJcblxyXG5EYXRlLl9nZXRQYXJzZVJlZ0V4cCA9IGZ1bmN0aW9uIERhdGUkX2dldFBhcnNlUmVnRXhwKGR0ZiwgZm9ybWF0KSB7XHJcblx0aWYgKCFkdGYuX3BhcnNlUmVnRXhwKSB7XHJcblx0XHRkdGYuX3BhcnNlUmVnRXhwID0ge307XHJcblx0fVxyXG5cdGVsc2UgaWYgKGR0Zi5fcGFyc2VSZWdFeHBbZm9ybWF0XSkge1xyXG5cdFx0cmV0dXJuIGR0Zi5fcGFyc2VSZWdFeHBbZm9ybWF0XTtcclxuXHR9XHJcblxyXG5cdHZhciBleHBGb3JtYXQgPSBEYXRlLl9leHBhbmRGb3JtYXQoZHRmLCBmb3JtYXQpO1xyXG5cdGV4cEZvcm1hdCA9IGV4cEZvcm1hdC5yZXBsYWNlKC8oW1xcXlxcJFxcLlxcKlxcK1xcP1xcfFxcW1xcXVxcKFxcKVxce1xcfV0pL2csIFwiXFxcXFxcXFwkMVwiKTtcclxuXHJcblx0dmFyIHJlZ2V4cCA9IG5ldyBTeXMuU3RyaW5nQnVpbGRlcihcIl5cIik7XHJcblx0dmFyIGdyb3VwcyA9IFtdO1xyXG5cdHZhciBpbmRleCA9IDA7XHJcblx0dmFyIHF1b3RlQ291bnQgPSAwO1xyXG5cdHZhciB0b2tlblJlZ0V4cCA9IERhdGUuX2dldFRva2VuUmVnRXhwKCk7XHJcblx0dmFyIG1hdGNoO1xyXG5cclxuXHR3aGlsZSAoKG1hdGNoID0gdG9rZW5SZWdFeHAuZXhlYyhleHBGb3JtYXQpKSAhPT0gbnVsbCkge1xyXG5cdFx0dmFyIHByZU1hdGNoID0gZXhwRm9ybWF0LnNsaWNlKGluZGV4LCBtYXRjaC5pbmRleCk7XHJcblx0XHRpbmRleCA9IHRva2VuUmVnRXhwLmxhc3RJbmRleDtcclxuXHJcblx0XHRxdW90ZUNvdW50ICs9IERhdGUuX2FwcGVuZFByZU9yUG9zdE1hdGNoKHByZU1hdGNoLCByZWdleHApO1xyXG5cdFx0aWYgKChxdW90ZUNvdW50JTIpID09PSAxKSB7XHJcblx0XHRcdHJlZ2V4cC5hcHBlbmQobWF0Y2hbMF0pO1xyXG5cdFx0XHRjb250aW51ZTtcclxuXHRcdH1cclxuXHJcblx0XHRzd2l0Y2ggKG1hdGNoWzBdKSB7XHJcblx0XHRcdGNhc2UgJ2RkZGQnOiBjYXNlICdkZGQnOlxyXG5cdFx0XHRjYXNlICdNTU1NJzogY2FzZSAnTU1NJzpcclxuXHRcdFx0Y2FzZSAnZ2cnOiBjYXNlICdnJzpcclxuXHRcdFx0XHRyZWdleHAuYXBwZW5kKFwiKFxcXFxEKylcIik7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdGNhc2UgJ3R0JzogY2FzZSAndCc6XHJcblx0XHRcdFx0cmVnZXhwLmFwcGVuZChcIihcXFxcRCopXCIpO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRjYXNlICd5eXl5JzpcclxuXHRcdFx0XHRyZWdleHAuYXBwZW5kKFwiKFxcXFxkezR9KVwiKTtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdFx0Y2FzZSAnZmZmJzpcclxuXHRcdFx0XHRyZWdleHAuYXBwZW5kKFwiKFxcXFxkezN9KVwiKTtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdFx0Y2FzZSAnZmYnOlxyXG5cdFx0XHRcdHJlZ2V4cC5hcHBlbmQoXCIoXFxcXGR7Mn0pXCIpO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRjYXNlICdmJzpcclxuXHRcdFx0XHRyZWdleHAuYXBwZW5kKFwiKFxcXFxkKVwiKTtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdFx0Y2FzZSAnZGQnOiBjYXNlICdkJzpcclxuXHRcdFx0Y2FzZSAnTU0nOiBjYXNlICdNJzpcclxuXHRcdFx0Y2FzZSAneXknOiBjYXNlICd5JzpcclxuXHRcdFx0Y2FzZSAnSEgnOiBjYXNlICdIJzpcclxuXHRcdFx0Y2FzZSAnaGgnOiBjYXNlICdoJzpcclxuXHRcdFx0Y2FzZSAnbW0nOiBjYXNlICdtJzpcclxuXHRcdFx0Y2FzZSAnc3MnOiBjYXNlICdzJzpcclxuXHRcdFx0XHRyZWdleHAuYXBwZW5kKFwiKFxcXFxkXFxcXGQ/KVwiKTtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdFx0Y2FzZSAnenp6JzpcclxuXHRcdFx0XHRyZWdleHAuYXBwZW5kKFwiKFsrLV0/XFxcXGRcXFxcZD86XFxcXGR7Mn0pXCIpO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRjYXNlICd6eic6IGNhc2UgJ3onOlxyXG5cdFx0XHRcdHJlZ2V4cC5hcHBlbmQoXCIoWystXT9cXFxcZFxcXFxkPylcIik7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdGNhc2UgJy8nOlxyXG5cdFx0XHRcdHJlZ2V4cC5hcHBlbmQoXCIoXFxcXFwiICsgZHRmLkRhdGVTZXBhcmF0b3IgKyBcIilcIik7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHR9XHJcblx0XHRBcnJheS5hZGQoZ3JvdXBzLCBtYXRjaFswXSk7XHJcblx0fVxyXG5cdERhdGUuX2FwcGVuZFByZU9yUG9zdE1hdGNoKGV4cEZvcm1hdC5zbGljZShpbmRleCksIHJlZ2V4cCk7XHJcblx0cmVnZXhwLmFwcGVuZChcIiRcIik7XHJcblx0dmFyIHJlZ2V4cFN0ciA9IHJlZ2V4cC50b1N0cmluZygpLnJlcGxhY2UoL1xccysvZywgXCJcXFxccytcIik7XHJcblx0dmFyIHBhcnNlUmVnRXhwID0geydyZWdFeHAnOiByZWdleHBTdHIsICdncm91cHMnOiBncm91cHN9O1xyXG5cdGR0Zi5fcGFyc2VSZWdFeHBbZm9ybWF0XSA9IHBhcnNlUmVnRXhwO1xyXG5cdHJldHVybiBwYXJzZVJlZ0V4cDtcclxufVxyXG5cclxuRGF0ZS5fZ2V0VG9rZW5SZWdFeHAgPSBmdW5jdGlvbiBEYXRlJF9nZXRUb2tlblJlZ0V4cCgpIHtcclxuXHRyZXR1cm4gL1xcL3xkZGRkfGRkZHxkZHxkfE1NTU18TU1NfE1NfE18eXl5eXx5eXx5fGhofGh8SEh8SHxtbXxtfHNzfHN8dHR8dHxmZmZ8ZmZ8Znx6enp8enp8enxnZ3xnL2c7XHJcbn1cclxuXHJcbkRhdGUucGFyc2VMb2NhbGUgPSBmdW5jdGlvbiBEYXRlJHBhcnNlTG9jYWxlKHZhbHVlLCBmb3JtYXRzKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI0RhdGUucGFyc2VMb2NhbGVcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInZhbHVlXCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZm9ybWF0c1wiIHBhcmFtZXRlckFycmF5PVwidHJ1ZVwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiRGF0ZVwiPjwvcmV0dXJucz5cclxuXHJcblx0cmV0dXJuIERhdGUuX3BhcnNlKHZhbHVlLCBTeXMuQ3VsdHVyZUluZm8uQ3VycmVudEN1bHR1cmUsIGFyZ3VtZW50cyk7XHJcbn1cclxuXHJcbkRhdGUucGFyc2VJbnZhcmlhbnQgPSBmdW5jdGlvbiBEYXRlJHBhcnNlSW52YXJpYW50KHZhbHVlLCBmb3JtYXRzKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI0RhdGUucGFyc2VJbnZhcmlhbnRcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInZhbHVlXCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZm9ybWF0c1wiIHBhcmFtZXRlckFycmF5PVwidHJ1ZVwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiRGF0ZVwiPjwvcmV0dXJucz5cclxuXHJcblx0cmV0dXJuIERhdGUuX3BhcnNlKHZhbHVlLCBTeXMuQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVyZSwgYXJndW1lbnRzKTtcclxufVxyXG5cclxuRGF0ZS5fcGFyc2UgPSBmdW5jdGlvbiBEYXRlJF9wYXJzZSh2YWx1ZSwgY3VsdHVyZUluZm8sIGFyZ3MpIHtcclxuXHR2YXIgaSwgbCwgZGF0ZSwgZm9ybWF0LCBmb3JtYXRzLCBjdXN0b20gPSBmYWxzZTtcclxuXHRmb3IgKGkgPSAxLCBsID0gYXJncy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuXHRcdGZvcm1hdCA9IGFyZ3NbaV07XHJcblx0XHRpZiAoZm9ybWF0KSB7XHJcblx0XHRcdGN1c3RvbSA9IHRydWU7XHJcblx0XHRcdGRhdGUgPSBEYXRlLl9wYXJzZUV4YWN0KHZhbHVlLCBmb3JtYXQsIGN1bHR1cmVJbmZvKTtcclxuXHRcdFx0aWYgKGRhdGUpIHJldHVybiBkYXRlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRpZiAoISBjdXN0b20pIHtcclxuXHRcdGZvcm1hdHMgPSBjdWx0dXJlSW5mby5fZ2V0RGF0ZVRpbWVGb3JtYXRzKCk7XHJcblx0XHRmb3IgKGkgPSAwLCBsID0gZm9ybWF0cy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuXHRcdFx0ZGF0ZSA9IERhdGUuX3BhcnNlRXhhY3QodmFsdWUsIGZvcm1hdHNbaV0sIGN1bHR1cmVJbmZvKTtcclxuXHRcdFx0aWYgKGRhdGUpIHJldHVybiBkYXRlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gbnVsbDtcclxufVxyXG5cclxuRGF0ZS5fcGFyc2VFeGFjdCA9IGZ1bmN0aW9uIERhdGUkX3BhcnNlRXhhY3QodmFsdWUsIGZvcm1hdCwgY3VsdHVyZUluZm8pIHtcclxuXHR2YWx1ZSA9IHZhbHVlLnRyaW0oKTtcclxuXHR2YXIgZHRmID0gY3VsdHVyZUluZm8uZGF0ZVRpbWVGb3JtYXQsXHJcblx0XHRwYXJzZUluZm8gPSBEYXRlLl9nZXRQYXJzZVJlZ0V4cChkdGYsIGZvcm1hdCksXHJcblx0XHRtYXRjaCA9IG5ldyBSZWdFeHAocGFyc2VJbmZvLnJlZ0V4cCkuZXhlYyh2YWx1ZSk7XHJcblx0aWYgKG1hdGNoID09PSBudWxsKSByZXR1cm4gbnVsbDtcclxuXHR2YXIgZ3JvdXBzID0gcGFyc2VJbmZvLmdyb3VwcyxcclxuXHRcdGVyYSA9IG51bGwsIHllYXIgPSBudWxsLCBtb250aCA9IG51bGwsIGRhdGUgPSBudWxsLCB3ZWVrRGF5ID0gbnVsbCxcclxuXHRcdGhvdXIgPSAwLCBob3VyT2Zmc2V0LCBtaW4gPSAwLCBzZWMgPSAwLCBtc2VjID0gMCwgdHpNaW5PZmZzZXQgPSBudWxsLFxyXG5cdFx0cG1Ib3VyID0gZmFsc2U7XHJcblx0Zm9yICh2YXIgaiA9IDAsIGpsID0gZ3JvdXBzLmxlbmd0aDsgaiA8IGpsOyBqKyspIHtcclxuXHRcdHZhciBtYXRjaEdyb3VwID0gbWF0Y2hbaisxXTtcclxuXHRcdGlmIChtYXRjaEdyb3VwKSB7XHJcblx0XHRcdHN3aXRjaCAoZ3JvdXBzW2pdKSB7XHJcblx0XHRcdFx0Y2FzZSAnZGQnOiBjYXNlICdkJzpcclxuXHRcdFx0XHRcdGRhdGUgPSBwYXJzZUludChtYXRjaEdyb3VwLCAxMCk7XHJcblx0XHRcdFx0XHRpZiAoKGRhdGUgPCAxKSB8fCAoZGF0ZSA+IDMxKSkgcmV0dXJuIG51bGw7XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRjYXNlICdNTU1NJzpcclxuXHRcdFx0XHRcdG1vbnRoID0gY3VsdHVyZUluZm8uX2dldE1vbnRoSW5kZXgobWF0Y2hHcm91cCk7XHJcblx0XHRcdFx0XHRpZiAoKG1vbnRoIDwgMCkgfHwgKG1vbnRoID4gMTEpKSByZXR1cm4gbnVsbDtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdGNhc2UgJ01NTSc6XHJcblx0XHRcdFx0XHRtb250aCA9IGN1bHR1cmVJbmZvLl9nZXRNb250aEluZGV4KG1hdGNoR3JvdXAsIHRydWUpO1xyXG5cdFx0XHRcdFx0aWYgKChtb250aCA8IDApIHx8IChtb250aCA+IDExKSkgcmV0dXJuIG51bGw7XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRjYXNlICdNJzogY2FzZSAnTU0nOlxyXG5cdFx0XHRcdFx0bW9udGggPSBwYXJzZUludChtYXRjaEdyb3VwLCAxMCkgLSAxO1xyXG5cdFx0XHRcdFx0aWYgKChtb250aCA8IDApIHx8IChtb250aCA+IDExKSkgcmV0dXJuIG51bGw7XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRjYXNlICd5JzogY2FzZSAneXknOlxyXG5cdFx0XHRcdFx0eWVhciA9IERhdGUuX2V4cGFuZFllYXIoZHRmLHBhcnNlSW50KG1hdGNoR3JvdXAsIDEwKSk7XHJcblx0XHRcdFx0XHRpZiAoKHllYXIgPCAwKSB8fCAoeWVhciA+IDk5OTkpKSByZXR1cm4gbnVsbDtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdGNhc2UgJ3l5eXknOlxyXG5cdFx0XHRcdFx0eWVhciA9IHBhcnNlSW50KG1hdGNoR3JvdXAsIDEwKTtcclxuXHRcdFx0XHRcdGlmICgoeWVhciA8IDApIHx8ICh5ZWFyID4gOTk5OSkpIHJldHVybiBudWxsO1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0Y2FzZSAnaCc6IGNhc2UgJ2hoJzpcclxuXHRcdFx0XHRcdGhvdXIgPSBwYXJzZUludChtYXRjaEdyb3VwLCAxMCk7XHJcblx0XHRcdFx0XHRpZiAoaG91ciA9PT0gMTIpIGhvdXIgPSAwO1xyXG5cdFx0XHRcdFx0aWYgKChob3VyIDwgMCkgfHwgKGhvdXIgPiAxMSkpIHJldHVybiBudWxsO1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0Y2FzZSAnSCc6IGNhc2UgJ0hIJzpcclxuXHRcdFx0XHRcdGhvdXIgPSBwYXJzZUludChtYXRjaEdyb3VwLCAxMCk7XHJcblx0XHRcdFx0XHRpZiAoKGhvdXIgPCAwKSB8fCAoaG91ciA+IDIzKSkgcmV0dXJuIG51bGw7XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRjYXNlICdtJzogY2FzZSAnbW0nOlxyXG5cdFx0XHRcdFx0bWluID0gcGFyc2VJbnQobWF0Y2hHcm91cCwgMTApO1xyXG5cdFx0XHRcdFx0aWYgKChtaW4gPCAwKSB8fCAobWluID4gNTkpKSByZXR1cm4gbnVsbDtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdGNhc2UgJ3MnOiBjYXNlICdzcyc6XHJcblx0XHRcdFx0XHRzZWMgPSBwYXJzZUludChtYXRjaEdyb3VwLCAxMCk7XHJcblx0XHRcdFx0XHRpZiAoKHNlYyA8IDApIHx8IChzZWMgPiA1OSkpIHJldHVybiBudWxsO1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0Y2FzZSAndHQnOiBjYXNlICd0JzpcclxuXHRcdFx0XHRcdHZhciB1cHBlclRva2VuID0gbWF0Y2hHcm91cC50b1VwcGVyQ2FzZSgpO1xyXG5cdFx0XHRcdFx0cG1Ib3VyID0gKHVwcGVyVG9rZW4gPT09IGR0Zi5QTURlc2lnbmF0b3IudG9VcHBlckNhc2UoKSk7XHJcblx0XHRcdFx0XHRpZiAoIXBtSG91ciAmJiAodXBwZXJUb2tlbiAhPT0gZHRmLkFNRGVzaWduYXRvci50b1VwcGVyQ2FzZSgpKSkgcmV0dXJuIG51bGw7XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRjYXNlICdmJzpcclxuXHRcdFx0XHRcdG1zZWMgPSBwYXJzZUludChtYXRjaEdyb3VwLCAxMCkgKiAxMDA7XHJcblx0XHRcdFx0XHRpZiAoKG1zZWMgPCAwKSB8fCAobXNlYyA+IDk5OSkpIHJldHVybiBudWxsO1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0Y2FzZSAnZmYnOlxyXG5cdFx0XHRcdFx0bXNlYyA9IHBhcnNlSW50KG1hdGNoR3JvdXAsIDEwKSAqIDEwO1xyXG5cdFx0XHRcdFx0aWYgKChtc2VjIDwgMCkgfHwgKG1zZWMgPiA5OTkpKSByZXR1cm4gbnVsbDtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdGNhc2UgJ2ZmZic6XHJcblx0XHRcdFx0XHRtc2VjID0gcGFyc2VJbnQobWF0Y2hHcm91cCwgMTApO1xyXG5cdFx0XHRcdFx0aWYgKChtc2VjIDwgMCkgfHwgKG1zZWMgPiA5OTkpKSByZXR1cm4gbnVsbDtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdGNhc2UgJ2RkZGQnOlxyXG5cdFx0XHRcdFx0d2Vla0RheSA9IGN1bHR1cmVJbmZvLl9nZXREYXlJbmRleChtYXRjaEdyb3VwKTtcclxuXHRcdFx0XHRcdGlmICgod2Vla0RheSA8IDApIHx8ICh3ZWVrRGF5ID4gNikpIHJldHVybiBudWxsO1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0Y2FzZSAnZGRkJzpcclxuXHRcdFx0XHRcdHdlZWtEYXkgPSBjdWx0dXJlSW5mby5fZ2V0RGF5SW5kZXgobWF0Y2hHcm91cCwgdHJ1ZSk7XHJcblx0XHRcdFx0XHRpZiAoKHdlZWtEYXkgPCAwKSB8fCAod2Vla0RheSA+IDYpKSByZXR1cm4gbnVsbDtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdGNhc2UgJ3p6eic6XHJcblx0XHRcdFx0XHR2YXIgb2Zmc2V0cyA9IG1hdGNoR3JvdXAuc3BsaXQoLzovKTtcclxuXHRcdFx0XHRcdGlmIChvZmZzZXRzLmxlbmd0aCAhPT0gMikgcmV0dXJuIG51bGw7XHJcblx0XHRcdFx0XHRob3VyT2Zmc2V0ID0gcGFyc2VJbnQob2Zmc2V0c1swXSwgMTApO1xyXG5cdFx0XHRcdFx0aWYgKChob3VyT2Zmc2V0IDwgLTEyKSB8fCAoaG91ck9mZnNldCA+IDEzKSkgcmV0dXJuIG51bGw7XHJcblx0XHRcdFx0XHR2YXIgbWluT2Zmc2V0ID0gcGFyc2VJbnQob2Zmc2V0c1sxXSwgMTApO1xyXG5cdFx0XHRcdFx0aWYgKChtaW5PZmZzZXQgPCAwKSB8fCAobWluT2Zmc2V0ID4gNTkpKSByZXR1cm4gbnVsbDtcclxuXHRcdFx0XHRcdHR6TWluT2Zmc2V0ID0gKGhvdXJPZmZzZXQgKiA2MCkgKyAobWF0Y2hHcm91cC5zdGFydHNXaXRoKCctJyk/IC1taW5PZmZzZXQgOiBtaW5PZmZzZXQpO1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0Y2FzZSAneic6IGNhc2UgJ3p6JzpcclxuXHRcdFx0XHRcdGhvdXJPZmZzZXQgPSBwYXJzZUludChtYXRjaEdyb3VwLCAxMCk7XHJcblx0XHRcdFx0XHRpZiAoKGhvdXJPZmZzZXQgPCAtMTIpIHx8IChob3VyT2Zmc2V0ID4gMTMpKSByZXR1cm4gbnVsbDtcclxuXHRcdFx0XHRcdHR6TWluT2Zmc2V0ID0gaG91ck9mZnNldCAqIDYwO1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0Y2FzZSAnZyc6IGNhc2UgJ2dnJzpcclxuXHRcdFx0XHRcdHZhciBlcmFOYW1lID0gbWF0Y2hHcm91cDtcclxuXHRcdFx0XHRcdGlmICghZXJhTmFtZSB8fCAhZHRmLmVyYXMpIHJldHVybiBudWxsO1xyXG5cdFx0XHRcdFx0ZXJhTmFtZSA9IGVyYU5hbWUudG9Mb3dlckNhc2UoKS50cmltKCk7XHJcblx0XHRcdFx0XHRmb3IgKHZhciBpID0gMCwgbCA9IGR0Zi5lcmFzLmxlbmd0aDsgaSA8IGw7IGkgKz0gNCkge1xyXG5cdFx0XHRcdFx0XHRpZiAoZXJhTmFtZSA9PT0gZHRmLmVyYXNbaSArIDFdLnRvTG93ZXJDYXNlKCkpIHtcclxuXHRcdFx0XHRcdFx0XHRlcmEgPSBpO1xyXG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRpZiAoZXJhID09PSBudWxsKSByZXR1cm4gbnVsbDtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdHZhciByZXN1bHQgPSBuZXcgRGF0ZSgpLCBkZWZhdWx0WWVhciwgY29udmVydCA9IGR0Zi5DYWxlbmRhci5jb252ZXJ0O1xyXG5cdC8vIElmIG5vbmUgYXJlIHNwZWNpZmllZCwgc2V0IHRvIHRvZGF5cyBkYXRlIHRvIDEvMS8xOTcwXHJcblx0aWYgKHllYXIgPT0gbnVsbCAmJiBtb250aCA9PSBudWxsICYmIGRhdGUgPT0gbnVsbCkge1xyXG5cdFx0eWVhciA9IDE5NzA7XHJcblx0XHRtb250aCA9IDA7XHJcblx0XHRkYXRlID0gMTtcclxuXHR9XHJcblx0ZWxzZSB7XHJcblx0XHRpZiAoY29udmVydCkge1xyXG5cdFx0XHRkZWZhdWx0WWVhciA9IGNvbnZlcnQuZnJvbUdyZWdvcmlhbihyZXN1bHQpWzBdO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGRlZmF1bHRZZWFyID0gcmVzdWx0LmdldEZ1bGxZZWFyKCk7XHJcblx0XHR9XHJcblx0XHRpZiAoeWVhciA9PT0gbnVsbCkge1xyXG5cdFx0XHR5ZWFyID0gZGVmYXVsdFllYXI7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChkdGYuZXJhcykge1xyXG5cdFx0XHR5ZWFyICs9IGR0Zi5lcmFzWyhlcmEgfHwgMCkgKyAzXTtcclxuXHRcdH1cclxuXHRcdGlmIChtb250aCA9PT0gbnVsbCkge1xyXG5cdFx0XHRtb250aCA9IDA7XHJcblx0XHR9XHJcblx0XHRpZiAoZGF0ZSA9PT0gbnVsbCkge1xyXG5cdFx0XHRkYXRlID0gMTtcclxuXHRcdH1cclxuXHR9XHJcblx0aWYgKGNvbnZlcnQpIHtcclxuXHRcdHJlc3VsdCA9IGNvbnZlcnQudG9HcmVnb3JpYW4oeWVhciwgbW9udGgsIGRhdGUpO1xyXG5cdFx0aWYgKHJlc3VsdCA9PT0gbnVsbCkgcmV0dXJuIG51bGw7XHJcblx0fVxyXG5cdGVsc2Uge1xyXG5cdFx0cmVzdWx0LnNldEZ1bGxZZWFyKHllYXIsIG1vbnRoLCBkYXRlKTtcclxuXHRcdGlmIChyZXN1bHQuZ2V0RGF0ZSgpICE9PSBkYXRlKSByZXR1cm4gbnVsbDtcclxuXHRcdGlmICgod2Vla0RheSAhPT0gbnVsbCkgJiYgKHJlc3VsdC5nZXREYXkoKSAhPT0gd2Vla0RheSkpIHtcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblx0fVxyXG5cdGlmIChwbUhvdXIgJiYgKGhvdXIgPCAxMikpIHtcclxuXHRcdGhvdXIgKz0gMTI7XHJcblx0fVxyXG5cdHJlc3VsdC5zZXRIb3Vycyhob3VyLCBtaW4sIHNlYywgbXNlYyk7XHJcblx0aWYgKHR6TWluT2Zmc2V0ICE9PSBudWxsKSB7XHJcblx0XHR2YXIgYWRqdXN0ZWRNaW4gPSByZXN1bHQuZ2V0TWludXRlcygpIC0gKHR6TWluT2Zmc2V0ICsgcmVzdWx0LmdldFRpbWV6b25lT2Zmc2V0KCkpO1xyXG5cdFx0cmVzdWx0LnNldEhvdXJzKHJlc3VsdC5nZXRIb3VycygpICsgcGFyc2VJbnQoYWRqdXN0ZWRNaW4vNjAsIDEwKSwgYWRqdXN0ZWRNaW4lNjApO1xyXG5cdH1cclxuXHRyZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5EYXRlLnByb3RvdHlwZS5mb3JtYXQgPSBmdW5jdGlvbiBEYXRlJGZvcm1hdChmb3JtYXQpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojRGF0ZS5mb3JtYXRcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImZvcm1hdFwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiU3RyaW5nXCI+PC9yZXR1cm5zPlxyXG5cclxuXHRyZXR1cm4gdGhpcy5fdG9Gb3JtYXR0ZWRTdHJpbmcoZm9ybWF0LCBTeXMuQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVyZSk7XHJcbn1cclxuXHJcbkRhdGUucHJvdG90eXBlLmxvY2FsZUZvcm1hdCA9IGZ1bmN0aW9uIERhdGUkbG9jYWxlRm9ybWF0KGZvcm1hdCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNEYXRlLmxvY2FsZUZvcm1hdFwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZm9ybWF0XCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJTdHJpbmdcIj48L3JldHVybnM+XHJcblxyXG5cdHJldHVybiB0aGlzLl90b0Zvcm1hdHRlZFN0cmluZyhmb3JtYXQsIFN5cy5DdWx0dXJlSW5mby5DdXJyZW50Q3VsdHVyZSk7XHJcbn1cclxuXHJcbkRhdGUucHJvdG90eXBlLl90b0Zvcm1hdHRlZFN0cmluZyA9IGZ1bmN0aW9uIERhdGUkX3RvRm9ybWF0dGVkU3RyaW5nKGZvcm1hdCwgY3VsdHVyZUluZm8pIHtcclxuXHR2YXIgZHRmID0gY3VsdHVyZUluZm8uZGF0ZVRpbWVGb3JtYXQsXHJcblx0XHRjb252ZXJ0ID0gZHRmLkNhbGVuZGFyLmNvbnZlcnQ7XHJcblx0aWYgKCFmb3JtYXQgfHwgIWZvcm1hdC5sZW5ndGggfHwgKGZvcm1hdCA9PT0gJ2knKSkge1xyXG5cdFx0aWYgKGN1bHR1cmVJbmZvICYmIGN1bHR1cmVJbmZvLm5hbWUubGVuZ3RoKSB7XHJcblx0XHRcdGlmIChjb252ZXJ0KSB7XHJcblx0XHRcdFx0cmV0dXJuIHRoaXMuX3RvRm9ybWF0dGVkU3RyaW5nKGR0Zi5GdWxsRGF0ZVRpbWVQYXR0ZXJuLCBjdWx0dXJlSW5mbyk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dmFyIGVyYURhdGUgPSBuZXcgRGF0ZSh0aGlzLmdldFRpbWUoKSk7XHJcblx0XHRcdFx0dmFyIGVyYSA9IERhdGUuX2dldEVyYSh0aGlzLCBkdGYuZXJhcyk7XHJcblx0XHRcdFx0ZXJhRGF0ZS5zZXRGdWxsWWVhcihEYXRlLl9nZXRFcmFZZWFyKHRoaXMsIGR0ZiwgZXJhKSk7XHJcblx0XHRcdFx0cmV0dXJuIGVyYURhdGUudG9Mb2NhbGVTdHJpbmcoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHJldHVybiB0aGlzLnRvU3RyaW5nKCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHR2YXIgZXJhcyA9IGR0Zi5lcmFzLFxyXG5cdFx0c29ydGFibGUgPSAoZm9ybWF0ID09PSBcInNcIik7XHJcblx0Zm9ybWF0ID0gRGF0ZS5fZXhwYW5kRm9ybWF0KGR0ZiwgZm9ybWF0KTtcclxuXHJcblx0dmFyIHJldCA9IG5ldyBTeXMuU3RyaW5nQnVpbGRlcigpO1xyXG5cdHZhciBob3VyO1xyXG5cclxuXHRmdW5jdGlvbiBhZGRMZWFkaW5nWmVybyhudW0pIHtcclxuXHRcdGlmIChudW0gPCAxMCkge1xyXG5cdFx0XHRyZXR1cm4gJzAnICsgbnVtO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIG51bS50b1N0cmluZygpO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gYWRkTGVhZGluZ1plcm9zKG51bSkge1xyXG5cdFx0aWYgKG51bSA8IDEwKSB7XHJcblx0XHRcdHJldHVybiAnMDAnICsgbnVtO1xyXG5cdFx0fVxyXG5cdFx0aWYgKG51bSA8IDEwMCkge1xyXG5cdFx0XHRyZXR1cm4gJzAnICsgbnVtO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIG51bS50b1N0cmluZygpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBwYWRZZWFyKHllYXIpIHtcclxuXHRcdGlmICh5ZWFyIDwgMTApIHtcclxuXHRcdFx0cmV0dXJuICcwMDAnICsgeWVhcjtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKHllYXIgPCAxMDApIHtcclxuXHRcdFx0cmV0dXJuICcwMCcgKyB5ZWFyO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAoeWVhciA8IDEwMDApIHtcclxuXHRcdFx0cmV0dXJuICcwJyArIHllYXI7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4geWVhci50b1N0cmluZygpO1xyXG5cdH1cclxuXHR2YXIgZm91bmREYXksIGNoZWNrZWREYXksIGRheVBhcnRSZWdFeHAgPSAvKFteZF18XikoZHxkZCkoW15kXXwkKS9nO1xyXG5cdGZ1bmN0aW9uIGhhc0RheSgpIHtcclxuXHRcdGlmIChmb3VuZERheSB8fCBjaGVja2VkRGF5KSB7XHJcblx0XHRcdHJldHVybiBmb3VuZERheTtcclxuXHRcdH1cclxuXHRcdGZvdW5kRGF5ID0gZGF5UGFydFJlZ0V4cC50ZXN0KGZvcm1hdCk7XHJcblx0XHRjaGVja2VkRGF5ID0gdHJ1ZTtcclxuXHRcdHJldHVybiBmb3VuZERheTtcclxuXHR9XHJcblx0dmFyIHF1b3RlQ291bnQgPSAwLFxyXG5cdFx0dG9rZW5SZWdFeHAgPSBEYXRlLl9nZXRUb2tlblJlZ0V4cCgpLFxyXG5cdFx0Y29udmVydGVkO1xyXG5cdGlmICghc29ydGFibGUgJiYgY29udmVydCkge1xyXG5cdFx0Y29udmVydGVkID0gY29udmVydC5mcm9tR3JlZ29yaWFuKHRoaXMpO1xyXG5cdH1cclxuXHRmb3IgKDs7KSB7XHJcblxyXG5cdFx0dmFyIGluZGV4ID0gdG9rZW5SZWdFeHAubGFzdEluZGV4O1xyXG5cclxuXHRcdHZhciBhciA9IHRva2VuUmVnRXhwLmV4ZWMoZm9ybWF0KTtcclxuXHJcblx0XHR2YXIgcHJlTWF0Y2ggPSBmb3JtYXQuc2xpY2UoaW5kZXgsIGFyID8gYXIuaW5kZXggOiBmb3JtYXQubGVuZ3RoKTtcclxuXHRcdHF1b3RlQ291bnQgKz0gRGF0ZS5fYXBwZW5kUHJlT3JQb3N0TWF0Y2gocHJlTWF0Y2gsIHJldCk7XHJcblxyXG5cdFx0aWYgKCFhcikgYnJlYWs7XHJcblxyXG5cdFx0aWYgKChxdW90ZUNvdW50JTIpID09PSAxKSB7XHJcblx0XHRcdHJldC5hcHBlbmQoYXJbMF0pO1xyXG5cdFx0XHRjb250aW51ZTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIGdldFBhcnQoZGF0ZSwgcGFydCkge1xyXG5cdFx0XHRpZiAoY29udmVydGVkKSB7XHJcblx0XHRcdFx0cmV0dXJuIGNvbnZlcnRlZFtwYXJ0XTtcclxuXHRcdFx0fVxyXG5cdFx0XHRzd2l0Y2ggKHBhcnQpIHtcclxuXHRcdFx0XHRjYXNlIDA6IHJldHVybiBkYXRlLmdldEZ1bGxZZWFyKCk7XHJcblx0XHRcdFx0Y2FzZSAxOiByZXR1cm4gZGF0ZS5nZXRNb250aCgpO1xyXG5cdFx0XHRcdGNhc2UgMjogcmV0dXJuIGRhdGUuZ2V0RGF0ZSgpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0c3dpdGNoIChhclswXSkge1xyXG5cdFx0Y2FzZSBcImRkZGRcIjpcclxuXHRcdFx0cmV0LmFwcGVuZChkdGYuRGF5TmFtZXNbdGhpcy5nZXREYXkoKV0pO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdGNhc2UgXCJkZGRcIjpcclxuXHRcdFx0cmV0LmFwcGVuZChkdGYuQWJicmV2aWF0ZWREYXlOYW1lc1t0aGlzLmdldERheSgpXSk7XHJcblx0XHRcdGJyZWFrO1xyXG5cdFx0Y2FzZSBcImRkXCI6XHJcblx0XHRcdGZvdW5kRGF5ID0gdHJ1ZTtcclxuXHRcdFx0cmV0LmFwcGVuZChhZGRMZWFkaW5nWmVybyhnZXRQYXJ0KHRoaXMsIDIpKSk7XHJcblx0XHRcdGJyZWFrO1xyXG5cdFx0Y2FzZSBcImRcIjpcclxuXHRcdFx0Zm91bmREYXkgPSB0cnVlO1xyXG5cdFx0XHRyZXQuYXBwZW5kKGdldFBhcnQodGhpcywgMikpO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdGNhc2UgXCJNTU1NXCI6XHJcblx0XHRcdHJldC5hcHBlbmQoKGR0Zi5Nb250aEdlbml0aXZlTmFtZXMgJiYgaGFzRGF5KCkpXHJcblx0XHRcdFx0PyBkdGYuTW9udGhHZW5pdGl2ZU5hbWVzW2dldFBhcnQodGhpcywgMSldXHJcblx0XHRcdFx0OiBkdGYuTW9udGhOYW1lc1tnZXRQYXJ0KHRoaXMsIDEpXSk7XHJcblx0XHRcdGJyZWFrO1xyXG5cdFx0Y2FzZSBcIk1NTVwiOlxyXG5cdFx0XHRyZXQuYXBwZW5kKChkdGYuQWJicmV2aWF0ZWRNb250aEdlbml0aXZlTmFtZXMgJiYgaGFzRGF5KCkpXHJcblx0XHRcdFx0PyBkdGYuQWJicmV2aWF0ZWRNb250aEdlbml0aXZlTmFtZXNbZ2V0UGFydCh0aGlzLCAxKV1cclxuXHRcdFx0XHQ6IGR0Zi5BYmJyZXZpYXRlZE1vbnRoTmFtZXNbZ2V0UGFydCh0aGlzLCAxKV0pO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdGNhc2UgXCJNTVwiOlxyXG5cdFx0XHRyZXQuYXBwZW5kKGFkZExlYWRpbmdaZXJvKGdldFBhcnQodGhpcywgMSkgKyAxKSk7XHJcblx0XHRcdGJyZWFrO1xyXG5cdFx0Y2FzZSBcIk1cIjpcclxuXHRcdFx0cmV0LmFwcGVuZChnZXRQYXJ0KHRoaXMsIDEpICsgMSk7XHJcblx0XHRcdGJyZWFrO1xyXG5cdFx0Y2FzZSBcInl5eXlcIjpcclxuXHRcdFx0cmV0LmFwcGVuZChwYWRZZWFyKGNvbnZlcnRlZCA/IGNvbnZlcnRlZFswXSA6IERhdGUuX2dldEVyYVllYXIodGhpcywgZHRmLCBEYXRlLl9nZXRFcmEodGhpcywgZXJhcyksIHNvcnRhYmxlKSkpO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdGNhc2UgXCJ5eVwiOlxyXG5cdFx0XHRyZXQuYXBwZW5kKGFkZExlYWRpbmdaZXJvKChjb252ZXJ0ZWQgPyBjb252ZXJ0ZWRbMF0gOiBEYXRlLl9nZXRFcmFZZWFyKHRoaXMsIGR0ZiwgRGF0ZS5fZ2V0RXJhKHRoaXMsIGVyYXMpLCBzb3J0YWJsZSkpICUgMTAwKSk7XHJcblx0XHRcdGJyZWFrO1xyXG5cdFx0Y2FzZSBcInlcIjpcclxuXHRcdFx0cmV0LmFwcGVuZCgoY29udmVydGVkID8gY29udmVydGVkWzBdIDogRGF0ZS5fZ2V0RXJhWWVhcih0aGlzLCBkdGYsIERhdGUuX2dldEVyYSh0aGlzLCBlcmFzKSwgc29ydGFibGUpKSAlIDEwMCk7XHJcblx0XHRcdGJyZWFrO1xyXG5cdFx0Y2FzZSBcImhoXCI6XHJcblx0XHRcdGhvdXIgPSB0aGlzLmdldEhvdXJzKCkgJSAxMjtcclxuXHRcdFx0aWYgKGhvdXIgPT09IDApIGhvdXIgPSAxMjtcclxuXHRcdFx0cmV0LmFwcGVuZChhZGRMZWFkaW5nWmVybyhob3VyKSk7XHJcblx0XHRcdGJyZWFrO1xyXG5cdFx0Y2FzZSBcImhcIjpcclxuXHRcdFx0aG91ciA9IHRoaXMuZ2V0SG91cnMoKSAlIDEyO1xyXG5cdFx0XHRpZiAoaG91ciA9PT0gMCkgaG91ciA9IDEyO1xyXG5cdFx0XHRyZXQuYXBwZW5kKGhvdXIpO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdGNhc2UgXCJISFwiOlxyXG5cdFx0XHRyZXQuYXBwZW5kKGFkZExlYWRpbmdaZXJvKHRoaXMuZ2V0SG91cnMoKSkpO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdGNhc2UgXCJIXCI6XHJcblx0XHRcdHJldC5hcHBlbmQodGhpcy5nZXRIb3VycygpKTtcclxuXHRcdFx0YnJlYWs7XHJcblx0XHRjYXNlIFwibW1cIjpcclxuXHRcdFx0cmV0LmFwcGVuZChhZGRMZWFkaW5nWmVybyh0aGlzLmdldE1pbnV0ZXMoKSkpO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdGNhc2UgXCJtXCI6XHJcblx0XHRcdHJldC5hcHBlbmQodGhpcy5nZXRNaW51dGVzKCkpO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdGNhc2UgXCJzc1wiOlxyXG5cdFx0XHRyZXQuYXBwZW5kKGFkZExlYWRpbmdaZXJvKHRoaXMuZ2V0U2Vjb25kcygpKSk7XHJcblx0XHRcdGJyZWFrO1xyXG5cdFx0Y2FzZSBcInNcIjpcclxuXHRcdFx0cmV0LmFwcGVuZCh0aGlzLmdldFNlY29uZHMoKSk7XHJcblx0XHRcdGJyZWFrO1xyXG5cdFx0Y2FzZSBcInR0XCI6XHJcblx0XHRcdHJldC5hcHBlbmQoKHRoaXMuZ2V0SG91cnMoKSA8IDEyKSA/IGR0Zi5BTURlc2lnbmF0b3IgOiBkdGYuUE1EZXNpZ25hdG9yKTtcclxuXHRcdFx0YnJlYWs7XHJcblx0XHRjYXNlIFwidFwiOlxyXG5cdFx0XHRyZXQuYXBwZW5kKCgodGhpcy5nZXRIb3VycygpIDwgMTIpID8gZHRmLkFNRGVzaWduYXRvciA6IGR0Zi5QTURlc2lnbmF0b3IpLmNoYXJBdCgwKSk7XHJcblx0XHRcdGJyZWFrO1xyXG5cdFx0Y2FzZSBcImZcIjpcclxuXHRcdFx0cmV0LmFwcGVuZChhZGRMZWFkaW5nWmVyb3ModGhpcy5nZXRNaWxsaXNlY29uZHMoKSkuY2hhckF0KDApKTtcclxuXHRcdFx0YnJlYWs7XHJcblx0XHRjYXNlIFwiZmZcIjpcclxuXHRcdFx0cmV0LmFwcGVuZChhZGRMZWFkaW5nWmVyb3ModGhpcy5nZXRNaWxsaXNlY29uZHMoKSkuc3Vic3RyKDAsIDIpKTtcclxuXHRcdFx0YnJlYWs7XHJcblx0XHRjYXNlIFwiZmZmXCI6XHJcblx0XHRcdHJldC5hcHBlbmQoYWRkTGVhZGluZ1plcm9zKHRoaXMuZ2V0TWlsbGlzZWNvbmRzKCkpKTtcclxuXHRcdFx0YnJlYWs7XHJcblx0XHRjYXNlIFwielwiOlxyXG5cdFx0XHRob3VyID0gdGhpcy5nZXRUaW1lem9uZU9mZnNldCgpIC8gNjA7XHJcblx0XHRcdHJldC5hcHBlbmQoKChob3VyIDw9IDApID8gJysnIDogJy0nKSArIE1hdGguZmxvb3IoTWF0aC5hYnMoaG91cikpKTtcclxuXHRcdFx0YnJlYWs7XHJcblx0XHRjYXNlIFwienpcIjpcclxuXHRcdFx0aG91ciA9IHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSAvIDYwO1xyXG5cdFx0XHRyZXQuYXBwZW5kKCgoaG91ciA8PSAwKSA/ICcrJyA6ICctJykgKyBhZGRMZWFkaW5nWmVybyhNYXRoLmZsb29yKE1hdGguYWJzKGhvdXIpKSkpO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdGNhc2UgXCJ6enpcIjpcclxuXHRcdFx0aG91ciA9IHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSAvIDYwO1xyXG5cdFx0XHRyZXQuYXBwZW5kKCgoaG91ciA8PSAwKSA/ICcrJyA6ICctJykgKyBhZGRMZWFkaW5nWmVybyhNYXRoLmZsb29yKE1hdGguYWJzKGhvdXIpKSkgK1xyXG5cdFx0XHRcdFwiOlwiICsgYWRkTGVhZGluZ1plcm8oTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpICUgNjApKSk7XHJcblx0XHRcdGJyZWFrO1xyXG5cdFx0Y2FzZSBcImdcIjpcclxuXHRcdGNhc2UgXCJnZ1wiOlxyXG5cdFx0XHRpZiAoZHRmLmVyYXMpIHtcclxuXHRcdFx0XHRyZXQuYXBwZW5kKGR0Zi5lcmFzW0RhdGUuX2dldEVyYSh0aGlzLCBlcmFzKSArIDFdKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRicmVhaztcclxuXHRcdGNhc2UgXCIvXCI6XHJcblx0XHRcdHJldC5hcHBlbmQoZHRmLkRhdGVTZXBhcmF0b3IpO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdH1cclxuXHR9XHJcblx0cmV0dXJuIHJldC50b1N0cmluZygpO1xyXG59XHJcblN0cmluZy5sb2NhbGVGb3JtYXQgPSBmdW5jdGlvbiBTdHJpbmckbG9jYWxlRm9ybWF0KGZvcm1hdCwgYXJncykge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTdHJpbmcubG9jYWxlRm9ybWF0XCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJmb3JtYXRcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJhcmdzXCIgcGFyYW1ldGVyQXJyYXk9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJTdHJpbmdcIj48L3JldHVybnM+XHJcblxyXG5cdHJldHVybiBTdHJpbmcuX3RvRm9ybWF0dGVkU3RyaW5nKHRydWUsIGFyZ3VtZW50cyk7XHJcbn1cclxuTnVtYmVyLnBhcnNlTG9jYWxlID0gZnVuY3Rpb24gTnVtYmVyJHBhcnNlTG9jYWxlKHZhbHVlKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI051bWJlci5wYXJzZUxvY2FsZVwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwidmFsdWVcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIk51bWJlclwiPjwvcmV0dXJucz5cclxuXHJcblx0cmV0dXJuIE51bWJlci5fcGFyc2UodmFsdWUsIFN5cy5DdWx0dXJlSW5mby5DdXJyZW50Q3VsdHVyZSk7XHJcbn1cclxuTnVtYmVyLnBhcnNlSW52YXJpYW50ID0gZnVuY3Rpb24gTnVtYmVyJHBhcnNlSW52YXJpYW50KHZhbHVlKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI051bWJlci5wYXJzZUludmFyaWFudFwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwidmFsdWVcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIk51bWJlclwiPjwvcmV0dXJucz5cclxuXHJcblx0cmV0dXJuIE51bWJlci5fcGFyc2UodmFsdWUsIFN5cy5DdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlKTtcclxufVxyXG5OdW1iZXIuX3BhcnNlID0gZnVuY3Rpb24gTnVtYmVyJF9wYXJzZSh2YWx1ZSwgY3VsdHVyZUluZm8pIHtcclxuXHR2YWx1ZSA9IHZhbHVlLnRyaW0oKTtcclxuXHRpZiAodmFsdWUubWF0Y2goL15bKy1dP2luZmluaXR5JC9pKSkge1xyXG5cdFx0cmV0dXJuIHBhcnNlRmxvYXQodmFsdWUpO1xyXG5cdH1cclxuXHRpZiAodmFsdWUubWF0Y2goL14weFthLWYwLTldKyQvaSkpIHtcclxuXHRcdHJldHVybiBwYXJzZUludCh2YWx1ZSk7XHJcblx0fVxyXG5cclxuXHR2YXIgbnVtRm9ybWF0ID0gY3VsdHVyZUluZm8ubnVtYmVyRm9ybWF0O1xyXG5cdHZhciBzaWduSW5mbyA9IE51bWJlci5fcGFyc2VOdW1iZXJOZWdhdGl2ZVBhdHRlcm4odmFsdWUsIG51bUZvcm1hdCwgbnVtRm9ybWF0Lk51bWJlck5lZ2F0aXZlUGF0dGVybik7XHJcblx0dmFyIHNpZ24gPSBzaWduSW5mb1swXTtcclxuXHR2YXIgbnVtID0gc2lnbkluZm9bMV07XHJcblx0aWYgKChzaWduID09PSAnJykgJiYgKG51bUZvcm1hdC5OdW1iZXJOZWdhdGl2ZVBhdHRlcm4gIT09IDEpKSB7XHJcblx0XHRzaWduSW5mbyA9IE51bWJlci5fcGFyc2VOdW1iZXJOZWdhdGl2ZVBhdHRlcm4odmFsdWUsIG51bUZvcm1hdCwgMSk7XHJcblx0XHRzaWduID0gc2lnbkluZm9bMF07XHJcblx0XHRudW0gPSBzaWduSW5mb1sxXTtcclxuXHR9XHJcblx0aWYgKHNpZ24gPT09ICcnKSBzaWduID0gJysnO1xyXG5cdHZhciBleHBvbmVudDtcclxuXHR2YXIgaW50QW5kRnJhY3Rpb247XHJcblx0dmFyIGV4cG9uZW50UG9zID0gbnVtLmluZGV4T2YoJ2UnKTtcclxuXHRpZiAoZXhwb25lbnRQb3MgPCAwKSBleHBvbmVudFBvcyA9IG51bS5pbmRleE9mKCdFJyk7XHJcblx0aWYgKGV4cG9uZW50UG9zIDwgMCkge1xyXG5cdFx0aW50QW5kRnJhY3Rpb24gPSBudW07XHJcblx0XHRleHBvbmVudCA9IG51bGw7XHJcblx0fVxyXG5cdGVsc2Uge1xyXG5cdFx0aW50QW5kRnJhY3Rpb24gPSBudW0uc3Vic3RyKDAsIGV4cG9uZW50UG9zKTtcclxuXHRcdGV4cG9uZW50ID0gbnVtLnN1YnN0cihleHBvbmVudFBvcyArIDEpO1xyXG5cdH1cclxuXHR2YXIgaW50ZWdlcjtcclxuXHR2YXIgZnJhY3Rpb247XHJcblx0dmFyIGRlY2ltYWxQb3MgPSBpbnRBbmRGcmFjdGlvbi5pbmRleE9mKG51bUZvcm1hdC5OdW1iZXJEZWNpbWFsU2VwYXJhdG9yKTtcclxuXHRpZiAoZGVjaW1hbFBvcyA8IDApIHtcclxuXHRcdGludGVnZXIgPSBpbnRBbmRGcmFjdGlvbjtcclxuXHRcdGZyYWN0aW9uID0gbnVsbDtcclxuXHR9XHJcblx0ZWxzZSB7XHJcblx0XHRpbnRlZ2VyID0gaW50QW5kRnJhY3Rpb24uc3Vic3RyKDAsIGRlY2ltYWxQb3MpO1xyXG5cdFx0ZnJhY3Rpb24gPSBpbnRBbmRGcmFjdGlvbi5zdWJzdHIoZGVjaW1hbFBvcyArIG51bUZvcm1hdC5OdW1iZXJEZWNpbWFsU2VwYXJhdG9yLmxlbmd0aCk7XHJcblx0fVxyXG5cdGludGVnZXIgPSBpbnRlZ2VyLnNwbGl0KG51bUZvcm1hdC5OdW1iZXJHcm91cFNlcGFyYXRvcikuam9pbignJyk7XHJcblx0dmFyIGFsdE51bUdyb3VwU2VwYXJhdG9yID0gbnVtRm9ybWF0Lk51bWJlckdyb3VwU2VwYXJhdG9yLnJlcGxhY2UoL1xcdTAwQTAvZywgXCIgXCIpO1xyXG5cdGlmIChudW1Gb3JtYXQuTnVtYmVyR3JvdXBTZXBhcmF0b3IgIT09IGFsdE51bUdyb3VwU2VwYXJhdG9yKSB7XHJcblx0XHRpbnRlZ2VyID0gaW50ZWdlci5zcGxpdChhbHROdW1Hcm91cFNlcGFyYXRvcikuam9pbignJyk7XHJcblx0fVxyXG5cdHZhciBwID0gc2lnbiArIGludGVnZXI7XHJcblx0aWYgKGZyYWN0aW9uICE9PSBudWxsKSB7XHJcblx0XHRwICs9ICcuJyArIGZyYWN0aW9uO1xyXG5cdH1cclxuXHRpZiAoZXhwb25lbnQgIT09IG51bGwpIHtcclxuXHRcdHZhciBleHBTaWduSW5mbyA9IE51bWJlci5fcGFyc2VOdW1iZXJOZWdhdGl2ZVBhdHRlcm4oZXhwb25lbnQsIG51bUZvcm1hdCwgMSk7XHJcblx0XHRpZiAoZXhwU2lnbkluZm9bMF0gPT09ICcnKSB7XHJcblx0XHRcdGV4cFNpZ25JbmZvWzBdID0gJysnO1xyXG5cdFx0fVxyXG5cdFx0cCArPSAnZScgKyBleHBTaWduSW5mb1swXSArIGV4cFNpZ25JbmZvWzFdO1xyXG5cdH1cclxuXHJcblx0aWYgKHAubWF0Y2goL15bKy1dP1xcZCpcXC4/XFxkKihlWystXT9cXGQrKT8kLykpIHtcclxuXHRcdHJldHVybiBwYXJzZUZsb2F0KHApO1xyXG5cdH1cclxuXHRyZXR1cm4gTnVtYmVyLk5hTjtcclxufVxyXG5OdW1iZXIuX3BhcnNlTnVtYmVyTmVnYXRpdmVQYXR0ZXJuID0gZnVuY3Rpb24gTnVtYmVyJF9wYXJzZU51bWJlck5lZ2F0aXZlUGF0dGVybih2YWx1ZSwgbnVtRm9ybWF0LCBudW1iZXJOZWdhdGl2ZVBhdHRlcm4pIHtcclxuXHR2YXIgbmVnID0gbnVtRm9ybWF0Lk5lZ2F0aXZlU2lnbjtcclxuXHR2YXIgcG9zID0gbnVtRm9ybWF0LlBvc2l0aXZlU2lnbjtcclxuXHRzd2l0Y2ggKG51bWJlck5lZ2F0aXZlUGF0dGVybikge1xyXG5cdFx0Y2FzZSA0OlxyXG5cdFx0XHRuZWcgPSAnICcgKyBuZWc7XHJcblx0XHRcdHBvcyA9ICcgJyArIHBvcztcclxuXHRcdGNhc2UgMzpcclxuXHRcdFx0aWYgKHZhbHVlLmVuZHNXaXRoKG5lZykpIHtcclxuXHRcdFx0XHRyZXR1cm4gWyctJywgdmFsdWUuc3Vic3RyKDAsIHZhbHVlLmxlbmd0aCAtIG5lZy5sZW5ndGgpXTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh2YWx1ZS5lbmRzV2l0aChwb3MpKSB7XHJcblx0XHRcdFx0cmV0dXJuIFsnKycsIHZhbHVlLnN1YnN0cigwLCB2YWx1ZS5sZW5ndGggLSBwb3MubGVuZ3RoKV07XHJcblx0XHRcdH1cclxuXHRcdFx0YnJlYWs7XHJcblx0XHRjYXNlIDI6XHJcblx0XHRcdG5lZyArPSAnICc7XHJcblx0XHRcdHBvcyArPSAnICc7XHJcblx0XHRjYXNlIDE6XHJcblx0XHRcdGlmICh2YWx1ZS5zdGFydHNXaXRoKG5lZykpIHtcclxuXHRcdFx0XHRyZXR1cm4gWyctJywgdmFsdWUuc3Vic3RyKG5lZy5sZW5ndGgpXTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh2YWx1ZS5zdGFydHNXaXRoKHBvcykpIHtcclxuXHRcdFx0XHRyZXR1cm4gWycrJywgdmFsdWUuc3Vic3RyKHBvcy5sZW5ndGgpXTtcclxuXHRcdFx0fVxyXG5cdFx0XHRicmVhaztcclxuXHRcdGNhc2UgMDpcclxuXHRcdFx0aWYgKHZhbHVlLnN0YXJ0c1dpdGgoJygnKSAmJiB2YWx1ZS5lbmRzV2l0aCgnKScpKSB7XHJcblx0XHRcdFx0cmV0dXJuIFsnLScsIHZhbHVlLnN1YnN0cigxLCB2YWx1ZS5sZW5ndGggLSAyKV07XHJcblx0XHRcdH1cclxuXHRcdFx0YnJlYWs7XHJcblx0fVxyXG5cdHJldHVybiBbJycsIHZhbHVlXTtcclxufVxyXG5cclxuTnVtYmVyLnByb3RvdHlwZS5mb3JtYXQgPSBmdW5jdGlvbiBOdW1iZXIkZm9ybWF0KGZvcm1hdCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNOdW1iZXIuZm9ybWF0XCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJmb3JtYXRcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIlN0cmluZ1wiPjwvcmV0dXJucz5cclxuXHJcblx0cmV0dXJuIHRoaXMuX3RvRm9ybWF0dGVkU3RyaW5nKGZvcm1hdCwgU3lzLkN1bHR1cmVJbmZvLkludmFyaWFudEN1bHR1cmUpO1xyXG59XHJcbk51bWJlci5wcm90b3R5cGUubG9jYWxlRm9ybWF0ID0gZnVuY3Rpb24gTnVtYmVyJGxvY2FsZUZvcm1hdChmb3JtYXQpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojTnVtYmVyLmxvY2FsZUZvcm1hdFwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZm9ybWF0XCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJTdHJpbmdcIj48L3JldHVybnM+XHJcblxyXG5cdHJldHVybiB0aGlzLl90b0Zvcm1hdHRlZFN0cmluZyhmb3JtYXQsIFN5cy5DdWx0dXJlSW5mby5DdXJyZW50Q3VsdHVyZSk7XHJcbn1cclxuTnVtYmVyLnByb3RvdHlwZS5fdG9Gb3JtYXR0ZWRTdHJpbmcgPSBmdW5jdGlvbiBOdW1iZXIkX3RvRm9ybWF0dGVkU3RyaW5nKGZvcm1hdCwgY3VsdHVyZUluZm8pIHtcclxuXHRpZiAoIWZvcm1hdCB8fCAoZm9ybWF0Lmxlbmd0aCA9PT0gMCkgfHwgKGZvcm1hdCA9PT0gJ2knKSkge1xyXG5cdFx0aWYgKGN1bHR1cmVJbmZvICYmIChjdWx0dXJlSW5mby5uYW1lLmxlbmd0aCA+IDApKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLnRvTG9jYWxlU3RyaW5nKCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMudG9TdHJpbmcoKTtcclxuXHRcdH1cclxuXHR9XHJcblx0dmFyIF9wZXJjZW50UG9zaXRpdmVQYXR0ZXJuID0gW1wibiAlXCIsIFwibiVcIiwgXCIlblwiIF07XHJcblx0dmFyIF9wZXJjZW50TmVnYXRpdmVQYXR0ZXJuID0gW1wiLW4gJVwiLCBcIi1uJVwiLCBcIi0lblwiXTtcclxuXHR2YXIgX251bWJlck5lZ2F0aXZlUGF0dGVybiA9IFtcIihuKVwiLFwiLW5cIixcIi0gblwiLFwibi1cIixcIm4gLVwiXTtcclxuXHR2YXIgX2N1cnJlbmN5UG9zaXRpdmVQYXR0ZXJuID0gW1wiJG5cIixcIm4kXCIsXCIkIG5cIixcIm4gJFwiXTtcclxuXHR2YXIgX2N1cnJlbmN5TmVnYXRpdmVQYXR0ZXJuID0gW1wiKCRuKVwiLFwiLSRuXCIsXCIkLW5cIixcIiRuLVwiLFwiKG4kKVwiLFwiLW4kXCIsXCJuLSRcIixcIm4kLVwiLFwiLW4gJFwiLFwiLSQgblwiLFwibiAkLVwiLFwiJCBuLVwiLFwiJCAtblwiLFwibi0gJFwiLFwiKCQgbilcIixcIihuICQpXCJdO1xyXG5cclxuXHRmdW5jdGlvbiB6ZXJvUGFkKHN0ciwgY291bnQsIGxlZnQpIHtcclxuXHRcdGZvciAodmFyIGw9c3RyLmxlbmd0aDsgbCA8IGNvdW50OyBsKyspIHtcclxuXHRcdFx0c3RyID0gKGxlZnQgPyAoJzAnICsgc3RyKSA6IChzdHIgKyAnMCcpKTtcclxuXHRcdH1cclxuXHRcdHJldHVybiBzdHI7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIGV4cGFuZE51bWJlcihudW1iZXIsIHByZWNpc2lvbiwgZ3JvdXBTaXplcywgc2VwLCBkZWNpbWFsQ2hhcikge1xyXG5cdFx0dmFyIGN1clNpemUgPSBncm91cFNpemVzWzBdO1xyXG5cdFx0dmFyIGN1ckdyb3VwSW5kZXggPSAxO1xyXG5cclxuXHJcblxyXG5cdFx0dmFyIGZhY3RvciA9IE1hdGgucG93KDEwLCBwcmVjaXNpb24pO1xyXG5cdFx0dmFyIHJvdW5kZWQgPSAoTWF0aC5yb3VuZChudW1iZXIgKiBmYWN0b3IpIC8gZmFjdG9yKTtcclxuXHRcdGlmICghaXNGaW5pdGUocm91bmRlZCkpIHtcclxuXHRcdFx0cm91bmRlZCA9IG51bWJlcjtcclxuXHRcdH1cclxuXHRcdG51bWJlciA9IHJvdW5kZWQ7XHJcblx0XHR2YXIgbnVtYmVyU3RyaW5nID0gbnVtYmVyLnRvU3RyaW5nKCk7XHJcblx0XHR2YXIgcmlnaHQgPSBcIlwiO1xyXG5cdFx0dmFyIGV4cG9uZW50O1xyXG5cdFx0dmFyIHNwbGl0ID0gbnVtYmVyU3RyaW5nLnNwbGl0KC9lL2kpO1xyXG5cdFx0bnVtYmVyU3RyaW5nID0gc3BsaXRbMF07XHJcblx0XHRleHBvbmVudCA9IChzcGxpdC5sZW5ndGggPiAxID8gcGFyc2VJbnQoc3BsaXRbMV0pIDogMCk7XHJcblx0XHRzcGxpdCA9IG51bWJlclN0cmluZy5zcGxpdCgnLicpO1xyXG5cdFx0bnVtYmVyU3RyaW5nID0gc3BsaXRbMF07XHJcblx0XHRyaWdodCA9IHNwbGl0Lmxlbmd0aCA+IDEgPyBzcGxpdFsxXSA6IFwiXCI7XHJcblx0XHR2YXIgbDtcclxuXHRcdGlmIChleHBvbmVudCA+IDApIHtcclxuXHRcdFx0cmlnaHQgPSB6ZXJvUGFkKHJpZ2h0LCBleHBvbmVudCwgZmFsc2UpO1xyXG5cdFx0XHRudW1iZXJTdHJpbmcgKz0gcmlnaHQuc2xpY2UoMCwgZXhwb25lbnQpO1xyXG5cdFx0XHRyaWdodCA9IHJpZ2h0LnN1YnN0cihleHBvbmVudCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChleHBvbmVudCA8IDApIHtcclxuXHRcdFx0ZXhwb25lbnQgPSAtZXhwb25lbnQ7XHJcblx0XHRcdG51bWJlclN0cmluZyA9IHplcm9QYWQobnVtYmVyU3RyaW5nLCBleHBvbmVudCsxLCB0cnVlKTtcclxuXHRcdFx0cmlnaHQgPSBudW1iZXJTdHJpbmcuc2xpY2UoLWV4cG9uZW50LCBudW1iZXJTdHJpbmcubGVuZ3RoKSArIHJpZ2h0O1xyXG5cdFx0XHRudW1iZXJTdHJpbmcgPSBudW1iZXJTdHJpbmcuc2xpY2UoMCwgLWV4cG9uZW50KTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAocHJlY2lzaW9uID4gMCkge1xyXG5cdFx0XHRpZiAocmlnaHQubGVuZ3RoID4gcHJlY2lzaW9uKSB7XHJcblx0XHRcdFx0cmlnaHQgPSByaWdodC5zbGljZSgwLCBwcmVjaXNpb24pO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHJpZ2h0ID0gemVyb1BhZChyaWdodCwgcHJlY2lzaW9uLCBmYWxzZSk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmlnaHQgPSBkZWNpbWFsQ2hhciArIHJpZ2h0O1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHJpZ2h0ID0gXCJcIjtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgc3RyaW5nSW5kZXggPSBudW1iZXJTdHJpbmcubGVuZ3RoLTE7XHJcblx0XHR2YXIgcmV0ID0gXCJcIjtcclxuXHRcdHdoaWxlIChzdHJpbmdJbmRleCA+PSAwKSB7XHJcblxyXG5cdFx0XHRpZiAoY3VyU2l6ZSA9PT0gMCB8fCBjdXJTaXplID4gc3RyaW5nSW5kZXgpIHtcclxuXHRcdFx0XHRpZiAocmV0Lmxlbmd0aCA+IDApXHJcblx0XHRcdFx0XHRyZXR1cm4gbnVtYmVyU3RyaW5nLnNsaWNlKDAsIHN0cmluZ0luZGV4ICsgMSkgKyBzZXAgKyByZXQgKyByaWdodDtcclxuXHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0XHRyZXR1cm4gbnVtYmVyU3RyaW5nLnNsaWNlKDAsIHN0cmluZ0luZGV4ICsgMSkgKyByaWdodDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKHJldC5sZW5ndGggPiAwKVxyXG5cdFx0XHRcdHJldCA9IG51bWJlclN0cmluZy5zbGljZShzdHJpbmdJbmRleCAtIGN1clNpemUgKyAxLCBzdHJpbmdJbmRleCsxKSArIHNlcCArIHJldDtcclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdHJldCA9IG51bWJlclN0cmluZy5zbGljZShzdHJpbmdJbmRleCAtIGN1clNpemUgKyAxLCBzdHJpbmdJbmRleCsxKTtcclxuXHJcblx0XHRcdHN0cmluZ0luZGV4IC09IGN1clNpemU7XHJcblxyXG5cdFx0XHRpZiAoY3VyR3JvdXBJbmRleCA8IGdyb3VwU2l6ZXMubGVuZ3RoKSB7XHJcblx0XHRcdFx0Y3VyU2l6ZSA9IGdyb3VwU2l6ZXNbY3VyR3JvdXBJbmRleF07XHJcblx0XHRcdFx0Y3VyR3JvdXBJbmRleCsrO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gbnVtYmVyU3RyaW5nLnNsaWNlKDAsIHN0cmluZ0luZGV4ICsgMSkgKyBzZXAgKyByZXQgKyByaWdodDtcclxuXHR9XHJcblx0dmFyIG5mID0gY3VsdHVyZUluZm8ubnVtYmVyRm9ybWF0O1xyXG5cclxuXHR2YXIgbnVtYmVyID0gTWF0aC5hYnModGhpcyk7XHJcblxyXG5cdGlmICghZm9ybWF0KVxyXG5cdFx0Zm9ybWF0ID0gXCJEXCI7XHJcblxyXG5cdHZhciBwcmVjaXNpb24gPSAtMTtcclxuXHRpZiAoZm9ybWF0Lmxlbmd0aCA+IDEpIHByZWNpc2lvbiA9IHBhcnNlSW50KGZvcm1hdC5zbGljZSgxKSwgMTApO1xyXG5cclxuXHR2YXIgcGF0dGVybjtcclxuXHRzd2l0Y2ggKGZvcm1hdC5jaGFyQXQoMCkpIHtcclxuXHRjYXNlIFwiZFwiOlxyXG5cdGNhc2UgXCJEXCI6XHJcblx0XHRwYXR0ZXJuID0gJ24nO1xyXG5cclxuXHRcdGlmIChwcmVjaXNpb24gIT09IC0xKSB7XHJcblx0XHRcdG51bWJlciA9IHplcm9QYWQoXCJcIitudW1iZXIsIHByZWNpc2lvbiwgdHJ1ZSk7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHRoaXMgPCAwKSBudW1iZXIgPSAtbnVtYmVyO1xyXG5cdFx0YnJlYWs7XHJcblx0Y2FzZSBcImNcIjpcclxuXHRjYXNlIFwiQ1wiOlxyXG5cdFx0aWYgKHRoaXMgPCAwKSBwYXR0ZXJuID0gX2N1cnJlbmN5TmVnYXRpdmVQYXR0ZXJuW25mLkN1cnJlbmN5TmVnYXRpdmVQYXR0ZXJuXTtcclxuXHRcdGVsc2UgcGF0dGVybiA9IF9jdXJyZW5jeVBvc2l0aXZlUGF0dGVybltuZi5DdXJyZW5jeVBvc2l0aXZlUGF0dGVybl07XHJcblx0XHRpZiAocHJlY2lzaW9uID09PSAtMSkgcHJlY2lzaW9uID0gbmYuQ3VycmVuY3lEZWNpbWFsRGlnaXRzO1xyXG5cdFx0bnVtYmVyID0gZXhwYW5kTnVtYmVyKE1hdGguYWJzKHRoaXMpLCBwcmVjaXNpb24sIG5mLkN1cnJlbmN5R3JvdXBTaXplcywgbmYuQ3VycmVuY3lHcm91cFNlcGFyYXRvciwgbmYuQ3VycmVuY3lEZWNpbWFsU2VwYXJhdG9yKTtcclxuXHRcdGJyZWFrO1xyXG5cdGNhc2UgXCJuXCI6XHJcblx0Y2FzZSBcIk5cIjpcclxuXHRcdGlmICh0aGlzIDwgMCkgcGF0dGVybiA9IF9udW1iZXJOZWdhdGl2ZVBhdHRlcm5bbmYuTnVtYmVyTmVnYXRpdmVQYXR0ZXJuXTtcclxuXHRcdGVsc2UgcGF0dGVybiA9ICduJztcclxuXHRcdGlmIChwcmVjaXNpb24gPT09IC0xKSBwcmVjaXNpb24gPSBuZi5OdW1iZXJEZWNpbWFsRGlnaXRzO1xyXG5cdFx0bnVtYmVyID0gZXhwYW5kTnVtYmVyKE1hdGguYWJzKHRoaXMpLCBwcmVjaXNpb24sIG5mLk51bWJlckdyb3VwU2l6ZXMsIG5mLk51bWJlckdyb3VwU2VwYXJhdG9yLCBuZi5OdW1iZXJEZWNpbWFsU2VwYXJhdG9yKTtcclxuXHRcdGJyZWFrO1xyXG5cdGNhc2UgXCJwXCI6XHJcblx0Y2FzZSBcIlBcIjpcclxuXHRcdGlmICh0aGlzIDwgMCkgcGF0dGVybiA9IF9wZXJjZW50TmVnYXRpdmVQYXR0ZXJuW25mLlBlcmNlbnROZWdhdGl2ZVBhdHRlcm5dO1xyXG5cdFx0ZWxzZSBwYXR0ZXJuID0gX3BlcmNlbnRQb3NpdGl2ZVBhdHRlcm5bbmYuUGVyY2VudFBvc2l0aXZlUGF0dGVybl07XHJcblx0XHRpZiAocHJlY2lzaW9uID09PSAtMSkgcHJlY2lzaW9uID0gbmYuUGVyY2VudERlY2ltYWxEaWdpdHM7XHJcblx0XHRudW1iZXIgPSBleHBhbmROdW1iZXIoTWF0aC5hYnModGhpcykgKiAxMDAsIHByZWNpc2lvbiwgbmYuUGVyY2VudEdyb3VwU2l6ZXMsIG5mLlBlcmNlbnRHcm91cFNlcGFyYXRvciwgbmYuUGVyY2VudERlY2ltYWxTZXBhcmF0b3IpO1xyXG5cdFx0YnJlYWs7XHJcblx0ZGVmYXVsdDpcclxuXHRcdHRocm93IEVycm9yLmZvcm1hdChTeXMuUmVzLmZvcm1hdEJhZEZvcm1hdFNwZWNpZmllcik7XHJcblx0fVxyXG5cclxuXHR2YXIgcmVnZXggPSAvbnxcXCR8LXwlL2c7XHJcblxyXG5cdHZhciByZXQgPSBcIlwiO1xyXG5cclxuXHRmb3IgKDs7KSB7XHJcblxyXG5cdFx0dmFyIGluZGV4ID0gcmVnZXgubGFzdEluZGV4O1xyXG5cclxuXHRcdHZhciBhciA9IHJlZ2V4LmV4ZWMocGF0dGVybik7XHJcblxyXG5cdFx0cmV0ICs9IHBhdHRlcm4uc2xpY2UoaW5kZXgsIGFyID8gYXIuaW5kZXggOiBwYXR0ZXJuLmxlbmd0aCk7XHJcblxyXG5cdFx0aWYgKCFhcilcclxuXHRcdFx0YnJlYWs7XHJcblxyXG5cdFx0c3dpdGNoIChhclswXSkge1xyXG5cdFx0Y2FzZSBcIm5cIjpcclxuXHRcdFx0cmV0ICs9IG51bWJlcjtcclxuXHRcdFx0YnJlYWs7XHJcblx0XHRjYXNlIFwiJFwiOlxyXG5cdFx0XHRyZXQgKz0gbmYuQ3VycmVuY3lTeW1ib2w7XHJcblx0XHRcdGJyZWFrO1xyXG5cdFx0Y2FzZSBcIi1cIjpcclxuXHRcdFx0aWYgKC9bMS05XS8udGVzdChudW1iZXIpKSB7XHJcblx0XHRcdFx0cmV0ICs9IG5mLk5lZ2F0aXZlU2lnbjtcclxuXHRcdFx0fVxyXG5cdFx0XHRicmVhaztcclxuXHRcdGNhc2UgXCIlXCI6XHJcblx0XHRcdHJldCArPSBuZi5QZXJjZW50U3ltYm9sO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHJldHVybiByZXQ7XHJcbn1cclxuZnVuY3Rpb24gdG9VcHBlcih2YWx1ZSkge1xyXG5cdHJldHVybiB2YWx1ZS5zcGxpdChcIlxcdTAwQTBcIikuam9pbignICcpLnRvVXBwZXJDYXNlKCk7XHJcbn1cclxuZnVuY3Rpb24gdG9VcHBlckFycmF5KGFycikge1xyXG5cdHZhciByZXN1bHQgPSBbXTtcclxuXHRmb3JlYWNoKGFyciwgZnVuY3Rpb24odmFsdWUsIGkpIHtcclxuXHRcdHJlc3VsdFtpXSA9IHRvVXBwZXIodmFsdWUpO1xyXG5cdH0pO1xyXG5cdHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsb25lKG9iaikge1xyXG5cdHZhciBvYmpOZXcgPSB7fTtcclxuXHRmb3JJbihvYmosIGZ1bmN0aW9uKHZhbHVlLCBmaWVsZCkge1xyXG5cdFx0b2JqTmV3W2ZpZWxkXSA9ICh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5KSA/ICh2YWx1ZS5sZW5ndGggPT09IDEgPyBbdmFsdWVdIDogQXJyYXkuYXBwbHkobnVsbCwgdmFsdWUpKSA6XHJcblx0XHRcdCgodHlwZW9mKHZhbHVlKSA9PT0gXCJvYmplY3RcIikgPyBjbG9uZSh2YWx1ZSkgOiB2YWx1ZSk7XHJcblx0fSk7XHJcblx0cmV0dXJuIG9iak5ldztcclxufVxyXG5cclxuU3lzLkN1bHR1cmVJbmZvID0gZnVuY3Rpb24gU3lzJEN1bHR1cmVJbmZvKG5hbWUsIG51bWJlckZvcm1hdCwgZGF0ZVRpbWVGb3JtYXQpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLkN1bHR1cmVJbmZvLiNjdG9yXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJuYW1lXCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwibnVtYmVyRm9ybWF0XCIgdHlwZT1cIk9iamVjdFwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZGF0ZVRpbWVGb3JtYXRcIiB0eXBlPVwiT2JqZWN0XCI+PC9wYXJhbT5cclxuXHJcblx0dGhpcy5uYW1lID0gbmFtZTtcclxuXHR0aGlzLm51bWJlckZvcm1hdCA9IG51bWJlckZvcm1hdDtcclxuXHR0aGlzLmRhdGVUaW1lRm9ybWF0ID0gZGF0ZVRpbWVGb3JtYXQ7XHJcbn1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJEN1bHR1cmVJbmZvJF9nZXREYXRlVGltZUZvcm1hdHMoKSB7XHJcblx0XHR2YXIgZm9ybWF0cyA9IHRoaXMuX2RhdGVUaW1lRm9ybWF0cztcclxuXHRcdGlmICghZm9ybWF0cykge1xyXG5cdFx0XHR2YXIgZHRmID0gdGhpcy5kYXRlVGltZUZvcm1hdDtcclxuXHRcdFx0dGhpcy5fZGF0ZVRpbWVGb3JtYXRzID0gZm9ybWF0cyA9XHJcblx0XHRcdCAgWyBkdGZbXCJNb250aERheVBhdHRlcm5cIl0sXHJcblx0XHRcdFx0ZHRmW1wiWWVhck1vbnRoUGF0dGVyblwiXSxcclxuXHRcdFx0XHRkdGZbXCJTaG9ydERhdGVQYXR0ZXJuXCJdLFxyXG5cdFx0XHRcdGR0ZltcIlNob3J0VGltZVBhdHRlcm5cIl0sXHJcblx0XHRcdFx0ZHRmW1wiTG9uZ0RhdGVQYXR0ZXJuXCJdLFxyXG5cdFx0XHRcdGR0ZltcIkxvbmdUaW1lUGF0dGVyblwiXSxcclxuXHRcdFx0XHRkdGZbXCJGdWxsRGF0ZVRpbWVQYXR0ZXJuXCJdLFxyXG5cdFx0XHRcdGR0ZltcIlJGQzExMjNQYXR0ZXJuXCJdLFxyXG5cdFx0XHRcdGR0ZltcIlNvcnRhYmxlRGF0ZVRpbWVQYXR0ZXJuXCJdLFxyXG5cdFx0XHRcdGR0ZltcIlVuaXZlcnNhbFNvcnRhYmxlRGF0ZVRpbWVQYXR0ZXJuXCJdIF07XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gZm9ybWF0cztcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJEN1bHR1cmVJbmZvJF9nZXRNb250aEluZGV4KHZhbHVlLCBhYmJyKSB7XHJcblx0XHR2YXIgbmFtZSA9IGFiYnIgPyBcIl91cHBlckFiYnJNb250aHNcIiA6IFwiX3VwcGVyTW9udGhzXCIsXHJcblx0XHRcdGdlbml0aXZlTmFtZSA9IG5hbWUgKyBcIkdlbml0aXZlXCIsXHJcblx0XHRcdHVwcGVyTW9udGhzID0gdGhpc1tuYW1lXTtcclxuXHRcdGlmICghdXBwZXJNb250aHMpIHtcclxuXHRcdFx0dmFyIHByZWZpeCA9IChhYmJyID8gXCJBYmJyZXZpYXRlZFwiIDogXCJcIik7XHJcblx0XHRcdHRoaXNbbmFtZV0gPSB0b1VwcGVyQXJyYXkodGhpcy5kYXRlVGltZUZvcm1hdFtwcmVmaXgrXCJNb250aE5hbWVzXCJdKTtcclxuXHRcdFx0dGhpc1tnZW5pdGl2ZU5hbWVdID0gdG9VcHBlckFycmF5KHRoaXMuZGF0ZVRpbWVGb3JtYXRbcHJlZml4K1wiTW9udGhHZW5pdGl2ZU5hbWVzXCJdKTtcclxuXHRcdH1cclxuXHRcdHZhbHVlID0gdG9VcHBlcih2YWx1ZSk7XHJcblx0XHR2YXIgaSA9IGluZGV4T2YodGhpc1tuYW1lXSwgdmFsdWUpO1xyXG5cdFx0aWYgKGkgPCAwKSB7XHJcblx0XHRcdGkgPSBpbmRleE9mKHRoaXNbZ2VuaXRpdmVOYW1lXSwgdmFsdWUpO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGk7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRDdWx0dXJlSW5mbyRfZ2V0RGF5SW5kZXgodmFsdWUsIGFiYnIpIHtcclxuXHRcdHZhciBuYW1lID0gYWJiciA/IFwiX3VwcGVyQWJickRheXNcIiA6IFwiX3VwcGVyRGF5c1wiLFxyXG5cdFx0XHR1cHBlckRheXMgPSB0aGlzW25hbWVdO1xyXG5cdFx0aWYgKCF1cHBlckRheXMpIHtcclxuXHRcdFx0dGhpc1tuYW1lXSA9IHRvVXBwZXJBcnJheSh0aGlzLmRhdGVUaW1lRm9ybWF0WyhhYmJyID8gXCJBYmJyZXZpYXRlZFwiIDogXCJcIikrXCJEYXlOYW1lc1wiXSk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gaW5kZXhPZih0aGlzW25hbWVdLCB0b1VwcGVyKHZhbHVlKSk7XHJcblx0fVxyXG5TeXMuQ3VsdHVyZUluZm8ucHJvdG90eXBlID0ge1xyXG5cdF9nZXREYXRlVGltZUZvcm1hdHM6IFN5cyRDdWx0dXJlSW5mbyRfZ2V0RGF0ZVRpbWVGb3JtYXRzLFxyXG5cdF9nZXRNb250aEluZGV4OiBTeXMkQ3VsdHVyZUluZm8kX2dldE1vbnRoSW5kZXgsXHJcblx0X2dldERheUluZGV4OiBTeXMkQ3VsdHVyZUluZm8kX2dldERheUluZGV4XHJcbn1cclxuU3lzLkN1bHR1cmVJbmZvLnJlZ2lzdGVyQ2xhc3MoJ1N5cy5DdWx0dXJlSW5mbycpO1xyXG5cclxubWVyZ2UoU3lzLkN1bHR1cmVJbmZvLCB7XHJcbl9wYXJzZTogZnVuY3Rpb24odmFsdWUpIHtcclxuXHR2YXIgZHRmID0gdmFsdWUuZGF0ZVRpbWVGb3JtYXQ7XHJcblx0aWYgKGR0ZiAmJiAhZHRmLmVyYXMpIHtcclxuXHRcdGR0Zi5lcmFzID0gdmFsdWUuZXJhcztcclxuXHR9XHJcblx0cmV0dXJuIG5ldyBTeXMuQ3VsdHVyZUluZm8odmFsdWUubmFtZSwgdmFsdWUubnVtYmVyRm9ybWF0LCBkdGYpO1xyXG59LFxyXG5fc2V0dXA6IGZ1bmN0aW9uKCkge1xyXG5cdHZhciBjdWx0dXJlSW5mbyA9IHdpbmRvdy5fX2N1bHR1cmVJbmZvLFxyXG5cdFx0bW9udGhOYW1lcyA9IFtcIkphbnVhcnlcIixcIkZlYnJ1YXJ5XCIsXCJNYXJjaFwiLFwiQXByaWxcIixcIk1heVwiLFwiSnVuZVwiLFwiSnVseVwiLFwiQXVndXN0XCIsXCJTZXB0ZW1iZXJcIixcIk9jdG9iZXJcIixcIk5vdmVtYmVyXCIsXCJEZWNlbWJlclwiLFwiXCJdLFxyXG5cdFx0c2hvcnRNb250aE5hbWVzID0gW1wiSmFuXCIsXCJGZWJcIixcIk1hclwiLFwiQXByXCIsXCJNYXlcIixcIkp1blwiLFwiSnVsXCIsXCJBdWdcIixcIlNlcFwiLFwiT2N0XCIsXCJOb3ZcIixcIkRlY1wiLFwiXCJdLFxyXG5cdFx0aW52YXJpYW50ID0geyBcIm5hbWVcIjogXCJcIiwgXCJudW1iZXJGb3JtYXRcIjogeyBcIkN1cnJlbmN5RGVjaW1hbERpZ2l0c1wiOiAyLCBcIkN1cnJlbmN5RGVjaW1hbFNlcGFyYXRvclwiOiBcIi5cIiwgXCJDdXJyZW5jeUdyb3VwU2l6ZXNcIjogWzNdLCBcIk51bWJlckdyb3VwU2l6ZXNcIjogWzNdLCBcIlBlcmNlbnRHcm91cFNpemVzXCI6IFszXSwgXCJDdXJyZW5jeUdyb3VwU2VwYXJhdG9yXCI6IFwiLFwiLCBcIkN1cnJlbmN5U3ltYm9sXCI6IFwiXFx1MDBBNFwiLCBcIk5hTlN5bWJvbFwiOiBcIk5hTlwiLCBcIkN1cnJlbmN5TmVnYXRpdmVQYXR0ZXJuXCI6IDAsIFwiTnVtYmVyTmVnYXRpdmVQYXR0ZXJuXCI6IDEsIFwiUGVyY2VudFBvc2l0aXZlUGF0dGVyblwiOiAwLCBcIlBlcmNlbnROZWdhdGl2ZVBhdHRlcm5cIjogMCwgXCJOZWdhdGl2ZUluZmluaXR5U3ltYm9sXCI6IFwiLUluZmluaXR5XCIsIFwiTmVnYXRpdmVTaWduXCI6IFwiLVwiLCBcIk51bWJlckRlY2ltYWxEaWdpdHNcIjogMiwgXCJOdW1iZXJEZWNpbWFsU2VwYXJhdG9yXCI6IFwiLlwiLCBcIk51bWJlckdyb3VwU2VwYXJhdG9yXCI6IFwiLFwiLCBcIkN1cnJlbmN5UG9zaXRpdmVQYXR0ZXJuXCI6IDAsIFwiUG9zaXRpdmVJbmZpbml0eVN5bWJvbFwiOiBcIkluZmluaXR5XCIsIFwiUG9zaXRpdmVTaWduXCI6IFwiK1wiLCBcIlBlcmNlbnREZWNpbWFsRGlnaXRzXCI6IDIsIFwiUGVyY2VudERlY2ltYWxTZXBhcmF0b3JcIjogXCIuXCIsIFwiUGVyY2VudEdyb3VwU2VwYXJhdG9yXCI6IFwiLFwiLCBcIlBlcmNlbnRTeW1ib2xcIjogXCIlXCIsIFwiUGVyTWlsbGVTeW1ib2xcIjogXCJcXHUyMDMwXCIsIFwiTmF0aXZlRGlnaXRzXCI6IFtcIjBcIiwgXCIxXCIsIFwiMlwiLCBcIjNcIiwgXCI0XCIsIFwiNVwiLCBcIjZcIiwgXCI3XCIsIFwiOFwiLCBcIjlcIl0sIFwiRGlnaXRTdWJzdGl0dXRpb25cIjogMSB9LCBcImRhdGVUaW1lRm9ybWF0XCI6IHsgXCJBTURlc2lnbmF0b3JcIjogXCJBTVwiLCBcIkNhbGVuZGFyXCI6IHsgXCJNaW5TdXBwb3J0ZWREYXRlVGltZVwiOiBcIkAtNjIxMzU1NjgwMDAwMDBAXCIsIFwiTWF4U3VwcG9ydGVkRGF0ZVRpbWVcIjogXCJAMjUzNDAyMzAwNzk5OTk5QFwiLCBcIkFsZ29yaXRobVR5cGVcIjogMSwgXCJDYWxlbmRhclR5cGVcIjogMSwgXCJFcmFzXCI6IFsxXSwgXCJUd29EaWdpdFllYXJNYXhcIjogMjAyOSB9LCBcIkRhdGVTZXBhcmF0b3JcIjogXCIvXCIsIFwiRmlyc3REYXlPZldlZWtcIjogMCwgXCJDYWxlbmRhcldlZWtSdWxlXCI6IDAsIFwiRnVsbERhdGVUaW1lUGF0dGVyblwiOiBcImRkZGQsIGRkIE1NTU0geXl5eSBISDptbTpzc1wiLCBcIkxvbmdEYXRlUGF0dGVyblwiOiBcImRkZGQsIGRkIE1NTU0geXl5eVwiLCBcIkxvbmdUaW1lUGF0dGVyblwiOiBcIkhIOm1tOnNzXCIsIFwiTW9udGhEYXlQYXR0ZXJuXCI6IFwiTU1NTSBkZFwiLCBcIlBNRGVzaWduYXRvclwiOiBcIlBNXCIsIFwiUkZDMTEyM1BhdHRlcm5cIjogXCJkZGQsIGRkIE1NTSB5eXl5IEhIXFwnOlxcJ21tXFwnOlxcJ3NzIFxcJ0dNVFxcJ1wiLCBcIlNob3J0RGF0ZVBhdHRlcm5cIjogXCJNTS9kZC95eXl5XCIsIFwiU2hvcnRUaW1lUGF0dGVyblwiOiBcImg6bW0gdHRcIiwgXCJTb3J0YWJsZURhdGVUaW1lUGF0dGVyblwiOiBcInl5eXlcXCctXFwnTU1cXCctXFwnZGRcXCdUXFwnSEhcXCc6XFwnbW1cXCc6XFwnc3NcIiwgXCJUaW1lU2VwYXJhdG9yXCI6IFwiOlwiLCBcIlVuaXZlcnNhbFNvcnRhYmxlRGF0ZVRpbWVQYXR0ZXJuXCI6IFwieXl5eVxcJy1cXCdNTVxcJy1cXCdkZCBISFxcJzpcXCdtbVxcJzpcXCdzc1xcJ1pcXCdcIiwgXCJZZWFyTW9udGhQYXR0ZXJuXCI6IFwieXl5eSBNTU1NXCIsIFwiQWJicmV2aWF0ZWREYXlOYW1lc1wiOiBbXCJTdW5cIiwgXCJNb25cIiwgXCJUdWVcIiwgXCJXZWRcIiwgXCJUaHVcIiwgXCJGcmlcIiwgXCJTYXRcIl0sIFwiU2hvcnRlc3REYXlOYW1lc1wiOiBbXCJTdVwiLCBcIk1vXCIsIFwiVHVcIiwgXCJXZVwiLCBcIlRoXCIsIFwiRnJcIiwgXCJTYVwiXSwgXCJEYXlOYW1lc1wiOiBbXCJTdW5kYXlcIiwgXCJNb25kYXlcIiwgXCJUdWVzZGF5XCIsIFwiV2VkbmVzZGF5XCIsIFwiVGh1cnNkYXlcIiwgXCJGcmlkYXlcIiwgXCJTYXR1cmRheVwiXSwgXCJBYmJyZXZpYXRlZE1vbnRoTmFtZXNcIjogc2hvcnRNb250aE5hbWVzLCBcIk1vbnRoTmFtZXNcIjogbW9udGhOYW1lcywgXCJOYXRpdmVDYWxlbmRhck5hbWVcIjogXCJHcmVnb3JpYW4gQ2FsZW5kYXJcIiwgXCJBYmJyZXZpYXRlZE1vbnRoR2VuaXRpdmVOYW1lc1wiOiBBcnJheS5jbG9uZShzaG9ydE1vbnRoTmFtZXMpLCBcIk1vbnRoR2VuaXRpdmVOYW1lc1wiOiBBcnJheS5jbG9uZShtb250aE5hbWVzKSB9LCBcImVyYXNcIjogWzEsIFwiQS5ELlwiLCBudWxsLCAwXSB9O1xyXG5cdHRoaXMuSW52YXJpYW50Q3VsdHVyZSA9IHRoaXMuX3BhcnNlKGludmFyaWFudCk7XHJcblx0c3dpdGNoKHR5cGVvZihjdWx0dXJlSW5mbykpIHtcclxuXHRcdGNhc2UgXCJzdHJpbmdcIjpcclxuXHRcdFx0Y3VsdHVyZUluZm8gPSB3aW5kb3cuZXZhbChcIihcIiArIGN1bHR1cmVJbmZvICsgXCIpXCIpO1xyXG5cdFx0Y2FzZSBcIm9iamVjdFwiOlxyXG5cdFx0XHR0aGlzLkN1cnJlbnRDdWx0dXJlID0gdGhpcy5fcGFyc2UoY3VsdHVyZUluZm8pO1xyXG5cdFx0XHR0cnkge1xyXG5cdFx0XHRcdGRlbGV0ZSBfX2N1bHR1cmVJbmZvO1xyXG5cdFx0XHR9IGNhdGNoKGUpIHtcclxuXHRcdFx0XHRfX2N1bHR1cmVJbmZvID0gbnVsbDtcclxuXHRcdFx0fVxyXG5cdFx0XHRicmVhaztcclxuXHRcdGRlZmF1bHQ6XHJcblx0XHRcdGN1bHR1cmVJbmZvID0gY2xvbmUoaW52YXJpYW50KTtcclxuXHRcdFx0Y3VsdHVyZUluZm8ubmFtZSA9IFwiZW4tVVNcIjtcclxuXHRcdFx0Y3VsdHVyZUluZm8ubnVtYmVyRm9ybWF0LkN1cnJlbmN5U3ltYm9sID0gXCIkXCI7XHJcblx0XHRcdHZhciBkdGYgPSBjdWx0dXJlSW5mby5kYXRlVGltZUZvcm1hdDtcclxuXHRcdFx0ZHRmLkZ1bGxEYXRlUGF0dGVybiA9IFwiZGRkZCwgTU1NTSBkZCwgeXl5eSBoOm1tOnNzIHR0XCI7XHJcblx0XHRcdGR0Zi5Mb25nRGF0ZVBhdHRlcm4gPSBcImRkZGQsIE1NTU0gZGQsIHl5eXlcIjtcclxuXHRcdFx0ZHRmLkxvbmdUaW1lUGF0dGVybiA9IFwiaDptbTpzcyB0dFwiO1xyXG5cdFx0XHRkdGYuU2hvcnREYXRlUGF0dGVybiA9IFwiTS9kL3l5eXlcIjtcclxuXHRcdFx0ZHRmLlNob3J0VGltZVBhdHRlcm4gPSBcImg6bW0gdHRcIjtcclxuXHRcdFx0ZHRmLlllYXJNb250aFBhdHRlcm4gPSBcIk1NTU0sIHl5eXlcIjtcclxuXHRcdFx0dGhpcy5DdXJyZW50Q3VsdHVyZSA9IHRoaXMuX3BhcnNlKGN1bHR1cmVJbmZvKTtcclxuXHRcdFx0YnJlYWs7XHJcblx0fVxyXG59XHJcbn0pO1xyXG5cclxuU3lzLkN1bHR1cmVJbmZvLl9zZXR1cCgpO1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5UeXBlLnJlZ2lzdGVyTmFtZXNwYWNlKCdTeXMuU2VyaWFsaXphdGlvbicpO1xyXG5cclxuU3lzLlNlcmlhbGl6YXRpb24uSmF2YVNjcmlwdFNlcmlhbGl6ZXIgPSBmdW5jdGlvbiBTeXMkU2VyaWFsaXphdGlvbiRKYXZhU2NyaXB0U2VyaWFsaXplcigpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlNlcmlhbGl6YXRpb24uSmF2YVNjcmlwdFNlcmlhbGl6ZXIuI2N0b3JcIiAvPlxyXG5cdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG59XHJcblN5cy5TZXJpYWxpemF0aW9uLkphdmFTY3JpcHRTZXJpYWxpemVyLnJlZ2lzdGVyQ2xhc3MoJ1N5cy5TZXJpYWxpemF0aW9uLkphdmFTY3JpcHRTZXJpYWxpemVyJyk7XHJcblxyXG5tZXJnZShTeXMuU2VyaWFsaXphdGlvbi5KYXZhU2NyaXB0U2VyaWFsaXplciwge1xyXG5fZXNjOiB7XHJcblx0Y2hhcnNSZWdFeHM6IHsgJ1wiJzogL1xcXCIvZywgJ1xcXFwnOiAvXFxcXC9nIH0sIC8qXCIqL1xyXG5cdGNoYXJzOiBbJ1xcXFwnLCAnXCInXSxcclxuXHRkYXRlUmVnRXg6IC8oXnxbXlxcXFxdKVxcXCJcXFxcXFwvRGF0ZVxcKCgtP1swLTldKykoPzpbYS16QS1aXXwoPzpcXCt8LSlbMC05XXs0fSk/XFwpXFxcXFxcL1xcXCIvZywgLyogXCIgKi9cclxuXHRlc2NhcGVDaGFyczogeydcXFxcJzonXFxcXFxcXFwnLCAnXCInOidcXFxcXCInLCBcIlxcYlwiOlwiXFxcXGJcIiwgXCJcXHRcIjpcIlxcXFx0XCIsIFwiXFxuXCI6XCJcXFxcblwiLCBcIlxcZlwiOlwiXFxcXGZcIiwgXCJcXHJcIjpcIlxcXFxyXCJ9LFxyXG5cdGVzY2FwZVJlZ0V4RzogL1tcXFwiXFxcXFxceDAwLVxceDFGXS9nLFxyXG5cdGVzY2FwZVJlZ0V4OiAvW1xcXCJcXFxcXFx4MDAtXFx4MUZdL2ksXHJcblx0anNvblJlZ0V4OiAvW14sOnt9XFxbXFxdMC05LlxcLStFYWVmbG5yLXUgXFxuXFxyXFx0XS9nLFxyXG5cdGpzb25TdHJpbmdSZWdFeDogL1xcXCIoXFxcXC58W15cXFwiXFxcXF0pKlxcXCIvZyAvKlwiKi9cclxufSxcclxuX2luaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdHZhciBlc2MgPSB0aGlzLl9lc2MsXHJcblx0XHR0b0VzYyA9IGVzYy5jaGFycyxcclxuXHRcdHRvRXNjUkUgPSBlc2MuY2hhcnNSZWdFeHMsXHJcblx0XHRlc2NDaGFycyA9IGVzYy5lc2NhcGVDaGFycztcclxuXHRmb3IgKHZhciBpID0gMDsgaSA8IDMyOyBpKyspIHtcclxuXHRcdHZhciBjID0gU3RyaW5nLmZyb21DaGFyQ29kZShpKTtcclxuXHRcdHRvRXNjW2krMl0gPSBjO1xyXG5cdFx0dG9Fc2NSRVtjXSA9IG5ldyBSZWdFeHAoYywgJ2cnKTtcclxuXHRcdGVzY0NoYXJzW2NdID0gZXNjQ2hhcnNbY10gfHwgKFwiXFxcXHVcIiArIChcIjAwMFwiICsgaS50b1N0cmluZygxNikpLnNsaWNlKC00KSk7XHJcblx0fVxyXG5cdHRoaXMuX2xvYWQgPSB0cnVlO1xyXG59LFxyXG5fc2VyaWFsaXplTnVtYmVyV2l0aEJ1aWxkZXI6IGZ1bmN0aW9uKG9iamVjdCwgc3RyaW5nQnVpbGRlcikge1xyXG5cdGlmICghaXNGaW5pdGUob2JqZWN0KSkge1xyXG5cdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTeXMuUmVzLmNhbm5vdFNlcmlhbGl6ZU5vbkZpbml0ZU51bWJlcnMpO1xyXG5cdH1cclxuXHRzdHJpbmdCdWlsZGVyLmFwcGVuZChTdHJpbmcob2JqZWN0KSk7XHJcbn0sXHJcblxyXG5cclxuXHJcblxyXG5fc2VyaWFsaXplU3RyaW5nV2l0aEJ1aWxkZXI6IGZ1bmN0aW9uKHN0cmluZywgc3RyaW5nQnVpbGRlcikge1xyXG5cdHN0cmluZ0J1aWxkZXIuYXBwZW5kKCdcIicpO1xyXG5cdHZhciBlc2MgPSB0aGlzLl9lc2M7XHJcblx0aWYgKGVzYy5lc2NhcGVSZWdFeC50ZXN0KHN0cmluZykpIHtcclxuXHRcdGlmICghdGhpcy5fbG9hZCkge1xyXG5cdFx0XHR0aGlzLl9pbml0KCk7XHJcblx0XHR9XHJcblx0XHRpZiAoc3RyaW5nLmxlbmd0aCA8IDEyOCkge1xyXG5cdFx0XHRzdHJpbmcgPSBzdHJpbmcucmVwbGFjZShlc2MuZXNjYXBlUmVnRXhHLFxyXG5cdFx0XHRcdGZ1bmN0aW9uKHgpIHsgcmV0dXJuIGVzYy5lc2NhcGVDaGFyc1t4XTsgfSk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCAzNDsgaSsrKSB7XHJcblx0XHRcdFx0dmFyIGMgPSBlc2MuY2hhcnNbaV07XHJcblx0XHRcdFx0aWYgKHN0cmluZy5pbmRleE9mKGMpICE9PSAtMSkge1xyXG5cdFx0XHRcdFx0dmFyIGVzY0NoYXIgPSBlc2MuZXNjYXBlQ2hhcnNbY107XHJcblx0XHRcdFx0XHRzdHJpbmcgPSAoaXNCcm93c2VyKFwiT3BlcmFcIikgfHwgaXNCcm93c2VyKFwiRmlyZWZveFwiKSkgP1xyXG5cdFx0XHRcdFx0XHRzdHJpbmcuc3BsaXQoYykuam9pbihlc2NDaGFyKSA6XHJcblx0XHRcdFx0XHRcdHN0cmluZy5yZXBsYWNlKGVzYy5jaGFyc1JlZ0V4c1tjXSwgZXNjQ2hhcik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0ICAgfVxyXG5cdH1cclxuXHRzdHJpbmdCdWlsZGVyLmFwcGVuZChzdHJpbmcpLmFwcGVuZCgnXCInKTtcclxufSxcclxuX3NlcmlhbGl6ZVdpdGhCdWlsZGVyOiBmdW5jdGlvbihvYmplY3QsIHN0cmluZ0J1aWxkZXIsIHNvcnQsIHByZXZPYmplY3RzKSB7XHJcblx0dmFyIGk7XHJcblx0c3dpdGNoICh0eXBlb2Ygb2JqZWN0KSB7XHJcblx0Y2FzZSAnb2JqZWN0JzpcclxuXHRcdGlmIChvYmplY3QpIHtcclxuXHRcdFx0aWYgKHByZXZPYmplY3RzKXtcclxuXHRcdFx0XHRpZiAoU3lzLl9pbmRleE9mKHByZXZPYmplY3RzLCBvYmplY3QpICE9PSAtMSkge1xyXG5cdFx0XHRcdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTeXMuUmVzLmNhbm5vdFNlcmlhbGl6ZU9iamVjdFdpdGhDeWNsZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHByZXZPYmplY3RzID0gW107XHJcblx0XHRcdH1cclxuXHRcdFx0dHJ5IHtcclxuXHRcdFx0XHRwcmV2T2JqZWN0cy5wdXNoKG9iamVjdCk7XHJcblx0XHRcdFx0aWYgKE51bWJlci5pc0luc3RhbmNlT2ZUeXBlKG9iamVjdCkpIHtcclxuXHRcdFx0XHRcdHRoaXMuX3NlcmlhbGl6ZU51bWJlcldpdGhCdWlsZGVyKG9iamVjdCwgc3RyaW5nQnVpbGRlcik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2UgaWYgKEJvb2xlYW4uaXNJbnN0YW5jZU9mVHlwZShvYmplY3QpKSB7XHJcblx0XHRcdFx0XHRzdHJpbmdCdWlsZGVyLmFwcGVuZChvYmplY3QpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmIChTdHJpbmcuaXNJbnN0YW5jZU9mVHlwZShvYmplY3QpKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9zZXJpYWxpemVTdHJpbmdXaXRoQnVpbGRlcihvYmplY3QsIHN0cmluZ0J1aWxkZXIpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmIChvYmplY3QgaW5zdGFuY2VvZiBBcnJheSkge1xyXG5cdFx0XHRcdFx0c3RyaW5nQnVpbGRlci5hcHBlbmQoJ1snKTtcclxuXHRcdFx0XHRcdGZvciAoaSA9IDA7IGkgPCBvYmplY3QubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0XHRcdFx0aWYgKGkpIHtcclxuXHRcdFx0XHRcdFx0XHRzdHJpbmdCdWlsZGVyLmFwcGVuZCgnLCcpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdHRoaXMuX3NlcmlhbGl6ZVdpdGhCdWlsZGVyKG9iamVjdFtpXSwgc3RyaW5nQnVpbGRlciwgZmFsc2UsIHByZXZPYmplY3RzKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHN0cmluZ0J1aWxkZXIuYXBwZW5kKCddJyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0aWYgKERhdGUuaXNJbnN0YW5jZU9mVHlwZShvYmplY3QpKSB7XHJcblx0XHRcdFx0XHRcdHN0cmluZ0J1aWxkZXIuYXBwZW5kKCdcIlxcXFwvRGF0ZSgnKS5cclxuXHRcdFx0XHRcdFx0XHRhcHBlbmQob2JqZWN0LmdldFRpbWUoKSkuXHJcblx0XHRcdFx0XHRcdFx0YXBwZW5kKCcpXFxcXC9cIicpO1xyXG5cdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHR2YXIgcHJvcGVydGllcyA9IFtdLFxyXG5cdFx0XHRcdFx0XHRwcm9wZXJ0eUNvdW50ID0gMDtcclxuXHRcdFx0XHRcdGZvciAodmFyIG5hbWUgaW4gb2JqZWN0KSB7XHJcblx0XHRcdFx0XHRcdGlmIChuYW1lLmNoYXJBdCgwKSAhPT0gJyQnKSB7XHJcblx0XHRcdFx0XHRcdFx0aWYgKG5hbWUgPT09ICdfX3R5cGUnICYmIHByb3BlcnR5Q291bnQpIHtcclxuXHRcdFx0XHRcdFx0XHRcdHByb3BlcnRpZXNbcHJvcGVydHlDb3VudCsrXSA9IHByb3BlcnRpZXNbMF07XHJcblx0XHRcdFx0XHRcdFx0XHRwcm9wZXJ0aWVzWzBdID0gbmFtZTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0XHRwcm9wZXJ0aWVzW3Byb3BlcnR5Q291bnQrK10gPSBuYW1lO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0aWYgKHNvcnQpIHByb3BlcnRpZXMuc29ydCgpO1xyXG5cclxuXHRcdFx0XHRcdHN0cmluZ0J1aWxkZXIuYXBwZW5kKCd7Jyk7XHJcblx0XHRcdFx0XHR2YXIgbmVlZENvbW1hO1xyXG5cdFx0XHRcdFx0Zm9yIChpPTA7IGkgPCBwcm9wZXJ0eUNvdW50OyBpKyspIHtcclxuXHRcdFx0XHRcdFx0dmFyIHByb3AgPSBwcm9wZXJ0aWVzW2ldLCB2YWx1ZSA9IG9iamVjdFtwcm9wXSxcclxuXHRcdFx0XHRcdFx0XHR0eXBlID0gdHlwZW9mKHZhbHVlKTtcclxuXHRcdFx0XHRcdFx0aWYgKHR5cGUgIT09ICd1bmRlZmluZWQnICYmIHR5cGUgIT09ICdmdW5jdGlvbicpIHtcclxuXHRcdFx0XHRcdFx0XHRpZiAobmVlZENvbW1hKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRzdHJpbmdCdWlsZGVyLmFwcGVuZCgnLCcpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR0aGlzLl9zZXJpYWxpemVXaXRoQnVpbGRlcihwcm9wLCBzdHJpbmdCdWlsZGVyLCBzb3J0LCBwcmV2T2JqZWN0cyk7XHJcblx0XHRcdFx0XHRcdFx0c3RyaW5nQnVpbGRlci5hcHBlbmQoJzonKTtcclxuXHRcdFx0XHRcdFx0XHR0aGlzLl9zZXJpYWxpemVXaXRoQnVpbGRlcih2YWx1ZSwgc3RyaW5nQnVpbGRlciwgc29ydCwgcHJldk9iamVjdHMpO1xyXG5cdFx0XHRcdFx0XHRcdG5lZWRDb21tYSA9IHRydWU7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRzdHJpbmdCdWlsZGVyLmFwcGVuZCgnfScpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRmaW5hbGx5IHtcclxuXHRcdFx0XHRBcnJheS5yZW1vdmVBdChwcmV2T2JqZWN0cywgcHJldk9iamVjdHMubGVuZ3RoIC0gMSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRzdHJpbmdCdWlsZGVyLmFwcGVuZCgnbnVsbCcpO1xyXG5cdFx0fVxyXG5cdFx0YnJlYWs7XHJcblxyXG5cdGNhc2UgJ251bWJlcic6XHJcblx0XHR0aGlzLl9zZXJpYWxpemVOdW1iZXJXaXRoQnVpbGRlcihvYmplY3QsIHN0cmluZ0J1aWxkZXIpO1xyXG5cdFx0YnJlYWs7XHJcblxyXG5cdGNhc2UgJ3N0cmluZyc6XHJcblx0XHR0aGlzLl9zZXJpYWxpemVTdHJpbmdXaXRoQnVpbGRlcihvYmplY3QsIHN0cmluZ0J1aWxkZXIpO1xyXG5cdFx0YnJlYWs7XHJcblxyXG5cdGNhc2UgJ2Jvb2xlYW4nOlxyXG5cdFx0c3RyaW5nQnVpbGRlci5hcHBlbmQob2JqZWN0KTtcclxuXHRcdGJyZWFrO1xyXG5cclxuXHRkZWZhdWx0OlxyXG5cdFx0c3RyaW5nQnVpbGRlci5hcHBlbmQoJ251bGwnKTtcclxuXHRcdGJyZWFrO1xyXG5cdH1cclxufVxyXG59KTtcclxuXHJcblN5cy5TZXJpYWxpemF0aW9uLkphdmFTY3JpcHRTZXJpYWxpemVyLnNlcmlhbGl6ZSA9IGZ1bmN0aW9uIFN5cyRTZXJpYWxpemF0aW9uJEphdmFTY3JpcHRTZXJpYWxpemVyJHNlcmlhbGl6ZShvYmplY3QpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlNlcmlhbGl6YXRpb24uSmF2YVNjcmlwdFNlcmlhbGl6ZXIuc2VyaWFsaXplXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJvYmplY3RcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIlN0cmluZ1wiPjwvcmV0dXJucz5cclxuXHJcblx0dmFyIHN0cmluZ0J1aWxkZXIgPSBuZXcgU3lzLlN0cmluZ0J1aWxkZXIoKTtcclxuXHRTeXMuU2VyaWFsaXphdGlvbi5KYXZhU2NyaXB0U2VyaWFsaXplci5fc2VyaWFsaXplV2l0aEJ1aWxkZXIob2JqZWN0LCBzdHJpbmdCdWlsZGVyLCBmYWxzZSk7XHJcblx0cmV0dXJuIHN0cmluZ0J1aWxkZXIudG9TdHJpbmcoKTtcclxufVxyXG5cclxuU3lzLlNlcmlhbGl6YXRpb24uSmF2YVNjcmlwdFNlcmlhbGl6ZXIuZGVzZXJpYWxpemUgPSBmdW5jdGlvbiBTeXMkU2VyaWFsaXphdGlvbiRKYXZhU2NyaXB0U2VyaWFsaXplciRkZXNlcmlhbGl6ZShkYXRhLCBzZWN1cmUpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlNlcmlhbGl6YXRpb24uSmF2YVNjcmlwdFNlcmlhbGl6ZXIuZGVzZXJpYWxpemVcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImRhdGFcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJzZWN1cmVcIiB0eXBlPVwiQm9vbGVhblwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucz48L3JldHVybnM+XHJcblxyXG5cdGlmICghZGF0YS5sZW5ndGgpIHRocm93IEVycm9yLmFyZ3VtZW50KCdkYXRhJywgU3lzLlJlcy5jYW5ub3REZXNlcmlhbGl6ZUVtcHR5U3RyaW5nKTtcclxuXHR2YXIgZXIsIGVzYyA9IFN5cy5TZXJpYWxpemF0aW9uLkphdmFTY3JpcHRTZXJpYWxpemVyLl9lc2M7XHJcblx0dHJ5IHtcclxuXHRcdHZhciBleHAgPSBkYXRhLnJlcGxhY2UoZXNjLmRhdGVSZWdFeCwgXCIkMW5ldyBEYXRlKCQyKVwiKTtcclxuXHRcdGlmIChzZWN1cmUgJiYgZXNjLmpzb25SZWdFeC50ZXN0KGV4cC5yZXBsYWNlKGVzYy5qc29uU3RyaW5nUmVnRXgsICcnKSkpIHRocm93IG51bGw7XHJcblxyXG5cdFx0cmV0dXJuIHdpbmRvdy5ldmFsKCcoJyArIGV4cCArICcpJyk7XHJcblx0fVxyXG5cdGNhdGNoIChlcikge1xyXG5cdFx0IHRocm93IEVycm9yLmFyZ3VtZW50KCdkYXRhJywgU3lzLlJlcy5jYW5ub3REZXNlcmlhbGl6ZUludmFsaWRKc29uKTtcclxuXHR9XHJcbn1cclxuXHJcblxyXG5cclxuXHJcblxyXG5UeXBlLnJlZ2lzdGVyTmFtZXNwYWNlKCdTeXMuVUknKTtcclxuXHJcblN5cy5FdmVudEhhbmRsZXJMaXN0ID0gZnVuY3Rpb24gU3lzJEV2ZW50SGFuZGxlckxpc3QoKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5FdmVudEhhbmRsZXJMaXN0LiNjdG9yXCIgLz5cclxuXHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHR0aGlzLl9saXN0ID0ge307XHJcbn1cclxuXHJcblxyXG5cdGZ1bmN0aW9uIFN5cyRFdmVudEhhbmRsZXJMaXN0JF9hZGRIYW5kbGVyKGlkLCBoYW5kbGVyKSB7XHJcblx0XHRBcnJheS5hZGQodGhpcy5fZ2V0RXZlbnQoaWQsIHRydWUpLCBoYW5kbGVyKTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJEV2ZW50SGFuZGxlckxpc3QkYWRkSGFuZGxlcihpZCwgaGFuZGxlcikge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5FdmVudEhhbmRsZXJMaXN0LmFkZEhhbmRsZXJcIiAvPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiaWRcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImhhbmRsZXJcIiB0eXBlPVwiRnVuY3Rpb25cIj48L3BhcmFtPlxyXG5cclxuXHRcdHRoaXMuX2FkZEhhbmRsZXIoaWQsIGhhbmRsZXIpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkRXZlbnRIYW5kbGVyTGlzdCRfcmVtb3ZlSGFuZGxlcihpZCwgaGFuZGxlcikge1xyXG5cdFx0dmFyIGV2dCA9IHRoaXMuX2dldEV2ZW50KGlkKTtcclxuXHRcdGlmICghZXZ0KSByZXR1cm47XHJcblx0XHRBcnJheS5yZW1vdmUoZXZ0LCBoYW5kbGVyKTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJEV2ZW50SGFuZGxlckxpc3QkX3JlbW92ZUhhbmRsZXJzKGlkKSB7XHJcblx0XHRpZiAoIWlkKSB7XHJcblx0XHRcdHRoaXMuX2xpc3QgPSB7fTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHR2YXIgZXZ0ID0gdGhpcy5fZ2V0RXZlbnQoaWQpO1xyXG5cdFx0XHRpZiAoIWV2dCkgcmV0dXJuO1xyXG5cdFx0XHRldnQubGVuZ3RoID0gMDtcclxuXHRcdH1cclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJEV2ZW50SGFuZGxlckxpc3QkcmVtb3ZlSGFuZGxlcihpZCwgaGFuZGxlcikge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5FdmVudEhhbmRsZXJMaXN0LnJlbW92ZUhhbmRsZXJcIiAvPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiaWRcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImhhbmRsZXJcIiB0eXBlPVwiRnVuY3Rpb25cIj48L3BhcmFtPlxyXG5cclxuXHRcdHRoaXMuX3JlbW92ZUhhbmRsZXIoaWQsIGhhbmRsZXIpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkRXZlbnRIYW5kbGVyTGlzdCRnZXRIYW5kbGVyKGlkKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLkV2ZW50SGFuZGxlckxpc3QuZ2V0SGFuZGxlclwiIC8+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJpZFwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJGdW5jdGlvblwiPjwvcmV0dXJucz5cclxuXHJcblx0XHR2YXIgZXZ0ID0gdGhpcy5fZ2V0RXZlbnQoaWQpO1xyXG5cdFx0aWYgKCFldnQgfHwgKGV2dC5sZW5ndGggPT09IDApKSByZXR1cm4gbnVsbDtcclxuXHRcdGV2dCA9IEFycmF5LmNsb25lKGV2dCk7XHJcblx0XHRyZXR1cm4gZnVuY3Rpb24oc291cmNlLCBhcmdzKSB7XHJcblx0XHRcdGZvciAodmFyIGkgPSAwLCBsID0gZXZ0Lmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG5cdFx0XHRcdGV2dFtpXShzb3VyY2UsIGFyZ3MpO1xyXG5cdFx0XHR9XHJcblx0XHR9O1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkRXZlbnRIYW5kbGVyTGlzdCRfZ2V0RXZlbnQoaWQsIGNyZWF0ZSkge1xyXG5cdFx0aWYgKCF0aGlzLl9saXN0W2lkXSkge1xyXG5cdFx0XHRpZiAoIWNyZWF0ZSkgcmV0dXJuIG51bGw7XHJcblx0XHRcdHRoaXMuX2xpc3RbaWRdID0gW107XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdGhpcy5fbGlzdFtpZF07XHJcblx0fVxyXG5TeXMuRXZlbnRIYW5kbGVyTGlzdC5wcm90b3R5cGUgPSB7XHJcblx0X2FkZEhhbmRsZXI6IFN5cyRFdmVudEhhbmRsZXJMaXN0JF9hZGRIYW5kbGVyLFxyXG5cdGFkZEhhbmRsZXI6IFN5cyRFdmVudEhhbmRsZXJMaXN0JGFkZEhhbmRsZXIsXHJcblx0X3JlbW92ZUhhbmRsZXI6IFN5cyRFdmVudEhhbmRsZXJMaXN0JF9yZW1vdmVIYW5kbGVyLFxyXG5cdF9yZW1vdmVIYW5kbGVyczogU3lzJEV2ZW50SGFuZGxlckxpc3QkX3JlbW92ZUhhbmRsZXJzLFxyXG5cdHJlbW92ZUhhbmRsZXI6IFN5cyRFdmVudEhhbmRsZXJMaXN0JHJlbW92ZUhhbmRsZXIsXHJcblx0Z2V0SGFuZGxlcjogU3lzJEV2ZW50SGFuZGxlckxpc3QkZ2V0SGFuZGxlcixcclxuXHRfZ2V0RXZlbnQ6IFN5cyRFdmVudEhhbmRsZXJMaXN0JF9nZXRFdmVudFxyXG59XHJcblN5cy5FdmVudEhhbmRsZXJMaXN0LnJlZ2lzdGVyQ2xhc3MoJ1N5cy5FdmVudEhhbmRsZXJMaXN0Jyk7XHJcblN5cy5Db21tYW5kRXZlbnRBcmdzID0gZnVuY3Rpb24gU3lzJENvbW1hbmRFdmVudEFyZ3MoY29tbWFuZE5hbWUsIGNvbW1hbmRBcmd1bWVudCwgY29tbWFuZFNvdXJjZSkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuQ29tbWFuZEV2ZW50QXJncy4jY3RvclwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiY29tbWFuZE5hbWVcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJjb21tYW5kQXJndW1lbnRcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJjb21tYW5kU291cmNlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblxyXG5cdFN5cy5Db21tYW5kRXZlbnRBcmdzLmluaXRpYWxpemVCYXNlKHRoaXMpO1xyXG5cdHRoaXMuX2NvbW1hbmROYW1lID0gY29tbWFuZE5hbWU7XHJcblx0dGhpcy5fY29tbWFuZEFyZ3VtZW50ID0gY29tbWFuZEFyZ3VtZW50O1xyXG5cdHRoaXMuX2NvbW1hbmRTb3VyY2UgPSBjb21tYW5kU291cmNlO1xyXG59XHJcblxyXG5cclxuXHJcblxyXG5cdGZ1bmN0aW9uIFN5cyRDb21tYW5kRXZlbnRBcmdzJGdldF9jb21tYW5kTmFtZSgpIHtcclxuXHRcdC8vLyA8dmFsdWUgdHlwZT1cIlN0cmluZ1wiIGxvY2lkPVwiUDpKI1N5cy5Db21tYW5kRXZlbnRBcmdzLmNvbW1hbmROYW1lXCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0cmV0dXJuIHRoaXMuX2NvbW1hbmROYW1lO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkQ29tbWFuZEV2ZW50QXJncyRnZXRfY29tbWFuZEFyZ3VtZW50KCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSBtYXlCZU51bGw9XCJ0cnVlXCIgbG9jaWQ9XCJQOkojU3lzLkNvbW1hbmRFdmVudEFyZ3MuY29tbWFuZEFyZ3VtZW50XCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0cmV0dXJuIHRoaXMuX2NvbW1hbmRBcmd1bWVudDtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJENvbW1hbmRFdmVudEFyZ3MkZ2V0X2NvbW1hbmRTb3VyY2UoKSB7XHJcblx0XHQvLy8gPHZhbHVlIG1heUJlTnVsbD1cInRydWVcIiBsb2NpZD1cIlA6SiNTeXMuQ29tbWFuZEV2ZW50QXJncy5jb21tYW5kU291cmNlXCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0cmV0dXJuIHRoaXMuX2NvbW1hbmRTb3VyY2U7XHJcblx0fVxyXG5TeXMuQ29tbWFuZEV2ZW50QXJncy5wcm90b3R5cGUgPSB7XHJcblx0X2NvbW1hbmROYW1lOiBudWxsLFxyXG5cdF9jb21tYW5kQXJndW1lbnQ6IG51bGwsXHJcblx0X2NvbW1hbmRTb3VyY2U6IG51bGwsXHJcblx0Z2V0X2NvbW1hbmROYW1lOiBTeXMkQ29tbWFuZEV2ZW50QXJncyRnZXRfY29tbWFuZE5hbWUsXHJcblx0Z2V0X2NvbW1hbmRBcmd1bWVudDogU3lzJENvbW1hbmRFdmVudEFyZ3MkZ2V0X2NvbW1hbmRBcmd1bWVudCxcclxuXHRnZXRfY29tbWFuZFNvdXJjZTogU3lzJENvbW1hbmRFdmVudEFyZ3MkZ2V0X2NvbW1hbmRTb3VyY2VcclxufVxyXG5TeXMuQ29tbWFuZEV2ZW50QXJncy5yZWdpc3RlckNsYXNzKFwiU3lzLkNvbW1hbmRFdmVudEFyZ3NcIiwgU3lzLkNhbmNlbEV2ZW50QXJncyk7XHJcblN5cy5JTm90aWZ5UHJvcGVydHlDaGFuZ2UgPSBmdW5jdGlvbiBTeXMkSU5vdGlmeVByb3BlcnR5Q2hhbmdlKCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuSU5vdGlmeVByb3BlcnR5Q2hhbmdlLiNjdG9yXCIgLz5cclxuXHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG59XHJcblxyXG5cdGZ1bmN0aW9uIFN5cyRJTm90aWZ5UHJvcGVydHlDaGFuZ2UkYWRkX3Byb3BlcnR5Q2hhbmdlZChoYW5kbGVyKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiRTpKI1N5cy5JTm90aWZ5UHJvcGVydHlDaGFuZ2UucHJvcGVydHlDaGFuZ2VkXCIgLz5cclxuXHJcblx0XHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkSU5vdGlmeVByb3BlcnR5Q2hhbmdlJHJlbW92ZV9wcm9wZXJ0eUNoYW5nZWQoaGFuZGxlcikge1xyXG5cclxuXHRcdHRocm93IEVycm9yLm5vdEltcGxlbWVudGVkKCk7XHJcblx0fVxyXG5TeXMuSU5vdGlmeVByb3BlcnR5Q2hhbmdlLnByb3RvdHlwZSA9IHtcclxuXHRhZGRfcHJvcGVydHlDaGFuZ2VkOiBTeXMkSU5vdGlmeVByb3BlcnR5Q2hhbmdlJGFkZF9wcm9wZXJ0eUNoYW5nZWQsXHJcblx0cmVtb3ZlX3Byb3BlcnR5Q2hhbmdlZDogU3lzJElOb3RpZnlQcm9wZXJ0eUNoYW5nZSRyZW1vdmVfcHJvcGVydHlDaGFuZ2VkXHJcbn1cclxuU3lzLklOb3RpZnlQcm9wZXJ0eUNoYW5nZS5yZWdpc3RlckludGVyZmFjZSgnU3lzLklOb3RpZnlQcm9wZXJ0eUNoYW5nZScpO1xyXG5TeXMuUHJvcGVydHlDaGFuZ2VkRXZlbnRBcmdzID0gZnVuY3Rpb24gU3lzJFByb3BlcnR5Q2hhbmdlZEV2ZW50QXJncyhwcm9wZXJ0eU5hbWUpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlByb3BlcnR5Q2hhbmdlZEV2ZW50QXJncy4jY3RvclwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwicHJvcGVydHlOYW1lXCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblxyXG5cdFN5cy5Qcm9wZXJ0eUNoYW5nZWRFdmVudEFyZ3MuaW5pdGlhbGl6ZUJhc2UodGhpcyk7XHJcblx0dGhpcy5fcHJvcGVydHlOYW1lID0gcHJvcGVydHlOYW1lO1xyXG59XHJcblx0ZnVuY3Rpb24gU3lzJFByb3BlcnR5Q2hhbmdlZEV2ZW50QXJncyRnZXRfcHJvcGVydHlOYW1lKCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiU3RyaW5nXCIgbG9jaWQ9XCJQOkojU3lzLlByb3BlcnR5Q2hhbmdlZEV2ZW50QXJncy5wcm9wZXJ0eU5hbWVcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHRyZXR1cm4gdGhpcy5fcHJvcGVydHlOYW1lO1xyXG5cdH1cclxuU3lzLlByb3BlcnR5Q2hhbmdlZEV2ZW50QXJncy5wcm90b3R5cGUgPSB7XHJcblx0Z2V0X3Byb3BlcnR5TmFtZTogU3lzJFByb3BlcnR5Q2hhbmdlZEV2ZW50QXJncyRnZXRfcHJvcGVydHlOYW1lXHJcbn1cclxuU3lzLlByb3BlcnR5Q2hhbmdlZEV2ZW50QXJncy5yZWdpc3RlckNsYXNzKCdTeXMuUHJvcGVydHlDaGFuZ2VkRXZlbnRBcmdzJywgU3lzLkV2ZW50QXJncyk7XHJcblN5cy5JTm90aWZ5RGlzcG9zaW5nID0gZnVuY3Rpb24gU3lzJElOb3RpZnlEaXNwb3NpbmcoKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5JTm90aWZ5RGlzcG9zaW5nLiNjdG9yXCIgLz5cclxuXHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG59XHJcblxyXG5cdGZ1bmN0aW9uIFN5cyRJTm90aWZ5RGlzcG9zaW5nJGFkZF9kaXNwb3NpbmcoaGFuZGxlcikge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIkU6SiNTeXMuSU5vdGlmeURpc3Bvc2luZy5kaXNwb3NpbmdcIiAvPlxyXG5cclxuXHRcdHRocm93IEVycm9yLm5vdEltcGxlbWVudGVkKCk7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRJTm90aWZ5RGlzcG9zaW5nJHJlbW92ZV9kaXNwb3NpbmcoaGFuZGxlcikge1xyXG5cclxuXHRcdHRocm93IEVycm9yLm5vdEltcGxlbWVudGVkKCk7XHJcblx0fVxyXG5TeXMuSU5vdGlmeURpc3Bvc2luZy5wcm90b3R5cGUgPSB7XHJcblx0YWRkX2Rpc3Bvc2luZzogU3lzJElOb3RpZnlEaXNwb3NpbmckYWRkX2Rpc3Bvc2luZyxcclxuXHRyZW1vdmVfZGlzcG9zaW5nOiBTeXMkSU5vdGlmeURpc3Bvc2luZyRyZW1vdmVfZGlzcG9zaW5nXHJcbn1cclxuU3lzLklOb3RpZnlEaXNwb3NpbmcucmVnaXN0ZXJJbnRlcmZhY2UoXCJTeXMuSU5vdGlmeURpc3Bvc2luZ1wiKTtcclxuU3lzLkNvbXBvbmVudCA9IGZ1bmN0aW9uIFN5cyRDb21wb25lbnQoKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5Db21wb25lbnQuI2N0b3JcIiAvPlxyXG5cdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdGlmIChTeXMuQXBwbGljYXRpb24pIFN5cy5BcHBsaWNhdGlvbi5yZWdpc3RlckRpc3Bvc2FibGVPYmplY3QodGhpcyk7XHJcbn1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJENvbXBvbmVudCRnZXRfaXNMaW5rUGVuZGluZygpIHtcclxuXHRcdC8vLyA8dmFsdWUgdHlwZT1cIkJvb2xlYW5cIiBsb2NpZD1cIlA6SiNTeXMuQ29tcG9uZW50LmlzTGlua1BlbmRpbmdcIj48L3ZhbHVlPlxyXG5cdFx0cmV0dXJuICEhdGhpcy5faXNMaW5rUGVuZGluZztcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJENvbXBvbmVudCRzZXRfaXNMaW5rUGVuZGluZyh2YWx1ZSkge1xyXG5cdFx0dGhpcy5faXNMaW5rUGVuZGluZyA9IHZhbHVlO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkQ29tcG9uZW50JGdldF9ldmVudHMoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJTeXMuRXZlbnRIYW5kbGVyTGlzdFwiIGxvY2lkPVwiUDpKI1N5cy5Db21wb25lbnQuZXZlbnRzXCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0cmV0dXJuIFN5cy5PYnNlcnZlci5fZ2V0Q29udGV4dCh0aGlzLCB0cnVlKS5ldmVudHM7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRDb21wb25lbnQkZ2V0X2lkKCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiU3RyaW5nXCIgbG9jaWQ9XCJQOkojU3lzLkNvbXBvbmVudC5pZFwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiB0aGlzLl9pZCB8fCBudWxsO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkQ29tcG9uZW50JHNldF9pZCh2YWx1ZSkge1xyXG5cclxuXHRcdGlmICh0aGlzLl9pZFNldCkgdGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTeXMuUmVzLmNvbXBvbmVudENhbnRTZXRJZFR3aWNlKTtcclxuXHRcdHRoaXMuX2lkU2V0ID0gdHJ1ZTtcclxuXHRcdHZhciBvbGRJZCA9IHRoaXMuZ2V0X2lkKCk7XHJcblx0XHRpZiAob2xkSWQgJiYgU3lzLkFwcGxpY2F0aW9uLmZpbmRDb21wb25lbnQob2xkSWQpKSB0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN5cy5SZXMuY29tcG9uZW50Q2FudFNldElkQWZ0ZXJBZGRlZFRvQXBwKTtcclxuXHRcdHRoaXMuX2lkID0gdmFsdWU7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRDb21wb25lbnQkZ2V0X2lzSW5pdGlhbGl6ZWQoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJCb29sZWFuXCIgbG9jaWQ9XCJQOkojU3lzLkNvbXBvbmVudC5pc0luaXRpYWxpemVkXCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0cmV0dXJuICEhdGhpcy5faW5pdGlhbGl6ZWQ7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRDb21wb25lbnQkZ2V0X2lzVXBkYXRpbmcoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJCb29sZWFuXCIgbG9jaWQ9XCJQOkojU3lzLkNvbXBvbmVudC5pc1VwZGF0aW5nXCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0cmV0dXJuICEhdGhpcy5fdXBkYXRpbmc7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRDb21wb25lbnQkYWRkX2Rpc3Bvc2luZyhoYW5kbGVyKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJFOkojU3lzLkNvbXBvbmVudC5kaXNwb3NpbmdcIiAvPlxyXG5cclxuXHRcdHRoaXMuX2FkZEhhbmRsZXIoXCJkaXNwb3NpbmdcIiwgaGFuZGxlcik7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRDb21wb25lbnQkcmVtb3ZlX2Rpc3Bvc2luZyhoYW5kbGVyKSB7XHJcblxyXG5cdFx0dGhpcy5fcmVtb3ZlSGFuZGxlcihcImRpc3Bvc2luZ1wiLCBoYW5kbGVyKTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJENvbXBvbmVudCRhZGRfcHJvcGVydHlDaGFuZ2VkKGhhbmRsZXIpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIkU6SiNTeXMuQ29tcG9uZW50LnByb3BlcnR5Q2hhbmdlZFwiIC8+XHJcblxyXG5cdFx0dGhpcy5fYWRkSGFuZGxlcihcInByb3BlcnR5Q2hhbmdlZFwiLCBoYW5kbGVyKTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJENvbXBvbmVudCRyZW1vdmVfcHJvcGVydHlDaGFuZ2VkKGhhbmRsZXIpIHtcclxuXHJcblx0XHR0aGlzLl9yZW1vdmVIYW5kbGVyKFwicHJvcGVydHlDaGFuZ2VkXCIsIGhhbmRsZXIpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkQ29tcG9uZW50JF9hZGRIYW5kbGVyKGV2ZW50TmFtZSwgaGFuZGxlcikge1xyXG5cdFx0U3lzLk9ic2VydmVyLmFkZEV2ZW50SGFuZGxlcih0aGlzLCBldmVudE5hbWUsIGhhbmRsZXIpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkQ29tcG9uZW50JF9yZW1vdmVIYW5kbGVyKGV2ZW50TmFtZSwgaGFuZGxlcikge1xyXG5cdFx0U3lzLk9ic2VydmVyLnJlbW92ZUV2ZW50SGFuZGxlcih0aGlzLCBldmVudE5hbWUsIGhhbmRsZXIpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkQ29tcG9uZW50JGJlZ2luVXBkYXRlKCkge1xyXG5cdFx0dGhpcy5fdXBkYXRpbmcgPSB0cnVlO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkQ29tcG9uZW50JGRpc3Bvc2UoKSB7XHJcblx0XHRTeXMuT2JzZXJ2ZXIucmFpc2VFdmVudCh0aGlzLCBcImRpc3Bvc2luZ1wiKTtcclxuXHRcdFN5cy5PYnNlcnZlci5jbGVhckV2ZW50SGFuZGxlcnModGhpcyk7XHJcblx0XHRTeXMuQXBwbGljYXRpb24udW5yZWdpc3RlckRpc3Bvc2FibGVPYmplY3QodGhpcyk7XHJcblx0XHRTeXMuQXBwbGljYXRpb24ucmVtb3ZlQ29tcG9uZW50KHRoaXMpO1xyXG5cdFx0dGhpcy5fdXBkYXRpbmcgPSB0aGlzLl9pbml0aWFsaXplZCA9IHRoaXMuX29ic2VydmVyQ29udGV4dCA9IHRoaXMuX2lzTGlua1BlbmRpbmcgPSBudWxsO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkQ29tcG9uZW50JGVuZFVwZGF0ZSgpIHtcclxuXHRcdHRoaXMuX3VwZGF0aW5nID0gZmFsc2U7XHJcblx0XHRpZiAoIXRoaXMuX2luaXRpYWxpemVkKSB0aGlzLmluaXRpYWxpemUoKTtcclxuXHRcdHRoaXMudXBkYXRlZCgpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkQ29tcG9uZW50JGluaXRpYWxpemUoKSB7XHJcblx0XHR0aGlzLl9pbml0aWFsaXplZCA9IHRydWU7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRDb21wb25lbnQkbGluaygpIHtcclxuXHRcdHRoaXMuX2lzTGlua1BlbmRpbmcgPSBmYWxzZTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJENvbXBvbmVudCRyYWlzZVByb3BlcnR5Q2hhbmdlZChwcm9wZXJ0eU5hbWUpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuQ29tcG9uZW50LnJhaXNlUHJvcGVydHlDaGFuZ2VkXCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cInByb3BlcnR5TmFtZVwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cclxuXHRcdFN5cy5PYnNlcnZlci5yYWlzZVByb3BlcnR5Q2hhbmdlZCh0aGlzLCBwcm9wZXJ0eU5hbWUpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkQ29tcG9uZW50JHVwZGF0ZWQoKSB7XHJcblx0fVxyXG5TeXMuQ29tcG9uZW50LnByb3RvdHlwZSA9IHtcclxuXHRnZXRfZXZlbnRzOiBTeXMkQ29tcG9uZW50JGdldF9ldmVudHMsXHJcblx0Z2V0X2lkOiBTeXMkQ29tcG9uZW50JGdldF9pZCxcclxuXHRzZXRfaWQ6IFN5cyRDb21wb25lbnQkc2V0X2lkLFxyXG5cdGdldF9pc0xpbmtQZW5kaW5nOiBTeXMkQ29tcG9uZW50JGdldF9pc0xpbmtQZW5kaW5nLFxyXG5cdHNldF9pc0xpbmtQZW5kaW5nOiBTeXMkQ29tcG9uZW50JHNldF9pc0xpbmtQZW5kaW5nLFxyXG5cdGdldF9pc0luaXRpYWxpemVkOiBTeXMkQ29tcG9uZW50JGdldF9pc0luaXRpYWxpemVkLFxyXG5cdGdldF9pc1VwZGF0aW5nOiBTeXMkQ29tcG9uZW50JGdldF9pc1VwZGF0aW5nLFxyXG5cdGFkZF9kaXNwb3Npbmc6IFN5cyRDb21wb25lbnQkYWRkX2Rpc3Bvc2luZyxcclxuXHRyZW1vdmVfZGlzcG9zaW5nOiBTeXMkQ29tcG9uZW50JHJlbW92ZV9kaXNwb3NpbmcsXHJcblx0YWRkX3Byb3BlcnR5Q2hhbmdlZDogU3lzJENvbXBvbmVudCRhZGRfcHJvcGVydHlDaGFuZ2VkLFxyXG5cdHJlbW92ZV9wcm9wZXJ0eUNoYW5nZWQ6IFN5cyRDb21wb25lbnQkcmVtb3ZlX3Byb3BlcnR5Q2hhbmdlZCxcclxuXHRfYWRkSGFuZGxlcjogU3lzJENvbXBvbmVudCRfYWRkSGFuZGxlcixcclxuXHRfcmVtb3ZlSGFuZGxlcjogU3lzJENvbXBvbmVudCRfcmVtb3ZlSGFuZGxlcixcclxuXHRiZWdpblVwZGF0ZTogU3lzJENvbXBvbmVudCRiZWdpblVwZGF0ZSxcclxuXHRkaXNwb3NlOiBTeXMkQ29tcG9uZW50JGRpc3Bvc2UsXHJcblx0ZW5kVXBkYXRlOiBTeXMkQ29tcG9uZW50JGVuZFVwZGF0ZSxcclxuXHRpbml0aWFsaXplOiBTeXMkQ29tcG9uZW50JGluaXRpYWxpemUsXHJcblx0cmFpc2VQcm9wZXJ0eUNoYW5nZWQ6IFN5cyRDb21wb25lbnQkcmFpc2VQcm9wZXJ0eUNoYW5nZWQsXHJcblx0dXBkYXRlZDogU3lzJENvbXBvbmVudCR1cGRhdGVkLFxyXG5cdGxpbms6IFN5cyRDb21wb25lbnQkbGlua1xyXG59XHJcblN5cy5Db21wb25lbnQucmVnaXN0ZXJDbGFzcygnU3lzLkNvbXBvbmVudCcsIG51bGwsIFN5cy5JRGlzcG9zYWJsZSwgU3lzLklOb3RpZnlQcm9wZXJ0eUNoYW5nZSwgU3lzLklOb3RpZnlEaXNwb3NpbmcpO1xyXG5cclxuU3lzLkNvbXBvbmVudC5fc2V0UHJvcGVydGllcyA9IGZ1bmN0aW9uIFN5cyRDb21wb25lbnQkX3NldFByb3BlcnRpZXModGFyZ2V0LCBwcm9wZXJ0aWVzKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5Db21wb25lbnQuX3NldFByb3BlcnRpZXNcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInRhcmdldFwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwicHJvcGVydGllc1wiPjwvcGFyYW0+XHJcblxyXG5cdHZhciBjdXJyZW50O1xyXG5cdHZhciB0YXJnZXRUeXBlID0gT2JqZWN0LmdldFR5cGUodGFyZ2V0KTtcclxuXHR2YXIgaXNPYmplY3QgPSAodGFyZ2V0VHlwZSA9PT0gT2JqZWN0KSB8fCAodGFyZ2V0VHlwZSA9PT0gU3lzLlVJLkRvbUVsZW1lbnQpO1xyXG5cdHZhciBpc0NvbXBvbmVudCA9IFN5cy5Db21wb25lbnQuaXNJbnN0YW5jZU9mVHlwZSh0YXJnZXQpICYmICF0YXJnZXQuZ2V0X2lzVXBkYXRpbmcoKTtcclxuXHRpZiAoaXNDb21wb25lbnQpIHRhcmdldC5iZWdpblVwZGF0ZSgpO1xyXG5cdGZvciAodmFyIG5hbWUgaW4gcHJvcGVydGllcykge1xyXG5cdFx0dmFyIHZhbCA9IHByb3BlcnRpZXNbbmFtZV07XHJcblx0XHR2YXIgZ2V0dGVyID0gaXNPYmplY3QgPyBudWxsIDogdGFyZ2V0W1wiZ2V0X1wiICsgbmFtZV07XHJcblx0XHRpZiAoaXNPYmplY3QgfHwgdHlwZW9mKGdldHRlcikgIT09ICdmdW5jdGlvbicpIHtcclxuXHRcdFx0dmFyIHRhcmdldFZhbCA9IHRhcmdldFtuYW1lXTtcclxuXHRcdFx0aWYgKCF2YWwgfHwgKHR5cGVvZih2YWwpICE9PSAnb2JqZWN0JykgfHwgKGlzT2JqZWN0ICYmICF0YXJnZXRWYWwpKSB7XHJcblx0XHRcdFx0dGFyZ2V0W25hbWVdID0gdmFsO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMuX3NldFByb3BlcnRpZXModGFyZ2V0VmFsLCB2YWwpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dmFyIHNldHRlciA9IHRhcmdldFtcInNldF9cIiArIG5hbWVdO1xyXG5cdFx0XHRpZiAodHlwZW9mKHNldHRlcikgPT09ICdmdW5jdGlvbicpIHtcclxuXHRcdFx0XHRzZXR0ZXIuYXBwbHkodGFyZ2V0LCBbdmFsXSk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuXHRcdFx0XHRjdXJyZW50ID0gZ2V0dGVyLmFwcGx5KHRhcmdldCk7XHJcblx0XHRcdFx0aWYgKCEoY3VycmVudCBpbnN0YW5jZW9mIEFycmF5KSkgdGhyb3cgbmV3IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuUmVzLnByb3BlcnR5Tm90QW5BcnJheSwgbmFtZSkpO1xyXG5cdFx0XHRcdGZvciAodmFyIGkgPSAwLCBqID0gY3VycmVudC5sZW5ndGgsIGw9IHZhbC5sZW5ndGg7IGkgPCBsOyBpKyssIGorKykge1xyXG5cdFx0XHRcdFx0Y3VycmVudFtqXSA9IHZhbFtpXTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoKHR5cGVvZih2YWwpID09PSAnb2JqZWN0JykgJiYgKE9iamVjdC5nZXRUeXBlKHZhbCkgPT09IE9iamVjdCkpIHtcclxuXHRcdFx0XHRjdXJyZW50ID0gZ2V0dGVyLmFwcGx5KHRhcmdldCk7XHJcblx0XHRcdFx0aWYgKCh0eXBlb2YoY3VycmVudCkgPT09ICd1bmRlZmluZWQnKSB8fCAoY3VycmVudCA9PT0gbnVsbCkpIHRocm93IG5ldyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN0cmluZy5mb3JtYXQoU3lzLlJlcy5wcm9wZXJ0eU51bGxPclVuZGVmaW5lZCwgbmFtZSkpO1xyXG5cdFx0XHRcdHRoaXMuX3NldFByb3BlcnRpZXMoY3VycmVudCwgdmFsKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTdHJpbmcuZm9ybWF0KFN5cy5SZXMucHJvcGVydHlOb3RXcml0YWJsZSwgbmFtZSkpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdGlmIChpc0NvbXBvbmVudCkgdGFyZ2V0LmVuZFVwZGF0ZSgpO1xyXG59XHJcblxyXG5TeXMuQ29tcG9uZW50Ll9zZXRSZWZlcmVuY2VzID0gZnVuY3Rpb24gU3lzJENvbXBvbmVudCRfc2V0UmVmZXJlbmNlcyhjb21wb25lbnQsIHJlZmVyZW5jZXMpIHtcclxuXHR2YXIgcmVmZXJlbmNlLCByZWZzID0ge307XHJcblx0Zm9ySW4ocmVmZXJlbmNlcywgZnVuY3Rpb24oaWQsIG5hbWUpIHtcclxuXHRcdHJlZnNbbmFtZV0gPSByZWZlcmVuY2UgPSAkZmluZChpZCk7XHJcblx0XHRpZiAoIXJlZmVyZW5jZSkgdGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTdHJpbmcuZm9ybWF0KFN5cy5SZXMucmVmZXJlbmNlTm90Rm91bmQsIGlkKSk7XHJcblx0fSk7XHJcblx0U3lzLl9zZXRQcm9wcyhjb21wb25lbnQsIHJlZnMpO1xyXG59XHJcblxyXG4kY3JlYXRlID0gU3lzLkNvbXBvbmVudC5jcmVhdGUgPSBmdW5jdGlvbiBTeXMkQ29tcG9uZW50JGNyZWF0ZSh0eXBlLCBwcm9wZXJ0aWVzLCBldmVudHMsIHJlZmVyZW5jZXMsIGVsZW1lbnQpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLkNvbXBvbmVudC5jcmVhdGVcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInR5cGVcIiB0eXBlPVwiVHlwZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwicHJvcGVydGllc1wiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImV2ZW50c1wiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInJlZmVyZW5jZXNcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJlbGVtZW50XCIgZG9tRWxlbWVudD1cInRydWVcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIk9iamVjdFwiPjwvcmV0dXJucz5cclxuXHJcblx0aWYgKHR5cGUuaW5oZXJpdHNGcm9tKFN5cy5VSS5CZWhhdmlvcikgfHwgdHlwZS5pbmhlcml0c0Zyb20oU3lzLlVJLkNvbnRyb2wpKSB7XHJcblx0XHRpZiAoIWVsZW1lbnQpIHRocm93IEVycm9yLmFyZ3VtZW50KCdlbGVtZW50JywgU3lzLlJlcy5jcmVhdGVOb0RvbSk7XHJcblx0fVxyXG5cdGVsc2UgaWYgKGVsZW1lbnQpIHRocm93IEVycm9yLmFyZ3VtZW50KCdlbGVtZW50JywgU3lzLlJlcy5jcmVhdGVDb21wb25lbnRPbkRvbSk7XHJcblx0dmFyIGNvbXBvbmVudCA9IChlbGVtZW50ID8gbmV3IHR5cGUoZWxlbWVudCk6IG5ldyB0eXBlKCkpO1xyXG5cdGNhbGxJZihjb21wb25lbnQsIFwiYmVnaW5VcGRhdGVcIik7XHJcblx0aWYgKHByb3BlcnRpZXMpIHtcclxuXHRcdFN5cy5Db21wb25lbnQuX3NldFByb3BlcnRpZXMoY29tcG9uZW50LCBwcm9wZXJ0aWVzKTtcclxuXHR9XHJcblx0aWYgKGV2ZW50cykge1xyXG5cdFx0Zm9yICh2YXIgbmFtZSBpbiBldmVudHMpIHtcclxuXHRcdFx0aWYgKCEoY29tcG9uZW50W1wiYWRkX1wiICsgbmFtZV0gaW5zdGFuY2VvZiBGdW5jdGlvbikpIHRocm93IG5ldyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN0cmluZy5mb3JtYXQoU3lzLlJlcy51bmRlZmluZWRFdmVudCwgbmFtZSkpO1xyXG5cdFx0XHRpZiAoIShldmVudHNbbmFtZV0gaW5zdGFuY2VvZiBGdW5jdGlvbikpIHRocm93IG5ldyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN5cy5SZXMuZXZlbnRIYW5kbGVyTm90RnVuY3Rpb24pO1xyXG5cdFx0XHRjb21wb25lbnRbXCJhZGRfXCIgKyBuYW1lXShldmVudHNbbmFtZV0pO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRTeXMuQ29tcG9uZW50Ll9yZWdpc3Rlcihjb21wb25lbnQsIHJlZmVyZW5jZXMpO1xyXG5cdHJldHVybiBjb21wb25lbnQ7XHJcbn1cclxuU3lzLkNvbXBvbmVudC5fcmVnaXN0ZXIgPSBmdW5jdGlvbiBTeXMkQ29tcG9uZW50JF9yZWdpc3Rlcihjb21wb25lbnQsIHJlZmVyZW5jZXMsIGRvbnRVcGRhdGUpIHtcclxuXHR2YXIgcmV0O1xyXG5cdGlmIChTeXMuQ29tcG9uZW50LmlzSW5zdGFuY2VPZlR5cGUoY29tcG9uZW50KSkge1xyXG5cdFx0cmV0ID0gdHJ1ZTtcclxuXHRcdHZhciBhcHAgPSBTeXMuQXBwbGljYXRpb247XHJcblx0XHRpZiAoY29tcG9uZW50LmdldF9pZCgpKSB7XHJcblx0XHRcdGFwcC5hZGRDb21wb25lbnQoY29tcG9uZW50KTtcclxuXHRcdH1cclxuXHRcdGlmIChhcHAuZ2V0X2lzQ3JlYXRpbmdDb21wb25lbnRzKCkpIHtcclxuXHRcdFx0YXBwLl9jcmVhdGVkQ29tcG9uZW50cy5wdXNoKGNvbXBvbmVudCk7XHJcblx0XHRcdGlmIChyZWZlcmVuY2VzKSB7XHJcblx0XHRcdFx0YXBwLl9hZGRDb21wb25lbnRUb1NlY29uZFBhc3MoY29tcG9uZW50LCByZWZlcmVuY2VzKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICghZG9udFVwZGF0ZSkge1xyXG5cdFx0XHRcdGNvbXBvbmVudC5lbmRVcGRhdGUoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGlmIChyZWZlcmVuY2VzKSB7XHJcblx0XHRcdFx0U3lzLkNvbXBvbmVudC5fc2V0UmVmZXJlbmNlcyhjb21wb25lbnQsIHJlZmVyZW5jZXMpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICghZG9udFVwZGF0ZSkge1xyXG5cdFx0XHRcdGNvbXBvbmVudC5lbmRVcGRhdGUoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gcmV0O1xyXG59XHJcblxyXG5TeXMuX2dldENvbXBvbmVudCA9IGZ1bmN0aW9uIFN5cyRfZ2V0Q29tcG9uZW50KGZvdW5kLCBzZWxlY3RvciwgY29udGV4dCkge1xyXG5cdHZhciBjb21wb25lbnQgPSBTeXMuQXBwbGljYXRpb24uZmluZENvbXBvbmVudChzZWxlY3Rvcik7XHJcblx0aWYgKGNvbXBvbmVudCkge1xyXG5cdFx0Zm91bmQucHVzaChjb21wb25lbnQpO1xyXG5cdH1cclxufVxyXG5cclxuU3lzLl8yUGFzcyA9IGZ1bmN0aW9uIFN5cyRfMlBhc3MoY2FsbGJhY2spIHtcclxuXHR2YXIgYXBwID0gU3lzLkFwcGxpY2F0aW9uLFxyXG5cdFx0dXNlVHdvUGFzcyA9ICFhcHAuZ2V0X2lzQ3JlYXRpbmdDb21wb25lbnRzKCk7XHJcblx0aWYgKHVzZVR3b1Bhc3MpIGFwcC5iZWdpbkNyZWF0ZUNvbXBvbmVudHMoKTtcclxuXHRmb3JlYWNoKGNhbGxiYWNrLCBmdW5jdGlvbihjKSB7IGMoKSB9KTtcclxuXHRpZiAodXNlVHdvUGFzcykgYXBwLmVuZENyZWF0ZUNvbXBvbmVudHMoKTtcclxufVxyXG5TeXMuVUkuTW91c2VCdXR0b24gPSBmdW5jdGlvbiBTeXMkVUkkTW91c2VCdXR0b24oKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5Nb3VzZUJ1dHRvbi4jY3RvclwiIC8+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwibGVmdEJ1dHRvblwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiIHN0YXRpYz1cInRydWVcIiBsb2NpZD1cIkY6SiNTeXMuVUkuTW91c2VCdXR0b24ubGVmdEJ1dHRvblwiPjwvZmllbGQ+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwibWlkZGxlQnV0dG9uXCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCIgc3RhdGljPVwidHJ1ZVwiIGxvY2lkPVwiRjpKI1N5cy5VSS5Nb3VzZUJ1dHRvbi5taWRkbGVCdXR0b25cIj48L2ZpZWxkPlxyXG5cdC8vLyA8ZmllbGQgbmFtZT1cInJpZ2h0QnV0dG9uXCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCIgc3RhdGljPVwidHJ1ZVwiIGxvY2lkPVwiRjpKI1N5cy5VSS5Nb3VzZUJ1dHRvbi5yaWdodEJ1dHRvblwiPjwvZmllbGQ+XHJcblx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0dGhyb3cgRXJyb3Iubm90SW1wbGVtZW50ZWQoKTtcclxufVxyXG5cclxuXHJcblxyXG5cclxuU3lzLlVJLk1vdXNlQnV0dG9uLnByb3RvdHlwZSA9IHtcclxuXHRsZWZ0QnV0dG9uOiAwLFxyXG5cdG1pZGRsZUJ1dHRvbjogMSxcclxuXHRyaWdodEJ1dHRvbjogMlxyXG59XHJcblN5cy5VSS5Nb3VzZUJ1dHRvbi5yZWdpc3RlckVudW0oXCJTeXMuVUkuTW91c2VCdXR0b25cIik7XHJcblN5cy5VSS5LZXkgPSBmdW5jdGlvbiBTeXMkVUkkS2V5KCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuS2V5LiNjdG9yXCIgLz5cclxuXHQvLy8gPGZpZWxkIG5hbWU9XCJiYWNrc3BhY2VcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIiBzdGF0aWM9XCJ0cnVlXCIgbG9jaWQ9XCJGOkojU3lzLlVJLktleS5iYWNrc3BhY2VcIj48L2ZpZWxkPlxyXG5cdC8vLyA8ZmllbGQgbmFtZT1cInRhYlwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiIHN0YXRpYz1cInRydWVcIiBsb2NpZD1cIkY6SiNTeXMuVUkuS2V5LnRhYlwiPjwvZmllbGQ+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwiZW50ZXJcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIiBzdGF0aWM9XCJ0cnVlXCIgbG9jaWQ9XCJGOkojU3lzLlVJLktleS5lbnRlclwiPjwvZmllbGQ+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwiZXNjXCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCIgc3RhdGljPVwidHJ1ZVwiIGxvY2lkPVwiRjpKI1N5cy5VSS5LZXkuZXNjXCI+PC9maWVsZD5cclxuXHQvLy8gPGZpZWxkIG5hbWU9XCJzcGFjZVwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiIHN0YXRpYz1cInRydWVcIiBsb2NpZD1cIkY6SiNTeXMuVUkuS2V5LnNwYWNlXCI+PC9maWVsZD5cclxuXHQvLy8gPGZpZWxkIG5hbWU9XCJwYWdlVXBcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIiBzdGF0aWM9XCJ0cnVlXCIgbG9jaWQ9XCJGOkojU3lzLlVJLktleS5wYWdlVXBcIj48L2ZpZWxkPlxyXG5cdC8vLyA8ZmllbGQgbmFtZT1cInBhZ2VEb3duXCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCIgc3RhdGljPVwidHJ1ZVwiIGxvY2lkPVwiRjpKI1N5cy5VSS5LZXkucGFnZURvd25cIj48L2ZpZWxkPlxyXG5cdC8vLyA8ZmllbGQgbmFtZT1cImVuZFwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiIHN0YXRpYz1cInRydWVcIiBsb2NpZD1cIkY6SiNTeXMuVUkuS2V5LmVuZFwiPjwvZmllbGQ+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwiaG9tZVwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiIHN0YXRpYz1cInRydWVcIiBsb2NpZD1cIkY6SiNTeXMuVUkuS2V5LmhvbWVcIj48L2ZpZWxkPlxyXG5cdC8vLyA8ZmllbGQgbmFtZT1cImxlZnRcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIiBzdGF0aWM9XCJ0cnVlXCIgbG9jaWQ9XCJGOkojU3lzLlVJLktleS5sZWZ0XCI+PC9maWVsZD5cclxuXHQvLy8gPGZpZWxkIG5hbWU9XCJ1cFwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiIHN0YXRpYz1cInRydWVcIiBsb2NpZD1cIkY6SiNTeXMuVUkuS2V5LnVwXCI+PC9maWVsZD5cclxuXHQvLy8gPGZpZWxkIG5hbWU9XCJyaWdodFwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiIHN0YXRpYz1cInRydWVcIiBsb2NpZD1cIkY6SiNTeXMuVUkuS2V5LnJpZ2h0XCI+PC9maWVsZD5cclxuXHQvLy8gPGZpZWxkIG5hbWU9XCJkb3duXCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCIgc3RhdGljPVwidHJ1ZVwiIGxvY2lkPVwiRjpKI1N5cy5VSS5LZXkuZG93blwiPjwvZmllbGQ+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwiZGVsXCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCIgc3RhdGljPVwidHJ1ZVwiIGxvY2lkPVwiRjpKI1N5cy5VSS5LZXkuZGVsXCI+PC9maWVsZD5cclxuXHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG59XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblN5cy5VSS5LZXkucHJvdG90eXBlID0ge1xyXG5cdGJhY2tzcGFjZTogOCxcclxuXHR0YWI6IDksXHJcblx0ZW50ZXI6IDEzLFxyXG5cdGVzYzogMjcsXHJcblx0c3BhY2U6IDMyLFxyXG5cdHBhZ2VVcDogMzMsXHJcblx0cGFnZURvd246IDM0LFxyXG5cdGVuZDogMzUsXHJcblx0aG9tZTogMzYsXHJcblx0bGVmdDogMzcsXHJcblx0dXA6IDM4LFxyXG5cdHJpZ2h0OiAzOSxcclxuXHRkb3duOiA0MCxcclxuXHRkZWw6IDEyN1xyXG59XHJcblN5cy5VSS5LZXkucmVnaXN0ZXJFbnVtKFwiU3lzLlVJLktleVwiKTtcclxuU3lzLlVJLlBvaW50ID0gZnVuY3Rpb24gU3lzJFVJJFBvaW50KHgsIHkpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLlBvaW50LiNjdG9yXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ4XCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ5XCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPGZpZWxkIG5hbWU9XCJ4XCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCIgbG9jaWQ9XCJGOkojU3lzLlVJLlBvaW50LnhcIj48L2ZpZWxkPlxyXG5cdC8vLyA8ZmllbGQgbmFtZT1cInlcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIiBsb2NpZD1cIkY6SiNTeXMuVUkuUG9pbnQueVwiPjwvZmllbGQ+XHJcblxyXG5cdHRoaXMueCA9IHg7XHJcblx0dGhpcy55ID0geTtcclxufVxyXG5TeXMuVUkuUG9pbnQucmVnaXN0ZXJDbGFzcygnU3lzLlVJLlBvaW50Jyk7XHJcblN5cy5VSS5Cb3VuZHMgPSBmdW5jdGlvbiBTeXMkVUkkQm91bmRzKHgsIHksIHdpZHRoLCBoZWlnaHQpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLkJvdW5kcy4jY3RvclwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwieFwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwieVwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwid2lkdGhcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImhlaWdodFwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwieFwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiIGxvY2lkPVwiRjpKI1N5cy5VSS5Cb3VuZHMueFwiPjwvZmllbGQ+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwieVwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiIGxvY2lkPVwiRjpKI1N5cy5VSS5Cb3VuZHMueVwiPjwvZmllbGQ+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwid2lkdGhcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIiBsb2NpZD1cIkY6SiNTeXMuVUkuQm91bmRzLndpZHRoXCI+PC9maWVsZD5cclxuXHQvLy8gPGZpZWxkIG5hbWU9XCJoZWlnaHRcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIiBsb2NpZD1cIkY6SiNTeXMuVUkuQm91bmRzLmhlaWdodFwiPjwvZmllbGQ+XHJcblxyXG5cdHRoaXMueCA9IHg7XHJcblx0dGhpcy55ID0geTtcclxuXHR0aGlzLmhlaWdodCA9IGhlaWdodDtcclxuXHR0aGlzLndpZHRoID0gd2lkdGg7XHJcbn1cclxuU3lzLlVJLkJvdW5kcy5yZWdpc3RlckNsYXNzKCdTeXMuVUkuQm91bmRzJyk7XHJcblN5cy5VSS5Eb21FdmVudCA9IGZ1bmN0aW9uIFN5cyRVSSREb21FdmVudChldmVudE9iamVjdCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuRG9tRXZlbnQuI2N0b3JcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImV2ZW50T2JqZWN0XCI+PC9wYXJhbT5cclxuXHQvLy8gPGZpZWxkIG5hbWU9XCJhbHRLZXlcIiB0eXBlPVwiQm9vbGVhblwiIGxvY2lkPVwiRjpKI1N5cy5VSS5Eb21FdmVudC5hbHRLZXlcIj48L2ZpZWxkPlxyXG5cdC8vLyA8ZmllbGQgbmFtZT1cImJ1dHRvblwiIHR5cGU9XCJTeXMuVUkuTW91c2VCdXR0b25cIiBsb2NpZD1cIkY6SiNTeXMuVUkuRG9tRXZlbnQuYnV0dG9uXCI+PC9maWVsZD5cclxuXHQvLy8gPGZpZWxkIG5hbWU9XCJjaGFyQ29kZVwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiIGxvY2lkPVwiRjpKI1N5cy5VSS5Eb21FdmVudC5jaGFyQ29kZVwiPjwvZmllbGQ+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwiY2xpZW50WFwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiIGxvY2lkPVwiRjpKI1N5cy5VSS5Eb21FdmVudC5jbGllbnRYXCI+PC9maWVsZD5cclxuXHQvLy8gPGZpZWxkIG5hbWU9XCJjbGllbnRZXCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCIgbG9jaWQ9XCJGOkojU3lzLlVJLkRvbUV2ZW50LmNsaWVudFlcIj48L2ZpZWxkPlxyXG5cdC8vLyA8ZmllbGQgbmFtZT1cImN0cmxLZXlcIiB0eXBlPVwiQm9vbGVhblwiIGxvY2lkPVwiRjpKI1N5cy5VSS5Eb21FdmVudC5jdHJsS2V5XCI+PC9maWVsZD5cclxuXHQvLy8gPGZpZWxkIG5hbWU9XCJrZXlDb2RlXCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCIgbG9jaWQ9XCJGOkojU3lzLlVJLkRvbUV2ZW50LmtleUNvZGVcIj48L2ZpZWxkPlxyXG5cdC8vLyA8ZmllbGQgbmFtZT1cIm9mZnNldFhcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIiBsb2NpZD1cIkY6SiNTeXMuVUkuRG9tRXZlbnQub2Zmc2V0WFwiPjwvZmllbGQ+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwib2Zmc2V0WVwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiIGxvY2lkPVwiRjpKI1N5cy5VSS5Eb21FdmVudC5vZmZzZXRZXCI+PC9maWVsZD5cclxuXHQvLy8gPGZpZWxkIG5hbWU9XCJzY3JlZW5YXCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCIgbG9jaWQ9XCJGOkojU3lzLlVJLkRvbUV2ZW50LnNjcmVlblhcIj48L2ZpZWxkPlxyXG5cdC8vLyA8ZmllbGQgbmFtZT1cInNjcmVlbllcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIiBsb2NpZD1cIkY6SiNTeXMuVUkuRG9tRXZlbnQuc2NyZWVuWVwiPjwvZmllbGQ+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwic2hpZnRLZXlcIiB0eXBlPVwiQm9vbGVhblwiIGxvY2lkPVwiRjpKI1N5cy5VSS5Eb21FdmVudC5zaGlmdEtleVwiPjwvZmllbGQ+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwidGFyZ2V0XCIgbG9jaWQ9XCJGOkojU3lzLlVJLkRvbUV2ZW50LnRhcmdldFwiPjwvZmllbGQ+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwidHlwZVwiIHR5cGU9XCJTdHJpbmdcIiBsb2NpZD1cIkY6SiNTeXMuVUkuRG9tRXZlbnQudHlwZVwiPjwvZmllbGQ+XHJcblxyXG5cdHZhciBldiA9IGV2ZW50T2JqZWN0O1xyXG5cdHZhciBldHlwZSA9IHRoaXMudHlwZSA9IGV2LnR5cGUudG9Mb3dlckNhc2UoKTtcclxuXHR0aGlzLnJhd0V2ZW50ID0gZXY7XHJcblx0dGhpcy5hbHRLZXkgPSBldi5hbHRLZXk7XHJcblx0aWYgKHR5cGVvZihldi5idXR0b24pICE9PSAndW5kZWZpbmVkJykge1xyXG5cdFx0dGhpcy5idXR0b24gPSAodHlwZW9mKGV2LndoaWNoKSAhPT0gJ3VuZGVmaW5lZCcpID8gZXYuYnV0dG9uIDpcclxuXHRcdFx0KGV2LmJ1dHRvbiA9PT0gNCkgPyBTeXMuVUkuTW91c2VCdXR0b24ubWlkZGxlQnV0dG9uIDpcclxuXHRcdFx0KGV2LmJ1dHRvbiA9PT0gMikgPyBTeXMuVUkuTW91c2VCdXR0b24ucmlnaHRCdXR0b24gOlxyXG5cdFx0XHRTeXMuVUkuTW91c2VCdXR0b24ubGVmdEJ1dHRvbjtcclxuXHR9XHJcblx0aWYgKGV0eXBlID09PSAna2V5cHJlc3MnKSB7XHJcblx0XHR0aGlzLmNoYXJDb2RlID0gZXYuY2hhckNvZGUgfHwgZXYua2V5Q29kZTtcclxuXHR9XHJcblx0ZWxzZSBpZiAoZXYua2V5Q29kZSAmJiAoZXYua2V5Q29kZSA9PT0gNDYpKSB7XHJcblx0XHR0aGlzLmtleUNvZGUgPSAxMjc7XHJcblx0fVxyXG5cdGVsc2Uge1xyXG5cdFx0dGhpcy5rZXlDb2RlID0gZXYua2V5Q29kZTtcclxuXHR9XHJcblx0dGhpcy5jbGllbnRYID0gZXYuY2xpZW50WDtcclxuXHR0aGlzLmNsaWVudFkgPSBldi5jbGllbnRZO1xyXG5cdHRoaXMuY3RybEtleSA9IGV2LmN0cmxLZXk7XHJcblx0dGhpcy50YXJnZXQgPSBldi50YXJnZXQgPyBldi50YXJnZXQgOiBldi5zcmNFbGVtZW50O1xyXG5cdGlmIChldHlwZS5zdWJzdHIoMCwgMykgIT09ICdrZXknKSB7XHJcblx0XHRpZiAoKHR5cGVvZihldi5vZmZzZXRYKSAhPT0gJ3VuZGVmaW5lZCcpICYmICh0eXBlb2YoZXYub2Zmc2V0WSkgIT09ICd1bmRlZmluZWQnKSkge1xyXG5cdFx0XHR0aGlzLm9mZnNldFggPSBldi5vZmZzZXRYO1xyXG5cdFx0XHR0aGlzLm9mZnNldFkgPSBldi5vZmZzZXRZO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAodGhpcy50YXJnZXQgJiYgKHRoaXMudGFyZ2V0Lm5vZGVUeXBlICE9PSAzKSAmJiAodHlwZW9mKGV2LmNsaWVudFgpID09PSAnbnVtYmVyJykpIHtcclxuXHRcdFx0dmFyIGxvYyA9IFN5cy5VSS5Eb21FbGVtZW50LmdldExvY2F0aW9uKHRoaXMudGFyZ2V0KTtcclxuXHRcdFx0dmFyIHcgPSBTeXMuVUkuRG9tRWxlbWVudC5fZ2V0V2luZG93KHRoaXMudGFyZ2V0KTtcclxuXHRcdFx0dGhpcy5vZmZzZXRYID0gKHcucGFnZVhPZmZzZXQgfHwgMCkgKyBldi5jbGllbnRYIC0gbG9jLng7XHJcblx0XHRcdHRoaXMub2Zmc2V0WSA9ICh3LnBhZ2VZT2Zmc2V0IHx8IDApICsgZXYuY2xpZW50WSAtIGxvYy55O1xyXG5cdFx0fVxyXG5cdH1cclxuXHR0aGlzLnNjcmVlblggPSBldi5zY3JlZW5YO1xyXG5cdHRoaXMuc2NyZWVuWSA9IGV2LnNjcmVlblk7XHJcblx0dGhpcy5zaGlmdEtleSA9IGV2LnNoaWZ0S2V5O1xyXG59XHJcblxyXG5cdGZ1bmN0aW9uIFN5cyRVSSREb21FdmVudCRwcmV2ZW50RGVmYXVsdCgpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuRG9tRXZlbnQucHJldmVudERlZmF1bHRcIiAvPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHRpZiAodGhpcy5yYXdFdmVudC5wcmV2ZW50RGVmYXVsdCkge1xyXG5cdFx0XHR0aGlzLnJhd0V2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmICh3aW5kb3cuZXZlbnQpIHtcclxuXHRcdFx0dGhpcy5yYXdFdmVudC5yZXR1cm5WYWx1ZSA9IGZhbHNlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkVUkkRG9tRXZlbnQkc3RvcFByb3BhZ2F0aW9uKCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb25cIiAvPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHRpZiAodGhpcy5yYXdFdmVudC5zdG9wUHJvcGFnYXRpb24pIHtcclxuXHRcdFx0dGhpcy5yYXdFdmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKHdpbmRvdy5ldmVudCkge1xyXG5cdFx0XHR0aGlzLnJhd0V2ZW50LmNhbmNlbEJ1YmJsZSA9IHRydWU7XHJcblx0XHR9XHJcblx0fVxyXG5TeXMuVUkuRG9tRXZlbnQucHJvdG90eXBlID0ge1xyXG5cdHByZXZlbnREZWZhdWx0OiBTeXMkVUkkRG9tRXZlbnQkcHJldmVudERlZmF1bHQsXHJcblx0c3RvcFByb3BhZ2F0aW9uOiBTeXMkVUkkRG9tRXZlbnQkc3RvcFByb3BhZ2F0aW9uXHJcbn1cclxuU3lzLlVJLkRvbUV2ZW50LnJlZ2lzdGVyQ2xhc3MoJ1N5cy5VSS5Eb21FdmVudCcpO1xyXG5cclxudmFyIHNpbXVsYXRpbmdFdmVudCA9IGZhbHNlO1xyXG4kc2ltdWxhdGVNdXRhdGlvbkV2ZW50ID0gU3lzLlVJLkRvbUV2ZW50LnNpbXVsYXRlID0gZnVuY3Rpb24gU3lzJFVJJERvbUV2ZW50JHNpbXVsYXRlTXV0YXRpb25FdmVudChlbGVtZW50LCBldmVudE5hbWUsIGJ1YmJsZXMsIGNhbmNlbGFibGUpIHtcclxuXHQvLyBEb24ndCBidWJibGUgdGhlIGV2ZW50IGJ5IGRlZmF1bHRcclxuXHRpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDMpIHtcclxuXHRcdGJ1YmJsZXMgPSBmYWxzZTtcclxuXHR9XHJcblxyXG5cdC8vIEFsbG93IGNhbGNlbGluZyB0aGUgZXZlbnQgYnkgZGVmYXVsdFxyXG5cdGlmIChhcmd1bWVudHMubGVuZ3RoIDwgNCkge1xyXG5cdFx0Y2FuY2VsYWJsZSA9IHRydWU7XHJcblx0fVxyXG5cdFxyXG5cdHRyeSB7XHJcblx0XHRzaW11bGF0aW5nRXZlbnQgPSB0cnVlO1xyXG5cdFx0aWYgKGVsZW1lbnQuZGlzcGF0Y2hFdmVudCkge1xyXG5cdFx0XHR2YXIgZXZ0ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoXCJldmVudHNcIik7XHJcblx0XHRcdGV2dC5pbml0RXZlbnQoZXZlbnROYW1lLCBidWJibGVzLCBjYW5jZWxhYmxlKTtcclxuXHRcdFx0ZWxlbWVudC5kaXNwYXRjaEV2ZW50KGV2dCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChlbGVtZW50LmZpcmVFdmVudCkge1xyXG5cdFx0XHRlbGVtZW50LmZpcmVFdmVudChcIm9uXCIgKyBldmVudE5hbWUpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRmaW5hbGx5IHtcclxuXHRcdHNpbXVsYXRpbmdFdmVudCA9IGZhbHNlO1xyXG5cdH1cclxufVxyXG5cclxuZnVuY3Rpb24gc2ltdWxhdGVFcnJvcihlKSB7XHJcblx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcblx0XHR0aHJvdyBlO1xyXG5cdH0sIDEpO1xyXG59XHJcblxyXG4kYWRkSGFuZGxlciA9IFN5cy5VSS5Eb21FdmVudC5hZGRIYW5kbGVyID0gZnVuY3Rpb24gU3lzJFVJJERvbUV2ZW50JGFkZEhhbmRsZXIoZWxlbWVudHMsIGV2ZW50TmFtZSwgaGFuZGxlciwgYXV0b1JlbW92ZSkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuRG9tRXZlbnQuYWRkSGFuZGxlclwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZWxlbWVudHNcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImV2ZW50TmFtZVwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImhhbmRsZXJcIiB0eXBlPVwiRnVuY3Rpb25cIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImF1dG9SZW1vdmVcIiB0eXBlPVwiQm9vbGVhblwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cclxuXHRpZiAoZXZlbnROYW1lID09PSBcImVycm9yXCIpIHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3lzLlJlcy5hZGRIYW5kbGVyQ2FudEJlVXNlZEZvckVycm9yKTtcclxuXHRTeXMuX3F1ZXJ5QWxsKGVsZW1lbnRzLCBmdW5jdGlvbihlbGVtZW50KSB7XHJcblx0XHRpZiAoIWVsZW1lbnQuX2V2ZW50cykge1xyXG5cdFx0XHRlbGVtZW50Ll9ldmVudHMgPSB7fTtcclxuXHRcdH1cclxuXHRcdHZhciBldmVudENhY2hlID0gZWxlbWVudC5fZXZlbnRzW2V2ZW50TmFtZV07XHJcblx0XHRpZiAoIWV2ZW50Q2FjaGUpIHtcclxuXHRcdFx0ZWxlbWVudC5fZXZlbnRzW2V2ZW50TmFtZV0gPSBldmVudENhY2hlID0gW107XHJcblx0XHR9XHJcblx0XHR2YXIgYnJvd3NlckhhbmRsZXI7XHJcblx0XHRpZiAoZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKSB7XHJcblx0XHRcdGJyb3dzZXJIYW5kbGVyID0gZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRcdGlmIChzaW11bGF0aW5nRXZlbnQgJiYgU3lzLkJyb3dzZXIubmFtZSA9PT0gXCJGaXJlZm94XCIpIHtcclxuXHRcdFx0XHRcdHRyeSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiBoYW5kbGVyLmNhbGwoZWxlbWVudCwgbmV3IFN5cy5VSS5Eb21FdmVudChlKSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRjYXRjaCAoZSkge1xyXG5cdFx0XHRcdFx0XHRzaW11bGF0ZUVycm9yKGUpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHJldHVybiBoYW5kbGVyLmNhbGwoZWxlbWVudCwgbmV3IFN5cy5VSS5Eb21FdmVudChlKSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGJyb3dzZXJIYW5kbGVyLCBmYWxzZSk7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChlbGVtZW50LmF0dGFjaEV2ZW50KSB7XHJcblx0XHRcdGJyb3dzZXJIYW5kbGVyID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0dmFyIGV4LCBldiA9IHt9O1xyXG5cdFx0XHRcdHRyeSB7ZXYgPSBTeXMuVUkuRG9tRWxlbWVudC5fZ2V0V2luZG93KGVsZW1lbnQpLmV2ZW50fSBjYXRjaChleCkge31cclxuXHRcdFx0XHRyZXR1cm4gaGFuZGxlci5jYWxsKGVsZW1lbnQsIG5ldyBTeXMuVUkuRG9tRXZlbnQoZXYpKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbGVtZW50LmF0dGFjaEV2ZW50KCdvbicgKyBldmVudE5hbWUsIGJyb3dzZXJIYW5kbGVyKTtcclxuXHRcdH1cclxuXHRcdGV2ZW50Q2FjaGUucHVzaCh7aGFuZGxlcjogaGFuZGxlciwgYnJvd3NlckhhbmRsZXI6IGJyb3dzZXJIYW5kbGVyLCBhdXRvUmVtb3ZlOiBhdXRvUmVtb3ZlIH0pO1xyXG5cdFx0aWYgKGF1dG9SZW1vdmUpIHtcclxuXHRcdFx0U3lzLlVJLkRvbUVsZW1lbnQuX29uRGlzcG9zZShlbGVtZW50LCBTeXMuVUkuRG9tRXZlbnQuX2Rpc3Bvc2VIYW5kbGVycyk7XHJcblx0XHR9XHJcblx0fSk7XHJcbn1cclxuXHJcblN5cy5yZWdpc3RlclBsdWdpbih7XHJcblx0bmFtZTogXCJhZGRIYW5kbGVyXCIsXHJcblx0ZGVzY3JpcHRpb246IFwiQSBjcm9zcy1icm93c2VyIHdheSB0byBhZGQgYSBET00gZXZlbnQgaGFuZGxlciB0byBhbiBlbGVtZW50LlwiLFxyXG5cdHBsdWdpbjogU3lzLlVJLkRvbUV2ZW50LmFkZEhhbmRsZXIsXHJcblx0cGFyYW1ldGVyczogW1xyXG5cdFx0e25hbWU6IFwiZWxlbWVudHNcIiwgZGVzY3JpcHRpb246IFwiVGhlIGVsZW1lbnQgb3IgdGV4dCBub2RlLCBvciBhcnJheSBvZiBlbGVtZW50cyBvciB0ZXh0IG5vZGVzLCB0aGF0IGV4cG9zZXMgdGhlIGV2ZW50LiBZb3UgbWF5IGFsc28gcGFzcyBhIERPTSBzZWxlY3RvciBvciBhcnJheSBvZiBET00gc2VsZWN0b3JzLlwifSxcclxuXHRcdHtuYW1lOiBcImV2ZW50TmFtZVwiLCB0eXBlOiBcIlN0cmluZ1wiLCBkZXNjcmlwdGlvbjogXCJUaGUgbmFtZSBvZiB0aGUgZXZlbnQuIERvIG5vdCBpbmNsdWRlIHRoZSAnb24nIHByZWZpeCwgZm9yIGV4YW1wbGUsICdjbGljaycgaW5zdGVhZCBvZiAnb25jbGljaycuXCJ9LFxyXG5cdFx0e25hbWU6IFwiaGFuZGxlclwiLCB0eXBlOiBcIkZ1bmN0aW9uXCIsIGRlc2NyaXB0aW9uOiBcIlRoZSBldmVudCBoYW5kbGVyIHRvIGFkZC5cIn0sXHJcblx0XHR7bmFtZTogXCJhdXRvUmVtb3ZlXCIsIHR5cGU6IFwiQm9vbGVhblwiLCBkZXNjcmlwdGlvbjogXCJXaGV0aGVyIHRoZSBoYW5kbGVyIHNob3VsZCBiZSByZW1vdmVkIGF1dG9tYXRpY2FsbHkgd2hlbiB0aGUgZWxlbWVudCBpcyBkaXNwb3NlZCBvZiwgc3VjaCBhcyB3aGVuIGFuIFVwZGF0ZVBhbmVsIHJlZnJlc2hlcywgb3IgU3lzLkFwcGxpY2F0aW9uLmRpc3Bvc2VFbGVtZW50IGlzIGNhbGxlZC5cIn1cclxuXHRdXHJcbn0pO1xyXG5cclxuJGFkZEhhbmRsZXJzID0gU3lzLlVJLkRvbUV2ZW50LmFkZEhhbmRsZXJzID0gZnVuY3Rpb24gU3lzJFVJJERvbUV2ZW50JGFkZEhhbmRsZXJzKGVsZW1lbnRzLCBldmVudHMsIGhhbmRsZXJPd25lciwgYXV0b1JlbW92ZSkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuRG9tRXZlbnQuYWRkSGFuZGxlcnNcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImVsZW1lbnRzXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJldmVudHNcIiB0eXBlPVwiT2JqZWN0XCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJoYW5kbGVyT3duZXJcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJhdXRvUmVtb3ZlXCIgdHlwZT1cIkJvb2xlYW5cIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHJcblx0U3lzLl9xdWVyeUFsbChlbGVtZW50cywgZnVuY3Rpb24oZWxlbWVudCkge1xyXG5cdFx0Zm9yICh2YXIgbmFtZSBpbiBldmVudHMpIHtcclxuXHRcdFx0dmFyIGhhbmRsZXIgPSBldmVudHNbbmFtZV07XHJcblx0XHRcdGlmICh0eXBlb2YoaGFuZGxlcikgIT09ICdmdW5jdGlvbicpIHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3lzLlJlcy5jYW50QWRkTm9uRnVuY3Rpb25oYW5kbGVyKTtcclxuXHRcdFx0aWYgKGhhbmRsZXJPd25lcikge1xyXG5cdFx0XHRcdGhhbmRsZXIgPSBGdW5jdGlvbi5jcmVhdGVEZWxlZ2F0ZShoYW5kbGVyT3duZXIsIGhhbmRsZXIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdCRhZGRIYW5kbGVyKGVsZW1lbnQsIG5hbWUsIGhhbmRsZXIsIGF1dG9SZW1vdmUgfHwgZmFsc2UpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG59XHJcblxyXG5TeXMucmVnaXN0ZXJQbHVnaW4oe1xyXG5cdG5hbWU6IFwiYWRkSGFuZGxlcnNcIixcclxuXHRkZXNjcmlwdGlvbjogXCJBZGRzIGEgbGlzdCBvZiBldmVudCBoYW5kbGVycyB0byBhbiBlbGVtZW50LiBJZiBhIGhhbmRsZXJPd25lciBpcyBzcGVjaWZpZWQsIGRlbGVnYXRlcyBhcmUgY3JlYXRlZCB3aXRoIGVhY2ggb2YgdGhlIGhhbmRsZXJzLlwiLFxyXG5cdHBsdWdpbjogU3lzLlVJLkRvbUV2ZW50LmFkZEhhbmRsZXJzLFxyXG5cdHBhcmFtZXRlcnM6IFtcclxuXHRcdHtuYW1lOiBcImVsZW1lbnRzXCIsIGRlc2NyaXB0aW9uOiBcIlRoZSBlbGVtZW50IG9yIHRleHQgbm9kZSwgb3IgYXJyYXkgb2YgZWxlbWVudCBvciB0ZXh0IG5vZGVzLCB0aGF0IGV4cG9zZXMgdGhlIGV2ZW50LiBZb3UgbWF5IGFsc28gcGFzcyBhIERPTSBzZWxlY3RvciBvciBhcnJheSBvZiBET00gc2VsZWN0b3JzLlwifSxcclxuXHRcdHtuYW1lOiBcImV2ZW50c1wiLCB0eXBlOiBcIk9iamVjdFwiLCBkZXNjcmlwdGlvbjogXCJBIGRpY3Rpb25hcnkgb2YgZXZlbnQgaGFuZGxlcnMuXCJ9LFxyXG5cdFx0e25hbWU6IFwiaGFuZGxlck93bmVyXCIsIGRlc2NyaXB0aW9uOiBcIlRoZSBvd25lciBvZiB0aGUgZXZlbnQgaGFuZGxlcnMgdGhhdCB3aWxsIGJlIHRoZSB0aGlzIHBvaW50ZXIgZm9yIHRoZSBkZWxlZ2F0ZXMgdGhhdCB3aWxsIGJlIGNyZWF0ZWQgZnJvbSB0aGUgaGFuZGxlcnMuXCJ9LFxyXG5cdFx0e25hbWU6IFwiYXV0b1JlbW92ZVwiLCB0eXBlOiBcIkJvb2xlYW5cIiwgZGVzY3JpcHRpb246IFwiV2hldGhlciB0aGUgaGFuZGxlciBzaG91bGQgYmUgcmVtb3ZlZCBhdXRvbWF0aWNhbGx5IHdoZW4gdGhlIGVsZW1lbnQgaXMgZGlzcG9zZWQgb2YsIHN1Y2ggYXMgd2hlbiBhbiBVcGRhdGVQYW5lbCByZWZyZXNoZXMsIG9yIFN5cy5BcHBsaWNhdGlvbi5kaXNwb3NlRWxlbWVudCBpcyBjYWxsZWQuXCJ9XHJcblx0XVxyXG59KTtcclxuXHJcbiRjbGVhckhhbmRsZXJzID0gU3lzLlVJLkRvbUV2ZW50LmNsZWFySGFuZGxlcnMgPSBmdW5jdGlvbiBTeXMkVUkkRG9tRXZlbnQkY2xlYXJIYW5kbGVycyhlbGVtZW50cykge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuRG9tRXZlbnQuY2xlYXJIYW5kbGVyc1wiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZWxlbWVudHNcIj48L3BhcmFtPlxyXG5cclxuXHRTeXMuX3F1ZXJ5QWxsKGVsZW1lbnRzLCBmdW5jdGlvbihlbGVtZW50KSB7XHJcblx0XHRTeXMuVUkuRG9tRXZlbnQuX2NsZWFySGFuZGxlcnMoZWxlbWVudCwgZmFsc2UpO1xyXG5cdH0pO1xyXG59XHJcblxyXG5TeXMucmVnaXN0ZXJQbHVnaW4oe1xyXG5cdG5hbWU6IFwiY2xlYXJIYW5kbGVyc1wiLFxyXG5cdGRlc2NyaXB0aW9uOiBcIkNsZWFycyBhbGwgdGhlIGV2ZW50IGhhbmRsZXJzIHRoYXQgd2VyZSBhZGRlZCB0byB0aGUgZWxlbWVudCBvciBhcnJheSBvZiBlbGVtZW50cy4gWW91IG1heSBhbHNvIHBhc3MgYSBET00gc2VsZWN0b3Igb3IgYXJyYXkgb2YgRE9NIHNlbGVjdG9ycy5cIixcclxuXHRwbHVnaW46IFN5cy5VSS5Eb21FdmVudC5jbGVhckhhbmRsZXJzLFxyXG5cdHBhcmFtZXRlcnM6IFtcclxuXHRcdHtuYW1lOiBcImVsZW1lbnRzXCIsIGRlc2NyaXB0aW9uOiBcIlRoZSBlbGVtZW50IG9yIHRleHQgbm9kZSwgb3IgYW4gYXJyYXkgb2YgZWxlbWVudHMgb3IgdGV4dCBub2Rlcy5cIn1cclxuXHRdXHJcbn0pO1xyXG5cclxuU3lzLlVJLkRvbUV2ZW50Ll9jbGVhckhhbmRsZXJzID0gZnVuY3Rpb24gU3lzJFVJJERvbUV2ZW50JF9jbGVhckhhbmRsZXJzKGVsZW1lbnRzLCBhdXRvUmVtb3ZpbmcpIHtcclxuXHRTeXMuX3F1ZXJ5QWxsKGVsZW1lbnRzLCBmdW5jdGlvbihlbGVtZW50KSB7XHJcblx0XHRpZiAoZWxlbWVudC5fZXZlbnRzKSB7XHJcblx0XHRcdHZhciBjYWNoZSA9IGVsZW1lbnQuX2V2ZW50cztcclxuXHRcdFx0Zm9yICh2YXIgbmFtZSBpbiBjYWNoZSkge1xyXG5cdFx0XHRcdHZhciBoYW5kbGVycyA9IGNhY2hlW25hbWVdO1xyXG5cdFx0XHRcdGZvciAodmFyIGkgPSBoYW5kbGVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG5cdFx0XHRcdFx0dmFyIGVudHJ5ID0gaGFuZGxlcnNbaV07XHJcblx0XHRcdFx0XHRpZiAoIWF1dG9SZW1vdmluZyB8fCBlbnRyeS5hdXRvUmVtb3ZlKSB7XHJcblx0XHRcdFx0XHRcdCRyZW1vdmVIYW5kbGVyKGVsZW1lbnQsIG5hbWUsIGVudHJ5LmhhbmRsZXIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0pO1xyXG59XHJcblxyXG5TeXMuVUkuRG9tRXZlbnQuX2Rpc3Bvc2VIYW5kbGVycyA9IGZ1bmN0aW9uIFN5cyRVSSREb21FdmVudCRfZGlzcG9zZUhhbmRsZXJzKCkge1xyXG5cdFN5cy5VSS5Eb21FdmVudC5fY2xlYXJIYW5kbGVycyh0aGlzLCB0cnVlKTtcclxufVxyXG5cclxuJHJlbW92ZUhhbmRsZXIgPSBTeXMuVUkuRG9tRXZlbnQucmVtb3ZlSGFuZGxlciA9IGZ1bmN0aW9uIFN5cyRVSSREb21FdmVudCRyZW1vdmVIYW5kbGVyKGVsZW1lbnRzLCBldmVudE5hbWUsIGhhbmRsZXIpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLkRvbUV2ZW50LnJlbW92ZUhhbmRsZXJcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImVsZW1lbnRzXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJldmVudE5hbWVcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJoYW5kbGVyXCIgdHlwZT1cIkZ1bmN0aW9uXCI+PC9wYXJhbT5cclxuXHJcblx0U3lzLlVJLkRvbUV2ZW50Ll9yZW1vdmVIYW5kbGVyKGVsZW1lbnRzLCBldmVudE5hbWUsIGhhbmRsZXIpO1xyXG59XHJcblN5cy5VSS5Eb21FdmVudC5fcmVtb3ZlSGFuZGxlciA9IGZ1bmN0aW9uIFN5cyRVSSREb21FdmVudCRfcmVtb3ZlSGFuZGxlcihlbGVtZW50cywgZXZlbnROYW1lLCBoYW5kbGVyKSB7XHJcblx0U3lzLl9xdWVyeUFsbChlbGVtZW50cywgZnVuY3Rpb24oZWxlbWVudCkge1xyXG5cdFx0dmFyIGJyb3dzZXJIYW5kbGVyID0gbnVsbDtcclxuXHRcdGlmICgodHlwZW9mKGVsZW1lbnQuX2V2ZW50cykgIT09ICdvYmplY3QnKSB8fCAhZWxlbWVudC5fZXZlbnRzKSB7XHJcblx0XHRcdC8vIHRlbXBvcmFyeSBkZWJ1Z2dpbmcgY29kZSwgc2hvdWxkIGJlIHJlbW92ZWQgYXMgc29vbiBhcyBjYXVzZSBvZiBlcnJvciBpcyBkaXNjb3ZlcmVkXHJcblx0XHRcdGlmICh0eXBlb2YoY29uc29sZSkgIT09ICd1bmRlZmluZWQnICYmIGNvbnNvbGUuZXJyb3IpIHtcclxuXHRcdFx0XHRjb25zb2xlLmVycm9yKFwiZWxlbWVudCBldmVudHMgZG9lcyBub3QgZXhpc3RcIik7XHJcblx0XHRcdFx0Y29uc29sZS5lcnJvcihcImhhbmRsZXI6IFwiICsgaGFuZGxlci50b1N0cmluZygpKTtcclxuXHRcdFx0XHRjb25zb2xlLmVycm9yKFN5cy5SZXMuZXZlbnRIYW5kbGVySW52YWxpZCk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0dmFyIGNhY2hlID0gZWxlbWVudC5fZXZlbnRzW2V2ZW50TmFtZV07XHJcblx0XHRpZiAoIShjYWNoZSBpbnN0YW5jZW9mIEFycmF5KSkge1xyXG5cdFx0XHQvLyB0ZW1wb3JhcnkgZGVidWdnaW5nIGNvZGUsIHNob3VsZCBiZSByZW1vdmVkIGFzIHNvb24gYXMgY2F1c2Ugb2YgZXJyb3IgaXMgZGlzY292ZXJlZFxyXG5cdFx0XHRpZiAodHlwZW9mKGNvbnNvbGUpICE9PSAndW5kZWZpbmVkJyAmJiBjb25zb2xlLmVycm9yKSB7XHJcblx0XHRcdFx0Y29uc29sZS5lcnJvcihcImNhY2hlIGlzIG5vdCBhbiBhcnJheTogXCIgKyBjYWNoZSk7XHJcblx0XHRcdFx0Y29uc29sZS5lcnJvcihcImhhbmRsZXI6IFwiICsgaGFuZGxlci50b1N0cmluZygpKTtcclxuXHRcdFx0XHRjb25zb2xlLmVycm9yKFN5cy5SZXMuZXZlbnRIYW5kbGVySW52YWxpZCk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0Zm9yICh2YXIgaSA9IDAsIGwgPSBjYWNoZS5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuXHRcdFx0aWYgKGNhY2hlW2ldLmhhbmRsZXIgPT09IGhhbmRsZXIpIHtcclxuXHRcdFx0XHRicm93c2VySGFuZGxlciA9IGNhY2hlW2ldLmJyb3dzZXJIYW5kbGVyO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRpZiAodHlwZW9mKGJyb3dzZXJIYW5kbGVyKSAhPT0gJ2Z1bmN0aW9uJykge1xyXG5cdFx0XHQvLyB0ZW1wb3JhcnkgZGVidWdnaW5nIGNvZGUsIHNob3VsZCBiZSByZW1vdmVkIGFzIHNvb24gYXMgY2F1c2Ugb2YgZXJyb3IgaXMgZGlzY292ZXJlZFxyXG5cdFx0XHRpZiAodHlwZW9mKGNvbnNvbGUpICE9PSAndW5kZWZpbmVkJyAmJiBjb25zb2xlLmVycm9yKSB7XHJcblx0XHRcdFx0Y29uc29sZS5lcnJvcihcImhhbmRsZXIgZXZlbnQgY291bGQgbm90IGJlIGZvdW5kXCIpO1xyXG5cdFx0XHRcdGNvbnNvbGUuZXJyb3IoXCJoYW5kbGVyOiBcIiArIGhhbmRsZXIudG9TdHJpbmcoKSk7XHJcblx0XHRcdFx0Y29uc29sZS5lcnJvcihTeXMuUmVzLmV2ZW50SGFuZGxlckludmFsaWQpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdGlmIChlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIpIHtcclxuXHRcdFx0ZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgYnJvd3NlckhhbmRsZXIsIGZhbHNlKTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKGVsZW1lbnQuZGV0YWNoRXZlbnQpIHtcclxuXHRcdFx0ZWxlbWVudC5kZXRhY2hFdmVudCgnb24nICsgZXZlbnROYW1lLCBicm93c2VySGFuZGxlcik7XHJcblx0XHR9XHJcblx0XHRjYWNoZS5zcGxpY2UoaSwgMSk7XHJcblxyXG5cdFx0aWYgKGNhY2hlLmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0ZGVsZXRlIGVsZW1lbnQuX2V2ZW50c1tldmVudE5hbWVdO1xyXG5cclxuXHRcdGZvciAodmFyIHByb3AgaW4gZWxlbWVudC5fZXZlbnRzKSB7XHJcblx0XHRcdGlmIChlbGVtZW50Ll9ldmVudHMuaGFzT3duUHJvcGVydHkocHJvcCkpIHtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRlbGVtZW50Ll9ldmVudHMgPSBudWxsO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG59XHJcblxyXG5TeXMucmVnaXN0ZXJQbHVnaW4oe1xyXG5cdG5hbWU6IFwicmVtb3ZlSGFuZGxlclwiLFxyXG5cdGRlc2NyaXB0aW9uOiBcIkEgY3Jvc3MtYnJvd3NlciB3YXkgdG8gcmVtb3ZlIGEgRE9NIGV2ZW50IGhhbmRsZXIgZnJvbSBhbiBlbGVtZW50LiBZb3UgbWF5IGFsc28gcGFzcyBhIERPTSBzZWxlY3RvciBvciBhcnJheSBvZiBET00gc2VsZWN0b3JzLlwiLFxyXG5cdHBsdWdpbjogU3lzLlVJLkRvbUV2ZW50LnJlbW92ZUhhbmRsZXIsXHJcblx0cGFyYW1ldGVyczogW1xyXG5cdFx0e25hbWU6IFwiZWxlbWVudHNcIiwgZGVzY3JpcHRpb246IFwiVGhlIGVsZW1lbnQgb3IgdGV4dCBub2RlLCBvciBhcnJheSBvZiBlbGVtZW50cyBvciB0ZXh0IG5vZGVzLCB0aGF0IGV4cG9zZXMgdGhlIGV2ZW50LlwifSxcclxuXHRcdHtuYW1lOiBcImV2ZW50TmFtZVwiLCB0eXBlOiBcIlN0cmluZ1wiLCBkZXNjcmlwdGlvbjogXCJUaGUgbmFtZSBvZiB0aGUgZXZlbnQuIERvIG5vdCBpbmNsdWRlIHRoZSAnb24nIHByZWZpeCwgZm9yIGV4YW1wbGUsICdjbGljaycgaW5zdGVhZCBvZiAnb25jbGljaycuXCJ9LFxyXG5cdFx0e25hbWU6IFwiaGFuZGxlclwiLCB0eXBlOiBcIkZ1bmN0aW9uXCIsIGRlc2NyaXB0aW9uOiBcIlRoZSBldmVudCBoYW5kbGVyIHRvIHJlbW92ZS5cIn1cclxuXHRdXHJcbn0pO1xyXG5cclxuU3lzLlVJLkRvbUV2ZW50Ll9lbnN1cmVEb21Ob2RlID0gZnVuY3Rpb24gU3lzJFVJJERvbUV2ZW50JF9lbnN1cmVEb21Ob2RlKGVsZW1lbnQpIHtcclxuXHRpZiAoZWxlbWVudCAmJiBlbGVtZW50LnRhZ05hbWUgJiYgKGVsZW1lbnQudGFnTmFtZS50b1VwcGVyQ2FzZSgpID09PSBcIlNDUklQVFwiKSkgcmV0dXJuO1xyXG5cdHZhciBkb2MgPSBlbGVtZW50ID8gKGVsZW1lbnQub3duZXJEb2N1bWVudCB8fCBlbGVtZW50LmRvY3VtZW50IHx8IGVsZW1lbnQpIDogbnVsbDtcclxuXHRpZiAoIWVsZW1lbnQgfHxcclxuXHRcdCgodHlwZW9mKGVsZW1lbnQuZG9jdW1lbnQpICE9PSAnb2JqZWN0JykgJiYgKGVsZW1lbnQgIT0gZG9jKSAmJiAodHlwZW9mKGVsZW1lbnQubm9kZVR5cGUpICE9PSAnbnVtYmVyJykpKSB7XHJcblx0XHR0aHJvdyBFcnJvci5hcmd1bWVudChcImVsZW1lbnRcIiwgU3lzLlJlcy5hcmd1bWVudERvbU5vZGUpO1xyXG5cdH1cclxufVxyXG5cclxuU3lzLl9xdWVyeUFsbCA9IGZ1bmN0aW9uIFN5cyRfcXVlcnlBbGwoc2VsZWN0b3IsIGNhbGxiYWNrKSB7XHJcblx0dmFyIGVsZW1lbnRzID0gc2VsZWN0b3I7XHJcblx0aWYgKHR5cGVvZihzZWxlY3RvcikgPT09IFwic3RyaW5nXCIpIHtcclxuXHRcdGVsZW1lbnRzID0gU3lzLnF1ZXJ5KHNlbGVjdG9yKTtcclxuXHR9XHJcblx0U3lzLl9mb3JlYWNoKGVsZW1lbnRzLCBmdW5jdGlvbihzZWxlY3Rvcikge1xyXG5cdFx0dmFyIGVsZW1lbnRzID0gc2VsZWN0b3I7XHJcblx0XHRpZiAodHlwZW9mKHNlbGVjdG9yKSA9PT0gXCJzdHJpbmdcIikge1xyXG5cdFx0XHRlbGVtZW50cyA9IFN5cy5xdWVyeShzZWxlY3Rvcik7XHJcblx0XHR9XHJcblx0XHRTeXMuX2ZvcmVhY2goZWxlbWVudHMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcclxuXHRcdFx0U3lzLlVJLkRvbUV2ZW50Ll9lbnN1cmVEb21Ob2RlKGVsZW1lbnQpO1xyXG5cdFx0XHR2YXIgbm9kZVR5cGUgPSBlbGVtZW50Lm5vZGVUeXBlO1xyXG5cdFx0XHRpZiAobm9kZVR5cGUgPT09IDMgfHwgbm9kZVR5cGUgPT09IDIgfHwgbm9kZVR5cGUgPT09IDgpIHJldHVybjtcclxuXHRcdFx0Y2FsbGJhY2soZWxlbWVudCk7XHJcblx0XHR9KTtcclxuXHR9KTtcclxufVxyXG5TeXMuVUkuRG9tRWxlbWVudCA9IGZ1bmN0aW9uIFN5cyRVSSREb21FbGVtZW50KCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuRG9tRWxlbWVudC4jY3RvclwiIC8+XHJcblx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0dGhyb3cgRXJyb3Iubm90SW1wbGVtZW50ZWQoKTtcclxufVxyXG5TeXMuVUkuRG9tRWxlbWVudC5yZWdpc3RlckNsYXNzKCdTeXMuVUkuRG9tRWxlbWVudCcpO1xyXG5cclxuU3lzLlVJLkRvbUVsZW1lbnQuYWRkQ3NzQ2xhc3MgPSBmdW5jdGlvbiBTeXMkVUkkRG9tRWxlbWVudCRhZGRDc3NDbGFzcyhlbGVtZW50LCBjbGFzc05hbWUpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLkRvbUVsZW1lbnQuYWRkQ3NzQ2xhc3NcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImVsZW1lbnRcIiBkb21FbGVtZW50PVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiY2xhc3NOYW1lXCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblxyXG5cdGlmICghU3lzLlVJLkRvbUVsZW1lbnQuY29udGFpbnNDc3NDbGFzcyhlbGVtZW50LCBjbGFzc05hbWUpKSB7XHJcblx0XHRpZiAoZWxlbWVudC5jbGFzc05hbWUgPT09ICcnKSB7XHJcblx0XHRcdGVsZW1lbnQuY2xhc3NOYW1lID0gY2xhc3NOYW1lO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGVsZW1lbnQuY2xhc3NOYW1lICs9ICcgJyArIGNsYXNzTmFtZTtcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcblN5cy5VSS5Eb21FbGVtZW50LmNvbnRhaW5zQ3NzQ2xhc3MgPSBmdW5jdGlvbiBTeXMkVUkkRG9tRWxlbWVudCRjb250YWluc0Nzc0NsYXNzKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuRG9tRWxlbWVudC5jb250YWluc0Nzc0NsYXNzXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJlbGVtZW50XCIgZG9tRWxlbWVudD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImNsYXNzTmFtZVwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiQm9vbGVhblwiPjwvcmV0dXJucz5cclxuXHJcblx0cmV0dXJuIEFycmF5LmNvbnRhaW5zKGVsZW1lbnQuY2xhc3NOYW1lLnNwbGl0KCcgJyksIGNsYXNzTmFtZSk7XHJcbn1cclxuXHJcblN5cy5VSS5Eb21FbGVtZW50LmdldEJvdW5kcyA9IGZ1bmN0aW9uIFN5cyRVSSREb21FbGVtZW50JGdldEJvdW5kcyhlbGVtZW50KSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5Eb21FbGVtZW50LmdldEJvdW5kc1wiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZWxlbWVudFwiIGRvbUVsZW1lbnQ9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIlN5cy5VSS5Cb3VuZHNcIj48L3JldHVybnM+XHJcblxyXG5cdHZhciBvZmZzZXQgPSBTeXMuVUkuRG9tRWxlbWVudC5nZXRMb2NhdGlvbihlbGVtZW50KTtcclxuXHJcblx0cmV0dXJuIG5ldyBTeXMuVUkuQm91bmRzKG9mZnNldC54LCBvZmZzZXQueSwgZWxlbWVudC5vZmZzZXRXaWR0aCB8fCAwLCBlbGVtZW50Lm9mZnNldEhlaWdodCB8fCAwKTtcclxufVxyXG5cclxuJGdldCA9IFN5cy5VSS5Eb21FbGVtZW50LmdldEVsZW1lbnRCeUlkID0gZnVuY3Rpb24gU3lzJFVJJERvbUVsZW1lbnQkZ2V0RWxlbWVudEJ5SWQoaWQsIGVsZW1lbnQpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLkRvbUVsZW1lbnQuZ2V0RWxlbWVudEJ5SWRcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImlkXCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZWxlbWVudFwiIGRvbUVsZW1lbnQ9XCJ0cnVlXCIgb3B0aW9uYWw9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxyZXR1cm5zIGRvbUVsZW1lbnQ9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcmV0dXJucz5cclxuXHJcblx0cmV0dXJuIFN5cy5nZXQoXCIjXCIgKyBpZCwgZWxlbWVudCB8fCBudWxsKTtcclxufVxyXG5cclxuaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QpIHtcclxuXHRTeXMuVUkuRG9tRWxlbWVudC5nZXRMb2NhdGlvbiA9IGZ1bmN0aW9uIFN5cyRVSSREb21FbGVtZW50JGdldExvY2F0aW9uKGVsZW1lbnQpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuRG9tRWxlbWVudC5nZXRMb2NhdGlvblwiIC8+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJlbGVtZW50XCIgZG9tRWxlbWVudD1cInRydWVcIj48L3BhcmFtPlxyXG5cdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJTeXMuVUkuUG9pbnRcIj48L3JldHVybnM+XHJcblxyXG5cdFx0aWYgKGVsZW1lbnQuc2VsZiB8fCBlbGVtZW50Lm5vZGVUeXBlID09PSA5IHx8XHJcblx0XHRcdChlbGVtZW50ID09PSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHx8XHJcblx0XHRcdChlbGVtZW50LnBhcmVudE5vZGUgPT09IGVsZW1lbnQub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpKSB7XHJcblx0XHRcdHJldHVybiBuZXcgU3lzLlVJLlBvaW50KDAsIDApO1xyXG5cdFx0fVxyXG5cdFx0dmFyIGNsaWVudFJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG5cdFx0aWYgKCFjbGllbnRSZWN0KSB7XHJcblx0XHRcdHJldHVybiBuZXcgU3lzLlVJLlBvaW50KDAsMCk7XHJcblx0XHR9XHJcblx0XHR2YXIgZXgsIGRvY3VtZW50RWxlbWVudCA9IGVsZW1lbnQub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsXHJcblx0XHRcdG9mZnNldFggPSBNYXRoLnJvdW5kKGNsaWVudFJlY3QubGVmdCkgKyBkb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCxcclxuXHRcdFx0b2Zmc2V0WSA9IE1hdGgucm91bmQoY2xpZW50UmVjdC50b3ApICsgZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDtcclxuXHRcdGlmIChpc0Jyb3dzZXIoXCJJbnRlcm5ldEV4cGxvcmVyXCIpKSB7XHJcblx0XHRcdHRyeSB7XHJcblx0XHRcdFx0dmFyIGYgPSBlbGVtZW50Lm93bmVyRG9jdW1lbnQucGFyZW50V2luZG93LmZyYW1lRWxlbWVudCB8fCBudWxsO1xyXG5cdFx0XHRcdGlmIChmKSB7XHJcblx0XHRcdFx0XHR2YXIgb2Zmc2V0ID0gKGYuZnJhbWVCb3JkZXIgPT09IFwiMFwiIHx8IGYuZnJhbWVCb3JkZXIgPT09IFwibm9cIikgPyAyIDogMDtcclxuXHRcdFx0XHRcdG9mZnNldFggKz0gb2Zmc2V0O1xyXG5cdFx0XHRcdFx0b2Zmc2V0WSArPSBvZmZzZXQ7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGNhdGNoKGV4KSB7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKFN5cy5Ccm93c2VyLnZlcnNpb24gPT09IDcgJiYgIWRvY3VtZW50LmRvY3VtZW50TW9kZSkge1xyXG5cdFx0XHRcdHZhciBib2R5ID0gZG9jdW1lbnQuYm9keSxcclxuXHRcdFx0XHRcdHJlY3QgPSBib2R5LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLFxyXG5cdFx0XHRcdFx0em9vbSA9IChyZWN0LnJpZ2h0LXJlY3QubGVmdCkgLyBib2R5LmNsaWVudFdpZHRoO1xyXG5cdFx0XHRcdHpvb20gPSBNYXRoLnJvdW5kKHpvb20gKiAxMDApO1xyXG5cdFx0XHRcdHpvb20gPSAoem9vbSAtIHpvb20gJSA1KSAvIDEwMDtcclxuXHRcdFx0XHRpZiAoIWlzTmFOKHpvb20pICYmICh6b29tICE9PSAxKSkge1xyXG5cdFx0XHRcdFx0b2Zmc2V0WCA9IE1hdGgucm91bmQob2Zmc2V0WCAvIHpvb20pO1xyXG5cdFx0XHRcdFx0b2Zmc2V0WSA9IE1hdGgucm91bmQob2Zmc2V0WSAvIHpvb20pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAoKGRvY3VtZW50LmRvY3VtZW50TW9kZSB8fCAwKSA8IDgpIHtcclxuXHRcdFx0XHRvZmZzZXRYIC09IGRvY3VtZW50RWxlbWVudC5jbGllbnRMZWZ0O1xyXG5cdFx0XHRcdG9mZnNldFkgLT0gZG9jdW1lbnRFbGVtZW50LmNsaWVudFRvcDtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIG5ldyBTeXMuVUkuUG9pbnQob2Zmc2V0WCwgb2Zmc2V0WSk7XHJcblx0fVxyXG59XHJcbmVsc2UgaWYgKGlzQnJvd3NlcihcIlNhZmFyaVwiKSkge1xyXG5cdFN5cy5VSS5Eb21FbGVtZW50LmdldExvY2F0aW9uID0gZnVuY3Rpb24gU3lzJFVJJERvbUVsZW1lbnQkZ2V0TG9jYXRpb24oZWxlbWVudCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5Eb21FbGVtZW50LmdldExvY2F0aW9uXCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImVsZW1lbnRcIiBkb21FbGVtZW50PVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0XHQvLy8gPHJldHVybnMgdHlwZT1cIlN5cy5VSS5Qb2ludFwiPjwvcmV0dXJucz5cclxuXHJcblx0XHRpZiAoKGVsZW1lbnQud2luZG93ICYmIChlbGVtZW50LndpbmRvdyA9PT0gZWxlbWVudCkpIHx8IGVsZW1lbnQubm9kZVR5cGUgPT09IDkpIHJldHVybiBuZXcgU3lzLlVJLlBvaW50KDAsMCk7XHJcblxyXG5cdFx0dmFyIG9mZnNldFggPSAwLCBvZmZzZXRZID0gMCxcclxuXHRcdFx0cGFyZW50LFxyXG5cdFx0XHRwcmV2aW91cyA9IG51bGwsXHJcblx0XHRcdHByZXZpb3VzU3R5bGUgPSBudWxsLFxyXG5cdFx0XHRjdXJyZW50U3R5bGU7XHJcblx0XHRmb3IgKHBhcmVudCA9IGVsZW1lbnQ7IHBhcmVudDsgcHJldmlvdXMgPSBwYXJlbnQsIHByZXZpb3VzU3R5bGUgPSBjdXJyZW50U3R5bGUsIHBhcmVudCA9IHBhcmVudC5vZmZzZXRQYXJlbnQpIHtcclxuXHRcdFx0Y3VycmVudFN0eWxlID0gU3lzLlVJLkRvbUVsZW1lbnQuX2dldEN1cnJlbnRTdHlsZShwYXJlbnQpO1xyXG5cdFx0XHR2YXIgdGFnTmFtZSA9IHBhcmVudC50YWdOYW1lID8gcGFyZW50LnRhZ05hbWUudG9VcHBlckNhc2UoKSA6IG51bGw7XHJcblxyXG5cdFx0XHRpZiAoKHBhcmVudC5vZmZzZXRMZWZ0IHx8IHBhcmVudC5vZmZzZXRUb3ApICYmXHJcblx0XHRcdFx0KCh0YWdOYW1lICE9PSBcIkJPRFlcIikgfHwgKCFwcmV2aW91c1N0eWxlIHx8IHByZXZpb3VzU3R5bGUucG9zaXRpb24gIT09IFwiYWJzb2x1dGVcIikpKSB7XHJcblx0XHRcdFx0b2Zmc2V0WCArPSBwYXJlbnQub2Zmc2V0TGVmdDtcclxuXHRcdFx0XHRvZmZzZXRZICs9IHBhcmVudC5vZmZzZXRUb3A7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChwcmV2aW91cyAmJiBTeXMuQnJvd3Nlci52ZXJzaW9uID49IDMpIHtcclxuXHRcdFx0XHRvZmZzZXRYICs9IHBhcnNlSW50KGN1cnJlbnRTdHlsZS5ib3JkZXJMZWZ0V2lkdGgpO1xyXG5cdFx0XHRcdG9mZnNldFkgKz0gcGFyc2VJbnQoY3VycmVudFN0eWxlLmJvcmRlclRvcFdpZHRoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGN1cnJlbnRTdHlsZSA9IFN5cy5VSS5Eb21FbGVtZW50Ll9nZXRDdXJyZW50U3R5bGUoZWxlbWVudCk7XHJcblx0XHR2YXIgZWxlbWVudFBvc2l0aW9uID0gY3VycmVudFN0eWxlID8gY3VycmVudFN0eWxlLnBvc2l0aW9uIDogbnVsbDtcclxuXHRcdGlmICghZWxlbWVudFBvc2l0aW9uIHx8IChlbGVtZW50UG9zaXRpb24gIT09IFwiYWJzb2x1dGVcIikpIHtcclxuXHRcdFx0Zm9yIChwYXJlbnQgPSBlbGVtZW50LnBhcmVudE5vZGU7IHBhcmVudDsgcGFyZW50ID0gcGFyZW50LnBhcmVudE5vZGUpIHtcclxuXHRcdFx0XHR0YWdOYW1lID0gcGFyZW50LnRhZ05hbWUgPyBwYXJlbnQudGFnTmFtZS50b1VwcGVyQ2FzZSgpIDogbnVsbDtcclxuXHJcblx0XHRcdFx0aWYgKCh0YWdOYW1lICE9PSBcIkJPRFlcIikgJiYgKHRhZ05hbWUgIT09IFwiSFRNTFwiKSAmJiAocGFyZW50LnNjcm9sbExlZnQgfHwgcGFyZW50LnNjcm9sbFRvcCkpIHtcclxuXHRcdFx0XHRcdG9mZnNldFggLT0gKHBhcmVudC5zY3JvbGxMZWZ0IHx8IDApO1xyXG5cdFx0XHRcdFx0b2Zmc2V0WSAtPSAocGFyZW50LnNjcm9sbFRvcCB8fCAwKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Y3VycmVudFN0eWxlID0gU3lzLlVJLkRvbUVsZW1lbnQuX2dldEN1cnJlbnRTdHlsZShwYXJlbnQpO1xyXG5cdFx0XHRcdHZhciBwYXJlbnRQb3NpdGlvbiA9IGN1cnJlbnRTdHlsZSA/IGN1cnJlbnRTdHlsZS5wb3NpdGlvbiA6IG51bGw7XHJcblxyXG5cdFx0XHRcdGlmIChwYXJlbnRQb3NpdGlvbiAmJiAocGFyZW50UG9zaXRpb24gPT09IFwiYWJzb2x1dGVcIikpIGJyZWFrO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gbmV3IFN5cy5VSS5Qb2ludChvZmZzZXRYLCBvZmZzZXRZKTtcclxuXHR9XHJcbn1cclxuZWxzZSB7XHJcblx0U3lzLlVJLkRvbUVsZW1lbnQuZ2V0TG9jYXRpb24gPSBmdW5jdGlvbiBTeXMkVUkkRG9tRWxlbWVudCRnZXRMb2NhdGlvbihlbGVtZW50KSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLkRvbUVsZW1lbnQuZ2V0TG9jYXRpb25cIiAvPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiZWxlbWVudFwiIGRvbUVsZW1lbnQ9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiU3lzLlVJLlBvaW50XCI+PC9yZXR1cm5zPlxyXG5cclxuXHRcdGlmICgoZWxlbWVudC53aW5kb3cgJiYgKGVsZW1lbnQud2luZG93ID09PSBlbGVtZW50KSkgfHwgZWxlbWVudC5ub2RlVHlwZSA9PT0gOSkgcmV0dXJuIG5ldyBTeXMuVUkuUG9pbnQoMCwwKTtcclxuXHJcblx0XHR2YXIgb2Zmc2V0WCA9IDAsIG9mZnNldFkgPSAwLFxyXG5cdFx0XHRwYXJlbnQsXHJcblx0XHRcdHByZXZpb3VzID0gbnVsbCxcclxuXHRcdFx0cHJldmlvdXNTdHlsZSA9IG51bGwsXHJcblx0XHRcdGN1cnJlbnRTdHlsZSA9IG51bGw7XHJcblx0XHRmb3IgKHBhcmVudCA9IGVsZW1lbnQ7IHBhcmVudDsgcHJldmlvdXMgPSBwYXJlbnQsIHByZXZpb3VzU3R5bGUgPSBjdXJyZW50U3R5bGUsIHBhcmVudCA9IHBhcmVudC5vZmZzZXRQYXJlbnQpIHtcclxuXHRcdFx0dmFyIHRhZ05hbWUgPSBwYXJlbnQudGFnTmFtZSA/IHBhcmVudC50YWdOYW1lLnRvVXBwZXJDYXNlKCkgOiBudWxsO1xyXG5cdFx0XHRjdXJyZW50U3R5bGUgPSBTeXMuVUkuRG9tRWxlbWVudC5fZ2V0Q3VycmVudFN0eWxlKHBhcmVudCk7XHJcblxyXG5cdFx0XHRpZiAoKHBhcmVudC5vZmZzZXRMZWZ0IHx8IHBhcmVudC5vZmZzZXRUb3ApICYmXHJcblx0XHRcdFx0ISgodGFnTmFtZSA9PT0gXCJCT0RZXCIpICYmXHJcblx0XHRcdFx0KCFwcmV2aW91c1N0eWxlIHx8IHByZXZpb3VzU3R5bGUucG9zaXRpb24gIT09IFwiYWJzb2x1dGVcIikpKSB7XHJcblxyXG5cdFx0XHRcdG9mZnNldFggKz0gcGFyZW50Lm9mZnNldExlZnQ7XHJcblx0XHRcdFx0b2Zmc2V0WSArPSBwYXJlbnQub2Zmc2V0VG9wO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAocHJldmlvdXMgIT09IG51bGwgJiYgY3VycmVudFN0eWxlKSB7XHJcblx0XHRcdFx0aWYgKCh0YWdOYW1lICE9PSBcIlRBQkxFXCIpICYmICh0YWdOYW1lICE9PSBcIlREXCIpICYmICh0YWdOYW1lICE9PSBcIkhUTUxcIikpIHtcclxuXHRcdFx0XHRcdG9mZnNldFggKz0gcGFyc2VJbnQoY3VycmVudFN0eWxlLmJvcmRlckxlZnRXaWR0aCkgfHwgMDtcclxuXHRcdFx0XHRcdG9mZnNldFkgKz0gcGFyc2VJbnQoY3VycmVudFN0eWxlLmJvcmRlclRvcFdpZHRoKSB8fCAwO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAodGFnTmFtZSA9PT0gXCJUQUJMRVwiICYmXHJcblx0XHRcdFx0XHQoY3VycmVudFN0eWxlLnBvc2l0aW9uID09PSBcInJlbGF0aXZlXCIgfHwgY3VycmVudFN0eWxlLnBvc2l0aW9uID09PSBcImFic29sdXRlXCIpKSB7XHJcblx0XHRcdFx0XHRvZmZzZXRYICs9IHBhcnNlSW50KGN1cnJlbnRTdHlsZS5tYXJnaW5MZWZ0KSB8fCAwO1xyXG5cdFx0XHRcdFx0b2Zmc2V0WSArPSBwYXJzZUludChjdXJyZW50U3R5bGUubWFyZ2luVG9wKSB8fCAwO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGN1cnJlbnRTdHlsZSA9IFN5cy5VSS5Eb21FbGVtZW50Ll9nZXRDdXJyZW50U3R5bGUoZWxlbWVudCk7XHJcblx0XHR2YXIgZWxlbWVudFBvc2l0aW9uID0gY3VycmVudFN0eWxlID8gY3VycmVudFN0eWxlLnBvc2l0aW9uIDogbnVsbDtcclxuXHRcdGlmICghZWxlbWVudFBvc2l0aW9uIHx8IChlbGVtZW50UG9zaXRpb24gIT09IFwiYWJzb2x1dGVcIikpIHtcclxuXHRcdFx0Zm9yIChwYXJlbnQgPSBlbGVtZW50LnBhcmVudE5vZGU7IHBhcmVudDsgcGFyZW50ID0gcGFyZW50LnBhcmVudE5vZGUpIHtcclxuXHRcdFx0XHR0YWdOYW1lID0gcGFyZW50LnRhZ05hbWUgPyBwYXJlbnQudGFnTmFtZS50b1VwcGVyQ2FzZSgpIDogbnVsbDtcclxuXHJcblx0XHRcdFx0aWYgKCh0YWdOYW1lICE9PSBcIkJPRFlcIikgJiYgKHRhZ05hbWUgIT09IFwiSFRNTFwiKSAmJiAocGFyZW50LnNjcm9sbExlZnQgfHwgcGFyZW50LnNjcm9sbFRvcCkpIHtcclxuXHJcblx0XHRcdFx0XHRvZmZzZXRYIC09IChwYXJlbnQuc2Nyb2xsTGVmdCB8fCAwKTtcclxuXHRcdFx0XHRcdG9mZnNldFkgLT0gKHBhcmVudC5zY3JvbGxUb3AgfHwgMCk7XHJcblxyXG5cdFx0XHRcdFx0Y3VycmVudFN0eWxlID0gU3lzLlVJLkRvbUVsZW1lbnQuX2dldEN1cnJlbnRTdHlsZShwYXJlbnQpO1xyXG5cdFx0XHRcdFx0aWYgKGN1cnJlbnRTdHlsZSkge1xyXG5cdFx0XHRcdFx0XHRvZmZzZXRYICs9IHBhcnNlSW50KGN1cnJlbnRTdHlsZS5ib3JkZXJMZWZ0V2lkdGgpIHx8IDA7XHJcblx0XHRcdFx0XHRcdG9mZnNldFkgKz0gcGFyc2VJbnQoY3VycmVudFN0eWxlLmJvcmRlclRvcFdpZHRoKSB8fCAwO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIG5ldyBTeXMuVUkuUG9pbnQob2Zmc2V0WCwgb2Zmc2V0WSk7XHJcblx0fVxyXG59XHJcblxyXG5TeXMuVUkuRG9tRWxlbWVudC5pc0RvbUVsZW1lbnQgPSBmdW5jdGlvbiBTeXMkVUkkRG9tRWxlbWVudCRpc0RvbUVsZW1lbnQob2JqKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5Eb21FbGVtZW50LmlzRG9tRWxlbWVudFwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwib2JqXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIkJvb2xlYW5cIj48L3JldHVybnM+XHJcblxyXG5cdHJldHVybiBTeXMuX2lzRG9tRWxlbWVudChvYmopO1xyXG59XHJcblxyXG5TeXMuVUkuRG9tRWxlbWVudC5yZW1vdmVDc3NDbGFzcyA9IGZ1bmN0aW9uIFN5cyRVSSREb21FbGVtZW50JHJlbW92ZUNzc0NsYXNzKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuRG9tRWxlbWVudC5yZW1vdmVDc3NDbGFzc1wiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZWxlbWVudFwiIGRvbUVsZW1lbnQ9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJjbGFzc05hbWVcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHJcblx0dmFyIGN1cnJlbnRDbGFzc05hbWUgPSAnICcgKyBlbGVtZW50LmNsYXNzTmFtZSArICcgJztcclxuXHR2YXIgaW5kZXggPSBjdXJyZW50Q2xhc3NOYW1lLmluZGV4T2YoJyAnICsgY2xhc3NOYW1lICsgJyAnKTtcclxuXHRpZiAoaW5kZXggPj0gMCkge1xyXG5cdFx0ZWxlbWVudC5jbGFzc05hbWUgPSAoY3VycmVudENsYXNzTmFtZS5zdWJzdHIoMCwgaW5kZXgpICsgJyAnICtcclxuXHRcdFx0Y3VycmVudENsYXNzTmFtZS5zdWJzdHJpbmcoaW5kZXggKyBjbGFzc05hbWUubGVuZ3RoICsgMSwgY3VycmVudENsYXNzTmFtZS5sZW5ndGgpKS50cmltKCk7XHJcblx0fVxyXG59XHJcblxyXG5TeXMuVUkuRG9tRWxlbWVudC5yZXNvbHZlRWxlbWVudCA9IGZ1bmN0aW9uIFN5cyRVSSREb21FbGVtZW50JHJlc29sdmVFbGVtZW50KGVsZW1lbnRPckVsZW1lbnRJZCwgY29udGFpbmVyRWxlbWVudCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuRG9tRWxlbWVudC5yZXNvbHZlRWxlbWVudFwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZWxlbWVudE9yRWxlbWVudElkXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiY29udGFpbmVyRWxlbWVudFwiIGRvbUVsZW1lbnQ9XCJ0cnVlXCIgb3B0aW9uYWw9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxyZXR1cm5zIGRvbUVsZW1lbnQ9XCJ0cnVlXCI+PC9yZXR1cm5zPlxyXG5cclxuXHR2YXIgZWwgPSBlbGVtZW50T3JFbGVtZW50SWQ7XHJcblx0aWYgKCFlbCkgcmV0dXJuIG51bGw7XHJcblx0aWYgKHR5cGVvZihlbCkgPT09IFwic3RyaW5nXCIpIHtcclxuXHRcdGVsID0gU3lzLmdldChcIiNcIiArIGVsLCBjb250YWluZXJFbGVtZW50KTtcclxuXHRcdGlmICghZWwpIHtcclxuXHRcdFx0dGhyb3cgRXJyb3IuYXJndW1lbnQoXCJlbGVtZW50T3JFbGVtZW50SWRcIiwgU3RyaW5nLmZvcm1hdChTeXMuUmVzLmVsZW1lbnROb3RGb3VuZCwgZWxlbWVudE9yRWxlbWVudElkKSk7XHJcblx0XHR9XHJcblx0fVxyXG5cdGVsc2UgaWYoIVN5cy5VSS5Eb21FbGVtZW50LmlzRG9tRWxlbWVudChlbCkpIHtcclxuXHRcdHRocm93IEVycm9yLmFyZ3VtZW50KFwiZWxlbWVudE9yRWxlbWVudElkXCIsIFN5cy5SZXMuZXhwZWN0ZWRFbGVtZW50T3JJZCk7XHJcblx0fVxyXG5cdHJldHVybiBlbDtcclxufVxyXG5cclxuU3lzLlVJLkRvbUVsZW1lbnQucmFpc2VCdWJibGVFdmVudCA9IGZ1bmN0aW9uIFN5cyRVSSREb21FbGVtZW50JHJhaXNlQnViYmxlRXZlbnQoc291cmNlLCBhcmdzKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5Eb21FbGVtZW50LnJhaXNlQnViYmxlRXZlbnRcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInNvdXJjZVwiIGRvbUVsZW1lbnQ9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJhcmdzXCIgdHlwZT1cIlN5cy5FdmVudEFyZ3NcIj48L3BhcmFtPlxyXG5cclxuXHR2YXIgdGFyZ2V0ID0gc291cmNlO1xyXG5cdHdoaWxlICh0YXJnZXQpIHtcclxuXHRcdHZhciBjb250cm9sID0gdGFyZ2V0LmNvbnRyb2w7XHJcblx0XHRpZiAoY29udHJvbCAmJiBjb250cm9sLm9uQnViYmxlRXZlbnQgJiYgY29udHJvbC5yYWlzZUJ1YmJsZUV2ZW50KSB7XHJcblx0XHRcdGlmICghY29udHJvbC5vbkJ1YmJsZUV2ZW50KHNvdXJjZSwgYXJncykpIHtcclxuXHRcdFx0XHRjb250cm9sLl9yYWlzZUJ1YmJsZUV2ZW50KHNvdXJjZSwgYXJncyk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0dGFyZ2V0ID0gdGFyZ2V0LnBhcmVudE5vZGU7XHJcblx0fVxyXG59XHJcblxyXG5TeXMuVUkuRG9tRWxlbWVudC5fZW5zdXJlR2V0ID0gZnVuY3Rpb24gU3lzJFVJJERvbUVsZW1lbnQkX2Vuc3VyZUdldChzZWxlY3RvciwgY29udGV4dCwgYXJnKSB7XHJcblx0dmFyIHJldCA9IFN5cy5nZXQoc2VsZWN0b3IsIGNvbnRleHQpO1xyXG5cdGlmICghcmV0ICYmIHR5cGVvZihzZWxlY3RvcikgPT09IFwic3RyaW5nXCIpIHtcclxuXHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuUmVzLnNlbGVjdG9yTm90Rm91bmQsIHNlbGVjdG9yKSk7XHJcblx0fVxyXG5cdGVsc2UgaWYgKHJldCAmJiAhdGhpcy5pc0RvbUVsZW1lbnQocmV0KSkge1xyXG5cdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTdHJpbmcuZm9ybWF0KFN5cy5SZXMuZXhwZWN0ZWREb21FbGVtZW50T3JTZWxlY3RvciwgYXJnKSk7XHJcblx0fVxyXG5cdHJldHVybiByZXQ7XHJcbn1cclxuXHJcblN5cy5VSS5Eb21FbGVtZW50LnNldExvY2F0aW9uID0gZnVuY3Rpb24gU3lzJFVJJERvbUVsZW1lbnQkc2V0TG9jYXRpb24oZWxlbWVudCwgeCwgeSkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuRG9tRWxlbWVudC5zZXRMb2NhdGlvblwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZWxlbWVudFwiIGRvbUVsZW1lbnQ9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ4XCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ5XCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHJcblx0dmFyIHN0eWxlID0gZWxlbWVudC5zdHlsZTtcclxuXHRzdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XHJcblx0c3R5bGUubGVmdCA9IHggKyBcInB4XCI7XHJcblx0c3R5bGUudG9wID0geSArIFwicHhcIjtcclxufVxyXG5cclxuU3lzLlVJLkRvbUVsZW1lbnQudG9nZ2xlQ3NzQ2xhc3MgPSBmdW5jdGlvbiBTeXMkVUkkRG9tRWxlbWVudCR0b2dnbGVDc3NDbGFzcyhlbGVtZW50LCBjbGFzc05hbWUpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLkRvbUVsZW1lbnQudG9nZ2xlQ3NzQ2xhc3NcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImVsZW1lbnRcIiBkb21FbGVtZW50PVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiY2xhc3NOYW1lXCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblxyXG5cdGlmIChTeXMuVUkuRG9tRWxlbWVudC5jb250YWluc0Nzc0NsYXNzKGVsZW1lbnQsIGNsYXNzTmFtZSkpIHtcclxuXHRcdFN5cy5VSS5Eb21FbGVtZW50LnJlbW92ZUNzc0NsYXNzKGVsZW1lbnQsIGNsYXNzTmFtZSk7XHJcblx0fVxyXG5cdGVsc2Uge1xyXG5cdFx0U3lzLlVJLkRvbUVsZW1lbnQuYWRkQ3NzQ2xhc3MoZWxlbWVudCwgY2xhc3NOYW1lKTtcclxuXHR9XHJcbn1cclxuXHJcblN5cy5VSS5Eb21FbGVtZW50LmdldFZpc2liaWxpdHlNb2RlID0gZnVuY3Rpb24gU3lzJFVJJERvbUVsZW1lbnQkZ2V0VmlzaWJpbGl0eU1vZGUoZWxlbWVudCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuRG9tRWxlbWVudC5nZXRWaXNpYmlsaXR5TW9kZVwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZWxlbWVudFwiIGRvbUVsZW1lbnQ9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIlN5cy5VSS5WaXNpYmlsaXR5TW9kZVwiPjwvcmV0dXJucz5cclxuXHJcblx0cmV0dXJuIChlbGVtZW50Ll92aXNpYmlsaXR5TW9kZSA9PT0gU3lzLlVJLlZpc2liaWxpdHlNb2RlLmhpZGUpID9cclxuXHRcdFN5cy5VSS5WaXNpYmlsaXR5TW9kZS5oaWRlIDpcclxuXHRcdFN5cy5VSS5WaXNpYmlsaXR5TW9kZS5jb2xsYXBzZTtcclxufVxyXG5TeXMuVUkuRG9tRWxlbWVudC5zZXRWaXNpYmlsaXR5TW9kZSA9IGZ1bmN0aW9uIFN5cyRVSSREb21FbGVtZW50JHNldFZpc2liaWxpdHlNb2RlKGVsZW1lbnQsIHZhbHVlKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5Eb21FbGVtZW50LnNldFZpc2liaWxpdHlNb2RlXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJlbGVtZW50XCIgZG9tRWxlbWVudD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInZhbHVlXCIgdHlwZT1cIlN5cy5VSS5WaXNpYmlsaXR5TW9kZVwiPjwvcGFyYW0+XHJcblxyXG5cdFN5cy5VSS5Eb21FbGVtZW50Ll9lbnN1cmVPbGREaXNwbGF5TW9kZShlbGVtZW50KTtcclxuXHRpZiAoZWxlbWVudC5fdmlzaWJpbGl0eU1vZGUgIT09IHZhbHVlKSB7XHJcblx0XHRlbGVtZW50Ll92aXNpYmlsaXR5TW9kZSA9IHZhbHVlO1xyXG5cdFx0aWYgKFN5cy5VSS5Eb21FbGVtZW50LmdldFZpc2libGUoZWxlbWVudCkgPT09IGZhbHNlKSB7XHJcblx0XHRcdGlmIChlbGVtZW50Ll92aXNpYmlsaXR5TW9kZSA9PT0gU3lzLlVJLlZpc2liaWxpdHlNb2RlLmhpZGUpIHtcclxuXHRcdFx0XHRlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBlbGVtZW50Ll9vbGREaXNwbGF5TW9kZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGVsZW1lbnQuX3Zpc2liaWxpdHlNb2RlID0gdmFsdWU7XHJcblx0fVxyXG59XHJcblxyXG5TeXMuVUkuRG9tRWxlbWVudC5nZXRWaXNpYmxlID0gZnVuY3Rpb24gU3lzJFVJJERvbUVsZW1lbnQkZ2V0VmlzaWJsZShlbGVtZW50KSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5Eb21FbGVtZW50LmdldFZpc2libGVcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImVsZW1lbnRcIiBkb21FbGVtZW50PVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJCb29sZWFuXCI+PC9yZXR1cm5zPlxyXG5cclxuXHR2YXIgc3R5bGUgPSBlbGVtZW50LmN1cnJlbnRTdHlsZSB8fCBTeXMuVUkuRG9tRWxlbWVudC5fZ2V0Q3VycmVudFN0eWxlKGVsZW1lbnQpO1xyXG5cdGlmICghc3R5bGUpIHJldHVybiB0cnVlO1xyXG5cdHJldHVybiAoc3R5bGUudmlzaWJpbGl0eSAhPT0gJ2hpZGRlbicpICYmIChzdHlsZS5kaXNwbGF5ICE9PSAnbm9uZScpO1xyXG59XHJcblN5cy5VSS5Eb21FbGVtZW50LnNldFZpc2libGUgPSBmdW5jdGlvbiBTeXMkVUkkRG9tRWxlbWVudCRzZXRWaXNpYmxlKGVsZW1lbnQsIHZhbHVlLCBmbikge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuRG9tRWxlbWVudC5zZXRWaXNpYmxlXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJlbGVtZW50XCIgZG9tRWxlbWVudD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInZhbHVlXCIgdHlwZT1cIkJvb2xlYW5cIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImZuXCIgdHlwZT1cIkZ1bmN0aW9uXCI+PC9wYXJhbT5cclxuXHJcblx0dmFyIGlzSW5pdGlhbGl6aW5nID0gZmFsc2U7XHJcblx0aWYgKHR5cGVvZiBlbGVtZW50Ll9sYXN0VmlzaWJpbGl0eSA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuXHRcdGlzSW5pdGlhbGl6aW5nID0gdHJ1ZTtcclxuXHR9XHJcblxyXG5cdGVsZW1lbnQuX2xhc3RWaXNpYmlsaXR5ID0gdmFsdWU7XHJcblxyXG5cdGlmICh2YWx1ZSAhPT0gU3lzLlVJLkRvbUVsZW1lbnQuZ2V0VmlzaWJsZShlbGVtZW50KSkge1xyXG5cdFx0U3lzLlVJLkRvbUVsZW1lbnQuX2Vuc3VyZU9sZERpc3BsYXlNb2RlKGVsZW1lbnQpO1xyXG5cclxuXHRcdGlmIChmbikge1xyXG5cdFx0XHRmbihlbGVtZW50LCB2YWx1ZSwgaXNJbml0aWFsaXppbmcsIGVsZW1lbnQuX29sZERpc3BsYXlNb2RlKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRlbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPSB2YWx1ZSA/ICd2aXNpYmxlJyA6ICdoaWRkZW4nO1xyXG5cdFx0XHRpZiAodmFsdWUgfHwgKGVsZW1lbnQuX3Zpc2liaWxpdHlNb2RlID09PSBTeXMuVUkuVmlzaWJpbGl0eU1vZGUuaGlkZSkpIHtcclxuXHRcdFx0XHRlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBlbGVtZW50Ll9vbGREaXNwbGF5TW9kZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcblN5cy5VSS5Eb21FbGVtZW50LnNldENvbW1hbmQgPSBmdW5jdGlvbiBTeXMkVUkkRG9tRWxlbWVudCRzZXRDb21tYW5kKGNvbW1hbmRTb3VyY2UsIGNvbW1hbmROYW1lLCBjb21tYW5kQXJndW1lbnQsIGNvbW1hbmRUYXJnZXQpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLkRvbUVsZW1lbnQuc2V0Q29tbWFuZFwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiY29tbWFuZFNvdXJjZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiY29tbWFuZE5hbWVcIiB0eXBlPVwiU3RyaW5nXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiY29tbWFuZEFyZ3VtZW50XCIgbWF5QmVOdWxsPVwidHJ1ZVwiIG9wdGlvbmFsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiY29tbWFuZFRhcmdldFwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cclxuXHRTeXMuVUkuRG9tRXZlbnQuYWRkSGFuZGxlcihjb21tYW5kU291cmNlLCAnY2xpY2snLCBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBzb3VyY2UgPSBjb21tYW5kVGFyZ2V0IHx8IHRoaXM7XHJcblx0XHRTeXMuVUkuRG9tRWxlbWVudC5yYWlzZUJ1YmJsZUV2ZW50KHNvdXJjZSwgbmV3IFN5cy5Db21tYW5kRXZlbnRBcmdzKGNvbW1hbmROYW1lLCBjb21tYW5kQXJndW1lbnQsIHRoaXMpKTtcclxuXHR9LCB0cnVlXHJcbik7XHJcbn1cclxuXHJcblN5cy5yZWdpc3RlclBsdWdpbih7XHJcblx0bmFtZTogXCJzZXRDb21tYW5kXCIsXHJcblx0cGx1Z2luOiBTeXMuVUkuRG9tRWxlbWVudC5zZXRDb21tYW5kXHJcbn0pO1xyXG5cclxuU3lzLlVJLkRvbUVsZW1lbnQuX2Vuc3VyZU9sZERpc3BsYXlNb2RlID0gZnVuY3Rpb24gU3lzJFVJJERvbUVsZW1lbnQkX2Vuc3VyZU9sZERpc3BsYXlNb2RlKGVsZW1lbnQpIHtcclxuXHRpZiAoIWVsZW1lbnQuX29sZERpc3BsYXlNb2RlKSB7XHJcblx0XHR2YXIgc3R5bGUgPSBlbGVtZW50LmN1cnJlbnRTdHlsZSB8fCBTeXMuVUkuRG9tRWxlbWVudC5fZ2V0Q3VycmVudFN0eWxlKGVsZW1lbnQpO1xyXG5cdFx0ZWxlbWVudC5fb2xkRGlzcGxheU1vZGUgPSBzdHlsZSA/IHN0eWxlLmRpc3BsYXkgOiBudWxsO1xyXG5cdFx0aWYgKCFlbGVtZW50Ll9vbGREaXNwbGF5TW9kZSB8fCBlbGVtZW50Ll9vbGREaXNwbGF5TW9kZSA9PT0gJ25vbmUnKSB7XHJcblx0XHRcdHN3aXRjaChlbGVtZW50LnRhZ05hbWUudG9VcHBlckNhc2UoKSkge1xyXG5cdFx0XHRcdGNhc2UgJ0RJVic6IGNhc2UgJ1AnOiBjYXNlICdBRERSRVNTJzogY2FzZSAnQkxPQ0tRVU9URSc6IGNhc2UgJ0JPRFknOiBjYXNlICdDT0wnOlxyXG5cdFx0XHRcdGNhc2UgJ0NPTEdST1VQJzogY2FzZSAnREQnOiBjYXNlICdETCc6IGNhc2UgJ0RUJzogY2FzZSAnRklFTERTRVQnOiBjYXNlICdGT1JNJzpcclxuXHRcdFx0XHRjYXNlICdIMSc6IGNhc2UgJ0gyJzogY2FzZSAnSDMnOiBjYXNlICdINCc6IGNhc2UgJ0g1JzogY2FzZSAnSDYnOiBjYXNlICdIUic6XHJcblx0XHRcdFx0Y2FzZSAnSUZSQU1FJzogY2FzZSAnTEVHRU5EJzogY2FzZSAnT0wnOiBjYXNlICdQUkUnOiBjYXNlICdUQUJMRSc6IGNhc2UgJ1REJzpcclxuXHRcdFx0XHRjYXNlICdUSCc6IGNhc2UgJ1RSJzogY2FzZSAnVUwnOlxyXG5cdFx0XHRcdFx0ZWxlbWVudC5fb2xkRGlzcGxheU1vZGUgPSAnYmxvY2snO1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0Y2FzZSAnTEknOlxyXG5cdFx0XHRcdFx0ZWxlbWVudC5fb2xkRGlzcGxheU1vZGUgPSAnbGlzdC1pdGVtJztcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdGRlZmF1bHQ6XHJcblx0XHRcdFx0XHRlbGVtZW50Ll9vbGREaXNwbGF5TW9kZSA9ICdpbmxpbmUnO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5TeXMuVUkuRG9tRWxlbWVudC5fZ2V0V2luZG93ID0gZnVuY3Rpb24gU3lzJFVJJERvbUVsZW1lbnQkX2dldFdpbmRvdyhlbGVtZW50KSB7XHJcblx0dmFyIGRvYyA9IGVsZW1lbnQub3duZXJEb2N1bWVudCB8fCBlbGVtZW50LmRvY3VtZW50IHx8IGVsZW1lbnQ7XHJcblx0cmV0dXJuIGRvYy5kZWZhdWx0VmlldyB8fCBkb2MucGFyZW50V2luZG93O1xyXG59XHJcblxyXG5TeXMuVUkuRG9tRWxlbWVudC5fZ2V0Q3VycmVudFN0eWxlID0gZnVuY3Rpb24gU3lzJFVJJERvbUVsZW1lbnQkX2dldEN1cnJlbnRTdHlsZShlbGVtZW50KSB7XHJcblx0aWYgKGVsZW1lbnQubm9kZVR5cGUgPT09IDMpIHJldHVybiBudWxsO1xyXG5cdHZhciB3ID0gU3lzLlVJLkRvbUVsZW1lbnQuX2dldFdpbmRvdyhlbGVtZW50KTtcclxuXHRpZiAoZWxlbWVudC5kb2N1bWVudEVsZW1lbnQpIGVsZW1lbnQgPSBlbGVtZW50LmRvY3VtZW50RWxlbWVudDtcclxuXHR2YXIgY29tcHV0ZWRTdHlsZSA9ICh3ICYmIChlbGVtZW50ICE9PSB3KSAmJiB3LmdldENvbXB1dGVkU3R5bGUpID9cclxuXHRcdHcuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBudWxsKSA6XHJcblx0XHRlbGVtZW50LmN1cnJlbnRTdHlsZSB8fCBlbGVtZW50LnN0eWxlO1xyXG5cdGlmICghY29tcHV0ZWRTdHlsZSAmJiBpc0Jyb3dzZXIoXCJTYWZhcmlcIikgJiYgZWxlbWVudC5zdHlsZSkge1xyXG5cdFx0dmFyIG9sZERpc3BsYXkgPSBlbGVtZW50LnN0eWxlLmRpc3BsYXk7XHJcblx0XHR2YXIgb2xkUG9zaXRpb24gPSBlbGVtZW50LnN0eWxlLnBvc2l0aW9uO1xyXG5cdFx0ZWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XHJcblx0XHRlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG5cdFx0dmFyIHN0eWxlID0gdy5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQsIG51bGwpO1xyXG5cdFx0ZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gb2xkRGlzcGxheTtcclxuXHRcdGVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSBvbGRQb3NpdGlvbjtcclxuXHRcdGNvbXB1dGVkU3R5bGUgPSB7fTtcclxuXHRcdGZvciAodmFyIG4gaW4gc3R5bGUpIHtcclxuXHRcdFx0Y29tcHV0ZWRTdHlsZVtuXSA9IHN0eWxlW25dO1xyXG5cdFx0fVxyXG5cdFx0Y29tcHV0ZWRTdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG5cdH1cclxuXHRyZXR1cm4gY29tcHV0ZWRTdHlsZTtcclxufVxyXG5cclxuU3lzLlVJLkRvbUVsZW1lbnQuX29uRGlzcG9zZSA9IGZ1bmN0aW9uIFN5cyRVSSREb21FbGVtZW50JF9vbkRpc3Bvc2UoZWxlbWVudCwgZm4pIHtcclxuXHR2YXIgcXVldWUsIGQgPSBlbGVtZW50LmRpc3Bvc2U7XHJcblx0aWYgKGQgIT09IFN5cy5VSS5Eb21FbGVtZW50Ll9kaXNwb3NlKSB7XHJcblx0XHRlbGVtZW50LmRpc3Bvc2UgPSBTeXMuVUkuRG9tRWxlbWVudC5fZGlzcG9zZTtcclxuXHRcdGVsZW1lbnQuX19tc2FqYXhkaXNwb3NlID0gcXVldWUgPSBbXTtcclxuXHRcdGlmICh0eXBlb2YoZCkgPT09IFwiZnVuY3Rpb25cIikge1xyXG5cdFx0XHRxdWV1ZS5wdXNoKGQpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRlbHNlIHtcclxuXHRcdHF1ZXVlID0gZWxlbWVudC5fX21zYWpheGRpc3Bvc2U7XHJcblx0fVxyXG5cdHF1ZXVlLnB1c2goZm4pO1xyXG59XHJcblxyXG5TeXMuVUkuRG9tRWxlbWVudC5fZGlzcG9zZSA9IGZ1bmN0aW9uIFN5cyRVSSREb21FbGVtZW50JF9kaXNwb3NlKCkge1xyXG5cdHZhciBxdWV1ZSA9IHRoaXMuX19tc2FqYXhkaXNwb3NlO1xyXG5cdGlmIChxdWV1ZSkge1xyXG5cdFx0Zm9yICh2YXIgaSA9IDAsIGwgPSBxdWV1ZS5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuXHRcdFx0cXVldWVbaV0uYXBwbHkodGhpcyk7XHJcblx0XHR9XHJcblx0fVxyXG5cdGlmICh0aGlzLmNvbnRyb2wgJiYgdHlwZW9mKHRoaXMuY29udHJvbC5kaXNwb3NlKSA9PT0gXCJmdW5jdGlvblwiKSB7XHJcblx0XHR0aGlzLmNvbnRyb2wuZGlzcG9zZSgpO1xyXG5cdH1cclxuXHR0aGlzLl9fbXNhamF4ZGlzcG9zZSA9IG51bGw7XHJcblx0dGhpcy5kaXNwb3NlID0gbnVsbDtcclxufVxyXG5TeXMuSUNvbnRhaW5lciA9IGZ1bmN0aW9uIFN5cyRJQ29udGFpbmVyKCkge1xyXG5cdHRocm93IEVycm9yLm5vdEltcGxlbWVudGVkKCk7XHJcbn1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJElDb250YWluZXIkYWRkQ29tcG9uZW50KGNvbXBvbmVudCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5JQ29udGFpbmVyLmFkZENvbXBvbmVudFwiIC8+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJjb21wb25lbnRcIiB0eXBlPVwiU3lzLkNvbXBvbmVudFwiPjwvcGFyYW0+XHJcblxyXG5cdFx0dGhyb3cgRXJyb3Iubm90SW1wbGVtZW50ZWQoKTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJElDb250YWluZXIkcmVtb3ZlQ29tcG9uZW50KGNvbXBvbmVudCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5JQ29udGFpbmVyLnJlbW92ZUNvbXBvbmVudFwiIC8+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJjb21wb25lbnRcIiB0eXBlPVwiU3lzLkNvbXBvbmVudFwiPjwvcGFyYW0+XHJcblxyXG5cdFx0dGhyb3cgRXJyb3Iubm90SW1wbGVtZW50ZWQoKTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJElDb250YWluZXIkZmluZENvbXBvbmVudChpZCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5JQ29udGFpbmVyLmZpbmRDb21wb25lbnRcIiAvPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiaWRcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiU3lzLkNvbXBvbmVudFwiPjwvcmV0dXJucz5cclxuXHJcblx0XHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkSUNvbnRhaW5lciRnZXRDb21wb25lbnRzKCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5JQ29udGFpbmVyLmdldENvbXBvbmVudHNcIiAvPlxyXG5cdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJBcnJheVwiIGVsZW1lbnRUeXBlPVwiU3lzLkNvbXBvbmVudFwiPjwvcmV0dXJucz5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0dGhyb3cgRXJyb3Iubm90SW1wbGVtZW50ZWQoKTtcclxuXHR9XHJcblN5cy5JQ29udGFpbmVyLnByb3RvdHlwZSA9IHtcclxuXHRhZGRDb21wb25lbnQ6IFN5cyRJQ29udGFpbmVyJGFkZENvbXBvbmVudCxcclxuXHRyZW1vdmVDb21wb25lbnQ6IFN5cyRJQ29udGFpbmVyJHJlbW92ZUNvbXBvbmVudCxcclxuXHRmaW5kQ29tcG9uZW50OiBTeXMkSUNvbnRhaW5lciRmaW5kQ29tcG9uZW50LFxyXG5cdGdldENvbXBvbmVudHM6IFN5cyRJQ29udGFpbmVyJGdldENvbXBvbmVudHNcclxufVxyXG5TeXMuSUNvbnRhaW5lci5yZWdpc3RlckludGVyZmFjZShcIlN5cy5JQ29udGFpbmVyXCIpO1xyXG5cclxuU3lzLkFwcGxpY2F0aW9uTG9hZEV2ZW50QXJncyA9IGZ1bmN0aW9uIFN5cyRBcHBsaWNhdGlvbkxvYWRFdmVudEFyZ3MoY29tcG9uZW50cywgaXNQYXJ0aWFsTG9hZCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuQXBwbGljYXRpb25Mb2FkRXZlbnRBcmdzLiNjdG9yXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJjb21wb25lbnRzXCIgdHlwZT1cIkFycmF5XCIgZWxlbWVudFR5cGU9XCJTeXMuQ29tcG9uZW50XCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJpc1BhcnRpYWxMb2FkXCIgdHlwZT1cIkJvb2xlYW5cIj48L3BhcmFtPlxyXG5cclxuXHRTeXMuQXBwbGljYXRpb25Mb2FkRXZlbnRBcmdzLmluaXRpYWxpemVCYXNlKHRoaXMpO1xyXG5cdHRoaXMuX2NvbXBvbmVudHMgPSBjb21wb25lbnRzO1xyXG5cdHRoaXMuX2lzUGFydGlhbExvYWQgPSBpc1BhcnRpYWxMb2FkO1xyXG59XHJcblx0ZnVuY3Rpb24gU3lzJEFwcGxpY2F0aW9uTG9hZEV2ZW50QXJncyRnZXRfY29tcG9uZW50cygpIHtcclxuXHRcdC8vLyA8dmFsdWUgdHlwZT1cIkFycmF5XCIgZWxlbWVudFR5cGU9XCJTeXMuQ29tcG9uZW50XCIgbG9jaWQ9XCJQOkojU3lzLkFwcGxpY2F0aW9uTG9hZEV2ZW50QXJncy5jb21wb25lbnRzXCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0cmV0dXJuIHRoaXMuX2NvbXBvbmVudHM7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRBcHBsaWNhdGlvbkxvYWRFdmVudEFyZ3MkZ2V0X2lzUGFydGlhbExvYWQoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJCb29sZWFuXCIgbG9jaWQ9XCJQOkojU3lzLkFwcGxpY2F0aW9uTG9hZEV2ZW50QXJncy5pc1BhcnRpYWxMb2FkXCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0cmV0dXJuIHRoaXMuX2lzUGFydGlhbExvYWQ7XHJcblx0fVxyXG5TeXMuQXBwbGljYXRpb25Mb2FkRXZlbnRBcmdzLnByb3RvdHlwZSA9IHtcclxuXHRnZXRfY29tcG9uZW50czogU3lzJEFwcGxpY2F0aW9uTG9hZEV2ZW50QXJncyRnZXRfY29tcG9uZW50cyxcclxuXHRnZXRfaXNQYXJ0aWFsTG9hZDogU3lzJEFwcGxpY2F0aW9uTG9hZEV2ZW50QXJncyRnZXRfaXNQYXJ0aWFsTG9hZFxyXG59XHJcblN5cy5BcHBsaWNhdGlvbkxvYWRFdmVudEFyZ3MucmVnaXN0ZXJDbGFzcygnU3lzLkFwcGxpY2F0aW9uTG9hZEV2ZW50QXJncycsIFN5cy5FdmVudEFyZ3MpO1xyXG5TeXMuX0FwcGxpY2F0aW9uID0gZnVuY3Rpb24gU3lzJF9BcHBsaWNhdGlvbigpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLkFwcGxpY2F0aW9uLiNjdG9yXCIgLz5cclxuXHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRTeXMuX0FwcGxpY2F0aW9uLmluaXRpYWxpemVCYXNlKHRoaXMpO1xyXG5cclxuXHR0aGlzLl9kaXNwb3NhYmxlT2JqZWN0cyA9IFtdO1xyXG5cdHRoaXMuX2NvbXBvbmVudHMgPSB7fTtcclxuXHR0aGlzLl9jcmVhdGVkQ29tcG9uZW50cyA9IFtdO1xyXG5cdHRoaXMuX3NlY29uZFBhc3NDb21wb25lbnRzID0gW107XHJcblxyXG5cdHRoaXMuX3VubG9hZEhhbmRsZXJEZWxlZ2F0ZSA9IEZ1bmN0aW9uLmNyZWF0ZURlbGVnYXRlKHRoaXMsIHRoaXMuX3VubG9hZEhhbmRsZXIpO1xyXG5cdFN5cy5VSS5Eb21FdmVudC5hZGRIYW5kbGVyKHdpbmRvdywgXCJ1bmxvYWRcIiwgdGhpcy5fdW5sb2FkSGFuZGxlckRlbGVnYXRlKTtcclxufVxyXG5cclxuXHJcblxyXG5cdGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kZ2V0X2lzQ3JlYXRpbmdDb21wb25lbnRzKCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiQm9vbGVhblwiIGxvY2lkPVwiUDpKI1N5cy5BcHBsaWNhdGlvbi5pc0NyZWF0aW5nQ29tcG9uZW50c1wiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiAhIXRoaXMuX2NyZWF0aW5nQ29tcG9uZW50cztcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJF9BcHBsaWNhdGlvbiRnZXRfaXNEaXNwb3NpbmcoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJCb29sZWFuXCIgbG9jaWQ9XCJQOkojU3lzLkFwcGxpY2F0aW9uLmlzRGlzcG9zaW5nXCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0cmV0dXJuICEhdGhpcy5fZGlzcG9zaW5nO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkX0FwcGxpY2F0aW9uJGFkZF9pbml0KGhhbmRsZXIpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIkU6SiNTeXMuQXBwbGljYXRpb24uaW5pdFwiIC8+XHJcblxyXG5cdFx0aWYgKHRoaXMuX2luaXRpYWxpemVkKSB7XHJcblx0XHRcdGhhbmRsZXIodGhpcywgU3lzLkV2ZW50QXJncy5FbXB0eSk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpcy5fYWRkSGFuZGxlcihcImluaXRcIiwgaGFuZGxlcik7XHJcblx0XHR9XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kcmVtb3ZlX2luaXQoaGFuZGxlcikge1xyXG5cclxuXHRcdHRoaXMuX3JlbW92ZUhhbmRsZXIoXCJpbml0XCIsIGhhbmRsZXIpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkX0FwcGxpY2F0aW9uJGFkZF9sb2FkKGhhbmRsZXIpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIkU6SiNTeXMuQXBwbGljYXRpb24ubG9hZFwiIC8+XHJcblxyXG5cdFx0dGhpcy5fYWRkSGFuZGxlcihcImxvYWRcIiwgaGFuZGxlcik7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kcmVtb3ZlX2xvYWQoaGFuZGxlcikge1xyXG5cclxuXHRcdHRoaXMuX3JlbW92ZUhhbmRsZXIoXCJsb2FkXCIsIGhhbmRsZXIpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkX0FwcGxpY2F0aW9uJGFkZF91bmxvYWQoaGFuZGxlcikge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiRTpKI1N5cy5BcHBsaWNhdGlvbi51bmxvYWRcIiAvPlxyXG5cclxuXHRcdHRoaXMuX2FkZEhhbmRsZXIoXCJ1bmxvYWRcIiwgaGFuZGxlcik7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kcmVtb3ZlX3VubG9hZChoYW5kbGVyKSB7XHJcblxyXG5cdFx0dGhpcy5fcmVtb3ZlSGFuZGxlcihcInVubG9hZFwiLCBoYW5kbGVyKTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJF9BcHBsaWNhdGlvbiRhZGRDb21wb25lbnQoY29tcG9uZW50KSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLkFwcGxpY2F0aW9uLmFkZENvbXBvbmVudFwiIC8+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJjb21wb25lbnRcIiB0eXBlPVwiU3lzLkNvbXBvbmVudFwiPjwvcGFyYW0+XHJcblxyXG5cdFx0dmFyIGlkID0gY29tcG9uZW50LmdldF9pZCgpO1xyXG5cdFx0aWYgKCFpZCkgdGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTeXMuUmVzLmNhbnRBZGRXaXRob3V0SWQpO1xyXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb21wb25lbnRzW2lkXSkgIT09ICd1bmRlZmluZWQnKSB0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN0cmluZy5mb3JtYXQoU3lzLlJlcy5hcHBEdXBsaWNhdGVDb21wb25lbnQsIGlkKSk7XHJcblx0XHR0aGlzLl9jb21wb25lbnRzW2lkXSA9IGNvbXBvbmVudDtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJF9BcHBsaWNhdGlvbiRiZWdpbkNyZWF0ZUNvbXBvbmVudHMoKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLkFwcGxpY2F0aW9uLmJlZ2luQ3JlYXRlQ29tcG9uZW50c1wiIC8+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHRoaXMuX2NyZWF0aW5nQ29tcG9uZW50cyA9IHRydWU7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kZGlzcG9zZSgpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuQXBwbGljYXRpb24uZGlzcG9zZVwiIC8+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdGlmICghdGhpcy5fZGlzcG9zaW5nKSB7XHJcblx0XHRcdHRoaXMuX2Rpc3Bvc2luZyA9IHRydWU7XHJcblx0XHRcdGlmICh0aGlzLl90aW1lckNvb2tpZSkge1xyXG5cdFx0XHRcdHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy5fdGltZXJDb29raWUpO1xyXG5cdFx0XHRcdGRlbGV0ZSB0aGlzLl90aW1lckNvb2tpZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodGhpcy5fZW5kUmVxdWVzdEhhbmRsZXIpIHtcclxuXHRcdFx0XHRTeXMuV2ViRm9ybXMuUGFnZVJlcXVlc3RNYW5hZ2VyLmdldEluc3RhbmNlKCkucmVtb3ZlX2VuZFJlcXVlc3QodGhpcy5fZW5kUmVxdWVzdEhhbmRsZXIpO1xyXG5cdFx0XHRcdGRlbGV0ZSB0aGlzLl9lbmRSZXF1ZXN0SGFuZGxlcjtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodGhpcy5fYmVnaW5SZXF1ZXN0SGFuZGxlcikge1xyXG5cdFx0XHRcdFN5cy5XZWJGb3Jtcy5QYWdlUmVxdWVzdE1hbmFnZXIuZ2V0SW5zdGFuY2UoKS5yZW1vdmVfYmVnaW5SZXF1ZXN0KHRoaXMuX2JlZ2luUmVxdWVzdEhhbmRsZXIpO1xyXG5cdFx0XHRcdGRlbGV0ZSB0aGlzLl9iZWdpblJlcXVlc3RIYW5kbGVyO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh3aW5kb3cucGFnZVVubG9hZCkge1xyXG5cdFx0XHRcdHdpbmRvdy5wYWdlVW5sb2FkKHRoaXMsIFN5cy5FdmVudEFyZ3MuRW1wdHkpO1xyXG5cdFx0XHR9XHJcblx0XHRcdFN5cy5PYnNlcnZlci5yYWlzZUV2ZW50KHRoaXMsIFwidW5sb2FkXCIpO1xyXG5cdFx0XHR2YXIgZGlzcG9zYWJsZU9iamVjdHMgPSBBcnJheS5jbG9uZSh0aGlzLl9kaXNwb3NhYmxlT2JqZWN0cyk7XHJcblx0XHRcdGZvciAodmFyIGkgPSAwLCBsID0gZGlzcG9zYWJsZU9iamVjdHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XHJcblx0XHRcdFx0dmFyIG9iamVjdCA9IGRpc3Bvc2FibGVPYmplY3RzW2ldO1xyXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqZWN0KSAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG5cdFx0XHRcdFx0b2JqZWN0LmRpc3Bvc2UoKTtcclxuXHRcdFx0XHRcdGRlbGV0ZSBvYmplY3QuX19tc2Rpc3Bvc2VpbmRleDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5fZGlzcG9zYWJsZU9iamVjdHMubGVuZ3RoID0gMDtcclxuXHJcblx0XHRcdFN5cy5VSS5Eb21FdmVudC5yZW1vdmVIYW5kbGVyKHdpbmRvdywgXCJ1bmxvYWRcIiwgdGhpcy5fdW5sb2FkSGFuZGxlckRlbGVnYXRlKTtcclxuXHJcblx0XHRcdGlmIChTeXMuX1NjcmlwdExvYWRlcikge1xyXG5cdFx0XHRcdHZhciBzbCA9IFN5cy5fU2NyaXB0TG9hZGVyLmdldEluc3RhbmNlKCk7XHJcblx0XHRcdFx0aWYgKHNsKSB7XHJcblx0XHRcdFx0XHRzbC5kaXNwb3NlKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRTeXMuX0FwcGxpY2F0aW9uLmNhbGxCYXNlTWV0aG9kKHRoaXMsICdkaXNwb3NlJyk7XHJcblx0XHR9XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kZGlzcG9zZUVsZW1lbnQoZWxlbWVudCwgY2hpbGROb2Rlc09ubHkpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuX0FwcGxpY2F0aW9uLmRpc3Bvc2VFbGVtZW50XCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImVsZW1lbnRcIj48L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiY2hpbGROb2Rlc09ubHlcIiB0eXBlPVwiQm9vbGVhblwiPjwvcGFyYW0+XHJcblxyXG5cdFx0aWYgKGVsZW1lbnQubm9kZVR5cGUgPT09IDEpIHtcclxuXHRcdFx0dmFyIGQsIGMsIGksIGxpc3QsXHJcblx0XHRcdFx0YWxsRWxlbWVudHMgPSBlbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKSxcclxuXHRcdFx0XHRsZW5ndGggPSBhbGxFbGVtZW50cy5sZW5ndGgsXHJcblx0XHRcdFx0Y2hpbGRyZW4gPSBuZXcgQXJyYXkobGVuZ3RoKTtcclxuXHRcdFx0Zm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0Y2hpbGRyZW5baV0gPSBhbGxFbGVtZW50c1tpXTtcclxuXHRcdFx0fVxyXG5cdFx0XHRmb3IgKGkgPSBsZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG5cdFx0XHRcdHZhciBjaGlsZCA9IGNoaWxkcmVuW2ldO1xyXG5cdFx0XHRcdGQgPSBjaGlsZC5kaXNwb3NlO1xyXG5cdFx0XHRcdGlmIChkICYmIHR5cGVvZihkKSA9PT0gXCJmdW5jdGlvblwiKSB7XHJcblx0XHRcdFx0XHRjaGlsZC5kaXNwb3NlKCk7XHJcblx0XHRcdFx0XHRjaGlsZC5kaXNwb3NlID0gbnVsbDtcclxuXHRcdFx0XHRcdGNoaWxkLl9fbXNhamF4ZGlzcG9zZSA9IG51bGw7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0YyA9IGNoaWxkLmNvbnRyb2w7XHJcblx0XHRcdFx0XHRpZiAoYyAmJiB0eXBlb2YoYy5kaXNwb3NlKSA9PT0gXCJmdW5jdGlvblwiKSB7XHJcblx0XHRcdFx0XHRcdGMuZGlzcG9zZSgpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRsaXN0ID0gY2hpbGQuX2JlaGF2aW9ycztcclxuXHRcdFx0XHRpZiAobGlzdCkge1xyXG5cdFx0XHRcdFx0dGhpcy5fZGlzcG9zZUNvbXBvbmVudHMobGlzdCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGxpc3QgPSBjaGlsZC5fY29tcG9uZW50cztcclxuXHRcdFx0XHRpZiAobGlzdCkge1xyXG5cdFx0XHRcdFx0dGhpcy5fZGlzcG9zZUNvbXBvbmVudHMobGlzdCk7XHJcblx0XHRcdFx0XHRjaGlsZC5fY29tcG9uZW50cyA9IG51bGw7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGlmICghY2hpbGROb2Rlc09ubHkpIHtcclxuXHRcdFx0XHRkID0gZWxlbWVudC5kaXNwb3NlO1xyXG5cdFx0XHRcdGlmIChkICYmIHR5cGVvZihkKSA9PT0gXCJmdW5jdGlvblwiKSB7XHJcblx0XHRcdFx0XHRlbGVtZW50LmRpc3Bvc2UoKTtcclxuXHRcdFx0XHRcdGVsZW1lbnQuZGlzcG9zZSA9IG51bGw7XHJcblx0XHRcdFx0XHRlbGVtZW50Ll9fbXNhamF4ZGlzcG9zZSA9IG51bGw7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0YyA9IGVsZW1lbnQuY29udHJvbDtcclxuXHRcdFx0XHRcdGlmIChjICYmIHR5cGVvZihjLmRpc3Bvc2UpID09PSBcImZ1bmN0aW9uXCIpIHtcclxuXHRcdFx0XHRcdFx0Yy5kaXNwb3NlKCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGxpc3QgPSBlbGVtZW50Ll9iZWhhdmlvcnM7XHJcblx0XHRcdFx0aWYgKGxpc3QpIHtcclxuXHRcdFx0XHRcdHRoaXMuX2Rpc3Bvc2VDb21wb25lbnRzKGxpc3QpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRsaXN0ID0gZWxlbWVudC5fY29tcG9uZW50cztcclxuXHRcdFx0XHRpZiAobGlzdCkge1xyXG5cdFx0XHRcdFx0dGhpcy5fZGlzcG9zZUNvbXBvbmVudHMobGlzdCk7XHJcblx0XHRcdFx0XHRlbGVtZW50Ll9jb21wb25lbnRzID0gbnVsbDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJF9BcHBsaWNhdGlvbiRlbmRDcmVhdGVDb21wb25lbnRzKCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5BcHBsaWNhdGlvbi5lbmRDcmVhdGVDb21wb25lbnRzXCIgLz5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0dmFyIGNvbXBvbmVudHMgPSB0aGlzLl9zZWNvbmRQYXNzQ29tcG9uZW50cztcclxuXHRcdGZvciAodmFyIGkgPSAwLCBsID0gY29tcG9uZW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuXHRcdFx0dmFyIGVudHJ5ID0gY29tcG9uZW50c1tpXSxcclxuXHRcdFx0XHRjb21wb25lbnQgPSBlbnRyeS5jb21wb25lbnQ7XHJcblx0XHRcdFN5cy5Db21wb25lbnQuX3NldFJlZmVyZW5jZXMoY29tcG9uZW50LCBlbnRyeS5yZWZlcmVuY2VzKTtcclxuXHRcdFx0Y29tcG9uZW50LmVuZFVwZGF0ZSgpO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5fc2Vjb25kUGFzc0NvbXBvbmVudHMgPSBbXTtcclxuXHRcdHRoaXMuX2NyZWF0aW5nQ29tcG9uZW50cyA9IGZhbHNlO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkX0FwcGxpY2F0aW9uJGZpbmRDb21wb25lbnQoaWQsIHBhcmVudCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5BcHBsaWNhdGlvbi5maW5kQ29tcG9uZW50XCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImlkXCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJwYXJlbnRcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiU3lzLkNvbXBvbmVudFwiIG1heUJlTnVsbD1cInRydWVcIj48L3JldHVybnM+XHJcblxyXG5cdFx0cmV0dXJuIChwYXJlbnQgP1xyXG5cdFx0XHQoKFN5cy5JQ29udGFpbmVyLmlzSW5zdGFuY2VPZlR5cGUocGFyZW50KSkgP1xyXG5cdFx0XHRcdHBhcmVudC5maW5kQ29tcG9uZW50KGlkKSA6XHJcblx0XHRcdFx0cGFyZW50W2lkXSB8fCBudWxsKSA6XHJcblx0XHRcdFN5cy5BcHBsaWNhdGlvbi5fY29tcG9uZW50c1tpZF0gfHwgbnVsbCk7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kZ2V0Q29tcG9uZW50cygpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuQXBwbGljYXRpb24uZ2V0Q29tcG9uZW50c1wiIC8+XHJcblx0XHQvLy8gPHJldHVybnMgdHlwZT1cIkFycmF5XCIgZWxlbWVudFR5cGU9XCJTeXMuQ29tcG9uZW50XCI+PC9yZXR1cm5zPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHR2YXIgcmVzID0gW107XHJcblx0XHR2YXIgY29tcG9uZW50cyA9IHRoaXMuX2NvbXBvbmVudHM7XHJcblx0XHRmb3IgKHZhciBuYW1lIGluIGNvbXBvbmVudHMpIHtcclxuXHRcdFx0aWYgKGNvbXBvbmVudHMuaGFzT3duUHJvcGVydHkobmFtZSkpIHtcclxuXHRcdFx0XHRyZXMucHVzaChjb21wb25lbnRzW25hbWVdKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHJlcztcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJF9BcHBsaWNhdGlvbiRpbml0aWFsaXplKCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5BcHBsaWNhdGlvbi5pbml0aWFsaXplXCIgLz5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0d2luZG93LnNldFRpbWVvdXQoRnVuY3Rpb24uY3JlYXRlRGVsZWdhdGUodGhpcywgdGhpcy5fZG9Jbml0aWFsaXplKSwgMCk7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kX2RvSW5pdGlhbGl6ZSgpIHtcclxuXHRcdGlmKCF0aGlzLmdldF9pc0luaXRpYWxpemVkKCkgJiYgIXRoaXMuX2Rpc3Bvc2luZykge1xyXG5cdFx0XHRTeXMuX0FwcGxpY2F0aW9uLmNhbGxCYXNlTWV0aG9kKHRoaXMsICdpbml0aWFsaXplJyk7XHJcblx0XHRcdHRoaXMuX3JhaXNlSW5pdCgpO1xyXG5cdFx0XHRpZiAodGhpcy5nZXRfc3RhdGVTdHJpbmcpIHtcclxuXHRcdFx0XHRpZiAoU3lzLldlYkZvcm1zICYmIFN5cy5XZWJGb3Jtcy5QYWdlUmVxdWVzdE1hbmFnZXIpIHtcclxuXHRcdFx0XHRcdHRoaXMuX2JlZ2luUmVxdWVzdEhhbmRsZXIgPSBGdW5jdGlvbi5jcmVhdGVEZWxlZ2F0ZSh0aGlzLCB0aGlzLl9vblBhZ2VSZXF1ZXN0TWFuYWdlckJlZ2luUmVxdWVzdCk7XHJcblx0XHRcdFx0XHRTeXMuV2ViRm9ybXMuUGFnZVJlcXVlc3RNYW5hZ2VyLmdldEluc3RhbmNlKCkuYWRkX2JlZ2luUmVxdWVzdCh0aGlzLl9iZWdpblJlcXVlc3RIYW5kbGVyKTtcclxuXHRcdFx0XHRcdHRoaXMuX2VuZFJlcXVlc3RIYW5kbGVyID0gRnVuY3Rpb24uY3JlYXRlRGVsZWdhdGUodGhpcywgdGhpcy5fb25QYWdlUmVxdWVzdE1hbmFnZXJFbmRSZXF1ZXN0KTtcclxuXHRcdFx0XHRcdFN5cy5XZWJGb3Jtcy5QYWdlUmVxdWVzdE1hbmFnZXIuZ2V0SW5zdGFuY2UoKS5hZGRfZW5kUmVxdWVzdCh0aGlzLl9lbmRSZXF1ZXN0SGFuZGxlcik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHZhciBsb2FkZWRFbnRyeSA9IHRoaXMuZ2V0X3N0YXRlU3RyaW5nKCk7XHJcblx0XHRcdFx0aWYgKGxvYWRlZEVudHJ5ICE9PSB0aGlzLl9jdXJyZW50RW50cnkpIHtcclxuXHRcdFx0XHRcdHRoaXMuX25hdmlnYXRlKGxvYWRlZEVudHJ5KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHR0aGlzLl9lbnN1cmVIaXN0b3J5KCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHRoaXMucmFpc2VMb2FkKCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kbm90aWZ5U2NyaXB0TG9hZGVkKCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5BcHBsaWNhdGlvbi5ub3RpZnlTY3JpcHRMb2FkZWRcIiAvPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kcmVnaXN0ZXJEaXNwb3NhYmxlT2JqZWN0KG9iamVjdCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5BcHBsaWNhdGlvbi5yZWdpc3RlckRpc3Bvc2FibGVPYmplY3RcIiAvPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwib2JqZWN0XCIgdHlwZT1cIlN5cy5JRGlzcG9zYWJsZVwiPjwvcGFyYW0+XHJcblxyXG5cdFx0aWYgKCF0aGlzLl9kaXNwb3NpbmcpIHtcclxuXHRcdFx0dmFyIG9iamVjdHMgPSB0aGlzLl9kaXNwb3NhYmxlT2JqZWN0cyxcclxuXHRcdFx0XHRpID0gb2JqZWN0cy5sZW5ndGg7XHJcblx0XHRcdG9iamVjdHNbaV0gPSBvYmplY3Q7XHJcblx0XHRcdG9iamVjdC5fX21zZGlzcG9zZWluZGV4ID0gaTtcclxuXHRcdH1cclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJF9BcHBsaWNhdGlvbiRyYWlzZUxvYWQoKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLkFwcGxpY2F0aW9uLnJhaXNlTG9hZFwiIC8+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHZhciBhcmdzID0gbmV3IFN5cy5BcHBsaWNhdGlvbkxvYWRFdmVudEFyZ3MoQXJyYXkuY2xvbmUodGhpcy5fY3JlYXRlZENvbXBvbmVudHMpLCAhIXRoaXMuX2xvYWRlZCk7XHJcblx0XHR0aGlzLl9sb2FkZWQgPSB0cnVlO1xyXG5cdFx0U3lzLk9ic2VydmVyLnJhaXNlRXZlbnQodGhpcywgXCJsb2FkXCIsIGFyZ3MpO1xyXG5cdFx0aWYgKHdpbmRvdy5wYWdlTG9hZCkge1xyXG5cdFx0XHR3aW5kb3cucGFnZUxvYWQodGhpcywgYXJncyk7XHJcblx0XHR9XHJcblx0XHR0aGlzLl9jcmVhdGVkQ29tcG9uZW50cyA9IFtdO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkX0FwcGxpY2F0aW9uJHJlbW92ZUNvbXBvbmVudChjb21wb25lbnQpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuQXBwbGljYXRpb24ucmVtb3ZlQ29tcG9uZW50XCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImNvbXBvbmVudFwiIHR5cGU9XCJTeXMuQ29tcG9uZW50XCI+PC9wYXJhbT5cclxuXHJcblx0XHR2YXIgaWQgPSBjb21wb25lbnQuZ2V0X2lkKCk7XHJcblx0XHRpZiAoaWQpIGRlbGV0ZSB0aGlzLl9jb21wb25lbnRzW2lkXTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJF9BcHBsaWNhdGlvbiR1bnJlZ2lzdGVyRGlzcG9zYWJsZU9iamVjdChvYmplY3QpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuQXBwbGljYXRpb24udW5yZWdpc3RlckRpc3Bvc2FibGVPYmplY3RcIiAvPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwib2JqZWN0XCIgdHlwZT1cIlN5cy5JRGlzcG9zYWJsZVwiPjwvcGFyYW0+XHJcblxyXG5cdFx0aWYgKCF0aGlzLl9kaXNwb3NpbmcpIHtcclxuXHRcdFx0dmFyIGkgPSBvYmplY3QuX19tc2Rpc3Bvc2VpbmRleDtcclxuXHRcdFx0aWYgKHR5cGVvZihpKSA9PT0gXCJudW1iZXJcIikge1xyXG5cdFx0XHRcdHZhciBkaXNwb3NhYmxlT2JqZWN0cyA9IHRoaXMuX2Rpc3Bvc2FibGVPYmplY3RzO1xyXG5cdFx0XHRcdGRlbGV0ZSBkaXNwb3NhYmxlT2JqZWN0c1tpXTtcclxuXHRcdFx0XHRkZWxldGUgb2JqZWN0Ll9fbXNkaXNwb3NlaW5kZXg7XHJcblx0XHRcdFx0aWYgKCsrdGhpcy5fZGVsZXRlQ291bnQgPiAxMDAwKSB7XHJcblx0XHRcdFx0XHR2YXIgbmV3QXJyYXkgPSBbXTtcclxuXHRcdFx0XHRcdGZvciAodmFyIGogPSAwLCBsID0gZGlzcG9zYWJsZU9iamVjdHMubGVuZ3RoOyBqIDwgbDsgaisrKSB7XHJcblx0XHRcdFx0XHRcdG9iamVjdCA9IGRpc3Bvc2FibGVPYmplY3RzW2pdO1xyXG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKG9iamVjdCkgIT09IFwidW5kZWZpbmVkXCIpIHtcclxuXHRcdFx0XHRcdFx0XHRvYmplY3QuX19tc2Rpc3Bvc2VpbmRleCA9IG5ld0FycmF5Lmxlbmd0aDtcclxuXHRcdFx0XHRcdFx0XHRuZXdBcnJheS5wdXNoKG9iamVjdCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHRoaXMuX2Rpc3Bvc2FibGVPYmplY3RzID0gbmV3QXJyYXk7XHJcblx0XHRcdFx0XHR0aGlzLl9kZWxldGVDb3VudCA9IDA7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kX2FkZENvbXBvbmVudFRvU2Vjb25kUGFzcyhjb21wb25lbnQsIHJlZmVyZW5jZXMpIHtcclxuXHRcdHRoaXMuX3NlY29uZFBhc3NDb21wb25lbnRzLnB1c2goe2NvbXBvbmVudDogY29tcG9uZW50LCByZWZlcmVuY2VzOiByZWZlcmVuY2VzfSk7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kX2Rpc3Bvc2VDb21wb25lbnRzKGxpc3QpIHtcclxuXHRcdGlmIChsaXN0KSB7XHJcblx0XHRcdGZvciAodmFyIGkgPSBsaXN0Lmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcblx0XHRcdFx0dmFyIGl0ZW0gPSBsaXN0W2ldO1xyXG5cdFx0XHRcdGlmICh0eXBlb2YoaXRlbS5kaXNwb3NlKSA9PT0gXCJmdW5jdGlvblwiKSB7XHJcblx0XHRcdFx0XHRpdGVtLmRpc3Bvc2UoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJF9BcHBsaWNhdGlvbiRfcmFpc2VJbml0KCkge1xyXG5cdFx0dGhpcy5iZWdpbkNyZWF0ZUNvbXBvbmVudHMoKTtcclxuXHRcdFN5cy5PYnNlcnZlci5yYWlzZUV2ZW50KHRoaXMsIFwiaW5pdFwiKTtcclxuXHRcdHRoaXMuZW5kQ3JlYXRlQ29tcG9uZW50cygpO1xyXG5cdCAgIH1cclxuXHJcblx0ZnVuY3Rpb24gQ2xlYW51cFByb3RvdHlwZSh0eXBlKSB7XHJcblx0XHRpZiAodHlwZSAmJiB0eXBlLnByb3RvdHlwZSkge1xyXG5cdFx0XHRmb3IgKGtleSBpbiB0eXBlLnByb3RvdHlwZSkge1xyXG5cdFx0XHRcdGlmICh0eXBlLnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eShrZXkpKVxyXG5cdFx0XHRcdFx0dHlwZS5wcm90b3R5cGVba2V5XSA9IG51bGw7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHR5cGUucHJvdG90eXBlLmNvbnN0cnVjdG9yKVxyXG5cdFx0XHRcdHR5cGUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gbnVsbDtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kX3VubG9hZEhhbmRsZXIoZXZlbnQpIHtcclxuXHJcblx0XHQvLyBTa2lwIGRpc3Bvc2FsIGxvZ2ljIGV4Y2VwdCBmb3Igb2xkZXIgdmVyc2lvbnMgb2YgSW50ZXJuZXQgRXhwbG9yZXJcclxuXHRcdGlmIChTeXMuQnJvd3Nlci5hZ2VudCAhPT0gU3lzLkJyb3dzZXIuSW50ZXJuZXRFeHBsb3JlciB8fCBTeXMuQnJvd3Nlci52ZXJzaW9uID4gOSkgcmV0dXJuO1xyXG5cclxuXHRcdHRyeSB7XHJcblx0XHRcdHRoaXMuZGlzcG9zZSgpO1xyXG5cdFx0XHR3aW5kb3cuJGZpbmQgPSBudWxsO1xyXG5cdFx0XHR3aW5kb3cuVHlwZSA9IG51bGw7XHJcblx0XHRcdHdpbmRvdy5fZXZlbnRzID0gbnVsbDtcclxuXHJcblx0XHRcdENsZWFudXBQcm90b3R5cGUoRnVuY3Rpb24pO1xyXG5cdFx0XHRDbGVhbnVwUHJvdG90eXBlKE9iamVjdCk7XHJcblx0XHRcdENsZWFudXBQcm90b3R5cGUoU3RyaW5nKTtcclxuXHRcdFx0Q2xlYW51cFByb3RvdHlwZShBcnJheSk7XHJcblx0XHRcdENsZWFudXBQcm90b3R5cGUoUmVnRXhwKTtcclxuXHRcdFx0Q2xlYW51cFByb3RvdHlwZShOdW1iZXIpO1xyXG5cdFx0XHRDbGVhbnVwUHJvdG90eXBlKEJvb2xlYW4pO1xyXG5cdFx0XHRDbGVhbnVwUHJvdG90eXBlKERhdGUpO1xyXG5cdFx0XHRDbGVhbnVwUHJvdG90eXBlKEVycm9yKTtcclxuXHJcblx0XHRcdGZvciAodmFyIHR5cGUgaW4gU3lzLl9fdXBwZXJDYXNlVHlwZXMpXHJcblx0XHRcdFx0Q2xlYW51cFByb3RvdHlwZShTeXMuX191cHBlckNhc2VUeXBlc1t0eXBlXSk7XHJcblxyXG5cdFx0XHR3aW5kb3cuU3lzID0gbnVsbDtcclxuXHRcdFx0d2luZG93Lm9ubG9hZCA9IG51bGw7XHJcblx0XHRcdHdpbmRvdy5vbnVubG9hZCA9IG51bGw7XHJcblx0XHRcdHdpbmRvdy5fX21zYWpheGRpc3Bvc2UgPSBudWxsO1xyXG5cdFx0XHR3aW5kb3cuZGlzcG9zZSA9IG51bGw7XHJcblx0XHR9XHJcblx0XHRjYXRjaCAoZSlcclxuXHRcdHt9XHJcblx0fVxyXG5TeXMuX0FwcGxpY2F0aW9uLnByb3RvdHlwZSA9IHtcclxuXHRfZGVsZXRlQ291bnQ6IDAsXHJcblx0Z2V0X2lzQ3JlYXRpbmdDb21wb25lbnRzOiBTeXMkX0FwcGxpY2F0aW9uJGdldF9pc0NyZWF0aW5nQ29tcG9uZW50cyxcclxuXHRnZXRfaXNEaXNwb3Npbmc6IFN5cyRfQXBwbGljYXRpb24kZ2V0X2lzRGlzcG9zaW5nLFxyXG5cdGFkZF9pbml0OiBTeXMkX0FwcGxpY2F0aW9uJGFkZF9pbml0LFxyXG5cdHJlbW92ZV9pbml0OiBTeXMkX0FwcGxpY2F0aW9uJHJlbW92ZV9pbml0LFxyXG5cdGFkZF9sb2FkOiBTeXMkX0FwcGxpY2F0aW9uJGFkZF9sb2FkLFxyXG5cdHJlbW92ZV9sb2FkOiBTeXMkX0FwcGxpY2F0aW9uJHJlbW92ZV9sb2FkLFxyXG5cdGFkZF91bmxvYWQ6IFN5cyRfQXBwbGljYXRpb24kYWRkX3VubG9hZCxcclxuXHRyZW1vdmVfdW5sb2FkOiBTeXMkX0FwcGxpY2F0aW9uJHJlbW92ZV91bmxvYWQsXHJcblx0YWRkQ29tcG9uZW50OiBTeXMkX0FwcGxpY2F0aW9uJGFkZENvbXBvbmVudCxcclxuXHRiZWdpbkNyZWF0ZUNvbXBvbmVudHM6IFN5cyRfQXBwbGljYXRpb24kYmVnaW5DcmVhdGVDb21wb25lbnRzLFxyXG5cdGRpc3Bvc2U6IFN5cyRfQXBwbGljYXRpb24kZGlzcG9zZSxcclxuXHRkaXNwb3NlRWxlbWVudDogU3lzJF9BcHBsaWNhdGlvbiRkaXNwb3NlRWxlbWVudCxcclxuXHRlbmRDcmVhdGVDb21wb25lbnRzOiBTeXMkX0FwcGxpY2F0aW9uJGVuZENyZWF0ZUNvbXBvbmVudHMsXHJcblx0ZmluZENvbXBvbmVudDogU3lzJF9BcHBsaWNhdGlvbiRmaW5kQ29tcG9uZW50LFxyXG5cdGdldENvbXBvbmVudHM6IFN5cyRfQXBwbGljYXRpb24kZ2V0Q29tcG9uZW50cyxcclxuXHRpbml0aWFsaXplOiBTeXMkX0FwcGxpY2F0aW9uJGluaXRpYWxpemUsXHJcblx0X2RvSW5pdGlhbGl6ZTogU3lzJF9BcHBsaWNhdGlvbiRfZG9Jbml0aWFsaXplLFxyXG5cdG5vdGlmeVNjcmlwdExvYWRlZDogU3lzJF9BcHBsaWNhdGlvbiRub3RpZnlTY3JpcHRMb2FkZWQsXHJcblx0cmVnaXN0ZXJEaXNwb3NhYmxlT2JqZWN0OiBTeXMkX0FwcGxpY2F0aW9uJHJlZ2lzdGVyRGlzcG9zYWJsZU9iamVjdCxcclxuXHRyYWlzZUxvYWQ6IFN5cyRfQXBwbGljYXRpb24kcmFpc2VMb2FkLFxyXG5cdHJlbW92ZUNvbXBvbmVudDogU3lzJF9BcHBsaWNhdGlvbiRyZW1vdmVDb21wb25lbnQsXHJcblx0dW5yZWdpc3RlckRpc3Bvc2FibGVPYmplY3Q6IFN5cyRfQXBwbGljYXRpb24kdW5yZWdpc3RlckRpc3Bvc2FibGVPYmplY3QsXHJcblx0X2FkZENvbXBvbmVudFRvU2Vjb25kUGFzczogU3lzJF9BcHBsaWNhdGlvbiRfYWRkQ29tcG9uZW50VG9TZWNvbmRQYXNzLFxyXG5cdF9kaXNwb3NlQ29tcG9uZW50czogU3lzJF9BcHBsaWNhdGlvbiRfZGlzcG9zZUNvbXBvbmVudHMsXHJcblx0X3JhaXNlSW5pdDogU3lzJF9BcHBsaWNhdGlvbiRfcmFpc2VJbml0LFxyXG5cdF91bmxvYWRIYW5kbGVyOiBTeXMkX0FwcGxpY2F0aW9uJF91bmxvYWRIYW5kbGVyXHJcbn1cclxuU3lzLl9BcHBsaWNhdGlvbi5yZWdpc3RlckNsYXNzKCdTeXMuX0FwcGxpY2F0aW9uJywgU3lzLkNvbXBvbmVudCwgU3lzLklDb250YWluZXIpO1xyXG5cclxuU3lzLkFwcGxpY2F0aW9uID0gbmV3IFN5cy5fQXBwbGljYXRpb24oKTtcclxud2luZG93LiRmaW5kID0gU3lzLkFwcGxpY2F0aW9uLmZpbmRDb21wb25lbnQ7XHJcblxyXG5cclxuU3lzLm9uUmVhZHkoZnVuY3Rpb24oKSB7XHJcblx0U3lzLkFwcGxpY2F0aW9uLl9kb0luaXRpYWxpemUoKTtcclxufSk7XHJcblxyXG5cclxuU3lzLlVJLkJlaGF2aW9yID0gZnVuY3Rpb24gU3lzJFVJJEJlaGF2aW9yKGVsZW1lbnQpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLkJlaGF2aW9yLiNjdG9yXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJlbGVtZW50XCIgZG9tRWxlbWVudD1cInRydWVcIj48L3BhcmFtPlxyXG5cclxuXHRTeXMuVUkuQmVoYXZpb3IuaW5pdGlhbGl6ZUJhc2UodGhpcyk7XHJcblx0dGhpcy5fZWxlbWVudCA9IGVsZW1lbnQ7XHJcblx0dmFyIGJlaGF2aW9ycyA9IChlbGVtZW50Ll9iZWhhdmlvcnMgPSBlbGVtZW50Ll9iZWhhdmlvcnMgfHwgW10pO1xyXG5cdGJlaGF2aW9ycy5wdXNoKHRoaXMpO1xyXG59XHJcblxyXG5cdGZ1bmN0aW9uIFN5cyRVSSRCZWhhdmlvciRnZXRfZWxlbWVudCgpIHtcclxuXHRcdC8vLyA8dmFsdWUgZG9tRWxlbWVudD1cInRydWVcIiBsb2NpZD1cIlA6SiNTeXMuVUkuQmVoYXZpb3IuZWxlbWVudFwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiB0aGlzLl9lbGVtZW50O1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkVUkkQmVoYXZpb3IkZ2V0X2lkKCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiU3RyaW5nXCIgbG9jaWQ9XCJQOkojU3lzLlVJLkJlaGF2aW9yLmlkXCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0dmFyIGJhc2VJZCA9IFN5cy5VSS5CZWhhdmlvci5jYWxsQmFzZU1ldGhvZCh0aGlzLCAnZ2V0X2lkJyk7XHJcblx0XHRpZiAoYmFzZUlkKSByZXR1cm4gYmFzZUlkO1xyXG5cdFx0aWYgKCF0aGlzLl9lbGVtZW50IHx8ICF0aGlzLl9lbGVtZW50LmlkKSByZXR1cm4gJyc7XHJcblx0XHRyZXR1cm4gdGhpcy5fZWxlbWVudC5pZCArICckJyArIHRoaXMuZ2V0X25hbWUoKTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJFVJJEJlaGF2aW9yJGdldF9uYW1lKCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiU3RyaW5nXCIgbG9jaWQ9XCJQOkojU3lzLlVJLkJlaGF2aW9yLm5hbWVcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0dXJuIHRoaXMuX25hbWU7XHJcblx0XHR2YXIgbmFtZSA9IE9iamVjdC5nZXRUeXBlTmFtZSh0aGlzKTtcclxuXHRcdHZhciBpID0gbmFtZS5sYXN0SW5kZXhPZignLicpO1xyXG5cdFx0aWYgKGkgIT09IC0xKSBuYW1lID0gbmFtZS5zdWJzdHIoaSArIDEpO1xyXG5cdFx0aWYgKCF0aGlzLl9pbml0aWFsaXplZCkgdGhpcy5fbmFtZSA9IG5hbWU7XHJcblx0XHRyZXR1cm4gbmFtZTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJFVJJEJlaGF2aW9yJHNldF9uYW1lKHZhbHVlKSB7XHJcblxyXG5cdFx0aWYgKCh2YWx1ZSA9PT0gJycpIHx8ICh2YWx1ZS5jaGFyQXQoMCkgPT09ICcgJykgfHwgKHZhbHVlLmNoYXJBdCh2YWx1ZS5sZW5ndGggLSAxKSA9PT0gJyAnKSlcclxuXHRcdFx0dGhyb3cgRXJyb3IuYXJndW1lbnQoJ3ZhbHVlJywgU3lzLlJlcy5pbnZhbGlkSWQpO1xyXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbGVtZW50W3ZhbHVlXSkgIT09ICd1bmRlZmluZWQnKVxyXG5cdFx0XHR0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN0cmluZy5mb3JtYXQoU3lzLlJlcy5iZWhhdmlvckR1cGxpY2F0ZU5hbWUsIHZhbHVlKSk7XHJcblx0XHRpZiAodGhpcy5nZXRfaXNJbml0aWFsaXplZCgpKSB0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN5cy5SZXMuY2FudFNldE5hbWVBZnRlckluaXQpO1xyXG5cdFx0dGhpcy5fbmFtZSA9IHZhbHVlO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkVUkkQmVoYXZpb3IkaW5pdGlhbGl6ZSgpIHtcclxuXHRcdFN5cy5VSS5CZWhhdmlvci5jYWxsQmFzZU1ldGhvZCh0aGlzLCAnaW5pdGlhbGl6ZScpO1xyXG5cdFx0dmFyIG5hbWUgPSB0aGlzLmdldF9uYW1lKCk7XHJcblx0XHRpZiAobmFtZSkgdGhpcy5fZWxlbWVudFtuYW1lXSA9IHRoaXM7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRVSSRCZWhhdmlvciRkaXNwb3NlKCkge1xyXG5cdFx0U3lzLlVJLkJlaGF2aW9yLmNhbGxCYXNlTWV0aG9kKHRoaXMsICdkaXNwb3NlJyk7XHJcblx0XHR2YXIgZSA9IHRoaXMuX2VsZW1lbnQ7XHJcblx0XHRpZiAoZSkge1xyXG5cdFx0XHR2YXIgbmFtZSA9IHRoaXMuZ2V0X25hbWUoKTtcclxuXHRcdFx0aWYgKG5hbWUpIHtcclxuXHRcdFx0XHRlW25hbWVdID0gbnVsbDtcclxuXHRcdFx0fVxyXG5cdFx0XHR2YXIgYmVoYXZpb3JzID0gZS5fYmVoYXZpb3JzO1xyXG5cdFx0XHRBcnJheS5yZW1vdmUoYmVoYXZpb3JzLCB0aGlzKTtcclxuXHRcdFx0aWYgKCFiZWhhdmlvcnMubGVuZ3RoKSB7XHJcblx0XHRcdFx0ZS5fYmVoYXZpb3JzID0gbnVsbDtcclxuXHRcdFx0fVxyXG5cdFx0XHRkZWxldGUgdGhpcy5fZWxlbWVudDtcclxuXHRcdH1cclxuXHR9XHJcblN5cy5VSS5CZWhhdmlvci5wcm90b3R5cGUgPSB7XHJcblx0Z2V0X2VsZW1lbnQ6IFN5cyRVSSRCZWhhdmlvciRnZXRfZWxlbWVudCxcclxuXHRnZXRfaWQ6IFN5cyRVSSRCZWhhdmlvciRnZXRfaWQsXHJcblx0Z2V0X25hbWU6IFN5cyRVSSRCZWhhdmlvciRnZXRfbmFtZSxcclxuXHRzZXRfbmFtZTogU3lzJFVJJEJlaGF2aW9yJHNldF9uYW1lLFxyXG5cdGluaXRpYWxpemU6IFN5cyRVSSRCZWhhdmlvciRpbml0aWFsaXplLFxyXG5cdGRpc3Bvc2U6IFN5cyRVSSRCZWhhdmlvciRkaXNwb3NlXHJcbn1cclxuU3lzLlVJLkJlaGF2aW9yLnJlZ2lzdGVyQ2xhc3MoJ1N5cy5VSS5CZWhhdmlvcicsIFN5cy5Db21wb25lbnQpO1xyXG5cclxuU3lzLlVJLkJlaGF2aW9yLmdldEJlaGF2aW9yQnlOYW1lID0gZnVuY3Rpb24gU3lzJFVJJEJlaGF2aW9yJGdldEJlaGF2aW9yQnlOYW1lKGVsZW1lbnQsIG5hbWUpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLkJlaGF2aW9yLmdldEJlaGF2aW9yQnlOYW1lXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJlbGVtZW50XCIgZG9tRWxlbWVudD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cIm5hbWVcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIlN5cy5VSS5CZWhhdmlvclwiIG1heUJlTnVsbD1cInRydWVcIj48L3JldHVybnM+XHJcblxyXG5cdHZhciBiID0gZWxlbWVudFtuYW1lXTtcclxuXHRyZXR1cm4gKGIgJiYgU3lzLlVJLkJlaGF2aW9yLmlzSW5zdGFuY2VPZlR5cGUoYikpID8gYiA6IG51bGw7XHJcbn1cclxuXHJcblN5cy5VSS5CZWhhdmlvci5nZXRCZWhhdmlvcnMgPSBmdW5jdGlvbiBTeXMkVUkkQmVoYXZpb3IkZ2V0QmVoYXZpb3JzKGVsZW1lbnQpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLkJlaGF2aW9yLmdldEJlaGF2aW9yc1wiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZWxlbWVudFwiIGRvbUVsZW1lbnQ9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHJldHVybnMgdHlwZT1cIkFycmF5XCIgZWxlbWVudFR5cGU9XCJTeXMuVUkuQmVoYXZpb3JcIj48L3JldHVybnM+XHJcblxyXG5cdGlmICghZWxlbWVudC5fYmVoYXZpb3JzKSByZXR1cm4gW107XHJcblx0cmV0dXJuIEFycmF5LmNsb25lKGVsZW1lbnQuX2JlaGF2aW9ycyk7XHJcbn1cclxuXHJcblN5cy5VSS5CZWhhdmlvci5nZXRCZWhhdmlvcnNCeVR5cGUgPSBmdW5jdGlvbiBTeXMkVUkkQmVoYXZpb3IkZ2V0QmVoYXZpb3JzQnlUeXBlKGVsZW1lbnQsIHR5cGUpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLkJlaGF2aW9yLmdldEJlaGF2aW9yc0J5VHlwZVwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZWxlbWVudFwiIGRvbUVsZW1lbnQ9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ0eXBlXCIgdHlwZT1cIlR5cGVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiQXJyYXlcIiBlbGVtZW50VHlwZT1cIlN5cy5VSS5CZWhhdmlvclwiPjwvcmV0dXJucz5cclxuXHJcblx0dmFyIGJlaGF2aW9ycyA9IGVsZW1lbnQuX2JlaGF2aW9ycztcclxuXHR2YXIgcmVzdWx0cyA9IFtdO1xyXG5cdGlmIChiZWhhdmlvcnMpIHtcclxuXHRcdGZvciAodmFyIGkgPSAwLCBsID0gYmVoYXZpb3JzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG5cdFx0XHRpZiAodHlwZS5pc0luc3RhbmNlT2ZUeXBlKGJlaGF2aW9yc1tpXSkpIHtcclxuXHRcdFx0XHRyZXN1bHRzLnB1c2goYmVoYXZpb3JzW2ldKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gcmVzdWx0cztcclxufVxyXG5TeXMuVUkuVmlzaWJpbGl0eU1vZGUgPSBmdW5jdGlvbiBTeXMkVUkkVmlzaWJpbGl0eU1vZGUoKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5WaXNpYmlsaXR5TW9kZS4jY3RvclwiIC8+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwiaGlkZVwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiIHN0YXRpYz1cInRydWVcIiBsb2NpZD1cIkY6SiNTeXMuVUkuVmlzaWJpbGl0eU1vZGUuaGlkZVwiPjwvZmllbGQ+XHJcblx0Ly8vIDxmaWVsZCBuYW1lPVwiY29sbGFwc2VcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIiBzdGF0aWM9XCJ0cnVlXCIgbG9jaWQ9XCJGOkojU3lzLlVJLlZpc2liaWxpdHlNb2RlLmNvbGxhcHNlXCI+PC9maWVsZD5cclxuXHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG59XHJcblxyXG5cclxuXHJcblN5cy5VSS5WaXNpYmlsaXR5TW9kZS5wcm90b3R5cGUgPSB7XHJcblx0aGlkZTogMCxcclxuXHRjb2xsYXBzZTogMVxyXG59XHJcblN5cy5VSS5WaXNpYmlsaXR5TW9kZS5yZWdpc3RlckVudW0oXCJTeXMuVUkuVmlzaWJpbGl0eU1vZGVcIik7XHJcblxyXG5TeXMuVUkuQ29udHJvbCA9IGZ1bmN0aW9uIFN5cyRVSSRDb250cm9sKGVsZW1lbnQpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLkNvbnRyb2wuI2N0b3JcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImVsZW1lbnRcIiBkb21FbGVtZW50PVwidHJ1ZVwiPjwvcGFyYW0+XHJcblxyXG5cdGlmICh0eXBlb2YoZWxlbWVudC5jb250cm9sKSAhPT0gJ3VuZGVmaW5lZCcpIHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3lzLlJlcy5jb250cm9sQWxyZWFkeURlZmluZWQpO1xyXG5cdFN5cy5VSS5Db250cm9sLmluaXRpYWxpemVCYXNlKHRoaXMpO1xyXG5cclxuXHR0aGlzLl9lbGVtZW50ID0gZWxlbWVudDtcclxuXHRlbGVtZW50LmNvbnRyb2wgPSB0aGlzO1xyXG5cdHZhciByb2xlID0gdGhpcy5nZXRfcm9sZSgpO1xyXG5cdGlmIChyb2xlKSB7XHJcblx0XHRlbGVtZW50LnNldEF0dHJpYnV0ZShcInJvbGVcIiwgcm9sZSk7XHJcblx0fVxyXG59XHJcblxyXG5cclxuXHJcblxyXG5cdGZ1bmN0aW9uIFN5cyRVSSRDb250cm9sJGdldF9lbGVtZW50KCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSBkb21FbGVtZW50PVwidHJ1ZVwiIGxvY2lkPVwiUDpKI1N5cy5VSS5Db250cm9sLmVsZW1lbnRcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHRyZXR1cm4gdGhpcy5fZWxlbWVudDtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJFVJJENvbnRyb2wkZ2V0X2lkKCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiU3RyaW5nXCIgbG9jaWQ9XCJQOkojU3lzLlVJLkNvbnRyb2wuaWRcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHRyZXR1cm4gdGhpcy5faWQgfHwgKHRoaXMuX2VsZW1lbnQgPyB0aGlzLl9lbGVtZW50LmlkIDogXCJcIik7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRVSSRDb250cm9sJGdldF9wYXJlbnQoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJTeXMuVUkuQ29udHJvbFwiIGxvY2lkPVwiUDpKI1N5cy5VSS5Db250cm9sLnBhcmVudFwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdGlmICh0aGlzLl9wYXJlbnQpIHJldHVybiB0aGlzLl9wYXJlbnQ7XHJcblx0XHRpZiAoIXRoaXMuX2VsZW1lbnQpIHJldHVybiBudWxsO1xyXG5cdFx0dmFyIHBhcmVudEVsZW1lbnQgPSB0aGlzLl9lbGVtZW50LnBhcmVudE5vZGU7XHJcblx0XHR3aGlsZSAocGFyZW50RWxlbWVudCkge1xyXG5cdFx0XHRpZiAocGFyZW50RWxlbWVudC5jb250cm9sKSB7XHJcblx0XHRcdFx0cmV0dXJuIHBhcmVudEVsZW1lbnQuY29udHJvbDtcclxuXHRcdFx0fVxyXG5cdFx0XHRwYXJlbnRFbGVtZW50ID0gcGFyZW50RWxlbWVudC5wYXJlbnROb2RlO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIG51bGw7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRVSSRDb250cm9sJHNldF9wYXJlbnQodmFsdWUpIHtcclxuXHJcblx0XHRpZiAoIXRoaXMuX2VsZW1lbnQpIHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3lzLlJlcy5jYW50QmVDYWxsZWRBZnRlckRpc3Bvc2UpO1xyXG5cdFx0dmFyIHBhcmVudHMgPSBbdGhpc107XHJcblx0XHR2YXIgY3VycmVudCA9IHZhbHVlO1xyXG5cdFx0d2hpbGUgKGN1cnJlbnQpIHtcclxuXHRcdFx0aWYgKEFycmF5LmNvbnRhaW5zKHBhcmVudHMsIGN1cnJlbnQpKSB0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN5cy5SZXMuY2lyY3VsYXJQYXJlbnRDaGFpbik7XHJcblx0XHRcdHBhcmVudHNbcGFyZW50cy5sZW5ndGhdID0gY3VycmVudDtcclxuXHRcdFx0Y3VycmVudCA9IGN1cnJlbnQuZ2V0X3BhcmVudCgpO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5fcGFyZW50ID0gdmFsdWU7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRVSSRDb250cm9sJGdldF9yb2xlKCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiU3RyaW5nXCIgbG9jaWQ9XCJQOkojU3lzLlVJLkNvbnRyb2wucm9sZVwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiBudWxsO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkVUkkQ29udHJvbCRnZXRfdmlzaWJpbGl0eU1vZGUoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJTeXMuVUkuVmlzaWJpbGl0eU1vZGVcIiBsb2NpZD1cIlA6SiNTeXMuVUkuQ29udHJvbC52aXNpYmlsaXR5TW9kZVwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdGlmICghdGhpcy5fZWxlbWVudCkgdGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTeXMuUmVzLmNhbnRCZUNhbGxlZEFmdGVyRGlzcG9zZSk7XHJcblx0XHRyZXR1cm4gU3lzLlVJLkRvbUVsZW1lbnQuZ2V0VmlzaWJpbGl0eU1vZGUodGhpcy5fZWxlbWVudCk7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRVSSRDb250cm9sJHNldF92aXNpYmlsaXR5TW9kZSh2YWx1ZSkge1xyXG5cclxuXHRcdGlmICghdGhpcy5fZWxlbWVudCkgdGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTeXMuUmVzLmNhbnRCZUNhbGxlZEFmdGVyRGlzcG9zZSk7XHJcblx0XHRTeXMuVUkuRG9tRWxlbWVudC5zZXRWaXNpYmlsaXR5TW9kZSh0aGlzLl9lbGVtZW50LCB2YWx1ZSk7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRVSSRDb250cm9sJGdldF92aXNpYmlsaXR5RnVuY3Rpb24oKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJGdW5jdGlvblwiIGxvY2lkPVwiUDpKI1N5cy5VSS5Db250cm9sLnZpc2liaWxpdHlGdW5jdGlvblwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiB0aGlzLl92aXNpYmlsaXR5RnVuY3Rpb247XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRVSSRDb250cm9sJHNldF92aXNpYmlsaXR5RnVuY3Rpb24odmFsdWUpIHtcclxuXHJcblx0XHR0aGlzLl92aXNpYmlsaXR5RnVuY3Rpb24gPSB2YWx1ZTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJFVJJENvbnRyb2wkZ2V0X3Zpc2libGUoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJCb29sZWFuXCIgbG9jaWQ9XCJQOkojU3lzLlVJLkNvbnRyb2wudmlzaWJsZVwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdGlmICghdGhpcy5fZWxlbWVudCkgdGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTeXMuUmVzLmNhbnRCZUNhbGxlZEFmdGVyRGlzcG9zZSk7XHJcblx0XHRyZXR1cm4gU3lzLlVJLkRvbUVsZW1lbnQuZ2V0VmlzaWJsZSh0aGlzLl9lbGVtZW50KTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJFVJJENvbnRyb2wkc2V0X3Zpc2libGUodmFsdWUpIHtcclxuXHJcblx0XHRpZiAoIXRoaXMuX2VsZW1lbnQpIHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3lzLlJlcy5jYW50QmVDYWxsZWRBZnRlckRpc3Bvc2UpO1xyXG5cdFx0U3lzLlVJLkRvbUVsZW1lbnQuc2V0VmlzaWJsZSh0aGlzLl9lbGVtZW50LCB2YWx1ZSwgdGhpcy5nZXRfdmlzaWJpbGl0eUZ1bmN0aW9uKCkpXHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRVSSRDb250cm9sJGFkZENzc0NsYXNzKGNsYXNzTmFtZSkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5Db250cm9sLmFkZENzc0NsYXNzXCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImNsYXNzTmFtZVwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cclxuXHRcdGlmICghdGhpcy5fZWxlbWVudCkgdGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTeXMuUmVzLmNhbnRCZUNhbGxlZEFmdGVyRGlzcG9zZSk7XHJcblx0XHRTeXMuVUkuRG9tRWxlbWVudC5hZGRDc3NDbGFzcyh0aGlzLl9lbGVtZW50LCBjbGFzc05hbWUpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkVUkkQ29udHJvbCRkaXNwb3NlKCkge1xyXG5cdFx0U3lzLlVJLkNvbnRyb2wuY2FsbEJhc2VNZXRob2QodGhpcywgJ2Rpc3Bvc2UnKTtcclxuXHRcdGlmICh0aGlzLl9lbGVtZW50KSB7XHJcblx0XHRcdHRoaXMuX2VsZW1lbnQuY29udHJvbCA9IG51bGw7XHJcblx0XHRcdGRlbGV0ZSB0aGlzLl9lbGVtZW50O1xyXG5cdFx0fVxyXG5cdFx0aWYgKHRoaXMuX3BhcmVudCkgZGVsZXRlIHRoaXMuX3BhcmVudDtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJFVJJENvbnRyb2wkb25CdWJibGVFdmVudChzb3VyY2UsIGFyZ3MpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuQ29udHJvbC5vbkJ1YmJsZUV2ZW50XCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cInNvdXJjZVwiPjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJhcmdzXCIgdHlwZT1cIlN5cy5FdmVudEFyZ3NcIj48L3BhcmFtPlxyXG5cdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJCb29sZWFuXCI+PC9yZXR1cm5zPlxyXG5cclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJFVJJENvbnRyb2wkcmFpc2VCdWJibGVFdmVudChzb3VyY2UsIGFyZ3MpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuQ29udHJvbC5yYWlzZUJ1YmJsZUV2ZW50XCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cInNvdXJjZVwiPjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJhcmdzXCIgdHlwZT1cIlN5cy5FdmVudEFyZ3NcIj48L3BhcmFtPlxyXG5cclxuXHRcdHRoaXMuX3JhaXNlQnViYmxlRXZlbnQoc291cmNlLCBhcmdzKTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJFVJJENvbnRyb2wkX3JhaXNlQnViYmxlRXZlbnQoc291cmNlLCBhcmdzKSB7XHJcblx0XHR2YXIgY3VycmVudFRhcmdldCA9IHRoaXMuZ2V0X3BhcmVudCgpO1xyXG5cdFx0d2hpbGUgKGN1cnJlbnRUYXJnZXQpIHtcclxuXHRcdFx0aWYgKGN1cnJlbnRUYXJnZXQub25CdWJibGVFdmVudChzb3VyY2UsIGFyZ3MpKSB7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblx0XHRcdGN1cnJlbnRUYXJnZXQgPSBjdXJyZW50VGFyZ2V0LmdldF9wYXJlbnQoKTtcclxuXHRcdH1cclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJFVJJENvbnRyb2wkcmVtb3ZlQ3NzQ2xhc3MoY2xhc3NOYW1lKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLkNvbnRyb2wucmVtb3ZlQ3NzQ2xhc3NcIiAvPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiY2xhc3NOYW1lXCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblxyXG5cdFx0aWYgKCF0aGlzLl9lbGVtZW50KSB0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN5cy5SZXMuY2FudEJlQ2FsbGVkQWZ0ZXJEaXNwb3NlKTtcclxuXHRcdFN5cy5VSS5Eb21FbGVtZW50LnJlbW92ZUNzc0NsYXNzKHRoaXMuX2VsZW1lbnQsIGNsYXNzTmFtZSk7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyRVSSRDb250cm9sJHRvZ2dsZUNzc0NsYXNzKGNsYXNzTmFtZSkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5Db250cm9sLnRvZ2dsZUNzc0NsYXNzXCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImNsYXNzTmFtZVwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cclxuXHRcdGlmICghdGhpcy5fZWxlbWVudCkgdGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTeXMuUmVzLmNhbnRCZUNhbGxlZEFmdGVyRGlzcG9zZSk7XHJcblx0XHRTeXMuVUkuRG9tRWxlbWVudC50b2dnbGVDc3NDbGFzcyh0aGlzLl9lbGVtZW50LCBjbGFzc05hbWUpO1xyXG5cdH1cclxuU3lzLlVJLkNvbnRyb2wucHJvdG90eXBlID0ge1xyXG5cdF9wYXJlbnQ6IG51bGwsXHJcblx0X3Zpc2liaWxpdHlNb2RlOiBTeXMuVUkuVmlzaWJpbGl0eU1vZGUuaGlkZSxcclxuXHRnZXRfZWxlbWVudDogU3lzJFVJJENvbnRyb2wkZ2V0X2VsZW1lbnQsXHJcblx0Z2V0X2lkOiBTeXMkVUkkQ29udHJvbCRnZXRfaWQsXHJcblx0Z2V0X3BhcmVudDogU3lzJFVJJENvbnRyb2wkZ2V0X3BhcmVudCxcclxuXHRzZXRfcGFyZW50OiBTeXMkVUkkQ29udHJvbCRzZXRfcGFyZW50LFxyXG5cdGdldF9yb2xlOiBTeXMkVUkkQ29udHJvbCRnZXRfcm9sZSxcclxuXHRnZXRfdmlzaWJpbGl0eU1vZGU6IFN5cyRVSSRDb250cm9sJGdldF92aXNpYmlsaXR5TW9kZSxcclxuXHRzZXRfdmlzaWJpbGl0eU1vZGU6IFN5cyRVSSRDb250cm9sJHNldF92aXNpYmlsaXR5TW9kZSxcclxuXHRnZXRfdmlzaWJpbGl0eUZ1bmN0aW9uOiBTeXMkVUkkQ29udHJvbCRnZXRfdmlzaWJpbGl0eUZ1bmN0aW9uLFxyXG5cdHNldF92aXNpYmlsaXR5RnVuY3Rpb246IFN5cyRVSSRDb250cm9sJHNldF92aXNpYmlsaXR5RnVuY3Rpb24sXHJcblx0Z2V0X3Zpc2libGU6IFN5cyRVSSRDb250cm9sJGdldF92aXNpYmxlLFxyXG5cdHNldF92aXNpYmxlOiBTeXMkVUkkQ29udHJvbCRzZXRfdmlzaWJsZSxcclxuXHRhZGRDc3NDbGFzczogU3lzJFVJJENvbnRyb2wkYWRkQ3NzQ2xhc3MsXHJcblx0ZGlzcG9zZTogU3lzJFVJJENvbnRyb2wkZGlzcG9zZSxcclxuXHRvbkJ1YmJsZUV2ZW50OiBTeXMkVUkkQ29udHJvbCRvbkJ1YmJsZUV2ZW50LFxyXG5cdHJhaXNlQnViYmxlRXZlbnQ6IFN5cyRVSSRDb250cm9sJHJhaXNlQnViYmxlRXZlbnQsXHJcblx0X3JhaXNlQnViYmxlRXZlbnQ6IFN5cyRVSSRDb250cm9sJF9yYWlzZUJ1YmJsZUV2ZW50LFxyXG5cdHJlbW92ZUNzc0NsYXNzOiBTeXMkVUkkQ29udHJvbCRyZW1vdmVDc3NDbGFzcyxcclxuXHR0b2dnbGVDc3NDbGFzczogU3lzJFVJJENvbnRyb2wkdG9nZ2xlQ3NzQ2xhc3NcclxufVxyXG5TeXMuVUkuQ29udHJvbC5yZWdpc3RlckNsYXNzKCdTeXMuVUkuQ29udHJvbCcsIFN5cy5Db21wb25lbnQpO1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5TeXMuSGlzdG9yeUV2ZW50QXJncyA9IGZ1bmN0aW9uIFN5cyRIaXN0b3J5RXZlbnRBcmdzKHN0YXRlKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5IaXN0b3J5RXZlbnRBcmdzLiNjdG9yXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJzdGF0ZVwiIHR5cGU9XCJPYmplY3RcIj48L3BhcmFtPlxyXG5cclxuXHRTeXMuSGlzdG9yeUV2ZW50QXJncy5pbml0aWFsaXplQmFzZSh0aGlzKTtcclxuXHR0aGlzLl9zdGF0ZSA9IHN0YXRlO1xyXG59XHJcblxyXG5cdGZ1bmN0aW9uIFN5cyRIaXN0b3J5RXZlbnRBcmdzJGdldF9zdGF0ZSgpIHtcclxuXHRcdC8vLyA8dmFsdWUgdHlwZT1cIk9iamVjdFwiIGxvY2lkPVwiUDpKI1N5cy5IaXN0b3J5RXZlbnRBcmdzLnN0YXRlXCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0cmV0dXJuIHRoaXMuX3N0YXRlO1xyXG5cdH1cclxuU3lzLkhpc3RvcnlFdmVudEFyZ3MucHJvdG90eXBlID0ge1xyXG5cdGdldF9zdGF0ZTogU3lzJEhpc3RvcnlFdmVudEFyZ3MkZ2V0X3N0YXRlXHJcbn1cclxuU3lzLkhpc3RvcnlFdmVudEFyZ3MucmVnaXN0ZXJDbGFzcygnU3lzLkhpc3RvcnlFdmVudEFyZ3MnLCBTeXMuRXZlbnRBcmdzKTtcclxuXHJcblxyXG5TeXMuQXBwbGljYXRpb24uX2FwcExvYWRIYW5kbGVyID0gbnVsbDtcclxuU3lzLkFwcGxpY2F0aW9uLl9iZWdpblJlcXVlc3RIYW5kbGVyID0gbnVsbDtcclxuU3lzLkFwcGxpY2F0aW9uLl9jbGllbnRJZCA9IG51bGw7XHJcblN5cy5BcHBsaWNhdGlvbi5fY3VycmVudEVudHJ5ID0gJyc7XHJcblN5cy5BcHBsaWNhdGlvbi5fZW5kUmVxdWVzdEhhbmRsZXIgPSBudWxsO1xyXG5TeXMuQXBwbGljYXRpb24uX2hpc3RvcnkgPSBudWxsO1xyXG5TeXMuQXBwbGljYXRpb24uX2VuYWJsZUhpc3RvcnkgPSBmYWxzZTtcclxuU3lzLkFwcGxpY2F0aW9uLl9oaXN0b3J5RW5hYmxlZEluU2NyaXB0TWFuYWdlciA9IGZhbHNlO1xyXG5TeXMuQXBwbGljYXRpb24uX2hpc3RvcnlGcmFtZSA9IG51bGw7XHJcblN5cy5BcHBsaWNhdGlvbi5faGlzdG9yeUluaXRpYWxpemVkID0gZmFsc2U7XHJcblN5cy5BcHBsaWNhdGlvbi5faGlzdG9yeVBvaW50SXNOZXcgPSBmYWxzZTtcclxuU3lzLkFwcGxpY2F0aW9uLl9pZ25vcmVUaW1lciA9IGZhbHNlO1xyXG5TeXMuQXBwbGljYXRpb24uX2luaXRpYWxTdGF0ZSA9IG51bGw7XHJcblN5cy5BcHBsaWNhdGlvbi5fc3RhdGUgPSB7fTtcclxuU3lzLkFwcGxpY2F0aW9uLl90aW1lckNvb2tpZSA9IDA7XHJcblN5cy5BcHBsaWNhdGlvbi5fdGltZXJIYW5kbGVyID0gbnVsbDtcclxuU3lzLkFwcGxpY2F0aW9uLl91bmlxdWVJZCA9IG51bGw7XHJcblxyXG5cclxuXHJcblN5cy5fQXBwbGljYXRpb24ucHJvdG90eXBlLmdldF9zdGF0ZVN0cmluZyA9IGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kZ2V0X3N0YXRlU3RyaW5nKCkge1xyXG5cdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuX0FwcGxpY2F0aW9uLmdldF9zdGF0ZVN0cmluZ1wiIC8+XHJcblx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0dmFyIGhhc2ggPSBudWxsO1xyXG5cdGlmIChpc0Jyb3dzZXIoXCJGaXJlZm94XCIpKSB7XHJcblx0XHR2YXIgaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xyXG5cdFx0dmFyIGhhc2hJbmRleCA9IGhyZWYuaW5kZXhPZignIycpO1xyXG5cdFx0aWYgKGhhc2hJbmRleCAhPT0gLTEpIHtcclxuXHRcdFx0aGFzaCA9IGhyZWYuc3Vic3RyaW5nKGhhc2hJbmRleCArIDEpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGhhc2ggPSBcIlwiO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGhhc2g7XHJcblx0fVxyXG5cdGVsc2Uge1xyXG5cdFx0aGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoO1xyXG5cdH1cclxuXHRpZiAoKGhhc2gubGVuZ3RoID4gMCkgJiYgKGhhc2guY2hhckF0KDApID09PSAnIycpKSB7XHJcblx0XHRoYXNoID0gaGFzaC5zdWJzdHJpbmcoMSk7XHJcblx0fVxyXG5cclxuXHRyZXR1cm4gaGFzaDtcclxufTtcclxuXHJcblN5cy5fQXBwbGljYXRpb24ucHJvdG90eXBlLmdldF9lbmFibGVIaXN0b3J5ID0gZnVuY3Rpb24gU3lzJF9BcHBsaWNhdGlvbiRnZXRfZW5hYmxlSGlzdG9yeSgpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLl9BcHBsaWNhdGlvbi5nZXRfZW5hYmxlSGlzdG9yeVwiIC8+XHJcblx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0cmV0dXJuIHRoaXMuX2VuYWJsZUhpc3Rvcnk7XHJcbn07XHJcblxyXG5TeXMuX0FwcGxpY2F0aW9uLnByb3RvdHlwZS5zZXRfZW5hYmxlSGlzdG9yeSA9IGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kc2V0X2VuYWJsZUhpc3RvcnkodmFsdWUpIHtcclxuXHRpZiAodGhpcy5faW5pdGlhbGl6ZWQgJiYgIXRoaXMuX2luaXRpYWxpemluZykge1xyXG5cdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTeXMuUmVzLmhpc3RvcnlDYW5ub3RFbmFibGVIaXN0b3J5KTtcclxuXHR9XHJcblx0ZWxzZSBpZiAodGhpcy5faGlzdG9yeUVuYWJsZWRJblNjcmlwdE1hbmFnZXIgJiYgIXZhbHVlKSB7XHJcblx0XHR0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN5cy5SZXMuaW52YWxpZEhpc3RvcnlTZXR0aW5nQ29tYmluYXRpb24pO1xyXG5cdH1cclxuXHR0aGlzLl9lbmFibGVIaXN0b3J5ID0gdmFsdWU7XHJcbn07XHJcblxyXG5TeXMuX0FwcGxpY2F0aW9uLnByb3RvdHlwZS5hZGRfbmF2aWdhdGUgPSBmdW5jdGlvbiBTeXMkX0FwcGxpY2F0aW9uJGFkZF9uYXZpZ2F0ZShoYW5kbGVyKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiRTpKI1N5cy5BcHBsaWNhdGlvbi5uYXZpZ2F0ZVwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiaGFuZGxlclwiIHR5cGU9XCJGdW5jdGlvblwiPjwvcGFyYW0+XHJcblxyXG5cdHRoaXMuX2FkZEhhbmRsZXIoXCJuYXZpZ2F0ZVwiLCBoYW5kbGVyKTtcclxufTtcclxuXHJcblN5cy5fQXBwbGljYXRpb24ucHJvdG90eXBlLnJlbW92ZV9uYXZpZ2F0ZSA9IGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kcmVtb3ZlX25hdmlnYXRlKGhhbmRsZXIpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLl9BcHBsaWNhdGlvbi5yZW1vdmVfbmF2aWdhdGVcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImhhbmRsZXJcIiB0eXBlPVwiRnVuY3Rpb25cIj48L3BhcmFtPlxyXG5cclxuXHR0aGlzLl9yZW1vdmVIYW5kbGVyKFwibmF2aWdhdGVcIiwgaGFuZGxlcik7XHJcbn07XHJcblxyXG5TeXMuX0FwcGxpY2F0aW9uLnByb3RvdHlwZS5hZGRIaXN0b3J5UG9pbnQgPSBmdW5jdGlvbiBTeXMkX0FwcGxpY2F0aW9uJGFkZEhpc3RvcnlQb2ludChzdGF0ZSwgdGl0bGUpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLkFwcGxpY2F0aW9uLmFkZEhpc3RvcnlQb2ludFwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwic3RhdGVcIiB0eXBlPVwiT2JqZWN0XCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ0aXRsZVwiIHR5cGU9XCJTdHJpbmdcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHJcblx0aWYgKCF0aGlzLl9lbmFibGVIaXN0b3J5KSB0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN5cy5SZXMuaGlzdG9yeUNhbm5vdEFkZEhpc3RvcnlQb2ludFdpdGhIaXN0b3J5RGlzYWJsZWQpO1xyXG5cdGZvciAodmFyIG4gaW4gc3RhdGUpIHtcclxuXHRcdHZhciB2ID0gc3RhdGVbbl07XHJcblx0XHR2YXIgdCA9IHR5cGVvZih2KTtcclxuXHRcdGlmICgodiAhPT0gbnVsbCkgJiYgKCh0ID09PSAnb2JqZWN0JykgfHwgKHQgPT09ICdmdW5jdGlvbicpIHx8ICh0ID09PSAndW5kZWZpbmVkJykpKSB7XHJcblx0XHRcdHRocm93IEVycm9yLmFyZ3VtZW50KCdzdGF0ZScsIFN5cy5SZXMuc3RhdGVNdXN0QmVTdHJpbmdEaWN0aW9uYXJ5KTtcclxuXHRcdH1cclxuXHR9XHJcblx0dGhpcy5fZW5zdXJlSGlzdG9yeSgpO1xyXG5cdHZhciBpbml0aWFsU3RhdGUgPSB0aGlzLl9zdGF0ZTtcclxuXHRmb3IgKHZhciBrZXkgaW4gc3RhdGUpIHtcclxuXHRcdHZhciB2YWx1ZSA9IHN0YXRlW2tleV07XHJcblx0XHRpZiAodmFsdWUgPT09IG51bGwpIHtcclxuXHRcdFx0aWYgKHR5cGVvZihpbml0aWFsU3RhdGVba2V5XSkgIT09ICd1bmRlZmluZWQnKSB7XHJcblx0XHRcdFx0ZGVsZXRlIGluaXRpYWxTdGF0ZVtrZXldO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0aW5pdGlhbFN0YXRlW2tleV0gPSB2YWx1ZTtcclxuXHRcdH1cclxuXHR9XHJcblx0dmFyIGVudHJ5ID0gdGhpcy5fc2VyaWFsaXplU3RhdGUoaW5pdGlhbFN0YXRlKTtcclxuXHR0aGlzLl9oaXN0b3J5UG9pbnRJc05ldyA9IHRydWU7XHJcblx0dGhpcy5fc2V0U3RhdGUoZW50cnksIHRpdGxlKTtcclxuXHR0aGlzLl9yYWlzZU5hdmlnYXRlKCk7XHJcbn07XHJcblxyXG5TeXMuX0FwcGxpY2F0aW9uLnByb3RvdHlwZS5zZXRTZXJ2ZXJJZCA9IGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kc2V0U2VydmVySWQoY2xpZW50SWQsIHVuaXF1ZUlkKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5BcHBsaWNhdGlvbi5zZXRTZXJ2ZXJJZFwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiY2xpZW50SWRcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ1bmlxdWVJZFwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cclxuXHR0aGlzLl9jbGllbnRJZCA9IGNsaWVudElkO1xyXG5cdHRoaXMuX3VuaXF1ZUlkID0gdW5pcXVlSWQ7XHJcbn07XHJcblxyXG5TeXMuX0FwcGxpY2F0aW9uLnByb3RvdHlwZS5zZXRTZXJ2ZXJTdGF0ZSA9IGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kc2V0U2VydmVyU3RhdGUodmFsdWUpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLkFwcGxpY2F0aW9uLnNldFNlcnZlclN0YXRlXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ2YWx1ZVwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cclxuXHR0aGlzLl9lbnN1cmVIaXN0b3J5KCk7XHJcblx0dGhpcy5fc3RhdGUuX19zID0gdmFsdWU7XHJcblx0dGhpcy5fdXBkYXRlSGlkZGVuRmllbGQodmFsdWUpO1xyXG59O1xyXG5cclxuU3lzLl9BcHBsaWNhdGlvbi5wcm90b3R5cGUuX2Rlc2VyaWFsaXplU3RhdGUgPSBmdW5jdGlvbiBTeXMkX0FwcGxpY2F0aW9uJF9kZXNlcmlhbGl6ZVN0YXRlKGVudHJ5KSB7XHJcblx0dmFyIHJlc3VsdCA9IHt9O1xyXG5cdGVudHJ5ID0gZW50cnkgfHwgJyc7XHJcblx0dmFyIHNlcnZlclNlcGFyYXRvciA9IGVudHJ5LmluZGV4T2YoJyYmJyk7XHJcblx0aWYgKChzZXJ2ZXJTZXBhcmF0b3IgIT09IC0xKSAmJiAoc2VydmVyU2VwYXJhdG9yICsgMiA8IGVudHJ5Lmxlbmd0aCkpIHtcclxuXHRcdHJlc3VsdC5fX3MgPSBlbnRyeS5zdWJzdHIoc2VydmVyU2VwYXJhdG9yICsgMik7XHJcblx0XHRlbnRyeSA9IGVudHJ5LnN1YnN0cigwLCBzZXJ2ZXJTZXBhcmF0b3IpO1xyXG5cdH1cclxuXHR2YXIgdG9rZW5zID0gZW50cnkuc3BsaXQoJyYnKTtcclxuXHRmb3IgKHZhciBpID0gMCwgbCA9IHRva2Vucy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuXHRcdHZhciB0b2tlbiA9IHRva2Vuc1tpXTtcclxuXHRcdHZhciBlcXVhbCA9IHRva2VuLmluZGV4T2YoJz0nKTtcclxuXHRcdGlmICgoZXF1YWwgIT09IC0xKSAmJiAoZXF1YWwgKyAxIDwgdG9rZW4ubGVuZ3RoKSkge1xyXG5cdFx0XHR2YXIgbmFtZSA9IHRva2VuLnN1YnN0cigwLCBlcXVhbCk7XHJcblx0XHRcdHZhciB2YWx1ZSA9IHRva2VuLnN1YnN0cihlcXVhbCArIDEpO1xyXG5cdFx0XHRyZXN1bHRbbmFtZV0gPSBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gcmVzdWx0O1xyXG59O1xyXG5cclxuU3lzLl9BcHBsaWNhdGlvbi5wcm90b3R5cGUuX2VuYWJsZUhpc3RvcnlJblNjcmlwdE1hbmFnZXIgPSBmdW5jdGlvbiBTeXMkX0FwcGxpY2F0aW9uJF9lbmFibGVIaXN0b3J5SW5TY3JpcHRNYW5hZ2VyKCkge1xyXG5cdHRoaXMuX2VuYWJsZUhpc3RvcnkgPSB0cnVlO1xyXG5cdHRoaXMuX2hpc3RvcnlFbmFibGVkSW5TY3JpcHRNYW5hZ2VyID0gdHJ1ZTtcclxufTtcclxuXHJcblN5cy5fQXBwbGljYXRpb24ucHJvdG90eXBlLl9lbnN1cmVIaXN0b3J5ID0gZnVuY3Rpb24gU3lzJF9BcHBsaWNhdGlvbiRfZW5zdXJlSGlzdG9yeSgpIHtcclxuXHRpZiAoIXRoaXMuX2hpc3RvcnlJbml0aWFsaXplZCAmJiB0aGlzLl9lbmFibGVIaXN0b3J5KSB7XHJcblx0XHRpZiAoaXNCcm93c2VyKFwiSW50ZXJuZXRFeHBsb3JlclwiKSAmJiAoU3lzLkJyb3dzZXIuZG9jdW1lbnRNb2RlIDwgOCkpIHtcclxuXHRcdFx0dGhpcy5faGlzdG9yeUZyYW1lID0gU3lzLmdldCgnI19faGlzdG9yeUZyYW1lJyk7XHJcblx0XHRcdGlmICghdGhpcy5faGlzdG9yeUZyYW1lKSB0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN5cy5SZXMuaGlzdG9yeU1pc3NpbmdGcmFtZSk7XHJcblx0XHRcdHRoaXMuX2lnbm9yZUlGcmFtZSA9IHRydWU7XHJcblx0XHR9XHJcblx0XHR0aGlzLl90aW1lckhhbmRsZXIgPSBGdW5jdGlvbi5jcmVhdGVEZWxlZ2F0ZSh0aGlzLCB0aGlzLl9vbklkbGUpO1xyXG5cdFx0dGhpcy5fdGltZXJDb29raWUgPSB3aW5kb3cuc2V0VGltZW91dCh0aGlzLl90aW1lckhhbmRsZXIsIDEwMCk7XHJcblx0XHR0cnkge1xyXG5cdFx0XHR0aGlzLl9pbml0aWFsU3RhdGUgPSB0aGlzLl9kZXNlcmlhbGl6ZVN0YXRlKHRoaXMuZ2V0X3N0YXRlU3RyaW5nKCkpO1xyXG5cdFx0fSBjYXRjaChlKSB7fVxyXG5cdFx0dGhpcy5faGlzdG9yeUluaXRpYWxpemVkID0gdHJ1ZTtcclxuXHR9XHJcbn07XHJcblxyXG5TeXMuX0FwcGxpY2F0aW9uLnByb3RvdHlwZS5fbmF2aWdhdGUgPSBmdW5jdGlvbiBTeXMkX0FwcGxpY2F0aW9uJF9uYXZpZ2F0ZShlbnRyeSkge1xyXG5cdHRoaXMuX2Vuc3VyZUhpc3RvcnkoKTtcclxuXHJcblx0dmFyIHN0YXRlID0gdGhpcy5fZGVzZXJpYWxpemVTdGF0ZShlbnRyeSk7XHJcblx0aWYgKHRoaXMuX3VuaXF1ZUlkKSB7XHJcblx0XHR2YXIgb2xkU2VydmVyRW50cnkgPSB0aGlzLl9zdGF0ZS5fX3MgfHwgJyc7XHJcblx0XHR2YXIgbmV3U2VydmVyRW50cnkgPSBzdGF0ZS5fX3MgfHwgJyc7XHJcblx0XHRpZiAobmV3U2VydmVyRW50cnkgIT09IG9sZFNlcnZlckVudHJ5KSB7XHJcblx0XHRcdHRoaXMuX3VwZGF0ZUhpZGRlbkZpZWxkKG5ld1NlcnZlckVudHJ5KTtcclxuXHRcdFx0X19kb1Bvc3RCYWNrKHRoaXMuX3VuaXF1ZUlkLCBuZXdTZXJ2ZXJFbnRyeSk7XHJcblx0XHRcdHRoaXMuX3N0YXRlID0gc3RhdGU7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHR9XHJcblx0dGhpcy5fc2V0U3RhdGUoZW50cnkpO1xyXG5cdHRoaXMuX3N0YXRlID0gc3RhdGU7XHJcblx0dGhpcy5fcmFpc2VOYXZpZ2F0ZSgpO1xyXG59O1xyXG5cclxuU3lzLl9BcHBsaWNhdGlvbi5wcm90b3R5cGUuX29uSWRsZSA9IGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kX29uSWRsZSgpIHtcclxuXHRkZWxldGUgdGhpcy5fdGltZXJDb29raWU7XHJcblx0dmFyIGVudHJ5ID0gdGhpcy5nZXRfc3RhdGVTdHJpbmcoKTtcclxuXHRpZiAoZW50cnkgIT09IHRoaXMuX2N1cnJlbnRFbnRyeSkge1xyXG5cdFx0aWYgKCF0aGlzLl9pZ25vcmVUaW1lcikge1xyXG5cdFx0XHR0aGlzLl9oaXN0b3J5UG9pbnRJc05ldyA9IGZhbHNlO1xyXG5cdFx0XHR0aGlzLl9uYXZpZ2F0ZShlbnRyeSk7XHJcblx0XHR9XHJcblx0fVxyXG5cdGVsc2Uge1xyXG5cdFx0dGhpcy5faWdub3JlVGltZXIgPSBmYWxzZTtcclxuXHR9XHJcblx0dGhpcy5fdGltZXJDb29raWUgPSB3aW5kb3cuc2V0VGltZW91dCh0aGlzLl90aW1lckhhbmRsZXIsIDEwMCk7XHJcbn07XHJcblxyXG5TeXMuX0FwcGxpY2F0aW9uLnByb3RvdHlwZS5fb25JRnJhbWVMb2FkID0gZnVuY3Rpb24gU3lzJF9BcHBsaWNhdGlvbiRfb25JRnJhbWVMb2FkKGVudHJ5KSB7XHJcblx0dGhpcy5fZW5zdXJlSGlzdG9yeSgpO1xyXG5cdGlmICghdGhpcy5faWdub3JlSUZyYW1lKSB7XHJcblx0XHR0aGlzLl9oaXN0b3J5UG9pbnRJc05ldyA9IGZhbHNlO1xyXG5cdFx0dGhpcy5fbmF2aWdhdGUoZW50cnkpO1xyXG5cdH1cclxuXHR0aGlzLl9pZ25vcmVJRnJhbWUgPSBmYWxzZTtcclxufTtcclxuXHJcblN5cy5fQXBwbGljYXRpb24ucHJvdG90eXBlLl9vblBhZ2VSZXF1ZXN0TWFuYWdlckJlZ2luUmVxdWVzdCA9IGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kX29uUGFnZVJlcXVlc3RNYW5hZ2VyQmVnaW5SZXF1ZXN0KHNlbmRlciwgYXJncykge1xyXG5cdHRoaXMuX2lnbm9yZVRpbWVyID0gdHJ1ZTtcclxuXHR0aGlzLl9vcmlnaW5hbFRpdGxlID0gZG9jdW1lbnQudGl0bGU7XHJcbn07XHJcblxyXG5TeXMuX0FwcGxpY2F0aW9uLnByb3RvdHlwZS5fb25QYWdlUmVxdWVzdE1hbmFnZXJFbmRSZXF1ZXN0ID0gZnVuY3Rpb24gU3lzJF9BcHBsaWNhdGlvbiRfb25QYWdlUmVxdWVzdE1hbmFnZXJFbmRSZXF1ZXN0KHNlbmRlciwgYXJncykge1xyXG5cdHZhciBkYXRhSXRlbSA9IGFyZ3MuZ2V0X2RhdGFJdGVtcygpW3RoaXMuX2NsaWVudElkXTtcclxuXHR2YXIgb3JpZ2luYWxUaXRsZSA9IHRoaXMuX29yaWdpbmFsVGl0bGU7XHJcblx0dGhpcy5fb3JpZ2luYWxUaXRsZSA9IG51bGw7XHJcblxyXG5cdHZhciBldmVudFRhcmdldCA9IFN5cy5nZXQoXCIjX19FVkVOVFRBUkdFVFwiKTtcclxuXHRpZiAoZXZlbnRUYXJnZXQgJiYgZXZlbnRUYXJnZXQudmFsdWUgPT09IHRoaXMuX3VuaXF1ZUlkKSB7XHJcblx0XHRldmVudFRhcmdldC52YWx1ZSA9ICcnO1xyXG5cdH1cclxuXHRpZiAodHlwZW9mKGRhdGFJdGVtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuXHRcdHRoaXMuc2V0U2VydmVyU3RhdGUoZGF0YUl0ZW0pO1xyXG5cdFx0dGhpcy5faGlzdG9yeVBvaW50SXNOZXcgPSB0cnVlO1xyXG5cdH1cclxuXHRlbHNlIHtcclxuXHRcdHRoaXMuX2lnbm9yZVRpbWVyID0gZmFsc2U7XHJcblx0fVxyXG5cdHZhciBlbnRyeSA9IHRoaXMuX3NlcmlhbGl6ZVN0YXRlKHRoaXMuX3N0YXRlKTtcclxuXHRpZiAoZW50cnkgIT09IHRoaXMuX2N1cnJlbnRFbnRyeSkge1xyXG5cdFx0dGhpcy5faWdub3JlVGltZXIgPSB0cnVlO1xyXG5cdFx0aWYgKHR5cGVvZihvcmlnaW5hbFRpdGxlKSA9PT0gXCJzdHJpbmdcIikge1xyXG5cdFx0XHRpZiAoU3lzLkJyb3dzZXIuYWdlbnQgIT09IFN5cy5Ccm93c2VyLkludGVybmV0RXhwbG9yZXIgfHwgU3lzLkJyb3dzZXIudmVyc2lvbiA+IDcpIHtcclxuXHRcdFx0XHR2YXIgbmV3VGl0bGUgPSBkb2N1bWVudC50aXRsZTtcclxuXHRcdFx0XHRkb2N1bWVudC50aXRsZSA9IG9yaWdpbmFsVGl0bGU7XHJcblx0XHRcdFx0dGhpcy5fc2V0U3RhdGUoZW50cnkpO1xyXG5cdFx0XHRcdGRvY3VtZW50LnRpdGxlID0gbmV3VGl0bGU7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5fc2V0U3RhdGUoZW50cnkpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHRoaXMuX3JhaXNlTmF2aWdhdGUoKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHR0aGlzLl9zZXRTdGF0ZShlbnRyeSk7XHJcblx0XHRcdHRoaXMuX3JhaXNlTmF2aWdhdGUoKTtcclxuXHRcdH1cclxuXHR9XHJcbn07XHJcblxyXG5TeXMuX0FwcGxpY2F0aW9uLnByb3RvdHlwZS5fcmFpc2VOYXZpZ2F0ZSA9IGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kX3JhaXNlTmF2aWdhdGUoKSB7XHJcblx0dmFyIGlzTmV3ID0gdGhpcy5faGlzdG9yeVBvaW50SXNOZXc7XHJcblx0dmFyIHN0YXRlQ2xvbmUgPSB7fTtcclxuXHRmb3IgKHZhciBrZXkgaW4gdGhpcy5fc3RhdGUpIHtcclxuXHRcdGlmIChrZXkgIT09ICdfX3MnKSB7XHJcblx0XHRcdHN0YXRlQ2xvbmVba2V5XSA9IHRoaXMuX3N0YXRlW2tleV07XHJcblx0XHR9XHJcblx0fVxyXG5cdHZhciBhcmdzID0gbmV3IFN5cy5IaXN0b3J5RXZlbnRBcmdzKHN0YXRlQ2xvbmUpO1xyXG5cdFN5cy5PYnNlcnZlci5yYWlzZUV2ZW50KHRoaXMsIFwibmF2aWdhdGVcIiwgYXJncyk7XHJcblx0aWYgKCFpc05ldykge1xyXG5cdFx0dmFyIGVycjtcclxuXHRcdHRyeSB7XHJcblx0XHRcdGlmIChpc0Jyb3dzZXIoXCJGaXJlZm94XCIpICYmIHdpbmRvdy5sb2NhdGlvbi5oYXNoICYmXHJcblx0XHRcdFx0KCF3aW5kb3cuZnJhbWVFbGVtZW50IHx8IHdpbmRvdy50b3AubG9jYXRpb24uaGFzaCkpIHtcclxuXHRcdFx0XHQoU3lzLkJyb3dzZXIudmVyc2lvbiA8IDMuNSkgP1xyXG5cdFx0XHRcdFx0d2luZG93Lmhpc3RvcnkuZ28oMCkgOlxyXG5cdFx0XHRcdFx0bG9jYXRpb24uaGFzaCA9IHRoaXMuZ2V0X3N0YXRlU3RyaW5nKCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGNhdGNoKGVycikge1xyXG5cdFx0fVxyXG5cdH1cclxufTtcclxuXHJcblN5cy5fQXBwbGljYXRpb24ucHJvdG90eXBlLl9zZXJpYWxpemVTdGF0ZSA9IGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kX3NlcmlhbGl6ZVN0YXRlKHN0YXRlKSB7XHJcblx0dmFyIHNlcmlhbGl6ZWQgPSBbXTtcclxuXHRmb3IgKHZhciBrZXkgaW4gc3RhdGUpIHtcclxuXHRcdHZhciB2YWx1ZSA9IHN0YXRlW2tleV07XHJcblx0XHRpZiAoa2V5ID09PSAnX19zJykge1xyXG5cdFx0XHR2YXIgc2VydmVyU3RhdGUgPSB2YWx1ZTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRpZiAoa2V5LmluZGV4T2YoJz0nKSAhPT0gLTEpIHRocm93IEVycm9yLmFyZ3VtZW50KCdzdGF0ZScsIFN5cy5SZXMuc3RhdGVGaWVsZE5hbWVJbnZhbGlkKTtcclxuXHRcdFx0c2VyaWFsaXplZFtzZXJpYWxpemVkLmxlbmd0aF0gPSBrZXkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gc2VyaWFsaXplZC5qb2luKCcmJykgKyAoc2VydmVyU3RhdGUgPyAnJiYnICsgc2VydmVyU3RhdGUgOiAnJyk7XHJcbn07XHJcblxyXG5TeXMuX0FwcGxpY2F0aW9uLnByb3RvdHlwZS5fc2V0U3RhdGUgPSBmdW5jdGlvbiBTeXMkX0FwcGxpY2F0aW9uJF9zZXRTdGF0ZShlbnRyeSwgdGl0bGUpIHtcclxuXHRpZiAodGhpcy5fZW5hYmxlSGlzdG9yeSkge1xyXG5cdFx0ZW50cnkgPSBlbnRyeSB8fCAnJztcclxuXHRcdGlmIChlbnRyeSAhPT0gdGhpcy5fY3VycmVudEVudHJ5KSB7XHJcblx0XHRcdGlmICh3aW5kb3cudGhlRm9ybSkge1xyXG5cdFx0XHRcdHZhciBhY3Rpb24gPSB3aW5kb3cudGhlRm9ybS5hY3Rpb247XHJcblx0XHRcdFx0dmFyIGhhc2hJbmRleCA9IGFjdGlvbi5pbmRleE9mKCcjJyk7XHJcblx0XHRcdFx0d2luZG93LnRoZUZvcm0uYWN0aW9uID0gKChoYXNoSW5kZXggIT09IC0xKSA/IGFjdGlvbi5zdWJzdHJpbmcoMCwgaGFzaEluZGV4KSA6IGFjdGlvbikgKyAnIycgKyBlbnRyeTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodGhpcy5faGlzdG9yeUZyYW1lICYmIHRoaXMuX2hpc3RvcnlQb2ludElzTmV3KSB7XHJcblx0XHRcdFx0dGhpcy5faWdub3JlSUZyYW1lID0gdHJ1ZTtcclxuXHRcdFx0XHR2YXIgZnJhbWVEb2MgPSB0aGlzLl9oaXN0b3J5RnJhbWUuY29udGVudFdpbmRvdy5kb2N1bWVudDtcclxuXHRcdFx0XHRmcmFtZURvYy5vcGVuKFwiamF2YXNjcmlwdDonPGh0bWw+PC9odG1sPidcIik7XHJcblx0XHRcdFx0ZnJhbWVEb2Mud3JpdGUoXCI8aHRtbD48aGVhZD48dGl0bGU+XCIgKyAodGl0bGUgfHwgZG9jdW1lbnQudGl0bGUpICtcclxuXHRcdFx0XHRcdFwiPC90aXRsZT48c2NyaVwiICsgXCJwdCB0eXBlPVxcXCJ0ZXh0L2phdmFzY3JpcHRcXFwiPnBhcmVudC5TeXMuQXBwbGljYXRpb24uX29uSUZyYW1lTG9hZChcIiArXHJcblx0XHRcdFx0XHRTeXMuU2VyaWFsaXphdGlvbi5KYXZhU2NyaXB0U2VyaWFsaXplci5zZXJpYWxpemUoZW50cnkpICtcclxuXHRcdFx0XHRcdFwiKTs8L3NjcmlcIiArIFwicHQ+PC9oZWFkPjxib2R5PjwvYm9keT48L2h0bWw+XCIpO1xyXG5cdFx0XHRcdGZyYW1lRG9jLmNsb3NlKCk7XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5faWdub3JlVGltZXIgPSBmYWxzZTtcclxuXHRcdFx0dGhpcy5fY3VycmVudEVudHJ5ID0gZW50cnk7XHJcblx0XHRcdGlmICh0aGlzLl9oaXN0b3J5RnJhbWUgfHwgdGhpcy5faGlzdG9yeVBvaW50SXNOZXcpIHtcclxuXHRcdFx0XHR2YXIgY3VycmVudEhhc2ggPSB0aGlzLmdldF9zdGF0ZVN0cmluZygpO1xyXG5cdFx0XHRcdGlmIChlbnRyeSAhPT0gY3VycmVudEhhc2gpIHtcclxuXHRcdFx0XHRcdHZhciBsb2MgPSBkb2N1bWVudC5sb2NhdGlvbjtcclxuXHRcdFx0XHRcdGlmIChsb2MuaHJlZi5sZW5ndGggLSBsb2MuaGFzaC5sZW5ndGggKyBlbnRyeS5sZW5ndGggPiAyMDQ4KSB7XHJcblx0XHRcdFx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuUmVzLnVybFRvb0xvbmcsIDIwNDgpKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gZW50cnk7XHJcblx0XHRcdFx0XHR0aGlzLl9jdXJyZW50RW50cnkgPSB0aGlzLmdldF9zdGF0ZVN0cmluZygpO1xyXG5cdFx0XHRcdFx0aWYgKCh0eXBlb2YodGl0bGUpICE9PSAndW5kZWZpbmVkJykgJiYgKHRpdGxlICE9PSBudWxsKSkge1xyXG5cdFx0XHRcdFx0XHRkb2N1bWVudC50aXRsZSA9IHRpdGxlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHR0aGlzLl9oaXN0b3J5UG9pbnRJc05ldyA9IGZhbHNlO1xyXG5cdFx0fVxyXG5cdH1cclxufTtcclxuXHJcblN5cy5fQXBwbGljYXRpb24ucHJvdG90eXBlLl91cGRhdGVIaWRkZW5GaWVsZCA9IGZ1bmN0aW9uIFN5cyRfQXBwbGljYXRpb24kX3VwZGF0ZUhpZGRlbkZpZWxkKHZhbHVlKSB7XHJcblx0aWYgKHRoaXMuX2NsaWVudElkKSB7XHJcblx0XHR2YXIgc2VydmVyU3RhdGVGaWVsZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuX2NsaWVudElkKTtcclxuXHRcdGlmIChzZXJ2ZXJTdGF0ZUZpZWxkKSB7XHJcblx0XHRcdHNlcnZlclN0YXRlRmllbGQudmFsdWUgPSB2YWx1ZTtcclxuXHRcdH1cclxuXHR9XHJcbn07XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbmlmICghd2luZG93LlhNTEh0dHBSZXF1ZXN0KSB7XHJcblx0d2luZG93LlhNTEh0dHBSZXF1ZXN0ID0gZnVuY3Rpb24gd2luZG93JFhNTEh0dHBSZXF1ZXN0KCkge1xyXG5cdFx0dmFyIHByb2dJRHMgPSBbICdNc3htbDIuWE1MSFRUUC4zLjAnLCAnTXN4bWwyLlhNTEhUVFAnIF07XHJcblx0XHRmb3IgKHZhciBpID0gMCwgbCA9IHByb2dJRHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XHJcblx0XHRcdHRyeSB7XHJcblx0XHRcdFx0cmV0dXJuIG5ldyBBY3RpdmVYT2JqZWN0KHByb2dJRHNbaV0pO1xyXG5cdFx0XHR9XHJcblx0XHRcdGNhdGNoIChleCkge1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcbn1cclxuXHJcblR5cGUucmVnaXN0ZXJOYW1lc3BhY2UoJ1N5cy5OZXQnKTtcclxuXHJcblN5cy5OZXQuV2ViUmVxdWVzdEV4ZWN1dG9yID0gZnVuY3Rpb24gU3lzJE5ldCRXZWJSZXF1ZXN0RXhlY3V0b3IoKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5OZXQuV2ViUmVxdWVzdEV4ZWN1dG9yLiNjdG9yXCIgLz5cclxuXHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHR0aGlzLl93ZWJSZXF1ZXN0ID0gbnVsbDtcclxuXHR0aGlzLl9yZXN1bHRPYmplY3QgPSBudWxsO1xyXG59XHJcblxyXG5cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlJlcXVlc3RFeGVjdXRvciRnZXRfd2ViUmVxdWVzdCgpIHtcclxuXHRcdC8vLyA8dmFsdWUgdHlwZT1cIlN5cy5OZXQuV2ViUmVxdWVzdFwiIGxvY2lkPVwiUDpKI1N5cy5OZXQuV2ViUmVxdWVzdEV4ZWN1dG9yLndlYlJlcXVlc3RcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHRyZXR1cm4gdGhpcy5fd2ViUmVxdWVzdDtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIFN5cyROZXQkV2ViUmVxdWVzdEV4ZWN1dG9yJF9zZXRfd2ViUmVxdWVzdCh2YWx1ZSkge1xyXG5cdFx0aWYgKHRoaXMuZ2V0X3N0YXJ0ZWQoKSkge1xyXG5cdFx0XHR0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN0cmluZy5mb3JtYXQoU3lzLlJlcy5jYW5ub3RDYWxsT25jZVN0YXJ0ZWQsICdzZXRfd2ViUmVxdWVzdCcpKTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLl93ZWJSZXF1ZXN0ID0gdmFsdWU7XHJcblx0fVxyXG5cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJSZXF1ZXN0RXhlY3V0b3IkZ2V0X3N0YXJ0ZWQoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJCb29sZWFuXCIgbG9jaWQ9XCJQOkojU3lzLk5ldC5XZWJSZXF1ZXN0RXhlY3V0b3Iuc3RhcnRlZFwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHRocm93IEVycm9yLm5vdEltcGxlbWVudGVkKCk7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlJlcXVlc3RFeGVjdXRvciRnZXRfcmVzcG9uc2VBdmFpbGFibGUoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJCb29sZWFuXCIgbG9jaWQ9XCJQOkojU3lzLk5ldC5XZWJSZXF1ZXN0RXhlY3V0b3IucmVzcG9uc2VBdmFpbGFibGVcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJSZXF1ZXN0RXhlY3V0b3IkZ2V0X3RpbWVkT3V0KCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiQm9vbGVhblwiIGxvY2lkPVwiUDpKI1N5cy5OZXQuV2ViUmVxdWVzdEV4ZWN1dG9yLnRpbWVkT3V0XCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0dGhyb3cgRXJyb3Iubm90SW1wbGVtZW50ZWQoKTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJSZXF1ZXN0RXhlY3V0b3IkZ2V0X2Fib3J0ZWQoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJCb29sZWFuXCIgbG9jaWQ9XCJQOkojU3lzLk5ldC5XZWJSZXF1ZXN0RXhlY3V0b3IuYWJvcnRlZFwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHRocm93IEVycm9yLm5vdEltcGxlbWVudGVkKCk7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyROZXQkV2ViUmVxdWVzdEV4ZWN1dG9yJGdldF9yZXNwb25zZURhdGEoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJTdHJpbmdcIiBsb2NpZD1cIlA6SiNTeXMuTmV0LldlYlJlcXVlc3RFeGVjdXRvci5yZXNwb25zZURhdGFcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlJlcXVlc3RFeGVjdXRvciRnZXRfc3RhdHVzQ29kZSgpIHtcclxuXHRcdC8vLyA8dmFsdWUgdHlwZT1cIk51bWJlclwiIGxvY2lkPVwiUDpKI1N5cy5OZXQuV2ViUmVxdWVzdEV4ZWN1dG9yLnN0YXR1c0NvZGVcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlJlcXVlc3RFeGVjdXRvciRnZXRfc3RhdHVzVGV4dCgpIHtcclxuXHRcdC8vLyA8dmFsdWUgdHlwZT1cIlN0cmluZ1wiIGxvY2lkPVwiUDpKI1N5cy5OZXQuV2ViUmVxdWVzdEV4ZWN1dG9yLnN0YXR1c1RleHRcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlJlcXVlc3RFeGVjdXRvciRnZXRfeG1sKCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSBsb2NpZD1cIlA6SiNTeXMuTmV0LldlYlJlcXVlc3RFeGVjdXRvci54bWxcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlJlcXVlc3RFeGVjdXRvciRnZXRfb2JqZWN0KCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSBsb2NpZD1cIlA6SiNTeXMuTmV0LldlYlJlcXVlc3RFeGVjdXRvci5vYmplY3RcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHRpZiAoIXRoaXMuX3Jlc3VsdE9iamVjdCkge1xyXG5cdFx0XHR0aGlzLl9yZXN1bHRPYmplY3QgPSBTeXMuU2VyaWFsaXphdGlvbi5KYXZhU2NyaXB0U2VyaWFsaXplci5kZXNlcmlhbGl6ZSh0aGlzLmdldF9yZXNwb25zZURhdGEoKSk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdGhpcy5fcmVzdWx0T2JqZWN0O1xyXG5cdH1cclxuXHJcblxyXG5cdGZ1bmN0aW9uIFN5cyROZXQkV2ViUmVxdWVzdEV4ZWN1dG9yJGV4ZWN1dGVSZXF1ZXN0KCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5OZXQuV2ViUmVxdWVzdEV4ZWN1dG9yLmV4ZWN1dGVSZXF1ZXN0XCIgLz5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0dGhyb3cgRXJyb3Iubm90SW1wbGVtZW50ZWQoKTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJSZXF1ZXN0RXhlY3V0b3IkYWJvcnQoKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk5ldC5XZWJSZXF1ZXN0RXhlY3V0b3IuYWJvcnRcIiAvPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlJlcXVlc3RFeGVjdXRvciRnZXRSZXNwb25zZUhlYWRlcihoZWFkZXIpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuTmV0LldlYlJlcXVlc3RFeGVjdXRvci5nZXRSZXNwb25zZUhlYWRlclwiIC8+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJoZWFkZXJcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHJcblx0XHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlJlcXVlc3RFeGVjdXRvciRnZXRBbGxSZXNwb25zZUhlYWRlcnMoKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk5ldC5XZWJSZXF1ZXN0RXhlY3V0b3IuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzXCIgLz5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0dGhyb3cgRXJyb3Iubm90SW1wbGVtZW50ZWQoKTtcclxuXHR9XHJcblN5cy5OZXQuV2ViUmVxdWVzdEV4ZWN1dG9yLnByb3RvdHlwZSA9IHtcclxuXHRnZXRfd2ViUmVxdWVzdDogU3lzJE5ldCRXZWJSZXF1ZXN0RXhlY3V0b3IkZ2V0X3dlYlJlcXVlc3QsXHJcblx0X3NldF93ZWJSZXF1ZXN0OiBTeXMkTmV0JFdlYlJlcXVlc3RFeGVjdXRvciRfc2V0X3dlYlJlcXVlc3QsXHJcblx0Z2V0X3N0YXJ0ZWQ6IFN5cyROZXQkV2ViUmVxdWVzdEV4ZWN1dG9yJGdldF9zdGFydGVkLFxyXG5cdGdldF9yZXNwb25zZUF2YWlsYWJsZTogU3lzJE5ldCRXZWJSZXF1ZXN0RXhlY3V0b3IkZ2V0X3Jlc3BvbnNlQXZhaWxhYmxlLFxyXG5cdGdldF90aW1lZE91dDogU3lzJE5ldCRXZWJSZXF1ZXN0RXhlY3V0b3IkZ2V0X3RpbWVkT3V0LFxyXG5cdGdldF9hYm9ydGVkOiBTeXMkTmV0JFdlYlJlcXVlc3RFeGVjdXRvciRnZXRfYWJvcnRlZCxcclxuXHRnZXRfcmVzcG9uc2VEYXRhOiBTeXMkTmV0JFdlYlJlcXVlc3RFeGVjdXRvciRnZXRfcmVzcG9uc2VEYXRhLFxyXG5cdGdldF9zdGF0dXNDb2RlOiBTeXMkTmV0JFdlYlJlcXVlc3RFeGVjdXRvciRnZXRfc3RhdHVzQ29kZSxcclxuXHRnZXRfc3RhdHVzVGV4dDogU3lzJE5ldCRXZWJSZXF1ZXN0RXhlY3V0b3IkZ2V0X3N0YXR1c1RleHQsXHJcblx0Z2V0X3htbDogU3lzJE5ldCRXZWJSZXF1ZXN0RXhlY3V0b3IkZ2V0X3htbCxcclxuXHRnZXRfb2JqZWN0OiBTeXMkTmV0JFdlYlJlcXVlc3RFeGVjdXRvciRnZXRfb2JqZWN0LFxyXG5cdGV4ZWN1dGVSZXF1ZXN0OiBTeXMkTmV0JFdlYlJlcXVlc3RFeGVjdXRvciRleGVjdXRlUmVxdWVzdCxcclxuXHRhYm9ydDogU3lzJE5ldCRXZWJSZXF1ZXN0RXhlY3V0b3IkYWJvcnQsXHJcblx0Z2V0UmVzcG9uc2VIZWFkZXI6IFN5cyROZXQkV2ViUmVxdWVzdEV4ZWN1dG9yJGdldFJlc3BvbnNlSGVhZGVyLFxyXG5cdGdldEFsbFJlc3BvbnNlSGVhZGVyczogU3lzJE5ldCRXZWJSZXF1ZXN0RXhlY3V0b3IkZ2V0QWxsUmVzcG9uc2VIZWFkZXJzXHJcbn1cclxuU3lzLk5ldC5XZWJSZXF1ZXN0RXhlY3V0b3IucmVnaXN0ZXJDbGFzcygnU3lzLk5ldC5XZWJSZXF1ZXN0RXhlY3V0b3InKTtcclxuU3lzLk5ldC5YTUxET00gPSBmdW5jdGlvbiBTeXMkTmV0JFhNTERPTShtYXJrdXApIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk5ldC5YTUxET00uI2N0b3JcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cIm1hcmt1cFwiIHR5cGU9XCJTdHJpbmdcIj48L3BhcmFtPlxyXG5cclxuXHRpZiAoIXdpbmRvdy5ET01QYXJzZXIpIHtcclxuXHRcdHZhciBwcm9nSURzID0gWyAnTXN4bWwyLkRPTURvY3VtZW50LjMuMCcsICdNc3htbDIuRE9NRG9jdW1lbnQnIF07XHJcblx0XHRmb3IgKHZhciBpID0gMCwgbCA9IHByb2dJRHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XHJcblx0XHRcdHRyeSB7XHJcblx0XHRcdFx0dmFyIHhtbERPTSA9IG5ldyBBY3RpdmVYT2JqZWN0KHByb2dJRHNbaV0pO1xyXG5cdFx0XHRcdHhtbERPTS5hc3luYyA9IGZhbHNlO1xyXG5cdFx0XHRcdHhtbERPTS5sb2FkWE1MKG1hcmt1cCk7XHJcblx0XHRcdFx0eG1sRE9NLnNldFByb3BlcnR5KCdTZWxlY3Rpb25MYW5ndWFnZScsICdYUGF0aCcpO1xyXG5cdFx0XHRcdHJldHVybiB4bWxET007XHJcblx0XHRcdH1cclxuXHRcdFx0Y2F0Y2ggKGV4KSB7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0ZWxzZSB7XHJcblx0XHR0cnkge1xyXG5cdFx0XHR2YXIgZG9tUGFyc2VyID0gbmV3IHdpbmRvdy5ET01QYXJzZXIoKTtcclxuXHRcdFx0cmV0dXJuIGRvbVBhcnNlci5wYXJzZUZyb21TdHJpbmcobWFya3VwLCAndGV4dC94bWwnKTtcclxuXHRcdH1cclxuXHRcdGNhdGNoIChleCkge1xyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gbnVsbDtcclxufVxyXG5cclxuU3lzLk5ldC5YTUxIdHRwRXhlY3V0b3IgPSBmdW5jdGlvbiBTeXMkTmV0JFhNTEh0dHBFeGVjdXRvcigpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk5ldC5YTUxIdHRwRXhlY3V0b3IuI2N0b3JcIiAvPlxyXG5cdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cclxuXHRTeXMuTmV0LlhNTEh0dHBFeGVjdXRvci5pbml0aWFsaXplQmFzZSh0aGlzKTtcclxuXHJcblx0dmFyIF90aGlzID0gdGhpcztcclxuXHR0aGlzLl94bWxIdHRwUmVxdWVzdCA9IG51bGw7XHJcblx0dGhpcy5fd2ViUmVxdWVzdCA9IG51bGw7XHJcblx0dGhpcy5fcmVzcG9uc2VBdmFpbGFibGUgPSBmYWxzZTtcclxuXHR0aGlzLl90aW1lZE91dCA9IGZhbHNlO1xyXG5cdHRoaXMuX3RpbWVyID0gbnVsbDtcclxuXHR0aGlzLl9hYm9ydGVkID0gZmFsc2U7XHJcblx0dGhpcy5fc3RhcnRlZCA9IGZhbHNlO1xyXG5cclxuXHR0aGlzLl9vblJlYWR5U3RhdGVDaGFuZ2UgPSAoZnVuY3Rpb24gKCkge1xyXG5cclxuXHRcdGlmIChfdGhpcy5feG1sSHR0cFJlcXVlc3QucmVhZHlTdGF0ZSA9PT0gNFxyXG4pIHtcclxuXHRcdFx0dHJ5IHtcclxuXHRcdFx0XHRpZiAodHlwZW9mKF90aGlzLl94bWxIdHRwUmVxdWVzdC5zdGF0dXMpID09PSBcInVuZGVmaW5lZFwiKSB7XHJcblx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGNhdGNoKGV4KSB7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblx0XHRcdF90aGlzLl9jbGVhclRpbWVyKCk7XHJcblx0XHRcdF90aGlzLl9yZXNwb25zZUF2YWlsYWJsZSA9IHRydWU7XHJcblx0XHRcdFx0X3RoaXMuX3dlYlJlcXVlc3QuY29tcGxldGVkKFN5cy5FdmVudEFyZ3MuRW1wdHkpO1xyXG5cdFx0XHRcdGlmIChfdGhpcy5feG1sSHR0cFJlcXVlc3QgIT0gbnVsbCkge1xyXG5cdFx0XHRcdFx0X3RoaXMuX3htbEh0dHBSZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IEZ1bmN0aW9uLmVtcHR5TWV0aG9kO1xyXG5cdFx0XHRcdFx0X3RoaXMuX3htbEh0dHBSZXF1ZXN0ID0gbnVsbDtcclxuXHRcdFx0XHR9XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdHRoaXMuX2NsZWFyVGltZXIgPSAoZnVuY3Rpb24oKSB7XHJcblx0XHRpZiAoX3RoaXMuX3RpbWVyICE9IG51bGwpIHtcclxuXHRcdFx0d2luZG93LmNsZWFyVGltZW91dChfdGhpcy5fdGltZXIpO1xyXG5cdFx0XHRfdGhpcy5fdGltZXIgPSBudWxsO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHR0aGlzLl9vblRpbWVvdXQgPSAoZnVuY3Rpb24oKSB7XHJcblx0XHRpZiAoIV90aGlzLl9yZXNwb25zZUF2YWlsYWJsZSkge1xyXG5cdFx0XHRfdGhpcy5fY2xlYXJUaW1lcigpO1xyXG5cdFx0XHRfdGhpcy5fdGltZWRPdXQgPSB0cnVlO1xyXG5cdFx0XHRfdGhpcy5feG1sSHR0cFJlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gRnVuY3Rpb24uZW1wdHlNZXRob2Q7XHJcblx0XHRcdF90aGlzLl94bWxIdHRwUmVxdWVzdC5hYm9ydCgpO1xyXG5cdFx0XHRfdGhpcy5fd2ViUmVxdWVzdC5jb21wbGV0ZWQoU3lzLkV2ZW50QXJncy5FbXB0eSk7XHJcblx0XHRcdF90aGlzLl94bWxIdHRwUmVxdWVzdCA9IG51bGw7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG59XHJcblxyXG5cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRYTUxIdHRwRXhlY3V0b3IkZ2V0X3RpbWVkT3V0KCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiQm9vbGVhblwiIGxvY2lkPVwiUDpKI1N5cy5OZXQuWE1MSHR0cEV4ZWN1dG9yLnRpbWVkT3V0XCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0cmV0dXJuIHRoaXMuX3RpbWVkT3V0O1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRYTUxIdHRwRXhlY3V0b3IkZ2V0X3N0YXJ0ZWQoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJCb29sZWFuXCIgbG9jaWQ9XCJQOkojU3lzLk5ldC5YTUxIdHRwRXhlY3V0b3Iuc3RhcnRlZFwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiB0aGlzLl9zdGFydGVkO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRYTUxIdHRwRXhlY3V0b3IkZ2V0X3Jlc3BvbnNlQXZhaWxhYmxlKCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiQm9vbGVhblwiIGxvY2lkPVwiUDpKI1N5cy5OZXQuWE1MSHR0cEV4ZWN1dG9yLnJlc3BvbnNlQXZhaWxhYmxlXCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0cmV0dXJuIHRoaXMuX3Jlc3BvbnNlQXZhaWxhYmxlO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRYTUxIdHRwRXhlY3V0b3IkZ2V0X2Fib3J0ZWQoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJCb29sZWFuXCIgbG9jaWQ9XCJQOkojU3lzLk5ldC5YTUxIdHRwRXhlY3V0b3IuYWJvcnRlZFwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiB0aGlzLl9hYm9ydGVkO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRYTUxIdHRwRXhlY3V0b3IkZXhlY3V0ZVJlcXVlc3QoKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk5ldC5YTUxIdHRwRXhlY3V0b3IuZXhlY3V0ZVJlcXVlc3RcIiAvPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHR0aGlzLl93ZWJSZXF1ZXN0ID0gdGhpcy5nZXRfd2ViUmVxdWVzdCgpO1xyXG5cclxuXHRcdGlmICh0aGlzLl9zdGFydGVkKSB7XHJcblx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuUmVzLmNhbm5vdENhbGxPbmNlU3RhcnRlZCwgJ2V4ZWN1dGVSZXF1ZXN0JykpO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHRoaXMuX3dlYlJlcXVlc3QgPT09IG51bGwpIHtcclxuXHRcdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTeXMuUmVzLm51bGxXZWJSZXF1ZXN0KTtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgYm9keSA9IHRoaXMuX3dlYlJlcXVlc3QuZ2V0X2JvZHkoKTtcclxuXHRcdHZhciBoZWFkZXJzID0gdGhpcy5fd2ViUmVxdWVzdC5nZXRfaGVhZGVycygpO1xyXG5cdFx0dGhpcy5feG1sSHR0cFJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuXHRcdHRoaXMuX3htbEh0dHBSZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IHRoaXMuX29uUmVhZHlTdGF0ZUNoYW5nZTtcclxuXHRcdHZhciB2ZXJiID0gdGhpcy5fd2ViUmVxdWVzdC5nZXRfaHR0cFZlcmIoKTtcclxuXHRcdHRoaXMuX3htbEh0dHBSZXF1ZXN0Lm9wZW4odmVyYiwgdGhpcy5fd2ViUmVxdWVzdC5nZXRSZXNvbHZlZFVybCgpLCB0cnVlXHJcbik7XHJcblx0XHR0aGlzLl94bWxIdHRwUmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKFwiWC1SZXF1ZXN0ZWQtV2l0aFwiLCBcIlhNTEh0dHBSZXF1ZXN0XCIpO1xyXG5cdFx0aWYgKGhlYWRlcnMpIHtcclxuXHRcdFx0Zm9yICh2YXIgaGVhZGVyIGluIGhlYWRlcnMpIHtcclxuXHRcdFx0XHR2YXIgdmFsID0gaGVhZGVyc1toZWFkZXJdO1xyXG5cdFx0XHRcdGlmICh0eXBlb2YodmFsKSAhPT0gXCJmdW5jdGlvblwiKVxyXG5cdFx0XHRcdFx0dGhpcy5feG1sSHR0cFJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcihoZWFkZXIsIHZhbCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRpZiAodmVyYi50b0xvd2VyQ2FzZSgpID09PSBcInBvc3RcIikge1xyXG5cdFx0XHRpZiAoKGhlYWRlcnMgPT09IG51bGwpIHx8ICFoZWFkZXJzWydDb250ZW50LVR5cGUnXSkge1xyXG5cdFx0XHRcdHRoaXMuX3htbEh0dHBSZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7IGNoYXJzZXQ9dXRmLTgnKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKCFib2R5KSB7XHJcblx0XHRcdFx0Ym9keSA9IFwiXCI7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHR2YXIgdGltZW91dCA9IHRoaXMuX3dlYlJlcXVlc3QuZ2V0X3RpbWVvdXQoKTtcclxuXHRcdGlmICh0aW1lb3V0ID4gMCkge1xyXG5cdFx0XHR0aGlzLl90aW1lciA9IHdpbmRvdy5zZXRUaW1lb3V0KEZ1bmN0aW9uLmNyZWF0ZURlbGVnYXRlKHRoaXMsIHRoaXMuX29uVGltZW91dCksIHRpbWVvdXQpO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5feG1sSHR0cFJlcXVlc3Quc2VuZChib2R5KTtcclxuXHRcdHRoaXMuX3N0YXJ0ZWQgPSB0cnVlO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRYTUxIdHRwRXhlY3V0b3IkZ2V0UmVzcG9uc2VIZWFkZXIoaGVhZGVyKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk5ldC5YTUxIdHRwRXhlY3V0b3IuZ2V0UmVzcG9uc2VIZWFkZXJcIiAvPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwiaGVhZGVyXCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0XHQvLy8gPHJldHVybnMgdHlwZT1cIlN0cmluZ1wiPjwvcmV0dXJucz5cclxuXHJcblx0XHRpZiAoIXRoaXMuX3Jlc3BvbnNlQXZhaWxhYmxlKSB7XHJcblx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuUmVzLmNhbm5vdENhbGxCZWZvcmVSZXNwb25zZSwgJ2dldFJlc3BvbnNlSGVhZGVyJykpO1xyXG5cdFx0fVxyXG5cdFx0aWYgKCF0aGlzLl94bWxIdHRwUmVxdWVzdCkge1xyXG5cdFx0XHR0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN0cmluZy5mb3JtYXQoU3lzLlJlcy5jYW5ub3RDYWxsT3V0c2lkZUhhbmRsZXIsICdnZXRSZXNwb25zZUhlYWRlcicpKTtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgcmVzdWx0O1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0cmVzdWx0ID0gdGhpcy5feG1sSHR0cFJlcXVlc3QuZ2V0UmVzcG9uc2VIZWFkZXIoaGVhZGVyKTtcclxuXHRcdH0gY2F0Y2ggKGUpIHtcclxuXHRcdH1cclxuXHRcdGlmICghcmVzdWx0KSByZXN1bHQgPSBcIlwiO1xyXG5cdFx0cmV0dXJuIHJlc3VsdDtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIFN5cyROZXQkWE1MSHR0cEV4ZWN1dG9yJGdldEFsbFJlc3BvbnNlSGVhZGVycygpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuTmV0LlhNTEh0dHBFeGVjdXRvci5nZXRBbGxSZXNwb25zZUhlYWRlcnNcIiAvPlxyXG5cdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJTdHJpbmdcIj48L3JldHVybnM+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdGlmICghdGhpcy5fcmVzcG9uc2VBdmFpbGFibGUpIHtcclxuXHRcdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTdHJpbmcuZm9ybWF0KFN5cy5SZXMuY2Fubm90Q2FsbEJlZm9yZVJlc3BvbnNlLCAnZ2V0QWxsUmVzcG9uc2VIZWFkZXJzJykpO1xyXG5cdFx0fVxyXG5cdFx0aWYgKCF0aGlzLl94bWxIdHRwUmVxdWVzdCkge1xyXG5cdFx0XHR0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN0cmluZy5mb3JtYXQoU3lzLlJlcy5jYW5ub3RDYWxsT3V0c2lkZUhhbmRsZXIsICdnZXRBbGxSZXNwb25zZUhlYWRlcnMnKSk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHRoaXMuX3htbEh0dHBSZXF1ZXN0LmdldEFsbFJlc3BvbnNlSGVhZGVycygpO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRYTUxIdHRwRXhlY3V0b3IkZ2V0X3Jlc3BvbnNlRGF0YSgpIHtcclxuXHRcdC8vLyA8dmFsdWUgdHlwZT1cIlN0cmluZ1wiIGxvY2lkPVwiUDpKI1N5cy5OZXQuWE1MSHR0cEV4ZWN1dG9yLnJlc3BvbnNlRGF0YVwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdGlmICghdGhpcy5fcmVzcG9uc2VBdmFpbGFibGUpIHtcclxuXHRcdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTdHJpbmcuZm9ybWF0KFN5cy5SZXMuY2Fubm90Q2FsbEJlZm9yZVJlc3BvbnNlLCAnZ2V0X3Jlc3BvbnNlRGF0YScpKTtcclxuXHRcdH1cclxuXHRcdGlmICghdGhpcy5feG1sSHR0cFJlcXVlc3QpIHtcclxuXHRcdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTdHJpbmcuZm9ybWF0KFN5cy5SZXMuY2Fubm90Q2FsbE91dHNpZGVIYW5kbGVyLCAnZ2V0X3Jlc3BvbnNlRGF0YScpKTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gdGhpcy5feG1sSHR0cFJlcXVlc3QucmVzcG9uc2VUZXh0O1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRYTUxIdHRwRXhlY3V0b3IkZ2V0X3N0YXR1c0NvZGUoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJOdW1iZXJcIiBsb2NpZD1cIlA6SiNTeXMuTmV0LlhNTEh0dHBFeGVjdXRvci5zdGF0dXNDb2RlXCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0aWYgKCF0aGlzLl9yZXNwb25zZUF2YWlsYWJsZSkge1xyXG5cdFx0XHR0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN0cmluZy5mb3JtYXQoU3lzLlJlcy5jYW5ub3RDYWxsQmVmb3JlUmVzcG9uc2UsICdnZXRfc3RhdHVzQ29kZScpKTtcclxuXHRcdH1cclxuXHRcdGlmICghdGhpcy5feG1sSHR0cFJlcXVlc3QpIHtcclxuXHRcdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTdHJpbmcuZm9ybWF0KFN5cy5SZXMuY2Fubm90Q2FsbE91dHNpZGVIYW5kbGVyLCAnZ2V0X3N0YXR1c0NvZGUnKSk7XHJcblx0XHR9XHJcblx0XHR2YXIgcmVzdWx0ID0gMDtcclxuXHRcdHRyeSB7XHJcblx0XHRcdHJlc3VsdCA9IHRoaXMuX3htbEh0dHBSZXF1ZXN0LnN0YXR1cztcclxuXHRcdH1cclxuXHRcdGNhdGNoKGV4KSB7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRYTUxIdHRwRXhlY3V0b3IkZ2V0X3N0YXR1c1RleHQoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJTdHJpbmdcIiBsb2NpZD1cIlA6SiNTeXMuTmV0LlhNTEh0dHBFeGVjdXRvci5zdGF0dXNUZXh0XCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0aWYgKCF0aGlzLl9yZXNwb25zZUF2YWlsYWJsZSkge1xyXG5cdFx0XHR0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN0cmluZy5mb3JtYXQoU3lzLlJlcy5jYW5ub3RDYWxsQmVmb3JlUmVzcG9uc2UsICdnZXRfc3RhdHVzVGV4dCcpKTtcclxuXHRcdH1cclxuXHRcdGlmICghdGhpcy5feG1sSHR0cFJlcXVlc3QpIHtcclxuXHRcdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTdHJpbmcuZm9ybWF0KFN5cy5SZXMuY2Fubm90Q2FsbE91dHNpZGVIYW5kbGVyLCAnZ2V0X3N0YXR1c1RleHQnKSk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHRoaXMuX3htbEh0dHBSZXF1ZXN0LnN0YXR1c1RleHQ7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFhNTEh0dHBFeGVjdXRvciRnZXRfeG1sKCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSBsb2NpZD1cIlA6SiNTeXMuTmV0LlhNTEh0dHBFeGVjdXRvci54bWxcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHRpZiAoIXRoaXMuX3Jlc3BvbnNlQXZhaWxhYmxlKSB7XHJcblx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuUmVzLmNhbm5vdENhbGxCZWZvcmVSZXNwb25zZSwgJ2dldF94bWwnKSk7XHJcblx0XHR9XHJcblx0XHRpZiAoIXRoaXMuX3htbEh0dHBSZXF1ZXN0KSB7XHJcblx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuUmVzLmNhbm5vdENhbGxPdXRzaWRlSGFuZGxlciwgJ2dldF94bWwnKSk7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIHhtbCA9IHRoaXMuX3htbEh0dHBSZXF1ZXN0LnJlc3BvbnNlWE1MO1xyXG5cdFx0aWYgKCF4bWwgfHwgIXhtbC5kb2N1bWVudEVsZW1lbnQpIHtcclxuXHJcblx0XHRcdHhtbCA9IFN5cy5OZXQuWE1MRE9NKHRoaXMuX3htbEh0dHBSZXF1ZXN0LnJlc3BvbnNlVGV4dCk7XHJcblxyXG5cdFx0XHRpZiAoIXhtbCB8fCAheG1sLmRvY3VtZW50RWxlbWVudClcclxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignTVNJRScpICE9PSAtMSkge1xyXG5cdFx0XHR4bWwuc2V0UHJvcGVydHkoJ1NlbGVjdGlvbkxhbmd1YWdlJywgJ1hQYXRoJyk7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHhtbC5kb2N1bWVudEVsZW1lbnQubmFtZXNwYWNlVVJJID09PSBcImh0dHA6Ly93d3cubW96aWxsYS5vcmcvbmV3bGF5b3V0L3htbC9wYXJzZXJlcnJvci54bWxcIiAmJlxyXG5cdFx0XHR4bWwuZG9jdW1lbnRFbGVtZW50LnRhZ05hbWUgPT09IFwicGFyc2VyZXJyb3JcIikge1xyXG5cdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdH1cclxuXHRcdGlmICh4bWwuZG9jdW1lbnRFbGVtZW50LmZpcnN0Q2hpbGQgJiYgeG1sLmRvY3VtZW50RWxlbWVudC5maXJzdENoaWxkLnRhZ05hbWUgPT09IFwicGFyc2VyZXJyb3JcIikge1xyXG5cdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdH1cclxuXHRcdHJldHVybiB4bWw7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFhNTEh0dHBFeGVjdXRvciRhYm9ydCgpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuTmV0LlhNTEh0dHBFeGVjdXRvci5hYm9ydFwiIC8+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdGlmICghdGhpcy5fc3RhcnRlZCkge1xyXG5cdFx0XHR0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN5cy5SZXMuY2Fubm90QWJvcnRCZWZvcmVTdGFydCk7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHRoaXMuX2Fib3J0ZWQgfHwgdGhpcy5fcmVzcG9uc2VBdmFpbGFibGUgfHwgdGhpcy5fdGltZWRPdXQpXHJcblx0XHRcdHJldHVybjtcclxuXHJcblx0XHR0aGlzLl9hYm9ydGVkID0gdHJ1ZTtcclxuXHJcblx0XHR0aGlzLl9jbGVhclRpbWVyKCk7XHJcblxyXG5cdFx0aWYgKHRoaXMuX3htbEh0dHBSZXF1ZXN0ICYmICF0aGlzLl9yZXNwb25zZUF2YWlsYWJsZSkge1xyXG5cclxuXHRcdFx0dGhpcy5feG1sSHR0cFJlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gRnVuY3Rpb24uZW1wdHlNZXRob2Q7XHJcblx0XHRcdHRoaXMuX3htbEh0dHBSZXF1ZXN0LmFib3J0KCk7XHJcblx0XHRcdHRoaXMuX3htbEh0dHBSZXF1ZXN0ID0gbnVsbDtcclxuXHJcblx0XHRcdHRoaXMuX3dlYlJlcXVlc3QuY29tcGxldGVkKFN5cy5FdmVudEFyZ3MuRW1wdHkpO1xyXG5cdFx0fVxyXG5cdH1cclxuU3lzLk5ldC5YTUxIdHRwRXhlY3V0b3IucHJvdG90eXBlID0ge1xyXG5cdGdldF90aW1lZE91dDogU3lzJE5ldCRYTUxIdHRwRXhlY3V0b3IkZ2V0X3RpbWVkT3V0LFxyXG5cdGdldF9zdGFydGVkOiBTeXMkTmV0JFhNTEh0dHBFeGVjdXRvciRnZXRfc3RhcnRlZCxcclxuXHRnZXRfcmVzcG9uc2VBdmFpbGFibGU6IFN5cyROZXQkWE1MSHR0cEV4ZWN1dG9yJGdldF9yZXNwb25zZUF2YWlsYWJsZSxcclxuXHRnZXRfYWJvcnRlZDogU3lzJE5ldCRYTUxIdHRwRXhlY3V0b3IkZ2V0X2Fib3J0ZWQsXHJcblx0ZXhlY3V0ZVJlcXVlc3Q6IFN5cyROZXQkWE1MSHR0cEV4ZWN1dG9yJGV4ZWN1dGVSZXF1ZXN0LFxyXG5cdGdldFJlc3BvbnNlSGVhZGVyOiBTeXMkTmV0JFhNTEh0dHBFeGVjdXRvciRnZXRSZXNwb25zZUhlYWRlcixcclxuXHRnZXRBbGxSZXNwb25zZUhlYWRlcnM6IFN5cyROZXQkWE1MSHR0cEV4ZWN1dG9yJGdldEFsbFJlc3BvbnNlSGVhZGVycyxcclxuXHRnZXRfcmVzcG9uc2VEYXRhOiBTeXMkTmV0JFhNTEh0dHBFeGVjdXRvciRnZXRfcmVzcG9uc2VEYXRhLFxyXG5cdGdldF9zdGF0dXNDb2RlOiBTeXMkTmV0JFhNTEh0dHBFeGVjdXRvciRnZXRfc3RhdHVzQ29kZSxcclxuXHRnZXRfc3RhdHVzVGV4dDogU3lzJE5ldCRYTUxIdHRwRXhlY3V0b3IkZ2V0X3N0YXR1c1RleHQsXHJcblx0Z2V0X3htbDogU3lzJE5ldCRYTUxIdHRwRXhlY3V0b3IkZ2V0X3htbCxcclxuXHRhYm9ydDogU3lzJE5ldCRYTUxIdHRwRXhlY3V0b3IkYWJvcnRcclxufVxyXG5TeXMuTmV0LlhNTEh0dHBFeGVjdXRvci5yZWdpc3RlckNsYXNzKCdTeXMuTmV0LlhNTEh0dHBFeGVjdXRvcicsIFN5cy5OZXQuV2ViUmVxdWVzdEV4ZWN1dG9yKTtcclxuU3lzLk5ldC5fV2ViUmVxdWVzdE1hbmFnZXIgPSBmdW5jdGlvbiBTeXMkTmV0JF9XZWJSZXF1ZXN0TWFuYWdlcigpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJQOkojU3lzLk5ldC5XZWJSZXF1ZXN0TWFuYWdlci4jY3RvclwiIC8+XHJcblx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0dGhpcy5fZGVmYXVsdFRpbWVvdXQgPSAwO1xyXG5cdHRoaXMuX2RlZmF1bHRFeGVjdXRvclR5cGUgPSBcIlN5cy5OZXQuWE1MSHR0cEV4ZWN1dG9yXCI7XHJcbn1cclxuXHJcblxyXG5cdGZ1bmN0aW9uIFN5cyROZXQkX1dlYlJlcXVlc3RNYW5hZ2VyJGFkZF9pbnZva2luZ1JlcXVlc3QoaGFuZGxlcikge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiRTpKI1N5cy5OZXQuV2ViUmVxdWVzdE1hbmFnZXIuaW52b2tpbmdSZXF1ZXN0XCIgLz5cclxuXHJcblx0XHRTeXMuT2JzZXJ2ZXIuYWRkRXZlbnRIYW5kbGVyKHRoaXMsIFwiaW52b2tpbmdSZXF1ZXN0XCIsIGhhbmRsZXIpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkTmV0JF9XZWJSZXF1ZXN0TWFuYWdlciRyZW1vdmVfaW52b2tpbmdSZXF1ZXN0KGhhbmRsZXIpIHtcclxuXHJcblx0XHRTeXMuT2JzZXJ2ZXIucmVtb3ZlRXZlbnRIYW5kbGVyKHRoaXMsIFwiaW52b2tpbmdSZXF1ZXN0XCIsIGhhbmRsZXIpO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRfV2ViUmVxdWVzdE1hbmFnZXIkYWRkX2NvbXBsZXRlZFJlcXVlc3QoaGFuZGxlcikge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiRTpKI1N5cy5OZXQuV2ViUmVxdWVzdE1hbmFnZXIuY29tcGxldGVkUmVxdWVzdFwiIC8+XHJcblxyXG5cdFx0U3lzLk9ic2VydmVyLmFkZEV2ZW50SGFuZGxlcih0aGlzLCBcImNvbXBsZXRlZFJlcXVlc3RcIiwgaGFuZGxlcik7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyROZXQkX1dlYlJlcXVlc3RNYW5hZ2VyJHJlbW92ZV9jb21wbGV0ZWRSZXF1ZXN0KGhhbmRsZXIpIHtcclxuXHJcblx0XHRTeXMuT2JzZXJ2ZXIucmVtb3ZlRXZlbnRIYW5kbGVyKHRoaXMsIFwiY29tcGxldGVkUmVxdWVzdFwiLCBoYW5kbGVyKTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRfV2ViUmVxdWVzdE1hbmFnZXIkZ2V0X2RlZmF1bHRUaW1lb3V0KCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiTnVtYmVyXCIgbG9jaWQ9XCJQOkojU3lzLk5ldC5XZWJSZXF1ZXN0TWFuYWdlci5kZWZhdWx0VGltZW91dFwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiB0aGlzLl9kZWZhdWx0VGltZW91dDtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRfV2ViUmVxdWVzdE1hbmFnZXIkc2V0X2RlZmF1bHRUaW1lb3V0KHZhbHVlKSB7XHJcblxyXG5cdFx0aWYgKHZhbHVlIDwgMCkge1xyXG5cdFx0XHR0aHJvdyBFcnJvci5hcmd1bWVudE91dE9mUmFuZ2UoXCJ2YWx1ZVwiLCB2YWx1ZSwgU3lzLlJlcy5pbnZhbGlkVGltZW91dCk7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5fZGVmYXVsdFRpbWVvdXQgPSB2YWx1ZTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIFN5cyROZXQkX1dlYlJlcXVlc3RNYW5hZ2VyJGdldF9kZWZhdWx0RXhlY3V0b3JUeXBlKCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiU3RyaW5nXCIgbG9jaWQ9XCJQOkojU3lzLk5ldC5XZWJSZXF1ZXN0TWFuYWdlci5kZWZhdWx0RXhlY3V0b3JUeXBlXCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0cmV0dXJuIHRoaXMuX2RlZmF1bHRFeGVjdXRvclR5cGU7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyROZXQkX1dlYlJlcXVlc3RNYW5hZ2VyJHNldF9kZWZhdWx0RXhlY3V0b3JUeXBlKHZhbHVlKSB7XHJcblxyXG5cdFx0dGhpcy5fZGVmYXVsdEV4ZWN1dG9yVHlwZSA9IHZhbHVlO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRfV2ViUmVxdWVzdE1hbmFnZXIkZXhlY3V0ZVJlcXVlc3Qod2ViUmVxdWVzdCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5OZXQuV2ViUmVxdWVzdE1hbmFnZXIuZXhlY3V0ZVJlcXVlc3RcIiAvPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwid2ViUmVxdWVzdFwiIHR5cGU9XCJTeXMuTmV0LldlYlJlcXVlc3RcIj48L3BhcmFtPlxyXG5cclxuXHRcdHZhciBleGVjdXRvciA9IHdlYlJlcXVlc3QuZ2V0X2V4ZWN1dG9yKCk7XHJcblx0XHRpZiAoIWV4ZWN1dG9yKSB7XHJcblxyXG5cdFx0XHR2YXIgZXIsIGZhaWxlZCA9IGZhbHNlO1xyXG5cdFx0XHR0cnkge1xyXG5cdFx0XHRcdHZhciBleGVjdXRvclR5cGUgPSB3aW5kb3cuZXZhbCh0aGlzLl9kZWZhdWx0RXhlY3V0b3JUeXBlKTtcclxuXHRcdFx0XHRleGVjdXRvciA9IG5ldyBleGVjdXRvclR5cGUoKTtcclxuXHRcdFx0fSBjYXRjaCAoZXIpIHtcclxuXHRcdFx0XHRmYWlsZWQgPSB0cnVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoZmFpbGVkICB8fCAhU3lzLk5ldC5XZWJSZXF1ZXN0RXhlY3V0b3IuaXNJbnN0YW5jZU9mVHlwZShleGVjdXRvcikgfHwgIWV4ZWN1dG9yKSB7XHJcblx0XHRcdFx0dGhyb3cgRXJyb3IuYXJndW1lbnQoXCJkZWZhdWx0RXhlY3V0b3JUeXBlXCIsIFN0cmluZy5mb3JtYXQoU3lzLlJlcy5pbnZhbGlkRXhlY3V0b3JUeXBlLCB0aGlzLl9kZWZhdWx0RXhlY3V0b3JUeXBlKSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHdlYlJlcXVlc3Quc2V0X2V4ZWN1dG9yKGV4ZWN1dG9yKTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoZXhlY3V0b3IuZ2V0X2Fib3J0ZWQoKSkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIGV2QXJncyA9IG5ldyBTeXMuTmV0Lk5ldHdvcmtSZXF1ZXN0RXZlbnRBcmdzKHdlYlJlcXVlc3QpO1xyXG5cdFx0U3lzLk9ic2VydmVyLnJhaXNlRXZlbnQodGhpcywgXCJpbnZva2luZ1JlcXVlc3RcIiwgZXZBcmdzKTtcclxuXHRcdGlmICghZXZBcmdzLmdldF9jYW5jZWwoKSkge1xyXG5cdFx0XHRleGVjdXRvci5leGVjdXRlUmVxdWVzdCgpO1xyXG5cdFx0fVxyXG5cdH1cclxuU3lzLk5ldC5fV2ViUmVxdWVzdE1hbmFnZXIucHJvdG90eXBlID0ge1xyXG5cdGFkZF9pbnZva2luZ1JlcXVlc3Q6IFN5cyROZXQkX1dlYlJlcXVlc3RNYW5hZ2VyJGFkZF9pbnZva2luZ1JlcXVlc3QsXHJcblx0cmVtb3ZlX2ludm9raW5nUmVxdWVzdDogU3lzJE5ldCRfV2ViUmVxdWVzdE1hbmFnZXIkcmVtb3ZlX2ludm9raW5nUmVxdWVzdCxcclxuXHRhZGRfY29tcGxldGVkUmVxdWVzdDogU3lzJE5ldCRfV2ViUmVxdWVzdE1hbmFnZXIkYWRkX2NvbXBsZXRlZFJlcXVlc3QsXHJcblx0cmVtb3ZlX2NvbXBsZXRlZFJlcXVlc3Q6IFN5cyROZXQkX1dlYlJlcXVlc3RNYW5hZ2VyJHJlbW92ZV9jb21wbGV0ZWRSZXF1ZXN0LFxyXG5cdGdldF9kZWZhdWx0VGltZW91dDogU3lzJE5ldCRfV2ViUmVxdWVzdE1hbmFnZXIkZ2V0X2RlZmF1bHRUaW1lb3V0LFxyXG5cdHNldF9kZWZhdWx0VGltZW91dDogU3lzJE5ldCRfV2ViUmVxdWVzdE1hbmFnZXIkc2V0X2RlZmF1bHRUaW1lb3V0LFxyXG5cdGdldF9kZWZhdWx0RXhlY3V0b3JUeXBlOiBTeXMkTmV0JF9XZWJSZXF1ZXN0TWFuYWdlciRnZXRfZGVmYXVsdEV4ZWN1dG9yVHlwZSxcclxuXHRzZXRfZGVmYXVsdEV4ZWN1dG9yVHlwZTogU3lzJE5ldCRfV2ViUmVxdWVzdE1hbmFnZXIkc2V0X2RlZmF1bHRFeGVjdXRvclR5cGUsXHJcblx0ZXhlY3V0ZVJlcXVlc3Q6IFN5cyROZXQkX1dlYlJlcXVlc3RNYW5hZ2VyJGV4ZWN1dGVSZXF1ZXN0XHJcbn1cclxuXHJcblN5cy5OZXQuX1dlYlJlcXVlc3RNYW5hZ2VyLnJlZ2lzdGVyQ2xhc3MoJ1N5cy5OZXQuX1dlYlJlcXVlc3RNYW5hZ2VyJyk7XHJcblxyXG5cclxuU3lzLk5ldC5XZWJSZXF1ZXN0TWFuYWdlciA9IG5ldyBTeXMuTmV0Ll9XZWJSZXF1ZXN0TWFuYWdlcigpO1xyXG5TeXMuTmV0Lk5ldHdvcmtSZXF1ZXN0RXZlbnRBcmdzID0gZnVuY3Rpb24gU3lzJE5ldCROZXR3b3JrUmVxdWVzdEV2ZW50QXJncyh3ZWJSZXF1ZXN0KSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5OZXQuTmV0d29ya1JlcXVlc3RFdmVudEFyZ3MuI2N0b3JcIiAvPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cIndlYlJlcXVlc3RcIiB0eXBlPVwiU3lzLk5ldC5XZWJSZXF1ZXN0XCI+PC9wYXJhbT5cclxuXHJcblx0U3lzLk5ldC5OZXR3b3JrUmVxdWVzdEV2ZW50QXJncy5pbml0aWFsaXplQmFzZSh0aGlzKTtcclxuXHR0aGlzLl93ZWJSZXF1ZXN0ID0gd2ViUmVxdWVzdDtcclxufVxyXG5cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCROZXR3b3JrUmVxdWVzdEV2ZW50QXJncyRnZXRfd2ViUmVxdWVzdCgpIHtcclxuXHRcdC8vLyA8dmFsdWUgdHlwZT1cIlN5cy5OZXQuV2ViUmVxdWVzdFwiIGxvY2lkPVwiUDpKI1N5cy5OZXQuTmV0d29ya1JlcXVlc3RFdmVudEFyZ3Mud2ViUmVxdWVzdFwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiB0aGlzLl93ZWJSZXF1ZXN0O1xyXG5cdH1cclxuU3lzLk5ldC5OZXR3b3JrUmVxdWVzdEV2ZW50QXJncy5wcm90b3R5cGUgPSB7XHJcblx0Z2V0X3dlYlJlcXVlc3Q6IFN5cyROZXQkTmV0d29ya1JlcXVlc3RFdmVudEFyZ3MkZ2V0X3dlYlJlcXVlc3RcclxufVxyXG5cclxuU3lzLk5ldC5OZXR3b3JrUmVxdWVzdEV2ZW50QXJncy5yZWdpc3RlckNsYXNzKCdTeXMuTmV0Lk5ldHdvcmtSZXF1ZXN0RXZlbnRBcmdzJywgU3lzLkNhbmNlbEV2ZW50QXJncyk7XHJcblN5cy5OZXQuV2ViUmVxdWVzdCA9IGZ1bmN0aW9uIFN5cyROZXQkV2ViUmVxdWVzdCgpIHtcclxuXHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk5ldC5XZWJSZXF1ZXN0LiNjdG9yXCIgLz5cclxuXHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHR0aGlzLl91cmwgPSBcIlwiO1xyXG5cdHRoaXMuX2hlYWRlcnMgPSB7IH07XHJcblx0dGhpcy5fYm9keSA9IG51bGw7XHJcblx0dGhpcy5fdXNlckNvbnRleHQgPSBudWxsO1xyXG5cdHRoaXMuX2h0dHBWZXJiID0gbnVsbDtcclxuXHR0aGlzLl9leGVjdXRvciA9IG51bGw7XHJcblx0dGhpcy5faW52b2tlQ2FsbGVkID0gZmFsc2U7XHJcblx0dGhpcy5fdGltZW91dCA9IDA7XHJcbn1cclxuXHJcblxyXG5cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlJlcXVlc3QkYWRkX2NvbXBsZXRlZChoYW5kbGVyKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiRTpKI1N5cy5OZXQuV2ViUmVxdWVzdC5jb21wbGV0ZWRcIiAvPlxyXG5cclxuXHRcdFN5cy5PYnNlcnZlci5hZGRFdmVudEhhbmRsZXIodGhpcywgXCJjb21wbGV0ZWRcIiwgaGFuZGxlcik7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyROZXQkV2ViUmVxdWVzdCRyZW1vdmVfY29tcGxldGVkKGhhbmRsZXIpIHtcclxuXHJcblx0XHRTeXMuT2JzZXJ2ZXIucmVtb3ZlRXZlbnRIYW5kbGVyKHRoaXMsIFwiY29tcGxldGVkXCIsIGhhbmRsZXIpO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJSZXF1ZXN0JGNvbXBsZXRlZChldmVudEFyZ3MpIHtcclxuXHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuTmV0LldlYlJlcXVlc3QuY29tcGxldGVkXCIgLz5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cImV2ZW50QXJnc1wiIHR5cGU9XCJTeXMuRXZlbnRBcmdzXCI+PC9wYXJhbT5cclxuXHJcblx0XHRmdW5jdGlvbiByYWlzZShzb3VyY2UsIHNlbmRlciwgZXZlbnROYW1lKSB7XHJcblx0XHRcdHZhciBoYW5kbGVyID0gU3lzLk9ic2VydmVyLl9nZXRDb250ZXh0KHNvdXJjZSwgdHJ1ZSkuZXZlbnRzLmdldEhhbmRsZXIoZXZlbnROYW1lKTtcclxuXHRcdFx0aWYgKGhhbmRsZXIpIHtcclxuXHRcdFx0XHRoYW5kbGVyKHNlbmRlciwgZXZlbnRBcmdzKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmFpc2UoU3lzLk5ldC5XZWJSZXF1ZXN0TWFuYWdlciwgdGhpcy5fZXhlY3V0b3IsIFwiY29tcGxldGVkUmVxdWVzdFwiKTtcclxuXHRcdHJhaXNlKHRoaXMsIHRoaXMuX2V4ZWN1dG9yLCBcImNvbXBsZXRlZFwiKTtcclxuXHRcdFN5cy5PYnNlcnZlci5jbGVhckV2ZW50SGFuZGxlcnModGhpcywgXCJjb21wbGV0ZWRcIik7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlJlcXVlc3QkZ2V0X3VybCgpIHtcclxuXHRcdC8vLyA8dmFsdWUgdHlwZT1cIlN0cmluZ1wiIGxvY2lkPVwiUDpKI1N5cy5OZXQuV2ViUmVxdWVzdC51cmxcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHRyZXR1cm4gdGhpcy5fdXJsO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlJlcXVlc3Qkc2V0X3VybCh2YWx1ZSkge1xyXG5cclxuXHRcdHRoaXMuX3VybCA9IHZhbHVlO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJSZXF1ZXN0JGdldF9oZWFkZXJzKCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSBsb2NpZD1cIlA6SiNTeXMuTmV0LldlYlJlcXVlc3QuaGVhZGVyc1wiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiB0aGlzLl9oZWFkZXJzO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJSZXF1ZXN0JGdldF9odHRwVmVyYigpIHtcclxuXHRcdC8vLyA8dmFsdWUgdHlwZT1cIlN0cmluZ1wiIGxvY2lkPVwiUDpKI1N5cy5OZXQuV2ViUmVxdWVzdC5odHRwVmVyYlwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdGlmICh0aGlzLl9odHRwVmVyYiA9PT0gbnVsbCkge1xyXG5cdFx0XHRpZiAodGhpcy5fYm9keSA9PT0gbnVsbCkge1xyXG5cdFx0XHRcdHJldHVybiBcIkdFVFwiO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiBcIlBPU1RcIjtcclxuXHRcdH1cclxuXHRcdHJldHVybiB0aGlzLl9odHRwVmVyYjtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJSZXF1ZXN0JHNldF9odHRwVmVyYih2YWx1ZSkge1xyXG5cclxuXHRcdGlmICh2YWx1ZS5sZW5ndGggPT09IDApIHtcclxuXHRcdFx0dGhyb3cgRXJyb3IuYXJndW1lbnQoJ3ZhbHVlJywgU3lzLlJlcy5pbnZhbGlkSHR0cFZlcmIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuX2h0dHBWZXJiID0gdmFsdWU7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlJlcXVlc3QkZ2V0X2JvZHkoKSB7XHJcblx0XHQvLy8gPHZhbHVlIG1heUJlTnVsbD1cInRydWVcIiBsb2NpZD1cIlA6SiNTeXMuTmV0LldlYlJlcXVlc3QuYm9keVwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiB0aGlzLl9ib2R5O1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlJlcXVlc3Qkc2V0X2JvZHkodmFsdWUpIHtcclxuXHJcblx0XHR0aGlzLl9ib2R5ID0gdmFsdWU7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlJlcXVlc3QkZ2V0X3VzZXJDb250ZXh0KCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSBtYXlCZU51bGw9XCJ0cnVlXCIgbG9jaWQ9XCJQOkojU3lzLk5ldC5XZWJSZXF1ZXN0LnVzZXJDb250ZXh0XCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0cmV0dXJuIHRoaXMuX3VzZXJDb250ZXh0O1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlJlcXVlc3Qkc2V0X3VzZXJDb250ZXh0KHZhbHVlKSB7XHJcblxyXG5cdFx0dGhpcy5fdXNlckNvbnRleHQgPSB2YWx1ZTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIFN5cyROZXQkV2ViUmVxdWVzdCRnZXRfZXhlY3V0b3IoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJTeXMuTmV0LldlYlJlcXVlc3RFeGVjdXRvclwiIGxvY2lkPVwiUDpKI1N5cy5OZXQuV2ViUmVxdWVzdC5leGVjdXRvclwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiB0aGlzLl9leGVjdXRvcjtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJSZXF1ZXN0JHNldF9leGVjdXRvcih2YWx1ZSkge1xyXG5cclxuXHRcdGlmICh0aGlzLl9leGVjdXRvciAhPT0gbnVsbCAmJiB0aGlzLl9leGVjdXRvci5nZXRfc3RhcnRlZCgpKSB7XHJcblx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3lzLlJlcy5zZXRFeGVjdXRvckFmdGVyQWN0aXZlKTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLl9leGVjdXRvciA9IHZhbHVlO1xyXG5cdFx0dGhpcy5fZXhlY3V0b3IuX3NldF93ZWJSZXF1ZXN0KHRoaXMpO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJSZXF1ZXN0JGdldF90aW1lb3V0KCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiTnVtYmVyXCIgbG9jaWQ9XCJQOkojU3lzLk5ldC5XZWJSZXF1ZXN0LnRpbWVvdXRcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHRpZiAodGhpcy5fdGltZW91dCA9PT0gMCkge1xyXG5cdFx0XHRyZXR1cm4gU3lzLk5ldC5XZWJSZXF1ZXN0TWFuYWdlci5nZXRfZGVmYXVsdFRpbWVvdXQoKTtcclxuXHRcdH1cclxuXHRcdHJldHVybiB0aGlzLl90aW1lb3V0O1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlJlcXVlc3Qkc2V0X3RpbWVvdXQodmFsdWUpIHtcclxuXHJcblx0XHRpZiAodmFsdWUgPCAwKSB7XHJcblx0XHRcdHRocm93IEVycm9yLmFyZ3VtZW50T3V0T2ZSYW5nZShcInZhbHVlXCIsIHZhbHVlLCBTeXMuUmVzLmludmFsaWRUaW1lb3V0KTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLl90aW1lb3V0ID0gdmFsdWU7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlJlcXVlc3QkZ2V0UmVzb2x2ZWRVcmwoKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojcmFpc2VcIiAvPlxyXG5cdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJTdHJpbmdcIj48L3JldHVybnM+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiBTeXMuTmV0LldlYlJlcXVlc3QuX3Jlc29sdmVVcmwodGhpcy5fdXJsKTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIFN5cyROZXQkV2ViUmVxdWVzdCRpbnZva2UoKSB7XHJcblx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojcmFpc2VcIiAvPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHRpZiAodGhpcy5faW52b2tlQ2FsbGVkKSB7XHJcblx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3lzLlJlcy5pbnZva2VDYWxsZWRUd2ljZSk7XHJcblx0XHR9XHJcblxyXG5cdFx0U3lzLk5ldC5XZWJSZXF1ZXN0TWFuYWdlci5leGVjdXRlUmVxdWVzdCh0aGlzKTtcclxuXHRcdHRoaXMuX2ludm9rZUNhbGxlZCA9IHRydWU7XHJcblx0fVxyXG5TeXMuTmV0LldlYlJlcXVlc3QucHJvdG90eXBlID0ge1xyXG5cdGFkZF9jb21wbGV0ZWQ6IFN5cyROZXQkV2ViUmVxdWVzdCRhZGRfY29tcGxldGVkLFxyXG5cdHJlbW92ZV9jb21wbGV0ZWQ6IFN5cyROZXQkV2ViUmVxdWVzdCRyZW1vdmVfY29tcGxldGVkLFxyXG5cdGNvbXBsZXRlZDogU3lzJE5ldCRXZWJSZXF1ZXN0JGNvbXBsZXRlZCxcclxuXHRnZXRfdXJsOiBTeXMkTmV0JFdlYlJlcXVlc3QkZ2V0X3VybCxcclxuXHRzZXRfdXJsOiBTeXMkTmV0JFdlYlJlcXVlc3Qkc2V0X3VybCxcclxuXHRnZXRfaGVhZGVyczogU3lzJE5ldCRXZWJSZXF1ZXN0JGdldF9oZWFkZXJzLFxyXG5cdGdldF9odHRwVmVyYjogU3lzJE5ldCRXZWJSZXF1ZXN0JGdldF9odHRwVmVyYixcclxuXHRzZXRfaHR0cFZlcmI6IFN5cyROZXQkV2ViUmVxdWVzdCRzZXRfaHR0cFZlcmIsXHJcblx0Z2V0X2JvZHk6IFN5cyROZXQkV2ViUmVxdWVzdCRnZXRfYm9keSxcclxuXHRzZXRfYm9keTogU3lzJE5ldCRXZWJSZXF1ZXN0JHNldF9ib2R5LFxyXG5cdGdldF91c2VyQ29udGV4dDogU3lzJE5ldCRXZWJSZXF1ZXN0JGdldF91c2VyQ29udGV4dCxcclxuXHRzZXRfdXNlckNvbnRleHQ6IFN5cyROZXQkV2ViUmVxdWVzdCRzZXRfdXNlckNvbnRleHQsXHJcblx0Z2V0X2V4ZWN1dG9yOiBTeXMkTmV0JFdlYlJlcXVlc3QkZ2V0X2V4ZWN1dG9yLFxyXG5cdHNldF9leGVjdXRvcjogU3lzJE5ldCRXZWJSZXF1ZXN0JHNldF9leGVjdXRvcixcclxuXHRnZXRfdGltZW91dDogU3lzJE5ldCRXZWJSZXF1ZXN0JGdldF90aW1lb3V0LFxyXG5cdHNldF90aW1lb3V0OiBTeXMkTmV0JFdlYlJlcXVlc3Qkc2V0X3RpbWVvdXQsXHJcblx0Z2V0UmVzb2x2ZWRVcmw6IFN5cyROZXQkV2ViUmVxdWVzdCRnZXRSZXNvbHZlZFVybCxcclxuXHRpbnZva2U6IFN5cyROZXQkV2ViUmVxdWVzdCRpbnZva2VcclxufVxyXG5cclxuXHJcblN5cy5OZXQuV2ViUmVxdWVzdC5fcmVzb2x2ZVVybCA9IGZ1bmN0aW9uIFN5cyROZXQkV2ViUmVxdWVzdCRfcmVzb2x2ZVVybCh1cmwsIGJhc2VVcmwpIHtcclxuXHRpZiAodXJsICYmIHVybC5pbmRleE9mKCc6Ly8nKSAhPT0gLTEpIHtcclxuXHRcdHJldHVybiB1cmw7XHJcblx0fVxyXG5cclxuXHRpZiAoIWJhc2VVcmwgfHwgYmFzZVVybC5sZW5ndGggPT09IDApIHtcclxuXHRcdHZhciBiYXNlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdiYXNlJylbMF07XHJcblx0XHRpZiAoYmFzZUVsZW1lbnQgJiYgYmFzZUVsZW1lbnQuaHJlZiAmJiBiYXNlRWxlbWVudC5ocmVmLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0YmFzZVVybCA9IGJhc2VFbGVtZW50LmhyZWY7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0YmFzZVVybCA9IGRvY3VtZW50LlVSTDtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHZhciBxc1N0YXJ0ID0gYmFzZVVybC5pbmRleE9mKCc/Jyk7XHJcblx0aWYgKHFzU3RhcnQgIT09IC0xKSB7XHJcblx0XHRiYXNlVXJsID0gYmFzZVVybC5zdWJzdHIoMCwgcXNTdGFydCk7XHJcblx0fVxyXG5cdHFzU3RhcnQgPSBiYXNlVXJsLmluZGV4T2YoJyMnKTtcclxuXHRpZiAocXNTdGFydCAhPT0gLTEpIHtcclxuXHRcdGJhc2VVcmwgPSBiYXNlVXJsLnN1YnN0cigwLCBxc1N0YXJ0KTtcclxuXHR9XHJcblx0YmFzZVVybCA9IGJhc2VVcmwuc3Vic3RyKDAsIGJhc2VVcmwubGFzdEluZGV4T2YoJy8nKSArIDEpO1xyXG5cclxuXHRpZiAoIXVybCB8fCB1cmwubGVuZ3RoID09PSAwKSB7XHJcblx0XHRyZXR1cm4gYmFzZVVybDtcclxuXHR9XHJcblxyXG5cdGlmICh1cmwuY2hhckF0KDApID09PSAnLycpIHtcclxuXHRcdHZhciBzbGFzaHNsYXNoID0gYmFzZVVybC5pbmRleE9mKCc6Ly8nKTtcclxuXHRcdGlmIChzbGFzaHNsYXNoID09PSAtMSkge1xyXG5cdFx0XHR0aHJvdyBFcnJvci5hcmd1bWVudChcImJhc2VVcmxcIiwgU3lzLlJlcy5iYWRCYXNlVXJsMSk7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIG5leHRTbGFzaCA9IGJhc2VVcmwuaW5kZXhPZignLycsIHNsYXNoc2xhc2ggKyAzKTtcclxuXHRcdGlmIChuZXh0U2xhc2ggPT09IC0xKSB7XHJcblx0XHRcdHRocm93IEVycm9yLmFyZ3VtZW50KFwiYmFzZVVybFwiLCBTeXMuUmVzLmJhZEJhc2VVcmwyKTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gYmFzZVVybC5zdWJzdHIoMCwgbmV4dFNsYXNoKSArIHVybDtcclxuXHR9XHJcblx0ZWxzZSB7XHJcblx0XHR2YXIgbGFzdFNsYXNoID0gYmFzZVVybC5sYXN0SW5kZXhPZignLycpO1xyXG5cdFx0aWYgKGxhc3RTbGFzaCA9PT0gLTEpIHtcclxuXHRcdFx0dGhyb3cgRXJyb3IuYXJndW1lbnQoXCJiYXNlVXJsXCIsIFN5cy5SZXMuYmFkQmFzZVVybDMpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBiYXNlVXJsLnN1YnN0cigwLCBsYXN0U2xhc2grMSkgKyB1cmw7XHJcblx0fVxyXG59XHJcblxyXG5TeXMuTmV0LldlYlJlcXVlc3QuX2NyZWF0ZVF1ZXJ5U3RyaW5nID0gZnVuY3Rpb24gU3lzJE5ldCRXZWJSZXF1ZXN0JF9jcmVhdGVRdWVyeVN0cmluZyhxdWVyeVN0cmluZywgZW5jb2RlTWV0aG9kLCBhZGRQYXJhbXMpIHtcclxuXHRlbmNvZGVNZXRob2QgPSBlbmNvZGVNZXRob2QgfHwgZW5jb2RlVVJJQ29tcG9uZW50O1xyXG5cdHZhciBpID0gMCwgb2JqLCB2YWwsIGFyZywgc2IgPSBuZXcgU3lzLlN0cmluZ0J1aWxkZXIoKTtcclxuXHRpZiAocXVlcnlTdHJpbmcpIHtcclxuXHRcdGZvciAoYXJnIGluIHF1ZXJ5U3RyaW5nKSB7XHJcblx0XHRcdG9iaiA9IHF1ZXJ5U3RyaW5nW2FyZ107XHJcblx0XHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gXCJmdW5jdGlvblwiKSBjb250aW51ZTtcclxuXHRcdFx0dmFsID0gU3lzLlNlcmlhbGl6YXRpb24uSmF2YVNjcmlwdFNlcmlhbGl6ZXIuc2VyaWFsaXplKG9iaik7XHJcblx0XHRcdGlmIChpKyspIHtcclxuXHRcdFx0XHRzYi5hcHBlbmQoJyYnKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRzYi5hcHBlbmQoYXJnKTtcclxuXHRcdFx0c2IuYXBwZW5kKCc9Jyk7XHJcblx0XHRcdHNiLmFwcGVuZChlbmNvZGVNZXRob2QodmFsKSk7XHJcblx0XHR9XHJcblx0fVxyXG5cdGlmIChhZGRQYXJhbXMpIHtcclxuXHRcdGlmIChpKSB7XHJcblx0XHRcdHNiLmFwcGVuZCgnJicpO1xyXG5cdFx0fVxyXG5cdFx0c2IuYXBwZW5kKGFkZFBhcmFtcyk7XHJcblx0fVxyXG5cdHJldHVybiBzYi50b1N0cmluZygpO1xyXG59XHJcblxyXG5TeXMuTmV0LldlYlJlcXVlc3QuX2NyZWF0ZVVybCA9IGZ1bmN0aW9uIFN5cyROZXQkV2ViUmVxdWVzdCRfY3JlYXRlVXJsKHVybCwgcXVlcnlTdHJpbmcsIGFkZFBhcmFtcykge1xyXG5cdGlmICghcXVlcnlTdHJpbmcgJiYgIWFkZFBhcmFtcykge1xyXG5cdFx0cmV0dXJuIHVybDtcclxuXHR9XHJcblx0dmFyIHFzID0gU3lzLk5ldC5XZWJSZXF1ZXN0Ll9jcmVhdGVRdWVyeVN0cmluZyhxdWVyeVN0cmluZywgbnVsbCwgYWRkUGFyYW1zKTtcclxuXHRyZXR1cm4gcXMubGVuZ3RoXHJcblx0XHQ/IHVybCArICgodXJsICYmIHVybC5pbmRleE9mKCc/JykgPj0gMCkgPyBcIiZcIiA6IFwiP1wiKSArIHFzXHJcblx0XHQ6IHVybDtcclxufVxyXG5cclxuU3lzLk5ldC5XZWJSZXF1ZXN0LnJlZ2lzdGVyQ2xhc3MoJ1N5cy5OZXQuV2ViUmVxdWVzdCcpO1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5UeXBlLnJlZ2lzdGVyTmFtZXNwYWNlKCdTeXMuTmV0Jyk7XHJcblxyXG5TeXMuTmV0LldlYlNlcnZpY2VQcm94eSA9IGZ1bmN0aW9uIFN5cyROZXQkV2ViU2VydmljZVByb3h5KCkge1xyXG59XHJcblxyXG5cdGZ1bmN0aW9uIFN5cyROZXQkV2ViU2VydmljZVByb3h5JGdldF90aW1lb3V0KCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiTnVtYmVyXCIgbG9jaWQ9XCJQOkojU3lzLk5ldC5XZWJTZXJ2aWNlUHJveHkudGltZW91dFwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiB0aGlzLl90aW1lb3V0IHx8IDA7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyROZXQkV2ViU2VydmljZVByb3h5JHNldF90aW1lb3V0KHZhbHVlKSB7XHJcblxyXG5cdFx0aWYgKHZhbHVlIDwgMCkge1xyXG5cdFx0XHR0aHJvdyBFcnJvci5hcmd1bWVudE91dE9mUmFuZ2UoJ3ZhbHVlJywgdmFsdWUsIFN5cy5SZXMuaW52YWxpZFRpbWVvdXQpO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5fdGltZW91dCA9IHZhbHVlO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlNlcnZpY2VQcm94eSRnZXRfZGVmYXVsdFVzZXJDb250ZXh0KCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSBtYXlCZU51bGw9XCJ0cnVlXCIgbG9jaWQ9XCJQOkojU3lzLk5ldC5XZWJTZXJ2aWNlUHJveHkuZGVmYXVsdFVzZXJDb250ZXh0XCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0cmV0dXJuICh0eXBlb2YodGhpcy5fdXNlckNvbnRleHQpID09PSBcInVuZGVmaW5lZFwiKSA/IG51bGwgOiB0aGlzLl91c2VyQ29udGV4dDtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJTZXJ2aWNlUHJveHkkc2V0X2RlZmF1bHRVc2VyQ29udGV4dCh2YWx1ZSkge1xyXG5cclxuXHRcdHRoaXMuX3VzZXJDb250ZXh0ID0gdmFsdWU7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyROZXQkV2ViU2VydmljZVByb3h5JGdldF9kZWZhdWx0U3VjY2VlZGVkQ2FsbGJhY2soKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJGdW5jdGlvblwiIG1heUJlTnVsbD1cInRydWVcIiBsb2NpZD1cIlA6SiNTeXMuTmV0LldlYlNlcnZpY2VQcm94eS5kZWZhdWx0U3VjY2VlZGVkQ2FsbGJhY2tcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHRyZXR1cm4gdGhpcy5fc3VjY2VlZGVkIHx8IG51bGw7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyROZXQkV2ViU2VydmljZVByb3h5JHNldF9kZWZhdWx0U3VjY2VlZGVkQ2FsbGJhY2sodmFsdWUpIHtcclxuXHJcblx0XHR0aGlzLl9zdWNjZWVkZWQgPSB2YWx1ZTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJTZXJ2aWNlUHJveHkkZ2V0X2RlZmF1bHRGYWlsZWRDYWxsYmFjaygpIHtcclxuXHRcdC8vLyA8dmFsdWUgdHlwZT1cIkZ1bmN0aW9uXCIgbWF5QmVOdWxsPVwidHJ1ZVwiIGxvY2lkPVwiUDpKI1N5cy5OZXQuV2ViU2VydmljZVByb3h5LmRlZmF1bHRGYWlsZWRDYWxsYmFja1wiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiB0aGlzLl9mYWlsZWQgfHwgbnVsbDtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJTZXJ2aWNlUHJveHkkc2V0X2RlZmF1bHRGYWlsZWRDYWxsYmFjayh2YWx1ZSkge1xyXG5cclxuXHRcdHRoaXMuX2ZhaWxlZCA9IHZhbHVlO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlNlcnZpY2VQcm94eSRnZXRfZW5hYmxlSnNvbnAoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJCb29sZWFuXCIgbG9jaWQ9XCJQOkojU3lzLk5ldC5XZWJTZXJ2aWNlUHJveHkuZW5hYmxlSnNvbnBcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHRyZXR1cm4gISF0aGlzLl9qc29ucDtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJTZXJ2aWNlUHJveHkkc2V0X2VuYWJsZUpzb25wKHZhbHVlKSB7XHJcblxyXG5cdFx0dGhpcy5fanNvbnAgPSB2YWx1ZTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJTZXJ2aWNlUHJveHkkZ2V0X3BhdGgoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJTdHJpbmdcIiBsb2NpZD1cIlA6SiNTeXMuTmV0LldlYlNlcnZpY2VQcm94eS5wYXRoXCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0cmV0dXJuIHRoaXMuX3BhdGggfHwgbnVsbDtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJTZXJ2aWNlUHJveHkkc2V0X3BhdGgodmFsdWUpIHtcclxuXHJcblx0XHR0aGlzLl9wYXRoID0gdmFsdWU7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyROZXQkV2ViU2VydmljZVByb3h5JGdldF9qc29ucENhbGxiYWNrUGFyYW1ldGVyKCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiU3RyaW5nXCIgbG9jaWQ9XCJQOkojU3lzLk5ldC5XZWJTZXJ2aWNlUHJveHkuanNvbnBDYWxsYmFja1BhcmFtZXRlclwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiB0aGlzLl9jYWxsYmFja1BhcmFtZXRlciB8fCBcImNhbGxiYWNrXCI7XHJcblx0fVxyXG5cdGZ1bmN0aW9uIFN5cyROZXQkV2ViU2VydmljZVByb3h5JHNldF9qc29ucENhbGxiYWNrUGFyYW1ldGVyKHZhbHVlKSB7XHJcblxyXG5cdFx0dGhpcy5fY2FsbGJhY2tQYXJhbWV0ZXIgPSB2YWx1ZTtcclxuXHR9XHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJTZXJ2aWNlUHJveHkkX2ludm9rZShzZXJ2aWNlUGF0aCwgbWV0aG9kTmFtZSwgdXNlR2V0LCBwYXJhbXMsIG9uU3VjY2Vzcywgb25GYWlsdXJlLCB1c2VyQ29udGV4dCkge1xyXG5cdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5OZXQuV2ViU2VydmljZVByb3h5Ll9pbnZva2VcIiAvPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwic2VydmljZVBhdGhcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cIm1ldGhvZE5hbWVcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cInVzZUdldFwiIHR5cGU9XCJCb29sZWFuXCI+PC9wYXJhbT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cInBhcmFtc1wiPjwvcGFyYW0+XHJcblx0XHQvLy8gPHBhcmFtIG5hbWU9XCJvblN1Y2Nlc3NcIiB0eXBlPVwiRnVuY3Rpb25cIiBtYXlCZU51bGw9XCJ0cnVlXCIgb3B0aW9uYWw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdC8vLyA8cGFyYW0gbmFtZT1cIm9uRmFpbHVyZVwiIHR5cGU9XCJGdW5jdGlvblwiIG1heUJlTnVsbD1cInRydWVcIiBvcHRpb25hbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdFx0Ly8vIDxwYXJhbSBuYW1lPVwidXNlckNvbnRleHRcIiBtYXlCZU51bGw9XCJ0cnVlXCIgb3B0aW9uYWw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiU3lzLk5ldC5XZWJSZXF1ZXN0XCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcmV0dXJucz5cclxuXHJcblxyXG5cdFx0b25TdWNjZXNzID0gb25TdWNjZXNzIHx8IHRoaXMuZ2V0X2RlZmF1bHRTdWNjZWVkZWRDYWxsYmFjaygpO1xyXG5cdFx0b25GYWlsdXJlID0gb25GYWlsdXJlIHx8IHRoaXMuZ2V0X2RlZmF1bHRGYWlsZWRDYWxsYmFjaygpO1xyXG5cdFx0aWYgKHVzZXJDb250ZXh0ID09PSBudWxsIHx8IHR5cGVvZiB1c2VyQ29udGV4dCA9PT0gJ3VuZGVmaW5lZCcpIHVzZXJDb250ZXh0ID0gdGhpcy5nZXRfZGVmYXVsdFVzZXJDb250ZXh0KCk7XHJcblx0XHRyZXR1cm4gU3lzLk5ldC5XZWJTZXJ2aWNlUHJveHkuaW52b2tlKHNlcnZpY2VQYXRoLCBtZXRob2ROYW1lLCB1c2VHZXQsIHBhcmFtcywgb25TdWNjZXNzLCBvbkZhaWx1cmUsIHVzZXJDb250ZXh0LCB0aGlzLmdldF90aW1lb3V0KCksIHRoaXMuZ2V0X2VuYWJsZUpzb25wKCksIHRoaXMuZ2V0X2pzb25wQ2FsbGJhY2tQYXJhbWV0ZXIoKSk7XHJcblx0fVxyXG5TeXMuTmV0LldlYlNlcnZpY2VQcm94eS5wcm90b3R5cGUgPSB7XHJcblx0Z2V0X3RpbWVvdXQ6IFN5cyROZXQkV2ViU2VydmljZVByb3h5JGdldF90aW1lb3V0LFxyXG5cdHNldF90aW1lb3V0OiBTeXMkTmV0JFdlYlNlcnZpY2VQcm94eSRzZXRfdGltZW91dCxcclxuXHRnZXRfZGVmYXVsdFVzZXJDb250ZXh0OiBTeXMkTmV0JFdlYlNlcnZpY2VQcm94eSRnZXRfZGVmYXVsdFVzZXJDb250ZXh0LFxyXG5cdHNldF9kZWZhdWx0VXNlckNvbnRleHQ6IFN5cyROZXQkV2ViU2VydmljZVByb3h5JHNldF9kZWZhdWx0VXNlckNvbnRleHQsXHJcblx0Z2V0X2RlZmF1bHRTdWNjZWVkZWRDYWxsYmFjazogU3lzJE5ldCRXZWJTZXJ2aWNlUHJveHkkZ2V0X2RlZmF1bHRTdWNjZWVkZWRDYWxsYmFjayxcclxuXHRzZXRfZGVmYXVsdFN1Y2NlZWRlZENhbGxiYWNrOiBTeXMkTmV0JFdlYlNlcnZpY2VQcm94eSRzZXRfZGVmYXVsdFN1Y2NlZWRlZENhbGxiYWNrLFxyXG5cdGdldF9kZWZhdWx0RmFpbGVkQ2FsbGJhY2s6IFN5cyROZXQkV2ViU2VydmljZVByb3h5JGdldF9kZWZhdWx0RmFpbGVkQ2FsbGJhY2ssXHJcblx0c2V0X2RlZmF1bHRGYWlsZWRDYWxsYmFjazogU3lzJE5ldCRXZWJTZXJ2aWNlUHJveHkkc2V0X2RlZmF1bHRGYWlsZWRDYWxsYmFjayxcclxuXHRnZXRfZW5hYmxlSnNvbnA6IFN5cyROZXQkV2ViU2VydmljZVByb3h5JGdldF9lbmFibGVKc29ucCxcclxuXHRzZXRfZW5hYmxlSnNvbnA6IFN5cyROZXQkV2ViU2VydmljZVByb3h5JHNldF9lbmFibGVKc29ucCxcclxuXHRnZXRfcGF0aDogU3lzJE5ldCRXZWJTZXJ2aWNlUHJveHkkZ2V0X3BhdGgsXHJcblx0c2V0X3BhdGg6IFN5cyROZXQkV2ViU2VydmljZVByb3h5JHNldF9wYXRoLFxyXG5cdGdldF9qc29ucENhbGxiYWNrUGFyYW1ldGVyOiBTeXMkTmV0JFdlYlNlcnZpY2VQcm94eSRnZXRfanNvbnBDYWxsYmFja1BhcmFtZXRlcixcclxuXHRzZXRfanNvbnBDYWxsYmFja1BhcmFtZXRlcjogU3lzJE5ldCRXZWJTZXJ2aWNlUHJveHkkc2V0X2pzb25wQ2FsbGJhY2tQYXJhbWV0ZXIsXHJcblx0X2ludm9rZTogU3lzJE5ldCRXZWJTZXJ2aWNlUHJveHkkX2ludm9rZVxyXG59XHJcblN5cy5OZXQuV2ViU2VydmljZVByb3h5LnJlZ2lzdGVyQ2xhc3MoJ1N5cy5OZXQuV2ViU2VydmljZVByb3h5Jyk7XHJcblxyXG5TeXMuTmV0LldlYlNlcnZpY2VQcm94eS5pbnZva2UgPSBmdW5jdGlvbiBTeXMkTmV0JFdlYlNlcnZpY2VQcm94eSRpbnZva2Uoc2VydmljZVBhdGgsIG1ldGhvZE5hbWUsIHVzZUdldCwgcGFyYW1zLCBvblN1Y2Nlc3MsIG9uRmFpbHVyZSwgdXNlckNvbnRleHQsIHRpbWVvdXQsIGVuYWJsZUpzb25wLCBqc29ucENhbGxiYWNrUGFyYW1ldGVyKSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5OZXQuV2ViU2VydmljZVByb3h5Lmludm9rZVwiIC8+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwic2VydmljZVBhdGhcIiB0eXBlPVwiU3RyaW5nXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJtZXRob2ROYW1lXCIgdHlwZT1cIlN0cmluZ1wiIG1heUJlTnVsbD1cInRydWVcIiBvcHRpb25hbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInVzZUdldFwiIHR5cGU9XCJCb29sZWFuXCIgb3B0aW9uYWw9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwicGFyYW1zXCIgbWF5QmVOdWxsPVwidHJ1ZVwiIG9wdGlvbmFsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwib25TdWNjZXNzXCIgdHlwZT1cIkZ1bmN0aW9uXCIgbWF5QmVOdWxsPVwidHJ1ZVwiIG9wdGlvbmFsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwib25GYWlsdXJlXCIgdHlwZT1cIkZ1bmN0aW9uXCIgbWF5QmVOdWxsPVwidHJ1ZVwiIG9wdGlvbmFsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwidXNlckNvbnRleHRcIiBtYXlCZU51bGw9XCJ0cnVlXCIgb3B0aW9uYWw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ0aW1lb3V0XCIgdHlwZT1cIk51bWJlclwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cImVuYWJsZUpzb25wXCIgdHlwZT1cIkJvb2xlYW5cIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJqc29ucENhbGxiYWNrUGFyYW1ldGVyXCIgdHlwZT1cIlN0cmluZ1wiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cmV0dXJucyB0eXBlPVwiU3lzLk5ldC5XZWJSZXF1ZXN0XCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcmV0dXJucz5cclxuXHJcblx0dmFyIHNjaGVtZUhvc3QgPSAoZW5hYmxlSnNvbnAgIT09IGZhbHNlKSA/IFN5cy5OZXQuV2ViU2VydmljZVByb3h5Ll94ZG9tYWluLmV4ZWMoc2VydmljZVBhdGgpIDogbnVsbCxcclxuXHRcdHRlbXBDYWxsYmFjaywganNvbnAgPSBzY2hlbWVIb3N0ICYmIChzY2hlbWVIb3N0Lmxlbmd0aCA9PT0gMykgJiZcclxuXHRcdFx0KChzY2hlbWVIb3N0WzFdICE9PSBsb2NhdGlvbi5wcm90b2NvbCkgfHwgKHNjaGVtZUhvc3RbMl0gIT09IGxvY2F0aW9uLmhvc3QpKTtcclxuXHR1c2VHZXQgPSBqc29ucCB8fCB1c2VHZXQ7XHJcblx0aWYgKGpzb25wKSB7XHJcblx0XHRqc29ucENhbGxiYWNrUGFyYW1ldGVyID0ganNvbnBDYWxsYmFja1BhcmFtZXRlciB8fCBcImNhbGxiYWNrXCI7XHJcblx0XHR0ZW1wQ2FsbGJhY2sgPSBcIl9qc29ucFwiICsgU3lzLl9qc29ucCsrO1xyXG5cdH1cclxuXHRpZiAoIXBhcmFtcykgcGFyYW1zID0ge307XHJcblx0dmFyIHVybFBhcmFtcyA9IHBhcmFtcztcclxuXHRpZiAoIXVzZUdldCB8fCAhdXJsUGFyYW1zKSB1cmxQYXJhbXMgPSB7fTtcclxuXHR2YXIgZXJyb3IsIHRpbWVvdXRjb29raWUgPSBudWxsLCBib2R5ID0gbnVsbCxcclxuXHRcdHVybCA9IFN5cy5OZXQuV2ViUmVxdWVzdC5fY3JlYXRlVXJsKG1ldGhvZE5hbWVcclxuXHRcdFx0PyAoc2VydmljZVBhdGgrXCIvXCIrZW5jb2RlVVJJQ29tcG9uZW50KG1ldGhvZE5hbWUpKVxyXG5cdFx0XHQ6IHNlcnZpY2VQYXRoLCB1cmxQYXJhbXMsIGpzb25wID8gKGpzb25wQ2FsbGJhY2tQYXJhbWV0ZXIgKyBcIj1TeXMuXCIgKyB0ZW1wQ2FsbGJhY2spIDogbnVsbCk7XHJcblx0aWYgKGpzb25wKSB7XHJcblx0XHRmdW5jdGlvbiBqc29ucENvbXBsZXRlKGRhdGEsIHN0YXR1c0NvZGUpIHtcclxuXHRcdFx0aWYgKHRpbWVvdXRjb29raWUgIT09IG51bGwpIHtcclxuXHRcdFx0XHR3aW5kb3cuY2xlYXJUaW1lb3V0KHRpbWVvdXRjb29raWUpO1xyXG5cdFx0XHRcdHRpbWVvdXRjb29raWUgPSBudWxsO1xyXG5cdFx0XHR9XHJcblx0XHRcdGRlbGV0ZSBTeXNbdGVtcENhbGxiYWNrXTtcclxuXHRcdFx0dGVtcENhbGxiYWNrID0gbnVsbDtcclxuXHRcdFx0aWYgKCh0eXBlb2Yoc3RhdHVzQ29kZSkgIT09IFwidW5kZWZpbmVkXCIpICYmIChzdGF0dXNDb2RlICE9PSAyMDApKSB7XHJcblx0XHRcdFx0aWYgKG9uRmFpbHVyZSkge1xyXG5cdFx0XHRcdFx0ZXJyb3IgPSBuZXcgU3lzLk5ldC5XZWJTZXJ2aWNlRXJyb3IoZmFsc2UsXHJcblx0XHRcdFx0XHRcdFx0ZGF0YS5NZXNzYWdlIHx8IFN0cmluZy5mb3JtYXQoU3lzLlJlcy53ZWJTZXJ2aWNlRmFpbGVkTm9Nc2csIG1ldGhvZE5hbWUpLFxyXG5cdFx0XHRcdFx0XHRcdGRhdGEuU3RhY2tUcmFjZSB8fCBudWxsLFxyXG5cdFx0XHRcdFx0XHRcdGRhdGEuRXhjZXB0aW9uVHlwZSB8fCBudWxsLFxyXG5cdFx0XHRcdFx0XHRcdGRhdGEpO1xyXG5cdFx0XHRcdFx0ZXJyb3IuX3N0YXR1c0NvZGUgPSBzdGF0dXNDb2RlO1xyXG5cdFx0XHRcdFx0b25GYWlsdXJlKGVycm9yLCB1c2VyQ29udGV4dCwgbWV0aG9kTmFtZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0aWYgKGRhdGEuU3RhY2tUcmFjZSAmJiBkYXRhLk1lc3NhZ2UpIHtcclxuXHRcdFx0XHRcdFx0ZXJyb3IgPSBkYXRhLlN0YWNrVHJhY2UgKyBcIi0tIFwiICsgZGF0YS5NZXNzYWdlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdGVycm9yID0gZGF0YS5TdGFja1RyYWNlIHx8IGRhdGEuTWVzc2FnZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVycm9yID0gU3RyaW5nLmZvcm1hdChlcnJvciA/IFN5cy5SZXMud2ViU2VydmljZUZhaWxlZCA6IFN5cy5SZXMud2ViU2VydmljZUZhaWxlZE5vTXNnLCBtZXRob2ROYW1lLCBlcnJvcik7XHJcblx0XHRcdFx0XHR0aHJvdyBTeXMuTmV0LldlYlNlcnZpY2VQcm94eS5fY3JlYXRlRmFpbGVkRXJyb3IobWV0aG9kTmFtZSwgU3RyaW5nLmZvcm1hdChTeXMuUmVzLndlYlNlcnZpY2VGYWlsZWQsIG1ldGhvZE5hbWUsIGVycm9yKSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKG9uU3VjY2Vzcykge1xyXG5cdFx0XHRcdG9uU3VjY2VzcyhkYXRhLCB1c2VyQ29udGV4dCwgbWV0aG9kTmFtZSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdFN5c1t0ZW1wQ2FsbGJhY2tdID0ganNvbnBDb21wbGV0ZTtcclxuXHRcdFN5cy5fbG9hZEpzb25wKHVybCwgZnVuY3Rpb24oKSB7XHJcblx0XHRcdGlmICh0ZW1wQ2FsbGJhY2spIHtcclxuXHRcdFx0XHRqc29ucENvbXBsZXRlKHsgTWVzc2FnZTogU3RyaW5nLmZvcm1hdChTeXMuUmVzLndlYlNlcnZpY2VGYWlsZWROb01zZywgbWV0aG9kTmFtZSkgfSwgLTEpO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHRcdHJldHVybiBudWxsO1xyXG5cdH1cclxuXHR2YXIgcmVxdWVzdCA9IG5ldyBTeXMuTmV0LldlYlJlcXVlc3QoKTtcclxuXHRyZXF1ZXN0LnNldF91cmwodXJsKTtcclxuXHRyZXF1ZXN0LmdldF9oZWFkZXJzKClbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgnO1xyXG5cdGlmICghdXNlR2V0KSB7XHJcblx0XHRib2R5ID0gU3lzLlNlcmlhbGl6YXRpb24uSmF2YVNjcmlwdFNlcmlhbGl6ZXIuc2VyaWFsaXplKHBhcmFtcyk7XHJcblx0XHRpZiAoYm9keSA9PT0gXCJ7fVwiKSBib2R5ID0gXCJcIjtcclxuXHR9XHJcblx0cmVxdWVzdC5zZXRfYm9keShib2R5KTtcclxuXHRyZXF1ZXN0LmFkZF9jb21wbGV0ZWQob25Db21wbGV0ZSk7XHJcblx0aWYgKHRpbWVvdXQgJiYgdGltZW91dCA+IDApIHJlcXVlc3Quc2V0X3RpbWVvdXQodGltZW91dCk7XHJcblx0cmVxdWVzdC5pbnZva2UoKTtcclxuXHRmdW5jdGlvbiBvbkNvbXBsZXRlKHJlc3BvbnNlLCBldmVudEFyZ3MpIHtcclxuXHRcdGlmIChyZXNwb25zZS5nZXRfcmVzcG9uc2VBdmFpbGFibGUoKSkge1xyXG5cdFx0XHR2YXIgZXgsIHN0YXR1c0NvZGUgPSByZXNwb25zZS5nZXRfc3RhdHVzQ29kZSgpO1xyXG5cdFx0XHR2YXIgcmVzdWx0ID0gbnVsbDtcclxuXHRcdFx0dHJ5IHtcclxuXHRcdFx0XHR2YXIgY29udGVudFR5cGUgPSByZXNwb25zZS5nZXRSZXNwb25zZUhlYWRlcihcIkNvbnRlbnQtVHlwZVwiKTtcclxuXHRcdFx0XHRyZXN1bHQgPSBjb250ZW50VHlwZS5zdGFydHNXaXRoKFwiYXBwbGljYXRpb24vanNvblwiKSA/IHJlc3BvbnNlLmdldF9vYmplY3QoKSA6XHJcblx0XHRcdFx0XHQoY29udGVudFR5cGUuc3RhcnRzV2l0aChcInRleHQveG1sXCIpID8gcmVzcG9uc2UuZ2V0X3htbCgpIDogcmVzcG9uc2UuZ2V0X3Jlc3BvbnNlRGF0YSgpKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRjYXRjaCAoZXgpIHtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIGVycm9yID0gcmVzcG9uc2UuZ2V0UmVzcG9uc2VIZWFkZXIoXCJqc29uZXJyb3JcIik7XHJcblx0XHRcdHZhciBlcnJvck9iaiA9IChlcnJvciA9PT0gXCJ0cnVlXCIpO1xyXG5cdFx0XHRpZiAoZXJyb3JPYmopIHtcclxuXHRcdFx0XHRpZiAocmVzdWx0KSB7XHJcblx0XHRcdFx0XHRyZXN1bHQgPSBuZXcgU3lzLk5ldC5XZWJTZXJ2aWNlRXJyb3IoZmFsc2UsIHJlc3VsdC5NZXNzYWdlLCByZXN1bHQuU3RhY2tUcmFjZSwgcmVzdWx0LkV4Y2VwdGlvblR5cGUsIHJlc3VsdCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKGNvbnRlbnRUeXBlLnN0YXJ0c1dpdGgoXCJhcHBsaWNhdGlvbi9qc29uXCIpKSB7XHJcblx0XHRcdFx0cmVzdWx0ID0gKCFyZXN1bHQgfHwgKHR5cGVvZihyZXN1bHQuZCkgPT09IFwidW5kZWZpbmVkXCIpKSA/IHJlc3VsdCA6IHJlc3VsdC5kO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICgoKHN0YXR1c0NvZGUgPCAyMDApIHx8IChzdGF0dXNDb2RlID49IDMwMCkpIHx8IGVycm9yT2JqKSB7XHJcblx0XHRcdFx0aWYgKG9uRmFpbHVyZSkge1xyXG5cdFx0XHRcdFx0aWYgKCFyZXN1bHQgfHwgIWVycm9yT2JqKSB7XHJcblx0XHRcdFx0XHRcdHJlc3VsdCA9IG5ldyBTeXMuTmV0LldlYlNlcnZpY2VFcnJvcihmYWxzZVxyXG4sIFN0cmluZy5mb3JtYXQoU3lzLlJlcy53ZWJTZXJ2aWNlRmFpbGVkTm9Nc2csIG1ldGhvZE5hbWUpKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHJlc3VsdC5fc3RhdHVzQ29kZSA9IHN0YXR1c0NvZGU7XHJcblx0XHRcdFx0XHRvbkZhaWx1cmUocmVzdWx0LCB1c2VyQ29udGV4dCwgbWV0aG9kTmFtZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0aWYgKHJlc3VsdCAmJiBlcnJvck9iaikge1xyXG5cdFx0XHRcdFx0XHRlcnJvciA9IHJlc3VsdC5nZXRfZXhjZXB0aW9uVHlwZSgpICsgXCItLSBcIiArIHJlc3VsdC5nZXRfbWVzc2FnZSgpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdGVycm9yID0gcmVzcG9uc2UuZ2V0X3Jlc3BvbnNlRGF0YSgpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0dGhyb3cgU3lzLk5ldC5XZWJTZXJ2aWNlUHJveHkuX2NyZWF0ZUZhaWxlZEVycm9yKG1ldGhvZE5hbWUsIFN0cmluZy5mb3JtYXQoU3lzLlJlcy53ZWJTZXJ2aWNlRmFpbGVkLCBtZXRob2ROYW1lLCBlcnJvcikpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmIChvblN1Y2Nlc3MpIHtcclxuXHRcdFx0XHRvblN1Y2Nlc3MocmVzdWx0LCB1c2VyQ29udGV4dCwgbWV0aG9kTmFtZSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHR2YXIgdGltZWRPdXQgPSByZXNwb25zZS5nZXRfdGltZWRPdXQoKSxcclxuXHRcdFx0XHRtc2cgPSBTdHJpbmcuZm9ybWF0KCh0aW1lZE91dCA/IFN5cy5SZXMud2ViU2VydmljZVRpbWVkT3V0IDogU3lzLlJlcy53ZWJTZXJ2aWNlRmFpbGVkTm9Nc2cpLCBtZXRob2ROYW1lKTtcclxuXHRcdFx0aWYgKG9uRmFpbHVyZSkge1xyXG5cdFx0XHRcdG9uRmFpbHVyZShuZXcgU3lzLk5ldC5XZWJTZXJ2aWNlRXJyb3IodGltZWRPdXQsIG1zZywgXCJcIiwgXCJcIiksIHVzZXJDb250ZXh0LCBtZXRob2ROYW1lKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aHJvdyBTeXMuTmV0LldlYlNlcnZpY2VQcm94eS5fY3JlYXRlRmFpbGVkRXJyb3IobWV0aG9kTmFtZSwgbXNnKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0cmV0dXJuIHJlcXVlc3Q7XHJcbn1cclxuXHJcblN5cy5OZXQuV2ViU2VydmljZVByb3h5Ll9jcmVhdGVGYWlsZWRFcnJvciA9IGZ1bmN0aW9uIFN5cyROZXQkV2ViU2VydmljZVByb3h5JF9jcmVhdGVGYWlsZWRFcnJvcihtZXRob2ROYW1lLCBlcnJvck1lc3NhZ2UpIHtcclxuXHR2YXIgZGlzcGxheU1lc3NhZ2UgPSBcIlN5cy5OZXQuV2ViU2VydmljZUZhaWxlZEV4Y2VwdGlvbjogXCIgKyBlcnJvck1lc3NhZ2U7XHJcblx0dmFyIGUgPSBFcnJvci5jcmVhdGUoZGlzcGxheU1lc3NhZ2UsIHsgJ25hbWUnOiAnU3lzLk5ldC5XZWJTZXJ2aWNlRmFpbGVkRXhjZXB0aW9uJywgJ21ldGhvZE5hbWUnOiBtZXRob2ROYW1lIH0pO1xyXG5cdGUucG9wU3RhY2tGcmFtZSgpO1xyXG5cdHJldHVybiBlO1xyXG59XHJcblxyXG5TeXMuTmV0LldlYlNlcnZpY2VQcm94eS5fZGVmYXVsdEZhaWxlZENhbGxiYWNrID0gZnVuY3Rpb24gU3lzJE5ldCRXZWJTZXJ2aWNlUHJveHkkX2RlZmF1bHRGYWlsZWRDYWxsYmFjayhlcnIsIG1ldGhvZE5hbWUpIHtcclxuXHR2YXIgZXJyb3IgPSBlcnIuZ2V0X2V4Y2VwdGlvblR5cGUoKSArIFwiLS0gXCIgKyBlcnIuZ2V0X21lc3NhZ2UoKTtcclxuXHR0aHJvdyBTeXMuTmV0LldlYlNlcnZpY2VQcm94eS5fY3JlYXRlRmFpbGVkRXJyb3IobWV0aG9kTmFtZSwgU3RyaW5nLmZvcm1hdChTeXMuUmVzLndlYlNlcnZpY2VGYWlsZWQsIG1ldGhvZE5hbWUsIGVycm9yKSk7XHJcbn1cclxuXHJcblxyXG5cclxuU3lzLk5ldC5XZWJTZXJ2aWNlUHJveHkuX2dlbmVyYXRlVHlwZWRDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uIFN5cyROZXQkV2ViU2VydmljZVByb3h5JF9nZW5lcmF0ZVR5cGVkQ29uc3RydWN0b3IodHlwZSkge1xyXG5cdHJldHVybiBmdW5jdGlvbihwcm9wZXJ0aWVzKSB7XHJcblx0XHRpZiAocHJvcGVydGllcykge1xyXG5cdFx0XHRmb3IgKHZhciBuYW1lIGluIHByb3BlcnRpZXMpIHtcclxuXHRcdFx0XHR0aGlzW25hbWVdID0gcHJvcGVydGllc1tuYW1lXTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0dGhpcy5fX3R5cGUgPSB0eXBlO1xyXG5cdH1cclxufVxyXG5cclxuXHJcblN5cy5fanNvbnAgPSAwO1xyXG5cclxuXHJcblN5cy5OZXQuV2ViU2VydmljZVByb3h5Ll94ZG9tYWluID0gL15cXHMqKFthLXpBLVowLTlcXCtcXC1cXC5dK1xcOilcXC9cXC8oW14/I1xcL10rKS87XHJcblxyXG5TeXMuX2xvYWRKc29ucCA9IGZ1bmN0aW9uIF9sb2FkSnNvbnAoc3JjLCBjYWxsYmFjaykge1xyXG5cdHZhciBzY3JpcHQgPSBjcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcclxuXHRzY3JpcHQudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnO1xyXG5cdHNjcmlwdC5zcmMgPSBzcmM7XHJcblx0dmFyIGF0dGFjaEV2ZW50ID0gc2NyaXB0LmF0dGFjaEV2ZW50O1xyXG5cdGZ1bmN0aW9uIG9uRXZlbnQoKSB7XHJcblx0XHRpZiAoIWF0dGFjaEV2ZW50IHx8IC9sb2FkZWR8Y29tcGxldGUvLnRlc3Qoc2NyaXB0LnJlYWR5U3RhdGUpKSB7XHJcblx0XHRcdGlmIChhdHRhY2hFdmVudCkge1xyXG5cdFx0XHRcdHNjcmlwdC5kZXRhY2hFdmVudChcIm9ucmVhZHlzdGF0ZWNoYW5nZVwiLCBvbkV2ZW50KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRzY3JpcHQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgb25FdmVudCwgZmFsc2UpO1xyXG5cdFx0XHRcdHNjcmlwdC5yZW1vdmVFdmVudExpc3RlbmVyKFwiZXJyb3JcIiwgb25FdmVudCwgZmFsc2UpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGNhbGxiYWNrLmFwcGx5KHNjcmlwdCk7XHJcblx0XHRcdHNjcmlwdCA9IG51bGw7XHJcblx0XHR9XHJcblx0fVxyXG5cdGlmIChhdHRhY2hFdmVudCkge1xyXG5cdFx0c2NyaXB0LmF0dGFjaEV2ZW50KFwib25yZWFkeXN0YXRlY2hhbmdlXCIsIG9uRXZlbnQpO1xyXG5cdH1cclxuXHRlbHNlIHtcclxuXHRcdHNjcmlwdC5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBvbkV2ZW50LCBmYWxzZSk7XHJcblx0XHRzY3JpcHQuYWRkRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsIG9uRXZlbnQsIGZhbHNlKTtcclxuXHR9XHJcblx0ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJoZWFkXCIpWzBdLmFwcGVuZENoaWxkKHNjcmlwdCk7XHJcbn1cclxuXHJcblN5cy5OZXQuV2ViU2VydmljZUVycm9yID0gZnVuY3Rpb24gU3lzJE5ldCRXZWJTZXJ2aWNlRXJyb3IodGltZWRPdXQsIG1lc3NhZ2UsIHN0YWNrVHJhY2UsIGV4Y2VwdGlvblR5cGUsIGVycm9yT2JqZWN0KSB7XHJcblx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5OZXQuV2ViU2VydmljZUVycm9yLiNjdG9yXCIgLz5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJ0aW1lZE91dFwiIHR5cGU9XCJCb29sZWFuXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJtZXNzYWdlXCIgdHlwZT1cIlN0cmluZ1wiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdC8vLyA8cGFyYW0gbmFtZT1cInN0YWNrVHJhY2VcIiB0eXBlPVwiU3RyaW5nXCIgbWF5QmVOdWxsPVwidHJ1ZVwiIG9wdGlvbmFsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0Ly8vIDxwYXJhbSBuYW1lPVwiZXhjZXB0aW9uVHlwZVwiIHR5cGU9XCJTdHJpbmdcIiBtYXlCZU51bGw9XCJ0cnVlXCIgb3B0aW9uYWw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHQvLy8gPHBhcmFtIG5hbWU9XCJlcnJvck9iamVjdFwiIHR5cGU9XCJPYmplY3RcIiBtYXlCZU51bGw9XCJ0cnVlXCIgb3B0aW9uYWw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHJcblx0dGhpcy5fdGltZWRPdXQgPSB0aW1lZE91dDtcclxuXHR0aGlzLl9tZXNzYWdlID0gbWVzc2FnZTtcclxuXHR0aGlzLl9zdGFja1RyYWNlID0gc3RhY2tUcmFjZTtcclxuXHR0aGlzLl9leGNlcHRpb25UeXBlID0gZXhjZXB0aW9uVHlwZTtcclxuXHR0aGlzLl9lcnJvck9iamVjdCA9IGVycm9yT2JqZWN0O1xyXG5cdHRoaXMuX3N0YXR1c0NvZGUgPSAtMTtcclxufVxyXG5cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJTZXJ2aWNlRXJyb3IkZ2V0X3RpbWVkT3V0KCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiQm9vbGVhblwiIGxvY2lkPVwiUDpKI1N5cy5OZXQuV2ViU2VydmljZUVycm9yLnRpbWVkT3V0XCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0cmV0dXJuIHRoaXMuX3RpbWVkT3V0O1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJTZXJ2aWNlRXJyb3IkZ2V0X3N0YXR1c0NvZGUoKSB7XHJcblx0XHQvLy8gPHZhbHVlIHR5cGU9XCJOdW1iZXJcIiBsb2NpZD1cIlA6SiNTeXMuTmV0LldlYlNlcnZpY2VFcnJvci5zdGF0dXNDb2RlXCI+PC92YWx1ZT5cclxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAwKSB0aHJvdyBFcnJvci5wYXJhbWV0ZXJDb3VudCgpO1xyXG5cdFx0cmV0dXJuIHRoaXMuX3N0YXR1c0NvZGU7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlNlcnZpY2VFcnJvciRnZXRfbWVzc2FnZSgpIHtcclxuXHRcdC8vLyA8dmFsdWUgdHlwZT1cIlN0cmluZ1wiIGxvY2lkPVwiUDpKI1N5cy5OZXQuV2ViU2VydmljZUVycm9yLm1lc3NhZ2VcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHRyZXR1cm4gdGhpcy5fbWVzc2FnZTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIFN5cyROZXQkV2ViU2VydmljZUVycm9yJGdldF9zdGFja1RyYWNlKCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiU3RyaW5nXCIgbG9jaWQ9XCJQOkojU3lzLk5ldC5XZWJTZXJ2aWNlRXJyb3Iuc3RhY2tUcmFjZVwiPjwvdmFsdWU+XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMCkgdGhyb3cgRXJyb3IucGFyYW1ldGVyQ291bnQoKTtcclxuXHRcdHJldHVybiB0aGlzLl9zdGFja1RyYWNlIHx8IFwiXCI7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBTeXMkTmV0JFdlYlNlcnZpY2VFcnJvciRnZXRfZXhjZXB0aW9uVHlwZSgpIHtcclxuXHRcdC8vLyA8dmFsdWUgdHlwZT1cIlN0cmluZ1wiIGxvY2lkPVwiUDpKI1N5cy5OZXQuV2ViU2VydmljZUVycm9yLmV4Y2VwdGlvblR5cGVcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHRyZXR1cm4gdGhpcy5fZXhjZXB0aW9uVHlwZSB8fCBcIlwiO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJTZXJ2aWNlRXJyb3IkZ2V0X2Vycm9yT2JqZWN0KCkge1xyXG5cdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiT2JqZWN0XCIgbG9jaWQ9XCJQOkojU3lzLk5ldC5XZWJTZXJ2aWNlRXJyb3IuZXJyb3JPYmplY3RcIj48L3ZhbHVlPlxyXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDApIHRocm93IEVycm9yLnBhcmFtZXRlckNvdW50KCk7XHJcblx0XHRyZXR1cm4gdGhpcy5fZXJyb3JPYmplY3QgfHwgbnVsbDtcclxuXHR9XHJcblN5cy5OZXQuV2ViU2VydmljZUVycm9yLnByb3RvdHlwZSA9IHtcclxuXHRnZXRfdGltZWRPdXQ6IFN5cyROZXQkV2ViU2VydmljZUVycm9yJGdldF90aW1lZE91dCxcclxuXHRnZXRfc3RhdHVzQ29kZTogU3lzJE5ldCRXZWJTZXJ2aWNlRXJyb3IkZ2V0X3N0YXR1c0NvZGUsXHJcblx0Z2V0X21lc3NhZ2U6IFN5cyROZXQkV2ViU2VydmljZUVycm9yJGdldF9tZXNzYWdlLFxyXG5cdGdldF9zdGFja1RyYWNlOiBTeXMkTmV0JFdlYlNlcnZpY2VFcnJvciRnZXRfc3RhY2tUcmFjZSxcclxuXHRnZXRfZXhjZXB0aW9uVHlwZTogU3lzJE5ldCRXZWJTZXJ2aWNlRXJyb3IkZ2V0X2V4Y2VwdGlvblR5cGUsXHJcblx0Z2V0X2Vycm9yT2JqZWN0OiBTeXMkTmV0JFdlYlNlcnZpY2VFcnJvciRnZXRfZXJyb3JPYmplY3RcclxufVxyXG5TeXMuTmV0LldlYlNlcnZpY2VFcnJvci5yZWdpc3RlckNsYXNzKCdTeXMuTmV0LldlYlNlcnZpY2VFcnJvcicpO1xyXG5cclxuXHJcblR5cGUucmVnaXN0ZXJOYW1lc3BhY2UoXCJTeXMuU2VydmljZXNcIik7XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbnZhciBucyA9IFN5cy5TZXJ2aWNlcztcclxuXHJcblxyXG52YXIgc2VydmljZSA9IFwiU2VydmljZVwiLFxyXG5cdHJvbGUgPSBcIlJvbGVcIixcclxuXHRhdXRoID0gXCJBdXRoZW50aWNhdGlvblwiLFxyXG5cdHByb2ZpbGUgPSBcIlByb2ZpbGVcIjtcclxuZnVuY3Rpb24gc2V0UGF0aChwYXRoKSB7XHJcblx0dGhpcy5fcGF0aCA9IHBhdGg7XHJcbn1cclxuXHJcbm5zW2F1dGgrc2VydmljZV0gPSB7XHJcblx0c2V0X3BhdGg6IHNldFBhdGgsXHJcblx0X3NldEF1dGhlbnRpY2F0ZWQ6IGZ1bmN0aW9uKGF1dGgpIHtcclxuXHRcdHRoaXMuX2F1dGggPSBhdXRoO1xyXG5cdH1cclxufTtcclxubnNbXCJfXCIgKyBhdXRoICsgc2VydmljZV0gPSB7fTtcclxuXHJcblxyXG5uc1twcm9maWxlICsgc2VydmljZV0gPSB7IHNldF9wYXRoOiBzZXRQYXRoIH07XHJcbm5zW1wiX1wiICsgcHJvZmlsZSArIHNlcnZpY2VdID0ge307XHJcbm5zLlByb2ZpbGVHcm91cCA9IGZ1bmN0aW9uIG5zJFByb2ZpbGVHcm91cChwcm9wZXJ0aWVzKSB7XHJcblx0dGhpcy5fcHJvcGVydHlncm91cCA9IHByb3BlcnRpZXM7XHJcbn1cclxuXHJcblxyXG5uc1tyb2xlICsgc2VydmljZV0gPSB7IHNldF9wYXRoOiBzZXRQYXRoIH07XHJcbm5zW1wiX1wiICsgcm9sZSArIHNlcnZpY2VdID0ge307XHJcblxyXG5cclxufVxyXG5cclxuaWYgKFN5cy5sb2FkZXIpIHtcclxuXHRTeXMubG9hZGVyLnJlZ2lzdGVyU2NyaXB0KFwiTWljcm9zb2Z0QWpheFwiLCBudWxsLCBleGVjdXRlKTtcclxufVxyXG5lbHNlIHtcclxuXHRleGVjdXRlKCk7XHJcbn1cclxuXHJcbn0pKHdpbmRvdywgd2luZG93LlN5cyk7XHJcbnZhciAkZ2V0LCAkY3JlYXRlLCAkYWRkSGFuZGxlciwgJGFkZEhhbmRsZXJzLCAkY2xlYXJIYW5kbGVycztcclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuVHlwZS5yZWdpc3Rlck5hbWVzcGFjZSgnU3lzJyk7XHJcblxyXG5TeXMuUmVzPXtcclxuJ2ludm9rZUNhbGxlZFR3aWNlJzonQ2Fubm90IGNhbGwgaW52b2tlIG1vcmUgdGhhbiBvbmNlLicsXHJcbidhcmd1bWVudFR5cGVOYW1lJzonVmFsdWUgaXMgbm90IHRoZSBuYW1lIG9mIGFuIGV4aXN0aW5nIHR5cGUuJyxcclxuJ2NhbnRCZUNhbGxlZEFmdGVyRGlzcG9zZSc6J0NhblxcJ3QgYmUgY2FsbGVkIGFmdGVyIGRpc3Bvc2UuJyxcclxuJ3dlYlNlcnZpY2VGYWlsZWQnOidUaGUgc2VydmVyIG1ldGhvZCBcXCd7MH1cXCcgZmFpbGVkIHdpdGggdGhlIGZvbGxvd2luZyBlcnJvcjogezF9JyxcclxuJ2NvbXBvbmVudENhbnRTZXRJZEFmdGVyQWRkZWRUb0FwcCc6J1RoZSBpZCBwcm9wZXJ0eSBvZiBhIGNvbXBvbmVudCBjYW5cXCd0IGJlIHNldCBhZnRlciBpdFxcJ3MgYmVlbiBhZGRlZCB0byB0aGUgQXBwbGljYXRpb24gb2JqZWN0LicsXHJcbidiZWhhdmlvckR1cGxpY2F0ZU5hbWUnOidBIGJlaGF2aW9yIHdpdGggbmFtZSBcXCd7MH1cXCcgYWxyZWFkeSBleGlzdHMgb3IgaXQgaXMgdGhlIG5hbWUgb2YgYW4gZXhpc3RpbmcgcHJvcGVydHkgb24gdGhlIHRhcmdldCBlbGVtZW50LicsXHJcbidub3RBVHlwZU5hbWUnOidWYWx1ZSBpcyBub3QgYSB2YWxpZCB0eXBlIG5hbWUuJyxcclxuJ2VsZW1lbnROb3RGb3VuZCc6J0FuIGVsZW1lbnQgd2l0aCBpZCBcXCd7MH1cXCcgY291bGQgbm90IGJlIGZvdW5kLicsXHJcbidzdGF0ZU11c3RCZVN0cmluZ0RpY3Rpb25hcnknOidUaGUgc3RhdGUgb2JqZWN0IGNhbiBvbmx5IGhhdmUgbnVsbCBhbmQgc3RyaW5nIGZpZWxkcy4nLFxyXG4naW52YWxpZEV4ZWN1dG9yVHlwZSc6J0NvdWxkIG5vdCBjcmVhdGUgYSB2YWxpZCBTeXMuTmV0LldlYlJlcXVlc3RFeGVjdXRvciBmcm9tOiB7MH0uJyxcclxuJ2Jvb2xUcnVlT3JGYWxzZSc6J1ZhbHVlIG11c3QgYmUgXFwndHJ1ZVxcJyBvciBcXCdmYWxzZVxcJy4nLFxyXG4nY2Fubm90Q2FsbEJlZm9yZVJlc3BvbnNlJzonQ2Fubm90IGNhbGwgezB9IHdoZW4gcmVzcG9uc2VBdmFpbGFibGUgaXMgZmFsc2UuJyxcclxuJ3NjcmlwdExvYWRGYWlsZWROb0hlYWQnOidTY3JpcHRMb2FkZXIgcmVxdWlyZXMgcGFnZXMgdG8gY29udGFpbiBhIDxoZWFkPiBlbGVtZW50LicsXHJcbidzdHJpbmdGb3JtYXRJbnZhbGlkJzonVGhlIGZvcm1hdCBzdHJpbmcgaXMgaW52YWxpZC4nLFxyXG4ncmVmZXJlbmNlTm90Rm91bmQnOidDb21wb25lbnQgXFwnezB9XFwnIHdhcyBub3QgZm91bmQuJyxcclxuJ2VudW1SZXNlcnZlZE5hbWUnOidcXCd7MH1cXCcgaXMgYSByZXNlcnZlZCBuYW1lIHRoYXQgY2FuXFwndCBiZSB1c2VkIGFzIGFuIGVudW0gdmFsdWUgbmFtZS4nLFxyXG4nY2lyY3VsYXJQYXJlbnRDaGFpbic6J1RoZSBjaGFpbiBvZiBjb250cm9sIHBhcmVudHMgY2FuXFwndCBoYXZlIGNpcmN1bGFyIHJlZmVyZW5jZXMuJyxcclxuJ25hbWVzcGFjZUNvbnRhaW5zTm9uT2JqZWN0JzonT2JqZWN0IHswfSBhbHJlYWR5IGV4aXN0cyBhbmQgaXMgbm90IGFuIG9iamVjdC4nLFxyXG4ndW5kZWZpbmVkRXZlbnQnOidcXCd7MH1cXCcgaXMgbm90IGFuIGV2ZW50LicsXHJcbidpbnZhbGlkVGltZW91dCc6J1ZhbHVlIG11c3QgYmUgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHplcm8uJyxcclxuJ2Nhbm5vdEFib3J0QmVmb3JlU3RhcnQnOidDYW5ub3QgYWJvcnQgd2hlbiBleGVjdXRvciBoYXMgbm90IHN0YXJ0ZWQuJyxcclxuJ29ic2VydmFibGVDb25mbGljdCc6J09iamVjdCBhbHJlYWR5IGNvbnRhaW5zIGEgbWVtYmVyIHdpdGggdGhlIG5hbWUgXFwnezB9XFwnLicsXHJcbidpbnZhbGlkSHR0cFZlcmInOidodHRwVmVyYiBjYW5ub3QgYmUgc2V0IHRvIGFuIGVtcHR5IG9yIG51bGwgc3RyaW5nLicsXHJcbidudWxsV2ViUmVxdWVzdCc6J0Nhbm5vdCBjYWxsIGV4ZWN1dGVSZXF1ZXN0IHdpdGggYSBudWxsIHdlYlJlcXVlc3QuJyxcclxuJ2hpc3RvcnlDYW5ub3RFbmFibGVIaXN0b3J5JzonQ2Fubm90IHNldCBlbmFibGVIaXN0b3J5IGFmdGVyIGluaXRpYWxpemF0aW9uLicsXHJcbidldmVudEhhbmRsZXJJbnZhbGlkJzonSGFuZGxlciB3YXMgbm90IGFkZGVkIHRocm91Z2ggdGhlIFN5cy5VSS5Eb21FdmVudC5hZGRIYW5kbGVyIG1ldGhvZC4nLFxyXG4nc2NyaXB0TG9hZEZhaWxlZERlYnVnJzonVGhlIHNjcmlwdCBcXCd7MH1cXCcgZmFpbGVkIHRvIGxvYWQuIENoZWNrIGZvcjpcXHJcXG4gSW5hY2Nlc3NpYmxlIHBhdGguXFxyXFxuIFNjcmlwdCBlcnJvcnMuIChJRSkgRW5hYmxlIFxcJ0Rpc3BsYXkgYSBub3RpZmljYXRpb24gYWJvdXQgZXZlcnkgc2NyaXB0IGVycm9yXFwnIHVuZGVyIGFkdmFuY2VkIHNldHRpbmdzLicsXHJcbidwcm9wZXJ0eU5vdFdyaXRhYmxlJzonXFwnezB9XFwnIGlzIG5vdCBhIHdyaXRhYmxlIHByb3BlcnR5LicsXHJcbidlbnVtSW52YWxpZFZhbHVlTmFtZSc6J1xcJ3swfVxcJyBpcyBub3QgYSB2YWxpZCBuYW1lIGZvciBhbiBlbnVtIHZhbHVlLicsXHJcbidjYW5ub3RDYWxsT25jZVN0YXJ0ZWQnOidDYW5ub3QgY2FsbCB7MH0gb25jZSBzdGFydGVkLicsXHJcbidjb250cm9sQWxyZWFkeURlZmluZWQnOidBIGNvbnRyb2wgaXMgYWxyZWFkeSBhc3NvY2lhdGVkIHdpdGggdGhlIGVsZW1lbnQuJyxcclxuJ2FkZEhhbmRsZXJDYW50QmVVc2VkRm9yRXJyb3InOidDYW5cXCd0IGFkZCBhIGhhbmRsZXIgZm9yIHRoZSBlcnJvciBldmVudCB1c2luZyB0aGlzIG1ldGhvZC4gUGxlYXNlIHNldCB0aGUgd2luZG93Lm9uZXJyb3IgcHJvcGVydHkgaW5zdGVhZC4nLFxyXG4nYmFkQmFzZVVybDEnOidCYXNlIFVSTCBkb2VzIG5vdCBjb250YWluIDovLy4nLFxyXG4nYmFkQmFzZVVybDInOidCYXNlIFVSTCBkb2VzIG5vdCBjb250YWluIGFub3RoZXIgLy4nLFxyXG4nYmFkQmFzZVVybDMnOidDYW5ub3QgZmluZCBsYXN0IC8gaW4gYmFzZSBVUkwuJyxcclxuJ3NldEV4ZWN1dG9yQWZ0ZXJBY3RpdmUnOidDYW5ub3Qgc2V0IGV4ZWN1dG9yIGFmdGVyIGl0IGhhcyBiZWNvbWUgYWN0aXZlLicsXHJcbidjYW50QWRkTm9uRnVuY3Rpb25oYW5kbGVyJzonQ2FuXFwndCBhZGQgYSBoYW5kbGVyIHRoYXQgaXMgbm90IGEgZnVuY3Rpb24uJyxcclxuJ2ludmFsaWROYW1lU3BhY2UnOidWYWx1ZSBpcyBub3QgYSB2YWxpZCBuYW1lc3BhY2UgaWRlbnRpZmllci4nLFxyXG4nbm90QW5JbnRlcmZhY2UnOidWYWx1ZSBpcyBub3QgYSB2YWxpZCBpbnRlcmZhY2UuJyxcclxuJ2V2ZW50SGFuZGxlck5vdEZ1bmN0aW9uJzonSGFuZGxlciBtdXN0IGJlIGEgZnVuY3Rpb24uJyxcclxuJ3Byb3BlcnR5Tm90QW5BcnJheSc6J1xcJ3swfVxcJyBpcyBub3QgYW4gQXJyYXkgcHJvcGVydHkuJyxcclxuJ25hbWVzcGFjZUNvbnRhaW5zQ2xhc3MnOidPYmplY3QgezB9IGFscmVhZHkgZXhpc3RzIGFzIGEgY2xhc3MsIGVudW0sIG9yIGludGVyZmFjZS4nLFxyXG4ndHlwZVJlZ2lzdGVyZWRUd2ljZSc6J1R5cGUgezB9IGhhcyBhbHJlYWR5IGJlZW4gcmVnaXN0ZXJlZC4gVGhlIHR5cGUgbWF5IGJlIGRlZmluZWQgbXVsdGlwbGUgdGltZXMgb3IgdGhlIHNjcmlwdCBmaWxlIHRoYXQgZGVmaW5lcyBpdCBtYXkgaGF2ZSBhbHJlYWR5IGJlZW4gbG9hZGVkLiBBIHBvc3NpYmxlIGNhdXNlIGlzIGEgY2hhbmdlIG9mIHNldHRpbmdzIGR1cmluZyBhIHBhcnRpYWwgdXBkYXRlLicsXHJcbidjYW50U2V0TmFtZUFmdGVySW5pdCc6J1RoZSBuYW1lIHByb3BlcnR5IGNhblxcJ3QgYmUgc2V0IG9uIHRoaXMgb2JqZWN0IGFmdGVyIGluaXRpYWxpemF0aW9uLicsXHJcbidoaXN0b3J5TWlzc2luZ0ZyYW1lJzonRm9yIHRoZSBoaXN0b3J5IGZlYXR1cmUgdG8gd29yayBpbiBJRSwgdGhlIHBhZ2UgbXVzdCBoYXZlIGFuIGlGcmFtZSBlbGVtZW50IHdpdGggaWQgXFwnX19oaXN0b3J5RnJhbWVcXCcgcG9pbnRlZCB0byBhIHBhZ2UgdGhhdCBnZXRzIGl0cyB0aXRsZSBmcm9tIHRoZSBcXCd0aXRsZVxcJyBxdWVyeSBzdHJpbmcgcGFyYW1ldGVyIGFuZCBjYWxscyBTeXMuQXBwbGljYXRpb24uX29uSUZyYW1lTG9hZCgpIG9uIHRoZSBwYXJlbnQgd2luZG93LiBUaGlzIGNhbiBiZSBkb25lIGJ5IHNldHRpbmcgRW5hYmxlSGlzdG9yeSB0byB0cnVlIG9uIFNjcmlwdE1hbmFnZXIuJyxcclxuJ2FwcER1cGxpY2F0ZUNvbXBvbmVudCc6J1R3byBjb21wb25lbnRzIHdpdGggdGhlIHNhbWUgaWQgXFwnezB9XFwnIGNhblxcJ3QgYmUgYWRkZWQgdG8gdGhlIGFwcGxpY2F0aW9uLicsXHJcbidoaXN0b3J5Q2Fubm90QWRkSGlzdG9yeVBvaW50V2l0aEhpc3RvcnlEaXNhYmxlZCc6J0EgaGlzdG9yeSBwb2ludCBjYW4gb25seSBiZSBhZGRlZCBpZiBlbmFibGVIaXN0b3J5IGlzIHNldCB0byB0cnVlLicsXHJcbidleHBlY3RlZEVsZW1lbnRPcklkJzonVmFsdWUgbXVzdCBiZSBhIERPTSBlbGVtZW50IG9yIERPTSBlbGVtZW50IGlkLicsXHJcbidzZWxlY3Rvck5vdEZvdW5kJzonQW4gZWxlbWVudCB3aXRoIHNlbGVjdG9yIFxcJ3swfVxcJyBjb3VsZCBub3QgYmUgZm91bmQuJyxcclxuJ2Nhbm5vdENhbGxPdXRzaWRlSGFuZGxlcic6J0Nhbm5vdCBjYWxsIHswfSBvdXRzaWRlIG9mIGEgY29tcGxldGVkIGV2ZW50IGhhbmRsZXIuJyxcclxuJ21ldGhvZE5vdEZvdW5kJzonTm8gbWV0aG9kIGZvdW5kIHdpdGggbmFtZSBcXCd7MH1cXCcuJyxcclxuJ2FycmF5UGFyc2VCYWRGb3JtYXQnOidWYWx1ZSBtdXN0IGJlIGEgdmFsaWQgc3RyaW5nIHJlcHJlc2VudGF0aW9uIGZvciBhbiBhcnJheS4gSXQgbXVzdCBzdGFydCB3aXRoIGEgXFwnW1xcJyBhbmQgZW5kIHdpdGggYSBcXCddXFwnLicsXHJcbidjYW5ub3RTZXJpYWxpemVPYmplY3RXaXRoQ3ljbGUnOidDYW5ub3Qgc2VyaWFsaXplIG9iamVjdCB3aXRoIGN5Y2xpYyByZWZlcmVuY2Ugd2l0aGluIGNoaWxkIHByb3BlcnRpZXMuJyxcclxuJ3N0YXRlRmllbGROYW1lSW52YWxpZCc6J1N0YXRlIGZpZWxkIG5hbWVzIG11c3Qgbm90IGNvbnRhaW4gYW55IFxcJz1cXCcgY2hhcmFjdGVycy4nLFxyXG4nc3RyaW5nRm9ybWF0QnJhY2VNaXNtYXRjaCc6J1RoZSBmb3JtYXQgc3RyaW5nIGNvbnRhaW5zIGFuIHVubWF0Y2hlZCBvcGVuaW5nIG9yIGNsb3NpbmcgYnJhY2UuJyxcclxuJ2VudW1WYWx1ZU5vdEludGVnZXInOidBbiBlbnVtZXJhdGlvbiBkZWZpbml0aW9uIGNhbiBvbmx5IGNvbnRhaW4gaW50ZWdlciB2YWx1ZXMuJyxcclxuJ3Byb3BlcnR5TnVsbE9yVW5kZWZpbmVkJzonQ2Fubm90IHNldCB0aGUgcHJvcGVydGllcyBvZiBcXCd7MH1cXCcgYmVjYXVzZSBpdCByZXR1cm5lZCBhIG51bGwgdmFsdWUuJyxcclxuJ2V4cGVjdGVkRG9tRWxlbWVudE9yU2VsZWN0b3InOidcXCd7MH1cXCcgbXVzdCBiZSBhIERPTSBlbGVtZW50IG9yIERPTSBlbGVtZW50IHNlbGVjdG9yLicsXHJcbidhcmd1bWVudERvbU5vZGUnOidWYWx1ZSBtdXN0IGJlIGEgRE9NIGVsZW1lbnQgb3IgYSB0ZXh0IG5vZGUuJyxcclxuJ2NvbXBvbmVudENhbnRTZXRJZFR3aWNlJzonVGhlIGlkIHByb3BlcnR5IG9mIGEgY29tcG9uZW50IGNhblxcJ3QgYmUgc2V0IG1vcmUgdGhhbiBvbmNlLicsXHJcbidjcmVhdGVDb21wb25lbnRPbkRvbSc6J1ZhbHVlIG11c3QgYmUgbnVsbCBmb3IgQ29tcG9uZW50cyB0aGF0IGFyZSBub3QgQ29udHJvbHMgb3IgQmVoYXZpb3JzLicsXHJcbidjcmVhdGVOb0RvbSc6J1ZhbHVlIG11c3Qgbm90IGJlIG51bGwgZm9yIENvbnRyb2xzIGFuZCBCZWhhdmlvcnMuJyxcclxuJ2NhbnRBZGRXaXRob3V0SWQnOidDYW5cXCd0IGFkZCBhIGNvbXBvbmVudCB0aGF0IGRvZXNuXFwndCBoYXZlIGFuIGlkLicsXHJcbid1cmxUb29Mb25nJzonVGhlIGhpc3Rvcnkgc3RhdGUgbXVzdCBiZSBzbWFsbCBlbm91Z2ggdG8gbm90IG1ha2UgdGhlIHVybCBsYXJnZXIgdGhhbiB7MH0gY2hhcmFjdGVycy4nLFxyXG4nbm90T2JzZXJ2YWJsZSc6J0luc3RhbmNlcyBvZiB0eXBlIFxcJ3swfVxcJyBjYW5ub3QgYmUgb2JzZXJ2ZWQuJyxcclxuJ2JhZFR5cGVOYW1lJzonVmFsdWUgaXMgbm90IHRoZSBuYW1lIG9mIHRoZSB0eXBlIGJlaW5nIHJlZ2lzdGVyZWQgb3IgdGhlIG5hbWUgaXMgYSByZXNlcnZlZCB3b3JkLicsXHJcbidhcmd1bWVudEludGVnZXInOidWYWx1ZSBtdXN0IGJlIGFuIGludGVnZXIuJyxcclxuJ2FyZ3VtZW50VHlwZSc6J09iamVjdCBjYW5ub3QgYmUgY29udmVydGVkIHRvIHRoZSByZXF1aXJlZCB0eXBlLicsXHJcbidhcmd1bWVudE51bGwnOidWYWx1ZSBjYW5ub3QgYmUgbnVsbC4nLFxyXG4nc2NyaXB0QWxyZWFkeUxvYWRlZCc6J1RoZSBzY3JpcHQgXFwnezB9XFwnIGhhcyBiZWVuIHJlZmVyZW5jZWQgbXVsdGlwbGUgdGltZXMuIElmIHJlZmVyZW5jaW5nIE1pY3Jvc29mdCBBSkFYIHNjcmlwdHMgZXhwbGljaXRseSwgc2V0IHRoZSBNaWNyb3NvZnRBamF4TW9kZSBwcm9wZXJ0eSBvZiB0aGUgU2NyaXB0TWFuYWdlciB0byBFeHBsaWNpdC4nLFxyXG4nc2NyaXB0RGVwZW5kZW5jeU5vdEZvdW5kJzonVGhlIHNjcmlwdCBcXCd7MH1cXCcgZmFpbGVkIHRvIGxvYWQgYmVjYXVzZSBpdCBpcyBkZXBlbmRlbnQgb24gc2NyaXB0IFxcJ3sxfVxcJy4nLFxyXG4nZm9ybWF0QmFkRm9ybWF0U3BlY2lmaWVyJzonRm9ybWF0IHNwZWNpZmllciB3YXMgaW52YWxpZC4nLFxyXG4ncmVxdWlyZWRTY3JpcHRSZWZlcmVuY2VOb3RJbmNsdWRlZCc6J1xcJ3swfVxcJyByZXF1aXJlcyB0aGF0IHlvdSBoYXZlIGluY2x1ZGVkIGEgc2NyaXB0IHJlZmVyZW5jZSB0byBcXCd7MX1cXCcuJyxcclxuJ3dlYlNlcnZpY2VGYWlsZWROb01zZyc6J1RoZSBzZXJ2ZXIgbWV0aG9kIFxcJ3swfVxcJyBmYWlsZWQuJyxcclxuJ2FyZ3VtZW50RG9tRWxlbWVudCc6J1ZhbHVlIG11c3QgYmUgYSBET00gZWxlbWVudC4nLFxyXG4nYWN0dWFsVmFsdWUnOidBY3R1YWwgdmFsdWUgd2FzIHswfS4nLFxyXG4nZW51bUludmFsaWRWYWx1ZSc6J1xcJ3swfVxcJyBpcyBub3QgYSB2YWxpZCB2YWx1ZSBmb3IgZW51bSB7MX0uJyxcclxuJ3NjcmlwdExvYWRGYWlsZWQnOidUaGUgc2NyaXB0IFxcJ3swfVxcJyBjb3VsZCBub3QgYmUgbG9hZGVkLicsXHJcbidwYXJhbWV0ZXJDb3VudCc6J1BhcmFtZXRlciBjb3VudCBtaXNtYXRjaC4nLFxyXG4nY2Fubm90RGVzZXJpYWxpemVFbXB0eVN0cmluZyc6J0Nhbm5vdCBkZXNlcmlhbGl6ZSBlbXB0eSBzdHJpbmcuJyxcclxuJ2Zvcm1hdEludmFsaWRTdHJpbmcnOidJbnB1dCBzdHJpbmcgd2FzIG5vdCBpbiBhIGNvcnJlY3QgZm9ybWF0LicsXHJcbidhcmd1bWVudCc6J1ZhbHVlIGRvZXMgbm90IGZhbGwgd2l0aGluIHRoZSBleHBlY3RlZCByYW5nZS4nLFxyXG4nY2Fubm90RGVzZXJpYWxpemVJbnZhbGlkSnNvbic6J0Nhbm5vdCBkZXNlcmlhbGl6ZS4gVGhlIGRhdGEgZG9lcyBub3QgY29ycmVzcG9uZCB0byB2YWxpZCBKU09OLicsXHJcbidjYW5ub3RTZXJpYWxpemVOb25GaW5pdGVOdW1iZXJzJzonQ2Fubm90IHNlcmlhbGl6ZSBub24gZmluaXRlIG51bWJlcnMuJyxcclxuJ2FyZ3VtZW50VW5kZWZpbmVkJzonVmFsdWUgY2Fubm90IGJlIHVuZGVmaW5lZC4nLFxyXG4nd2ViU2VydmljZUludmFsaWRSZXR1cm5UeXBlJzonVGhlIHNlcnZlciBtZXRob2QgXFwnezB9XFwnIHJldHVybmVkIGFuIGludmFsaWQgdHlwZS4gRXhwZWN0ZWQgdHlwZTogezF9JyxcclxuJ3NlcnZpY2VQYXRoTm90U2V0JzonVGhlIHBhdGggdG8gdGhlIHdlYiBzZXJ2aWNlIGhhcyBub3QgYmVlbiBzZXQuJyxcclxuJ2FyZ3VtZW50VHlwZVdpdGhUeXBlcyc6J09iamVjdCBvZiB0eXBlIFxcJ3swfVxcJyBjYW5ub3QgYmUgY29udmVydGVkIHRvIHR5cGUgXFwnezF9XFwnLicsXHJcbidwYXJhbU5hbWUnOidQYXJhbWV0ZXIgbmFtZTogezB9JyxcclxuJ251bGxSZWZlcmVuY2VJblBhdGgnOidOdWxsIHJlZmVyZW5jZSB3aGlsZSBldmFsdWF0aW5nIGRhdGEgcGF0aDogXFwnezB9XFwnLicsXHJcbidmb3JtYXQnOidPbmUgb2YgdGhlIGlkZW50aWZpZWQgaXRlbXMgd2FzIGluIGFuIGludmFsaWQgZm9ybWF0LicsXHJcbidhc3NlcnRGYWlsZWRDYWxsZXInOidBc3NlcnRpb24gRmFpbGVkOiB7MH1cXHJcXG5hdCB7MX0nLFxyXG4nYXJndW1lbnRPdXRPZlJhbmdlJzonU3BlY2lmaWVkIGFyZ3VtZW50IHdhcyBvdXQgb2YgdGhlIHJhbmdlIG9mIHZhbGlkIHZhbHVlcy4nLFxyXG4nd2ViU2VydmljZVRpbWVkT3V0JzonVGhlIHNlcnZlciBtZXRob2QgXFwnezB9XFwnIHRpbWVkIG91dC4nLFxyXG4nbm90SW1wbGVtZW50ZWQnOidUaGUgbWV0aG9kIG9yIG9wZXJhdGlvbiBpcyBub3QgaW1wbGVtZW50ZWQuJyxcclxuJ2Fzc2VydEZhaWxlZCc6J0Fzc2VydGlvbiBGYWlsZWQ6IHswfScsXHJcbidpbnZhbGlkT3BlcmF0aW9uJzonT3BlcmF0aW9uIGlzIG5vdCB2YWxpZCBkdWUgdG8gdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIG9iamVjdC4nLFxyXG4nYnJlYWtJbnRvRGVidWdnZXInOid7MH1cXHJcXG5cXHJcXG5CcmVhayBpbnRvIGRlYnVnZ2VyPydcclxufTtcclxuIiwiLy8gTmFtZTogICAgICAgIE1pY3Jvc29mdEFqYXhUZW1wbGF0ZXMuZGVidWcuanNcclxuLy8gQXNzZW1ibHk6ICAgIFN5c3RlbS5XZWIuQWpheFxyXG4vLyBWZXJzaW9uOiAgICAgMy4wLjMxMTA2LjBcclxuLy8gRmlsZVZlcnNpb246IDMuMC4zMTEwNi4wXHJcbi8vLyA8cmVmZXJlbmNlIG5hbWU9XCJNaWNyb3NvZnRBamF4Q29tcG9uZW50TW9kZWwuanNcIiAvPlxyXG4vLy8gPHJlZmVyZW5jZSBuYW1lPVwiTWljcm9zb2Z0QWpheFNlcmlhbGl6YXRpb24uanNcIiAvPlxyXG5cclxuXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG5cclxuXHRmdW5jdGlvbiBleGVjdXRlKCkge1xyXG5cdFx0VHlwZS5fcmVnaXN0ZXJTY3JpcHQoXCJNaWNyb3NvZnRBamF4VGVtcGxhdGVzLmpzXCIsIFtcIk1pY3Jvc29mdEFqYXhDb21wb25lbnRNb2RlbC5qc1wiLCBcIk1pY3Jvc29mdEFqYXhTZXJpYWxpemF0aW9uLmpzXCJdKTtcclxuXHJcblx0XHR2YXIgbWVyZ2UgPSBTeXMuX21lcmdlLFxyXG5cdFx0XHRmb3JlYWNoID0gU3lzLl9mb3JlYWNoLFxyXG5cdFx0XHRmb3JJbiA9IFN5cy5fZm9ySW4sXHJcblx0XHRcdGluZGV4T2YgPSBTeXMuX2luZGV4T2YsXHJcblx0XHRcdGlzQnJvd3NlciA9IFN5cy5faXNCcm93c2VyO1xyXG5cclxuXHRcdGZ1bmN0aW9uIHNlcmlhbGl6ZShvYmopIHtcclxuXHRcdFx0cmV0dXJuIFN5cy5TZXJpYWxpemF0aW9uLkphdmFTY3JpcHRTZXJpYWxpemVyLnNlcmlhbGl6ZShvYmopO1xyXG5cdFx0fVxyXG5cclxuXHRcdFR5cGUucmVnaXN0ZXJOYW1lc3BhY2UoXCJTeXMuTmV0XCIpO1xyXG5cclxuXHRcdFN5cy5OZXQuV2ViUmVxdWVzdEV2ZW50QXJncyA9IGZ1bmN0aW9uIFN5cyROZXQkV2ViUmVxdWVzdEV2ZW50QXJncyhleGVjdXRvciwgZXJyb3IsIHJlc3VsdCkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLk5ldC5XZWJSZXF1ZXN0RXZlbnRBcmdzLiNjdG9yXCIgLz5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwiZXhlY3V0b3JcIiB0eXBlPVwiU3lzLk5ldC5XZWJSZXF1ZXN0RXhlY3V0b3JcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwiZXJyb3JcIiB0eXBlPVwiU3lzLk5ldC5XZWJTZXJ2aWNlRXJyb3JcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwicmVzdWx0XCIgb3B0aW9uYWw9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0XHRcdHRoaXMuX2V4ZWN1dG9yID0gZXhlY3V0b3I7XHJcblx0XHRcdHRoaXMuX2Vycm9yID0gZXJyb3IgfHwgbnVsbDtcclxuXHRcdFx0dGhpcy5fcmVzdWx0ID0gdHlwZW9mIChyZXN1bHQpID09PSBcInVuZGVmaW5lZFwiID8gbnVsbCA6IHJlc3VsdDtcclxuXHRcdFx0U3lzLk5ldC5XZWJSZXF1ZXN0RXZlbnRBcmdzLmluaXRpYWxpemVCYXNlKHRoaXMpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIFN5cyROZXQkV2ViUmVxdWVzdEV2ZW50QXJncyRnZXRfZXJyb3IoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgdHlwZT1cIlN5cy5OZXQuV2ViU2VydmljZUVycm9yXCIgbWF5QmVOdWxsPVwidHJ1ZVwiIGxvY2lkPVwiUDpKI1N5cy5OZXQuV2ViUmVxdWVzdEV2ZW50QXJncy5lcnJvclwiPjwvdmFsdWU+XHJcblx0XHRcdHJldHVybiB0aGlzLl9lcnJvciB8fCBudWxsO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJSZXF1ZXN0RXZlbnRBcmdzJGdldF9leGVjdXRvcigpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiU3lzLk5ldC5XZWJSZXF1ZXN0RXhlY3V0b3JcIiBtYXlCZU51bGw9XCJ0cnVlXCIgbG9jaWQ9XCJQOkojU3lzLk5ldC5XZWJSZXF1ZXN0RXZlbnRBcmdzLmV4ZWN1dG9yXCI+PC92YWx1ZT5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX2V4ZWN1dG9yO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJE5ldCRXZWJSZXF1ZXN0RXZlbnRBcmdzJGdldF9yZXN1bHQoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgbWF5QmVOdWxsPVwidHJ1ZVwiIGxvY2lkPVwiUDpKI1N5cy5OZXQuV2ViUmVxdWVzdEV2ZW50QXJncy5yZXN1bHRcIj48L3ZhbHVlPlxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVzdWx0O1xyXG5cdFx0fVxyXG5cdFx0U3lzLk5ldC5XZWJSZXF1ZXN0RXZlbnRBcmdzLnByb3RvdHlwZSA9IHtcclxuXHRcdFx0Z2V0X2Vycm9yOiBTeXMkTmV0JFdlYlJlcXVlc3RFdmVudEFyZ3MkZ2V0X2Vycm9yLFxyXG5cdFx0XHRnZXRfZXhlY3V0b3I6IFN5cyROZXQkV2ViUmVxdWVzdEV2ZW50QXJncyRnZXRfZXhlY3V0b3IsXHJcblx0XHRcdGdldF9yZXN1bHQ6IFN5cyROZXQkV2ViUmVxdWVzdEV2ZW50QXJncyRnZXRfcmVzdWx0XHJcblx0XHR9O1xyXG5cdFx0U3lzLk5ldC5XZWJSZXF1ZXN0RXZlbnRBcmdzLnJlZ2lzdGVyQ2xhc3MoXCJTeXMuTmV0LldlYlJlcXVlc3RFdmVudEFyZ3NcIiwgU3lzLkV2ZW50QXJncyk7XHJcblxyXG5cdFx0VHlwZS5yZWdpc3Rlck5hbWVzcGFjZShcIlN5cy5EYXRhXCIpO1xyXG5cclxuXHRcdFN5cy5EYXRhLkRhdGFFdmVudEFyZ3MgPSBmdW5jdGlvbiBTeXMkRGF0YSREYXRhRXZlbnRBcmdzKGRhdGEpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5EYXRhLkRhdGFFdmVudEFyZ3MuI2N0b3JcIiAvPlxyXG5cdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJkYXRhXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0XHRcdHRoaXMuX2RhdGEgPSBkYXRhO1xyXG5cdFx0XHRTeXMuRGF0YS5EYXRhRXZlbnRBcmdzLmluaXRpYWxpemVCYXNlKHRoaXMpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIFN5cyREYXRhJERhdGFFdmVudEFyZ3MkZ2V0X2RhdGEoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgbWF5QmVOdWxsPVwidHJ1ZVwiIGxvY2lkPVwiUDpKI1N5cy5EYXRhLkRhdGFFdmVudEFyZ3MuZGF0YVwiPjwvdmFsdWU+XHJcblx0XHRcdHZhciBkID0gdGhpcy5fZGF0YTtcclxuXHRcdFx0cmV0dXJuICh0eXBlb2YgKGQpID09PSBcInVuZGVmaW5lZFwiID8gbnVsbCA6IGQpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJERhdGEkRGF0YUV2ZW50QXJncyRzZXRfZGF0YSh2YWx1ZSkge1xyXG5cdFx0XHR0aGlzLl9kYXRhID0gdmFsdWU7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkRGF0YSREYXRhRXZlbnRBcmdzJGdldF9pdGVtUGxhY2Vob2xkZXIoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgbWF5QmVOdWxsPVwidHJ1ZVwiIGxvY2lkPVwiUDpKI1N5cy5EYXRhLkRhdGFFdmVudEFyZ3MuaXRlbVBsYWNlaG9sZGVyXCI+PC92YWx1ZT5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX3BsYWNlaG9sZGVyIHx8IG51bGw7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkRGF0YSREYXRhRXZlbnRBcmdzJHNldF9pdGVtUGxhY2Vob2xkZXIodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fcGxhY2Vob2xkZXIgPSB2YWx1ZTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyREYXRhJERhdGFFdmVudEFyZ3MkZ2V0X2l0ZW1UZW1wbGF0ZSgpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSBtYXlCZU51bGw9XCJ0cnVlXCIgbG9jaWQ9XCJQOkojU3lzLkRhdGEuRGF0YUV2ZW50QXJncy5pdGVtVGVtcGxhdGVcIj48L3ZhbHVlPlxyXG5cdFx0XHRyZXR1cm4gdGhpcy5faXRlbVRlbXBsYXRlIHx8IG51bGw7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkRGF0YSREYXRhRXZlbnRBcmdzJHNldF9pdGVtVGVtcGxhdGUodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5faXRlbVRlbXBsYXRlID0gdmFsdWU7XHJcblx0XHR9XHJcblx0XHRTeXMuRGF0YS5EYXRhRXZlbnRBcmdzLnByb3RvdHlwZSA9IHtcclxuXHRcdFx0Z2V0X2RhdGE6IFN5cyREYXRhJERhdGFFdmVudEFyZ3MkZ2V0X2RhdGEsXHJcblx0XHRcdHNldF9kYXRhOiBTeXMkRGF0YSREYXRhRXZlbnRBcmdzJHNldF9kYXRhLFxyXG5cdFx0XHRnZXRfaXRlbVBsYWNlaG9sZGVyOiBTeXMkRGF0YSREYXRhRXZlbnRBcmdzJGdldF9pdGVtUGxhY2Vob2xkZXIsXHJcblx0XHRcdHNldF9pdGVtUGxhY2Vob2xkZXI6IFN5cyREYXRhJERhdGFFdmVudEFyZ3Mkc2V0X2l0ZW1QbGFjZWhvbGRlcixcclxuXHRcdFx0Z2V0X2l0ZW1UZW1wbGF0ZTogU3lzJERhdGEkRGF0YUV2ZW50QXJncyRnZXRfaXRlbVRlbXBsYXRlLFxyXG5cdFx0XHRzZXRfaXRlbVRlbXBsYXRlOiBTeXMkRGF0YSREYXRhRXZlbnRBcmdzJHNldF9pdGVtVGVtcGxhdGVcclxuXHRcdH07XHJcblx0XHRTeXMuRGF0YS5EYXRhRXZlbnRBcmdzLnJlZ2lzdGVyQ2xhc3MoXCJTeXMuRGF0YS5EYXRhRXZlbnRBcmdzXCIsIFN5cy5DYW5jZWxFdmVudEFyZ3MpO1xyXG5cclxuXHRcdGlmICghU3lzLkRhdGEuSURhdGFQcm92aWRlcikge1xyXG5cdFx0XHRTeXMuRGF0YS5JRGF0YVByb3ZpZGVyID0gZnVuY3Rpb24gU3lzJERhdGEkSURhdGFQcm92aWRlcigpIHtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0ZnVuY3Rpb24gU3lzJERhdGEkSURhdGFQcm92aWRlciRmZXRjaERhdGEob3BlcmF0aW9uLCBwYXJhbWV0ZXJzLCBtZXJnZU9wdGlvbiwgaHR0cFZlcmIsIHN1Y2NlZWRlZENhbGxiYWNrLCBmYWlsZWRDYWxsYmFjaywgdGltZW91dCwgdXNlckNvbnRleHQpIHtcclxuXHRcdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLkRhdGEuSURhdGFQcm92aWRlci5mZXRjaERhdGFcIiAvPlxyXG5cdFx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cIm9wZXJhdGlvblwiPjwvcGFyYW0+XHJcblx0XHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwicGFyYW1ldGVyc1wiIHR5cGU9XCJPYmplY3RcIiBtYXlCZU51bGw9XCJ0cnVlXCIgb3B0aW9uYWw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJtZXJnZU9wdGlvblwiIHR5cGU9XCJTeXMuRGF0YS5NZXJnZU9wdGlvblwiIG1heUJlTnVsbD1cInRydWVcIiBvcHRpb25hbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdFx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cImh0dHBWZXJiXCIgdHlwZT1cIlN0cmluZ1wiIG1heUJlTnVsbD1cInRydWVcIiBvcHRpb25hbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdFx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cInN1Y2NlZWRlZENhbGxiYWNrXCIgdHlwZT1cIkZ1bmN0aW9uXCIgbWF5QmVOdWxsPVwidHJ1ZVwiIG9wdGlvbmFsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0XHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwiZmFpbGVkQ2FsbGJhY2tcIiB0eXBlPVwiRnVuY3Rpb25cIiBtYXlCZU51bGw9XCJ0cnVlXCIgb3B0aW9uYWw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJ0aW1lb3V0XCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiIG9wdGlvbmFsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0XHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwidXNlckNvbnRleHRcIiBtYXlCZU51bGw9XCJ0cnVlXCIgb3B0aW9uYWw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdFx0XHQvLy8gPHJldHVybnMgdHlwZT1cIlN5cy5OZXQuV2ViUmVxdWVzdFwiPjwvcmV0dXJucz5cclxuXHRcdFx0XHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdFN5cy5EYXRhLklEYXRhUHJvdmlkZXIucHJvdG90eXBlID0ge1xyXG5cdFx0XHRcdGZldGNoRGF0YTogU3lzJERhdGEkSURhdGFQcm92aWRlciRmZXRjaERhdGFcclxuXHRcdFx0fVxyXG5cdFx0XHRTeXMuRGF0YS5JRGF0YVByb3ZpZGVyLnJlZ2lzdGVySW50ZXJmYWNlKFwiU3lzLkRhdGEuSURhdGFQcm92aWRlclwiKTtcclxuXHRcdH1cclxuXHRcdGlmICghU3lzLkRhdGEuTWVyZ2VPcHRpb24pIHtcclxuXHRcdFx0U3lzLkRhdGEuTWVyZ2VPcHRpb24gPSBmdW5jdGlvbiBTeXMkRGF0YSRNZXJnZU9wdGlvbigpIHtcclxuXHRcdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLkRhdGEuTWVyZ2VPcHRpb24uI2N0b3JcIiAvPlxyXG5cdFx0XHRcdC8vLyA8ZmllbGQgbmFtZT1cImFwcGVuZE9ubHlcIiB0eXBlPVwiTnVtYmVyXCIgaW50ZWdlcj1cInRydWVcIiBzdGF0aWM9XCJ0cnVlXCIgbG9jaWQ9XCJGOkojU3lzLkRhdGEuTWVyZ2VPcHRpb24uYXBwZW5kT25seVwiPjwvZmllbGQ+XHJcblx0XHRcdFx0Ly8vIDxmaWVsZCBuYW1lPVwib3ZlcndyaXRlQ2hhbmdlc1wiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiIHN0YXRpYz1cInRydWVcIiBsb2NpZD1cIkY6SiNTeXMuRGF0YS5NZXJnZU9wdGlvbi5vdmVyd3JpdGVDaGFuZ2VzXCI+PC9maWVsZD5cclxuXHRcdFx0XHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG5cdFx0XHR9XHJcblxyXG5cclxuXHJcblxyXG5cdFx0XHRTeXMuRGF0YS5NZXJnZU9wdGlvbi5wcm90b3R5cGUgPSB7XHJcblx0XHRcdFx0YXBwZW5kT25seTogMCxcclxuXHRcdFx0XHRvdmVyd3JpdGVDaGFuZ2VzOiAxXHJcblx0XHRcdH1cclxuXHRcdFx0U3lzLkRhdGEuTWVyZ2VPcHRpb24ucmVnaXN0ZXJFbnVtKFwiU3lzLkRhdGEuTWVyZ2VPcHRpb25cIik7XHJcblxyXG5cdFx0fVxyXG5cclxuXHRcdFR5cGUucmVnaXN0ZXJOYW1lc3BhY2UoXCJTeXMuVUlcIik7XHJcblxyXG5cdFx0U3lzLkFwcGxpY2F0aW9uLnJlZ2lzdGVyTWFya3VwRXh0ZW5zaW9uID0gZnVuY3Rpb24gU3lzJEFwcGxpY2F0aW9uJHJlZ2lzdGVyTWFya3VwRXh0ZW5zaW9uKGV4dGVuc2lvbk5hbWUsIGV4dGVuc2lvbiwgaXNFeHByZXNzaW9uKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuQXBwbGljYXRpb24ucmVnaXN0ZXJNYXJrdXBFeHRlbnNpb25cIiAvPlxyXG5cdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJleHRlbnNpb25OYW1lXCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cImV4dGVuc2lvblwiIHR5cGU9XCJGdW5jdGlvblwiPjwvcGFyYW0+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cImlzRXhwcmVzc2lvblwiIHR5cGU9XCJCb29sZWFuXCIgb3B0aW9uYWw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdFx0aWYgKCF0aGlzLl9leHRlbnNpb25zKSB7XHJcblx0XHRcdFx0dGhpcy5fZXh0ZW5zaW9ucyA9IHt9O1xyXG5cdFx0XHR9XHJcblx0XHRcdGlzRXhwcmVzc2lvbiA9ICgodHlwZW9mIChpc0V4cHJlc3Npb24pID09PSBcInVuZGVmaW5lZFwiKSB8fCAoaXNFeHByZXNzaW9uID09PSB0cnVlKSk7XHJcblx0XHRcdHRoaXMuX2V4dGVuc2lvbnNbZXh0ZW5zaW9uTmFtZV0gPSB7IGV4cHJlc3Npb246IGlzRXhwcmVzc2lvbiwgZXh0ZW5zaW9uOiBleHRlbnNpb24gfTtcclxuXHRcdH1cclxuXHRcdFN5cy5BcHBsaWNhdGlvbi5fZ2V0TWFya3VwRXh0ZW5zaW9uID0gZnVuY3Rpb24gU3lzJEFwcGxpY2F0aW9uJF9nZXRNYXJrdXBFeHRlbnNpb24obmFtZSkge1xyXG5cdFx0XHR2YXIgZXh0ZW5zaW9uID0gdGhpcy5fZXh0ZW5zaW9ucyA/IHRoaXMuX2V4dGVuc2lvbnNbbmFtZV0gOiBudWxsO1xyXG5cdFx0XHRpZiAoIWV4dGVuc2lvbikge1xyXG5cdFx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuVUkuVGVtcGxhdGVzUmVzLmNhbm5vdEZpbmRNYXJrdXBFeHRlbnNpb24sIG5hbWUpKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gZXh0ZW5zaW9uO1xyXG5cdFx0fVxyXG5cdFx0U3lzLlVJLlRlbXBsYXRlID0gZnVuY3Rpb24gU3lzJFVJJFRlbXBsYXRlKGVsZW1lbnQpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5UZW1wbGF0ZS4jY3RvclwiIC8+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cImVsZW1lbnRcIiBkb21FbGVtZW50PVwidHJ1ZVwiIG1heUJlTnVsbD1cImZhbHNlXCI+PC9wYXJhbT5cclxuXHRcdFx0dGhpcy5fZWxlbWVudCA9IGVsZW1lbnQ7XHJcblx0XHRcdHRoaXMuX2luc3RhbnRpYXRlSW4gPSBudWxsO1xyXG5cdFx0XHR0aGlzLl9pbnN0YW5jZUlkID0gMDtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkVGVtcGxhdGUkZ2V0X2VsZW1lbnQoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgZG9tRWxlbWVudD1cInRydWVcIiBsb2NpZD1cIlA6SiNTeXMuVUkuVGVtcGxhdGUuZWxlbWVudFwiPjwvdmFsdWU+XHJcblx0XHRcdHJldHVybiB0aGlzLl9lbGVtZW50O1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJFRlbXBsYXRlJGRpc3Bvc2UoKSB7XHJcblx0XHRcdHRoaXMuX2VsZW1lbnQgPSBudWxsO1xyXG5cdFx0XHR0aGlzLl9pbnN0YW50aWF0ZUluID0gbnVsbDtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSRUZW1wbGF0ZSRfYXBwZW5kVGV4dE5vZGUoY29kZSwgc3RvcmVFbGVtZW50Q29kZSwgdGV4dCkge1xyXG5cdFx0XHRjb2RlLnB1c2goc3RvcmVFbGVtZW50Q29kZSwgXCJkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShcIiwgc2VyaWFsaXplKHRleHQpLCBcIikpO1xcblwiKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSRUZW1wbGF0ZSRfYXBwZW5kQXR0cmlidXRlU2V0dGVyKGNvZGUsIHR5cGVJbmRleCwgYXR0cmliLCBleHByZXNzaW9uLCBpc0V4cHJlc3Npb24sIGJvb2xlYW5WYWx1ZSkge1xyXG5cdFx0XHR2YXIgbnMgPSBhdHRyaWIubnMsIG5hbWUgPSBhdHRyaWIubmFtZSwgcmVzdHJpY3RlZCA9ICghbnMgJiYgU3lzLlVJLlRlbXBsYXRlLl9pc1Jlc3RyaWN0ZWQobmFtZSkpO1xyXG5cdFx0XHRpZiAocmVzdHJpY3RlZCkge1xyXG5cdFx0XHRcdGV4cHJlc3Npb24gPSBcIlN5cy5VSS5UZW1wbGF0ZS5fY2hlY2tBdHRyaWJ1dGUoJ1wiICsgbmFtZSArIFwiJywgXCIgKyBleHByZXNzaW9uICsgXCIpXCI7XHJcblx0XHRcdH1cclxuXHRcdFx0c3dpdGNoIChhdHRyaWIudHlwZSkge1xyXG5cdFx0XHRcdGNhc2UgMTpcclxuXHRcdFx0XHRcdGNvZGUucHVzaChcIiAgJGNvbXBvbmVudCA9ICRlbGVtZW50O1xcbiAgXCIpO1xyXG5cdFx0XHRcdFx0aWYgKGlzRXhwcmVzc2lvbikge1xyXG5cdFx0XHRcdFx0XHRpZiAoYXR0cmliLnRleHROb2RlKSB7XHJcblx0XHRcdFx0XHRcdFx0Y29kZS5wdXNoKFwiY29udGFpbmVyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKFwiLCBleHByZXNzaW9uLCBcIikpO1xcblwiKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRjb2RlLnB1c2goXCIkZWxlbWVudC5cIiwgbmFtZSwgXCIgPSBcIiwgZXhwcmVzc2lvbiwgXCI7XFxuXCIpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0Y29kZS5wdXNoKGV4cHJlc3Npb24sIFwiO1xcblwiKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGlmIChhdHRyaWIudGV4dE5vZGUgfHwgbmFtZSA9PT0gXCJpbm5lckhUTUxcIikgcmV0dXJuIHRydWU7XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRjYXNlIDI6XHJcblx0XHRcdFx0XHRpZiAoaXNFeHByZXNzaW9uKSB7XHJcblx0XHRcdFx0XHRcdG5hbWUgPSBzZXJpYWxpemUobmFtZSk7XHJcblx0XHRcdFx0XHRcdGNvZGUucHVzaChcIiAgJGNvbXBvbmVudCA9ICRlbGVtZW50O1xcbiAgICAoXCIsIGV4cHJlc3Npb24sXHJcblx0XHRcdFx0XHRcdFx0XHRcIikgPyBTeXMuVUkuRG9tRWxlbWVudC5hZGRDc3NDbGFzcygkZWxlbWVudCwgXCIsIG5hbWUsXHJcblx0XHRcdFx0XHRcdFx0XHRcIikgOiBTeXMuVUkuRG9tRWxlbWVudC5yZW1vdmVDc3NDbGFzcygkZWxlbWVudCwgXCIsIG5hbWUsIFwiKTtcXG5cIik7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0Y29kZS5wdXNoKFwiICAkY29tcG9uZW50ID0gJGVsZW1lbnQ7XFxuICBcIiwgZXhwcmVzc2lvbiwgXCI7XFxuXCIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0Y2FzZSAzOlxyXG5cdFx0XHRcdFx0dmFyIGluZGV4ID0gdHlwZUluZGV4W25zXTtcclxuXHRcdFx0XHRcdGlmIChpbmRleC5pc0NsYXNzKSB7XHJcblx0XHRcdFx0XHRcdGNvZGUucHVzaChcIiAgJGNvbXBvbmVudCA9IF9fY29tcG9uZW50SW5kZXhbJ1wiLCBucywgXCInXTtcXG5cIik7XHJcblx0XHRcdFx0XHRcdGlmIChpc0V4cHJlc3Npb24pIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgbWFwID0gYXR0cmliLm1hcDtcclxuXHRcdFx0XHRcdFx0XHRpZiAobWFwLnR5cGUgPT09IDEpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGNvZGUucHVzaChcIiAgJGNvbXBvbmVudC5cIiwgbWFwLnNldHRlck5hbWUsIFwiKFwiLCBleHByZXNzaW9uLCBcIik7XFxuXCIpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRlbHNlIGlmIChtYXAudHlwZSA9PT0gMikge1xyXG5cdFx0XHRcdFx0XHRcdFx0Y29kZS5wdXNoKFwiICBfX2YgPSBcIiwgZXhwcmVzc2lvbiwgXCI7XFxuXCIsXHJcblx0XHRcdFx0XHRcdFx0XHRcdCAgXCIgICRjb21wb25lbnQuXCIsIG1hcC5zZXR0ZXJOYW1lLCAnKHR5cGVvZihfX2YpID09PSBcImZ1bmN0aW9uXCIgPyBfX2YgOiBuZXcgRnVuY3Rpb24oXCJzZW5kZXJcIiwgXCJhcmdzXCIsIF9fZikpO1xcbicpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdGNvZGUucHVzaChcIiAgJGNvbXBvbmVudFsnXCIsIG1hcC5uYW1lLCBcIiddID0gXCIsIGV4cHJlc3Npb24sIFwiO1xcblwiKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0Y29kZS5wdXNoKFwiICBcIiwgZXhwcmVzc2lvbiwgXCI7XFxuXCIpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0aWYgKCFpc0V4cHJlc3Npb24pIHtcclxuXHRcdFx0XHRcdFx0XHR0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0dmFyIHByb3AgPSBzZXJpYWxpemUoYXR0cmliLm5hbWUpICsgXCI6IFwiICsgZXhwcmVzc2lvbjtcclxuXHRcdFx0XHRcdFx0aWYgKCFpbmRleC5wcm9wcykge1xyXG5cdFx0XHRcdFx0XHRcdGluZGV4LnByb3BzID0gcHJvcDtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRpbmRleC5wcm9wcyArPSBcIiwgXCIgKyBwcm9wO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRjYXNlIDQ6XHJcblx0XHRcdFx0XHR0aGlzW1wiX1wiICsgbmFtZV0gPSBleHByZXNzaW9uO1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0ZGVmYXVsdDpcclxuXHRcdFx0XHRcdGlmIChpc0V4cHJlc3Npb24pIHtcclxuXHRcdFx0XHRcdFx0aWYgKC9eb24vaS50ZXN0KG5hbWUpKSB7XHJcblx0XHRcdFx0XHRcdFx0Y29kZS5wdXNoKFwiICAkY29tcG9uZW50ID0gJGVsZW1lbnQ7XFxuICAkZWxlbWVudC5cIiArIG5hbWUgKyBcIiA9IG5ldyBGdW5jdGlvbihcIiArXHJcblx0XHRcdFx0XHRcdFx0KGRvY3VtZW50LmF0dGFjaEV2ZW50ID8gXCJcIiA6IFwiJ2V2ZW50JywgXCIpICsgZXhwcmVzc2lvbiArIFwiKTtcXG5cIik7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0aWYgKGJvb2xlYW5WYWx1ZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0Y29kZS5wdXNoKFwiICAkY29tcG9uZW50ID0gJGVsZW1lbnQ7XFxuICBpZiAoXCIgKyBleHByZXNzaW9uICtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcIikge1xcbiAgICBfX2UgPSBkb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUoJ1wiICsgbmFtZSArXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XCInKTtcXG4gICAgX19lLm5vZGVWYWx1ZSA9IFxcXCJcIiArIGJvb2xlYW5WYWx1ZSArIFwiXFxcIjtcXG4gICAgJGVsZW1lbnQuc2V0QXR0cmlidXRlTm9kZShfX2UpO1xcbiAgfVxcblwiKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0XHRjb2RlLnB1c2goXCIgICRjb21wb25lbnQgPSAkZWxlbWVudDtcXG4gIF9fZSA9IGRvY3VtZW50LmNyZWF0ZUF0dHJpYnV0ZSgnXCIgKyBuYW1lICsgXCInKTtcXG4gIF9fZS5ub2RlVmFsdWUgPSBcIiArXHJcblx0XHRcdFx0XHRcdFx0XHRcdGV4cHJlc3Npb24gKyBcIjtcXG4gICRlbGVtZW50LnNldEF0dHJpYnV0ZU5vZGUoX19lKTtcXG5cIik7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0Y29kZS5wdXNoKFwiICAkY29tcG9uZW50ID0gJGVsZW1lbnQ7XFxuICBcIiArIGV4cHJlc3Npb24gKyBcIjtcXG5cIik7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkVGVtcGxhdGUkX3Byb2Nlc3NBdHRyaWJ1dGUoY29kZSwgdHlwZUluZGV4LCBhdHRyaWIsIHZhbHVlLCBib29sZWFuVmFsdWUpIHtcclxuXHRcdFx0dmFsdWUgPSB0aGlzLl9nZXRBdHRyaWJ1dGVFeHByZXNzaW9uKGF0dHJpYiwgdmFsdWUpO1xyXG5cdFx0XHRpZiAodmFsdWUpIHtcclxuXHRcdFx0XHRyZXR1cm4gdGhpcy5fYXBwZW5kQXR0cmlidXRlU2V0dGVyKGNvZGUsIHR5cGVJbmRleCwgYXR0cmliLFxyXG5cdFx0XHRcdHZhbHVlLmNvZGUsIHZhbHVlLmlzRXhwcmVzc2lvbiwgYm9vbGVhblZhbHVlKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkVGVtcGxhdGUkX2dldEF0dHJpYnV0ZUV4cHJlc3Npb24oYXR0cmliLCB2YWx1ZSwgbm9TZXJpYWxpemUpIHtcclxuXHRcdFx0dmFyIHR5cGUgPSB0eXBlb2YgKHZhbHVlKTtcclxuXHRcdFx0aWYgKHR5cGUgPT09IFwidW5kZWZpbmVkXCIpIHJldHVybiBudWxsO1xyXG5cdFx0XHRpZiAodmFsdWUgPT09IG51bGwpIHJldHVybiB7IGlzRXhwcmVzc2lvbjogdHJ1ZSwgY29kZTogXCJudWxsXCIgfTtcclxuXHRcdFx0aWYgKCFhdHRyaWIuaXNOYXRpdmUgJiYgKHR5cGUgPT09IFwic3RyaW5nXCIpKSB7XHJcblx0XHRcdFx0aWYgKHZhbHVlLnN0YXJ0c1dpdGgoXCJ7e1wiKSAmJiB2YWx1ZS5lbmRzV2l0aChcIn19XCIpKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4geyBpc0V4cHJlc3Npb246IHRydWUsIGNvZGU6IHZhbHVlLnNsaWNlKDIsIC0yKS50cmltKCkgfTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSBpZiAodmFsdWUuc3RhcnRzV2l0aChcIntcIikgJiYgdmFsdWUuZW5kc1dpdGgoXCJ9XCIpKSB7XHJcblx0XHRcdFx0XHR2YXIgZXh0ID0gU3lzLkFwcGxpY2F0aW9uLl9nZXRFeHRlbnNpb25Db2RlKHZhbHVlLnNsaWNlKDEsIC0xKSksXHJcblx0XHRcdFx0XHRwcm9wZXJ0aWVzID0gZXh0LnByb3BlcnRpZXMsXHJcblx0XHRcdFx0XHRwcm9wcyA9IFwiXCI7XHJcblx0XHRcdFx0XHRmb3IgKHZhciBuYW1lIGluIHByb3BlcnRpZXMpIHtcclxuXHRcdFx0XHRcdFx0dmFyIHN1YlZhbHVlID0gdGhpcy5fZ2V0QXR0cmlidXRlRXhwcmVzc2lvbihhdHRyaWIsIHByb3BlcnRpZXNbbmFtZV0pO1xyXG5cdFx0XHRcdFx0XHRpZiAoc3ViVmFsdWUgJiYgc3ViVmFsdWUuaXNFeHByZXNzaW9uKSB7XHJcblx0XHRcdFx0XHRcdFx0dmFyIHByb3AgPSBzZXJpYWxpemUobmFtZSkgKyBcIjpcIiArIHN1YlZhbHVlLmNvZGU7XHJcblx0XHRcdFx0XHRcdFx0aWYgKHByb3BzKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRwcm9wcyArPSBcIixcIiArIHByb3A7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0cHJvcHMgPSBwcm9wO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0cmV0dXJuIHsgaXNFeHByZXNzaW9uOiBleHQuaW5zdGFuY2UuZXhwcmVzc2lvbixcclxuXHRcdFx0XHRcdFx0Y29kZTogXCJTeXMuQXBwbGljYXRpb24uX2dldE1hcmt1cEV4dGVuc2lvbihcIiArIHNlcmlhbGl6ZShleHQubmFtZSkgKyBcIikuZXh0ZW5zaW9uKCRjb21wb25lbnQsIFwiICtcclxuXHRcdFx0XHRcdFx0c2VyaWFsaXplKChhdHRyaWIudHlwZSA9PT0gMiA/IFwiY2xhc3M6XCIgOiBcIlwiKSArIGF0dHJpYi5uYW1lKSArXHJcblx0XHRcdFx0XHRcdFwiLCAkY29udGV4dCwge1wiICsgcHJvcHMgKyBcIn0pXCJcclxuXHRcdFx0XHRcdH07XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChhdHRyaWIuaXNJZCkge1xyXG5cdFx0XHRcdG5vU2VyaWFsaXplID0gdHJ1ZTtcclxuXHRcdFx0XHR2YWx1ZSA9ICckaWQoJyArIHNlcmlhbGl6ZSh2YWx1ZSkgKyAnKSc7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHsgaXNFeHByZXNzaW9uOiB0cnVlLCBjb2RlOiAobm9TZXJpYWxpemUgPyB2YWx1ZSA6IHNlcmlhbGl6ZSh2YWx1ZSkpIH07XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkVGVtcGxhdGUkX3Byb2Nlc3NCb29sZWFuQXR0cmlidXRlKGVsZW1lbnQsIGNvZGUsIHR5cGVJbmRleCwgbmFtZSkge1xyXG5cdFx0XHR2YXIgdmFsdWUsIGlzTmF0aXZlLCBub2RlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGVOb2RlKFwic3lzOlwiICsgbmFtZSk7XHJcblx0XHRcdGlmICghbm9kZSkge1xyXG5cdFx0XHRcdGlzTmF0aXZlID0gdHJ1ZTtcclxuXHRcdFx0XHRub2RlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGVOb2RlKG5hbWUpO1xyXG5cdFx0XHRcdGlmIChub2RlICYmIChub2RlLnNwZWNpZmllZCB8fCAobm9kZS5ub2RlVmFsdWUgPT09IHRydWUpKSkge1xyXG5cdFx0XHRcdFx0dmFsdWUgPSB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmIChlbGVtZW50LmdldEF0dHJpYnV0ZShuYW1lKSA9PT0gbmFtZSkge1xyXG5cdFx0XHRcdFx0dmFsdWUgPSB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dmFsdWUgPSBub2RlLm5vZGVWYWx1ZTtcclxuXHRcdFx0XHRpZiAodmFsdWUgPT09IFwidHJ1ZVwiKSB7XHJcblx0XHRcdFx0XHR2YWx1ZSA9IHRydWU7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2UgaWYgKHZhbHVlID09PSBcImZhbHNlXCIpIHtcclxuXHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5fcHJvY2Vzc0F0dHJpYnV0ZShjb2RlLCB0eXBlSW5kZXgsIHsgbmFtZTogbmFtZSwgaXNOYXRpdmU6IGlzTmF0aXZlIH0sIHZhbHVlLCBuYW1lKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSRUZW1wbGF0ZSRfcHJvY2Vzc0Jvb2xlYW5BdHRyaWJ1dGVzKGVsZW1lbnQsIGNvZGUsIHR5cGVJbmRleCwgYXR0cmlidXRlcykge1xyXG5cdFx0XHR2YXIgbmFtZSwgbm9kZSwgdmFsdWU7XHJcblx0XHRcdGZvciAodmFyIGkgPSAwLCBsID0gYXR0cmlidXRlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuXHRcdFx0XHR0aGlzLl9wcm9jZXNzQm9vbGVhbkF0dHJpYnV0ZShlbGVtZW50LCBjb2RlLCB0eXBlSW5kZXgsIGF0dHJpYnV0ZXNbaV0pO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkVGVtcGxhdGUkX3Byb2Nlc3NDb2RlQmxvY2sobmFtZSwgZWxlbWVudCwgY29kZSkge1xyXG5cdFx0XHR2YXIgdmFsdWUgPSB0aGlzLl9nZXRFeHBsaWNpdEF0dHJpYnV0ZShudWxsLCBudWxsLCBlbGVtZW50LCBuYW1lKTtcclxuXHRcdFx0aWYgKHZhbHVlKSB7XHJcblx0XHRcdFx0dmFsdWUgPSB0aGlzLl9nZXRBdHRyaWJ1dGVFeHByZXNzaW9uKHsgbmFtZTogbmFtZSB9LCB2YWx1ZSwgdHJ1ZSkuY29kZTtcclxuXHRcdFx0XHRjb2RlLnB1c2goKG5hbWUgPT09IFwic3lzOmlmXCIpID8gKFwiICBpZiAoXCIgKyB2YWx1ZSArIFwiKSB7XFxuXCIpXHJcblx0XHRcdFx0XHRcdDogKFwiICBcIiArIHZhbHVlICsgXCJcXG5cIikpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiAhIXZhbHVlO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJFRlbXBsYXRlJF9nZXRFeHBsaWNpdEF0dHJpYnV0ZShjb2RlLCB0eXBlSW5kZXgsIGVsZW1lbnQsIG5hbWUsIHByb2Nlc3NOYW1lLCBpc05hdGl2ZSwgYXR0cmliKSB7XHJcblx0XHRcdHZhciBlLCBub2RlLCB2YWx1ZTtcclxuXHRcdFx0aWYgKG5hbWUgPT09IFwic3R5bGVcIiAmJiBlbGVtZW50LnN0eWxlKSB7XHJcblx0XHRcdFx0dmFsdWUgPSBlbGVtZW50LnN0eWxlLmNzc1RleHQ7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dHJ5IHtcclxuXHRcdFx0XHRcdC8vIEpCUDogSW4gSUU5IHRoZSBnZXRBdHRyaWJ1dGVOb2RlIG1ldGhvZCBoYW5kbGVzICdjbGFzcycgc3BlY2lhbCwgaW4gdGhhdCBpdCBhcHBlYXJzIHRvIGFjdHVhbGx5IGNyZWF0ZVxyXG5cdFx0XHRcdFx0Ly8gYSBuZXcgJ2NsYXNzJyBhdHRyaWJ1dGUgYW5kIHNldHMgdGhlIHZhbHVlIHRvIGVtcHR5IHN0cmluZyBpZiBpdCBkb2Vzbid0IGV4aXN0IG9uIHRoZSBlbGVtZW50LlxyXG5cdFx0XHRcdFx0Ly8gVGhpcyBiZWhhdmlvciBhcHBlYXJzIHRvIGFmZmVjdCB0aGUgc3lzOmNsYXNzIGF0dHJpYnV0ZSB2YWx1ZSwgYXMgaXQgaXMgYWxzbyBzZXQgdG8gZW1wdHkgc3RyaW5nIGFmdGVyIHRoZSBnZXRBdHRyaWJ1dGVOb2RlIG1ldGhvZCBpcyBjYWxsZWQuXHJcblxyXG5cdFx0XHRcdFx0aWYgKG5hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJjbGFzc1wiICYmIFN5cy5Ccm93c2VyLmFnZW50ID09PSBTeXMuQnJvd3NlclsnSW50ZXJuZXRFeHBsb3JlciddICYmIFN5cy5Ccm93c2VyLnZlcnNpb24gPj0gOSkge1xyXG5cdFx0XHRcdFx0XHRpZiAoIWVsZW1lbnQuY2xhc3NOYW1lKSB7XHJcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdC8vIEhBQ0s6IGV2YWx1YXRlIHRoZSBzeXM6Y2xhc3MgYXR0cmlidXRlLCB3aGljaCBzb21laG93IHNldHMgdGhlIGNsYXNzIGF0dHJpYnV0ZSBlcXVhbCB0byBzeXM6Y2xhc3MgdmFsdWVcclxuXHRcdFx0XHRcdFx0XHRlbGVtZW50LmdldEF0dHJpYnV0ZU5vZGUoXCJzeXM6Y2xhc3NcIik7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRub2RlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGVOb2RlKG5hbWUpO1xyXG5cclxuXHRcdFx0XHRcdGlmIChub2RlICYmIG5vZGUuc3BlY2lmaWVkKSB7XHJcblx0XHRcdFx0XHRcdHZhbHVlID0gbm9kZS5ub2RlVmFsdWU7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGNhdGNoIChlKSB7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh2YWx1ZSAmJiBwcm9jZXNzTmFtZSkge1xyXG5cdFx0XHRcdHRoaXMuX3Byb2Nlc3NBdHRyaWJ1dGUoY29kZSwgdHlwZUluZGV4LCBtZXJnZSh7IG5hbWU6IHByb2Nlc3NOYW1lLCB0eXBlOiAxLCBpc05hdGl2ZTogaXNOYXRpdmUgfSwgYXR0cmliKSwgdmFsdWUpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiB2YWx1ZTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSRUZW1wbGF0ZSRfYnVpbGRUZW1wbGF0ZUNvZGUobmVzdGVkVGVtcGxhdGVzLCBlbGVtZW50LCBjb2RlLCBkZXB0aCkge1xyXG5cdFx0XHR2YXIgaSwgaiwgbCwgbSwgdHlwZU5hbWUsIGlzSW5wdXQsIGlzQnV0dG9uLFxyXG5cdFx0XHRleHByZXNzaW9uUmVnRXhwID0gU3lzLlVJLlRlbXBsYXRlLl9leHByZXNzaW9uUmVnRXhwLFxyXG5cdFx0XHRzdG9yZUVsZW1lbnRDb2RlID0gXCIgIFwiICsgKGRlcHRoID8gKFwiX19wW19fZC0xXS5hcHBlbmRDaGlsZChcIikgOiBcIl9fdG9wRWxlbWVudHMucHVzaChcIiksXHJcblx0XHRcdHVzZURpcmVjdCA9IGlzQnJvd3NlcihcIkludGVybmV0RXhwbG9yZXJcIikgJiYgU3lzLkJyb3dzZXIudmVyc2lvbiA8IDk7XHJcblx0XHRcdGNvZGUucHVzaChcIiAgX19kKys7XFxuXCIpO1xyXG5cdFx0XHRmb3IgKGkgPSAwLCBsID0gZWxlbWVudC5jaGlsZE5vZGVzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG5cdFx0XHRcdHZhciBjaGlsZE5vZGUgPSBlbGVtZW50LmNoaWxkTm9kZXNbaV0sIHRleHQgPSBjaGlsZE5vZGUubm9kZVZhbHVlO1xyXG5cclxuXHRcdFx0XHRpZiAoY2hpbGROb2RlLm5vZGVUeXBlID09PSA4KSB7XHJcblx0XHRcdFx0XHRjb2RlLnB1c2goc3RvcmVFbGVtZW50Q29kZSArIFwiZG9jdW1lbnQuY3JlYXRlQ29tbWVudChcIiArIHNlcmlhbGl6ZSh0ZXh0KSArIFwiKSk7XFxuXCIpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmIChjaGlsZE5vZGUubm9kZVR5cGUgPT09IDMpIHtcclxuXHRcdFx0XHRcdHZhciB0cmltVGV4dCA9IHRleHQudHJpbSgpO1xyXG5cdFx0XHRcdFx0aWYgKHRyaW1UZXh0LnN0YXJ0c1dpdGgoXCJ7XCIpICYmIHRyaW1UZXh0LmVuZHNXaXRoKFwifVwiKSAmJiAoIXRyaW1UZXh0LnN0YXJ0c1dpdGgoXCJ7e1wiKSB8fCAhdHJpbVRleHQuZW5kc1dpdGgoXCJ9fVwiKSkpIHtcclxuXHRcdFx0XHRcdFx0dmFyIGF0dHJpYk5hbWUsIHNldENvbXBvbmVudENvZGU7XHJcblx0XHRcdFx0XHRcdHNldENvbXBvbmVudENvZGUgPSAnJGNvbXBvbmVudD0kZWxlbWVudDtcXG4nO1xyXG5cdFx0XHRcdFx0XHRpZiAoZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwidGV4dGFyZWFcIikge1xyXG5cdFx0XHRcdFx0XHRcdGF0dHJpYk5hbWUgPSBcInZhbHVlXCI7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0YXR0cmliTmFtZSA9IFwiaW5uZXJUZXh0XCI7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0dmFyIGV4cHIgPSB0aGlzLl9nZXRBdHRyaWJ1dGVFeHByZXNzaW9uKHsgbmFtZTogYXR0cmliTmFtZSB9LCB0cmltVGV4dCk7XHJcblx0XHRcdFx0XHRcdGlmIChleHByLmlzRXhwcmVzc2lvbikge1xyXG5cdFx0XHRcdFx0XHRcdGNvZGUucHVzaChzdG9yZUVsZW1lbnRDb2RlLCBcImRvY3VtZW50LmNyZWF0ZVRleHROb2RlKFwiLCBleHByLmNvZGUsIFwiKSk7XFxuXCIpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdGNvZGUucHVzaCgnJGNvbXBvbmVudD0kZWxlbWVudDtcXG4nLCAnICAnLCBleHByLmNvZGUsICc7XFxuJyk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHR2YXIgbWF0Y2ggPSBleHByZXNzaW9uUmVnRXhwLmV4ZWModGV4dCksIGxhc3RJbmRleCA9IDA7XHJcblx0XHRcdFx0XHRcdHdoaWxlIChtYXRjaCkge1xyXG5cdFx0XHRcdFx0XHRcdHZhciBjYXRjaFVwVGV4dCA9IHRleHQuc3Vic3RyaW5nKGxhc3RJbmRleCwgbWF0Y2guaW5kZXgpO1xyXG5cdFx0XHRcdFx0XHRcdGlmIChjYXRjaFVwVGV4dCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0dGhpcy5fYXBwZW5kVGV4dE5vZGUoY29kZSwgc3RvcmVFbGVtZW50Q29kZSwgY2F0Y2hVcFRleHQpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRjb2RlLnB1c2goc3RvcmVFbGVtZW50Q29kZSwgXCJkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShcIiwgbWF0Y2hbMV0sIFwiKSk7XFxuXCIpO1xyXG5cdFx0XHRcdFx0XHRcdGxhc3RJbmRleCA9IG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoO1xyXG5cdFx0XHRcdFx0XHRcdG1hdGNoID0gZXhwcmVzc2lvblJlZ0V4cC5leGVjKHRleHQpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGlmIChsYXN0SW5kZXggPCB0ZXh0Lmxlbmd0aCkge1xyXG5cdFx0XHRcdFx0XHRcdHRoaXMuX2FwcGVuZFRleHROb2RlKGNvZGUsIHN0b3JlRWxlbWVudENvZGUsIHRleHQuc3Vic3RyKGxhc3RJbmRleCkpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0dmFyIGF0dHJpYnV0ZXMgPSBjaGlsZE5vZGUuYXR0cmlidXRlcyxcclxuXHRcdFx0XHRcdFx0dHlwZU5hbWVzID0gbnVsbCwgc3lzQXR0cmlidXRlID0gbnVsbCwgdHlwZUluZGV4ID0ge30sXHJcblx0XHRcdFx0XHRcdHRhZ05hbWUgPSBjaGlsZE5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpLFxyXG5cdFx0XHRcdFx0XHRib29sZWFuQXR0cmlidXRlcywgZHAxID0gZGVwdGggKyAxLCBjb250ZW50VGVtcGxhdGU7XHJcblx0XHRcdFx0XHRpZiAodGFnTmFtZSA9PT0gXCJzY3JpcHRcIikge1xyXG5cdFx0XHRcdFx0XHRjb250aW51ZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHZhciBpc0NvZGVJZkdlbmVyYXRlZCA9IHRoaXMuX3Byb2Nlc3NDb2RlQmxvY2soXCJzeXM6aWZcIiwgY2hpbGROb2RlLCBjb2RlKTtcclxuXHRcdFx0XHRcdHRoaXMuX3Byb2Nlc3NDb2RlQmxvY2soXCJzeXM6Y29kZWJlZm9yZVwiLCBjaGlsZE5vZGUsIGNvZGUpO1xyXG5cdFx0XHRcdFx0Y29udGVudFRlbXBsYXRlID0gdGhpcy5fZ2V0RXhwbGljaXRBdHRyaWJ1dGUobnVsbCwgbnVsbCwgY2hpbGROb2RlLCBcInN5czpjb250ZW50LXRlbXBsYXRlXCIpO1xyXG5cdFx0XHRcdFx0aWYgKGNvbnRlbnRUZW1wbGF0ZSkge1xyXG5cdFx0XHRcdFx0XHRpZiAoY29udGVudFRlbXBsYXRlLmNvbnN0cnVjdG9yICE9PSBTdHJpbmcpIHRocm93IG5ldyBFcnJvcihcIlRoZSBzeXM6Y29udGVudC10ZW1wbGF0ZSBhdHRyaWJ1dGUgdmFsdWUgbXVzdCBiZSBhIHN0cmluZy5cIik7XHJcblx0XHRcdFx0XHRcdGNvZGUucHVzaChcIiAgX19jb250ZW50VGVtcGxhdGVzLnB1c2goJ1wiICsgY29udGVudFRlbXBsYXRlICsgXCInKTtcXG5cIik7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRpc0J1dHRvbiA9ICh0YWdOYW1lID09PSBcImJ1dHRvblwiKTtcclxuXHRcdFx0XHRcdGlzSW5wdXQgPSBpc0J1dHRvbiB8fCAodGFnTmFtZSA9PT0gXCJpbnB1dFwiKTtcclxuXHRcdFx0XHRcdGlmIChpc0lucHV0KSB7XHJcblx0XHRcdFx0XHRcdHZhciB0eXBlRXhwcmVzc2lvbiA9IGNoaWxkTm9kZS5nZXRBdHRyaWJ1dGUoXCJzeXM6dHlwZVwiKTtcclxuXHRcdFx0XHRcdFx0dHlwZUV4cHJlc3Npb24gPSB0eXBlRXhwcmVzc2lvbiA/XHJcblx0XHRcdFx0XHRcdHRoaXMuX2dldEF0dHJpYnV0ZUV4cHJlc3Npb24oeyBuYW1lOiBcInR5cGVcIiB9LCB0eXBlRXhwcmVzc2lvbikgOlxyXG5cdFx0XHRcdFx0XHR0aGlzLl9nZXRBdHRyaWJ1dGVFeHByZXNzaW9uKHsgbmFtZTogXCJ0eXBlXCIsIGlzTmF0aXZlOiB0cnVlIH0sIGNoaWxkTm9kZS5nZXRBdHRyaWJ1dGUoXCJ0eXBlXCIpKTtcclxuXHRcdFx0XHRcdFx0dmFyIG5hbWVFeHByZXNzaW9uID0gY2hpbGROb2RlLmdldEF0dHJpYnV0ZShcInN5czpuYW1lXCIpO1xyXG5cdFx0XHRcdFx0XHRuYW1lRXhwcmVzc2lvbiA9IG5hbWVFeHByZXNzaW9uID9cclxuXHRcdFx0XHRcdFx0dGhpcy5fZ2V0QXR0cmlidXRlRXhwcmVzc2lvbih7IG5hbWU6IFwibmFtZVwiIH0sIG5hbWVFeHByZXNzaW9uKSA6XHJcblx0XHRcdFx0XHRcdHRoaXMuX2dldEF0dHJpYnV0ZUV4cHJlc3Npb24oeyBuYW1lOiBcIm5hbWVcIiwgaXNOYXRpdmU6IHRydWUgfSwgY2hpbGROb2RlLmdldEF0dHJpYnV0ZShcIm5hbWVcIikpO1xyXG5cdFx0XHRcdFx0XHRpZiAoIXR5cGVFeHByZXNzaW9uLmlzRXhwcmVzc2lvbiB8fCAhbmFtZUV4cHJlc3Npb24uaXNFeHByZXNzaW9uKSB7XHJcblx0XHRcdFx0XHRcdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTeXMuVUkuVGVtcGxhdGVzUmVzLm11c3RTZXRJbnB1dEVsZW1lbnRzRXhwbGljaXRseSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0Y29kZS5wdXNoKFwiICAkZWxlbWVudD1jb250YWluZXI9X19wW19fZF09U3lzLlVJLlRlbXBsYXRlLl9jcmVhdGVJbnB1dChcIiArIHR5cGVFeHByZXNzaW9uLmNvZGUgKyBcIiwgXCIgKyBuYW1lRXhwcmVzc2lvbi5jb2RlICsgXCIsIFwiICsgaXNCdXR0b24gKyBcIik7XFxuXCIpO1xyXG5cdFx0XHRcdFx0XHRib29sZWFuQXR0cmlidXRlcyA9IFN5cy5VSS5UZW1wbGF0ZS5faW5wdXRCb29sZWFuQXR0cmlidXRlcztcclxuXHRcdFx0XHRcdFx0dGhpcy5fcHJvY2Vzc0Jvb2xlYW5BdHRyaWJ1dGVzKGNoaWxkTm9kZSwgY29kZSwgdHlwZUluZGV4LCBib29sZWFuQXR0cmlidXRlc1tcIiBsaXN0XCJdKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRjb2RlLnB1c2goXCIgICRlbGVtZW50PWNvbnRhaW5lcj1fX3BbX19kXT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdcIiArIGNoaWxkTm9kZS5ub2RlTmFtZSArIFwiJyk7XFxuXCIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0aWYgKCFkZXB0aCkge1xyXG5cdFx0XHRcdFx0XHRjb2RlLnB1c2goXCIgJGVsZW1lbnQuX19tc3RjaW5kZXggPSAkY29udGV4dC5fdGNpbmRleDtcXG5cIik7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR0aGlzLl9nZXRFeHBsaWNpdEF0dHJpYnV0ZShjb2RlLCB0eXBlSW5kZXgsIGNoaWxkTm9kZSwgXCJzeXM6aWRcIiwgXCJpZFwiLCBmYWxzZSwgeyBpc0lkOiB0cnVlIH0pIHx8XHJcblx0XHRcdFx0XHR0aGlzLl9nZXRFeHBsaWNpdEF0dHJpYnV0ZShjb2RlLCB0eXBlSW5kZXgsIGNoaWxkTm9kZSwgXCJpZFwiLCBcImlkXCIsIHRydWUsIHsgaXNJZDogdHJ1ZSB9KTtcclxuXHJcblx0XHRcdFx0XHR0eXBlTmFtZXMgPSB0aGlzLl9nZXRFeHBsaWNpdEF0dHJpYnV0ZShjb2RlLCB0eXBlSW5kZXgsIGNoaWxkTm9kZSwgXCJzeXM6YXR0YWNoXCIpO1xyXG5cdFx0XHRcdFx0aWYgKHR5cGVOYW1lcykge1xyXG5cdFx0XHRcdFx0XHR0eXBlTmFtZXMgPSB0eXBlTmFtZXMuc3BsaXQoJywnKTtcclxuXHRcdFx0XHRcdFx0Y29kZS5wdXNoKFwiICBfX2NvbXBvbmVudEluZGV4ID0ge31cXG5cIik7XHJcblx0XHRcdFx0XHRcdGZvciAoaiA9IDAsIG0gPSB0eXBlTmFtZXMubGVuZ3RoOyBqIDwgbTsgaisrKSB7XHJcblx0XHRcdFx0XHRcdFx0dHlwZU5hbWUgPSB0eXBlTmFtZXNbal0udHJpbSgpO1xyXG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlSW5kZXhbdHlwZU5hbWVdKSBjb250aW51ZTtcclxuXHRcdFx0XHRcdFx0XHR2YXIgdHlwZSA9IFN5cy5BcHBsaWNhdGlvbi5fZmluZFR5cGUoY2hpbGROb2RlLCB0eXBlTmFtZSwgdXNlRGlyZWN0KTtcclxuXHRcdFx0XHRcdFx0XHRpZiAoIXR5cGUpIHtcclxuXHRcdFx0XHRcdFx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuVUkuVGVtcGxhdGVzUmVzLmludmFsaWRBdHRhY2gsIFwic3lzOmF0dGFjaFwiLCB0eXBlTmFtZSkpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR2YXIgaXNDb21wb25lbnQsIGlzQ29udHJvbE9yQmVoYXZpb3IsIGlzQ29udGV4dCwgaXNDb250ZW50VGVtcGxhdGUsIGlzQ2xhc3MgPSB0eXBlb2YgKHR5cGUpICE9PSBcInN0cmluZ1wiO1xyXG5cdFx0XHRcdFx0XHRcdGlmIChpc0NsYXNzKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRpc0NvbXBvbmVudCA9IHR5cGUuaW5oZXJpdHNGcm9tKFN5cy5Db21wb25lbnQpO1xyXG5cdFx0XHRcdFx0XHRcdFx0aXNDb250cm9sT3JCZWhhdmlvciA9IChpc0NvbXBvbmVudCAmJiAodHlwZS5pbmhlcml0c0Zyb20oU3lzLlVJLkJlaGF2aW9yKSB8fCB0eXBlLmluaGVyaXRzRnJvbShTeXMuVUkuQ29udHJvbCkpKTtcclxuXHRcdFx0XHRcdFx0XHRcdGlzQ29udGV4dCA9IHR5cGUuaW1wbGVtZW50c0ludGVyZmFjZShTeXMuVUkuSVRlbXBsYXRlQ29udGV4dENvbnN1bWVyKTtcclxuXHRcdFx0XHRcdFx0XHRcdGlzQ29udGVudFRlbXBsYXRlID0gdHlwZS5pbXBsZW1lbnRzSW50ZXJmYWNlKFN5cy5VSS5JQ29udGVudFRlbXBsYXRlQ29uc3VtZXIpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR0eXBlSW5kZXhbdHlwZU5hbWVdID0geyB0eXBlOiB0eXBlLCBpc0NsYXNzOiBpc0NsYXNzLCBpc0NvbXBvbmVudDogaXNDb21wb25lbnQgfTtcclxuXHRcdFx0XHRcdFx0XHRpZiAoaXNDbGFzcykge1xyXG5cdFx0XHRcdFx0XHRcdFx0Y29kZS5wdXNoKFwiICBfX2NvbXBvbmVudEluZGV4WydcIiArIHR5cGVOYW1lICsgXCInXSA9ICRjb21wb25lbnQgPSBuZXcgXCIgKyB0eXBlLmdldE5hbWUoKSk7XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoaXNDb250cm9sT3JCZWhhdmlvcikge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRjb2RlLnB1c2goXCIoJGVsZW1lbnQpO1xcblwiKTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRjb2RlLnB1c2goXCIoKTtcXG4gIFN5cy5BcHBsaWNhdGlvbi5fcmVnaXN0ZXJDb21wb25lbnQoJGVsZW1lbnQsICRjb21wb25lbnQpO1xcblwiKTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdGlmIChpc0NvbXBvbmVudCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRjb2RlLnB1c2goXCIgICRjb21wb25lbnQuYmVnaW5VcGRhdGUoKTtcXG5cIik7XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoaXNDb250ZXh0KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGNvZGUucHVzaChcIiAgJGNvbXBvbmVudC5zZXRfdGVtcGxhdGVDb250ZXh0KCRjb250ZXh0KTtcXG5cIik7XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoaXNDb250ZW50VGVtcGxhdGUpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y29kZS5wdXNoKFwiICBpZiAoX19wYXJlbnRDb250ZW50VGVtcGxhdGUgJiYgX19wYXJlbnRDb250ZW50VGVtcGxhdGUubGVuZ3RoID4gMCkgJGNvbXBvbmVudC5hZGRDb250ZW50VGVtcGxhdGUoX19wYXJlbnRDb250ZW50VGVtcGxhdGUpO1xcblwiKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y29kZS5wdXNoKFwiICBpZiAoX19jb250ZW50VGVtcGxhdGVzLmxlbmd0aCA+IDApICRjb21wb25lbnQuYWRkQ29udGVudFRlbXBsYXRlKF9fY29udGVudFRlbXBsYXRlcy5qb2luKCcgJykpO1xcblwiKTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdHZhciBpZGF0dHIgPSB0eXBlTmFtZSArIFwiOmlkXCIsXHJcblx0XHRcdFx0XHRcdFx0XHR0eXBlYXR0ciA9IFN5cy5BcHBsaWNhdGlvbi5fc3BsaXRBdHRyaWJ1dGUoaWRhdHRyLCBmYWxzZSwgdHlwZUluZGV4KTtcclxuXHRcdFx0XHRcdFx0XHRcdHR5cGVhdHRyLmlzSWQgPSB0cnVlO1xyXG5cdFx0XHRcdFx0XHRcdFx0dGhpcy5fZ2V0RXhwbGljaXRBdHRyaWJ1dGUoY29kZSwgdHlwZUluZGV4LCBjaGlsZE5vZGUsIGlkYXR0ciwgXCJpZFwiLCBmYWxzZSwgdHlwZWF0dHIpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0dGhpcy5fZ2V0RXhwbGljaXRBdHRyaWJ1dGUoY29kZSwgdHlwZUluZGV4LCBjaGlsZE5vZGUsIFwic3R5bGVcIiwgXCJzdHlsZS5jc3NUZXh0XCIsIHRydWUpO1xyXG5cdFx0XHRcdFx0dGhpcy5fZ2V0RXhwbGljaXRBdHRyaWJ1dGUoY29kZSwgdHlwZUluZGV4LCBjaGlsZE5vZGUsIFwiY2xhc3NcIiwgXCJjbGFzc05hbWVcIiwgdHJ1ZSk7XHJcblx0XHRcdFx0XHRpZiAoIWlzSW5wdXQpIHtcclxuXHRcdFx0XHRcdFx0Ym9vbGVhbkF0dHJpYnV0ZXMgPSBTeXMuVUkuVGVtcGxhdGUuX2Jvb2xlYW5BdHRyaWJ1dGVzW3RhZ05hbWVdIHx8XHJcblx0XHRcdFx0XHRcdFN5cy5VSS5UZW1wbGF0ZS5fY29tbW9uQm9vbGVhbkF0dHJpYnV0ZXM7XHJcblx0XHRcdFx0XHRcdHRoaXMuX3Byb2Nlc3NCb29sZWFuQXR0cmlidXRlcyhjaGlsZE5vZGUsIGNvZGUsIHR5cGVJbmRleCwgYm9vbGVhbkF0dHJpYnV0ZXNbXCIgbGlzdFwiXSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR2YXIgaXNTZWxlY3QgPSAodGFnTmFtZSA9PT0gXCJzZWxlY3RcIiksXHJcblx0XHRcdFx0XHRkZWxheWVkQXR0cmlidXRlcyA9IG51bGwsXHJcblx0XHRcdFx0XHRzcGxpdCA9IFN5cy5BcHBsaWNhdGlvbi5fc3BsaXRBdHRyaWJ1dGUsXHJcblx0XHRcdFx0XHRza2lwQ2hpbGRyZW4gPSBmYWxzZSxcclxuXHRcdFx0XHRcdHNraXAgPSB7ICdpZCc6IDEsICdjbGFzcyc6IDEsICdzdHlsZSc6IDEsICdzeXM6YXR0YWNoJzogMSwgJ3N5czppZCc6IDEsICdzeXM6ZGlzYWJsZWQnOiAxLCAnc3lzOmNoZWNrZWQnOiAxLCAnc3lzOnJlYWRvbmx5JzogMSwgJ3N5czppc21hcCc6IDEsICdzeXM6bXVsdGlwbGUnOiAxLCAnc3lzOnNlbGVjdGVkJzogMSwgJ3N5czppZic6IDEsICdzeXM6Y29kZWJlZm9yZSc6IDEsICdzeXM6Y29kZWFmdGVyJzogMSwgJ3N5czpjb250ZW50LXRlbXBsYXRlJzogMSB9O1xyXG5cdFx0XHRcdFx0Zm9yIChqID0gMCwgbSA9IGF0dHJpYnV0ZXMubGVuZ3RoOyBqIDwgbTsgaisrKSB7XHJcblx0XHRcdFx0XHRcdHZhciBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzW2pdLCBuYW1lID0gYXR0cmlidXRlLm5vZGVOYW1lLCBsb3dlck5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBIQUNLOiBJRSBpbmNsdWRlcyB1c2VyLWRlZmluZWQgYXR0cmlidXRlcywgYXMgd2VsbCBhcyBhdHRyaWJ1dGVzIGFkZGVkIHRvIGFuIGVsZW1lbnRcclxuXHRcdFx0XHRcdFx0Ly8gdmlhIEphdmFTY3JpcHQuIFRoaXMgY2F1c2VzIHVuZGVzaXJhYmxlIGJlaGF2aW9yIHdoZW4gdGhlc2UgYXR0cmlidXRlcyBhcmUgY29waWVkIHRvXHJcblx0XHRcdFx0XHRcdC8vIGEgRE9NIGVsZW1lbnQgdmlhIHRlbXBsYXRlIHJlbmRlcmluZy4gRm9yIGV4YW1wbGUsIGluIHRoZSBjYXNlIG9mIGpRdWVyeSBkYXRhLCB0aGVcclxuXHRcdFx0XHRcdFx0Ly8gdGVtcGxhdGUgZWxlbWVudCBhbmQgcmVzdWx0aW5nIHJlbmRlcmVkIGVsZW1lbnQgd2lsbCBzaGFyZSB0aGUgc2FtZSBkYXRhIGNhY2hlIHNpbmNlXHJcblx0XHRcdFx0XHRcdC8vIHRoZXkgaGF2ZSB0aGUgc2FtZSB2YWx1ZSBmb3IgdGhlIGV4cGFuZG8gYXR0cmlidXRlIHRoYXQgaXMgdXNlZCBhcyB0aGUgY2FjaGUga2V5LlxyXG5cdFx0XHRcdFx0XHRpZiAobmFtZS5pbmRleE9mKFwialF1ZXJ5XCIpID09PSAwKVxyXG5cdFx0XHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cclxuXHRcdFx0XHRcdFx0aWYgKCFhdHRyaWJ1dGUuc3BlY2lmaWVkICYmICghaXNJbnB1dCB8fCBsb3dlck5hbWUgIT09IFwidmFsdWVcIikpIGNvbnRpbnVlO1xyXG5cdFx0XHRcdFx0XHRpZiAoc2tpcFtsb3dlck5hbWVdIHx8IGJvb2xlYW5BdHRyaWJ1dGVzW2xvd2VyTmFtZV0pIGNvbnRpbnVlO1xyXG5cdFx0XHRcdFx0XHRpZiAoaXNJbnB1dCAmJiBTeXMuVUkuVGVtcGxhdGUuX2lucHV0UmVxdWlyZWRBdHRyaWJ1dGVzW2xvd2VyTmFtZV0pIGNvbnRpbnVlO1xyXG5cdFx0XHRcdFx0XHR2YXIgYXR0cmliID0gc3BsaXQobmFtZSwgaXNTZWxlY3QsIHR5cGVJbmRleCksXHJcblx0XHRcdFx0XHRcdG5zID0gYXR0cmliLm5zLFxyXG5cdFx0XHRcdFx0XHR2YWx1ZSA9IGF0dHJpYnV0ZS5ub2RlVmFsdWUsXHJcblx0XHRcdFx0XHRcdGF0eXBlID0gYXR0cmliLnR5cGU7XHJcblx0XHRcdFx0XHRcdG5hbWUgPSBhdHRyaWIubmFtZTtcclxuXHRcdFx0XHRcdFx0aWYgKGF0eXBlID09PSAxKSB7XHJcblx0XHRcdFx0XHRcdFx0aWYgKGlzU2VsZWN0ICYmICghbnMgfHwgbnMgPT09IFwic3lzXCIpKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRkZWxheWVkQXR0cmlidXRlcyA9IGRlbGF5ZWRBdHRyaWJ1dGVzIHx8IFtdO1xyXG5cdFx0XHRcdFx0XHRcdFx0ZGVsYXllZEF0dHJpYnV0ZXMucHVzaChbYXR0cmliLCB2YWx1ZV0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0Y29udGludWU7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdHNraXBbbmFtZS50b0xvd2VyQ2FzZSgpXSA9IHRydWU7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0ZWxzZSBpZiAoYXR5cGUgPT09IDApIHtcclxuXHRcdFx0XHRcdFx0XHRza2lwW25hbWUudG9Mb3dlckNhc2UoKV0gPSB0cnVlO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGVsc2UgaWYgKGF0eXBlID09PSAzICYmIG5hbWUgPT09IFwiaWRcIiAmJiB0eXBlSW5kZXhbbnNdICYmIHR5cGVJbmRleFtuc10uaXNDbGFzcykge1xyXG5cdFx0XHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGlmICh0aGlzLl9wcm9jZXNzQXR0cmlidXRlKGNvZGUsIHR5cGVJbmRleCwgYXR0cmliLCB2YWx1ZSkpIHtcclxuXHRcdFx0XHRcdFx0XHRza2lwQ2hpbGRyZW4gPSB0cnVlO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRpZiAodGhpcy5fY29tbWFuZCkge1xyXG5cdFx0XHRcdFx0XHRjb2RlLnB1c2goXCIgU3lzLlVJLkRvbUVsZW1lbnQuc2V0Q29tbWFuZCgkZWxlbWVudCwgXCIgKyB0aGlzLl9jb21tYW5kICsgXCIsIFwiICsgKHRoaXMuX2NvbW1hbmRhcmd1bWVudCB8fCAnbnVsbCcpICsgXCIsIFN5cy5VSS5Eb21FbGVtZW50Ll9lbnN1cmVHZXQoXCIgKyAodGhpcy5fY29tbWFuZHRhcmdldCB8fCAnbnVsbCcpICsgXCIsICRjb250ZXh0LCAnc3lzOmNvbW1hbmR0YXJnZXQnKSk7XFxuXCIpO1xyXG5cdFx0XHRcdFx0XHR0aGlzLl9jb21tYW5kID0gbnVsbDtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHRoaXMuX2NvbW1hbmRhcmd1bWVudCA9IG51bGw7XHJcblx0XHRcdFx0XHR0aGlzLl9jb21tYW5kdGFyZ2V0ID0gbnVsbDtcclxuXHJcblx0XHRcdFx0XHRjb2RlLnB1c2goc3RvcmVFbGVtZW50Q29kZSArIFwiJGVsZW1lbnQpO1xcblwiKTtcclxuXHRcdFx0XHRcdGZvciAodHlwZU5hbWUgaW4gdHlwZUluZGV4KSB7XHJcblx0XHRcdFx0XHRcdHZhciBpbmRleCA9IHR5cGVJbmRleFt0eXBlTmFtZV07XHJcblx0XHRcdFx0XHRcdGlmIChpbmRleC5pc0NsYXNzKSB7XHJcblx0XHRcdFx0XHRcdFx0Y29kZS5wdXNoKFwiICAkY29udGV4dC5fcmVnaXN0ZXJDb21wb25lbnQoX19jb21wb25lbnRJbmRleFsnXCIgKyB0eXBlTmFtZSArIFwiJ10pO1xcblwiKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRjb2RlLnB1c2goXCIgICRjb250ZXh0Ll9yZWdpc3RlcklmKFwiKTtcclxuXHRcdFx0XHRcdFx0XHRjb2RlLnB1c2goaW5kZXgudHlwZSk7XHJcblx0XHRcdFx0XHRcdFx0Y29kZS5wdXNoKFwiKCRlbGVtZW50LCBcIik7XHJcblx0XHRcdFx0XHRcdFx0Y29kZS5wdXNoKFwie1wiICsgKGluZGV4LnByb3BzIHx8IFwiXCIpICsgXCJ9LCAkY29udGV4dCkpO1xcblwiKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0aWYgKFN5cy5VSS5UZW1wbGF0ZS5faXNUZW1wbGF0ZShjaGlsZE5vZGUpKSB7XHJcblx0XHRcdFx0XHRcdHZhciBuZXN0ZWRUZW1wbGF0ZSA9IG5ldyBTeXMuVUkuVGVtcGxhdGUoY2hpbGROb2RlKTtcclxuXHRcdFx0XHRcdFx0bmVzdGVkVGVtcGxhdGUucmVjb21waWxlKCk7XHJcblx0XHRcdFx0XHRcdG5lc3RlZFRlbXBsYXRlcy5wdXNoKGNoaWxkTm9kZS5fbXNhamF4dGVtcGxhdGUpO1xyXG5cdFx0XHRcdFx0XHRjb2RlLnB1c2goXCIgICRlbGVtZW50Ll9tc2FqYXh0ZW1wbGF0ZSA9IHRoaXMuZ2V0X2VsZW1lbnQoKS5fbXNhamF4dGVtcGxhdGVbMl1bXCIgKyAobmVzdGVkVGVtcGxhdGVzLmxlbmd0aCAtIDEpICsgXCJdO1xcblwiKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2UgaWYgKCFza2lwQ2hpbGRyZW4pIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5fYnVpbGRUZW1wbGF0ZUNvZGUobmVzdGVkVGVtcGxhdGVzLCBjaGlsZE5vZGUsIGNvZGUsIGRwMSk7XHJcblx0XHRcdFx0XHRcdGNvZGUucHVzaChcIiAgJGVsZW1lbnQ9Y29udGFpbmVyPV9fcFtfX2RdO1xcblwiKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGlmIChkZWxheWVkQXR0cmlidXRlcykge1xyXG5cdFx0XHRcdFx0XHRmb3IgKGogPSAwLCBtID0gZGVsYXllZEF0dHJpYnV0ZXMubGVuZ3RoOyBqIDwgbTsgaisrKSB7XHJcblx0XHRcdFx0XHRcdFx0YXR0cmlidXRlID0gZGVsYXllZEF0dHJpYnV0ZXNbal07XHJcblx0XHRcdFx0XHRcdFx0dGhpcy5fcHJvY2Vzc0F0dHJpYnV0ZShjb2RlLCB0eXBlSW5kZXgsIGF0dHJpYnV0ZVswXSwgYXR0cmlidXRlWzFdKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0aWYgKGNvbnRlbnRUZW1wbGF0ZSkge1xyXG5cdFx0XHRcdFx0XHRjb2RlLnB1c2goXCIgIF9fY29udGVudFRlbXBsYXRlcy5wb3AoKTtcXG5cIik7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR0aGlzLl9wcm9jZXNzQ29kZUJsb2NrKFwic3lzOmNvZGVhZnRlclwiLCBjaGlsZE5vZGUsIGNvZGUpO1xyXG5cdFx0XHRcdFx0aWYgKGlzQ29kZUlmR2VuZXJhdGVkKSB7XHJcblx0XHRcdFx0XHRcdGNvZGUucHVzaChcIiAgfVxcblwiKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0Y29kZS5wdXNoKFwiICAtLV9fZDtcXG5cIik7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkVGVtcGxhdGUkX2Vuc3VyZUNvbXBpbGVkKCkge1xyXG5cdFx0XHRpZiAoIXRoaXMuX2luc3RhbnRpYXRlSW4pIHtcclxuXHRcdFx0XHR2YXIgZWxlbWVudCA9IHRoaXMuZ2V0X2VsZW1lbnQoKTtcclxuXHRcdFx0XHRpZiAoZWxlbWVudC5fbXNhamF4dGVtcGxhdGUpIHtcclxuXHRcdFx0XHRcdHRoaXMuX2luc3RhbnRpYXRlSW4gPSBlbGVtZW50Ll9tc2FqYXh0ZW1wbGF0ZVswXTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHR0aGlzLnJlY29tcGlsZSgpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJFRlbXBsYXRlJHJlY29tcGlsZSgpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5UZW1wbGF0ZS5yZWNvbXBpbGVcIiAvPlxyXG5cdFx0XHR2YXIgZWxlbWVudCA9IHRoaXMuZ2V0X2VsZW1lbnQoKSxcclxuXHRcdFx0Y29kZSA9IFtcIiAkaW5kZXggPSAodHlwZW9mKCRpbmRleCkgPT09ICdudW1iZXInID8gJGluZGV4IDogX19pbnN0YW5jZUlkKTtcXG4gdmFyIGZyYWdtZW50PWRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwgJGNvbXBvbmVudCwgX19jb21wb25lbnRJbmRleCwgX19lLCBfX2YsIF9fdG9wRWxlbWVudHMgPSBbXSwgX19kID0gMCwgX19wID0gW2ZyYWdtZW50XSwgJGVsZW1lbnQgPSBfX2NvbnRhaW5lckVsZW1lbnQsIGNvbnRhaW5lciA9IGZyYWdtZW50LCAkY29udGV4dCA9IG5ldyBTeXMuVUkuVGVtcGxhdGVDb250ZXh0KCksIF9fY29udGVudFRlbXBsYXRlcyA9IFtdLCAkaWQgPSBmdW5jdGlvbihwcmVmaXgpIHsgcmV0dXJuICRjb250ZXh0LmdldEluc3RhbmNlSWQocHJlZml4KTsgfTtcXG4gJGNvbnRleHQuZGF0YSA9ICh0eXBlb2YoX19kYXRhKSA9PT0gJ3VuZGVmaW5lZCcgPyBudWxsIDogX19kYXRhKTtcXG4gJGNvbnRleHQuY29tcG9uZW50cyA9IFtdO1xcbiAkY29udGV4dC5ub2RlcyA9IF9fdG9wRWxlbWVudHM7XFxuICRjb250ZXh0LmRhdGFJdGVtID0gJGRhdGFJdGVtO1xcbiAkY29udGV4dC5pbmRleCA9ICRpbmRleDtcXG4gJGNvbnRleHQucGFyZW50Q29udGV4dCA9IF9fcGFyZW50Q29udGV4dDtcXG4gJGNvbnRleHQucm9vdENvbnRleHQgPSBfX3BhcmVudENvbnRleHQucm9vdENvbnRleHQ7XFxuICRjb250ZXh0LmNvbnRhaW5lckVsZW1lbnQgPSBfX2NvbnRhaW5lckVsZW1lbnQ7XFxuICRjb250ZXh0Lmluc2VydEJlZm9yZU5vZGUgPSBfX3JlZmVyZW5jZU5vZGU7XFxuICRjb250ZXh0LnRlbXBsYXRlID0gdGhpcztcXG4gd2l0aCgkZGF0YUl0ZW0gfHwge30pIHtcXG5cIl0sXHJcblx0XHRcdG5lc3RlZFRlbXBsYXRlcyA9IFtdO1xyXG5cdFx0XHR0aGlzLl9idWlsZFRlbXBsYXRlQ29kZShuZXN0ZWRUZW1wbGF0ZXMsIGVsZW1lbnQsIGNvZGUsIDApO1xyXG5cdFx0XHRjb2RlLnB1c2goXCJ9XFxuIF9fY29udGFpbmVyRWxlbWVudC5hcHBlbmRDaGlsZChmcmFnbWVudCk7XFxuICRjb250ZXh0Ll9vbkluc3RhbnRpYXRlZChfX3JlZmVyZW5jZU5vZGUpO1xcbiByZXR1cm4gJGNvbnRleHQ7XCIpO1xyXG5cdFx0XHRjb2RlID0gY29kZS5qb2luKCcnKTtcclxuXHRcdFx0ZWxlbWVudC5fbXNhamF4dGVtcGxhdGUgPSBbdGhpcy5faW5zdGFudGlhdGVJbiA9IG5ldyBGdW5jdGlvbihcIl9fY29udGFpbmVyRWxlbWVudFwiLCBcIiRyb290Q29udGV4dFwiLCBcIiR2bVwiLCBcIiRlbWl0XCIsIFwiX19kYXRhXCIsIFwiJGRhdGFJdGVtXCIsIFwiJGluZGV4XCIsIFwiX19yZWZlcmVuY2VOb2RlXCIsIFwiX19wYXJlbnRDb250ZXh0XCIsIFwiX19wYXJlbnRDb250ZW50VGVtcGxhdGVcIiwgXCJfX2luc3RhbmNlSWRcIiwgY29kZSksIGVsZW1lbnQsIG5lc3RlZFRlbXBsYXRlc107XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkVGVtcGxhdGUkaW5zdGFudGlhdGVJbihjb250YWluZXJFbGVtZW50LCBkYXRhLCBkYXRhSXRlbSwgZGF0YUluZGV4LCBub2RlVG9JbnNlcnRUZW1wbGF0ZUJlZm9yZSwgcGFyZW50Q29udGV4dCwgcGFyZW50Q29udGVudFRlbXBsYXRlKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiMkaWRcIiAvPlxyXG5cdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJjb250YWluZXJFbGVtZW50XCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwiZGF0YVwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJkYXRhSXRlbVwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJkYXRhSW5kZXhcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCIgdHlwZT1cIk51bWJlclwiIGludGVnZXI9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwibm9kZVRvSW5zZXJ0VGVtcGxhdGVCZWZvcmVcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwicGFyZW50Q29udGV4dFwiIHR5cGU9XCJTeXMuVUkuVGVtcGxhdGVDb250ZXh0XCIgb3B0aW9uYWw9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cInBhcmVudENvbnRlbnRUZW1wbGF0ZVwiIHR5cGU9XCJTdHJpbmdcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJTeXMuVUkuVGVtcGxhdGVDb250ZXh0XCI+PC9yZXR1cm5zPlxyXG5cdFx0XHRjb250YWluZXJFbGVtZW50ID0gU3lzLlVJLkRvbUVsZW1lbnQuX2Vuc3VyZUdldChjb250YWluZXJFbGVtZW50LCBudWxsLCBcImNvbnRhaW5lckVsZW1lbnRcIik7XHJcblx0XHRcdG5vZGVUb0luc2VydFRlbXBsYXRlQmVmb3JlID0gU3lzLlVJLkRvbUVsZW1lbnQuX2Vuc3VyZUdldChub2RlVG9JbnNlcnRUZW1wbGF0ZUJlZm9yZSwgbnVsbCwgXCJub2RlVG9JbnNlcnRUZW1wbGF0ZUJlZm9yZVwiKTtcclxuXHRcdFx0dGhpcy5fZW5zdXJlQ29tcGlsZWQoKTtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2luc3RhbnRpYXRlSW4oY29udGFpbmVyRWxlbWVudCwgcGFyZW50Q29udGV4dC5yb290Q29udGV4dCwgcGFyZW50Q29udGV4dC5yb290Q29udGV4dC52bSwgcGFyZW50Q29udGV4dC5yb290Q29udGV4dC52bSA/IHBhcmVudENvbnRleHQucm9vdENvbnRleHQudm0uJGVtaXQuYmluZChwYXJlbnRDb250ZXh0LnJvb3RDb250ZXh0LnZtKSA6IG51bGwsIGRhdGEsIGRhdGFJdGVtLCBkYXRhSW5kZXgsIG5vZGVUb0luc2VydFRlbXBsYXRlQmVmb3JlLCBwYXJlbnRDb250ZXh0LCBwYXJlbnRDb250ZW50VGVtcGxhdGUsIHRoaXMuX2luc3RhbmNlSWQrKyk7XHJcblx0XHR9XHJcblxyXG5cdFx0U3lzLlVJLlRlbXBsYXRlLnByb3RvdHlwZSA9IHtcclxuXHRcdFx0Z2V0X2VsZW1lbnQ6IFN5cyRVSSRUZW1wbGF0ZSRnZXRfZWxlbWVudCxcclxuXHRcdFx0ZGlzcG9zZTogU3lzJFVJJFRlbXBsYXRlJGRpc3Bvc2UsXHJcblx0XHRcdF9hcHBlbmRUZXh0Tm9kZTogU3lzJFVJJFRlbXBsYXRlJF9hcHBlbmRUZXh0Tm9kZSxcclxuXHRcdFx0X2FwcGVuZEF0dHJpYnV0ZVNldHRlcjogU3lzJFVJJFRlbXBsYXRlJF9hcHBlbmRBdHRyaWJ1dGVTZXR0ZXIsXHJcblx0XHRcdF9wcm9jZXNzQXR0cmlidXRlOiBTeXMkVUkkVGVtcGxhdGUkX3Byb2Nlc3NBdHRyaWJ1dGUsXHJcblx0XHRcdF9nZXRBdHRyaWJ1dGVFeHByZXNzaW9uOiBTeXMkVUkkVGVtcGxhdGUkX2dldEF0dHJpYnV0ZUV4cHJlc3Npb24sXHJcblx0XHRcdF9wcm9jZXNzQm9vbGVhbkF0dHJpYnV0ZTogU3lzJFVJJFRlbXBsYXRlJF9wcm9jZXNzQm9vbGVhbkF0dHJpYnV0ZSxcclxuXHRcdFx0X3Byb2Nlc3NCb29sZWFuQXR0cmlidXRlczogU3lzJFVJJFRlbXBsYXRlJF9wcm9jZXNzQm9vbGVhbkF0dHJpYnV0ZXMsXHJcblx0XHRcdF9wcm9jZXNzQ29kZUJsb2NrOiBTeXMkVUkkVGVtcGxhdGUkX3Byb2Nlc3NDb2RlQmxvY2ssXHJcblx0XHRcdF9nZXRFeHBsaWNpdEF0dHJpYnV0ZTogU3lzJFVJJFRlbXBsYXRlJF9nZXRFeHBsaWNpdEF0dHJpYnV0ZSxcclxuXHRcdFx0X2J1aWxkVGVtcGxhdGVDb2RlOiBTeXMkVUkkVGVtcGxhdGUkX2J1aWxkVGVtcGxhdGVDb2RlLFxyXG5cdFx0XHRfZW5zdXJlQ29tcGlsZWQ6IFN5cyRVSSRUZW1wbGF0ZSRfZW5zdXJlQ29tcGlsZWQsXHJcblx0XHRcdHJlY29tcGlsZTogU3lzJFVJJFRlbXBsYXRlJHJlY29tcGlsZSxcclxuXHRcdFx0aW5zdGFudGlhdGVJbjogU3lzJFVJJFRlbXBsYXRlJGluc3RhbnRpYXRlSW5cclxuXHRcdH1cclxuXHRcdFN5cy5VSS5UZW1wbGF0ZS5faXNSZXN0cmljdGVkID0gZnVuY3Rpb24gU3lzJFVJJFRlbXBsYXRlJF9pc1Jlc3RyaWN0ZWQobmFtZSkge1xyXG5cdFx0XHR2YXIgcmVzdHJpY3RlZCA9IFN5cy5VSS5UZW1wbGF0ZS5fZ2V0UmVzdHJpY3RlZEluZGV4KCk7XHJcblx0XHRcdHJldHVybiByZXN0cmljdGVkLmF0dHJpYnV0ZXNbbmFtZS50b0xvd2VyQ2FzZSgpXTtcclxuXHRcdH1cclxuXHRcdFN5cy5VSS5UZW1wbGF0ZS5fY2hlY2tBdHRyaWJ1dGUgPSBmdW5jdGlvbiBTeXMkVUkkVGVtcGxhdGUkX2NoZWNrQXR0cmlidXRlKG5hbWUsIHZhbHVlKSB7XHJcblx0XHRcdGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gdmFsdWU7XHJcblx0XHRcdHZhciBuZXdWYWx1ZSA9IHZhbHVlLCByZXN0cmljdGVkID0gU3lzLlVJLlRlbXBsYXRlLl9nZXRSZXN0cmljdGVkSW5kZXgoKTtcclxuXHRcdFx0aWYgKHJlc3RyaWN0ZWQuYXR0cmlidXRlc1tuYW1lLnRvTG93ZXJDYXNlKCldKSB7XHJcblx0XHRcdFx0aWYgKHR5cGVvZiAodmFsdWUpICE9PSBcInN0cmluZ1wiKSB7XHJcblx0XHRcdFx0XHR2YWx1ZSA9IHZhbHVlLnRvU3RyaW5nKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHZhciBtYXRjaCA9IFN5cy5VSS5UZW1wbGF0ZS5fcHJvdG9jb2xSZWdFeHAuZXhlYyh2YWx1ZS50b0xvd2VyQ2FzZSgpKTtcclxuXHRcdFx0XHRpZiAobWF0Y2gpIHtcclxuXHRcdFx0XHRcdGlmICghcmVzdHJpY3RlZC5wcm90b2NvbHNbbWF0Y2hbMV1dKSB7XHJcblx0XHRcdFx0XHRcdG5ld1ZhbHVlID0gXCJcIjtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIG5ld1ZhbHVlO1xyXG5cdFx0fVxyXG5cdFx0U3lzLlVJLlRlbXBsYXRlLl9nZXRJZEZ1bmN0aW9uID0gZnVuY3Rpb24gU3lzJFVJJFRlbXBsYXRlJF9nZXRJZEZ1bmN0aW9uKGluc3RhbmNlKSB7XHJcblx0XHRcdHJldHVybiBmdW5jdGlvbiAocHJlZml4KSB7XHJcblx0XHRcdFx0cmV0dXJuIHByZWZpeCArIGluc3RhbmNlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRTeXMuVUkuVGVtcGxhdGUuX2NyZWF0ZUlucHV0ID0gZnVuY3Rpb24gU3lzJFVJJFRlbXBsYXRlJF9jcmVhdGVJbnB1dCh0eXBlLCBuYW1lLCBpc0J1dHRvbikge1xyXG5cdFx0XHR2YXIgZXJyLCBlbGVtZW50LCBjYWxsZWUgPSBhcmd1bWVudHMuY2FsbGVlLCBkeW5hbWljID0gY2FsbGVlLl9keW5hbWljO1xyXG5cdFx0XHRpZiAoZHluYW1pYyA9PT0gdHJ1ZSkge1xyXG5cdFx0XHRcdGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGlzQnV0dG9uID8gJ2J1dHRvbicgOiAnaW5wdXQnKTtcclxuXHRcdFx0XHRpZiAodHlwZSkge1xyXG5cdFx0XHRcdFx0ZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIHR5cGUpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAobmFtZSkge1xyXG5cdFx0XHRcdFx0ZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJuYW1lXCIsIG5hbWUpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR2YXIgaHRtbCA9IGlzQnV0dG9uID8gXCI8YnV0dG9uIFwiIDogXCI8aW5wdXQgXCI7XHJcblx0XHRcdFx0aWYgKHR5cGUpIHtcclxuXHRcdFx0XHRcdGh0bWwgKz0gXCJ0eXBlPSdcIiArIHR5cGUgKyBcIicgXCI7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGlmIChuYW1lKSB7XHJcblx0XHRcdFx0XHRodG1sICs9IFwibmFtZT0nXCIgKyBuYW1lICsgXCInIFwiO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRodG1sICs9IGlzQnV0dG9uID8gXCI+PC9idXR0b24+XCIgOiBcIi8+XCI7XHJcblx0XHRcdFx0dHJ5IHtcclxuXHRcdFx0XHRcdGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGh0bWwpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRjYXRjaCAoZXJyKSB7XHJcblx0XHRcdFx0XHRkeW5hbWljID0gdHJ1ZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKHR5cGVvZiAoZHluYW1pYykgPT09IFwidW5kZWZpbmVkXCIpIHtcclxuXHRcdFx0XHRcdGR5bmFtYyA9IChlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKSAhPT0gKGlzQnV0dG9uID8gXCJidXR0b25cIiA6IFwiaW5wdXRcIikpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRjYWxsZWUuX2R5bmFtaWMgPSBkeW5hbWljO1xyXG5cdFx0XHRcdGlmIChkeW5hbWljKSB7XHJcblx0XHRcdFx0XHRlbGVtZW50ID0gY2FsbGVlKHR5cGUsIG5hbWUsIGlzQnV0dG9uKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIGVsZW1lbnQ7XHJcblx0XHR9XHJcblx0XHRTeXMuVUkuVGVtcGxhdGUuX2lzVGVtcGxhdGUgPSBmdW5jdGlvbiBTeXMkVUkkVGVtcGxhdGUkX2lzVGVtcGxhdGUoZWxlbWVudCkge1xyXG5cdFx0XHR2YXIgY2xhc3NOYW1lID0gZWxlbWVudC5jbGFzc05hbWU7XHJcblx0XHRcdHJldHVybiAoY2xhc3NOYW1lICYmICgoY2xhc3NOYW1lID09PSBcInN5cy10ZW1wbGF0ZVwiKSB8fCAvKF58IClzeXNcXC10ZW1wbGF0ZSgkfCApLy50ZXN0KGNsYXNzTmFtZSkpKTtcclxuXHRcdH1cclxuXHRcdFN5cy5VSS5UZW1wbGF0ZS5faW5wdXRSZXF1aXJlZEF0dHJpYnV0ZXMgPSB7IFwidHlwZVwiOiAxLCBcIm5hbWVcIjogMSwgXCJzeXM6dHlwZVwiOiAxLCBcInN5czpuYW1lXCI6IDEgfTtcclxuXHJcblxyXG5cclxuXHJcblxyXG5cdFx0U3lzLlVJLlRlbXBsYXRlLl9jb21tb25Cb29sZWFuQXR0cmlidXRlcyA9IHsgZGlzYWJsZWQ6IHRydWUsIFwiIGxpc3RcIjogW1wiZGlzYWJsZWRcIl0gfTtcclxuXHRcdFN5cy5VSS5UZW1wbGF0ZS5faW5wdXRCb29sZWFuQXR0cmlidXRlcyA9XHJcblx0eyBkaXNhYmxlZDogdHJ1ZSwgY2hlY2tlZDogdHJ1ZSwgcmVhZG9ubHk6IHRydWUsXHJcblx0XHRcIiBsaXN0XCI6IFtcImRpc2FibGVkXCIsIFwiY2hlY2tlZFwiLCBcInJlYWRvbmx5XCJdXHJcblx0fTtcclxuXHRcdFN5cy5VSS5UZW1wbGF0ZS5fYm9vbGVhbkF0dHJpYnV0ZXMgPSB7XHJcblx0XHRcdFwiaW5wdXRcIjogU3lzLlVJLlRlbXBsYXRlLl9pbnB1dEJvb2xlYW5BdHRyaWJ1dGVzLFxyXG5cdFx0XHRcInNlbGVjdFwiOiB7IGRpc2FibGVkOiB0cnVlLCBtdWx0aXBsZTogdHJ1ZSwgXCIgbGlzdFwiOiBbXCJkaXNhYmxlZFwiLCBcIm11bHRpcGxlXCJdIH0sXHJcblx0XHRcdFwib3B0aW9uXCI6IHsgZGlzYWJsZWQ6IHRydWUsIHNlbGVjdGVkOiB0cnVlLCBcIiBsaXN0XCI6IFtcImRpc2FibGVkXCIsIFwic2VsZWN0ZWRcIl0gfSxcclxuXHRcdFx0XCJpbWdcIjogeyBkaXNhYmxlZDogdHJ1ZSwgaXNtYXA6IHRydWUsIFwiIGxpc3RcIjogW1wiZGlzYWJsZWRcIiwgXCJpc21hcFwiXSB9LFxyXG5cdFx0XHRcInRleHRhcmVhXCI6IHsgZGlzYWJsZWQ6IHRydWUsIHJlYWRvbmx5OiB0cnVlLCBcIiBsaXN0XCI6IFtcImRpc2FibGVkXCIsIFwicmVhZG9ubHlcIl0gfVxyXG5cdFx0fTtcclxuXHRcdFN5cy5VSS5UZW1wbGF0ZS5fZXhwcmVzc2lvblJlZ0V4cCA9IC9cXHtcXHtcXHMqKFtcXHdcXFddKj8pXFxzKlxcfVxcfS9nO1xyXG5cdFx0U3lzLlVJLlRlbXBsYXRlLmFsbG93ZWRQcm90b2NvbHMgPSBbXHJcblx0XCJodHRwXCIsXHJcblx0XCJodHRwc1wiLFxyXG5cdFwiZGF0YVwiXHJcbl07XHJcblx0XHRTeXMuVUkuVGVtcGxhdGUucmVzdHJpY3RlZEF0dHJpYnV0ZXMgPSBbXHJcblx0XCJzcmNcIixcclxuXHRcImhyZWZcIixcclxuXHRcImNvZGViYXNlXCIsXHJcblx0XCJjaXRlXCIsXHJcblx0XCJiYWNrZ3JvdW5kXCIsXHJcblx0XCJhY3Rpb25cIixcclxuXHRcImxvbmdkZXNjXCIsXHJcblx0XCJwcm9maWxlXCIsXHJcblx0XCJ1c2VtYXBcIixcclxuXHRcImNsYXNzaWRcIixcclxuXHRcImRhdGFcIlxyXG5dO1xyXG5cdFx0U3lzLlVJLlRlbXBsYXRlLl9nZXRSZXN0cmljdGVkSW5kZXggPSBmdW5jdGlvbiBTeXMkVUkkVGVtcGxhdGUkX2dldFJlc3RyaWN0ZWRJbmRleCgpIHtcclxuXHRcdFx0dmFyIGksIGwsIHByb3RvY29sSW5kZXgsIGF0dHJpYnV0ZUluZGV4LFxyXG5cdFx0cHJvdG9jb2xzID0gU3lzLlVJLlRlbXBsYXRlLmFsbG93ZWRQcm90b2NvbHMgfHwgW10sXHJcblx0XHRhdHRyaWJ1dGVzID0gU3lzLlVJLlRlbXBsYXRlLnJlc3RyaWN0ZWRBdHRyaWJ1dGVzIHx8IFtdLFxyXG5cdFx0aW5kZXggPSBTeXMuVUkuVGVtcGxhdGUuX3Jlc3RyaWN0ZWRJbmRleDtcclxuXHRcdFx0aWYgKCFpbmRleCB8fCAoaW5kZXguYWxsb3dlZFByb3RvY29scyAhPT0gcHJvdG9jb2xzKSB8fCAoaW5kZXgucmVzdHJpY3RlZEF0dHJpYnV0ZXMgIT09IGF0dHJpYnV0ZXMpKSB7XHJcblx0XHRcdFx0aW5kZXggPSB7IGFsbG93ZWRQcm90b2NvbHM6IHByb3RvY29scywgcmVzdHJpY3RlZEF0dHJpYnV0ZXM6IGF0dHJpYnV0ZXMgfTtcclxuXHRcdFx0XHRpbmRleC5wcm90b2NvbHMgPSBwcm90b2NvbEluZGV4ID0ge307XHJcblx0XHRcdFx0Zm9yIChpID0gMCwgbCA9IHByb3RvY29scy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuXHRcdFx0XHRcdHByb3RvY29sSW5kZXhbcHJvdG9jb2xzW2ldXSA9IHRydWU7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGluZGV4LmF0dHJpYnV0ZXMgPSBhdHRyaWJ1dGVJbmRleCA9IHt9O1xyXG5cdFx0XHRcdGZvciAoaSA9IDAsIGwgPSBhdHRyaWJ1dGVzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG5cdFx0XHRcdFx0YXR0cmlidXRlSW5kZXhbYXR0cmlidXRlc1tpXV0gPSB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRTeXMuVUkuVGVtcGxhdGUuX3Jlc3RyaWN0ZWRJbmRleCA9IGluZGV4O1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiBpbmRleDtcclxuXHRcdH1cclxuXHRcdFN5cy5VSS5UZW1wbGF0ZS5yZWdpc3RlckNsYXNzKFwiU3lzLlVJLlRlbXBsYXRlXCIsIG51bGwsIFN5cy5JRGlzcG9zYWJsZSk7XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHRcdFN5cy5VSS5UZW1wbGF0ZS5fcHJvdG9jb2xSZWdFeHAgPSAvXlxccyooW2EtekEtWjAtOVxcK1xcLVxcLl0rKVxcOi87XHJcblxyXG5cdFx0U3lzLlVJLlRlbXBsYXRlLmZpbmRDb250ZXh0ID0gZnVuY3Rpb24gU3lzJFVJJFRlbXBsYXRlJGZpbmRDb250ZXh0KGVsZW1lbnQpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5UZW1wbGF0ZS5maW5kQ29udGV4dFwiIC8+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cImVsZW1lbnRcIiBkb21FbGVtZW50PVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0XHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiU3lzLlVJLlRlbXBsYXRlQ29udGV4dFwiPjwvcmV0dXJucz5cclxuXHRcdFx0dmFyIHRjO1xyXG5cdFx0XHRkbyB7XHJcblx0XHRcdFx0dGMgPSBTeXMuVUkuVGVtcGxhdGVDb250ZXh0Ll9jb250ZXh0c1tlbGVtZW50Ll9fbXN0Y2luZGV4XTtcclxuXHRcdFx0XHRlbGVtZW50ID0gZWxlbWVudC5wYXJlbnROb2RlO1xyXG5cdFx0XHR9IHdoaWxlICghdGMgJiYgZWxlbWVudCk7XHJcblx0XHRcdHJldHVybiB0YyB8fCBTeXMuQXBwbGljYXRpb24uZ2V0X3RlbXBsYXRlQ29udGV4dCgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdFN5cy5fQXBwbGljYXRpb24ucHJvdG90eXBlLmdldF90ZW1wbGF0ZUNvbnRleHQgPSBmdW5jdGlvbiBTeXMkX0FwcGxpY2F0aW9uJGdldF90ZW1wbGF0ZUNvbnRleHQoKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuX0FwcGxpY2F0aW9uLmdldF90ZW1wbGF0ZUNvbnRleHRcIiAvPlxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fY29udGV4dCB8fCBudWxsO1xyXG5cdFx0fVxyXG5cclxuXHJcblxyXG5cdFx0U3lzLl9BcHBsaWNhdGlvbi5wcm90b3R5cGUuX2Jhc2VEaXNwb3NlID0gU3lzLl9BcHBsaWNhdGlvbi5wcm90b3R5cGUuZGlzcG9zZTtcclxuXHRcdFN5cy5fQXBwbGljYXRpb24ucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiBTeXMkX0FwcGxpY2F0aW9uJGRpc3Bvc2UoKSB7XHJcblx0XHRcdHZhciBjdHggPSB0aGlzLl9jb250ZXh0O1xyXG5cdFx0XHRpZiAoY3R4KSBjdHguZGlzcG9zZSgpO1xyXG5cdFx0XHR0aGlzLl9jb250ZXh0ID0gbnVsbDtcclxuXHRcdFx0dGhpcy5fYmFzZURpc3Bvc2UoKTtcclxuXHRcdH1cclxuXHJcblx0XHRTeXMuX0FwcGxpY2F0aW9uLnByb3RvdHlwZS5yZW1vdmVDb21wb25lbnQgPSBmdW5jdGlvbiBTeXMkX0FwcGxpY2F0aW9uJHJlbW92ZUNvbXBvbmVudChjb21wb25lbnQpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5fQXBwbGljYXRpb24ucmVtb3ZlQ29tcG9uZW50XCIgLz5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwiY29tcG9uZW50XCIgdHlwZT1cIlN5cy5Db21wb25lbnRcIj48L3BhcmFtPlxyXG5cdFx0XHR2YXIgaWQgPSBjb21wb25lbnQuZ2V0X2lkKCk7XHJcblx0XHRcdGlmIChpZCkgZGVsZXRlIHRoaXMuX2NvbXBvbmVudHNbaWRdO1xyXG5cdFx0XHR2YXIgY3R4ID0gdGhpcy5fY29udGV4dDtcclxuXHRcdFx0aWYgKGN0eCkge1xyXG5cdFx0XHRcdHZhciB0YyA9IGNvbXBvbmVudC5fX3RjO1xyXG5cdFx0XHRcdGlmICh0YyAmJiB0Y1swXSA9PT0gY3R4Ll90Y2luZGV4KSB7XHJcblx0XHRcdFx0XHRkZWxldGUgY3R4LmNvbXBvbmVudHNbdGNbMV1dO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0U3lzLlVJLlRlbXBsYXRlQ29udGV4dCA9IGZ1bmN0aW9uIFN5cyRVSSRUZW1wbGF0ZUNvbnRleHQodGNpbmRleCkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLlRlbXBsYXRlQ29udGV4dC4jY3RvclwiIC8+XHJcblx0XHRcdC8vLyA8ZmllbGQgbmFtZT1cImRhdGFcIiBsb2NpZD1cIkY6SiNTeXMuVUkuVGVtcGxhdGVDb250ZXh0LmRhdGFcIj48L2ZpZWxkPlxyXG5cdFx0XHQvLy8gPGZpZWxkIG5hbWU9XCJkYXRhSXRlbVwiIGxvY2lkPVwiRjpKI1N5cy5VSS5UZW1wbGF0ZUNvbnRleHQuZGF0YUl0ZW1cIj48L2ZpZWxkPlxyXG5cdFx0XHQvLy8gPGZpZWxkIG5hbWU9XCJpbmRleFwiIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiIGxvY2lkPVwiRjpKI1N5cy5VSS5UZW1wbGF0ZUNvbnRleHQuaW5kZXhcIj48L2ZpZWxkPlxyXG5cdFx0XHQvLy8gPGZpZWxkIG5hbWU9XCJnZXRJbnN0YW5jZUlkXCIgdHlwZT1cIkZ1bmN0aW9uXCIgbG9jaWQ9XCJGOkojU3lzLlVJLlRlbXBsYXRlQ29udGV4dC5nZXRJbnN0YW5jZUlkXCI+PC9maWVsZD5cclxuXHRcdFx0Ly8vIDxmaWVsZCBuYW1lPVwicGFyZW50Q29udGV4dFwiIHR5cGU9XCJTeXMuVUkuVGVtcGxhdGVDb250ZXh0XCIgbG9jaWQ9XCJGOkojU3lzLlVJLlRlbXBsYXRlQ29udGV4dC5wYXJlbnRDb250ZXh0XCI+PC9maWVsZD5cclxuXHRcdFx0Ly8vIDxmaWVsZCBuYW1lPVwiY29udGFpbmVyRWxlbWVudFwiIGRvbUVsZW1lbnQ9XCJ0cnVlXCIgbG9jaWQ9XCJGOkojU3lzLlVJLlRlbXBsYXRlQ29udGV4dC5jb250YWluZXJFbGVtZW50XCI+PC9maWVsZD5cclxuXHRcdFx0Ly8vIDxmaWVsZCBuYW1lPVwiY29tcG9uZW50c1wiIHR5cGU9XCJBcnJheVwiIGVsZW1lbnRUeXBlPVwiT2JqZWN0XCIgbG9jaWQ9XCJGOkojU3lzLlVJLlRlbXBsYXRlQ29udGV4dC5jb21wb25lbnRzXCI+PC9maWVsZD5cclxuXHRcdFx0Ly8vIDxmaWVsZCBuYW1lPVwibm9kZXNcIiB0eXBlPVwiQXJyYXlcIiBlbGVtZW50RG9tRWxlbWVudD1cInRydWVcIiBsb2NpZD1cIkY6SiNTeXMuVUkuVGVtcGxhdGVDb250ZXh0Lm5vZGVzXCI+PC9maWVsZD5cclxuXHRcdFx0dmFyIGluZGV4ID0gdGhpcy5fdGNpbmRleCA9IHRjaW5kZXggfHwgU3lzLlVJLlRlbXBsYXRlQ29udGV4dC5fdGNpbmRleCsrO1xyXG5cdFx0XHRTeXMuVUkuVGVtcGxhdGVDb250ZXh0Ll9jb250ZXh0c1tpbmRleF0gPSB0aGlzO1xyXG5cdFx0XHR0aGlzLl9jb21wbGV0ZWQgPSBbXTtcclxuXHRcdFx0U3lzLlVJLlRlbXBsYXRlQ29udGV4dC5pbml0aWFsaXplQmFzZSh0aGlzKTtcclxuXHRcdH1cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJFRlbXBsYXRlQ29udGV4dCRkaXNwb3NlKCkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLlRlbXBsYXRlQ29udGV4dC5kaXNwb3NlXCIgLz5cclxuXHRcdFx0aWYgKCF0aGlzLl9nbG9iYWwpIHtcclxuXHRcdFx0XHR2YXIgbm9kZXMgPSB0aGlzLm5vZGVzO1xyXG5cdFx0XHRcdGlmIChub2Rlcykge1xyXG5cdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDAsIGwgPSBub2Rlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuXHRcdFx0XHRcdFx0dmFyIGVsZW1lbnQgPSBub2Rlc1tpXTtcclxuXHRcdFx0XHRcdFx0aWYgKGVsZW1lbnQubm9kZVR5cGUgPT09IDEpIHtcclxuXHRcdFx0XHRcdFx0XHRTeXMuQXBwbGljYXRpb24uZGlzcG9zZUVsZW1lbnQoZWxlbWVudCwgZmFsc2UpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHZhciBjb21wb25lbnRzID0gdGhpcy5jb21wb25lbnRzO1xyXG5cdFx0XHRcdGlmIChjb21wb25lbnRzKSB7XHJcblx0XHRcdFx0XHRmb3IgKHZhciBpID0gMCwgbCA9IGNvbXBvbmVudHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XHJcblx0XHRcdFx0XHRcdGRlbGV0ZSBjb21wb25lbnRzW2ldLl9fdGM7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGRlbGV0ZSBTeXMuVUkuVGVtcGxhdGVDb250ZXh0Ll9jb250ZXh0c1t0aGlzLl90Y2luZGV4XTtcclxuXHRcdFx0dGhpcy5ub2RlcyA9IHRoaXMuZGF0YUl0ZW0gPSB0aGlzLmNvbXBvbmVudHMgPSB0aGlzLmdldEluc3RhbmNlSWQgPVxyXG5cdFx0dGhpcy5jb250YWluZXJFbGVtZW50ID0gdGhpcy5pbnNlcnRCZWZvcmVOb2RlID0gdGhpcy5wYXJlbnRDb250ZXh0ID0gdGhpcy5kYXRhID0gbnVsbDtcclxuXHRcdFx0dGhpcy5pc0Rpc3Bvc2VkID0gdHJ1ZTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSRUZW1wbGF0ZUNvbnRleHQkcXVlcnkoc2VsZWN0b3IpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2ZpbmQoc2VsZWN0b3IpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJFRlbXBsYXRlQ29udGV4dCRnZXQoc2VsZWN0b3IpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2ZpbmQoc2VsZWN0b3IsIHRydWUpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJFRlbXBsYXRlQ29udGV4dCRfZmluZChzZWxlY3Rvciwgc2luZ2xlKSB7XHJcblx0XHRcdHJldHVybiAvXlsjXFwkXShcXHd8WyQ6XFwuXFwtXSkrJC8udGVzdChzZWxlY3RvcikgP1xyXG5cdFx0XHR0aGlzLl9maW5kQnlJZChzZWxlY3Rvci5zdWJzdHIoMCwgMSksIHNlbGVjdG9yLnN1YnN0cigxKSwgc2luZ2xlKSA6XHJcblx0XHRcdFN5cy5fZmluZChzZWxlY3RvciwgdGhpcy5ub2Rlcywgc2luZ2xlKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSRUZW1wbGF0ZUNvbnRleHQkX2ZpbmRCeUlkKGtpbmQsIGlkLCBzaW5nbGUpIHtcclxuXHRcdFx0dmFyIGVsZW1lbnQgPSBudWxsO1xyXG5cdFx0XHRmb3IgKHZhciBjb250ZXh0ID0gdGhpczsgIWVsZW1lbnQgJiYgY29udGV4dDsgY29udGV4dCA9IGNvbnRleHQucGFyZW50Q29udGV4dCkge1xyXG5cdFx0XHRcdHZhciBub2RlcyA9IGNvbnRleHQubm9kZXMsXHJcblx0XHRcdFx0aW5zdGFuY2VJZCA9IGtpbmQgKyBjb250ZXh0LmdldEluc3RhbmNlSWQoaWQpO1xyXG5cdFx0XHRcdGlmIChjb250ZXh0Ll9nbG9iYWwpIHtcclxuXHRcdFx0XHRcdGVsZW1lbnQgPSBTeXMuZ2V0KGluc3RhbmNlSWQpIHx8IFN5cy5nZXQoaW5zdGFuY2VJZCwgbm9kZXMpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdGVsZW1lbnQgPSBTeXMuZ2V0KGluc3RhbmNlSWQsIG5vZGVzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxlbWVudCA9IGVsZW1lbnQgfHwgU3lzLmdldChraW5kICsgaWQpO1xyXG5cdFx0XHRyZXR1cm4gc2luZ2xlID8gZWxlbWVudCA6IChlbGVtZW50ID8gW2VsZW1lbnRdIDogW10pO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJFRlbXBsYXRlQ29udGV4dCRnZXRJbnN0YW5jZUlkKHByZWZpeCkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLlRlbXBsYXRlQ29udGV4dC5nZXRJbnN0YW5jZUlkXCIgLz5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwicHJlZml4XCIgdHlwZT1cIlN0cmluZ1wiPjwvcGFyYW0+XHJcblx0XHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiU3RyaW5nXCI+PC9yZXR1cm5zPlxyXG5cdFx0XHRyZXR1cm4gcHJlZml4ICsgKHRoaXMuX2dsb2JhbCA/IFwiXCIgOiB0aGlzLl90Y2luZGV4KTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSRUZW1wbGF0ZUNvbnRleHQkaW5pdGlhbGl6ZUNvbXBvbmVudHMoKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuVGVtcGxhdGVDb250ZXh0LmluaXRpYWxpemVDb21wb25lbnRzXCIgLz5cclxuXHRcdFx0dmFyIGNvbXBvbmVudHMgPSB0aGlzLmNvbXBvbmVudHM7XHJcblx0XHRcdGlmIChjb21wb25lbnRzKSB7XHJcblx0XHRcdFx0dmFyIGkgPSBjb21wb25lbnRzLmxlbmd0aCAtIDEsIGluZGV4ID0gdGhpcy5fbGFzdEluZGV4O1xyXG5cdFx0XHRcdHRoaXMuX2xhc3RJbmRleCA9IGk7XHJcblx0XHRcdFx0Zm9yICg7IGkgPiBpbmRleDsgaS0tKSB7XHJcblx0XHRcdFx0XHR2YXIgY29tcG9uZW50ID0gY29tcG9uZW50c1tpXTtcclxuXHRcdFx0XHRcdGlmIChjb21wb25lbnQgJiYgU3lzLkNvbXBvbmVudC5pc0luc3RhbmNlT2ZUeXBlKGNvbXBvbmVudCkpIHtcclxuXHRcdFx0XHRcdFx0aWYgKGNvbXBvbmVudC5nZXRfaXNVcGRhdGluZygpKSB7XHJcblx0XHRcdFx0XHRcdFx0Y29tcG9uZW50LmVuZFVwZGF0ZSgpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGVsc2UgaWYgKCFjb21wb25lbnQuZ2V0X2lzSW5pdGlhbGl6ZWQoKSkge1xyXG5cdFx0XHRcdFx0XHRcdGNvbXBvbmVudC5pbml0aWFsaXplKCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSRUZW1wbGF0ZUNvbnRleHQkYWRkX2luc3RhbnRpYXRlZChoYW5kbGVyKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIkU6SiNTeXMuVUkuRGF0YVZpZXdUZW1wbGF0ZUNvbnRleHQuaW5zdGFudGlhdGVkXCIgLz5cclxuXHRcdFx0U3lzLk9ic2VydmVyLmFkZEV2ZW50SGFuZGxlcih0aGlzLCBcImluc3RhbnRpYXRlZFwiLCBoYW5kbGVyKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSRUZW1wbGF0ZUNvbnRleHQkcmVtb3ZlX2luc3RhbnRpYXRlZChoYW5kbGVyKSB7XHJcblx0XHRcdFN5cy5PYnNlcnZlci5yZW1vdmVFdmVudEhhbmRsZXIodGhpcywgXCJpbnN0YW50aWF0ZWRcIiwgaGFuZGxlcik7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkVGVtcGxhdGVDb250ZXh0JF9vbkluc3RhbnRpYXRlZChyZWZlcmVuY2VOb2RlLCBsZWF2ZUluUGxhY2UpIHtcclxuXHRcdFx0Zm9yZWFjaCh0aGlzLl9jb21wbGV0ZWQsIGZ1bmN0aW9uIChjYWxsYmFjaykge1xyXG5cdFx0XHRcdGNhbGxiYWNrKCk7XHJcblx0XHRcdH0pO1xyXG5cdFx0XHR0aGlzLl9jb21wbGV0ZWQgPSBbXTtcclxuXHRcdFx0aWYgKCFsZWF2ZUluUGxhY2UpIHtcclxuXHRcdFx0XHR2YXIgY29udGFpbmVyID0gdGhpcy5jb250YWluZXJFbGVtZW50O1xyXG5cdFx0XHRcdGZvcmVhY2godGhpcy5ub2RlcywgZnVuY3Rpb24gKG5vZGUpIHtcclxuXHRcdFx0XHRcdGNvbnRhaW5lci5pbnNlcnRCZWZvcmUobm9kZSwgcmVmZXJlbmNlTm9kZSB8fCBudWxsKTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRTeXMuT2JzZXJ2ZXIucmFpc2VFdmVudCh0aGlzLCBcImluc3RhbnRpYXRlZFwiKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSRUZW1wbGF0ZUNvbnRleHQkX3JlZ2lzdGVyQ29tcG9uZW50KGNvbXBvbmVudCkge1xyXG5cdFx0XHR2YXIgY29tcG9uZW50cyA9IHRoaXMuY29tcG9uZW50cztcclxuXHRcdFx0Y29tcG9uZW50Ll9fdGMgPSBbdGhpcy5fdGNpbmRleCwgY29tcG9uZW50cy5sZW5ndGhdO1xyXG5cdFx0XHRjb21wb25lbnRzLnB1c2goY29tcG9uZW50KTtcclxuXHRcdFx0U3lzLkNvbXBvbmVudC5fcmVnaXN0ZXIoY29tcG9uZW50LCBudWxsLCB0cnVlKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSRUZW1wbGF0ZUNvbnRleHQkX3JlZ2lzdGVySWYocmVzdWx0KSB7XHJcblx0XHRcdGlmIChyZXN1bHQgaW5zdGFuY2VvZiBBcnJheSkge1xyXG5cdFx0XHRcdGZvciAodmFyIGkgPSAwLCBsID0gcmVzdWx0Lmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG5cdFx0XHRcdFx0dGhpcy5fcmVnaXN0ZXJDb21wb25lbnQocmVzdWx0W2ldKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAocmVzdWx0ICYmIHR5cGVvZiAocmVzdWx0KSA9PT0gJ29iamVjdCcpIHtcclxuXHRcdFx0XHR0aGlzLl9yZWdpc3RlckNvbXBvbmVudChyZXN1bHQpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRTeXMuVUkuVGVtcGxhdGVDb250ZXh0LnByb3RvdHlwZSA9IHtcclxuXHRcdFx0ZGF0YTogbnVsbCxcclxuXHRcdFx0ZGF0YUl0ZW06IG51bGwsXHJcblx0XHRcdGluZGV4OiAwLFxyXG5cdFx0XHRwYXJlbnRDb250ZXh0OiBudWxsLFxyXG5cdFx0XHRjb250YWluZXJFbGVtZW50OiBudWxsLFxyXG5cdFx0XHRpbnNlcnRCZWZvcmVOb2RlOiBudWxsLFxyXG5cdFx0XHRjb21wb25lbnRzOiBudWxsLFxyXG5cdFx0XHRub2RlczogbnVsbCxcclxuXHRcdFx0aXNEaXNwb3NlZDogZmFsc2UsXHJcblx0XHRcdF9sYXN0SW5kZXg6IC0xLFxyXG5cdFx0XHRkaXNwb3NlOiBTeXMkVUkkVGVtcGxhdGVDb250ZXh0JGRpc3Bvc2UsXHJcblx0XHRcdHF1ZXJ5OiBTeXMkVUkkVGVtcGxhdGVDb250ZXh0JHF1ZXJ5LFxyXG5cdFx0XHRnZXQ6IFN5cyRVSSRUZW1wbGF0ZUNvbnRleHQkZ2V0LFxyXG5cdFx0XHRfZmluZDogU3lzJFVJJFRlbXBsYXRlQ29udGV4dCRfZmluZCxcclxuXHRcdFx0X2ZpbmRCeUlkOiBTeXMkVUkkVGVtcGxhdGVDb250ZXh0JF9maW5kQnlJZCxcclxuXHRcdFx0Z2V0SW5zdGFuY2VJZDogU3lzJFVJJFRlbXBsYXRlQ29udGV4dCRnZXRJbnN0YW5jZUlkLFxyXG5cdFx0XHRpbml0aWFsaXplQ29tcG9uZW50czogU3lzJFVJJFRlbXBsYXRlQ29udGV4dCRpbml0aWFsaXplQ29tcG9uZW50cyxcclxuXHRcdFx0YWRkX2luc3RhbnRpYXRlZDogU3lzJFVJJFRlbXBsYXRlQ29udGV4dCRhZGRfaW5zdGFudGlhdGVkLFxyXG5cdFx0XHRyZW1vdmVfaW5zdGFudGlhdGVkOiBTeXMkVUkkVGVtcGxhdGVDb250ZXh0JHJlbW92ZV9pbnN0YW50aWF0ZWQsXHJcblx0XHRcdF9vbkluc3RhbnRpYXRlZDogU3lzJFVJJFRlbXBsYXRlQ29udGV4dCRfb25JbnN0YW50aWF0ZWQsXHJcblx0XHRcdF9yZWdpc3RlckNvbXBvbmVudDogU3lzJFVJJFRlbXBsYXRlQ29udGV4dCRfcmVnaXN0ZXJDb21wb25lbnQsXHJcblx0XHRcdF9yZWdpc3RlcklmOiBTeXMkVUkkVGVtcGxhdGVDb250ZXh0JF9yZWdpc3RlcklmXHJcblx0XHR9XHJcblx0XHRTeXMuVUkuVGVtcGxhdGVDb250ZXh0LnJlZ2lzdGVyQ2xhc3MoXCJTeXMuVUkuVGVtcGxhdGVDb250ZXh0XCIsIG51bGwsIFN5cy5JRGlzcG9zYWJsZSk7XHJcblx0XHRTeXMuVUkuVGVtcGxhdGVDb250ZXh0Ll90Y2luZGV4ID0gMDtcclxuXHRcdFN5cy5VSS5UZW1wbGF0ZUNvbnRleHQuX2NvbnRleHRzID0gW107XHJcblx0XHRTeXMuVUkuSVRlbXBsYXRlQ29udGV4dENvbnN1bWVyID0gZnVuY3Rpb24gU3lzJFVJJElUZW1wbGF0ZUNvbnRleHRDb25zdW1lcigpIHtcclxuXHRcdFx0dGhyb3cgRXJyb3Iubm90SW1wbGVtZW50ZWQoKTtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkSVRlbXBsYXRlQ29udGV4dENvbnN1bWVyJGdldF90ZW1wbGF0ZUNvbnRleHQoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgdHlwZT1cIlN5cy5VSS5UZW1wbGF0ZUNvbnRleHRcIiBtYXlCZU51bGw9XCJ0cnVlXCIgbG9jaWQ9XCJQOkojU3lzLlVJLklUZW1wbGF0ZUNvbnRleHRDb25zdW1lci50ZW1wbGF0ZUNvbnRleHRcIj48L3ZhbHVlPlxyXG5cdFx0XHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJElUZW1wbGF0ZUNvbnRleHRDb25zdW1lciRzZXRfdGVtcGxhdGVDb250ZXh0KHZhbHVlKSB7XHJcblx0XHRcdHRocm93IEVycm9yLm5vdEltcGxlbWVudGVkKCk7XHJcblx0XHR9XHJcblx0XHRTeXMuVUkuSVRlbXBsYXRlQ29udGV4dENvbnN1bWVyLnByb3RvdHlwZSA9IHtcclxuXHRcdFx0Z2V0X3RlbXBsYXRlQ29udGV4dDogU3lzJFVJJElUZW1wbGF0ZUNvbnRleHRDb25zdW1lciRnZXRfdGVtcGxhdGVDb250ZXh0LFxyXG5cdFx0XHRzZXRfdGVtcGxhdGVDb250ZXh0OiBTeXMkVUkkSVRlbXBsYXRlQ29udGV4dENvbnN1bWVyJHNldF90ZW1wbGF0ZUNvbnRleHRcclxuXHRcdH1cclxuXHRcdFN5cy5VSS5JVGVtcGxhdGVDb250ZXh0Q29uc3VtZXIucmVnaXN0ZXJJbnRlcmZhY2UoXCJTeXMuVUkuSVRlbXBsYXRlQ29udGV4dENvbnN1bWVyXCIpO1xyXG5cclxuXHRcdFN5cy5VSS5JQ29udGVudFRlbXBsYXRlQ29uc3VtZXIgPSBmdW5jdGlvbiBTeXMkVUkkSUNvbnRlbnRUZW1wbGF0ZUNvbnN1bWVyKCkge1xyXG5cdFx0XHR0aHJvdyBFcnJvci5ub3RJbXBsZW1lbnRlZCgpO1xyXG5cdFx0fTtcclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSRJQ29udGVudFRlbXBsYXRlQ29uc3VtZXIkYWRkQ29udGVudFRlbXBsYXRlKHRtcGwpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiU3RyaW5nXCIgbG9jaWQ9XCJNOkojU3lzLlVJLklDb250ZW50VGVtcGxhdGVDb25zdW1lci5hZGRDb250ZW50VGVtcGxhdGVcIj48L3ZhbHVlPlxyXG5cdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJiaW5kaW5nQ29udGV4dFwiIHR5cGU9XCJPYmplY3RcIiBvcHRpb25hbD1cImZhbHNlXCIgbWF5QmVOdWxsPVwiZmFsc2VcIj48L3BhcmFtPlxyXG5cdFx0XHRpZiAodG1wbC5jb25zdHJ1Y3RvciAhPT0gU3RyaW5nKSB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2QgXFxcImFkZENvbnRlbnRUZW1wbGF0ZVxcXCIgcmVxdWlyZXMgYW4gYXJndW1lbnQgb2YgdHlwZSBTdHJpbmcuXCIpO1xyXG5cdFx0XHRpZiAodG1wbC5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0aWYgKHRoaXMuX2NvbnRlbnRUZW1wbGF0ZSkge1xyXG5cdFx0XHRcdFx0dGhpcy5fY29udGVudFRlbXBsYXRlICs9IFwiIFwiO1xyXG5cdFx0XHRcdFx0dGhpcy5fY29udGVudFRlbXBsYXRlICs9IHRtcGw7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0dGhpcy5fY29udGVudFRlbXBsYXRlID0gdG1wbDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdFN5cy5VSS5JQ29udGVudFRlbXBsYXRlQ29uc3VtZXIucHJvdG90eXBlID0ge1xyXG5cdFx0XHRhZGRDb250ZW50VGVtcGxhdGU6IFN5cyRVSSRJQ29udGVudFRlbXBsYXRlQ29uc3VtZXIkYWRkQ29udGVudFRlbXBsYXRlXHJcblx0XHR9O1xyXG5cdFx0U3lzLlVJLklDb250ZW50VGVtcGxhdGVDb25zdW1lci5yZWdpc3RlckludGVyZmFjZShcIlN5cy5VSS5JQ29udGVudFRlbXBsYXRlQ29uc3VtZXJcIik7XHJcblxyXG5cdFx0U3lzLkFwcGxpY2F0aW9uLl9jYXNlSW5kZXggPSB7fTtcclxuXHJcblx0XHRTeXMuQXBwbGljYXRpb24uX3Byb3RvdHlwZUluZGV4ID0ge307XHJcblxyXG5cdFx0U3lzLkFwcGxpY2F0aW9uLl9jb250ZXh0ID0gbmV3IFN5cy5VSS5UZW1wbGF0ZUNvbnRleHQoKTtcclxuXHRcdFN5cy5BcHBsaWNhdGlvbi5fY29udGV4dC5fZ2xvYmFsID0gdHJ1ZTtcclxuXHRcdFN5cy5BcHBsaWNhdGlvbi5fY29udGV4dC5yb290Q29udGV4dCA9IFN5cy5BcHBsaWNhdGlvbi5fY29udGV4dDtcclxuXHJcblx0XHRTeXMuQXBwbGljYXRpb24uYWN0aXZhdGVFbGVtZW50ID0gZnVuY3Rpb24gU3lzJEFwcGxpY2F0aW9uJGFjdGl2YXRlRWxlbWVudChlbGVtZW50LCBiaW5kaW5nQ29udGV4dCwgcmVjdXJzaXZlLCB1c2VHbG9iYWxDb250ZXh0LCB2bSkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLkFwcGxpY2F0aW9uLmFjdGl2YXRlRWxlbWVudFwiIC8+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cImVsZW1lbnRcIiBkb21FbGVtZW50PVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cImJpbmRpbmdDb250ZXh0XCIgdHlwZT1cIk9iamVjdFwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJyZWN1cnNpdmVcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJTeXMuVUkuVGVtcGxhdGVDb250ZXh0XCI+PC9yZXR1cm5zPlxyXG5cdFx0XHRyZXR1cm4gU3lzLkFwcGxpY2F0aW9uLmFjdGl2YXRlRWxlbWVudHMoZWxlbWVudCwgYmluZGluZ0NvbnRleHQgfHwgbnVsbCwgKHJlY3Vyc2l2ZSAhPT0gZmFsc2UpLCAodXNlR2xvYmFsQ29udGV4dCAhPT0gZmFsc2UpLCB2bSk7XHJcblx0XHR9O1xyXG5cclxuXHRcdFN5cy5BcHBsaWNhdGlvbi5hY3RpdmF0ZUVsZW1lbnRzID0gZnVuY3Rpb24gU3lzJEFwcGxpY2F0aW9uJGFjdGl2YXRlRWxlbWVudHMoZWxlbWVudHMsIGJpbmRpbmdDb250ZXh0LCByZWN1cnNpdmUsIHVzZUdsb2JhbENvbnRleHQsIHZtKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuQXBwbGljYXRpb24uYWN0aXZhdGVFbGVtZW50c1wiIC8+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cImVsZW1lbnRzXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwiYmluZGluZ0NvbnRleHRcIiBvcHRpb25hbD1cInRydWVcIiBtYXlCZU51bGw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwicmVjdXJzaXZlXCIgb3B0aW9uYWw9XCJ0cnVlXCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0XHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiU3lzLlVJLlRlbXBsYXRlQ29udGV4dFwiPjwvcmV0dXJucz5cclxuXHRcdFx0dmFyIGFwcCA9IFN5cy5BcHBsaWNhdGlvbixcclxuXHRcdFx0XHR0YyA9IHVzZUdsb2JhbENvbnRleHQgPT09IGZhbHNlID8gbmV3IFN5cy5VSS5UZW1wbGF0ZUNvbnRleHQoKSA6IGFwcC5fY29udGV4dCxcclxuXHRcdFx0XHR1c2VEaXJlY3QgPSBpc0Jyb3dzZXIoXCJJbnRlcm5ldEV4cGxvcmVyXCIpICYmIFN5cy5Ccm93c2VyLnZlcnNpb24gPCA5O1xyXG5cdFx0XHR0Yy5kYXRhSXRlbSA9IHRjLmRhdGEgPSB0eXBlb2YgKGJpbmRpbmdDb250ZXh0KSA9PT0gXCJ1bmRlZmluZWRcIiA/IG51bGwgOiBiaW5kaW5nQ29udGV4dDtcclxuXHRcdFx0dGMucm9vdENvbnRleHQgPSB0YztcclxuXHRcdFx0dGMudm0gPSB2bTtcclxuXHRcdFx0dGMuY29tcG9uZW50cyA9IHRjLmNvbXBvbmVudHMgfHwgW107XHJcblx0XHRcdHRjLm5vZGVzID0gZWxlbWVudHM7XHJcblx0XHRcdHJlY3Vyc2l2ZSA9IChyZWN1cnNpdmUgIT09IGZhbHNlKTtcclxuXHRcdFx0U3lzLl9xdWVyeUFsbChlbGVtZW50cywgZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuXHRcdFx0XHRhcHAuX2FjdGl2YXRlRWxlbWVudChlbGVtZW50LCB0YywgdXNlRGlyZWN0LCBudWxsLCByZWN1cnNpdmUpO1xyXG5cdFx0XHR9KTtcclxuXHRcdFx0dGMuaW5pdGlhbGl6ZUNvbXBvbmVudHMoKTtcclxuXHRcdFx0dGMuX29uSW5zdGFudGlhdGVkKG51bGwsIHRydWUpO1xyXG5cdFx0XHRyZXR1cm4gdGM7XHJcblx0XHR9O1xyXG5cclxuXHRcdFN5cy5yZWdpc3RlclBsdWdpbih7XHJcblx0XHRcdG5hbWU6IFwiYWN0aXZhdGVFbGVtZW50c1wiLFxyXG5cdFx0XHRwbHVnaW46IFN5cy5BcHBsaWNhdGlvbi5hY3RpdmF0ZUVsZW1lbnRzLFxyXG5cdFx0XHRyZXR1cm5UeXBlOiBcIlN5cy5VSS5UZW1wbGF0ZUNvbnRleHRcIixcclxuXHRcdFx0cGFyYW1ldGVyczogW1xyXG5cdFx0eyBuYW1lOiBcImVsZW1lbnRzXCIsIGRlc2NyaXB0aW9uOiBcIlRoZSBlbGVtZW50IG9yIGFycmF5IG9mIGVsZW1lbnRzIHRvIGFjdGl2YXRlLiBZb3UgbWF5IGFsc28gcGFzcyBET00gc2VsZWN0b3JzIG9yIGFycmF5IG9mIERPTSBzZWxlY3RvcnMuXCIgfSxcclxuXHRcdHsgbmFtZTogXCJiaW5kaW5nQ29udGV4dFwiLCBkZXNjcmlwdGlvbjogXCJUaGUgYmluZGluZyBjb250ZXh0LlwiIH0sXHJcblx0XHR7IG5hbWU6IFwicmVjdXJzaXZlXCIsIHR5cGU6IFwiQm9vbGVhblwiLCBkZXNjcmlwdGlvbjogXCJTcGVjaWZpZXMgd2hldGhlciBwcm9jZXNzaW5nIHNob3VsZCBvY2N1ciByZWN1cnNpdmVseS5cIiB9XHJcblx0XVxyXG5cdFx0fSk7XHJcblxyXG5cdFx0U3lzLkFwcGxpY2F0aW9uLl9maW5kVHlwZSA9IGZ1bmN0aW9uIFN5cyRBcHBsaWNhdGlvbiRfZmluZFR5cGUoZWxlbWVudCwgcHJlZml4LCB1c2VEaXJlY3QpIHtcclxuXHRcdFx0dmFyIGVyLCBlcnIsIHR5cGUsIHhtbG5zID0gXCJ4bWxuczpcIiArIHByZWZpeDtcclxuXHRcdFx0ZnVuY3Rpb24gZ2V0VHlwZSgpIHtcclxuXHRcdFx0XHR2YXIgbnM7XHJcblx0XHRcdFx0dHJ5IHsgbnMgPSB1c2VEaXJlY3QgPyBlbGVtZW50W3htbG5zXSA6IGVsZW1lbnQuZ2V0QXR0cmlidXRlKHhtbG5zKTsgfVxyXG5cdFx0XHRcdGNhdGNoIChlcikgeyB9XHJcblx0XHRcdFx0aWYgKG5zICYmIG5zLnN1YnN0cigwLCAxMSkgPT09IFwiamF2YXNjcmlwdDpcIikge1xyXG5cdFx0XHRcdFx0bnMgPSBucy5zdWJzdHIoMTEpO1xyXG5cdFx0XHRcdFx0dHlwZSA9IG51bGw7XHJcblx0XHRcdFx0XHR0cnkge1xyXG5cdFx0XHRcdFx0XHR0eXBlID0gVHlwZS5wYXJzZShucyk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRjYXRjaCAoZXIpIHtcclxuXHRcdFx0XHRcdFx0ZXJyID0gU3RyaW5nLmZvcm1hdChTeXMuVUkuVGVtcGxhdGVzUmVzLmludmFsaWRUeXBlTmFtZXNwYWNlLCBucyk7XHJcblx0XHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGlmICh0eXBlICYmIHR5cGUuX19jbGFzcykge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0dHlwZSA9IG5zO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRmb3IgKDsgZWxlbWVudDsgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSkge1xyXG5cdFx0XHRcdGdldFR5cGUoKTtcclxuXHRcdFx0XHRpZiAoZXJyKSB7XHJcblx0XHRcdFx0XHR0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKGVycik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGlmICh0eXBlKSByZXR1cm4gdHlwZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbGVtZW50ID0gZG9jdW1lbnQuYm9keTtcclxuXHRcdFx0Z2V0VHlwZSgpO1xyXG5cdFx0XHRpZiAoZXJyKSB7XHJcblx0XHRcdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihlcnIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiB0eXBlO1xyXG5cdFx0fVxyXG5cclxuXHRcdFN5cy5BcHBsaWNhdGlvbi5fYWN0aXZhdGVFbGVtZW50ID0gZnVuY3Rpb24gU3lzJEFwcGxpY2F0aW9uJF9hY3RpdmF0ZUVsZW1lbnQocGFyZW50LCB0ZW1wbGF0ZUNvbnRleHQsIHVzZURpcmVjdCwgcGFyZW50Q29udGVudFRlbXBsYXRlcywgcmVjdXJzaXZlKSB7XHJcblx0XHRcdGlmIChyZWN1cnNpdmUpIHtcclxuXHRcdFx0XHRyZWN1cnNpdmUgPSAhU3lzLlVJLlRlbXBsYXRlLl9pc1RlbXBsYXRlKHBhcmVudCk7XHJcblx0XHRcdH1cclxuXHRcdFx0dmFyIGkgPSAtMSxcclxuXHRcdGFsbEVsZW1lbnRzID0gcmVjdXJzaXZlID8gKHVzZURpcmVjdCA/IHBhcmVudC5hbGwgOiBwYXJlbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCIqXCIpKSA6IFtdLFxyXG5cdFx0aXNUZW1wbGF0ZSA9IC8oXnwgKXN5c1xcLXRlbXBsYXRlKCR8ICkvLFxyXG5cdFx0aXNJZ25vcmUgPSAvKF58IClzeXNcXC1pZ25vcmUoJHwgKS8sXHJcblx0XHRcdGV4cGFuZG9zQXJlTGFzdCA9IHVzZURpcmVjdCAmJiBTeXMuQnJvd3Nlci52ZXJzaW9uIDw9IDcsXHJcblx0XHRlbGVtZW50ID0gcGFyZW50O1xyXG5cdFx0XHRkbyB7XHJcblx0XHRcdFx0aWYgKGVsZW1lbnQubm9kZVR5cGUgIT09IDEpIGNvbnRpbnVlO1xyXG5cdFx0XHRcdC8vLy8vIHRoaXMgY29kZSBpcyBpbmxpbmUgcmF0aGVyIHRoYW4gZmFjdG9yZWQgb3V0IGludG8gYSBmdW5jdGlvbiBiZWNhdXNlXHJcblx0XHRcdFx0Ly8vLy8gcGVyZm9ybWFuY2UgdGVzdGluZyBoYXMgc2hvd24gdGhhdCBjYWxsaW5nIHRoZSBmYWN0b3JlZCBtZXRob2QgY2F1c2VzIGFjdGl2YXRpb25cclxuXHRcdFx0XHQvLy8vLyB0byBiZSBtZWFzdXJhYmx5IHNsb3dlciBpbiBJRSwgZHVlIHRvIHRoZSBvdmVyaGVhZCBvZiBpbnZva2luZyBhIGZ1bmN0aW9uLlxyXG5cdFx0XHRcdC8vLy8vIGJlZ2luIGVsZW1lbnQgYWN0aXZhdGlvblxyXG5cclxuXHRcdFx0XHR2YXIgZXJyLCBqLCBtLCB0eXBlTGlzdCA9IG51bGwsIGVudHJ5ID0gbnVsbCwgaW5kZXggPSBudWxsLCBmbkluZGV4ID0gbnVsbCwgY29udGVudFRlbXBsYXRlID0gbnVsbCxcclxuXHRcdFx0YWN0aXZhdGVkID0gZmFsc2UsXHJcblx0XHRcdG5vZGVOYW1lID0gbnVsbCxcclxuXHRcdFx0YXR0cmlidXRlcyA9IGVsZW1lbnQuYXR0cmlidXRlcyxcclxuXHRcdFx0YWxlbmd0aCA9IGF0dHJpYnV0ZXMubGVuZ3RoIC0gMSxcclxuXHRcdFx0YXR0cmlidXRlczIgPSBudWxsO1xyXG5cdFx0XHRcdGlmIChhbGVuZ3RoID49IDAgJiYgKCFleHBhbmRvc0FyZUxhc3QgfHwgYXR0cmlidXRlc1thbGVuZ3RoXS5leHBhbmRvKSAmJiAhZWxlbWVudC5fX21zYWpheGFjdGl2YXRlZCkge1xyXG5cdFx0XHRcdFx0Zm9yIChqID0gYWxlbmd0aDsgaiA+PSAwOyBqLS0pIHtcclxuXHRcdFx0XHRcdFx0dmFyIGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNbal07XHJcblx0XHRcdFx0XHRcdGlmIChleHBhbmRvc0FyZUxhc3QgJiYgIWF0dHJpYnV0ZS5leHBhbmRvKSBicmVhaztcclxuXHRcdFx0XHRcdFx0aWYgKCFhdHRyaWJ1dGUuc3BlY2lmaWVkIHx8IGF0dHJpYnV0ZS5ub2RlTmFtZS5pbmRleE9mKCc6JykgPCAwKSBjb250aW51ZTtcclxuXHRcdFx0XHRcdFx0YWN0aXZhdGVkID0gdHJ1ZTtcclxuXHRcdFx0XHRcdFx0bm9kZU5hbWUgPSBhdHRyaWJ1dGUubm9kZU5hbWU7XHJcblx0XHRcdFx0XHRcdHZhciB2YWx1ZSA9IGF0dHJpYnV0ZS5ub2RlVmFsdWU7XHJcblx0XHRcdFx0XHRcdHN3aXRjaCAobm9kZU5hbWUpIHtcclxuXHRcdFx0XHRcdFx0XHRjYXNlIFwic3lzOmF0dGFjaFwiOlxyXG5cdFx0XHRcdFx0XHRcdFx0dHlwZUxpc3QgPSB2YWx1ZS5zcGxpdCgnLCcpO1xyXG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRcdFx0Y2FzZSBcInN5czpjb21tYW5kXCI6XHJcblx0XHRcdFx0XHRcdFx0XHR2YXIgY29tbWFuZCA9IFN5cy5BcHBsaWNhdGlvbi5fZ2V0UHJvcGVydHlWYWx1ZShudWxsLCBudWxsLCBudWxsLCB2YWx1ZSwgdGVtcGxhdGVDb250ZXh0LCBlbGVtZW50LCBudWxsLCB0cnVlKTtcclxuXHRcdFx0XHRcdFx0XHRcdHZhciBjb21tYW5kQXJnID0gU3lzLkFwcGxpY2F0aW9uLl9nZXRDb21tYW5kQXR0cihlbGVtZW50LCB0ZW1wbGF0ZUNvbnRleHQsIFwic3lzOmNvbW1hbmRhcmd1bWVudFwiLCB1c2VEaXJlY3QpLFxyXG5cdFx0XHRcdFx0XHRjb21tYW5kVGFyZ2V0ID0gU3lzLkFwcGxpY2F0aW9uLl9nZXRDb21tYW5kQXR0cihlbGVtZW50LCB0ZW1wbGF0ZUNvbnRleHQsIFwic3lzOmNvbW1hbmR0YXJnZXRcIiwgdXNlRGlyZWN0KTtcclxuXHRcdFx0XHRcdFx0XHRcdFN5cy5VSS5Eb21FbGVtZW50LnNldENvbW1hbmQoZWxlbWVudCwgY29tbWFuZCB8fCBcIlwiLCBjb21tYW5kQXJnIHx8IG51bGwsIFN5cy5VSS5Eb21FbGVtZW50Ll9lbnN1cmVHZXQoY29tbWFuZFRhcmdldCwgdGVtcGxhdGVDb250ZXh0LCBcInN5czpjb21tYW5kdGFyZ2V0XCIpKTtcclxuXHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHRcdGNhc2UgXCJzeXM6Y29udGVudC10ZW1wbGF0ZVwiOlxyXG5cdFx0XHRcdFx0XHRcdFx0Y29udGVudFRlbXBsYXRlID0gU3lzLkFwcGxpY2F0aW9uLl9nZXRQcm9wZXJ0eVZhbHVlKG51bGwsIG51bGwsIG51bGwsIHZhbHVlLCB0ZW1wbGF0ZUNvbnRleHQsIGVsZW1lbnQsIG51bGwsIHRydWUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRcdFx0ZGVmYXVsdDpcclxuXHRcdFx0XHRcdFx0XHRcdGF0dHJpYnV0ZXMyID0gYXR0cmlidXRlczIgfHwgW107XHJcblx0XHRcdFx0XHRcdFx0XHRhdHRyaWJ1dGVzMi5wdXNoKGF0dHJpYnV0ZSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGlmIChjb250ZW50VGVtcGxhdGUgIT09IG51bGwgJiYgdHlwZUxpc3QgPT09IG51bGwpIHtcclxuXHRcdFx0XHRcdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihcImludmFsaWRTeXNDb250ZW50VGVtcGxhdGVcIik7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRpZiAoYWN0aXZhdGVkKSB7XHJcblx0XHRcdFx0XHRcdGVsZW1lbnQuX19tc2FqYXhhY3RpdmF0ZWQgPSB0cnVlO1xyXG5cdFx0XHRcdFx0XHRpZiAodHlwZUxpc3QpIHtcclxuXHRcdFx0XHRcdFx0XHRpbmRleCA9IHt9O1xyXG5cdFx0XHRcdFx0XHRcdGZvciAodmFyIGsgPSAwLCBuID0gdHlwZUxpc3QubGVuZ3RoOyBrIDwgbjsgaysrKSB7XHJcblx0XHRcdFx0XHRcdFx0XHR2YXIgdHlwZU5hbWUgPSB0eXBlTGlzdFtrXS50cmltKCk7XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoaW5kZXhbdHlwZU5hbWVdKSBjb250aW51ZTtcclxuXHRcdFx0XHRcdFx0XHRcdHZhciB0eXBlID0gU3lzLkFwcGxpY2F0aW9uLl9maW5kVHlwZShlbGVtZW50LCB0eXBlTmFtZSwgdXNlRGlyZWN0KTtcclxuXHRcdFx0XHRcdFx0XHRcdGlmICghdHlwZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN0cmluZy5mb3JtYXQoU3lzLlVJLlRlbXBsYXRlc1Jlcy5pbnZhbGlkQXR0YWNoLCBcInN5czphdHRhY2hcIiwgdHlwZU5hbWUpKTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdHZhciBwcm9wcyA9IG51bGwsIGlzQ29tcG9uZW50ID0gMCwgaXNDb250cm9sT3JCZWhhdmlvciA9IDAsIGlzQ29udGV4dCA9IDAsIGlzQ29udGVudFRlbXBsYXRlID0gMCxcclxuXHRcdFx0XHRcdFx0XHRpc0NsYXNzID0gKHR5cGVvZiAodHlwZSkgIT09IFwic3RyaW5nXCIpLFxyXG5cdFx0XHRcdFx0XHRcdGluc3RhbmNlID0gbnVsbDtcclxuXHRcdFx0XHRcdFx0XHRcdGlmIChpc0NsYXNzKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGlzQ29tcG9uZW50ID0gdHlwZS5pbmhlcml0c0Zyb20oU3lzLkNvbXBvbmVudCk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGlzQ29udHJvbE9yQmVoYXZpb3IgPSAoaXNDb21wb25lbnQgJiYgKHR5cGUuaW5oZXJpdHNGcm9tKFN5cy5VSS5CZWhhdmlvcikgfHwgdHlwZS5pbmhlcml0c0Zyb20oU3lzLlVJLkNvbnRyb2wpKSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGlzQ29udGV4dCA9IHR5cGUuaW1wbGVtZW50c0ludGVyZmFjZShTeXMuVUkuSVRlbXBsYXRlQ29udGV4dENvbnN1bWVyKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0aXNDb250ZW50VGVtcGxhdGUgPSB0eXBlLmltcGxlbWVudHNJbnRlcmZhY2UoU3lzLlVJLklDb250ZW50VGVtcGxhdGVDb25zdW1lcik7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGluc3RhbmNlID0gaXNDb250cm9sT3JCZWhhdmlvciA/IG5ldyB0eXBlKGVsZW1lbnQpIDogbmV3IHR5cGUoKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKGlzQ29tcG9uZW50KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0aW5zdGFuY2UuYmVnaW5VcGRhdGUoKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoIWlzQ29udHJvbE9yQmVoYXZpb3IpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRTeXMuQXBwbGljYXRpb24uX3JlZ2lzdGVyQ29tcG9uZW50KGVsZW1lbnQsIGluc3RhbmNlKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoaXNDb250ZXh0KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0aW5zdGFuY2Uuc2V0X3RlbXBsYXRlQ29udGV4dCh0ZW1wbGF0ZUNvbnRleHQpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmIChpc0NvbnRlbnRUZW1wbGF0ZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChjb250ZW50VGVtcGxhdGUgIT09IG51bGwpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGluc3RhbmNlLmFkZENvbnRlbnRUZW1wbGF0ZShjb250ZW50VGVtcGxhdGUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAocGFyZW50Q29udGVudFRlbXBsYXRlcykge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0aW5zdGFuY2UuYWRkQ29udGVudFRlbXBsYXRlKHBhcmVudENvbnRlbnRUZW1wbGF0ZXMpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRlbHNlIGlmIChjb250ZW50VGVtcGxhdGUgIT09IG51bGwpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFwiaW52YWxpZFN5c0NvbnRlbnRUZW1wbGF0ZVwiKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRlbnRyeSA9IHsgaW5zdGFuY2U6IGluc3RhbmNlLCBpc0NsYXNzOiB0cnVlLCB0eXBlTmFtZTogdHlwZU5hbWUsIHR5cGU6IHR5cGUgfTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdGVsc2UgaWYgKGNvbnRlbnRUZW1wbGF0ZSAhPT0gbnVsbCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFwiaW52YWxpZFN5c0NvbnRlbnRUZW1wbGF0ZVwiKTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRwcm9wcyA9IHt9O1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRpbnN0YW5jZSA9IFR5cGUucGFyc2UodHlwZSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGVudHJ5ID0geyBpbnN0YW5jZTogaW5zdGFuY2UsIHByb3BzOiBwcm9wcywgdHlwZU5hbWU6IHR5cGVOYW1lLCB0eXBlOiB0eXBlIH07XHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmICghZm5JbmRleCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGZuSW5kZXggPSBbZW50cnldO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGZuSW5kZXhbZm5JbmRleC5sZW5ndGhdID0gZW50cnk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdGluZGV4W3R5cGVOYW1lXSA9IGVudHJ5O1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRpZiAoYXR0cmlidXRlczIpIHtcclxuXHRcdFx0XHRcdFx0XHRmb3IgKGogPSBhdHRyaWJ1dGVzMi5sZW5ndGggLSAxOyBqID49IDA7IGotLSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0YXR0cmlidXRlID0gYXR0cmlidXRlczJbal07XHJcblx0XHRcdFx0XHRcdFx0XHRub2RlTmFtZSA9IGF0dHJpYnV0ZS5ub2RlTmFtZTtcclxuXHRcdFx0XHRcdFx0XHRcdHZhbHVlID0gYXR0cmlidXRlLm5vZGVWYWx1ZTtcclxuXHRcdFx0XHRcdFx0XHRcdHZhciBpc1NlbGVjdCA9ICgvXnNlbGVjdCQvaS50ZXN0KGVsZW1lbnQudGFnTmFtZSkpLFxyXG5cdFx0XHRcdFx0XHRcdGF0dHJpYiA9IFN5cy5BcHBsaWNhdGlvbi5fc3BsaXRBdHRyaWJ1dGUobm9kZU5hbWUsIGlzU2VsZWN0LCBpbmRleCksXHJcblx0XHRcdFx0XHRcdFx0YXR5cGUgPSBhdHRyaWIudHlwZSxcclxuXHRcdFx0XHRcdFx0XHRucyA9IGF0dHJpYi5ucyxcclxuXHRcdFx0XHRcdFx0XHRuYW1lID0gYXR0cmliLm5hbWU7XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoYXR5cGUgPCAwKSBjb250aW51ZTtcclxuXHRcdFx0XHRcdFx0XHRcdGlmIChhdHlwZSA9PT0gMykge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRlbnRyeSA9IGF0dHJpYi5pbmRleDtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIHRhcmdldCA9IGVudHJ5Lmluc3RhbmNlO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR2YWx1ZSA9IFN5cy5BcHBsaWNhdGlvbi5fZ2V0UHJvcGVydHlWYWx1ZShhdHRyaWIsIHRhcmdldCwgbmFtZSwgdmFsdWUsIHRlbXBsYXRlQ29udGV4dCwgZWxlbWVudCk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YgKHZhbHVlKSA9PT0gXCJ1bmRlZmluZWRcIikgY29udGludWU7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmIChlbnRyeS5pc0NsYXNzKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0c3dpdGNoIChhdHRyaWIubWFwLnR5cGUpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGNhc2UgMTpcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0YXR0cmliLm1hcC5zZXR0ZXIuY2FsbCh0YXJnZXQsIHZhbHVlKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRjYXNlIDI6XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGF0dHJpYi5tYXAuc2V0dGVyLmNhbGwodGFyZ2V0LCB0eXBlb2YgKHZhbHVlKSA9PT0gXCJmdW5jdGlvblwiID8gdmFsdWUgOiBuZXcgRnVuY3Rpb24oXCJzZW5kZXJcIiwgXCJhcmdzXCIsIHZhbHVlKSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZGVmYXVsdDpcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0dGFyZ2V0W25hbWVdID0gdmFsdWU7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGVudHJ5LnByb3BzW25hbWVdID0gdmFsdWU7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdGVsc2UgaWYgKGF0eXBlIDw9IDIpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKGF0dHJpYi50ZXh0Tm9kZSB8fCAobmFtZSA9PT0gXCJpbm5lckhUTUxcIikpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRTeXMuQXBwbGljYXRpb24uX2NsZWFyQ29udGVudChlbGVtZW50KTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHR2YWx1ZSA9IFN5cy5BcHBsaWNhdGlvbi5fZ2V0UHJvcGVydHlWYWx1ZShhdHRyaWIsIGVsZW1lbnQsIG5hbWUsIHZhbHVlLCB0ZW1wbGF0ZUNvbnRleHQsIGVsZW1lbnQpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mICh2YWx1ZSkgPT09IFwidW5kZWZpbmVkXCIpIGNvbnRpbnVlO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRzd2l0Y2ggKGF0dHJpYi50eXBlKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Y2FzZSAwOlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKC9eb24vaS50ZXN0KG5hbWUpKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRlbGVtZW50W25hbWVdID0gdmFsdWU7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZWxlbWVudFtuYW1lXSA9IGRvY3VtZW50LmF0dGFjaEV2ZW50ID8gbmV3IEZ1bmN0aW9uKHZhbHVlKSA6IG5ldyBGdW5jdGlvbihcImV2ZW50XCIsIHZhbHVlKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChpc1NlbGVjdCAmJiAobmFtZSA9PT0gXCJ2YWx1ZVwiKSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRlbGVtZW50LnZhbHVlID0gdmFsdWU7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIGJvb2xlYW5zID0gU3lzLlVJLlRlbXBsYXRlLl9ib29sZWFuQXR0cmlidXRlcyxcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRsb3dlclRhZyA9IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlzYm9vbCA9IChuYW1lID09PSBcImRpc2FibGVkXCIpIHx8IChib29sZWFuc1tsb3dlclRhZ10gJiYgYm9vbGVhbnNbbG93ZXJUYWddW25hbWVdKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChpc2Jvb2wpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKG5hbWUgPT09IFwic2VsZWN0ZWRcIikge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGVsZW1lbnQuc2VsZWN0ZWQgPSB2YWx1ZTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoIXZhbHVlKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUobmFtZSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZWxzZSBpZiAobmFtZSA9PT0gXCJjaGVja2VkXCIpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRlbGVtZW50LnNldEF0dHJpYnV0ZShuYW1lLCBuYW1lKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIGEgPSBkb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUobmFtZSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRhLm5vZGVWYWx1ZSA9IGlzYm9vbCA/IG5hbWUgOiB2YWx1ZTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGVsZW1lbnQuc2V0QXR0cmlidXRlTm9kZShhKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGNhc2UgMTpcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChhdHRyaWIudGV4dE5vZGUpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0U3lzLkFwcGxpY2F0aW9uLl9jbGVhckNvbnRlbnQoZWxlbWVudCk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGVsZW1lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodmFsdWUpKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRTeXMuT2JzZXJ2ZXIuc2V0VmFsdWUoZWxlbWVudCwgbmFtZSwgdmFsdWUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Y2FzZSAyOlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dmFsdWUgPyBTeXMuVUkuRG9tRWxlbWVudC5hZGRDc3NDbGFzcyhlbGVtZW50LCBuYW1lKSA6IFN5cy5VSS5Eb21FbGVtZW50LnJlbW92ZUNzc0NsYXNzKGVsZW1lbnQsIG5hbWUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0aWYgKGZuSW5kZXgpIHtcclxuXHRcdFx0XHRcdFx0XHRmb3IgKGogPSAwLCBtID0gZm5JbmRleC5sZW5ndGg7IGogPCBtOyBqKyspIHtcclxuXHRcdFx0XHRcdFx0XHRcdGVudHJ5ID0gZm5JbmRleFtqXTtcclxuXHRcdFx0XHRcdFx0XHRcdHRlbXBsYXRlQ29udGV4dC5fcmVnaXN0ZXJJZihlbnRyeS5pbnN0YW5jZShlbGVtZW50LCBlbnRyeS5wcm9wcywgdGVtcGxhdGVDb250ZXh0KSk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGlmIChpbmRleCkge1xyXG5cdFx0XHRcdFx0XHRcdGZvciAoZW50cnkgaW4gaW5kZXgpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGlmIChpbmRleC5oYXNPd25Qcm9wZXJ0eShlbnRyeSkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0ZW50cnkgPSBpbmRleFtlbnRyeV07XHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmIChlbnRyeSAmJiBlbnRyeS5pc0NsYXNzKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0dGVtcGxhdGVDb250ZXh0Ll9yZWdpc3RlckNvbXBvbmVudChlbnRyeS5pbnN0YW5jZSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdC8vLy8vIGVuZCBlbGVtZW50IGFjdGl2YXRpb25cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKHJlY3Vyc2l2ZSkge1xyXG5cdFx0XHRcdFx0dmFyIGNsYXNzTmFtZSA9IGVsZW1lbnQuY2xhc3NOYW1lO1xyXG5cdFx0XHRcdFx0aWYgKGNsYXNzTmFtZSAmJiAoY2xhc3NOYW1lLmxlbmd0aCA+PSAxMCkgJiYgKGNsYXNzTmFtZSA9PT0gXCJzeXMtdGVtcGxhdGVcIiB8fCBjbGFzc05hbWUgPT09IFwic3lzLWlnbm9yZVwiIHx8IGlzVGVtcGxhdGUudGVzdChjbGFzc05hbWUpIHx8IGlzSWdub3JlLnRlc3QoY2xhc3NOYW1lKSkpIHtcclxuXHRcdFx0XHRcdFx0dmFyIG5leHQgPSBlbGVtZW50Lm5leHRTaWJsaW5nO1xyXG5cdFx0XHRcdFx0XHR3aGlsZSAobmV4dCAmJiAobmV4dC5ub2RlVHlwZSAhPT0gMSkpIHtcclxuXHRcdFx0XHRcdFx0XHRuZXh0ID0gbmV4dC5uZXh0U2libGluZztcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR3aGlsZSAoIW5leHQpIHtcclxuXHRcdFx0XHRcdFx0XHRlbGVtZW50ID0gZWxlbWVudC5wYXJlbnROb2RlO1xyXG5cdFx0XHRcdFx0XHRcdGlmIChlbGVtZW50ID09PSBwYXJlbnQpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRuZXh0ID0gZWxlbWVudC5uZXh0U2libGluZztcclxuXHRcdFx0XHRcdFx0XHR3aGlsZSAobmV4dCAmJiAobmV4dC5ub2RlVHlwZSAhPT0gMSkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdG5leHQgPSBuZXh0Lm5leHRTaWJsaW5nO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRpZiAoIW5leHQgfHwgKG5leHQubm9kZVR5cGUgIT09IDEpKSB7XHJcblx0XHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0ZG8ge1xyXG5cdFx0XHRcdFx0XHRcdGVsZW1lbnQgPSBhbGxFbGVtZW50c1tpICsgMV07XHJcblx0XHRcdFx0XHRcdFx0aWYgKGVsZW1lbnQgPT09IG5leHQpIGJyZWFrO1xyXG5cdFx0XHRcdFx0XHRcdGkrKztcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR3aGlsZSAoZWxlbWVudCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHdoaWxlICghIShlbGVtZW50ID0gYWxsRWxlbWVudHNbKytpXSkpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIFN5cyRBcHBsaWNhdGlvbiRfZWxlbWVudFRvU3RyaW5nKGVsKSB7XHJcblx0XHRcdGlmICghZWwudGFnTmFtZSkge1xyXG5cdFx0XHRcdHJldHVybiBcInVua25vd24gZWxlbWVudFwiO1xyXG5cdFx0XHR9XHJcblx0XHRcdHZhciBzdHIgPSBlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XHJcblx0XHRcdGlmIChzdHIgPT09IFwiaW5wdXRcIikge1xyXG5cdFx0XHRcdHN0ciArPSBcIltcIiArIGVsLnR5cGUgKyBcIl1cIjtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAoZWwuaWQpIHtcclxuXHRcdFx0XHRzdHIgKz0gXCIjXCIgKyBlbC5pZDtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAoZWwuY2xhc3NOYW1lKSB7XHJcblx0XHRcdFx0ZWwuY2xhc3NOYW1lLnNwbGl0KC9cXHMrL2cpLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcclxuXHRcdFx0XHRcdHN0ciArPSBcIi5cIiArIGM7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHN0cjtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBhIG5vbi1jb250cm9sIHRhcmdldGluZyBkYXRhIGF0dHJpYnV0ZSwgaS5lLiBcImRhdGEtc3lzLWNsYXNzXCJcclxuXHRcdHZhciBzeXNEYXRhQXR0ckV4cHIgPSAvXmRhdGFcXC1zeXNcXC0oW2Etel9dKikkLztcclxuXHJcblx0XHQvLyBhIGNvbnRyb2wgdGFyZ2V0aW5nIGRhdGEgYXR0cmlidXRlLCBpLmUuOiBcImRhdGEtZGF0YXZpZXctZGF0YVwiXHJcblx0XHR2YXIgY29udHJvbERhdGFBdHRyRXhwciA9IC9eZGF0YVxcLShbYS16X10qKVxcLShbYS16X10qKSQvO1xyXG5cclxuXHRcdC8vIGEgbm9uLWNvbnRyb2wgdGFyZ2V0aW5nIGRhdGEgYXR0cmlidXRlLCBpLmUuIFwiZGF0YS1zeXMtY2xhc3NcIlxyXG5cdFx0dmFyIHN5c0F0dHJFeHByID0gL15zeXNcXDooW2Etel9dKikkLztcclxuXHJcblx0XHRTeXMuQXBwbGljYXRpb24uX2xpbmtBdHRyaWJ1dGVzID0gZnVuY3Rpb24gU3lzJEFwcGxpY2F0aW9uJF9saW5rQXR0cmlidXRlcyhlbGVtZW50LCBwYXJlbnRDb250ZXh0LCBhdHRhY2hlZE5hbWUpIHtcclxuXHRcdFx0dmFyIGksIGF0dHIsIGRhdGFBdHRyLCBtc0RhdGFBdHRyaWIsIGlzU2VsZWN0LCBpc1RleHRBcmVhLCBtYXRjaCwgYXR0ck5hbWUsIHZhbHVlLCB0YXJnZXQsIHRhcmdldFByb3AsIGxpbmssIHR5cGVJbmRleCwgYXR0ckxpbmtzRWxlbWVudENvbnRlbnQsIGNvbnRyb2xUeXBlO1xyXG5cclxuXHRcdFx0aWYgKGVsZW1lbnQuY29udHJvbCAmJiBhdHRhY2hlZE5hbWUpIHtcclxuXHRcdFx0XHR0eXBlSW5kZXggPSB7fTtcclxuXHRcdFx0XHRjb250cm9sVHlwZSA9IGVsZW1lbnQuY29udHJvbC5jb25zdHJ1Y3RvcjtcclxuXHRcdFx0XHR0eXBlSW5kZXhbYXR0YWNoZWROYW1lXSA9IHsgdHlwZTogY29udHJvbFR5cGUsIGlzQ2xhc3M6IHRydWUsIGlzQ29tcG9uZW50OiBjb250cm9sVHlwZS5pbmhlcml0c0Zyb20gJiYgY29udHJvbFR5cGUuaW5oZXJpdHNGcm9tKFN5cy5Db21wb25lbnQpIH07XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGZvciAoaSA9IDA7IGkgPCBlbGVtZW50LmF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHRhdHRyID0gZWxlbWVudC5hdHRyaWJ1dGVzW2ldO1xyXG5cdFx0XHRcdGF0dHJOYW1lID0gYXR0ci5uYW1lO1xyXG5cclxuXHRcdFx0XHQvLyB0ZXN0IGZvciBhIFwiZGF0YSBhdHRyaWJ1dGVcIiwgaS5lLiBcImRhdGEtZGF0YXZpZXctZGF0YVwiXHJcblx0XHRcdFx0aWYgKHN5c0RhdGFBdHRyRXhwci50ZXN0KGF0dHJOYW1lKSkge1xyXG5cdFx0XHRcdFx0ZGF0YUF0dHIgPSB7IHJhdzogYXR0ck5hbWUsIHByZWZpeDogXCJzeXNcIiB9O1xyXG5cdFx0XHRcdFx0ZGF0YUF0dHIubmFtZSA9IHN5c0RhdGFBdHRyRXhwci5leGVjKGF0dHIubmFtZSlbMV07XHJcblx0XHRcdFx0XHRsaW5rID0gdHJ1ZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSBpZiAoY29udHJvbERhdGFBdHRyRXhwci50ZXN0KGF0dHJOYW1lKSkge1xyXG5cdFx0XHRcdFx0ZGF0YUF0dHIgPSB7IHJhdzogYXR0ck5hbWUgfTtcclxuXHRcdFx0XHRcdG1hdGNoID0gY29udHJvbERhdGFBdHRyRXhwci5leGVjKGF0dHJOYW1lKTtcclxuXHRcdFx0XHRcdGRhdGFBdHRyLmNvbnRyb2wgPSBkYXRhQXR0ci5wcmVmaXggPSBtYXRjaFsxXTtcclxuXHRcdFx0XHRcdGRhdGFBdHRyLm5hbWUgPSBtYXRjaFsyXTtcclxuXHRcdFx0XHRcdGxpbmsgPSB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmIChzeXNBdHRyRXhwci50ZXN0KGF0dHJOYW1lKSkge1xyXG5cdFx0XHRcdFx0ZGF0YUF0dHIgPSB7IHJhdzogYXR0ck5hbWUsIHByZWZpeDogXCJzeXNcIiB9O1xyXG5cdFx0XHRcdFx0ZGF0YUF0dHIubmFtZSA9IHN5c0F0dHJFeHByLmV4ZWMoYXR0ci5uYW1lKVsxXTtcclxuXHRcdFx0XHRcdGxpbmsgPSBmYWxzZTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIGlmIHRoaXMgaXMgYSBkYXRhIGF0dHJpYnV0ZSwgdGhlbiBsaW5rIG9yIGJpbmQgaXQgdG8gdGhlIHRhcmdldCBhbmQgcmVtb3ZlIGl0IGZyb20gdGhlIERPTVxyXG5cdFx0XHRcdGlmIChkYXRhQXR0cikge1xyXG5cdFx0XHRcdFx0dGFyZ2V0ID0gZGF0YUF0dHIuY29udHJvbCA/IGVsZW1lbnQuY29udHJvbCA6IGVsZW1lbnQ7XHJcblxyXG5cdFx0XHRcdFx0aWYgKHRhcmdldCkge1xyXG5cdFx0XHRcdFx0XHRpc1NlbGVjdCA9IGVsZW1lbnQudGFnTmFtZSA9PT0gXCJTRUxFQ1RcIjtcclxuXHRcdFx0XHRcdFx0aXNUZXh0QXJlYSA9IGVsZW1lbnQudGFnTmFtZSA9PT0gXCJURVhUQVJFQVwiO1xyXG5cdFx0XHRcdFx0XHRtc0RhdGFBdHRyaWIgPSBTeXMuQXBwbGljYXRpb24uX3NwbGl0QXR0cmlidXRlKGRhdGFBdHRyLnByZWZpeCArIFwiOlwiICsgZGF0YUF0dHIubmFtZSwgaXNTZWxlY3QsIHR5cGVJbmRleCk7XHJcblx0XHRcdFx0XHRcdHRhcmdldFByb3AgPSBtc0RhdGFBdHRyaWIubmFtZTtcclxuXHJcblx0XHRcdFx0XHRcdC8vIEZvciBpbm5lciBodG1sIGFuZCB0ZXh0LCB0aGUgY2hpbGQgbm9kZXMgb2YgdGhlIGVsZW1lbnQgc2hvdWxkIG5vdCBiZVxyXG5cdFx0XHRcdFx0XHQvLyBsaW5rZWQgc2luY2UgdGhleSBhcmUgZHluYW1pYyBjb250ZW50IHRoYXQgaXMgbm90IGRlZmluZWQgd2l0aGluIHRoZVxyXG5cdFx0XHRcdFx0XHQvLyBvcmlnaW5hbCB0ZW1wbGF0ZSBtYXJrdXAgc291cmNlLCBhbmQgY291bGQgcG90ZW50aWFsbHkgYmUgdW5zYWZlLlxyXG5cdFx0XHRcdFx0XHRpZiAodGFyZ2V0UHJvcCA9PT0gXCJpbm5lckhUTUxcIiB8fCB0YXJnZXRQcm9wID09PSBcImlubmVyVGV4dFwiIHx8IChpc1RleHRBcmVhICYmIHRhcmdldFByb3AgPT09IFwidmFsdWVcIikpIHtcclxuXHRcdFx0XHRcdFx0XHRhdHRyTGlua3NFbGVtZW50Q29udGVudCA9IHRydWU7XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdHZhbHVlID0gU3lzLkFwcGxpY2F0aW9uLl9nZXRQcm9wZXJ0eVZhbHVlKG1zRGF0YUF0dHJpYiwgdGFyZ2V0LCB0YXJnZXRQcm9wLCBhdHRyLm5vZGVWYWx1ZSwgcGFyZW50Q29udGV4dCwgZWxlbWVudCwgbnVsbCwgZmFsc2UsIHsgaXNMaW5rUGVuZGluZzogIWVsZW1lbnQuY29udHJvbCAmJiBsaW5rIH0pO1xyXG5cdFx0XHRcdFx0XHRpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0XHRcdFN5cy5PYnNlcnZlci5zZXRWYWx1ZSh0YXJnZXQsIG1zRGF0YUF0dHJpYi5uYW1lIHx8IHRhcmdldFByb3AsIHZhbHVlKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0ZGF0YUF0dHIgPSBudWxsO1xyXG5cclxuXHRcdFx0XHRcdFx0aWYgKCFsaW5rKSB7XHJcblx0XHRcdFx0XHRcdFx0ZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoYXR0ci5uYW1lKTtcclxuXHRcdFx0XHRcdFx0XHRpIC09IDE7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiBhdHRyTGlua3NFbGVtZW50Q29udGVudDtcclxuXHRcdH07XHJcblxyXG5cdFx0Ly8gbWFya3MgdGhlIGJlZ2lubmluZyBvciBlbmQgb2YgYSBjb250ZXh0LCBpLmUuIFwiL2l0ZW1cIiBvciBcIml0ZW0gXyR0MjAyXCJcclxuXHRcdHZhciBpdGVtQ29tbWVudEV4cHIgPSAvXihcXC98KWl0ZW0oXFw6KFtcXCRfQS1aYS16MC05XSspfCkkLztcclxuXHJcblx0XHRTeXMuQXBwbGljYXRpb24uX2xpbmtDb250ZXh0cyA9IGZ1bmN0aW9uIFN5cyRBcHBsaWNhdGlvbiRfbGlua0NvbnRleHRzKHBhcmVudENvbnRleHQsIHBhcmVudENvbnRyb2wsIHBhcmVudERhdGEsIHBhcmVudEVsZW1lbnQsIGN1cnJlbnRDb250ZXh0LCBwYXJlbnRDb250ZW50VGVtcGxhdGVzLCByZWN1cnNpdmUsIGdlbmVyYXRlSWRzKSB7XHJcblx0XHRcdHZhciBjaGlsZHJlbiwgbmV3Q29udGV4dCwgcHJlY2VlZGluZ1RleHQsIGN0eElkeCwgdGNJZHgsIGlzU2VsZWN0LCBpLCBub2RlLCBtYXRjaCwgbWFya2VyLCB0bXBsSWR4LCB0bXBsLCBnZW5lcmF0ZXNDb250ZXh0LCB2YWx1ZSwgZm91bmRCaW5kaW5nLCBpc0FycmF5RGF0YSwgZ2VuZXJhdGVDaGlsZElkcyxcclxuXHRcdFx0XHRpc1NpbmdsZUV4dGVybmFsQ29udGV4dCwgbGFzdEluZGV4LCB0YXJnZXRQcm9wLCBtc0F0dHJpYiwgdGV4dCwgdHJpbVRleHQsIGV4cHJSZWdFeHAsIGF0dGFjaE5hbWUsIGlzQ29udGVudFRlbXBsYXRlLCBjb250ZW50VGVtcGxhdGUsIGNoaWxkQ29udGVudFRlbXBsYXRlcywgY3R4QXR0cixcclxuXHRcdFx0XHRpc1RleHROb2RlLCBpc0VsZW1lbnROb2RlLCBpc0NvbW1lbnROb2RlO1xyXG5cclxuXHRcdFx0Y3R4SWR4ID0gLTE7XHJcblx0XHRcdGlzU2luZ2xlRXh0ZXJuYWxDb250ZXh0ID0gIXJlY3Vyc2l2ZSAmJiBjdXJyZW50Q29udGV4dDtcclxuXHRcdFx0aXNBcnJheURhdGEgPSBwYXJlbnREYXRhICYmIHBhcmVudERhdGEgaW5zdGFuY2VvZiBBcnJheTtcclxuXHRcdFx0aXNTZWxlY3QgPSBwYXJlbnRFbGVtZW50LnRhZ05hbWUgPT09IFwiU0VMRUNUXCI7XHJcblx0XHRcdGV4cHJSZWdFeHAgPSBTeXMuVUkuVGVtcGxhdGUuX2V4cHJlc3Npb25SZWdFeHA7XHJcblxyXG5cdFx0XHQvLyBDb3B5IGNoaWxkIG5vZGVzIGludG8gYXJyYXkgdG8gaXNvbGF0ZSBmcm9tIGV4dGVybmFsIGNoYW5nZXMgdG8gdGhlIERPTVxyXG5cdFx0XHRpID0gLTE7XHJcblx0XHRcdGNoaWxkcmVuID0gW107XHJcblx0XHRcdHdoaWxlIChub2RlID0gcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzWysraV0pIHtcclxuXHRcdFx0XHRjaGlsZHJlbltpXSA9IG5vZGU7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGZvciAoaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdG5vZGUgPSBjaGlsZHJlbltpXTtcclxuXHRcdFx0XHRtYXJrZXIgPSB0bXBsSWR4ID0gdG1wbCA9IG1hdGNoID0gdmFsdWUgPSBudWxsO1xyXG5cdFx0XHRcdGdlbmVyYXRlc0NvbnRleHQgPSBmb3VuZEJpbmRpbmcgPSBmYWxzZTtcclxuXHRcdFx0XHRnZW5lcmF0ZUNoaWxkSWRzID0gZ2VuZXJhdGVJZHM7XHJcblx0XHRcdFx0aXNFbGVtZW50Tm9kZSA9IG5vZGUubm9kZVR5cGUgPT09IDE7XHJcblx0XHRcdFx0aXNUZXh0Tm9kZSA9IG5vZGUubm9kZVR5cGUgPT09IDM7XHJcblx0XHRcdFx0aXNDb21tZW50Tm9kZSA9IG5vZGUubm9kZVR5cGUgPT09IDg7XHJcblxyXG5cdFx0XHRcdC8vIExvb2sgZm9yIGJpbmRpbmcgZXhwcmVzc2lvbnMgaW4gdGV4dCBub2Rlc1xyXG5cdFx0XHRcdC8vIE5PVEU6IGJhc2VkIG9uIF9idWlsZFRlbXBsYXRlQ29kZVxyXG5cdFx0XHRcdGlmIChpc1RleHROb2RlKSB7XHJcblx0XHRcdFx0XHR0ZXh0ID0gbm9kZS5ub2RlVmFsdWU7XHJcblx0XHRcdFx0XHR0cmltVGV4dCA9IHRleHQudHJpbSgpO1xyXG5cclxuXHRcdFx0XHRcdC8vIEFuIGV4dGVuc2lvbiB0YWtlcyB0aGUgcGxhY2Ugb2Ygbm9kZSB2YWx1ZVxyXG5cdFx0XHRcdFx0aWYgKCh0cmltVGV4dC5zdGFydHNXaXRoKFwie1wiKSAmJiB0cmltVGV4dC5lbmRzV2l0aChcIn1cIikgJiYgKCF0cmltVGV4dC5zdGFydHNXaXRoKFwie3tcIikgfHwgIXRyaW1UZXh0LmVuZHNXaXRoKFwifX1cIikpKSkge1xyXG5cdFx0XHRcdFx0XHRmb3VuZEJpbmRpbmcgPSB0cnVlO1xyXG5cdFx0XHRcdFx0XHR0YXJnZXRQcm9wID0gKHBhcmVudEVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcInRleHRhcmVhXCIgPyBcInZhbHVlXCIgOiBcImlubmVyVGV4dFwiKTtcclxuXHRcdFx0XHRcdFx0bXNBdHRyaWIgPSBTeXMuQXBwbGljYXRpb24uX3NwbGl0QXR0cmlidXRlKHRhcmdldFByb3AsIGlzU2VsZWN0KTtcclxuXHRcdFx0XHRcdFx0dmFsdWUgPSBTeXMuQXBwbGljYXRpb24uX2dldFByb3BlcnR5VmFsdWUobXNBdHRyaWIsIHBhcmVudEVsZW1lbnQsIHRhcmdldFByb3AsIHRleHQsIGN1cnJlbnRDb250ZXh0LCBwYXJlbnRFbGVtZW50LCBudWxsLCBmYWxzZSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHQvLyBNdWx0aXBsZSBleHByZXNzaW9ucyBjYW4gYmUgbmVzdGVkIHdpdGhpbiBhIGJsb2NrIG9mIHRleHRcclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRsYXN0SW5kZXggPSAwO1xyXG5cdFx0XHRcdFx0XHRtYXRjaCA9IGV4cHJSZWdFeHAuZXhlYyh0ZXh0KTtcclxuXHRcdFx0XHRcdFx0d2hpbGUgKG1hdGNoKSB7XHJcblx0XHRcdFx0XHRcdFx0aWYgKCFmb3VuZEJpbmRpbmcpIHtcclxuXHRcdFx0XHRcdFx0XHRcdHZhbHVlID0gXCJcIjtcclxuXHRcdFx0XHRcdFx0XHRcdGZvdW5kQmluZGluZyA9IHRydWU7XHJcblx0XHRcdFx0XHRcdFx0XHR0YXJnZXRQcm9wID0gKHBhcmVudEVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcInRleHRhcmVhXCIgPyBcInZhbHVlXCIgOiBcImlubmVyVGV4dFwiKTtcclxuXHRcdFx0XHRcdFx0XHRcdG1zQXR0cmliID0gU3lzLkFwcGxpY2F0aW9uLl9zcGxpdEF0dHJpYnV0ZSh0YXJnZXRQcm9wLCBpc1NlbGVjdCk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdHZhbHVlICs9IHRleHQuc3Vic3RyaW5nKGxhc3RJbmRleCwgbWF0Y2guaW5kZXgpIHx8IFwiXCI7XHJcblx0XHRcdFx0XHRcdFx0dmFsdWUgKz0gU3lzLkFwcGxpY2F0aW9uLl9nZXRQcm9wZXJ0eVZhbHVlKG1zQXR0cmliLCBwYXJlbnRFbGVtZW50LCB0YXJnZXRQcm9wLCBtYXRjaFswXSwgY3VycmVudENvbnRleHQsIHBhcmVudEVsZW1lbnQsIG51bGwsIGZhbHNlKSB8fCBcIlwiO1xyXG5cdFx0XHRcdFx0XHRcdGxhc3RJbmRleCA9IG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoO1xyXG5cdFx0XHRcdFx0XHRcdG1hdGNoID0gZXhwclJlZ0V4cC5leGVjKHRleHQpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGlmIChmb3VuZEJpbmRpbmcgJiYgbGFzdEluZGV4IDwgdGV4dC5sZW5ndGgpIHtcclxuXHRcdFx0XHRcdFx0XHR2YWx1ZSArPSB0ZXh0LnN1YnN0cihsYXN0SW5kZXgpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0Ly8gVXBkYXRlIHRoZSBub2RlJ3MgdmFsdWVcclxuXHRcdFx0XHRcdGlmIChmb3VuZEJpbmRpbmcpIHtcclxuXHRcdFx0XHRcdFx0bm9kZS5ub2RlVmFsdWUgPSB2YWx1ZSB8fCBcIlwiO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gSWYgdGhpcyBpcyB0b3AtbGV2ZWwgdGhlbiBsb29rIGZvciBjb250ZXh0IG1hcmtlcnNcclxuXHRcdFx0XHRpZiAoIXJlY3Vyc2l2ZSkge1xyXG5cdFx0XHRcdFx0aWYgKGlzQ29tbWVudE5vZGUgJiYgKG1hdGNoID0gaXRlbUNvbW1lbnRFeHByLmV4ZWMobm9kZS5ub2RlVmFsdWUpKSkge1xyXG5cdFx0XHRcdFx0XHRpZiAobWF0Y2hbMV0gPT09IFwiXCIpIHtcclxuXHRcdFx0XHRcdFx0XHR0Y0lkeCA9IG1hdGNoWzNdO1xyXG5cdFx0XHRcdFx0XHRcdG1hcmtlciA9IHsgYmVnaW46IHRydWUsIGVuZDogZmFsc2UgfTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRlbHNlIGlmIChtYXRjaFsxXSA9PT0gXCIvXCIpIHtcclxuXHRcdFx0XHRcdFx0XHRtYXJrZXIgPSB7IGJlZ2luOiBmYWxzZSwgZW5kOiB0cnVlIH07XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2UgaWYgKGlzRWxlbWVudE5vZGUgJiYgbm9kZS5oYXNBdHRyaWJ1dGUoXCJkYXRhLXN5cy1jdHhcIikpIHtcclxuXHRcdFx0XHRcdFx0Y3R4QXR0ciA9IG5vZGUuZ2V0QXR0cmlidXRlKFwiZGF0YS1zeXMtY3R4XCIpO1xyXG5cclxuXHRcdFx0XHRcdFx0aWYgKGN0eEF0dHIuaW5kZXhPZihcIi9cIikgPT09IDApIHtcclxuXHRcdFx0XHRcdFx0XHRtYXJrZXIgPSB7IGJlZ2luOiBmYWxzZSwgZW5kOiB0cnVlIH07XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0dGNJZHggPSBjdHhBdHRyO1xyXG5cdFx0XHRcdFx0XHRcdG1hcmtlciA9IHsgYmVnaW46IHRydWUsIGVuZDogZmFsc2UgfTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGlmIChtYXJrZXIpIHtcclxuXHRcdFx0XHRcdFx0aWYgKGlzU2luZ2xlRXh0ZXJuYWxDb250ZXh0KSB7XHJcblx0XHRcdFx0XHRcdFx0aWYgKGlzRWxlbWVudE5vZGUpIHtcclxuXHRcdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIlVuZXhwZWN0ZWQgY29udGV4dCBtYXJrZXIgaW4gRE9NIGZvciBlbGVtZW50ICdcIiArIFN5cyRBcHBsaWNhdGlvbiRfZWxlbWVudFRvU3RyaW5nKG5vZGUpICsgXCInOiBjb250ZXh0IHdhcyBwcm92aWRlZCBieSBjYWxsZXIuXCIpO1xyXG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoaXNDb21tZW50Tm9kZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiVW5leHBlY3RlZCBjb250ZXh0IG1hcmtlciBpbiBET00gZm9yIGNvbW1lbnQgJ1wiICsgbm9kZS5ub2RlVmFsdWUgKyBcIic6IGNvbnRleHQgd2FzIHByb3ZpZGVkIGJ5IGNhbGxlci5cIik7XHJcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIlVuZXhwZWN0ZWQgY29udGV4dCBtYXJrZXIgaW4gRE9NOiBjb250ZXh0IHdhcyBwcm92aWRlZCBieSBjYWxsZXJcIik7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBTdGFydCBhIG5ldyBjb250ZXh0IGFmdGVyIHRoaXMgbm9kZVxyXG5cdFx0XHRcdFx0XHRpZiAobWFya2VyLmJlZ2luKSB7XHJcblxyXG5cdFx0XHRcdFx0XHRcdC8vIFZlcmlmeSB0aGF0IHRoZXJlIGlzbid0IGN1cnJlbnRseSBhbiBhY3RpdmUgY29udGV4dFxyXG5cdFx0XHRcdFx0XHRcdGlmIChjdXJyZW50Q29udGV4dCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gVGhlcmUgc2hvdWxkIGJlIG5vIGNvbnRleHQgZWl0aGVyIGJlY2F1c2UgaXQgaXMgc3VwcGxpZWQgYnkgdGhlIGNhbGxlclxyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gKGkuZS4gQ29udGVudCksIHdlIGhhdmUgb25seSBqdXN0IGVudGVyZWQgdGhlIG1ldGhvZCBhbmQgaGF2ZW4ndCB5ZXQgZW5jb3VudGVyZWRcclxuXHRcdFx0XHRcdFx0XHRcdC8vIGEgY29udGV4dCBiZWdpbiBtYXJrZXIsIG9yIHRoZSBub2RlIHdhcyBwcmVjZWVkZWQgYnkgYSBjb250ZXh0IGVuZCBtYXJrZXJcclxuXHRcdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIlRoZXJlIGlzIGFscmVhZHkgYSBjb250ZXh0IGluIHVzZS4gVGhpcyBtYXkgYmUgY2F1c2VkIGJ5IGludmFsaWQgbWFya3VwLlwiKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRcdGlmICghdGNJZHgpIHtcclxuXHRcdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBmaW5kIGNvbnRleHQgaWQgZm9yIG5ld2x5IGNyZWF0ZWQgY29udGV4dC5cIik7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0XHQvLyBTdGFydCBuZXcgY29udGV4dCBmb3IgYSBuZXcgaXRlbSB3aGVuIGEgY29udGV4dCBiZWdpbiBtYXJrZXIgaXMgZm91bmQgKG1pbWlja3MgY29tcGlsZWQgY29kZSlcclxuXHRcdFx0XHRcdFx0XHRuZXdDb250ZXh0ID0gbmV3IFN5cy5VSS5UZW1wbGF0ZUNvbnRleHQodGNJZHgpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRuZXdDb250ZXh0LmRhdGEgPSBwYXJlbnREYXRhO1xyXG5cdFx0XHRcdFx0XHRcdG5ld0NvbnRleHQuY29tcG9uZW50cyA9IFtdO1xyXG5cclxuXHRcdFx0XHRcdFx0XHQvLyBVc2UgdGhlIHByZWNlZWRpbmcgdGV4dCBub2RlcyBpZiB0aGVyZSBhcmUgYW55XHJcblx0XHRcdFx0XHRcdFx0aWYgKHByZWNlZWRpbmdUZXh0KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRuZXdDb250ZXh0Lm5vZGVzID0gcHJlY2VlZGluZ1RleHQuc2xpY2UoKTtcclxuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0bmV3Q29udGV4dC5ub2RlcyA9IFtdO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0bmV3Q29udGV4dC5pbmRleCA9ICsrY3R4SWR4O1xyXG5cclxuXHRcdFx0XHRcdFx0XHQvLyBTZXQgdGhlIGluZGV4IGFuZCB1c2UgaXQgdG8gcmV0cmlldmUgdGhlIGRhdGEgaXRlbSBmb3IgdGhlIGNvbnRleHRcclxuXHRcdFx0XHRcdFx0XHRpZiAoaXNBcnJheURhdGEpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGlmIChjdHhJZHggPj0gcGFyZW50RGF0YS5sZW5ndGgpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiVW5leHBlY3RlZCBudW1iZXIgb2YgY29udGV4dHM6IGV4cGVjdGVkIFwiICsgcGFyZW50RGF0YS5sZW5ndGggKyBcIiBidXQgZm91bmQgYXQgbGVhc3QgXCIgKyAoY3R4SWR4ICsgMSkpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0bmV3Q29udGV4dC5kYXRhSXRlbSA9IHBhcmVudERhdGFbY3R4SWR4XTtcclxuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKGN0eElkeCA+IDApIHtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJGb3VuZCBtdWx0aXBsZSBjb250ZXh0cyBpbiBET00sIGJ1dCBkYXRhIGlzIG5vdCBhbiBhcnJheS5cIik7XHJcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdG5ld0NvbnRleHQuZGF0YUl0ZW0gPSBwYXJlbnREYXRhO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0bmV3Q29udGV4dC5wYXJlbnRDb250ZXh0ID0gcGFyZW50Q29udGV4dDtcclxuXHRcdFx0XHRcdFx0XHRuZXdDb250ZXh0LmNvbnRhaW5lckVsZW1lbnQgPSBwYXJlbnRFbGVtZW50O1xyXG5cclxuXHRcdFx0XHRcdFx0XHQvLyBHZXQgdGhlIHRlbXBsYXRlIGZyb20gdGhlIHBhcmVudCBjb250cm9sIChpLmUuIGRhdGF2aWV3KVxyXG5cdFx0XHRcdFx0XHRcdGlmIChwYXJlbnRDb250cm9sLl9nZXRUZW1wbGF0ZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0bmV3Q29udGV4dC50ZW1wbGF0ZSA9IHBhcmVudENvbnRyb2wuX2dldFRlbXBsYXRlKCk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0XHQvLyBQcmUtY29tcGlsZSB0aGUgdGVtcGxhdGUgaWYgbmVjZXNzYXJ5LCBzaW5jZSB3ZSB3aWxsIG5lZWQgdG8gYWNjZXNzIG5lc3RlZCB0ZW1wbGF0ZXNcclxuXHRcdFx0XHRcdFx0XHRuZXdDb250ZXh0LnRlbXBsYXRlLl9lbnN1cmVDb21waWxlZCgpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHQvLyBDbGVhciBvdXQgdGV4dCBub2RlcyBhcnJheVxyXG5cdFx0XHRcdFx0XHRcdHByZWNlZWRpbmdUZXh0ID0gbnVsbDtcclxuXHJcblx0XHRcdFx0XHRcdFx0Ly8gQWRkIHRoZSBjb250ZXh0IHRvIHRoZSBwYXJlbnQgY29udHJvbCBhbmQgdXNlIGl0IGFzIHRoZSBjdXJyZW50IGNvbnRleHRcclxuXHRcdFx0XHRcdFx0XHRwYXJlbnRDb250cm9sLl9jb250ZXh0cy5wdXNoKG5ld0NvbnRleHQpO1xyXG5cdFx0XHRcdFx0XHRcdGN1cnJlbnRDb250ZXh0ID0gbmV3Q29udGV4dDtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHQvLyBFbmQgdGhlIGN1cnJlbnQgY29udGV4dCB3aGVuIGEgY29udGV4dCBlbmQgbWFya2VyIGlzIGZvdW5kXHJcblx0XHRcdFx0XHRcdGVsc2UgaWYgKG1hcmtlci5lbmQpIHtcclxuXHRcdFx0XHRcdFx0XHRjdXJyZW50Q29udGV4dC5fb25JbnN0YW50aWF0ZWQobnVsbCwgdHJ1ZSk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdC8vIFJlc2V0IHZhcmlhYmxlcyB0aWVkIHRvIHRoZSBjdXJyZW50IGNvbnRleHRcclxuXHRcdFx0XHRcdFx0XHRjdXJyZW50Q29udGV4dCA9IG51bGw7XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdC8vIFJlbW92ZSBlbGVtZW50cyBzaW5jZSB0aGV5IG1heSBzdGlsbCBiZSBzaG93biBieSB0aGUgYnJvd3NlclxyXG5cdFx0XHRcdFx0XHQvLyBpbiBzb21lIGNhc2VzLCBldmVuIGlmIHRoZXkgYXJlIGhpZGRlbiAoaS5lLiBPUFRJT04pLlxyXG5cdFx0XHRcdFx0XHRpZiAoaXNFbGVtZW50Tm9kZSkge1xyXG5cdFx0XHRcdFx0XHRcdHBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQobm9kZSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdC8vIENvbnRpbnVlIHRvIHRoZSBuZXh0IG5vZGUgaWYgdGhpcyBub2RlIHdhcyBhIG1hcmtlclxyXG5cdFx0XHRcdFx0XHRjb250aW51ZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHQvLyBTYXZlIHRleHQgbm9kZXMgdG8gYmUgaW5jbHVkZWQgaW4gdGhlIGZvbGxvd2luZyBjb250ZXh0XHJcblx0XHRcdFx0XHRcdGlmIChpc1RleHROb2RlICYmICFjdXJyZW50Q29udGV4dCkge1xyXG5cdFx0XHRcdFx0XHRcdGlmIChwcmVjZWVkaW5nVGV4dCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0cHJlY2VlZGluZ1RleHQucHVzaChub2RlKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0XHRwcmVjZWVkaW5nVGV4dCA9IFtub2RlXTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0aWYgKCFjdXJyZW50Q29udGV4dCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKGlzRWxlbWVudE5vZGUpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiRm91bmQgZWxlbWVudCAnXCIgKyBTeXMkQXBwbGljYXRpb24kX2VsZW1lbnRUb1N0cmluZyhub2RlKSArIFwiJyBvdXRzaWRlIG9mIGFuIGFjdGl2ZSBjb250ZXh0LlwiKTtcclxuXHRcdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoaXNDb21tZW50Tm9kZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJGb3VuZCBjb21tZW50ICdcIiArIG5vZGUubm9kZVZhbHVlICsgXCInIG91dHNpZGUgb2YgYW4gYWN0aXZlIGNvbnRleHQuXCIpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiRm91bmQgdW5rbm93biBub2RlICdcIiArIG5vZGUubm9kZVZhbHVlICsgXCInIG91dHNpZGUgb2YgYW4gYWN0aXZlIGNvbnRleHQuXCIpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0Ly8gT25seSB0b3AtbGV2ZWwgKG5vbi1yZWN1cnNpdmUpIG5vZGVzIGFyZSBhZGRlZCB0byB0aGUgY29udGV4dCBub2RlcyBsaXN0XHJcblx0XHRcdFx0XHRcdFx0Y3VycmVudENvbnRleHQubm9kZXMucHVzaChub2RlKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gT25seSBlbGVtZW50c1xyXG5cdFx0XHRcdGlmIChpc0VsZW1lbnROb2RlKSB7XHJcblxyXG5cdFx0XHRcdFx0Ly8gSWYgYSB0ZW1wbGF0ZSBpbmRleCBhdHRyaWJ1dGUgd2FzIHNwZWNpZmllZCwgdGhlbiB1cyBpdCBmb3IgdGVtcGxhdGVkIGNvbnRyb2xzXHJcblx0XHRcdFx0XHRpZiAobm9kZS5oYXNBdHRyaWJ1dGUoXCJkYXRhLXN5cy10bXBsaWR4XCIpKSB7XHJcblx0XHRcdFx0XHRcdHRtcGxJZHggPSBwYXJzZUludChub2RlLmdldEF0dHJpYnV0ZShcImRhdGEtc3lzLXRtcGxpZHhcIiksIDEwKTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyBBc3NpZ24gY29udGV4dCBpbmRleCAobWltaWNzIGNvbXBpbGVkIGNvZGUpXHJcblx0XHRcdFx0XHRub2RlLl9fbXN0Y2luZGV4ID0gY3VycmVudENvbnRleHQuX3RjaW5kZXg7XHJcblxyXG5cdFx0XHRcdFx0aWYgKG5vZGUuaGFzQXR0cmlidXRlKFwiZGF0YS1jb250aW51ZVwiKSkge1xyXG5cdFx0XHRcdFx0XHQvLyBDaGlsZHJlbiB3ZXJlIGFsbG93ZWQgdG8gY29udGludWUgcmVuZGVyaW5nLCBzbyBkb24ndCBzdGFydCBnZW5lcmF0aW5nIGlkc1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAoIWdlbmVyYXRlQ2hpbGRJZHMpIHtcclxuXHRcdFx0XHRcdFx0Ly8gRGV0ZWN0IHNwZWNpYWwgYXR0cmlidXRlcyB0aGF0IHdvdWxkIGhhdmUgYmVlbiB0YWtlbiBjYXJlIG9mIGJ5IHNlcnZlci1zaWRlIHJlbmRlcmluZy5cclxuXHRcdFx0XHRcdFx0aWYgKG5vZGUuaGFzQXR0cmlidXRlKFwic3lzOmF0dGFjaFwiKSB8fCBub2RlLmhhc0F0dHJpYnV0ZShcInN5czppZlwiKSB8fCBub2RlLmhhc0F0dHJpYnV0ZShcInN5czpjb250ZW50LXRlbXBsYXRlXCIpKSB7XHJcblx0XHRcdFx0XHRcdFx0Z2VuZXJhdGVDaGlsZElkcyA9IHRydWU7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyBJZiBhIHN5czppZiBhdHRyaWJ1dGUgZXhpc3RzLCB0aGVuIHBvdGVudGlhbGx5IHJlbW92ZSB0aGUgZWxlbWVudCBmcm9tIHRoZSBET01cclxuXHRcdFx0XHRcdC8vIGRvbid0IHJlbW92ZSBpdCBpbW1lZGlhdGVseSBzaW5jZSBpdHMgY29udGVudHMgY291bGQgYWZmZWN0IGxpbmtpbmcgKGUuZy4gY2hpbGQgdGVtcGxhdGUgaW5kZXgpXHJcblx0XHRcdFx0XHRpZiAobm9kZS5oYXNBdHRyaWJ1dGUoXCJzeXM6aWZcIikpIHtcclxuXHRcdFx0XHRcdFx0dmFsdWUgPSBub2RlLmdldEF0dHJpYnV0ZShcInN5czppZlwiKTtcclxuXHRcdFx0XHRcdFx0aWYgKFN5cy5BcHBsaWNhdGlvbi5fZ2V0UHJvcGVydHlWYWx1ZShudWxsLCBudWxsLCBudWxsLCB2YWx1ZSwgY3VycmVudENvbnRleHQsIG5vZGUsIG51bGwsIHRydWUpKSB7XHJcblx0XHRcdFx0XHRcdFx0bm9kZS5yZW1vdmVBdHRyaWJ1dGUoXCJzeXM6aWZcIik7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0cGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZChub2RlKTtcclxuXHRcdFx0XHRcdFx0XHRjb250aW51ZTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdC8vIGdlbmVyYXRlIGNsaWVudCBpZFxyXG5cdFx0XHRcdFx0aWYgKG5vZGUuaGFzQXR0cmlidXRlKFwic3lzOmlkXCIpKSB7XHJcblx0XHRcdFx0XHRcdGlmIChub2RlLmlkKSB7XHJcblx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiRm91bmQgYSBzeXM6aWQgYmluZGluZyBpbiBwcmUtcmVuZGVyZWQgbWFya3VwLCBidXQgdGhlIGVsZW1lbnQgYWxyZWFkeSBoYXMgYW4gaWQuXCIpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHR2YWx1ZSA9IG5vZGUuZ2V0QXR0cmlidXRlKFwic3lzOmlkXCIpO1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gRXZhbHVhdGUgZXhwcmVzc2lvbiB2YWx1ZSBpbiB0aGUgY3VycmVudCBjb250ZXh0XHJcblx0XHRcdFx0XHRcdGlmICh2YWx1ZS5zdGFydHNXaXRoKFwie1wiKSAmJiB2YWx1ZS5lbmRzV2l0aChcIn1cIikpIHtcclxuXHRcdFx0XHRcdFx0XHRtc0F0dHJpYiA9IFN5cy5BcHBsaWNhdGlvbi5fc3BsaXRBdHRyaWJ1dGUoXCJpZFwiLCBmYWxzZSk7XHJcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSBTeXMuQXBwbGljYXRpb24uX2dldFByb3BlcnR5VmFsdWUobXNBdHRyaWIsIHBhcmVudEVsZW1lbnQsIFwiaWRcIiwgdmFsdWUsIGN1cnJlbnRDb250ZXh0LCBwYXJlbnRFbGVtZW50LCBudWxsLCB0cnVlKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHQvLyBPdGhlcndpc2UsIGNhbGwgZ2V0SW5zdGFuY2VJZCB0byBnZW5lcmF0ZSBhIHVuaXF1ZSBpZFxyXG5cdFx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHR2YWx1ZSA9IGN1cnJlbnRDb250ZXh0LmdldEluc3RhbmNlSWQodmFsdWUpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRub2RlLmlkID0gdmFsdWU7XHJcblxyXG5cdFx0XHRcdFx0XHRub2RlLnJlbW92ZUF0dHJpYnV0ZShcInN5czppZFwiKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2UgaWYgKGdlbmVyYXRlQ2hpbGRJZHMgJiYgbm9kZS5oYXNBdHRyaWJ1dGUoXCJpZFwiKSkge1xyXG5cdFx0XHRcdFx0XHR2YWx1ZSA9IG5vZGUuaWQ7XHJcblx0XHRcdFx0XHRcdG5vZGUuaWQgPSBjdXJyZW50Q29udGV4dC5nZXRJbnN0YW5jZUlkKHZhbHVlKTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyBEZXRlY3QgY29udGVudC10ZW1wbGF0ZSBhdHRyaWJ1dGVcclxuXHRcdFx0XHRcdGlmIChub2RlLmhhc0F0dHJpYnV0ZShcImRhdGEtc3lzLWNvbnRlbnQtdGVtcGxhdGVcIikpIHtcclxuXHRcdFx0XHRcdFx0Y29udGVudFRlbXBsYXRlID0gbm9kZS5nZXRBdHRyaWJ1dGUoXCJkYXRhLXN5cy1jb250ZW50LXRlbXBsYXRlXCIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdGNvbnRlbnRUZW1wbGF0ZSA9IG51bGw7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0Ly8gRGV0ZWN0IHRjaW5kZXggYXR0cmlidXRlXHJcblx0XHRcdFx0XHR0Y0lkeCA9IG5vZGUuZ2V0QXR0cmlidXRlKFwiZGF0YS1zeXMtdGNpbmRleFwiKTtcclxuXHJcblx0XHRcdFx0XHQvLyBhIGNvbnRyb2wgd2FzIHJlbmRlcmVkIHNlcnZlci1zaWRlLCBzbyBsaW5rIGl0IGFuZCBpdCdzIGF0dHJpYnV0ZXNcclxuXHRcdFx0XHRcdGlmIChub2RlLmhhc0F0dHJpYnV0ZShcImRhdGEtc3lzLWF0dGFjaFwiKSkge1xyXG5cdFx0XHRcdFx0XHRhdHRhY2hOYW1lID0gbm9kZS5nZXRBdHRyaWJ1dGUoXCJkYXRhLXN5cy1hdHRhY2hcIik7XHJcblx0XHRcdFx0XHRcdFN5cy5BcHBsaWNhdGlvbi5fbGlua0NvbnRyb2xFbGVtZW50KG5vZGUsIGN1cnJlbnRDb250ZXh0KTtcclxuXHJcblx0XHRcdFx0XHRcdC8vIFByb3ZpZGUgY29udHJvbCB3aXRoIGNvbnRlbnQgdGVtcGxhdGUgbmFtZXMgaWYgaXQgcmVxdWlyZXMgdGhlbS5cclxuXHRcdFx0XHRcdFx0Ly8gTk9URTogVGhlIGFzc3VtcHRpb24gdGhhdCB0aGUgY29udHJvbCdzIGNvbnN0cnVjdG9yIHdpbGwgYmUgYSBmdW5jdGlvbiBpcyBPS1xyXG5cdFx0XHRcdFx0XHQvLyBoZXJlIHNpbmNlIHdlIG11c3QgYXNzdW1lIHRoYXQgaXQgaXMgaW5kZWVkIGEgY29udHJvbCBmb3IgcHVycG9zZXMgb2YgbGlua2luZy5cclxuXHRcdFx0XHRcdFx0Ly8gQWxzbywgYXR0YWNoaW5nIGNvbnRyb2xzIHRvIGxhYmVsIGVsZW1lbnRzIHdvdWxkIGNhdXNlIG90aGVyIHByb2JsZW1zIGFueXdheS5cclxuXHRcdFx0XHRcdFx0aXNDb250ZW50VGVtcGxhdGUgPSBub2RlLmNvbnRyb2wuY29uc3RydWN0b3IuaW1wbGVtZW50c0ludGVyZmFjZShTeXMuVUkuSUNvbnRlbnRUZW1wbGF0ZUNvbnN1bWVyKTtcclxuXHRcdFx0XHRcdFx0aWYgKGlzQ29udGVudFRlbXBsYXRlKSB7XHJcblx0XHRcdFx0XHRcdFx0aWYgKGNvbnRlbnRUZW1wbGF0ZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0bm9kZS5jb250cm9sLmFkZENvbnRlbnRUZW1wbGF0ZShjb250ZW50VGVtcGxhdGUpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRpZiAocGFyZW50Q29udGVudFRlbXBsYXRlcykge1xyXG5cdFx0XHRcdFx0XHRcdFx0bm9kZS5jb250cm9sLmFkZENvbnRlbnRUZW1wbGF0ZShwYXJlbnRDb250ZW50VGVtcGxhdGVzKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0ZWxzZSBpZiAoY29udGVudFRlbXBsYXRlICE9PSBudWxsKSB7XHJcblx0XHRcdFx0XHRcdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihcImludmFsaWRTeXNDb250ZW50VGVtcGxhdGVcIik7XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdC8vIHNldCB0aGUgc2VydmVyLWdlbmVyYXRlZCBjdHggaWRcclxuXHRcdFx0XHRcdFx0aWYgKG5vZGUuY29udHJvbC5fc2V0VGVtcGxhdGVDdHhJZCkge1xyXG5cdFx0XHRcdFx0XHRcdG5vZGUuY29udHJvbC5fc2V0VGVtcGxhdGVDdHhJZCh0Y0lkeCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFN5cy5BcHBsaWNhdGlvbi5fbGlua0F0dHJpYnV0ZXMobm9kZSwgY3VycmVudENvbnRleHQsIGF0dGFjaE5hbWUpO1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gZGV0ZXJtaW5lIHdoZXRoZXIgdGhlIGNvbnRyb2wgaXMgYSBjb250ZXh0LWdlbmVyYXRpbmcgY29udHJvbCAoaS5lLiBkYXRhdmlldyksIGluXHJcblx0XHRcdFx0XHRcdC8vIHdoaWNoIGNhc2UgaXQgd2lsbCBiZSByZXNwb25zaWJsZSBmb3IgbGlua2luZyBpdCdzIG93biBjb250ZW50XHJcblx0XHRcdFx0XHRcdGlmIChub2RlLmNvbnRyb2wuX2dlbmVyYXRlc0NvbnRleHQpIHtcclxuXHRcdFx0XHRcdFx0XHRnZW5lcmF0ZXNDb250ZXh0ID0gbm9kZS5jb250cm9sLl9nZW5lcmF0ZXNDb250ZXh0KCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdC8vIGlmIHRoZSBjb250cm9sIGdldHMgaXRzIHRlbXBsYXRlIGZyb20gaXQncyBwYXJlbnQncyB0ZW1wbGF0ZSBpdCBzaG91bGQgdXNlXHJcblx0XHRcdFx0XHRcdGlmIChnZW5lcmF0ZXNDb250ZXh0ICYmIG5vZGUuY29udHJvbC5fc2V0VGVtcGxhdGUpIHtcclxuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mICh0bXBsSWR4KSAhPT0gXCJudW1iZXJcIikge1xyXG5cdFx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiQSB0ZW1wbGF0ZWQgY29udHJvbCBpcyBhdHRhY2hlZCB0byB0aGUgbm9kZSwgYnV0IG5vIHRlbXBsYXRlIGluZGV4IHdhcyBzcGVjaWZpZWQuXCIpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR0bXBsID0gbmV3IFN5cy5VSS5UZW1wbGF0ZShjdXJyZW50Q29udGV4dC50ZW1wbGF0ZS5nZXRfZWxlbWVudCgpLl9tc2FqYXh0ZW1wbGF0ZVsyXVt0bXBsSWR4XVsxXSk7XHJcblx0XHRcdFx0XHRcdFx0dG1wbC5fZW5zdXJlQ29tcGlsZWQoKTtcclxuXHRcdFx0XHRcdFx0XHRub2RlLmNvbnRyb2wuX3NldFRlbXBsYXRlKHRtcGwpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHQvLyByZWdpc3RlciB0aGUgY29udHJvbCB3aXRoIHRoZSBjb250ZXh0IGhlcmUgcmF0aGVyIHRoYW4gd2hlblxyXG5cdFx0XHRcdFx0XHQvLyBsaW5raW5nIHRoZSBjb250cm9sIChzbyB0aGF0IGF0dHJpYnV0ZXMgY2FuIGJlIGxpbmtlZCBmaXJzdD8pXHJcblx0XHRcdFx0XHRcdGN1cnJlbnRDb250ZXh0Ll9yZWdpc3RlckNvbXBvbmVudChub2RlLmNvbnRyb2wpO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGlmIChwYXJlbnRDb250ZW50VGVtcGxhdGVzKSB7XHJcblx0XHRcdFx0XHRcdGNoaWxkQ29udGVudFRlbXBsYXRlcyA9IHBhcmVudENvbnRlbnRUZW1wbGF0ZXM7XHJcblx0XHRcdFx0XHRcdGlmIChjb250ZW50VGVtcGxhdGUpIHtcclxuXHRcdFx0XHRcdFx0XHRjaGlsZENvbnRlbnRUZW1wbGF0ZXMgKz0gXCIgXCIgKyBjb250ZW50VGVtcGxhdGU7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2UgaWYgKGNvbnRlbnRUZW1wbGF0ZSkge1xyXG5cdFx0XHRcdFx0XHRjaGlsZENvbnRlbnRUZW1wbGF0ZXMgPSBjb250ZW50VGVtcGxhdGU7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0Y2hpbGRDb250ZW50VGVtcGxhdGVzID0gbnVsbDtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHQvLyBpZiB0aGUgZWxlbWVudCBkb2Vzbid0IGdlbmVyYXRlIGEgY29udGV4dCwgdGhlbiByZWN1cnNpdmVseSBsaW5rIGl0J3MgY2hpbGRyZW5cclxuXHRcdFx0XHRcdGlmICghZ2VuZXJhdGVzQ29udGV4dCkge1xyXG5cdFx0XHRcdFx0XHQvLyBpZiB0aGUgbm9kZSBpcyBhIHRlbXBsYXRlIChjbGFzcyA9IFwic3lzLXRlbXBsYXRlXCIpLCB0aGVuIGluY3JlbWVudCB0aGUgY2hpbGQgdGVtcGxhdGUgaW5kZXggc28gdGhhdFxyXG5cdFx0XHRcdFx0XHQvLyBjb250ZXh0LWdlbmVyYXRpbmcgY29udHJvbHMgdGhhdCBmb2xsb3cgd2lsbCBiZSBhc3NpZ25lZCB0aGUgY29ycmVjdCB0ZW1wbGF0ZVxyXG5cdFx0XHRcdFx0XHRpZiAoU3lzLlVJLlRlbXBsYXRlLl9pc1RlbXBsYXRlKG5vZGUpKSB7XHJcblx0XHRcdFx0XHRcdFx0YXR0YWNoTmFtZSA9IG5vZGUuZ2V0QXR0cmlidXRlKFwic3lzOmF0dGFjaFwiKTtcclxuXHRcdFx0XHRcdFx0XHRTeXMuQXBwbGljYXRpb24uX2FjdGl2YXRlRWxlbWVudChub2RlLCBjdXJyZW50Q29udGV4dCwgaXNCcm93c2VyKFwiSW50ZXJuZXRFeHBsb3JlclwiKSAmJiBTeXMuQnJvd3Nlci52ZXJzaW9uIDwgOSwgY2hpbGRDb250ZW50VGVtcGxhdGVzLCB0cnVlKTtcclxuXHRcdFx0XHRcdFx0XHRTeXMuQXBwbGljYXRpb24uX2xpbmtBdHRyaWJ1dGVzKG5vZGUsIGN1cnJlbnRDb250ZXh0LCBhdHRhY2hOYW1lKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHQvLyBJZiB0aGUgbm9kZSBoYXMgYW55IGF0dHJpYnV0ZXMgdGhhdCB3ZXJlbid0IHJlbmRlcmVkIChpLmUuIFwic3lzOlwiIGF0dHJpYnV0ZXMpLCB0aGVuIGFjdGl2YXRlIG9ubHkgdGhpcyBub2RlXHJcblx0XHRcdFx0XHRcdFx0aWYgKEFycmF5LnByb3RvdHlwZS5zb21lLmNhbGwobm9kZS5hdHRyaWJ1dGVzLCBmdW5jdGlvbiAoYSkgeyByZXR1cm4gYS5uYW1lLmluZGV4T2YoXCI6XCIpID49IDA7IH0pKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRTeXMuQXBwbGljYXRpb24uX2FjdGl2YXRlRWxlbWVudChub2RlLCBjdXJyZW50Q29udGV4dCwgaXNCcm93c2VyKFwiSW50ZXJuZXRFeHBsb3JlclwiKSAmJiBTeXMuQnJvd3Nlci52ZXJzaW9uIDwgOSwgY2hpbGRDb250ZW50VGVtcGxhdGVzLCBmYWxzZSk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdGlmICghU3lzLkFwcGxpY2F0aW9uLl9saW5rQXR0cmlidXRlcyhub2RlLCBjdXJyZW50Q29udGV4dCwgYXR0YWNoTmFtZSkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdC8vIFRoZSBlbGVtZW50IGRpZCBOT1QgaGF2ZSBhbiBhdHRyaWJ1dGUgdGhhdCByZXN1bHRzIGluIGxpbmtpbmcgdGhlIGNvbnRlbnRcclxuXHRcdFx0XHRcdFx0XHRcdC8vIG9mIHRoZSBlbGVtZW50IChpLmUuIGlubmVySFRNTCBvciBpbm5lclRleHQpLCBzbyByZWN1cnNpdmVseSBsaW5rIGNoaWxkIG5vZGVzLlxyXG5cdFx0XHRcdFx0XHRcdFx0U3lzLkFwcGxpY2F0aW9uLl9saW5rQ29udGV4dHMocGFyZW50Q29udGV4dCwgcGFyZW50Q29udHJvbCwgcGFyZW50RGF0YSwgbm9kZSwgY3VycmVudENvbnRleHQsIGNoaWxkQ29udGVudFRlbXBsYXRlcywgdHJ1ZSwgZ2VuZXJhdGVDaGlsZElkcyk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoIXJlY3Vyc2l2ZSAmJiBpc0FycmF5RGF0YSAmJiAhaXNTaW5nbGVFeHRlcm5hbENvbnRleHQgJiYgY3R4SWR4ICE9IHBhcmVudERhdGEubGVuZ3RoIC0gMSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIlVuZXhwZWN0ZWQgbnVtYmVyIG9mIGNvbnRleHRzOiBleHBlY3RlZCBcIiArIHBhcmVudERhdGEubGVuZ3RoICsgXCIgYnV0IGZvdW5kIFwiICsgKGN0eElkeCArIDEpKTtcclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHJcblx0XHRTeXMuQXBwbGljYXRpb24uX2xpbmtDb250cm9sRWxlbWVudCA9IGZ1bmN0aW9uIFN5cyRBcHBsaWNhdGlvbiRfbGlua0NvbnRyb2xFbGVtZW50KGVsZW1lbnQsIHBhcmVudENvbnRleHQpIHtcclxuXHRcdFx0aWYgKCFlbGVtZW50Lmhhc0F0dHJpYnV0ZShcImRhdGEtc3lzLWF0dGFjaFwiKSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIkVsZW1lbnQgJ1wiICsgU3lzJEFwcGxpY2F0aW9uJF9lbGVtZW50VG9TdHJpbmcoZWxlbWVudCkgKyBcIicgaXMgbm90IGEgY29udHJvbC5cIik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciBjb250cm9sVHlwZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiZGF0YS1zeXMtYXR0YWNoXCIpLFxyXG5cdFx0XHRcdHR5cGUgPSBTeXMuQXBwbGljYXRpb24uX2ZpbmRUeXBlKGVsZW1lbnQsIGNvbnRyb2xUeXBlLCBpc0Jyb3dzZXIoXCJJbnRlcm5ldEV4cGxvcmVyXCIpICYmIFN5cy5Ccm93c2VyLnZlcnNpb24gPCA5KSxcclxuXHRcdFx0XHRpc0NvbnRleHQgPSB0eXBlLmltcGxlbWVudHNJbnRlcmZhY2UoU3lzLlVJLklUZW1wbGF0ZUNvbnRleHRDb25zdW1lciksXHJcblx0XHRcdFx0Y29udHJvbCA9IG5ldyB0eXBlKGVsZW1lbnQpO1xyXG5cclxuXHRcdFx0Y29udHJvbC5iZWdpblVwZGF0ZSgpO1xyXG5cdFx0XHRjb250cm9sLnNldF9pc0xpbmtQZW5kaW5nKHRydWUpO1xyXG5cdFx0XHRpZiAoaXNDb250ZXh0KSB7XHJcblx0XHRcdFx0Y29udHJvbC5zZXRfdGVtcGxhdGVDb250ZXh0KHBhcmVudENvbnRleHQpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZXR1cm4gY29udHJvbFR5cGU7XHJcblx0XHR9O1xyXG5cclxuXHRcdFN5cy5BcHBsaWNhdGlvbi5saW5rRWxlbWVudCA9IGZ1bmN0aW9uIChlbGVtZW50LCB0bXBsRWxlbWVudCkge1xyXG5cdFx0XHR2YXIgYXBwQ29udGV4dCwgY29udHJvbCwgY29udHJvbFR5cGUsIHRtcGwsIGNvbnRlbnRUZW1wbGF0ZSwgaXNDb250ZW50VGVtcGxhdGU7XHJcblxyXG5cdFx0XHQvLyBJbml0aWFsaXplIHRoZSBhcHBsaWNhdGlvbiBjb250ZXh0XHJcblx0XHRcdGFwcENvbnRleHQgPSBTeXMuQXBwbGljYXRpb24uX2NvbnRleHQ7XHJcblx0XHRcdGFwcENvbnRleHQuZGF0YUl0ZW0gPSBudWxsO1xyXG5cdFx0XHRhcHBDb250ZXh0LmNvbXBvbmVudHMgPSBhcHBDb250ZXh0LmNvbXBvbmVudHMgfHwgW107XHJcblx0XHRcdGFwcENvbnRleHQubm9kZXMgPSBbZWxlbWVudF07XHJcblxyXG5cdFx0XHQvLyBJbml0aWFsaXplIHRoZSByb290IGNvbnRyb2xcclxuXHRcdFx0Y29udHJvbFR5cGUgPSBTeXMuQXBwbGljYXRpb24uX2xpbmtDb250cm9sRWxlbWVudChlbGVtZW50LCBhcHBDb250ZXh0KTtcclxuXHJcblx0XHRcdC8vIE5PVEU6IEFzc3VtcHRpb24gdGhhdCB0aGUgY29udHJvbCBpcyBhbiBNc0FqYXggY29udHJvbCBpcyBPSyBoZXJlLCBzaW5jZSB3ZVxyXG5cdFx0XHQvLyBhcmUgbGlua2luZyB0aGUgZWxlbWVudCBpZiBpdCBpcyBub3QgYSBjb250cm9sIHRoZW4gaXQgaXMgYW4gZXJyb3Igc2NlbmFyaW8uXHJcblx0XHRcdGNvbnRyb2wgPSBlbGVtZW50LmNvbnRyb2w7XHJcblxyXG5cdFx0XHQvLyBEZXRlY3QgY29udGVudC10ZW1wbGF0ZSBhdHRyaWJ1dGVcclxuXHRcdFx0aWYgKGVsZW1lbnQuaGFzQXR0cmlidXRlKFwiZGF0YS1zeXMtY29udGVudC10ZW1wbGF0ZVwiKSkge1xyXG5cdFx0XHRcdGlzQ29udGVudFRlbXBsYXRlID0gY29udHJvbC5jb25zdHJ1Y3Rvci5pbXBsZW1lbnRzSW50ZXJmYWNlKFN5cy5VSS5JQ29udGVudFRlbXBsYXRlQ29uc3VtZXIpO1xyXG5cdFx0XHRcdGlmICghaXNDb250ZW50VGVtcGxhdGUpIHtcclxuXHRcdFx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oXCJpbnZhbGlkU3lzQ29udGVudFRlbXBsYXRlXCIpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRjb250ZW50VGVtcGxhdGUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZShcImRhdGEtc3lzLWNvbnRlbnQtdGVtcGxhdGVcIik7XHJcblx0XHRcdFx0aWYgKGNvbnRlbnRUZW1wbGF0ZSkge1xyXG5cdFx0XHRcdFx0Y29udHJvbC5hZGRDb250ZW50VGVtcGxhdGUoY29udGVudFRlbXBsYXRlKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIFNldCB0aGUgdGVtcGxhdGVcclxuXHRcdFx0aWYgKGNvbnRyb2wuX3NldFRlbXBsYXRlKSB7XHJcblx0XHRcdFx0dG1wbCA9IG5ldyBTeXMuVUkuVGVtcGxhdGUodG1wbEVsZW1lbnQpO1xyXG5cdFx0XHRcdHRtcGwuX2Vuc3VyZUNvbXBpbGVkKCk7XHJcblx0XHRcdFx0Y29udHJvbC5fc2V0VGVtcGxhdGUodG1wbCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdFN5cy5BcHBsaWNhdGlvbi5fbGlua0F0dHJpYnV0ZXMoZWxlbWVudCwgYXBwQ29udGV4dCwgY29udHJvbFR5cGUpO1xyXG5cclxuXHRcdFx0YXBwQ29udGV4dC5fcmVnaXN0ZXJDb21wb25lbnQoY29udHJvbCk7XHJcblx0XHRcdGFwcENvbnRleHQuaW5pdGlhbGl6ZUNvbXBvbmVudHMoKTtcclxuXHRcdFx0YXBwQ29udGV4dC5fb25JbnN0YW50aWF0ZWQobnVsbCwgdHJ1ZSk7XHJcblx0XHR9O1xyXG5cclxuXHRcdFN5cy5BcHBsaWNhdGlvbi5fY2xlYXJDb250ZW50ID0gZnVuY3Rpb24gU3lzJEFwcGxpY2F0aW9uJF9jbGVhckNvbnRlbnQoZWxlbWVudCkge1xyXG5cdFx0XHR2YXIgZXJyO1xyXG5cdFx0XHRTeXMuQXBwbGljYXRpb24uZGlzcG9zZUVsZW1lbnQoZWxlbWVudCwgdHJ1ZSk7XHJcblx0XHRcdHRyeSB7IGVsZW1lbnQuaW5uZXJIVE1MID0gXCJcIjsgfVxyXG5cdFx0XHRjYXRjaCAoZXJyKSB7XHJcblx0XHRcdFx0d2hpbGUgKGVsZW1lbnQuZmlyc3RDaGlsZCkge1xyXG5cdFx0XHRcdFx0ZWxlbWVudC5yZW1vdmVDaGlsZChlbGVtZW50LmZpcnN0Q2hpbGQpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0U3lzLkFwcGxpY2F0aW9uLl9nZXRDb21tYW5kQXR0ciA9IGZ1bmN0aW9uIFN5cyRBcHBsaWNhdGlvbiRfZ2V0Q29tbWFuZEF0dHIoZWxlbWVudCwgdGVtcGxhdGVDb250ZXh0LCBuYW1lLCB1c2VEaXJlY3QpIHtcclxuXHRcdFx0dmFyIGVyciwgdmFsdWUgPSBudWxsO1xyXG5cdFx0XHR0cnkge1xyXG5cdFx0XHRcdHZhbHVlID0gdXNlRGlyZWN0ID8gZWxlbWVudFtuYW1lXSA6IGVsZW1lbnQuZ2V0QXR0cmlidXRlKG5hbWUpO1xyXG5cdFx0XHRcdHZhbHVlID0gdmFsdWUgPyBTeXMuQXBwbGljYXRpb24uX2dldFByb3BlcnR5VmFsdWUobnVsbCwgbnVsbCwgbnVsbCwgdmFsdWUsIHRlbXBsYXRlQ29udGV4dCwgZWxlbWVudCwgbnVsbCwgdHJ1ZSkgOiBudWxsO1xyXG5cdFx0XHR9XHJcblx0XHRcdGNhdGNoIChlcnIpIHsgfVxyXG5cdFx0XHRyZXR1cm4gdmFsdWU7XHJcblx0XHR9XHJcblx0XHRTeXMuQXBwbGljYXRpb24uX2RpcmVjdEF0dHJpYnV0ZXMgPSB7XHJcblx0XHRcdFwic3R5bGVcIjogXCJzdHlsZS5jc3NUZXh0XCIsXHJcblx0XHRcdFwiY2xhc3NcIjogXCJjbGFzc05hbWVcIixcclxuXHRcdFx0XCJjZWxscGFkZGluZ1wiOiBcImNlbGxQYWRkaW5nXCIsXHJcblx0XHRcdFwiY2VsbHNwYWNpbmdcIjogXCJjZWxsU3BhY2luZ1wiLFxyXG5cdFx0XHRcImNvbHNwYW5cIjogXCJjb2xTcGFuXCIsXHJcblx0XHRcdFwicm93c3BhblwiOiBcInJvd1NwYW5cIixcclxuXHRcdFx0XCJjb250ZW50ZWRpdGFibGVcIjogXCJjb250ZW50RWRpdGFibGVcIixcclxuXHRcdFx0XCJ2YWxpZ25cIjogXCJ2QWxpZ25cIixcclxuXHRcdFx0XCJpbm5lcnRleHRcIjogXCJpbm5lclRleHRcIixcclxuXHRcdFx0XCJpbm5lcmh0bWxcIjogXCJpbm5lckhUTUxcIlxyXG5cdFx0fVxyXG5cdFx0U3lzLkFwcGxpY2F0aW9uLl9zcGxpdEF0dHJpYnV0ZSA9IGZ1bmN0aW9uIFN5cyRBcHBsaWNhdGlvbiRfc3BsaXRBdHRyaWJ1dGUoYXR0cmlidXRlTmFtZSwgaXNTZWxlY3QsIHR5cGVJbmRleCkge1xyXG5cdFx0XHR2YXIgbmFtZVBhcnRzID0gYXR0cmlidXRlTmFtZS5zcGxpdCgnOicpLFxyXG5cdFx0XHRucyA9IG5hbWVQYXJ0cy5sZW5ndGggPiAxID8gbmFtZVBhcnRzWzBdIDogbnVsbCxcclxuXHRcdFx0bmFtZSA9IG5hbWVQYXJ0c1tucyA/IDEgOiAwXSxcclxuXHRcdFx0dHlwZSA9IC0xLFxyXG5cdFx0XHR0ZXh0Tm9kZSwgbWFwLCBpbmRleCwgaXNTeXMgPSAobnMgPT09IFwic3lzXCIpLFxyXG5cdFx0XHRsb3dlck5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCksXHJcblx0XHRcdGlzTmF0aXZlID0gIW5zO1xyXG5cdFx0XHRpZiAoIW5zIHx8IGlzU3lzKSB7XHJcblx0XHRcdFx0dmFyIG5ld05hbWUgPSBTeXMuQXBwbGljYXRpb24uX2RpcmVjdEF0dHJpYnV0ZXNbbG93ZXJOYW1lXTtcclxuXHRcdFx0XHRpZiAobmV3TmFtZSkge1xyXG5cdFx0XHRcdFx0dHlwZSA9IDE7XHJcblx0XHRcdFx0XHRpZiAobmFtZSA9PT0gXCJpbm5lcnRleHRcIikge1xyXG5cdFx0XHRcdFx0XHR0ZXh0Tm9kZSA9IHRydWU7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRuYW1lID0gbmV3TmFtZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSBpZiAoaXNTZWxlY3QpIHtcclxuXHRcdFx0XHRcdGlmIChsb3dlck5hbWUgPT09IFwic2VsZWN0ZWRpbmRleFwiKSB7XHJcblx0XHRcdFx0XHRcdG5hbWUgPSBcInNlbGVjdGVkSW5kZXhcIjtcclxuXHRcdFx0XHRcdFx0dHlwZSA9IDE7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIGlmIChuYW1lID09PSBcInZhbHVlXCIpIHtcclxuXHRcdFx0XHRcdFx0dHlwZSA9IDE7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIGlmIChpc1N5cykge1xyXG5cdFx0XHRcdFx0XHR0eXBlID0gMDtcclxuXHRcdFx0XHRcdFx0bnMgPSBudWxsO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmIChpc1N5cykge1xyXG5cdFx0XHRcdFx0aWYgKChuYW1lID09PSBcImNvbW1hbmRcIikgfHwgKG5hbWUgPT09IFwiY29tbWFuZGFyZ3VtZW50XCIpIHx8IChuYW1lID09PSBcImNvbW1hbmR0YXJnZXRcIikpIHtcclxuXHRcdFx0XHRcdFx0dHlwZSA9IDQ7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIGlmIChuYW1lLmluZGV4T2YoXCJzdHlsZS1cIikgPT09IDApIHtcclxuXHRcdFx0XHRcdFx0bmFtZSA9IFwic3R5bGUuXCIgKyBTeXMuQXBwbGljYXRpb24uX3RyYW5zbGF0ZVN0eWxlTmFtZShuYW1lLnN1YnN0cig2KSk7XHJcblx0XHRcdFx0XHRcdHR5cGUgPSAxO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAobmFtZS5pbmRleE9mKFwiY2xhc3MtXCIpID09PSAwKSB7XHJcblx0XHRcdFx0XHRcdG5hbWUgPSBuYW1lLnN1YnN0cig2KTtcclxuXHRcdFx0XHRcdFx0dHlwZSA9IDI7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0bnMgPSBudWxsO1xyXG5cdFx0XHRcdFx0XHR0eXBlID0gMDtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAodHlwZUluZGV4KSB7XHJcblx0XHRcdFx0aW5kZXggPSB0eXBlSW5kZXhbbnNdO1xyXG5cdFx0XHRcdGlmIChpbmRleCkge1xyXG5cdFx0XHRcdFx0dHlwZSA9IDM7XHJcblx0XHRcdFx0XHRpZiAoaW5kZXguaXNDbGFzcykge1xyXG5cdFx0XHRcdFx0XHRtYXAgPSBTeXMuQXBwbGljYXRpb24uX3RyYW5zbGF0ZU5hbWUobmFtZSwgaW5kZXgudHlwZSk7XHJcblx0XHRcdFx0XHRcdG5hbWUgPSBtYXAubmFtZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRuYW1lID0gbnMgKyBcIjpcIiArIG5hbWU7XHJcblx0XHRcdFx0XHRucyA9IG51bGw7XHJcblx0XHRcdFx0XHR0eXBlID0gLTE7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdG5hbWUgPSBucyArIFwiOlwiICsgbmFtZTtcclxuXHRcdFx0XHRucyA9IG51bGw7XHJcblx0XHRcdFx0dHlwZSA9IC0xO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiB7IG5zOiBucywgbmFtZTogbmFtZSwgdHlwZTogdHlwZSwgbWFwOiBtYXAsIGluZGV4OiBpbmRleCwgdGV4dE5vZGU6IHRleHROb2RlLCBpc05hdGl2ZTogaXNOYXRpdmUgfTtcclxuXHRcdH1cclxuXHJcblx0XHRTeXMuQXBwbGljYXRpb24uX3RyYW5zbGF0ZVN0eWxlTmFtZSA9IGZ1bmN0aW9uIFN5cyRBcHBsaWNhdGlvbiRfdHJhbnNsYXRlU3R5bGVOYW1lKG5hbWUpIHtcclxuXHRcdFx0aWYgKG5hbWUuaW5kZXhPZignLScpID09PSAtMSkgcmV0dXJuIG5hbWU7XHJcblx0XHRcdHZhciBwYXJ0cyA9IG5hbWUudG9Mb3dlckNhc2UoKS5zcGxpdCgnLScpLFxyXG5cdFx0bmV3TmFtZSA9IHBhcnRzWzBdO1xyXG5cdFx0XHRmb3IgKHZhciBpID0gMSwgbCA9IHBhcnRzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG5cdFx0XHRcdHZhciBwYXJ0ID0gcGFydHNbaV07XHJcblx0XHRcdFx0bmV3TmFtZSArPSBwYXJ0LnN1YnN0cigwLCAxKS50b1VwcGVyQ2FzZSgpICsgcGFydC5zdWJzdHIoMSk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIG5ld05hbWU7XHJcblx0XHR9XHJcblxyXG5cdFx0U3lzLkFwcGxpY2F0aW9uLl9nZXRFeHRlbnNpb25Db2RlID0gZnVuY3Rpb24gU3lzJEFwcGxpY2F0aW9uJF9nZXRFeHRlbnNpb25Db2RlKGV4dGVuc2lvbiwgZG9FdmFsLCB0ZW1wbGF0ZUNvbnRleHQsIGVsZW1lbnQpIHtcclxuXHRcdFx0ZXh0ZW5zaW9uID0gZXh0ZW5zaW9uLnRyaW0oKTtcclxuXHRcdFx0dmFyIG5hbWUsIHByb3BlcnRpZXMsIHByb3BlcnR5QmFnID0ge30sIHNwYWNlSW5kZXggPSBleHRlbnNpb24uaW5kZXhPZignICcpO1xyXG5cdFx0XHRpZiAoc3BhY2VJbmRleCAhPT0gLTEpIHtcclxuXHRcdFx0XHRuYW1lID0gZXh0ZW5zaW9uLnN1YnN0cigwLCBzcGFjZUluZGV4KTtcclxuXHRcdFx0XHRwcm9wZXJ0aWVzID0gZXh0ZW5zaW9uLnN1YnN0cihzcGFjZUluZGV4ICsgMSk7XHJcblx0XHRcdFx0aWYgKHByb3BlcnRpZXMpIHtcclxuXHRcdFx0XHRcdHByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLnJlcGxhY2UoL1xcXFwsL2csICdcXHUwMDAwJykuc3BsaXQoXCIsXCIpO1xyXG5cdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDAsIGwgPSBwcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG5cdFx0XHRcdFx0XHR2YXIgcHJvcGVydHkgPSBwcm9wZXJ0aWVzW2ldLnJlcGxhY2UoL1xcdTAwMDAvZywgXCIsXCIpLFxyXG5cdFx0XHRcdFx0XHRlcXVhbEluZGV4ID0gcHJvcGVydHkuaW5kZXhPZignPScpLFxyXG5cdFx0XHRcdFx0XHRwVmFsdWUsIHBOYW1lO1xyXG5cdFx0XHRcdFx0XHRpZiAoZXF1YWxJbmRleCAhPT0gLTEpIHtcclxuXHRcdFx0XHRcdFx0XHRwTmFtZSA9IHByb3BlcnR5LnN1YnN0cigwLCBlcXVhbEluZGV4KS50cmltKCk7XHJcblx0XHRcdFx0XHRcdFx0cFZhbHVlID0gcHJvcGVydHkuc3Vic3RyKGVxdWFsSW5kZXggKyAxKS50cmltKCk7XHJcblx0XHRcdFx0XHRcdFx0aWYgKGRvRXZhbCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0cFZhbHVlID0gdGhpcy5fZ2V0UHJvcGVydHlWYWx1ZShudWxsLCBudWxsLCBudWxsLCBwVmFsdWUsIHRlbXBsYXRlQ29udGV4dCwgZWxlbWVudCwgdHJ1ZSk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdHBOYW1lID0gXCIkZGVmYXVsdFwiO1xyXG5cdFx0XHRcdFx0XHRcdHBWYWx1ZSA9IHByb3BlcnR5LnRyaW0oKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRwcm9wZXJ0eUJhZ1twTmFtZV0gPSBwVmFsdWU7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdG5hbWUgPSBleHRlbnNpb247XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHsgaW5zdGFuY2U6IFN5cy5BcHBsaWNhdGlvbi5fZ2V0TWFya3VwRXh0ZW5zaW9uKG5hbWUpLCBuYW1lOiBuYW1lLCBwcm9wZXJ0aWVzOiBwcm9wZXJ0eUJhZyB9O1xyXG5cdFx0fVxyXG5cclxuXHRcdFN5cy5BcHBsaWNhdGlvbi5fZ2V0UHJvcGVydHlWYWx1ZSA9IGZ1bmN0aW9uIFN5cyRBcHBsaWNhdGlvbiRfZ2V0UHJvcGVydHlWYWx1ZShhdHRyaWIsIHRhcmdldCwgbmFtZSwgdmFsdWUsIHRlbXBsYXRlQ29udGV4dCwgZWxlbWVudCwgaW5FeHRlbnNpb24sIHN1cHByZXNzRXh0ZW5zaW9uLCBhZGRpdGlvbmFsUHJvcGVydGllcykge1xyXG5cdFx0XHR2YXIgcHJvcGVydHlWYWx1ZSA9IHZhbHVlLnJlcGxhY2UoLyZsdDsvLCBcIjxcIikucmVwbGFjZSgvJmd0Oy8sIFwiPlwiKTtcclxuXHRcdFx0aWYgKHByb3BlcnR5VmFsdWUuc3RhcnRzV2l0aChcInt7XCIpICYmIHByb3BlcnR5VmFsdWUuZW5kc1dpdGgoXCJ9fVwiKSkge1xyXG5cdFx0XHRcdHByb3BlcnR5VmFsdWUgPSB0aGlzLl9ldmFsdWF0ZUV4cHJlc3Npb24ocHJvcGVydHlWYWx1ZS5zbGljZSgyLCAtMiksIHRlbXBsYXRlQ29udGV4dCwgZWxlbWVudCk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoIXN1cHByZXNzRXh0ZW5zaW9uICYmICFpbkV4dGVuc2lvbiAmJiBwcm9wZXJ0eVZhbHVlLnN0YXJ0c1dpdGgoXCJ7XCIpICYmIHByb3BlcnR5VmFsdWUuZW5kc1dpdGgoXCJ9XCIpKSB7XHJcblx0XHRcdFx0dmFyIGV4dGVuc2lvbiA9IHRoaXMuX2dldEV4dGVuc2lvbkNvZGUocHJvcGVydHlWYWx1ZS5zbGljZSgxLCAtMSksIHRydWUsIHRlbXBsYXRlQ29udGV4dCwgZWxlbWVudCk7XHJcblx0XHRcdFx0cHJvcGVydHlWYWx1ZSA9IGV4dGVuc2lvbi5pbnN0YW5jZS5leHRlbnNpb24odGFyZ2V0LCAoYXR0cmliLnR5cGUgPT09IDIgPyBcImNsYXNzOlwiIDogXCJcIikgKyBuYW1lLCB0ZW1wbGF0ZUNvbnRleHQsIG1lcmdlKGFkZGl0aW9uYWxQcm9wZXJ0aWVzIHx8IHt9LCBleHRlbnNpb24ucHJvcGVydGllcykpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiBwcm9wZXJ0eVZhbHVlO1xyXG5cdFx0fVxyXG5cdFx0U3lzLkFwcGxpY2F0aW9uLl90cnlOYW1lID0gZnVuY3Rpb24gU3lzJEFwcGxpY2F0aW9uJF90cnlOYW1lKG5hbWUsIHR5cGUpIHtcclxuXHRcdFx0dmFyIHByb3RvdHlwZSA9IHR5cGUucHJvdG90eXBlLFxyXG5cdFx0c2V0dGVyTmFtZSA9IFwic2V0X1wiICsgbmFtZSwgc2V0dGVyID0gcHJvdG90eXBlW3NldHRlck5hbWVdO1xyXG5cdFx0XHRpZiAoc2V0dGVyKSB7XHJcblx0XHRcdFx0cmV0dXJuIHsgbmFtZTogbmFtZSwgc2V0dGVyTmFtZTogc2V0dGVyTmFtZSwgc2V0dGVyOiBzZXR0ZXIsIHR5cGU6IDEgfTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAobmFtZS5zdGFydHNXaXRoKCdvbicpKSB7XHJcblx0XHRcdFx0c2V0dGVyTmFtZSA9IFwiYWRkX1wiICsgbmFtZS5zdWJzdHIoMik7XHJcblx0XHRcdFx0dmFyIGFkZGVyID0gcHJvdG90eXBlW3NldHRlck5hbWVdO1xyXG5cdFx0XHRcdGlmIChhZGRlcikge1xyXG5cdFx0XHRcdFx0cmV0dXJuIHsgbmFtZTogbmFtZSwgc2V0dGVyTmFtZTogc2V0dGVyTmFtZSwgc2V0dGVyOiBhZGRlciwgdHlwZTogMiB9O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodHlwZW9mIChwcm90b3R5cGVbbmFtZV0pICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcblx0XHRcdFx0cmV0dXJuIHsgbmFtZTogbmFtZSB9O1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiBudWxsO1xyXG5cdFx0fVxyXG5cdFx0U3lzLkFwcGxpY2F0aW9uLl90cmFuc2xhdGVOYW1lID0gZnVuY3Rpb24gU3lzJEFwcGxpY2F0aW9uJF90cmFuc2xhdGVOYW1lKG5hbWUsIHR5cGUpIHtcclxuXHRcdFx0aWYgKG5hbWUgJiYgKG5hbWUgIT09IG5hbWUudG9Mb3dlckNhc2UoKSkpIHtcclxuXHRcdFx0XHR0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN0cmluZy5mb3JtYXQoU3lzLlVJLlRlbXBsYXRlc1Jlcy5pbnZhbGlkQXR0cmlidXRlTmFtZSwgbmFtZSkpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHZhciBjYWNoZSwgaW5kZXggPSBTeXMuQXBwbGljYXRpb24uX3Byb3RvdHlwZUluZGV4W3R5cGUuX190eXBlTmFtZV07XHJcblx0XHRcdGlmIChpbmRleCkge1xyXG5cdFx0XHRcdGNhY2hlID0gaW5kZXhbbmFtZV07XHJcblx0XHRcdFx0aWYgKGNhY2hlKSByZXR1cm4gY2FjaGU7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0aW5kZXggPSB7fTtcclxuXHRcdFx0fVxyXG5cdFx0XHR0eXBlLnJlc29sdmVJbmhlcml0YW5jZSgpO1xyXG5cdFx0XHRjYWNoZSA9IFN5cy5BcHBsaWNhdGlvbi5fdHJ5TmFtZShuYW1lLCB0eXBlKTtcclxuXHRcdFx0aWYgKCFjYWNoZSkge1xyXG5cdFx0XHRcdHZhciBjYXNlZE5hbWUgPSBTeXMuQXBwbGljYXRpb24uX21hcFRvUHJvdG90eXBlKG5hbWUsIHR5cGUpO1xyXG5cdFx0XHRcdGlmIChjYXNlZE5hbWUgJiYgKGNhc2VkTmFtZSAhPT0gbmFtZSkpIHtcclxuXHRcdFx0XHRcdGNhY2hlID0gU3lzLkFwcGxpY2F0aW9uLl90cnlOYW1lKGNhc2VkTmFtZSwgdHlwZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGlmICghY2FjaGUpIHtcclxuXHRcdFx0XHRcdGNhY2hlID0geyBuYW1lOiBuYW1lIH07XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGluZGV4W25hbWVdID0gY2FjaGU7XHJcblx0XHRcdHJldHVybiBjYWNoZTtcclxuXHRcdH1cclxuXHRcdFN5cy5BcHBsaWNhdGlvbi5fbWFwVG9Qcm90b3R5cGUgPSBmdW5jdGlvbiBTeXMkQXBwbGljYXRpb24kX21hcFRvUHJvdG90eXBlKG5hbWUsIHR5cGUpIHtcclxuXHRcdFx0aWYgKCF0eXBlKSB7XHJcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwidHlwZSBpcyB1bmRlZmluZWQgKG5hbWU9XFxcIlwiICsgbmFtZSArIFwiXFxcIikuXCIpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoIXR5cGUuX190eXBlTmFtZSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIlxcXCJcIiArIHR5cGUgKyBcIlxcXCIgaXMgbm90IGEgdmFsaWQgdHlwZSAobmFtZT1cXFwiXCIgKyBuYW1lICsgXCJcXFwiKS5cIik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciBmaXhlZE5hbWUsIGNhc2VJbmRleCA9IFN5cy5BcHBsaWNhdGlvbi5fY2FzZUluZGV4W3R5cGUuX190eXBlTmFtZV07XHJcblx0XHRcdGlmICghY2FzZUluZGV4KSB7XHJcblx0XHRcdFx0Y2FzZUluZGV4ID0ge307XHJcblx0XHRcdFx0dHlwZS5yZXNvbHZlSW5oZXJpdGFuY2UoKTtcclxuXHRcdFx0XHRmb3IgKHZhciBtZW1iZXJOYW1lIGluIHR5cGUucHJvdG90eXBlKSB7XHJcblx0XHRcdFx0XHRpZiAobWVtYmVyTmFtZS5zdGFydHNXaXRoKFwiZ2V0X1wiKSB8fCBtZW1iZXJOYW1lLnN0YXJ0c1dpdGgoXCJzZXRfXCIpIHx8IG1lbWJlck5hbWUuc3RhcnRzV2l0aChcImFkZF9cIikpIHtcclxuXHRcdFx0XHRcdFx0bWVtYmVyTmFtZSA9IG1lbWJlck5hbWUuc3Vic3RyKDQpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAobWVtYmVyTmFtZS5zdGFydHNXaXRoKFwicmVtb3ZlX1wiKSkge1xyXG5cdFx0XHRcdFx0XHRtZW1iZXJOYW1lID0gbWVtYmVyTmFtZS5zdWJzdHIoNyk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRjYXNlSW5kZXhbbWVtYmVyTmFtZS50b0xvd2VyQ2FzZSgpXSA9IG1lbWJlck5hbWU7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdFN5cy5BcHBsaWNhdGlvbi5fY2FzZUluZGV4W3R5cGUuX190eXBlTmFtZV0gPSBjYXNlSW5kZXg7XHJcblx0XHRcdH1cclxuXHRcdFx0bmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTtcclxuXHRcdFx0aWYgKG5hbWUuc3RhcnRzV2l0aCgnb24nKSkge1xyXG5cdFx0XHRcdGZpeGVkTmFtZSA9IGNhc2VJbmRleFtuYW1lLnN1YnN0cigyKV07XHJcblx0XHRcdFx0aWYgKGZpeGVkTmFtZSkge1xyXG5cdFx0XHRcdFx0Zml4ZWROYW1lID0gXCJvblwiICsgZml4ZWROYW1lO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdGZpeGVkTmFtZSA9IGNhc2VJbmRleFtuYW1lXTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0Zml4ZWROYW1lID0gY2FzZUluZGV4W25hbWVdO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiBmaXhlZE5hbWU7XHJcblx0XHR9XHJcblxyXG5cdFx0U3lzLkFwcGxpY2F0aW9uLl9kb0V2YWwgPSBmdW5jdGlvbiBTeXMkQXBwbGljYXRpb24kX2RvRXZhbChfX2V4cHJlc3Npb24sICRjb250ZXh0KSB7XHJcblx0XHRcdHdpdGggKCRjb250ZXh0LmRhdGFJdGVtIHx8IHt9KSB7XHJcblx0XHRcdFx0cmV0dXJuIGV2YWwoXCIoXCIgKyBfX2V4cHJlc3Npb24gKyBcIilcIik7XHJcblx0XHRcdH1cclxuXHRcdH07XHJcblx0XHRTeXMuQXBwbGljYXRpb24uX2V2YWx1YXRlRXhwcmVzc2lvbiA9IGZ1bmN0aW9uIFN5cyRBcHBsaWNhdGlvbiRfZXZhbHVhdGVFeHByZXNzaW9uKGV4cHJlc3Npb24sICRjb250ZXh0LCAkZWxlbWVudCkge1xyXG5cdFx0XHR2YXIgZm4gPSBuZXcgRnVuY3Rpb24oXCIkcm9vdENvbnRleHRcIiwgXCIkY29udGV4dFwiLCBcIiRlbGVtZW50XCIsIFwiJGRhdGFJdGVtXCIsIFwiJGluZGV4XCIsIFwiJGlkXCIsIFwiJHZtXCIsIFwiJGVtaXRcIiwgXCJyZXR1cm4gXCIgKyBleHByZXNzaW9uICsgXCI7XCIpO1xyXG5cdFx0XHRyZXR1cm4gZm4oJGNvbnRleHQucm9vdENvbnRleHQsICRjb250ZXh0LCAkZWxlbWVudCwgJGNvbnRleHQuZGF0YUl0ZW0sICRjb250ZXh0LmluZGV4LCAkY29udGV4dC5yb290Q29udGV4dC52bSwgJGNvbnRleHQucm9vdENvbnRleHQudm0gPyAkY29udGV4dC5yb290Q29udGV4dC52bS4kZW1pdC5iaW5kKCRjb250ZXh0LnJvb3RDb250ZXh0LnZtKSA6IG51bGwsIGZ1bmN0aW9uIChwcmVmaXgpIHsgcmV0dXJuICRjb250ZXh0LmdldEluc3RhbmNlSWQocHJlZml4KTsgfSk7XHJcblx0XHR9O1xyXG5cclxuXHRcdFN5cy5BcHBsaWNhdGlvbi5fcmVnaXN0ZXJDb21wb25lbnQgPSBmdW5jdGlvbiBTeXMkQXBwbGljYXRpb24kX3JlZ2lzdGVyQ29tcG9uZW50KGVsZW1lbnQsIGNvbXBvbmVudCkge1xyXG5cdFx0XHR2YXIgY29tcG9uZW50cyA9IGVsZW1lbnQuX2NvbXBvbmVudHM7XHJcblx0XHRcdGlmICghY29tcG9uZW50cykge1xyXG5cdFx0XHRcdGVsZW1lbnQuX2NvbXBvbmVudHMgPSBjb21wb25lbnRzID0gW107XHJcblx0XHRcdH1cclxuXHRcdFx0Y29tcG9uZW50c1tjb21wb25lbnRzLmxlbmd0aF0gPSBjb21wb25lbnQ7XHJcblx0XHR9XHJcblxyXG5cdFx0U3lzLkFwcGxpY2F0aW9uLl9hY3RpdmF0ZU9uUGFydGlhbCA9IGZ1bmN0aW9uIFN5cyRBcHBsaWNhdGlvbiRfYWN0aXZhdGVPblBhcnRpYWwocGFuZWwsIHJlbmRlcmluZykge1xyXG5cdFx0XHR0aGlzLl9kb1VwZGF0ZVBhbmVsKHBhbmVsLCByZW5kZXJpbmcpO1xyXG5cdFx0XHRpZiAoU3lzLmFjdGl2YXRlRG9tKSB7XHJcblx0XHRcdFx0U3lzLkFwcGxpY2F0aW9uLmFjdGl2YXRlRWxlbWVudChwYW5lbCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRTeXMuQXBwbGljYXRpb24uX3JhaXNlSW5pdCA9IGZ1bmN0aW9uIFN5cyRBcHBsaWNhdGlvbiRfcmFpc2VJbml0KCkge1xyXG5cdFx0XHR0aGlzLmJlZ2luQ3JlYXRlQ29tcG9uZW50cygpO1xyXG5cdFx0XHRTeXMuT2JzZXJ2ZXIucmFpc2VFdmVudCh0aGlzLCBcImluaXRcIik7XHJcblx0XHRcdGlmIChTeXMuYWN0aXZhdGVEb20pIHtcclxuXHRcdFx0XHRTeXMuQXBwbGljYXRpb24uYWN0aXZhdGVFbGVtZW50KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCk7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKFN5cy5XZWJGb3JtcyAmJiBTeXMuV2ViRm9ybXMuUGFnZVJlcXVlc3RNYW5hZ2VyKSB7XHJcblx0XHRcdFx0dmFyIHBybSA9IFN5cy5XZWJGb3Jtcy5QYWdlUmVxdWVzdE1hbmFnZXIuZ2V0SW5zdGFuY2UoKTtcclxuXHRcdFx0XHRwcm0uX2RvVXBkYXRlUGFuZWwgPSBwcm0uX3VwZGF0ZVBhbmVsO1xyXG5cdFx0XHRcdHBybS5fdXBkYXRlUGFuZWwgPSBTeXMuQXBwbGljYXRpb24uX2FjdGl2YXRlT25QYXJ0aWFsO1xyXG5cdFx0XHR9XHJcblx0XHRcdHRoaXMuZW5kQ3JlYXRlQ29tcG9uZW50cygpO1xyXG5cdFx0fVxyXG5cdFx0U3lzLkJpbmRpbmdNb2RlID0gZnVuY3Rpb24gU3lzJEJpbmRpbmdNb2RlKCkge1xyXG5cdFx0fVxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cdFx0U3lzLkJpbmRpbmdNb2RlLnByb3RvdHlwZSA9IHtcclxuXHRcdFx0YXV0bzogMCxcclxuXHRcdFx0b25lVGltZTogMSxcclxuXHRcdFx0b25lV2F5OiAyLFxyXG5cdFx0XHR0d29XYXk6IDMsXHJcblx0XHRcdG9uZVdheVRvU291cmNlOiA0XHJcblx0XHR9XHJcblx0XHRTeXMuQmluZGluZ01vZGUucmVnaXN0ZXJFbnVtKFwiU3lzLkJpbmRpbmdNb2RlXCIpO1xyXG5cdFx0U3lzLkJpbmRpbmcgPSBmdW5jdGlvbiBTeXMkQmluZGluZygpIHtcclxuXHRcdFx0U3lzLkJpbmRpbmcuaW5pdGlhbGl6ZUJhc2UodGhpcyk7XHJcblx0XHRcdHRoaXMuX3NvdXJjZUhhbmRsZXJzID0gW107XHJcblx0XHRcdHRoaXMuX3RhcmdldEhhbmRsZXJzID0gW107XHJcblx0XHRcdHRoaXMuX29uU291cmNlQ2hhbmdlZCA9IEZ1bmN0aW9uLmNyZWF0ZURlbGVnYXRlKHRoaXMsIHRoaXMuX3NvdXJjZUNoYW5nZWQpO1xyXG5cdFx0XHR0aGlzLl9vblRhcmdldENoYW5nZWQgPSBGdW5jdGlvbi5jcmVhdGVEZWxlZ2F0ZSh0aGlzLCB0aGlzLl90YXJnZXRDaGFuZ2VkKTtcclxuXHRcdFx0dGhpcy5fb25PcHRpb25zVXBkYXRlZCA9IEZ1bmN0aW9uLmNyZWF0ZURlbGVnYXRlKHRoaXMsIHRoaXMuX29wdGlvbnNVcGRhdGVkKTtcclxuXHRcdFx0dGhpcy5fb25EaXNwb3NlID0gRnVuY3Rpb24uY3JlYXRlRGVsZWdhdGUodGhpcywgdGhpcy5kaXNwb3NlKTtcclxuXHRcdH1cclxuXHJcblxyXG5cdFx0ZnVuY3Rpb24gU3lzJEJpbmRpbmckZ2V0X2NvbnZlcnQoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgbWF5QmVOdWxsPVwidHJ1ZVwiIGxvY2lkPVwiUDpKI1N5cy5CaW5kaW5nLmNvbnZlcnRcIj48L3ZhbHVlPlxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fY29udmVydCB8fCBudWxsO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJEJpbmRpbmckc2V0X2NvbnZlcnQodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fY29udmVydCA9IHZhbHVlO1xyXG5cdFx0XHR0aGlzLl9jb252ZXJ0Rm4gPSB0aGlzLl9yZXNvbHZlRnVuY3Rpb24odmFsdWUpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJEJpbmRpbmckZ2V0X2NvbnZlcnRCYWNrKCkge1xyXG5cdFx0XHQvLy8gPHZhbHVlIG1heUJlTnVsbD1cInRydWVcIiBsb2NpZD1cIlA6SiNTeXMuQmluZGluZy5jb252ZXJ0QmFja1wiPjwvdmFsdWU+XHJcblx0XHRcdHJldHVybiB0aGlzLl9jb252ZXJ0QmFjayB8fCBudWxsO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJEJpbmRpbmckc2V0X2NvbnZlcnRCYWNrKHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX2NvbnZlcnRCYWNrID0gdmFsdWU7XHJcblx0XHRcdHRoaXMuX2NvbnZlcnRCYWNrRm4gPSB0aGlzLl9yZXNvbHZlRnVuY3Rpb24odmFsdWUpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJEJpbmRpbmckZ2V0X2lnbm9yZUVycm9ycygpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiQm9vbGVhblwiIG1heUJlTnVsbD1cImZhbHNlXCIgbG9jaWQ9XCJQOkojU3lzLkJpbmRpbmcuaWdub3JlRXJyb3JzXCI+PC92YWx1ZT5cclxuXHRcdFx0cmV0dXJuICEhdGhpcy5faWdub3JlRXJyb3JzO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJEJpbmRpbmckc2V0X2lnbm9yZUVycm9ycyh2YWx1ZSkge1xyXG5cdFx0XHR0aGlzLl9pZ25vcmVFcnJvcnMgPSB2YWx1ZTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRCaW5kaW5nJGdldF9tb2RlKCkge1xyXG5cdFx0XHQvLy8gPHZhbHVlIHR5cGU9XCJTeXMuQmluZGluZ01vZGVcIiBtYXlCZU51bGw9XCJmYWxzZVwiIGxvY2lkPVwiUDpKI1N5cy5CaW5kaW5nLm1vZGVcIj48L3ZhbHVlPlxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fbW9kZSB8fCBTeXMuQmluZGluZ01vZGUuYXV0bztcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRCaW5kaW5nJHNldF9tb2RlKHZhbHVlKSB7XHJcblx0XHRcdGlmICh0aGlzLl9pbml0aWFsaXplZCkge1xyXG5cdFx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuVUkuVGVtcGxhdGVzUmVzLmNvbW1vbk5vdEFmdGVySW5pdCwgXCJCaW5kaW5nXCIsIFwibW9kZVwiKSk7XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5fbW9kZSA9IHZhbHVlO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJEJpbmRpbmckZ2V0X2RlZmF1bHRWYWx1ZSgpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSBtYXlCZU51bGw9XCJ0cnVlXCIgbG9jaWQ9XCJQOkojU3lzLkJpbmRpbmcuZGVmYXVsdFZhbHVlXCI+PC92YWx1ZT5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX2RlZmF1bHRWYWx1ZTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRCaW5kaW5nJHNldF9kZWZhdWx0VmFsdWUodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fZGVmYXVsdFZhbHVlID0gdmFsdWU7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkQmluZGluZyRnZXRfc291cmNlKCkge1xyXG5cdFx0XHQvLy8gPHZhbHVlIG1heUJlTnVsbD1cInRydWVcIiBsb2NpZD1cIlA6SiNTeXMuQmluZGluZy5zb3VyY2VcIj48L3ZhbHVlPlxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fc291cmNlIHx8IG51bGw7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkQmluZGluZyRzZXRfc291cmNlKHZhbHVlKSB7XHJcblx0XHRcdGlmICh0aGlzLl9pbml0aWFsaXplZCkge1xyXG5cdFx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuVUkuVGVtcGxhdGVzUmVzLmNvbW1vbk5vdEFmdGVySW5pdCwgXCJCaW5kaW5nXCIsIFwic291cmNlXCIpKTtcclxuXHRcdFx0fVxyXG5cdFx0XHR0aGlzLl9zb3VyY2UgPSB2YWx1ZTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRCaW5kaW5nJGdldF90ZW1wbGF0ZUNvbnRleHQoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgbWF5QmVOdWxsPVwidHJ1ZVwiIHR5cGU9XCJTeXMuVUkuVGVtcGxhdGVDb250ZXh0XCIgbG9jaWQ9XCJQOkojU3lzLkJpbmRpbmcudGVtcGxhdGVDb250ZXh0XCI+PC92YWx1ZT5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX3RlbXBsYXRlQ29udGV4dCB8fCBudWxsO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJEJpbmRpbmckc2V0X3RlbXBsYXRlQ29udGV4dCh2YWx1ZSkge1xyXG5cdFx0XHR0aGlzLl90ZW1wbGF0ZUNvbnRleHQgPSB2YWx1ZTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRCaW5kaW5nJGdldF9wYXRoKCkge1xyXG5cdFx0XHQvLy8gPHZhbHVlIHR5cGU9XCJTdHJpbmdcIiBtYXlCZU51bGw9XCJ0cnVlXCIgbG9jaWQ9XCJQOkojU3lzLkJpbmRpbmcucGF0aFwiPjwvdmFsdWU+XHJcblx0XHRcdHJldHVybiB0aGlzLl9wYXRoIHx8IFwiXCI7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkQmluZGluZyRzZXRfcGF0aCh2YWx1ZSkge1xyXG5cdFx0XHRpZiAodGhpcy5faW5pdGlhbGl6ZWQpIHtcclxuXHRcdFx0XHR0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN0cmluZy5mb3JtYXQoU3lzLlVJLlRlbXBsYXRlc1Jlcy5jb21tb25Ob3RBZnRlckluaXQsIFwiQmluZGluZ1wiLCBcInBhdGhcIikpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHRoaXMuX3BhdGggPSB2YWx1ZTtcclxuXHRcdFx0dGhpcy5fcGF0aEFycmF5ID0gdmFsdWUgPyB2YWx1ZS5zcGxpdCgnLicpIDogbnVsbDtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRCaW5kaW5nJGdldF90YXJnZXQoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgbWF5QmVOdWxsPVwidHJ1ZVwiIGxvY2lkPVwiUDpKI1N5cy5CaW5kaW5nLnRhcmdldFwiPjwvdmFsdWU+XHJcblx0XHRcdHJldHVybiB0aGlzLl90YXJnZXQgfHwgbnVsbDtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRCaW5kaW5nJHNldF90YXJnZXQodmFsdWUpIHtcclxuXHRcdFx0aWYgKHRoaXMuX2luaXRpYWxpemVkKSB7XHJcblx0XHRcdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTdHJpbmcuZm9ybWF0KFN5cy5VSS5UZW1wbGF0ZXNSZXMuY29tbW9uTm90QWZ0ZXJJbml0LCBcIkJpbmRpbmdcIiwgXCJ0YXJnZXRcIikpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHRoaXMuX3RhcmdldCA9IHZhbHVlO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJEJpbmRpbmckZ2V0X3RhcmdldFByb3BlcnR5KCkge1xyXG5cdFx0XHQvLy8gPHZhbHVlIHR5cGU9XCJTdHJpbmdcIiBtYXlCZU51bGw9XCJ0cnVlXCIgbG9jaWQ9XCJQOkojU3lzLkJpbmRpbmcudGFyZ2V0UHJvcGVydHlcIj48L3ZhbHVlPlxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fdGFyZ2V0UHJvcGVydHkgfHwgXCJcIjtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRCaW5kaW5nJHNldF90YXJnZXRQcm9wZXJ0eSh2YWx1ZSkge1xyXG5cdFx0XHRpZiAodGhpcy5faW5pdGlhbGl6ZWQpIHtcclxuXHRcdFx0XHR0aHJvdyBFcnJvci5pbnZhbGlkT3BlcmF0aW9uKFN0cmluZy5mb3JtYXQoU3lzLlVJLlRlbXBsYXRlc1Jlcy5jb21tb25Ob3RBZnRlckluaXQsIFwiQmluZGluZ1wiLCBcInRhcmdldFByb3BlcnR5XCIpKTtcclxuXHRcdFx0fVxyXG5cdFx0XHR0aGlzLl90YXJnZXRQcm9wZXJ0eSA9IHZhbHVlO1xyXG5cdFx0XHR0aGlzLl90YXJnZXRQcm9wZXJ0eUFycmF5ID0gdmFsdWUgPyB2YWx1ZS5zcGxpdCgnLicpIDogbnVsbDtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRCaW5kaW5nJF9hZGRCaW5kaW5nKGVsZW1lbnQpIHtcclxuXHRcdFx0aWYgKGVsZW1lbnQubm9kZVR5cGUgPT09IDMpIHtcclxuXHRcdFx0XHRlbGVtZW50ID0gZWxlbWVudC5wYXJlbnROb2RlO1xyXG5cdFx0XHRcdGlmICghZWxlbWVudCkgcmV0dXJuO1xyXG5cdFx0XHR9XHJcblx0XHRcdHZhciBiaW5kaW5ncyA9IGVsZW1lbnQuX19tc2FqYXhiaW5kaW5ncyA9IGVsZW1lbnQuX19tc2FqYXhiaW5kaW5ncyB8fCBbXTtcclxuXHRcdFx0YmluZGluZ3MucHVzaCh0aGlzKTtcclxuXHRcdFx0U3lzLlVJLkRvbUVsZW1lbnQuX29uRGlzcG9zZShlbGVtZW50LCBTeXMuQmluZGluZy5fZGlzcG9zZUJpbmRpbmdzKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRCaW5kaW5nJGRpc3Bvc2UoKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuQmluZGluZy5kaXNwb3NlXCIgLz5cclxuXHRcdFx0aWYgKCF0aGlzLl9kaXNwb3NlZCkge1xyXG5cdFx0XHRcdHRoaXMuX2Rpc3Bvc2VkID0gdHJ1ZTtcclxuXHRcdFx0XHR0aGlzLl93YXRjaE9iamVjdChudWxsKTtcclxuXHRcdFx0XHR0aGlzLl93YXRjaE9iamVjdChudWxsLCB0cnVlKTtcclxuXHRcdFx0XHR0aGlzLl90YXJnZXRIYW5kbGVycyA9IG51bGw7XHJcblx0XHRcdFx0dGhpcy5fc291cmNlSGFuZGxlcnMgPSBudWxsO1xyXG5cdFx0XHRcdHZhciBzb3VyY2UgPSB0aGlzLl9zb3VyY2UsXHJcblx0XHRcdFx0dGFyZ2V0ID0gdGhpcy5fdGFyZ2V0O1xyXG5cdFx0XHRcdGlmIChzb3VyY2UpIHtcclxuXHRcdFx0XHRcdGlmICh0aGlzLl9zb3VyY2VPcHRpb24pIFN5cy5PYnNlcnZlci5yZW1vdmVFdmVudEhhbmRsZXIoc291cmNlLCBcIm9wdGlvbnNDaGFuZ2VkXCIsIHRoaXMuX29uT3B0aW9uc1VwZGF0ZWQpO1xyXG5cdFx0XHRcdFx0aWYgKFN5cy5JTm90aWZ5RGlzcG9zaW5nLmlzSW1wbGVtZW50ZWRCeShzb3VyY2UpKSBzb3VyY2UucmVtb3ZlX2Rpc3Bvc2luZyh0aGlzLl9vbkRpc3Bvc2UpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAodGFyZ2V0KSB7XHJcblx0XHRcdFx0XHRpZiAodGhpcy5fdGFyZ2V0T3B0aW9uKSBTeXMuT2JzZXJ2ZXIucmVtb3ZlRXZlbnRIYW5kbGVyKHRhcmdldCwgXCJvcHRpb25zQ2hhbmdlZFwiLCB0aGlzLl9vbk9wdGlvbnNVcGRhdGVkKTtcclxuXHRcdFx0XHRcdGlmIChTeXMuSU5vdGlmeURpc3Bvc2luZy5pc0ltcGxlbWVudGVkQnkodGFyZ2V0KSkgdGFyZ2V0LnJlbW92ZV9kaXNwb3NpbmcodGhpcy5fb25EaXNwb3NlKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0dGhpcy5fY29udmVydCA9IHRoaXMuX2NvbnZlcnRCYWNrID0gdGhpcy5fY29udmVydEZuID0gdGhpcy5fY29udmVydEJhY2tGbiA9IHRoaXMuX2xhc3RTb3VyY2UgPSB0aGlzLl9sYXN0VGFyZ2V0ID1cclxuXHRcdFx0XHRcdHRoaXMuX3NvdXJjZSA9IHRoaXMuX3RhcmdldCA9IHRoaXMuX3BhdGggPSB0aGlzLl9wYXRoQXJyYXkgPSB0aGlzLl9kZWZhdWx0VmFsdWUgPSB0aGlzLl90YXJnZXRQcm9wZXJ0eSA9XHJcblx0XHRcdFx0XHR0aGlzLl90YXJnZXRQcm9wZXJ0eUFycmF5ID0gdGhpcy5fdGVtcGxhdGVDb250ZXh0ID0gdGhpcy5fdXBkYXRlU291cmNlID0gdGhpcy5fc291cmNlT3B0aW9uID0gdGhpcy5fdXBkYXRlVGFyZ2V0ID1cclxuXHRcdFx0XHRcdHRoaXMuX3RhcmdldE9wdGlvbiA9IHRoaXMuX21vZGUgPSB0aGlzLl9vbk9wdGlvbnNVcGRhdGVkID0gdGhpcy5fb25UYXJnZXRDaGFuZ2VkID0gdGhpcy5fb25Tb3VyY2VDaGFuZ2VkID1cclxuXHRcdFx0XHRcdHRoaXMuX29uRGlzcG9zZSA9IG51bGw7XHJcblx0XHRcdH1cclxuXHRcdFx0U3lzLkJpbmRpbmcuY2FsbEJhc2VNZXRob2QodGhpcywgJ2Rpc3Bvc2UnKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRCaW5kaW5nJF9nZXRQcm9wZXJ0eUZyb21JbmRleChvYmosIHBhdGgsIHN0YXJ0SW5kZXgsIGVuZEluZGV4KSB7XHJcblx0XHRcdGZvciAodmFyIGkgPSBzdGFydEluZGV4OyBpIDw9IGVuZEluZGV4OyBpKyspIHtcclxuXHRcdFx0XHRpZiAob2JqID09PSBudWxsIHx8IHR5cGVvZiAob2JqKSA9PT0gXCJ1bmRlZmluZWRcIikge1xyXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdG9iaiA9IHRoaXMuX2dldFByb3BlcnR5RGF0YShvYmosIHBhdGhbaV0pO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiBvYmo7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkQmluZGluZyRfZ2V0UHJvcGVydHlEYXRhKG9iaiwgbmFtZSkge1xyXG5cdFx0XHRpZiAodHlwZW9mIChvYmpbXCJnZXRfXCIgKyBuYW1lXSkgPT09IFwiZnVuY3Rpb25cIikge1xyXG5cdFx0XHRcdHJldHVybiBvYmpbXCJnZXRfXCIgKyBuYW1lXSgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHJldHVybiBvYmpbbmFtZV07XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRCaW5kaW5nJF93YXRjaE9iamVjdChvYmplY3QsIGlzU291cmNlKSB7XHJcblx0XHRcdHZhciBwYXRoID0gaXNTb3VyY2UgPyB0aGlzLl9wYXRoQXJyYXkgOiB0aGlzLl90YXJnZXRQcm9wZXJ0eUFycmF5LFxyXG5cdFx0XHRoYW5kbGVycyA9IGlzU291cmNlID8gdGhpcy5fc291cmNlSGFuZGxlcnMgOiB0aGlzLl90YXJnZXRIYW5kbGVycyxcclxuXHRcdFx0b2JzZXJ2YWJsZSA9ICEhb2JqZWN0O1xyXG5cdFx0XHRpZiAocGF0aCkge1xyXG5cdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdFx0dmFyIHByb3BlcnR5ID0gcGF0aFtpXSxcclxuXHRcdFx0XHRcdGhhbmRsZXIgPSBoYW5kbGVyc1tpXTtcclxuXHRcdFx0XHRcdGlmICghaGFuZGxlciB8fCBoYW5kbGVyLm9iamVjdCAhPT0gb2JqZWN0KSB7XHJcblx0XHRcdFx0XHRcdGlmIChoYW5kbGVyKSB7XHJcblx0XHRcdFx0XHRcdFx0dGhpcy5fZm9yZ2V0KGhhbmRsZXIpO1xyXG5cdFx0XHRcdFx0XHRcdGhhbmRsZXJzW2ldID0gbnVsbDtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRpZiAob2JzZXJ2YWJsZSkge1xyXG5cdFx0XHRcdFx0XHRcdGhhbmRsZXJzW2ldID0gdGhpcy5fbGlzdGVuKG9iamVjdCwgcHJvcGVydHksIGlzU291cmNlKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0Ly8gaWYgdGhlIGxlYWYgb2YgdGhlIHBhdGggaXMgYSB2dWUgcmVmLCBsaXN0ZW4gdG8gdGhlIHZhbHVlIGFzIHdlbGxcclxuXHRcdFx0XHRcdFx0XHRpZiAoaSA9PT0gcGF0aC5sZW5ndGggLSAxICYmIF9pc1Z1ZVJlZihvYmplY3RbcHJvcGVydHldKSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0cGF0aC5wdXNoKCd2YWx1ZScpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0aWYgKG9ic2VydmFibGUpIHtcclxuXHRcdFx0XHRcdFx0b2JqZWN0ID0gdGhpcy5fZ2V0UHJvcGVydHlEYXRhKG9iamVjdCwgcHJvcGVydHkpO1xyXG5cdFx0XHRcdFx0XHRvYnNlcnZhYmxlID0gKG9iamVjdCAmJiAodHlwZW9mIChvYmplY3QpID09PSBcIm9iamVjdFwiIHx8IChvYmplY3QgaW5zdGFuY2VvZiBBcnJheSkgfHwgU3lzLl9pc0RvbUVsZW1lbnQob2JqZWN0KSkgfHwgX2lzVnVlVHlwZShvYmplY3QpKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRvYmplY3QgPSBudWxsO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gY2xlYW4gdXAgb3JwaGFuZWQgbGVhZiBoYW5kbGVyc1xyXG5cdFx0XHRcdGZvciAodmFyIGkgPSBwYXRoLmxlbmd0aDsgaSA8IGhhbmRsZXJzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0XHRpZiAoaGFuZGxlcnNbaV0pIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5fZm9yZ2V0KGhhbmRsZXJzW2ldKTtcclxuXHRcdFx0XHRcdFx0aGFuZGxlcnNbaV0gPSBudWxsO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJEJpbmRpbmckX2lzSW5wdXQoZWxlbWVudCwgcHJvcGVydHkpIHtcclxuXHRcdFx0dmFyIHJldCxcclxuXHRcdFx0dGFnID0gKFN5cy5VSS5Eb21FbGVtZW50LmlzRG9tRWxlbWVudChlbGVtZW50KSAmJiBlbGVtZW50Lm5vZGVUeXBlID09PSAxICYmIGVsZW1lbnQudGFnTmFtZSkgP1xyXG5cdFx0XHRcdGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpIDogXCJcIjtcclxuXHRcdFx0aWYgKHRhZyA9PT0gXCJzZWxlY3RcIiB8fCB0YWcgPT09IFwiaW5wdXRcIiB8fCB0YWcgPT09IFwidGV4dGFyZWFcIikge1xyXG5cdFx0XHRcdHByb3BlcnR5ID0gKHByb3BlcnR5IHx8IFwiXCIpLnRvTG93ZXJDYXNlKCk7XHJcblx0XHRcdFx0aWYgKHByb3BlcnR5ID09PSBcInZhbHVlXCIgfHwgcHJvcGVydHkgPT09IFwic2VsZWN0ZWRpbmRleFwiIHx8IHByb3BlcnR5ID09PSBcImNoZWNrZWRcIikge1xyXG5cdFx0XHRcdFx0aWYgKHRhZyAhPT0gXCJpbnB1dFwiIHx8ICh0YWcgPT09IFwiaW5wdXRcIiAmJiAhL2J1dHRvbnxpbWFnZXxoaWRkZW58c3VibWl0fHJlc2V0L2kudGVzdChlbGVtZW50LnR5cGUpKSkge1xyXG5cdFx0XHRcdFx0XHRyZXQgPSB0YWc7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiByZXQ7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBfaXNWdWVSZWYodmFsdWUpIHtcclxuXHRcdFx0cmV0dXJuIHdpbmRvdy5WdWUgJiYgVnVlLmlzUmVmKHZhbHVlKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIF9pc1Z1ZVJlYWN0aXZlKHZhbHVlKSB7XHJcblx0XHRcdHJldHVybiB3aW5kb3cuVnVlICYmIFZ1ZS5pc1JlYWN0aXZlKHZhbHVlKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIF9pc1Z1ZVR5cGUodmFsdWUpIHtcclxuXHRcdFx0cmV0dXJuIF9pc1Z1ZVJlZih2YWx1ZSkgfHwgX2lzVnVlUmVhY3RpdmUodmFsdWUpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJEJpbmRpbmckX2xpc3RlbihvYmplY3QsIHByb3BlcnR5LCBpc1NvdXJjZSkge1xyXG5cdFx0XHR2YXIgX3RoaXMgPSB0aGlzLFxyXG5cdFx0XHRsaXN0ZW5lciA9IGlzU291cmNlID8gdGhpcy5fb25Tb3VyY2VDaGFuZ2VkIDogdGhpcy5fb25UYXJnZXRDaGFuZ2VkLFxyXG5cdFx0XHRoYW5kbGVycyA9IHtcclxuXHRcdFx0XHRsaXN0ZW5lcjogbGlzdGVuZXIsXHJcblx0XHRcdFx0b2JqZWN0OiBvYmplY3QsXHJcblx0XHRcdFx0cGM6IGZ1bmN0aW9uIChzZW5kZXIsIGFyZ3MpIHtcclxuXHRcdFx0XHRcdHZhciBjaGFuZ2VkID0gYXJncy5nZXRfcHJvcGVydHlOYW1lKCk7XHJcblx0XHRcdFx0XHRpZiAoIWNoYW5nZWQgfHwgY2hhbmdlZCA9PT0gcHJvcGVydHkpIHtcclxuXHRcdFx0XHRcdFx0bGlzdGVuZXIoKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGRvbTogW11cclxuXHRcdFx0fTtcclxuXHRcdFx0U3lzLk9ic2VydmVyLl9hZGRFdmVudEhhbmRsZXIob2JqZWN0LCBcInByb3BlcnR5Q2hhbmdlZFwiLCBoYW5kbGVycy5wYyk7XHJcblx0XHRcdHZhciBpc0lucHV0ID0gdGhpcy5faXNJbnB1dChvYmplY3QsIHByb3BlcnR5KSxcclxuXHRcdFx0XHRhZGRlciA9IFN5cy5VSS5Eb21FdmVudC5hZGRIYW5kbGVyO1xyXG5cdFx0XHRpZiAoX2lzVnVlVHlwZShvYmplY3QpIHx8IF9pc1Z1ZVR5cGUob2JqZWN0W3Byb3BlcnR5XSkpIHtcclxuXHRcdFx0XHR2YXIgbyA9IG9iamVjdDtcclxuXHRcdFx0XHR2YXIgZGVwcyA9IFtmdW5jdGlvbiAoKSB7IHJldHVybiBvW3Byb3BlcnR5XTsgfV07XHJcblx0XHRcdFx0dmFyIGlzTGlzdCA9IGZhbHNlO1xyXG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KG9iamVjdFtwcm9wZXJ0eV0pKSB7XHJcblx0XHRcdFx0XHRpc0xpc3QgPSB0cnVlO1xyXG5cdFx0XHRcdFx0ZGVwcy5wdXNoKGZ1bmN0aW9uICgpIHsgcmV0dXJuIG9bcHJvcGVydHldLmxlbmd0aDsgfSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGhhbmRsZXJzLmRpc3Bvc2UgPSBWdWUud2F0Y2goZGVwcywgZnVuY3Rpb24gKG5ld1ZhbHMpIHtcclxuXHRcdFx0XHRcdGxpc3RlbmVyKCk7XHJcblx0XHRcdFx0XHRpZiAoaXNMaXN0KVxyXG5cdFx0XHRcdFx0XHRTeXMuT2JzZXJ2ZXIucmFpc2VDb2xsZWN0aW9uQ2hhbmdlZChuZXdWYWxzWzBdKTtcclxuXHRcdFx0XHR9LmJpbmQodGhpcykpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChpc0lucHV0KSB7XHJcblx0XHRcdFx0aGFuZGxlcnMuZG9tLnB1c2goXCJjaGFuZ2VcIik7XHJcblx0XHRcdFx0YWRkZXIob2JqZWN0LCBcImNoYW5nZVwiLCBsaXN0ZW5lcik7XHJcblx0XHRcdFx0aWYgKGlzSW5wdXQgIT09IFwidGV4dGFyZWFcIikge1xyXG5cdFx0XHRcdFx0aGFuZGxlcnMuZG9tLnB1c2goXCJjbGlja1wiKTtcclxuXHRcdFx0XHRcdGFkZGVyKG9iamVjdCwgXCJjbGlja1wiLCBsaXN0ZW5lcik7XHJcblx0XHRcdFx0XHRpZiAoaXNJbnB1dCA9PT0gXCJzZWxlY3RcIikge1xyXG5cdFx0XHRcdFx0XHRoYW5kbGVycy5kb20ucHVzaChcImtleXVwXCIpO1xyXG5cdFx0XHRcdFx0XHRhZGRlcihvYmplY3QsIFwia2V5dXBcIiwgbGlzdGVuZXIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRvYmplY3QgPSBudWxsO1xyXG5cdFx0XHRyZXR1cm4gaGFuZGxlcnM7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkQmluZGluZyRfZm9yZ2V0KGhhbmRsZXIpIHtcclxuXHRcdFx0dmFyIG9iamVjdCA9IGhhbmRsZXIub2JqZWN0LFxyXG5cdFx0XHRkb20gPSBoYW5kbGVyLmRvbTtcclxuXHRcdFx0aWYgKGhhbmRsZXIucGMpXHJcblx0XHRcdFx0U3lzLk9ic2VydmVyLl9yZW1vdmVFdmVudEhhbmRsZXIob2JqZWN0LCBcInByb3BlcnR5Q2hhbmdlZFwiLCBoYW5kbGVyLnBjKTtcclxuXHRcdFx0Zm9yICh2YXIgaSA9IDAsIGwgPSBkb20ubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XHJcblx0XHRcdFx0U3lzLlVJLkRvbUV2ZW50LnJlbW92ZUhhbmRsZXIob2JqZWN0LCBkb21baV0sIGhhbmRsZXIubGlzdGVuZXIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChoYW5kbGVyLmRpc3Bvc2UpXHJcblx0XHRcdFx0aGFuZGxlci5kaXNwb3NlKCk7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkQmluZGluZyRfcmVzb2x2ZUZ1bmN0aW9uKHZhbHVlKSB7XHJcblx0XHRcdHZhciBlLCByZXQ7XHJcblx0XHRcdGlmICh0eXBlb2YgKHZhbHVlKSA9PT0gJ2Z1bmN0aW9uJykge1xyXG5cdFx0XHRcdHJldCA9IHZhbHVlO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdGlmICh0eXBlb2YgKHZhbHVlKSAhPT0gXCJzdHJpbmdcIikge1xyXG5cdFx0XHRcdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTdHJpbmcuZm9ybWF0KFN5cy5VSS5UZW1wbGF0ZXNSZXMuaW52YWxpZEZ1bmN0aW9uTmFtZSwgdmFsdWUpKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0cmV0ID0gU3lzLmNvbnZlcnRlcnNbdmFsdWVdO1xyXG5cdFx0XHRcdGlmICghcmV0KSB7XHJcblx0XHRcdFx0XHR0cnkge1xyXG5cdFx0XHRcdFx0XHRyZXQgPSBUeXBlLnBhcnNlKHZhbHVlKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGNhdGNoIChlKSB7XHJcblx0XHRcdFx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuVUkuVGVtcGxhdGVzUmVzLmZ1bmN0aW9uTm90Rm91bmQsIHZhbHVlKSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiByZXQ7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkQmluZGluZyRsaW5rKCkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLkJpbmRpbmcubGlua1wiIC8+XHJcblx0XHRcdGlmICh0aGlzLmdldF9tb2RlKCkgPT09IFN5cy5CaW5kaW5nTW9kZS5vbmVXYXlUb1NvdXJjZSkge1xyXG5cdFx0XHRcdHRoaXMuX3RhcmdldENoYW5nZWQoZmFsc2UpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMuX3NvdXJjZUNoYW5nZWQoZmFsc2UpO1xyXG5cdFx0XHR9XHJcblx0XHRcdFN5cy5CaW5kaW5nLmNhbGxCYXNlTWV0aG9kKHRoaXMsICdsaW5rJyk7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkQmluZGluZyR1cGRhdGUobW9kZSkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLkJpbmRpbmcudXBkYXRlXCIgLz5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwibW9kZVwiIG9wdGlvbmFsPVwidHJ1ZVwiIG1heUJlTnVsbD1cInRydWVcIj48L3BhcmFtPlxyXG5cdFx0XHRpZiAoIXRoaXMuX2luaXRpYWxpemVkKSB7XHJcblx0XHRcdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTeXMuVUkuVGVtcGxhdGVzUmVzLnVwZGF0ZUJlZm9yZUluaXQpO1xyXG5cdFx0XHR9XHJcblx0XHRcdG1vZGUgPSBtb2RlIHx8IHRoaXMuZ2V0X21vZGUoKTtcclxuXHRcdFx0aWYgKG1vZGUgPT09IFN5cy5CaW5kaW5nTW9kZS5vbmVXYXlUb1NvdXJjZSkge1xyXG5cdFx0XHRcdHRoaXMuX3RhcmdldENoYW5nZWQodHJ1ZSk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5fc291cmNlQ2hhbmdlZCh0cnVlKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJEJpbmRpbmckX25vdFNldChuYW1lKSB7XHJcblx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuVUkuVGVtcGxhdGVzUmVzLmJpbmRpbmdQcm9wZXJ0eU5vdFNldCwgbmFtZSkpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIFN5cyRCaW5kaW5nJGluaXRpYWxpemUoKSB7XHJcblx0XHRcdGlmICghdGhpcy5nZXRfaXNJbml0aWFsaXplZCgpKSB7XHJcblx0XHRcdFx0aWYgKCF0aGlzLmdldF90YXJnZXRQcm9wZXJ0eSgpKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9ub3RTZXQoXCJ0YXJnZXRQcm9wZXJ0eVwiKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0dmFyIHRjID0gdGhpcy5nZXRfdGVtcGxhdGVDb250ZXh0KCk7XHJcblx0XHRcdFx0aWYgKCF0Yykge1xyXG5cdFx0XHRcdFx0dGhpcy5fZG9Jbml0aWFsaXplKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0dGMuX2NvbXBsZXRlZC5wdXNoKEZ1bmN0aW9uLmNyZWF0ZURlbGVnYXRlKHRoaXMsIHRoaXMuX2RvSW5pdGlhbGl6ZSkpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJEJpbmRpbmckX2RvSW5pdGlhbGl6ZSgpIHtcclxuXHRcdFx0dmFyIHNvdXJjZSA9IHRoaXMuZ2V0X3NvdXJjZSgpLFxyXG5cdFx0XHRcdHRhcmdldCA9IHRoaXMuZ2V0X3RhcmdldCgpO1xyXG5cdFx0XHRpZiAodHlwZW9mIChzb3VyY2UpID09PSBcInN0cmluZ1wiKSB7XHJcblx0XHRcdFx0dGhpcy5zZXRfc291cmNlKHNvdXJjZSA9IHRoaXMuX3Jlc29sdmVSZWZlcmVuY2Uoc291cmNlKSB8fCBudWxsKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodHlwZW9mICh0YXJnZXQpID09PSBcInN0cmluZ1wiKSB7XHJcblx0XHRcdFx0dGhpcy5zZXRfdGFyZ2V0KHRhcmdldCA9IHRoaXMuX3Jlc29sdmVSZWZlcmVuY2UodGFyZ2V0KSB8fCBudWxsKTtcclxuXHRcdFx0fVxyXG5cdFx0XHR2YXIgbW9kZSA9IHRoaXMuZ2V0X21vZGUoKTtcclxuXHRcdFx0aWYgKHRhcmdldCAmJiAobW9kZSA9PT0gU3lzLkJpbmRpbmdNb2RlLmF1dG8pKSB7XHJcblx0XHRcdFx0bW9kZSA9IFwib25lV2F5XCI7XHJcblx0XHRcdFx0aWYgKCh0aGlzLl9pc0lucHV0KHRhcmdldCwgdGhpcy5fdGFyZ2V0UHJvcGVydHlBcnJheSA/IHRoaXMuX3RhcmdldFByb3BlcnR5QXJyYXlbMF0gOiBcIlwiKSkgfHxcclxuXHRcdFx0XHRTeXMuSU5vdGlmeVByb3BlcnR5Q2hhbmdlLmlzSW1wbGVtZW50ZWRCeSh0YXJnZXQpKSB7XHJcblx0XHRcdFx0XHRtb2RlID0gXCJ0d29XYXlcIjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0bW9kZSA9IFN5cy5CaW5kaW5nTW9kZVttb2RlXTtcclxuXHRcdFx0XHR0aGlzLnNldF9tb2RlKG1vZGUpO1xyXG5cdFx0XHR9XHJcblx0XHRcdFN5cy5CaW5kaW5nLmNhbGxCYXNlTWV0aG9kKHRoaXMsICdpbml0aWFsaXplJyk7XHJcblx0XHRcdGlmICh0aGlzLmdldF9pc0xpbmtQZW5kaW5nKCkpIHtcclxuXHRcdFx0XHR0aGlzLmxpbmsoKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aGlzLnVwZGF0ZShtb2RlKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKG1vZGUgIT09IFN5cy5CaW5kaW5nTW9kZS5vbmVUaW1lKSB7XHJcblx0XHRcdFx0aWYgKHNvdXJjZSkge1xyXG5cdFx0XHRcdFx0aWYgKG1vZGUgIT09IFN5cy5CaW5kaW5nTW9kZS5vbmVXYXlUb1NvdXJjZSkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLl93YXRjaE9iamVjdChzb3VyY2UsIHRydWUpO1xyXG5cdFx0XHRcdFx0XHRpZiAoU3lzLklOb3RpZnlEaXNwb3NpbmcuaXNJbXBsZW1lbnRlZEJ5KHNvdXJjZSkpIHtcclxuXHRcdFx0XHRcdFx0XHRzb3VyY2UuYWRkX2Rpc3Bvc2luZyh0aGlzLl9vbkRpc3Bvc2UpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRpZiAoU3lzLlVJLkRvbUVsZW1lbnQuaXNEb21FbGVtZW50KHNvdXJjZSkpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5fYWRkQmluZGluZyhzb3VyY2UpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAodGFyZ2V0KSB7XHJcblx0XHRcdFx0XHRpZiAobW9kZSAhPT0gU3lzLkJpbmRpbmdNb2RlLm9uZVdheSkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLl93YXRjaE9iamVjdCh0YXJnZXQpO1xyXG5cdFx0XHRcdFx0XHRpZiAoU3lzLklOb3RpZnlEaXNwb3NpbmcuaXNJbXBsZW1lbnRlZEJ5KHRhcmdldCkpIHtcclxuXHRcdFx0XHRcdFx0XHR0YXJnZXQuYWRkX2Rpc3Bvc2luZyh0aGlzLl9vbkRpc3Bvc2UpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRpZiAoU3lzLlVJLkRvbUVsZW1lbnQuaXNEb21FbGVtZW50KHRhcmdldCkpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5fYWRkQmluZGluZyh0YXJnZXQpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRmdW5jdGlvbiBsaXN0ZW4oZSwgcCkge1xyXG5cdFx0XHRcdGlmIChTeXMuVUkuRG9tRWxlbWVudC5pc0RvbUVsZW1lbnQoZSkgJiYgL15zZWxlY3QkL2kudGVzdChlLnRhZ05hbWUpICYmIC9eKHNlbGVjdGVkSW5kZXh8dmFsdWUpJC9pLnRlc3QocCkpIHtcclxuXHRcdFx0XHRcdFN5cy5PYnNlcnZlci5hZGRFdmVudEhhbmRsZXIoZSwgXCJvcHRpb25zQ2hhbmdlZFwiLCB0aGlzLl9vbk9wdGlvbnNVcGRhdGVkKTtcclxuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHNvdXJjZSAmJiBtb2RlID49IDMpIHtcclxuXHRcdFx0XHR0aGlzLl9zb3VyY2VPcHRpb24gPSBsaXN0ZW4uY2FsbCh0aGlzLCBzb3VyY2UsIHRoaXMuZ2V0X3BhdGgoKSk7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHRhcmdldCAmJiBtb2RlIDw9IDMpIHtcclxuXHRcdFx0XHR0aGlzLl90YXJnZXRPcHRpb24gPSBsaXN0ZW4uY2FsbCh0aGlzLCB0YXJnZXQsIHRoaXMuZ2V0X3RhcmdldFByb3BlcnR5KCkpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkQmluZGluZyRfaXNDaGVja2VkKGVsZW1lbnQsIG5hbWUpIHtcclxuXHRcdFx0cmV0dXJuIChuYW1lID09PSBcImNoZWNrZWRcIikgJiYgKGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcImlucHV0XCIpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJEJpbmRpbmckX29wdGlvbnNVcGRhdGVkKHNlbGVjdCkge1xyXG5cdFx0XHRpZiAoIXRoaXMuX2Rpc3Bvc2VkKSB7XHJcblx0XHRcdFx0dGhpcy51cGRhdGUoc2VsZWN0ID09PSB0aGlzLmdldF9zb3VyY2UoKSA/IDQgOiAyKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJEJpbmRpbmckX3NvdXJjZUNoYW5nZWQoZm9yY2UpIHtcclxuXHRcdFx0aWYgKHRoaXMuX2Rpc3Bvc2VkKSByZXR1cm47XHJcblx0XHRcdHZhciBlcixcclxuXHRcdFx0XHRsaW5rID0gZm9yY2UgPT09IGZhbHNlLFxyXG5cdFx0XHRcdHRhcmdldCA9IHRoaXMuZ2V0X3RhcmdldCgpLFxyXG5cdFx0XHRcdHNvdXJjZSA9IHRoaXMuZ2V0X3NvdXJjZSgpO1xyXG5cdFx0XHRmb3JjZSA9IGZvcmNlID09PSB0cnVlO1xyXG5cdFx0XHRpZiAoIXRhcmdldCkgcmV0dXJuO1xyXG5cdFx0XHRzb3VyY2UgPSAoc291cmNlICYmIHRoaXMuX3BhdGhBcnJheSlcclxuXHRcdFx0XHRcdD8gdGhpcy5fZ2V0UHJvcGVydHlGcm9tSW5kZXgoc291cmNlLCB0aGlzLl9wYXRoQXJyYXksIDAsIHRoaXMuX3BhdGhBcnJheS5sZW5ndGggLSAxKVxyXG5cdFx0XHRcdFx0OiBzb3VyY2U7XHJcblx0XHRcdGlmIChfaXNWdWVSZWYoc291cmNlKSkge1xyXG5cdFx0XHRcdHNvdXJjZSA9IHNvdXJjZS52YWx1ZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAoIXRoaXMuX3VwZGF0ZVNvdXJjZSAmJiAoZm9yY2UgfHwgbGluayB8fCAoc291cmNlICE9PSB0aGlzLl9sYXN0U291cmNlKSkpIHtcclxuXHRcdFx0XHR0cnkge1xyXG5cdFx0XHRcdFx0dGhpcy5fdXBkYXRlVGFyZ2V0ID0gdHJ1ZTtcclxuXHRcdFx0XHRcdHRoaXMuX2xhc3RTb3VyY2UgPSB0aGlzLl9sYXN0VGFyZ2V0ID0gc291cmNlO1xyXG5cdFx0XHRcdFx0aWYgKCFsaW5rKSB7XHJcblx0XHRcdFx0XHRcdGlmICh0aGlzLl9jb252ZXJ0Rm4pIHtcclxuXHRcdFx0XHRcdFx0XHRpZiAodGhpcy5faWdub3JlRXJyb3JzKSB7XHJcblx0XHRcdFx0XHRcdFx0XHR0cnkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRzb3VyY2UgPSB0aGlzLl9jb252ZXJ0Rm4oc291cmNlLCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdGNhdGNoIChlcikgeyB9XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0c291cmNlID0gdGhpcy5fY29udmVydEZuKHNvdXJjZSwgdGhpcyk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGlmICgoc291cmNlID09PSBudWxsKSB8fCAodHlwZW9mIChzb3VyY2UpID09PSBcInVuZGVmaW5lZFwiKSkge1xyXG5cdFx0XHRcdFx0XHRcdHNvdXJjZSA9IHRoaXMuZ2V0X2RlZmF1bHRWYWx1ZSgpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGlmICh0aGlzLl90YXJnZXRQcm9wZXJ0eSAmJiB0aGlzLl90YXJnZXRQcm9wZXJ0eS5zdGFydHNXaXRoKFwiY2xhc3M6XCIpKSB7XHJcblx0XHRcdFx0XHRcdFx0dmFyIGNsYXNzTmFtZSA9IHRoaXMuX3RhcmdldFByb3BlcnR5LnN1YnN0cig2KS50cmltKCk7XHJcblx0XHRcdFx0XHRcdFx0c291cmNlID8gU3lzLlVJLkRvbUVsZW1lbnQuYWRkQ3NzQ2xhc3ModGFyZ2V0LCBjbGFzc05hbWUpIDogU3lzLlVJLkRvbUVsZW1lbnQucmVtb3ZlQ3NzQ2xhc3ModGFyZ2V0LCBjbGFzc05hbWUpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdHZhciB0YXJnZXRBcnJheUxlbmd0aCA9IHRoaXMuX3RhcmdldFByb3BlcnR5QXJyYXkubGVuZ3RoO1xyXG5cdFx0XHRcdFx0XHRcdHRhcmdldCA9IHRoaXMuX2dldFByb3BlcnR5RnJvbUluZGV4KHRhcmdldCwgdGhpcy5fdGFyZ2V0UHJvcGVydHlBcnJheSwgMCwgdGFyZ2V0QXJyYXlMZW5ndGggLSAyKTtcclxuXHRcdFx0XHRcdFx0XHRpZiAoKHRhcmdldCAhPT0gbnVsbCkgJiYgKHR5cGVvZiAodGFyZ2V0KSAhPT0gXCJ1bmRlZmluZWRcIikpIHtcclxuXHRcdFx0XHRcdFx0XHRcdHZhciBuYW1lID0gdGhpcy5fdGFyZ2V0UHJvcGVydHlBcnJheVt0YXJnZXRBcnJheUxlbmd0aCAtIDFdLFxyXG5cdFx0XHRcdFx0XHRcdFx0aXNFbGVtZW50ID0gU3lzLlVJLkRvbUVsZW1lbnQuaXNEb21FbGVtZW50KHRhcmdldCk7XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoaXNFbGVtZW50KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHNvdXJjZSA9IFN5cy5VSS5UZW1wbGF0ZS5fY2hlY2tBdHRyaWJ1dGUobmFtZSwgc291cmNlKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKHNvdXJjZSA9PT0gbnVsbCB8fCBzb3VyY2UgPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHNvdXJjZSA9IFwiXCI7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdGlmIChpc0VsZW1lbnQgJiYgKG5hbWUgPT09IFwiaW5uZXJIVE1MXCIgfHwgbmFtZSA9PT0gXCJpbm5lclRleHRcIikpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0U3lzLkFwcGxpY2F0aW9uLl9jbGVhckNvbnRlbnQodGFyZ2V0KTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKG5hbWUgPT09IFwiaW5uZXJIVE1MXCIpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR0YXJnZXQuaW5uZXJIVE1MID0gc291cmNlO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHRhcmdldC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShzb3VyY2UpKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRTeXMuT2JzZXJ2ZXIucmFpc2VQcm9wZXJ0eUNoYW5nZWQodGFyZ2V0LCBuYW1lKTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdGVsc2UgaWYgKGlzRWxlbWVudCAmJiAobmFtZSA9PT0gXCJ0YWJJbmRleFwiIHx8IG5hbWUgPT09IFwidGFiaW5kZXhcIikpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0U3lzLk9ic2VydmVyLl9zZXRWYWx1ZSh0YXJnZXQsIFwidGFiSW5kZXhcIiwgc291cmNlKTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRTeXMuT2JzZXJ2ZXIuX3NldFZhbHVlKHRhcmdldCwgbmFtZSwgc291cmNlKTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdGlmIChzb3VyY2UgJiYgaXNFbGVtZW50ICYmIHRoaXMuX2lzQ2hlY2tlZCh0YXJnZXQsIG5hbWUpKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHZhciBhID0gZG9jdW1lbnQuY3JlYXRlQXR0cmlidXRlKG5hbWUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRhLm5vZGVWYWx1ZSA9IG5hbWU7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHRhcmdldC5zZXRBdHRyaWJ1dGVOb2RlKGEpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRmaW5hbGx5IHtcclxuXHRcdFx0XHRcdHRoaXMuX3VwZGF0ZVRhcmdldCA9IGZhbHNlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAoIWZvcmNlICYmICFsaW5rKSB7XHJcblx0XHRcdFx0dGhpcy5fd2F0Y2hPYmplY3QodGhpcy5nZXRfc291cmNlKCksIHRydWUpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkQmluZGluZyRfdGFyZ2V0Q2hhbmdlZChmb3JjZSkge1xyXG5cdFx0XHRpZiAodGhpcy5fZGlzcG9zZWQpIHJldHVybjtcclxuXHRcdFx0dmFyIGxpbmsgPSBmb3JjZSA9PT0gZmFsc2UsXHJcblx0XHRcdFx0dGFyZ2V0ID0gdGhpcy5nZXRfdGFyZ2V0KCksXHJcblx0XHRcdFx0c291cmNlID0gdGhpcy5nZXRfc291cmNlKCk7XHJcblx0XHRcdGZvcmNlID0gZm9yY2UgPT09IHRydWU7XHJcblx0XHRcdGlmICghc291cmNlKSByZXR1cm47XHJcblx0XHRcdHRhcmdldCA9ICF0YXJnZXQgPyBudWxsIDogdGhpcy5fZ2V0UHJvcGVydHlGcm9tSW5kZXgodGFyZ2V0LCB0aGlzLl90YXJnZXRQcm9wZXJ0eUFycmF5LFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHQwLCB0aGlzLl90YXJnZXRQcm9wZXJ0eUFycmF5Lmxlbmd0aCAtIDEpO1xyXG5cdFx0XHRpZiAoIXRoaXMuX3VwZGF0ZVRhcmdldCAmJiAoZm9yY2UgfHwgbGluayB8fCAodGFyZ2V0ICE9PSB0aGlzLl9sYXN0VGFyZ2V0KSkpIHtcclxuXHRcdFx0XHR0cnkge1xyXG5cdFx0XHRcdFx0dGhpcy5fdXBkYXRlU291cmNlID0gdHJ1ZTtcclxuXHRcdFx0XHRcdHRoaXMuX2xhc3RUYXJnZXQgPSB0aGlzLl9sYXN0U291cmNlID0gdGFyZ2V0O1xyXG5cdFx0XHRcdFx0aWYgKCFsaW5rKSB7XHJcblx0XHRcdFx0XHRcdGlmICh0aGlzLl9jb252ZXJ0QmFja0ZuKSB7XHJcblx0XHRcdFx0XHRcdFx0aWYgKHRoaXMuX2lnbm9yZUVycm9ycykge1xyXG5cdFx0XHRcdFx0XHRcdFx0dHJ5IHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dGFyZ2V0ID0gdGhpcy5fY29udmVydEJhY2tGbih0YXJnZXQsIHRoaXMpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0Y2F0Y2ggKGUpIHsgfVxyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdHRhcmdldCA9IHRoaXMuX2NvbnZlcnRCYWNrRm4odGFyZ2V0LCB0aGlzKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0aWYgKHRoaXMuX3BhdGhBcnJheSkge1xyXG5cdFx0XHRcdFx0XHRcdHZhciBzb3VyY2VBcnJheUxlbmd0aCA9IHRoaXMuX3BhdGhBcnJheS5sZW5ndGg7XHJcblx0XHRcdFx0XHRcdFx0c291cmNlID0gdGhpcy5fZ2V0UHJvcGVydHlGcm9tSW5kZXgoc291cmNlLCB0aGlzLl9wYXRoQXJyYXksIDAsIHNvdXJjZUFycmF5TGVuZ3RoIC0gMik7XHJcblx0XHRcdFx0XHRcdFx0aWYgKChzb3VyY2UgIT09IG51bGwpICYmICh0eXBlb2YgKHNvdXJjZSkgIT09IFwidW5kZWZpbmVkXCIpKSB7XHJcblx0XHRcdFx0XHRcdFx0XHR2YXIgbmFtZSA9IHRoaXMuX3BhdGhBcnJheVtzb3VyY2VBcnJheUxlbmd0aCAtIDFdLFxyXG5cdFx0XHRcdFx0XHRcdFx0aXNFbGVtZW50ID0gU3lzLlVJLkRvbUVsZW1lbnQuaXNEb21FbGVtZW50KHNvdXJjZSk7XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoaXNFbGVtZW50KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHRhcmdldCA9IFN5cy5VSS5UZW1wbGF0ZS5fY2hlY2tBdHRyaWJ1dGUobmFtZSwgdGFyZ2V0KTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKG5hbWUgPT09IFwiaW5uZXJIVE1MXCIpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRTeXMuQXBwbGljYXRpb24uX2NsZWFyQ29udGVudChzb3VyY2UpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRTeXMuT2JzZXJ2ZXIuX3NldFZhbHVlKHNvdXJjZSwgbmFtZSwgdGFyZ2V0KTtcclxuXHRcdFx0XHRcdFx0XHRcdGlmICh0YXJnZXQgJiYgaXNFbGVtZW50ICYmIHRoaXMuX2lzQ2hlY2tlZChzb3VyY2UsIG5hbWUpKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHZhciBhID0gZG9jdW1lbnQuY3JlYXRlQXR0cmlidXRlKG5hbWUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRhLm5vZGVWYWx1ZSA9IG5hbWU7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHNvdXJjZS5zZXRBdHRyaWJ1dGVOb2RlKGEpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRmaW5hbGx5IHtcclxuXHRcdFx0XHRcdHRoaXMuX3VwZGF0ZVNvdXJjZSA9IGZhbHNlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAoIWZvcmNlICYmICFsaW5rKSB7XHJcblx0XHRcdFx0dGhpcy5fd2F0Y2hPYmplY3QodGhpcy5nZXRfdGFyZ2V0KCkpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkQmluZGluZyRfcmVzb2x2ZVJlZmVyZW5jZShzdHIpIHtcclxuXHRcdFx0dmFyIHJlZiA9IFN5cy5nZXQoc3RyLCB0aGlzLmdldF90ZW1wbGF0ZUNvbnRleHQoKSk7XHJcblx0XHRcdGlmICgocmVmID09PSBudWxsKSB8fCAodHlwZW9mIChyZWYpID09PSBcInVuZGVmaW5lZFwiKSkge1xyXG5cdFx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3RyaW5nLmZvcm1hdChTeXMuVUkuVGVtcGxhdGVzUmVzLnVucmVzb2x2ZWRSZWZlcmVuY2UsIHN0cikpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiByZWYgfHwgbnVsbDtcclxuXHRcdH1cclxuXHRcdFN5cy5CaW5kaW5nLnByb3RvdHlwZSA9IHtcclxuXHRcdFx0X2RlZmF1bHRWYWx1ZTogbnVsbCxcclxuXHRcdFx0Z2V0X2NvbnZlcnQ6IFN5cyRCaW5kaW5nJGdldF9jb252ZXJ0LFxyXG5cdFx0XHRzZXRfY29udmVydDogU3lzJEJpbmRpbmckc2V0X2NvbnZlcnQsXHJcblx0XHRcdGdldF9jb252ZXJ0QmFjazogU3lzJEJpbmRpbmckZ2V0X2NvbnZlcnRCYWNrLFxyXG5cdFx0XHRzZXRfY29udmVydEJhY2s6IFN5cyRCaW5kaW5nJHNldF9jb252ZXJ0QmFjayxcclxuXHRcdFx0Z2V0X2lnbm9yZUVycm9yczogU3lzJEJpbmRpbmckZ2V0X2lnbm9yZUVycm9ycyxcclxuXHRcdFx0c2V0X2lnbm9yZUVycm9yczogU3lzJEJpbmRpbmckc2V0X2lnbm9yZUVycm9ycyxcclxuXHRcdFx0Z2V0X21vZGU6IFN5cyRCaW5kaW5nJGdldF9tb2RlLFxyXG5cdFx0XHRzZXRfbW9kZTogU3lzJEJpbmRpbmckc2V0X21vZGUsXHJcblx0XHRcdGdldF9kZWZhdWx0VmFsdWU6IFN5cyRCaW5kaW5nJGdldF9kZWZhdWx0VmFsdWUsXHJcblx0XHRcdHNldF9kZWZhdWx0VmFsdWU6IFN5cyRCaW5kaW5nJHNldF9kZWZhdWx0VmFsdWUsXHJcblx0XHRcdGdldF9zb3VyY2U6IFN5cyRCaW5kaW5nJGdldF9zb3VyY2UsXHJcblx0XHRcdHNldF9zb3VyY2U6IFN5cyRCaW5kaW5nJHNldF9zb3VyY2UsXHJcblx0XHRcdGdldF90ZW1wbGF0ZUNvbnRleHQ6IFN5cyRCaW5kaW5nJGdldF90ZW1wbGF0ZUNvbnRleHQsXHJcblx0XHRcdHNldF90ZW1wbGF0ZUNvbnRleHQ6IFN5cyRCaW5kaW5nJHNldF90ZW1wbGF0ZUNvbnRleHQsXHJcblx0XHRcdGdldF9wYXRoOiBTeXMkQmluZGluZyRnZXRfcGF0aCxcclxuXHRcdFx0c2V0X3BhdGg6IFN5cyRCaW5kaW5nJHNldF9wYXRoLFxyXG5cdFx0XHRnZXRfdGFyZ2V0OiBTeXMkQmluZGluZyRnZXRfdGFyZ2V0LFxyXG5cdFx0XHRzZXRfdGFyZ2V0OiBTeXMkQmluZGluZyRzZXRfdGFyZ2V0LFxyXG5cdFx0XHRnZXRfdGFyZ2V0UHJvcGVydHk6IFN5cyRCaW5kaW5nJGdldF90YXJnZXRQcm9wZXJ0eSxcclxuXHRcdFx0c2V0X3RhcmdldFByb3BlcnR5OiBTeXMkQmluZGluZyRzZXRfdGFyZ2V0UHJvcGVydHksXHJcblx0XHRcdF9hZGRCaW5kaW5nOiBTeXMkQmluZGluZyRfYWRkQmluZGluZyxcclxuXHRcdFx0ZGlzcG9zZTogU3lzJEJpbmRpbmckZGlzcG9zZSxcclxuXHRcdFx0X2dldFByb3BlcnR5RnJvbUluZGV4OiBTeXMkQmluZGluZyRfZ2V0UHJvcGVydHlGcm9tSW5kZXgsXHJcblx0XHRcdF9nZXRQcm9wZXJ0eURhdGE6IFN5cyRCaW5kaW5nJF9nZXRQcm9wZXJ0eURhdGEsXHJcblx0XHRcdF93YXRjaE9iamVjdDogU3lzJEJpbmRpbmckX3dhdGNoT2JqZWN0LFxyXG5cdFx0XHRfaXNJbnB1dDogU3lzJEJpbmRpbmckX2lzSW5wdXQsXHJcblx0XHRcdF9saXN0ZW46IFN5cyRCaW5kaW5nJF9saXN0ZW4sXHJcblx0XHRcdF9mb3JnZXQ6IFN5cyRCaW5kaW5nJF9mb3JnZXQsXHJcblx0XHRcdF9yZXNvbHZlRnVuY3Rpb246IFN5cyRCaW5kaW5nJF9yZXNvbHZlRnVuY3Rpb24sXHJcblx0XHRcdHVwZGF0ZTogU3lzJEJpbmRpbmckdXBkYXRlLFxyXG5cdFx0XHRsaW5rOiBTeXMkQmluZGluZyRsaW5rLFxyXG5cdFx0XHRfbm90U2V0OiBTeXMkQmluZGluZyRfbm90U2V0LFxyXG5cdFx0XHRpbml0aWFsaXplOiBTeXMkQmluZGluZyRpbml0aWFsaXplLFxyXG5cdFx0XHRfZG9Jbml0aWFsaXplOiBTeXMkQmluZGluZyRfZG9Jbml0aWFsaXplLFxyXG5cdFx0XHRfaXNDaGVja2VkOiBTeXMkQmluZGluZyRfaXNDaGVja2VkLFxyXG5cdFx0XHRfb3B0aW9uc1VwZGF0ZWQ6IFN5cyRCaW5kaW5nJF9vcHRpb25zVXBkYXRlZCxcclxuXHRcdFx0X3NvdXJjZUNoYW5nZWQ6IFN5cyRCaW5kaW5nJF9zb3VyY2VDaGFuZ2VkLFxyXG5cdFx0XHRfdGFyZ2V0Q2hhbmdlZDogU3lzJEJpbmRpbmckX3RhcmdldENoYW5nZWQsXHJcblx0XHRcdF9yZXNvbHZlUmVmZXJlbmNlOiBTeXMkQmluZGluZyRfcmVzb2x2ZVJlZmVyZW5jZVxyXG5cdFx0fVxyXG5cdFx0U3lzLkJpbmRpbmcuX2Rpc3Bvc2VCaW5kaW5ncyA9IGZ1bmN0aW9uIFN5cyRCaW5kaW5nJF9kaXNwb3NlQmluZGluZ3MoKSB7XHJcblx0XHRcdHZhciBiaW5kaW5ncyA9IHRoaXMuX19tc2FqYXhiaW5kaW5ncztcclxuXHRcdFx0aWYgKGJpbmRpbmdzKSB7XHJcblx0XHRcdFx0Zm9yICh2YXIgaSA9IDAsIGwgPSBiaW5kaW5ncy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuXHRcdFx0XHRcdGJpbmRpbmdzW2ldLmRpc3Bvc2UoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5fX21zYWpheGJpbmRpbmdzID0gbnVsbDtcclxuXHRcdH1cclxuXHRcdFN5cy5CaW5kaW5nLnJlZ2lzdGVyQ2xhc3MoXCJTeXMuQmluZGluZ1wiLCBTeXMuQ29tcG9uZW50LCBTeXMuVUkuSVRlbXBsYXRlQ29udGV4dENvbnN1bWVyKTtcclxuXHRcdFN5cy5jb252ZXJ0ZXJzID0gU3lzLmNvbnZlcnRlcnMgfHwge307XHJcblxyXG5cdFx0U3lzLkJpbmRpbmcuYmluZCA9IGZ1bmN0aW9uIFN5cyRCaW5kaW5nJGJpbmQodGFyZ2V0T3JPcHRpb25zLCBwcm9wZXJ0eSwgc291cmNlLCBwYXRoLCBvcHRpb25zKSB7XHJcblx0XHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkge1xyXG5cdFx0XHRcdG9wdGlvbnMgPSBtZXJnZSh7XHJcblx0XHRcdFx0XHR0YXJnZXQ6IHRhcmdldE9yT3B0aW9ucyxcclxuXHRcdFx0XHRcdHRhcmdldFByb3BlcnR5OiBwcm9wZXJ0eSxcclxuXHRcdFx0XHRcdHNvdXJjZTogc291cmNlLFxyXG5cdFx0XHRcdFx0cGF0aDogcGF0aCxcclxuXHRcdFx0XHRcdHRlbXBsYXRlQ29udGV4dDogU3lzLl9pc0luc3RhbmNlT2ZUeXBlKFN5cy5VSS5UZW1wbGF0ZUNvbnRleHQsIHRoaXMpID8gdGhpcyA6IG51bGxcclxuXHRcdFx0XHR9LCBvcHRpb25zKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRvcHRpb25zID0gdGFyZ2V0T3JPcHRpb25zO1xyXG5cdFx0XHR9XHJcblx0XHRcdHZhciB2YWx1ZSA9IG9wdGlvbnMubW9kZTtcclxuXHRcdFx0aWYgKHR5cGVvZiAodmFsdWUpID09PSBcInN0cmluZ1wiKSB7XHJcblx0XHRcdFx0b3B0aW9ucy5tb2RlID0gU3lzLkJpbmRpbmdNb2RlLnBhcnNlKHZhbHVlKTtcclxuXHRcdFx0fVxyXG5cdFx0XHR2YWx1ZSA9IG9wdGlvbnMuaWdub3JlRXJyb3JzO1xyXG5cdFx0XHRpZiAodHlwZW9mICh2YWx1ZSkgPT09IFwic3RyaW5nXCIpIHtcclxuXHRcdFx0XHRvcHRpb25zLmlnbm9yZUVycm9ycyA9IEJvb2xlYW4ucGFyc2UodmFsdWUpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHZhciBiaW5kaW5nID0gbmV3IFN5cy5CaW5kaW5nKCk7XHJcblx0XHRcdGZvckluKG9wdGlvbnMsIGZ1bmN0aW9uICh2LCBuKSB7XHJcblx0XHRcdFx0aWYgKHR5cGVvZiAodikgIT09IFwidW5kZWZpbmVkXCIpIFN5cy5PYnNlcnZlci5zZXRWYWx1ZShiaW5kaW5nLCBuLCB2KTtcclxuXHRcdFx0fSk7XHJcblx0XHRcdGJpbmRpbmcuaW5pdGlhbGl6ZSgpO1xyXG5cdFx0XHRyZXR1cm4gYmluZGluZztcclxuXHRcdH1cclxuXHJcblx0XHRTeXMucmVnaXN0ZXJQbHVnaW4oe1xyXG5cdFx0XHRuYW1lOiBcImJpbmRcIixcclxuXHRcdFx0cGx1Z2luOiBTeXMuQmluZGluZy5iaW5kXHJcblx0XHR9KTtcclxuXHJcblx0XHRTeXMuQXBwbGljYXRpb24ucmVnaXN0ZXJNYXJrdXBFeHRlbnNpb24oXHJcblwiYmluZGluZ1wiLFxyXG5mdW5jdGlvbiAoY29tcG9uZW50LCB0YXJnZXRQcm9wZXJ0eSwgdGVtcGxhdGVDb250ZXh0LCBwcm9wZXJ0aWVzKSB7XHJcblx0dmFyIG9wdGlvbnMgPSBtZXJnZSh7XHJcblx0XHRzb3VyY2U6IHRlbXBsYXRlQ29udGV4dC5kYXRhSXRlbSxcclxuXHRcdHRlbXBsYXRlQ29udGV4dDogdGVtcGxhdGVDb250ZXh0LFxyXG5cdFx0dGFyZ2V0OiBjb21wb25lbnQsXHJcblx0XHR0YXJnZXRQcm9wZXJ0eTogdGFyZ2V0UHJvcGVydHlcclxuXHR9LCBwcm9wZXJ0aWVzKTtcclxuXHRvcHRpb25zLnBhdGggPSBvcHRpb25zLnBhdGggfHwgb3B0aW9ucy4kZGVmYXVsdDtcclxuXHRkZWxldGUgb3B0aW9ucy4kZGVmYXVsdDtcclxuXHR2YXIgYmluZGluZyA9IFN5cy5CaW5kaW5nLmJpbmQob3B0aW9ucyk7XHJcblx0dGVtcGxhdGVDb250ZXh0LmNvbXBvbmVudHMucHVzaChiaW5kaW5nKTtcclxufSxcclxuZmFsc2UpO1xyXG5cdFx0U3lzLlVJLkRhdGFWaWV3ID0gZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3KGVsZW1lbnQpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5EYXRhVmlldy4jY3RvclwiIC8+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cImVsZW1lbnRcIj48L3BhcmFtPlxyXG5cdFx0XHRTeXMuVUkuRGF0YVZpZXcuaW5pdGlhbGl6ZUJhc2UodGhpcywgW2VsZW1lbnRdKTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBHbG9iYWwgZGF0YXZpZXcgY29uZmlndXJhdGlvblxyXG5cdFx0U3lzLlVJLkRhdGFWaWV3LmNvbmZpZyA9IHtcclxuXHRcdFx0dXNlT3B0aW1hbFVwZGF0ZXM6IGZhbHNlXHJcblx0XHR9O1xyXG5cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRhZGRfY29tbWFuZChoYW5kbGVyKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIkU6SiNTeXMuVUkuRGF0YVZpZXcuY29tbWFuZFwiIC8+XHJcblx0XHRcdHRoaXMuX2FkZEhhbmRsZXIoXCJjb21tYW5kXCIsIGhhbmRsZXIpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JHJlbW92ZV9jb21tYW5kKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fcmVtb3ZlSGFuZGxlcihcImNvbW1hbmRcIiwgaGFuZGxlcik7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckYWRkX3JlbmRlcmluZyhoYW5kbGVyKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIkU6SiNTeXMuVUkuRGF0YVZpZXcucmVuZGVyaW5nXCIgLz5cclxuXHRcdFx0dGhpcy5fYWRkSGFuZGxlcihcInJlbmRlcmluZ1wiLCBoYW5kbGVyKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRyZW1vdmVfcmVuZGVyaW5nKGhhbmRsZXIpIHtcclxuXHRcdFx0dGhpcy5fcmVtb3ZlSGFuZGxlcihcInJlbmRlcmluZ1wiLCBoYW5kbGVyKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRhZGRfcmVuZGVyZWQoaGFuZGxlcikge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJFOkojU3lzLlVJLkRhdGFWaWV3LnJlbmRlcmVkXCIgLz5cclxuXHRcdFx0dGhpcy5fYWRkSGFuZGxlcihcInJlbmRlcmVkXCIsIGhhbmRsZXIpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JHJlbW92ZV9yZW5kZXJlZChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUhhbmRsZXIoXCJyZW5kZXJlZFwiLCBoYW5kbGVyKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRhZGRfaXRlbVJlbmRlcmVkKGhhbmRsZXIpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiRTpKI1N5cy5VSS5EYXRhVmlldy5pdGVtUmVuZGVyZWRcIiAvPlxyXG5cdFx0XHR0aGlzLl9hZGRIYW5kbGVyKFwiaXRlbVJlbmRlcmVkXCIsIGhhbmRsZXIpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JHJlbW92ZV9pdGVtUmVuZGVyZWQoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9yZW1vdmVIYW5kbGVyKFwiaXRlbVJlbmRlcmVkXCIsIGhhbmRsZXIpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JGFkZF9pdGVtUmVuZGVyaW5nKGhhbmRsZXIpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiRTpKI1N5cy5VSS5EYXRhVmlldy5pdGVtUmVuZGVyaW5nXCIgLz5cclxuXHRcdFx0dGhpcy5fYWRkSGFuZGxlcihcIml0ZW1SZW5kZXJpbmdcIiwgaGFuZGxlcik7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckcmVtb3ZlX2l0ZW1SZW5kZXJpbmcoaGFuZGxlcikge1xyXG5cdFx0XHR0aGlzLl9yZW1vdmVIYW5kbGVyKFwiaXRlbVJlbmRlcmluZ1wiLCBoYW5kbGVyKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRhZGRfZmV0Y2hGYWlsZWQoaGFuZGxlcikge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJFOkojU3lzLlVJLkRhdGFWaWV3LmZldGNoRmFpbGVkXCIgLz5cclxuXHRcdFx0dGhpcy5fYWRkSGFuZGxlcihcImZldGNoRmFpbGVkXCIsIGhhbmRsZXIpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JHJlbW92ZV9mZXRjaEZhaWxlZChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUhhbmRsZXIoXCJmZXRjaEZhaWxlZFwiLCBoYW5kbGVyKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRhZGRfZmV0Y2hTdWNjZWVkZWQoaGFuZGxlcikge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJFOkojU3lzLlVJLkRhdGFWaWV3LmZldGNoU3VjY2VlZGVkXCIgLz5cclxuXHRcdFx0dGhpcy5fYWRkSGFuZGxlcihcImZldGNoU3VjY2VlZGVkXCIsIGhhbmRsZXIpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JHJlbW92ZV9mZXRjaFN1Y2NlZWRlZChoYW5kbGVyKSB7XHJcblx0XHRcdHRoaXMuX3JlbW92ZUhhbmRsZXIoXCJmZXRjaFN1Y2NlZWRlZFwiLCBoYW5kbGVyKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRnZXRfdmlld0RhdGEoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgbWF5QmVOdWxsPVwidHJ1ZVwiIGxvY2lkPVwiUDpKI1N5cy5VSS5EYXRhVmlldy52aWV3RGF0YVwiPjwvdmFsdWU+XHJcblx0XHRcdHJldHVybiB0aGlzLl92aWV3RGF0YSB8fCBudWxsO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JGdldF9kYXRhKCkge1xyXG5cdFx0XHQvLy8gPHZhbHVlIG1heUJlTnVsbD1cInRydWVcIiBsb2NpZD1cIlA6SiNTeXMuVUkuRGF0YVZpZXcuZGF0YVwiPjwvdmFsdWU+XHJcblx0XHRcdHJldHVybiB0aGlzLl9kYXRhO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JHNldF9kYXRhKHZhbHVlKSB7XHJcblx0XHRcdGlmICghdGhpcy5fc2V0RGF0YSB8fCAodGhpcy5fZGF0YSAhPT0gdmFsdWUpKSB7XHJcblx0XHRcdFx0dGhpcy5fbG9hZERhdGEodmFsdWUpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckZ2V0X2RhdGFQcm92aWRlcigpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSBtYXlCZU51bGw9XCJ0cnVlXCIgbG9jaWQ9XCJQOkojU3lzLlVJLkRhdGFWaWV3LmRhdGFQcm92aWRlclwiPjwvdmFsdWU+XHJcblx0XHRcdHJldHVybiB0aGlzLl9wcm92aWRlciB8fCBudWxsO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JHNldF9kYXRhUHJvdmlkZXIodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fZGF0YVByb3ZpZGVyID0gdGhpcy5fd3NwID0gdGhpcy5fd3NwQ2xhc3MgPSBudWxsO1xyXG5cdFx0XHRpZiAoU3lzLkRhdGEuSURhdGFQcm92aWRlci5pc0ltcGxlbWVudGVkQnkodmFsdWUpKSB7XHJcblx0XHRcdFx0dGhpcy5fZGF0YVByb3ZpZGVyID0gdmFsdWU7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoU3lzLk5ldC5XZWJTZXJ2aWNlUHJveHkuaXNJbnN0YW5jZU9mVHlwZSh2YWx1ZSkpIHtcclxuXHRcdFx0XHR0aGlzLl93c3AgPSB2YWx1ZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmIChUeXBlLmlzQ2xhc3ModmFsdWUpICYmIHZhbHVlLmluaGVyaXRzRnJvbShTeXMuTmV0LldlYlNlcnZpY2VQcm94eSkgJiYgdHlwZW9mICh2YWx1ZS5nZXRfcGF0aCkgPT09IFwiZnVuY3Rpb25cIikge1xyXG5cdFx0XHRcdHRoaXMuX3dzcENsYXNzID0gdmFsdWU7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoKHZhbHVlICE9PSBudWxsKSAmJiAodHlwZW9mICh2YWx1ZSkgIT09IFwic3RyaW5nXCIpKSB7XHJcblx0XHRcdFx0dGhyb3cgRXJyb3IuYXJndW1lbnQoXCJkYXRhUHJvdmlkZXJcIiwgU3lzLlVJLlRlbXBsYXRlc1Jlcy5pbnZhbGlkRGF0YVByb3ZpZGVyVHlwZSk7XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5fcHJvdmlkZXIgPSB2YWx1ZTtcclxuXHRcdFx0aWYgKHRoaXMuZ2V0X2F1dG9GZXRjaCgpICYmIHRoaXMuX2lzQWN0aXZlKCkpIHtcclxuXHRcdFx0XHRpZiAodmFsdWUpIHtcclxuXHRcdFx0XHRcdHRoaXMuX2RvQXV0b0ZldGNoKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMuX3N0YWxlID0gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JGdldF9hdXRvRmV0Y2goKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgbG9jaWQ9XCJQOkojU3lzLlVJLkRhdGFWaWV3LmF1dG9GZXRjaFwiPjwvdmFsdWU+XHJcblx0XHRcdHJldHVybiB0aGlzLl9hdXRvRmV0Y2g7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckc2V0X2F1dG9GZXRjaCh2YWx1ZSkge1xyXG5cdFx0XHR2YXIgd2FzID0gdGhpcy5fYXV0b0ZldGNoO1xyXG5cdFx0XHRpZiAodHlwZW9mICh2YWx1ZSkgPT09IFwic3RyaW5nXCIpIHtcclxuXHRcdFx0XHR2YWx1ZSA9IEJvb2xlYW4ucGFyc2UodmFsdWUpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKHR5cGVvZiAodmFsdWUpICE9PSBcImJvb2xlYW5cIikge1xyXG5cdFx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3lzLlVJLlRlbXBsYXRlc1Jlcy5zdHJpbmdPckJvb2xlYW4pO1xyXG5cdFx0XHR9XHJcblx0XHRcdHRoaXMuX2F1dG9GZXRjaCA9IHZhbHVlO1xyXG5cdFx0XHRpZiAodGhpcy5faXNBY3RpdmUoKSAmJiB0aGlzLl9zdGFsZSAmJiAhd2FzICYmIHZhbHVlKSB7XHJcblx0XHRcdFx0dGhpcy5fZG9BdXRvRmV0Y2goKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JGdldF9pc0ZldGNoaW5nKCkge1xyXG5cdFx0XHQvLy8gPHZhbHVlIHR5cGU9XCJCb29sZWFuXCIgbG9jaWQ9XCJQOkojU3lzLlVJLkRhdGFWaWV3LmlzRmV0Y2hpbmdcIj48L3ZhbHVlPlxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fZmV0Y2hpbmc7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckZ2V0X2h0dHBWZXJiKCkge1xyXG5cdFx0XHQvLy8gPHZhbHVlIHR5cGU9XCJTdHJpbmdcIiBsb2NpZD1cIlA6SiNTeXMuVUkuRGF0YVZpZXcuaHR0cFZlcmJcIj48L3ZhbHVlPlxyXG5cdFx0XHRyZXR1cm4gdGhpcy5faHR0cFZlcmIgfHwgXCJQT1NUXCI7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckc2V0X2h0dHBWZXJiKHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX2h0dHBWZXJiID0gdmFsdWU7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckZ2V0X2NvbnRleHRzKCkge1xyXG5cdFx0XHQvLy8gPHZhbHVlIHR5cGU9XCJBcnJheVwiIGVsZW1lbnRUeXBlPVwiU3lzLlVJLlRlbXBsYXRlQ29udGV4dFwiIGVsZW1lbnRNYXlCZU51bGw9XCJ0cnVlXCIgbG9jaWQ9XCJQOkojU3lzLlVJLkRhdGFWaWV3LmNvbnRleHRzXCI+PC92YWx1ZT5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX2NvbnRleHRzO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JGdldF9mZXRjaFBhcmFtZXRlcnMoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgdHlwZT1cIk9iamVjdFwiIG1heUJlTnVsbD1cInRydWVcIiBsb2NpZD1cIlA6SiNTeXMuVUkuRGF0YVZpZXcuZmV0Y2hQYXJhbWV0ZXJzXCI+PC92YWx1ZT5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX2ZldGNoUGFyYW1ldGVycztcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRzZXRfZmV0Y2hQYXJhbWV0ZXJzKHZhbHVlKSB7XHJcblx0XHRcdGlmICh0aGlzLl9mZXRjaFBhcmFtZXRlcnMgIT09IHZhbHVlKSB7XHJcblx0XHRcdFx0dGhpcy5fZmV0Y2hQYXJhbWV0ZXJzID0gdmFsdWU7XHJcblx0XHRcdFx0aWYgKHRoaXMuZ2V0X2F1dG9GZXRjaCgpICYmIHRoaXMuX2lzQWN0aXZlKCkpIHtcclxuXHRcdFx0XHRcdHRoaXMuX2RvQXV0b0ZldGNoKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0dGhpcy5fc3RhbGUgPSB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JGdldF9zZWxlY3RlZERhdGEoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgbWF5QmVOdWxsPVwidHJ1ZVwiIGxvY2lkPVwiUDpKI1N5cy5VSS5EYXRhVmlldy5zZWxlY3RlZERhdGFcIj48L3ZhbHVlPlxyXG5cdFx0XHR2YXIgc2VsZWN0ZWRJbmRleCA9IHRoaXMuZ2V0X3NlbGVjdGVkSW5kZXgoKTtcclxuXHRcdFx0aWYgKHNlbGVjdGVkSW5kZXggPiAtMSkge1xyXG5cdFx0XHRcdHZhciBkYXRhID0gdGhpcy5nZXRfdmlld0RhdGEoKTtcclxuXHRcdFx0XHRpZiAoKGRhdGEgaW5zdGFuY2VvZiBBcnJheSkgJiYgKHNlbGVjdGVkSW5kZXggPCBkYXRhLmxlbmd0aCkpIHtcclxuXHRcdFx0XHRcdHJldHVybiBkYXRhW3NlbGVjdGVkSW5kZXhdO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRnZXRfc2VsZWN0ZWRJbmRleCgpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSBsb2NpZD1cIlA6SiNTeXMuVUkuRGF0YVZpZXcuc2VsZWN0ZWRJbmRleFwiPjwvdmFsdWU+XHJcblx0XHRcdHJldHVybiB0aGlzLl9zZWxlY3RlZEluZGV4O1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JHNldF9zZWxlY3RlZEluZGV4KHZhbHVlKSB7XHJcblx0XHRcdHZhbHVlID0gdGhpcy5fdmFsaWRhdGVJbmRleElucHV0KHZhbHVlKTtcclxuXHRcdFx0aWYgKHZhbHVlIDwgLTEpIHtcclxuXHRcdFx0XHR0aHJvdyBFcnJvci5hcmd1bWVudE91dE9mUmFuZ2UoXCJ2YWx1ZVwiLCB2YWx1ZSk7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKCF0aGlzLmdldF9pc0luaXRpYWxpemVkKCkgfHwgIXRoaXMuX3NldERhdGEpIHtcclxuXHRcdFx0XHR0aGlzLl9zZWxlY3RlZEluZGV4ID0gdmFsdWU7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5fYXBwbHlTZWxlY3RlZEluZGV4KHZhbHVlKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JGdldF9pbml0aWFsU2VsZWN0ZWRJbmRleCgpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSBsb2NpZD1cIlA6SiNTeXMuVUkuRGF0YVZpZXcuaW5pdGlhbFNlbGVjdGVkSW5kZXhcIj48L3ZhbHVlPlxyXG5cdFx0XHRyZXR1cm4gdGhpcy5faW5pdGlhbFNlbGVjdGVkSW5kZXg7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckc2V0X2luaXRpYWxTZWxlY3RlZEluZGV4KHZhbHVlKSB7XHJcblx0XHRcdHZhbHVlID0gdGhpcy5fdmFsaWRhdGVJbmRleElucHV0KHZhbHVlKTtcclxuXHRcdFx0aWYgKHZhbHVlIDwgLTEpIHtcclxuXHRcdFx0XHR0aHJvdyBFcnJvci5hcmd1bWVudE91dE9mUmFuZ2UoXCJ2YWx1ZVwiLCB2YWx1ZSk7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHZhbHVlICE9PSB0aGlzLmdldF9pbml0aWFsU2VsZWN0ZWRJbmRleCgpKSB7XHJcblx0XHRcdFx0dGhpcy5faW5pdGlhbFNlbGVjdGVkSW5kZXggPSB2YWx1ZTtcclxuXHRcdFx0XHR0aGlzLl9yYWlzZUNoYW5nZWQoXCJpbml0aWFsU2VsZWN0ZWRJbmRleFwiKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JGdldF9zZWxlY3RlZEl0ZW1DbGFzcygpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiU3RyaW5nXCIgbG9jaWQ9XCJQOkojU3lzLlVJLkRhdGFWaWV3LnNlbGVjdGVkSXRlbUNsYXNzXCI+PC92YWx1ZT5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX3NlbGVjdGVkSXRlbUNsYXNzIHx8IFwiXCI7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckc2V0X3NlbGVjdGVkSXRlbUNsYXNzKHZhbHVlKSB7XHJcblx0XHRcdHZhciBuYW1lID0gdGhpcy5nZXRfc2VsZWN0ZWRJdGVtQ2xhc3MoKTtcclxuXHRcdFx0aWYgKHZhbHVlICE9PSBuYW1lKSB7XHJcblx0XHRcdFx0dmFyIGluZGV4ID0gdGhpcy5nZXRfc2VsZWN0ZWRJbmRleCgpO1xyXG5cdFx0XHRcdHRoaXMuX2FkZFJlbW92ZUNzc0NsYXNzKGluZGV4LCBuYW1lLCBTeXMuVUkuRG9tRWxlbWVudC5yZW1vdmVDc3NDbGFzcyk7XHJcblx0XHRcdFx0dGhpcy5fYWRkUmVtb3ZlQ3NzQ2xhc3MoaW5kZXgsIHZhbHVlLCBTeXMuVUkuRG9tRWxlbWVudC5hZGRDc3NDbGFzcyk7XHJcblx0XHRcdFx0dGhpcy5fc2VsZWN0ZWRJdGVtQ2xhc3MgPSB2YWx1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JGdldF90aW1lb3V0KCkge1xyXG5cdFx0XHQvLy8gPHZhbHVlIHR5cGU9XCJOdW1iZXJcIiBpbnRlZ2VyPVwidHJ1ZVwiIGxvY2lkPVwiUDpKI1N5cy5VSS5EYXRhVmlldy50aW1lb3V0XCI+PC92YWx1ZT5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX3RpbWVvdXQ7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckc2V0X3RpbWVvdXQodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fdGltZW91dCA9IHZhbHVlO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JGdldF9mZXRjaE9wZXJhdGlvbigpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSBtYXlCZU51bGw9XCJ0cnVlXCIgbG9jaWQ9XCJQOkojU3lzLlVJLkRhdGFWaWV3LmZldGNoT3BlcmF0aW9uXCI+PC92YWx1ZT5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5IHx8IFwiXCI7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckc2V0X2ZldGNoT3BlcmF0aW9uKHZhbHVlKSB7XHJcblx0XHRcdGlmICh0aGlzLl9xdWVyeSAhPT0gdmFsdWUpIHtcclxuXHRcdFx0XHR0aGlzLl9xdWVyeSA9IHZhbHVlO1xyXG5cdFx0XHRcdGlmICh0aGlzLmdldF9hdXRvRmV0Y2goKSAmJiB0aGlzLl9pc0FjdGl2ZSgpKSB7XHJcblx0XHRcdFx0XHRpZiAodmFsdWUpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5fZG9BdXRvRmV0Y2goKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHR0aGlzLl9zdGFsZSA9IHRydWU7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckZ2V0X2l0ZW1QbGFjZWhvbGRlcigpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSBtYXlCZU51bGw9XCJ0cnVlXCIgbG9jaWQ9XCJQOkojU3lzLlVJLkRhdGFWaWV3Lml0ZW1QbGFjZWhvbGRlclwiPjwvdmFsdWU+XHJcblx0XHRcdHJldHVybiB0aGlzLl9wbGFjZWhvbGRlciB8fCBudWxsO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JHNldF9pdGVtUGxhY2Vob2xkZXIodmFsdWUpIHtcclxuXHRcdFx0aWYgKHRoaXMuX3BsYWNlaG9sZGVyICE9PSB2YWx1ZSkge1xyXG5cdFx0XHRcdHRoaXMuX3BsYWNlaG9sZGVyID0gdmFsdWU7XHJcblx0XHRcdFx0dGhpcy5fZGlydHkgPSB0cnVlO1xyXG5cdFx0XHRcdHRoaXMuX3JhaXNlQ2hhbmdlZChcIml0ZW1QbGFjZWhvbGRlclwiKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JGdldF90ZW1wbGF0ZUNvbnRleHQoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgbWF5QmVOdWxsPVwidHJ1ZVwiIHR5cGU9XCJTeXMuVUkuVGVtcGxhdGVDb250ZXh0XCIgbG9jaWQ9XCJQOkojU3lzLlVJLkRhdGFWaWV3LnRlbXBsYXRlQ29udGV4dFwiPjwvdmFsdWU+XHJcblx0XHRcdHJldHVybiB0aGlzLl9wYXJlbnRDb250ZXh0IHx8IFN5cy5VSS5UZW1wbGF0ZS5maW5kQ29udGV4dCh0aGlzLmdldF9lbGVtZW50KCkpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JHNldF90ZW1wbGF0ZUNvbnRleHQodmFsdWUpIHtcclxuXHRcdFx0aWYgKHRoaXMuX3BhcmVudENvbnRleHQgIT09IHZhbHVlKSB7XHJcblx0XHRcdFx0dGhpcy5fcGFyZW50Q29udGV4dCA9IHZhbHVlO1xyXG5cdFx0XHRcdHRoaXMuX2RpcnR5ID0gdHJ1ZTtcclxuXHRcdFx0XHR0aGlzLl9yYWlzZUNoYW5nZWQoXCJ0ZW1wbGF0ZUNvbnRleHRcIik7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRnZXRfaXRlbVRlbXBsYXRlKCkge1xyXG5cdFx0XHQvLy8gPHZhbHVlIG1heUJlTnVsbD1cInRydWVcIiBsb2NpZD1cIlA6SiNTeXMuVUkuRGF0YVZpZXcuaXRlbVRlbXBsYXRlXCI+PC92YWx1ZT5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX3RlbXBsYXRlIHx8IG51bGw7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckc2V0X2l0ZW1UZW1wbGF0ZSh2YWx1ZSkge1xyXG5cdFx0XHRpZiAodGhpcy5fdGVtcGxhdGUgIT09IHZhbHVlKSB7XHJcblx0XHRcdFx0dGhpcy5fdGVtcGxhdGUgPSB2YWx1ZTtcclxuXHRcdFx0XHR0aGlzLl9kaXJ0eSA9IHRydWU7XHJcblx0XHRcdFx0aWYgKHRoaXMuX2R2VGVtcGxhdGUpIHtcclxuXHRcdFx0XHRcdHRoaXMuX2R2VGVtcGxhdGUuZGlzcG9zZSgpO1xyXG5cdFx0XHRcdFx0dGhpcy5fZHZUZW1wbGF0ZSA9IG51bGw7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGlmICh0aGlzLl9pc0FjdGl2ZSgpKSB7XHJcblx0XHRcdFx0XHR0aGlzLnJhaXNlUHJvcGVydHlDaGFuZ2VkKFwiaXRlbVRlbXBsYXRlXCIpO1xyXG5cdFx0XHRcdFx0dGhpcy5yZWZyZXNoKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0dGhpcy5fY2hhbmdlZCA9IHRydWU7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckX2FwcGx5U2VsZWN0ZWRJbmRleCh2YWx1ZSwgZm9yY2UpIHtcclxuXHRcdFx0dmFyIGN1cnJlbnRJbmRleCA9IHRoaXMuZ2V0X3NlbGVjdGVkSW5kZXgoKTtcclxuXHRcdFx0aWYgKGZvcmNlIHx8ICh2YWx1ZSAhPT0gY3VycmVudEluZGV4KSkge1xyXG5cdFx0XHRcdHZhciBkYXRhID0gdGhpcy5nZXRfdmlld0RhdGEoKTtcclxuXHRcdFx0XHRpZiAoIShkYXRhIGluc3RhbmNlb2YgQXJyYXkpKSB7XHJcblx0XHRcdFx0XHRkYXRhID0gW2RhdGFdO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHR2YXIgb3V0T2ZSYW5nZSA9ICh2YWx1ZSA8IC0xKSB8fCAodmFsdWUgPj0gZGF0YS5sZW5ndGgpO1xyXG5cdFx0XHRcdGlmIChvdXRPZlJhbmdlKSB7XHJcblx0XHRcdFx0XHR0aHJvdyBFcnJvci5hcmd1bWVudE91dE9mUmFuZ2UoXCJ2YWx1ZVwiLCB2YWx1ZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHRoaXMuX3NlbGVjdGVkSW5kZXggPSB2YWx1ZTtcclxuXHRcdFx0XHR0aGlzLl9jdXJyZW50RGF0YSA9ICgodmFsdWUgPT09IC0xKSB8fCBvdXRPZlJhbmdlKSA/IG51bGwgOiBkYXRhW3ZhbHVlXTtcclxuXHRcdFx0XHR2YXIgY2xhc3NOYW1lID0gdGhpcy5nZXRfc2VsZWN0ZWRJdGVtQ2xhc3MoKTtcclxuXHRcdFx0XHR0aGlzLl9hZGRSZW1vdmVDc3NDbGFzcyhjdXJyZW50SW5kZXgsIGNsYXNzTmFtZSwgU3lzLlVJLkRvbUVsZW1lbnQucmVtb3ZlQ3NzQ2xhc3MpO1xyXG5cdFx0XHRcdHRoaXMuX2FkZFJlbW92ZUNzc0NsYXNzKHZhbHVlLCBjbGFzc05hbWUsIFN5cy5VSS5Eb21FbGVtZW50LmFkZENzc0NsYXNzKTtcclxuXHRcdFx0XHRpZiAoIXRoaXMuZ2V0X2lzVXBkYXRpbmcoKSkge1xyXG5cdFx0XHRcdFx0aWYgKHZhbHVlICE9PSBjdXJyZW50SW5kZXgpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5yYWlzZVByb3BlcnR5Q2hhbmdlZCgnc2VsZWN0ZWRJbmRleCcpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHRoaXMuX2NoYW5nZWQgPSB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAoIXRoaXMuZ2V0X2lzVXBkYXRpbmcoKSkge1xyXG5cdFx0XHRcdHRoaXMuX3JhaXNlU2VsZWN0ZWREYXRhKCk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5fY2hhbmdlZCA9IHRydWU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRfYWRkUmVtb3ZlQ3NzQ2xhc3MoaW5kZXgsIGNsYXNzTmFtZSwgYWRkUmVtb3ZlKSB7XHJcblx0XHRcdGlmIChjbGFzc05hbWUgJiYgKGluZGV4ID4gLTEpKSB7XHJcblx0XHRcdFx0dmFyIGl0ZW1zID0gdGhpcy5nZXRfY29udGV4dHMoKSwgbCA9IGl0ZW1zID8gaXRlbXMubGVuZ3RoIDogLTE7XHJcblx0XHRcdFx0aWYgKGwgJiYgKGluZGV4IDwgbCkpIHtcclxuXHRcdFx0XHRcdHZhciBlbGVtZW50c1NldCA9IGl0ZW1zW2luZGV4XS5ub2RlcztcclxuXHRcdFx0XHRcdGlmIChlbGVtZW50c1NldCkge1xyXG5cdFx0XHRcdFx0XHRmb3IgKHZhciBpID0gMCwgbGVuID0gZWxlbWVudHNTZXQubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgZWxlbWVudCA9IGVsZW1lbnRzU2V0W2ldO1xyXG5cdFx0XHRcdFx0XHRcdGlmIChlbGVtZW50Lm5vZGVUeXBlID09PSAxKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRhZGRSZW1vdmUoZWxlbWVudCwgY2xhc3NOYW1lKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRnZXRfdXNlT3B0aW1hbFVwZGF0ZXMoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl91c2VPcHRpbWFsVXBkYXRlcztcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRzZXRfdXNlT3B0aW1hbFVwZGF0ZXModmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fdXNlT3B0aW1hbFVwZGF0ZXMgPSB2YWx1ZTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRfY29sbGVjdGlvbkNoYW5nZWQoc2VuZGVyLCBhcmdzKSB7XHJcblx0XHRcdHZhciBvbGRTZWxlY3RlZCA9IHRoaXMuX2N1cnJlbnREYXRhLFxyXG5cdFx0XHRjaGFuZ2VzID0gYXJncy5nZXRfY2hhbmdlcygpLFxyXG5cdFx0XHRzZWxlY3RlZEluZGV4ID0gdGhpcy5nZXRfc2VsZWN0ZWRJbmRleCgpLCBvbGRJbmRleCA9IHNlbGVjdGVkSW5kZXg7XHJcblx0XHRcdGlmICh0aGlzLl9pc0FjdGl2ZSgpKSB7XHJcblx0XHRcdFx0dGhpcy5fY2hhbmdpbmcgPSB0cnVlO1xyXG5cclxuXHRcdFx0XHQvLyBEZXRlcm1pbmUgaWYgdGhlIGNoYW5nZXMgY29udGFpbiBhbiBhZGQgZXZlbnQgdGhhdCBvY2N1cnMgYmVmb3JlIGEgcmVtb3ZlIGV2ZW50IHdoaWNoIHByZWNlZWRzIGl0IGluIHRoZSBhcnJheS5cclxuXHRcdFx0XHQvLyBpLmUuOiBhcnJheSA9IFswLCAxXSwgYWRkIDIgYXQgaW5kZXggMiwgdGhlbiByZW1vdmUgYXQgaW5kZXggMCwgcmVzdWx0aW5nIGluIFsxLCAyXVxyXG5cdFx0XHRcdHZhciBjb250YWluc0FkZEJlZm9yZVByZWNlZGluZ1JlbW92ZSA9IGNoYW5nZXMuc29tZShmdW5jdGlvbiAoZXZ0LCBpKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gZXZ0LmFjdGlvbiA9PT0gU3lzLk5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkQWN0aW9uLmFkZCAmJiBjaGFuZ2VzLnNvbWUoZnVuY3Rpb24gKG90aGVyLCBqKSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiBqID4gaSAmJiBvdGhlci5hY3Rpb24gPT09IFN5cy5Ob3RpZnlDb2xsZWN0aW9uQ2hhbmdlZEFjdGlvbi5yZW1vdmUgJiYgb3RoZXIub2xkU3RhcnRpbmdJbmRleCA8PSBldnQubmV3U3RhcnRpbmdJbmRleDtcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdH0pO1xyXG5cclxuXHRcdFx0XHQvLyBJZiBhbiBhZGQgZXZlbnQgb2NjdXJzIGJlZm9yZSBhIHJlbW92ZSB3aGljaCBwcmVjZWVkcyBpdCBpbiB0aGUgYXJyYXksIHRoZW4gZmFsbCBiYWNrIHRvIGEgbm9uLW9wdGltYWwgcmVmcmVzaC5cclxuXHRcdFx0XHRpZiAoY29udGFpbnNBZGRCZWZvcmVQcmVjZWRpbmdSZW1vdmUpIHtcclxuXHRcdFx0XHRcdHRoaXMucmVmcmVzaCgpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdC8vIERldGVybWluZSBpZiB0aGUgdGVtcGxhdGUgdXNlcyB0aGUgJGluZGV4IGFyZ3VtZW50IGJ5IGluc3BlY3RpbmcgdGhlIGNvbXBpbGVkIHRlbXBsYXRlIGNvZGUuXHJcblx0XHRcdFx0XHR2YXIgdGVtcGxhdGUgPSB0aGlzLl9lbnN1cmVUZW1wbGF0ZSh0aGlzLl9nZXRUZW1wbGF0ZSgpKTtcclxuXHRcdFx0XHRcdHRlbXBsYXRlLl9lbnN1cmVDb21waWxlZCgpO1xyXG5cdFx0XHRcdFx0dmFyIHRlbXBsYXRlVXNlc0RvbGxhckluZGV4ID0gL3dpdGhcXHMqXFwoLipcXCRpbmRleC8udGVzdCh0ZW1wbGF0ZS5faW5zdGFudGlhdGVJbi50b1N0cmluZygpLnJlcGxhY2UoLyhcXHJcXG58XFxufFxccikvZ20sIFwiXCIpKTtcclxuXHJcblx0XHRcdFx0XHR2YXIgdXNlT3B0aW1hbFVwZGF0ZXMgPSB0aGlzLmdldF91c2VPcHRpbWFsVXBkYXRlcygpICE9IG51bGwgPyB0aGlzLmdldF91c2VPcHRpbWFsVXBkYXRlcygpIDogU3lzLlVJLkRhdGFWaWV3LmNvbmZpZy51c2VPcHRpbWFsVXBkYXRlcztcclxuXHRcdFx0XHRcdGlmICh1c2VPcHRpbWFsVXBkYXRlcyAhPT0gdHJ1ZSB8fCB0ZW1wbGF0ZVVzZXNEb2xsYXJJbmRleCkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLnJlZnJlc2goKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHR2YXIgX3RoaXMgPSB0aGlzO1xyXG5cdFx0XHRcdFx0XHRmb3JlYWNoKGNoYW5nZXMsIGZ1bmN0aW9uIChldnQpIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgaSwgYXJyLCBzdGFydCwgbGVuO1xyXG5cdFx0XHRcdFx0XHRcdGlmIChldnQub2xkSXRlbXMgJiYgZXZ0Lm9sZEl0ZW1zLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHRcdFx0XHRcdGFyciA9IGV2dC5vbGRJdGVtcztcclxuXHRcdFx0XHRcdFx0XHRcdHN0YXJ0ID0gZXZ0Lm9sZFN0YXJ0aW5nSW5kZXg7XHJcblx0XHRcdFx0XHRcdFx0XHRsZW4gPSBhcnIubGVuZ3RoO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdF90aGlzLl9jbGVhckNvbnRhaW5lcnMoX3RoaXMuX3BsYWNlaG9sZGVycywgc3RhcnQsIGxlbik7XHJcblx0XHRcdFx0XHRcdFx0XHRfdGhpcy5fY29udGV4dHMuc3BsaWNlKHN0YXJ0LCBsZW4pO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRlbHNlIGlmIChldnQubmV3SXRlbXMgJiYgZXZ0Lm5ld0l0ZW1zLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHRcdFx0XHRcdGFyciA9IGV2dC5uZXdJdGVtcztcclxuXHRcdFx0XHRcdFx0XHRcdHN0YXJ0ID0gZXZ0Lm5ld1N0YXJ0aW5nSW5kZXg7XHJcblx0XHRcdFx0XHRcdFx0XHRsZW4gPSBhcnIubGVuZ3RoO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRfdGhpcy5fY29udGV4dHMuc3BsaWNlKHN0YXJ0ICsgaSwgMCwgbnVsbCk7XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRfdGhpcy5yZWZyZXNoKHN0YXJ0LCBsZW4pXHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5fZGlydHkgPSB0cnVlO1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cdFx0XHR2YXIgZGF0YSA9IHRoaXMuZ2V0X3ZpZXdEYXRhKCk7XHJcblx0XHRcdGlmICgoc2VsZWN0ZWRJbmRleCAhPT0gLTEpICYmIChzZWxlY3RlZEluZGV4IDwgZGF0YS5sZW5ndGgpICYmXHJcblx0XHRcdChkYXRhW3NlbGVjdGVkSW5kZXhdID09PSBvbGRTZWxlY3RlZCkpIHtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHRcdFx0Zm9yICh2YXIgaSA9IDAsIGwgPSBjaGFuZ2VzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG5cdFx0XHRcdHZhciBjaGFuZ2UgPSBjaGFuZ2VzW2ldO1xyXG5cdFx0XHRcdGlmIChjaGFuZ2UuYWN0aW9uID09PSBTeXMuTm90aWZ5Q29sbGVjdGlvbkNoYW5nZWRBY3Rpb24uYWRkKSB7XHJcblx0XHRcdFx0XHRpZiAoc2VsZWN0ZWRJbmRleCA+PSBjaGFuZ2UubmV3U3RhcnRpbmdJbmRleCkge1xyXG5cdFx0XHRcdFx0XHRzZWxlY3RlZEluZGV4ICs9IGNoYW5nZS5uZXdJdGVtcy5sZW5ndGg7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0dmFyIGluZGV4ID0gY2hhbmdlLm9sZFN0YXJ0aW5nSW5kZXgsIGxlbiA9IGNoYW5nZS5vbGRJdGVtcy5sZW5ndGgsIGxhc3RJbmRleCA9IGluZGV4ICsgbGVuIC0gMTtcclxuXHRcdFx0XHRcdGlmIChzZWxlY3RlZEluZGV4ID4gbGFzdEluZGV4KSB7XHJcblx0XHRcdFx0XHRcdHNlbGVjdGVkSW5kZXggLT0gbGVuO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAoc2VsZWN0ZWRJbmRleCA+PSBpbmRleCkge1xyXG5cdFx0XHRcdFx0XHRzZWxlY3RlZEluZGV4ID0gLTE7XHJcblx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAoc2VsZWN0ZWRJbmRleCAhPT0gb2xkSW5kZXgpIHtcclxuXHRcdFx0XHR0aGlzLnNldF9zZWxlY3RlZEluZGV4KHNlbGVjdGVkSW5kZXgpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckX2VsZW1lbnRDb250YWlucyhjb250YWluZXIsIGVsZW1lbnQsIGV4Y2x1ZGVTZWxmKSB7XHJcblx0XHRcdGlmIChjb250YWluZXIgPT09IGVsZW1lbnQpIHtcclxuXHRcdFx0XHRyZXR1cm4gIWV4Y2x1ZGVTZWxmO1xyXG5cdFx0XHR9XHJcblx0XHRcdGRvIHtcclxuXHRcdFx0XHRlbGVtZW50ID0gZWxlbWVudC5wYXJlbnROb2RlO1xyXG5cdFx0XHRcdGlmIChlbGVtZW50ID09PSBjb250YWluZXIpIHJldHVybiB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHRcdHdoaWxlIChlbGVtZW50KTtcclxuXHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JF9yYWlzZUNoYW5nZWQobmFtZSkge1xyXG5cdFx0XHRpZiAodGhpcy5faXNBY3RpdmUoKSkge1xyXG5cdFx0XHRcdHRoaXMucmFpc2VQcm9wZXJ0eUNoYW5nZWQobmFtZSk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5fY2hhbmdlZCA9IHRydWU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRfcmFpc2VGYWlsZWQocmVxdWVzdCwgZXJyb3IpIHtcclxuXHRcdFx0dmFyIGFyZ3MgPSBuZXcgU3lzLk5ldC5XZWJSZXF1ZXN0RXZlbnRBcmdzKHJlcXVlc3QgPyByZXF1ZXN0LmdldF9leGVjdXRvcigpIDogbnVsbCwgZXJyb3IpO1xyXG5cdFx0XHR0aGlzLm9uRmV0Y2hGYWlsZWQoYXJncyk7XHJcblx0XHRcdFN5cy5PYnNlcnZlci5yYWlzZUV2ZW50KHRoaXMsIFwiZmV0Y2hGYWlsZWRcIiwgYXJncyk7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckX3JhaXNlU2VsZWN0ZWREYXRhKCkge1xyXG5cdFx0XHRpZiAodGhpcy5fbGFzdERhdGEgIT09IHRoaXMuX2N1cnJlbnREYXRhKSB7XHJcblx0XHRcdFx0dGhpcy5fbGFzdERhdGEgPSB0aGlzLl9jdXJyZW50RGF0YTtcclxuXHRcdFx0XHR0aGlzLnJhaXNlUHJvcGVydHlDaGFuZ2VkKCdzZWxlY3RlZERhdGEnKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JF9yYWlzZVN1Y2NlZWRlZChyZXF1ZXN0LCByZXN1bHQpIHtcclxuXHRcdFx0dmFyIGFyZ3MgPSBuZXcgU3lzLk5ldC5XZWJSZXF1ZXN0RXZlbnRBcmdzKHJlcXVlc3QgPyByZXF1ZXN0LmdldF9leGVjdXRvcigpIDogbnVsbCwgbnVsbCwgcmVzdWx0KTtcclxuXHRcdFx0dGhpcy5vbkZldGNoU3VjY2VlZGVkKGFyZ3MpO1xyXG5cdFx0XHRTeXMuT2JzZXJ2ZXIucmFpc2VFdmVudCh0aGlzLCBcImZldGNoU3VjY2VlZGVkXCIsIGFyZ3MpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JF9lbnN1cmVUZW1wbGF0ZSh0ZW1wbGF0ZSkge1xyXG5cdFx0XHRpZiAoIVN5cy5VSS5UZW1wbGF0ZS5pc0luc3RhbmNlT2ZUeXBlKHRlbXBsYXRlKSkge1xyXG5cdFx0XHRcdHRlbXBsYXRlID0gU3lzLlVJLkRvbUVsZW1lbnQuX2Vuc3VyZUdldCh0ZW1wbGF0ZSwgdGhpcy5nZXRfdGVtcGxhdGVDb250ZXh0KCksIFwiaXRlbVRlbXBsYXRlXCIpO1xyXG5cdFx0XHRcdGlmICh0ZW1wbGF0ZSkge1xyXG5cdFx0XHRcdFx0dGVtcGxhdGUgPSBuZXcgU3lzLlVJLlRlbXBsYXRlKHRlbXBsYXRlKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHRlbXBsYXRlO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JF9zZXRUZW1wbGF0ZSh2YWx1ZSkge1xyXG5cdFx0XHRpZiAodGhpcy5fZHZUZW1wbGF0ZSkge1xyXG5cdFx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3lzLlVJLlRlbXBsYXRlc1Jlcy50ZW1wbGF0ZUFscmVhZHlEZWZpbmVkKTtcclxuXHRcdFx0fVxyXG5cdFx0XHR0aGlzLl9kdlRlbXBsYXRlID0gdmFsdWU7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckX2dldFRlbXBsYXRlKCkge1xyXG5cdFx0XHRpZiAodGhpcy5fZHZUZW1wbGF0ZSkgcmV0dXJuIHRoaXMuX2R2VGVtcGxhdGU7XHJcblx0XHRcdHZhciB0ZW1wbGF0ZSA9IHRoaXMuZ2V0X2l0ZW1UZW1wbGF0ZSgpO1xyXG5cdFx0XHRpZiAoIXRlbXBsYXRlKSB7XHJcblx0XHRcdFx0dmFyIGVsZW1lbnQgPSB0aGlzLmdldF9lbGVtZW50KCk7XHJcblx0XHRcdFx0aWYgKFN5cy5VSS5UZW1wbGF0ZS5faXNUZW1wbGF0ZShlbGVtZW50KSkge1xyXG5cdFx0XHRcdFx0dGhpcy5fZHZUZW1wbGF0ZSA9IHRlbXBsYXRlID0gbmV3IFN5cy5VSS5UZW1wbGF0ZShlbGVtZW50KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoIVN5cy5VSS5UZW1wbGF0ZS5pc0luc3RhbmNlT2ZUeXBlKHRlbXBsYXRlKSkge1xyXG5cdFx0XHRcdHRlbXBsYXRlID0gU3lzLlVJLkRvbUVsZW1lbnQuX2Vuc3VyZUdldCh0ZW1wbGF0ZSwgdGhpcy5nZXRfdGVtcGxhdGVDb250ZXh0KCksIFwiaXRlbVRlbXBsYXRlXCIpO1xyXG5cdFx0XHRcdHZhciBlID0gdGhpcy5nZXRfZWxlbWVudCgpO1xyXG5cdFx0XHRcdGlmICgoZSAhPT0gdGVtcGxhdGUpICYmIHRoaXMuX2VsZW1lbnRDb250YWlucyhlLCB0ZW1wbGF0ZSwgdHJ1ZSkpIHtcclxuXHRcdFx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3lzLlVJLlRlbXBsYXRlc1Jlcy5taXNwbGFjZWRUZW1wbGF0ZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHRoaXMuX2R2VGVtcGxhdGUgPSB0ZW1wbGF0ZSA9IG5ldyBTeXMuVUkuVGVtcGxhdGUodGVtcGxhdGUpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdGlmICh0aGlzLl9lbGVtZW50Q29udGFpbnModGhpcy5nZXRfZWxlbWVudCgpLCB0ZW1wbGF0ZS5nZXRfZWxlbWVudCgpLCB0cnVlKSkge1xyXG5cdFx0XHRcdFx0dGhyb3cgRXJyb3IuaW52YWxpZE9wZXJhdGlvbihTeXMuVUkuVGVtcGxhdGVzUmVzLm1pc3BsYWNlZFRlbXBsYXRlKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHRlbXBsYXRlO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JF9sb2FkRGF0YSh2YWx1ZSkge1xyXG5cdFx0XHR0aGlzLl9zd2FwRGF0YSh0aGlzLl9kYXRhLCB2YWx1ZSk7XHJcblx0XHRcdHRoaXMuX2RhdGEgPSB2YWx1ZTtcclxuXHRcdFx0dGhpcy5fc2V0RGF0YSA9IHRydWU7XHJcblx0XHRcdHRoaXMuX3N0YWxlID0gZmFsc2U7XHJcblx0XHRcdHRoaXMuX2RpcnR5ID0gdHJ1ZTtcclxuXHRcdFx0aWYgKHRoaXMuX2lzQWN0aXZlKCkpIHtcclxuXHRcdFx0XHRpZiAodGhpcy5nZXRfaXNMaW5rUGVuZGluZygpKSB7XHJcblx0XHRcdFx0XHR0aGlzLmxpbmsoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHR0aGlzLnJlZnJlc2goKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0dGhpcy5yYWlzZVByb3BlcnR5Q2hhbmdlZChcImRhdGFcIik7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5fY2hhbmdlZCA9IHRydWU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRfcmVzZXRTZWxlY3RlZEluZGV4KCkge1xyXG5cdFx0XHR2YXIgZGF0YSA9IHRoaXMuZ2V0X3ZpZXdEYXRhKCksIGluaXRpYWxTZWxlY3RlZEluZGV4ID0gdGhpcy5nZXRfaW5pdGlhbFNlbGVjdGVkSW5kZXgoKSxcclxuXHRcdFx0c2VsZWN0ZWRJbmRleCA9IHRoaXMuZ2V0X3NlbGVjdGVkSW5kZXgoKTtcclxuXHRcdFx0aWYgKCEoZGF0YSBpbnN0YW5jZW9mIEFycmF5KSB8fCAoaW5pdGlhbFNlbGVjdGVkSW5kZXggPj0gZGF0YS5sZW5ndGgpKSB7XHJcblx0XHRcdFx0aWYgKHNlbGVjdGVkSW5kZXggIT09IC0xKSB7XHJcblx0XHRcdFx0XHR0aGlzLnNldF9zZWxlY3RlZEluZGV4KC0xKTtcclxuXHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoc2VsZWN0ZWRJbmRleCAhPT0gaW5pdGlhbFNlbGVjdGVkSW5kZXgpIHtcclxuXHRcdFx0XHR0aGlzLnNldF9zZWxlY3RlZEluZGV4KGluaXRpYWxTZWxlY3RlZEluZGV4KTtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5fY3VycmVudERhdGEgPSB0aGlzLmdldF9zZWxlY3RlZERhdGEoKTtcclxuXHRcdFx0dGhpcy5fcmFpc2VTZWxlY3RlZERhdGEoKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRfaW5pdGlhbGl6ZVJlc3VsdHMoc3RhcnQsIGNvdW50KSB7XHJcblx0XHRcdGZvciAodmFyIGkgPSBzdGFydCB8fCAwLCBsZW4gPSBjb3VudCA/IChzdGFydCArIGNvdW50KSA6IHRoaXMuX2NvbnRleHRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcblx0XHRcdFx0dmFyIGN0eCA9IHRoaXMuX2NvbnRleHRzW2ldO1xyXG5cdFx0XHRcdGlmIChjdHgpIGN0eC5pbml0aWFsaXplQ29tcG9uZW50cygpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckX2lzQWN0aXZlKCkge1xyXG5cdFx0XHRyZXR1cm4gKHRoaXMuZ2V0X2lzSW5pdGlhbGl6ZWQoKSAmJiAhdGhpcy5nZXRfaXNVcGRhdGluZygpKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRfcmFpc2VDb21tYW5kKGFyZ3MpIHtcclxuXHRcdFx0dGhpcy5vbkNvbW1hbmQoYXJncyk7XHJcblx0XHRcdFN5cy5PYnNlcnZlci5yYWlzZUV2ZW50KHRoaXMsIFwiY29tbWFuZFwiLCBhcmdzKTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRfcmFpc2VJdGVtKHR5cGUsIGFyZ3MpIHtcclxuXHRcdFx0dGhpc1snb25JdGVtJyArIHR5cGVdKGFyZ3MpO1xyXG5cdFx0XHRTeXMuT2JzZXJ2ZXIucmFpc2VFdmVudCh0aGlzLCBcIml0ZW1cIiArIHR5cGUsIGFyZ3MpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JGFib3J0RmV0Y2goKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuRGF0YVZpZXcuYWJvcnRGZXRjaFwiIC8+XHJcblx0XHRcdGlmICh0aGlzLl9yZXF1ZXN0KSB7XHJcblx0XHRcdFx0dGhpcy5fcmVxdWVzdC5nZXRfZXhlY3V0b3IoKS5hYm9ydCgpO1xyXG5cdFx0XHRcdHRoaXMuX3JlcXVlc3QgPSBudWxsO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh0aGlzLl9mZXRjaGluZykge1xyXG5cdFx0XHRcdHRoaXMuX2ZldGNoaW5nID0gZmFsc2U7XHJcblx0XHRcdFx0dGhpcy5fcmFpc2VDaGFuZ2VkKFwiaXNGZXRjaGluZ1wiKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JG9uQnViYmxlRXZlbnQoc291cmNlLCBhcmdzKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuRGF0YVZpZXcub25CdWJibGVFdmVudFwiIC8+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cInNvdXJjZVwiPjwvcGFyYW0+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cImFyZ3NcIiB0eXBlPVwiU3lzLkV2ZW50QXJnc1wiPjwvcGFyYW0+XHJcblx0XHRcdC8vLyA8cmV0dXJucyB0eXBlPVwiQm9vbGVhblwiPjwvcmV0dXJucz5cclxuXHRcdFx0aWYgKFN5cy5Db21tYW5kRXZlbnRBcmdzLmlzSW5zdGFuY2VPZlR5cGUoYXJncykpIHtcclxuXHRcdFx0XHR0aGlzLl9yYWlzZUNvbW1hbmQoYXJncyk7XHJcblx0XHRcdFx0aWYgKGFyZ3MuZ2V0X2NhbmNlbCgpKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHR2YXIgbmFtZSA9IGFyZ3MuZ2V0X2NvbW1hbmROYW1lKCk7XHJcblx0XHRcdFx0XHRpZiAobmFtZSAmJiAobmFtZS50b0xvd2VyQ2FzZSgpID09PSBcInNlbGVjdFwiKSkge1xyXG5cdFx0XHRcdFx0XHR2YXIgaW5kZXggPSB0aGlzLl9maW5kQ29udGV4dEluZGV4KHNvdXJjZSk7XHJcblx0XHRcdFx0XHRcdGlmIChpbmRleCAhPT0gLTEpIHtcclxuXHRcdFx0XHRcdFx0XHR0aGlzLnNldF9zZWxlY3RlZEluZGV4KGluZGV4KTtcclxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckb25SZW5kZXJpbmcoYXJncykge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLkRhdGFWaWV3Lm9uUmVuZGVyaW5nXCIgLz5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwiYXJnc1wiIHR5cGU9XCJTeXMuRGF0YS5EYXRhRXZlbnRBcmdzXCI+PC9wYXJhbT5cclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRvbkZldGNoRmFpbGVkKGFyZ3MpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5EYXRhVmlldy5vbkZldGNoRmFpbGVkXCIgLz5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwiYXJnc1wiIHR5cGU9XCJTeXMuTmV0LldlYlJlcXVlc3RFdmVudEFyZ3NcIj48L3BhcmFtPlxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JG9uRmV0Y2hTdWNjZWVkZWQoYXJncykge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLkRhdGFWaWV3Lm9uRmV0Y2hTdWNjZWVkZWRcIiAvPlxyXG5cdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJhcmdzXCIgdHlwZT1cIlN5cy5OZXQuV2ViUmVxdWVzdEV2ZW50QXJnc1wiPjwvcGFyYW0+XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckX2RvQXV0b0ZldGNoKCkge1xyXG5cdFx0XHR2YXIgZTtcclxuXHRcdFx0dHJ5IHtcclxuXHRcdFx0XHRpZiAodGhpcy5fZGF0YVByb3ZpZGVyIHx8IHRoaXMuX3Byb3ZpZGVyKSB7XHJcblx0XHRcdFx0XHR0aGlzLmZldGNoRGF0YSgpO1xyXG5cdFx0XHRcdFx0dGhpcy5fc3RhbGUgPSBmYWxzZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0Y2F0Y2ggKGUpIHtcclxuXHRcdFx0XHR0aGlzLl9yYWlzZUZhaWxlZChudWxsLCBudWxsKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JF9maW5kQ29udGV4dEluZGV4KHNvdXJjZSkge1xyXG5cdFx0XHR2YXIgY29udGFpbmVycyA9IHRoaXMuX2NvbnRhaW5lcnM7XHJcblx0XHRcdGlmIChzb3VyY2UgJiYgY29udGFpbmVycykge1xyXG5cdFx0XHRcdHZhciByZXN1bHRzID0gdGhpcy5nZXRfY29udGV4dHMoKTtcclxuXHRcdFx0XHRpZiAocmVzdWx0cykge1xyXG5cdFx0XHRcdFx0dmFyIGVsZW1lbnQgPSBTeXMuVUkuRG9tRWxlbWVudC5fZW5zdXJlR2V0KHNvdXJjZSwgdGhpcy5nZXRfdGVtcGxhdGVDb250ZXh0KCksIFwic291cmNlXCIpO1xyXG5cdFx0XHRcdFx0aWYgKGVsZW1lbnQpIHtcclxuXHRcdFx0XHRcdFx0dmFyIHBhcmVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSwgZHZFbGVtZW50ID0gdGhpcy5nZXRfZWxlbWVudCgpLCBjaW5kZXggPSAtMTtcclxuXHRcdFx0XHRcdFx0d2hpbGUgKHBhcmVudCAmJiAoKGNpbmRleCA9IFN5cy5faW5kZXhPZihjb250YWluZXJzLCBwYXJlbnQpKSA8IDApICYmIChwYXJlbnQgIT09IGR2RWxlbWVudCkpIHtcclxuXHRcdFx0XHRcdFx0XHRlbGVtZW50ID0gcGFyZW50O1xyXG5cdFx0XHRcdFx0XHRcdHBhcmVudCA9IHBhcmVudC5wYXJlbnROb2RlO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGlmIChjaW5kZXggPiAtMSkge1xyXG5cdFx0XHRcdFx0XHRcdHZhciBjb250YWluZXIgPSBjb250YWluZXJzW2NpbmRleF07XHJcblx0XHRcdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDAsIGwgPSByZXN1bHRzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG5cdFx0XHRcdFx0XHRcdFx0dmFyIHJlc3VsdCA9IHJlc3VsdHNbaV07XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoKHJlc3VsdC5jb250YWluZXJFbGVtZW50ID09PSBjb250YWluZXIpICYmIChTeXMuX2luZGV4T2YocmVzdWx0Lm5vZGVzLCBlbGVtZW50KSA+IC0xKSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gaTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIC0xO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JGZpbmRDb250ZXh0KHNvdXJjZSkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLkRhdGFWaWV3LmZpbmRDb250ZXh0XCIgLz5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwic291cmNlXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJTeXMuVUkuVGVtcGxhdGVDb250ZXh0XCIgbWF5QmVOdWxsPVwidHJ1ZVwiPjwvcmV0dXJucz5cclxuXHRcdFx0dmFyIGluZGV4ID0gdGhpcy5fZmluZENvbnRleHRJbmRleChzb3VyY2UpO1xyXG5cdFx0XHRyZXR1cm4gKGluZGV4ICE9PSAtMSkgPyB0aGlzLmdldF9jb250ZXh0cygpW2luZGV4XSA6IG51bGw7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckX2NsZWFyQ29udGFpbmVyKGNvbnRhaW5lciwgcGxhY2Vob2xkZXIsIHN0YXJ0Tm9kZSwgZW5kTm9kZSkge1xyXG5cdFx0XHR2YXIgY291bnQgPSBwbGFjZWhvbGRlciA/IHBsYWNlaG9sZGVyLl9fbXNhamF4cGhjb3VudCA6IC0xO1xyXG5cdFx0XHRpZiAoKGNvdW50ID4gLTEpICYmIHBsYWNlaG9sZGVyKSBwbGFjZWhvbGRlci5fX21zYWpheHBoY291bnQgPSAwO1xyXG5cdFx0XHRpZiAoY291bnQgPCAwKSB7XHJcblx0XHRcdFx0aWYgKHBsYWNlaG9sZGVyKSB7XHJcblx0XHRcdFx0XHRjb250YWluZXIucmVtb3ZlQ2hpbGQocGxhY2Vob2xkZXIpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAoIXN0YXJ0Tm9kZSkge1xyXG5cdFx0XHRcdFx0U3lzLkFwcGxpY2F0aW9uLmRpc3Bvc2VFbGVtZW50KGNvbnRhaW5lciwgdHJ1ZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHZhciBjbGVhcmVkID0gZmFsc2U7XHJcblx0XHRcdFx0aWYgKCFzdGFydE5vZGUpIHtcclxuXHRcdFx0XHRcdHRyeSB7XHJcblx0XHRcdFx0XHRcdGNvbnRhaW5lci5pbm5lckhUTUwgPSBcIlwiO1xyXG5cdFx0XHRcdFx0XHRjbGVhcmVkID0gdHJ1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGNhdGNoIChlcnIpIHsgfVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAoIWNsZWFyZWQpIHtcclxuXHRcdFx0XHRcdHZhciBjaGlsZCA9IHN0YXJ0Tm9kZSB8fCBjb250YWluZXIuZmlyc3RDaGlsZCwgbmV4dENoaWxkO1xyXG5cdFx0XHRcdFx0d2hpbGUgKGNoaWxkKSB7XHJcblx0XHRcdFx0XHRcdG5leHRDaGlsZCA9IGNoaWxkID09PSBlbmROb2RlID8gbnVsbCA6IGNoaWxkLm5leHRTaWJsaW5nO1xyXG5cdFx0XHRcdFx0XHRTeXMuQXBwbGljYXRpb24uZGlzcG9zZUVsZW1lbnQoY2hpbGQsIGZhbHNlKTtcclxuXHRcdFx0XHRcdFx0Y29udGFpbmVyLnJlbW92ZUNoaWxkKGNoaWxkKTtcclxuXHRcdFx0XHRcdFx0Y2hpbGQgPSBuZXh0Q2hpbGQ7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGlmIChwbGFjZWhvbGRlcikge1xyXG5cdFx0XHRcdFx0Y29udGFpbmVyLmFwcGVuZENoaWxkKHBsYWNlaG9sZGVyKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoY291bnQgPiAwKSB7XHJcblx0XHRcdFx0dmFyIGksIGwsIHN0YXJ0LCBjaGlsZHJlbiA9IGNvbnRhaW5lci5jaGlsZE5vZGVzO1xyXG5cdFx0XHRcdGZvciAoaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuXHRcdFx0XHRcdGlmIChjaGlsZHJlbltpXSA9PT0gcGxhY2Vob2xkZXIpIHtcclxuXHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHN0YXJ0ID0gaSAtIGNvdW50O1xyXG5cdFx0XHRcdGZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XHJcblx0XHRcdFx0XHR2YXIgZWxlbWVudCA9IGNoaWxkcmVuW3N0YXJ0XTtcclxuXHRcdFx0XHRcdFN5cy5BcHBsaWNhdGlvbi5kaXNwb3NlRWxlbWVudChlbGVtZW50LCBmYWxzZSk7XHJcblx0XHRcdFx0XHRjb250YWluZXIucmVtb3ZlQ2hpbGQoZWxlbWVudCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckX2NsZWFyQ29udGFpbmVycyhwbGFjZWhvbGRlcnMsIHN0YXJ0LCBjb3VudCkge1xyXG5cdFx0XHR2YXIgaSwgbGVuO1xyXG5cdFx0XHRmb3IgKGkgPSAwLCBsZW4gPSBwbGFjZWhvbGRlcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0XHR2YXIgcGggPSBwbGFjZWhvbGRlcnNbaV0sXHJcblx0XHRcdFx0Y29udGFpbmVyID0gcGggPyBwaC5wYXJlbnROb2RlIDogdGhpcy5nZXRfZWxlbWVudCgpO1xyXG5cdFx0XHRcdHRoaXMuX2NsZWFyQ29udGFpbmVyKGNvbnRhaW5lciwgcGgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGZvciAoaSA9IHN0YXJ0IHx8IDAsIGxlbiA9IGNvdW50ID8gKHN0YXJ0ICsgY291bnQpIDogdGhpcy5fY29udGV4dHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0XHR2YXIgY3R4ID0gdGhpcy5fY29udGV4dHNbaV07XHJcblx0XHRcdFx0Y3R4Lm5vZGVzID0gbnVsbDtcclxuXHRcdFx0XHRjdHguZGlzcG9zZSgpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckX2lzQWxvbmUoY29udGFpbmVyLCBwaCkge1xyXG5cdFx0XHR2YXIgY2hpbGROb2RlcyA9IGNvbnRhaW5lci5jaGlsZE5vZGVzO1xyXG5cdFx0XHRpZiAoY2hpbGROb2Rlcy5sZW5ndGggPT09IDEpIHJldHVybiB0cnVlO1xyXG5cdFx0XHR2YXIgbm9kZSA9IGNvbnRhaW5lci5maXJzdENoaWxkLCBub3RXaGl0ZXNwYWNlID0gL1xcUy87XHJcblx0XHRcdHdoaWxlIChub2RlKSB7XHJcblx0XHRcdFx0aWYgKG5vZGUgIT09IHBoKSB7XHJcblx0XHRcdFx0XHR2YXIgdHlwZSA9IG5vZGUubm9kZVR5cGU7XHJcblx0XHRcdFx0XHRpZiAodHlwZSA9PT0gMykge1xyXG5cdFx0XHRcdFx0XHRpZiAobm90V2hpdGVzcGFjZS50ZXN0KG5vZGUubm9kZVZhbHVlKSkgcmV0dXJuIGZhbHNlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAodHlwZSAhPT0gOCkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdG5vZGUgPSBub2RlLm5leHRTaWJsaW5nO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JF9nZW5lcmF0ZXNDb250ZXh0KCkge1xyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRyZWZyZXNoKHN0YXJ0LCBjb3VudCkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojU3lzLlVJLkRhdGFWaWV3LnJlZnJlc2hcIiAvPlxyXG5cdFx0XHRpZiAoIXRoaXMuX3NldERhdGEpIHJldHVybjtcclxuXHRcdFx0dmFyIGNvbGxlY3Rpb25DaGFuZ2UgPSB0aGlzLl9jaGFuZ2luZztcclxuXHRcdFx0dGhpcy5fY2hhbmdpbmcgPSBmYWxzZTtcclxuXHRcdFx0dmFyIGRhdGEgPSB0aGlzLmdldF9kYXRhKCksXHJcblx0XHRcdFx0cGN0eCA9IHRoaXMuZ2V0X3RlbXBsYXRlQ29udGV4dCgpLFxyXG5cdFx0XHRcdHJlbmRlckFyZ3MgPSBuZXcgU3lzLkRhdGEuRGF0YUV2ZW50QXJncyhkYXRhKTtcclxuXHRcdFx0cmVuZGVyQXJncy5faXRlbVRlbXBsYXRlID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcclxuXHRcdFx0cmVuZGVyQXJncy5fcGxhY2Vob2xkZXIgPSBTeXMuVUkuRG9tRWxlbWVudC5fZW5zdXJlR2V0KHRoaXMuZ2V0X2l0ZW1QbGFjZWhvbGRlcigpLCBwY3R4LCBcIml0ZW1QbGFjZWhvbGRlclwiKTtcclxuXHRcdFx0dGhpcy5vblJlbmRlcmluZyhyZW5kZXJBcmdzKTtcclxuXHRcdFx0U3lzLk9ic2VydmVyLnJhaXNlRXZlbnQodGhpcywgXCJyZW5kZXJpbmdcIiwgcmVuZGVyQXJncyk7XHJcblx0XHRcdGlmIChyZW5kZXJBcmdzLmdldF9jYW5jZWwoKSkgcmV0dXJuO1xyXG5cdFx0XHRkYXRhID0gcmVuZGVyQXJncy5nZXRfZGF0YSgpO1xyXG5cdFx0XHR0aGlzLl92aWV3RGF0YSA9IGRhdGE7XHJcblxyXG5cdFx0XHR2YXIgdGVtcGxhdGUgPSB0aGlzLl9lbnN1cmVUZW1wbGF0ZShyZW5kZXJBcmdzLl9pdGVtVGVtcGxhdGUpO1xyXG5cdFx0XHR0aGlzLl9kaXJ0eSA9IGZhbHNlO1xyXG5cdFx0XHR2YXIgcGggPSBTeXMuVUkuRG9tRWxlbWVudC5fZW5zdXJlR2V0KHJlbmRlckFyZ3MuX3BsYWNlaG9sZGVyLCBwY3R4LCBcIml0ZW1QbGFjZWhvbGRlclwiKSxcclxuXHRcdFx0XHRlbGVtZW50ID0gdGhpcy5nZXRfZWxlbWVudCgpLFxyXG5cdFx0XHRcdHJlc3VsdCwgaXRlbVRlbXBsYXRlLCBhcmdzLFxyXG5cdFx0XHRcdGNvbnRlbnRUZW1wbGF0ZSA9IHRoaXMuX2NvbnRlbnRUZW1wbGF0ZTtcclxuXHRcdFx0aWYgKHRoaXMuX3BsYWNlaG9sZGVycyAmJiBhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XHJcblx0XHRcdFx0dGhpcy5fY2xlYXJDb250YWluZXJzKHRoaXMuX3BsYWNlaG9sZGVycyk7XHJcblx0XHRcdH1cclxuXHRcdFx0dmFyIGxpc3QgPSBkYXRhO1xyXG5cdFx0XHR2YXIgbGVuLCBpO1xyXG5cdFx0XHRpZiAoKGRhdGEgPT09IG51bGwpIHx8ICh0eXBlb2YgKGRhdGEpID09PSBcInVuZGVmaW5lZFwiKSkge1xyXG5cdFx0XHRcdGkgPSAwO1xyXG5cdFx0XHRcdGxlbiA9IDA7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoIShkYXRhIGluc3RhbmNlb2YgQXJyYXkpKSB7XHJcblx0XHRcdFx0bGlzdCA9IFtkYXRhXTtcclxuXHRcdFx0XHRpID0gMDtcclxuXHRcdFx0XHRsZW4gPSAxO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdGkgPSBzdGFydCB8fCAwO1xyXG5cdFx0XHRcdGxlbiA9IGNvdW50ID8gKHN0YXJ0ICsgY291bnQpIDogZGF0YS5sZW5ndGg7XHJcblx0XHRcdH1cclxuXHRcdFx0ZnVuY3Rpb24gY2xlYXJBbmRTaG93KCkge1xyXG5cdFx0XHRcdGlmICghdGhpcy5fY2xlYXJlZCkge1xyXG5cdFx0XHRcdFx0aWYgKFN5cy5VSS5UZW1wbGF0ZS5faXNUZW1wbGF0ZShlbGVtZW50KSkge1xyXG5cdFx0XHRcdFx0XHR2YXIgc2VsZlRlbXBsYXRlID0gbmV3IFN5cy5VSS5UZW1wbGF0ZShlbGVtZW50KTtcclxuXHRcdFx0XHRcdFx0c2VsZlRlbXBsYXRlLl9lbnN1cmVDb21waWxlZCgpO1xyXG5cdFx0XHRcdFx0XHRzZWxmVGVtcGxhdGUuZGlzcG9zZSgpO1xyXG5cdFx0XHRcdFx0XHRTeXMuVUkuRG9tRWxlbWVudC5yZW1vdmVDc3NDbGFzcyhlbGVtZW50LCBcInN5cy10ZW1wbGF0ZVwiKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHRoaXMuX2NsZWFyQ29udGFpbmVyKGVsZW1lbnQsIG51bGwpO1xyXG5cdFx0XHRcdFx0ZWxlbWVudC5fX21zYWpheHBoY291bnQgPSAtMTtcclxuXHRcdFx0XHRcdHRoaXMuX2NsZWFyZWQgPSB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAoIWxlbiAmJiB0ZW1wbGF0ZSAmJiB0ZW1wbGF0ZS5nZXRfZWxlbWVudCgpID09PSBlbGVtZW50KSB7XHJcblx0XHRcdFx0Y2xlYXJBbmRTaG93LmNhbGwodGhpcyk7XHJcblx0XHRcdH1cclxuXHRcdFx0dmFyIGN1cnJlbnRQaCwgbGFzdFBoLCBwbGFjZWhvbGRlcnMsIGNvbnRhaW5lciwgY29udGFpbmVycywgb3B0aW9uc0NoYW5nZWQsIGluc2VydEJlZm9yZTtcclxuXHRcdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcclxuXHRcdFx0XHR0aGlzLl9wbGFjZWhvbGRlcnMgPSBwbGFjZWhvbGRlcnMgPSBbXTtcclxuXHRcdFx0XHR0aGlzLl9jb250YWluZXJzID0gY29udGFpbmVycyA9IFtdO1xyXG5cdFx0XHRcdHRoaXMuX2NvbnRleHRzID0gbmV3IEFycmF5KGxlbik7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0cGxhY2Vob2xkZXJzID0gdGhpcy5fcGxhY2Vob2xkZXJzO1xyXG5cdFx0XHRcdGNvbnRhaW5lcnMgPSB0aGlzLl9jb250YWluZXJzO1xyXG5cdFx0XHRcdHZhciBuZXh0Q29udGV4dCA9IHRoaXMuX2NvbnRleHRzW3N0YXJ0ICsgY291bnRdO1xyXG5cdFx0XHRcdGlmIChuZXh0Q29udGV4dCAmJiBuZXh0Q29udGV4dC5ub2Rlcykge1xyXG5cdFx0XHRcdFx0aW5zZXJ0QmVmb3JlID0gbmV4dENvbnRleHQubm9kZXNbMF07XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGZvciAoOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0XHR2YXIgaXRlbSA9IGxpc3RbaV07XHJcblx0XHRcdFx0YXJncyA9IG5ldyBTeXMuVUkuRGF0YVZpZXdJdGVtRXZlbnRBcmdzKGl0ZW0pO1xyXG5cdFx0XHRcdGFyZ3MuX2l0ZW1UZW1wbGF0ZSA9IHRlbXBsYXRlO1xyXG5cdFx0XHRcdGFyZ3MuX3BsYWNlaG9sZGVyID0gcGg7XHJcblx0XHRcdFx0dGhpcy5fcmFpc2VJdGVtKFwiUmVuZGVyaW5nXCIsIGFyZ3MpO1xyXG5cdFx0XHRcdGl0ZW1UZW1wbGF0ZSA9IHRoaXMuX2Vuc3VyZVRlbXBsYXRlKGFyZ3MuX2l0ZW1UZW1wbGF0ZSk7XHJcblx0XHRcdFx0Y3VycmVudFBoID0gU3lzLlVJLkRvbUVsZW1lbnQuX2Vuc3VyZUdldChhcmdzLl9wbGFjZWhvbGRlciwgcGN0eCwgXCJpdGVtUGxhY2Vob2xkZXJcIik7XHJcblx0XHRcdFx0Y3VycmVudFBoID0gY3VycmVudFBoID8gKGN1cnJlbnRQaC5fX21zYWpheHBob3B0aW9uIHx8IGN1cnJlbnRQaCkgOiBudWxsO1xyXG5cdFx0XHRcdGlmIChjdXJyZW50UGggIT09IGxhc3RQaCkge1xyXG5cdFx0XHRcdFx0Y29udGFpbmVyID0gY3VycmVudFBoID8gY3VycmVudFBoLnBhcmVudE5vZGUgOiBlbGVtZW50O1xyXG5cdFx0XHRcdFx0aWYgKFN5cy5faW5kZXhPZihwbGFjZWhvbGRlcnMsIGN1cnJlbnRQaCkgPCAwKSB7XHJcblx0XHRcdFx0XHRcdGlmIChjdXJyZW50UGgpIHtcclxuXHRcdFx0XHRcdFx0XHRpZiAoL15vcHRpb24kL2kudGVzdChjdXJyZW50UGgudGFnTmFtZSkgJiYgL3NlbGVjdC9pLnRlc3QoY29udGFpbmVyLnRhZ05hbWUpKSB7XHJcblx0XHRcdFx0XHRcdFx0XHR2YXIgbmV3UGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdfaGlkZGVuUGxhY2Vob2xkZXInKTtcclxuXHRcdFx0XHRcdFx0XHRcdGNvbnRhaW5lci5yZXBsYWNlQ2hpbGQobmV3UGgsIGN1cnJlbnRQaCk7XHJcblx0XHRcdFx0XHRcdFx0XHRjdXJyZW50UGguX19tc2FqYXhwaG9wdGlvbiA9IG5ld1BoO1xyXG5cdFx0XHRcdFx0XHRcdFx0bmV3UGguYXBwZW5kQ2hpbGQoY3VycmVudFBoKTtcclxuXHRcdFx0XHRcdFx0XHRcdGN1cnJlbnRQaCA9IG5ld1BoO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRjdXJyZW50UGguc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuXHRcdFx0XHRcdFx0XHR2YXIgcGhjb3VudCA9IGN1cnJlbnRQaC5fX21zYWpheHBoY291bnQ7XHJcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZiAocGhjb3VudCkgPT09IFwidW5kZWZpbmVkXCIgJiYgdGhpcy5faXNBbG9uZShjb250YWluZXIsIGN1cnJlbnRQaCkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGN1cnJlbnRQaC5fX21zYWpheHBoY291bnQgPSAtMTtcclxuXHRcdFx0XHRcdFx0XHRcdHRoaXMuX2NsZWFyQ29udGFpbmVyKGNvbnRhaW5lciwgY3VycmVudFBoKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0Y2xlYXJBbmRTaG93LmNhbGwodGhpcyk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0cGxhY2Vob2xkZXJzLnB1c2goY3VycmVudFBoKTtcclxuXHRcdFx0XHRcdFx0aWYgKFN5cy5faW5kZXhPZihjb250YWluZXJzLCBjb250YWluZXIpIDwgMCkge1xyXG5cdFx0XHRcdFx0XHRcdGNvbnRhaW5lcnMucHVzaChjb250YWluZXIpO1xyXG5cdFx0XHRcdFx0XHRcdGlmICgvXnNlbGVjdCQvaS50ZXN0KGNvbnRhaW5lci50YWdOYW1lKSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0b3B0aW9uc0NoYW5nZWQgPSBvcHRpb25zQ2hhbmdlZCB8fCBbXTtcclxuXHRcdFx0XHRcdFx0XHRcdG9wdGlvbnNDaGFuZ2VkLnB1c2goY29udGFpbmVyKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0bGFzdFBoID0gY3VycmVudFBoO1xyXG5cdFx0XHRcdGlmIChpdGVtVGVtcGxhdGUpIHtcclxuXHRcdFx0XHRcdHJlc3VsdCA9IGl0ZW1UZW1wbGF0ZS5pbnN0YW50aWF0ZUluKGNvbnRhaW5lciwgZGF0YSwgaXRlbSwgaSwgY3VycmVudFBoIHx8IGluc2VydEJlZm9yZSwgcGN0eCwgY29udGVudFRlbXBsYXRlKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRyZXN1bHQgPSBtZXJnZShuZXcgU3lzLlVJLlRlbXBsYXRlQ29udGV4dCgpLCB7XHJcblx0XHRcdFx0XHRcdG5vZGVzOiBbXSxcclxuXHRcdFx0XHRcdFx0ZGF0YUl0ZW06IGl0ZW0sXHJcblx0XHRcdFx0XHRcdGRhdGE6IGRhdGEsXHJcblx0XHRcdFx0XHRcdGluZGV4OiBpLFxyXG5cdFx0XHRcdFx0XHRwYXJlbnRDb250ZXh0OiBwY3R4XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0YXJncy5fY3R4ID0gcmVzdWx0O1xyXG5cdFx0XHRcdHRoaXMuX2NvbnRleHRzW2ldID0gcmVzdWx0O1xyXG5cdFx0XHRcdHRoaXMuX3JhaXNlSXRlbShcIlJlbmRlcmVkXCIsIHJlc3VsdCk7XHJcblx0XHRcdFx0aWYgKGl0ZW1UZW1wbGF0ZSAmJiBjdXJyZW50UGgpIHtcclxuXHRcdFx0XHRcdHZhciBjb3VudCA9IGN1cnJlbnRQaC5fX21zYWpheHBoY291bnQgfHwgMDtcclxuXHRcdFx0XHRcdGlmIChjb3VudCA+IC0xKSB7XHJcblx0XHRcdFx0XHRcdGN1cnJlbnRQaC5fX21zYWpheHBoY291bnQgPSBjb3VudCArIHJlc3VsdC5ub2Rlcy5sZW5ndGg7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChvcHRpb25zQ2hhbmdlZCkge1xyXG5cdFx0XHRcdGZvciAoaSA9IDA7IGkgPCBvcHRpb25zQ2hhbmdlZC5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdFx0U3lzLk9ic2VydmVyLnJhaXNlRXZlbnQob3B0aW9uc0NoYW5nZWRbaV0sIFwib3B0aW9uc0NoYW5nZWRcIiwgU3lzLkV2ZW50QXJncy5FbXB0eSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoIWNvbGxlY3Rpb25DaGFuZ2UpIHtcclxuXHRcdFx0XHRpZiAoIXRoaXMuX3JlbmRlcmVkICYmIHRoaXMuZ2V0X3NlbGVjdGVkSW5kZXgoKSA+IC0xKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9hcHBseVNlbGVjdGVkSW5kZXgodGhpcy5nZXRfc2VsZWN0ZWRJbmRleCgpLCB0cnVlKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHR0aGlzLl9yZXNldFNlbGVjdGVkSW5kZXgoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5fcmVuZGVyZWQgPSB0cnVlO1xyXG5cclxuXHRcdFx0dmFyIHNlbGVjdGVkQ2xhc3MgPSB0aGlzLmdldF9zZWxlY3RlZEl0ZW1DbGFzcygpO1xyXG5cdFx0XHRpZiAoc2VsZWN0ZWRDbGFzcykge1xyXG5cdFx0XHRcdHZhciBzZWxlY3RlZEluZGV4ID0gdGhpcy5nZXRfc2VsZWN0ZWRJbmRleCgpO1xyXG5cdFx0XHRcdGlmIChzZWxlY3RlZEluZGV4ICE9PSAtMSkge1xyXG5cdFx0XHRcdFx0dGhpcy5fYWRkUmVtb3ZlQ3NzQ2xhc3Moc2VsZWN0ZWRJbmRleCwgc2VsZWN0ZWRDbGFzcywgU3lzLlVJLkRvbUVsZW1lbnQuYWRkQ3NzQ2xhc3MpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHR0aGlzLnJhaXNlUHJvcGVydHlDaGFuZ2VkKFwidmlld0RhdGFcIik7XHJcblx0XHRcdFN5cy5PYnNlcnZlci5yYWlzZUV2ZW50KHRoaXMsIFwicmVuZGVyZWRcIiwgcmVuZGVyQXJncyk7XHJcblx0XHRcdHRoaXMuX2luaXRpYWxpemVSZXN1bHRzKHN0YXJ0LCBjb3VudCk7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckX3N3YXBEYXRhKG9sZERhdGEsIG5ld0RhdGEpIHtcclxuXHRcdFx0aWYgKG9sZERhdGEpIHtcclxuXHRcdFx0XHRzd2l0Y2ggKHRoaXMuX2V2ZW50VHlwZSkge1xyXG5cdFx0XHRcdFx0Y2FzZSAxOlxyXG5cdFx0XHRcdFx0XHRvbGREYXRhLnJlbW92ZV9jb2xsZWN0aW9uQ2hhbmdlZCh0aGlzLl9jaGFuZ2VkSGFuZGxlcik7XHJcblx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0Y2FzZSAyOlxyXG5cdFx0XHRcdFx0XHRTeXMuT2JzZXJ2ZXIucmVtb3ZlQ29sbGVjdGlvbkNoYW5nZWQob2xkRGF0YSwgdGhpcy5fY2hhbmdlZEhhbmRsZXIpO1xyXG5cdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5fZXZlbnRUeXBlID0gMDtcclxuXHRcdFx0aWYgKG5ld0RhdGEpIHtcclxuXHRcdFx0XHRpZiAoIXRoaXMuX2NoYW5nZWRIYW5kbGVyKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9jaGFuZ2VkSGFuZGxlciA9IEZ1bmN0aW9uLmNyZWF0ZURlbGVnYXRlKHRoaXMsIHRoaXMuX2NvbGxlY3Rpb25DaGFuZ2VkKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKHR5cGVvZiAobmV3RGF0YS5hZGRfY29sbGVjdGlvbkNoYW5nZWQpID09PSBcImZ1bmN0aW9uXCIpIHtcclxuXHRcdFx0XHRcdG5ld0RhdGEuYWRkX2NvbGxlY3Rpb25DaGFuZ2VkKHRoaXMuX2NoYW5nZWRIYW5kbGVyKTtcclxuXHRcdFx0XHRcdHRoaXMuX2V2ZW50VHlwZSA9IDE7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2UgaWYgKG5ld0RhdGEgaW5zdGFuY2VvZiBBcnJheSkge1xyXG5cdFx0XHRcdFx0U3lzLk9ic2VydmVyLmFkZENvbGxlY3Rpb25DaGFuZ2VkKG5ld0RhdGEsIHRoaXMuX2NoYW5nZWRIYW5kbGVyKTtcclxuXHRcdFx0XHRcdHRoaXMuX2V2ZW50VHlwZSA9IDI7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckX3ZhbGlkYXRlSW5kZXhJbnB1dCh2YWx1ZSkge1xyXG5cdFx0XHR2YXIgdHlwZSA9IHR5cGVvZiAodmFsdWUpO1xyXG5cdFx0XHRpZiAodHlwZSA9PT0gXCJzdHJpbmdcIikge1xyXG5cdFx0XHRcdHZhbHVlID0gcGFyc2VJbnQodmFsdWUpO1xyXG5cdFx0XHRcdGlmIChpc05hTih2YWx1ZSkpIHtcclxuXHRcdFx0XHRcdHRocm93IEVycm9yLmFyZ3VtZW50KFN5cy5VSS5UZW1wbGF0ZXNSZXMuaW52YWxpZFNlbGVjdGVkSW5kZXhWYWx1ZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKHR5cGUgIT09IFwibnVtYmVyXCIpIHtcclxuXHRcdFx0XHR0aHJvdyBFcnJvci5hcmd1bWVudChTeXMuVUkuVGVtcGxhdGVzUmVzLmludmFsaWRTZWxlY3RlZEluZGV4VmFsdWUpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiB2YWx1ZTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlldyRkaXNwb3NlKCkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojZGlzcG9zZVwiIC8+XHJcblx0XHRcdGlmICh0aGlzLl9wbGFjZWhvbGRlcnMgJiYgIVN5cy5BcHBsaWNhdGlvbi5nZXRfaXNEaXNwb3NpbmcoKSkge1xyXG5cdFx0XHRcdHRoaXMuX2NsZWFyQ29udGFpbmVycyh0aGlzLl9wbGFjZWhvbGRlcnMpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh0aGlzLl9kdlRlbXBsYXRlKSB7XHJcblx0XHRcdFx0dGhpcy5fZHZUZW1wbGF0ZS5kaXNwb3NlKCk7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHRoaXMuZ2V0X2lzRmV0Y2hpbmcoKSkge1xyXG5cdFx0XHRcdHRoaXMuYWJvcnRGZXRjaCgpO1xyXG5cdFx0XHRcdHRoaXMuX2ZldGNoaW5nID0gZmFsc2U7XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5fc3dhcERhdGEodGhpcy5fZGF0YSwgbnVsbCk7XHJcblx0XHRcdHRoaXMuX2N1cnJlbnREYXRhID0gdGhpcy5fbGFzdERhdGEgPSB0aGlzLl9wbGFjZWhvbGRlcnMgPSB0aGlzLl9jb250YWluZXJzID0gdGhpcy5fcGxhY2Vob2xkZXIgPSB0aGlzLl9jb250ZXh0cyA9XHJcblx0XHRcdFx0dGhpcy5fYXV0b0ZldGNoID0gdGhpcy5fcGFyZW50Q29udGV4dCA9IHRoaXMuX2R2VGVtcGxhdGUgPSB0aGlzLl9yZXF1ZXN0ID0gdGhpcy5fZGF0YVByb3ZpZGVyID0gdGhpcy5fd3NwID1cclxuXHRcdFx0XHR0aGlzLl93c3BDbGFzcyA9IHRoaXMuX2ZldGNoaW5nID0gdGhpcy5faW5pdGlhbFNlbGVjdGVkSW5kZXggPSB0aGlzLl9zZWxlY3RlZEluZGV4ID0gdGhpcy5fcHJvdmlkZXIgPSB0aGlzLl9kYXRhID1cclxuXHRcdFx0XHR0aGlzLl9mZXRjaFBhcmFtZXRlcnMgPSB0aGlzLl9xdWVyeSA9IHRoaXMuX2NvbnRlbnRUZW1wbGF0ZSA9IHRoaXMuX2NoYW5nZWQgPSB0aGlzLl9kaXJ0eSA9IHRoaXMuX2V2ZW50VHlwZSA9XHJcblx0XHRcdFx0dGhpcy5fc3RhbGUgPSB0aGlzLl90aW1lb3V0ID0gdGhpcy5fdmlzaWJpbGl0eU1vZGUgPSB0aGlzLl9jaGFuZ2luZyA9IHRoaXMuX2NoYW5nZWRIYW5kbGVyID0gdGhpcy5fdmlld0RhdGEgPVxyXG5cdFx0XHRcdHRoaXMuX2NsZWFyZWQgPSB0aGlzLl9yZW5kZXJlZCA9IHRoaXMuX3NldERhdGEgPSBudWxsO1xyXG5cdFx0XHRTeXMuVUkuRGF0YVZpZXcuY2FsbEJhc2VNZXRob2QodGhpcywgXCJkaXNwb3NlXCIpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JGluaXRpYWxpemUoKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNpbml0aWFsaXplXCIgLz5cclxuXHRcdFx0U3lzLlVJLkRhdGFWaWV3LmNhbGxCYXNlTWV0aG9kKHRoaXMsIFwiaW5pdGlhbGl6ZVwiKTtcclxuXHRcdFx0aWYgKHRoaXMuZ2V0X2lzTGlua1BlbmRpbmcoKSkge1xyXG5cdFx0XHRcdGlmICh0aGlzLmhhc093blByb3BlcnR5KFwiX2RhdGFcIikpIHtcclxuXHRcdFx0XHRcdHRoaXMubGluaygpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aGlzLnJlZnJlc2goKTtcclxuXHRcdFx0XHR0aGlzLnVwZGF0ZWQoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JGZldGNoRGF0YShzdWNjZWVkZWRDYWxsYmFjaywgZmFpbGVkQ2FsbGJhY2ssIG1lcmdlT3B0aW9uLCB1c2VyQ29udGV4dCkge1xyXG5cdFx0XHQvLy8gPHN1bW1hcnkgbG9jaWQ9XCJNOkojZmV0Y2hEYXRhXCIgLz5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwic3VjY2VlZGVkQ2FsbGJhY2tcIiB0eXBlPVwiRnVuY3Rpb25cIiBtYXlCZU51bGw9XCJ0cnVlXCIgb3B0aW9uYWw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwiZmFpbGVkQ2FsbGJhY2tcIiB0eXBlPVwiRnVuY3Rpb25cIiBtYXlCZU51bGw9XCJ0cnVlXCIgb3B0aW9uYWw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwibWVyZ2VPcHRpb25cIiB0eXBlPVwiU3lzLkRhdGEuTWVyZ2VPcHRpb25cIiBtYXlCZU51bGw9XCJ0cnVlXCIgb3B0aW9uYWw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwidXNlckNvbnRleHRcIiBtYXlCZU51bGw9XCJ0cnVlXCIgb3B0aW9uYWw9XCJ0cnVlXCI+PC9wYXJhbT5cclxuXHRcdFx0Ly8vIDxyZXR1cm5zIHR5cGU9XCJTeXMuTmV0LldlYlJlcXVlc3RcIj48L3JldHVybnM+XHJcblx0XHRcdHRoaXMuX3N0YWxlID0gZmFsc2U7XHJcblx0XHRcdHZhciByZXF1ZXN0LCBfdGhpcyA9IHRoaXM7XHJcblx0XHRcdGZ1bmN0aW9uIG9uU3VjY2VzcyhkYXRhKSB7XHJcblx0XHRcdFx0X3RoaXMuX2xvYWREYXRhKGRhdGEpO1xyXG5cdFx0XHRcdF90aGlzLl9mZXRjaGluZyA9IGZhbHNlO1xyXG5cdFx0XHRcdF90aGlzLl9yZXF1ZXN0ID0gbnVsbDtcclxuXHRcdFx0XHRfdGhpcy5fcmFpc2VDaGFuZ2VkKFwiaXNGZXRjaGluZ1wiKTtcclxuXHRcdFx0XHRfdGhpcy5fcmFpc2VTdWNjZWVkZWQocmVxdWVzdCwgZGF0YSk7XHJcblx0XHRcdFx0aWYgKHN1Y2NlZWRlZENhbGxiYWNrKSB7XHJcblx0XHRcdFx0XHRzdWNjZWVkZWRDYWxsYmFjayhkYXRhLCB1c2VyQ29udGV4dCwgXCJmZXRjaERhdGFcIik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGZ1bmN0aW9uIG9uRmFpbChlcnJvcikge1xyXG5cdFx0XHRcdF90aGlzLl9mZXRjaGluZyA9IGZhbHNlO1xyXG5cdFx0XHRcdF90aGlzLl9yZXF1ZXN0ID0gbnVsbDtcclxuXHRcdFx0XHRfdGhpcy5fcmFpc2VDaGFuZ2VkKFwiaXNGZXRjaGluZ1wiKTtcclxuXHRcdFx0XHRfdGhpcy5fcmFpc2VGYWlsZWQocmVxdWVzdCwgZXJyb3IpO1xyXG5cdFx0XHRcdGlmIChmYWlsZWRDYWxsYmFjaykge1xyXG5cdFx0XHRcdFx0ZmFpbGVkQ2FsbGJhY2soZXJyb3IsIHVzZXJDb250ZXh0LCBcImZldGNoRGF0YVwiKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHRoaXMuX2ZldGNoaW5nKSB7XHJcblx0XHRcdFx0dGhpcy5hYm9ydEZldGNoKCk7XHJcblx0XHRcdH1cclxuXHRcdFx0dmFyIGRhdGFQcm92aWRlciA9IHRoaXMuX2RhdGFQcm92aWRlcixcclxuXHRcdFx0d3NwID0gdGhpcy5fd3NwLFxyXG5cdFx0XHR3c3BjID0gdGhpcy5fd3NwQ2xhc3MsXHJcblx0XHRcdHF1ZXJ5ID0gdGhpcy5nZXRfZmV0Y2hPcGVyYXRpb24oKSxcclxuXHRcdFx0cGFyYW1ldGVycyA9IHRoaXMuZ2V0X2ZldGNoUGFyYW1ldGVycygpIHx8IG51bGwsXHJcblx0XHRcdGh0dHBWZXJiID0gdGhpcy5nZXRfaHR0cFZlcmIoKSB8fCBcIlBPU1RcIixcclxuXHRcdFx0dGltZW91dCA9IHRoaXMuZ2V0X3RpbWVvdXQoKSB8fCAwO1xyXG5cdFx0XHRpZiAodHlwZW9mIChtZXJnZU9wdGlvbikgPT09IFwidW5kZWZpbmVkXCIpIHtcclxuXHRcdFx0XHRtZXJnZU9wdGlvbiA9IG51bGw7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKGRhdGFQcm92aWRlcikge1xyXG5cdFx0XHRcdHJlcXVlc3QgPSBkYXRhUHJvdmlkZXIuZmV0Y2hEYXRhKHF1ZXJ5LCBwYXJhbWV0ZXJzLCBtZXJnZU9wdGlvbiwgaHR0cFZlcmIsIG9uU3VjY2Vzcywgb25GYWlsLCB0aW1lb3V0LCB1c2VyQ29udGV4dCk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAod3NwKSB7XHJcblx0XHRcdFx0dmFyIHBhdGggPSB3c3AuZ2V0X3BhdGgoKTtcclxuXHRcdFx0XHRpZiAoIXBhdGgpIHtcclxuXHRcdFx0XHRcdHZhciB0eXBlID0gT2JqZWN0LmdldFR5cGUod3NwKTtcclxuXHRcdFx0XHRcdGlmICh0eXBlICYmICh0eXBlb2YgKHR5cGUuZ2V0X3BhdGgpID09PSBcImZ1bmN0aW9uXCIpKSB7XHJcblx0XHRcdFx0XHRcdHBhdGggPSB0eXBlLmdldF9wYXRoKCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdFR5cGUuX2NoZWNrRGVwZW5kZW5jeShcIk1pY3Jvc29mdEFqYXhXZWJTZXJ2aWNlcy5qc1wiLCBcIlN5cy5VSS5EYXRhVmlldy5mZXRjaERhdGFcIik7XHJcblx0XHRcdFx0cmVxdWVzdCA9IFN5cy5VSS5EYXRhVmlldy5fZmV0Y2hXU1AobnVsbCwgcGF0aCwgcXVlcnksIHBhcmFtZXRlcnMsIGh0dHBWZXJiLCBvblN1Y2Nlc3MsIG9uRmFpbCwgdGltZW91dCB8fCB3c3AuZ2V0X3RpbWVvdXQoKSk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0VHlwZS5fY2hlY2tEZXBlbmRlbmN5KFwiTWljcm9zb2Z0QWpheFdlYlNlcnZpY2VzLmpzXCIsIFwiU3lzLlVJLkRhdGFWaWV3LmZldGNoRGF0YVwiKTtcclxuXHRcdFx0XHRpZiAod3NwYykge1xyXG5cdFx0XHRcdFx0cmVxdWVzdCA9IFN5cy5VSS5EYXRhVmlldy5fZmV0Y2hXU1AobnVsbCwgd3NwYy5nZXRfcGF0aCgpLCBxdWVyeSwgcGFyYW1ldGVycywgaHR0cFZlcmIsIG9uU3VjY2VzcyxcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdCBvbkZhaWwsIHRpbWVvdXQgfHwgd3NwYy5nZXRfdGltZW91dCgpKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRyZXF1ZXN0ID0gU3lzLlVJLkRhdGFWaWV3Ll9mZXRjaFdTUChudWxsLCB0aGlzLl9wcm92aWRlciwgcXVlcnksIHBhcmFtZXRlcnMsIGh0dHBWZXJiLCBvblN1Y2Nlc3MsIG9uRmFpbCwgdGltZW91dCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHRoaXMuX3JlcXVlc3QgPSByZXF1ZXN0O1xyXG5cdFx0XHR0aGlzLl9mZXRjaGluZyA9IHRydWU7XHJcblx0XHRcdHRoaXMuX3JhaXNlQ2hhbmdlZChcImlzRmV0Y2hpbmdcIik7XHJcblx0XHRcdHJldHVybiByZXF1ZXN0O1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JG9uQ29tbWFuZChhcmdzKSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuRGF0YVZpZXcub25Db21tYW5kXCIgLz5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwiYXJnc1wiIHR5cGU9XCJTeXMuQ29tbWFuZEV2ZW50QXJnc1wiPjwvcGFyYW0+XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckb25JdGVtUmVuZGVyaW5nKGFyZ3MpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5EYXRhVmlldy5vbkl0ZW1SZW5kZXJpbmdcIiAvPlxyXG5cdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJhcmdzXCIgdHlwZT1cIlN5cy5VSS5EYXRhVmlld0l0ZW1FdmVudEFyZ3NcIj48L3BhcmFtPlxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gU3lzJFVJJERhdGFWaWV3JG9uSXRlbVJlbmRlcmVkKGFyZ3MpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5EYXRhVmlldy5vbkl0ZW1SZW5kZXJlZFwiIC8+XHJcblx0XHRcdC8vLyA8cGFyYW0gbmFtZT1cImFyZ3NcIiB0eXBlPVwiU3lzLlVJLkRhdGFWaWV3SXRlbUV2ZW50QXJnc1wiPjwvcGFyYW0+XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckdXBkYXRlZCgpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5EYXRhVmlldy51cGRhdGVkXCIgLz5cclxuXHRcdFx0aWYgKHRoaXMuX3N0YWxlICYmIHRoaXMuZ2V0X2F1dG9GZXRjaCgpKSB7XHJcblx0XHRcdFx0dGhpcy5fZG9BdXRvRmV0Y2goKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodGhpcy5fZGlydHkpIHtcclxuXHRcdFx0XHR0aGlzLnJlZnJlc2goKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodGhpcy5fY2hhbmdlZCkge1xyXG5cdFx0XHRcdHRoaXMucmFpc2VQcm9wZXJ0eUNoYW5nZWQoXCJcIik7XHJcblx0XHRcdFx0dGhpcy5fY2hhbmdlZCA9IGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckbGluaygpIHtcclxuXHRcdFx0Ly8vIDxzdW1tYXJ5IGxvY2lkPVwiTTpKI1N5cy5VSS5EYXRhVmlldy5saW5rXCIgLz5cclxuXHJcblx0XHRcdC8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBjb250cm9sIGRvZXNuJ3QgYXBwZWFyIHRoYXQgaXQgbmVlZHMgdG8gcmUtcmVuZGVyXHJcblx0XHRcdHRoaXMuX2NoYW5nZWQgPSBmYWxzZTtcclxuXHRcdFx0dGhpcy5fZGlydHkgPSBmYWxzZTtcclxuXHJcblx0XHRcdC8vIFdvdWxkIG5vcm1hbGx5IGJlIHNldCB1cCBieSBcInJlZnJlc2hcIlxyXG5cdFx0XHR0aGlzLl9jb250ZXh0cyA9IFtdO1xyXG5cdFx0XHR0aGlzLl9wbGFjZWhvbGRlcnMgPSBbbnVsbF07XHJcblx0XHRcdHRoaXMuX2NvbnRhaW5lcnMgPSBbdGhpcy5nZXRfZWxlbWVudCgpXTtcclxuXHJcblx0XHRcdFN5cy5BcHBsaWNhdGlvbi5fbGlua0NvbnRleHRzKHRoaXMuZ2V0X3RlbXBsYXRlQ29udGV4dCgpLCB0aGlzLCB0aGlzLmdldF9kYXRhKCksIHRoaXMuZ2V0X2VsZW1lbnQoKSwgbnVsbCwgdGhpcy5fY29udGVudFRlbXBsYXRlKTtcclxuXHJcblx0XHRcdC8vIFdvdWxkIG5vcm1hbGx5IGJlIGNhbGxlZCBhdCB0aGUgZW5kIG9mIFwicmVmcmVzaFwiXHJcblx0XHRcdHRoaXMuX2luaXRpYWxpemVSZXN1bHRzKCk7XHJcblxyXG5cdFx0XHRTeXMuVUkuRGF0YVZpZXcuY2FsbEJhc2VNZXRob2QodGhpcywgXCJsaW5rXCIpO1xyXG5cdFx0fVxyXG5cdFx0U3lzLlVJLkRhdGFWaWV3LnByb3RvdHlwZSA9IHtcclxuXHRcdFx0X2F1dG9GZXRjaDogZmFsc2UsXHJcblx0XHRcdF9mZXRjaGluZzogZmFsc2UsXHJcblx0XHRcdF9jaGFuZ2VkOiBmYWxzZSxcclxuXHRcdFx0X2RhdGE6IG51bGwsXHJcblx0XHRcdF9kYXRhUHJvdmlkZXI6IG51bGwsXHJcblx0XHRcdF93c3A6IG51bGwsXHJcblx0XHRcdF93c3BDbGFzczogbnVsbCxcclxuXHRcdFx0X2RpcnR5OiBmYWxzZSxcclxuXHRcdFx0X3N0YWxlOiB0cnVlLFxyXG5cdFx0XHRfZHZUZW1wbGF0ZTogbnVsbCxcclxuXHRcdFx0X2V2ZW50VHlwZTogMCxcclxuXHRcdFx0X2h0dHBWZXJiOiBudWxsLFxyXG5cdFx0XHRfaW5pdGlhbFNlbGVjdGVkSW5kZXg6IC0xLFxyXG5cdFx0XHRfZmV0Y2hQYXJhbWV0ZXJzOiBudWxsLFxyXG5cdFx0XHRfcGFyZW50Q29udGV4dDogbnVsbCxcclxuXHRcdFx0X3BsYWNlaG9sZGVyOiBudWxsLFxyXG5cdFx0XHRfcXVlcnk6IG51bGwsXHJcblx0XHRcdF9jb250ZXh0czogbnVsbCxcclxuXHRcdFx0X3NlbGVjdGVkSW5kZXg6IC0xLFxyXG5cdFx0XHRfc2VsZWN0ZWRJdGVtQ2xhc3M6IG51bGwsXHJcblx0XHRcdF90ZW1wbGF0ZTogbnVsbCxcclxuXHRcdFx0X3RpbWVvdXQ6IDAsXHJcblx0XHRcdF9yZXF1ZXN0OiBudWxsLFxyXG5cdFx0XHRhZGRfY29tbWFuZDogU3lzJFVJJERhdGFWaWV3JGFkZF9jb21tYW5kLFxyXG5cdFx0XHRyZW1vdmVfY29tbWFuZDogU3lzJFVJJERhdGFWaWV3JHJlbW92ZV9jb21tYW5kLFxyXG5cdFx0XHRhZGRfcmVuZGVyaW5nOiBTeXMkVUkkRGF0YVZpZXckYWRkX3JlbmRlcmluZyxcclxuXHRcdFx0cmVtb3ZlX3JlbmRlcmluZzogU3lzJFVJJERhdGFWaWV3JHJlbW92ZV9yZW5kZXJpbmcsXHJcblx0XHRcdGFkZF9yZW5kZXJlZDogU3lzJFVJJERhdGFWaWV3JGFkZF9yZW5kZXJlZCxcclxuXHRcdFx0cmVtb3ZlX3JlbmRlcmVkOiBTeXMkVUkkRGF0YVZpZXckcmVtb3ZlX3JlbmRlcmVkLFxyXG5cdFx0XHRhZGRfaXRlbVJlbmRlcmVkOiBTeXMkVUkkRGF0YVZpZXckYWRkX2l0ZW1SZW5kZXJlZCxcclxuXHRcdFx0cmVtb3ZlX2l0ZW1SZW5kZXJlZDogU3lzJFVJJERhdGFWaWV3JHJlbW92ZV9pdGVtUmVuZGVyZWQsXHJcblx0XHRcdGFkZF9pdGVtUmVuZGVyaW5nOiBTeXMkVUkkRGF0YVZpZXckYWRkX2l0ZW1SZW5kZXJpbmcsXHJcblx0XHRcdHJlbW92ZV9pdGVtUmVuZGVyaW5nOiBTeXMkVUkkRGF0YVZpZXckcmVtb3ZlX2l0ZW1SZW5kZXJpbmcsXHJcblx0XHRcdGFkZF9mZXRjaEZhaWxlZDogU3lzJFVJJERhdGFWaWV3JGFkZF9mZXRjaEZhaWxlZCxcclxuXHRcdFx0cmVtb3ZlX2ZldGNoRmFpbGVkOiBTeXMkVUkkRGF0YVZpZXckcmVtb3ZlX2ZldGNoRmFpbGVkLFxyXG5cdFx0XHRhZGRfZmV0Y2hTdWNjZWVkZWQ6IFN5cyRVSSREYXRhVmlldyRhZGRfZmV0Y2hTdWNjZWVkZWQsXHJcblx0XHRcdHJlbW92ZV9mZXRjaFN1Y2NlZWRlZDogU3lzJFVJJERhdGFWaWV3JHJlbW92ZV9mZXRjaFN1Y2NlZWRlZCxcclxuXHRcdFx0Z2V0X3ZpZXdEYXRhOiBTeXMkVUkkRGF0YVZpZXckZ2V0X3ZpZXdEYXRhLFxyXG5cdFx0XHRnZXRfZGF0YTogU3lzJFVJJERhdGFWaWV3JGdldF9kYXRhLFxyXG5cdFx0XHRzZXRfZGF0YTogU3lzJFVJJERhdGFWaWV3JHNldF9kYXRhLFxyXG5cdFx0XHRnZXRfZGF0YVByb3ZpZGVyOiBTeXMkVUkkRGF0YVZpZXckZ2V0X2RhdGFQcm92aWRlcixcclxuXHRcdFx0c2V0X2RhdGFQcm92aWRlcjogU3lzJFVJJERhdGFWaWV3JHNldF9kYXRhUHJvdmlkZXIsXHJcblx0XHRcdGdldF9hdXRvRmV0Y2g6IFN5cyRVSSREYXRhVmlldyRnZXRfYXV0b0ZldGNoLFxyXG5cdFx0XHRzZXRfYXV0b0ZldGNoOiBTeXMkVUkkRGF0YVZpZXckc2V0X2F1dG9GZXRjaCxcclxuXHRcdFx0Z2V0X2lzRmV0Y2hpbmc6IFN5cyRVSSREYXRhVmlldyRnZXRfaXNGZXRjaGluZyxcclxuXHRcdFx0Z2V0X2h0dHBWZXJiOiBTeXMkVUkkRGF0YVZpZXckZ2V0X2h0dHBWZXJiLFxyXG5cdFx0XHRzZXRfaHR0cFZlcmI6IFN5cyRVSSREYXRhVmlldyRzZXRfaHR0cFZlcmIsXHJcblx0XHRcdGdldF9jb250ZXh0czogU3lzJFVJJERhdGFWaWV3JGdldF9jb250ZXh0cyxcclxuXHRcdFx0Z2V0X2ZldGNoUGFyYW1ldGVyczogU3lzJFVJJERhdGFWaWV3JGdldF9mZXRjaFBhcmFtZXRlcnMsXHJcblx0XHRcdHNldF9mZXRjaFBhcmFtZXRlcnM6IFN5cyRVSSREYXRhVmlldyRzZXRfZmV0Y2hQYXJhbWV0ZXJzLFxyXG5cdFx0XHRnZXRfc2VsZWN0ZWREYXRhOiBTeXMkVUkkRGF0YVZpZXckZ2V0X3NlbGVjdGVkRGF0YSxcclxuXHRcdFx0Z2V0X3NlbGVjdGVkSW5kZXg6IFN5cyRVSSREYXRhVmlldyRnZXRfc2VsZWN0ZWRJbmRleCxcclxuXHRcdFx0c2V0X3NlbGVjdGVkSW5kZXg6IFN5cyRVSSREYXRhVmlldyRzZXRfc2VsZWN0ZWRJbmRleCxcclxuXHRcdFx0Z2V0X2luaXRpYWxTZWxlY3RlZEluZGV4OiBTeXMkVUkkRGF0YVZpZXckZ2V0X2luaXRpYWxTZWxlY3RlZEluZGV4LFxyXG5cdFx0XHRzZXRfaW5pdGlhbFNlbGVjdGVkSW5kZXg6IFN5cyRVSSREYXRhVmlldyRzZXRfaW5pdGlhbFNlbGVjdGVkSW5kZXgsXHJcblx0XHRcdGdldF9zZWxlY3RlZEl0ZW1DbGFzczogU3lzJFVJJERhdGFWaWV3JGdldF9zZWxlY3RlZEl0ZW1DbGFzcyxcclxuXHRcdFx0c2V0X3NlbGVjdGVkSXRlbUNsYXNzOiBTeXMkVUkkRGF0YVZpZXckc2V0X3NlbGVjdGVkSXRlbUNsYXNzLFxyXG5cdFx0XHRnZXRfdGltZW91dDogU3lzJFVJJERhdGFWaWV3JGdldF90aW1lb3V0LFxyXG5cdFx0XHRzZXRfdGltZW91dDogU3lzJFVJJERhdGFWaWV3JHNldF90aW1lb3V0LFxyXG5cdFx0XHRnZXRfZmV0Y2hPcGVyYXRpb246IFN5cyRVSSREYXRhVmlldyRnZXRfZmV0Y2hPcGVyYXRpb24sXHJcblx0XHRcdHNldF9mZXRjaE9wZXJhdGlvbjogU3lzJFVJJERhdGFWaWV3JHNldF9mZXRjaE9wZXJhdGlvbixcclxuXHRcdFx0Z2V0X2l0ZW1QbGFjZWhvbGRlcjogU3lzJFVJJERhdGFWaWV3JGdldF9pdGVtUGxhY2Vob2xkZXIsXHJcblx0XHRcdHNldF9pdGVtUGxhY2Vob2xkZXI6IFN5cyRVSSREYXRhVmlldyRzZXRfaXRlbVBsYWNlaG9sZGVyLFxyXG5cdFx0XHRnZXRfdGVtcGxhdGVDb250ZXh0OiBTeXMkVUkkRGF0YVZpZXckZ2V0X3RlbXBsYXRlQ29udGV4dCxcclxuXHRcdFx0c2V0X3RlbXBsYXRlQ29udGV4dDogU3lzJFVJJERhdGFWaWV3JHNldF90ZW1wbGF0ZUNvbnRleHQsXHJcblx0XHRcdGdldF9pdGVtVGVtcGxhdGU6IFN5cyRVSSREYXRhVmlldyRnZXRfaXRlbVRlbXBsYXRlLFxyXG5cdFx0XHRzZXRfaXRlbVRlbXBsYXRlOiBTeXMkVUkkRGF0YVZpZXckc2V0X2l0ZW1UZW1wbGF0ZSxcclxuXHRcdFx0Z2V0X3VzZU9wdGltYWxVcGRhdGVzOiBTeXMkVUkkRGF0YVZpZXckZ2V0X3VzZU9wdGltYWxVcGRhdGVzLFxyXG5cdFx0XHRzZXRfdXNlT3B0aW1hbFVwZGF0ZXM6IFN5cyRVSSREYXRhVmlldyRzZXRfdXNlT3B0aW1hbFVwZGF0ZXMsXHJcblx0XHRcdF9hcHBseVNlbGVjdGVkSW5kZXg6IFN5cyRVSSREYXRhVmlldyRfYXBwbHlTZWxlY3RlZEluZGV4LFxyXG5cdFx0XHRfYWRkUmVtb3ZlQ3NzQ2xhc3M6IFN5cyRVSSREYXRhVmlldyRfYWRkUmVtb3ZlQ3NzQ2xhc3MsXHJcblx0XHRcdF9jb2xsZWN0aW9uQ2hhbmdlZDogU3lzJFVJJERhdGFWaWV3JF9jb2xsZWN0aW9uQ2hhbmdlZCxcclxuXHRcdFx0X2VsZW1lbnRDb250YWluczogU3lzJFVJJERhdGFWaWV3JF9lbGVtZW50Q29udGFpbnMsXHJcblx0XHRcdF9yYWlzZUNoYW5nZWQ6IFN5cyRVSSREYXRhVmlldyRfcmFpc2VDaGFuZ2VkLFxyXG5cdFx0XHRfcmFpc2VGYWlsZWQ6IFN5cyRVSSREYXRhVmlldyRfcmFpc2VGYWlsZWQsXHJcblx0XHRcdF9yYWlzZVNlbGVjdGVkRGF0YTogU3lzJFVJJERhdGFWaWV3JF9yYWlzZVNlbGVjdGVkRGF0YSxcclxuXHRcdFx0X3JhaXNlU3VjY2VlZGVkOiBTeXMkVUkkRGF0YVZpZXckX3JhaXNlU3VjY2VlZGVkLFxyXG5cdFx0XHRfZW5zdXJlVGVtcGxhdGU6IFN5cyRVSSREYXRhVmlldyRfZW5zdXJlVGVtcGxhdGUsXHJcblx0XHRcdF9zZXRUZW1wbGF0ZTogU3lzJFVJJERhdGFWaWV3JF9zZXRUZW1wbGF0ZSxcclxuXHRcdFx0X2dldFRlbXBsYXRlOiBTeXMkVUkkRGF0YVZpZXckX2dldFRlbXBsYXRlLFxyXG5cdFx0XHRfbG9hZERhdGE6IFN5cyRVSSREYXRhVmlldyRfbG9hZERhdGEsXHJcblx0XHRcdF9yZXNldFNlbGVjdGVkSW5kZXg6IFN5cyRVSSREYXRhVmlldyRfcmVzZXRTZWxlY3RlZEluZGV4LFxyXG5cdFx0XHRfaW5pdGlhbGl6ZVJlc3VsdHM6IFN5cyRVSSREYXRhVmlldyRfaW5pdGlhbGl6ZVJlc3VsdHMsXHJcblx0XHRcdF9pc0FjdGl2ZTogU3lzJFVJJERhdGFWaWV3JF9pc0FjdGl2ZSxcclxuXHRcdFx0X3JhaXNlQ29tbWFuZDogU3lzJFVJJERhdGFWaWV3JF9yYWlzZUNvbW1hbmQsXHJcblx0XHRcdF9yYWlzZUl0ZW06IFN5cyRVSSREYXRhVmlldyRfcmFpc2VJdGVtLFxyXG5cdFx0XHRhYm9ydEZldGNoOiBTeXMkVUkkRGF0YVZpZXckYWJvcnRGZXRjaCxcclxuXHRcdFx0b25CdWJibGVFdmVudDogU3lzJFVJJERhdGFWaWV3JG9uQnViYmxlRXZlbnQsXHJcblx0XHRcdG9uUmVuZGVyaW5nOiBTeXMkVUkkRGF0YVZpZXckb25SZW5kZXJpbmcsXHJcblx0XHRcdG9uRmV0Y2hGYWlsZWQ6IFN5cyRVSSREYXRhVmlldyRvbkZldGNoRmFpbGVkLFxyXG5cdFx0XHRvbkZldGNoU3VjY2VlZGVkOiBTeXMkVUkkRGF0YVZpZXckb25GZXRjaFN1Y2NlZWRlZCxcclxuXHRcdFx0X2RvQXV0b0ZldGNoOiBTeXMkVUkkRGF0YVZpZXckX2RvQXV0b0ZldGNoLFxyXG5cdFx0XHRfZmluZENvbnRleHRJbmRleDogU3lzJFVJJERhdGFWaWV3JF9maW5kQ29udGV4dEluZGV4LFxyXG5cdFx0XHRmaW5kQ29udGV4dDogU3lzJFVJJERhdGFWaWV3JGZpbmRDb250ZXh0LFxyXG5cdFx0XHRfY2xlYXJDb250YWluZXI6IFN5cyRVSSREYXRhVmlldyRfY2xlYXJDb250YWluZXIsXHJcblx0XHRcdF9jbGVhckNvbnRhaW5lcnM6IFN5cyRVSSREYXRhVmlldyRfY2xlYXJDb250YWluZXJzLFxyXG5cdFx0XHRfaXNBbG9uZTogU3lzJFVJJERhdGFWaWV3JF9pc0Fsb25lLFxyXG5cdFx0XHRfZ2VuZXJhdGVzQ29udGV4dDogU3lzJFVJJERhdGFWaWV3JF9nZW5lcmF0ZXNDb250ZXh0LFxyXG5cdFx0XHRyZWZyZXNoOiBTeXMkVUkkRGF0YVZpZXckcmVmcmVzaCxcclxuXHRcdFx0X3N3YXBEYXRhOiBTeXMkVUkkRGF0YVZpZXckX3N3YXBEYXRhLFxyXG5cdFx0XHRfdmFsaWRhdGVJbmRleElucHV0OiBTeXMkVUkkRGF0YVZpZXckX3ZhbGlkYXRlSW5kZXhJbnB1dCxcclxuXHRcdFx0ZGlzcG9zZTogU3lzJFVJJERhdGFWaWV3JGRpc3Bvc2UsXHJcblx0XHRcdGluaXRpYWxpemU6IFN5cyRVSSREYXRhVmlldyRpbml0aWFsaXplLFxyXG5cdFx0XHRmZXRjaERhdGE6IFN5cyRVSSREYXRhVmlldyRmZXRjaERhdGEsXHJcblx0XHRcdG9uQ29tbWFuZDogU3lzJFVJJERhdGFWaWV3JG9uQ29tbWFuZCxcclxuXHRcdFx0b25JdGVtUmVuZGVyaW5nOiBTeXMkVUkkRGF0YVZpZXckb25JdGVtUmVuZGVyaW5nLFxyXG5cdFx0XHRvbkl0ZW1SZW5kZXJlZDogU3lzJFVJJERhdGFWaWV3JG9uSXRlbVJlbmRlcmVkLFxyXG5cdFx0XHR1cGRhdGVkOiBTeXMkVUkkRGF0YVZpZXckdXBkYXRlZCxcclxuXHRcdFx0bGluazogU3lzJFVJJERhdGFWaWV3JGxpbmtcclxuXHRcdH1cclxuXHRcdFN5cy5VSS5EYXRhVmlldy5yZWdpc3RlckNsYXNzKFwiU3lzLlVJLkRhdGFWaWV3XCIsIFN5cy5VSS5Db250cm9sLCBTeXMuVUkuSVRlbXBsYXRlQ29udGV4dENvbnN1bWVyLCBTeXMuVUkuSUNvbnRlbnRUZW1wbGF0ZUNvbnN1bWVyKTtcclxuXHRcdFN5cy5yZWdpc3RlckNvbXBvbmVudChTeXMuVUkuRGF0YVZpZXcpO1xyXG5cclxuXHRcdFN5cy5VSS5EYXRhVmlldy5fZmV0Y2hXU1AgPSBmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXckX2ZldGNoV1NQKGRhdGFDb250ZXh0LCB1cmksIG9wZXJhdGlvbiwgcGFyYW1ldGVycywgaHR0cFZlcmIsIHN1Y2NlZWRlZENhbGxiYWNrLCBmYWlsZWRDYWxsYmFjaywgdGltZW91dCwgY29udGV4dCkge1xyXG5cdFx0XHRpZiAoIXVyaSkge1xyXG5cdFx0XHRcdHRocm93IEVycm9yLmludmFsaWRPcGVyYXRpb24oU3lzLlVJLlRlbXBsYXRlc1Jlcy5yZXF1aXJlZFVyaSk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIFN5cy5OZXQuV2ViU2VydmljZVByb3h5Lmludm9rZShcclxuXHRcdHVyaSwgb3BlcmF0aW9uLFxyXG5cdFx0aHR0cFZlcmIgPT09IFwiR0VUXCIsIHBhcmFtZXRlcnMsIHN1Y2NlZWRlZENhbGxiYWNrLFxyXG5cdFx0ZmFpbGVkQ2FsbGJhY2ssIGNvbnRleHQsIHRpbWVvdXQpO1xyXG5cdFx0fVxyXG5cdFx0U3lzLlVJLkRhdGFWaWV3SXRlbUV2ZW50QXJncyA9IGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlld0l0ZW1FdmVudEFyZ3MoZGF0YUl0ZW0sIGl0ZW1Db250ZXh0KSB7XHJcblx0XHRcdC8vLyA8c3VtbWFyeSBsb2NpZD1cIk06SiNTeXMuVUkuRGF0YVZpZXdJdGVtRXZlbnRBcmdzLiNjdG9yXCIgLz5cclxuXHRcdFx0Ly8vIDxwYXJhbSBuYW1lPVwiZGF0YUl0ZW1cIj48L3BhcmFtPlxyXG5cdFx0XHQvLy8gPHBhcmFtIG5hbWU9XCJpdGVtQ29udGV4dFwiIHR5cGU9XCJTeXMuVUkuVGVtcGxhdGVDb250ZXh0XCIgbWF5QmVOdWxsPVwidHJ1ZVwiIG9wdGlvbmFsPVwidHJ1ZVwiPjwvcGFyYW0+XHJcblx0XHRcdFN5cy5VSS5EYXRhVmlld0l0ZW1FdmVudEFyZ3MuaW5pdGlhbGl6ZUJhc2UodGhpcyk7XHJcblx0XHRcdHRoaXMuX2N0eCA9IGl0ZW1Db250ZXh0O1xyXG5cdFx0XHR0aGlzLl9kYXRhID0gZGF0YUl0ZW0gfHwgbnVsbDtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXdJdGVtRXZlbnRBcmdzJGdldF9kYXRhSXRlbSgpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSBsb2NpZD1cIlA6SiNTeXMuVUkuRGF0YVZpZXdJdGVtRXZlbnRBcmdzLmRhdGFJdGVtXCI+PC92YWx1ZT5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGE7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXdJdGVtRXZlbnRBcmdzJGdldF9pdGVtQ29udGV4dCgpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSB0eXBlPVwiU3lzLlVJLlRlbXBsYXRlQ29udGV4dFwiIGxvY2lkPVwiUDpKI1N5cy5VSS5EYXRhVmlld0l0ZW1FdmVudEFyZ3MuaXRlbUNvbnRleHRcIj48L3ZhbHVlPlxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fY3R4IHx8IG51bGw7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXdJdGVtRXZlbnRBcmdzJGdldF9pdGVtUGxhY2Vob2xkZXIoKSB7XHJcblx0XHRcdC8vLyA8dmFsdWUgbWF5QmVOdWxsPVwidHJ1ZVwiIGxvY2lkPVwiUDpKI1N5cy5VSS5EYXRhVmlld0l0ZW1FdmVudEFyZ3MuaXRlbVBsYWNlaG9sZGVyXCI+PC92YWx1ZT5cclxuXHRcdFx0cmV0dXJuIHRoaXMuX3BsYWNlaG9sZGVyIHx8IG51bGw7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXdJdGVtRXZlbnRBcmdzJHNldF9pdGVtUGxhY2Vob2xkZXIodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fcGxhY2Vob2xkZXIgPSB2YWx1ZTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIFN5cyRVSSREYXRhVmlld0l0ZW1FdmVudEFyZ3MkZ2V0X2l0ZW1UZW1wbGF0ZSgpIHtcclxuXHRcdFx0Ly8vIDx2YWx1ZSBtYXlCZU51bGw9XCJ0cnVlXCIgbG9jaWQ9XCJQOkojU3lzLlVJLkRhdGFWaWV3SXRlbUV2ZW50QXJncy5pdGVtVGVtcGxhdGVcIj48L3ZhbHVlPlxyXG5cdFx0XHRyZXR1cm4gdGhpcy5faXRlbVRlbXBsYXRlIHx8IG51bGw7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBTeXMkVUkkRGF0YVZpZXdJdGVtRXZlbnRBcmdzJHNldF9pdGVtVGVtcGxhdGUodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5faXRlbVRlbXBsYXRlID0gdmFsdWU7XHJcblx0XHR9XHJcblx0XHRTeXMuVUkuRGF0YVZpZXdJdGVtRXZlbnRBcmdzLnByb3RvdHlwZSA9IHtcclxuXHRcdFx0Z2V0X2RhdGFJdGVtOiBTeXMkVUkkRGF0YVZpZXdJdGVtRXZlbnRBcmdzJGdldF9kYXRhSXRlbSxcclxuXHRcdFx0Z2V0X2l0ZW1Db250ZXh0OiBTeXMkVUkkRGF0YVZpZXdJdGVtRXZlbnRBcmdzJGdldF9pdGVtQ29udGV4dCxcclxuXHRcdFx0Z2V0X2l0ZW1QbGFjZWhvbGRlcjogU3lzJFVJJERhdGFWaWV3SXRlbUV2ZW50QXJncyRnZXRfaXRlbVBsYWNlaG9sZGVyLFxyXG5cdFx0XHRzZXRfaXRlbVBsYWNlaG9sZGVyOiBTeXMkVUkkRGF0YVZpZXdJdGVtRXZlbnRBcmdzJHNldF9pdGVtUGxhY2Vob2xkZXIsXHJcblx0XHRcdGdldF9pdGVtVGVtcGxhdGU6IFN5cyRVSSREYXRhVmlld0l0ZW1FdmVudEFyZ3MkZ2V0X2l0ZW1UZW1wbGF0ZSxcclxuXHRcdFx0c2V0X2l0ZW1UZW1wbGF0ZTogU3lzJFVJJERhdGFWaWV3SXRlbUV2ZW50QXJncyRzZXRfaXRlbVRlbXBsYXRlXHJcblx0XHR9XHJcblx0XHRTeXMuVUkuRGF0YVZpZXdJdGVtRXZlbnRBcmdzLnJlZ2lzdGVyQ2xhc3MoXCJTeXMuVUkuRGF0YVZpZXdJdGVtRXZlbnRBcmdzXCIsIFN5cy5FdmVudEFyZ3MpO1xyXG5cdH1cclxuXHJcblx0aWYgKHdpbmRvdy5TeXMgJiYgU3lzLmxvYWRlcikge1xyXG5cdFx0U3lzLmxvYWRlci5yZWdpc3RlclNjcmlwdChcIlRlbXBsYXRlc1wiLCBudWxsLCBleGVjdXRlKTtcclxuXHR9XHJcblx0ZWxzZSB7XHJcblx0XHRleGVjdXRlKCk7XHJcblx0fVxyXG5cclxufSkoKTtcclxuXHJcblR5cGUucmVnaXN0ZXJOYW1lc3BhY2UoJ1N5cy5VSScpO1xyXG5cclxuU3lzLlVJLlRlbXBsYXRlc1Jlcz17XHJcbidjb21tb25Ob3RBZnRlckluaXQnOid7MH0gXFwnezF9XFwnIGNhbm5vdCBiZSBzZXQgYWZ0ZXIgaW5pdGlhbGl6ZS4nLFxyXG4ndW5yZXNvbHZlZFJlZmVyZW5jZSc6J1N5cy5CaW5kaW5nIGNvdWxkIG5vdCBmaW5kIGFuIGVsZW1lbnQgb3IgY29tcG9uZW50IHdpdGggdGhlIHNlbGVjdG9yIFxcXCJ7MH1cXFwiLicsXHJcbidzdHJpbmdPckJvb2xlYW4nOidWYWx1ZSBtdXN0IGJlIHRoZSBzdHJpbmcgXFxcInRydWVcXFwiLCBcXFwiZmFsc2VcXFwiLCBvciBhIEJvb2xlYW4uJyxcclxuJ2VsZW1lbnROb3RGb3VuZCc6J0FuIGVsZW1lbnQgd2l0aCBpZCBcXCd7MH1cXCcgY291bGQgbm90IGJlIGZvdW5kLicsXHJcbid1cGRhdGVCZWZvcmVJbml0JzonVXBkYXRlIGNhbm5vdCBiZSBjYWxsZWQgYmVmb3JlIGluaXRpYWxpemUuJyxcclxuJ2ludmFsaWRBdHRyaWJ1dGVOYW1lJzonSW52YWxpZCBhdHRyaWJ1dGUgbmFtZSBcXCd7MH1cXCcuIERlY2xhcmVkIGF0dHJpYnV0ZSBuYW1lcyBtdXN0IGJlIGluIGxvd2VyY2FzZS4nLFxyXG4naW52YWxpZEZ1bmN0aW9uTmFtZSc6J1xcJ3swfVxcJyBtdXN0IGJlIG9mIHR5cGUgRnVuY3Rpb24gb3IgdGhlIG5hbWUgb2YgYSBmdW5jdGlvbiBhcyBhIFN0cmluZy4nLFxyXG4naW52YWxpZERhdGFQcm92aWRlclR5cGUnOidWYWx1ZSBtdXN0IGJlIGEgc2VydmljZSBVUkksIGFuIGluc3RhbmNlIG9mIFN5cy5OZXQuV2ViU2VydmljZVByb3h5LCBvciBjbGFzcyB0aGF0IGltcGxlbWVudHMgU3lzLkRhdGEuSURhdGFQcm92aWRlci4nLFxyXG4ncmVxdWlyZWRVcmknOidBIHNlcnZpY2VVcmkgbXVzdCBiZSBzZXQgcHJpb3IgdG8gY2FsbGluZyBmZXRjaERhdGEuJyxcclxuJ2ludmFsaWRBdHRhY2gnOidJbnZhbGlkIGF0dHJpYnV0ZSBcXCd7MH1cXCcsIHRoZSB0eXBlIFxcJ3sxfVxcJyBpcyBub3QgYSByZWdpc3RlcmVkIG5hbWVzcGFjZS4nLFxyXG4nY2Fubm90QWN0aXZhdGUnOidDb3VsZCBub3QgYWN0aXZhdGUgZWxlbWVudCB3aXRoIGlkIFxcJ3swfVxcJywgdGhlIGVsZW1lbnQgY291bGQgbm90IGJlIGZvdW5kLicsXHJcbidtaXNwbGFjZWRUZW1wbGF0ZSc6J0RhdGFWaWV3IGl0ZW0gdGVtcGxhdGUgbXVzdCBub3QgYmUgYSBjaGlsZCBlbGVtZW50IG9mIHRoZSBEYXRhVmlldy4nLFxyXG4ndGVtcGxhdGVBbHJlYWR5RGVmaW5lZCc6ICdEYXRhVmlldyB0ZW1wbGF0ZSBpcyBhbHJlYWR5IGRlZmluZWQuJyxcclxuJ2Z1bmN0aW9uTm90Rm91bmQnOidBIGZ1bmN0aW9uIHdpdGggdGhlIG5hbWUgXFwnezB9XFwnIGNvdWxkIG5vdCBiZSBmb3VuZC4nLFxyXG4nYmluZGluZ1Byb3BlcnR5Tm90U2V0JzonQmluZGluZyBcXCd7MH1cXCcgbXVzdCBiZSBzZXQgcHJpb3IgdG8gaW5pdGlhbGl6ZS4nLFxyXG4naW52YWxpZFNlbGVjdGVkSW5kZXhWYWx1ZSc6J1ZhbHVlIG11c3QgYmUgYSBOdW1iZXIgb3IgYSBTdHJpbmcgdGhhdCBjYW4gYmUgY29udmVydGVkIHRvIGEgTnVtYmVyLicsXHJcbidtdXN0U2V0SW5wdXRFbGVtZW50c0V4cGxpY2l0bHknOidJbnB1dCBlbGVtZW50cyBcXCd0eXBlXFwnIGFuZCBcXCduYW1lXFwnIGF0dHJpYnV0ZXMgbXVzdCBiZSBleHBsaWNpdGx5IHNldC4nLFxyXG4naW52YWxpZFR5cGVOYW1lc3BhY2UnOidJbnZhbGlkIHR5cGUgbmFtZXNwYWNlIGRlY2xhcmF0aW9uLCBcXCd7MH1cXCcgaXMgbm90IGEgdmFsaWQgdHlwZS4nLFxyXG4nY2Fubm90RmluZE1hcmt1cEV4dGVuc2lvbic6J0EgbWFya3VwIGV4dGVuc2lvbiB3aXRoIHRoZSBuYW1lIFxcJ3swfVxcJyBjb3VsZCBub3QgYmUgZm91bmQuJyxcclxuJ2ludmFsaWRTeXNDb250ZW50VGVtcGxhdGUnOiAnVGhlIHN5czpjb250ZW50LXRlbXBsYXRlIGF0dHJpYnV0ZSBtdXN0IGJlIHVzZWQgb24gb3Igd2l0aGluIGFuIGNvbnRyb2wgdGhhdCBpbXBsZW1lbnRzIFN5cy5VSS5JQ29udGVudFRlbXBsYXRlQ29uc3VtZXIuJ1xyXG59O1xyXG4iXSwic291cmNlUm9vdCI6IiJ9