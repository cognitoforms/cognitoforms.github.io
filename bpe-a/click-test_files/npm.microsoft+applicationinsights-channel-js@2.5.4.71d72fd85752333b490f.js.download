(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["npm.microsoft+applicationinsights-channel-js@2.5.4"],{

/***/ "../../node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/EnvelopeCreator.js":
/*!**************************************************************************************************************************************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Cognito.Web.Client/node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/EnvelopeCreator.js ***!
  \**************************************************************************************************************************************************************************************************************************/
/*! exports provided: EnvelopeCreator, DependencyEnvelopeCreator, EventEnvelopeCreator, ExceptionEnvelopeCreator, MetricEnvelopeCreator, PageViewEnvelopeCreator, PageViewPerformanceEnvelopeCreator, TraceEnvelopeCreator */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "EnvelopeCreator", function() { return EnvelopeCreator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DependencyEnvelopeCreator", function() { return DependencyEnvelopeCreator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "EventEnvelopeCreator", function() { return EventEnvelopeCreator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ExceptionEnvelopeCreator", function() { return ExceptionEnvelopeCreator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MetricEnvelopeCreator", function() { return MetricEnvelopeCreator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "PageViewEnvelopeCreator", function() { return PageViewEnvelopeCreator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "PageViewPerformanceEnvelopeCreator", function() { return PageViewPerformanceEnvelopeCreator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TraceEnvelopeCreator", function() { return TraceEnvelopeCreator; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tslib */ "../../node_modules/.pnpm/tslib@1.14.1/node_modules/tslib/tslib.es6.js");
/* harmony import */ var _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @microsoft/applicationinsights-common */ "../../node_modules/.pnpm/@microsoft+applicationinsights-common@2.5.4/node_modules/@microsoft/applicationinsights-common/dist-esm/applicationinsights-common.js");
/* harmony import */ var _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @microsoft/applicationinsights-core-js */ "../../node_modules/.pnpm/@microsoft+applicationinsights-core-js@2.5.4/node_modules/@microsoft/applicationinsights-core-js/dist-esm/applicationinsights-core-js.js");



// these two constants are used to filter out properties not needed when trying to extract custom properties and measurements from the incoming payload
var baseType = "baseType";
var baseData = "baseData";
var EnvelopeCreator = /** @class */ (function () {
    function EnvelopeCreator() {
    }
    EnvelopeCreator.extractPropsAndMeasurements = function (data, properties, measurements) {
        if (!_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(data)) {
            for (var key in data) {
                if (data.hasOwnProperty(key)) {
                    var value = data[key];
                    if (_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNumber(value)) {
                        measurements[key] = value;
                    }
                    else if (_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isString(value)) {
                        properties[key] = value;
                    }
                    else if (Object(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["hasJSON"])()) {
                        properties[key] = Object(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["getJSON"])().stringify(value);
                    }
                }
            }
        }
    };
    // TODO: Do we want this to take logger as arg or use this._logger as nonstatic?
    EnvelopeCreator.createEnvelope = function (logger, envelopeType, telemetryItem, data) {
        var envelope = new _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Envelope"](logger, data, envelopeType);
        if (telemetryItem[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["SampleRate"]]) {
            envelope.sampleRate = telemetryItem[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["SampleRate"]];
        }
        envelope.iKey = telemetryItem.iKey;
        var iKeyNoDashes = telemetryItem.iKey.replace(/-/g, "");
        envelope.name = envelope.name.replace("{0}", iKeyNoDashes);
        // extract all extensions from ctx
        EnvelopeCreator.extractPartAExtensions(telemetryItem, envelope);
        // loop through the envelope tags (extension of Part A) and pick out the ones that should go in outgoing envelope tags
        if (!telemetryItem.tags) {
            telemetryItem.tags = [];
        }
        return envelope;
    };
    /*
     * Maps Part A data from CS 4.0
     */
    EnvelopeCreator.extractPartAExtensions = function (item, env) {
        // todo: switch to keys from common in this method
        if (!env.tags) {
            env.tags = {};
        }
        if (!item.ext) {
            item.ext = {};
        }
        if (!item.tags) {
            item.tags = [];
        }
        if (item.ext.user) {
            if (item.ext.user.authId) {
                env.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["CtxTagKeys"].userAuthUserId] = item.ext.user.authId;
            }
            var userId = item.ext.user.id || item.ext.user.localId;
            if (userId) {
                env.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["CtxTagKeys"].userId] = userId;
            }
        }
        if (item.ext.app) {
            if (item.ext.app.sesId) {
                env.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["CtxTagKeys"].sessionId] = item.ext.app.sesId;
            }
        }
        if (item.ext.device) {
            if (item.ext.device.id || item.ext.device.localId) {
                env.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["CtxTagKeys"].deviceId] = item.ext.device.id || item.ext.device.localId;
            }
            if (item.ext.device.deviceClass) {
                env.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["CtxTagKeys"].deviceType] = item.ext.device.deviceClass;
            }
            if (item.ext.device.ip) {
                env.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["CtxTagKeys"].deviceIp] = item.ext.device.ip;
            }
        }
        if (item.ext.web) {
            var web = item.ext.web;
            if (web.browserLang) {
                env.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["CtxTagKeys"].deviceLanguage] = web.browserLang;
            }
            if (web.browserVer) {
                env.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["CtxTagKeys"].deviceBrowserVersion] = web.browserVer;
            }
            if (web.browser) {
                env.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["CtxTagKeys"].deviceBrowser] = web.browser;
            }
            env.data = env.data || {};
            env.data.baseData = env.data.baseData || {};
            env.data.baseData.properties = env.data.baseData.properties || {};
            if (web.domain) {
                env.data.baseData.properties['domain'] = web.domain;
            }
            if (web.isManual) {
                env.data.baseData.properties['isManual'] = web.isManual.toString();
            }
            if (web.screenRes) {
                env.data.baseData.properties['screenRes'] = web.screenRes;
            }
            if (web.userConsent) {
                env.data.baseData.properties['userConsent'] = web.userConsent.toString();
            }
        }
        if (item.ext.device) {
            if (item.ext.device.model) {
                env.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["CtxTagKeys"].deviceModel] = item.ext.device.model;
            }
        }
        if (item.ext.os && item.ext.os.name) {
            env.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["CtxTagKeys"].deviceOS] = item.ext.os.name;
        }
        if (item.ext.device) {
            if (item.ext.device.deviceType) {
                env.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["CtxTagKeys"].deviceType] = item.ext.device.deviceType;
            }
        }
        // No support for mapping Trace.traceState to 2.0 as it is currently empty
        if (item.ext.trace) {
            if (item.ext.trace.parentID) {
                env.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["CtxTagKeys"].operationParentId] = item.ext.trace.parentID;
            }
            if (item.ext.trace.name) {
                env.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["CtxTagKeys"].operationName] = item.ext.trace.name;
            }
            if (item.ext.trace.traceID) {
                env.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["CtxTagKeys"].operationId] = item.ext.trace.traceID;
            }
        }
        // Sample 4.0 schema
        //  {
        //     "time" : "2018-09-05T22:51:22.4936Z",
        //     "name" : "MetricWithNamespace",
        //     "iKey" : "ABC-5a4cbd20-e601-4ef5-a3c6-5d6577e4398e",
        //     "ext": {  "cloud": {
        //          "role": "WATSON3",
        //          "roleInstance": "CO4AEAP00000260"
        //      },
        //      "device": {}, "correlation": {} },
        //      "tags": [
        //        { "amazon.region" : "east2" },
        //        { "os.expid" : "wp:02df239" }
        //     ]
        //   }
        var tgs = {};
        var _loop_1 = function (i) {
            var tg = item.tags[i];
            // CoreUtils.objKeys returns an array of keys
            _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].arrForEach(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].objKeys(tg), function (key) {
                tgs[key] = tg[key];
            });
            item.tags.splice(i, 1);
        };
        // deals with tags.push({object})
        for (var i = item.tags.length - 1; i >= 0; i--) {
            _loop_1(i);
        }
        // deals with tags[key]=value
        for (var tg in item.tags) {
            tgs[tg] = item.tags[tg];
        }
        env.tags = tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"]({}, env.tags, tgs);
        if (!env.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["CtxTagKeys"].internalSdkVersion]) {
            // Append a version in case it is not already set
            env.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["CtxTagKeys"].internalSdkVersion] = "javascript:" + EnvelopeCreator.Version;
        }
    };
    EnvelopeCreator.Version = "2.5.4";
    return EnvelopeCreator;
}());

var DependencyEnvelopeCreator = /** @class */ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"](DependencyEnvelopeCreator, _super);
    function DependencyEnvelopeCreator() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    DependencyEnvelopeCreator.prototype.Create = function (logger, telemetryItem) {
        this._logger = logger;
        if (_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(telemetryItem.baseData)) {
            this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["_InternalMessageId"].TelemetryEnvelopeInvalid, "telemetryItem.baseData cannot be null.");
        }
        var customMeasurements = telemetryItem.baseData.measurements || {};
        var customProperties = telemetryItem.baseData.properties || {};
        EnvelopeCreator.extractPropsAndMeasurements(telemetryItem.data, customProperties, customMeasurements);
        var bd = telemetryItem.baseData;
        if (_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(bd)) {
            logger.warnToConsole("Invalid input for dependency data");
            return null;
        }
        var id = bd.id;
        var absoluteUrl = bd.target;
        var command = bd.name;
        var duration = bd.duration;
        var success = bd.success;
        var resultCode = bd.responseCode;
        var requestAPI = bd.type;
        var correlationContext = bd.correlationContext;
        var method = bd.properties && bd.properties[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["HttpMethod"]] ? bd.properties[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["HttpMethod"]] : "GET";
        var baseData = new _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["RemoteDependencyData"](logger, id, absoluteUrl, command, duration, success, resultCode, method, requestAPI, correlationContext, customProperties, customMeasurements);
        var data = new _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Data"](_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["RemoteDependencyData"].dataType, baseData);
        return EnvelopeCreator.createEnvelope(logger, _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["RemoteDependencyData"].envelopeType, telemetryItem, data);
    };
    DependencyEnvelopeCreator.DependencyEnvelopeCreator = new DependencyEnvelopeCreator();
    return DependencyEnvelopeCreator;
}(EnvelopeCreator));

var EventEnvelopeCreator = /** @class */ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"](EventEnvelopeCreator, _super);
    function EventEnvelopeCreator() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    EventEnvelopeCreator.prototype.Create = function (logger, telemetryItem) {
        this._logger = logger;
        if (_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(telemetryItem.baseData)) {
            this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["_InternalMessageId"].TelemetryEnvelopeInvalid, "telemetryItem.baseData cannot be null.");
        }
        var customProperties = {};
        var customMeasurements = {};
        if (telemetryItem.baseType !== _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Event"].dataType) {
            customProperties['baseTypeSource'] = telemetryItem.baseType; // save the passed in base type as a property
        }
        if (telemetryItem.baseType === _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Event"].dataType) {
            customProperties = telemetryItem.baseData.properties || {};
            customMeasurements = telemetryItem.baseData.measurements || {};
        }
        else {
            if (telemetryItem.baseData) {
                EnvelopeCreator.extractPropsAndMeasurements(telemetryItem.baseData, customProperties, customMeasurements);
            }
        }
        // Exract root level properties from part C telemetryItem.data
        EnvelopeCreator.extractPropsAndMeasurements(telemetryItem.data, customProperties, customMeasurements);
        var eventName = telemetryItem.baseData.name;
        var baseData = new _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Event"](logger, eventName, customProperties, customMeasurements);
        var data = new _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Data"](_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Event"].dataType, baseData);
        return EnvelopeCreator.createEnvelope(logger, _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Event"].envelopeType, telemetryItem, data);
    };
    EventEnvelopeCreator.EventEnvelopeCreator = new EventEnvelopeCreator();
    return EventEnvelopeCreator;
}(EnvelopeCreator));

var ExceptionEnvelopeCreator = /** @class */ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"](ExceptionEnvelopeCreator, _super);
    function ExceptionEnvelopeCreator() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    ExceptionEnvelopeCreator.prototype.Create = function (logger, telemetryItem) {
        this._logger = logger;
        if (_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(telemetryItem.baseData)) {
            this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["_InternalMessageId"].TelemetryEnvelopeInvalid, "telemetryItem.baseData cannot be null.");
        }
        var bd = telemetryItem.baseData;
        var baseData = _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Exception"].CreateFromInterface(logger, bd);
        var data = new _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Data"](_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Exception"].dataType, baseData);
        return EnvelopeCreator.createEnvelope(logger, _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Exception"].envelopeType, telemetryItem, data);
    };
    ExceptionEnvelopeCreator.ExceptionEnvelopeCreator = new ExceptionEnvelopeCreator();
    return ExceptionEnvelopeCreator;
}(EnvelopeCreator));

var MetricEnvelopeCreator = /** @class */ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"](MetricEnvelopeCreator, _super);
    function MetricEnvelopeCreator() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    MetricEnvelopeCreator.prototype.Create = function (logger, telemetryItem) {
        this._logger = logger;
        if (_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(telemetryItem.baseData)) {
            this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["_InternalMessageId"].TelemetryEnvelopeInvalid, "telemetryItem.baseData cannot be null.");
        }
        var props = telemetryItem.baseData.properties || {};
        var measurements = telemetryItem.baseData.measurements || {};
        EnvelopeCreator.extractPropsAndMeasurements(telemetryItem.data, props, measurements);
        var name = telemetryItem.baseData.name;
        var average = telemetryItem.baseData.average;
        var sampleCount = telemetryItem.baseData.sampleCount;
        var min = telemetryItem.baseData.min;
        var max = telemetryItem.baseData.max;
        var baseData = new _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Metric"](logger, name, average, sampleCount, min, max, props, measurements);
        var data = new _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Data"](_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Metric"].dataType, baseData);
        return EnvelopeCreator.createEnvelope(logger, _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Metric"].envelopeType, telemetryItem, data);
    };
    MetricEnvelopeCreator.MetricEnvelopeCreator = new MetricEnvelopeCreator();
    return MetricEnvelopeCreator;
}(EnvelopeCreator));

var PageViewEnvelopeCreator = /** @class */ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"](PageViewEnvelopeCreator, _super);
    function PageViewEnvelopeCreator() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    PageViewEnvelopeCreator.prototype.Create = function (logger, telemetryItem) {
        this._logger = logger;
        if (_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(telemetryItem.baseData)) {
            this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["_InternalMessageId"].TelemetryEnvelopeInvalid, "telemetryItem.baseData cannot be null.");
        }
        // Since duration is not part of the domain properties in Common Schema, extract it from part C
        var duration;
        if (!_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(telemetryItem.baseData) &&
            !_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(telemetryItem.baseData.properties) &&
            !_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(telemetryItem.baseData.properties.duration)) {
            duration = telemetryItem.baseData.properties.duration;
            delete telemetryItem.baseData.properties.duration;
        }
        else if (!_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(telemetryItem.data) &&
            !_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(telemetryItem.data["duration"])) {
            duration = telemetryItem.data["duration"];
            delete telemetryItem.data["duration"];
        }
        var bd = telemetryItem.baseData;
        // special case: pageview.id is grabbed from current operation id. Analytics plugin is decoupled from properties plugin, so this is done here instead. This can be made a default telemetry intializer instead if needed to be decoupled from channel
        var currentContextId;
        if (telemetryItem.ext && telemetryItem.ext.trace && telemetryItem.ext.trace.traceID) {
            currentContextId = telemetryItem.ext.trace.traceID;
        }
        var id = bd.id || currentContextId;
        var name = bd.name;
        var url = bd.uri;
        var properties = bd.properties || {};
        var measurements = bd.measurements || {};
        // refUri is a field that Breeze still does not recognize as part of Part B. For now, put it in Part C until it supports it as a domain property
        if (!_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(bd.refUri)) {
            properties["refUri"] = bd.refUri;
        }
        // pageType is a field that Breeze still does not recognize as part of Part B. For now, put it in Part C until it supports it as a domain property
        if (!_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(bd.pageType)) {
            properties["pageType"] = bd.pageType;
        }
        // isLoggedIn is a field that Breeze still does not recognize as part of Part B. For now, put it in Part C until it supports it as a domain property
        if (!_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(bd.isLoggedIn)) {
            properties["isLoggedIn"] = bd.isLoggedIn.toString();
        }
        // pageTags is a field that Breeze still does not recognize as part of Part B. For now, put it in Part C until it supports it as a domain property
        if (!_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(bd.properties)) {
            var pageTags = bd.properties;
            for (var key in pageTags) {
                if (pageTags.hasOwnProperty(key)) {
                    properties[key] = pageTags[key];
                }
            }
        }
        EnvelopeCreator.extractPropsAndMeasurements(telemetryItem.data, properties, measurements);
        var baseData = new _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["PageView"](logger, name, url, duration, properties, measurements, id);
        var data = new _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Data"](_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["PageView"].dataType, baseData);
        return EnvelopeCreator.createEnvelope(logger, _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["PageView"].envelopeType, telemetryItem, data);
    };
    PageViewEnvelopeCreator.PageViewEnvelopeCreator = new PageViewEnvelopeCreator();
    return PageViewEnvelopeCreator;
}(EnvelopeCreator));

var PageViewPerformanceEnvelopeCreator = /** @class */ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"](PageViewPerformanceEnvelopeCreator, _super);
    function PageViewPerformanceEnvelopeCreator() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    PageViewPerformanceEnvelopeCreator.prototype.Create = function (logger, telemetryItem) {
        this._logger = logger;
        if (_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(telemetryItem.baseData)) {
            this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["_InternalMessageId"].TelemetryEnvelopeInvalid, "telemetryItem.baseData cannot be null.");
        }
        var bd = telemetryItem.baseData;
        var name = bd.name;
        var url = bd.uri || bd.url;
        var properties = bd.properties || {};
        var measurements = bd.measurements || {};
        EnvelopeCreator.extractPropsAndMeasurements(telemetryItem.data, properties, measurements);
        var baseData = new _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["PageViewPerformance"](logger, name, url, undefined, properties, measurements, bd);
        var data = new _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Data"](_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["PageViewPerformance"].dataType, baseData);
        return EnvelopeCreator.createEnvelope(logger, _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["PageViewPerformance"].envelopeType, telemetryItem, data);
    };
    PageViewPerformanceEnvelopeCreator.PageViewPerformanceEnvelopeCreator = new PageViewPerformanceEnvelopeCreator();
    return PageViewPerformanceEnvelopeCreator;
}(EnvelopeCreator));

var TraceEnvelopeCreator = /** @class */ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"](TraceEnvelopeCreator, _super);
    function TraceEnvelopeCreator() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    TraceEnvelopeCreator.prototype.Create = function (logger, telemetryItem) {
        this._logger = logger;
        if (_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(telemetryItem.baseData)) {
            this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["_InternalMessageId"].TelemetryEnvelopeInvalid, "telemetryItem.baseData cannot be null.");
        }
        var message = telemetryItem.baseData.message;
        var severityLevel = telemetryItem.baseData.severityLevel;
        var props = telemetryItem.baseData.properties || {};
        var measurements = telemetryItem.baseData.measurements || {};
        EnvelopeCreator.extractPropsAndMeasurements(telemetryItem.data, props, measurements);
        var baseData = new _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Trace"](logger, message, severityLevel, props, measurements);
        var data = new _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Data"](_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Trace"].dataType, baseData);
        return EnvelopeCreator.createEnvelope(logger, _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Trace"].envelopeType, telemetryItem, data);
    };
    TraceEnvelopeCreator.TraceEnvelopeCreator = new TraceEnvelopeCreator();
    return TraceEnvelopeCreator;
}(EnvelopeCreator));

//# sourceMappingURL=EnvelopeCreator.js.map

/***/ }),

/***/ "../../node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/Offline.js":
/*!******************************************************************************************************************************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Cognito.Web.Client/node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/Offline.js ***!
  \******************************************************************************************************************************************************************************************************************/
/*! exports provided: OfflineListener, Offline */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "OfflineListener", function() { return OfflineListener; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Offline", function() { return Offline; });
/* harmony import */ var _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @microsoft/applicationinsights-core-js */ "../../node_modules/.pnpm/@microsoft+applicationinsights-core-js@2.5.4/node_modules/@microsoft/applicationinsights-core-js/dist-esm/applicationinsights-core-js.js");

/**
 * @description Monitors browser for offline events
 * @export default - Offline: Static instance of OfflineListener
 * @class OfflineListener
 */
var OfflineListener = /** @class */ (function () {
    function OfflineListener() {
        this._onlineStatus = true;
        var _window = Object(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_0__["getWindow"])();
        var _document = Object(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_0__["getDocument"])();
        var isListening = false;
        var _this = this;
        try {
            if (_window) {
                if (_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_0__["EventHelper"].Attach(_window, 'online', this._setOnline.bind(_this))) {
                    _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_0__["EventHelper"].Attach(_window, 'offline', this._setOffline.bind(_this));
                    isListening = true;
                }
            }
            if (_document) {
                // Also attach to the document.body or document
                var target = _document.body || _document;
                if (!_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_0__["CoreUtils"].isUndefined(target.ononline)) {
                    target.ononline = this._setOnline.bind(_this);
                    target.onoffline = this._setOffline.bind(_this);
                    isListening = true;
                }
            }
        }
        catch (e) {
            // this makes react-native less angry
            isListening = false;
        }
        this.isListening = isListening;
    }
    OfflineListener.prototype.isOnline = function () {
        var _navigator = Object(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_0__["getNavigator"])();
        if (this.isListening) {
            return this._onlineStatus;
        }
        else if (_navigator && !_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_0__["CoreUtils"].isNullOrUndefined(_navigator.onLine)) {
            return _navigator.onLine;
        }
        else {
            // Cannot determine online status - report as online
            return true;
        }
    };
    OfflineListener.prototype.isOffline = function () {
        return !this.isOnline();
    };
    OfflineListener.prototype._setOnline = function () {
        this._onlineStatus = true;
    };
    OfflineListener.prototype._setOffline = function () {
        this._onlineStatus = false;
    };
    OfflineListener.Offline = new OfflineListener;
    return OfflineListener;
}());

var Offline = OfflineListener.Offline;
//# sourceMappingURL=Offline.js.map

/***/ }),

/***/ "../../node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/SendBuffer.js":
/*!*********************************************************************************************************************************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Cognito.Web.Client/node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/SendBuffer.js ***!
  \*********************************************************************************************************************************************************************************************************************/
/*! exports provided: ArraySendBuffer, SessionStorageSendBuffer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ArraySendBuffer", function() { return ArraySendBuffer; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SessionStorageSendBuffer", function() { return SessionStorageSendBuffer; });
/* harmony import */ var _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @microsoft/applicationinsights-common */ "../../node_modules/.pnpm/@microsoft+applicationinsights-common@2.5.4/node_modules/@microsoft/applicationinsights-common/dist-esm/applicationinsights-common.js");
/* harmony import */ var _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @microsoft/applicationinsights-core-js */ "../../node_modules/.pnpm/@microsoft+applicationinsights-core-js@2.5.4/node_modules/@microsoft/applicationinsights-core-js/dist-esm/applicationinsights-core-js.js");


/*
 * An array based send buffer.
 */
var ArraySendBuffer = /** @class */ (function () {
    function ArraySendBuffer(config) {
        this._config = config;
        this._buffer = [];
    }
    ArraySendBuffer.prototype.enqueue = function (payload) {
        this._buffer.push(payload);
    };
    ArraySendBuffer.prototype.count = function () {
        return this._buffer.length;
    };
    ArraySendBuffer.prototype.clear = function () {
        this._buffer.length = 0;
    };
    ArraySendBuffer.prototype.getItems = function () {
        return this._buffer.slice(0);
    };
    ArraySendBuffer.prototype.batchPayloads = function (payload) {
        if (payload && payload.length > 0) {
            var batch = this._config.emitLineDelimitedJson() ?
                payload.join("\n") :
                "[" + payload.join(",") + "]";
            return batch;
        }
        return null;
    };
    ArraySendBuffer.prototype.markAsSent = function (payload) {
        this.clear();
    };
    ArraySendBuffer.prototype.clearSent = function (payload) {
        // not supported
    };
    return ArraySendBuffer;
}());

/*
 * Session storege buffer holds a copy of all unsent items in the browser session storage.
 */
var SessionStorageSendBuffer = /** @class */ (function () {
    function SessionStorageSendBuffer(logger, config) {
        this._bufferFullMessageSent = false;
        this._logger = logger;
        this._config = config;
        var bufferItems = this.getBuffer(SessionStorageSendBuffer.BUFFER_KEY);
        var notDeliveredItems = this.getBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY);
        this._buffer = bufferItems.concat(notDeliveredItems);
        // If the buffer has too many items, drop items from the end.
        if (this._buffer.length > SessionStorageSendBuffer.MAX_BUFFER_SIZE) {
            this._buffer.length = SessionStorageSendBuffer.MAX_BUFFER_SIZE;
        }
        // update DataLossAnalyzer with the number of recovered items
        // Uncomment if you want to use DataLossanalyzer
        // DataLossAnalyzer.itemsRestoredFromSessionBuffer = this._buffer.length;
        this.setBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY, []);
        this.setBuffer(SessionStorageSendBuffer.BUFFER_KEY, this._buffer);
    }
    SessionStorageSendBuffer.prototype.enqueue = function (payload) {
        if (this._buffer.length >= SessionStorageSendBuffer.MAX_BUFFER_SIZE) {
            // sent internal log only once per page view
            if (!this._bufferFullMessageSent) {
                this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["LoggingSeverity"].WARNING, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["_InternalMessageId"].SessionStorageBufferFull, "Maximum buffer size reached: " + this._buffer.length, true);
                this._bufferFullMessageSent = true;
            }
            return;
        }
        this._buffer.push(payload);
        this.setBuffer(SessionStorageSendBuffer.BUFFER_KEY, this._buffer);
    };
    SessionStorageSendBuffer.prototype.count = function () {
        return this._buffer.length;
    };
    SessionStorageSendBuffer.prototype.clear = function () {
        this._buffer.length = 0;
        this.setBuffer(SessionStorageSendBuffer.BUFFER_KEY, []);
        this.setBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY, []);
        this._bufferFullMessageSent = false;
    };
    SessionStorageSendBuffer.prototype.getItems = function () {
        return this._buffer.slice(0);
    };
    SessionStorageSendBuffer.prototype.batchPayloads = function (payload) {
        if (payload && payload.length > 0) {
            var batch = this._config.emitLineDelimitedJson() ?
                payload.join("\n") :
                "[" + payload.join(",") + "]";
            return batch;
        }
        return null;
    };
    SessionStorageSendBuffer.prototype.markAsSent = function (payload) {
        this._buffer = this.removePayloadsFromBuffer(payload, this._buffer);
        this.setBuffer(SessionStorageSendBuffer.BUFFER_KEY, this._buffer);
        var sentElements = this.getBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY);
        if (sentElements instanceof Array && payload instanceof Array) {
            sentElements = sentElements.concat(payload);
            if (sentElements.length > SessionStorageSendBuffer.MAX_BUFFER_SIZE) {
                // We send telemetry normally. If the SENT_BUFFER is too big we don't add new elements
                // until we receive a response from the backend and the buffer has free space again (see clearSent method)
                this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["_InternalMessageId"].SessionStorageBufferFull, "Sent buffer reached its maximum size: " + sentElements.length, true);
                sentElements.length = SessionStorageSendBuffer.MAX_BUFFER_SIZE;
            }
            this.setBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY, sentElements);
        }
    };
    SessionStorageSendBuffer.prototype.clearSent = function (payload) {
        var sentElements = this.getBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY);
        sentElements = this.removePayloadsFromBuffer(payload, sentElements);
        this.setBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY, sentElements);
    };
    SessionStorageSendBuffer.prototype.removePayloadsFromBuffer = function (payloads, buffer) {
        var remaining = [];
        for (var i in buffer) {
            var contains = false;
            for (var j in payloads) {
                if (payloads[j] === buffer[i]) {
                    contains = true;
                    break;
                }
            }
            if (!contains) {
                remaining.push(buffer[i]);
            }
        }
        ;
        return remaining;
    };
    SessionStorageSendBuffer.prototype.getBuffer = function (key) {
        var prefixedKey = key;
        try {
            prefixedKey = this._config.namePrefix && this._config.namePrefix() ? this._config.namePrefix() + "_" + prefixedKey : prefixedKey;
            var bufferJson = _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_0__["Util"].getSessionStorage(this._logger, prefixedKey);
            if (bufferJson) {
                var buffer = Object(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["getJSON"])().parse(bufferJson);
                if (buffer) {
                    return buffer;
                }
            }
        }
        catch (e) {
            this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["_InternalMessageId"].FailedToRestoreStorageBuffer, " storage key: " + prefixedKey + ", " + _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_0__["Util"].getExceptionName(e), { exception: _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_0__["Util"].dump(e) });
        }
        return [];
    };
    SessionStorageSendBuffer.prototype.setBuffer = function (key, buffer) {
        var prefixedKey = key;
        try {
            prefixedKey = this._config.namePrefix && this._config.namePrefix() ? this._config.namePrefix() + "_" + prefixedKey : prefixedKey;
            var bufferJson = JSON.stringify(buffer);
            _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_0__["Util"].setSessionStorage(this._logger, prefixedKey, bufferJson);
        }
        catch (e) {
            // if there was an error, clear the buffer
            // telemetry is stored in the _buffer array so we won't loose any items
            _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_0__["Util"].setSessionStorage(this._logger, prefixedKey, JSON.stringify([]));
            this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["LoggingSeverity"].WARNING, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["_InternalMessageId"].FailedToSetStorageBuffer, " storage key: " + prefixedKey + ", " + _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_0__["Util"].getExceptionName(e) + ". Buffer cleared", { exception: _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_0__["Util"].dump(e) });
        }
    };
    SessionStorageSendBuffer.BUFFER_KEY = "AI_buffer";
    SessionStorageSendBuffer.SENT_BUFFER_KEY = "AI_sentBuffer";
    // Maximum number of payloads stored in the buffer. If the buffer is full, new elements will be dropped.
    SessionStorageSendBuffer.MAX_BUFFER_SIZE = 2000;
    return SessionStorageSendBuffer;
}());

//# sourceMappingURL=SendBuffer.js.map

/***/ }),

/***/ "../../node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/Sender.js":
/*!*****************************************************************************************************************************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Cognito.Web.Client/node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/Sender.js ***!
  \*****************************************************************************************************************************************************************************************************************/
/*! exports provided: Sender */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Sender", function() { return Sender; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tslib */ "../../node_modules/.pnpm/tslib@1.14.1/node_modules/tslib/tslib.es6.js");
/* harmony import */ var _SendBuffer__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./SendBuffer */ "../../node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/SendBuffer.js");
/* harmony import */ var _EnvelopeCreator__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./EnvelopeCreator */ "../../node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/EnvelopeCreator.js");
/* harmony import */ var _Serializer__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Serializer */ "../../node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/Serializer.js");
/* harmony import */ var _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @microsoft/applicationinsights-common */ "../../node_modules/.pnpm/@microsoft+applicationinsights-common@2.5.4/node_modules/@microsoft/applicationinsights-common/dist-esm/applicationinsights-common.js");
/* harmony import */ var _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @microsoft/applicationinsights-core-js */ "../../node_modules/.pnpm/@microsoft+applicationinsights-core-js@2.5.4/node_modules/@microsoft/applicationinsights-core-js/dist-esm/applicationinsights-core-js.js");
/* harmony import */ var _Offline__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./Offline */ "../../node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/Offline.js");
/* harmony import */ var _TelemetryProcessors_Sample__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./TelemetryProcessors/Sample */ "../../node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/TelemetryProcessors/Sample.js");



 // todo move to channel




function _getResponseText(xhr) {
    try {
        return xhr.responseText;
    }
    catch (e) {
        // Best effort, as XHR may throw while XDR wont so just ignore
    }
    return null;
}
var Sender = /** @class */ (function (_super) {
    tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"](Sender, _super);
    function Sender() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.priority = 1001;
        _this.identifier = _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["BreezeChannelIdentifier"];
        /**
         * Whether XMLHttpRequest object is supported. Older version of IE (8,9) do not support it.
         */
        _this._XMLHttpRequestSupported = false;
        return _this;
    }
    Sender.constructEnvelope = function (orig, iKey, logger) {
        var envelope;
        if (iKey !== orig.iKey && !_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["CoreUtils"].isNullOrUndefined(iKey)) {
            envelope = tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"]({}, orig, { iKey: iKey });
        }
        else {
            envelope = orig;
        }
        switch (envelope.baseType) {
            case _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Event"].dataType:
                return _EnvelopeCreator__WEBPACK_IMPORTED_MODULE_2__["EventEnvelopeCreator"].EventEnvelopeCreator.Create(logger, envelope);
            case _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Trace"].dataType:
                return _EnvelopeCreator__WEBPACK_IMPORTED_MODULE_2__["TraceEnvelopeCreator"].TraceEnvelopeCreator.Create(logger, envelope);
            case _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["PageView"].dataType:
                return _EnvelopeCreator__WEBPACK_IMPORTED_MODULE_2__["PageViewEnvelopeCreator"].PageViewEnvelopeCreator.Create(logger, envelope);
            case _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["PageViewPerformance"].dataType:
                return _EnvelopeCreator__WEBPACK_IMPORTED_MODULE_2__["PageViewPerformanceEnvelopeCreator"].PageViewPerformanceEnvelopeCreator.Create(logger, envelope);
            case _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Exception"].dataType:
                return _EnvelopeCreator__WEBPACK_IMPORTED_MODULE_2__["ExceptionEnvelopeCreator"].ExceptionEnvelopeCreator.Create(logger, envelope);
            case _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Metric"].dataType:
                return _EnvelopeCreator__WEBPACK_IMPORTED_MODULE_2__["MetricEnvelopeCreator"].MetricEnvelopeCreator.Create(logger, envelope);
            case _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["RemoteDependencyData"].dataType:
                return _EnvelopeCreator__WEBPACK_IMPORTED_MODULE_2__["DependencyEnvelopeCreator"].DependencyEnvelopeCreator.Create(logger, envelope);
            default:
                return _EnvelopeCreator__WEBPACK_IMPORTED_MODULE_2__["EventEnvelopeCreator"].EventEnvelopeCreator.Create(logger, envelope);
        }
    };
    Sender._getDefaultAppInsightsChannelConfig = function () {
        // set default values
        return {
            endpointUrl: function () { return "https://dc.services.visualstudio.com/v2/track"; },
            emitLineDelimitedJson: function () { return false; },
            maxBatchInterval: function () { return 15000; },
            maxBatchSizeInBytes: function () { return 102400; },
            disableTelemetry: function () { return false; },
            enableSessionStorageBuffer: function () { return true; },
            isRetryDisabled: function () { return false; },
            isBeaconApiDisabled: function () { return true; },
            onunloadDisableBeacon: function () { return false; },
            instrumentationKey: function () { return undefined; },
            namePrefix: function () { return undefined; },
            samplingPercentage: function () { return 100; }
        };
    };
    Sender._getEmptyAppInsightsChannelConfig = function () {
        return {
            endpointUrl: undefined,
            emitLineDelimitedJson: undefined,
            maxBatchInterval: undefined,
            maxBatchSizeInBytes: undefined,
            disableTelemetry: undefined,
            enableSessionStorageBuffer: undefined,
            isRetryDisabled: undefined,
            isBeaconApiDisabled: undefined,
            onunloadDisableBeacon: undefined,
            instrumentationKey: undefined,
            namePrefix: undefined,
            samplingPercentage: undefined
        };
    };
    Sender.prototype.pause = function () {
        throw new Error("Method not implemented.");
    };
    Sender.prototype.resume = function () {
        throw new Error("Method not implemented.");
    };
    Sender.prototype.flush = function () {
        try {
            this.triggerSend();
        }
        catch (e) {
            this.diagLog().throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["_InternalMessageId"].FlushFailed, "flush failed, telemetry will not be collected: " + _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Util"].getExceptionName(e), { exception: _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Util"].dump(e) });
        }
    };
    Sender.prototype.onunloadFlush = function () {
        if ((this._senderConfig.onunloadDisableBeacon() === false || this._senderConfig.isBeaconApiDisabled() === false) && _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Util"].IsBeaconApiSupported()) {
            try {
                this.triggerSend(true, this._beaconSender);
            }
            catch (e) {
                this.diagLog().throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["_InternalMessageId"].FailedToSendQueuedTelemetry, "failed to flush with beacon sender on page unload, telemetry will not be collected: " + _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Util"].getExceptionName(e), { exception: _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Util"].dump(e) });
            }
        }
        else {
            this.flush();
        }
    };
    Sender.prototype.teardown = function () {
        throw new Error("Method not implemented.");
    };
    Sender.prototype.initialize = function (config, core, extensions, pluginChain) {
        _super.prototype.initialize.call(this, config, core, extensions, pluginChain);
        var ctx = this._getTelCtx();
        var identifier = this.identifier;
        this._serializer = new _Serializer__WEBPACK_IMPORTED_MODULE_3__["Serializer"](core.logger);
        this._consecutiveErrors = 0;
        this._retryAt = null;
        this._lastSend = 0;
        this._sender = null;
        var defaultConfig = Sender._getDefaultAppInsightsChannelConfig();
        this._senderConfig = Sender._getEmptyAppInsightsChannelConfig();
        var _loop_1 = function (field) {
            this_1._senderConfig[field] = function () { return ctx.getConfig(identifier, field, defaultConfig[field]()); };
        };
        var this_1 = this;
        for (var field in defaultConfig) {
            _loop_1(field);
        }
        this._buffer = (this._senderConfig.enableSessionStorageBuffer && _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Util"].canUseSessionStorage())
            ? new _SendBuffer__WEBPACK_IMPORTED_MODULE_1__["SessionStorageSendBuffer"](this.diagLog(), this._senderConfig) : new _SendBuffer__WEBPACK_IMPORTED_MODULE_1__["ArraySendBuffer"](this._senderConfig);
        this._sample = new _TelemetryProcessors_Sample__WEBPACK_IMPORTED_MODULE_7__["Sample"](this._senderConfig.samplingPercentage(), this.diagLog());
        if (!this._senderConfig.isBeaconApiDisabled() && _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Util"].IsBeaconApiSupported()) {
            this._sender = this._beaconSender;
        }
        else {
            if (!_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["CoreUtils"].isUndefined(XMLHttpRequest)) {
                var testXhr = new XMLHttpRequest();
                if ("withCredentials" in testXhr) {
                    this._sender = this._xhrSender;
                    this._XMLHttpRequestSupported = true;
                }
                else if (!_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["CoreUtils"].isUndefined(XDomainRequest)) {
                    this._sender = this._xdrSender; // IE 8 and 9
                }
            }
        }
    };
    Sender.prototype.processTelemetry = function (telemetryItem, itemCtx) {
        itemCtx = this._getTelCtx(itemCtx);
        try {
            // if master off switch is set, don't send any data
            if (this._senderConfig.disableTelemetry()) {
                // Do not send/save data
                return;
            }
            // validate input
            if (!telemetryItem) {
                itemCtx.diagLog().throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["_InternalMessageId"].CannotSendEmptyTelemetry, "Cannot send empty telemetry");
                return;
            }
            // validate event
            if (telemetryItem.baseData && !telemetryItem.baseType) {
                itemCtx.diagLog().throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["_InternalMessageId"].InvalidEvent, "Cannot send telemetry without baseData and baseType");
                return;
            }
            if (!telemetryItem.baseType) {
                // Default
                telemetryItem.baseType = "EventData";
            }
            // ensure a sender was constructed
            if (!this._sender) {
                itemCtx.diagLog().throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["_InternalMessageId"].SenderNotInitialized, "Sender was not initialized");
                return;
            }
            // check if this item should be sampled in, else add sampleRate tag
            if (!this._isSampledIn(telemetryItem)) {
                // Item is sampled out, do not send it
                itemCtx.diagLog().throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["LoggingSeverity"].WARNING, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["_InternalMessageId"].TelemetrySampledAndNotSent, "Telemetry item was sampled out and not sent", { SampleRate: this._sample.sampleRate });
                return;
            }
            else {
                telemetryItem[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["SampleRate"]] = this._sample.sampleRate;
            }
            // construct an envelope that Application Insights endpoint can understand
            var aiEnvelope_1 = Sender.constructEnvelope(telemetryItem, this._senderConfig.instrumentationKey(), itemCtx.diagLog());
            if (!aiEnvelope_1) {
                itemCtx.diagLog().throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["_InternalMessageId"].CreateEnvelopeError, "Unable to create an AppInsights envelope");
                return;
            }
            var doNotSendItem_1 = false;
            // this is for running in legacy mode, where customer may already have a custom initializer present
            if (telemetryItem.tags && telemetryItem.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["ProcessLegacy"]]) {
                _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["CoreUtils"].arrForEach(telemetryItem.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["ProcessLegacy"]], function (callBack) {
                    try {
                        if (callBack && callBack(aiEnvelope_1) === false) {
                            doNotSendItem_1 = true;
                            itemCtx.diagLog().warnToConsole("Telemetry processor check returns false");
                        }
                    }
                    catch (e) {
                        // log error but dont stop executing rest of the telemetry initializers
                        // doNotSendItem = true;
                        itemCtx.diagLog().throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["_InternalMessageId"].TelemetryInitializerFailed, "One of telemetry initializers failed, telemetry item will not be sent: " + _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Util"].getExceptionName(e), { exception: _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Util"].dump(e) }, true);
                    }
                });
                delete telemetryItem.tags[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["ProcessLegacy"]];
            }
            if (doNotSendItem_1) {
                return; // do not send, no need to execute next plugin
            }
            // check if the incoming payload is too large, truncate if necessary
            var payload = this._serializer.serialize(aiEnvelope_1);
            // flush if we would exceed the max-size limit by adding this item
            var bufferPayload = this._buffer.getItems();
            var batch = this._buffer.batchPayloads(bufferPayload);
            if (batch && (batch.length + payload.length > this._senderConfig.maxBatchSizeInBytes())) {
                this.triggerSend();
            }
            // enqueue the payload
            this._buffer.enqueue(payload);
            // ensure an invocation timeout is set
            this._setupTimer();
        }
        catch (e) {
            itemCtx.diagLog().throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["LoggingSeverity"].WARNING, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["_InternalMessageId"].FailedAddingTelemetryToBuffer, "Failed adding telemetry to the sender's buffer, some telemetry will be lost: " + _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Util"].getExceptionName(e), { exception: _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Util"].dump(e) });
        }
        // hand off the telemetry item to the next plugin
        this.processNext(telemetryItem, itemCtx);
    };
    /**
     * xhr state changes
     */
    Sender.prototype._xhrReadyStateChange = function (xhr, payload, countOfItemsInPayload) {
        if (xhr.readyState === 4) {
            var response = null;
            if (!this._appId) {
                response = this._parseResponse(_getResponseText(xhr) || xhr.response);
                if (response && response.appId) {
                    this._appId = response.appId;
                }
            }
            if ((xhr.status < 200 || xhr.status >= 300) && xhr.status !== 0) {
                if (!this._senderConfig.isRetryDisabled() && this._isRetriable(xhr.status)) {
                    this._resendPayload(payload);
                    this.diagLog().throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["LoggingSeverity"].WARNING, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["_InternalMessageId"].TransmissionFailed, ". " +
                        "Response code " + xhr.status + ". Will retry to send " + payload.length + " items.");
                }
                else {
                    this._onError(payload, this._formatErrorMessageXhr(xhr));
                }
            }
            else if (_Offline__WEBPACK_IMPORTED_MODULE_6__["Offline"].isOffline()) {
                // Note: Don't check for staus == 0, since adblock gives this code
                if (!this._senderConfig.isRetryDisabled()) {
                    var offlineBackOffMultiplier = 10; // arbritrary number
                    this._resendPayload(payload, offlineBackOffMultiplier);
                    this.diagLog().throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["LoggingSeverity"].WARNING, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["_InternalMessageId"].TransmissionFailed, ". Offline - Response Code: " + xhr.status + ". Offline status: " + _Offline__WEBPACK_IMPORTED_MODULE_6__["Offline"].isOffline() + ". Will retry to send " + payload.length + " items.");
                }
            }
            else {
                if (xhr.status === 206) {
                    if (!response) {
                        response = this._parseResponse(_getResponseText(xhr) || xhr.response);
                    }
                    if (response && !this._senderConfig.isRetryDisabled()) {
                        this._onPartialSuccess(payload, response);
                    }
                    else {
                        this._onError(payload, this._formatErrorMessageXhr(xhr));
                    }
                }
                else {
                    this._consecutiveErrors = 0;
                    this._onSuccess(payload, countOfItemsInPayload);
                }
            }
        }
    };
    /**
     * Immediately send buffered data
     * @param async {boolean} - Indicates if the events should be sent asynchronously
     * @param forcedSender {SenderFunction} - Indicates the forcedSender, undefined if not passed
     */
    Sender.prototype.triggerSend = function (async, forcedSender) {
        if (async === void 0) { async = true; }
        try {
            // Send data only if disableTelemetry is false
            if (!this._senderConfig.disableTelemetry()) {
                if (this._buffer.count() > 0) {
                    var payload = this._buffer.getItems();
                    // invoke send
                    if (forcedSender) {
                        forcedSender.call(this, payload, async);
                    }
                    else {
                        this._sender(payload, async);
                    }
                }
                // update lastSend time to enable throttling
                this._lastSend = +new Date;
            }
            else {
                this._buffer.clear();
            }
            clearTimeout(this._timeoutHandle);
            this._timeoutHandle = null;
            this._retryAt = null;
        }
        catch (e) {
            /* Ignore this error for IE under v10 */
            if (!_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Util"].getIEVersion() || _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Util"].getIEVersion() > 9) {
                this.diagLog().throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["_InternalMessageId"].TransmissionFailed, "Telemetry transmission failed, some telemetry will be lost: " + _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Util"].getExceptionName(e), { exception: _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Util"].dump(e) });
            }
        }
    };
    /**
     * error handler
     */
    Sender.prototype._onError = function (payload, message, event) {
        this.diagLog().throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["LoggingSeverity"].WARNING, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["_InternalMessageId"].OnError, "Failed to send telemetry.", { message: message });
        this._buffer.clearSent(payload);
    };
    /**
     * partial success handler
     */
    Sender.prototype._onPartialSuccess = function (payload, results) {
        var failed = [];
        var retry = [];
        // Iterate through the reversed array of errors so that splicing doesn't have invalid indexes after the first item.
        var errors = results.errors.reverse();
        for (var _i = 0, errors_1 = errors; _i < errors_1.length; _i++) {
            var error = errors_1[_i];
            var extracted = payload.splice(error.index, 1)[0];
            if (this._isRetriable(error.statusCode)) {
                retry.push(extracted);
            }
            else {
                // All other errors, including: 402 (Monthly quota exceeded) and 439 (Too many requests and refresh cache).
                failed.push(extracted);
            }
        }
        if (payload.length > 0) {
            this._onSuccess(payload, results.itemsAccepted);
        }
        if (failed.length > 0) {
            this._onError(failed, this._formatErrorMessageXhr(null, ['partial success', results.itemsAccepted, 'of', results.itemsReceived].join(' ')));
        }
        if (retry.length > 0) {
            this._resendPayload(retry);
            this.diagLog().throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["LoggingSeverity"].WARNING, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["_InternalMessageId"].TransmissionFailed, "Partial success. " +
                "Delivered: " + payload.length + ", Failed: " + failed.length +
                ". Will retry to send " + retry.length + " our of " + results.itemsReceived + " items");
        }
    };
    /**
     * success handler
     */
    Sender.prototype._onSuccess = function (payload, countOfItemsInPayload) {
        this._buffer.clearSent(payload);
    };
    /**
     * xdr state changes
     */
    Sender.prototype._xdrOnLoad = function (xdr, payload) {
        var responseText = _getResponseText(xdr);
        if (xdr && (responseText + "" === "200" || responseText === "")) {
            this._consecutiveErrors = 0;
            this._onSuccess(payload, 0);
        }
        else {
            var results = this._parseResponse(responseText);
            if (results && results.itemsReceived && results.itemsReceived > results.itemsAccepted
                && !this._senderConfig.isRetryDisabled()) {
                this._onPartialSuccess(payload, results);
            }
            else {
                this._onError(payload, this._formatErrorMessageXdr(xdr));
            }
        }
    };
    Sender.prototype._isSampledIn = function (envelope) {
        return this._sample.isSampledIn(envelope);
    };
    /**
     * Send Beacon API request
     * @param payload {string} - The data payload to be sent.
     * @param isAsync {boolean} - not used
     * Note: Beacon API does not support custom headers and we are not able to get
     * appId from the backend for the correct correlation.
     */
    Sender.prototype._beaconSender = function (payload, isAsync) {
        var url = this._senderConfig.endpointUrl();
        var batch = this._buffer.batchPayloads(payload);
        // Chrome only allows CORS-safelisted values for the sendBeacon data argument
        // see: https://bugs.chromium.org/p/chromium/issues/detail?id=720283
        var plainTextBatch = new Blob([batch], { type: 'text/plain;charset=UTF-8' });
        // The sendBeacon method returns true if the user agent is able to successfully queue the data for transfer. Otherwise it returns false.
        var queued = Object(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["getNavigator"])().sendBeacon(url, plainTextBatch);
        if (queued) {
            this._buffer.markAsSent(payload);
            // no response from beaconSender, clear buffer
            this._onSuccess(payload, payload.length);
        }
        else {
            this._xhrSender(payload, true);
            this.diagLog().throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["LoggingSeverity"].WARNING, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["_InternalMessageId"].TransmissionFailed, ". " + "Failed to send telemetry with Beacon API, retried with xhrSender.");
        }
    };
    /**
     * Send XMLHttpRequest
     * @param payload {string} - The data payload to be sent.
     * @param isAsync {boolean} - Indicates if the request should be sent asynchronously
     */
    Sender.prototype._xhrSender = function (payload, isAsync) {
        var _this = this;
        var xhr = new XMLHttpRequest();
        var endPointUrl = this._senderConfig.endpointUrl();
        try {
            xhr[_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["DisabledPropertyName"]] = true;
        }
        catch (e) {
            // If the environment has locked down the XMLHttpRequest (preventExtensions and/or freeze), this would
            // cause the request to fail and we no telemetry would be sent
        }
        xhr.open("POST", endPointUrl, isAsync);
        xhr.setRequestHeader("Content-type", "application/json");
        // append Sdk-Context request header only in case of breeze endpoint
        if (_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Util"].isInternalApplicationInsightsEndpoint(endPointUrl)) {
            xhr.setRequestHeader(_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["RequestHeaders"].sdkContextHeader, _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["RequestHeaders"].sdkContextHeaderAppIdRequest);
        }
        xhr.onreadystatechange = function () { return _this._xhrReadyStateChange(xhr, payload, payload.length); };
        xhr.onerror = function (event) { return _this._onError(payload, _this._formatErrorMessageXhr(xhr), event); };
        // compose an array of payloads
        var batch = this._buffer.batchPayloads(payload);
        xhr.send(batch);
        this._buffer.markAsSent(payload);
    };
    /**
     * Parses the response from the backend.
     * @param response - XMLHttpRequest or XDomainRequest response
     */
    Sender.prototype._parseResponse = function (response) {
        try {
            if (response && response !== "") {
                var result = Object(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["getJSON"])().parse(response);
                if (result && result.itemsReceived && result.itemsReceived >= result.itemsAccepted &&
                    result.itemsReceived - result.itemsAccepted === result.errors.length) {
                    return result;
                }
            }
        }
        catch (e) {
            this.diagLog().throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["_InternalMessageId"].InvalidBackendResponse, "Cannot parse the response. " + _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_4__["Util"].getExceptionName(e), {
                response: response
            });
        }
        return null;
    };
    /**
     * Resend payload. Adds payload back to the send buffer and setup a send timer (with exponential backoff).
     * @param payload
     */
    Sender.prototype._resendPayload = function (payload, linearFactor) {
        if (linearFactor === void 0) { linearFactor = 1; }
        if (!payload || payload.length === 0) {
            return;
        }
        this._buffer.clearSent(payload);
        this._consecutiveErrors++;
        for (var _i = 0, payload_1 = payload; _i < payload_1.length; _i++) {
            var item = payload_1[_i];
            this._buffer.enqueue(item);
        }
        // setup timer
        this._setRetryTime(linearFactor);
        this._setupTimer();
    };
    /**
     * Calculates the time to wait before retrying in case of an error based on
     * http://en.wikipedia.org/wiki/Exponential_backoff
     */
    Sender.prototype._setRetryTime = function (linearFactor) {
        var SlotDelayInSeconds = 10;
        var delayInSeconds;
        if (this._consecutiveErrors <= 1) {
            delayInSeconds = SlotDelayInSeconds;
        }
        else {
            var backOffSlot = (Math.pow(2, this._consecutiveErrors) - 1) / 2;
            // tslint:disable-next-line:insecure-random
            var backOffDelay = Math.floor(Math.random() * backOffSlot * SlotDelayInSeconds) + 1;
            backOffDelay = linearFactor * backOffDelay;
            delayInSeconds = Math.max(Math.min(backOffDelay, 3600), SlotDelayInSeconds);
        }
        // TODO: Log the backoff time like the C# version does.
        var retryAfterTimeSpan = Date.now() + (delayInSeconds * 1000);
        // TODO: Log the retry at time like the C# version does.
        this._retryAt = retryAfterTimeSpan;
    };
    /**
     * Sets up the timer which triggers actually sending the data.
     */
    Sender.prototype._setupTimer = function () {
        var _this = this;
        if (!this._timeoutHandle) {
            var retryInterval = this._retryAt ? Math.max(0, this._retryAt - Date.now()) : 0;
            var timerValue = Math.max(this._senderConfig.maxBatchInterval(), retryInterval);
            this._timeoutHandle = setTimeout(function () {
                _this.triggerSend();
            }, timerValue);
        }
    };
    /**
     * Checks if the SDK should resend the payload after receiving this status code from the backend.
     * @param statusCode
     */
    Sender.prototype._isRetriable = function (statusCode) {
        return statusCode === 408 // Timeout
            || statusCode === 429 // Too many requests.
            || statusCode === 500 // Internal server error.
            || statusCode === 503; // Service unavailable.
    };
    Sender.prototype._formatErrorMessageXhr = function (xhr, message) {
        if (xhr) {
            return "XMLHttpRequest,Status:" + xhr.status + ",Response:" + _getResponseText(xhr) || false || false;
        }
        return message;
    };
    /**
     * Send XDomainRequest
     * @param payload {string} - The data payload to be sent.
     * @param isAsync {boolean} - Indicates if the request should be sent asynchronously
     *
     * Note: XDomainRequest does not support sync requests. This 'isAsync' parameter is added
     * to maintain consistency with the xhrSender's contract
     * Note: XDomainRequest does not support custom headers and we are not able to get
     * appId from the backend for the correct correlation.
     */
    Sender.prototype._xdrSender = function (payload, isAsync) {
        var _this = this;
        var _window = Object(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["getWindow"])();
        var xdr = new XDomainRequest();
        xdr.onload = function () { return _this._xdrOnLoad(xdr, payload); };
        xdr.onerror = function (event) { return _this._onError(payload, _this._formatErrorMessageXdr(xdr), event); };
        // XDomainRequest requires the same protocol as the hosting page.
        // If the protocol doesn't match, we can't send the telemetry :(.
        var hostingProtocol = _window && _window.location && _window.location.protocol || "";
        if (this._senderConfig.endpointUrl().lastIndexOf(hostingProtocol, 0) !== 0) {
            this.diagLog().throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["LoggingSeverity"].WARNING, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["_InternalMessageId"].TransmissionFailed, ". " +
                "Cannot send XDomain request. The endpoint URL protocol doesn't match the hosting page protocol.");
            this._buffer.clear();
            return;
        }
        var endpointUrl = this._senderConfig.endpointUrl().replace(/^(https?:)/, "");
        xdr.open('POST', endpointUrl);
        // compose an array of payloads
        var batch = this._buffer.batchPayloads(payload);
        xdr.send(batch);
        this._buffer.markAsSent(payload);
    };
    Sender.prototype._formatErrorMessageXdr = function (xdr, message) {
        if (xdr) {
            return "XDomainRequest,Response:" + _getResponseText(xdr) || false;
        }
        return message;
    };
    return Sender;
}(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_5__["BaseTelemetryPlugin"]));

//# sourceMappingURL=Sender.js.map

/***/ }),

/***/ "../../node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/Serializer.js":
/*!*********************************************************************************************************************************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Cognito.Web.Client/node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/Serializer.js ***!
  \*********************************************************************************************************************************************************************************************************************/
/*! exports provided: Serializer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Serializer", function() { return Serializer; });
/* harmony import */ var _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @microsoft/applicationinsights-common */ "../../node_modules/.pnpm/@microsoft+applicationinsights-common@2.5.4/node_modules/@microsoft/applicationinsights-common/dist-esm/applicationinsights-common.js");
/* harmony import */ var _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @microsoft/applicationinsights-core-js */ "../../node_modules/.pnpm/@microsoft+applicationinsights-core-js@2.5.4/node_modules/@microsoft/applicationinsights-core-js/dist-esm/applicationinsights-core-js.js");


var Serializer = /** @class */ (function () {
    function Serializer(logger) {
        this._logger = logger;
    }
    /**
     * Serializes the current object to a JSON string.
     */
    Serializer.prototype.serialize = function (input) {
        var output = this._serializeObject(input, "root");
        try {
            return Object(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["getJSON"])().stringify(output);
        }
        catch (e) {
            // if serialization fails return an empty string
            this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["_InternalMessageId"].CannotSerializeObject, (e && _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["CoreUtils"].isFunction(e.toString)) ? e.toString() : "Error serializing object", null, true);
        }
    };
    Serializer.prototype._serializeObject = function (source, name) {
        var circularReferenceCheck = "__aiCircularRefCheck";
        var output = {};
        if (!source) {
            this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["_InternalMessageId"].CannotSerializeObject, "cannot serialize object because it is null or undefined", { name: name }, true);
            return output;
        }
        if (source[circularReferenceCheck]) {
            this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["LoggingSeverity"].WARNING, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["_InternalMessageId"].CircularReferenceDetected, "Circular reference detected while serializing object", { name: name }, true);
            return output;
        }
        if (!source.aiDataContract) {
            // special case for measurements/properties/tags
            if (name === "measurements") {
                output = this._serializeStringMap(source, "number", name);
            }
            else if (name === "properties") {
                output = this._serializeStringMap(source, "string", name);
            }
            else if (name === "tags") {
                output = this._serializeStringMap(source, "string", name);
            }
            else if (_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_0__["Util"].isArray(source)) {
                output = this._serializeArray(source, name);
            }
            else {
                this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["LoggingSeverity"].WARNING, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["_InternalMessageId"].CannotSerializeObjectNonSerializable, "Attempting to serialize an object which does not implement ISerializable", { name: name }, true);
                try {
                    // verify that the object can be stringified
                    Object(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["getJSON"])().stringify(source);
                    output = source;
                }
                catch (e) {
                    // if serialization fails return an empty string
                    this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["_InternalMessageId"].CannotSerializeObject, (e && _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["CoreUtils"].isFunction(e.toString)) ? e.toString() : "Error serializing object", null, true);
                }
            }
            return output;
        }
        source[circularReferenceCheck] = true;
        for (var field in source.aiDataContract) {
            var contract = source.aiDataContract[field];
            var isRequired = (_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["CoreUtils"].isFunction(contract)) ? (contract() & _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_0__["FieldType"].Required) : (contract & _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_0__["FieldType"].Required);
            var isHidden = (_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["CoreUtils"].isFunction(contract)) ? (contract() & _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_0__["FieldType"].Hidden) : (contract & _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_0__["FieldType"].Hidden);
            var isArray = contract & _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_0__["FieldType"].Array;
            var isPresent = source[field] !== undefined;
            var isObject = _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["CoreUtils"].isObject(source[field]) && source[field] !== null;
            if (isRequired && !isPresent && !isArray) {
                this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["_InternalMessageId"].MissingRequiredFieldSpecification, "Missing required field specification. The field is required but not present on source", { field: field, name: name });
                // If not in debug mode, continue and hope the error is permissible
                continue;
            }
            if (isHidden) {
                // Don't serialize hidden fields
                continue;
            }
            var value = void 0;
            if (isObject) {
                if (isArray) {
                    // special case; resurse on each object in the source array
                    value = this._serializeArray(source[field], field);
                }
                else {
                    // recurse on the source object in this field
                    value = this._serializeObject(source[field], field);
                }
            }
            else {
                // assign the source field to the output even if undefined or required
                value = source[field];
            }
            // only emit this field if the value is defined
            if (value !== undefined) {
                output[field] = value;
            }
        }
        delete source[circularReferenceCheck];
        return output;
    };
    Serializer.prototype._serializeArray = function (sources, name) {
        var output;
        if (!!sources) {
            if (!_microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_0__["Util"].isArray(sources)) {
                this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["LoggingSeverity"].CRITICAL, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["_InternalMessageId"].ItemNotInArray, "This field was specified as an array in the contract but the item is not an array.\r\n", { name: name }, true);
            }
            else {
                output = [];
                for (var i = 0; i < sources.length; i++) {
                    var source = sources[i];
                    var item = this._serializeObject(source, name + "[" + i + "]");
                    output.push(item);
                }
            }
        }
        return output;
    };
    Serializer.prototype._serializeStringMap = function (map, expectedType, name) {
        var output;
        if (map) {
            output = {};
            for (var field in map) {
                var value = map[field];
                if (expectedType === "string") {
                    if (value === undefined) {
                        output[field] = "undefined";
                    }
                    else if (value === null) {
                        output[field] = "null";
                    }
                    else if (!value.toString) {
                        output[field] = "invalid field: toString() is not defined.";
                    }
                    else {
                        output[field] = value.toString();
                    }
                }
                else if (expectedType === "number") {
                    if (value === undefined) {
                        output[field] = "undefined";
                    }
                    else if (value === null) {
                        output[field] = "null";
                    }
                    else {
                        var num = parseFloat(value);
                        if (isNaN(num)) {
                            output[field] = "NaN";
                        }
                        else {
                            output[field] = num;
                        }
                    }
                }
                else {
                    output[field] = "invalid field: " + name + " is of unknown type.";
                    this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_1__["LoggingSeverity"].CRITICAL, output[field], null, true);
                }
            }
        }
        return output;
    };
    return Serializer;
}());

//# sourceMappingURL=Serializer.js.map

/***/ }),

/***/ "../../node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/TelemetryProcessors/Sample.js":
/*!*************************************************************************************************************************************************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Cognito.Web.Client/node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/TelemetryProcessors/Sample.js ***!
  \*************************************************************************************************************************************************************************************************************************************/
/*! exports provided: Sample */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Sample", function() { return Sample; });
/* harmony import */ var _SamplingScoreGenerators_SamplingScoreGenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./SamplingScoreGenerators/SamplingScoreGenerator */ "../../node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/TelemetryProcessors/SamplingScoreGenerators/SamplingScoreGenerator.js");
/* harmony import */ var _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @microsoft/applicationinsights-common */ "../../node_modules/.pnpm/@microsoft+applicationinsights-common@2.5.4/node_modules/@microsoft/applicationinsights-common/dist-esm/applicationinsights-common.js");
/* harmony import */ var _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @microsoft/applicationinsights-core-js */ "../../node_modules/.pnpm/@microsoft+applicationinsights-core-js@2.5.4/node_modules/@microsoft/applicationinsights-core-js/dist-esm/applicationinsights-core-js.js");
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.



var Sample = /** @class */ (function () {
    function Sample(sampleRate, logger) {
        // We're using 32 bit math, hence max value is (2^31 - 1)
        this.INT_MAX_VALUE = 2147483647;
        this._logger = _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["CoreUtils"].isNullOrUndefined(logger) ? new _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["DiagnosticLogger"]() : logger;
        if (sampleRate > 100 || sampleRate < 0) {
            this._logger.throwInternal(_microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["LoggingSeverity"].WARNING, _microsoft_applicationinsights_core_js__WEBPACK_IMPORTED_MODULE_2__["_InternalMessageId"].SampleRateOutOfRange, "Sampling rate is out of range (0..100). Sampling will be disabled, you may be sending too much data which may affect your AI service level.", { samplingRate: sampleRate }, true);
            this.sampleRate = 100;
        }
        this.sampleRate = sampleRate;
        this.samplingScoreGenerator = new _SamplingScoreGenerators_SamplingScoreGenerator__WEBPACK_IMPORTED_MODULE_0__["SamplingScoreGenerator"]();
    }
    /**
     * Determines if an envelope is sampled in (i.e. will be sent) or not (i.e. will be dropped).
     */
    Sample.prototype.isSampledIn = function (envelope) {
        var samplingPercentage = this.sampleRate; // 0 - 100
        var isSampledIn = false;
        if (samplingPercentage === null || samplingPercentage === undefined || samplingPercentage >= 100) {
            return true;
        }
        else if (envelope.baseType === _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["Metric"].dataType) {
            // exclude MetricData telemetry from sampling
            return true;
        }
        isSampledIn = this.samplingScoreGenerator.getSamplingScore(envelope) < samplingPercentage;
        return isSampledIn;
    };
    return Sample;
}());

//# sourceMappingURL=Sample.js.map

/***/ }),

/***/ "../../node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/TelemetryProcessors/SamplingScoreGenerators/HashCodeScoreGenerator.js":
/*!*****************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Cognito.Web.Client/node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/TelemetryProcessors/SamplingScoreGenerators/HashCodeScoreGenerator.js ***!
  \*****************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: HashCodeScoreGenerator */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "HashCodeScoreGenerator", function() { return HashCodeScoreGenerator; });
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
var HashCodeScoreGenerator = /** @class */ (function () {
    function HashCodeScoreGenerator() {
    }
    HashCodeScoreGenerator.prototype.getHashCodeScore = function (key) {
        var score = this.getHashCode(key) / HashCodeScoreGenerator.INT_MAX_VALUE;
        return score * 100;
    };
    HashCodeScoreGenerator.prototype.getHashCode = function (input) {
        if (input === "") {
            return 0;
        }
        while (input.length < HashCodeScoreGenerator.MIN_INPUT_LENGTH) {
            input = input.concat(input);
        }
        // 5381 is a magic number: http://stackoverflow.com/questions/10696223/reason-for-5381-number-in-djb-hash-function
        var hash = 5381;
        for (var i = 0; i < input.length; ++i) {
            hash = ((hash << 5) + hash) + input.charCodeAt(i);
            // 'hash' is of number type which means 53 bit integer (http://www.ecma-international.org/ecma-262/6.0/#sec-ecmascript-language-types-number-type)
            // 'hash & hash' will keep it 32 bit integer - just to make it clearer what the result is.
            hash = hash & hash;
        }
        return Math.abs(hash);
    };
    // We're using 32 bit math, hence max value is (2^31 - 1)
    HashCodeScoreGenerator.INT_MAX_VALUE = 2147483647;
    // (Magic number) DJB algorithm can't work on shorter strings (results in poor distribution
    HashCodeScoreGenerator.MIN_INPUT_LENGTH = 8;
    return HashCodeScoreGenerator;
}());

//# sourceMappingURL=HashCodeScoreGenerator.js.map

/***/ }),

/***/ "../../node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/TelemetryProcessors/SamplingScoreGenerators/SamplingScoreGenerator.js":
/*!*****************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Cognito.Web.Client/node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/TelemetryProcessors/SamplingScoreGenerators/SamplingScoreGenerator.js ***!
  \*****************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: SamplingScoreGenerator */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SamplingScoreGenerator", function() { return SamplingScoreGenerator; });
/* harmony import */ var _HashCodeScoreGenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./HashCodeScoreGenerator */ "../../node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/TelemetryProcessors/SamplingScoreGenerators/HashCodeScoreGenerator.js");
/* harmony import */ var _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @microsoft/applicationinsights-common */ "../../node_modules/.pnpm/@microsoft+applicationinsights-common@2.5.4/node_modules/@microsoft/applicationinsights-common/dist-esm/applicationinsights-common.js");
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.


var SamplingScoreGenerator = /** @class */ (function () {
    function SamplingScoreGenerator() {
        this.hashCodeGeneragor = new _HashCodeScoreGenerator__WEBPACK_IMPORTED_MODULE_0__["HashCodeScoreGenerator"]();
        this.keys = new _microsoft_applicationinsights_common__WEBPACK_IMPORTED_MODULE_1__["ContextTagKeys"]();
    }
    SamplingScoreGenerator.prototype.getSamplingScore = function (item) {
        var score = 0;
        if (item.tags && item.tags[this.keys.userId]) {
            score = this.hashCodeGeneragor.getHashCodeScore(item.tags[this.keys.userId]);
        }
        else if (item.ext && item.ext.user && item.ext.user.id) {
            score = this.hashCodeGeneragor.getHashCodeScore(item.ext.user.id);
        }
        else if (item.tags && item.tags[this.keys.operationId]) {
            score = this.hashCodeGeneragor.getHashCodeScore(item.tags[this.keys.operationId]);
        }
        else if (item.ext && item.ext.telemetryTrace && item.ext.telemetryTrace.traceID) {
            score = this.hashCodeGeneragor.getHashCodeScore(item.ext.telemetryTrace.traceID);
        }
        else {
            // tslint:disable-next-line:insecure-random
            score = (Math.random() * 100);
        }
        return score;
    };
    return SamplingScoreGenerator;
}());

//# sourceMappingURL=SamplingScoreGenerator.js.map

/***/ }),

/***/ "../../node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/applicationinsights-channel-js.js":
/*!*****************************************************************************************************************************************************************************************************************************************!*\
  !*** C:/Users/TylerTrotter/repos/Cognito Forms/Cognito.Web.Client/node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/applicationinsights-channel-js.js ***!
  \*****************************************************************************************************************************************************************************************************************************************/
/*! exports provided: Sender */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _Sender__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Sender */ "../../node_modules/.pnpm/@microsoft+applicationinsights-channel-js@2.5.4/node_modules/@microsoft/applicationinsights-channel-js/dist-esm/Sender.js");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Sender", function() { return _Sender__WEBPACK_IMPORTED_MODULE_0__["Sender"]; });


//# sourceMappingURL=applicationinsights-channel-js.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9DOi9Vc2Vycy9UeWxlclRyb3R0ZXIvcmVwb3MvQ29nbml0byBGb3Jtcy9Db2duaXRvLldlYi5DbGllbnQvbm9kZV9tb2R1bGVzLy5wbnBtL0BtaWNyb3NvZnQrYXBwbGljYXRpb25pbnNpZ2h0cy1jaGFubmVsLWpzQDIuNS40L25vZGVfbW9kdWxlcy9AbWljcm9zb2Z0L2FwcGxpY2F0aW9uaW5zaWdodHMtY2hhbm5lbC1qcy9kaXN0LWVzbS9FbnZlbG9wZUNyZWF0b3IuanMiLCJ3ZWJwYWNrOi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vQzovVXNlcnMvVHlsZXJUcm90dGVyL3JlcG9zL0NvZ25pdG8gRm9ybXMvQ29nbml0by5XZWIuQ2xpZW50L25vZGVfbW9kdWxlcy8ucG5wbS9AbWljcm9zb2Z0K2FwcGxpY2F0aW9uaW5zaWdodHMtY2hhbm5lbC1qc0AyLjUuNC9ub2RlX21vZHVsZXMvQG1pY3Jvc29mdC9hcHBsaWNhdGlvbmluc2lnaHRzLWNoYW5uZWwtanMvZGlzdC1lc20vT2ZmbGluZS5qcyIsIndlYnBhY2s6Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9DOi9Vc2Vycy9UeWxlclRyb3R0ZXIvcmVwb3MvQ29nbml0byBGb3Jtcy9Db2duaXRvLldlYi5DbGllbnQvbm9kZV9tb2R1bGVzLy5wbnBtL0BtaWNyb3NvZnQrYXBwbGljYXRpb25pbnNpZ2h0cy1jaGFubmVsLWpzQDIuNS40L25vZGVfbW9kdWxlcy9AbWljcm9zb2Z0L2FwcGxpY2F0aW9uaW5zaWdodHMtY2hhbm5lbC1qcy9kaXN0LWVzbS9TZW5kQnVmZmVyLmpzIiwid2VicGFjazovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL0M6L1VzZXJzL1R5bGVyVHJvdHRlci9yZXBvcy9Db2duaXRvIEZvcm1zL0NvZ25pdG8uV2ViLkNsaWVudC9ub2RlX21vZHVsZXMvLnBucG0vQG1pY3Jvc29mdCthcHBsaWNhdGlvbmluc2lnaHRzLWNoYW5uZWwtanNAMi41LjQvbm9kZV9tb2R1bGVzL0BtaWNyb3NvZnQvYXBwbGljYXRpb25pbnNpZ2h0cy1jaGFubmVsLWpzL2Rpc3QtZXNtL1NlbmRlci5qcyIsIndlYnBhY2s6Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9DOi9Vc2Vycy9UeWxlclRyb3R0ZXIvcmVwb3MvQ29nbml0byBGb3Jtcy9Db2duaXRvLldlYi5DbGllbnQvbm9kZV9tb2R1bGVzLy5wbnBtL0BtaWNyb3NvZnQrYXBwbGljYXRpb25pbnNpZ2h0cy1jaGFubmVsLWpzQDIuNS40L25vZGVfbW9kdWxlcy9AbWljcm9zb2Z0L2FwcGxpY2F0aW9uaW5zaWdodHMtY2hhbm5lbC1qcy9kaXN0LWVzbS9TZXJpYWxpemVyLmpzIiwid2VicGFjazovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL0M6L1VzZXJzL1R5bGVyVHJvdHRlci9yZXBvcy9Db2duaXRvIEZvcm1zL0NvZ25pdG8uV2ViLkNsaWVudC9ub2RlX21vZHVsZXMvLnBucG0vQG1pY3Jvc29mdCthcHBsaWNhdGlvbmluc2lnaHRzLWNoYW5uZWwtanNAMi41LjQvbm9kZV9tb2R1bGVzL0BtaWNyb3NvZnQvYXBwbGljYXRpb25pbnNpZ2h0cy1jaGFubmVsLWpzL2Rpc3QtZXNtL1RlbGVtZXRyeVByb2Nlc3NvcnMvU2FtcGxlLmpzIiwid2VicGFjazovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL0M6L1VzZXJzL1R5bGVyVHJvdHRlci9yZXBvcy9Db2duaXRvIEZvcm1zL0NvZ25pdG8uV2ViLkNsaWVudC9ub2RlX21vZHVsZXMvLnBucG0vQG1pY3Jvc29mdCthcHBsaWNhdGlvbmluc2lnaHRzLWNoYW5uZWwtanNAMi41LjQvbm9kZV9tb2R1bGVzL0BtaWNyb3NvZnQvYXBwbGljYXRpb25pbnNpZ2h0cy1jaGFubmVsLWpzL2Rpc3QtZXNtL1RlbGVtZXRyeVByb2Nlc3NvcnMvU2FtcGxpbmdTY29yZUdlbmVyYXRvcnMvSGFzaENvZGVTY29yZUdlbmVyYXRvci5qcyIsIndlYnBhY2s6Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9DOi9Vc2Vycy9UeWxlclRyb3R0ZXIvcmVwb3MvQ29nbml0byBGb3Jtcy9Db2duaXRvLldlYi5DbGllbnQvbm9kZV9tb2R1bGVzLy5wbnBtL0BtaWNyb3NvZnQrYXBwbGljYXRpb25pbnNpZ2h0cy1jaGFubmVsLWpzQDIuNS40L25vZGVfbW9kdWxlcy9AbWljcm9zb2Z0L2FwcGxpY2F0aW9uaW5zaWdodHMtY2hhbm5lbC1qcy9kaXN0LWVzbS9UZWxlbWV0cnlQcm9jZXNzb3JzL1NhbXBsaW5nU2NvcmVHZW5lcmF0b3JzL1NhbXBsaW5nU2NvcmVHZW5lcmF0b3IuanMiLCJ3ZWJwYWNrOi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vQzovVXNlcnMvVHlsZXJUcm90dGVyL3JlcG9zL0NvZ25pdG8gRm9ybXMvQ29nbml0by5XZWIuQ2xpZW50L25vZGVfbW9kdWxlcy8ucG5wbS9AbWljcm9zb2Z0K2FwcGxpY2F0aW9uaW5zaWdodHMtY2hhbm5lbC1qc0AyLjUuNC9ub2RlX21vZHVsZXMvQG1pY3Jvc29mdC9hcHBsaWNhdGlvbmluc2lnaHRzLWNoYW5uZWwtanMvZGlzdC1lc20vYXBwbGljYXRpb25pbnNpZ2h0cy1jaGFubmVsLWpzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBaUM7QUFDZ0s7QUFDdkU7QUFDMUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLGdGQUFTO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnRkFBUztBQUNqQztBQUNBO0FBQ0EsNkJBQTZCLGdGQUFTO0FBQ3RDO0FBQ0E7QUFDQSw2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akNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNrRTtBQUNLO0FBQ3ZFO0FBQ0E7QUFDQSxxQ0FBcUMsOEVBQXNCO0FBQzNELHdCQUF3QixvRkFBYztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDaUM7QUFDbEMsa0Q7Ozs7Ozs7Ozs7OztBQ2hDQTtBQUFBO0FBQUE7QUFBQTtBQUFrQztBQUNsQywwRCIsImZpbGUiOiJucG0ubWljcm9zb2Z0K2FwcGxpY2F0aW9uaW5zaWdodHMtY2hhbm5lbC1qc0AyLjUuNC43MWQ3MmZkODU3NTIzMzNiNDkwZi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHRzbGliXzEgZnJvbSBcInRzbGliXCI7XHJcbmltcG9ydCB7IERhdGEsIEVudmVsb3BlLCBSZW1vdGVEZXBlbmRlbmN5RGF0YSwgRXZlbnQsIEV4Y2VwdGlvbiwgTWV0cmljLCBQYWdlVmlldywgVHJhY2UsIFBhZ2VWaWV3UGVyZm9ybWFuY2UsIEN0eFRhZ0tleXMsIEh0dHBNZXRob2QsIFNhbXBsZVJhdGUgfSBmcm9tICdAbWljcm9zb2Z0L2FwcGxpY2F0aW9uaW5zaWdodHMtY29tbW9uJztcclxuaW1wb3J0IHsgQ29yZVV0aWxzLCBMb2dnaW5nU2V2ZXJpdHksIF9JbnRlcm5hbE1lc3NhZ2VJZCwgaGFzSlNPTiwgZ2V0SlNPTiB9IGZyb20gJ0BtaWNyb3NvZnQvYXBwbGljYXRpb25pbnNpZ2h0cy1jb3JlLWpzJztcclxuLy8gdGhlc2UgdHdvIGNvbnN0YW50cyBhcmUgdXNlZCB0byBmaWx0ZXIgb3V0IHByb3BlcnRpZXMgbm90IG5lZWRlZCB3aGVuIHRyeWluZyB0byBleHRyYWN0IGN1c3RvbSBwcm9wZXJ0aWVzIGFuZCBtZWFzdXJlbWVudHMgZnJvbSB0aGUgaW5jb21pbmcgcGF5bG9hZFxyXG52YXIgYmFzZVR5cGUgPSBcImJhc2VUeXBlXCI7XHJcbnZhciBiYXNlRGF0YSA9IFwiYmFzZURhdGFcIjtcclxudmFyIEVudmVsb3BlQ3JlYXRvciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEVudmVsb3BlQ3JlYXRvcigpIHtcclxuICAgIH1cclxuICAgIEVudmVsb3BlQ3JlYXRvci5leHRyYWN0UHJvcHNBbmRNZWFzdXJlbWVudHMgPSBmdW5jdGlvbiAoZGF0YSwgcHJvcGVydGllcywgbWVhc3VyZW1lbnRzKSB7XHJcbiAgICAgICAgaWYgKCFDb3JlVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQoZGF0YSkpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KGtleSkpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBkYXRhW2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKENvcmVVdGlscy5pc051bWJlcih2YWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVhc3VyZW1lbnRzW2tleV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoQ29yZVV0aWxzLmlzU3RyaW5nKHZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzW2tleV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaGFzSlNPTigpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXNba2V5XSA9IGdldEpTT04oKS5zdHJpbmdpZnkodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICAvLyBUT0RPOiBEbyB3ZSB3YW50IHRoaXMgdG8gdGFrZSBsb2dnZXIgYXMgYXJnIG9yIHVzZSB0aGlzLl9sb2dnZXIgYXMgbm9uc3RhdGljP1xyXG4gICAgRW52ZWxvcGVDcmVhdG9yLmNyZWF0ZUVudmVsb3BlID0gZnVuY3Rpb24gKGxvZ2dlciwgZW52ZWxvcGVUeXBlLCB0ZWxlbWV0cnlJdGVtLCBkYXRhKSB7XHJcbiAgICAgICAgdmFyIGVudmVsb3BlID0gbmV3IEVudmVsb3BlKGxvZ2dlciwgZGF0YSwgZW52ZWxvcGVUeXBlKTtcclxuICAgICAgICBpZiAodGVsZW1ldHJ5SXRlbVtTYW1wbGVSYXRlXSkge1xyXG4gICAgICAgICAgICBlbnZlbG9wZS5zYW1wbGVSYXRlID0gdGVsZW1ldHJ5SXRlbVtTYW1wbGVSYXRlXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZW52ZWxvcGUuaUtleSA9IHRlbGVtZXRyeUl0ZW0uaUtleTtcclxuICAgICAgICB2YXIgaUtleU5vRGFzaGVzID0gdGVsZW1ldHJ5SXRlbS5pS2V5LnJlcGxhY2UoLy0vZywgXCJcIik7XHJcbiAgICAgICAgZW52ZWxvcGUubmFtZSA9IGVudmVsb3BlLm5hbWUucmVwbGFjZShcInswfVwiLCBpS2V5Tm9EYXNoZXMpO1xyXG4gICAgICAgIC8vIGV4dHJhY3QgYWxsIGV4dGVuc2lvbnMgZnJvbSBjdHhcclxuICAgICAgICBFbnZlbG9wZUNyZWF0b3IuZXh0cmFjdFBhcnRBRXh0ZW5zaW9ucyh0ZWxlbWV0cnlJdGVtLCBlbnZlbG9wZSk7XHJcbiAgICAgICAgLy8gbG9vcCB0aHJvdWdoIHRoZSBlbnZlbG9wZSB0YWdzIChleHRlbnNpb24gb2YgUGFydCBBKSBhbmQgcGljayBvdXQgdGhlIG9uZXMgdGhhdCBzaG91bGQgZ28gaW4gb3V0Z29pbmcgZW52ZWxvcGUgdGFnc1xyXG4gICAgICAgIGlmICghdGVsZW1ldHJ5SXRlbS50YWdzKSB7XHJcbiAgICAgICAgICAgIHRlbGVtZXRyeUl0ZW0udGFncyA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZW52ZWxvcGU7XHJcbiAgICB9O1xyXG4gICAgLypcclxuICAgICAqIE1hcHMgUGFydCBBIGRhdGEgZnJvbSBDUyA0LjBcclxuICAgICAqL1xyXG4gICAgRW52ZWxvcGVDcmVhdG9yLmV4dHJhY3RQYXJ0QUV4dGVuc2lvbnMgPSBmdW5jdGlvbiAoaXRlbSwgZW52KSB7XHJcbiAgICAgICAgLy8gdG9kbzogc3dpdGNoIHRvIGtleXMgZnJvbSBjb21tb24gaW4gdGhpcyBtZXRob2RcclxuICAgICAgICBpZiAoIWVudi50YWdzKSB7XHJcbiAgICAgICAgICAgIGVudi50YWdzID0ge307XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghaXRlbS5leHQpIHtcclxuICAgICAgICAgICAgaXRlbS5leHQgPSB7fTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFpdGVtLnRhZ3MpIHtcclxuICAgICAgICAgICAgaXRlbS50YWdzID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpdGVtLmV4dC51c2VyKSB7XHJcbiAgICAgICAgICAgIGlmIChpdGVtLmV4dC51c2VyLmF1dGhJZCkge1xyXG4gICAgICAgICAgICAgICAgZW52LnRhZ3NbQ3R4VGFnS2V5cy51c2VyQXV0aFVzZXJJZF0gPSBpdGVtLmV4dC51c2VyLmF1dGhJZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgdXNlcklkID0gaXRlbS5leHQudXNlci5pZCB8fCBpdGVtLmV4dC51c2VyLmxvY2FsSWQ7XHJcbiAgICAgICAgICAgIGlmICh1c2VySWQpIHtcclxuICAgICAgICAgICAgICAgIGVudi50YWdzW0N0eFRhZ0tleXMudXNlcklkXSA9IHVzZXJJZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaXRlbS5leHQuYXBwKSB7XHJcbiAgICAgICAgICAgIGlmIChpdGVtLmV4dC5hcHAuc2VzSWQpIHtcclxuICAgICAgICAgICAgICAgIGVudi50YWdzW0N0eFRhZ0tleXMuc2Vzc2lvbklkXSA9IGl0ZW0uZXh0LmFwcC5zZXNJZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaXRlbS5leHQuZGV2aWNlKSB7XHJcbiAgICAgICAgICAgIGlmIChpdGVtLmV4dC5kZXZpY2UuaWQgfHwgaXRlbS5leHQuZGV2aWNlLmxvY2FsSWQpIHtcclxuICAgICAgICAgICAgICAgIGVudi50YWdzW0N0eFRhZ0tleXMuZGV2aWNlSWRdID0gaXRlbS5leHQuZGV2aWNlLmlkIHx8IGl0ZW0uZXh0LmRldmljZS5sb2NhbElkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpdGVtLmV4dC5kZXZpY2UuZGV2aWNlQ2xhc3MpIHtcclxuICAgICAgICAgICAgICAgIGVudi50YWdzW0N0eFRhZ0tleXMuZGV2aWNlVHlwZV0gPSBpdGVtLmV4dC5kZXZpY2UuZGV2aWNlQ2xhc3M7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGl0ZW0uZXh0LmRldmljZS5pcCkge1xyXG4gICAgICAgICAgICAgICAgZW52LnRhZ3NbQ3R4VGFnS2V5cy5kZXZpY2VJcF0gPSBpdGVtLmV4dC5kZXZpY2UuaXA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGl0ZW0uZXh0LndlYikge1xyXG4gICAgICAgICAgICB2YXIgd2ViID0gaXRlbS5leHQud2ViO1xyXG4gICAgICAgICAgICBpZiAod2ViLmJyb3dzZXJMYW5nKSB7XHJcbiAgICAgICAgICAgICAgICBlbnYudGFnc1tDdHhUYWdLZXlzLmRldmljZUxhbmd1YWdlXSA9IHdlYi5icm93c2VyTGFuZztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAod2ViLmJyb3dzZXJWZXIpIHtcclxuICAgICAgICAgICAgICAgIGVudi50YWdzW0N0eFRhZ0tleXMuZGV2aWNlQnJvd3NlclZlcnNpb25dID0gd2ViLmJyb3dzZXJWZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHdlYi5icm93c2VyKSB7XHJcbiAgICAgICAgICAgICAgICBlbnYudGFnc1tDdHhUYWdLZXlzLmRldmljZUJyb3dzZXJdID0gd2ViLmJyb3dzZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZW52LmRhdGEgPSBlbnYuZGF0YSB8fCB7fTtcclxuICAgICAgICAgICAgZW52LmRhdGEuYmFzZURhdGEgPSBlbnYuZGF0YS5iYXNlRGF0YSB8fCB7fTtcclxuICAgICAgICAgICAgZW52LmRhdGEuYmFzZURhdGEucHJvcGVydGllcyA9IGVudi5kYXRhLmJhc2VEYXRhLnByb3BlcnRpZXMgfHwge307XHJcbiAgICAgICAgICAgIGlmICh3ZWIuZG9tYWluKSB7XHJcbiAgICAgICAgICAgICAgICBlbnYuZGF0YS5iYXNlRGF0YS5wcm9wZXJ0aWVzWydkb21haW4nXSA9IHdlYi5kb21haW47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHdlYi5pc01hbnVhbCkge1xyXG4gICAgICAgICAgICAgICAgZW52LmRhdGEuYmFzZURhdGEucHJvcGVydGllc1snaXNNYW51YWwnXSA9IHdlYi5pc01hbnVhbC50b1N0cmluZygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh3ZWIuc2NyZWVuUmVzKSB7XHJcbiAgICAgICAgICAgICAgICBlbnYuZGF0YS5iYXNlRGF0YS5wcm9wZXJ0aWVzWydzY3JlZW5SZXMnXSA9IHdlYi5zY3JlZW5SZXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHdlYi51c2VyQ29uc2VudCkge1xyXG4gICAgICAgICAgICAgICAgZW52LmRhdGEuYmFzZURhdGEucHJvcGVydGllc1sndXNlckNvbnNlbnQnXSA9IHdlYi51c2VyQ29uc2VudC50b1N0cmluZygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpdGVtLmV4dC5kZXZpY2UpIHtcclxuICAgICAgICAgICAgaWYgKGl0ZW0uZXh0LmRldmljZS5tb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgZW52LnRhZ3NbQ3R4VGFnS2V5cy5kZXZpY2VNb2RlbF0gPSBpdGVtLmV4dC5kZXZpY2UubW9kZWw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGl0ZW0uZXh0Lm9zICYmIGl0ZW0uZXh0Lm9zLm5hbWUpIHtcclxuICAgICAgICAgICAgZW52LnRhZ3NbQ3R4VGFnS2V5cy5kZXZpY2VPU10gPSBpdGVtLmV4dC5vcy5uYW1lO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaXRlbS5leHQuZGV2aWNlKSB7XHJcbiAgICAgICAgICAgIGlmIChpdGVtLmV4dC5kZXZpY2UuZGV2aWNlVHlwZSkge1xyXG4gICAgICAgICAgICAgICAgZW52LnRhZ3NbQ3R4VGFnS2V5cy5kZXZpY2VUeXBlXSA9IGl0ZW0uZXh0LmRldmljZS5kZXZpY2VUeXBlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIE5vIHN1cHBvcnQgZm9yIG1hcHBpbmcgVHJhY2UudHJhY2VTdGF0ZSB0byAyLjAgYXMgaXQgaXMgY3VycmVudGx5IGVtcHR5XHJcbiAgICAgICAgaWYgKGl0ZW0uZXh0LnRyYWNlKSB7XHJcbiAgICAgICAgICAgIGlmIChpdGVtLmV4dC50cmFjZS5wYXJlbnRJRCkge1xyXG4gICAgICAgICAgICAgICAgZW52LnRhZ3NbQ3R4VGFnS2V5cy5vcGVyYXRpb25QYXJlbnRJZF0gPSBpdGVtLmV4dC50cmFjZS5wYXJlbnRJRDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaXRlbS5leHQudHJhY2UubmFtZSkge1xyXG4gICAgICAgICAgICAgICAgZW52LnRhZ3NbQ3R4VGFnS2V5cy5vcGVyYXRpb25OYW1lXSA9IGl0ZW0uZXh0LnRyYWNlLm5hbWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGl0ZW0uZXh0LnRyYWNlLnRyYWNlSUQpIHtcclxuICAgICAgICAgICAgICAgIGVudi50YWdzW0N0eFRhZ0tleXMub3BlcmF0aW9uSWRdID0gaXRlbS5leHQudHJhY2UudHJhY2VJRDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBTYW1wbGUgNC4wIHNjaGVtYVxyXG4gICAgICAgIC8vICB7XHJcbiAgICAgICAgLy8gICAgIFwidGltZVwiIDogXCIyMDE4LTA5LTA1VDIyOjUxOjIyLjQ5MzZaXCIsXHJcbiAgICAgICAgLy8gICAgIFwibmFtZVwiIDogXCJNZXRyaWNXaXRoTmFtZXNwYWNlXCIsXHJcbiAgICAgICAgLy8gICAgIFwiaUtleVwiIDogXCJBQkMtNWE0Y2JkMjAtZTYwMS00ZWY1LWEzYzYtNWQ2NTc3ZTQzOThlXCIsXHJcbiAgICAgICAgLy8gICAgIFwiZXh0XCI6IHsgIFwiY2xvdWRcIjoge1xyXG4gICAgICAgIC8vICAgICAgICAgIFwicm9sZVwiOiBcIldBVFNPTjNcIixcclxuICAgICAgICAvLyAgICAgICAgICBcInJvbGVJbnN0YW5jZVwiOiBcIkNPNEFFQVAwMDAwMDI2MFwiXHJcbiAgICAgICAgLy8gICAgICB9LFxyXG4gICAgICAgIC8vICAgICAgXCJkZXZpY2VcIjoge30sIFwiY29ycmVsYXRpb25cIjoge30gfSxcclxuICAgICAgICAvLyAgICAgIFwidGFnc1wiOiBbXHJcbiAgICAgICAgLy8gICAgICAgIHsgXCJhbWF6b24ucmVnaW9uXCIgOiBcImVhc3QyXCIgfSxcclxuICAgICAgICAvLyAgICAgICAgeyBcIm9zLmV4cGlkXCIgOiBcIndwOjAyZGYyMzlcIiB9XHJcbiAgICAgICAgLy8gICAgIF1cclxuICAgICAgICAvLyAgIH1cclxuICAgICAgICB2YXIgdGdzID0ge307XHJcbiAgICAgICAgdmFyIF9sb29wXzEgPSBmdW5jdGlvbiAoaSkge1xyXG4gICAgICAgICAgICB2YXIgdGcgPSBpdGVtLnRhZ3NbaV07XHJcbiAgICAgICAgICAgIC8vIENvcmVVdGlscy5vYmpLZXlzIHJldHVybnMgYW4gYXJyYXkgb2Yga2V5c1xyXG4gICAgICAgICAgICBDb3JlVXRpbHMuYXJyRm9yRWFjaChDb3JlVXRpbHMub2JqS2V5cyh0ZyksIGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICAgICAgICAgIHRnc1trZXldID0gdGdba2V5XTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGl0ZW0udGFncy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvLyBkZWFscyB3aXRoIHRhZ3MucHVzaCh7b2JqZWN0fSlcclxuICAgICAgICBmb3IgKHZhciBpID0gaXRlbS50YWdzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgICAgIF9sb29wXzEoaSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGRlYWxzIHdpdGggdGFnc1trZXldPXZhbHVlXHJcbiAgICAgICAgZm9yICh2YXIgdGcgaW4gaXRlbS50YWdzKSB7XHJcbiAgICAgICAgICAgIHRnc1t0Z10gPSBpdGVtLnRhZ3NbdGddO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbnYudGFncyA9IHRzbGliXzEuX19hc3NpZ24oe30sIGVudi50YWdzLCB0Z3MpO1xyXG4gICAgICAgIGlmICghZW52LnRhZ3NbQ3R4VGFnS2V5cy5pbnRlcm5hbFNka1ZlcnNpb25dKSB7XHJcbiAgICAgICAgICAgIC8vIEFwcGVuZCBhIHZlcnNpb24gaW4gY2FzZSBpdCBpcyBub3QgYWxyZWFkeSBzZXRcclxuICAgICAgICAgICAgZW52LnRhZ3NbQ3R4VGFnS2V5cy5pbnRlcm5hbFNka1ZlcnNpb25dID0gXCJqYXZhc2NyaXB0OlwiICsgRW52ZWxvcGVDcmVhdG9yLlZlcnNpb247XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEVudmVsb3BlQ3JlYXRvci5WZXJzaW9uID0gXCIyLjUuNFwiO1xyXG4gICAgcmV0dXJuIEVudmVsb3BlQ3JlYXRvcjtcclxufSgpKTtcclxuZXhwb3J0IHsgRW52ZWxvcGVDcmVhdG9yIH07XHJcbnZhciBEZXBlbmRlbmN5RW52ZWxvcGVDcmVhdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgdHNsaWJfMS5fX2V4dGVuZHMoRGVwZW5kZW5jeUVudmVsb3BlQ3JlYXRvciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIERlcGVuZGVuY3lFbnZlbG9wZUNyZWF0b3IoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgRGVwZW5kZW5jeUVudmVsb3BlQ3JlYXRvci5wcm90b3R5cGUuQ3JlYXRlID0gZnVuY3Rpb24gKGxvZ2dlciwgdGVsZW1ldHJ5SXRlbSkge1xyXG4gICAgICAgIHRoaXMuX2xvZ2dlciA9IGxvZ2dlcjtcclxuICAgICAgICBpZiAoQ29yZVV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKHRlbGVtZXRyeUl0ZW0uYmFzZURhdGEpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2xvZ2dlci50aHJvd0ludGVybmFsKExvZ2dpbmdTZXZlcml0eS5DUklUSUNBTCwgX0ludGVybmFsTWVzc2FnZUlkLlRlbGVtZXRyeUVudmVsb3BlSW52YWxpZCwgXCJ0ZWxlbWV0cnlJdGVtLmJhc2VEYXRhIGNhbm5vdCBiZSBudWxsLlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGN1c3RvbU1lYXN1cmVtZW50cyA9IHRlbGVtZXRyeUl0ZW0uYmFzZURhdGEubWVhc3VyZW1lbnRzIHx8IHt9O1xyXG4gICAgICAgIHZhciBjdXN0b21Qcm9wZXJ0aWVzID0gdGVsZW1ldHJ5SXRlbS5iYXNlRGF0YS5wcm9wZXJ0aWVzIHx8IHt9O1xyXG4gICAgICAgIEVudmVsb3BlQ3JlYXRvci5leHRyYWN0UHJvcHNBbmRNZWFzdXJlbWVudHModGVsZW1ldHJ5SXRlbS5kYXRhLCBjdXN0b21Qcm9wZXJ0aWVzLCBjdXN0b21NZWFzdXJlbWVudHMpO1xyXG4gICAgICAgIHZhciBiZCA9IHRlbGVtZXRyeUl0ZW0uYmFzZURhdGE7XHJcbiAgICAgICAgaWYgKENvcmVVdGlscy5pc051bGxPclVuZGVmaW5lZChiZCkpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLndhcm5Ub0NvbnNvbGUoXCJJbnZhbGlkIGlucHV0IGZvciBkZXBlbmRlbmN5IGRhdGFcIik7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgaWQgPSBiZC5pZDtcclxuICAgICAgICB2YXIgYWJzb2x1dGVVcmwgPSBiZC50YXJnZXQ7XHJcbiAgICAgICAgdmFyIGNvbW1hbmQgPSBiZC5uYW1lO1xyXG4gICAgICAgIHZhciBkdXJhdGlvbiA9IGJkLmR1cmF0aW9uO1xyXG4gICAgICAgIHZhciBzdWNjZXNzID0gYmQuc3VjY2VzcztcclxuICAgICAgICB2YXIgcmVzdWx0Q29kZSA9IGJkLnJlc3BvbnNlQ29kZTtcclxuICAgICAgICB2YXIgcmVxdWVzdEFQSSA9IGJkLnR5cGU7XHJcbiAgICAgICAgdmFyIGNvcnJlbGF0aW9uQ29udGV4dCA9IGJkLmNvcnJlbGF0aW9uQ29udGV4dDtcclxuICAgICAgICB2YXIgbWV0aG9kID0gYmQucHJvcGVydGllcyAmJiBiZC5wcm9wZXJ0aWVzW0h0dHBNZXRob2RdID8gYmQucHJvcGVydGllc1tIdHRwTWV0aG9kXSA6IFwiR0VUXCI7XHJcbiAgICAgICAgdmFyIGJhc2VEYXRhID0gbmV3IFJlbW90ZURlcGVuZGVuY3lEYXRhKGxvZ2dlciwgaWQsIGFic29sdXRlVXJsLCBjb21tYW5kLCBkdXJhdGlvbiwgc3VjY2VzcywgcmVzdWx0Q29kZSwgbWV0aG9kLCByZXF1ZXN0QVBJLCBjb3JyZWxhdGlvbkNvbnRleHQsIGN1c3RvbVByb3BlcnRpZXMsIGN1c3RvbU1lYXN1cmVtZW50cyk7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBuZXcgRGF0YShSZW1vdGVEZXBlbmRlbmN5RGF0YS5kYXRhVHlwZSwgYmFzZURhdGEpO1xyXG4gICAgICAgIHJldHVybiBFbnZlbG9wZUNyZWF0b3IuY3JlYXRlRW52ZWxvcGUobG9nZ2VyLCBSZW1vdGVEZXBlbmRlbmN5RGF0YS5lbnZlbG9wZVR5cGUsIHRlbGVtZXRyeUl0ZW0sIGRhdGEpO1xyXG4gICAgfTtcclxuICAgIERlcGVuZGVuY3lFbnZlbG9wZUNyZWF0b3IuRGVwZW5kZW5jeUVudmVsb3BlQ3JlYXRvciA9IG5ldyBEZXBlbmRlbmN5RW52ZWxvcGVDcmVhdG9yKCk7XHJcbiAgICByZXR1cm4gRGVwZW5kZW5jeUVudmVsb3BlQ3JlYXRvcjtcclxufShFbnZlbG9wZUNyZWF0b3IpKTtcclxuZXhwb3J0IHsgRGVwZW5kZW5jeUVudmVsb3BlQ3JlYXRvciB9O1xyXG52YXIgRXZlbnRFbnZlbG9wZUNyZWF0b3IgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICB0c2xpYl8xLl9fZXh0ZW5kcyhFdmVudEVudmVsb3BlQ3JlYXRvciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEV2ZW50RW52ZWxvcGVDcmVhdG9yKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIEV2ZW50RW52ZWxvcGVDcmVhdG9yLnByb3RvdHlwZS5DcmVhdGUgPSBmdW5jdGlvbiAobG9nZ2VyLCB0ZWxlbWV0cnlJdGVtKSB7XHJcbiAgICAgICAgdGhpcy5fbG9nZ2VyID0gbG9nZ2VyO1xyXG4gICAgICAgIGlmIChDb3JlVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQodGVsZW1ldHJ5SXRlbS5iYXNlRGF0YSkpIHtcclxuICAgICAgICAgICAgdGhpcy5fbG9nZ2VyLnRocm93SW50ZXJuYWwoTG9nZ2luZ1NldmVyaXR5LkNSSVRJQ0FMLCBfSW50ZXJuYWxNZXNzYWdlSWQuVGVsZW1ldHJ5RW52ZWxvcGVJbnZhbGlkLCBcInRlbGVtZXRyeUl0ZW0uYmFzZURhdGEgY2Fubm90IGJlIG51bGwuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgY3VzdG9tUHJvcGVydGllcyA9IHt9O1xyXG4gICAgICAgIHZhciBjdXN0b21NZWFzdXJlbWVudHMgPSB7fTtcclxuICAgICAgICBpZiAodGVsZW1ldHJ5SXRlbS5iYXNlVHlwZSAhPT0gRXZlbnQuZGF0YVR5cGUpIHtcclxuICAgICAgICAgICAgY3VzdG9tUHJvcGVydGllc1snYmFzZVR5cGVTb3VyY2UnXSA9IHRlbGVtZXRyeUl0ZW0uYmFzZVR5cGU7IC8vIHNhdmUgdGhlIHBhc3NlZCBpbiBiYXNlIHR5cGUgYXMgYSBwcm9wZXJ0eVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGVsZW1ldHJ5SXRlbS5iYXNlVHlwZSA9PT0gRXZlbnQuZGF0YVR5cGUpIHtcclxuICAgICAgICAgICAgY3VzdG9tUHJvcGVydGllcyA9IHRlbGVtZXRyeUl0ZW0uYmFzZURhdGEucHJvcGVydGllcyB8fCB7fTtcclxuICAgICAgICAgICAgY3VzdG9tTWVhc3VyZW1lbnRzID0gdGVsZW1ldHJ5SXRlbS5iYXNlRGF0YS5tZWFzdXJlbWVudHMgfHwge307XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGVsZW1ldHJ5SXRlbS5iYXNlRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgRW52ZWxvcGVDcmVhdG9yLmV4dHJhY3RQcm9wc0FuZE1lYXN1cmVtZW50cyh0ZWxlbWV0cnlJdGVtLmJhc2VEYXRhLCBjdXN0b21Qcm9wZXJ0aWVzLCBjdXN0b21NZWFzdXJlbWVudHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEV4cmFjdCByb290IGxldmVsIHByb3BlcnRpZXMgZnJvbSBwYXJ0IEMgdGVsZW1ldHJ5SXRlbS5kYXRhXHJcbiAgICAgICAgRW52ZWxvcGVDcmVhdG9yLmV4dHJhY3RQcm9wc0FuZE1lYXN1cmVtZW50cyh0ZWxlbWV0cnlJdGVtLmRhdGEsIGN1c3RvbVByb3BlcnRpZXMsIGN1c3RvbU1lYXN1cmVtZW50cyk7XHJcbiAgICAgICAgdmFyIGV2ZW50TmFtZSA9IHRlbGVtZXRyeUl0ZW0uYmFzZURhdGEubmFtZTtcclxuICAgICAgICB2YXIgYmFzZURhdGEgPSBuZXcgRXZlbnQobG9nZ2VyLCBldmVudE5hbWUsIGN1c3RvbVByb3BlcnRpZXMsIGN1c3RvbU1lYXN1cmVtZW50cyk7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBuZXcgRGF0YShFdmVudC5kYXRhVHlwZSwgYmFzZURhdGEpO1xyXG4gICAgICAgIHJldHVybiBFbnZlbG9wZUNyZWF0b3IuY3JlYXRlRW52ZWxvcGUobG9nZ2VyLCBFdmVudC5lbnZlbG9wZVR5cGUsIHRlbGVtZXRyeUl0ZW0sIGRhdGEpO1xyXG4gICAgfTtcclxuICAgIEV2ZW50RW52ZWxvcGVDcmVhdG9yLkV2ZW50RW52ZWxvcGVDcmVhdG9yID0gbmV3IEV2ZW50RW52ZWxvcGVDcmVhdG9yKCk7XHJcbiAgICByZXR1cm4gRXZlbnRFbnZlbG9wZUNyZWF0b3I7XHJcbn0oRW52ZWxvcGVDcmVhdG9yKSk7XHJcbmV4cG9ydCB7IEV2ZW50RW52ZWxvcGVDcmVhdG9yIH07XHJcbnZhciBFeGNlcHRpb25FbnZlbG9wZUNyZWF0b3IgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICB0c2xpYl8xLl9fZXh0ZW5kcyhFeGNlcHRpb25FbnZlbG9wZUNyZWF0b3IsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBFeGNlcHRpb25FbnZlbG9wZUNyZWF0b3IoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgRXhjZXB0aW9uRW52ZWxvcGVDcmVhdG9yLnByb3RvdHlwZS5DcmVhdGUgPSBmdW5jdGlvbiAobG9nZ2VyLCB0ZWxlbWV0cnlJdGVtKSB7XHJcbiAgICAgICAgdGhpcy5fbG9nZ2VyID0gbG9nZ2VyO1xyXG4gICAgICAgIGlmIChDb3JlVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQodGVsZW1ldHJ5SXRlbS5iYXNlRGF0YSkpIHtcclxuICAgICAgICAgICAgdGhpcy5fbG9nZ2VyLnRocm93SW50ZXJuYWwoTG9nZ2luZ1NldmVyaXR5LkNSSVRJQ0FMLCBfSW50ZXJuYWxNZXNzYWdlSWQuVGVsZW1ldHJ5RW52ZWxvcGVJbnZhbGlkLCBcInRlbGVtZXRyeUl0ZW0uYmFzZURhdGEgY2Fubm90IGJlIG51bGwuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgYmQgPSB0ZWxlbWV0cnlJdGVtLmJhc2VEYXRhO1xyXG4gICAgICAgIHZhciBiYXNlRGF0YSA9IEV4Y2VwdGlvbi5DcmVhdGVGcm9tSW50ZXJmYWNlKGxvZ2dlciwgYmQpO1xyXG4gICAgICAgIHZhciBkYXRhID0gbmV3IERhdGEoRXhjZXB0aW9uLmRhdGFUeXBlLCBiYXNlRGF0YSk7XHJcbiAgICAgICAgcmV0dXJuIEVudmVsb3BlQ3JlYXRvci5jcmVhdGVFbnZlbG9wZShsb2dnZXIsIEV4Y2VwdGlvbi5lbnZlbG9wZVR5cGUsIHRlbGVtZXRyeUl0ZW0sIGRhdGEpO1xyXG4gICAgfTtcclxuICAgIEV4Y2VwdGlvbkVudmVsb3BlQ3JlYXRvci5FeGNlcHRpb25FbnZlbG9wZUNyZWF0b3IgPSBuZXcgRXhjZXB0aW9uRW52ZWxvcGVDcmVhdG9yKCk7XHJcbiAgICByZXR1cm4gRXhjZXB0aW9uRW52ZWxvcGVDcmVhdG9yO1xyXG59KEVudmVsb3BlQ3JlYXRvcikpO1xyXG5leHBvcnQgeyBFeGNlcHRpb25FbnZlbG9wZUNyZWF0b3IgfTtcclxudmFyIE1ldHJpY0VudmVsb3BlQ3JlYXRvciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIHRzbGliXzEuX19leHRlbmRzKE1ldHJpY0VudmVsb3BlQ3JlYXRvciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIE1ldHJpY0VudmVsb3BlQ3JlYXRvcigpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICBNZXRyaWNFbnZlbG9wZUNyZWF0b3IucHJvdG90eXBlLkNyZWF0ZSA9IGZ1bmN0aW9uIChsb2dnZXIsIHRlbGVtZXRyeUl0ZW0pIHtcclxuICAgICAgICB0aGlzLl9sb2dnZXIgPSBsb2dnZXI7XHJcbiAgICAgICAgaWYgKENvcmVVdGlscy5pc051bGxPclVuZGVmaW5lZCh0ZWxlbWV0cnlJdGVtLmJhc2VEYXRhKSkge1xyXG4gICAgICAgICAgICB0aGlzLl9sb2dnZXIudGhyb3dJbnRlcm5hbChMb2dnaW5nU2V2ZXJpdHkuQ1JJVElDQUwsIF9JbnRlcm5hbE1lc3NhZ2VJZC5UZWxlbWV0cnlFbnZlbG9wZUludmFsaWQsIFwidGVsZW1ldHJ5SXRlbS5iYXNlRGF0YSBjYW5ub3QgYmUgbnVsbC5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBwcm9wcyA9IHRlbGVtZXRyeUl0ZW0uYmFzZURhdGEucHJvcGVydGllcyB8fCB7fTtcclxuICAgICAgICB2YXIgbWVhc3VyZW1lbnRzID0gdGVsZW1ldHJ5SXRlbS5iYXNlRGF0YS5tZWFzdXJlbWVudHMgfHwge307XHJcbiAgICAgICAgRW52ZWxvcGVDcmVhdG9yLmV4dHJhY3RQcm9wc0FuZE1lYXN1cmVtZW50cyh0ZWxlbWV0cnlJdGVtLmRhdGEsIHByb3BzLCBtZWFzdXJlbWVudHMpO1xyXG4gICAgICAgIHZhciBuYW1lID0gdGVsZW1ldHJ5SXRlbS5iYXNlRGF0YS5uYW1lO1xyXG4gICAgICAgIHZhciBhdmVyYWdlID0gdGVsZW1ldHJ5SXRlbS5iYXNlRGF0YS5hdmVyYWdlO1xyXG4gICAgICAgIHZhciBzYW1wbGVDb3VudCA9IHRlbGVtZXRyeUl0ZW0uYmFzZURhdGEuc2FtcGxlQ291bnQ7XHJcbiAgICAgICAgdmFyIG1pbiA9IHRlbGVtZXRyeUl0ZW0uYmFzZURhdGEubWluO1xyXG4gICAgICAgIHZhciBtYXggPSB0ZWxlbWV0cnlJdGVtLmJhc2VEYXRhLm1heDtcclxuICAgICAgICB2YXIgYmFzZURhdGEgPSBuZXcgTWV0cmljKGxvZ2dlciwgbmFtZSwgYXZlcmFnZSwgc2FtcGxlQ291bnQsIG1pbiwgbWF4LCBwcm9wcywgbWVhc3VyZW1lbnRzKTtcclxuICAgICAgICB2YXIgZGF0YSA9IG5ldyBEYXRhKE1ldHJpYy5kYXRhVHlwZSwgYmFzZURhdGEpO1xyXG4gICAgICAgIHJldHVybiBFbnZlbG9wZUNyZWF0b3IuY3JlYXRlRW52ZWxvcGUobG9nZ2VyLCBNZXRyaWMuZW52ZWxvcGVUeXBlLCB0ZWxlbWV0cnlJdGVtLCBkYXRhKTtcclxuICAgIH07XHJcbiAgICBNZXRyaWNFbnZlbG9wZUNyZWF0b3IuTWV0cmljRW52ZWxvcGVDcmVhdG9yID0gbmV3IE1ldHJpY0VudmVsb3BlQ3JlYXRvcigpO1xyXG4gICAgcmV0dXJuIE1ldHJpY0VudmVsb3BlQ3JlYXRvcjtcclxufShFbnZlbG9wZUNyZWF0b3IpKTtcclxuZXhwb3J0IHsgTWV0cmljRW52ZWxvcGVDcmVhdG9yIH07XHJcbnZhciBQYWdlVmlld0VudmVsb3BlQ3JlYXRvciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIHRzbGliXzEuX19leHRlbmRzKFBhZ2VWaWV3RW52ZWxvcGVDcmVhdG9yLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gUGFnZVZpZXdFbnZlbG9wZUNyZWF0b3IoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgUGFnZVZpZXdFbnZlbG9wZUNyZWF0b3IucHJvdG90eXBlLkNyZWF0ZSA9IGZ1bmN0aW9uIChsb2dnZXIsIHRlbGVtZXRyeUl0ZW0pIHtcclxuICAgICAgICB0aGlzLl9sb2dnZXIgPSBsb2dnZXI7XHJcbiAgICAgICAgaWYgKENvcmVVdGlscy5pc051bGxPclVuZGVmaW5lZCh0ZWxlbWV0cnlJdGVtLmJhc2VEYXRhKSkge1xyXG4gICAgICAgICAgICB0aGlzLl9sb2dnZXIudGhyb3dJbnRlcm5hbChMb2dnaW5nU2V2ZXJpdHkuQ1JJVElDQUwsIF9JbnRlcm5hbE1lc3NhZ2VJZC5UZWxlbWV0cnlFbnZlbG9wZUludmFsaWQsIFwidGVsZW1ldHJ5SXRlbS5iYXNlRGF0YSBjYW5ub3QgYmUgbnVsbC5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFNpbmNlIGR1cmF0aW9uIGlzIG5vdCBwYXJ0IG9mIHRoZSBkb21haW4gcHJvcGVydGllcyBpbiBDb21tb24gU2NoZW1hLCBleHRyYWN0IGl0IGZyb20gcGFydCBDXHJcbiAgICAgICAgdmFyIGR1cmF0aW9uO1xyXG4gICAgICAgIGlmICghQ29yZVV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKHRlbGVtZXRyeUl0ZW0uYmFzZURhdGEpICYmXHJcbiAgICAgICAgICAgICFDb3JlVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQodGVsZW1ldHJ5SXRlbS5iYXNlRGF0YS5wcm9wZXJ0aWVzKSAmJlxyXG4gICAgICAgICAgICAhQ29yZVV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKHRlbGVtZXRyeUl0ZW0uYmFzZURhdGEucHJvcGVydGllcy5kdXJhdGlvbikpIHtcclxuICAgICAgICAgICAgZHVyYXRpb24gPSB0ZWxlbWV0cnlJdGVtLmJhc2VEYXRhLnByb3BlcnRpZXMuZHVyYXRpb247XHJcbiAgICAgICAgICAgIGRlbGV0ZSB0ZWxlbWV0cnlJdGVtLmJhc2VEYXRhLnByb3BlcnRpZXMuZHVyYXRpb247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKCFDb3JlVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQodGVsZW1ldHJ5SXRlbS5kYXRhKSAmJlxyXG4gICAgICAgICAgICAhQ29yZVV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKHRlbGVtZXRyeUl0ZW0uZGF0YVtcImR1cmF0aW9uXCJdKSkge1xyXG4gICAgICAgICAgICBkdXJhdGlvbiA9IHRlbGVtZXRyeUl0ZW0uZGF0YVtcImR1cmF0aW9uXCJdO1xyXG4gICAgICAgICAgICBkZWxldGUgdGVsZW1ldHJ5SXRlbS5kYXRhW1wiZHVyYXRpb25cIl07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBiZCA9IHRlbGVtZXRyeUl0ZW0uYmFzZURhdGE7XHJcbiAgICAgICAgLy8gc3BlY2lhbCBjYXNlOiBwYWdldmlldy5pZCBpcyBncmFiYmVkIGZyb20gY3VycmVudCBvcGVyYXRpb24gaWQuIEFuYWx5dGljcyBwbHVnaW4gaXMgZGVjb3VwbGVkIGZyb20gcHJvcGVydGllcyBwbHVnaW4sIHNvIHRoaXMgaXMgZG9uZSBoZXJlIGluc3RlYWQuIFRoaXMgY2FuIGJlIG1hZGUgYSBkZWZhdWx0IHRlbGVtZXRyeSBpbnRpYWxpemVyIGluc3RlYWQgaWYgbmVlZGVkIHRvIGJlIGRlY291cGxlZCBmcm9tIGNoYW5uZWxcclxuICAgICAgICB2YXIgY3VycmVudENvbnRleHRJZDtcclxuICAgICAgICBpZiAodGVsZW1ldHJ5SXRlbS5leHQgJiYgdGVsZW1ldHJ5SXRlbS5leHQudHJhY2UgJiYgdGVsZW1ldHJ5SXRlbS5leHQudHJhY2UudHJhY2VJRCkge1xyXG4gICAgICAgICAgICBjdXJyZW50Q29udGV4dElkID0gdGVsZW1ldHJ5SXRlbS5leHQudHJhY2UudHJhY2VJRDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGlkID0gYmQuaWQgfHwgY3VycmVudENvbnRleHRJZDtcclxuICAgICAgICB2YXIgbmFtZSA9IGJkLm5hbWU7XHJcbiAgICAgICAgdmFyIHVybCA9IGJkLnVyaTtcclxuICAgICAgICB2YXIgcHJvcGVydGllcyA9IGJkLnByb3BlcnRpZXMgfHwge307XHJcbiAgICAgICAgdmFyIG1lYXN1cmVtZW50cyA9IGJkLm1lYXN1cmVtZW50cyB8fCB7fTtcclxuICAgICAgICAvLyByZWZVcmkgaXMgYSBmaWVsZCB0aGF0IEJyZWV6ZSBzdGlsbCBkb2VzIG5vdCByZWNvZ25pemUgYXMgcGFydCBvZiBQYXJ0IEIuIEZvciBub3csIHB1dCBpdCBpbiBQYXJ0IEMgdW50aWwgaXQgc3VwcG9ydHMgaXQgYXMgYSBkb21haW4gcHJvcGVydHlcclxuICAgICAgICBpZiAoIUNvcmVVdGlscy5pc051bGxPclVuZGVmaW5lZChiZC5yZWZVcmkpKSB7XHJcbiAgICAgICAgICAgIHByb3BlcnRpZXNbXCJyZWZVcmlcIl0gPSBiZC5yZWZVcmk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHBhZ2VUeXBlIGlzIGEgZmllbGQgdGhhdCBCcmVlemUgc3RpbGwgZG9lcyBub3QgcmVjb2duaXplIGFzIHBhcnQgb2YgUGFydCBCLiBGb3Igbm93LCBwdXQgaXQgaW4gUGFydCBDIHVudGlsIGl0IHN1cHBvcnRzIGl0IGFzIGEgZG9tYWluIHByb3BlcnR5XHJcbiAgICAgICAgaWYgKCFDb3JlVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQoYmQucGFnZVR5cGUpKSB7XHJcbiAgICAgICAgICAgIHByb3BlcnRpZXNbXCJwYWdlVHlwZVwiXSA9IGJkLnBhZ2VUeXBlO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBpc0xvZ2dlZEluIGlzIGEgZmllbGQgdGhhdCBCcmVlemUgc3RpbGwgZG9lcyBub3QgcmVjb2duaXplIGFzIHBhcnQgb2YgUGFydCBCLiBGb3Igbm93LCBwdXQgaXQgaW4gUGFydCBDIHVudGlsIGl0IHN1cHBvcnRzIGl0IGFzIGEgZG9tYWluIHByb3BlcnR5XHJcbiAgICAgICAgaWYgKCFDb3JlVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQoYmQuaXNMb2dnZWRJbikpIHtcclxuICAgICAgICAgICAgcHJvcGVydGllc1tcImlzTG9nZ2VkSW5cIl0gPSBiZC5pc0xvZ2dlZEluLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHBhZ2VUYWdzIGlzIGEgZmllbGQgdGhhdCBCcmVlemUgc3RpbGwgZG9lcyBub3QgcmVjb2duaXplIGFzIHBhcnQgb2YgUGFydCBCLiBGb3Igbm93LCBwdXQgaXQgaW4gUGFydCBDIHVudGlsIGl0IHN1cHBvcnRzIGl0IGFzIGEgZG9tYWluIHByb3BlcnR5XHJcbiAgICAgICAgaWYgKCFDb3JlVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQoYmQucHJvcGVydGllcykpIHtcclxuICAgICAgICAgICAgdmFyIHBhZ2VUYWdzID0gYmQucHJvcGVydGllcztcclxuICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHBhZ2VUYWdzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocGFnZVRhZ3MuaGFzT3duUHJvcGVydHkoa2V5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXNba2V5XSA9IHBhZ2VUYWdzW2tleV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgRW52ZWxvcGVDcmVhdG9yLmV4dHJhY3RQcm9wc0FuZE1lYXN1cmVtZW50cyh0ZWxlbWV0cnlJdGVtLmRhdGEsIHByb3BlcnRpZXMsIG1lYXN1cmVtZW50cyk7XHJcbiAgICAgICAgdmFyIGJhc2VEYXRhID0gbmV3IFBhZ2VWaWV3KGxvZ2dlciwgbmFtZSwgdXJsLCBkdXJhdGlvbiwgcHJvcGVydGllcywgbWVhc3VyZW1lbnRzLCBpZCk7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBuZXcgRGF0YShQYWdlVmlldy5kYXRhVHlwZSwgYmFzZURhdGEpO1xyXG4gICAgICAgIHJldHVybiBFbnZlbG9wZUNyZWF0b3IuY3JlYXRlRW52ZWxvcGUobG9nZ2VyLCBQYWdlVmlldy5lbnZlbG9wZVR5cGUsIHRlbGVtZXRyeUl0ZW0sIGRhdGEpO1xyXG4gICAgfTtcclxuICAgIFBhZ2VWaWV3RW52ZWxvcGVDcmVhdG9yLlBhZ2VWaWV3RW52ZWxvcGVDcmVhdG9yID0gbmV3IFBhZ2VWaWV3RW52ZWxvcGVDcmVhdG9yKCk7XHJcbiAgICByZXR1cm4gUGFnZVZpZXdFbnZlbG9wZUNyZWF0b3I7XHJcbn0oRW52ZWxvcGVDcmVhdG9yKSk7XHJcbmV4cG9ydCB7IFBhZ2VWaWV3RW52ZWxvcGVDcmVhdG9yIH07XHJcbnZhciBQYWdlVmlld1BlcmZvcm1hbmNlRW52ZWxvcGVDcmVhdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgdHNsaWJfMS5fX2V4dGVuZHMoUGFnZVZpZXdQZXJmb3JtYW5jZUVudmVsb3BlQ3JlYXRvciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFBhZ2VWaWV3UGVyZm9ybWFuY2VFbnZlbG9wZUNyZWF0b3IoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgUGFnZVZpZXdQZXJmb3JtYW5jZUVudmVsb3BlQ3JlYXRvci5wcm90b3R5cGUuQ3JlYXRlID0gZnVuY3Rpb24gKGxvZ2dlciwgdGVsZW1ldHJ5SXRlbSkge1xyXG4gICAgICAgIHRoaXMuX2xvZ2dlciA9IGxvZ2dlcjtcclxuICAgICAgICBpZiAoQ29yZVV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKHRlbGVtZXRyeUl0ZW0uYmFzZURhdGEpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2xvZ2dlci50aHJvd0ludGVybmFsKExvZ2dpbmdTZXZlcml0eS5DUklUSUNBTCwgX0ludGVybmFsTWVzc2FnZUlkLlRlbGVtZXRyeUVudmVsb3BlSW52YWxpZCwgXCJ0ZWxlbWV0cnlJdGVtLmJhc2VEYXRhIGNhbm5vdCBiZSBudWxsLlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGJkID0gdGVsZW1ldHJ5SXRlbS5iYXNlRGF0YTtcclxuICAgICAgICB2YXIgbmFtZSA9IGJkLm5hbWU7XHJcbiAgICAgICAgdmFyIHVybCA9IGJkLnVyaSB8fCBiZC51cmw7XHJcbiAgICAgICAgdmFyIHByb3BlcnRpZXMgPSBiZC5wcm9wZXJ0aWVzIHx8IHt9O1xyXG4gICAgICAgIHZhciBtZWFzdXJlbWVudHMgPSBiZC5tZWFzdXJlbWVudHMgfHwge307XHJcbiAgICAgICAgRW52ZWxvcGVDcmVhdG9yLmV4dHJhY3RQcm9wc0FuZE1lYXN1cmVtZW50cyh0ZWxlbWV0cnlJdGVtLmRhdGEsIHByb3BlcnRpZXMsIG1lYXN1cmVtZW50cyk7XHJcbiAgICAgICAgdmFyIGJhc2VEYXRhID0gbmV3IFBhZ2VWaWV3UGVyZm9ybWFuY2UobG9nZ2VyLCBuYW1lLCB1cmwsIHVuZGVmaW5lZCwgcHJvcGVydGllcywgbWVhc3VyZW1lbnRzLCBiZCk7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBuZXcgRGF0YShQYWdlVmlld1BlcmZvcm1hbmNlLmRhdGFUeXBlLCBiYXNlRGF0YSk7XHJcbiAgICAgICAgcmV0dXJuIEVudmVsb3BlQ3JlYXRvci5jcmVhdGVFbnZlbG9wZShsb2dnZXIsIFBhZ2VWaWV3UGVyZm9ybWFuY2UuZW52ZWxvcGVUeXBlLCB0ZWxlbWV0cnlJdGVtLCBkYXRhKTtcclxuICAgIH07XHJcbiAgICBQYWdlVmlld1BlcmZvcm1hbmNlRW52ZWxvcGVDcmVhdG9yLlBhZ2VWaWV3UGVyZm9ybWFuY2VFbnZlbG9wZUNyZWF0b3IgPSBuZXcgUGFnZVZpZXdQZXJmb3JtYW5jZUVudmVsb3BlQ3JlYXRvcigpO1xyXG4gICAgcmV0dXJuIFBhZ2VWaWV3UGVyZm9ybWFuY2VFbnZlbG9wZUNyZWF0b3I7XHJcbn0oRW52ZWxvcGVDcmVhdG9yKSk7XHJcbmV4cG9ydCB7IFBhZ2VWaWV3UGVyZm9ybWFuY2VFbnZlbG9wZUNyZWF0b3IgfTtcclxudmFyIFRyYWNlRW52ZWxvcGVDcmVhdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgdHNsaWJfMS5fX2V4dGVuZHMoVHJhY2VFbnZlbG9wZUNyZWF0b3IsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBUcmFjZUVudmVsb3BlQ3JlYXRvcigpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICBUcmFjZUVudmVsb3BlQ3JlYXRvci5wcm90b3R5cGUuQ3JlYXRlID0gZnVuY3Rpb24gKGxvZ2dlciwgdGVsZW1ldHJ5SXRlbSkge1xyXG4gICAgICAgIHRoaXMuX2xvZ2dlciA9IGxvZ2dlcjtcclxuICAgICAgICBpZiAoQ29yZVV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKHRlbGVtZXRyeUl0ZW0uYmFzZURhdGEpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2xvZ2dlci50aHJvd0ludGVybmFsKExvZ2dpbmdTZXZlcml0eS5DUklUSUNBTCwgX0ludGVybmFsTWVzc2FnZUlkLlRlbGVtZXRyeUVudmVsb3BlSW52YWxpZCwgXCJ0ZWxlbWV0cnlJdGVtLmJhc2VEYXRhIGNhbm5vdCBiZSBudWxsLlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSB0ZWxlbWV0cnlJdGVtLmJhc2VEYXRhLm1lc3NhZ2U7XHJcbiAgICAgICAgdmFyIHNldmVyaXR5TGV2ZWwgPSB0ZWxlbWV0cnlJdGVtLmJhc2VEYXRhLnNldmVyaXR5TGV2ZWw7XHJcbiAgICAgICAgdmFyIHByb3BzID0gdGVsZW1ldHJ5SXRlbS5iYXNlRGF0YS5wcm9wZXJ0aWVzIHx8IHt9O1xyXG4gICAgICAgIHZhciBtZWFzdXJlbWVudHMgPSB0ZWxlbWV0cnlJdGVtLmJhc2VEYXRhLm1lYXN1cmVtZW50cyB8fCB7fTtcclxuICAgICAgICBFbnZlbG9wZUNyZWF0b3IuZXh0cmFjdFByb3BzQW5kTWVhc3VyZW1lbnRzKHRlbGVtZXRyeUl0ZW0uZGF0YSwgcHJvcHMsIG1lYXN1cmVtZW50cyk7XHJcbiAgICAgICAgdmFyIGJhc2VEYXRhID0gbmV3IFRyYWNlKGxvZ2dlciwgbWVzc2FnZSwgc2V2ZXJpdHlMZXZlbCwgcHJvcHMsIG1lYXN1cmVtZW50cyk7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBuZXcgRGF0YShUcmFjZS5kYXRhVHlwZSwgYmFzZURhdGEpO1xyXG4gICAgICAgIHJldHVybiBFbnZlbG9wZUNyZWF0b3IuY3JlYXRlRW52ZWxvcGUobG9nZ2VyLCBUcmFjZS5lbnZlbG9wZVR5cGUsIHRlbGVtZXRyeUl0ZW0sIGRhdGEpO1xyXG4gICAgfTtcclxuICAgIFRyYWNlRW52ZWxvcGVDcmVhdG9yLlRyYWNlRW52ZWxvcGVDcmVhdG9yID0gbmV3IFRyYWNlRW52ZWxvcGVDcmVhdG9yKCk7XHJcbiAgICByZXR1cm4gVHJhY2VFbnZlbG9wZUNyZWF0b3I7XHJcbn0oRW52ZWxvcGVDcmVhdG9yKSk7XHJcbmV4cG9ydCB7IFRyYWNlRW52ZWxvcGVDcmVhdG9yIH07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUVudmVsb3BlQ3JlYXRvci5qcy5tYXAiLCJpbXBvcnQgeyBDb3JlVXRpbHMsIEV2ZW50SGVscGVyLCBnZXRXaW5kb3csIGdldERvY3VtZW50LCBnZXROYXZpZ2F0b3IgfSBmcm9tICdAbWljcm9zb2Z0L2FwcGxpY2F0aW9uaW5zaWdodHMtY29yZS1qcyc7XHJcbi8qKlxyXG4gKiBAZGVzY3JpcHRpb24gTW9uaXRvcnMgYnJvd3NlciBmb3Igb2ZmbGluZSBldmVudHNcclxuICogQGV4cG9ydCBkZWZhdWx0IC0gT2ZmbGluZTogU3RhdGljIGluc3RhbmNlIG9mIE9mZmxpbmVMaXN0ZW5lclxyXG4gKiBAY2xhc3MgT2ZmbGluZUxpc3RlbmVyXHJcbiAqL1xyXG52YXIgT2ZmbGluZUxpc3RlbmVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gT2ZmbGluZUxpc3RlbmVyKCkge1xyXG4gICAgICAgIHRoaXMuX29ubGluZVN0YXR1cyA9IHRydWU7XHJcbiAgICAgICAgdmFyIF93aW5kb3cgPSBnZXRXaW5kb3coKTtcclxuICAgICAgICB2YXIgX2RvY3VtZW50ID0gZ2V0RG9jdW1lbnQoKTtcclxuICAgICAgICB2YXIgaXNMaXN0ZW5pbmcgPSBmYWxzZTtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChfd2luZG93KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoRXZlbnRIZWxwZXIuQXR0YWNoKF93aW5kb3csICdvbmxpbmUnLCB0aGlzLl9zZXRPbmxpbmUuYmluZChfdGhpcykpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgRXZlbnRIZWxwZXIuQXR0YWNoKF93aW5kb3csICdvZmZsaW5lJywgdGhpcy5fc2V0T2ZmbGluZS5iaW5kKF90aGlzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaXNMaXN0ZW5pbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChfZG9jdW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIC8vIEFsc28gYXR0YWNoIHRvIHRoZSBkb2N1bWVudC5ib2R5IG9yIGRvY3VtZW50XHJcbiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gX2RvY3VtZW50LmJvZHkgfHwgX2RvY3VtZW50O1xyXG4gICAgICAgICAgICAgICAgaWYgKCFDb3JlVXRpbHMuaXNVbmRlZmluZWQodGFyZ2V0Lm9ub25saW5lKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldC5vbm9ubGluZSA9IHRoaXMuX3NldE9ubGluZS5iaW5kKF90aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICB0YXJnZXQub25vZmZsaW5lID0gdGhpcy5fc2V0T2ZmbGluZS5iaW5kKF90aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICBpc0xpc3RlbmluZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgLy8gdGhpcyBtYWtlcyByZWFjdC1uYXRpdmUgbGVzcyBhbmdyeVxyXG4gICAgICAgICAgICBpc0xpc3RlbmluZyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzTGlzdGVuaW5nID0gaXNMaXN0ZW5pbmc7XHJcbiAgICB9XHJcbiAgICBPZmZsaW5lTGlzdGVuZXIucHJvdG90eXBlLmlzT25saW5lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfbmF2aWdhdG9yID0gZ2V0TmF2aWdhdG9yKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNMaXN0ZW5pbmcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29ubGluZVN0YXR1cztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoX25hdmlnYXRvciAmJiAhQ29yZVV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKF9uYXZpZ2F0b3Iub25MaW5lKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gX25hdmlnYXRvci5vbkxpbmU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBDYW5ub3QgZGV0ZXJtaW5lIG9ubGluZSBzdGF0dXMgLSByZXBvcnQgYXMgb25saW5lXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBPZmZsaW5lTGlzdGVuZXIucHJvdG90eXBlLmlzT2ZmbGluZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gIXRoaXMuaXNPbmxpbmUoKTtcclxuICAgIH07XHJcbiAgICBPZmZsaW5lTGlzdGVuZXIucHJvdG90eXBlLl9zZXRPbmxpbmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5fb25saW5lU3RhdHVzID0gdHJ1ZTtcclxuICAgIH07XHJcbiAgICBPZmZsaW5lTGlzdGVuZXIucHJvdG90eXBlLl9zZXRPZmZsaW5lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuX29ubGluZVN0YXR1cyA9IGZhbHNlO1xyXG4gICAgfTtcclxuICAgIE9mZmxpbmVMaXN0ZW5lci5PZmZsaW5lID0gbmV3IE9mZmxpbmVMaXN0ZW5lcjtcclxuICAgIHJldHVybiBPZmZsaW5lTGlzdGVuZXI7XHJcbn0oKSk7XHJcbmV4cG9ydCB7IE9mZmxpbmVMaXN0ZW5lciB9O1xyXG5leHBvcnQgdmFyIE9mZmxpbmUgPSBPZmZsaW5lTGlzdGVuZXIuT2ZmbGluZTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9T2ZmbGluZS5qcy5tYXAiLCJpbXBvcnQgeyBVdGlsIH0gZnJvbSAnQG1pY3Jvc29mdC9hcHBsaWNhdGlvbmluc2lnaHRzLWNvbW1vbic7XHJcbmltcG9ydCB7IExvZ2dpbmdTZXZlcml0eSwgX0ludGVybmFsTWVzc2FnZUlkLCBnZXRKU09OIH0gZnJvbSAnQG1pY3Jvc29mdC9hcHBsaWNhdGlvbmluc2lnaHRzLWNvcmUtanMnO1xyXG4vKlxyXG4gKiBBbiBhcnJheSBiYXNlZCBzZW5kIGJ1ZmZlci5cclxuICovXHJcbnZhciBBcnJheVNlbmRCdWZmZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBBcnJheVNlbmRCdWZmZXIoY29uZmlnKSB7XHJcbiAgICAgICAgdGhpcy5fY29uZmlnID0gY29uZmlnO1xyXG4gICAgICAgIHRoaXMuX2J1ZmZlciA9IFtdO1xyXG4gICAgfVxyXG4gICAgQXJyYXlTZW5kQnVmZmVyLnByb3RvdHlwZS5lbnF1ZXVlID0gZnVuY3Rpb24gKHBheWxvYWQpIHtcclxuICAgICAgICB0aGlzLl9idWZmZXIucHVzaChwYXlsb2FkKTtcclxuICAgIH07XHJcbiAgICBBcnJheVNlbmRCdWZmZXIucHJvdG90eXBlLmNvdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9idWZmZXIubGVuZ3RoO1xyXG4gICAgfTtcclxuICAgIEFycmF5U2VuZEJ1ZmZlci5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5fYnVmZmVyLmxlbmd0aCA9IDA7XHJcbiAgICB9O1xyXG4gICAgQXJyYXlTZW5kQnVmZmVyLnByb3RvdHlwZS5nZXRJdGVtcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYnVmZmVyLnNsaWNlKDApO1xyXG4gICAgfTtcclxuICAgIEFycmF5U2VuZEJ1ZmZlci5wcm90b3R5cGUuYmF0Y2hQYXlsb2FkcyA9IGZ1bmN0aW9uIChwYXlsb2FkKSB7XHJcbiAgICAgICAgaWYgKHBheWxvYWQgJiYgcGF5bG9hZC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHZhciBiYXRjaCA9IHRoaXMuX2NvbmZpZy5lbWl0TGluZURlbGltaXRlZEpzb24oKSA/XHJcbiAgICAgICAgICAgICAgICBwYXlsb2FkLmpvaW4oXCJcXG5cIikgOlxyXG4gICAgICAgICAgICAgICAgXCJbXCIgKyBwYXlsb2FkLmpvaW4oXCIsXCIpICsgXCJdXCI7XHJcbiAgICAgICAgICAgIHJldHVybiBiYXRjaDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9O1xyXG4gICAgQXJyYXlTZW5kQnVmZmVyLnByb3RvdHlwZS5tYXJrQXNTZW50ID0gZnVuY3Rpb24gKHBheWxvYWQpIHtcclxuICAgICAgICB0aGlzLmNsZWFyKCk7XHJcbiAgICB9O1xyXG4gICAgQXJyYXlTZW5kQnVmZmVyLnByb3RvdHlwZS5jbGVhclNlbnQgPSBmdW5jdGlvbiAocGF5bG9hZCkge1xyXG4gICAgICAgIC8vIG5vdCBzdXBwb3J0ZWRcclxuICAgIH07XHJcbiAgICByZXR1cm4gQXJyYXlTZW5kQnVmZmVyO1xyXG59KCkpO1xyXG5leHBvcnQgeyBBcnJheVNlbmRCdWZmZXIgfTtcclxuLypcclxuICogU2Vzc2lvbiBzdG9yZWdlIGJ1ZmZlciBob2xkcyBhIGNvcHkgb2YgYWxsIHVuc2VudCBpdGVtcyBpbiB0aGUgYnJvd3NlciBzZXNzaW9uIHN0b3JhZ2UuXHJcbiAqL1xyXG52YXIgU2Vzc2lvblN0b3JhZ2VTZW5kQnVmZmVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gU2Vzc2lvblN0b3JhZ2VTZW5kQnVmZmVyKGxvZ2dlciwgY29uZmlnKSB7XHJcbiAgICAgICAgdGhpcy5fYnVmZmVyRnVsbE1lc3NhZ2VTZW50ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5fbG9nZ2VyID0gbG9nZ2VyO1xyXG4gICAgICAgIHRoaXMuX2NvbmZpZyA9IGNvbmZpZztcclxuICAgICAgICB2YXIgYnVmZmVySXRlbXMgPSB0aGlzLmdldEJ1ZmZlcihTZXNzaW9uU3RvcmFnZVNlbmRCdWZmZXIuQlVGRkVSX0tFWSk7XHJcbiAgICAgICAgdmFyIG5vdERlbGl2ZXJlZEl0ZW1zID0gdGhpcy5nZXRCdWZmZXIoU2Vzc2lvblN0b3JhZ2VTZW5kQnVmZmVyLlNFTlRfQlVGRkVSX0tFWSk7XHJcbiAgICAgICAgdGhpcy5fYnVmZmVyID0gYnVmZmVySXRlbXMuY29uY2F0KG5vdERlbGl2ZXJlZEl0ZW1zKTtcclxuICAgICAgICAvLyBJZiB0aGUgYnVmZmVyIGhhcyB0b28gbWFueSBpdGVtcywgZHJvcCBpdGVtcyBmcm9tIHRoZSBlbmQuXHJcbiAgICAgICAgaWYgKHRoaXMuX2J1ZmZlci5sZW5ndGggPiBTZXNzaW9uU3RvcmFnZVNlbmRCdWZmZXIuTUFYX0JVRkZFUl9TSVpFKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2J1ZmZlci5sZW5ndGggPSBTZXNzaW9uU3RvcmFnZVNlbmRCdWZmZXIuTUFYX0JVRkZFUl9TSVpFO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyB1cGRhdGUgRGF0YUxvc3NBbmFseXplciB3aXRoIHRoZSBudW1iZXIgb2YgcmVjb3ZlcmVkIGl0ZW1zXHJcbiAgICAgICAgLy8gVW5jb21tZW50IGlmIHlvdSB3YW50IHRvIHVzZSBEYXRhTG9zc2FuYWx5emVyXHJcbiAgICAgICAgLy8gRGF0YUxvc3NBbmFseXplci5pdGVtc1Jlc3RvcmVkRnJvbVNlc3Npb25CdWZmZXIgPSB0aGlzLl9idWZmZXIubGVuZ3RoO1xyXG4gICAgICAgIHRoaXMuc2V0QnVmZmVyKFNlc3Npb25TdG9yYWdlU2VuZEJ1ZmZlci5TRU5UX0JVRkZFUl9LRVksIFtdKTtcclxuICAgICAgICB0aGlzLnNldEJ1ZmZlcihTZXNzaW9uU3RvcmFnZVNlbmRCdWZmZXIuQlVGRkVSX0tFWSwgdGhpcy5fYnVmZmVyKTtcclxuICAgIH1cclxuICAgIFNlc3Npb25TdG9yYWdlU2VuZEJ1ZmZlci5wcm90b3R5cGUuZW5xdWV1ZSA9IGZ1bmN0aW9uIChwYXlsb2FkKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2J1ZmZlci5sZW5ndGggPj0gU2Vzc2lvblN0b3JhZ2VTZW5kQnVmZmVyLk1BWF9CVUZGRVJfU0laRSkge1xyXG4gICAgICAgICAgICAvLyBzZW50IGludGVybmFsIGxvZyBvbmx5IG9uY2UgcGVyIHBhZ2Ugdmlld1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX2J1ZmZlckZ1bGxNZXNzYWdlU2VudCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbG9nZ2VyLnRocm93SW50ZXJuYWwoTG9nZ2luZ1NldmVyaXR5LldBUk5JTkcsIF9JbnRlcm5hbE1lc3NhZ2VJZC5TZXNzaW9uU3RvcmFnZUJ1ZmZlckZ1bGwsIFwiTWF4aW11bSBidWZmZXIgc2l6ZSByZWFjaGVkOiBcIiArIHRoaXMuX2J1ZmZlci5sZW5ndGgsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fYnVmZmVyRnVsbE1lc3NhZ2VTZW50ID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX2J1ZmZlci5wdXNoKHBheWxvYWQpO1xyXG4gICAgICAgIHRoaXMuc2V0QnVmZmVyKFNlc3Npb25TdG9yYWdlU2VuZEJ1ZmZlci5CVUZGRVJfS0VZLCB0aGlzLl9idWZmZXIpO1xyXG4gICAgfTtcclxuICAgIFNlc3Npb25TdG9yYWdlU2VuZEJ1ZmZlci5wcm90b3R5cGUuY291bnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2J1ZmZlci5sZW5ndGg7XHJcbiAgICB9O1xyXG4gICAgU2Vzc2lvblN0b3JhZ2VTZW5kQnVmZmVyLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLl9idWZmZXIubGVuZ3RoID0gMDtcclxuICAgICAgICB0aGlzLnNldEJ1ZmZlcihTZXNzaW9uU3RvcmFnZVNlbmRCdWZmZXIuQlVGRkVSX0tFWSwgW10pO1xyXG4gICAgICAgIHRoaXMuc2V0QnVmZmVyKFNlc3Npb25TdG9yYWdlU2VuZEJ1ZmZlci5TRU5UX0JVRkZFUl9LRVksIFtdKTtcclxuICAgICAgICB0aGlzLl9idWZmZXJGdWxsTWVzc2FnZVNlbnQgPSBmYWxzZTtcclxuICAgIH07XHJcbiAgICBTZXNzaW9uU3RvcmFnZVNlbmRCdWZmZXIucHJvdG90eXBlLmdldEl0ZW1zID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9idWZmZXIuc2xpY2UoMCk7XHJcbiAgICB9O1xyXG4gICAgU2Vzc2lvblN0b3JhZ2VTZW5kQnVmZmVyLnByb3RvdHlwZS5iYXRjaFBheWxvYWRzID0gZnVuY3Rpb24gKHBheWxvYWQpIHtcclxuICAgICAgICBpZiAocGF5bG9hZCAmJiBwYXlsb2FkLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgdmFyIGJhdGNoID0gdGhpcy5fY29uZmlnLmVtaXRMaW5lRGVsaW1pdGVkSnNvbigpID9cclxuICAgICAgICAgICAgICAgIHBheWxvYWQuam9pbihcIlxcblwiKSA6XHJcbiAgICAgICAgICAgICAgICBcIltcIiArIHBheWxvYWQuam9pbihcIixcIikgKyBcIl1cIjtcclxuICAgICAgICAgICAgcmV0dXJuIGJhdGNoO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH07XHJcbiAgICBTZXNzaW9uU3RvcmFnZVNlbmRCdWZmZXIucHJvdG90eXBlLm1hcmtBc1NlbnQgPSBmdW5jdGlvbiAocGF5bG9hZCkge1xyXG4gICAgICAgIHRoaXMuX2J1ZmZlciA9IHRoaXMucmVtb3ZlUGF5bG9hZHNGcm9tQnVmZmVyKHBheWxvYWQsIHRoaXMuX2J1ZmZlcik7XHJcbiAgICAgICAgdGhpcy5zZXRCdWZmZXIoU2Vzc2lvblN0b3JhZ2VTZW5kQnVmZmVyLkJVRkZFUl9LRVksIHRoaXMuX2J1ZmZlcik7XHJcbiAgICAgICAgdmFyIHNlbnRFbGVtZW50cyA9IHRoaXMuZ2V0QnVmZmVyKFNlc3Npb25TdG9yYWdlU2VuZEJ1ZmZlci5TRU5UX0JVRkZFUl9LRVkpO1xyXG4gICAgICAgIGlmIChzZW50RWxlbWVudHMgaW5zdGFuY2VvZiBBcnJheSAmJiBwYXlsb2FkIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgICAgc2VudEVsZW1lbnRzID0gc2VudEVsZW1lbnRzLmNvbmNhdChwYXlsb2FkKTtcclxuICAgICAgICAgICAgaWYgKHNlbnRFbGVtZW50cy5sZW5ndGggPiBTZXNzaW9uU3RvcmFnZVNlbmRCdWZmZXIuTUFYX0JVRkZFUl9TSVpFKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBXZSBzZW5kIHRlbGVtZXRyeSBub3JtYWxseS4gSWYgdGhlIFNFTlRfQlVGRkVSIGlzIHRvbyBiaWcgd2UgZG9uJ3QgYWRkIG5ldyBlbGVtZW50c1xyXG4gICAgICAgICAgICAgICAgLy8gdW50aWwgd2UgcmVjZWl2ZSBhIHJlc3BvbnNlIGZyb20gdGhlIGJhY2tlbmQgYW5kIHRoZSBidWZmZXIgaGFzIGZyZWUgc3BhY2UgYWdhaW4gKHNlZSBjbGVhclNlbnQgbWV0aG9kKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5fbG9nZ2VyLnRocm93SW50ZXJuYWwoTG9nZ2luZ1NldmVyaXR5LkNSSVRJQ0FMLCBfSW50ZXJuYWxNZXNzYWdlSWQuU2Vzc2lvblN0b3JhZ2VCdWZmZXJGdWxsLCBcIlNlbnQgYnVmZmVyIHJlYWNoZWQgaXRzIG1heGltdW0gc2l6ZTogXCIgKyBzZW50RWxlbWVudHMubGVuZ3RoLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIHNlbnRFbGVtZW50cy5sZW5ndGggPSBTZXNzaW9uU3RvcmFnZVNlbmRCdWZmZXIuTUFYX0JVRkZFUl9TSVpFO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc2V0QnVmZmVyKFNlc3Npb25TdG9yYWdlU2VuZEJ1ZmZlci5TRU5UX0JVRkZFUl9LRVksIHNlbnRFbGVtZW50cyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNlc3Npb25TdG9yYWdlU2VuZEJ1ZmZlci5wcm90b3R5cGUuY2xlYXJTZW50ID0gZnVuY3Rpb24gKHBheWxvYWQpIHtcclxuICAgICAgICB2YXIgc2VudEVsZW1lbnRzID0gdGhpcy5nZXRCdWZmZXIoU2Vzc2lvblN0b3JhZ2VTZW5kQnVmZmVyLlNFTlRfQlVGRkVSX0tFWSk7XHJcbiAgICAgICAgc2VudEVsZW1lbnRzID0gdGhpcy5yZW1vdmVQYXlsb2Fkc0Zyb21CdWZmZXIocGF5bG9hZCwgc2VudEVsZW1lbnRzKTtcclxuICAgICAgICB0aGlzLnNldEJ1ZmZlcihTZXNzaW9uU3RvcmFnZVNlbmRCdWZmZXIuU0VOVF9CVUZGRVJfS0VZLCBzZW50RWxlbWVudHMpO1xyXG4gICAgfTtcclxuICAgIFNlc3Npb25TdG9yYWdlU2VuZEJ1ZmZlci5wcm90b3R5cGUucmVtb3ZlUGF5bG9hZHNGcm9tQnVmZmVyID0gZnVuY3Rpb24gKHBheWxvYWRzLCBidWZmZXIpIHtcclxuICAgICAgICB2YXIgcmVtYWluaW5nID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgaSBpbiBidWZmZXIpIHtcclxuICAgICAgICAgICAgdmFyIGNvbnRhaW5zID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGogaW4gcGF5bG9hZHMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChwYXlsb2Fkc1tqXSA9PT0gYnVmZmVyW2ldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbnMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghY29udGFpbnMpIHtcclxuICAgICAgICAgICAgICAgIHJlbWFpbmluZy5wdXNoKGJ1ZmZlcltpXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgO1xyXG4gICAgICAgIHJldHVybiByZW1haW5pbmc7XHJcbiAgICB9O1xyXG4gICAgU2Vzc2lvblN0b3JhZ2VTZW5kQnVmZmVyLnByb3RvdHlwZS5nZXRCdWZmZXIgPSBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgdmFyIHByZWZpeGVkS2V5ID0ga2V5O1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHByZWZpeGVkS2V5ID0gdGhpcy5fY29uZmlnLm5hbWVQcmVmaXggJiYgdGhpcy5fY29uZmlnLm5hbWVQcmVmaXgoKSA/IHRoaXMuX2NvbmZpZy5uYW1lUHJlZml4KCkgKyBcIl9cIiArIHByZWZpeGVkS2V5IDogcHJlZml4ZWRLZXk7XHJcbiAgICAgICAgICAgIHZhciBidWZmZXJKc29uID0gVXRpbC5nZXRTZXNzaW9uU3RvcmFnZSh0aGlzLl9sb2dnZXIsIHByZWZpeGVkS2V5KTtcclxuICAgICAgICAgICAgaWYgKGJ1ZmZlckpzb24pIHtcclxuICAgICAgICAgICAgICAgIHZhciBidWZmZXIgPSBnZXRKU09OKCkucGFyc2UoYnVmZmVySnNvbik7XHJcbiAgICAgICAgICAgICAgICBpZiAoYnVmZmVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJ1ZmZlcjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9sb2dnZXIudGhyb3dJbnRlcm5hbChMb2dnaW5nU2V2ZXJpdHkuQ1JJVElDQUwsIF9JbnRlcm5hbE1lc3NhZ2VJZC5GYWlsZWRUb1Jlc3RvcmVTdG9yYWdlQnVmZmVyLCBcIiBzdG9yYWdlIGtleTogXCIgKyBwcmVmaXhlZEtleSArIFwiLCBcIiArIFV0aWwuZ2V0RXhjZXB0aW9uTmFtZShlKSwgeyBleGNlcHRpb246IFV0aWwuZHVtcChlKSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfTtcclxuICAgIFNlc3Npb25TdG9yYWdlU2VuZEJ1ZmZlci5wcm90b3R5cGUuc2V0QnVmZmVyID0gZnVuY3Rpb24gKGtleSwgYnVmZmVyKSB7XHJcbiAgICAgICAgdmFyIHByZWZpeGVkS2V5ID0ga2V5O1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHByZWZpeGVkS2V5ID0gdGhpcy5fY29uZmlnLm5hbWVQcmVmaXggJiYgdGhpcy5fY29uZmlnLm5hbWVQcmVmaXgoKSA/IHRoaXMuX2NvbmZpZy5uYW1lUHJlZml4KCkgKyBcIl9cIiArIHByZWZpeGVkS2V5IDogcHJlZml4ZWRLZXk7XHJcbiAgICAgICAgICAgIHZhciBidWZmZXJKc29uID0gSlNPTi5zdHJpbmdpZnkoYnVmZmVyKTtcclxuICAgICAgICAgICAgVXRpbC5zZXRTZXNzaW9uU3RvcmFnZSh0aGlzLl9sb2dnZXIsIHByZWZpeGVkS2V5LCBidWZmZXJKc29uKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgLy8gaWYgdGhlcmUgd2FzIGFuIGVycm9yLCBjbGVhciB0aGUgYnVmZmVyXHJcbiAgICAgICAgICAgIC8vIHRlbGVtZXRyeSBpcyBzdG9yZWQgaW4gdGhlIF9idWZmZXIgYXJyYXkgc28gd2Ugd29uJ3QgbG9vc2UgYW55IGl0ZW1zXHJcbiAgICAgICAgICAgIFV0aWwuc2V0U2Vzc2lvblN0b3JhZ2UodGhpcy5fbG9nZ2VyLCBwcmVmaXhlZEtleSwgSlNPTi5zdHJpbmdpZnkoW10pKTtcclxuICAgICAgICAgICAgdGhpcy5fbG9nZ2VyLnRocm93SW50ZXJuYWwoTG9nZ2luZ1NldmVyaXR5LldBUk5JTkcsIF9JbnRlcm5hbE1lc3NhZ2VJZC5GYWlsZWRUb1NldFN0b3JhZ2VCdWZmZXIsIFwiIHN0b3JhZ2Uga2V5OiBcIiArIHByZWZpeGVkS2V5ICsgXCIsIFwiICsgVXRpbC5nZXRFeGNlcHRpb25OYW1lKGUpICsgXCIuIEJ1ZmZlciBjbGVhcmVkXCIsIHsgZXhjZXB0aW9uOiBVdGlsLmR1bXAoZSkgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNlc3Npb25TdG9yYWdlU2VuZEJ1ZmZlci5CVUZGRVJfS0VZID0gXCJBSV9idWZmZXJcIjtcclxuICAgIFNlc3Npb25TdG9yYWdlU2VuZEJ1ZmZlci5TRU5UX0JVRkZFUl9LRVkgPSBcIkFJX3NlbnRCdWZmZXJcIjtcclxuICAgIC8vIE1heGltdW0gbnVtYmVyIG9mIHBheWxvYWRzIHN0b3JlZCBpbiB0aGUgYnVmZmVyLiBJZiB0aGUgYnVmZmVyIGlzIGZ1bGwsIG5ldyBlbGVtZW50cyB3aWxsIGJlIGRyb3BwZWQuXHJcbiAgICBTZXNzaW9uU3RvcmFnZVNlbmRCdWZmZXIuTUFYX0JVRkZFUl9TSVpFID0gMjAwMDtcclxuICAgIHJldHVybiBTZXNzaW9uU3RvcmFnZVNlbmRCdWZmZXI7XHJcbn0oKSk7XHJcbmV4cG9ydCB7IFNlc3Npb25TdG9yYWdlU2VuZEJ1ZmZlciB9O1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1TZW5kQnVmZmVyLmpzLm1hcCIsImltcG9ydCAqIGFzIHRzbGliXzEgZnJvbSBcInRzbGliXCI7XHJcbmltcG9ydCB7IFNlc3Npb25TdG9yYWdlU2VuZEJ1ZmZlciwgQXJyYXlTZW5kQnVmZmVyIH0gZnJvbSAnLi9TZW5kQnVmZmVyJztcclxuaW1wb3J0IHsgRGVwZW5kZW5jeUVudmVsb3BlQ3JlYXRvciwgRXZlbnRFbnZlbG9wZUNyZWF0b3IsIEV4Y2VwdGlvbkVudmVsb3BlQ3JlYXRvciwgTWV0cmljRW52ZWxvcGVDcmVhdG9yLCBQYWdlVmlld0VudmVsb3BlQ3JlYXRvciwgUGFnZVZpZXdQZXJmb3JtYW5jZUVudmVsb3BlQ3JlYXRvciwgVHJhY2VFbnZlbG9wZUNyZWF0b3IgfSBmcm9tICcuL0VudmVsb3BlQ3JlYXRvcic7XHJcbmltcG9ydCB7IFNlcmlhbGl6ZXIgfSBmcm9tICcuL1NlcmlhbGl6ZXInOyAvLyB0b2RvIG1vdmUgdG8gY2hhbm5lbFxyXG5pbXBvcnQgeyBEaXNhYmxlZFByb3BlcnR5TmFtZSwgUmVxdWVzdEhlYWRlcnMsIFV0aWwsIFBhZ2VWaWV3LCBFdmVudCwgVHJhY2UsIEV4Y2VwdGlvbiwgTWV0cmljLCBQYWdlVmlld1BlcmZvcm1hbmNlLCBSZW1vdGVEZXBlbmRlbmN5RGF0YSwgUHJvY2Vzc0xlZ2FjeSwgQnJlZXplQ2hhbm5lbElkZW50aWZpZXIsIFNhbXBsZVJhdGUgfSBmcm9tICdAbWljcm9zb2Z0L2FwcGxpY2F0aW9uaW5zaWdodHMtY29tbW9uJztcclxuaW1wb3J0IHsgQ29yZVV0aWxzLCBfSW50ZXJuYWxNZXNzYWdlSWQsIExvZ2dpbmdTZXZlcml0eSwgZ2V0V2luZG93LCBnZXROYXZpZ2F0b3IsIGdldEpTT04sIEJhc2VUZWxlbWV0cnlQbHVnaW4gfSBmcm9tICdAbWljcm9zb2Z0L2FwcGxpY2F0aW9uaW5zaWdodHMtY29yZS1qcyc7XHJcbmltcG9ydCB7IE9mZmxpbmUgfSBmcm9tICcuL09mZmxpbmUnO1xyXG5pbXBvcnQgeyBTYW1wbGUgfSBmcm9tICcuL1RlbGVtZXRyeVByb2Nlc3NvcnMvU2FtcGxlJztcclxuZnVuY3Rpb24gX2dldFJlc3BvbnNlVGV4dCh4aHIpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgcmV0dXJuIHhoci5yZXNwb25zZVRleHQ7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgIC8vIEJlc3QgZWZmb3J0LCBhcyBYSFIgbWF5IHRocm93IHdoaWxlIFhEUiB3b250IHNvIGp1c3QgaWdub3JlXHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxufVxyXG52YXIgU2VuZGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgdHNsaWJfMS5fX2V4dGVuZHMoU2VuZGVyLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gU2VuZGVyKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLnByaW9yaXR5ID0gMTAwMTtcclxuICAgICAgICBfdGhpcy5pZGVudGlmaWVyID0gQnJlZXplQ2hhbm5lbElkZW50aWZpZXI7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogV2hldGhlciBYTUxIdHRwUmVxdWVzdCBvYmplY3QgaXMgc3VwcG9ydGVkLiBPbGRlciB2ZXJzaW9uIG9mIElFICg4LDkpIGRvIG5vdCBzdXBwb3J0IGl0LlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIF90aGlzLl9YTUxIdHRwUmVxdWVzdFN1cHBvcnRlZCA9IGZhbHNlO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFNlbmRlci5jb25zdHJ1Y3RFbnZlbG9wZSA9IGZ1bmN0aW9uIChvcmlnLCBpS2V5LCBsb2dnZXIpIHtcclxuICAgICAgICB2YXIgZW52ZWxvcGU7XHJcbiAgICAgICAgaWYgKGlLZXkgIT09IG9yaWcuaUtleSAmJiAhQ29yZVV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKGlLZXkpKSB7XHJcbiAgICAgICAgICAgIGVudmVsb3BlID0gdHNsaWJfMS5fX2Fzc2lnbih7fSwgb3JpZywgeyBpS2V5OiBpS2V5IH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgZW52ZWxvcGUgPSBvcmlnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzd2l0Y2ggKGVudmVsb3BlLmJhc2VUeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgRXZlbnQuZGF0YVR5cGU6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gRXZlbnRFbnZlbG9wZUNyZWF0b3IuRXZlbnRFbnZlbG9wZUNyZWF0b3IuQ3JlYXRlKGxvZ2dlciwgZW52ZWxvcGUpO1xyXG4gICAgICAgICAgICBjYXNlIFRyYWNlLmRhdGFUeXBlOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFRyYWNlRW52ZWxvcGVDcmVhdG9yLlRyYWNlRW52ZWxvcGVDcmVhdG9yLkNyZWF0ZShsb2dnZXIsIGVudmVsb3BlKTtcclxuICAgICAgICAgICAgY2FzZSBQYWdlVmlldy5kYXRhVHlwZTpcclxuICAgICAgICAgICAgICAgIHJldHVybiBQYWdlVmlld0VudmVsb3BlQ3JlYXRvci5QYWdlVmlld0VudmVsb3BlQ3JlYXRvci5DcmVhdGUobG9nZ2VyLCBlbnZlbG9wZSk7XHJcbiAgICAgICAgICAgIGNhc2UgUGFnZVZpZXdQZXJmb3JtYW5jZS5kYXRhVHlwZTpcclxuICAgICAgICAgICAgICAgIHJldHVybiBQYWdlVmlld1BlcmZvcm1hbmNlRW52ZWxvcGVDcmVhdG9yLlBhZ2VWaWV3UGVyZm9ybWFuY2VFbnZlbG9wZUNyZWF0b3IuQ3JlYXRlKGxvZ2dlciwgZW52ZWxvcGUpO1xyXG4gICAgICAgICAgICBjYXNlIEV4Y2VwdGlvbi5kYXRhVHlwZTpcclxuICAgICAgICAgICAgICAgIHJldHVybiBFeGNlcHRpb25FbnZlbG9wZUNyZWF0b3IuRXhjZXB0aW9uRW52ZWxvcGVDcmVhdG9yLkNyZWF0ZShsb2dnZXIsIGVudmVsb3BlKTtcclxuICAgICAgICAgICAgY2FzZSBNZXRyaWMuZGF0YVR5cGU6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gTWV0cmljRW52ZWxvcGVDcmVhdG9yLk1ldHJpY0VudmVsb3BlQ3JlYXRvci5DcmVhdGUobG9nZ2VyLCBlbnZlbG9wZSk7XHJcbiAgICAgICAgICAgIGNhc2UgUmVtb3RlRGVwZW5kZW5jeURhdGEuZGF0YVR5cGU6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gRGVwZW5kZW5jeUVudmVsb3BlQ3JlYXRvci5EZXBlbmRlbmN5RW52ZWxvcGVDcmVhdG9yLkNyZWF0ZShsb2dnZXIsIGVudmVsb3BlKTtcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHJldHVybiBFdmVudEVudmVsb3BlQ3JlYXRvci5FdmVudEVudmVsb3BlQ3JlYXRvci5DcmVhdGUobG9nZ2VyLCBlbnZlbG9wZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNlbmRlci5fZ2V0RGVmYXVsdEFwcEluc2lnaHRzQ2hhbm5lbENvbmZpZyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAvLyBzZXQgZGVmYXVsdCB2YWx1ZXNcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBlbmRwb2ludFVybDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJodHRwczovL2RjLnNlcnZpY2VzLnZpc3VhbHN0dWRpby5jb20vdjIvdHJhY2tcIjsgfSxcclxuICAgICAgICAgICAgZW1pdExpbmVEZWxpbWl0ZWRKc29uOiBmdW5jdGlvbiAoKSB7IHJldHVybiBmYWxzZTsgfSxcclxuICAgICAgICAgICAgbWF4QmF0Y2hJbnRlcnZhbDogZnVuY3Rpb24gKCkgeyByZXR1cm4gMTUwMDA7IH0sXHJcbiAgICAgICAgICAgIG1heEJhdGNoU2l6ZUluQnl0ZXM6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDEwMjQwMDsgfSxcclxuICAgICAgICAgICAgZGlzYWJsZVRlbGVtZXRyeTogZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0sXHJcbiAgICAgICAgICAgIGVuYWJsZVNlc3Npb25TdG9yYWdlQnVmZmVyOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0cnVlOyB9LFxyXG4gICAgICAgICAgICBpc1JldHJ5RGlzYWJsZWQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZhbHNlOyB9LFxyXG4gICAgICAgICAgICBpc0JlYWNvbkFwaURpc2FibGVkOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0cnVlOyB9LFxyXG4gICAgICAgICAgICBvbnVubG9hZERpc2FibGVCZWFjb246IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZhbHNlOyB9LFxyXG4gICAgICAgICAgICBpbnN0cnVtZW50YXRpb25LZXk6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSxcclxuICAgICAgICAgICAgbmFtZVByZWZpeDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9LFxyXG4gICAgICAgICAgICBzYW1wbGluZ1BlcmNlbnRhZ2U6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDEwMDsgfVxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgU2VuZGVyLl9nZXRFbXB0eUFwcEluc2lnaHRzQ2hhbm5lbENvbmZpZyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBlbmRwb2ludFVybDogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICBlbWl0TGluZURlbGltaXRlZEpzb246IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgbWF4QmF0Y2hJbnRlcnZhbDogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICBtYXhCYXRjaFNpemVJbkJ5dGVzOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgIGRpc2FibGVUZWxlbWV0cnk6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgZW5hYmxlU2Vzc2lvblN0b3JhZ2VCdWZmZXI6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgaXNSZXRyeURpc2FibGVkOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgIGlzQmVhY29uQXBpRGlzYWJsZWQ6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgb251bmxvYWREaXNhYmxlQmVhY29uOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgIGluc3RydW1lbnRhdGlvbktleTogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICBuYW1lUHJlZml4OiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgIHNhbXBsaW5nUGVyY2VudGFnZTogdW5kZWZpbmVkXHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbiAgICBTZW5kZXIucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpO1xyXG4gICAgfTtcclxuICAgIFNlbmRlci5wcm90b3R5cGUucmVzdW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpO1xyXG4gICAgfTtcclxuICAgIFNlbmRlci5wcm90b3R5cGUuZmx1c2ggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgdGhpcy50cmlnZ2VyU2VuZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICB0aGlzLmRpYWdMb2coKS50aHJvd0ludGVybmFsKExvZ2dpbmdTZXZlcml0eS5DUklUSUNBTCwgX0ludGVybmFsTWVzc2FnZUlkLkZsdXNoRmFpbGVkLCBcImZsdXNoIGZhaWxlZCwgdGVsZW1ldHJ5IHdpbGwgbm90IGJlIGNvbGxlY3RlZDogXCIgKyBVdGlsLmdldEV4Y2VwdGlvbk5hbWUoZSksIHsgZXhjZXB0aW9uOiBVdGlsLmR1bXAoZSkgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNlbmRlci5wcm90b3R5cGUub251bmxvYWRGbHVzaCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoKHRoaXMuX3NlbmRlckNvbmZpZy5vbnVubG9hZERpc2FibGVCZWFjb24oKSA9PT0gZmFsc2UgfHwgdGhpcy5fc2VuZGVyQ29uZmlnLmlzQmVhY29uQXBpRGlzYWJsZWQoKSA9PT0gZmFsc2UpICYmIFV0aWwuSXNCZWFjb25BcGlTdXBwb3J0ZWQoKSkge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyU2VuZCh0cnVlLCB0aGlzLl9iZWFjb25TZW5kZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRpYWdMb2coKS50aHJvd0ludGVybmFsKExvZ2dpbmdTZXZlcml0eS5DUklUSUNBTCwgX0ludGVybmFsTWVzc2FnZUlkLkZhaWxlZFRvU2VuZFF1ZXVlZFRlbGVtZXRyeSwgXCJmYWlsZWQgdG8gZmx1c2ggd2l0aCBiZWFjb24gc2VuZGVyIG9uIHBhZ2UgdW5sb2FkLCB0ZWxlbWV0cnkgd2lsbCBub3QgYmUgY29sbGVjdGVkOiBcIiArIFV0aWwuZ2V0RXhjZXB0aW9uTmFtZShlKSwgeyBleGNlcHRpb246IFV0aWwuZHVtcChlKSB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5mbHVzaCgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTZW5kZXIucHJvdG90eXBlLnRlYXJkb3duID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpO1xyXG4gICAgfTtcclxuICAgIFNlbmRlci5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChjb25maWcsIGNvcmUsIGV4dGVuc2lvbnMsIHBsdWdpbkNoYWluKSB7XHJcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5pbml0aWFsaXplLmNhbGwodGhpcywgY29uZmlnLCBjb3JlLCBleHRlbnNpb25zLCBwbHVnaW5DaGFpbik7XHJcbiAgICAgICAgdmFyIGN0eCA9IHRoaXMuX2dldFRlbEN0eCgpO1xyXG4gICAgICAgIHZhciBpZGVudGlmaWVyID0gdGhpcy5pZGVudGlmaWVyO1xyXG4gICAgICAgIHRoaXMuX3NlcmlhbGl6ZXIgPSBuZXcgU2VyaWFsaXplcihjb3JlLmxvZ2dlcik7XHJcbiAgICAgICAgdGhpcy5fY29uc2VjdXRpdmVFcnJvcnMgPSAwO1xyXG4gICAgICAgIHRoaXMuX3JldHJ5QXQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX2xhc3RTZW5kID0gMDtcclxuICAgICAgICB0aGlzLl9zZW5kZXIgPSBudWxsO1xyXG4gICAgICAgIHZhciBkZWZhdWx0Q29uZmlnID0gU2VuZGVyLl9nZXREZWZhdWx0QXBwSW5zaWdodHNDaGFubmVsQ29uZmlnKCk7XHJcbiAgICAgICAgdGhpcy5fc2VuZGVyQ29uZmlnID0gU2VuZGVyLl9nZXRFbXB0eUFwcEluc2lnaHRzQ2hhbm5lbENvbmZpZygpO1xyXG4gICAgICAgIHZhciBfbG9vcF8xID0gZnVuY3Rpb24gKGZpZWxkKSB7XHJcbiAgICAgICAgICAgIHRoaXNfMS5fc2VuZGVyQ29uZmlnW2ZpZWxkXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGN0eC5nZXRDb25maWcoaWRlbnRpZmllciwgZmllbGQsIGRlZmF1bHRDb25maWdbZmllbGRdKCkpOyB9O1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdmFyIHRoaXNfMSA9IHRoaXM7XHJcbiAgICAgICAgZm9yICh2YXIgZmllbGQgaW4gZGVmYXVsdENvbmZpZykge1xyXG4gICAgICAgICAgICBfbG9vcF8xKGZpZWxkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fYnVmZmVyID0gKHRoaXMuX3NlbmRlckNvbmZpZy5lbmFibGVTZXNzaW9uU3RvcmFnZUJ1ZmZlciAmJiBVdGlsLmNhblVzZVNlc3Npb25TdG9yYWdlKCkpXHJcbiAgICAgICAgICAgID8gbmV3IFNlc3Npb25TdG9yYWdlU2VuZEJ1ZmZlcih0aGlzLmRpYWdMb2coKSwgdGhpcy5fc2VuZGVyQ29uZmlnKSA6IG5ldyBBcnJheVNlbmRCdWZmZXIodGhpcy5fc2VuZGVyQ29uZmlnKTtcclxuICAgICAgICB0aGlzLl9zYW1wbGUgPSBuZXcgU2FtcGxlKHRoaXMuX3NlbmRlckNvbmZpZy5zYW1wbGluZ1BlcmNlbnRhZ2UoKSwgdGhpcy5kaWFnTG9nKCkpO1xyXG4gICAgICAgIGlmICghdGhpcy5fc2VuZGVyQ29uZmlnLmlzQmVhY29uQXBpRGlzYWJsZWQoKSAmJiBVdGlsLklzQmVhY29uQXBpU3VwcG9ydGVkKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5fc2VuZGVyID0gdGhpcy5fYmVhY29uU2VuZGVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKCFDb3JlVXRpbHMuaXNVbmRlZmluZWQoWE1MSHR0cFJlcXVlc3QpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGVzdFhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKFwid2l0aENyZWRlbnRpYWxzXCIgaW4gdGVzdFhocikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbmRlciA9IHRoaXMuX3hoclNlbmRlcjtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9YTUxIdHRwUmVxdWVzdFN1cHBvcnRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmICghQ29yZVV0aWxzLmlzVW5kZWZpbmVkKFhEb21haW5SZXF1ZXN0KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbmRlciA9IHRoaXMuX3hkclNlbmRlcjsgLy8gSUUgOCBhbmQgOVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNlbmRlci5wcm90b3R5cGUucHJvY2Vzc1RlbGVtZXRyeSA9IGZ1bmN0aW9uICh0ZWxlbWV0cnlJdGVtLCBpdGVtQ3R4KSB7XHJcbiAgICAgICAgaXRlbUN0eCA9IHRoaXMuX2dldFRlbEN0eChpdGVtQ3R4KTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvLyBpZiBtYXN0ZXIgb2ZmIHN3aXRjaCBpcyBzZXQsIGRvbid0IHNlbmQgYW55IGRhdGFcclxuICAgICAgICAgICAgaWYgKHRoaXMuX3NlbmRlckNvbmZpZy5kaXNhYmxlVGVsZW1ldHJ5KCkpIHtcclxuICAgICAgICAgICAgICAgIC8vIERvIG5vdCBzZW5kL3NhdmUgZGF0YVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIHZhbGlkYXRlIGlucHV0XHJcbiAgICAgICAgICAgIGlmICghdGVsZW1ldHJ5SXRlbSkge1xyXG4gICAgICAgICAgICAgICAgaXRlbUN0eC5kaWFnTG9nKCkudGhyb3dJbnRlcm5hbChMb2dnaW5nU2V2ZXJpdHkuQ1JJVElDQUwsIF9JbnRlcm5hbE1lc3NhZ2VJZC5DYW5ub3RTZW5kRW1wdHlUZWxlbWV0cnksIFwiQ2Fubm90IHNlbmQgZW1wdHkgdGVsZW1ldHJ5XCIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIHZhbGlkYXRlIGV2ZW50XHJcbiAgICAgICAgICAgIGlmICh0ZWxlbWV0cnlJdGVtLmJhc2VEYXRhICYmICF0ZWxlbWV0cnlJdGVtLmJhc2VUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtQ3R4LmRpYWdMb2coKS50aHJvd0ludGVybmFsKExvZ2dpbmdTZXZlcml0eS5DUklUSUNBTCwgX0ludGVybmFsTWVzc2FnZUlkLkludmFsaWRFdmVudCwgXCJDYW5ub3Qgc2VuZCB0ZWxlbWV0cnkgd2l0aG91dCBiYXNlRGF0YSBhbmQgYmFzZVR5cGVcIik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCF0ZWxlbWV0cnlJdGVtLmJhc2VUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBEZWZhdWx0XHJcbiAgICAgICAgICAgICAgICB0ZWxlbWV0cnlJdGVtLmJhc2VUeXBlID0gXCJFdmVudERhdGFcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBlbnN1cmUgYSBzZW5kZXIgd2FzIGNvbnN0cnVjdGVkXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5fc2VuZGVyKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtQ3R4LmRpYWdMb2coKS50aHJvd0ludGVybmFsKExvZ2dpbmdTZXZlcml0eS5DUklUSUNBTCwgX0ludGVybmFsTWVzc2FnZUlkLlNlbmRlck5vdEluaXRpYWxpemVkLCBcIlNlbmRlciB3YXMgbm90IGluaXRpYWxpemVkXCIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoaXMgaXRlbSBzaG91bGQgYmUgc2FtcGxlZCBpbiwgZWxzZSBhZGQgc2FtcGxlUmF0ZSB0YWdcclxuICAgICAgICAgICAgaWYgKCF0aGlzLl9pc1NhbXBsZWRJbih0ZWxlbWV0cnlJdGVtKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gSXRlbSBpcyBzYW1wbGVkIG91dCwgZG8gbm90IHNlbmQgaXRcclxuICAgICAgICAgICAgICAgIGl0ZW1DdHguZGlhZ0xvZygpLnRocm93SW50ZXJuYWwoTG9nZ2luZ1NldmVyaXR5LldBUk5JTkcsIF9JbnRlcm5hbE1lc3NhZ2VJZC5UZWxlbWV0cnlTYW1wbGVkQW5kTm90U2VudCwgXCJUZWxlbWV0cnkgaXRlbSB3YXMgc2FtcGxlZCBvdXQgYW5kIG5vdCBzZW50XCIsIHsgU2FtcGxlUmF0ZTogdGhpcy5fc2FtcGxlLnNhbXBsZVJhdGUgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0ZWxlbWV0cnlJdGVtW1NhbXBsZVJhdGVdID0gdGhpcy5fc2FtcGxlLnNhbXBsZVJhdGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gY29uc3RydWN0IGFuIGVudmVsb3BlIHRoYXQgQXBwbGljYXRpb24gSW5zaWdodHMgZW5kcG9pbnQgY2FuIHVuZGVyc3RhbmRcclxuICAgICAgICAgICAgdmFyIGFpRW52ZWxvcGVfMSA9IFNlbmRlci5jb25zdHJ1Y3RFbnZlbG9wZSh0ZWxlbWV0cnlJdGVtLCB0aGlzLl9zZW5kZXJDb25maWcuaW5zdHJ1bWVudGF0aW9uS2V5KCksIGl0ZW1DdHguZGlhZ0xvZygpKTtcclxuICAgICAgICAgICAgaWYgKCFhaUVudmVsb3BlXzEpIHtcclxuICAgICAgICAgICAgICAgIGl0ZW1DdHguZGlhZ0xvZygpLnRocm93SW50ZXJuYWwoTG9nZ2luZ1NldmVyaXR5LkNSSVRJQ0FMLCBfSW50ZXJuYWxNZXNzYWdlSWQuQ3JlYXRlRW52ZWxvcGVFcnJvciwgXCJVbmFibGUgdG8gY3JlYXRlIGFuIEFwcEluc2lnaHRzIGVudmVsb3BlXCIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBkb05vdFNlbmRJdGVtXzEgPSBmYWxzZTtcclxuICAgICAgICAgICAgLy8gdGhpcyBpcyBmb3IgcnVubmluZyBpbiBsZWdhY3kgbW9kZSwgd2hlcmUgY3VzdG9tZXIgbWF5IGFscmVhZHkgaGF2ZSBhIGN1c3RvbSBpbml0aWFsaXplciBwcmVzZW50XHJcbiAgICAgICAgICAgIGlmICh0ZWxlbWV0cnlJdGVtLnRhZ3MgJiYgdGVsZW1ldHJ5SXRlbS50YWdzW1Byb2Nlc3NMZWdhY3ldKSB7XHJcbiAgICAgICAgICAgICAgICBDb3JlVXRpbHMuYXJyRm9yRWFjaCh0ZWxlbWV0cnlJdGVtLnRhZ3NbUHJvY2Vzc0xlZ2FjeV0sIGZ1bmN0aW9uIChjYWxsQmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsQmFjayAmJiBjYWxsQmFjayhhaUVudmVsb3BlXzEpID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9Ob3RTZW5kSXRlbV8xID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1DdHguZGlhZ0xvZygpLndhcm5Ub0NvbnNvbGUoXCJUZWxlbWV0cnkgcHJvY2Vzc29yIGNoZWNrIHJldHVybnMgZmFsc2VcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9nIGVycm9yIGJ1dCBkb250IHN0b3AgZXhlY3V0aW5nIHJlc3Qgb2YgdGhlIHRlbGVtZXRyeSBpbml0aWFsaXplcnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG9Ob3RTZW5kSXRlbSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1DdHguZGlhZ0xvZygpLnRocm93SW50ZXJuYWwoTG9nZ2luZ1NldmVyaXR5LkNSSVRJQ0FMLCBfSW50ZXJuYWxNZXNzYWdlSWQuVGVsZW1ldHJ5SW5pdGlhbGl6ZXJGYWlsZWQsIFwiT25lIG9mIHRlbGVtZXRyeSBpbml0aWFsaXplcnMgZmFpbGVkLCB0ZWxlbWV0cnkgaXRlbSB3aWxsIG5vdCBiZSBzZW50OiBcIiArIFV0aWwuZ2V0RXhjZXB0aW9uTmFtZShlKSwgeyBleGNlcHRpb246IFV0aWwuZHVtcChlKSB9LCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSB0ZWxlbWV0cnlJdGVtLnRhZ3NbUHJvY2Vzc0xlZ2FjeV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGRvTm90U2VuZEl0ZW1fMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuOyAvLyBkbyBub3Qgc2VuZCwgbm8gbmVlZCB0byBleGVjdXRlIG5leHQgcGx1Z2luXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gY2hlY2sgaWYgdGhlIGluY29taW5nIHBheWxvYWQgaXMgdG9vIGxhcmdlLCB0cnVuY2F0ZSBpZiBuZWNlc3NhcnlcclxuICAgICAgICAgICAgdmFyIHBheWxvYWQgPSB0aGlzLl9zZXJpYWxpemVyLnNlcmlhbGl6ZShhaUVudmVsb3BlXzEpO1xyXG4gICAgICAgICAgICAvLyBmbHVzaCBpZiB3ZSB3b3VsZCBleGNlZWQgdGhlIG1heC1zaXplIGxpbWl0IGJ5IGFkZGluZyB0aGlzIGl0ZW1cclxuICAgICAgICAgICAgdmFyIGJ1ZmZlclBheWxvYWQgPSB0aGlzLl9idWZmZXIuZ2V0SXRlbXMoKTtcclxuICAgICAgICAgICAgdmFyIGJhdGNoID0gdGhpcy5fYnVmZmVyLmJhdGNoUGF5bG9hZHMoYnVmZmVyUGF5bG9hZCk7XHJcbiAgICAgICAgICAgIGlmIChiYXRjaCAmJiAoYmF0Y2gubGVuZ3RoICsgcGF5bG9hZC5sZW5ndGggPiB0aGlzLl9zZW5kZXJDb25maWcubWF4QmF0Y2hTaXplSW5CeXRlcygpKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyU2VuZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGVucXVldWUgdGhlIHBheWxvYWRcclxuICAgICAgICAgICAgdGhpcy5fYnVmZmVyLmVucXVldWUocGF5bG9hZCk7XHJcbiAgICAgICAgICAgIC8vIGVuc3VyZSBhbiBpbnZvY2F0aW9uIHRpbWVvdXQgaXMgc2V0XHJcbiAgICAgICAgICAgIHRoaXMuX3NldHVwVGltZXIoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgaXRlbUN0eC5kaWFnTG9nKCkudGhyb3dJbnRlcm5hbChMb2dnaW5nU2V2ZXJpdHkuV0FSTklORywgX0ludGVybmFsTWVzc2FnZUlkLkZhaWxlZEFkZGluZ1RlbGVtZXRyeVRvQnVmZmVyLCBcIkZhaWxlZCBhZGRpbmcgdGVsZW1ldHJ5IHRvIHRoZSBzZW5kZXIncyBidWZmZXIsIHNvbWUgdGVsZW1ldHJ5IHdpbGwgYmUgbG9zdDogXCIgKyBVdGlsLmdldEV4Y2VwdGlvbk5hbWUoZSksIHsgZXhjZXB0aW9uOiBVdGlsLmR1bXAoZSkgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGhhbmQgb2ZmIHRoZSB0ZWxlbWV0cnkgaXRlbSB0byB0aGUgbmV4dCBwbHVnaW5cclxuICAgICAgICB0aGlzLnByb2Nlc3NOZXh0KHRlbGVtZXRyeUl0ZW0sIGl0ZW1DdHgpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogeGhyIHN0YXRlIGNoYW5nZXNcclxuICAgICAqL1xyXG4gICAgU2VuZGVyLnByb3RvdHlwZS5feGhyUmVhZHlTdGF0ZUNoYW5nZSA9IGZ1bmN0aW9uICh4aHIsIHBheWxvYWQsIGNvdW50T2ZJdGVtc0luUGF5bG9hZCkge1xyXG4gICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCkge1xyXG4gICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX2FwcElkKSB7XHJcbiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHRoaXMuX3BhcnNlUmVzcG9uc2UoX2dldFJlc3BvbnNlVGV4dCh4aHIpIHx8IHhoci5yZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuYXBwSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9hcHBJZCA9IHJlc3BvbnNlLmFwcElkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICgoeGhyLnN0YXR1cyA8IDIwMCB8fCB4aHIuc3RhdHVzID49IDMwMCkgJiYgeGhyLnN0YXR1cyAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9zZW5kZXJDb25maWcuaXNSZXRyeURpc2FibGVkKCkgJiYgdGhpcy5faXNSZXRyaWFibGUoeGhyLnN0YXR1cykpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXNlbmRQYXlsb2FkKHBheWxvYWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlhZ0xvZygpLnRocm93SW50ZXJuYWwoTG9nZ2luZ1NldmVyaXR5LldBUk5JTkcsIF9JbnRlcm5hbE1lc3NhZ2VJZC5UcmFuc21pc3Npb25GYWlsZWQsIFwiLiBcIiArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiUmVzcG9uc2UgY29kZSBcIiArIHhoci5zdGF0dXMgKyBcIi4gV2lsbCByZXRyeSB0byBzZW5kIFwiICsgcGF5bG9hZC5sZW5ndGggKyBcIiBpdGVtcy5cIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbkVycm9yKHBheWxvYWQsIHRoaXMuX2Zvcm1hdEVycm9yTWVzc2FnZVhocih4aHIpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChPZmZsaW5lLmlzT2ZmbGluZSgpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBOb3RlOiBEb24ndCBjaGVjayBmb3Igc3RhdXMgPT0gMCwgc2luY2UgYWRibG9jayBnaXZlcyB0aGlzIGNvZGVcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fc2VuZGVyQ29uZmlnLmlzUmV0cnlEaXNhYmxlZCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9mZmxpbmVCYWNrT2ZmTXVsdGlwbGllciA9IDEwOyAvLyBhcmJyaXRyYXJ5IG51bWJlclxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc2VuZFBheWxvYWQocGF5bG9hZCwgb2ZmbGluZUJhY2tPZmZNdWx0aXBsaWVyKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpYWdMb2coKS50aHJvd0ludGVybmFsKExvZ2dpbmdTZXZlcml0eS5XQVJOSU5HLCBfSW50ZXJuYWxNZXNzYWdlSWQuVHJhbnNtaXNzaW9uRmFpbGVkLCBcIi4gT2ZmbGluZSAtIFJlc3BvbnNlIENvZGU6IFwiICsgeGhyLnN0YXR1cyArIFwiLiBPZmZsaW5lIHN0YXR1czogXCIgKyBPZmZsaW5lLmlzT2ZmbGluZSgpICsgXCIuIFdpbGwgcmV0cnkgdG8gc2VuZCBcIiArIHBheWxvYWQubGVuZ3RoICsgXCIgaXRlbXMuXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHhoci5zdGF0dXMgPT09IDIwNikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB0aGlzLl9wYXJzZVJlc3BvbnNlKF9nZXRSZXNwb25zZVRleHQoeGhyKSB8fCB4aHIucmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgIXRoaXMuX3NlbmRlckNvbmZpZy5pc1JldHJ5RGlzYWJsZWQoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vblBhcnRpYWxTdWNjZXNzKHBheWxvYWQsIHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX29uRXJyb3IocGF5bG9hZCwgdGhpcy5fZm9ybWF0RXJyb3JNZXNzYWdlWGhyKHhocikpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NvbnNlY3V0aXZlRXJyb3JzID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9vblN1Y2Nlc3MocGF5bG9hZCwgY291bnRPZkl0ZW1zSW5QYXlsb2FkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEltbWVkaWF0ZWx5IHNlbmQgYnVmZmVyZWQgZGF0YVxyXG4gICAgICogQHBhcmFtIGFzeW5jIHtib29sZWFufSAtIEluZGljYXRlcyBpZiB0aGUgZXZlbnRzIHNob3VsZCBiZSBzZW50IGFzeW5jaHJvbm91c2x5XHJcbiAgICAgKiBAcGFyYW0gZm9yY2VkU2VuZGVyIHtTZW5kZXJGdW5jdGlvbn0gLSBJbmRpY2F0ZXMgdGhlIGZvcmNlZFNlbmRlciwgdW5kZWZpbmVkIGlmIG5vdCBwYXNzZWRcclxuICAgICAqL1xyXG4gICAgU2VuZGVyLnByb3RvdHlwZS50cmlnZ2VyU2VuZCA9IGZ1bmN0aW9uIChhc3luYywgZm9yY2VkU2VuZGVyKSB7XHJcbiAgICAgICAgaWYgKGFzeW5jID09PSB2b2lkIDApIHsgYXN5bmMgPSB0cnVlOyB9XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgLy8gU2VuZCBkYXRhIG9ubHkgaWYgZGlzYWJsZVRlbGVtZXRyeSBpcyBmYWxzZVxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX3NlbmRlckNvbmZpZy5kaXNhYmxlVGVsZW1ldHJ5KCkpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9idWZmZXIuY291bnQoKSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcGF5bG9hZCA9IHRoaXMuX2J1ZmZlci5nZXRJdGVtcygpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGludm9rZSBzZW5kXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZvcmNlZFNlbmRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JjZWRTZW5kZXIuY2FsbCh0aGlzLCBwYXlsb2FkLCBhc3luYyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZW5kZXIocGF5bG9hZCwgYXN5bmMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBsYXN0U2VuZCB0aW1lIHRvIGVuYWJsZSB0aHJvdHRsaW5nXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0U2VuZCA9ICtuZXcgRGF0ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2J1ZmZlci5jbGVhcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl90aW1lb3V0SGFuZGxlKTtcclxuICAgICAgICAgICAgdGhpcy5fdGltZW91dEhhbmRsZSA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMuX3JldHJ5QXQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAvKiBJZ25vcmUgdGhpcyBlcnJvciBmb3IgSUUgdW5kZXIgdjEwICovXHJcbiAgICAgICAgICAgIGlmICghVXRpbC5nZXRJRVZlcnNpb24oKSB8fCBVdGlsLmdldElFVmVyc2lvbigpID4gOSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kaWFnTG9nKCkudGhyb3dJbnRlcm5hbChMb2dnaW5nU2V2ZXJpdHkuQ1JJVElDQUwsIF9JbnRlcm5hbE1lc3NhZ2VJZC5UcmFuc21pc3Npb25GYWlsZWQsIFwiVGVsZW1ldHJ5IHRyYW5zbWlzc2lvbiBmYWlsZWQsIHNvbWUgdGVsZW1ldHJ5IHdpbGwgYmUgbG9zdDogXCIgKyBVdGlsLmdldEV4Y2VwdGlvbk5hbWUoZSksIHsgZXhjZXB0aW9uOiBVdGlsLmR1bXAoZSkgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBlcnJvciBoYW5kbGVyXHJcbiAgICAgKi9cclxuICAgIFNlbmRlci5wcm90b3R5cGUuX29uRXJyb3IgPSBmdW5jdGlvbiAocGF5bG9hZCwgbWVzc2FnZSwgZXZlbnQpIHtcclxuICAgICAgICB0aGlzLmRpYWdMb2coKS50aHJvd0ludGVybmFsKExvZ2dpbmdTZXZlcml0eS5XQVJOSU5HLCBfSW50ZXJuYWxNZXNzYWdlSWQuT25FcnJvciwgXCJGYWlsZWQgdG8gc2VuZCB0ZWxlbWV0cnkuXCIsIHsgbWVzc2FnZTogbWVzc2FnZSB9KTtcclxuICAgICAgICB0aGlzLl9idWZmZXIuY2xlYXJTZW50KHBheWxvYWQpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogcGFydGlhbCBzdWNjZXNzIGhhbmRsZXJcclxuICAgICAqL1xyXG4gICAgU2VuZGVyLnByb3RvdHlwZS5fb25QYXJ0aWFsU3VjY2VzcyA9IGZ1bmN0aW9uIChwYXlsb2FkLCByZXN1bHRzKSB7XHJcbiAgICAgICAgdmFyIGZhaWxlZCA9IFtdO1xyXG4gICAgICAgIHZhciByZXRyeSA9IFtdO1xyXG4gICAgICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCB0aGUgcmV2ZXJzZWQgYXJyYXkgb2YgZXJyb3JzIHNvIHRoYXQgc3BsaWNpbmcgZG9lc24ndCBoYXZlIGludmFsaWQgaW5kZXhlcyBhZnRlciB0aGUgZmlyc3QgaXRlbS5cclxuICAgICAgICB2YXIgZXJyb3JzID0gcmVzdWx0cy5lcnJvcnMucmV2ZXJzZSgpO1xyXG4gICAgICAgIGZvciAodmFyIF9pID0gMCwgZXJyb3JzXzEgPSBlcnJvcnM7IF9pIDwgZXJyb3JzXzEubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBlcnJvciA9IGVycm9yc18xW19pXTtcclxuICAgICAgICAgICAgdmFyIGV4dHJhY3RlZCA9IHBheWxvYWQuc3BsaWNlKGVycm9yLmluZGV4LCAxKVswXTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX2lzUmV0cmlhYmxlKGVycm9yLnN0YXR1c0NvZGUpKSB7XHJcbiAgICAgICAgICAgICAgICByZXRyeS5wdXNoKGV4dHJhY3RlZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBBbGwgb3RoZXIgZXJyb3JzLCBpbmNsdWRpbmc6IDQwMiAoTW9udGhseSBxdW90YSBleGNlZWRlZCkgYW5kIDQzOSAoVG9vIG1hbnkgcmVxdWVzdHMgYW5kIHJlZnJlc2ggY2FjaGUpLlxyXG4gICAgICAgICAgICAgICAgZmFpbGVkLnB1c2goZXh0cmFjdGVkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocGF5bG9hZC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX29uU3VjY2VzcyhwYXlsb2FkLCByZXN1bHRzLml0ZW1zQWNjZXB0ZWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZmFpbGVkLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgdGhpcy5fb25FcnJvcihmYWlsZWQsIHRoaXMuX2Zvcm1hdEVycm9yTWVzc2FnZVhocihudWxsLCBbJ3BhcnRpYWwgc3VjY2VzcycsIHJlc3VsdHMuaXRlbXNBY2NlcHRlZCwgJ29mJywgcmVzdWx0cy5pdGVtc1JlY2VpdmVkXS5qb2luKCcgJykpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJldHJ5Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgdGhpcy5fcmVzZW5kUGF5bG9hZChyZXRyeSk7XHJcbiAgICAgICAgICAgIHRoaXMuZGlhZ0xvZygpLnRocm93SW50ZXJuYWwoTG9nZ2luZ1NldmVyaXR5LldBUk5JTkcsIF9JbnRlcm5hbE1lc3NhZ2VJZC5UcmFuc21pc3Npb25GYWlsZWQsIFwiUGFydGlhbCBzdWNjZXNzLiBcIiArXHJcbiAgICAgICAgICAgICAgICBcIkRlbGl2ZXJlZDogXCIgKyBwYXlsb2FkLmxlbmd0aCArIFwiLCBGYWlsZWQ6IFwiICsgZmFpbGVkLmxlbmd0aCArXHJcbiAgICAgICAgICAgICAgICBcIi4gV2lsbCByZXRyeSB0byBzZW5kIFwiICsgcmV0cnkubGVuZ3RoICsgXCIgb3VyIG9mIFwiICsgcmVzdWx0cy5pdGVtc1JlY2VpdmVkICsgXCIgaXRlbXNcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogc3VjY2VzcyBoYW5kbGVyXHJcbiAgICAgKi9cclxuICAgIFNlbmRlci5wcm90b3R5cGUuX29uU3VjY2VzcyA9IGZ1bmN0aW9uIChwYXlsb2FkLCBjb3VudE9mSXRlbXNJblBheWxvYWQpIHtcclxuICAgICAgICB0aGlzLl9idWZmZXIuY2xlYXJTZW50KHBheWxvYWQpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogeGRyIHN0YXRlIGNoYW5nZXNcclxuICAgICAqL1xyXG4gICAgU2VuZGVyLnByb3RvdHlwZS5feGRyT25Mb2FkID0gZnVuY3Rpb24gKHhkciwgcGF5bG9hZCkge1xyXG4gICAgICAgIHZhciByZXNwb25zZVRleHQgPSBfZ2V0UmVzcG9uc2VUZXh0KHhkcik7XHJcbiAgICAgICAgaWYgKHhkciAmJiAocmVzcG9uc2VUZXh0ICsgXCJcIiA9PT0gXCIyMDBcIiB8fCByZXNwb25zZVRleHQgPT09IFwiXCIpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NvbnNlY3V0aXZlRXJyb3JzID0gMDtcclxuICAgICAgICAgICAgdGhpcy5fb25TdWNjZXNzKHBheWxvYWQsIDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdHMgPSB0aGlzLl9wYXJzZVJlc3BvbnNlKHJlc3BvbnNlVGV4dCk7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHRzICYmIHJlc3VsdHMuaXRlbXNSZWNlaXZlZCAmJiByZXN1bHRzLml0ZW1zUmVjZWl2ZWQgPiByZXN1bHRzLml0ZW1zQWNjZXB0ZWRcclxuICAgICAgICAgICAgICAgICYmICF0aGlzLl9zZW5kZXJDb25maWcuaXNSZXRyeURpc2FibGVkKCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX29uUGFydGlhbFN1Y2Nlc3MocGF5bG9hZCwgcmVzdWx0cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9vbkVycm9yKHBheWxvYWQsIHRoaXMuX2Zvcm1hdEVycm9yTWVzc2FnZVhkcih4ZHIpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTZW5kZXIucHJvdG90eXBlLl9pc1NhbXBsZWRJbiA9IGZ1bmN0aW9uIChlbnZlbG9wZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zYW1wbGUuaXNTYW1wbGVkSW4oZW52ZWxvcGUpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogU2VuZCBCZWFjb24gQVBJIHJlcXVlc3RcclxuICAgICAqIEBwYXJhbSBwYXlsb2FkIHtzdHJpbmd9IC0gVGhlIGRhdGEgcGF5bG9hZCB0byBiZSBzZW50LlxyXG4gICAgICogQHBhcmFtIGlzQXN5bmMge2Jvb2xlYW59IC0gbm90IHVzZWRcclxuICAgICAqIE5vdGU6IEJlYWNvbiBBUEkgZG9lcyBub3Qgc3VwcG9ydCBjdXN0b20gaGVhZGVycyBhbmQgd2UgYXJlIG5vdCBhYmxlIHRvIGdldFxyXG4gICAgICogYXBwSWQgZnJvbSB0aGUgYmFja2VuZCBmb3IgdGhlIGNvcnJlY3QgY29ycmVsYXRpb24uXHJcbiAgICAgKi9cclxuICAgIFNlbmRlci5wcm90b3R5cGUuX2JlYWNvblNlbmRlciA9IGZ1bmN0aW9uIChwYXlsb2FkLCBpc0FzeW5jKSB7XHJcbiAgICAgICAgdmFyIHVybCA9IHRoaXMuX3NlbmRlckNvbmZpZy5lbmRwb2ludFVybCgpO1xyXG4gICAgICAgIHZhciBiYXRjaCA9IHRoaXMuX2J1ZmZlci5iYXRjaFBheWxvYWRzKHBheWxvYWQpO1xyXG4gICAgICAgIC8vIENocm9tZSBvbmx5IGFsbG93cyBDT1JTLXNhZmVsaXN0ZWQgdmFsdWVzIGZvciB0aGUgc2VuZEJlYWNvbiBkYXRhIGFyZ3VtZW50XHJcbiAgICAgICAgLy8gc2VlOiBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD03MjAyODNcclxuICAgICAgICB2YXIgcGxhaW5UZXh0QmF0Y2ggPSBuZXcgQmxvYihbYmF0Y2hdLCB7IHR5cGU6ICd0ZXh0L3BsYWluO2NoYXJzZXQ9VVRGLTgnIH0pO1xyXG4gICAgICAgIC8vIFRoZSBzZW5kQmVhY29uIG1ldGhvZCByZXR1cm5zIHRydWUgaWYgdGhlIHVzZXIgYWdlbnQgaXMgYWJsZSB0byBzdWNjZXNzZnVsbHkgcXVldWUgdGhlIGRhdGEgZm9yIHRyYW5zZmVyLiBPdGhlcndpc2UgaXQgcmV0dXJucyBmYWxzZS5cclxuICAgICAgICB2YXIgcXVldWVkID0gZ2V0TmF2aWdhdG9yKCkuc2VuZEJlYWNvbih1cmwsIHBsYWluVGV4dEJhdGNoKTtcclxuICAgICAgICBpZiAocXVldWVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2J1ZmZlci5tYXJrQXNTZW50KHBheWxvYWQpO1xyXG4gICAgICAgICAgICAvLyBubyByZXNwb25zZSBmcm9tIGJlYWNvblNlbmRlciwgY2xlYXIgYnVmZmVyXHJcbiAgICAgICAgICAgIHRoaXMuX29uU3VjY2VzcyhwYXlsb2FkLCBwYXlsb2FkLmxlbmd0aCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl94aHJTZW5kZXIocGF5bG9hZCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuZGlhZ0xvZygpLnRocm93SW50ZXJuYWwoTG9nZ2luZ1NldmVyaXR5LldBUk5JTkcsIF9JbnRlcm5hbE1lc3NhZ2VJZC5UcmFuc21pc3Npb25GYWlsZWQsIFwiLiBcIiArIFwiRmFpbGVkIHRvIHNlbmQgdGVsZW1ldHJ5IHdpdGggQmVhY29uIEFQSSwgcmV0cmllZCB3aXRoIHhoclNlbmRlci5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogU2VuZCBYTUxIdHRwUmVxdWVzdFxyXG4gICAgICogQHBhcmFtIHBheWxvYWQge3N0cmluZ30gLSBUaGUgZGF0YSBwYXlsb2FkIHRvIGJlIHNlbnQuXHJcbiAgICAgKiBAcGFyYW0gaXNBc3luYyB7Ym9vbGVhbn0gLSBJbmRpY2F0ZXMgaWYgdGhlIHJlcXVlc3Qgc2hvdWxkIGJlIHNlbnQgYXN5bmNocm9ub3VzbHlcclxuICAgICAqL1xyXG4gICAgU2VuZGVyLnByb3RvdHlwZS5feGhyU2VuZGVyID0gZnVuY3Rpb24gKHBheWxvYWQsIGlzQXN5bmMpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgICAgICB2YXIgZW5kUG9pbnRVcmwgPSB0aGlzLl9zZW5kZXJDb25maWcuZW5kcG9pbnRVcmwoKTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB4aHJbRGlzYWJsZWRQcm9wZXJ0eU5hbWVdID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgLy8gSWYgdGhlIGVudmlyb25tZW50IGhhcyBsb2NrZWQgZG93biB0aGUgWE1MSHR0cFJlcXVlc3QgKHByZXZlbnRFeHRlbnNpb25zIGFuZC9vciBmcmVlemUpLCB0aGlzIHdvdWxkXHJcbiAgICAgICAgICAgIC8vIGNhdXNlIHRoZSByZXF1ZXN0IHRvIGZhaWwgYW5kIHdlIG5vIHRlbGVtZXRyeSB3b3VsZCBiZSBzZW50XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHhoci5vcGVuKFwiUE9TVFwiLCBlbmRQb2ludFVybCwgaXNBc3luYyk7XHJcbiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJDb250ZW50LXR5cGVcIiwgXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xyXG4gICAgICAgIC8vIGFwcGVuZCBTZGstQ29udGV4dCByZXF1ZXN0IGhlYWRlciBvbmx5IGluIGNhc2Ugb2YgYnJlZXplIGVuZHBvaW50XHJcbiAgICAgICAgaWYgKFV0aWwuaXNJbnRlcm5hbEFwcGxpY2F0aW9uSW5zaWdodHNFbmRwb2ludChlbmRQb2ludFVybCkpIHtcclxuICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoUmVxdWVzdEhlYWRlcnMuc2RrQ29udGV4dEhlYWRlciwgUmVxdWVzdEhlYWRlcnMuc2RrQ29udGV4dEhlYWRlckFwcElkUmVxdWVzdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5feGhyUmVhZHlTdGF0ZUNoYW5nZSh4aHIsIHBheWxvYWQsIHBheWxvYWQubGVuZ3RoKTsgfTtcclxuICAgICAgICB4aHIub25lcnJvciA9IGZ1bmN0aW9uIChldmVudCkgeyByZXR1cm4gX3RoaXMuX29uRXJyb3IocGF5bG9hZCwgX3RoaXMuX2Zvcm1hdEVycm9yTWVzc2FnZVhocih4aHIpLCBldmVudCk7IH07XHJcbiAgICAgICAgLy8gY29tcG9zZSBhbiBhcnJheSBvZiBwYXlsb2Fkc1xyXG4gICAgICAgIHZhciBiYXRjaCA9IHRoaXMuX2J1ZmZlci5iYXRjaFBheWxvYWRzKHBheWxvYWQpO1xyXG4gICAgICAgIHhoci5zZW5kKGJhdGNoKTtcclxuICAgICAgICB0aGlzLl9idWZmZXIubWFya0FzU2VudChwYXlsb2FkKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFBhcnNlcyB0aGUgcmVzcG9uc2UgZnJvbSB0aGUgYmFja2VuZC5cclxuICAgICAqIEBwYXJhbSByZXNwb25zZSAtIFhNTEh0dHBSZXF1ZXN0IG9yIFhEb21haW5SZXF1ZXN0IHJlc3BvbnNlXHJcbiAgICAgKi9cclxuICAgIFNlbmRlci5wcm90b3R5cGUuX3BhcnNlUmVzcG9uc2UgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBnZXRKU09OKCkucGFyc2UocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQuaXRlbXNSZWNlaXZlZCAmJiByZXN1bHQuaXRlbXNSZWNlaXZlZCA+PSByZXN1bHQuaXRlbXNBY2NlcHRlZCAmJlxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5pdGVtc1JlY2VpdmVkIC0gcmVzdWx0Lml0ZW1zQWNjZXB0ZWQgPT09IHJlc3VsdC5lcnJvcnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICB0aGlzLmRpYWdMb2coKS50aHJvd0ludGVybmFsKExvZ2dpbmdTZXZlcml0eS5DUklUSUNBTCwgX0ludGVybmFsTWVzc2FnZUlkLkludmFsaWRCYWNrZW5kUmVzcG9uc2UsIFwiQ2Fubm90IHBhcnNlIHRoZSByZXNwb25zZS4gXCIgKyBVdGlsLmdldEV4Y2VwdGlvbk5hbWUoZSksIHtcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlOiByZXNwb25zZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBSZXNlbmQgcGF5bG9hZC4gQWRkcyBwYXlsb2FkIGJhY2sgdG8gdGhlIHNlbmQgYnVmZmVyIGFuZCBzZXR1cCBhIHNlbmQgdGltZXIgKHdpdGggZXhwb25lbnRpYWwgYmFja29mZikuXHJcbiAgICAgKiBAcGFyYW0gcGF5bG9hZFxyXG4gICAgICovXHJcbiAgICBTZW5kZXIucHJvdG90eXBlLl9yZXNlbmRQYXlsb2FkID0gZnVuY3Rpb24gKHBheWxvYWQsIGxpbmVhckZhY3Rvcikge1xyXG4gICAgICAgIGlmIChsaW5lYXJGYWN0b3IgPT09IHZvaWQgMCkgeyBsaW5lYXJGYWN0b3IgPSAxOyB9XHJcbiAgICAgICAgaWYgKCFwYXlsb2FkIHx8IHBheWxvYWQubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fYnVmZmVyLmNsZWFyU2VudChwYXlsb2FkKTtcclxuICAgICAgICB0aGlzLl9jb25zZWN1dGl2ZUVycm9ycysrO1xyXG4gICAgICAgIGZvciAodmFyIF9pID0gMCwgcGF5bG9hZF8xID0gcGF5bG9hZDsgX2kgPCBwYXlsb2FkXzEubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBpdGVtID0gcGF5bG9hZF8xW19pXTtcclxuICAgICAgICAgICAgdGhpcy5fYnVmZmVyLmVucXVldWUoaXRlbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHNldHVwIHRpbWVyXHJcbiAgICAgICAgdGhpcy5fc2V0UmV0cnlUaW1lKGxpbmVhckZhY3Rvcik7XHJcbiAgICAgICAgdGhpcy5fc2V0dXBUaW1lcigpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQ2FsY3VsYXRlcyB0aGUgdGltZSB0byB3YWl0IGJlZm9yZSByZXRyeWluZyBpbiBjYXNlIG9mIGFuIGVycm9yIGJhc2VkIG9uXHJcbiAgICAgKiBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0V4cG9uZW50aWFsX2JhY2tvZmZcclxuICAgICAqL1xyXG4gICAgU2VuZGVyLnByb3RvdHlwZS5fc2V0UmV0cnlUaW1lID0gZnVuY3Rpb24gKGxpbmVhckZhY3Rvcikge1xyXG4gICAgICAgIHZhciBTbG90RGVsYXlJblNlY29uZHMgPSAxMDtcclxuICAgICAgICB2YXIgZGVsYXlJblNlY29uZHM7XHJcbiAgICAgICAgaWYgKHRoaXMuX2NvbnNlY3V0aXZlRXJyb3JzIDw9IDEpIHtcclxuICAgICAgICAgICAgZGVsYXlJblNlY29uZHMgPSBTbG90RGVsYXlJblNlY29uZHM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgYmFja09mZlNsb3QgPSAoTWF0aC5wb3coMiwgdGhpcy5fY29uc2VjdXRpdmVFcnJvcnMpIC0gMSkgLyAyO1xyXG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6aW5zZWN1cmUtcmFuZG9tXHJcbiAgICAgICAgICAgIHZhciBiYWNrT2ZmRGVsYXkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBiYWNrT2ZmU2xvdCAqIFNsb3REZWxheUluU2Vjb25kcykgKyAxO1xyXG4gICAgICAgICAgICBiYWNrT2ZmRGVsYXkgPSBsaW5lYXJGYWN0b3IgKiBiYWNrT2ZmRGVsYXk7XHJcbiAgICAgICAgICAgIGRlbGF5SW5TZWNvbmRzID0gTWF0aC5tYXgoTWF0aC5taW4oYmFja09mZkRlbGF5LCAzNjAwKSwgU2xvdERlbGF5SW5TZWNvbmRzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gVE9ETzogTG9nIHRoZSBiYWNrb2ZmIHRpbWUgbGlrZSB0aGUgQyMgdmVyc2lvbiBkb2VzLlxyXG4gICAgICAgIHZhciByZXRyeUFmdGVyVGltZVNwYW4gPSBEYXRlLm5vdygpICsgKGRlbGF5SW5TZWNvbmRzICogMTAwMCk7XHJcbiAgICAgICAgLy8gVE9ETzogTG9nIHRoZSByZXRyeSBhdCB0aW1lIGxpa2UgdGhlIEMjIHZlcnNpb24gZG9lcy5cclxuICAgICAgICB0aGlzLl9yZXRyeUF0ID0gcmV0cnlBZnRlclRpbWVTcGFuO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogU2V0cyB1cCB0aGUgdGltZXIgd2hpY2ggdHJpZ2dlcnMgYWN0dWFsbHkgc2VuZGluZyB0aGUgZGF0YS5cclxuICAgICAqL1xyXG4gICAgU2VuZGVyLnByb3RvdHlwZS5fc2V0dXBUaW1lciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmICghdGhpcy5fdGltZW91dEhhbmRsZSkge1xyXG4gICAgICAgICAgICB2YXIgcmV0cnlJbnRlcnZhbCA9IHRoaXMuX3JldHJ5QXQgPyBNYXRoLm1heCgwLCB0aGlzLl9yZXRyeUF0IC0gRGF0ZS5ub3coKSkgOiAwO1xyXG4gICAgICAgICAgICB2YXIgdGltZXJWYWx1ZSA9IE1hdGgubWF4KHRoaXMuX3NlbmRlckNvbmZpZy5tYXhCYXRjaEludGVydmFsKCksIHJldHJ5SW50ZXJ2YWwpO1xyXG4gICAgICAgICAgICB0aGlzLl90aW1lb3V0SGFuZGxlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy50cmlnZ2VyU2VuZCgpO1xyXG4gICAgICAgICAgICB9LCB0aW1lclZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDaGVja3MgaWYgdGhlIFNESyBzaG91bGQgcmVzZW5kIHRoZSBwYXlsb2FkIGFmdGVyIHJlY2VpdmluZyB0aGlzIHN0YXR1cyBjb2RlIGZyb20gdGhlIGJhY2tlbmQuXHJcbiAgICAgKiBAcGFyYW0gc3RhdHVzQ29kZVxyXG4gICAgICovXHJcbiAgICBTZW5kZXIucHJvdG90eXBlLl9pc1JldHJpYWJsZSA9IGZ1bmN0aW9uIChzdGF0dXNDb2RlKSB7XHJcbiAgICAgICAgcmV0dXJuIHN0YXR1c0NvZGUgPT09IDQwOCAvLyBUaW1lb3V0XHJcbiAgICAgICAgICAgIHx8IHN0YXR1c0NvZGUgPT09IDQyOSAvLyBUb28gbWFueSByZXF1ZXN0cy5cclxuICAgICAgICAgICAgfHwgc3RhdHVzQ29kZSA9PT0gNTAwIC8vIEludGVybmFsIHNlcnZlciBlcnJvci5cclxuICAgICAgICAgICAgfHwgc3RhdHVzQ29kZSA9PT0gNTAzOyAvLyBTZXJ2aWNlIHVuYXZhaWxhYmxlLlxyXG4gICAgfTtcclxuICAgIFNlbmRlci5wcm90b3R5cGUuX2Zvcm1hdEVycm9yTWVzc2FnZVhociA9IGZ1bmN0aW9uICh4aHIsIG1lc3NhZ2UpIHtcclxuICAgICAgICBpZiAoeGhyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcIlhNTEh0dHBSZXF1ZXN0LFN0YXR1czpcIiArIHhoci5zdGF0dXMgKyBcIixSZXNwb25zZTpcIiArIF9nZXRSZXNwb25zZVRleHQoeGhyKSB8fCB4aHIucmVzcG9uc2UgfHwgXCJcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBTZW5kIFhEb21haW5SZXF1ZXN0XHJcbiAgICAgKiBAcGFyYW0gcGF5bG9hZCB7c3RyaW5nfSAtIFRoZSBkYXRhIHBheWxvYWQgdG8gYmUgc2VudC5cclxuICAgICAqIEBwYXJhbSBpc0FzeW5jIHtib29sZWFufSAtIEluZGljYXRlcyBpZiB0aGUgcmVxdWVzdCBzaG91bGQgYmUgc2VudCBhc3luY2hyb25vdXNseVxyXG4gICAgICpcclxuICAgICAqIE5vdGU6IFhEb21haW5SZXF1ZXN0IGRvZXMgbm90IHN1cHBvcnQgc3luYyByZXF1ZXN0cy4gVGhpcyAnaXNBc3luYycgcGFyYW1ldGVyIGlzIGFkZGVkXHJcbiAgICAgKiB0byBtYWludGFpbiBjb25zaXN0ZW5jeSB3aXRoIHRoZSB4aHJTZW5kZXIncyBjb250cmFjdFxyXG4gICAgICogTm90ZTogWERvbWFpblJlcXVlc3QgZG9lcyBub3Qgc3VwcG9ydCBjdXN0b20gaGVhZGVycyBhbmQgd2UgYXJlIG5vdCBhYmxlIHRvIGdldFxyXG4gICAgICogYXBwSWQgZnJvbSB0aGUgYmFja2VuZCBmb3IgdGhlIGNvcnJlY3QgY29ycmVsYXRpb24uXHJcbiAgICAgKi9cclxuICAgIFNlbmRlci5wcm90b3R5cGUuX3hkclNlbmRlciA9IGZ1bmN0aW9uIChwYXlsb2FkLCBpc0FzeW5jKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2YXIgX3dpbmRvdyA9IGdldFdpbmRvdygpO1xyXG4gICAgICAgIHZhciB4ZHIgPSBuZXcgWERvbWFpblJlcXVlc3QoKTtcclxuICAgICAgICB4ZHIub25sb2FkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX3hkck9uTG9hZCh4ZHIsIHBheWxvYWQpOyB9O1xyXG4gICAgICAgIHhkci5vbmVycm9yID0gZnVuY3Rpb24gKGV2ZW50KSB7IHJldHVybiBfdGhpcy5fb25FcnJvcihwYXlsb2FkLCBfdGhpcy5fZm9ybWF0RXJyb3JNZXNzYWdlWGRyKHhkciksIGV2ZW50KTsgfTtcclxuICAgICAgICAvLyBYRG9tYWluUmVxdWVzdCByZXF1aXJlcyB0aGUgc2FtZSBwcm90b2NvbCBhcyB0aGUgaG9zdGluZyBwYWdlLlxyXG4gICAgICAgIC8vIElmIHRoZSBwcm90b2NvbCBkb2Vzbid0IG1hdGNoLCB3ZSBjYW4ndCBzZW5kIHRoZSB0ZWxlbWV0cnkgOiguXHJcbiAgICAgICAgdmFyIGhvc3RpbmdQcm90b2NvbCA9IF93aW5kb3cgJiYgX3dpbmRvdy5sb2NhdGlvbiAmJiBfd2luZG93LmxvY2F0aW9uLnByb3RvY29sIHx8IFwiXCI7XHJcbiAgICAgICAgaWYgKHRoaXMuX3NlbmRlckNvbmZpZy5lbmRwb2ludFVybCgpLmxhc3RJbmRleE9mKGhvc3RpbmdQcm90b2NvbCwgMCkgIT09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5kaWFnTG9nKCkudGhyb3dJbnRlcm5hbChMb2dnaW5nU2V2ZXJpdHkuV0FSTklORywgX0ludGVybmFsTWVzc2FnZUlkLlRyYW5zbWlzc2lvbkZhaWxlZCwgXCIuIFwiICtcclxuICAgICAgICAgICAgICAgIFwiQ2Fubm90IHNlbmQgWERvbWFpbiByZXF1ZXN0LiBUaGUgZW5kcG9pbnQgVVJMIHByb3RvY29sIGRvZXNuJ3QgbWF0Y2ggdGhlIGhvc3RpbmcgcGFnZSBwcm90b2NvbC5cIik7XHJcbiAgICAgICAgICAgIHRoaXMuX2J1ZmZlci5jbGVhcigpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBlbmRwb2ludFVybCA9IHRoaXMuX3NlbmRlckNvbmZpZy5lbmRwb2ludFVybCgpLnJlcGxhY2UoL14oaHR0cHM/OikvLCBcIlwiKTtcclxuICAgICAgICB4ZHIub3BlbignUE9TVCcsIGVuZHBvaW50VXJsKTtcclxuICAgICAgICAvLyBjb21wb3NlIGFuIGFycmF5IG9mIHBheWxvYWRzXHJcbiAgICAgICAgdmFyIGJhdGNoID0gdGhpcy5fYnVmZmVyLmJhdGNoUGF5bG9hZHMocGF5bG9hZCk7XHJcbiAgICAgICAgeGRyLnNlbmQoYmF0Y2gpO1xyXG4gICAgICAgIHRoaXMuX2J1ZmZlci5tYXJrQXNTZW50KHBheWxvYWQpO1xyXG4gICAgfTtcclxuICAgIFNlbmRlci5wcm90b3R5cGUuX2Zvcm1hdEVycm9yTWVzc2FnZVhkciA9IGZ1bmN0aW9uICh4ZHIsIG1lc3NhZ2UpIHtcclxuICAgICAgICBpZiAoeGRyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcIlhEb21haW5SZXF1ZXN0LFJlc3BvbnNlOlwiICsgX2dldFJlc3BvbnNlVGV4dCh4ZHIpIHx8IFwiXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBtZXNzYWdlO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTZW5kZXI7XHJcbn0oQmFzZVRlbGVtZXRyeVBsdWdpbikpO1xyXG5leHBvcnQgeyBTZW5kZXIgfTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9U2VuZGVyLmpzLm1hcCIsImltcG9ydCB7IFV0aWwsIEZpZWxkVHlwZSB9IGZyb20gJ0BtaWNyb3NvZnQvYXBwbGljYXRpb25pbnNpZ2h0cy1jb21tb24nO1xyXG5pbXBvcnQgeyBMb2dnaW5nU2V2ZXJpdHksIF9JbnRlcm5hbE1lc3NhZ2VJZCwgQ29yZVV0aWxzLCBnZXRKU09OIH0gZnJvbSAnQG1pY3Jvc29mdC9hcHBsaWNhdGlvbmluc2lnaHRzLWNvcmUtanMnO1xyXG52YXIgU2VyaWFsaXplciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFNlcmlhbGl6ZXIobG9nZ2VyKSB7XHJcbiAgICAgICAgdGhpcy5fbG9nZ2VyID0gbG9nZ2VyO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXJpYWxpemVzIHRoZSBjdXJyZW50IG9iamVjdCB0byBhIEpTT04gc3RyaW5nLlxyXG4gICAgICovXHJcbiAgICBTZXJpYWxpemVyLnByb3RvdHlwZS5zZXJpYWxpemUgPSBmdW5jdGlvbiAoaW5wdXQpIHtcclxuICAgICAgICB2YXIgb3V0cHV0ID0gdGhpcy5fc2VyaWFsaXplT2JqZWN0KGlucHV0LCBcInJvb3RcIik7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldEpTT04oKS5zdHJpbmdpZnkob3V0cHV0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgLy8gaWYgc2VyaWFsaXphdGlvbiBmYWlscyByZXR1cm4gYW4gZW1wdHkgc3RyaW5nXHJcbiAgICAgICAgICAgIHRoaXMuX2xvZ2dlci50aHJvd0ludGVybmFsKExvZ2dpbmdTZXZlcml0eS5DUklUSUNBTCwgX0ludGVybmFsTWVzc2FnZUlkLkNhbm5vdFNlcmlhbGl6ZU9iamVjdCwgKGUgJiYgQ29yZVV0aWxzLmlzRnVuY3Rpb24oZS50b1N0cmluZykpID8gZS50b1N0cmluZygpIDogXCJFcnJvciBzZXJpYWxpemluZyBvYmplY3RcIiwgbnVsbCwgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNlcmlhbGl6ZXIucHJvdG90eXBlLl9zZXJpYWxpemVPYmplY3QgPSBmdW5jdGlvbiAoc291cmNlLCBuYW1lKSB7XHJcbiAgICAgICAgdmFyIGNpcmN1bGFyUmVmZXJlbmNlQ2hlY2sgPSBcIl9fYWlDaXJjdWxhclJlZkNoZWNrXCI7XHJcbiAgICAgICAgdmFyIG91dHB1dCA9IHt9O1xyXG4gICAgICAgIGlmICghc291cmNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2xvZ2dlci50aHJvd0ludGVybmFsKExvZ2dpbmdTZXZlcml0eS5DUklUSUNBTCwgX0ludGVybmFsTWVzc2FnZUlkLkNhbm5vdFNlcmlhbGl6ZU9iamVjdCwgXCJjYW5ub3Qgc2VyaWFsaXplIG9iamVjdCBiZWNhdXNlIGl0IGlzIG51bGwgb3IgdW5kZWZpbmVkXCIsIHsgbmFtZTogbmFtZSB9LCB0cnVlKTtcclxuICAgICAgICAgICAgcmV0dXJuIG91dHB1dDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHNvdXJjZVtjaXJjdWxhclJlZmVyZW5jZUNoZWNrXSkge1xyXG4gICAgICAgICAgICB0aGlzLl9sb2dnZXIudGhyb3dJbnRlcm5hbChMb2dnaW5nU2V2ZXJpdHkuV0FSTklORywgX0ludGVybmFsTWVzc2FnZUlkLkNpcmN1bGFyUmVmZXJlbmNlRGV0ZWN0ZWQsIFwiQ2lyY3VsYXIgcmVmZXJlbmNlIGRldGVjdGVkIHdoaWxlIHNlcmlhbGl6aW5nIG9iamVjdFwiLCB7IG5hbWU6IG5hbWUgfSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghc291cmNlLmFpRGF0YUNvbnRyYWN0KSB7XHJcbiAgICAgICAgICAgIC8vIHNwZWNpYWwgY2FzZSBmb3IgbWVhc3VyZW1lbnRzL3Byb3BlcnRpZXMvdGFnc1xyXG4gICAgICAgICAgICBpZiAobmFtZSA9PT0gXCJtZWFzdXJlbWVudHNcIikge1xyXG4gICAgICAgICAgICAgICAgb3V0cHV0ID0gdGhpcy5fc2VyaWFsaXplU3RyaW5nTWFwKHNvdXJjZSwgXCJudW1iZXJcIiwgbmFtZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAobmFtZSA9PT0gXCJwcm9wZXJ0aWVzXCIpIHtcclxuICAgICAgICAgICAgICAgIG91dHB1dCA9IHRoaXMuX3NlcmlhbGl6ZVN0cmluZ01hcChzb3VyY2UsIFwic3RyaW5nXCIsIG5hbWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKG5hbWUgPT09IFwidGFnc1wiKSB7XHJcbiAgICAgICAgICAgICAgICBvdXRwdXQgPSB0aGlzLl9zZXJpYWxpemVTdHJpbmdNYXAoc291cmNlLCBcInN0cmluZ1wiLCBuYW1lKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChVdGlsLmlzQXJyYXkoc291cmNlKSkge1xyXG4gICAgICAgICAgICAgICAgb3V0cHV0ID0gdGhpcy5fc2VyaWFsaXplQXJyYXkoc291cmNlLCBuYW1lKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2xvZ2dlci50aHJvd0ludGVybmFsKExvZ2dpbmdTZXZlcml0eS5XQVJOSU5HLCBfSW50ZXJuYWxNZXNzYWdlSWQuQ2Fubm90U2VyaWFsaXplT2JqZWN0Tm9uU2VyaWFsaXphYmxlLCBcIkF0dGVtcHRpbmcgdG8gc2VyaWFsaXplIGFuIG9iamVjdCB3aGljaCBkb2VzIG5vdCBpbXBsZW1lbnQgSVNlcmlhbGl6YWJsZVwiLCB7IG5hbWU6IG5hbWUgfSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHZlcmlmeSB0aGF0IHRoZSBvYmplY3QgY2FuIGJlIHN0cmluZ2lmaWVkXHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0SlNPTigpLnN0cmluZ2lmeShzb3VyY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IHNvdXJjZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgc2VyaWFsaXphdGlvbiBmYWlscyByZXR1cm4gYW4gZW1wdHkgc3RyaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbG9nZ2VyLnRocm93SW50ZXJuYWwoTG9nZ2luZ1NldmVyaXR5LkNSSVRJQ0FMLCBfSW50ZXJuYWxNZXNzYWdlSWQuQ2Fubm90U2VyaWFsaXplT2JqZWN0LCAoZSAmJiBDb3JlVXRpbHMuaXNGdW5jdGlvbihlLnRvU3RyaW5nKSkgPyBlLnRvU3RyaW5nKCkgOiBcIkVycm9yIHNlcmlhbGl6aW5nIG9iamVjdFwiLCBudWxsLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gb3V0cHV0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBzb3VyY2VbY2lyY3VsYXJSZWZlcmVuY2VDaGVja10gPSB0cnVlO1xyXG4gICAgICAgIGZvciAodmFyIGZpZWxkIGluIHNvdXJjZS5haURhdGFDb250cmFjdCkge1xyXG4gICAgICAgICAgICB2YXIgY29udHJhY3QgPSBzb3VyY2UuYWlEYXRhQ29udHJhY3RbZmllbGRdO1xyXG4gICAgICAgICAgICB2YXIgaXNSZXF1aXJlZCA9IChDb3JlVXRpbHMuaXNGdW5jdGlvbihjb250cmFjdCkpID8gKGNvbnRyYWN0KCkgJiBGaWVsZFR5cGUuUmVxdWlyZWQpIDogKGNvbnRyYWN0ICYgRmllbGRUeXBlLlJlcXVpcmVkKTtcclxuICAgICAgICAgICAgdmFyIGlzSGlkZGVuID0gKENvcmVVdGlscy5pc0Z1bmN0aW9uKGNvbnRyYWN0KSkgPyAoY29udHJhY3QoKSAmIEZpZWxkVHlwZS5IaWRkZW4pIDogKGNvbnRyYWN0ICYgRmllbGRUeXBlLkhpZGRlbik7XHJcbiAgICAgICAgICAgIHZhciBpc0FycmF5ID0gY29udHJhY3QgJiBGaWVsZFR5cGUuQXJyYXk7XHJcbiAgICAgICAgICAgIHZhciBpc1ByZXNlbnQgPSBzb3VyY2VbZmllbGRdICE9PSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIHZhciBpc09iamVjdCA9IENvcmVVdGlscy5pc09iamVjdChzb3VyY2VbZmllbGRdKSAmJiBzb3VyY2VbZmllbGRdICE9PSBudWxsO1xyXG4gICAgICAgICAgICBpZiAoaXNSZXF1aXJlZCAmJiAhaXNQcmVzZW50ICYmICFpc0FycmF5KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9sb2dnZXIudGhyb3dJbnRlcm5hbChMb2dnaW5nU2V2ZXJpdHkuQ1JJVElDQUwsIF9JbnRlcm5hbE1lc3NhZ2VJZC5NaXNzaW5nUmVxdWlyZWRGaWVsZFNwZWNpZmljYXRpb24sIFwiTWlzc2luZyByZXF1aXJlZCBmaWVsZCBzcGVjaWZpY2F0aW9uLiBUaGUgZmllbGQgaXMgcmVxdWlyZWQgYnV0IG5vdCBwcmVzZW50IG9uIHNvdXJjZVwiLCB7IGZpZWxkOiBmaWVsZCwgbmFtZTogbmFtZSB9KTtcclxuICAgICAgICAgICAgICAgIC8vIElmIG5vdCBpbiBkZWJ1ZyBtb2RlLCBjb250aW51ZSBhbmQgaG9wZSB0aGUgZXJyb3IgaXMgcGVybWlzc2libGVcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpc0hpZGRlbikge1xyXG4gICAgICAgICAgICAgICAgLy8gRG9uJ3Qgc2VyaWFsaXplIGhpZGRlbiBmaWVsZHNcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHZvaWQgMDtcclxuICAgICAgICAgICAgaWYgKGlzT2JqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNBcnJheSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNwZWNpYWwgY2FzZTsgcmVzdXJzZSBvbiBlYWNoIG9iamVjdCBpbiB0aGUgc291cmNlIGFycmF5XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLl9zZXJpYWxpemVBcnJheShzb3VyY2VbZmllbGRdLCBmaWVsZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyByZWN1cnNlIG9uIHRoZSBzb3VyY2Ugb2JqZWN0IGluIHRoaXMgZmllbGRcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHRoaXMuX3NlcmlhbGl6ZU9iamVjdChzb3VyY2VbZmllbGRdLCBmaWVsZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBhc3NpZ24gdGhlIHNvdXJjZSBmaWVsZCB0byB0aGUgb3V0cHV0IGV2ZW4gaWYgdW5kZWZpbmVkIG9yIHJlcXVpcmVkXHJcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHNvdXJjZVtmaWVsZF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gb25seSBlbWl0IHRoaXMgZmllbGQgaWYgdGhlIHZhbHVlIGlzIGRlZmluZWRcclxuICAgICAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIG91dHB1dFtmaWVsZF0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBkZWxldGUgc291cmNlW2NpcmN1bGFyUmVmZXJlbmNlQ2hlY2tdO1xyXG4gICAgICAgIHJldHVybiBvdXRwdXQ7XHJcbiAgICB9O1xyXG4gICAgU2VyaWFsaXplci5wcm90b3R5cGUuX3NlcmlhbGl6ZUFycmF5ID0gZnVuY3Rpb24gKHNvdXJjZXMsIG5hbWUpIHtcclxuICAgICAgICB2YXIgb3V0cHV0O1xyXG4gICAgICAgIGlmICghIXNvdXJjZXMpIHtcclxuICAgICAgICAgICAgaWYgKCFVdGlsLmlzQXJyYXkoc291cmNlcykpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2xvZ2dlci50aHJvd0ludGVybmFsKExvZ2dpbmdTZXZlcml0eS5DUklUSUNBTCwgX0ludGVybmFsTWVzc2FnZUlkLkl0ZW1Ob3RJbkFycmF5LCBcIlRoaXMgZmllbGQgd2FzIHNwZWNpZmllZCBhcyBhbiBhcnJheSBpbiB0aGUgY29udHJhY3QgYnV0IHRoZSBpdGVtIGlzIG5vdCBhbiBhcnJheS5cXHJcXG5cIiwgeyBuYW1lOiBuYW1lIH0sIHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb3V0cHV0ID0gW107XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNvdXJjZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlID0gc291cmNlc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXMuX3NlcmlhbGl6ZU9iamVjdChzb3VyY2UsIG5hbWUgKyBcIltcIiArIGkgKyBcIl1cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0LnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG91dHB1dDtcclxuICAgIH07XHJcbiAgICBTZXJpYWxpemVyLnByb3RvdHlwZS5fc2VyaWFsaXplU3RyaW5nTWFwID0gZnVuY3Rpb24gKG1hcCwgZXhwZWN0ZWRUeXBlLCBuYW1lKSB7XHJcbiAgICAgICAgdmFyIG91dHB1dDtcclxuICAgICAgICBpZiAobWFwKSB7XHJcbiAgICAgICAgICAgIG91dHB1dCA9IHt9O1xyXG4gICAgICAgICAgICBmb3IgKHZhciBmaWVsZCBpbiBtYXApIHtcclxuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IG1hcFtmaWVsZF07XHJcbiAgICAgICAgICAgICAgICBpZiAoZXhwZWN0ZWRUeXBlID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W2ZpZWxkXSA9IFwidW5kZWZpbmVkXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtmaWVsZF0gPSBcIm51bGxcIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIXZhbHVlLnRvU3RyaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtmaWVsZF0gPSBcImludmFsaWQgZmllbGQ6IHRvU3RyaW5nKCkgaXMgbm90IGRlZmluZWQuXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbZmllbGRdID0gdmFsdWUudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChleHBlY3RlZFR5cGUgPT09IFwibnVtYmVyXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbZmllbGRdID0gXCJ1bmRlZmluZWRcIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W2ZpZWxkXSA9IFwibnVsbFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG51bSA9IHBhcnNlRmxvYXQodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNOYU4obnVtKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W2ZpZWxkXSA9IFwiTmFOXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbZmllbGRdID0gbnVtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0W2ZpZWxkXSA9IFwiaW52YWxpZCBmaWVsZDogXCIgKyBuYW1lICsgXCIgaXMgb2YgdW5rbm93biB0eXBlLlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2xvZ2dlci50aHJvd0ludGVybmFsKExvZ2dpbmdTZXZlcml0eS5DUklUSUNBTCwgb3V0cHV0W2ZpZWxkXSwgbnVsbCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG91dHB1dDtcclxuICAgIH07XHJcbiAgICByZXR1cm4gU2VyaWFsaXplcjtcclxufSgpKTtcclxuZXhwb3J0IHsgU2VyaWFsaXplciB9O1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1TZXJpYWxpemVyLmpzLm1hcCIsIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbmltcG9ydCB7IFNhbXBsaW5nU2NvcmVHZW5lcmF0b3IgfSBmcm9tICcuL1NhbXBsaW5nU2NvcmVHZW5lcmF0b3JzL1NhbXBsaW5nU2NvcmVHZW5lcmF0b3InO1xyXG5pbXBvcnQgeyBNZXRyaWMgfSBmcm9tICdAbWljcm9zb2Z0L2FwcGxpY2F0aW9uaW5zaWdodHMtY29tbW9uJztcclxuaW1wb3J0IHsgX0ludGVybmFsTWVzc2FnZUlkLCBMb2dnaW5nU2V2ZXJpdHksIERpYWdub3N0aWNMb2dnZXIsIENvcmVVdGlscyB9IGZyb20gJ0BtaWNyb3NvZnQvYXBwbGljYXRpb25pbnNpZ2h0cy1jb3JlLWpzJztcclxudmFyIFNhbXBsZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFNhbXBsZShzYW1wbGVSYXRlLCBsb2dnZXIpIHtcclxuICAgICAgICAvLyBXZSdyZSB1c2luZyAzMiBiaXQgbWF0aCwgaGVuY2UgbWF4IHZhbHVlIGlzICgyXjMxIC0gMSlcclxuICAgICAgICB0aGlzLklOVF9NQVhfVkFMVUUgPSAyMTQ3NDgzNjQ3O1xyXG4gICAgICAgIHRoaXMuX2xvZ2dlciA9IENvcmVVdGlscy5pc051bGxPclVuZGVmaW5lZChsb2dnZXIpID8gbmV3IERpYWdub3N0aWNMb2dnZXIoKSA6IGxvZ2dlcjtcclxuICAgICAgICBpZiAoc2FtcGxlUmF0ZSA+IDEwMCB8fCBzYW1wbGVSYXRlIDwgMCkge1xyXG4gICAgICAgICAgICB0aGlzLl9sb2dnZXIudGhyb3dJbnRlcm5hbChMb2dnaW5nU2V2ZXJpdHkuV0FSTklORywgX0ludGVybmFsTWVzc2FnZUlkLlNhbXBsZVJhdGVPdXRPZlJhbmdlLCBcIlNhbXBsaW5nIHJhdGUgaXMgb3V0IG9mIHJhbmdlICgwLi4xMDApLiBTYW1wbGluZyB3aWxsIGJlIGRpc2FibGVkLCB5b3UgbWF5IGJlIHNlbmRpbmcgdG9vIG11Y2ggZGF0YSB3aGljaCBtYXkgYWZmZWN0IHlvdXIgQUkgc2VydmljZSBsZXZlbC5cIiwgeyBzYW1wbGluZ1JhdGU6IHNhbXBsZVJhdGUgfSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2FtcGxlUmF0ZSA9IDEwMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zYW1wbGVSYXRlID0gc2FtcGxlUmF0ZTtcclxuICAgICAgICB0aGlzLnNhbXBsaW5nU2NvcmVHZW5lcmF0b3IgPSBuZXcgU2FtcGxpbmdTY29yZUdlbmVyYXRvcigpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBEZXRlcm1pbmVzIGlmIGFuIGVudmVsb3BlIGlzIHNhbXBsZWQgaW4gKGkuZS4gd2lsbCBiZSBzZW50KSBvciBub3QgKGkuZS4gd2lsbCBiZSBkcm9wcGVkKS5cclxuICAgICAqL1xyXG4gICAgU2FtcGxlLnByb3RvdHlwZS5pc1NhbXBsZWRJbiA9IGZ1bmN0aW9uIChlbnZlbG9wZSkge1xyXG4gICAgICAgIHZhciBzYW1wbGluZ1BlcmNlbnRhZ2UgPSB0aGlzLnNhbXBsZVJhdGU7IC8vIDAgLSAxMDBcclxuICAgICAgICB2YXIgaXNTYW1wbGVkSW4gPSBmYWxzZTtcclxuICAgICAgICBpZiAoc2FtcGxpbmdQZXJjZW50YWdlID09PSBudWxsIHx8IHNhbXBsaW5nUGVyY2VudGFnZSA9PT0gdW5kZWZpbmVkIHx8IHNhbXBsaW5nUGVyY2VudGFnZSA+PSAxMDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGVudmVsb3BlLmJhc2VUeXBlID09PSBNZXRyaWMuZGF0YVR5cGUpIHtcclxuICAgICAgICAgICAgLy8gZXhjbHVkZSBNZXRyaWNEYXRhIHRlbGVtZXRyeSBmcm9tIHNhbXBsaW5nXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpc1NhbXBsZWRJbiA9IHRoaXMuc2FtcGxpbmdTY29yZUdlbmVyYXRvci5nZXRTYW1wbGluZ1Njb3JlKGVudmVsb3BlKSA8IHNhbXBsaW5nUGVyY2VudGFnZTtcclxuICAgICAgICByZXR1cm4gaXNTYW1wbGVkSW47XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFNhbXBsZTtcclxufSgpKTtcclxuZXhwb3J0IHsgU2FtcGxlIH07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVNhbXBsZS5qcy5tYXAiLCIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG52YXIgSGFzaENvZGVTY29yZUdlbmVyYXRvciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEhhc2hDb2RlU2NvcmVHZW5lcmF0b3IoKSB7XHJcbiAgICB9XHJcbiAgICBIYXNoQ29kZVNjb3JlR2VuZXJhdG9yLnByb3RvdHlwZS5nZXRIYXNoQ29kZVNjb3JlID0gZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgIHZhciBzY29yZSA9IHRoaXMuZ2V0SGFzaENvZGUoa2V5KSAvIEhhc2hDb2RlU2NvcmVHZW5lcmF0b3IuSU5UX01BWF9WQUxVRTtcclxuICAgICAgICByZXR1cm4gc2NvcmUgKiAxMDA7XHJcbiAgICB9O1xyXG4gICAgSGFzaENvZGVTY29yZUdlbmVyYXRvci5wcm90b3R5cGUuZ2V0SGFzaENvZGUgPSBmdW5jdGlvbiAoaW5wdXQpIHtcclxuICAgICAgICBpZiAoaW5wdXQgPT09IFwiXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHdoaWxlIChpbnB1dC5sZW5ndGggPCBIYXNoQ29kZVNjb3JlR2VuZXJhdG9yLk1JTl9JTlBVVF9MRU5HVEgpIHtcclxuICAgICAgICAgICAgaW5wdXQgPSBpbnB1dC5jb25jYXQoaW5wdXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyA1MzgxIGlzIGEgbWFnaWMgbnVtYmVyOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzEwNjk2MjIzL3JlYXNvbi1mb3ItNTM4MS1udW1iZXItaW4tZGpiLWhhc2gtZnVuY3Rpb25cclxuICAgICAgICB2YXIgaGFzaCA9IDUzODE7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgICAgICBoYXNoID0gKChoYXNoIDw8IDUpICsgaGFzaCkgKyBpbnB1dC5jaGFyQ29kZUF0KGkpO1xyXG4gICAgICAgICAgICAvLyAnaGFzaCcgaXMgb2YgbnVtYmVyIHR5cGUgd2hpY2ggbWVhbnMgNTMgYml0IGludGVnZXIgKGh0dHA6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi82LjAvI3NlYy1lY21hc2NyaXB0LWxhbmd1YWdlLXR5cGVzLW51bWJlci10eXBlKVxyXG4gICAgICAgICAgICAvLyAnaGFzaCAmIGhhc2gnIHdpbGwga2VlcCBpdCAzMiBiaXQgaW50ZWdlciAtIGp1c3QgdG8gbWFrZSBpdCBjbGVhcmVyIHdoYXQgdGhlIHJlc3VsdCBpcy5cclxuICAgICAgICAgICAgaGFzaCA9IGhhc2ggJiBoYXNoO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gTWF0aC5hYnMoaGFzaCk7XHJcbiAgICB9O1xyXG4gICAgLy8gV2UncmUgdXNpbmcgMzIgYml0IG1hdGgsIGhlbmNlIG1heCB2YWx1ZSBpcyAoMl4zMSAtIDEpXHJcbiAgICBIYXNoQ29kZVNjb3JlR2VuZXJhdG9yLklOVF9NQVhfVkFMVUUgPSAyMTQ3NDgzNjQ3O1xyXG4gICAgLy8gKE1hZ2ljIG51bWJlcikgREpCIGFsZ29yaXRobSBjYW4ndCB3b3JrIG9uIHNob3J0ZXIgc3RyaW5ncyAocmVzdWx0cyBpbiBwb29yIGRpc3RyaWJ1dGlvblxyXG4gICAgSGFzaENvZGVTY29yZUdlbmVyYXRvci5NSU5fSU5QVVRfTEVOR1RIID0gODtcclxuICAgIHJldHVybiBIYXNoQ29kZVNjb3JlR2VuZXJhdG9yO1xyXG59KCkpO1xyXG5leHBvcnQgeyBIYXNoQ29kZVNjb3JlR2VuZXJhdG9yIH07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUhhc2hDb2RlU2NvcmVHZW5lcmF0b3IuanMubWFwIiwiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuaW1wb3J0IHsgSGFzaENvZGVTY29yZUdlbmVyYXRvciB9IGZyb20gJy4vSGFzaENvZGVTY29yZUdlbmVyYXRvcic7XHJcbmltcG9ydCB7IENvbnRleHRUYWdLZXlzIH0gZnJvbSAnQG1pY3Jvc29mdC9hcHBsaWNhdGlvbmluc2lnaHRzLWNvbW1vbic7XHJcbnZhciBTYW1wbGluZ1Njb3JlR2VuZXJhdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gU2FtcGxpbmdTY29yZUdlbmVyYXRvcigpIHtcclxuICAgICAgICB0aGlzLmhhc2hDb2RlR2VuZXJhZ29yID0gbmV3IEhhc2hDb2RlU2NvcmVHZW5lcmF0b3IoKTtcclxuICAgICAgICB0aGlzLmtleXMgPSBuZXcgQ29udGV4dFRhZ0tleXMoKTtcclxuICAgIH1cclxuICAgIFNhbXBsaW5nU2NvcmVHZW5lcmF0b3IucHJvdG90eXBlLmdldFNhbXBsaW5nU2NvcmUgPSBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgIHZhciBzY29yZSA9IDA7XHJcbiAgICAgICAgaWYgKGl0ZW0udGFncyAmJiBpdGVtLnRhZ3NbdGhpcy5rZXlzLnVzZXJJZF0pIHtcclxuICAgICAgICAgICAgc2NvcmUgPSB0aGlzLmhhc2hDb2RlR2VuZXJhZ29yLmdldEhhc2hDb2RlU2NvcmUoaXRlbS50YWdzW3RoaXMua2V5cy51c2VySWRdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoaXRlbS5leHQgJiYgaXRlbS5leHQudXNlciAmJiBpdGVtLmV4dC51c2VyLmlkKSB7XHJcbiAgICAgICAgICAgIHNjb3JlID0gdGhpcy5oYXNoQ29kZUdlbmVyYWdvci5nZXRIYXNoQ29kZVNjb3JlKGl0ZW0uZXh0LnVzZXIuaWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChpdGVtLnRhZ3MgJiYgaXRlbS50YWdzW3RoaXMua2V5cy5vcGVyYXRpb25JZF0pIHtcclxuICAgICAgICAgICAgc2NvcmUgPSB0aGlzLmhhc2hDb2RlR2VuZXJhZ29yLmdldEhhc2hDb2RlU2NvcmUoaXRlbS50YWdzW3RoaXMua2V5cy5vcGVyYXRpb25JZF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChpdGVtLmV4dCAmJiBpdGVtLmV4dC50ZWxlbWV0cnlUcmFjZSAmJiBpdGVtLmV4dC50ZWxlbWV0cnlUcmFjZS50cmFjZUlEKSB7XHJcbiAgICAgICAgICAgIHNjb3JlID0gdGhpcy5oYXNoQ29kZUdlbmVyYWdvci5nZXRIYXNoQ29kZVNjb3JlKGl0ZW0uZXh0LnRlbGVtZXRyeVRyYWNlLnRyYWNlSUQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmluc2VjdXJlLXJhbmRvbVxyXG4gICAgICAgICAgICBzY29yZSA9IChNYXRoLnJhbmRvbSgpICogMTAwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNjb3JlO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTYW1wbGluZ1Njb3JlR2VuZXJhdG9yO1xyXG59KCkpO1xyXG5leHBvcnQgeyBTYW1wbGluZ1Njb3JlR2VuZXJhdG9yIH07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVNhbXBsaW5nU2NvcmVHZW5lcmF0b3IuanMubWFwIiwiZXhwb3J0IHsgU2VuZGVyIH0gZnJvbSBcIi4vU2VuZGVyXCI7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcGxpY2F0aW9uaW5zaWdodHMtY2hhbm5lbC1qcy5qcy5tYXAiXSwic291cmNlUm9vdCI6IiJ9